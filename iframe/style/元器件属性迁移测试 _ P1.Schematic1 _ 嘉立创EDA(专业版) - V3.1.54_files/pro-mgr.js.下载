(()=>{var Ux=Object.create;var rw=Object.defineProperty;var Hx=Object.getOwnPropertyDescriptor;var Gx=Object.getOwnPropertyNames;var Yx=Object.getPrototypeOf,Vx=Object.prototype.hasOwnProperty;var wr=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,s)=>(typeof require<"u"?require:t)[s]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Bl=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var zx=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Gx(t))!Vx.call(e,i)&&i!==s&&rw(e,i,{get:()=>t[i],enumerable:!(r=Hx(t,i))||r.enumerable});return e};var Ei=(e,t,s)=>(s=e!=null?Ux(Yx(e)):{},zx(t||!e||!e.__esModule?rw(s,"default",{value:e,enumerable:!0}):s,e));var Vi=Bl((uG,dw)=>{"use strict";var q0=Object.defineProperty,Wx=Object.getOwnPropertyDescriptor,qx=Object.getOwnPropertyNames,Jx=Object.prototype.hasOwnProperty,Kx=(e,t)=>{for(var s in t)q0(e,s,{get:t[s],enumerable:!0})},Xx=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of qx(t))!Jx.call(e,i)&&i!==s&&q0(e,i,{get:()=>t[i],enumerable:!(r=Wx(t,i))||r.enumerable});return e},Zx=e=>Xx(q0({},"__esModule",{value:!0}),e),iw={};Kx(iw,{BroadcastChannelMessageBus:()=>fv,MessageBus:()=>lv,MessageBus2:()=>dv,MessageBusTask:()=>z0,MessageBusTask2:()=>Ch,WindowMessageBridge:()=>cv,WorkerMessageBridge:()=>ov,createBroadcastP2PStream:()=>uw,createBufferedByteBufferStream:()=>lw,createBufferedStream:()=>X0,createBufferedStringStream:()=>cw,dropP2PStream:()=>mv,flowRead:()=>yv,flowWrite:()=>gv});dw.exports=Zx(iw);var Nf=class{constructor(e=1.5){this.growthFactor=e,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(e){if(this.count===this.capacity){let t=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,t);let s=new Array(t);for(let r=0;r<this.count;r++)s[r]=this.buffer[(this.head+r)%this.capacity];this.buffer=s,this.head=0,this.tail=this.count,this.capacity=t}this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let e=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,e}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},J0=new ArrayBuffer(8),oG=new Float64Array(J0),cG=new Uint32Array(J0),lG=new Uint16Array(J0),V0=ArrayBuffer;try{V0=self.HTMLImageElement||V0}catch{}var $x=typeof SharedArrayBuffer<"u";function Lf(e){if(typeof e!="object"||e===null||e instanceof Date||e instanceof ArrayBuffer||$x&&e instanceof SharedArrayBuffer||e instanceof Blob||e instanceof FormData||e instanceof Function||e instanceof Uint8ClampedArray||e instanceof V0)return e;if(Array.isArray(e))return e.map(Lf);{let t={};for(let s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=Lf(e[s]));return t}}function Y0(e,t){return Qx(e,t,()=>[])}function Qx(e,t,s){let r=e[t];return r!==void 0||(r=s(t),e[t]=r),r}var ev=class{constructor(e){this.maxResources=e,this.idle=new Nf,this.isClosed=!1,this.resources=e}acquire(e){this.isClosed?Promise.resolve(!1).then(e):this.resources>0?(this.resources--,Promise.resolve(!0).then(e)):this.idle.enqueue(e)}acquireSync(){return new Promise(e=>{this.acquire(e)})}release(){if(!this.isClosed){let e=this.idle.dequeue();e?Promise.resolve(!0).then(e):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let e=this.idle.dequeue();Promise.resolve(!1).then(e)}}};function tv(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function sv(e,t){let s=0,r=e.length;for(let i=0;i<r;i++)e[i]===t&&(e.splice(i,1),i--,r--,s++);return s}var rv=tv(),iv=rv.WeakRef||(e=>e);function bc(e){if(e!=null){if(typeof e=="object")return new iv(e);console.error(e,e instanceof Object,typeof e);return}}function Co(e){return e==null?void 0:e.deref()}var nv="_MSG_BUS_RPC_",K0=300*1e3,av=(e=>(e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.PUSH="push",e.PULL="pull",e))(av||{}),nw=class{constructor(e){this.bus=e}processRemoteMessage(e,t){let s=bc(t),r=e.topic,i=e.type,n=e.message;switch(i){case"pull":this.bus.pull(r,a=>{this.push(r,a,Co(s))});break;case"subscribe":this.bus.subscribe(r,a=>{this.publish(r,a,Co(s))});break;case"publish":this.bus.publish(r,n,this,Co(s));break;case"push":this.bus.push(r,n,this,Co(s));break;default:console.debug("unknown message type "+i)}}rpcCall(e,t,s,r=K0){let i=bc(s),n=new Promise(a=>{let o=this.bus.uniqueRpcTopic(e);this.publish(e,{message:t,reply:o},Co(i)),this.bus.pull(o,(c,l,u)=>{a({message:c,bridge:l,source:bc(u)})})});return r>0?Promise.race([n,new Promise((a,o)=>{setTimeout(o,r)})]):n}},ov=class extends nw{constructor(e,t){super(e),this.worker=t,t.onmessage=s=>{this.processRemoteMessage(s.data,void 0)}}publish(e,t){this.postMessage(e,"publish",t)}subscribe(e){this.postMessage(e,"subscribe",null)}push(e,t){this.postMessage(e,"push",t)}pull(e){this.postMessage(e,"pull",null)}rpcCall(e,t,s=K0){return super.rpcCall(e,t,void 0,s)}postMessage(e,t,s){let r={topic:e,type:t,message:s};this.worker.postMessage(r)}discard(){this.worker.terminate()}},cv=class extends nw{constructor(e){super(e),window.addEventListener("message",t=>{this.processRemoteMessage(t.data,t.source)},!1)}publish(e,t,s){this.postMessage(e,"publish",t,s)}subscribe(e,t){if(t===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(e,"subscribe",null,t)}push(e,t,s){this.postMessage(e,"push",t,s)}pull(e,t){if(t===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(e,"pull",null,t)}postMessage(e,t,s,r){let i={topic:e,type:t,message:s};r&&r.postMessage(i,"*")}},z0=class{constructor(e){this.isRunning=!0,this.callback=e}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(e,t,s,r){try{e=r?e:Lf(e),this.callback(e,t,s)}catch(i){console.error(i)}}},lv=class{constructor(e=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=e}uniqueRpcTopic(e){return`${nv}-${e}-${this.uuid}-${this.rpcTicket++}`}publish(e,t,s,r){let i=this.subscribed[e];if(i){let n;for(let a of i)a.running()?a.execute(t,s,r,this.unsafe):(n=n||new Array,n.push(a));if(n)for(let a of n)sv(i,a)}else console.debug("no sub on topic: "+e)}subscribe(e,t){let s=new z0(t);return Y0(this.subscribed,e).push(s),s}push(e,t,s,r){let i=!1,n=this.pulled[e];if(n){for(;n.length>0;){let a=n.shift();if(a.running()){a.execute(t,s,r,this.unsafe),i=!0;break}}n.length===0&&delete this.pulled[e]}i||Y0(this.pushed,e).push({message:t,bridge:s,source:bc(r)})}pull(e,t){let s=new z0(t),r=this.pushed[e];if(r){let i=r.shift();s.execute(i.message,i.bridge,Co(i.source),this.unsafe),r.length===0&&delete this.pushed[e]}else Y0(this.pulled,e).push(s);return s}pullA(e){return new Promise(t=>{this.pull(e,(s,r,i)=>{t({message:s,bridge:r,source:bc(i)})})})}rpcService(e,t){this.subscribe(e,(s,r,i)=>{let{message:n,reply:a}=s;try{let o=t(n);if(o instanceof Promise){let c=bc(i);o.then(l=>{this.rpcReply(l,a,r,Co(c))},l=>{console.error(l),this.rpcReply(void 0,a,r,Co(c))})}else this.rpcReply(o,a,r,i)}catch(o){console.error(o),this.rpcReply(void 0,a,r,i)}})}rpcCall(e,t,s=K0){let r=new Promise(i=>{let n=this.uniqueRpcTopic(e);this.publish(e,{message:t,reply:n}),this.pull(n,(a,o,c)=>{i({message:a,bridge:o,source:bc(c)})})});return s>0?Promise.race([r,new Promise((i,n)=>{setTimeout(n,s)})]):r}rpcReply(e,t,s,r){s?s.push(t,e,r):this.push(t,e)}},uv="_MSG_BUS_RPC_";function W0(e,t){let s=0,r=e.length;for(let i=0;i<r;i++)e[i]===t&&(e.splice(i,1),i--,r--,s++);return s}function kl(e,t){return hv(e,t,()=>[])}function hv(e,t,s){let r=e[t];return r!==void 0||(r=s(t),e[t]=r),r}var Ch=class{constructor(e,t){this.callback=e,this.unsafe=t,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(e){try{e=this.unsafe?e:Lf(e),this.callback(e)}catch(t){console.error(t)}}},aw=class{constructor(e=crypto.randomUUID()){this.uuid=e,this.rpcTicket=0}subscribeOnce(e,t){let s=this.subscribe(e,r=>{s.cancel(),t(r)});return s}pullA(e){return new Promise(t=>{this.pull(e,t)})}rpcService(e,t){let s=r=>{try{let{message:i,replyTopic:n}=r;try{let a=t(i);a instanceof Promise?a.then(o=>{this.publish(n,{success:!0,result:o})}).catch(o=>{console.error(o),this.publish(n,{success:!1,err:String(o)})}):this.publish(n,{success:!0,result:a})}catch(a){this.publish(n,{success:!1,err:String(a)})}}finally{this.pull(e,s)}};this.pull(e,s)}rpcCall(e,t,s=0){let r=new Promise((i,n)=>{let a=`${uv}-${e}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(a,o=>{o.success?i(o.result):n(new Error(o.err))}),this.push(e,{message:t,replyTopic:a})});return s>0?Promise.race([r,new Promise((i,n)=>{setTimeout(n,s)})]):r}},dv=class extends aw{constructor(e=!1){super(),this.unsafe=e,this.subscribed={},this.pulled={},this.pushed={}}publish(e,t){let s=this.subscribed[e];if(s){let r;for(let i of s)i.running()?i.execute(t):(r=r||new Array,r.push(i));if(r)for(let i of r)W0(s,i)}}subscribe(e,t){let s=new Ch(t,this.unsafe);return kl(this.subscribed,e).push(s),s}push(e,t){let s=!1,r=this.pulled[e];if(r){for(;r.length>0;){let i=r.shift();if(i&&i.running()){i.execute(t),s=!0;break}}r.length===0&&delete this.pulled[e]}s||kl(this.pushed,e).push(t)}pull(e,t){let s=new Ch(t,this.unsafe);return this.repull(e,s),s}repull(e,t){let s=this.pushed[e];if(s){let r=s.shift();r&&(t.execute(r),s.length===0&&delete this.pushed[e])}else kl(this.pulled,e).push(t)}},pv=class extends aw{constructor(e=crypto.randomUUID()){super(e),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(e,t){console.debug("BC",this.uuid,"PUBLISH",e,t),this.broadcastPublish(e,t)}subscribe(e,t){console.debug("BC",this.uuid,"SUBSCRIBE",e);let s=new Ch(t,!0);return kl(this.subscribed,e).push(s),s}push(e,t){let s=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",e,`(${s})`,t),kl(this.pushed,e).push({id:s,message:t}),this.broadcastPushedHeadMessage(e)}pull(e,t){console.debug("BC",this.uuid,"PULL",e);let s=new Ch(t,!0);return kl(this.pulled,e).push(s),this.broadcastWhoHas(e),s}broadcastPushedHeadMessage(e){let t=this.pushed[e];t&&t[0]&&this.broadcastIHave(e,t[0].id)}onReceivedPublish(e,t,s){console.debug("BCMSG(",this.uuid,")","from",e,"PUBLISH",t,"message",s);let r=this.subscribed[t];if(r){let i;for(let n of r)n.running()?n.execute(s):(i=i||new Array,i.push(n));if(i)for(let n of i)W0(r,n);r.length===0&&delete this.subscribed[t]}}onReceivedWhoHas(e,t){console.debug("BCMSG(",this.uuid,")","from",e,"WHOHAS",t),this.broadcastPushedHeadMessage(t)}onReceivedIHave(e,t,s){console.debug("BCMSG(",this.uuid,")","from",e,"IHAVE",t,"id",s);let r=this.pulled[t];if(r){let i;for(let n of r)if(n.running()){this.broadcastINeed(t,e,s);break}else i=i||new Array,i.push(n);if(i)for(let n of i)W0(r,n);r.length===0&&delete this.pulled[t]}}onReceivedINeed(e,t,s,r){if(console.debug("BCMSG(",this.uuid,")","from",e,"INEED",t,"source",s,"id",r),this.uuid===s){let i=this.pushed[t];if(i&&i[0]&&i[0].id===r){let{message:n}=i.shift();this.broadcastIGive(t,r,e,n),this.broadcastPushedHeadMessage(t),i.length===0&&delete this.pushed[t]}}}onReceivedIGive(e,t,s,r,i){console.debug("BCMSG(",this.uuid,")","from",e,"IGIVE",t,"id",s,"target",r,"message",i);let n=this.pulled[t];if(n&&this.uuid===r){let a=!1;for(;n.length>0;){let o=n.shift();if(o.running()){o.execute(i),a=!0;break}}a||this.push(t,i),n.length===0&&delete this.pulled[t]}}},fv=class extends pv{constructor(e,t=crypto.randomUUID()){super(t),this.bc=new BroadcastChannel(e),this.bc.onmessage=s=>{this.onMessage(s.data)}}onMessage(e){let{type:t,uuid:s,topic:r}=e;switch(t){case"PUBLISH":{let{message:i}=e;this.onReceivedPublish(s,r,i);break}case"WHOHAS":{this.onReceivedWhoHas(s,r);break}case"IHAVE":{let{id:i}=e;this.onReceivedIHave(s,r,i);break}case"INEED":{let{source:i,id:n}=e;this.onReceivedINeed(s,r,i,n);break}case"IGIVE":{let{target:i,id:n,message:a}=e;this.onReceivedIGive(s,r,n,i,a);break}default:console.warn("unsupported",e)}}broadcastPublish(e,t){this.post({type:"PUBLISH",uuid:this.uuid,topic:e,message:t})}broadcastWhoHas(e){this.post({type:"WHOHAS",uuid:this.uuid,topic:e})}broadcastIHave(e,t){this.post({type:"IHAVE",uuid:this.uuid,topic:e,id:t})}broadcastINeed(e,t,s){this.post({type:"INEED",uuid:this.uuid,topic:e,source:t,id:s})}broadcastIGive(e,t,s,r){this.post({type:"IGIVE",uuid:this.uuid,topic:e,id:t,target:s,message:r})}post(e){this.bc.postMessage(e),Promise.resolve().then(()=>{this.onMessage(e)})}},Ml=Symbol("BLOCKING_QUEUE_RESET"),ow=class{constructor(e,t=()=>1){if(this.maxSize=e,this.itemSizeOf=t,this.queue=new Nf,this.waitingConsumers=new Nf,this.waitingProducers=new Nf,this.queueSize=0,this.closePromise=null,this.closeResolve=null,e<=0)throw new Error("Max size must be greater than 0")}enqueue(e){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let t=await new Promise(s=>{this.waitingProducers.enqueue(s)});return console.debug("queue is not full",this.size(),t),t?(this.innerEnqueue(e),!0):!1})():(this.innerEnqueue(e),!0)}innerEnqueue(e){if(this.waitingConsumers.isEmpty())this.queue.enqueue(e),this.queueSize+=this.itemSizeOf(e),console.debug("queue pushed",e,"size",this.queueSize);else{let t=this.waitingConsumers.dequeue();Promise.resolve(e).then(t),console.debug("queue direct",e,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let e=this.waitingConsumers.dequeue();Promise.resolve(Ml).then(e)}return setTimeout(()=>this.closeResolve(),0),Ml}else return new Promise(e=>{this.waitingConsumers.enqueue(e)});else{let e=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(e),!this.waitingProducers.isEmpty()){let t=this.waitingProducers.dequeue();Promise.resolve(!0).then(t)}return e}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(e=>{for(this.closeResolve=e;!this.waitingProducers.isEmpty();){let t=this.waitingProducers.dequeue();Promise.resolve(!1).then(t)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let t=this.waitingConsumers.dequeue();Promise.resolve(Ml).then(t)}e()}})),this.closePromise}};function X0(e,t,s=Number.MAX_SAFE_INTEGER){let r=new ow(s,t),i=new ReadableStream({pull(a){let o=!0,c=(async()=>{let l=new Array;do{let u=r.dequeue();if(u instanceof Promise){o=!1;let h=await u;h===Ml?a.close():l.push(h)}else{let h=u;h===Ml?a.close():l.push(h)}}while(r.size()>0);if(l.length>0){let u=e(l);a.enqueue(u)}})();if(!o)return console.debug("read stream stucked --------------------------------------"),c},async cancel(){console.debug("buffered readable cancel"),await r.close()}}),n=new WritableStream({write(a,o){let c=!0,l=(async()=>{let u=r.enqueue(a);typeof u=="boolean"?u||o.error(new Error("Write stream closed")):(c=!1,await u||o.error(new Error("Write stream closed")))})();if(!c)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),l},async close(){console.debug("buffered writable closing",r.size()),await r.close(),console.debug("buffered writable closed",r.size())},async abort(){console.debug("buffered writable aborting",r.size()),await r.close(),console.debug("buffered writable aborted",r.size())}});return{readable:i,writable:n}}function cw(e=Number.MAX_SAFE_INTEGER){return X0(t=>t.join(""),t=>t.length,e)}function lw(e=Number.MAX_SAFE_INTEGER){return X0(t=>{let s=new Uint8Array(t.reduce((i,n)=>i+n.byteLength,0)),r=0;return t.forEach(i=>{s.set(i,r),r+=i.byteLength}),s},t=>t.byteLength,e)}function uw(e){return new Promise((t,s)=>{let r=new BroadcastChannel(e),i=new ow(1),n=new ev(1),a=null,o=!1,c=!1,l=!1;r.onmessage=u=>{let h=u.data,{type:p}=h;if(console.debug("p2p",e,"type",p,"data",p==="DATA"&&h.data),p==="DATA")i.enqueue(h.data);else if(p==="HI"){if(!a){r.postMessage({type:"HI"});let g=0;a={rs:new ReadableStream({async pull(b){let E=await i.dequeue();E===Ml?(await f(),b.close()):(b.enqueue(E),r.postMessage({type:"ACK"}))},cancel(){return f()}}),ws:new WritableStream({async write(b,E){await n.acquireSync()?r.postMessage({type:"DATA",id:g++,data:b}):(d(),E.error(new Error("Write stream closed")))},close(){d()},abort(){d()}})},t(a)}}else p==="REND"?a?n.close():m("REND1"):p==="WEND"?a?i.close():m("WEND1"):p==="ACK"&&n.release();function d(){o||(o=!0,console.debug(e,"p2p write stream closed"),n.close(),r.postMessage({type:"WEND"}),c&&(console.debug(e,"p2p channel closed on ws"),r.close()))}async function f(){c||(c=!0,console.debug(e,"p2p read stream closed"),r.postMessage({type:"REND"}),await i.close(),o&&(console.debug(e,"p2p channel closed on rs"),r.close()))}async function m(g){l||(l=!0,console.debug(e,"p2p channel connection released on",g),n.close(),i.close(),a?(a.rs.locked||(console.debug(e,"p2p unlocked read stream direct cancel"),a.rs.cancel()),a.ws.locked||(console.debug(e,"p2p unlocked write stream direct close"),a.ws.close())):(r.postMessage({type:"HI"}),r.close()),s(new Error("p2p channel connection released")))}},r.postMessage({type:"HI"})})}function mv(e){return new Promise(t=>{let s=new BroadcastChannel(e);s.onmessage=r=>{let i=r.data,{type:n}=i;n==="HI"&&(s.postMessage({type:"REND"}),s.close(),t())},s.postMessage({type:"REND"})})}async function hw(e){try{return await uw(e)}catch(t){t.message!=="p2p channel connection released"&&console.error(t)}}async function gv(e,t,s=10*1024*1024,r=!0){let i=await hw(e);if(!i)return!1;let n=!1;try{let a,o=c=>{if(!a)if(!r)a=i.ws.getWriter();else if(typeof c=="string"){let l=cw(s);l.readable.pipeTo(i.ws),a=l.writable.getWriter()}else{let l=lw(s);l.readable.pipeTo(i.ws),a=l.writable.getWriter()}return a.write(c)};if(Array.isArray(t))for(let c of t)await o(c);else await t({write:o,get desiredSize(){return((a==null?void 0:a.desiredSize)||0)+10}});a&&await a.close(),n=!0}catch(a){console.error(a)}finally{return i.rs.cancel(),n}}async function yv(e,t){var r,i;let s=await hw(e);if(s)try{let n=s.rs.getReader();for((r=t.start)==null?void 0:r.call(t);;){let{value:a,done:o}=await n.read();if(a!==void 0){let c;if(t.update instanceof Promise?c=await t.update(a):c=t.update(a),c){await n.cancel();break}}if(o){(i=t.end)==null||i.call(t);break}}}catch(n){console.error(n)}finally{s.ws.close()}}});var LE=Bl((HA,NE)=>{(function(e){typeof HA=="object"&&typeof NE<"u"?NE.exports=e():typeof define=="function"&&define.amd?define([],e):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=e()})(function(){return(function e(t,s,r){function i(o,c){if(!s[o]){if(!t[o]){var l=typeof wr=="function"&&wr;if(!c&&l)return l(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=s[o]={exports:{}};t[o][0].call(h.exports,function(p){var d=t[o][1][p];return i(d||p)},h,h.exports,e,t,s,r)}return s[o].exports}for(var n=typeof wr=="function"&&wr,a=0;a<r.length;a++)i(r[a]);return i})({1:[function(e,t,s){"use strict";var r=e("./utils"),i=e("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(a){for(var o,c,l,u,h,p,d,f=[],m=0,g=a.length,b=g,E=r.getTypeOf(a)!=="string";m<a.length;)b=g-m,l=E?(o=a[m++],c=m<g?a[m++]:0,m<g?a[m++]:0):(o=a.charCodeAt(m++),c=m<g?a.charCodeAt(m++):0,m<g?a.charCodeAt(m++):0),u=o>>2,h=(3&o)<<4|c>>4,p=1<b?(15&c)<<2|l>>6:64,d=2<b?63&l:64,f.push(n.charAt(u)+n.charAt(h)+n.charAt(p)+n.charAt(d));return f.join("")},s.decode=function(a){var o,c,l,u,h,p,d=0,f=0,m="data:";if(a.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var g,b=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===n.charAt(64)&&b--,a.charAt(a.length-2)===n.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=i.uint8array?new Uint8Array(0|b):new Array(0|b);d<a.length;)o=n.indexOf(a.charAt(d++))<<2|(u=n.indexOf(a.charAt(d++)))>>4,c=(15&u)<<4|(h=n.indexOf(a.charAt(d++)))>>2,l=(3&h)<<6|(p=n.indexOf(a.charAt(d++))),g[f++]=o,h!==64&&(g[f++]=c),p!==64&&(g[f++]=l);return g}},{"./support":30,"./utils":32}],2:[function(e,t,s){"use strict";var r=e("./external"),i=e("./stream/DataWorker"),n=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");function o(c,l,u,h,p){this.compressedSize=c,this.uncompressedSize=l,this.crc32=u,this.compression=h,this.compressedContent=p}o.prototype={getContentWorker:function(){var c=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),l=this;return c.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(c,l,u){return c.pipe(new n).pipe(new a("uncompressedSize")).pipe(l.compressWorker(u)).pipe(new a("compressedSize")).withStreamInfo("compression",l)},t.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,s){"use strict";var r=e("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},s.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,s){"use strict";var r=e("./utils"),i=(function(){for(var n,a=[],o=0;o<256;o++){n=o;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;a[o]=n}return a})();t.exports=function(n,a){return n!==void 0&&n.length?r.getTypeOf(n)!=="string"?(function(o,c,l,u){var h=i,p=u+l;o^=-1;for(var d=u;d<p;d++)o=o>>>8^h[255&(o^c[d])];return-1^o})(0|a,n,n.length,0):(function(o,c,l,u){var h=i,p=u+l;o^=-1;for(var d=u;d<p;d++)o=o>>>8^h[255&(o^c.charCodeAt(d))];return-1^o})(0|a,n,n.length,0):0}},{"./utils":32}],5:[function(e,t,s){"use strict";s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(e,t,s){"use strict";var r=null;r=typeof Promise<"u"?Promise:e("lie"),t.exports={Promise:r}},{lie:37}],7:[function(e,t,s){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=e("pako"),n=e("./utils"),a=e("./stream/GenericWorker"),o=r?"uint8array":"array";function c(l,u){a.call(this,"FlateWorker/"+l),this._pako=null,this._pakoAction=l,this._pakoOptions=u,this.meta={}}s.magic="\b\0",n.inherits(c,a),c.prototype.processChunk=function(l){this.meta=l.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(o,l.data),!1)},c.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var l=this;this._pako.onData=function(u){l.push({data:u,meta:l.meta})}},s.compressWorker=function(l){return new c("Deflate",l)},s.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,t,s){"use strict";function r(h,p){var d,f="";for(d=0;d<p;d++)f+=String.fromCharCode(255&h),h>>>=8;return f}function i(h,p,d,f,m,g){var b,E,y=h.file,T=h.compression,w=g!==o.utf8encode,S=n.transformTo("string",g(y.name)),_=n.transformTo("string",o.utf8encode(y.name)),C=y.comment,x=n.transformTo("string",g(C)),D=n.transformTo("string",o.utf8encode(C)),I=_.length!==y.name.length,P=D.length!==C.length,L="",F="",V="",B=y.dir,k=y.date,O={crc32:0,compressedSize:0,uncompressedSize:0};p&&!d||(O.crc32=h.crc32,O.compressedSize=h.compressedSize,O.uncompressedSize=h.uncompressedSize);var R=0;p&&(R|=8),w||!I&&!P||(R|=2048);var v=0,j=0;B&&(v|=16),m==="UNIX"?(j=798,v|=(function(H,q){var Q=H;return H||(Q=q?16893:33204),(65535&Q)<<16})(y.unixPermissions,B)):(j=20,v|=(function(H){return 63&(H||0)})(y.dosPermissions)),b=k.getUTCHours(),b<<=6,b|=k.getUTCMinutes(),b<<=5,b|=k.getUTCSeconds()/2,E=k.getUTCFullYear()-1980,E<<=4,E|=k.getUTCMonth()+1,E<<=5,E|=k.getUTCDate(),I&&(F=r(1,1)+r(c(S),4)+_,L+="up"+r(F.length,2)+F),P&&(V=r(1,1)+r(c(x),4)+D,L+="uc"+r(V.length,2)+V);var M="";return M+=`
\0`,M+=r(R,2),M+=T.magic,M+=r(b,2),M+=r(E,2),M+=r(O.crc32,4),M+=r(O.compressedSize,4),M+=r(O.uncompressedSize,4),M+=r(S.length,2),M+=r(L.length,2),{fileRecord:l.LOCAL_FILE_HEADER+M+S+L,dirRecord:l.CENTRAL_FILE_HEADER+r(j,2)+M+r(x.length,2)+"\0\0\0\0"+r(v,4)+r(f,4)+S+L+x}}var n=e("../utils"),a=e("../stream/GenericWorker"),o=e("../utf8"),c=e("../crc32"),l=e("../signature");function u(h,p,d,f){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=d,this.encodeFileName=f,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(u,a),u.prototype.push=function(h){var p=h.meta.percent||0,d=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,a.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:d?(p+100*(d-f-1))/d:100}}))},u.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var d=i(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,d=i(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),p)this.push({data:(function(f){return l.DATA_DESCRIPTOR+r(f.crc32,4)+r(f.compressedSize,4)+r(f.uncompressedSize,4)})(h),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var d=this.bytesWritten-h,f=(function(m,g,b,E,y){var T=n.transformTo("string",y(E));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(m,2)+r(m,2)+r(g,4)+r(b,4)+r(T.length,2)+T})(this.dirRecords.length,d,h,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(d){p.processChunk(d)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(d){p.error(d)}),this},u.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(h){var p=this._sources;if(!a.prototype.error.call(this,h))return!1;for(var d=0;d<p.length;d++)try{p[d].error(h)}catch{}return!0},u.prototype.lock=function(){a.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},t.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,s){"use strict";var r=e("../compressions"),i=e("./ZipFileWorker");s.generateWorker=function(n,a,o){var c=new i(a.streamFiles,o,a.platform,a.encodeFileName),l=0;try{n.forEach(function(u,h){l++;var p=(function(g,b){var E=g||b,y=r[E];if(!y)throw new Error(E+" is not a valid compression method !");return y})(h.options.compression,a.compression),d=h.options.compressionOptions||a.compressionOptions||{},f=h.dir,m=h.date;h._compressWorker(p,d).withStreamInfo("file",{name:u,dir:f,date:m,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(c)}),c.entriesCount=l}catch(u){c.error(u)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,s){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new r;for(var n in this)typeof this[n]!="function"&&(i[n]=this[n]);return i}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(i,n){return new r().loadAsync(i,n)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,s){"use strict";var r=e("./utils"),i=e("./external"),n=e("./utf8"),a=e("./zipEntries"),o=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function l(u){return new i.Promise(function(h,p){var d=u.decompressed.getContentWorker().pipe(new o);d.on("error",function(f){p(f)}).on("end",function(){d.streamInfo.crc32!==u.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}t.exports=function(u,h){var p=this;return h=r.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),c.isNode&&c.isStream(u)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",u,!0,h.optimizedBinaryString,h.base64).then(function(d){var f=new a(h);return f.load(d),f}).then(function(d){var f=[i.Promise.resolve(d)],m=d.files;if(h.checkCRC32)for(var g=0;g<m.length;g++)f.push(l(m[g]));return i.Promise.all(f)}).then(function(d){for(var f=d.shift(),m=f.files,g=0;g<m.length;g++){var b=m[g],E=b.fileNameStr,y=r.resolve(b.fileNameStr);p.file(y,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:h.createFolders}),b.dir||(p.file(y).unsafeOriginalName=E)}return f.zipComment.length&&(p.comment=f.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,s){"use strict";var r=e("../utils"),i=e("../stream/GenericWorker");function n(a,o){i.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(o)}r.inherits(n,i),n.prototype._bindStream=function(a){var o=this;(this._stream=a).pause(),a.on("data",function(c){o.push({data:c,meta:{percent:0}})}).on("error",function(c){o.isPaused?this.generatedError=c:o.error(c)}).on("end",function(){o.isPaused?o._upstreamEnded=!0:o.end()})},n.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,s){"use strict";var r=e("readable-stream").Readable;function i(n,a,o){r.call(this,a),this._helper=n;var c=this;n.on("data",function(l,u){c.push(l)||c._helper.pause(),o&&o(u)}).on("error",function(l){c.emit("error",l)}).on("end",function(){c.push(null)})}e("../utils").inherits(i,r),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"../utils":32,"readable-stream":16}],14:[function(e,t,s){"use strict";t.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,i);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,i)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var i=new Buffer(r);return i.fill(0),i},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,t,s){"use strict";function r(y,T,w){var S,_=n.getTypeOf(T),C=n.extend(w||{},c);C.date=C.date||new Date,C.compression!==null&&(C.compression=C.compression.toUpperCase()),typeof C.unixPermissions=="string"&&(C.unixPermissions=parseInt(C.unixPermissions,8)),C.unixPermissions&&16384&C.unixPermissions&&(C.dir=!0),C.dosPermissions&&16&C.dosPermissions&&(C.dir=!0),C.dir&&(y=m(y)),C.createFolders&&(S=f(y))&&g.call(this,S,!0);var x=_==="string"&&C.binary===!1&&C.base64===!1;w&&w.binary!==void 0||(C.binary=!x),(T instanceof l&&T.uncompressedSize===0||C.dir||!T||T.length===0)&&(C.base64=!1,C.binary=!0,T="",C.compression="STORE",_="string");var D=null;D=T instanceof l||T instanceof a?T:p.isNode&&p.isStream(T)?new d(y,T):n.prepareContent(y,T,C.binary,C.optimizedBinaryString,C.base64);var I=new u(y,D,C);this.files[y]=I}var i=e("./utf8"),n=e("./utils"),a=e("./stream/GenericWorker"),o=e("./stream/StreamHelper"),c=e("./defaults"),l=e("./compressedObject"),u=e("./zipObject"),h=e("./generate"),p=e("./nodejsUtils"),d=e("./nodejs/NodejsStreamInputAdapter"),f=function(y){y.slice(-1)==="/"&&(y=y.substring(0,y.length-1));var T=y.lastIndexOf("/");return 0<T?y.substring(0,T):""},m=function(y){return y.slice(-1)!=="/"&&(y+="/"),y},g=function(y,T){return T=T!==void 0?T:c.createFolders,y=m(y),this.files[y]||r.call(this,y,null,{dir:!0,createFolders:T}),this.files[y]};function b(y){return Object.prototype.toString.call(y)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(y){var T,w,S;for(T in this.files)S=this.files[T],(w=T.slice(this.root.length,T.length))&&T.slice(0,this.root.length)===this.root&&y(w,S)},filter:function(y){var T=[];return this.forEach(function(w,S){y(w,S)&&T.push(S)}),T},file:function(y,T,w){if(arguments.length!==1)return y=this.root+y,r.call(this,y,T,w),this;if(b(y)){var S=y;return this.filter(function(C,x){return!x.dir&&S.test(C)})}var _=this.files[this.root+y];return _&&!_.dir?_:null},folder:function(y){if(!y)return this;if(b(y))return this.filter(function(_,C){return C.dir&&y.test(_)});var T=this.root+y,w=g.call(this,T),S=this.clone();return S.root=w.name,S},remove:function(y){y=this.root+y;var T=this.files[y];if(T||(y.slice(-1)!=="/"&&(y+="/"),T=this.files[y]),T&&!T.dir)delete this.files[y];else for(var w=this.filter(function(_,C){return C.name.slice(0,y.length)===y}),S=0;S<w.length;S++)delete this.files[w[S].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(y){var T,w={};try{if((w=n.extend(y||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=w.type.toLowerCase(),w.compression=w.compression.toUpperCase(),w.type==="binarystring"&&(w.type="string"),!w.type)throw new Error("No output type specified.");n.checkSupport(w.type),w.platform!=="darwin"&&w.platform!=="freebsd"&&w.platform!=="linux"&&w.platform!=="sunos"||(w.platform="UNIX"),w.platform==="win32"&&(w.platform="DOS");var S=w.comment||this.comment||"";T=h.generateWorker(this,w,S)}catch(_){(T=new a("error")).error(_)}return new o(T,w.type||"string",w.mimeType)},generateAsync:function(y,T){return this.generateInternalStream(y).accumulate(T)},generateNodeStream:function(y,T){return(y=y||{}).type||(y.type="nodebuffer"),this.generateInternalStream(y).toNodejsStream(T)}};t.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,s){"use strict";t.exports=e("stream")},{stream:void 0}],17:[function(e,t,s){"use strict";var r=e("./DataReader");function i(n){r.call(this,n);for(var a=0;a<this.data.length;a++)n[a]=255&n[a]}e("../utils").inherits(i,r),i.prototype.byteAt=function(n){return this.data[this.zero+n]},i.prototype.lastIndexOfSignature=function(n){for(var a=n.charCodeAt(0),o=n.charCodeAt(1),c=n.charCodeAt(2),l=n.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===a&&this.data[u+1]===o&&this.data[u+2]===c&&this.data[u+3]===l)return u-this.zero;return-1},i.prototype.readAndCheckSignature=function(n){var a=n.charCodeAt(0),o=n.charCodeAt(1),c=n.charCodeAt(2),l=n.charCodeAt(3),u=this.readData(4);return a===u[0]&&o===u[1]&&c===u[2]&&l===u[3]},i.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,s){"use strict";var r=e("../utils");function i(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var a,o=0;for(this.checkOffset(n),a=this.index+n-1;a>=this.index;a--)o=(o<<8)+this.byteAt(a);return this.index+=n,o},readString:function(n){return r.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,s){"use strict";var r=e("./Uint8ArrayReader");function i(n){r.call(this,n)}e("../utils").inherits(i,r),i.prototype.readData=function(n){this.checkOffset(n);var a=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,s){"use strict";var r=e("./DataReader");function i(n){r.call(this,n)}e("../utils").inherits(i,r),i.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},i.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},i.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},i.prototype.readData=function(n){this.checkOffset(n);var a=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,s){"use strict";var r=e("./ArrayReader");function i(n){r.call(this,n)}e("../utils").inherits(i,r),i.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,s){"use strict";var r=e("../utils"),i=e("../support"),n=e("./ArrayReader"),a=e("./StringReader"),o=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");t.exports=function(l){var u=r.getTypeOf(l);return r.checkSupport(u),u!=="string"||i.uint8array?u==="nodebuffer"?new o(l):i.uint8array?new c(r.transformTo("uint8array",l)):new n(r.transformTo("array",l)):new a(l)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,s){"use strict";s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,t,s){"use strict";var r=e("./GenericWorker"),i=e("../utils");function n(a){r.call(this,"ConvertWorker to "+a),this.destType=a}i.inherits(n,r),n.prototype.processChunk=function(a){this.push({data:i.transformTo(this.destType,a.data),meta:a.meta})},t.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,s){"use strict";var r=e("./GenericWorker"),i=e("../crc32");function n(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(n,r),n.prototype.processChunk=function(a){this.streamInfo.crc32=i(a.data,this.streamInfo.crc32||0),this.push(a)},t.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,s){"use strict";var r=e("../utils"),i=e("./GenericWorker");function n(a){i.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}r.inherits(n,i),n.prototype.processChunk=function(a){if(a){var o=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=o+a.data.length}i.prototype.processChunk.call(this,a)},t.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,s){"use strict";var r=e("../utils"),i=e("./GenericWorker");function n(a){i.call(this,"DataWorker");var o=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(c){o.dataIsReady=!0,o.data=c,o.max=c&&c.length||0,o.type=r.getTypeOf(c),o.isPaused||o._tickAndRepeat()},function(c){o.error(c)})}r.inherits(n,i),n.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,o=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,o);break;case"uint8array":a=this.data.subarray(this.index,o);break;case"array":case"nodebuffer":a=this.data.slice(this.index,o)}return this.index=o,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,s){"use strict";function r(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,n){return this._listeners[i].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,n){if(this._listeners[i])for(var a=0;a<this._listeners[i].length;a++)this._listeners[i][a].call(this,n)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var n=this;return i.on("data",function(a){n.processChunk(a)}),i.on("end",function(){n.end()}),i.on("error",function(a){n.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,n){return this.extraStreamInfo[i]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},t.exports=r},{}],29:[function(e,t,s){"use strict";var r=e("../utils"),i=e("./ConvertWorker"),n=e("./GenericWorker"),a=e("../base64"),o=e("../support"),c=e("../external"),l=null;if(o.nodestream)try{l=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(p,d){return new c.Promise(function(f,m){var g=[],b=p._internalType,E=p._outputType,y=p._mimeType;p.on("data",function(T,w){g.push(T),d&&d(w)}).on("error",function(T){g=[],m(T)}).on("end",function(){try{var T=(function(w,S,_){switch(w){case"blob":return r.newBlob(r.transformTo("arraybuffer",S),_);case"base64":return a.encode(S);default:return r.transformTo(w,S)}})(E,(function(w,S){var _,C=0,x=null,D=0;for(_=0;_<S.length;_++)D+=S[_].length;switch(w){case"string":return S.join("");case"array":return Array.prototype.concat.apply([],S);case"uint8array":for(x=new Uint8Array(D),_=0;_<S.length;_++)x.set(S[_],C),C+=S[_].length;return x;case"nodebuffer":return Buffer.concat(S);default:throw new Error("concat : unsupported type '"+w+"'")}})(b,g),y);f(T)}catch(w){m(w)}g=[]}).resume()})}function h(p,d,f){var m=d;switch(d){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=d,this._mimeType=f,r.checkSupport(m),this._worker=p.pipe(new i(m)),p.lock()}catch(g){this._worker=new n("error"),this._worker.error(g)}}h.prototype={accumulate:function(p){return u(this,p)},on:function(p,d){var f=this;return p==="data"?this._worker.on(p,function(m){d.call(f,m.data,m.meta)}):this._worker.on(p,function(){r.delay(d,arguments,f)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},p)}},t.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,s){"use strict";if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var r=new ArrayBuffer(0);try{s.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(r),s.blob=i.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!e("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,s){"use strict";for(var r=e("./utils"),i=e("./support"),n=e("./nodejsUtils"),a=e("./stream/GenericWorker"),o=new Array(256),c=0;c<256;c++)o[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;o[254]=o[254]=1;function l(){a.call(this,"utf-8 decode"),this.leftOver=null}function u(){a.call(this,"utf-8 encode")}s.utf8encode=function(h){return i.nodebuffer?n.newBufferFrom(h,"utf-8"):(function(p){var d,f,m,g,b,E=p.length,y=0;for(g=0;g<E;g++)(64512&(f=p.charCodeAt(g)))==55296&&g+1<E&&(64512&(m=p.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),g++),y+=f<128?1:f<2048?2:f<65536?3:4;for(d=i.uint8array?new Uint8Array(y):new Array(y),g=b=0;b<y;g++)(64512&(f=p.charCodeAt(g)))==55296&&g+1<E&&(64512&(m=p.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),g++),f<128?d[b++]=f:(f<2048?d[b++]=192|f>>>6:(f<65536?d[b++]=224|f>>>12:(d[b++]=240|f>>>18,d[b++]=128|f>>>12&63),d[b++]=128|f>>>6&63),d[b++]=128|63&f);return d})(h)},s.utf8decode=function(h){return i.nodebuffer?r.transformTo("nodebuffer",h).toString("utf-8"):(function(p){var d,f,m,g,b=p.length,E=new Array(2*b);for(d=f=0;d<b;)if((m=p[d++])<128)E[f++]=m;else if(4<(g=o[m]))E[f++]=65533,d+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&d<b;)m=m<<6|63&p[d++],g--;1<g?E[f++]=65533:m<65536?E[f++]=m:(m-=65536,E[f++]=55296|m>>10&1023,E[f++]=56320|1023&m)}return E.length!==f&&(E.subarray?E=E.subarray(0,f):E.length=f),r.applyFromCharCode(E)})(h=r.transformTo(i.uint8array?"uint8array":"array",h))},r.inherits(l,a),l.prototype.processChunk=function(h){var p=r.transformTo(i.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var d=p;(p=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),p.set(d,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var f=(function(g,b){var E;for((b=b||g.length)>g.length&&(b=g.length),E=b-1;0<=E&&(192&g[E])==128;)E--;return E<0||E===0?b:E+o[g[E]]>b?E:b})(p),m=p;f!==p.length&&(i.uint8array?(m=p.subarray(0,f),this.leftOver=p.subarray(f,p.length)):(m=p.slice(0,f),this.leftOver=p.slice(f,p.length))),this.push({data:s.utf8decode(m),meta:h.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=l,r.inherits(u,a),u.prototype.processChunk=function(h){this.push({data:s.utf8encode(h.data),meta:h.meta})},s.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,s){"use strict";var r=e("./support"),i=e("./base64"),n=e("./nodejsUtils"),a=e("./external");function o(d){return d}function c(d,f){for(var m=0;m<d.length;++m)f[m]=255&d.charCodeAt(m);return f}e("setimmediate"),s.newBlob=function(d,f){s.checkSupport("blob");try{return new Blob([d],{type:f})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(d),m.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(d,f,m){var g=[],b=0,E=d.length;if(E<=m)return String.fromCharCode.apply(null,d);for(;b<E;)f==="array"||f==="nodebuffer"?g.push(String.fromCharCode.apply(null,d.slice(b,Math.min(b+m,E)))):g.push(String.fromCharCode.apply(null,d.subarray(b,Math.min(b+m,E)))),b+=m;return g.join("")},stringifyByChar:function(d){for(var f="",m=0;m<d.length;m++)f+=String.fromCharCode(d[m]);return f},applyCanBeUsed:{uint8array:(function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}})()}};function u(d){var f=65536,m=s.getTypeOf(d),g=!0;if(m==="uint8array"?g=l.applyCanBeUsed.uint8array:m==="nodebuffer"&&(g=l.applyCanBeUsed.nodebuffer),g)for(;1<f;)try{return l.stringifyByChunk(d,m,f)}catch{f=Math.floor(f/2)}return l.stringifyByChar(d)}function h(d,f){for(var m=0;m<d.length;m++)f[m]=d[m];return f}s.applyFromCharCode=u;var p={};p.string={string:o,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return p.string.uint8array(d).buffer},uint8array:function(d){return c(d,new Uint8Array(d.length))},nodebuffer:function(d){return c(d,n.allocBuffer(d.length))}},p.array={string:u,array:o,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return n.newBufferFrom(d)}},p.arraybuffer={string:function(d){return u(new Uint8Array(d))},array:function(d){return h(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:o,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return n.newBufferFrom(new Uint8Array(d))}},p.uint8array={string:u,array:function(d){return h(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:o,nodebuffer:function(d){return n.newBufferFrom(d)}},p.nodebuffer={string:u,array:function(d){return h(d,new Array(d.length))},arraybuffer:function(d){return p.nodebuffer.uint8array(d).buffer},uint8array:function(d){return h(d,new Uint8Array(d.length))},nodebuffer:o},s.transformTo=function(d,f){if(f=f||"",!d)return f;s.checkSupport(d);var m=s.getTypeOf(f);return p[m][d](f)},s.resolve=function(d){for(var f=d.split("/"),m=[],g=0;g<f.length;g++){var b=f[g];b==="."||b===""&&g!==0&&g!==f.length-1||(b===".."?m.pop():m.push(b))}return m.join("/")},s.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":r.nodebuffer&&n.isBuffer(d)?"nodebuffer":r.uint8array&&d instanceof Uint8Array?"uint8array":r.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(d){if(!r[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(d){var f,m,g="";for(m=0;m<(d||"").length;m++)g+="\\x"+((f=d.charCodeAt(m))<16?"0":"")+f.toString(16).toUpperCase();return g},s.delay=function(d,f,m){setImmediate(function(){d.apply(m||null,f||[])})},s.inherits=function(d,f){function m(){}m.prototype=f.prototype,d.prototype=new m},s.extend=function(){var d,f,m={};for(d=0;d<arguments.length;d++)for(f in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],f)&&m[f]===void 0&&(m[f]=arguments[d][f]);return m},s.prepareContent=function(d,f,m,g,b){return a.Promise.resolve(f).then(function(E){return r.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new a.Promise(function(y,T){var w=new FileReader;w.onload=function(S){y(S.target.result)},w.onerror=function(S){T(S.target.error)},w.readAsArrayBuffer(E)}):E}).then(function(E){var y=s.getTypeOf(E);return y?(y==="arraybuffer"?E=s.transformTo("uint8array",E):y==="string"&&(b?E=i.decode(E):m&&g!==!0&&(E=(function(T){return c(T,r.uint8array?new Uint8Array(T.length):new Array(T.length))})(E))),E):a.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,t,s){"use strict";var r=e("./reader/readerFor"),i=e("./utils"),n=e("./signature"),a=e("./zipEntry"),o=e("./support");function c(l){this.files=[],this.loadOptions=l}c.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(u)+", expected "+i.pretty(l)+")")}},isSignature:function(l,u){var h=this.reader.index;this.reader.setIndex(l);var p=this.reader.readString(4)===u;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),u=o.uint8array?"uint8array":"array",h=i.transformTo(u,l);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l,u,h,p=this.zip64EndOfCentralSize-44;0<p;)l=this.reader.readInt(2),u=this.reader.readInt(4),h=this.reader.readData(u),this.zip64ExtensibleData[l]={id:l,length:u,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,u;for(l=0;l<this.files.length;l++)u=this.files[l],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(l=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(l<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(l);var u=l;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(l=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=u-h;if(0<p)this.isSignature(u,n.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(l){this.reader=r(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,t,s){"use strict";var r=e("./reader/readerFor"),i=e("./utils"),n=e("./compressedObject"),a=e("./crc32"),o=e("./utf8"),c=e("./compressions"),l=e("./support");function u(h,p){this.options=h,this.loadOptions=p}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,d;if(h.skip(22),this.fileNameLength=h.readInt(2),d=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(f){for(var m in c)if(Object.prototype.hasOwnProperty.call(c,m)&&c[m].magic===f)return c[m];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,d,f,m=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<m;)p=h.readInt(2),d=h.readInt(2),f=h.readData(d),this.extraFields[p]={id:p,length:d,value:f};h.setIndex(m)},handleUTF8:function(){var h=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var d=i.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var m=i.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=r(h.value);return p.readInt(1)!==1||a(this.fileName)!==p.readInt(4)?null:o.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=r(h.value);return p.readInt(1)!==1||a(this.fileComment)!==p.readInt(4)?null:o.utf8decode(p.readData(h.length-5))}return null}},t.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,s){"use strict";function r(p,d,f){this.name=p,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=d,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var i=e("./stream/StreamHelper"),n=e("./stream/DataWorker"),a=e("./utf8"),o=e("./compressedObject"),c=e("./stream/GenericWorker");r.prototype={internalStream:function(p){var d=null,f="string";try{if(!p)throw new Error("No output type specified.");var m=(f=p.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),d=this._decompressWorker();var g=!this._dataBinary;g&&!m&&(d=d.pipe(new a.Utf8EncodeWorker)),!g&&m&&(d=d.pipe(new a.Utf8DecodeWorker))}catch(b){(d=new c("error")).error(b)}return new i(d,f,"")},async:function(p,d){return this.internalStream(p).accumulate(d)},nodeStream:function(p,d){return this.internalStream(p||"nodebuffer").toNodejsStream(d)},_compressWorker:function(p,d){if(this._data instanceof o&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(f,p,d)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof c?this._data:new n(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<l.length;h++)r.prototype[l[h]]=u;t.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,s){(function(r){"use strict";var i,n,a=r.MutationObserver||r.WebKitMutationObserver;if(a){var o=0,c=new a(p),l=r.document.createTextNode("");c.observe(l,{characterData:!0}),i=function(){l.data=o=++o%2}}else if(r.setImmediate||r.MessageChannel===void 0)i="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var d=r.document.createElement("script");d.onreadystatechange=function(){p(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},r.document.documentElement.appendChild(d)}:function(){setTimeout(p,0)};else{var u=new r.MessageChannel;u.port1.onmessage=p,i=function(){u.port2.postMessage(0)}}var h=[];function p(){var d,f;n=!0;for(var m=h.length;m;){for(f=h,h=[],d=-1;++d<m;)f[d]();m=h.length}n=!1}t.exports=function(d){h.push(d)!==1||n||i()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,t,s){"use strict";var r=e("immediate");function i(){}var n={},a=["REJECTED"],o=["FULFILLED"],c=["PENDING"];function l(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,m!==i&&d(this,m)}function u(m,g,b){this.promise=m,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected)}function h(m,g,b){r(function(){var E;try{E=g(b)}catch(y){return n.reject(m,y)}E===m?n.reject(m,new TypeError("Cannot resolve promise with itself")):n.resolve(m,E)})}function p(m){var g=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof g=="function")return function(){g.apply(m,arguments)}}function d(m,g){var b=!1;function E(w){b||(b=!0,n.reject(m,w))}function y(w){b||(b=!0,n.resolve(m,w))}var T=f(function(){g(y,E)});T.status==="error"&&E(T.value)}function f(m,g){var b={};try{b.value=m(g),b.status="success"}catch(E){b.status="error",b.value=E}return b}(t.exports=l).prototype.finally=function(m){if(typeof m!="function")return this;var g=this.constructor;return this.then(function(b){return g.resolve(m()).then(function(){return b})},function(b){return g.resolve(m()).then(function(){throw b})})},l.prototype.catch=function(m){return this.then(null,m)},l.prototype.then=function(m,g){if(typeof m!="function"&&this.state===o||typeof g!="function"&&this.state===a)return this;var b=new this.constructor(i);return this.state!==c?h(b,this.state===o?m:g,this.outcome):this.queue.push(new u(b,m,g)),b},u.prototype.callFulfilled=function(m){n.resolve(this.promise,m)},u.prototype.otherCallFulfilled=function(m){h(this.promise,this.onFulfilled,m)},u.prototype.callRejected=function(m){n.reject(this.promise,m)},u.prototype.otherCallRejected=function(m){h(this.promise,this.onRejected,m)},n.resolve=function(m,g){var b=f(p,g);if(b.status==="error")return n.reject(m,b.value);var E=b.value;if(E)d(m,E);else{m.state=o,m.outcome=g;for(var y=-1,T=m.queue.length;++y<T;)m.queue[y].callFulfilled(g)}return m},n.reject=function(m,g){m.state=a,m.outcome=g;for(var b=-1,E=m.queue.length;++b<E;)m.queue[b].callRejected(g);return m},l.resolve=function(m){return m instanceof this?m:n.resolve(new this(i),m)},l.reject=function(m){var g=new this(i);return n.reject(g,m)},l.all=function(m){var g=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=m.length,E=!1;if(!b)return this.resolve([]);for(var y=new Array(b),T=0,w=-1,S=new this(i);++w<b;)_(m[w],w);return S;function _(C,x){g.resolve(C).then(function(D){y[x]=D,++T!==b||E||(E=!0,n.resolve(S,y))},function(D){E||(E=!0,n.reject(S,D))})}},l.race=function(m){var g=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=m.length,E=!1;if(!b)return this.resolve([]);for(var y=-1,T=new this(i);++y<b;)w=m[y],g.resolve(w).then(function(S){E||(E=!0,n.resolve(T,S))},function(S){E||(E=!0,n.reject(T,S))});var w;return T}},{immediate:36}],38:[function(e,t,s){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,t,s){"use strict";var r=e("./zlib/deflate"),i=e("./utils/common"),n=e("./utils/strings"),a=e("./zlib/messages"),o=e("./zlib/zstream"),c=Object.prototype.toString,l=0,u=-1,h=0,p=8;function d(m){if(!(this instanceof d))return new d(m);this.options=i.assign({level:u,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},m||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var b=r.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(b!==l)throw new Error(a[b]);if(g.header&&r.deflateSetHeader(this.strm,g.header),g.dictionary){var E;if(E=typeof g.dictionary=="string"?n.string2buf(g.dictionary):c.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(b=r.deflateSetDictionary(this.strm,E))!==l)throw new Error(a[b]);this._dict_set=!0}}function f(m,g){var b=new d(g);if(b.push(m,!0),b.err)throw b.msg||a[b.err];return b.result}d.prototype.push=function(m,g){var b,E,y=this.strm,T=this.options.chunkSize;if(this.ended)return!1;E=g===~~g?g:g===!0?4:0,typeof m=="string"?y.input=n.string2buf(m):c.call(m)==="[object ArrayBuffer]"?y.input=new Uint8Array(m):y.input=m,y.next_in=0,y.avail_in=y.input.length;do{if(y.avail_out===0&&(y.output=new i.Buf8(T),y.next_out=0,y.avail_out=T),(b=r.deflate(y,E))!==1&&b!==l)return this.onEnd(b),!(this.ended=!0);y.avail_out!==0&&(y.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(i.shrinkBuf(y.output,y.next_out))):this.onData(i.shrinkBuf(y.output,y.next_out)))}while((0<y.avail_in||y.avail_out===0)&&b!==1);return E===4?(b=r.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l):E!==2||(this.onEnd(l),!(y.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},s.Deflate=d,s.deflate=f,s.deflateRaw=function(m,g){return(g=g||{}).raw=!0,f(m,g)},s.gzip=function(m,g){return(g=g||{}).gzip=!0,f(m,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,t,s){"use strict";var r=e("./zlib/inflate"),i=e("./utils/common"),n=e("./utils/strings"),a=e("./zlib/constants"),o=e("./zlib/messages"),c=e("./zlib/zstream"),l=e("./zlib/gzheader"),u=Object.prototype.toString;function h(d){if(!(this instanceof h))return new h(d);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},d||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||d&&d.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&(15&f.windowBits)==0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var m=r.inflateInit2(this.strm,f.windowBits);if(m!==a.Z_OK)throw new Error(o[m]);this.header=new l,r.inflateGetHeader(this.strm,this.header)}function p(d,f){var m=new h(f);if(m.push(d,!0),m.err)throw m.msg||o[m.err];return m.result}h.prototype.push=function(d,f){var m,g,b,E,y,T,w=this.strm,S=this.options.chunkSize,_=this.options.dictionary,C=!1;if(this.ended)return!1;g=f===~~f?f:f===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof d=="string"?w.input=n.binstring2buf(d):u.call(d)==="[object ArrayBuffer]"?w.input=new Uint8Array(d):w.input=d,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new i.Buf8(S),w.next_out=0,w.avail_out=S),(m=r.inflate(w,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&_&&(T=typeof _=="string"?n.string2buf(_):u.call(_)==="[object ArrayBuffer]"?new Uint8Array(_):_,m=r.inflateSetDictionary(this.strm,T)),m===a.Z_BUF_ERROR&&C===!0&&(m=a.Z_OK,C=!1),m!==a.Z_STREAM_END&&m!==a.Z_OK)return this.onEnd(m),!(this.ended=!0);w.next_out&&(w.avail_out!==0&&m!==a.Z_STREAM_END&&(w.avail_in!==0||g!==a.Z_FINISH&&g!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=n.utf8border(w.output,w.next_out),E=w.next_out-b,y=n.buf2string(w.output,b),w.next_out=E,w.avail_out=S-E,E&&i.arraySet(w.output,w.output,b,E,0),this.onData(y)):this.onData(i.shrinkBuf(w.output,w.next_out)))),w.avail_in===0&&w.avail_out===0&&(C=!0)}while((0<w.avail_in||w.avail_out===0)&&m!==a.Z_STREAM_END);return m===a.Z_STREAM_END&&(g=a.Z_FINISH),g===a.Z_FINISH?(m=r.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===a.Z_OK):g!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(w.avail_out=0))},h.prototype.onData=function(d){this.chunks.push(d)},h.prototype.onEnd=function(d){d===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},s.Inflate=h,s.inflate=p,s.inflateRaw=function(d,f){return(f=f||{}).raw=!0,p(d,f)},s.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,t,s){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(a){for(var o=Array.prototype.slice.call(arguments,1);o.length;){var c=o.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var l in c)c.hasOwnProperty(l)&&(a[l]=c[l])}}return a},s.shrinkBuf=function(a,o){return a.length===o?a:a.subarray?a.subarray(0,o):(a.length=o,a)};var i={arraySet:function(a,o,c,l,u){if(o.subarray&&a.subarray)a.set(o.subarray(c,c+l),u);else for(var h=0;h<l;h++)a[u+h]=o[c+h]},flattenChunks:function(a){var o,c,l,u,h,p;for(o=l=0,c=a.length;o<c;o++)l+=a[o].length;for(p=new Uint8Array(l),o=u=0,c=a.length;o<c;o++)h=a[o],p.set(h,u),u+=h.length;return p}},n={arraySet:function(a,o,c,l,u){for(var h=0;h<l;h++)a[u+h]=o[c+h]},flattenChunks:function(a){return[].concat.apply([],a)}};s.setTyped=function(a){a?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,i)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,n))},s.setTyped(r)},{}],42:[function(e,t,s){"use strict";var r=e("./common"),i=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var a=new r.Buf8(256),o=0;o<256;o++)a[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function c(l,u){if(u<65537&&(l.subarray&&n||!l.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(l,u));for(var h="",p=0;p<u;p++)h+=String.fromCharCode(l[p]);return h}a[254]=a[254]=1,s.string2buf=function(l){var u,h,p,d,f,m=l.length,g=0;for(d=0;d<m;d++)(64512&(h=l.charCodeAt(d)))==55296&&d+1<m&&(64512&(p=l.charCodeAt(d+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),d++),g+=h<128?1:h<2048?2:h<65536?3:4;for(u=new r.Buf8(g),d=f=0;f<g;d++)(64512&(h=l.charCodeAt(d)))==55296&&d+1<m&&(64512&(p=l.charCodeAt(d+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),d++),h<128?u[f++]=h:(h<2048?u[f++]=192|h>>>6:(h<65536?u[f++]=224|h>>>12:(u[f++]=240|h>>>18,u[f++]=128|h>>>12&63),u[f++]=128|h>>>6&63),u[f++]=128|63&h);return u},s.buf2binstring=function(l){return c(l,l.length)},s.binstring2buf=function(l){for(var u=new r.Buf8(l.length),h=0,p=u.length;h<p;h++)u[h]=l.charCodeAt(h);return u},s.buf2string=function(l,u){var h,p,d,f,m=u||l.length,g=new Array(2*m);for(h=p=0;h<m;)if((d=l[h++])<128)g[p++]=d;else if(4<(f=a[d]))g[p++]=65533,h+=f-1;else{for(d&=f===2?31:f===3?15:7;1<f&&h<m;)d=d<<6|63&l[h++],f--;1<f?g[p++]=65533:d<65536?g[p++]=d:(d-=65536,g[p++]=55296|d>>10&1023,g[p++]=56320|1023&d)}return c(g,p)},s.utf8border=function(l,u){var h;for((u=u||l.length)>l.length&&(u=l.length),h=u-1;0<=h&&(192&l[h])==128;)h--;return h<0||h===0?u:h+a[l[h]]>u?h:u}},{"./common":41}],43:[function(e,t,s){"use strict";t.exports=function(r,i,n,a){for(var o=65535&r|0,c=r>>>16&65535|0,l=0;n!==0;){for(n-=l=2e3<n?2e3:n;c=c+(o=o+i[a++]|0)|0,--l;);o%=65521,c%=65521}return o|c<<16|0}},{}],44:[function(e,t,s){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,t,s){"use strict";var r=(function(){for(var i,n=[],a=0;a<256;a++){i=a;for(var o=0;o<8;o++)i=1&i?3988292384^i>>>1:i>>>1;n[a]=i}return n})();t.exports=function(i,n,a,o){var c=r,l=o+a;i^=-1;for(var u=o;u<l;u++)i=i>>>8^c[255&(i^n[u])];return-1^i}},{}],46:[function(e,t,s){"use strict";var r,i=e("../utils/common"),n=e("./trees"),a=e("./adler32"),o=e("./crc32"),c=e("./messages"),l=0,u=4,h=0,p=-2,d=-1,f=4,m=2,g=8,b=9,E=286,y=30,T=19,w=2*E+1,S=15,_=3,C=258,x=C+_+1,D=42,I=113,P=1,L=2,F=3,V=4;function B(G,pe){return G.msg=c[pe],pe}function k(G){return(G<<1)-(4<G?9:0)}function O(G){for(var pe=G.length;0<=--pe;)G[pe]=0}function R(G){var pe=G.state,ge=pe.pending;ge>G.avail_out&&(ge=G.avail_out),ge!==0&&(i.arraySet(G.output,pe.pending_buf,pe.pending_out,ge,G.next_out),G.next_out+=ge,pe.pending_out+=ge,G.total_out+=ge,G.avail_out-=ge,pe.pending-=ge,pe.pending===0&&(pe.pending_out=0))}function v(G,pe){n._tr_flush_block(G,0<=G.block_start?G.block_start:-1,G.strstart-G.block_start,pe),G.block_start=G.strstart,R(G.strm)}function j(G,pe){G.pending_buf[G.pending++]=pe}function M(G,pe){G.pending_buf[G.pending++]=pe>>>8&255,G.pending_buf[G.pending++]=255&pe}function H(G,pe){var ge,ie,$=G.max_chain_length,ae=G.strstart,ye=G.prev_length,Be=G.nice_match,be=G.strstart>G.w_size-x?G.strstart-(G.w_size-x):0,xe=G.window,je=G.w_mask,ke=G.prev,Xe=G.strstart+C,gt=xe[ae+ye-1],it=xe[ae+ye];G.prev_length>=G.good_match&&($>>=2),Be>G.lookahead&&(Be=G.lookahead);do if(xe[(ge=pe)+ye]===it&&xe[ge+ye-1]===gt&&xe[ge]===xe[ae]&&xe[++ge]===xe[ae+1]){ae+=2,ge++;do;while(xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&xe[++ae]===xe[++ge]&&ae<Xe);if(ie=C-(Xe-ae),ae=Xe-C,ye<ie){if(G.match_start=pe,Be<=(ye=ie))break;gt=xe[ae+ye-1],it=xe[ae+ye]}}while((pe=ke[pe&je])>be&&--$!=0);return ye<=G.lookahead?ye:G.lookahead}function q(G){var pe,ge,ie,$,ae,ye,Be,be,xe,je,ke=G.w_size;do{if($=G.window_size-G.lookahead-G.strstart,G.strstart>=ke+(ke-x)){for(i.arraySet(G.window,G.window,ke,ke,0),G.match_start-=ke,G.strstart-=ke,G.block_start-=ke,pe=ge=G.hash_size;ie=G.head[--pe],G.head[pe]=ke<=ie?ie-ke:0,--ge;);for(pe=ge=ke;ie=G.prev[--pe],G.prev[pe]=ke<=ie?ie-ke:0,--ge;);$+=ke}if(G.strm.avail_in===0)break;if(ye=G.strm,Be=G.window,be=G.strstart+G.lookahead,xe=$,je=void 0,je=ye.avail_in,xe<je&&(je=xe),ge=je===0?0:(ye.avail_in-=je,i.arraySet(Be,ye.input,ye.next_in,je,be),ye.state.wrap===1?ye.adler=a(ye.adler,Be,je,be):ye.state.wrap===2&&(ye.adler=o(ye.adler,Be,je,be)),ye.next_in+=je,ye.total_in+=je,je),G.lookahead+=ge,G.lookahead+G.insert>=_)for(ae=G.strstart-G.insert,G.ins_h=G.window[ae],G.ins_h=(G.ins_h<<G.hash_shift^G.window[ae+1])&G.hash_mask;G.insert&&(G.ins_h=(G.ins_h<<G.hash_shift^G.window[ae+_-1])&G.hash_mask,G.prev[ae&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=ae,ae++,G.insert--,!(G.lookahead+G.insert<_)););}while(G.lookahead<x&&G.strm.avail_in!==0)}function Q(G,pe){for(var ge,ie;;){if(G.lookahead<x){if(q(G),G.lookahead<x&&pe===l)return P;if(G.lookahead===0)break}if(ge=0,G.lookahead>=_&&(G.ins_h=(G.ins_h<<G.hash_shift^G.window[G.strstart+_-1])&G.hash_mask,ge=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),ge!==0&&G.strstart-ge<=G.w_size-x&&(G.match_length=H(G,ge)),G.match_length>=_)if(ie=n._tr_tally(G,G.strstart-G.match_start,G.match_length-_),G.lookahead-=G.match_length,G.match_length<=G.max_lazy_match&&G.lookahead>=_){for(G.match_length--;G.strstart++,G.ins_h=(G.ins_h<<G.hash_shift^G.window[G.strstart+_-1])&G.hash_mask,ge=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart,--G.match_length!=0;);G.strstart++}else G.strstart+=G.match_length,G.match_length=0,G.ins_h=G.window[G.strstart],G.ins_h=(G.ins_h<<G.hash_shift^G.window[G.strstart+1])&G.hash_mask;else ie=n._tr_tally(G,0,G.window[G.strstart]),G.lookahead--,G.strstart++;if(ie&&(v(G,!1),G.strm.avail_out===0))return P}return G.insert=G.strstart<_-1?G.strstart:_-1,pe===u?(v(G,!0),G.strm.avail_out===0?F:V):G.last_lit&&(v(G,!1),G.strm.avail_out===0)?P:L}function oe(G,pe){for(var ge,ie,$;;){if(G.lookahead<x){if(q(G),G.lookahead<x&&pe===l)return P;if(G.lookahead===0)break}if(ge=0,G.lookahead>=_&&(G.ins_h=(G.ins_h<<G.hash_shift^G.window[G.strstart+_-1])&G.hash_mask,ge=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),G.prev_length=G.match_length,G.prev_match=G.match_start,G.match_length=_-1,ge!==0&&G.prev_length<G.max_lazy_match&&G.strstart-ge<=G.w_size-x&&(G.match_length=H(G,ge),G.match_length<=5&&(G.strategy===1||G.match_length===_&&4096<G.strstart-G.match_start)&&(G.match_length=_-1)),G.prev_length>=_&&G.match_length<=G.prev_length){for($=G.strstart+G.lookahead-_,ie=n._tr_tally(G,G.strstart-1-G.prev_match,G.prev_length-_),G.lookahead-=G.prev_length-1,G.prev_length-=2;++G.strstart<=$&&(G.ins_h=(G.ins_h<<G.hash_shift^G.window[G.strstart+_-1])&G.hash_mask,ge=G.prev[G.strstart&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=G.strstart),--G.prev_length!=0;);if(G.match_available=0,G.match_length=_-1,G.strstart++,ie&&(v(G,!1),G.strm.avail_out===0))return P}else if(G.match_available){if((ie=n._tr_tally(G,0,G.window[G.strstart-1]))&&v(G,!1),G.strstart++,G.lookahead--,G.strm.avail_out===0)return P}else G.match_available=1,G.strstart++,G.lookahead--}return G.match_available&&(ie=n._tr_tally(G,0,G.window[G.strstart-1]),G.match_available=0),G.insert=G.strstart<_-1?G.strstart:_-1,pe===u?(v(G,!0),G.strm.avail_out===0?F:V):G.last_lit&&(v(G,!1),G.strm.avail_out===0)?P:L}function me(G,pe,ge,ie,$){this.good_length=G,this.max_lazy=pe,this.nice_length=ge,this.max_chain=ie,this.func=$}function Ee(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*w),this.dyn_dtree=new i.Buf16(2*(2*y+1)),this.bl_tree=new i.Buf16(2*(2*T+1)),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(S+1),this.heap=new i.Buf16(2*E+1),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*E+1),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Pe(G){var pe;return G&&G.state?(G.total_in=G.total_out=0,G.data_type=m,(pe=G.state).pending=0,pe.pending_out=0,pe.wrap<0&&(pe.wrap=-pe.wrap),pe.status=pe.wrap?D:I,G.adler=pe.wrap===2?0:1,pe.last_flush=l,n._tr_init(pe),h):B(G,p)}function Oe(G){var pe=Pe(G);return pe===h&&(function(ge){ge.window_size=2*ge.w_size,O(ge.head),ge.max_lazy_match=r[ge.level].max_lazy,ge.good_match=r[ge.level].good_length,ge.nice_match=r[ge.level].nice_length,ge.max_chain_length=r[ge.level].max_chain,ge.strstart=0,ge.block_start=0,ge.lookahead=0,ge.insert=0,ge.match_length=ge.prev_length=_-1,ge.match_available=0,ge.ins_h=0})(G.state),pe}function Fe(G,pe,ge,ie,$,ae){if(!G)return p;var ye=1;if(pe===d&&(pe=6),ie<0?(ye=0,ie=-ie):15<ie&&(ye=2,ie-=16),$<1||b<$||ge!==g||ie<8||15<ie||pe<0||9<pe||ae<0||f<ae)return B(G,p);ie===8&&(ie=9);var Be=new Ee;return(G.state=Be).strm=G,Be.wrap=ye,Be.gzhead=null,Be.w_bits=ie,Be.w_size=1<<Be.w_bits,Be.w_mask=Be.w_size-1,Be.hash_bits=$+7,Be.hash_size=1<<Be.hash_bits,Be.hash_mask=Be.hash_size-1,Be.hash_shift=~~((Be.hash_bits+_-1)/_),Be.window=new i.Buf8(2*Be.w_size),Be.head=new i.Buf16(Be.hash_size),Be.prev=new i.Buf16(Be.w_size),Be.lit_bufsize=1<<$+6,Be.pending_buf_size=4*Be.lit_bufsize,Be.pending_buf=new i.Buf8(Be.pending_buf_size),Be.d_buf=1*Be.lit_bufsize,Be.l_buf=3*Be.lit_bufsize,Be.level=pe,Be.strategy=ae,Be.method=ge,Oe(G)}r=[new me(0,0,0,0,function(G,pe){var ge=65535;for(ge>G.pending_buf_size-5&&(ge=G.pending_buf_size-5);;){if(G.lookahead<=1){if(q(G),G.lookahead===0&&pe===l)return P;if(G.lookahead===0)break}G.strstart+=G.lookahead,G.lookahead=0;var ie=G.block_start+ge;if((G.strstart===0||G.strstart>=ie)&&(G.lookahead=G.strstart-ie,G.strstart=ie,v(G,!1),G.strm.avail_out===0)||G.strstart-G.block_start>=G.w_size-x&&(v(G,!1),G.strm.avail_out===0))return P}return G.insert=0,pe===u?(v(G,!0),G.strm.avail_out===0?F:V):(G.strstart>G.block_start&&(v(G,!1),G.strm.avail_out),P)}),new me(4,4,8,4,Q),new me(4,5,16,8,Q),new me(4,6,32,32,Q),new me(4,4,16,16,oe),new me(8,16,32,32,oe),new me(8,16,128,128,oe),new me(8,32,128,256,oe),new me(32,128,258,1024,oe),new me(32,258,258,4096,oe)],s.deflateInit=function(G,pe){return Fe(G,pe,g,15,8,0)},s.deflateInit2=Fe,s.deflateReset=Oe,s.deflateResetKeep=Pe,s.deflateSetHeader=function(G,pe){return G&&G.state?G.state.wrap!==2?p:(G.state.gzhead=pe,h):p},s.deflate=function(G,pe){var ge,ie,$,ae;if(!G||!G.state||5<pe||pe<0)return G?B(G,p):p;if(ie=G.state,!G.output||!G.input&&G.avail_in!==0||ie.status===666&&pe!==u)return B(G,G.avail_out===0?-5:p);if(ie.strm=G,ge=ie.last_flush,ie.last_flush=pe,ie.status===D)if(ie.wrap===2)G.adler=0,j(ie,31),j(ie,139),j(ie,8),ie.gzhead?(j(ie,(ie.gzhead.text?1:0)+(ie.gzhead.hcrc?2:0)+(ie.gzhead.extra?4:0)+(ie.gzhead.name?8:0)+(ie.gzhead.comment?16:0)),j(ie,255&ie.gzhead.time),j(ie,ie.gzhead.time>>8&255),j(ie,ie.gzhead.time>>16&255),j(ie,ie.gzhead.time>>24&255),j(ie,ie.level===9?2:2<=ie.strategy||ie.level<2?4:0),j(ie,255&ie.gzhead.os),ie.gzhead.extra&&ie.gzhead.extra.length&&(j(ie,255&ie.gzhead.extra.length),j(ie,ie.gzhead.extra.length>>8&255)),ie.gzhead.hcrc&&(G.adler=o(G.adler,ie.pending_buf,ie.pending,0)),ie.gzindex=0,ie.status=69):(j(ie,0),j(ie,0),j(ie,0),j(ie,0),j(ie,0),j(ie,ie.level===9?2:2<=ie.strategy||ie.level<2?4:0),j(ie,3),ie.status=I);else{var ye=g+(ie.w_bits-8<<4)<<8;ye|=(2<=ie.strategy||ie.level<2?0:ie.level<6?1:ie.level===6?2:3)<<6,ie.strstart!==0&&(ye|=32),ye+=31-ye%31,ie.status=I,M(ie,ye),ie.strstart!==0&&(M(ie,G.adler>>>16),M(ie,65535&G.adler)),G.adler=1}if(ie.status===69)if(ie.gzhead.extra){for($=ie.pending;ie.gzindex<(65535&ie.gzhead.extra.length)&&(ie.pending!==ie.pending_buf_size||(ie.gzhead.hcrc&&ie.pending>$&&(G.adler=o(G.adler,ie.pending_buf,ie.pending-$,$)),R(G),$=ie.pending,ie.pending!==ie.pending_buf_size));)j(ie,255&ie.gzhead.extra[ie.gzindex]),ie.gzindex++;ie.gzhead.hcrc&&ie.pending>$&&(G.adler=o(G.adler,ie.pending_buf,ie.pending-$,$)),ie.gzindex===ie.gzhead.extra.length&&(ie.gzindex=0,ie.status=73)}else ie.status=73;if(ie.status===73)if(ie.gzhead.name){$=ie.pending;do{if(ie.pending===ie.pending_buf_size&&(ie.gzhead.hcrc&&ie.pending>$&&(G.adler=o(G.adler,ie.pending_buf,ie.pending-$,$)),R(G),$=ie.pending,ie.pending===ie.pending_buf_size)){ae=1;break}ae=ie.gzindex<ie.gzhead.name.length?255&ie.gzhead.name.charCodeAt(ie.gzindex++):0,j(ie,ae)}while(ae!==0);ie.gzhead.hcrc&&ie.pending>$&&(G.adler=o(G.adler,ie.pending_buf,ie.pending-$,$)),ae===0&&(ie.gzindex=0,ie.status=91)}else ie.status=91;if(ie.status===91)if(ie.gzhead.comment){$=ie.pending;do{if(ie.pending===ie.pending_buf_size&&(ie.gzhead.hcrc&&ie.pending>$&&(G.adler=o(G.adler,ie.pending_buf,ie.pending-$,$)),R(G),$=ie.pending,ie.pending===ie.pending_buf_size)){ae=1;break}ae=ie.gzindex<ie.gzhead.comment.length?255&ie.gzhead.comment.charCodeAt(ie.gzindex++):0,j(ie,ae)}while(ae!==0);ie.gzhead.hcrc&&ie.pending>$&&(G.adler=o(G.adler,ie.pending_buf,ie.pending-$,$)),ae===0&&(ie.status=103)}else ie.status=103;if(ie.status===103&&(ie.gzhead.hcrc?(ie.pending+2>ie.pending_buf_size&&R(G),ie.pending+2<=ie.pending_buf_size&&(j(ie,255&G.adler),j(ie,G.adler>>8&255),G.adler=0,ie.status=I)):ie.status=I),ie.pending!==0){if(R(G),G.avail_out===0)return ie.last_flush=-1,h}else if(G.avail_in===0&&k(pe)<=k(ge)&&pe!==u)return B(G,-5);if(ie.status===666&&G.avail_in!==0)return B(G,-5);if(G.avail_in!==0||ie.lookahead!==0||pe!==l&&ie.status!==666){var Be=ie.strategy===2?(function(be,xe){for(var je;;){if(be.lookahead===0&&(q(be),be.lookahead===0)){if(xe===l)return P;break}if(be.match_length=0,je=n._tr_tally(be,0,be.window[be.strstart]),be.lookahead--,be.strstart++,je&&(v(be,!1),be.strm.avail_out===0))return P}return be.insert=0,xe===u?(v(be,!0),be.strm.avail_out===0?F:V):be.last_lit&&(v(be,!1),be.strm.avail_out===0)?P:L})(ie,pe):ie.strategy===3?(function(be,xe){for(var je,ke,Xe,gt,it=be.window;;){if(be.lookahead<=C){if(q(be),be.lookahead<=C&&xe===l)return P;if(be.lookahead===0)break}if(be.match_length=0,be.lookahead>=_&&0<be.strstart&&(ke=it[Xe=be.strstart-1])===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]){gt=be.strstart+C;do;while(ke===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]&&ke===it[++Xe]&&Xe<gt);be.match_length=C-(gt-Xe),be.match_length>be.lookahead&&(be.match_length=be.lookahead)}if(be.match_length>=_?(je=n._tr_tally(be,1,be.match_length-_),be.lookahead-=be.match_length,be.strstart+=be.match_length,be.match_length=0):(je=n._tr_tally(be,0,be.window[be.strstart]),be.lookahead--,be.strstart++),je&&(v(be,!1),be.strm.avail_out===0))return P}return be.insert=0,xe===u?(v(be,!0),be.strm.avail_out===0?F:V):be.last_lit&&(v(be,!1),be.strm.avail_out===0)?P:L})(ie,pe):r[ie.level].func(ie,pe);if(Be!==F&&Be!==V||(ie.status=666),Be===P||Be===F)return G.avail_out===0&&(ie.last_flush=-1),h;if(Be===L&&(pe===1?n._tr_align(ie):pe!==5&&(n._tr_stored_block(ie,0,0,!1),pe===3&&(O(ie.head),ie.lookahead===0&&(ie.strstart=0,ie.block_start=0,ie.insert=0))),R(G),G.avail_out===0))return ie.last_flush=-1,h}return pe!==u?h:ie.wrap<=0?1:(ie.wrap===2?(j(ie,255&G.adler),j(ie,G.adler>>8&255),j(ie,G.adler>>16&255),j(ie,G.adler>>24&255),j(ie,255&G.total_in),j(ie,G.total_in>>8&255),j(ie,G.total_in>>16&255),j(ie,G.total_in>>24&255)):(M(ie,G.adler>>>16),M(ie,65535&G.adler)),R(G),0<ie.wrap&&(ie.wrap=-ie.wrap),ie.pending!==0?h:1)},s.deflateEnd=function(G){var pe;return G&&G.state?(pe=G.state.status)!==D&&pe!==69&&pe!==73&&pe!==91&&pe!==103&&pe!==I&&pe!==666?B(G,p):(G.state=null,pe===I?B(G,-3):h):p},s.deflateSetDictionary=function(G,pe){var ge,ie,$,ae,ye,Be,be,xe,je=pe.length;if(!G||!G.state||(ae=(ge=G.state).wrap)===2||ae===1&&ge.status!==D||ge.lookahead)return p;for(ae===1&&(G.adler=a(G.adler,pe,je,0)),ge.wrap=0,je>=ge.w_size&&(ae===0&&(O(ge.head),ge.strstart=0,ge.block_start=0,ge.insert=0),xe=new i.Buf8(ge.w_size),i.arraySet(xe,pe,je-ge.w_size,ge.w_size,0),pe=xe,je=ge.w_size),ye=G.avail_in,Be=G.next_in,be=G.input,G.avail_in=je,G.next_in=0,G.input=pe,q(ge);ge.lookahead>=_;){for(ie=ge.strstart,$=ge.lookahead-(_-1);ge.ins_h=(ge.ins_h<<ge.hash_shift^ge.window[ie+_-1])&ge.hash_mask,ge.prev[ie&ge.w_mask]=ge.head[ge.ins_h],ge.head[ge.ins_h]=ie,ie++,--$;);ge.strstart=ie,ge.lookahead=_-1,q(ge)}return ge.strstart+=ge.lookahead,ge.block_start=ge.strstart,ge.insert=ge.lookahead,ge.lookahead=0,ge.match_length=ge.prev_length=_-1,ge.match_available=0,G.next_in=Be,G.input=be,G.avail_in=ye,ge.wrap=ae,h},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,t,s){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,t,s){"use strict";t.exports=function(r,i){var n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C,x,D,I,P,L;n=r.state,a=r.next_in,P=r.input,o=a+(r.avail_in-5),c=r.next_out,L=r.output,l=c-(i-r.avail_out),u=c+(r.avail_out-257),h=n.dmax,p=n.wsize,d=n.whave,f=n.wnext,m=n.window,g=n.hold,b=n.bits,E=n.lencode,y=n.distcode,T=(1<<n.lenbits)-1,w=(1<<n.distbits)-1;e:do{b<15&&(g+=P[a++]<<b,b+=8,g+=P[a++]<<b,b+=8),S=E[g&T];t:for(;;){if(g>>>=_=S>>>24,b-=_,(_=S>>>16&255)===0)L[c++]=65535&S;else{if(!(16&_)){if((64&_)==0){S=E[(65535&S)+(g&(1<<_)-1)];continue t}if(32&_){n.mode=12;break e}r.msg="invalid literal/length code",n.mode=30;break e}C=65535&S,(_&=15)&&(b<_&&(g+=P[a++]<<b,b+=8),C+=g&(1<<_)-1,g>>>=_,b-=_),b<15&&(g+=P[a++]<<b,b+=8,g+=P[a++]<<b,b+=8),S=y[g&w];s:for(;;){if(g>>>=_=S>>>24,b-=_,!(16&(_=S>>>16&255))){if((64&_)==0){S=y[(65535&S)+(g&(1<<_)-1)];continue s}r.msg="invalid distance code",n.mode=30;break e}if(x=65535&S,b<(_&=15)&&(g+=P[a++]<<b,(b+=8)<_&&(g+=P[a++]<<b,b+=8)),h<(x+=g&(1<<_)-1)){r.msg="invalid distance too far back",n.mode=30;break e}if(g>>>=_,b-=_,(_=c-l)<x){if(d<(_=x-_)&&n.sane){r.msg="invalid distance too far back",n.mode=30;break e}if(I=m,(D=0)===f){if(D+=p-_,_<C){for(C-=_;L[c++]=m[D++],--_;);D=c-x,I=L}}else if(f<_){if(D+=p+f-_,(_-=f)<C){for(C-=_;L[c++]=m[D++],--_;);if(D=0,f<C){for(C-=_=f;L[c++]=m[D++],--_;);D=c-x,I=L}}}else if(D+=f-_,_<C){for(C-=_;L[c++]=m[D++],--_;);D=c-x,I=L}for(;2<C;)L[c++]=I[D++],L[c++]=I[D++],L[c++]=I[D++],C-=3;C&&(L[c++]=I[D++],1<C&&(L[c++]=I[D++]))}else{for(D=c-x;L[c++]=L[D++],L[c++]=L[D++],L[c++]=L[D++],2<(C-=3););C&&(L[c++]=L[D++],1<C&&(L[c++]=L[D++]))}break}}break}}while(a<o&&c<u);a-=C=b>>3,g&=(1<<(b-=C<<3))-1,r.next_in=a,r.next_out=c,r.avail_in=a<o?o-a+5:5-(a-o),r.avail_out=c<u?u-c+257:257-(c-u),n.hold=g,n.bits=b}},{}],49:[function(e,t,s){"use strict";var r=e("../utils/common"),i=e("./adler32"),n=e("./crc32"),a=e("./inffast"),o=e("./inftrees"),c=1,l=2,u=0,h=-2,p=1,d=852,f=592;function m(D){return(D>>>24&255)+(D>>>8&65280)+((65280&D)<<8)+((255&D)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(D){var I;return D&&D.state?(I=D.state,D.total_in=D.total_out=I.total=0,D.msg="",I.wrap&&(D.adler=1&I.wrap),I.mode=p,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new r.Buf32(d),I.distcode=I.distdyn=new r.Buf32(f),I.sane=1,I.back=-1,u):h}function E(D){var I;return D&&D.state?((I=D.state).wsize=0,I.whave=0,I.wnext=0,b(D)):h}function y(D,I){var P,L;return D&&D.state?(L=D.state,I<0?(P=0,I=-I):(P=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?h:(L.window!==null&&L.wbits!==I&&(L.window=null),L.wrap=P,L.wbits=I,E(D))):h}function T(D,I){var P,L;return D?(L=new g,(D.state=L).window=null,(P=y(D,I))!==u&&(D.state=null),P):h}var w,S,_=!0;function C(D){if(_){var I;for(w=new r.Buf32(512),S=new r.Buf32(32),I=0;I<144;)D.lens[I++]=8;for(;I<256;)D.lens[I++]=9;for(;I<280;)D.lens[I++]=7;for(;I<288;)D.lens[I++]=8;for(o(c,D.lens,0,288,w,0,D.work,{bits:9}),I=0;I<32;)D.lens[I++]=5;o(l,D.lens,0,32,S,0,D.work,{bits:5}),_=!1}D.lencode=w,D.lenbits=9,D.distcode=S,D.distbits=5}function x(D,I,P,L){var F,V=D.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new r.Buf8(V.wsize)),L>=V.wsize?(r.arraySet(V.window,I,P-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(L<(F=V.wsize-V.wnext)&&(F=L),r.arraySet(V.window,I,P-L,F,V.wnext),(L-=F)?(r.arraySet(V.window,I,P-L,L,0),V.wnext=L,V.whave=V.wsize):(V.wnext+=F,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=F))),0}s.inflateReset=E,s.inflateReset2=y,s.inflateResetKeep=b,s.inflateInit=function(D){return T(D,15)},s.inflateInit2=T,s.inflate=function(D,I){var P,L,F,V,B,k,O,R,v,j,M,H,q,Q,oe,me,Ee,Pe,Oe,Fe,G,pe,ge,ie,$=0,ae=new r.Buf8(4),ye=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!D||!D.state||!D.output||!D.input&&D.avail_in!==0)return h;(P=D.state).mode===12&&(P.mode=13),B=D.next_out,F=D.output,O=D.avail_out,V=D.next_in,L=D.input,k=D.avail_in,R=P.hold,v=P.bits,j=k,M=O,pe=u;e:for(;;)switch(P.mode){case p:if(P.wrap===0){P.mode=13;break}for(;v<16;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(2&P.wrap&&R===35615){ae[P.check=0]=255&R,ae[1]=R>>>8&255,P.check=n(P.check,ae,2,0),v=R=0,P.mode=2;break}if(P.flags=0,P.head&&(P.head.done=!1),!(1&P.wrap)||(((255&R)<<8)+(R>>8))%31){D.msg="incorrect header check",P.mode=30;break}if((15&R)!=8){D.msg="unknown compression method",P.mode=30;break}if(v-=4,G=8+(15&(R>>>=4)),P.wbits===0)P.wbits=G;else if(G>P.wbits){D.msg="invalid window size",P.mode=30;break}P.dmax=1<<G,D.adler=P.check=1,P.mode=512&R?10:12,v=R=0;break;case 2:for(;v<16;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(P.flags=R,(255&P.flags)!=8){D.msg="unknown compression method",P.mode=30;break}if(57344&P.flags){D.msg="unknown header flags set",P.mode=30;break}P.head&&(P.head.text=R>>8&1),512&P.flags&&(ae[0]=255&R,ae[1]=R>>>8&255,P.check=n(P.check,ae,2,0)),v=R=0,P.mode=3;case 3:for(;v<32;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}P.head&&(P.head.time=R),512&P.flags&&(ae[0]=255&R,ae[1]=R>>>8&255,ae[2]=R>>>16&255,ae[3]=R>>>24&255,P.check=n(P.check,ae,4,0)),v=R=0,P.mode=4;case 4:for(;v<16;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}P.head&&(P.head.xflags=255&R,P.head.os=R>>8),512&P.flags&&(ae[0]=255&R,ae[1]=R>>>8&255,P.check=n(P.check,ae,2,0)),v=R=0,P.mode=5;case 5:if(1024&P.flags){for(;v<16;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}P.length=R,P.head&&(P.head.extra_len=R),512&P.flags&&(ae[0]=255&R,ae[1]=R>>>8&255,P.check=n(P.check,ae,2,0)),v=R=0}else P.head&&(P.head.extra=null);P.mode=6;case 6:if(1024&P.flags&&(k<(H=P.length)&&(H=k),H&&(P.head&&(G=P.head.extra_len-P.length,P.head.extra||(P.head.extra=new Array(P.head.extra_len)),r.arraySet(P.head.extra,L,V,H,G)),512&P.flags&&(P.check=n(P.check,L,H,V)),k-=H,V+=H,P.length-=H),P.length))break e;P.length=0,P.mode=7;case 7:if(2048&P.flags){if(k===0)break e;for(H=0;G=L[V+H++],P.head&&G&&P.length<65536&&(P.head.name+=String.fromCharCode(G)),G&&H<k;);if(512&P.flags&&(P.check=n(P.check,L,H,V)),k-=H,V+=H,G)break e}else P.head&&(P.head.name=null);P.length=0,P.mode=8;case 8:if(4096&P.flags){if(k===0)break e;for(H=0;G=L[V+H++],P.head&&G&&P.length<65536&&(P.head.comment+=String.fromCharCode(G)),G&&H<k;);if(512&P.flags&&(P.check=n(P.check,L,H,V)),k-=H,V+=H,G)break e}else P.head&&(P.head.comment=null);P.mode=9;case 9:if(512&P.flags){for(;v<16;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(R!==(65535&P.check)){D.msg="header crc mismatch",P.mode=30;break}v=R=0}P.head&&(P.head.hcrc=P.flags>>9&1,P.head.done=!0),D.adler=P.check=0,P.mode=12;break;case 10:for(;v<32;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}D.adler=P.check=m(R),v=R=0,P.mode=11;case 11:if(P.havedict===0)return D.next_out=B,D.avail_out=O,D.next_in=V,D.avail_in=k,P.hold=R,P.bits=v,2;D.adler=P.check=1,P.mode=12;case 12:if(I===5||I===6)break e;case 13:if(P.last){R>>>=7&v,v-=7&v,P.mode=27;break}for(;v<3;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}switch(P.last=1&R,v-=1,3&(R>>>=1)){case 0:P.mode=14;break;case 1:if(C(P),P.mode=20,I!==6)break;R>>>=2,v-=2;break e;case 2:P.mode=17;break;case 3:D.msg="invalid block type",P.mode=30}R>>>=2,v-=2;break;case 14:for(R>>>=7&v,v-=7&v;v<32;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if((65535&R)!=(R>>>16^65535)){D.msg="invalid stored block lengths",P.mode=30;break}if(P.length=65535&R,v=R=0,P.mode=15,I===6)break e;case 15:P.mode=16;case 16:if(H=P.length){if(k<H&&(H=k),O<H&&(H=O),H===0)break e;r.arraySet(F,L,V,H,B),k-=H,V+=H,O-=H,B+=H,P.length-=H;break}P.mode=12;break;case 17:for(;v<14;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(P.nlen=257+(31&R),R>>>=5,v-=5,P.ndist=1+(31&R),R>>>=5,v-=5,P.ncode=4+(15&R),R>>>=4,v-=4,286<P.nlen||30<P.ndist){D.msg="too many length or distance symbols",P.mode=30;break}P.have=0,P.mode=18;case 18:for(;P.have<P.ncode;){for(;v<3;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}P.lens[ye[P.have++]]=7&R,R>>>=3,v-=3}for(;P.have<19;)P.lens[ye[P.have++]]=0;if(P.lencode=P.lendyn,P.lenbits=7,ge={bits:P.lenbits},pe=o(0,P.lens,0,19,P.lencode,0,P.work,ge),P.lenbits=ge.bits,pe){D.msg="invalid code lengths set",P.mode=30;break}P.have=0,P.mode=19;case 19:for(;P.have<P.nlen+P.ndist;){for(;me=($=P.lencode[R&(1<<P.lenbits)-1])>>>16&255,Ee=65535&$,!((oe=$>>>24)<=v);){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(Ee<16)R>>>=oe,v-=oe,P.lens[P.have++]=Ee;else{if(Ee===16){for(ie=oe+2;v<ie;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(R>>>=oe,v-=oe,P.have===0){D.msg="invalid bit length repeat",P.mode=30;break}G=P.lens[P.have-1],H=3+(3&R),R>>>=2,v-=2}else if(Ee===17){for(ie=oe+3;v<ie;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}v-=oe,G=0,H=3+(7&(R>>>=oe)),R>>>=3,v-=3}else{for(ie=oe+7;v<ie;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}v-=oe,G=0,H=11+(127&(R>>>=oe)),R>>>=7,v-=7}if(P.have+H>P.nlen+P.ndist){D.msg="invalid bit length repeat",P.mode=30;break}for(;H--;)P.lens[P.have++]=G}}if(P.mode===30)break;if(P.lens[256]===0){D.msg="invalid code -- missing end-of-block",P.mode=30;break}if(P.lenbits=9,ge={bits:P.lenbits},pe=o(c,P.lens,0,P.nlen,P.lencode,0,P.work,ge),P.lenbits=ge.bits,pe){D.msg="invalid literal/lengths set",P.mode=30;break}if(P.distbits=6,P.distcode=P.distdyn,ge={bits:P.distbits},pe=o(l,P.lens,P.nlen,P.ndist,P.distcode,0,P.work,ge),P.distbits=ge.bits,pe){D.msg="invalid distances set",P.mode=30;break}if(P.mode=20,I===6)break e;case 20:P.mode=21;case 21:if(6<=k&&258<=O){D.next_out=B,D.avail_out=O,D.next_in=V,D.avail_in=k,P.hold=R,P.bits=v,a(D,M),B=D.next_out,F=D.output,O=D.avail_out,V=D.next_in,L=D.input,k=D.avail_in,R=P.hold,v=P.bits,P.mode===12&&(P.back=-1);break}for(P.back=0;me=($=P.lencode[R&(1<<P.lenbits)-1])>>>16&255,Ee=65535&$,!((oe=$>>>24)<=v);){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(me&&(240&me)==0){for(Pe=oe,Oe=me,Fe=Ee;me=($=P.lencode[Fe+((R&(1<<Pe+Oe)-1)>>Pe)])>>>16&255,Ee=65535&$,!(Pe+(oe=$>>>24)<=v);){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}R>>>=Pe,v-=Pe,P.back+=Pe}if(R>>>=oe,v-=oe,P.back+=oe,P.length=Ee,me===0){P.mode=26;break}if(32&me){P.back=-1,P.mode=12;break}if(64&me){D.msg="invalid literal/length code",P.mode=30;break}P.extra=15&me,P.mode=22;case 22:if(P.extra){for(ie=P.extra;v<ie;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}P.length+=R&(1<<P.extra)-1,R>>>=P.extra,v-=P.extra,P.back+=P.extra}P.was=P.length,P.mode=23;case 23:for(;me=($=P.distcode[R&(1<<P.distbits)-1])>>>16&255,Ee=65535&$,!((oe=$>>>24)<=v);){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if((240&me)==0){for(Pe=oe,Oe=me,Fe=Ee;me=($=P.distcode[Fe+((R&(1<<Pe+Oe)-1)>>Pe)])>>>16&255,Ee=65535&$,!(Pe+(oe=$>>>24)<=v);){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}R>>>=Pe,v-=Pe,P.back+=Pe}if(R>>>=oe,v-=oe,P.back+=oe,64&me){D.msg="invalid distance code",P.mode=30;break}P.offset=Ee,P.extra=15&me,P.mode=24;case 24:if(P.extra){for(ie=P.extra;v<ie;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}P.offset+=R&(1<<P.extra)-1,R>>>=P.extra,v-=P.extra,P.back+=P.extra}if(P.offset>P.dmax){D.msg="invalid distance too far back",P.mode=30;break}P.mode=25;case 25:if(O===0)break e;if(H=M-O,P.offset>H){if((H=P.offset-H)>P.whave&&P.sane){D.msg="invalid distance too far back",P.mode=30;break}q=H>P.wnext?(H-=P.wnext,P.wsize-H):P.wnext-H,H>P.length&&(H=P.length),Q=P.window}else Q=F,q=B-P.offset,H=P.length;for(O<H&&(H=O),O-=H,P.length-=H;F[B++]=Q[q++],--H;);P.length===0&&(P.mode=21);break;case 26:if(O===0)break e;F[B++]=P.length,O--,P.mode=21;break;case 27:if(P.wrap){for(;v<32;){if(k===0)break e;k--,R|=L[V++]<<v,v+=8}if(M-=O,D.total_out+=M,P.total+=M,M&&(D.adler=P.check=P.flags?n(P.check,F,M,B-M):i(P.check,F,M,B-M)),M=O,(P.flags?R:m(R))!==P.check){D.msg="incorrect data check",P.mode=30;break}v=R=0}P.mode=28;case 28:if(P.wrap&&P.flags){for(;v<32;){if(k===0)break e;k--,R+=L[V++]<<v,v+=8}if(R!==(4294967295&P.total)){D.msg="incorrect length check",P.mode=30;break}v=R=0}P.mode=29;case 29:pe=1;break e;case 30:pe=-3;break e;case 31:return-4;case 32:default:return h}return D.next_out=B,D.avail_out=O,D.next_in=V,D.avail_in=k,P.hold=R,P.bits=v,(P.wsize||M!==D.avail_out&&P.mode<30&&(P.mode<27||I!==4))&&x(D,D.output,D.next_out,M-D.avail_out)?(P.mode=31,-4):(j-=D.avail_in,M-=D.avail_out,D.total_in+=j,D.total_out+=M,P.total+=M,P.wrap&&M&&(D.adler=P.check=P.flags?n(P.check,F,M,D.next_out-M):i(P.check,F,M,D.next_out-M)),D.data_type=P.bits+(P.last?64:0)+(P.mode===12?128:0)+(P.mode===20||P.mode===15?256:0),(j==0&&M===0||I===4)&&pe===u&&(pe=-5),pe)},s.inflateEnd=function(D){if(!D||!D.state)return h;var I=D.state;return I.window&&(I.window=null),D.state=null,u},s.inflateGetHeader=function(D,I){var P;return D&&D.state?(2&(P=D.state).wrap)==0?h:((P.head=I).done=!1,u):h},s.inflateSetDictionary=function(D,I){var P,L=I.length;return D&&D.state?(P=D.state).wrap!==0&&P.mode!==11?h:P.mode===11&&i(1,I,L,0)!==P.check?-3:x(D,I,L,L)?(P.mode=31,-4):(P.havedict=1,u):h},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,t,s){"use strict";var r=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(c,l,u,h,p,d,f,m){var g,b,E,y,T,w,S,_,C,x=m.bits,D=0,I=0,P=0,L=0,F=0,V=0,B=0,k=0,O=0,R=0,v=null,j=0,M=new r.Buf16(16),H=new r.Buf16(16),q=null,Q=0;for(D=0;D<=15;D++)M[D]=0;for(I=0;I<h;I++)M[l[u+I]]++;for(F=x,L=15;1<=L&&M[L]===0;L--);if(L<F&&(F=L),L===0)return p[d++]=20971520,p[d++]=20971520,m.bits=1,0;for(P=1;P<L&&M[P]===0;P++);for(F<P&&(F=P),D=k=1;D<=15;D++)if(k<<=1,(k-=M[D])<0)return-1;if(0<k&&(c===0||L!==1))return-1;for(H[1]=0,D=1;D<15;D++)H[D+1]=H[D]+M[D];for(I=0;I<h;I++)l[u+I]!==0&&(f[H[l[u+I]]++]=I);if(w=c===0?(v=q=f,19):c===1?(v=i,j-=257,q=n,Q-=257,256):(v=a,q=o,-1),D=P,T=d,B=I=R=0,E=-1,y=(O=1<<(V=F))-1,c===1&&852<O||c===2&&592<O)return 1;for(;;){for(S=D-B,C=f[I]<w?(_=0,f[I]):f[I]>w?(_=q[Q+f[I]],v[j+f[I]]):(_=96,0),g=1<<D-B,P=b=1<<V;p[T+(R>>B)+(b-=g)]=S<<24|_<<16|C|0,b!==0;);for(g=1<<D-1;R&g;)g>>=1;if(g!==0?(R&=g-1,R+=g):R=0,I++,--M[D]==0){if(D===L)break;D=l[u+f[I]]}if(F<D&&(R&y)!==E){for(B===0&&(B=F),T+=P,k=1<<(V=D-B);V+B<L&&!((k-=M[V+B])<=0);)V++,k<<=1;if(O+=1<<V,c===1&&852<O||c===2&&592<O)return 1;p[E=R&y]=F<<24|V<<16|T-d|0}}return R!==0&&(p[T+R]=D-B<<24|64<<16|0),m.bits=F,0}},{"../utils/common":41}],51:[function(e,t,s){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,t,s){"use strict";var r=e("../utils/common"),i=0,n=1;function a($){for(var ae=$.length;0<=--ae;)$[ae]=0}var o=0,c=29,l=256,u=l+1+c,h=30,p=19,d=2*u+1,f=15,m=16,g=7,b=256,E=16,y=17,T=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=new Array(2*(u+2));a(x);var D=new Array(2*h);a(D);var I=new Array(512);a(I);var P=new Array(256);a(P);var L=new Array(c);a(L);var F,V,B,k=new Array(h);function O($,ae,ye,Be,be){this.static_tree=$,this.extra_bits=ae,this.extra_base=ye,this.elems=Be,this.max_length=be,this.has_stree=$&&$.length}function R($,ae){this.dyn_tree=$,this.max_code=0,this.stat_desc=ae}function v($){return $<256?I[$]:I[256+($>>>7)]}function j($,ae){$.pending_buf[$.pending++]=255&ae,$.pending_buf[$.pending++]=ae>>>8&255}function M($,ae,ye){$.bi_valid>m-ye?($.bi_buf|=ae<<$.bi_valid&65535,j($,$.bi_buf),$.bi_buf=ae>>m-$.bi_valid,$.bi_valid+=ye-m):($.bi_buf|=ae<<$.bi_valid&65535,$.bi_valid+=ye)}function H($,ae,ye){M($,ye[2*ae],ye[2*ae+1])}function q($,ae){for(var ye=0;ye|=1&$,$>>>=1,ye<<=1,0<--ae;);return ye>>>1}function Q($,ae,ye){var Be,be,xe=new Array(f+1),je=0;for(Be=1;Be<=f;Be++)xe[Be]=je=je+ye[Be-1]<<1;for(be=0;be<=ae;be++){var ke=$[2*be+1];ke!==0&&($[2*be]=q(xe[ke]++,ke))}}function oe($){var ae;for(ae=0;ae<u;ae++)$.dyn_ltree[2*ae]=0;for(ae=0;ae<h;ae++)$.dyn_dtree[2*ae]=0;for(ae=0;ae<p;ae++)$.bl_tree[2*ae]=0;$.dyn_ltree[2*b]=1,$.opt_len=$.static_len=0,$.last_lit=$.matches=0}function me($){8<$.bi_valid?j($,$.bi_buf):0<$.bi_valid&&($.pending_buf[$.pending++]=$.bi_buf),$.bi_buf=0,$.bi_valid=0}function Ee($,ae,ye,Be){var be=2*ae,xe=2*ye;return $[be]<$[xe]||$[be]===$[xe]&&Be[ae]<=Be[ye]}function Pe($,ae,ye){for(var Be=$.heap[ye],be=ye<<1;be<=$.heap_len&&(be<$.heap_len&&Ee(ae,$.heap[be+1],$.heap[be],$.depth)&&be++,!Ee(ae,Be,$.heap[be],$.depth));)$.heap[ye]=$.heap[be],ye=be,be<<=1;$.heap[ye]=Be}function Oe($,ae,ye){var Be,be,xe,je,ke=0;if($.last_lit!==0)for(;Be=$.pending_buf[$.d_buf+2*ke]<<8|$.pending_buf[$.d_buf+2*ke+1],be=$.pending_buf[$.l_buf+ke],ke++,Be===0?H($,be,ae):(H($,(xe=P[be])+l+1,ae),(je=w[xe])!==0&&M($,be-=L[xe],je),H($,xe=v(--Be),ye),(je=S[xe])!==0&&M($,Be-=k[xe],je)),ke<$.last_lit;);H($,b,ae)}function Fe($,ae){var ye,Be,be,xe=ae.dyn_tree,je=ae.stat_desc.static_tree,ke=ae.stat_desc.has_stree,Xe=ae.stat_desc.elems,gt=-1;for($.heap_len=0,$.heap_max=d,ye=0;ye<Xe;ye++)xe[2*ye]!==0?($.heap[++$.heap_len]=gt=ye,$.depth[ye]=0):xe[2*ye+1]=0;for(;$.heap_len<2;)xe[2*(be=$.heap[++$.heap_len]=gt<2?++gt:0)]=1,$.depth[be]=0,$.opt_len--,ke&&($.static_len-=je[2*be+1]);for(ae.max_code=gt,ye=$.heap_len>>1;1<=ye;ye--)Pe($,xe,ye);for(be=Xe;ye=$.heap[1],$.heap[1]=$.heap[$.heap_len--],Pe($,xe,1),Be=$.heap[1],$.heap[--$.heap_max]=ye,$.heap[--$.heap_max]=Be,xe[2*be]=xe[2*ye]+xe[2*Be],$.depth[be]=($.depth[ye]>=$.depth[Be]?$.depth[ye]:$.depth[Be])+1,xe[2*ye+1]=xe[2*Be+1]=be,$.heap[1]=be++,Pe($,xe,1),2<=$.heap_len;);$.heap[--$.heap_max]=$.heap[1],(function(it,Ve){var as,Ds,A,N,Y,z,U=Ve.dyn_tree,Z=Ve.max_code,J=Ve.stat_desc.static_tree,ne=Ve.stat_desc.has_stree,ue=Ve.stat_desc.extra_bits,Ie=Ve.stat_desc.extra_base,Ue=Ve.stat_desc.max_length,Ye=0;for(N=0;N<=f;N++)it.bl_count[N]=0;for(U[2*it.heap[it.heap_max]+1]=0,as=it.heap_max+1;as<d;as++)Ue<(N=U[2*U[2*(Ds=it.heap[as])+1]+1]+1)&&(N=Ue,Ye++),U[2*Ds+1]=N,Z<Ds||(it.bl_count[N]++,Y=0,Ie<=Ds&&(Y=ue[Ds-Ie]),z=U[2*Ds],it.opt_len+=z*(N+Y),ne&&(it.static_len+=z*(J[2*Ds+1]+Y)));if(Ye!==0){do{for(N=Ue-1;it.bl_count[N]===0;)N--;it.bl_count[N]--,it.bl_count[N+1]+=2,it.bl_count[Ue]--,Ye-=2}while(0<Ye);for(N=Ue;N!==0;N--)for(Ds=it.bl_count[N];Ds!==0;)Z<(A=it.heap[--as])||(U[2*A+1]!==N&&(it.opt_len+=(N-U[2*A+1])*U[2*A],U[2*A+1]=N),Ds--)}})($,ae),Q(xe,gt,$.bl_count)}function G($,ae,ye){var Be,be,xe=-1,je=ae[1],ke=0,Xe=7,gt=4;for(je===0&&(Xe=138,gt=3),ae[2*(ye+1)+1]=65535,Be=0;Be<=ye;Be++)be=je,je=ae[2*(Be+1)+1],++ke<Xe&&be===je||(ke<gt?$.bl_tree[2*be]+=ke:be!==0?(be!==xe&&$.bl_tree[2*be]++,$.bl_tree[2*E]++):ke<=10?$.bl_tree[2*y]++:$.bl_tree[2*T]++,xe=be,gt=(ke=0)===je?(Xe=138,3):be===je?(Xe=6,3):(Xe=7,4))}function pe($,ae,ye){var Be,be,xe=-1,je=ae[1],ke=0,Xe=7,gt=4;for(je===0&&(Xe=138,gt=3),Be=0;Be<=ye;Be++)if(be=je,je=ae[2*(Be+1)+1],!(++ke<Xe&&be===je)){if(ke<gt)for(;H($,be,$.bl_tree),--ke!=0;);else be!==0?(be!==xe&&(H($,be,$.bl_tree),ke--),H($,E,$.bl_tree),M($,ke-3,2)):ke<=10?(H($,y,$.bl_tree),M($,ke-3,3)):(H($,T,$.bl_tree),M($,ke-11,7));xe=be,gt=(ke=0)===je?(Xe=138,3):be===je?(Xe=6,3):(Xe=7,4)}}a(k);var ge=!1;function ie($,ae,ye,Be){M($,(o<<1)+(Be?1:0),3),(function(be,xe,je,ke){me(be),ke&&(j(be,je),j(be,~je)),r.arraySet(be.pending_buf,be.window,xe,je,be.pending),be.pending+=je})($,ae,ye,!0)}s._tr_init=function($){ge||((function(){var ae,ye,Be,be,xe,je=new Array(f+1);for(be=Be=0;be<c-1;be++)for(L[be]=Be,ae=0;ae<1<<w[be];ae++)P[Be++]=be;for(P[Be-1]=be,be=xe=0;be<16;be++)for(k[be]=xe,ae=0;ae<1<<S[be];ae++)I[xe++]=be;for(xe>>=7;be<h;be++)for(k[be]=xe<<7,ae=0;ae<1<<S[be]-7;ae++)I[256+xe++]=be;for(ye=0;ye<=f;ye++)je[ye]=0;for(ae=0;ae<=143;)x[2*ae+1]=8,ae++,je[8]++;for(;ae<=255;)x[2*ae+1]=9,ae++,je[9]++;for(;ae<=279;)x[2*ae+1]=7,ae++,je[7]++;for(;ae<=287;)x[2*ae+1]=8,ae++,je[8]++;for(Q(x,u+1,je),ae=0;ae<h;ae++)D[2*ae+1]=5,D[2*ae]=q(ae,5);F=new O(x,w,l+1,u,f),V=new O(D,S,0,h,f),B=new O(new Array(0),_,0,p,g)})(),ge=!0),$.l_desc=new R($.dyn_ltree,F),$.d_desc=new R($.dyn_dtree,V),$.bl_desc=new R($.bl_tree,B),$.bi_buf=0,$.bi_valid=0,oe($)},s._tr_stored_block=ie,s._tr_flush_block=function($,ae,ye,Be){var be,xe,je=0;0<$.level?($.strm.data_type===2&&($.strm.data_type=(function(ke){var Xe,gt=4093624447;for(Xe=0;Xe<=31;Xe++,gt>>>=1)if(1&gt&&ke.dyn_ltree[2*Xe]!==0)return i;if(ke.dyn_ltree[18]!==0||ke.dyn_ltree[20]!==0||ke.dyn_ltree[26]!==0)return n;for(Xe=32;Xe<l;Xe++)if(ke.dyn_ltree[2*Xe]!==0)return n;return i})($)),Fe($,$.l_desc),Fe($,$.d_desc),je=(function(ke){var Xe;for(G(ke,ke.dyn_ltree,ke.l_desc.max_code),G(ke,ke.dyn_dtree,ke.d_desc.max_code),Fe(ke,ke.bl_desc),Xe=p-1;3<=Xe&&ke.bl_tree[2*C[Xe]+1]===0;Xe--);return ke.opt_len+=3*(Xe+1)+5+5+4,Xe})($),be=$.opt_len+3+7>>>3,(xe=$.static_len+3+7>>>3)<=be&&(be=xe)):be=xe=ye+5,ye+4<=be&&ae!==-1?ie($,ae,ye,Be):$.strategy===4||xe===be?(M($,2+(Be?1:0),3),Oe($,x,D)):(M($,4+(Be?1:0),3),(function(ke,Xe,gt,it){var Ve;for(M(ke,Xe-257,5),M(ke,gt-1,5),M(ke,it-4,4),Ve=0;Ve<it;Ve++)M(ke,ke.bl_tree[2*C[Ve]+1],3);pe(ke,ke.dyn_ltree,Xe-1),pe(ke,ke.dyn_dtree,gt-1)})($,$.l_desc.max_code+1,$.d_desc.max_code+1,je+1),Oe($,$.dyn_ltree,$.dyn_dtree)),oe($),Be&&me($)},s._tr_tally=function($,ae,ye){return $.pending_buf[$.d_buf+2*$.last_lit]=ae>>>8&255,$.pending_buf[$.d_buf+2*$.last_lit+1]=255&ae,$.pending_buf[$.l_buf+$.last_lit]=255&ye,$.last_lit++,ae===0?$.dyn_ltree[2*ye]++:($.matches++,ae--,$.dyn_ltree[2*(P[ye]+l+1)]++,$.dyn_dtree[2*v(ae)]++),$.last_lit===$.lit_bufsize-1},s._tr_align=function($){M($,2,3),H($,b,x),(function(ae){ae.bi_valid===16?(j(ae,ae.bi_buf),ae.bi_buf=0,ae.bi_valid=0):8<=ae.bi_valid&&(ae.pending_buf[ae.pending++]=255&ae.bi_buf,ae.bi_buf>>=8,ae.bi_valid-=8)})($)}},{"../utils/common":41}],53:[function(e,t,s){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,t,s){(function(r){(function(i,n){"use strict";if(!i.setImmediate){var a,o,c,l,u=1,h={},p=!1,d=i.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(i);f=f&&f.setTimeout?f:i,a={}.toString.call(i.process)==="[object process]"?function(E){process.nextTick(function(){g(E)})}:(function(){if(i.postMessage&&!i.importScripts){var E=!0,y=i.onmessage;return i.onmessage=function(){E=!1},i.postMessage("","*"),i.onmessage=y,E}})()?(l="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",b,!1):i.attachEvent("onmessage",b),function(E){i.postMessage(l+E,"*")}):i.MessageChannel?((c=new MessageChannel).port1.onmessage=function(E){g(E.data)},function(E){c.port2.postMessage(E)}):d&&"onreadystatechange"in d.createElement("script")?(o=d.documentElement,function(E){var y=d.createElement("script");y.onreadystatechange=function(){g(E),y.onreadystatechange=null,o.removeChild(y),y=null},o.appendChild(y)}):function(E){setTimeout(g,0,E)},f.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var y=new Array(arguments.length-1),T=0;T<y.length;T++)y[T]=arguments[T+1];var w={callback:E,args:y};return h[u]=w,a(u),u++},f.clearImmediate=m}function m(E){delete h[E]}function g(E){if(p)setTimeout(g,0,E);else{var y=h[E];if(y){p=!0;try{(function(T){var w=T.callback,S=T.args;switch(S.length){case 0:w();break;case 1:w(S[0]);break;case 2:w(S[0],S[1]);break;case 3:w(S[0],S[1],S[2]);break;default:w.apply(n,S)}})(y)}finally{m(E),p=!1}}}}function b(E){E.source===i&&typeof E.data=="string"&&E.data.indexOf(l)===0&&g(+E.data.slice(l.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var jD=Bl((QJ,MD)=>{(function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(s,r){return s<<r|s>>>32-r},rotr:function(s,r){return s<<32-r|s>>>r},endian:function(s){if(s.constructor==Number)return t.rotl(s,8)&16711935|t.rotl(s,24)&4278255360;for(var r=0;r<s.length;r++)s[r]=t.endian(s[r]);return s},randomBytes:function(s){for(var r=[];s>0;s--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(s){for(var r=[],i=0,n=0;i<s.length;i++,n+=8)r[n>>>5]|=s[i]<<24-n%32;return r},wordsToBytes:function(s){for(var r=[],i=0;i<s.length*32;i+=8)r.push(s[i>>>5]>>>24-i%32&255);return r},bytesToHex:function(s){for(var r=[],i=0;i<s.length;i++)r.push((s[i]>>>4).toString(16)),r.push((s[i]&15).toString(16));return r.join("")},hexToBytes:function(s){for(var r=[],i=0;i<s.length;i+=2)r.push(parseInt(s.substr(i,2),16));return r},bytesToBase64:function(s){for(var r=[],i=0;i<s.length;i+=3)for(var n=s[i]<<16|s[i+1]<<8|s[i+2],a=0;a<4;a++)i*8+a*6<=s.length*8?r.push(e.charAt(n>>>6*(3-a)&63)):r.push("=");return r.join("")},base64ToBytes:function(s){s=s.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],i=0,n=0;i<s.length;n=++i%4)n!=0&&r.push((e.indexOf(s.charAt(i-1))&Math.pow(2,-2*n+8)-1)<<n*2|e.indexOf(s.charAt(i))>>>6-n*2);return r}};MD.exports=t})()});var jb=Bl((eK,FD)=>{var Mb={utf8:{stringToBytes:function(e){return Mb.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(Mb.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],s=0;s<e.length;s++)t.push(e.charCodeAt(s)&255);return t},bytesToString:function(e){for(var t=[],s=0;s<e.length;s++)t.push(String.fromCharCode(e[s]));return t.join("")}}};FD.exports=Mb});var GD=Bl((tK,HD)=>{HD.exports=function(e){return e!=null&&(UD(e)||pM(e)||!!e._isBuffer)};function UD(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function pM(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&UD(e.slice(0,0))}});var VD=Bl((sK,YD)=>{(function(){var e=jD(),t=jb().utf8,s=GD(),r=jb().bin,i=function(n,a){n.constructor==String?a&&a.encoding==="binary"?n=r.stringToBytes(n):n=t.stringToBytes(n):s(n)?n=Array.prototype.slice.call(n,0):!Array.isArray(n)&&n.constructor!==Uint8Array&&(n=n.toString());for(var o=e.bytesToWords(n),c=n.length*8,l=1732584193,u=-271733879,h=-1732584194,p=271733878,d=0;d<o.length;d++)o[d]=(o[d]<<8|o[d]>>>24)&16711935|(o[d]<<24|o[d]>>>8)&4278255360;o[c>>>5]|=128<<c%32,o[(c+64>>>9<<4)+14]=c;for(var f=i._ff,m=i._gg,g=i._hh,b=i._ii,d=0;d<o.length;d+=16){var E=l,y=u,T=h,w=p;l=f(l,u,h,p,o[d+0],7,-680876936),p=f(p,l,u,h,o[d+1],12,-389564586),h=f(h,p,l,u,o[d+2],17,606105819),u=f(u,h,p,l,o[d+3],22,-1044525330),l=f(l,u,h,p,o[d+4],7,-176418897),p=f(p,l,u,h,o[d+5],12,1200080426),h=f(h,p,l,u,o[d+6],17,-1473231341),u=f(u,h,p,l,o[d+7],22,-45705983),l=f(l,u,h,p,o[d+8],7,1770035416),p=f(p,l,u,h,o[d+9],12,-1958414417),h=f(h,p,l,u,o[d+10],17,-42063),u=f(u,h,p,l,o[d+11],22,-1990404162),l=f(l,u,h,p,o[d+12],7,1804603682),p=f(p,l,u,h,o[d+13],12,-40341101),h=f(h,p,l,u,o[d+14],17,-1502002290),u=f(u,h,p,l,o[d+15],22,1236535329),l=m(l,u,h,p,o[d+1],5,-165796510),p=m(p,l,u,h,o[d+6],9,-1069501632),h=m(h,p,l,u,o[d+11],14,643717713),u=m(u,h,p,l,o[d+0],20,-373897302),l=m(l,u,h,p,o[d+5],5,-701558691),p=m(p,l,u,h,o[d+10],9,38016083),h=m(h,p,l,u,o[d+15],14,-660478335),u=m(u,h,p,l,o[d+4],20,-405537848),l=m(l,u,h,p,o[d+9],5,568446438),p=m(p,l,u,h,o[d+14],9,-1019803690),h=m(h,p,l,u,o[d+3],14,-187363961),u=m(u,h,p,l,o[d+8],20,1163531501),l=m(l,u,h,p,o[d+13],5,-1444681467),p=m(p,l,u,h,o[d+2],9,-51403784),h=m(h,p,l,u,o[d+7],14,1735328473),u=m(u,h,p,l,o[d+12],20,-1926607734),l=g(l,u,h,p,o[d+5],4,-378558),p=g(p,l,u,h,o[d+8],11,-2022574463),h=g(h,p,l,u,o[d+11],16,1839030562),u=g(u,h,p,l,o[d+14],23,-35309556),l=g(l,u,h,p,o[d+1],4,-1530992060),p=g(p,l,u,h,o[d+4],11,1272893353),h=g(h,p,l,u,o[d+7],16,-155497632),u=g(u,h,p,l,o[d+10],23,-1094730640),l=g(l,u,h,p,o[d+13],4,681279174),p=g(p,l,u,h,o[d+0],11,-358537222),h=g(h,p,l,u,o[d+3],16,-722521979),u=g(u,h,p,l,o[d+6],23,76029189),l=g(l,u,h,p,o[d+9],4,-640364487),p=g(p,l,u,h,o[d+12],11,-421815835),h=g(h,p,l,u,o[d+15],16,530742520),u=g(u,h,p,l,o[d+2],23,-995338651),l=b(l,u,h,p,o[d+0],6,-198630844),p=b(p,l,u,h,o[d+7],10,1126891415),h=b(h,p,l,u,o[d+14],15,-1416354905),u=b(u,h,p,l,o[d+5],21,-57434055),l=b(l,u,h,p,o[d+12],6,1700485571),p=b(p,l,u,h,o[d+3],10,-1894986606),h=b(h,p,l,u,o[d+10],15,-1051523),u=b(u,h,p,l,o[d+1],21,-2054922799),l=b(l,u,h,p,o[d+8],6,1873313359),p=b(p,l,u,h,o[d+15],10,-30611744),h=b(h,p,l,u,o[d+6],15,-1560198380),u=b(u,h,p,l,o[d+13],21,1309151649),l=b(l,u,h,p,o[d+4],6,-145523070),p=b(p,l,u,h,o[d+11],10,-1120210379),h=b(h,p,l,u,o[d+2],15,718787259),u=b(u,h,p,l,o[d+9],21,-343485551),l=l+E>>>0,u=u+y>>>0,h=h+T>>>0,p=p+w>>>0}return e.endian([l,u,h,p])};i._ff=function(n,a,o,c,l,u,h){var p=n+(a&o|~a&c)+(l>>>0)+h;return(p<<u|p>>>32-u)+a},i._gg=function(n,a,o,c,l,u,h){var p=n+(a&c|o&~c)+(l>>>0)+h;return(p<<u|p>>>32-u)+a},i._hh=function(n,a,o,c,l,u,h){var p=n+(a^o^c)+(l>>>0)+h;return(p<<u|p>>>32-u)+a},i._ii=function(n,a,o,c,l,u,h){var p=n+(o^(a|~c))+(l>>>0)+h;return(p<<u|p>>>32-u)+a},i._blocksize=16,i._digestsize=16,YD.exports=function(n,a){if(n==null)throw new Error("Illegal argument "+n);var o=e.wordsToBytes(i(n,a));return a&&a.asBytes?o:a&&a.asString?r.bytesToString(o):e.bytesToHex(o)}})()});var U0=Ei(Vi());var pw="3.1.49",fw="10/27/2025";var fe={autoTrimSilkscreen:!0,bomManage:void 0,logoutClearAll:void 0,HelpURL:void 0,bomUsedAttrs:void 0,contentData:void 0,currentprojectType:"SCH",ui_instance:!0,ui_module:!0,prjOpenSyncTimeout:100,leftTreeActiveTab:"pages",cacheWorker:void 0,messageBus:void 0,windowBridge:void 0,tabId:void 0,schematicUuid:void 0,sheetUniqueNumber:void 0,sessionStorageTabs:void 0,viewframe:void 0,selectBox1:void 0,gControlDots:void 0,gControlRects:void 0,gControlLines:void 0,gCanvas:void 0,doctype:void 0,cmdToken:"",stopFind:!1,gZoom:1,isReadOnlyMode:!1,zoomRatio:{min:20,max:1e5},layoutCache:void 0,currZoom:100,svgRoot:void 0,activeElement:void 0,helperCursor:void 0,schToolBarSymbol:void 0,privateSheets:void 0,projectSheets:void 0,localStorageDisabled:void 0,defaultImage:{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA1MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSIxIiB5PSIxIiB3aWR0aD0iNDgiIGhlaWdodD0iMzgiIGZpbGw9IiNGRkYiIHN0cm9rZT0iI0NDQyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBvbHlsaW5lIHBvaW50cz0iMS41LDIzLDE2LDEzLDM0LDI2LDQ4LjUsMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0NDQyIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMzUiIGN5PSIxMiIgcj0iNCIgZmlsbD0iI0NDQyIgc3Ryb2tlPSJub25lIi8+PC9zdmc+",width:50,height:40},emojiReg:/[^\u0020-\u007E\u00A0-\u00BE\u2E80-\uA4CF\uF900-\uFAFF\uFE30-\uFE4F\uFF00-\uFFEF\u0080-\u009F\u2000-\u201f\u2026\u2022\u20ac\r\n]/g,normalCodeReg:/[\u4e00-\u9fa50-9A-Za-z]/,drawing:void 0,loading:void 0,userAvatar:void 0,loginHandle:void 0,isMouseOnEditFrame:!1,hoverCache:void 0,contextmenuDisableOnce:void 0,gRecover:void 0,helperCursorConfig:{},hasRuler:!0,flipBoard:!1,eventFn:void 0,isNewEditorToSaving:!1,cloneObjects:void 0,symbolParam:void 0,checkNotificationInterval:12e4,checkUpdateInterval:36e5,saveFileTimeout:3e5,autoSaveMaxCount:1e3,autoSaveMaxBackupLevel:10,autoGzipAjaxPostSize:1e4,version:"V"+pw,buildDate:fw,ignoreConfirmClose:!1,globalVariableCookieData:{},teams:[],multiSelect:!1,isSaving:!1,pasteCount:0,pasteFrom:null,canvasStrTolerance:10,cmdFromUserCenter:{saveAsLocal:!1,saveAsCloud:!1},systemAttrs:void 0,symbolGrid:null,ToolAttrs:[],hideAttrObj:{},currentProject:{projectId:void 0,title:void 0,isCBB:void 0,branchUuid:void 0},previousProject:{projectId:void 0,title:void 0,isCBB:void 0},team_id:"",org_id:"",selectableObjMap:void 0,copySheets:[],copySchematics:[],autoSaveTimer:void 0,autoBackupTimer:void 0,isCBB:void 0,lastActionTime:void 0,bomGrid:void 0,bomGridSelectGroup:void 0,customDeviceHeaderGrid:void 0,hasForceCloseBottomBar:!1,isForceClosePlaceDeviceDialog:!1,profileSetting:null,panelGridSize:null,profileCatgory:{},globalKeyCodeCache:[],globalKeyCodeStorage:[],defaultFont:null,deviceType:null,differentailPairCache:null};var Ev=Object.create,q1=Object.defineProperty,bv=Object.getOwnPropertyDescriptor,Tv=Object.getOwnPropertyNames,wv=Object.getPrototypeOf,Sv=Object.prototype.hasOwnProperty,jl=(e=>typeof wr<"u"?wr:typeof Proxy<"u"?new Proxy(e,{get:(t,s)=>(typeof wr<"u"?wr:t)[s]}):e)(function(e){if(typeof wr<"u")return wr.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),_v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Av=(e,t)=>{for(var s in t)q1(e,s,{get:t[s],enumerable:!0})},Cv=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Tv(t))!Sv.call(e,i)&&i!==s&&q1(e,i,{get:()=>t[i],enumerable:!(r=bv(t,i))||r.enumerable});return e},sd=(e,t,s)=>(s=e!=null?Ev(wv(e)):{},Cv(t||!e||!e.__esModule?q1(s,"default",{value:e,enumerable:!0}):s,e)),rd=_v((e,t)=>{"use strict";var s=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(A,N)=>{for(var Y in N)s(A,Y,{get:N[Y],enumerable:!0})},o=(A,N,Y,z)=>{if(N&&typeof N=="object"||typeof N=="function")for(let U of i(N))!n.call(A,U)&&U!==Y&&s(A,U,{get:()=>N[U],enumerable:!(z=r(N,U))||z.enumerable});return A},c=A=>o(s({},"__esModule",{value:!0}),A),l={};a(l,{BroadcastChannelMessageBus:()=>Be,MessageBus:()=>Oe,MessageBus2:()=>ae,MessageBusTask:()=>Pe,MessageBusTask2:()=>ie,WindowMessageBridge:()=>Ee,WorkerMessageBridge:()=>me,createBroadcastP2PStream:()=>gt,createBufferedByteBufferStream:()=>Xe,createBufferedStream:()=>je,createBufferedStringStream:()=>ke,dropP2PStream:()=>it,flowRead:()=>Ds,flowWrite:()=>as}),t.exports=c(l);var u=class{constructor(A=1.5){this.growthFactor=A,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(A){if(this.count===this.capacity){let N=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,N);let Y=new Array(N);for(let z=0;z<this.count;z++)Y[z]=this.buffer[(this.head+z)%this.capacity];this.buffer=Y,this.head=0,this.tail=this.count,this.capacity=N}this.buffer[this.tail]=A,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let A=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,A}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},h=new ArrayBuffer(8),p=new Float64Array(h),d=new Uint32Array(h),f=new Uint16Array(h),m=ArrayBuffer;try{m=self.HTMLImageElement||m}catch{}var g=typeof SharedArrayBuffer<"u";function b(A){if(typeof A!="object"||A===null||A instanceof Date||A instanceof ArrayBuffer||g&&A instanceof SharedArrayBuffer||A instanceof Blob||A instanceof FormData||A instanceof Function||A instanceof Uint8ClampedArray||A instanceof m)return A;if(Array.isArray(A))return A.map(b);{let N={};for(let Y in A)Object.hasOwnProperty.call(A,Y)&&(N[Y]=b(A[Y]));return N}}function E(A,N){return y(A,N,()=>[])}function y(A,N,Y){let z=A[N];return z!==void 0||(z=Y(N),A[N]=z),z}function T(A,N){if(Array.isArray(A)){for(let Y=0,z=A.length;Y<z;Y++)if(N(void 0,A[Y],Y)===!1)return}else{let Y=0;for(let z in A)if(A.hasOwnProperty(z)){let U=A[z];if(N(z,U,Y)===!1)return;Y++}}}var w=Object.prototype.hasOwnProperty;async function S(A,N){if(Array.isArray(A)){for(let Y=0,z=A.length;Y<z;Y++)if(await N(void 0,A[Y],Y)===!1)return}else{let Y=0;for(let z in A)if(w.call(A,z)){let U=A[z];if(await N(z,U,Y)===!1)return;Y++}}}function _(A,N,Y){return typeof A=="string"&&(/https?:/.test(A)||(A=location.origin+A)),Promise.race([fetch(A,N),new Promise((z,U)=>setTimeout(U,Y))])}function C(A,N){let Y=0,z=0;return(...U)=>{let Z=++Y;setTimeout(()=>{let J=performance.now();if(Z===Y||J-z>=A){try{N(...U)}catch(ne){console.log(ne)}z=J}},Math.max(0,A-(performance.now()-z)))}}function x(A,N){let Y=A.length,z=0;for(;z<Y;){let U=A.indexOf(`
`,z);U<0&&(U=Y);let Z=A.substring(z,U);try{if(N(Z)===!1)return}catch(J){console.error(J)}z=U+1}}function D(A){let N=null;return()=>(N===null&&(N=A()),N)}var I=0;function P(){I===0&&(I=Date.now()-performance.now());let A=new Array,N=I+performance.now();p[0]=N,A.push(d[1].toString(16)),p[0]=Math.random(),A.push(f[3].toString(16));let Y=f[2].toString(16);A.push("4"+Y.substr(0,3)),p[0]=N;let z=d[0].toString(16)+d[1].toString(16);return A.push("0"+z.substr(0,3)),A.push(z.substr(3)),A.join("-")}var L=class{constructor(A){this.maxResources=A,this.idle=new u,this.isClosed=!1,this.resources=A}acquire(A){this.isClosed?Promise.resolve(!1).then(A):this.resources>0?(this.resources--,Promise.resolve(!0).then(A)):this.idle.enqueue(A)}acquireSync(){return new Promise(A=>{this.acquire(A)})}release(){if(!this.isClosed){let A=this.idle.dequeue();A?Promise.resolve(!0).then(A):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let A=this.idle.dequeue();Promise.resolve(!1).then(A)}}};function F(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function V(A,N,Y){let z=A.length+N-1;for(let U=0;U<z;U++){let Z=new Array;for(let J=U-N+1;J<=U;J++)Z.push(A[J]);if(Y(Z)===!1)break}}function B(){let A=new Date,N=A.getFullYear(),Y=A.getMonth()+1,z=A.getDate(),U=A.getHours(),Z=A.getMinutes(),J=A.getSeconds(),ne=A.getMilliseconds();return"["+N+"-"+(Y<10?"0"+Y:Y)+"-"+(z<10?"0"+z:z)+" "+(U<10?"0"+U:U)+":"+(Z<10?"0"+Z:Z)+":"+(J<10?"0"+J:J)+"."+(ne<100?ne<10?"00"+ne:"0"+ne:ne)+"] "}function k(A){return new Promise(N=>setTimeout(N,A))}function O(A,N){let Y=0,z=A.length;for(let U=0;U<z;U++)A[U]===N&&(A.splice(U,1),U--,z--,Y++);return Y}var R=F(),v=R.WeakRef||(A=>A);function j(A){if(A!=null){if(typeof A=="object")return new v(A);console.error(A,A instanceof Object,typeof A);return}}function M(A){return A==null?void 0:A.deref()}var H="_MSG_BUS_RPC_",q=300*1e3,Q=(A=>(A.PUBLISH="publish",A.SUBSCRIBE="subscribe",A.PUSH="push",A.PULL="pull",A))(Q||{}),oe=class{constructor(A){this.bus=A}processRemoteMessage(A,N){let Y=j(N),z=A.topic,U=A.type,Z=A.message;switch(U){case"pull":this.bus.pull(z,J=>{this.push(z,J,M(Y))});break;case"subscribe":this.bus.subscribe(z,J=>{this.publish(z,J,M(Y))});break;case"publish":this.bus.publish(z,Z,this,M(Y));break;case"push":this.bus.push(z,Z,this,M(Y));break;default:console.debug("unknown message type "+U)}}rpcCall(A,N,Y,z=q){let U=j(Y),Z=new Promise(J=>{let ne=this.bus.uniqueRpcTopic(A);this.publish(A,{message:N,reply:ne},M(U)),this.bus.pull(ne,(ue,Ie,Ue)=>{J({message:ue,bridge:Ie,source:j(Ue)})})});return z>0?Promise.race([Z,new Promise((J,ne)=>{setTimeout(ne,z)})]):Z}},me=class extends oe{constructor(A,N){super(A),this.worker=N,N.onmessage=Y=>{this.processRemoteMessage(Y.data,void 0)}}publish(A,N){this.postMessage(A,"publish",N)}subscribe(A){this.postMessage(A,"subscribe",null)}push(A,N){this.postMessage(A,"push",N)}pull(A){this.postMessage(A,"pull",null)}rpcCall(A,N,Y=q){return super.rpcCall(A,N,void 0,Y)}postMessage(A,N,Y){let z={topic:A,type:N,message:Y};this.worker.postMessage(z)}discard(){this.worker.terminate()}},Ee=class extends oe{constructor(A){super(A),window.addEventListener("message",N=>{this.processRemoteMessage(N.data,N.source)},!1)}publish(A,N,Y){this.postMessage(A,"publish",N,Y)}subscribe(A,N){if(N===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(A,"subscribe",null,N)}push(A,N,Y){this.postMessage(A,"push",N,Y)}pull(A,N){if(N===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(A,"pull",null,N)}postMessage(A,N,Y,z){let U={topic:A,type:N,message:Y};z&&z.postMessage(U,"*")}},Pe=class{constructor(A){this.isRunning=!0,this.callback=A}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(A,N,Y,z){try{A=z?A:b(A),this.callback(A,N,Y)}catch(U){console.error(U)}}},Oe=class{constructor(A=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=A}uniqueRpcTopic(A){return`${H}-${A}-${this.uuid}-${this.rpcTicket++}`}publish(A,N,Y,z){let U=this.subscribed[A];if(U){let Z;for(let J of U)J.running()?J.execute(N,Y,z,this.unsafe):(Z=Z||new Array,Z.push(J));if(Z)for(let J of Z)O(U,J)}else console.debug("no sub on topic: "+A)}subscribe(A,N){let Y=new Pe(N);return E(this.subscribed,A).push(Y),Y}push(A,N,Y,z){let U=!1,Z=this.pulled[A];if(Z){for(;Z.length>0;){let J=Z.shift();if(J.running()){J.execute(N,Y,z,this.unsafe),U=!0;break}}Z.length===0&&delete this.pulled[A]}U||E(this.pushed,A).push({message:N,bridge:Y,source:j(z)})}pull(A,N){let Y=new Pe(N),z=this.pushed[A];if(z){let U=z.shift();Y.execute(U.message,U.bridge,M(U.source),this.unsafe),z.length===0&&delete this.pushed[A]}else E(this.pulled,A).push(Y);return Y}pullA(A){return new Promise(N=>{this.pull(A,(Y,z,U)=>{N({message:Y,bridge:z,source:j(U)})})})}rpcService(A,N){this.subscribe(A,(Y,z,U)=>{let{message:Z,reply:J}=Y;try{let ne=N(Z);if(ne instanceof Promise){let ue=j(U);ne.then(Ie=>{this.rpcReply(Ie,J,z,M(ue))},Ie=>{console.error(Ie),this.rpcReply(void 0,J,z,M(ue))})}else this.rpcReply(ne,J,z,U)}catch(ne){console.error(ne),this.rpcReply(void 0,J,z,U)}})}rpcCall(A,N,Y=q){let z=new Promise(U=>{let Z=this.uniqueRpcTopic(A);this.publish(A,{message:N,reply:Z}),this.pull(Z,(J,ne,ue)=>{U({message:J,bridge:ne,source:j(ue)})})});return Y>0?Promise.race([z,new Promise((U,Z)=>{setTimeout(Z,Y)})]):z}rpcReply(A,N,Y,z){Y?Y.push(N,A,z):this.push(N,A)}},Fe="_MSG_BUS_RPC_";function G(A,N){let Y=0,z=A.length;for(let U=0;U<z;U++)A[U]===N&&(A.splice(U,1),U--,z--,Y++);return Y}function pe(A,N){return ge(A,N,()=>[])}function ge(A,N,Y){let z=A[N];return z!==void 0||(z=Y(N),A[N]=z),z}var ie=class{constructor(A,N){this.callback=A,this.unsafe=N,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(A){try{A=this.unsafe?A:b(A),this.callback(A)}catch(N){console.error(N)}}},$=class{constructor(A=crypto.randomUUID()){this.uuid=A,this.rpcTicket=0}subscribeOnce(A,N){let Y=this.subscribe(A,z=>{Y.cancel(),N(z)});return Y}pullA(A){return new Promise(N=>{this.pull(A,N)})}rpcService(A,N){let Y=z=>{try{let{message:U,replyTopic:Z}=z;try{let J=N(U);J instanceof Promise?J.then(ne=>{this.publish(Z,{success:!0,result:ne})}).catch(ne=>{console.error(ne),this.publish(Z,{success:!1,err:String(ne)})}):this.publish(Z,{success:!0,result:J})}catch(J){this.publish(Z,{success:!1,err:String(J)})}}finally{this.pull(A,Y)}};this.pull(A,Y)}rpcCall(A,N,Y=0){let z=new Promise((U,Z)=>{let J=`${Fe}-${A}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(J,ne=>{ne.success?U(ne.result):Z(new Error(ne.err))}),this.push(A,{message:N,replyTopic:J})});return Y>0?Promise.race([z,new Promise((U,Z)=>{setTimeout(Z,Y)})]):z}},ae=class extends ${constructor(A=!1){super(),this.unsafe=A,this.subscribed={},this.pulled={},this.pushed={}}publish(A,N){let Y=this.subscribed[A];if(Y){let z;for(let U of Y)U.running()?U.execute(N):(z=z||new Array,z.push(U));if(z)for(let U of z)G(Y,U)}}subscribe(A,N){let Y=new ie(N,this.unsafe);return pe(this.subscribed,A).push(Y),Y}push(A,N){let Y=!1,z=this.pulled[A];if(z){for(;z.length>0;){let U=z.shift();if(U&&U.running()){U.execute(N),Y=!0;break}}z.length===0&&delete this.pulled[A]}Y||pe(this.pushed,A).push(N)}pull(A,N){let Y=new ie(N,this.unsafe);return this.repull(A,Y),Y}repull(A,N){let Y=this.pushed[A];if(Y){let z=Y.shift();z&&(N.execute(z),Y.length===0&&delete this.pushed[A])}else pe(this.pulled,A).push(N)}},ye=class extends ${constructor(A=crypto.randomUUID()){super(A),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(A,N){console.debug("BC",this.uuid,"PUBLISH",A,N),this.broadcastPublish(A,N)}subscribe(A,N){console.debug("BC",this.uuid,"SUBSCRIBE",A);let Y=new ie(N,!0);return pe(this.subscribed,A).push(Y),Y}push(A,N){let Y=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",A,`(${Y})`,N),pe(this.pushed,A).push({id:Y,message:N}),this.broadcastPushedHeadMessage(A)}pull(A,N){console.debug("BC",this.uuid,"PULL",A);let Y=new ie(N,!0);return pe(this.pulled,A).push(Y),this.broadcastWhoHas(A),Y}broadcastPushedHeadMessage(A){let N=this.pushed[A];N&&N[0]&&this.broadcastIHave(A,N[0].id)}onReceivedPublish(A,N,Y){console.debug("BCMSG(",this.uuid,")","from",A,"PUBLISH",N,"message",Y);let z=this.subscribed[N];if(z){let U;for(let Z of z)Z.running()?Z.execute(Y):(U=U||new Array,U.push(Z));if(U)for(let Z of U)G(z,Z);z.length===0&&delete this.subscribed[N]}}onReceivedWhoHas(A,N){console.debug("BCMSG(",this.uuid,")","from",A,"WHOHAS",N),this.broadcastPushedHeadMessage(N)}onReceivedIHave(A,N,Y){console.debug("BCMSG(",this.uuid,")","from",A,"IHAVE",N,"id",Y);let z=this.pulled[N];if(z){let U;for(let Z of z)if(Z.running()){this.broadcastINeed(N,A,Y);break}else U=U||new Array,U.push(Z);if(U)for(let Z of U)G(z,Z);z.length===0&&delete this.pulled[N]}}onReceivedINeed(A,N,Y,z){if(console.debug("BCMSG(",this.uuid,")","from",A,"INEED",N,"source",Y,"id",z),this.uuid===Y){let U=this.pushed[N];if(U&&U[0]&&U[0].id===z){let{message:Z}=U.shift();this.broadcastIGive(N,z,A,Z),this.broadcastPushedHeadMessage(N),U.length===0&&delete this.pushed[N]}}}onReceivedIGive(A,N,Y,z,U){console.debug("BCMSG(",this.uuid,")","from",A,"IGIVE",N,"id",Y,"target",z,"message",U);let Z=this.pulled[N];if(Z&&this.uuid===z){let J=!1;for(;Z.length>0;){let ne=Z.shift();if(ne.running()){ne.execute(U),J=!0;break}}J||this.push(N,U),Z.length===0&&delete this.pulled[N]}}},Be=class extends ye{constructor(A,N=crypto.randomUUID()){super(N),this.bc=new BroadcastChannel(A),this.bc.onmessage=Y=>{this.onMessage(Y.data)}}onMessage(A){let{type:N,uuid:Y,topic:z}=A;switch(N){case"PUBLISH":{let{message:U}=A;this.onReceivedPublish(Y,z,U);break}case"WHOHAS":{this.onReceivedWhoHas(Y,z);break}case"IHAVE":{let{id:U}=A;this.onReceivedIHave(Y,z,U);break}case"INEED":{let{source:U,id:Z}=A;this.onReceivedINeed(Y,z,U,Z);break}case"IGIVE":{let{target:U,id:Z,message:J}=A;this.onReceivedIGive(Y,z,Z,U,J);break}default:console.warn("unsupported",A)}}broadcastPublish(A,N){this.post({type:"PUBLISH",uuid:this.uuid,topic:A,message:N})}broadcastWhoHas(A){this.post({type:"WHOHAS",uuid:this.uuid,topic:A})}broadcastIHave(A,N){this.post({type:"IHAVE",uuid:this.uuid,topic:A,id:N})}broadcastINeed(A,N,Y){this.post({type:"INEED",uuid:this.uuid,topic:A,source:N,id:Y})}broadcastIGive(A,N,Y,z){this.post({type:"IGIVE",uuid:this.uuid,topic:A,id:N,target:Y,message:z})}post(A){this.bc.postMessage(A),Promise.resolve().then(()=>{this.onMessage(A)})}},be=Symbol("BLOCKING_QUEUE_RESET"),xe=class{constructor(A,N=()=>1){if(this.maxSize=A,this.itemSizeOf=N,this.queue=new u,this.waitingConsumers=new u,this.waitingProducers=new u,this.queueSize=0,this.closePromise=null,this.closeResolve=null,A<=0)throw new Error("Max size must be greater than 0")}enqueue(A){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let N=await new Promise(Y=>{this.waitingProducers.enqueue(Y)});return console.debug("queue is not full",this.size(),N),N?(this.innerEnqueue(A),!0):!1})():(this.innerEnqueue(A),!0)}innerEnqueue(A){if(this.waitingConsumers.isEmpty())this.queue.enqueue(A),this.queueSize+=this.itemSizeOf(A),console.debug("queue pushed",A,"size",this.queueSize);else{let N=this.waitingConsumers.dequeue();Promise.resolve(A).then(N),console.debug("queue direct",A,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let A=this.waitingConsumers.dequeue();Promise.resolve(be).then(A)}return setTimeout(()=>this.closeResolve(),0),be}else return new Promise(A=>{this.waitingConsumers.enqueue(A)});else{let A=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(A),!this.waitingProducers.isEmpty()){let N=this.waitingProducers.dequeue();Promise.resolve(!0).then(N)}return A}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(A=>{for(this.closeResolve=A;!this.waitingProducers.isEmpty();){let N=this.waitingProducers.dequeue();Promise.resolve(!1).then(N)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let N=this.waitingConsumers.dequeue();Promise.resolve(be).then(N)}A()}})),this.closePromise}};function je(A,N,Y=Number.MAX_SAFE_INTEGER){let z=new xe(Y,N),U=new ReadableStream({pull(J){let ne=!0,ue=(async()=>{let Ie=new Array;do{let Ue=z.dequeue();if(Ue instanceof Promise){ne=!1;let Ye=await Ue;Ye===be?J.close():Ie.push(Ye)}else{let Ye=Ue;Ye===be?J.close():Ie.push(Ye)}}while(z.size()>0);if(Ie.length>0){let Ue=A(Ie);J.enqueue(Ue)}})();if(!ne)return console.debug("read stream stucked --------------------------------------"),ue},async cancel(){console.debug("buffered readable cancel"),await z.close()}}),Z=new WritableStream({write(J,ne){let ue=!0,Ie=(async()=>{let Ue=z.enqueue(J);typeof Ue=="boolean"?Ue||ne.error(new Error("Write stream closed")):(ue=!1,await Ue||ne.error(new Error("Write stream closed")))})();if(!ue)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),Ie},async close(){console.debug("buffered writable closing",z.size()),await z.close(),console.debug("buffered writable closed",z.size())},async abort(){console.debug("buffered writable aborting",z.size()),await z.close(),console.debug("buffered writable aborted",z.size())}});return{readable:U,writable:Z}}function ke(A=Number.MAX_SAFE_INTEGER){return je(N=>N.join(""),N=>N.length,A)}function Xe(A=Number.MAX_SAFE_INTEGER){return je(N=>{let Y=new Uint8Array(N.reduce((U,Z)=>U+Z.byteLength,0)),z=0;return N.forEach(U=>{Y.set(U,z),z+=U.byteLength}),Y},N=>N.byteLength,A)}function gt(A){return new Promise((N,Y)=>{let z=new BroadcastChannel(A),U=new xe(1),Z=new L(1),J=null,ne=!1,ue=!1,Ie=!1;z.onmessage=Ue=>{let Ye=Ue.data,{type:Qe}=Ye;if(console.debug("p2p",A,"type",Qe,"data",Qe==="DATA"&&Ye.data),Qe==="DATA")U.enqueue(Ye.data);else if(Qe==="HI"){if(!J){z.postMessage({type:"HI"});let Yr=0;J={rs:new ReadableStream({async pull(Or){let Ir=await U.dequeue();Ir===be?(await ar(),Or.close()):(Or.enqueue(Ir),z.postMessage({type:"ACK"}))},cancel(){return ar()}}),ws:new WritableStream({async write(Or,Ir){await Z.acquireSync()?z.postMessage({type:"DATA",id:Yr++,data:Or}):(ws(),Ir.error(new Error("Write stream closed")))},close(){ws()},abort(){ws()}})},N(J)}}else Qe==="REND"?J?Z.close():yi("REND1"):Qe==="WEND"?J?U.close():yi("WEND1"):Qe==="ACK"&&Z.release();function ws(){ne||(ne=!0,console.debug(A,"p2p write stream closed"),Z.close(),z.postMessage({type:"WEND"}),ue&&(console.debug(A,"p2p channel closed on ws"),z.close()))}async function ar(){ue||(ue=!0,console.debug(A,"p2p read stream closed"),z.postMessage({type:"REND"}),await U.close(),ne&&(console.debug(A,"p2p channel closed on rs"),z.close()))}async function yi(Yr){Ie||(Ie=!0,console.debug(A,"p2p channel connection released on",Yr),Z.close(),U.close(),J?(J.rs.locked||(console.debug(A,"p2p unlocked read stream direct cancel"),J.rs.cancel()),J.ws.locked||(console.debug(A,"p2p unlocked write stream direct close"),J.ws.close())):(z.postMessage({type:"HI"}),z.close()),Y(new Error("p2p channel connection released")))}},z.postMessage({type:"HI"})})}function it(A){return new Promise(N=>{let Y=new BroadcastChannel(A);Y.onmessage=z=>{let U=z.data,{type:Z}=U;Z==="HI"&&(Y.postMessage({type:"REND"}),Y.close(),N())},Y.postMessage({type:"REND"})})}async function Ve(A){try{return await gt(A)}catch(N){N.message!=="p2p channel connection released"&&console.error(N)}}async function as(A,N,Y=10*1024*1024,z=!0){let U=await Ve(A);if(!U)return!1;let Z=!1;try{let J,ne=ue=>{if(!J)if(!z)J=U.ws.getWriter();else if(typeof ue=="string"){let Ie=ke(Y);Ie.readable.pipeTo(U.ws),J=Ie.writable.getWriter()}else{let Ie=Xe(Y);Ie.readable.pipeTo(U.ws),J=Ie.writable.getWriter()}return J.write(ue)};if(Array.isArray(N))for(let ue of N)await ne(ue);else await N({write:ne,get desiredSize(){return((J==null?void 0:J.desiredSize)||0)+10}});J&&await J.close(),Z=!0}catch(J){console.error(J)}finally{return U.rs.cancel(),Z}}async function Ds(A,N){var z,U;let Y=await Ve(A);if(Y)try{let Z=Y.rs.getReader();for((z=N.start)==null?void 0:z.call(N);;){let{value:J,done:ne}=await Z.read();if(J!==void 0){let ue;if(N.update instanceof Promise?ue=await N.update(J):ue=N.update(J),ue){await Z.cancel();break}}if(ne){(U=N.end)==null||U.call(N);break}}}catch(Z){console.error(Z)}finally{Y.ws.close()}}}),Dv={UNAUTHORIZED:"Not logged in yet, please log in and try again",LOGIN_FAIL:"The login status is invalid",PERMISSION_DENIED:"No permission or project does not exist",PERMISSION_DENIED1:"No permission",PRJ_NOT_EXIST:"No permission or project does not exist",ERROR_PATH:"No permission or project does not exist",PROJECT_NOT_FOUND:"The project was not found",PERMISSION_DENIED_PARAMS:"No permission to operate {type}",DATA_NOT_FOUND:"Data not found",PARAMS_DATA_NOT_FOUND:"The {type} data was not found",REQUEST_PARAM_ILLEGAL:"Parameter error",REQUEST_PARAM_ILLEGAL1:"Parameter error",REQUEST_PARAMS_ILLEGAL2:"The {type} parameter request is incorrect",REQUEST_PARAMS_NOT_NULL:"The {type} parameter of the request cannot be empty",REQUEST_PARAMS_NOT_ALL_NULL:"The {type} parameter of the request cannot be empty simultaneously",REQUEST_PARAMS_MUST_ARRAY:"The request parameter {type} must be an array",REQUEST_PARAMS_MUST_STRING:"The request parameter {type} must be a string",REQUEST_PARAMS_MUST_NUMBER:"The request parameter {type} must be a number",REQUEST_PARAMS_MUST_NUMBER_ARRAY:"The request parameter {type} must be a numeric array",REQUEST_PARAMS_MUST_STRING_ARRAY:"The request parameter {type} must be a string array",REQUEST_PARAMS_LENGTH_ERROR:"The length of the request parameter {type} is incorrect",REQUEST_PARAMS_TYPE_ERROR:"The request parameter {type} is of incorrect type",ILLEGAL_NAME:'The name is illegal and contains illegal characters such as /:*?"<>|',ILLEGAL_NAME1:'The name is illegal and contains illegal characters such as /:*?"<>|',ILLEGAL_NAME_ZH:"The name cannot contain Chinese characters",UUID_ERROR:"uuid error",DUPLICATE_DATA:"Duplicate title",DUPLICATE_DATA1:"Library duplicate name",DUPLICATE_DATA_PARAMS:"{type} Duplicate data",UPLOAD_LIMIT:"Document {documentName} size over 15MB, it is too big to save in the server, please modify and then try again.",MORE_THAN_LIMIT:"Exceed the maximum limit",FILE_MORE_THAN_LIMIT:"Exceed the maximum upload limit of {type}",PARAMS_MORE_THAN_LIMIT:"Exceed the maximum upload limit of the parameter {type}",IMAGE_MORE_THAN_LIMIT_PARAMS:"The picture exceeds the maximum upload limit",FILE_MORE_THAN_LIMIT_PARAMS:"The file exceeds the maximum upload limit",END_MUST_AFTER_START:"The start time cannot be later than the end time",FILE_READ_ONLY:"The project file eprj or library file elib property was set as read only, please enable the read only property at File Manager and try again, and contact with support",FILE_READ_ONLY1:"The project file eprj or library file elib property was set as read only, please enable the read only property at File Manager and try again, and contact with support",DATA_NOT_EXIST:"document {documentName} not exists",REQUEST_PARAMS_TIME_ERROR:"The time request parameter is incorrect",FILES_PATH_NOT_FOUND:"The file address cannot be found",FILES_DATA_NOT_FOUND:"The file data cannot be found",FILES_TYPE_ERROR:"File type error",FILES_TYPE_MUST_BE_ONE:"The file type must be {type}",SET_WATERMARK_FAIL:"Watermark setting failed",MYSQL_CRUD_ERROR:"{type} data execution failed. Please contact technical support for resolution",PARAMS_JSON_FAILED:"{type} data parsing failed",MYSQL_ERROR:"Database operation anomaly",NOT_FOUND:"The request does not exist",PRJ_NAME_EXISTS:"The name of the project already exists",BACKUP_NAME_EXISTS:"Backup Name already exists",TITLE_ILLEGAL_LEN:"The {documentName} length must be 1~128 bytes!",LIB_NOT_EXIST:"The component library does not exist",CONFIG_API_URLS_ERROR:"Real-time prices and inventory are not enabled. Please contact the administrator",ONE_CLICK_ORDER_NOT_OPEN:"The order placement function is not enabled. Please contact the administrator",MATERIAL_NOT_OPEN:"The material warehouse is not open. Please contact the administrator",SNAPSHOT_DEPTH_LIMIT:"There is a snapshot near the latest node or the snapshot has been applied for",OCR_SYMBOL_URL_ERROR:"The OCR request address is not configured",USER_DATA_NOT_FOUND:"The user does not exist",USER_DISABLE_ERROR:"The account has been deactivated",USER_EXISTS_LOGIN_ERROR:"The user has logged in elsewhere",USER_UNAUTHORIZED_MODULES_ERROR:"This account has not authorized the module",USER_UNAUTHORIZED_ACCESS_ERROR:"Access type error",ADMIN_NOT_CHANGE_PASSWORD:"The super administrator cannot reset the password",SAME_PASSWORD_NEW_PASSWORD:"The original password is the same as the new one",USER_ONLINE_REGISTRATION_FAILED:"The registration of the user online failed",USER_PASSWORD_CAN_NOT_DEFAULT:"The default password cannot be used",USER_BEFORE_PASSWORD_ERROR:"The original password is incorrect",USER_PASSWORD_LENGTH_ERROR:"The password length is 8 to 255 characters",ORG_ROLE_NOT_CREATE:"System roles cannot be created. Please make the necessary modifications",ORG_ROLE_NAME_DUPLICATE:"The character name already exists. Please modify it",ORG_ROLE_ORIGIN_ERROR:"Unknown character source {message}",ORG_ROLE_NOT_DEFAULT:"This character is not a preset one and cannot be operated",ADMIN_ROLE_NOT_CHANGE:"Administrator privileges do not allow for modification",ADMIN_NOT_CHANGE_STATUS:"The admin account cannot change its status",PROJECT_ARCHIVED:"The project has been locked",PROJECT_UUID_NULL:"The project uuid cannot be empty",PROJECT_UUID_ERROR:"uuid error or the project uuid already exists",PROJECT_OR_TEAM_UUID_ERROR:"The project uuid is incorrect or the team uuid already exists",PROJECT_NOT_PERSON_ERROR:"Personal projects are not allowed to be created",PROJECT_DUPLICATE_NAME:"Duplicate title",ANNOTATION_HAS_BE_FOUND:"The annotation has been created",ANNOTATION_NOT_FOUND:"The annotation block does not exist",ANNOTATION_CREATE_ERROR:"The annotation block creation failed",ANNOTATION_UPDATE_ERROR:"The update of the annotation block failed",ANNOTATION_DELETE_ERROR:"The annotation failed to be deleted",PROJECT_DUPLICATE_PATH:"The same path cannot be created",TEAM_NOT_FOUND:"The team does not exist",TEAM_UUID_NULL:"The team uuid cannot be empty",TEAM_FOLDER_ERROR:"The parent folder does not exist or does not belong to the current team",TEAM_FOLDER_UUID_ERROR:"The folder uuid is incorrect or the project uuid already exists",TEAM_URL_DUPLICATE:"Team link repetition",TEAM_CAN_NOT_DELETE:"There are still projects in the team. Please transfer or delete them first",COMPONENT_UUID_NULL:"The uuid of a component cannot be empty",COMPONENT_DATA_NOT_FOUND:"The component library data does not exist",COMPONENT_NAME_DUPLICATE:"Component libraries cannot have the same name",COMPONENT_TYPE_ERROR:"Library type error",DELETE_SON_CATEGORY:"The subcategories need to be deleted first",LICENSE:"License not found",START_TIME:"The start time of the license is incorrect",END_TIME:"The end time of the license is incorrect",PROJECT_LIMIT:"The maximum number of projects has been reached",USER_LIMIT:"The maximum number of accounts has been reached",ONLINE_NUMBER_LIMIT:"The maximum number of online users has been reached",LIMIT_PCB:"The PCB authorization quota has been reached and the addition failed",LIMIT_SCH:"The schematic authorization number is full, and the addition failed",LIMIT_PANEL:"The panel authorization number is full and the addition failed",TIME_ERROR:"If the system time is incorrect, please restart the server or fix the system time. After fixing, the private service needs to be restarted",LICENSE_ERROR:"Authorization error",LICENSE_TYPE_ERROR:"The type of authorized application is incorrect",LICENSE_ORIGIN_ERROR:"Unknown authorized application {type}",BRANCH_DATA_NOT_FOUND:"There is no engineering branch",PARENT_UUID_ERROR:"parent uuid error",BRANCH_MUST_AFTER_NODE:"The branch must be after the node",BRANCH_NAME_ERROR:"Incorrect branch name",BRANCH_NAME_DUPLICATE:"The branch name already exists",BRANCH_UUID_ERROR:"The branch uuid is incorrect",BRANCH_NODE_SET_ERROR:"Nodes cannot be set as default branches or marked as master",BRANCH_DELETE_MAIN_ERROR:"Nodes or branches on the main branch cannot be deleted",BRANCH_CHECK_OUT_ERROR:"There are documents that have been checked out",DOCUMENT_UUID_ERROR:"The document uuid is incorrect",UPDATE_FAILED:"Update failed",INNER_API_KEY_ERROR:"The ApiKey of the internal interface of the server is incorrect",BRANCH_MORE_THAN_LIMIT:"The version exceeds the maximum limit",WORKSPACE_API_ERROR:"The workspace request response is abnormal"},Pv={UNAUTHORIZED:"\u5C1A\u672A\u767B\u5F55\uFF0C\u8BF7\u767B\u5F55\u540E\u518D\u8BD5",LOGIN_FAIL:"\u767B\u5F55\u72B6\u6001\u5F02\u5E38",PERMISSION_DENIED:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",PERMISSION_DENIED1:"\u6CA1\u6709\u6743\u9650",PRJ_NOT_EXIST:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",ERROR_PATH:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",PROJECT_NOT_FOUND:"\u5DE5\u7A0B\u672A\u627E\u5230",PERMISSION_DENIED_PARAMS:"\u6CA1\u6709\u6743\u9650\u64CD\u4F5C{type}",DATA_NOT_FOUND:"\u6570\u636E\u672A\u627E\u5230",PARAMS_DATA_NOT_FOUND:"{type}\u6570\u636E\u672A\u627E\u5230",REQUEST_PARAM_ILLEGAL:"\u53C2\u6570\u9519\u8BEF",REQUEST_PARAM_ILLEGAL1:"\u53C2\u6570\u9519\u8BEF",REQUEST_PARAMS_ILLEGAL2:"\u8BF7\u6C42{type}\u53C2\u6570\u9519\u8BEF",REQUEST_PARAMS_NOT_NULL:"\u8BF7\u6C42{type}\u53C2\u6570\u4E0D\u80FD\u4E3A\u7A7A",REQUEST_PARAMS_NOT_ALL_NULL:"\u8BF7\u6C42{type}\u53C2\u6570\u4E0D\u80FD\u540C\u65F6\u4E3A\u7A7A",REQUEST_PARAMS_MUST_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u7EC4",REQUEST_PARAMS_MUST_STRING:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u5B57\u7B26\u4E32",REQUEST_PARAMS_MUST_NUMBER:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u5B57",REQUEST_PARAMS_MUST_NUMBER_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u5B57\u6570\u7EC4",REQUEST_PARAMS_MUST_STRING_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u5B57\u7B26\u4E32\u6570\u7EC4",REQUEST_PARAMS_LENGTH_ERROR:"\u8BF7\u6C42\u53C2\u6570{type}\u957F\u5EA6\u9519\u8BEF",REQUEST_PARAMS_TYPE_ERROR:"\u8BF7\u6C42\u53C2\u6570{type}\u7C7B\u578B\u9519\u8BEF",ILLEGAL_NAME:'\u540D\u79F0\u975E\u6CD5, \u5305\u542B /:*?"<>| \u7B49\u975E\u6CD5\u5B57\u7B26',ILLEGAL_NAME1:'\u540D\u79F0\u975E\u6CD5, \u5305\u542B /:*?"<>| \u7B49\u975E\u6CD5\u5B57\u7B26',ILLEGAL_NAME_ZH:"\u540D\u79F0\u4E0D\u80FD\u5305\u542B\u4E2D\u6587",UUID_ERROR:"uuid \u9519\u8BEF",DUPLICATE_DATA:"\u6807\u9898\u5DF2\u5B58\u5728",DUPLICATE_DATA1:"\u5E93\u91CD\u540D",DUPLICATE_DATA_PARAMS:"{type}\u91CD\u590D\u6570\u636E",UPLOAD_LIMIT:"\u6587\u6863 {documentName} \u8D85\u8FC715MB\uFF0C\u5BFC\u81F4\u65E0\u6CD5\u6B63\u5E38\u4FDD\u5B58\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u5BFC\u5165",MORE_THAN_LIMIT:"\u8D85\u8FC7\u6700\u5927\u9650\u5236",FILE_MORE_THAN_LIMIT:"\u8D85\u8FC7{type}\u6700\u5927\u4E0A\u4F20\u9650\u5236",PARAMS_MORE_THAN_LIMIT:"\u8D85\u8FC7\u53C2\u6570{type}\u7684\u6700\u5927\u4E0A\u4F20\u9650\u5236",IMAGE_MORE_THAN_LIMIT_PARAMS:"\u56FE\u7247\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236",FILE_MORE_THAN_LIMIT_PARAMS:"\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236",END_MUST_AFTER_START:"\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u665A\u4E8E\u7ED3\u675F\u65F6\u95F4",FILE_READ_ONLY:"\u5DE5\u7A0B\u6587\u4EF6eprj\u6216\u5E93\u6587\u4EF6elib\u5C5E\u6027\u53D8\u4E3A\u53EA\u8BFB\uFF0C\u8BF7\u5728\u8D44\u6E90\u7BA1\u7406\u5668\u53D6\u6D88\u53EA\u8BFB\u540E\u518D\u8BD5\uFF0C\u5E76\u8054\u7CFB\u6280\u672F\u652F\u6301",FILE_READ_ONLY1:"\u5DE5\u7A0B\u6587\u4EF6eprj\u6216\u5E93\u6587\u4EF6elib\u5C5E\u6027\u53D8\u4E3A\u53EA\u8BFB\uFF0C\u8BF7\u5728\u8D44\u6E90\u7BA1\u7406\u5668\u53D6\u6D88\u53EA\u8BFB\u540E\u518D\u8BD5\uFF0C\u5E76\u8054\u7CFB\u6280\u672F\u652F\u6301",DATA_NOT_EXIST:"\u6587\u6863{documentName}\u4E0D\u5B58\u5728",REQUEST_PARAMS_TIME_ERROR:"\u65F6\u95F4\u8BF7\u6C42\u53C2\u6570\u9519\u8BEF",FILES_PATH_NOT_FOUND:"\u627E\u4E0D\u5230\u6587\u4EF6\u5730\u5740",FILES_DATA_NOT_FOUND:"\u627E\u4E0D\u5230\u6587\u4EF6\u6570\u636E",FILES_TYPE_ERROR:"\u6587\u4EF6\u7C7B\u578B\u9519\u8BEF",FILES_TYPE_MUST_BE_ONE:"\u6587\u4EF6\u7C7B\u578B\u5FC5\u987B\u4E3A{type}",SET_WATERMARK_FAIL:"\u6C34\u5370\u8BBE\u7F6E\u5931\u8D25",MYSQL_CRUD_ERROR:"{type}\u6570\u636E\u6267\u884C\u5931\u8D25, \u8BF7\u8054\u7CFB\u6280\u672F\u652F\u6301\u89E3\u51B3",PARAMS_JSON_FAILED:"{type}\u6570\u636E\u89E3\u6790\u5931\u8D25",MYSQL_ERROR:"\u6570\u636E\u5E93\u64CD\u4F5C\u5F02\u5E38",NOT_FOUND:"\u8BF7\u6C42\u4E0D\u5B58\u5728",PRJ_NAME_EXISTS:"\u5DE5\u7A0B\u540D\u79F0\u5DF2\u5B58\u5728",BACKUP_NAME_EXISTS:"\u5907\u4EFD\u540D\u79F0\u5DF2\u5B58\u5728",TITLE_ILLEGAL_LEN:"{documentName}\u957F\u5EA6\u5FC5\u987B\u4E3A1~128\u5B57\u7B26\u957F\u5EA6\uFF01",LIB_NOT_EXIST:"\u5143\u4EF6\u5E93\u4E0D\u5B58\u5728",CONFIG_API_URLS_ERROR:"\u5B9E\u65F6\u4EF7\u683C\u548C\u5E93\u5B58\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",ONE_CLICK_ORDER_NOT_OPEN:"\u4E00\u4EF6\u4E0B\u5355\u529F\u80FD\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",MATERIAL_NOT_OPEN:"\u7269\u6599\u5E93\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",SNAPSHOT_DEPTH_LIMIT:"\u6700\u65B0\u8282\u70B9\u9644\u8FD1\u5B58\u5728\u5FEB\u7167\u6216\u5FEB\u7167\u5DF2\u88AB\u7533\u8BF7",OCR_SYMBOL_URL_ERROR:"OCR\u8BF7\u6C42\u5730\u5740\u672A\u914D\u7F6E",USER_DATA_NOT_FOUND:"\u7528\u6237\u4E0D\u5B58\u5728",USER_DISABLE_ERROR:"\u8D26\u53F7\u5DF2\u505C\u7528",USER_EXISTS_LOGIN_ERROR:"\u7528\u6237\u5DF2\u5728\u522B\u7684\u5730\u65B9\u767B\u5F55",USER_UNAUTHORIZED_MODULES_ERROR:"\u8BE5\u8D26\u53F7\u672A\u6388\u6743\u6A21\u5757",USER_UNAUTHORIZED_ACCESS_ERROR:"\u8BBF\u95EE\u7C7B\u578B\u9519\u8BEF",ADMIN_NOT_CHANGE_PASSWORD:"\u8D85\u7EA7\u7BA1\u7406\u5458\u65E0\u6CD5\u91CD\u7F6E\u5BC6\u7801",SAME_PASSWORD_NEW_PASSWORD:"\u539F\u5BC6\u7801\u8DDF\u65B0\u5BC6\u7801\u76F8\u540C",USER_ONLINE_REGISTRATION_FAILED:"\u767B\u8BB0\u7528\u6237\u5728\u7EBF\u5931\u8D25",USER_PASSWORD_CAN_NOT_DEFAULT:"\u4E0D\u80FD\u4F7F\u7528\u9ED8\u8BA4\u5BC6\u7801",USER_BEFORE_PASSWORD_ERROR:"\u539F\u5BC6\u7801\u9519\u8BEF",USER_PASSWORD_LENGTH_ERROR:"\u5BC6\u7801\u957F\u5EA6\u4E3A8-255\u4F4D",ORG_ROLE_NOT_CREATE:"\u4E0D\u80FD\u521B\u5EFA\u7CFB\u7EDF\u89D2\u8272, \u8BF7\u4FEE\u6539",ORG_ROLE_NAME_DUPLICATE:"\u89D2\u8272\u540D\u79F0\u5DF2\u5B58\u5728, \u8BF7\u4FEE\u6539",ORG_ROLE_ORIGIN_ERROR:"\u672A\u77E5\u7684\u89D2\u8272\u6765\u6E90{message}",ORG_ROLE_NOT_DEFAULT:"\u8BE5\u89D2\u8272\u4E0D\u662F\u9884\u8BBE\u89D2\u8272, \u4E0D\u80FD\u64CD\u4F5C",ADMIN_ROLE_NOT_CHANGE:"\u7BA1\u7406\u5458\u6743\u9650\u4E0D\u5141\u8BB8\u4FEE\u6539",ADMIN_NOT_CHANGE_STATUS:"admin\u8D26\u53F7\u4E0D\u80FD\u66F4\u6539\u72B6\u6001",PROJECT_ARCHIVED:"\u5DE5\u7A0B\u5DF2\u88AB\u9501\u5B9A",PROJECT_UUID_NULL:"\u5DE5\u7A0Buuid\u4E0D\u80FD\u4E3A\u7A7A",PROJECT_UUID_ERROR:"uuid\u9519\u8BEF\u6216\u8005\u5DE5\u7A0Buuid\u5DF2\u5B58\u5728",PROJECT_OR_TEAM_UUID_ERROR:"\u5DE5\u7A0Buuid\u9519\u8BEF\u6216\u8005\u5DF2\u5B58\u5728\u56E2\u961Fuuid",PROJECT_NOT_PERSON_ERROR:"\u4E0D\u5141\u8BB8\u521B\u5EFA\u4E2A\u4EBA\u5DE5\u7A0B",PROJECT_DUPLICATE_NAME:"\u6807\u9898\u5DF2\u5B58\u5728",ANNOTATION_HAS_BE_FOUND:"\u6279\u6CE8\u5DF2\u521B\u5EFA",ANNOTATION_NOT_FOUND:"\u6279\u6CE8\u5757\u4E0D\u5B58\u5728",ANNOTATION_CREATE_ERROR:"\u6279\u6CE8\u5757\u521B\u5EFA\u5931\u8D25",ANNOTATION_UPDATE_ERROR:"\u66F4\u65B0\u6279\u6CE8\u5757\u5931\u8D25",ANNOTATION_DELETE_ERROR:"\u6279\u6CE8\u6761\u5220\u9664\u5931\u8D25",PROJECT_DUPLICATE_PATH:"\u4E0D\u80FD\u521B\u5EFA\u76F8\u540C\u7684\u8DEF\u5F84",TEAM_NOT_FOUND:"\u56E2\u961F\u4E0D\u5B58\u5728",TEAM_UUID_NULL:"\u56E2\u961Fuuid\u4E0D\u80FD\u4E3A\u7A7A",TEAM_FOLDER_ERROR:"\u7236\u6587\u4EF6\u5939\u4E0D\u5B58\u5728\u6216\u4E0D\u5C5E\u4E8E\u5F53\u524D\u56E2\u961F",TEAM_FOLDER_UUID_ERROR:"\u6587\u4EF6\u5939uuid\u9519\u8BEF\u6216\u8005\u5DE5\u7A0Buuid\u5DF2\u5B58\u5728",TEAM_URL_DUPLICATE:"\u56E2\u961F\u94FE\u63A5\u91CD\u590D",TEAM_CAN_NOT_DELETE:"\u56E2\u961F\u4ECD\u5B58\u5728\u5DE5\u7A0B, \u8BF7\u5148\u8F6C\u79FB\u6216\u8005\u5220\u9664",COMPONENT_UUID_NULL:"\u5143\u4EF6uuid\u4E0D\u80FD\u4E3A\u7A7A",COMPONENT_DATA_NOT_FOUND:"\u5143\u4EF6\u5E93\u6570\u636E\u4E0D\u5B58\u5728",COMPONENT_NAME_DUPLICATE:"\u5143\u4EF6\u5E93\u4E0D\u80FD\u91CD\u540D",COMPONENT_TYPE_ERROR:"\u5E93\u7C7B\u578B\u9519\u8BEF",DELETE_SON_CATEGORY:"\u9700\u8981\u5148\u5220\u9664\u5B50\u7C7B\u522B",LICENSE:"\u672A\u627E\u5230\u8BB8\u53EF\u8BC1",START_TIME:"\u8BB8\u53EF\u8BC1\u5F00\u59CB\u65F6\u95F4\u9519\u8BEF",END_TIME:"\u8BB8\u53EF\u8BC1\u7ED3\u675F\u65F6\u95F4\u9519\u8BEF",PROJECT_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u5DE5\u7A0B\u6570",USER_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u8D26\u53F7\u6570",ONLINE_NUMBER_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u5728\u7EBF\u6570",LIMIT_PCB:"PCB\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",LIMIT_SCH:"\u539F\u7406\u56FE\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",LIMIT_PANEL:"\u9762\u677F\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",TIME_ERROR:"\u7CFB\u7EDF\u65F6\u95F4\u9519\u8BEF\u8BF7\u91CD\u542F\u670D\u52A1\u5668\u6216\u4FEE\u590D\u7CFB\u7EDF\u65F6\u95F4, \u4FEE\u590D\u540E\u9700\u8981\u91CD\u542F\u79C1\u6709\u5316\u670D\u52A1",LICENSE_ERROR:"\u6388\u6743\u9519\u8BEF",LICENSE_TYPE_ERROR:"\u6388\u6743\u5E94\u7528\u7C7B\u578B\u9519\u8BEF",LICENSE_ORIGIN_ERROR:"\u672A\u77E5\u7684\u6388\u6743\u5E94\u7528{type}",BRANCH_DATA_NOT_FOUND:"\u5DE5\u7A0B\u5206\u652F\u4E0D\u5B58\u5728",PARENT_UUID_ERROR:"\u7236\u7EA7uuid\u9519\u8BEF",BRANCH_MUST_AFTER_NODE:"\u5206\u652F\u5FC5\u987B\u5728\u8282\u70B9\u540E",BRANCH_NAME_ERROR:"\u5206\u652F\u540D\u9519\u8BEF",BRANCH_NAME_DUPLICATE:"\u5206\u652F\u540D\u5DF2\u5B58\u5728",BRANCH_UUID_ERROR:"\u5206\u652Fuuid\u9519\u8BEF",BRANCH_NODE_SET_ERROR:"\u8282\u70B9\u4E0D\u80FD\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5206\u652F\u6216\u6807\u8BB0\u4E3Amaster",BRANCH_DELETE_MAIN_ERROR:"\u4E0D\u80FD\u5220\u9664\u4E3B\u5206\u652F\u4E0A\u7684\u8282\u70B9\u6216\u5206\u652F",BRANCH_CHECK_OUT_ERROR:"\u5B58\u5728\u6587\u6863\u5DF2\u7B7E\u51FA",DOCUMENT_UUID_ERROR:"\u6587\u6863uuid\u9519\u8BEF",UPDATE_FAILED:"\u66F4\u65B0\u5931\u8D25",INNER_API_KEY_ERROR:"\u670D\u52A1\u7AEF\u5185\u90E8\u63A5\u53E3 ApiKey \u9519\u8BEF",BRANCH_MORE_THAN_LIMIT:"\u7248\u672C\u8D85\u8FC7\u6700\u5927\u9650\u5236",WORKSPACE_API_ERROR:"\u5DE5\u4F5C\u533A\u8BF7\u6C42\u54CD\u5E94\u5F02\u5E38"},mw={codeEN:Dv,codeCN:Pv},xc,w1=(xc=class{static load(){typeof mw=="object"&&(xc.cache=mw)}static match(t,s,r){if(!this.cache||!this.cache[t])return;let i=this.cache[t][s];if(r&&Object.prototype.toString.call(r)==="[object Object]")for(let n in r){let a=r[n];i=i.replace(`{${n}}`,a)}return i}},xc.cache={},xc);function Ov(){console.log("common init----------------"),w1.load()}var Iv=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(Iv||{});function zi(e,t){throw new Error(`invalid format state on (${t}) of ${e}`)}function xv(e,...t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c);switch(r){case 0:l==="%"?r=1:s.push(l);break;case 1:switch(l){case"d":n=t[i++],typeof n=="number"?(s.push(n.toFixed(0)),r=0):zi(e,c);break;case"f":n=t[i++],typeof n=="number"?(s.push(n.toString()),r=0):zi(e,c);break;case"x":n=t[i++],typeof n=="number"?(s.push((n|0).toString(16)),r=0):zi(e,c);break;case"X":n=t[i++],typeof n=="number"?(s.push((n|0).toString(16).toUpperCase()),r=0):zi(e,c);break;case"s":case"c":n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case"0":a=c+1,o=-1,r=2;break;case"%":s.push("%"),r=0;break;default:zi(e,c)}break;case 2:switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":o=c;break;case"d":if(o>=a){let u=parseInt(e.substring(a,o+1));n=t[i++],typeof n=="number"?(s.push((n|0).toString(10).padStart(u,"0")),r=0):zi(e,c)}else zi(e,c);break;case"x":if(o>=a){let u=parseInt(e.substring(a,o+1));n=t[i++],typeof n=="number"?(s.push((n|0).toString(16).padStart(u,"0")),r=0):zi(e,c)}else zi(e,c);break;case"X":if(o>=a){let u=parseInt(e.substring(a,o+1));n=t[i++],typeof n=="number"?(s.push((n|0).toString(16).toUpperCase().padStart(u,"0")),r=0):zi(e,c)}else zi(e,c);break;default:zi(e,c)}break;default:zi(e,c)}}return s.join("")}function y2(e){let t="";try{let s=/.*\\(.*)$/.exec(e);s&&s[1]&&typeof s[1]=="string"&&(t=s[1])}catch(s){console.error("Query Folder Name Error:",s)}return t}function E2(e,t){let s=Math.max(e.length,t.length);for(let r=0;r<s;r++){let i=e[r],n=t[r],a=0;if(typeof i=="string"&&typeof n=="string")a=i.localeCompare(n);else if(typeof i=="number"&&typeof n=="number")a=i-n;else{if(typeof i=="number"&&typeof n=="string")return-1;if(typeof i=="string"&&typeof n=="number")return 1;if(i===void 0&&n!==void 0)return-1;if(i!==void 0&&n===void 0)return 1}if(a!==0)return a}return 0}function S1(e){let t=/\d+/g,s=new Array,r=0;for(;;){let i=t.exec(e);if(i)r<i.index&&s.push(e.substring(r,i.index)),r=i.index+i[0].length,s.push(parseInt(i[0]));else break}return s.push(e),s}function vv(e,t,s,r){var l,u;let i=[],n=[],a=[];for(let h=0,p=e.length;h<p;h++){i[h]=h;let d;if(Array.isArray(t)){let f="";for(let m=0;m<t.length;m++)if(Object.hasOwnProperty.call(e[h],t[m])){f=e[h][t[m]];break}}else d=t?e[h][t]||((u=(l=e[h])==null?void 0:l[r])==null?void 0:u[t])||"":e[h];if(n[h]=String(d).toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),a[h]=[],n[h])for(let f=0;f<n[h].length;f++)a[h][f]=n[h][f].match(/\d/)?1:2}let o=function(h,p){let d=n[h],f=n[p],m=a[h],g=a[p];if(!d||!f)return s?d==f?0:d?-1:1:d==f?0:d?1:-1;let b=Math.max(d.length,f.length);for(let E=0;E<b;E++){if(s)if(d[E])if(f[E]){if(d[E]!=f[E])return m[E]!=g[E]?m[E]==1?1:-1:m[E]==1?f[E]-d[E]:d[E]<f[E]?1:-1}else return-1;else return 1;if(d[E])if(f[E]){if(d[E]!=f[E])return m[E]!=g[E]?m[E]==1?-1:1:m[E]==1?d[E]-f[E]:d[E]<f[E]?-1:1}else return 1;else return-1}return 0};i.sort(o);let c=[];for(let h=0;h<e.length;h++)c[h]=e[i[h]];return c}function Rv(e,t,s){let r=[],i=[],n=[],a=[e,t];for(let o=0,c=a.length;o<c;o++){r[o]=o;let l=a[o];if(i[o]=String(l).toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),n[o]=[],i[o])for(let u=0;u<i[o].length;u++)n[o][u]=i[o][u].match(/\d/)?1:2}return(function(o,c){let l=i[o],u=i[c],h=n[o],p=n[c];if(!l||!u)return s?l==u?0:l?-1:1:l==u?0:l?1:-1;let d=Math.max(l.length,u.length);for(let f=0;f<d;f++){if(s)if(l[f])if(u[f]){if(l[f]!=u[f])return h[f]!=p[f]?h[f]==1?1:-1:h[f]==1?u[f]-l[f]:l[f]<u[f]?1:-1}else return-1;else return 1;if(l[f])if(u[f]){if(l[f]!=u[f])return h[f]!=p[f]?h[f]==1?-1:1:h[f]==1?l[f]-u[f]:l[f]<u[f]?-1:1}else return 1;else return-1}return 0})(r[0],r[1])}function Nm(e,t){let s=!1;for(let r in t)if(Object.hasOwnProperty.call(t,r)&&e.indexOf(r)!==-1){s=!0;break}return s}function Nv(e,t=""){return e.sort((r,i)=>E2(S1(s(r)),S1(s(i)))),e;function s(r){if(!r)return r;let i;if(Array.isArray(t)){let n="";for(let a=0;a<t.length;a++)if(Object.hasOwnProperty.call(r,t[a])){n=r[t[a]];break}}else i=r[t]||r;return i}}function Lv(e,t,s=1){var o,c,l,u;let r=(o=e.match(/^\D+/))==null?void 0:o[0],i=(c=e.match(/\d+$/))==null?void 0:c[0],n=(l=t.match(/^\D+/))==null?void 0:l[0],a=(u=t.match(/\d+$/))==null?void 0:u[0];return r&&n?r!==n?s===1?r.localeCompare(n):n.localeCompare(r):i!==a?+i>+a?1*s:-1*s:0:r?-1*s:n?1*s:0}function Bv(e){return new Promise(t=>{setTimeout(t,e)})}var PG=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map(e=>e.charCodeAt(0));function kv(){try{if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis}catch{return null}}function du(){return self.EDITOR_TOP||self}function Mv(e,t,s){t=t||1,s=s||32;var r="",i=t,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(i=Math.round(Math.random()*(s-t))+t);for(var a=0;a<i;a++){let o=Math.round(Math.random()*(n.length-1));r+=n[o]}return r}function jv(e){try{return JSON.parse(e)}catch{return console.error(`ParseJSON failed:
`+e),null}}var Bc=(e=>(e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DUMMY=5]="DUMMY",e))(Bc||{}),Fv=(e,t)=>{switch(e){case 4:console.error(...t);break;case 3:console.warn(...t);break;case 2:console.info(...t);break;default:console.log(...t)}},Uv=(e,t)=>t,kc=class Nh{constructor(t,s=Fv,r=Uv){this.level=t,this.writer=s,this.formatter=r}wrap(t){return new Nh(this.level,this.writer,(s,r)=>(r=this.formatter(s,r),t(s,r)))}inject(t){return new Nh(this.level,this.writer,(s,r)=>(r=t(s,r),this.formatter(s,r)))}shadow(...t){return new Nh(this.level,(s,r)=>{this.writer(s,r);for(let i of t)i(s,r)},this.formatter)}mix(...t){return new Nh(0,(s,r)=>{this.process(s,r);for(let i of t)i.process(s,r)},(s,r)=>r)}process(t,s){this.level<=t&&this.writer(t,this.formatter(t,s))}process1(t,s,r){this.level<=t&&this.writer(t,this.formatter(t,[xv(s,...r)]))}trace(...t){this.process(0,t)}trace1(t,...s){this.process1(0,t,s)}debug(...t){this.process(1,t)}debug1(t,...s){this.process1(1,t,s)}info(...t){this.process(2,t)}info1(t,...s){this.process1(2,t,s)}warn(...t){this.process(3,t)}warn1(t,...s){this.process1(3,t,s)}error(...t){this.process(4,t)}error1(t,...s){this.process1(4,t,s)}},OG=new kc(5),IG=Date.now()-performance.now(),b2=new ArrayBuffer(10),xG=new Float64Array(b2,0,1),vG=new Uint8Array(b2);var J1={};Av(J1,{HAS_PANEL:()=>nR,HAS_PCB:()=>iR,HAS_SCH:()=>rR,IS_CLIENT:()=>vn,IS_CLIENT_HALF_OFFLINE:()=>fm,IS_CLIENT_NOT_ONLINE:()=>K1,IS_CLIENT_OFFLINE:()=>$v,IS_CLIENT_ONLINE:()=>mm,IS_DEV:()=>Yv,IS_EASYEDA:()=>w2,IS_EASYEDA_CLIENT:()=>Zv,IS_ECAD:()=>Vv,IS_HALF_OFFLINE:()=>km,IS_LCEDA:()=>T2,IS_LCEDA_CLIENT:()=>Xv,IS_OFFLINE:()=>Mm,IS_ONLINE:()=>Bm,IS_PCBLUXSHARE:()=>zv,IS_PRIVATE:()=>Lm,PRO_EDITOR_MODE:()=>Qv,PRO_EDITOR_MODES:()=>Lr,SSO_EXTERNAL_IDENTITY_DOMAIN:()=>qv,SSO_EXTERNAL_PERMISSION_DOMAIN:()=>Jv,SSO_EXTERNAL_PERMISSION_MANAGED_DOMAIN:()=>Kv,SSO_IDENTITY_CONNECT:()=>Wv});var Hv=(e=>(e.ruler="ruler",e.un_ruler="un_ruler",e))(Hv||{}),Ss=(e=>(e[e.HOME=-1]="HOME",e[e.BLANKTAB=0]="BLANKTAB",e[e.SCH=1]="SCH",e[e.PART=2]="PART",e[e.PCB=3]="PCB",e[e.FOOTPRINT=4]="FOOTPRINT",e[e.PRJ=5]="PRJ",e[e.SUBPART=6]="SUBPART",e[e.NGSPICE_MODEL=7]="NGSPICE_MODEL",e[e.NGSPICE=8]="NGSPICE",e[e.SIMULIDE=9]="SIMULIDE",e[e.WAVEFORM=10]="WAVEFORM",e[e.SCHLIB3D=11]="SCHLIB3D",e[e.PHOTOVIEW=12]="PHOTOVIEW",e[e.SCHMODULE=13]="SCHMODULE",e[e.PCBMODULE=14]="PCBMODULE",e[e.VIEW3D=15]="VIEW3D",e[e.PCBLIB3D=16]="PCBLIB3D",e[e.BLOCK_SYMBOL=17]="BLOCK_SYMBOL",e[e.NETFLAG=18]="NETFLAG",e[e.NETPORT=19]="NETPORT",e[e.SHEET_SYMBOL=20]="SHEET_SYMBOL",e[e.NONEELEC_SYMBOL=21]="NONEELEC_SYMBOL",e[e.SHORT_SYMBOL=22]="SHORT_SYMBOL",e[e.FOOTPRINTVIEW=23]="FOOTPRINTVIEW",e[e.CNCPRINTVIEW=24]="CNCPRINTVIEW",e[e.OFF_PAGE_CONNECTOR=25]="OFF_PAGE_CONNECTOR",e[e.PANEL=26]="PANEL",e[e.PANEL3D=27]="PANEL3D",e[e.DEVICE=28]="DEVICE",e[e.PANEL_LIB=29]="PANEL_LIB",e[e.ASSEMBLY_VARIANT=30]="ASSEMBLY_VARIANT",e[e.DIFF_PAIRS_FLAG=31]="DIFF_PAIRS_FLAG",e[e.SIMULIDE_MODEL=32]="SIMULIDE_MODEL",e))(Ss||{}),Gv=(e=>(e.SCH="SCH",e.PCB="PCB",e.PANEL="PANEL",e))(Gv||{}),Z0=kv(),Lr=String((Z0==null?void 0:Z0.PRO_EDITOR_MODE)||"LCEDA").split("-"),Yv=Lr.indexOf("DEVPRO")>=0,vn=Lr.indexOf("CLIENT")>=0,T2=Lr.indexOf("LCEDA")>=0,w2=Lr.indexOf("EASYEDA")>=0,Lm=Lr.indexOf("PRIVATE")>=0,Bm=Lr.indexOf("ONLINE")>=0,km=Lr.indexOf("HALF_OFFLINE")>=0,Mm=Lr.indexOf("OFFLINE")>=0,Vv=Lr.indexOf("ECAD")>=0,zv=Lr.indexOf("PCB_LUXSHARE")>=0,Wv=Lr.indexOf("SSO_IDENTITY_CONNECT")>=0,qv=Lr.indexOf("SSO_EXTERNAL_IDENTITY_DOMAIN")>=0,Jv=Lr.indexOf("SSO_EXTERNAL_PERMISSION_DOMAIN")>=0,Kv=Lr.indexOf("SSO_EXTERNAL_PERMISSION_MANAGED_DOMAIN")>=0,Xv=vn&&T2,Zv=vn&&w2,fm=vn&&km,K1=vn&&!Bm,$v=vn&&Mm,mm=vn&&Bm,Qv=vn?Bm?"ONLINE":km?"HALF_OFFLINE":Mm?"OFFLINE":"":"",eR=Lr.indexOf("SCH")>=0,tR=Lr.indexOf("PCB")>=0,sR=Lr.indexOf("PANEL")>=0,rR=eR,iR=tR,nR=sR,aR=(e=>(e.PROJECT_BACKUPS_MANUAL="Backup Project Manually",e.PROJECT_BACKUPS_AUTO="Backup Project Automatically",e.DELETE_BACKUPS="Delete Backup",e.SAVE="Save",e.CREATE_SHEET="New Page",e.DELETE_SHEET="Delete Page",e.RENAME_SHEET="Rename Page",e.SIGNED_SHEET="Check Out Page",e.SIGNIN_SHEET="Check In Page",e.CLEAR_SIGNED="Clear Check Out",e.PROJECT_LOCK="Lock Project",e.PROJECT_UNLOCK="Unlock Project",e.PROJECT_OPEN="Open Project",e.PROJECT_CLOSE="Close Project",e.DOCUMENT_PASTE="Paste Document",e.DOCUMENT_PASTE_ACROSS_PROJECT="Paste Document Across Projects",e.SCHEMATIC_PASTE="Paste Schematic",e.SCHEMATIC_PASTE_ACROSS_PROJECT="Paste Schematic Across Projects",e.PRIMITIVE_PASTE_ACROSS_PROJECT="Paste Elements Across Projects",e.PROJECT_SAVEAS_REMOTE="Save Project to Cloud",e.PROJECT_SAVEAS_LOCAL="Save Project to Local",e.LIBRARY_SAVEAS_LOCAL="Save Library to Local",e.DOCUMENT_SAVEAS_REMOTE="Save Document to Cloud",e.DOCUMENT_SAVEAS_LOCAL="Save Document to Local",e.CBB_SAVEAS_REMOTE="Save Reuse Module to Cloud",e.CBB_SAVEAS_LOCAL="Save Reuse Module to Local",e.SVG_EXPORT="Export SVG",e.PNG_EXPORT="Export PNG",e.PDF_EXPORT="Export PDF",e.BOM_EXPORT="Export BOM",e.PRINT="Print",e.GERBER_EXPORT="Export Gerber",e.COORDINATE_EXPORT="Export Pick and Place File",e.D3FILE_EXPORT="Export 3D File",e.D3SHELLFILE_EXPORT="Export 3D Shell File",e.TESTPOINT_REPORT_EXPORT="Export Test Point Report",e.DXF_EXPORT="Export DXF",e.ODBPLUSS_EXPORT="Export ODB++",e.AD_EXPORT="Export Altium Designer",e.DEVICE_REPLACE="Replace Device",e.FOOTPRINT_REPLACE="Replace Footprint",e.D3MODEL_REPLACE="Replace 3D Model",e.PROJECTLIB_UPDATE="Update Project Library",e.REPLACE="Find and Replace",e.TRACK_BATCH_RENAME="Rename Wires in Batch",e.SHEET_BATCH_RENAME="Rename Pages in Batch",e.NET_CREATED_AUTO="Automatic Network Generation",e.DESIGNATOR_ALLOCATION="Annotate Designator",e.UNIQUE_ID_RESET="Reset Unique ID",e.NET_TABLE_EXPORT="Export Netlist",e.REFRESH_PCB_BY_SCH="Update Schematic to PCB",e.REFRESH_SCH_BY_PCB="Update PCB to Schematic",e.CLEAR_DESIGNATOR="Clear Designator",e.UPDATE_PORT_BY_MODULE_SYMBOL="Update Ports from Module Symbol",e.DESIGN_RULE="Set Design Rules",e.NET_CLASS="Set Network Class",e.EQUAL_LENGTH_GROUP="Set Equal Length Group",e.DIFFERENTIAL_PAIR="Set Differential Pair",e))(aR||{}),vr,RG=(vr=class{constructor(t,s=crypto.randomUUID()){this.fileName=t,this.uuid=s,this._params=new URLSearchParams,this._aTarget=document.createElement("a"),this._params.append("uuid",s),this._params.append("fileName",t)}static get URL_VERSION(){var t;try{let s=location.host,r="/";return((t=new RegExp(`${s}(/[\\w|.]+)${r}`).exec(location.href))==null?void 0:t[1])||""}catch{return""}}static getOpenedStream(t){return this._openedInstances.get(t)}get createURL(){return`${vr.CREATE_URL}?${this._params}`}get writeURL(){return`${vr.WRITE_URL}?${this._params}`}get closeURL(){return`${vr.CLOSE_URL}?${this._params}`}get cancelURL(){return`${vr.CANCEL_URL}?${this._params}`}async create(){this._aTarget.href=this.createURL,this._aTarget.click(),this._aTarget.remove(),vr._openedInstances.set(this.uuid,this),await Bv(100)}async write(t){await(await fetch(this.writeURL,{method:"post",body:t})).json()}async close(){await fetch(this.closeURL,{method:"post"}),vr._openedInstances.delete(this.uuid)}async cancel(){await fetch(this.cancelURL,{method:"post"}),vr._openedInstances.delete(this.uuid)}},vr.CREATE_URL=`${vr.URL_VERSION}/sw/download/stream/create`,vr.WRITE_URL="/sw/download/stream/write",vr.CLOSE_URL="/sw/download/stream/close",vr.CANCEL_URL="/sw/download/stream/cancel",vr._openedInstances=new Map,vr);var oR=Object.create,S2=Object.defineProperty,cR=Object.getOwnPropertyDescriptor,lR=Object.getOwnPropertyNames,uR=Object.getPrototypeOf,hR=Object.prototype.hasOwnProperty,dR=(e=>typeof jl<"u"?jl:typeof Proxy<"u"?new Proxy(e,{get:(t,s)=>(typeof jl<"u"?jl:t)[s]}):e)(function(e){if(typeof jl<"u")return jl.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Nt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),pR=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of lR(t))!hR.call(e,i)&&i!==s&&S2(e,i,{get:()=>t[i],enumerable:!(r=cR(t,i))||r.enumerable});return e},pu=(e,t,s)=>(s=e!=null?oR(uR(e)):{},pR(t||!e||!e.__esModule?S2(s,"default",{value:e,enumerable:!0}):s,e)),id=Nt((e,t)=>{"use strict";var s=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(A,N)=>{for(var Y in N)s(A,Y,{get:N[Y],enumerable:!0})},o=(A,N,Y,z)=>{if(N&&typeof N=="object"||typeof N=="function")for(let U of i(N))!n.call(A,U)&&U!==Y&&s(A,U,{get:()=>N[U],enumerable:!(z=r(N,U))||z.enumerable});return A},c=A=>o(s({},"__esModule",{value:!0}),A),l={};a(l,{BroadcastChannelMessageBus:()=>Be,MessageBus:()=>Oe,MessageBus2:()=>ae,MessageBusTask:()=>Pe,MessageBusTask2:()=>ie,WindowMessageBridge:()=>Ee,WorkerMessageBridge:()=>me,createBroadcastP2PStream:()=>gt,createBufferedByteBufferStream:()=>Xe,createBufferedStream:()=>je,createBufferedStringStream:()=>ke,dropP2PStream:()=>it,flowRead:()=>Ds,flowWrite:()=>as}),t.exports=c(l);var u=class{constructor(A=1.5){this.growthFactor=A,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(A){if(this.count===this.capacity){let N=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,N);let Y=new Array(N);for(let z=0;z<this.count;z++)Y[z]=this.buffer[(this.head+z)%this.capacity];this.buffer=Y,this.head=0,this.tail=this.count,this.capacity=N}this.buffer[this.tail]=A,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let A=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,A}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},h=new ArrayBuffer(8),p=new Float64Array(h),d=new Uint32Array(h),f=new Uint16Array(h),m=ArrayBuffer;try{m=self.HTMLImageElement||m}catch{}var g=typeof SharedArrayBuffer<"u";function b(A){if(typeof A!="object"||A===null||A instanceof Date||A instanceof ArrayBuffer||g&&A instanceof SharedArrayBuffer||A instanceof Blob||A instanceof FormData||A instanceof Function||A instanceof Uint8ClampedArray||A instanceof m)return A;if(Array.isArray(A))return A.map(b);{let N={};for(let Y in A)Object.hasOwnProperty.call(A,Y)&&(N[Y]=b(A[Y]));return N}}function E(A,N){return y(A,N,()=>[])}function y(A,N,Y){let z=A[N];return z!==void 0||(z=Y(N),A[N]=z),z}function T(A,N){if(Array.isArray(A)){for(let Y=0,z=A.length;Y<z;Y++)if(N(void 0,A[Y],Y)===!1)return}else{let Y=0;for(let z in A)if(A.hasOwnProperty(z)){let U=A[z];if(N(z,U,Y)===!1)return;Y++}}}var w=Object.prototype.hasOwnProperty;async function S(A,N){if(Array.isArray(A)){for(let Y=0,z=A.length;Y<z;Y++)if(await N(void 0,A[Y],Y)===!1)return}else{let Y=0;for(let z in A)if(w.call(A,z)){let U=A[z];if(await N(z,U,Y)===!1)return;Y++}}}function _(A,N,Y){return typeof A=="string"&&(/https?:/.test(A)||(A=location.origin+A)),Promise.race([fetch(A,N),new Promise((z,U)=>setTimeout(U,Y))])}function C(A,N){let Y=0,z=0;return(...U)=>{let Z=++Y;setTimeout(()=>{let J=performance.now();if(Z===Y||J-z>=A){try{N(...U)}catch(ne){console.log(ne)}z=J}},Math.max(0,A-(performance.now()-z)))}}function x(A,N){let Y=A.length,z=0;for(;z<Y;){let U=A.indexOf(`
`,z);U<0&&(U=Y);let Z=A.substring(z,U);try{if(N(Z)===!1)return}catch(J){console.error(J)}z=U+1}}function D(A){let N=null;return()=>(N===null&&(N=A()),N)}var I=0;function P(){I===0&&(I=Date.now()-performance.now());let A=new Array,N=I+performance.now();p[0]=N,A.push(d[1].toString(16)),p[0]=Math.random(),A.push(f[3].toString(16));let Y=f[2].toString(16);A.push("4"+Y.substr(0,3)),p[0]=N;let z=d[0].toString(16)+d[1].toString(16);return A.push("0"+z.substr(0,3)),A.push(z.substr(3)),A.join("-")}var L=class{constructor(A){this.maxResources=A,this.idle=new u,this.isClosed=!1,this.resources=A}acquire(A){this.isClosed?Promise.resolve(!1).then(A):this.resources>0?(this.resources--,Promise.resolve(!0).then(A)):this.idle.enqueue(A)}acquireSync(){return new Promise(A=>{this.acquire(A)})}release(){if(!this.isClosed){let A=this.idle.dequeue();A?Promise.resolve(!0).then(A):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let A=this.idle.dequeue();Promise.resolve(!1).then(A)}}};function F(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function V(A,N,Y){let z=A.length+N-1;for(let U=0;U<z;U++){let Z=new Array;for(let J=U-N+1;J<=U;J++)Z.push(A[J]);if(Y(Z)===!1)break}}function B(){let A=new Date,N=A.getFullYear(),Y=A.getMonth()+1,z=A.getDate(),U=A.getHours(),Z=A.getMinutes(),J=A.getSeconds(),ne=A.getMilliseconds();return"["+N+"-"+(Y<10?"0"+Y:Y)+"-"+(z<10?"0"+z:z)+" "+(U<10?"0"+U:U)+":"+(Z<10?"0"+Z:Z)+":"+(J<10?"0"+J:J)+"."+(ne<100?ne<10?"00"+ne:"0"+ne:ne)+"] "}function k(A){return new Promise(N=>setTimeout(N,A))}function O(A,N){let Y=0,z=A.length;for(let U=0;U<z;U++)A[U]===N&&(A.splice(U,1),U--,z--,Y++);return Y}var R=F(),v=R.WeakRef||(A=>A);function j(A){if(A!=null){if(typeof A=="object")return new v(A);console.error(A,A instanceof Object,typeof A);return}}function M(A){return A==null?void 0:A.deref()}var H="_MSG_BUS_RPC_",q=300*1e3,Q=(A=>(A.PUBLISH="publish",A.SUBSCRIBE="subscribe",A.PUSH="push",A.PULL="pull",A))(Q||{}),oe=class{constructor(A){this.bus=A}processRemoteMessage(A,N){let Y=j(N),z=A.topic,U=A.type,Z=A.message;switch(U){case"pull":this.bus.pull(z,J=>{this.push(z,J,M(Y))});break;case"subscribe":this.bus.subscribe(z,J=>{this.publish(z,J,M(Y))});break;case"publish":this.bus.publish(z,Z,this,M(Y));break;case"push":this.bus.push(z,Z,this,M(Y));break;default:console.debug("unknown message type "+U)}}rpcCall(A,N,Y,z=q){let U=j(Y),Z=new Promise(J=>{let ne=this.bus.uniqueRpcTopic(A);this.publish(A,{message:N,reply:ne},M(U)),this.bus.pull(ne,(ue,Ie,Ue)=>{J({message:ue,bridge:Ie,source:j(Ue)})})});return z>0?Promise.race([Z,new Promise((J,ne)=>{setTimeout(ne,z)})]):Z}},me=class extends oe{constructor(A,N){super(A),this.worker=N,N.onmessage=Y=>{this.processRemoteMessage(Y.data,void 0)}}publish(A,N){this.postMessage(A,"publish",N)}subscribe(A){this.postMessage(A,"subscribe",null)}push(A,N){this.postMessage(A,"push",N)}pull(A){this.postMessage(A,"pull",null)}rpcCall(A,N,Y=q){return super.rpcCall(A,N,void 0,Y)}postMessage(A,N,Y){let z={topic:A,type:N,message:Y};this.worker.postMessage(z)}discard(){this.worker.terminate()}},Ee=class extends oe{constructor(A){super(A),window.addEventListener("message",N=>{this.processRemoteMessage(N.data,N.source)},!1)}publish(A,N,Y){this.postMessage(A,"publish",N,Y)}subscribe(A,N){if(N===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(A,"subscribe",null,N)}push(A,N,Y){this.postMessage(A,"push",N,Y)}pull(A,N){if(N===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(A,"pull",null,N)}postMessage(A,N,Y,z){let U={topic:A,type:N,message:Y};z&&z.postMessage(U,"*")}},Pe=class{constructor(A){this.isRunning=!0,this.callback=A}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(A,N,Y,z){try{A=z?A:b(A),this.callback(A,N,Y)}catch(U){console.error(U)}}},Oe=class{constructor(A=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=A}uniqueRpcTopic(A){return`${H}-${A}-${this.uuid}-${this.rpcTicket++}`}publish(A,N,Y,z){let U=this.subscribed[A];if(U){let Z;for(let J of U)J.running()?J.execute(N,Y,z,this.unsafe):(Z=Z||new Array,Z.push(J));if(Z)for(let J of Z)O(U,J)}else console.debug("no sub on topic: "+A)}subscribe(A,N){let Y=new Pe(N);return E(this.subscribed,A).push(Y),Y}push(A,N,Y,z){let U=!1,Z=this.pulled[A];if(Z){for(;Z.length>0;){let J=Z.shift();if(J.running()){J.execute(N,Y,z,this.unsafe),U=!0;break}}Z.length===0&&delete this.pulled[A]}U||E(this.pushed,A).push({message:N,bridge:Y,source:j(z)})}pull(A,N){let Y=new Pe(N),z=this.pushed[A];if(z){let U=z.shift();Y.execute(U.message,U.bridge,M(U.source),this.unsafe),z.length===0&&delete this.pushed[A]}else E(this.pulled,A).push(Y);return Y}pullA(A){return new Promise(N=>{this.pull(A,(Y,z,U)=>{N({message:Y,bridge:z,source:j(U)})})})}rpcService(A,N){this.subscribe(A,(Y,z,U)=>{let{message:Z,reply:J}=Y;try{let ne=N(Z);if(ne instanceof Promise){let ue=j(U);ne.then(Ie=>{this.rpcReply(Ie,J,z,M(ue))},Ie=>{console.error(Ie),this.rpcReply(void 0,J,z,M(ue))})}else this.rpcReply(ne,J,z,U)}catch(ne){console.error(ne),this.rpcReply(void 0,J,z,U)}})}rpcCall(A,N,Y=q){let z=new Promise(U=>{let Z=this.uniqueRpcTopic(A);this.publish(A,{message:N,reply:Z}),this.pull(Z,(J,ne,ue)=>{U({message:J,bridge:ne,source:j(ue)})})});return Y>0?Promise.race([z,new Promise((U,Z)=>{setTimeout(Z,Y)})]):z}rpcReply(A,N,Y,z){Y?Y.push(N,A,z):this.push(N,A)}},Fe="_MSG_BUS_RPC_";function G(A,N){let Y=0,z=A.length;for(let U=0;U<z;U++)A[U]===N&&(A.splice(U,1),U--,z--,Y++);return Y}function pe(A,N){return ge(A,N,()=>[])}function ge(A,N,Y){let z=A[N];return z!==void 0||(z=Y(N),A[N]=z),z}var ie=class{constructor(A,N){this.callback=A,this.unsafe=N,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(A){try{A=this.unsafe?A:b(A),this.callback(A)}catch(N){console.error(N)}}},$=class{constructor(A=crypto.randomUUID()){this.uuid=A,this.rpcTicket=0}subscribeOnce(A,N){let Y=this.subscribe(A,z=>{Y.cancel(),N(z)});return Y}pullA(A){return new Promise(N=>{this.pull(A,N)})}rpcService(A,N){let Y=z=>{try{let{message:U,replyTopic:Z}=z;try{let J=N(U);J instanceof Promise?J.then(ne=>{this.publish(Z,{success:!0,result:ne})}).catch(ne=>{console.error(ne),this.publish(Z,{success:!1,err:String(ne)})}):this.publish(Z,{success:!0,result:J})}catch(J){this.publish(Z,{success:!1,err:String(J)})}}finally{this.pull(A,Y)}};this.pull(A,Y)}rpcCall(A,N,Y=0){let z=new Promise((U,Z)=>{let J=`${Fe}-${A}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(J,ne=>{ne.success?U(ne.result):Z(new Error(ne.err))}),this.push(A,{message:N,replyTopic:J})});return Y>0?Promise.race([z,new Promise((U,Z)=>{setTimeout(Z,Y)})]):z}},ae=class extends ${constructor(A=!1){super(),this.unsafe=A,this.subscribed={},this.pulled={},this.pushed={}}publish(A,N){let Y=this.subscribed[A];if(Y){let z;for(let U of Y)U.running()?U.execute(N):(z=z||new Array,z.push(U));if(z)for(let U of z)G(Y,U)}}subscribe(A,N){let Y=new ie(N,this.unsafe);return pe(this.subscribed,A).push(Y),Y}push(A,N){let Y=!1,z=this.pulled[A];if(z){for(;z.length>0;){let U=z.shift();if(U&&U.running()){U.execute(N),Y=!0;break}}z.length===0&&delete this.pulled[A]}Y||pe(this.pushed,A).push(N)}pull(A,N){let Y=new ie(N,this.unsafe);return this.repull(A,Y),Y}repull(A,N){let Y=this.pushed[A];if(Y){let z=Y.shift();z&&(N.execute(z),Y.length===0&&delete this.pushed[A])}else pe(this.pulled,A).push(N)}},ye=class extends ${constructor(A=crypto.randomUUID()){super(A),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(A,N){console.debug("BC",this.uuid,"PUBLISH",A,N),this.broadcastPublish(A,N)}subscribe(A,N){console.debug("BC",this.uuid,"SUBSCRIBE",A);let Y=new ie(N,!0);return pe(this.subscribed,A).push(Y),Y}push(A,N){let Y=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",A,`(${Y})`,N),pe(this.pushed,A).push({id:Y,message:N}),this.broadcastPushedHeadMessage(A)}pull(A,N){console.debug("BC",this.uuid,"PULL",A);let Y=new ie(N,!0);return pe(this.pulled,A).push(Y),this.broadcastWhoHas(A),Y}broadcastPushedHeadMessage(A){let N=this.pushed[A];N&&N[0]&&this.broadcastIHave(A,N[0].id)}onReceivedPublish(A,N,Y){console.debug("BCMSG(",this.uuid,")","from",A,"PUBLISH",N,"message",Y);let z=this.subscribed[N];if(z){let U;for(let Z of z)Z.running()?Z.execute(Y):(U=U||new Array,U.push(Z));if(U)for(let Z of U)G(z,Z);z.length===0&&delete this.subscribed[N]}}onReceivedWhoHas(A,N){console.debug("BCMSG(",this.uuid,")","from",A,"WHOHAS",N),this.broadcastPushedHeadMessage(N)}onReceivedIHave(A,N,Y){console.debug("BCMSG(",this.uuid,")","from",A,"IHAVE",N,"id",Y);let z=this.pulled[N];if(z){let U;for(let Z of z)if(Z.running()){this.broadcastINeed(N,A,Y);break}else U=U||new Array,U.push(Z);if(U)for(let Z of U)G(z,Z);z.length===0&&delete this.pulled[N]}}onReceivedINeed(A,N,Y,z){if(console.debug("BCMSG(",this.uuid,")","from",A,"INEED",N,"source",Y,"id",z),this.uuid===Y){let U=this.pushed[N];if(U&&U[0]&&U[0].id===z){let{message:Z}=U.shift();this.broadcastIGive(N,z,A,Z),this.broadcastPushedHeadMessage(N),U.length===0&&delete this.pushed[N]}}}onReceivedIGive(A,N,Y,z,U){console.debug("BCMSG(",this.uuid,")","from",A,"IGIVE",N,"id",Y,"target",z,"message",U);let Z=this.pulled[N];if(Z&&this.uuid===z){let J=!1;for(;Z.length>0;){let ne=Z.shift();if(ne.running()){ne.execute(U),J=!0;break}}J||this.push(N,U),Z.length===0&&delete this.pulled[N]}}},Be=class extends ye{constructor(A,N=crypto.randomUUID()){super(N),this.bc=new BroadcastChannel(A),this.bc.onmessage=Y=>{this.onMessage(Y.data)}}onMessage(A){let{type:N,uuid:Y,topic:z}=A;switch(N){case"PUBLISH":{let{message:U}=A;this.onReceivedPublish(Y,z,U);break}case"WHOHAS":{this.onReceivedWhoHas(Y,z);break}case"IHAVE":{let{id:U}=A;this.onReceivedIHave(Y,z,U);break}case"INEED":{let{source:U,id:Z}=A;this.onReceivedINeed(Y,z,U,Z);break}case"IGIVE":{let{target:U,id:Z,message:J}=A;this.onReceivedIGive(Y,z,Z,U,J);break}default:console.warn("unsupported",A)}}broadcastPublish(A,N){this.post({type:"PUBLISH",uuid:this.uuid,topic:A,message:N})}broadcastWhoHas(A){this.post({type:"WHOHAS",uuid:this.uuid,topic:A})}broadcastIHave(A,N){this.post({type:"IHAVE",uuid:this.uuid,topic:A,id:N})}broadcastINeed(A,N,Y){this.post({type:"INEED",uuid:this.uuid,topic:A,source:N,id:Y})}broadcastIGive(A,N,Y,z){this.post({type:"IGIVE",uuid:this.uuid,topic:A,id:N,target:Y,message:z})}post(A){this.bc.postMessage(A),Promise.resolve().then(()=>{this.onMessage(A)})}},be=Symbol("BLOCKING_QUEUE_RESET"),xe=class{constructor(A,N=()=>1){if(this.maxSize=A,this.itemSizeOf=N,this.queue=new u,this.waitingConsumers=new u,this.waitingProducers=new u,this.queueSize=0,this.closePromise=null,this.closeResolve=null,A<=0)throw new Error("Max size must be greater than 0")}enqueue(A){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let N=await new Promise(Y=>{this.waitingProducers.enqueue(Y)});return console.debug("queue is not full",this.size(),N),N?(this.innerEnqueue(A),!0):!1})():(this.innerEnqueue(A),!0)}innerEnqueue(A){if(this.waitingConsumers.isEmpty())this.queue.enqueue(A),this.queueSize+=this.itemSizeOf(A),console.debug("queue pushed",A,"size",this.queueSize);else{let N=this.waitingConsumers.dequeue();Promise.resolve(A).then(N),console.debug("queue direct",A,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let A=this.waitingConsumers.dequeue();Promise.resolve(be).then(A)}return setTimeout(()=>this.closeResolve(),0),be}else return new Promise(A=>{this.waitingConsumers.enqueue(A)});else{let A=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(A),!this.waitingProducers.isEmpty()){let N=this.waitingProducers.dequeue();Promise.resolve(!0).then(N)}return A}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(A=>{for(this.closeResolve=A;!this.waitingProducers.isEmpty();){let N=this.waitingProducers.dequeue();Promise.resolve(!1).then(N)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let N=this.waitingConsumers.dequeue();Promise.resolve(be).then(N)}A()}})),this.closePromise}};function je(A,N,Y=Number.MAX_SAFE_INTEGER){let z=new xe(Y,N),U=new ReadableStream({pull(J){let ne=!0,ue=(async()=>{let Ie=new Array;do{let Ue=z.dequeue();if(Ue instanceof Promise){ne=!1;let Ye=await Ue;Ye===be?J.close():Ie.push(Ye)}else{let Ye=Ue;Ye===be?J.close():Ie.push(Ye)}}while(z.size()>0);if(Ie.length>0){let Ue=A(Ie);J.enqueue(Ue)}})();if(!ne)return console.debug("read stream stucked --------------------------------------"),ue},async cancel(){console.debug("buffered readable cancel"),await z.close()}}),Z=new WritableStream({write(J,ne){let ue=!0,Ie=(async()=>{let Ue=z.enqueue(J);typeof Ue=="boolean"?Ue||ne.error(new Error("Write stream closed")):(ue=!1,await Ue||ne.error(new Error("Write stream closed")))})();if(!ue)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),Ie},async close(){console.debug("buffered writable closing",z.size()),await z.close(),console.debug("buffered writable closed",z.size())},async abort(){console.debug("buffered writable aborting",z.size()),await z.close(),console.debug("buffered writable aborted",z.size())}});return{readable:U,writable:Z}}function ke(A=Number.MAX_SAFE_INTEGER){return je(N=>N.join(""),N=>N.length,A)}function Xe(A=Number.MAX_SAFE_INTEGER){return je(N=>{let Y=new Uint8Array(N.reduce((U,Z)=>U+Z.byteLength,0)),z=0;return N.forEach(U=>{Y.set(U,z),z+=U.byteLength}),Y},N=>N.byteLength,A)}function gt(A){return new Promise((N,Y)=>{let z=new BroadcastChannel(A),U=new xe(1),Z=new L(1),J=null,ne=!1,ue=!1,Ie=!1;z.onmessage=Ue=>{let Ye=Ue.data,{type:Qe}=Ye;if(console.debug("p2p",A,"type",Qe,"data",Qe==="DATA"&&Ye.data),Qe==="DATA")U.enqueue(Ye.data);else if(Qe==="HI"){if(!J){z.postMessage({type:"HI"});let Yr=0;J={rs:new ReadableStream({async pull(Or){let Ir=await U.dequeue();Ir===be?(await ar(),Or.close()):(Or.enqueue(Ir),z.postMessage({type:"ACK"}))},cancel(){return ar()}}),ws:new WritableStream({async write(Or,Ir){await Z.acquireSync()?z.postMessage({type:"DATA",id:Yr++,data:Or}):(ws(),Ir.error(new Error("Write stream closed")))},close(){ws()},abort(){ws()}})},N(J)}}else Qe==="REND"?J?Z.close():yi("REND1"):Qe==="WEND"?J?U.close():yi("WEND1"):Qe==="ACK"&&Z.release();function ws(){ne||(ne=!0,console.debug(A,"p2p write stream closed"),Z.close(),z.postMessage({type:"WEND"}),ue&&(console.debug(A,"p2p channel closed on ws"),z.close()))}async function ar(){ue||(ue=!0,console.debug(A,"p2p read stream closed"),z.postMessage({type:"REND"}),await U.close(),ne&&(console.debug(A,"p2p channel closed on rs"),z.close()))}async function yi(Yr){Ie||(Ie=!0,console.debug(A,"p2p channel connection released on",Yr),Z.close(),U.close(),J?(J.rs.locked||(console.debug(A,"p2p unlocked read stream direct cancel"),J.rs.cancel()),J.ws.locked||(console.debug(A,"p2p unlocked write stream direct close"),J.ws.close())):(z.postMessage({type:"HI"}),z.close()),Y(new Error("p2p channel connection released")))}},z.postMessage({type:"HI"})})}function it(A){return new Promise(N=>{let Y=new BroadcastChannel(A);Y.onmessage=z=>{let U=z.data,{type:Z}=U;Z==="HI"&&(Y.postMessage({type:"REND"}),Y.close(),N())},Y.postMessage({type:"REND"})})}async function Ve(A){try{return await gt(A)}catch(N){N.message!=="p2p channel connection released"&&console.error(N)}}async function as(A,N,Y=10*1024*1024,z=!0){let U=await Ve(A);if(!U)return!1;let Z=!1;try{let J,ne=ue=>{if(!J)if(!z)J=U.ws.getWriter();else if(typeof ue=="string"){let Ie=ke(Y);Ie.readable.pipeTo(U.ws),J=Ie.writable.getWriter()}else{let Ie=Xe(Y);Ie.readable.pipeTo(U.ws),J=Ie.writable.getWriter()}return J.write(ue)};if(Array.isArray(N))for(let ue of N)await ne(ue);else await N({write:ne,get desiredSize(){return((J==null?void 0:J.desiredSize)||0)+10}});J&&await J.close(),Z=!0}catch(J){console.error(J)}finally{return U.rs.cancel(),Z}}async function Ds(A,N){var z,U;let Y=await Ve(A);if(Y)try{let Z=Y.rs.getReader();for((z=N.start)==null?void 0:z.call(N);;){let{value:J,done:ne}=await Z.read();if(J!==void 0){let ue;if(N.update instanceof Promise?ue=await N.update(J):ue=N.update(J),ue){await Z.cancel();break}}if(ne){(U=N.end)==null||U.call(N);break}}}catch(Z){console.error(Z)}finally{Y.ws.close()}}}),fR=Nt(()=>{}),Jt=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r():typeof define=="function"&&define.amd?define([],r):s.CryptoJS=r()})(e,function(){var s=s||(function(r,i){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto),!n&&typeof dR=="function")try{n=fR()}catch{}var a=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||(function(){function y(){}return function(T){var w;return y.prototype=T,w=new y,y.prototype=null,w}})(),c={},l=c.lib={},u=l.Base=(function(){return{extend:function(y){var T=o(this);return y&&T.mixIn(y),(!T.hasOwnProperty("init")||this.init===T.init)&&(T.init=function(){T.$super.init.apply(this,arguments)}),T.init.prototype=T,T.$super=this,T},create:function(){var y=this.extend();return y.init.apply(y,arguments),y},init:function(){},mixIn:function(y){for(var T in y)y.hasOwnProperty(T)&&(this[T]=y[T]);y.hasOwnProperty("toString")&&(this.toString=y.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),h=l.WordArray=u.extend({init:function(y,T){y=this.words=y||[],T!=i?this.sigBytes=T:this.sigBytes=y.length*4},toString:function(y){return(y||d).stringify(this)},concat:function(y){var T=this.words,w=y.words,S=this.sigBytes,_=y.sigBytes;if(this.clamp(),S%4)for(var C=0;C<_;C++){var x=w[C>>>2]>>>24-C%4*8&255;T[S+C>>>2]|=x<<24-(S+C)%4*8}else for(var D=0;D<_;D+=4)T[S+D>>>2]=w[D>>>2];return this.sigBytes+=_,this},clamp:function(){var y=this.words,T=this.sigBytes;y[T>>>2]&=4294967295<<32-T%4*8,y.length=r.ceil(T/4)},clone:function(){var y=u.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var T=[],w=0;w<y;w+=4)T.push(a());return new h.init(T,y)}}),p=c.enc={},d=p.Hex={stringify:function(y){for(var T=y.words,w=y.sigBytes,S=[],_=0;_<w;_++){var C=T[_>>>2]>>>24-_%4*8&255;S.push((C>>>4).toString(16)),S.push((C&15).toString(16))}return S.join("")},parse:function(y){for(var T=y.length,w=[],S=0;S<T;S+=2)w[S>>>3]|=parseInt(y.substr(S,2),16)<<24-S%8*4;return new h.init(w,T/2)}},f=p.Latin1={stringify:function(y){for(var T=y.words,w=y.sigBytes,S=[],_=0;_<w;_++){var C=T[_>>>2]>>>24-_%4*8&255;S.push(String.fromCharCode(C))}return S.join("")},parse:function(y){for(var T=y.length,w=[],S=0;S<T;S++)w[S>>>2]|=(y.charCodeAt(S)&255)<<24-S%4*8;return new h.init(w,T)}},m=p.Utf8={stringify:function(y){try{return decodeURIComponent(escape(f.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return f.parse(unescape(encodeURIComponent(y)))}},g=l.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=m.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var T,w=this._data,S=w.words,_=w.sigBytes,C=this.blockSize,x=C*4,D=_/x;y?D=r.ceil(D):D=r.max((D|0)-this._minBufferSize,0);var I=D*C,P=r.min(I*4,_);if(I){for(var L=0;L<I;L+=C)this._doProcessBlock(S,L);T=S.splice(0,I),w.sigBytes-=P}return new h.init(T,P)},clone:function(){var y=u.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0}),b=l.Hasher=g.extend({cfg:u.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){y&&this._append(y);var T=this._doFinalize();return T},blockSize:512/32,_createHelper:function(y){return function(T,w){return new y.init(w).finalize(T)}},_createHmacHelper:function(y){return function(T,w){return new E.HMAC.init(y,w).finalize(T)}}}),E=c.algo={};return c})(Math);return s})}),jm=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.Base,o=n.WordArray,c=i.x64={},l=c.Word=a.extend({init:function(h,p){this.high=h,this.low=p}}),u=c.WordArray=a.extend({init:function(h,p){h=this.words=h||[],p!=r?this.sigBytes=p:this.sigBytes=h.length*8},toX32:function(){for(var h=this.words,p=h.length,d=[],f=0;f<p;f++){var m=h[f];d.push(m.high),d.push(m.low)}return o.create(d,this.sigBytes)},clone:function(){for(var h=a.clone.call(this),p=h.words=this.words.slice(0),d=p.length,f=0;f<d;f++)p[f]=p[f].clone();return h}})})(),s})}),mR=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){if(typeof ArrayBuffer=="function"){var r=s,i=r.lib,n=i.WordArray,a=n.init,o=n.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var l=c.byteLength,u=[],h=0;h<l;h++)u[h>>>2]|=c[h]<<24-h%4*8;a.call(this,u,l)}else a.apply(this,arguments)};o.prototype=n}})(),s.lib.WordArray})}),gR=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.enc,o=a.Utf16=a.Utf16BE={stringify:function(l){for(var u=l.words,h=l.sigBytes,p=[],d=0;d<h;d+=2){var f=u[d>>>2]>>>16-d%4*8&65535;p.push(String.fromCharCode(f))}return p.join("")},parse:function(l){for(var u=l.length,h=[],p=0;p<u;p++)h[p>>>1]|=l.charCodeAt(p)<<16-p%2*16;return n.create(h,u*2)}};a.Utf16LE={stringify:function(l){for(var u=l.words,h=l.sigBytes,p=[],d=0;d<h;d+=2){var f=c(u[d>>>2]>>>16-d%4*8&65535);p.push(String.fromCharCode(f))}return p.join("")},parse:function(l){for(var u=l.length,h=[],p=0;p<u;p++)h[p>>>1]|=c(l.charCodeAt(p)<<16-p%2*16);return n.create(h,u*2)}};function c(l){return l<<8&4278255360|l>>>8&16711935}})(),s.enc.Utf16})}),Mc=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.enc,o=a.Base64={stringify:function(l){var u=l.words,h=l.sigBytes,p=this._map;l.clamp();for(var d=[],f=0;f<h;f+=3)for(var m=u[f>>>2]>>>24-f%4*8&255,g=u[f+1>>>2]>>>24-(f+1)%4*8&255,b=u[f+2>>>2]>>>24-(f+2)%4*8&255,E=m<<16|g<<8|b,y=0;y<4&&f+y*.75<h;y++)d.push(p.charAt(E>>>6*(3-y)&63));var T=p.charAt(64);if(T)for(;d.length%4;)d.push(T);return d.join("")},parse:function(l){var u=l.length,h=this._map,p=this._reverseMap;if(!p){p=this._reverseMap=[];for(var d=0;d<h.length;d++)p[h.charCodeAt(d)]=d}var f=h.charAt(64);if(f){var m=l.indexOf(f);m!==-1&&(u=m)}return c(l,u,p)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function c(l,u,h){for(var p=[],d=0,f=0;f<u;f++)if(f%4){var m=h[l.charCodeAt(f-1)]<<f%4*2,g=h[l.charCodeAt(f)]>>>6-f%4*2,b=m|g;p[d>>>2]|=b<<24-d%4*8,d++}return n.create(p,d)}})(),s.enc.Base64})}),yR=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.enc,o=a.Base64url={stringify:function(l,u){u===void 0&&(u=!0);var h=l.words,p=l.sigBytes,d=u?this._safe_map:this._map;l.clamp();for(var f=[],m=0;m<p;m+=3)for(var g=h[m>>>2]>>>24-m%4*8&255,b=h[m+1>>>2]>>>24-(m+1)%4*8&255,E=h[m+2>>>2]>>>24-(m+2)%4*8&255,y=g<<16|b<<8|E,T=0;T<4&&m+T*.75<p;T++)f.push(d.charAt(y>>>6*(3-T)&63));var w=d.charAt(64);if(w)for(;f.length%4;)f.push(w);return f.join("")},parse:function(l,u){u===void 0&&(u=!0);var h=l.length,p=u?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var f=0;f<p.length;f++)d[p.charCodeAt(f)]=f}var m=p.charAt(64);if(m){var g=l.indexOf(m);g!==-1&&(h=g)}return c(l,h,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function c(l,u,h){for(var p=[],d=0,f=0;f<u;f++)if(f%4){var m=h[l.charCodeAt(f-1)]<<f%4*2,g=h[l.charCodeAt(f)]>>>6-f%4*2,b=m|g;p[d>>>2]|=b<<24-d%4*8,d++}return n.create(p,d)}})(),s.enc.Base64url})}),jc=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.algo,l=[];(function(){for(var m=0;m<64;m++)l[m]=r.abs(r.sin(m+1))*4294967296|0})();var u=c.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,g){for(var b=0;b<16;b++){var E=g+b,y=m[E];m[E]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var T=this._hash.words,w=m[g+0],S=m[g+1],_=m[g+2],C=m[g+3],x=m[g+4],D=m[g+5],I=m[g+6],P=m[g+7],L=m[g+8],F=m[g+9],V=m[g+10],B=m[g+11],k=m[g+12],O=m[g+13],R=m[g+14],v=m[g+15],j=T[0],M=T[1],H=T[2],q=T[3];j=h(j,M,H,q,w,7,l[0]),q=h(q,j,M,H,S,12,l[1]),H=h(H,q,j,M,_,17,l[2]),M=h(M,H,q,j,C,22,l[3]),j=h(j,M,H,q,x,7,l[4]),q=h(q,j,M,H,D,12,l[5]),H=h(H,q,j,M,I,17,l[6]),M=h(M,H,q,j,P,22,l[7]),j=h(j,M,H,q,L,7,l[8]),q=h(q,j,M,H,F,12,l[9]),H=h(H,q,j,M,V,17,l[10]),M=h(M,H,q,j,B,22,l[11]),j=h(j,M,H,q,k,7,l[12]),q=h(q,j,M,H,O,12,l[13]),H=h(H,q,j,M,R,17,l[14]),M=h(M,H,q,j,v,22,l[15]),j=p(j,M,H,q,S,5,l[16]),q=p(q,j,M,H,I,9,l[17]),H=p(H,q,j,M,B,14,l[18]),M=p(M,H,q,j,w,20,l[19]),j=p(j,M,H,q,D,5,l[20]),q=p(q,j,M,H,V,9,l[21]),H=p(H,q,j,M,v,14,l[22]),M=p(M,H,q,j,x,20,l[23]),j=p(j,M,H,q,F,5,l[24]),q=p(q,j,M,H,R,9,l[25]),H=p(H,q,j,M,C,14,l[26]),M=p(M,H,q,j,L,20,l[27]),j=p(j,M,H,q,O,5,l[28]),q=p(q,j,M,H,_,9,l[29]),H=p(H,q,j,M,P,14,l[30]),M=p(M,H,q,j,k,20,l[31]),j=d(j,M,H,q,D,4,l[32]),q=d(q,j,M,H,L,11,l[33]),H=d(H,q,j,M,B,16,l[34]),M=d(M,H,q,j,R,23,l[35]),j=d(j,M,H,q,S,4,l[36]),q=d(q,j,M,H,x,11,l[37]),H=d(H,q,j,M,P,16,l[38]),M=d(M,H,q,j,V,23,l[39]),j=d(j,M,H,q,O,4,l[40]),q=d(q,j,M,H,w,11,l[41]),H=d(H,q,j,M,C,16,l[42]),M=d(M,H,q,j,I,23,l[43]),j=d(j,M,H,q,F,4,l[44]),q=d(q,j,M,H,k,11,l[45]),H=d(H,q,j,M,v,16,l[46]),M=d(M,H,q,j,_,23,l[47]),j=f(j,M,H,q,w,6,l[48]),q=f(q,j,M,H,P,10,l[49]),H=f(H,q,j,M,R,15,l[50]),M=f(M,H,q,j,D,21,l[51]),j=f(j,M,H,q,k,6,l[52]),q=f(q,j,M,H,C,10,l[53]),H=f(H,q,j,M,V,15,l[54]),M=f(M,H,q,j,S,21,l[55]),j=f(j,M,H,q,L,6,l[56]),q=f(q,j,M,H,v,10,l[57]),H=f(H,q,j,M,I,15,l[58]),M=f(M,H,q,j,O,21,l[59]),j=f(j,M,H,q,x,6,l[60]),q=f(q,j,M,H,B,10,l[61]),H=f(H,q,j,M,_,15,l[62]),M=f(M,H,q,j,F,21,l[63]),T[0]=T[0]+j|0,T[1]=T[1]+M|0,T[2]=T[2]+H|0,T[3]=T[3]+q|0},_doFinalize:function(){var m=this._data,g=m.words,b=this._nDataBytes*8,E=m.sigBytes*8;g[E>>>5]|=128<<24-E%32;var y=r.floor(b/4294967296),T=b;g[(E+64>>>9<<4)+15]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,g[(E+64>>>9<<4)+14]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360,m.sigBytes=(g.length+1)*4,this._process();for(var w=this._hash,S=w.words,_=0;_<4;_++){var C=S[_];S[_]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}return w},clone:function(){var m=o.clone.call(this);return m._hash=this._hash.clone(),m}});function h(m,g,b,E,y,T,w){var S=m+(g&b|~g&E)+y+w;return(S<<T|S>>>32-T)+g}function p(m,g,b,E,y,T,w){var S=m+(g&E|b&~E)+y+w;return(S<<T|S>>>32-T)+g}function d(m,g,b,E,y,T,w){var S=m+(g^b^E)+y+w;return(S<<T|S>>>32-T)+g}function f(m,g,b,E,y,T,w){var S=m+(b^(g|~E))+y+w;return(S<<T|S>>>32-T)+g}i.MD5=o._createHelper(u),i.HmacMD5=o._createHmacHelper(u)})(Math),s.MD5})}),_2=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=i.Hasher,o=r.algo,c=[],l=o.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,h){for(var p=this._hash.words,d=p[0],f=p[1],m=p[2],g=p[3],b=p[4],E=0;E<80;E++){if(E<16)c[E]=u[h+E]|0;else{var y=c[E-3]^c[E-8]^c[E-14]^c[E-16];c[E]=y<<1|y>>>31}var T=(d<<5|d>>>27)+b+c[E];E<20?T+=(f&m|~f&g)+1518500249:E<40?T+=(f^m^g)+1859775393:E<60?T+=(f&m|f&g|m&g)-1894007588:T+=(f^m^g)-899497514,b=g,g=m,m=f<<30|f>>>2,f=d,d=T}p[0]=p[0]+d|0,p[1]=p[1]+f|0,p[2]=p[2]+m|0,p[3]=p[3]+g|0,p[4]=p[4]+b|0},_doFinalize:function(){var u=this._data,h=u.words,p=this._nDataBytes*8,d=u.sigBytes*8;return h[d>>>5]|=128<<24-d%32,h[(d+64>>>9<<4)+14]=Math.floor(p/4294967296),h[(d+64>>>9<<4)+15]=p,u.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var u=a.clone.call(this);return u._hash=this._hash.clone(),u}});r.SHA1=a._createHelper(l),r.HmacSHA1=a._createHmacHelper(l)})(),s.SHA1})}),X1=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.algo,l=[],u=[];(function(){function d(b){for(var E=r.sqrt(b),y=2;y<=E;y++)if(!(b%y))return!1;return!0}function f(b){return(b-(b|0))*4294967296|0}for(var m=2,g=0;g<64;)d(m)&&(g<8&&(l[g]=f(r.pow(m,1/2))),u[g]=f(r.pow(m,1/3)),g++),m++})();var h=[],p=c.SHA256=o.extend({_doReset:function(){this._hash=new a.init(l.slice(0))},_doProcessBlock:function(d,f){for(var m=this._hash.words,g=m[0],b=m[1],E=m[2],y=m[3],T=m[4],w=m[5],S=m[6],_=m[7],C=0;C<64;C++){if(C<16)h[C]=d[f+C]|0;else{var x=h[C-15],D=(x<<25|x>>>7)^(x<<14|x>>>18)^x>>>3,I=h[C-2],P=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;h[C]=D+h[C-7]+P+h[C-16]}var L=T&w^~T&S,F=g&b^g&E^b&E,V=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),B=(T<<26|T>>>6)^(T<<21|T>>>11)^(T<<7|T>>>25),k=_+B+L+u[C]+h[C],O=V+F;_=S,S=w,w=T,T=y+k|0,y=E,E=b,b=g,g=k+O|0}m[0]=m[0]+g|0,m[1]=m[1]+b|0,m[2]=m[2]+E|0,m[3]=m[3]+y|0,m[4]=m[4]+T|0,m[5]=m[5]+w|0,m[6]=m[6]+S|0,m[7]=m[7]+_|0},_doFinalize:function(){var d=this._data,f=d.words,m=this._nDataBytes*8,g=d.sigBytes*8;return f[g>>>5]|=128<<24-g%32,f[(g+64>>>9<<4)+14]=r.floor(m/4294967296),f[(g+64>>>9<<4)+15]=m,d.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var d=o.clone.call(this);return d._hash=this._hash.clone(),d}});i.SHA256=o._createHelper(p),i.HmacSHA256=o._createHmacHelper(p)})(Math),s.SHA256})}),ER=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),X1()):typeof define=="function"&&define.amd?define(["./core","./sha256"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.algo,o=a.SHA256,c=a.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var l=o._doFinalize.call(this);return l.sigBytes-=4,l}});r.SHA224=o._createHelper(c),r.HmacSHA224=o._createHmacHelper(c)})(),s.SHA224})}),A2=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),jm()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.Hasher,a=r.x64,o=a.Word,c=a.WordArray,l=r.algo;function u(){return o.create.apply(o,arguments)}var h=[u(1116352408,3609767458),u(1899447441,602891725),u(3049323471,3964484399),u(3921009573,2173295548),u(961987163,4081628472),u(1508970993,3053834265),u(2453635748,2937671579),u(2870763221,3664609560),u(3624381080,2734883394),u(310598401,1164996542),u(607225278,1323610764),u(1426881987,3590304994),u(1925078388,4068182383),u(2162078206,991336113),u(2614888103,633803317),u(3248222580,3479774868),u(3835390401,2666613458),u(4022224774,944711139),u(264347078,2341262773),u(604807628,2007800933),u(770255983,1495990901),u(1249150122,1856431235),u(1555081692,3175218132),u(1996064986,2198950837),u(2554220882,3999719339),u(2821834349,766784016),u(2952996808,2566594879),u(3210313671,3203337956),u(3336571891,1034457026),u(3584528711,2466948901),u(113926993,3758326383),u(338241895,168717936),u(666307205,1188179964),u(773529912,1546045734),u(1294757372,1522805485),u(1396182291,2643833823),u(1695183700,2343527390),u(1986661051,1014477480),u(2177026350,1206759142),u(2456956037,344077627),u(2730485921,1290863460),u(2820302411,3158454273),u(3259730800,3505952657),u(3345764771,106217008),u(3516065817,3606008344),u(3600352804,1432725776),u(4094571909,1467031594),u(275423344,851169720),u(430227734,3100823752),u(506948616,1363258195),u(659060556,3750685593),u(883997877,3785050280),u(958139571,3318307427),u(1322822218,3812723403),u(1537002063,2003034995),u(1747873779,3602036899),u(1955562222,1575990012),u(2024104815,1125592928),u(2227730452,2716904306),u(2361852424,442776044),u(2428436474,593698344),u(2756734187,3733110249),u(3204031479,2999351573),u(3329325298,3815920427),u(3391569614,3928383900),u(3515267271,566280711),u(3940187606,3454069534),u(4118630271,4000239992),u(116418474,1914138554),u(174292421,2731055270),u(289380356,3203993006),u(460393269,320620315),u(685471733,587496836),u(852142971,1086792851),u(1017036298,365543100),u(1126000580,2618297676),u(1288033470,3409855158),u(1501505948,4234509866),u(1607167915,987167468),u(1816402316,1246189591)],p=[];(function(){for(var f=0;f<80;f++)p[f]=u()})();var d=l.SHA512=n.extend({_doReset:function(){this._hash=new c.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(f,m){for(var g=this._hash.words,b=g[0],E=g[1],y=g[2],T=g[3],w=g[4],S=g[5],_=g[6],C=g[7],x=b.high,D=b.low,I=E.high,P=E.low,L=y.high,F=y.low,V=T.high,B=T.low,k=w.high,O=w.low,R=S.high,v=S.low,j=_.high,M=_.low,H=C.high,q=C.low,Q=x,oe=D,me=I,Ee=P,Pe=L,Oe=F,Fe=V,G=B,pe=k,ge=O,ie=R,$=v,ae=j,ye=M,Be=H,be=q,xe=0;xe<80;xe++){var je,ke,Xe=p[xe];if(xe<16)ke=Xe.high=f[m+xe*2]|0,je=Xe.low=f[m+xe*2+1]|0;else{var gt=p[xe-15],it=gt.high,Ve=gt.low,as=(it>>>1|Ve<<31)^(it>>>8|Ve<<24)^it>>>7,Ds=(Ve>>>1|it<<31)^(Ve>>>8|it<<24)^(Ve>>>7|it<<25),A=p[xe-2],N=A.high,Y=A.low,z=(N>>>19|Y<<13)^(N<<3|Y>>>29)^N>>>6,U=(Y>>>19|N<<13)^(Y<<3|N>>>29)^(Y>>>6|N<<26),Z=p[xe-7],J=Z.high,ne=Z.low,ue=p[xe-16],Ie=ue.high,Ue=ue.low;je=Ds+ne,ke=as+J+(je>>>0<Ds>>>0?1:0),je=je+U,ke=ke+z+(je>>>0<U>>>0?1:0),je=je+Ue,ke=ke+Ie+(je>>>0<Ue>>>0?1:0),Xe.high=ke,Xe.low=je}var Ye=pe&ie^~pe&ae,Qe=ge&$^~ge&ye,ws=Q&me^Q&Pe^me&Pe,ar=oe&Ee^oe&Oe^Ee&Oe,yi=(Q>>>28|oe<<4)^(Q<<30|oe>>>2)^(Q<<25|oe>>>7),Yr=(oe>>>28|Q<<4)^(oe<<30|Q>>>2)^(oe<<25|Q>>>7),Or=(pe>>>14|ge<<18)^(pe>>>18|ge<<14)^(pe<<23|ge>>>9),Ir=(ge>>>14|pe<<18)^(ge>>>18|pe<<14)^(ge<<23|pe>>>9),Sh=h[xe],H0=Sh.high,_h=Sh.low,Ls=be+Ir,Vr=Be+Or+(Ls>>>0<be>>>0?1:0),Ls=Ls+Qe,Vr=Vr+Ye+(Ls>>>0<Qe>>>0?1:0),Ls=Ls+_h,Vr=Vr+H0+(Ls>>>0<_h>>>0?1:0),Ls=Ls+je,Vr=Vr+ke+(Ls>>>0<je>>>0?1:0),Ah=Yr+ar,G0=yi+ws+(Ah>>>0<Yr>>>0?1:0);Be=ae,be=ye,ae=ie,ye=$,ie=pe,$=ge,ge=G+Ls|0,pe=Fe+Vr+(ge>>>0<G>>>0?1:0)|0,Fe=Pe,G=Oe,Pe=me,Oe=Ee,me=Q,Ee=oe,oe=Ls+Ah|0,Q=Vr+G0+(oe>>>0<Ls>>>0?1:0)|0}D=b.low=D+oe,b.high=x+Q+(D>>>0<oe>>>0?1:0),P=E.low=P+Ee,E.high=I+me+(P>>>0<Ee>>>0?1:0),F=y.low=F+Oe,y.high=L+Pe+(F>>>0<Oe>>>0?1:0),B=T.low=B+G,T.high=V+Fe+(B>>>0<G>>>0?1:0),O=w.low=O+ge,w.high=k+pe+(O>>>0<ge>>>0?1:0),v=S.low=v+$,S.high=R+ie+(v>>>0<$>>>0?1:0),M=_.low=M+ye,_.high=j+ae+(M>>>0<ye>>>0?1:0),q=C.low=q+be,C.high=H+Be+(q>>>0<be>>>0?1:0)},_doFinalize:function(){var f=this._data,m=f.words,g=this._nDataBytes*8,b=f.sigBytes*8;m[b>>>5]|=128<<24-b%32,m[(b+128>>>10<<5)+30]=Math.floor(g/4294967296),m[(b+128>>>10<<5)+31]=g,f.sigBytes=m.length*4,this._process();var E=this._hash.toX32();return E},clone:function(){var f=n.clone.call(this);return f._hash=this._hash.clone(),f},blockSize:1024/32});r.SHA512=n._createHelper(d),r.HmacSHA512=n._createHmacHelper(d)})(),s.SHA512})}),bR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),jm(),A2()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./sha512"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.x64,n=i.Word,a=i.WordArray,o=r.algo,c=o.SHA512,l=o.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var u=c._doFinalize.call(this);return u.sigBytes-=16,u}});r.SHA384=c._createHelper(l),r.HmacSHA384=c._createHmacHelper(l)})(),s.SHA384})}),TR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),jm()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.x64,l=c.Word,u=i.algo,h=[],p=[],d=[];(function(){for(var g=1,b=0,E=0;E<24;E++){h[g+5*b]=(E+1)*(E+2)/2%64;var y=b%5,T=(2*g+3*b)%5;g=y,b=T}for(var g=0;g<5;g++)for(var b=0;b<5;b++)p[g+5*b]=b+(2*g+3*b)%5*5;for(var w=1,S=0;S<24;S++){for(var _=0,C=0,x=0;x<7;x++){if(w&1){var D=(1<<x)-1;D<32?C^=1<<D:_^=1<<D-32}w&128?w=w<<1^113:w<<=1}d[S]=l.create(_,C)}})();var f=[];(function(){for(var g=0;g<25;g++)f[g]=l.create()})();var m=u.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],b=0;b<25;b++)g[b]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,b){for(var E=this._state,y=this.blockSize/2,T=0;T<y;T++){var w=g[b+2*T],S=g[b+2*T+1];w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,S=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360;var _=E[T];_.high^=S,_.low^=w}for(var C=0;C<24;C++){for(var x=0;x<5;x++){for(var D=0,I=0,P=0;P<5;P++){var _=E[x+5*P];D^=_.high,I^=_.low}var L=f[x];L.high=D,L.low=I}for(var x=0;x<5;x++)for(var F=f[(x+4)%5],V=f[(x+1)%5],B=V.high,k=V.low,D=F.high^(B<<1|k>>>31),I=F.low^(k<<1|B>>>31),P=0;P<5;P++){var _=E[x+5*P];_.high^=D,_.low^=I}for(var O=1;O<25;O++){var D,I,_=E[O],R=_.high,v=_.low,j=h[O];j<32?(D=R<<j|v>>>32-j,I=v<<j|R>>>32-j):(D=v<<j-32|R>>>64-j,I=R<<j-32|v>>>64-j);var M=f[p[O]];M.high=D,M.low=I}var H=f[0],q=E[0];H.high=q.high,H.low=q.low;for(var x=0;x<5;x++)for(var P=0;P<5;P++){var O=x+5*P,_=E[O],Q=f[O],oe=f[(x+1)%5+5*P],me=f[(x+2)%5+5*P];_.high=Q.high^~oe.high&me.high,_.low=Q.low^~oe.low&me.low}var _=E[0],Ee=d[C];_.high^=Ee.high,_.low^=Ee.low}},_doFinalize:function(){var g=this._data,b=g.words,E=this._nDataBytes*8,y=g.sigBytes*8,T=this.blockSize*32;b[y>>>5]|=1<<24-y%32,b[(r.ceil((y+1)/T)*T>>>5)-1]|=128,g.sigBytes=b.length*4,this._process();for(var w=this._state,S=this.cfg.outputLength/8,_=S/8,C=[],x=0;x<_;x++){var D=w[x],I=D.high,P=D.low;I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,P=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360,C.push(P),C.push(I)}return new a.init(C,S)},clone:function(){for(var g=o.clone.call(this),b=g._state=this._state.slice(0),E=0;E<25;E++)b[E]=b[E].clone();return g}});i.SHA3=o._createHelper(m),i.HmacSHA3=o._createHmacHelper(m)})(Math),s.SHA3})}),wR=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.algo,l=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),u=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),h=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),p=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=a.create([0,1518500249,1859775393,2400959708,2840853838]),f=a.create([1352829926,1548603684,1836072691,2053994217,0]),m=c.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(S,_){for(var C=0;C<16;C++){var x=_+C,D=S[x];S[x]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360}var I=this._hash.words,P=d.words,L=f.words,F=l.words,V=u.words,B=h.words,k=p.words,O,R,v,j,M,H,q,Q,oe,me;H=O=I[0],q=R=I[1],Q=v=I[2],oe=j=I[3],me=M=I[4];for(var Ee,C=0;C<80;C+=1)Ee=O+S[_+F[C]]|0,C<16?Ee+=g(R,v,j)+P[0]:C<32?Ee+=b(R,v,j)+P[1]:C<48?Ee+=E(R,v,j)+P[2]:C<64?Ee+=y(R,v,j)+P[3]:Ee+=T(R,v,j)+P[4],Ee=Ee|0,Ee=w(Ee,B[C]),Ee=Ee+M|0,O=M,M=j,j=w(v,10),v=R,R=Ee,Ee=H+S[_+V[C]]|0,C<16?Ee+=T(q,Q,oe)+L[0]:C<32?Ee+=y(q,Q,oe)+L[1]:C<48?Ee+=E(q,Q,oe)+L[2]:C<64?Ee+=b(q,Q,oe)+L[3]:Ee+=g(q,Q,oe)+L[4],Ee=Ee|0,Ee=w(Ee,k[C]),Ee=Ee+me|0,H=me,me=oe,oe=w(Q,10),Q=q,q=Ee;Ee=I[1]+v+oe|0,I[1]=I[2]+j+me|0,I[2]=I[3]+M+H|0,I[3]=I[4]+O+q|0,I[4]=I[0]+R+Q|0,I[0]=Ee},_doFinalize:function(){var S=this._data,_=S.words,C=this._nDataBytes*8,x=S.sigBytes*8;_[x>>>5]|=128<<24-x%32,_[(x+64>>>9<<4)+14]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,S.sigBytes=(_.length+1)*4,this._process();for(var D=this._hash,I=D.words,P=0;P<5;P++){var L=I[P];I[P]=(L<<8|L>>>24)&16711935|(L<<24|L>>>8)&4278255360}return D},clone:function(){var S=o.clone.call(this);return S._hash=this._hash.clone(),S}});function g(S,_,C){return S^_^C}function b(S,_,C){return S&_|~S&C}function E(S,_,C){return(S|~_)^C}function y(S,_,C){return S&C|_&~C}function T(S,_,C){return S^(_|~C)}function w(S,_){return S<<_|S>>>32-_}i.RIPEMD160=o._createHelper(m),i.HmacRIPEMD160=o._createHmacHelper(m)})(Math),s.RIPEMD160})}),Z1=Nt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r(Jt()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){(function(){var r=s,i=r.lib,n=i.Base,a=r.enc,o=a.Utf8,c=r.algo,l=c.HMAC=n.extend({init:function(u,h){u=this._hasher=new u.init,typeof h=="string"&&(h=o.parse(h));var p=u.blockSize,d=p*4;h.sigBytes>d&&(h=u.finalize(h)),h.clamp();for(var f=this._oKey=h.clone(),m=this._iKey=h.clone(),g=f.words,b=m.words,E=0;E<p;E++)g[E]^=1549556828,b[E]^=909522486;f.sigBytes=m.sigBytes=d,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var h=this._hasher,p=h.finalize(u);h.reset();var d=h.finalize(this._oKey.clone().concat(p));return d}})})()})}),SR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),X1(),Z1()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.Base,a=i.WordArray,o=r.algo,c=o.SHA256,l=o.HMAC,u=o.PBKDF2=n.extend({cfg:n.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,p){for(var d=this.cfg,f=l.create(d.hasher,h),m=a.create(),g=a.create([1]),b=m.words,E=g.words,y=d.keySize,T=d.iterations;b.length<y;){var w=f.update(p).finalize(g);f.reset();for(var S=w.words,_=S.length,C=w,x=1;x<T;x++){C=f.finalize(C),f.reset();for(var D=C.words,I=0;I<_;I++)S[I]^=D[I]}m.concat(w),E[0]++}return m.sigBytes=y*4,m}});r.PBKDF2=function(h,p,d){return u.create(d).compute(h,p)}})(),s.PBKDF2})}),Uo=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),_2(),Z1()):typeof define=="function"&&define.amd?define(["./core","./sha1","./hmac"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.Base,a=i.WordArray,o=r.algo,c=o.MD5,l=o.EvpKDF=n.extend({cfg:n.extend({keySize:128/32,hasher:c,iterations:1}),init:function(u){this.cfg=this.cfg.extend(u)},compute:function(u,h){for(var p,d=this.cfg,f=d.hasher.create(),m=a.create(),g=m.words,b=d.keySize,E=d.iterations;g.length<b;){p&&f.update(p),p=f.update(u).finalize(h),f.reset();for(var y=1;y<E;y++)p=f.finalize(p),f.reset();m.concat(p)}return m.sigBytes=b*4,m}});r.EvpKDF=function(u,h,p){return l.create(p).compute(u,h)}})(),s.EvpKDF})}),Br=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Uo()):typeof define=="function"&&define.amd?define(["./core","./evpkdf"],r):r(s.CryptoJS)})(e,function(s){s.lib.Cipher||(function(r){var i=s,n=i.lib,a=n.Base,o=n.WordArray,c=n.BufferedBlockAlgorithm,l=i.enc,u=l.Utf8,h=l.Base64,p=i.algo,d=p.EvpKDF,f=n.Cipher=c.extend({cfg:a.extend(),createEncryptor:function(L,F){return this.create(this._ENC_XFORM_MODE,L,F)},createDecryptor:function(L,F){return this.create(this._DEC_XFORM_MODE,L,F)},init:function(L,F,V){this.cfg=this.cfg.extend(V),this._xformMode=L,this._key=F,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(L){return this._append(L),this._process()},finalize:function(L){L&&this._append(L);var F=this._doFinalize();return F},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function L(F){return typeof F=="string"?P:x}return function(F){return{encrypt:function(V,B,k){return L(B).encrypt(F,V,B,k)},decrypt:function(V,B,k){return L(B).decrypt(F,V,B,k)}}}})()}),m=n.StreamCipher=f.extend({_doFinalize:function(){var L=this._process(!0);return L},blockSize:1}),g=i.mode={},b=n.BlockCipherMode=a.extend({createEncryptor:function(L,F){return this.Encryptor.create(L,F)},createDecryptor:function(L,F){return this.Decryptor.create(L,F)},init:function(L,F){this._cipher=L,this._iv=F}}),E=g.CBC=(function(){var L=b.extend();L.Encryptor=L.extend({processBlock:function(V,B){var k=this._cipher,O=k.blockSize;F.call(this,V,B,O),k.encryptBlock(V,B),this._prevBlock=V.slice(B,B+O)}}),L.Decryptor=L.extend({processBlock:function(V,B){var k=this._cipher,O=k.blockSize,R=V.slice(B,B+O);k.decryptBlock(V,B),F.call(this,V,B,O),this._prevBlock=R}});function F(V,B,k){var O,R=this._iv;R?(O=R,this._iv=r):O=this._prevBlock;for(var v=0;v<k;v++)V[B+v]^=O[v]}return L})(),y=i.pad={},T=y.Pkcs7={pad:function(L,F){for(var V=F*4,B=V-L.sigBytes%V,k=B<<24|B<<16|B<<8|B,O=[],R=0;R<B;R+=4)O.push(k);var v=o.create(O,B);L.concat(v)},unpad:function(L){var F=L.words[L.sigBytes-1>>>2]&255;L.sigBytes-=F}},w=n.BlockCipher=f.extend({cfg:f.cfg.extend({mode:E,padding:T}),reset:function(){var L;f.reset.call(this);var F=this.cfg,V=F.iv,B=F.mode;this._xformMode==this._ENC_XFORM_MODE?L=B.createEncryptor:(L=B.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==L?this._mode.init(this,V&&V.words):(this._mode=L.call(B,this,V&&V.words),this._mode.__creator=L)},_doProcessBlock:function(L,F){this._mode.processBlock(L,F)},_doFinalize:function(){var L,F=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(F.pad(this._data,this.blockSize),L=this._process(!0)):(L=this._process(!0),F.unpad(L)),L},blockSize:128/32}),S=n.CipherParams=a.extend({init:function(L){this.mixIn(L)},toString:function(L){return(L||this.formatter).stringify(this)}}),_=i.format={},C=_.OpenSSL={stringify:function(L){var F,V=L.ciphertext,B=L.salt;return B?F=o.create([1398893684,1701076831]).concat(B).concat(V):F=V,F.toString(h)},parse:function(L){var F,V=h.parse(L),B=V.words;return B[0]==1398893684&&B[1]==1701076831&&(F=o.create(B.slice(2,4)),B.splice(0,4),V.sigBytes-=16),S.create({ciphertext:V,salt:F})}},x=n.SerializableCipher=a.extend({cfg:a.extend({format:C}),encrypt:function(L,F,V,B){B=this.cfg.extend(B);var k=L.createEncryptor(V,B),O=k.finalize(F),R=k.cfg;return S.create({ciphertext:O,key:V,iv:R.iv,algorithm:L,mode:R.mode,padding:R.padding,blockSize:L.blockSize,formatter:B.format})},decrypt:function(L,F,V,B){B=this.cfg.extend(B),F=this._parse(F,B.format);var k=L.createDecryptor(V,B).finalize(F.ciphertext);return k},_parse:function(L,F){return typeof L=="string"?F.parse(L,this):L}}),D=i.kdf={},I=D.OpenSSL={execute:function(L,F,V,B,k){if(B||(B=o.random(64/8)),k)var O=d.create({keySize:F+V,hasher:k}).compute(L,B);else var O=d.create({keySize:F+V}).compute(L,B);var R=o.create(O.words.slice(F),V*4);return O.sigBytes=F*4,S.create({key:O,iv:R,salt:B})}},P=n.PasswordBasedCipher=x.extend({cfg:x.cfg.extend({kdf:I}),encrypt:function(L,F,V,B){B=this.cfg.extend(B);var k=B.kdf.execute(V,L.keySize,L.ivSize,B.salt,B.hasher);B.iv=k.iv;var O=x.encrypt.call(this,L,F,k.key,B);return O.mixIn(k),O},decrypt:function(L,F,V,B){B=this.cfg.extend(B),F=this._parse(F,B.format);var k=B.kdf.execute(V,L.keySize,L.ivSize,F.salt,B.hasher);B.iv=k.iv;var O=x.decrypt.call(this,L,F,k.key,B);return O}})})()})}),_R=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.CFB=(function(){var r=s.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize;i.call(this,n,a,c,o),this._prevBlock=n.slice(a,a+c)}}),r.Decryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize,l=n.slice(a,a+c);i.call(this,n,a,c,o),this._prevBlock=l}});function i(n,a,o,c){var l,u=this._iv;u?(l=u.slice(0),this._iv=void 0):l=this._prevBlock,c.encryptBlock(l,0);for(var h=0;h<o;h++)n[a+h]^=l[h]}return r})(),s.mode.CFB})}),AR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.CTR=(function(){var r=s.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize,l=this._iv,u=this._counter;l&&(u=this._counter=l.slice(0),this._iv=void 0);var h=u.slice(0);o.encryptBlock(h,0),u[c-1]=u[c-1]+1|0;for(var p=0;p<c;p++)n[a+p]^=h[p]}});return r.Decryptor=i,r})(),s.mode.CTR})}),CR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.CTRGladman=(function(){var r=s.lib.BlockCipherMode.extend();function i(o){if((o>>24&255)===255){var c=o>>16&255,l=o>>8&255,u=o&255;c===255?(c=0,l===255?(l=0,u===255?u=0:++u):++l):++c,o=0,o+=c<<16,o+=l<<8,o+=u}else o+=1<<24;return o}function n(o){return(o[0]=i(o[0]))===0&&(o[1]=i(o[1])),o}var a=r.Encryptor=r.extend({processBlock:function(o,c){var l=this._cipher,u=l.blockSize,h=this._iv,p=this._counter;h&&(p=this._counter=h.slice(0),this._iv=void 0),n(p);var d=p.slice(0);l.encryptBlock(d,0);for(var f=0;f<u;f++)o[c+f]^=d[f]}});return r.Decryptor=a,r})(),s.mode.CTRGladman})}),DR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.OFB=(function(){var r=s.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize,l=this._iv,u=this._keystream;l&&(u=this._keystream=l.slice(0),this._iv=void 0),o.encryptBlock(u,0);for(var h=0;h<c;h++)n[a+h]^=u[h]}});return r.Decryptor=i,r})(),s.mode.OFB})}),PR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.ECB=(function(){var r=s.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(i,n){this._cipher.encryptBlock(i,n)}}),r.Decryptor=r.extend({processBlock:function(i,n){this._cipher.decryptBlock(i,n)}}),r})(),s.mode.ECB})}),OR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.AnsiX923={pad:function(r,i){var n=r.sigBytes,a=i*4,o=a-n%a,c=n+o-1;r.clamp(),r.words[c>>>2]|=o<<24-c%4*8,r.sigBytes+=o},unpad:function(r){var i=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=i}},s.pad.Ansix923})}),IR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.Iso10126={pad:function(r,i){var n=i*4,a=n-r.sigBytes%n;r.concat(s.lib.WordArray.random(a-1)).concat(s.lib.WordArray.create([a<<24],1))},unpad:function(r){var i=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=i}},s.pad.Iso10126})}),xR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.Iso97971={pad:function(r,i){r.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(r,i)},unpad:function(r){s.pad.ZeroPadding.unpad(r),r.sigBytes--}},s.pad.Iso97971})}),vR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.ZeroPadding={pad:function(r,i){var n=i*4;r.clamp(),r.sigBytes+=n-(r.sigBytes%n||n)},unpad:function(r){for(var i=r.words,n=r.sigBytes-1,n=r.sigBytes-1;n>=0;n--)if(i[n>>>2]>>>24-n%4*8&255){r.sigBytes=n+1;break}}},s.pad.ZeroPadding})}),RR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.NoPadding={pad:function(){},unpad:function(){}},s.pad.NoPadding})}),NR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Br()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.CipherParams,o=i.enc,c=o.Hex,l=i.format,u=l.Hex={stringify:function(h){return h.ciphertext.toString(c)},parse:function(h){var p=c.parse(h);return a.create({ciphertext:p})}}})(),s.format.Hex})}),LR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Mc(),jc(),Uo(),Br()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.BlockCipher,a=r.algo,o=[],c=[],l=[],u=[],h=[],p=[],d=[],f=[],m=[],g=[];(function(){for(var y=[],T=0;T<256;T++)T<128?y[T]=T<<1:y[T]=T<<1^283;for(var w=0,S=0,T=0;T<256;T++){var _=S^S<<1^S<<2^S<<3^S<<4;_=_>>>8^_&255^99,o[w]=_,c[_]=w;var C=y[w],x=y[C],D=y[x],I=y[_]*257^_*16843008;l[w]=I<<24|I>>>8,u[w]=I<<16|I>>>16,h[w]=I<<8|I>>>24,p[w]=I;var I=D*16843009^x*65537^C*257^w*16843008;d[_]=I<<24|I>>>8,f[_]=I<<16|I>>>16,m[_]=I<<8|I>>>24,g[_]=I,w?(w=C^y[y[y[D^C]]],S^=y[y[S]]):w=S=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],E=a.AES=n.extend({_doReset:function(){var y;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var T=this._keyPriorReset=this._key,w=T.words,S=T.sigBytes/4,_=this._nRounds=S+6,C=(_+1)*4,x=this._keySchedule=[],D=0;D<C;D++)D<S?x[D]=w[D]:(y=x[D-1],D%S?S>6&&D%S==4&&(y=o[y>>>24]<<24|o[y>>>16&255]<<16|o[y>>>8&255]<<8|o[y&255]):(y=y<<8|y>>>24,y=o[y>>>24]<<24|o[y>>>16&255]<<16|o[y>>>8&255]<<8|o[y&255],y^=b[D/S|0]<<24),x[D]=x[D-S]^y);for(var I=this._invKeySchedule=[],P=0;P<C;P++){var D=C-P;if(P%4)var y=x[D];else var y=x[D-4];P<4||D<=4?I[P]=y:I[P]=d[o[y>>>24]]^f[o[y>>>16&255]]^m[o[y>>>8&255]]^g[o[y&255]]}}},encryptBlock:function(y,T){this._doCryptBlock(y,T,this._keySchedule,l,u,h,p,o)},decryptBlock:function(y,T){var w=y[T+1];y[T+1]=y[T+3],y[T+3]=w,this._doCryptBlock(y,T,this._invKeySchedule,d,f,m,g,c);var w=y[T+1];y[T+1]=y[T+3],y[T+3]=w},_doCryptBlock:function(y,T,w,S,_,C,x,D){for(var I=this._nRounds,P=y[T]^w[0],L=y[T+1]^w[1],F=y[T+2]^w[2],V=y[T+3]^w[3],B=4,k=1;k<I;k++){var O=S[P>>>24]^_[L>>>16&255]^C[F>>>8&255]^x[V&255]^w[B++],R=S[L>>>24]^_[F>>>16&255]^C[V>>>8&255]^x[P&255]^w[B++],v=S[F>>>24]^_[V>>>16&255]^C[P>>>8&255]^x[L&255]^w[B++],j=S[V>>>24]^_[P>>>16&255]^C[L>>>8&255]^x[F&255]^w[B++];P=O,L=R,F=v,V=j}var O=(D[P>>>24]<<24|D[L>>>16&255]<<16|D[F>>>8&255]<<8|D[V&255])^w[B++],R=(D[L>>>24]<<24|D[F>>>16&255]<<16|D[V>>>8&255]<<8|D[P&255])^w[B++],v=(D[F>>>24]<<24|D[V>>>16&255]<<16|D[P>>>8&255]<<8|D[L&255])^w[B++],j=(D[V>>>24]<<24|D[P>>>16&255]<<16|D[L>>>8&255]<<8|D[F&255])^w[B++];y[T]=O,y[T+1]=R,y[T+2]=v,y[T+3]=j},keySize:256/32});r.AES=n._createHelper(E)})(),s.AES})}),BR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Mc(),jc(),Uo(),Br()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=i.BlockCipher,o=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],p=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=a.extend({_doReset:function(){for(var b=this._key,E=b.words,y=[],T=0;T<56;T++){var w=c[T]-1;y[T]=E[w>>>5]>>>31-w%32&1}for(var S=this._subKeys=[],_=0;_<16;_++){for(var C=S[_]=[],x=u[_],T=0;T<24;T++)C[T/6|0]|=y[(l[T]-1+x)%28]<<31-T%6,C[4+(T/6|0)]|=y[28+(l[T+24]-1+x)%28]<<31-T%6;C[0]=C[0]<<1|C[0]>>>31;for(var T=1;T<7;T++)C[T]=C[T]>>>(T-1)*4+3;C[7]=C[7]<<5|C[7]>>>27}for(var D=this._invSubKeys=[],T=0;T<16;T++)D[T]=S[15-T]},encryptBlock:function(b,E){this._doCryptBlock(b,E,this._subKeys)},decryptBlock:function(b,E){this._doCryptBlock(b,E,this._invSubKeys)},_doCryptBlock:function(b,E,y){this._lBlock=b[E],this._rBlock=b[E+1],f.call(this,4,252645135),f.call(this,16,65535),m.call(this,2,858993459),m.call(this,8,16711935),f.call(this,1,1431655765);for(var T=0;T<16;T++){for(var w=y[T],S=this._lBlock,_=this._rBlock,C=0,x=0;x<8;x++)C|=h[x][((_^w[x])&p[x])>>>0];this._lBlock=_,this._rBlock=S^C}var D=this._lBlock;this._lBlock=this._rBlock,this._rBlock=D,f.call(this,1,1431655765),m.call(this,8,16711935),m.call(this,2,858993459),f.call(this,16,65535),f.call(this,4,252645135),b[E]=this._lBlock,b[E+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function f(b,E){var y=(this._lBlock>>>b^this._rBlock)&E;this._rBlock^=y,this._lBlock^=y<<b}function m(b,E){var y=(this._rBlock>>>b^this._lBlock)&E;this._lBlock^=y,this._rBlock^=y<<b}r.DES=a._createHelper(d);var g=o.TripleDES=a.extend({_doReset:function(){var b=this._key,E=b.words;if(E.length!==2&&E.length!==4&&E.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var y=E.slice(0,2),T=E.length<4?E.slice(0,2):E.slice(2,4),w=E.length<6?E.slice(0,2):E.slice(4,6);this._des1=d.createEncryptor(n.create(y)),this._des2=d.createEncryptor(n.create(T)),this._des3=d.createEncryptor(n.create(w))},encryptBlock:function(b,E){this._des1.encryptBlock(b,E),this._des2.decryptBlock(b,E),this._des3.encryptBlock(b,E)},decryptBlock:function(b,E){this._des3.decryptBlock(b,E),this._des2.encryptBlock(b,E),this._des1.decryptBlock(b,E)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=a._createHelper(g)})(),s.TripleDES})}),kR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Mc(),jc(),Uo(),Br()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.StreamCipher,a=r.algo,o=a.RC4=n.extend({_doReset:function(){for(var u=this._key,h=u.words,p=u.sigBytes,d=this._S=[],f=0;f<256;f++)d[f]=f;for(var f=0,m=0;f<256;f++){var g=f%p,b=h[g>>>2]>>>24-g%4*8&255;m=(m+d[f]+b)%256;var E=d[f];d[f]=d[m],d[m]=E}this._i=this._j=0},_doProcessBlock:function(u,h){u[h]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var u=this._S,h=this._i,p=this._j,d=0,f=0;f<4;f++){h=(h+1)%256,p=(p+u[h])%256;var m=u[h];u[h]=u[p],u[p]=m,d|=u[(u[h]+u[p])%256]<<24-f*8}return this._i=h,this._j=p,d}r.RC4=n._createHelper(o);var l=a.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var u=this.cfg.drop;u>0;u--)c.call(this)}});r.RC4Drop=n._createHelper(l)})(),s.RC4})}),MR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Mc(),jc(),Uo(),Br()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.StreamCipher,a=r.algo,o=[],c=[],l=[],u=a.Rabbit=n.extend({_doReset:function(){for(var p=this._key.words,d=this.cfg.iv,f=0;f<4;f++)p[f]=(p[f]<<8|p[f]>>>24)&16711935|(p[f]<<24|p[f]>>>8)&4278255360;var m=this._X=[p[0],p[3]<<16|p[2]>>>16,p[1],p[0]<<16|p[3]>>>16,p[2],p[1]<<16|p[0]>>>16,p[3],p[2]<<16|p[1]>>>16],g=this._C=[p[2]<<16|p[2]>>>16,p[0]&4294901760|p[1]&65535,p[3]<<16|p[3]>>>16,p[1]&4294901760|p[2]&65535,p[0]<<16|p[0]>>>16,p[2]&4294901760|p[3]&65535,p[1]<<16|p[1]>>>16,p[3]&4294901760|p[0]&65535];this._b=0;for(var f=0;f<4;f++)h.call(this);for(var f=0;f<8;f++)g[f]^=m[f+4&7];if(d){var b=d.words,E=b[0],y=b[1],T=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,w=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S=T>>>16|w&4294901760,_=w<<16|T&65535;g[0]^=T,g[1]^=S,g[2]^=w,g[3]^=_,g[4]^=T,g[5]^=S,g[6]^=w,g[7]^=_;for(var f=0;f<4;f++)h.call(this)}},_doProcessBlock:function(p,d){var f=this._X;h.call(this),o[0]=f[0]^f[5]>>>16^f[3]<<16,o[1]=f[2]^f[7]>>>16^f[5]<<16,o[2]=f[4]^f[1]>>>16^f[7]<<16,o[3]=f[6]^f[3]>>>16^f[1]<<16;for(var m=0;m<4;m++)o[m]=(o[m]<<8|o[m]>>>24)&16711935|(o[m]<<24|o[m]>>>8)&4278255360,p[d+m]^=o[m]},blockSize:128/32,ivSize:64/32});function h(){for(var p=this._X,d=this._C,f=0;f<8;f++)c[f]=d[f];d[0]=d[0]+1295307597+this._b|0,d[1]=d[1]+3545052371+(d[0]>>>0<c[0]>>>0?1:0)|0,d[2]=d[2]+886263092+(d[1]>>>0<c[1]>>>0?1:0)|0,d[3]=d[3]+1295307597+(d[2]>>>0<c[2]>>>0?1:0)|0,d[4]=d[4]+3545052371+(d[3]>>>0<c[3]>>>0?1:0)|0,d[5]=d[5]+886263092+(d[4]>>>0<c[4]>>>0?1:0)|0,d[6]=d[6]+1295307597+(d[5]>>>0<c[5]>>>0?1:0)|0,d[7]=d[7]+3545052371+(d[6]>>>0<c[6]>>>0?1:0)|0,this._b=d[7]>>>0<c[7]>>>0?1:0;for(var f=0;f<8;f++){var m=p[f]+d[f],g=m&65535,b=m>>>16,E=((g*g>>>17)+g*b>>>15)+b*b,y=((m&4294901760)*m|0)+((m&65535)*m|0);l[f]=E^y}p[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,p[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,p[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,p[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,p[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,p[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,p[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,p[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.Rabbit=n._createHelper(u)})(),s.Rabbit})}),jR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Mc(),jc(),Uo(),Br()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.StreamCipher,a=r.algo,o=[],c=[],l=[],u=a.RabbitLegacy=n.extend({_doReset:function(){var p=this._key.words,d=this.cfg.iv,f=this._X=[p[0],p[3]<<16|p[2]>>>16,p[1],p[0]<<16|p[3]>>>16,p[2],p[1]<<16|p[0]>>>16,p[3],p[2]<<16|p[1]>>>16],m=this._C=[p[2]<<16|p[2]>>>16,p[0]&4294901760|p[1]&65535,p[3]<<16|p[3]>>>16,p[1]&4294901760|p[2]&65535,p[0]<<16|p[0]>>>16,p[2]&4294901760|p[3]&65535,p[1]<<16|p[1]>>>16,p[3]&4294901760|p[0]&65535];this._b=0;for(var g=0;g<4;g++)h.call(this);for(var g=0;g<8;g++)m[g]^=f[g+4&7];if(d){var b=d.words,E=b[0],y=b[1],T=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,w=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S=T>>>16|w&4294901760,_=w<<16|T&65535;m[0]^=T,m[1]^=S,m[2]^=w,m[3]^=_,m[4]^=T,m[5]^=S,m[6]^=w,m[7]^=_;for(var g=0;g<4;g++)h.call(this)}},_doProcessBlock:function(p,d){var f=this._X;h.call(this),o[0]=f[0]^f[5]>>>16^f[3]<<16,o[1]=f[2]^f[7]>>>16^f[5]<<16,o[2]=f[4]^f[1]>>>16^f[7]<<16,o[3]=f[6]^f[3]>>>16^f[1]<<16;for(var m=0;m<4;m++)o[m]=(o[m]<<8|o[m]>>>24)&16711935|(o[m]<<24|o[m]>>>8)&4278255360,p[d+m]^=o[m]},blockSize:128/32,ivSize:64/32});function h(){for(var p=this._X,d=this._C,f=0;f<8;f++)c[f]=d[f];d[0]=d[0]+1295307597+this._b|0,d[1]=d[1]+3545052371+(d[0]>>>0<c[0]>>>0?1:0)|0,d[2]=d[2]+886263092+(d[1]>>>0<c[1]>>>0?1:0)|0,d[3]=d[3]+1295307597+(d[2]>>>0<c[2]>>>0?1:0)|0,d[4]=d[4]+3545052371+(d[3]>>>0<c[3]>>>0?1:0)|0,d[5]=d[5]+886263092+(d[4]>>>0<c[4]>>>0?1:0)|0,d[6]=d[6]+1295307597+(d[5]>>>0<c[5]>>>0?1:0)|0,d[7]=d[7]+3545052371+(d[6]>>>0<c[6]>>>0?1:0)|0,this._b=d[7]>>>0<c[7]>>>0?1:0;for(var f=0;f<8;f++){var m=p[f]+d[f],g=m&65535,b=m>>>16,E=((g*g>>>17)+g*b>>>15)+b*b,y=((m&4294901760)*m|0)+((m&65535)*m|0);l[f]=E^y}p[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,p[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,p[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,p[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,p[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,p[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,p[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,p[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.RabbitLegacy=n._createHelper(u)})(),s.RabbitLegacy})}),FR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),Mc(),jc(),Uo(),Br()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.BlockCipher,a=r.algo;let o=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],l=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var u={pbox:[],sbox:[]};function h(g,b){let E=b>>24&255,y=b>>16&255,T=b>>8&255,w=b&255,S=g.sbox[0][E]+g.sbox[1][y];return S=S^g.sbox[2][T],S=S+g.sbox[3][w],S}function p(g,b,E){let y=b,T=E,w;for(let S=0;S<o;++S)y=y^g.pbox[S],T=h(g,y)^T,w=y,y=T,T=w;return w=y,y=T,T=w,T=T^g.pbox[o],y=y^g.pbox[o+1],{left:y,right:T}}function d(g,b,E){let y=b,T=E,w;for(let S=o+1;S>1;--S)y=y^g.pbox[S],T=h(g,y)^T,w=y,y=T,T=w;return w=y,y=T,T=w,T=T^g.pbox[1],y=y^g.pbox[0],{left:y,right:T}}function f(g,b,E){for(let _=0;_<4;_++){g.sbox[_]=[];for(let C=0;C<256;C++)g.sbox[_][C]=l[_][C]}let y=0;for(let _=0;_<o+2;_++)g.pbox[_]=c[_]^b[y],y++,y>=E&&(y=0);let T=0,w=0,S=0;for(let _=0;_<o+2;_+=2)S=p(g,T,w),T=S.left,w=S.right,g.pbox[_]=T,g.pbox[_+1]=w;for(let _=0;_<4;_++)for(let C=0;C<256;C+=2)S=p(g,T,w),T=S.left,w=S.right,g.sbox[_][C]=T,g.sbox[_][C+1]=w;return!0}var m=a.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,b=g.words,E=g.sigBytes/4;f(u,b,E)}},encryptBlock:function(g,b){var E=p(u,g[b],g[b+1]);g[b]=E.left,g[b+1]=E.right},decryptBlock:function(g,b){var E=d(u,g[b],g[b+1]);g[b]=E.left,g[b+1]=E.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=n._createHelper(m)})(),s.Blowfish})}),UR=Nt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r(Jt(),jm(),mR(),gR(),Mc(),yR(),jc(),_2(),X1(),ER(),A2(),bR(),TR(),wR(),Z1(),SR(),Uo(),Br(),_R(),AR(),CR(),DR(),PR(),OR(),IR(),xR(),vR(),RR(),NR(),LR(),BR(),kR(),MR(),jR(),FR()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./enc-base64url","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy","./blowfish"],r):s.CryptoJS=r(s.CryptoJS)})(e,function(s){return s})}),HR=(e=>(e.Device="Device",e.Symbol="Symbol",e.Footprint="Footprint",e.OBJ="OBJ",e.ModelID="3D Model",e.ModelName="3D Model Title",e.OriginModelName="Origin 3D Model Title",e.ModelTransform="3D Model Transform",e.OriginFootprint="Origin Footprint",e))(HR||{}),Yh=(e=>(e.DOCHEAD="DOCHEAD",e.EDIT_HEAD="EDIT_HEAD",e.SCH="SCH",e.SCH_PAGE="SCH_PAGE",e.PCB="PCB",e.PANEL="PANEL",e.PANEL_LIB="PANEL_LIB",e.SYMBOL="SYMBOL",e.FOOTPRINT="FOOTPRINT",e.DEVICE="DEVICE",e.BLOB="BLOB",e.INSTANCE="INSTANCE",e.CONFIG="CONFIG",e.BOARD="BOARD",e.FONT="FONT",e.VARIANT="VARIANT",e.COMPONENT_GROUP="COMPONENT_GROUP",e.COMPONENT_GROUP_DATA="COMPONENT_GROUP_DATA",e.SIMULATION="SIMULATION",e))(Yh||{}),GR=(e=>(e.META="META",e.META_SORT="META_SORT",e.META_CREATE="META_CREATE",e.META_MODIFY="META_MODIFY",e.FONT="FONT",e.BLOB="BLOB",e.MAX_NUM="MAX_NUM",e.INSTANCE_ATTR="INSTANCE_ATTR",e.DELETE_DOC="DELETE_DOC",e.META_Z_INDEX="META_Z_INDEX",e.VARIANT_GROUPED="VARIANT_GROUPED",e.GROUP_INDEX="GROUP_INDEX",e.GROUP_DATA="GROUP_DATA",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.META_PLACEHOLDER="META_PLACEHOLDER",e))(GR||{}),xn="||",tr=`|
`;function Vh(e,t,s){return e.slice(t,s)}function gm(e,t,s){let r=e.length,i=0;for(;i<r;){let n=e.indexOf(tr,i);if(n<0){if(s)return e.substring(i);n=r}let a=Vh(e,i,n);try{if(a){let o=a.indexOf(xn),c=o>-1,l=c?Vh(a,0,o):a,u=c?Vh(a,o+xn.length):"";if(t(l,u,a,c?i+o+xn.length:i)===!1){a=null;break}a=null}}catch(o){console.error(o)}i=n+tr.length}e=null}var YR=["SYMBOL","FOOTPRINT","BLOB","FONT","PANEL_LIB","DEVICE","BOARD","INSTANCE","CONFIG","VARIANT","COMPONENT_GROUP","COMPONENT_GROUP_DATA"];function $0(e,t){return YR.includes(t)?t:e}var VR=class{parseFull(e,t,s){let r=t,i=s,n,a=null;gm(e,(o,c,l)=>{let u=JSON.parse(o);if(u.type==="EDIT_HEAD")a=JSON.parse(c),this.onEditHead&&this.onEditHead(a);else if(u.type==="DOCHEAD"){let h=JSON.parse(c);i=h.docType,r=h.uuid,n=h.client,h.ticket=u.ticket,this.onDocHead(h,a,l)}else this.onLine(u.id,u.ticket,c,u.type,u.client||n,i,r,u.firstTicket,u.pend,a,u.num,l)}),this.onEnd(),e=null}flowParseFull(e={}){let{cache:t,chunkLength:s=100*1024*1024,idsData:r,history:i}=e,n="",a=null,o,c=null,l=!0,u="",h=0,p=!1,d={},f=t?{}:void 0,m=E=>{f[E]===void 0&&(f[E]=-1),t(E,++f[E],d[E].data.join(tr)),d[E].data.length=0,d[E].size=0,d[E].data.push(d[E].head),d[E].size+=d[E].head.length},g=E=>{let y=$0(n,a);t&&(d[y].data.push(E),d[y].size+=(d[y].size?tr.length:0)+E.length,d[y].size+E.length>s&&m(y))},b=(E,y)=>gm(E,(T,w,S,_)=>{var x,D,I,P,L,F,V,B;let C=JSON.parse(T);if(C.type==="EDIT_HEAD")c=JSON.parse(w),(x=this.onEditHead)==null||x.call(this,c),(D=e.onEditHead)==null||D.call(e,c),p=!0;else if(C.type==="DOCHEAD"){let k=JSON.parse(w);a=k.docType,n=k.uuid,o=k.client,k.ticket=C.ticket,p||(c={uuid:k.uuid,username:(I=k==null?void 0:k.user)==null?void 0:I.username,nickname:(P=k==null?void 0:k.user)==null?void 0:P.nickname,updateTime:k==null?void 0:k.updateTime},(L=e.onEditHead)==null||L.call(e,c),p=!0),this.onDocHead(k,c,S);let O=$0(n,a);t&&!d[O]&&(d[O]={size:0,data:[],head:""}),t&&(d[O].head=S),g(S)}else{let k=C.num,O=C.client||o;if(r){let R=(B=(V=(F=r.ids)==null?void 0:F[n])==null?void 0:V[O])==null?void 0:B[C.id];if(!R||R[0]!==C.ticket)return;k=R[1],r.size-=1,delete r.ids[n][O][C.id]}if(i){let R=$0(n,a);t&&(i.dNum=(f==null?void 0:f[R])===void 0?0:(f==null?void 0:f[R])+1),i.start=t?d[R].size+tr.length+T.length+xn.length:h+_}this.onLine(C.id,C.ticket,w,C.type,O,a,n,C.firstTicket,C.pend,c||(i==null?void 0:i.editHead),k,S,i),g(S)}},y);return{start:()=>{l=!0},end:()=>{if(u&&b(u,!1),t)for(let E in d)d[E].size&&d[E].data.length>1&&m(E),d[E]=null;l=!1,u="",n="",n=null,o="",c=null,this.onEnd()},update:E=>{if(!l)throw new Error("\u66F4\u65B0\u524D\u672A\u8C03\u7528 start \u65B9\u6CD5");let y=b(u+E,!0);h=h+u.length+E.length-((y==null?void 0:y.length)||0),u="",y&&(u=y)},docMap:f}}parseLine(e,t,s){let r=e.indexOf(xn),i=r!==-1,n=i?Vh(e,0,r):e,a=i?Vh(e,r+xn.length):"",o=JSON.parse(n);this.onLine(o.id,o.ticket,a,o.type,o.client,s,t,o.firstTicket,o.pend,void 0,o.num,e),e=null}onEditHead(e){}},Q0=new Uint8Array(8);function qr(){crypto.getRandomValues(Q0);let e="";for(let t=0;t<Q0.length;t++)e+=Q0[t].toString(16).padStart(2,"0");return e}function Pc(e,t,s,r,i,n,a){let o={docType:e,client:t,uuid:s};return(r||r===0)&&(o.updateTime=r),(i||o.updateTime||o.updateTime===0)&&(o.version=i||String(r)),n&&(o.user=n),`${JSON.stringify({type:"DOCHEAD",ticket:a})}${xn}${JSON.stringify(o)}`}function Bi(e,t,s,r,i,n,a,o){let c={type:e,ticket:t,id:s};return n!==void 0&&(c.firstTicket=n),a!==void 0&&(c.pend=a),o!==void 0&&(c.num=o),i&&(c.client=i),`${JSON.stringify(c)}${xn}${r}`}var C2=class extends VR{constructor(e){super(),this.unique=qr(),this.maxTicket=0,this.isPendChange=!0,this.isLocalChange=!0,this.cbArr=[],this.tempLocalIds={},this.client=e||qr()}onLine(e,t,s,r,i,n,a,o,c,l,u){this.remoteChange(t,i,a,e,s,r,n,void 0,o,c,l,void 0,void 0,u)}getUnique(){return this.unique}setUnique(e){this.unique=e}onDocHead(e,t){}onEnd(){}setIsPendChange(e){this.isPendChange=e}getIsPendChange(){return this.isPendChange}getMaxTicket(){return this.maxTicket}setMaxTicket(e,t){e&&(t||this.maxTicket<e)&&(this.maxTicket=e)}setIsLocalChange(e){this.isLocalChange=e}getIsLocalChange(){return this.isLocalChange}revoke(e,t,s,r,i,n,a,o,c,l,u){var h;if(!((h=this.tempLocalIds[e])!=null&&h[t]))return u?u(t,i,s,a,`${r}-1`,e,n,void 0,void 0,!0,l):this.cbArr.forEach(p=>p(e,t,s,a,`${r}-1`,i,void 0,n,void 0,void 0,void 0,l)),!0}getRandomUuid(){return qr()}getClient(){return this.client}onChange(e){this.cbArr.push(e)}localChange(e,t,s,r,i,n){let a=this.maxTicket+1;return this.tempLocalIds[e]||(this.tempLocalIds[e]={}),this.tempLocalIds[e][t]=[this.getClient(),a],this.remoteChange(a,this.client,e,t,s,r,i,!0,void 0,!0,void 0,this.unique,void 0,n),a}remoteChange(e,t,s,r,i,n,a,o,c,l,u,h,p,d){var E;this.setMaxTicket(e);let f=h===this.unique,m=o||f,g=(!m||m&&this.isLocalChange)&&(!p||p&&this.isPendChange),b=(E=this.tempLocalIds[s])==null?void 0:E[r];!o&&f?b?(g=!1,b[0]===t&&b[1]===e&&delete this.tempLocalIds[s][r]):g=!0:!o&&b&&(b[1]>e||b[1]===e&&b[0]>t?g=!1:delete this.tempLocalIds[s][r]),g&&this.cbArr.forEach(y=>y(s,r,i,n,t,e,c,l,void 0,p,h,d))}};var $1=/^(?:ie|e)(\d+)$/;function qh(e){let t=e.match($1);return t?Number(t[1]):null}function vt(e){if(!e||typeof e!="string")return e;let t=e.match(/(?:ie|e)\d+/g);return t&&t.length===2&&t.join("")===e?t.join("-"):e}function xr(e){return e&&typeof e=="number"&&!isNaN(e)?-e:e}function zR(e,t){let s=[];for(let r=0;r<e.length;r+=2){let i={x:e[r],y:t?xr(e[r+1]):e[r+1]};s.push(i)}return s}function Li(e,t){return JSON.stringify([t,e])}function Do(e){try{let t=JSON.parse(e);return typeof t=="string"?e:t[1]}catch{return e}}var WR=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.POLY="POLY",e.STRING="STRING",e.AUX_LINE="AUXLINE",e.DIMENSION="DIMENSION",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(WR||{}),qR=(e=>(e.META="META",e.CANVAS="CANVAS",e.LAYER="LAYER",e.LAYER_PHYS="LAYER_PHYS",e.ACTIVE_LAYER="ACTIVE_LAYER",e.PARTITION="PARTITION",e.NET="NET",e.PRIMITIVE="PRIMITIVE",e.GROUP="GROUP",e.SILK_OPTS="SILK_OPTS",e.PREFERENCE="PREFERENCE",e.VIA="VIA",e.PAD="PAD",e.LINE="LINE",e.ARC="ARC",e.OBJ="OBJ",e.EQLEN_GRP="EQLEN_GRP",e.POLY="POLY",e.FILL="FILL",e.LAYER_FILL="LAYER_FILL",e.REGION="REGION",e.POUR="POUR",e.POURED="POURED",e.IMAGE="IMAGE",e.TEARDROP="TEARDROP",e.FPC_FILL="FPC_FILL",e.SHELL="SHELL",e.CREASE="CREASE",e.SHELLCUT="SHELLCUT",e.SHELL_ENTITY="SHELL_ENTITY",e.BOSS="BOSS",e.STRING="STRING",e.ATTR="ATTR",e.DIMENSION="DIMENSION",e.COMPONENT="COMPONENT",e.PAD_NET="PAD_NET",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.PANELIZE="PANELIZE",e.BOARD="BOARD",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(qR||{}),JR=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.ATTR="ATTR",e.LINE="LINE",e.WIRE="WIRE",e.BUS="BUS",e.TEXT="TEXT",e.POLY="POLY",e.CIRCLE="CIRCLE",e.ARC="ARC",e.BUSENTRY="BUSENTRY",e.RECT="RECT",e.MASK_REGION="MASK_REGION",e.PIN="PIN",e.OBJ="OBJ",e.COMPONENT="COMPONENT",e.PART="PART",e.ELLIPSE="ELLIPSE",e.BEZIER="BEZIER",e.TABLE="TABLE",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.NG_SETTING="NG_SETTING",e))(JR||{});var KR=["PARTITION","VIA","PAD","LINE","ARC","OBJ","POLY","FILL","REGION","POUR","POURED","IMAGE","TEARDROP","FPC_FILL","SHELL","CREASE","SHELLCUT","SHELL_ENTITY","BOSS","STRING","ATTR","DIMENSION","COMPONENT"];var XR=(e=>(e.SOLID="SOLID",e.SHORT_DASH="SHORT_DASH",e.DOT="DOT",e.DOT_DASH="DOT_DASH",e))(XR||{}),ZR=(e=>(e.PRINT="PRINT",e.COVER="COVER",e.PRINT_AND_COVER="PRINT&COVER",e))(ZR||{}),$R=(e=>(e.LEFT="LEFT",e.CENTER="CENTER",e.RIGHT="RIGHT",e))($R||{}),QR=(e=>(e.TOP="TOP",e.MIDDLE="MIDDLE",e.BOTTOM="BOTTOM",e))(QR||{}),eN=(e=>(e.LEFT_BOTTOM="LEFT_BOTTOM",e.CENTER_BOTTOM="CENTER_BOTTOM",e.RIGHT_BOTTOM="RIGHT_BOTTOM",e.LEFT_MIDDLE="LEFT_MIDDLE",e.CENTER_MIDDLE="CENTER_MIDDLE",e.RIGHT_MIDDLE="RIGHT_MIDDLE",e.LEFT_TOP="LEFT_TOP",e.CENTER_TOP="CENTER_TOP",e.RIGHT_TOP="RIGHT_TOP",e))(eN||{}),tN=(e=>(e.NONE="NONE",e.SOLID="SOLID",e.GRID="GRID",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e.RHOMBIC="RHOMBIC",e.LEFT_SLASH_LINE="LEFT_SLASH_LINE",e.RIGHT_SLASH_LINE="RIGHT_SLASH_LINE",e))(tN||{}),sN=(e=>(e.NONE="NONE",e.CLOCK="CLOCK",e.INVERTED="INVERTED",e.INVERTED_CLOCK="INVERTED_CLOCK",e))(sN||{}),rN=(e=>(e.NONE="NONE",e.GRID="GRID",e.OUTLETS="OUTLETS",e))(rN||{}),iN=(e=>(e.NONE="NONE",e.PUSH="PUSH",e.SURROUND="SURROUND",e.OBSTRUCT="OBSTRUCT",e.SURROUND_AND_PUSH="SURROUND&PUSH",e))(iN||{}),nN=(e=>(e.ELLIPSE="ELLIPSE",e.RECT="RECT",e.OVAL="OVAL",e.POLYGON="POLYGON",e))(nN||{}),aN=(e=>(e.ROUND="ROUND",e.RECT="RECT",e.SLOT="SLOT",e))(aN||{}),oN=(e=>(e.SOLID="SOLID",e.GRID_LINE="GRID_LINE",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e))(oN||{}),cN=(e=>(e.ALL="ALL",e.PAD="PAD",e.VIA="VIA",e))(cN||{}),lN=(e=>(e.NONE="NONE",e.SINGLE="SINGLE",e.ALL="ALL",e))(lN||{}),uN=(e=>(e.OPTIMIZA_OPEN="OPTIMIZA_OPEN",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(uN||{}),hN=(e=>(e.OPTIMIZA_STRONG="OPTIMIZA_STRONG",e.OPTIMIZA_WEAK="OPTIMIZA_WEAK",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(hN||{}),dN=(e=>(e.L45="L45",e.L90="L90",e.L="L",e.R45="R45",e.R90="R90",e.R="R",e))(dN||{}),pN=(e=>(e.NORMAL="NORMAL",e.BLIND="BLIND",e.SUTURE="SUTURE",e))(pN||{}),fN=(e=>(e.NORMAL="NORMAL",e.TEST="TEST",e.MARKER="MARKER",e))(fN||{}),mN=(e=>(e.DIVERGENCE="DIVERGENCE",e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(mN||{}),gN=(e=>(e.DOT="DOT",e.CENTER="CENT",e))(gN||{}),yN=(e=>(e.NORMAL="NORMAL",e.BOARD_OUTLINE="BOARD_OUTLINE",e))(yN||{}),EN=(e=>(e.SOLID="SOLID",e.GRID="GRID",e.PLANE="PLANE",e))(EN||{}),bN=(e=>(e.PROHIBIT="PROHIBIT",e.CONSTRAINT="CONSTRAINT",e))(bN||{}),TN=(e=>(e.COMPONENT="COMPONENT",e.VIA="VIA",e.TRACK="TRACK",e.FILL="FILL",e.COPPER="COPPER",e.PLANE="PLANE",e))(TN||{}),wN=(e=>(e.PI="Polyimide",e.FR4="FR4",e.STEEL_SHEET="Stainless Steel",e.M3_DOUBLE_SIDED_TAPE="3M Tape",e.EMI_SHIELDING_FILM="EMI Shielding Film",e))(wN||{}),SN=(e=>(e.PUSH_COVER="DRAWER",e.UPPER_LOWER_SHELLS="T&B",e))(SN||{}),_N=(e=>(e.X_AXIS_POSITIVE="X_AXIS_POSITIVE",e.X_AXIS_NEGATIVE="X_AXIS_NEGATIVE",e.Y_AXIS_POSITIVE="Y_AXIS_POSITIVE",e.Y_AXIS_NEGATIVE="Y_AXIS_NEGATIVE",e))(_N||{}),AN=(e=>(e.SLOT="SLOT",e.ENTITY="ENTITY",e))(AN||{}),CN=(e=>(e.AUTO="AUTO",e.UPPER_SHELLS="UPPER_SHELLS",e.LOWER_SHELLS="LOWER_SHELLS",e))(CN||{}),DN=(e=>(e.OUTLINE="OUTLINE",e.SCREW_PILLAR="SCREW_PILLAR",e.ENTITY="ENTITY",e))(DN||{}),PN=(e=>(e.M2="M2",e.M3="M3",e.M4="M4",e.M5="M5",e.M6="M6",e))(PN||{}),ON=(e=>(e.LENGTH="LENGTH",e.RADIUS="RADIUS",e.ANGLE="ANGLE",e))(ON||{}),IN=(e=>(e.MIL="mil",e.INCH="inch",e.CM="cm",e.MM="mm",e))(IN||{}),xN=(e=>(e.SAFE="SAFE",e.OTHER="OTHER",e.TRACK="TRACK",e.BLIND="BLIND",e.RADIUS="RADIUS",e.PLANE="PLANE",e.COPPER="COPPER",e.PASTE="PASTE",e.SOLDER="SOLDER",e.DIFFER_ENTAIL="DIFFER_ENTAIL",e.NET_LENGTH="NET_LENGTH",e.AUTO_ROUTER="AUTO_ROUTER",e.NET_LENGTH_TOLERANCE="NET_LENGTH_TOLERANCE",e))(xN||{}),vN=(e=>(e.NORMAL="NORMAL",e.DEFAULT="DEFAULT",e))(vN||{}),RN=(e=>(e.ALL="ALL",e.LAYERED="LAYERED",e))(RN||{}),NN=(e=>(e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(NN||{}),LN=(e=>(e.FORTY_FIVE="L45",e.NINETY="L90",e.NINETY_ARC="A90",e))(LN||{}),BN=(e=>(e.LESS="LESS",e.MID="MID",e.MORE="MORE",e))(BN||{}),kN=(e=>(e.SPEED_FIRST="SPEED_FIRST",e.COMPLETION_FIRST="COMPLETION_FIRST",e))(kN||{}),MN=(e=>(e.DesignRule="DesignRule",e.Board="Board",e.SlotRegion="SlotRegion",e.ProhibitedRegion="ProhibitedRegion",e.ConstraintRegion="ConstraintRegion",e.Component="Component",e.Track="Track",e.TestPoint="TestPoint",e.Pad="Pad",e.Via="Via",e.SutureHole="SutureHole",e.Text="Text",e.ColorfulImage="ColorfulImage",e.Image="Image",e.FPCStiffener="FPCStiffener",e.Dimension="Dimension",e.CopperRegion="CopperRegion",e.FillRegion="Fill Region",e.Line="Line",e.Teardrop="Teardrop",e.D3Shell="D3Shell",e))(MN||{}),jN=pu(UR());function _1(e,t,s,r,i,n,a,o){return JSON.stringify([e||"",t||"",s,r,i?1:0,n?1:0,a?1:0,o])}function FN(e){let t=JSON.parse(e);return{text:t[0],fontFamily:t[1],fontSize:t[2],thickness:t[3],bold:!!t[4],italic:!!t[5],reverse:!!t[6],expansion:t[7]}}function Fm(e){return jN.default.SHA256(e).toString()}function UN(e,t){let s=[],r=[],i={};gm(e,(l,u)=>{let h=JSON.parse(l);if(h.type==="DOCHEAD"||h.type==="META"||h.type==="META_CREATE"||h.type==="META_MODIFY"||h.type==="ELE_PLACEHOLDER"||h.type==="ELE_PLACEHOLDER"||h.type==="ELE_PLACEHOLDER")return;let{id:p}=h;i[p]=Object.assign(h,{data:u})});let n={};gm(t,(l,u="")=>{let h=JSON.parse(l);if(h.type==="BLOB")s.push(l+xn+u);else if(h.type==="FONT")r.push(l+xn+u);else{if(h.type==="DOCHEAD"||h.type==="META_MODIFY")return;let{id:p}=h;n[p]=Object.assign(h,{data:u})}});let a={},o={},c={};for(let l in i)if(!n.hasOwnProperty(l))o[l]=i[l];else{let{ticket:u}=i[l],{type:h,data:p,client:d}=n[l];a[l]={type:h,ticket:u,data:p,client:d},delete n[l]}for(let l in n){let{type:u,data:h,ticket:p,client:d}=n[l];c[l]={type:u,data:h,ticket:p,client:d}}return{delete:o,cover:a,add:c,blobs:s,fonts:r}}function e1(e,t,s){let{docType:r,uuid:i,client:n,updateTime:a,version:o,user:c,ticket:l}=s,u=[Pc(r,n,i,a,o,c,l)],{delete:h,cover:p,add:d,blobs:f,fonts:m}=UN(e,t);for(let g in h){let{ticket:b,type:E,client:y}=h[g];u.push(Bi(E,b+1,g,"",y))}for(let g in p){let{type:b,ticket:E,data:y,client:T}=p[g];u.push(Bi(b,E+1,g,y,T))}for(let g in d){let{type:b,ticket:E,data:y,client:T}=d[g];u.push(Bi(b,E,g,y,T))}return f.length&&(u.push(Pc("BLOB",n,"BLOB",a,o,c,l)),u=u.concat(f)),m.length&&(u.push(Pc("FONT",n,"FONT",a,o,c,l)),u=u.concat(m)),u.join(tr)}var NG=pu(id());var HN=class{constructor(e,t=1,s=[]){this.consistencyManager=e,this.startNum=t,this.needOrderType=s,this.initIng=!1,this.allOrderNum={},this.maxNum={},this.consistencyManager.onChange((r,i,n,a,o,c,l,u,h,p,d,f)=>{try{this.onParseLine(i,a,n?JSON.parse(n):null,o,c,u,f)}catch(m){console.error(m)}})}setIsInit(e){this.initIng=e}setNeedNum(e){this.needNum=e}setOrderNum(e,t,s){this.needNum&&this.needOrderType&&this.needOrderType.includes(s)&&t!==void 0&&(this.allOrderNum[e]=t,this.setMaxNum(s,t))}deleteOrderNum(e){delete this.allOrderNum[e]}getOrderNum(e){return this.allOrderNum[e]}setMaxNum(e,t,s){(s||this.maxNum[e]===void 0||this.maxNum[e]<t)&&(this.maxNum[e]=t)}getMaxNum(e){return this.maxNum[e]===void 0&&(this.maxNum[e]=this.startNum-1),++this.maxNum[e]}};function D2(e){switch(e=String(e),e){case"1":return"SAFE";case"2":return"OTHER";case"3":return"TRACK";case"4":return"BLIND";case"5":return"RADIUS";case"6":return"PLANE";case"7":return"COPPER";case"8":return"PASTE";case"9":return"SOLDER";case"10":return"DIFFER_ENTAIL";case"11":return"NET_LENGTH";case"12":return"AUTO_ROUTER";case"13":return"NET_LENGTH_TOLERANCE"}return e}function Wl(e){if(!e)return{};let t=["1","2","3","4","5","6","7","8","9","10","11","12","13"];for(let s of t)if(e.hasOwnProperty(s)){let r=e[s];delete e[s],e[D2(s)]=r}return e}var GN=(e=>(e[e.TRACK=0]="TRACK",e[e.SMDPad=1]="SMDPad",e[e.THPad=2]="THPad",e[e.SMD_Test_Point=3]="SMD_Test_Point",e[e.TH_Test_Point=4]="TH_Test_Point",e[e.VIA=5]="VIA",e[e.REGION=6]="REGION",e[e.PLANE=7]="PLANE",e[e.SLOT=8]="SLOT",e[e.LINE=9]="LINE",e[e.OTHER=10]="OTHER",e[e.SHEETFRAME=11]="SHEETFRAME",e[e.Hole=12]="Hole",e[e.Copper=13]="Copper",e[e.Inner=14]="Inner",e[e.PROHIBITAREA=15]="PROHIBITAREA",e[e.COMPONENT=16]="COMPONENT",e))(GN||{}),gw=class{constructor(){this.init=!1,this.defaultSafeData=null,this.defaultCopperSpace=null,this.defaultInnerSpace=null,this.copperChangeMap=new Map,this.innerChangeMap=new Map}addDefaultSafeSpaceData(e){this.init=!0,this.defaultSafeData=e}addDefaultCopperSpace(e,t){this.defaultCopperSpace={netClearance:e,boardClearance:t}}addDefaultInnerSpace(e,t){this.defaultInnerSpace={netClearance:e,boardClearance:t}}getNewDefaultData(e,t){if(e&&this.defaultSafeData==null||!e&&this.defaultInnerSpace==null)return null;let s=e?this.copperChangeMap.get(t):this.innerChangeMap.get(t);if(s==null)return null;let{netClearance:r,boardClearance:i}=s,n=this.defaultSafeData.safeSpacing[0].content,a=new Array(n.length);for(let o=0;o<n.length;o++)a[o]=Array.from(n[o]);return this.updateSafeData(a,r,i),a}fixSafeData(e){if(this.defaultCopperSpace!=null)for(let t of e.safeSpacing)this.updateSafeData(t.content,this.defaultCopperSpace.netClearance,this.defaultCopperSpace.netClearance)}updateSafeData(e,t,s){for(let r=0;r<e.length;r++){let i=e[r];for(let n=0;n<i.length;n++)r==7?n==11||n==8?i[n]=s:i[n]=t:n==7&&(r==11||r==8?i[n]=s:i[n]=t)}}addCopper2SafeChangeMap(e,t,s,r,i){this.copperChangeMap.set(e,{name:t,isDefault:s,netClearance:r,boardClearance:i})}addInner2SafeChangeMap(e,t,s,r,i){this.innerChangeMap.set(e,{name:t,isDefault:s,netClearance:r,boardClearance:i})}getSafeName4Copper(e){var t;return(t=this.copperChangeMap.get(e))==null?void 0:t.name}getSafeName4Plane(e){var t;return(t=this.innerChangeMap.get(e))==null?void 0:t.name}getDefaultCopper(){for(let[,e]of this.copperChangeMap)if(e.isDefault)return e.name;return null}getDefaultPlane(){for(let[,e]of this.innerChangeMap)if(e.isDefault)return e.name;return null}};function yw(e,t){let s=e,r={TWO_LAYERS_BOARD:"JLCPCB Capability(Two Layers Board)",SINGLE_LAYER_BOARD:"JLCPCB Capability(Single Layer Board)",MULTIPLE_LAYERS_BOARD:"JLCPCB Capability(Multiple Layers Board)",HIGH_FREQUENCY_BOARD:"JLCPCB Capability(High Frequency Board)",ALUMINUM_SUBSTRATE_BOARD:"JLCPCB Capability(Aluminum Substrate Board)",COPPER_SUBSTRATE_BOARD:"JLCPCB Capability(Copper Substrate Board)"};if(s.length==8){Object.values(r).includes(t)&&(s[4][0]=11.811,s[5][4]=11.811),s.splice(1,0,s[1].slice(0));for(let n=2;n<s.length;n++)s[n].splice(1,0,s[n][1]);s.push([].concat(s[1][0],s.slice(1).map(n=>n[1])))}s[1].push(s[1][s[1].length-1]),s.splice(3,0,[...s[1]]),s.splice(4,0,[...s[2]]),s[1].pop();for(let n=5;n<s.length;n++)s[n].splice(3,0,s[n][1]),s[n].splice(4,0,s[n][2]);s[3][3]=s[1][1],s[4][3]=s[2][1],s[4][4]=s[2][2];let i=6;s.splice(7,0,new Array(7).fill(i));for(let n=7;n<s.length;n++)s[n].splice(7,0,i);return s}function YN(e,t){let s=e[0],r=e[1],i=[],n="ALL";if(r instanceof Array){let a=yw(r,t);i.push({layerId:1,isOpen:!0,content:a})}else{for(let a in r){let o=r[a],c=yw(o,t);i.push({layerId:+a,isOpen:!0,content:c})}Object.keys(r).length>1&&(n="LAYERED")}return{unit:s,isForAll:n,safeSpacing:i}}function VN(e){let t=e[0],s=e[1],r=e[2];isNaN(r)&&(r=0);let i=e[3];return isNaN(i)&&(i=11.8),{unit:t,deviceClearance:s,thru2SmdClearance:r,holeClearance:i}}function zN(e){let t=e[0],s=e[1],r=!0,i=[];if(s instanceof Object)for(let n in s){let a=s[n];i.push({layerId:+n,stroMin:a[0],stroDef:a[1],stroMax:a[2]})}else i.push({layerId:1,stroMin:e[1],stroDef:e[2],stroMax:e[3]});return{unit:t,track:{isOpen:r,content:i}}}function WN(e){return{unit:e[0],netLenMin:e[1],netLenMax:e[2]}}function qN(e){return{unit:e[0],netLengthTolerance:e[1]}}function JN(e){let t=e[0],s=e[1],r=!0,i=[],n=[],a=0;if(s instanceof Object)for(let o in s){let c=s[o],{stroke:l,spacing:u,lenTolerMax:h}=c;i.push({layerId:+o,stroMin:l[0],stroDef:l[1],stroMax:l[2]}),n.push({layerId:+o,spacMin:u[0],spacDef:u[1]}),a=h}else i.push({layerId:1,stroMin:e[1],stroDef:e[2],stroMax:e[3]}),n.push({layerId:1,spacMin:e[4],spacDef:e[5]}),a=e[7];return{unit:t,stroWidth:{isOpen:r,content:i},spacing:{isOpen:r,content:n},differPairLenTolerMax:a}}function KN(e){let t=new Array;for(let s of e){let r=+s[1],i=+s[2];isNaN(r)||r<=0||isNaN(i)||i<=0||r===i||r===1&&i===2||r===2&&i===1||t.push({name:s[0],staLayerId:r,endLayerId:i,viaSizeRule:s[3]})}return{blinds:{content:t}}}function XN(e){return{unit:e[0],minRadius:e[1],defRadius:e[2],maxRadius:e[3],minInner:e[4],defInner:e[5],maxInner:e[6]}}function ZN(e){let t=[{layerId:1,connType:ru(e[7]!==void 0?e[7]:e[3]),spoWidth:e[8]!==void 0?e[8]:e[4],spoSpac:e[9]!==void 0?e[9]:e[5],spoAng:e[10]?e[10]:e[6]}];return{unit:e[0],mulPad:{isOpen:!0,content:t}}}function $N(e){let t=[{layerId:1,connType:ru(e[3]),spoWidth:e[4],spoSpac:e[5],spoAng:e[6]}],s=[{layerId:1,connType:Number(e[7])?"NON_CONNECT":"DIRECT"}],r=[{layerId:1,connType:ru(e[8]!==void 0?e[8]:e[3]),spoWidth:e[9]!==void 0?e[9]:e[4],spoSpac:e[10]!==void 0?e[10]:e[5],spoAng:e[11]?e[11]:e[6]}];return{unit:e[0],sglPad:{isOpen:!0,content:t},mulPad:{isOpen:!0,content:r},track:{isOpen:!0,content:s}}}function QN(e){return{unit:e[0],padTopExpan:e[1],padBotExpan:e[2],testPointTopExpan:e[3]?e[3]:-1e3,testPointBotExpan:e[4]?e[4]:-1e3}}function e3(e){return{unit:e[0],padTopExpan:e[1],padBotExpan:e[2],viaTopExpan:e[3],viaBotExpan:e[4],testPointTopExpan:e[5]?e[5]:2,testPointBotExpan:e[6]?e[6]:2}}function t3(e){function t(i){switch(i=i&&Number(i),i){case 0:return"L45";case 1:return"L90";case 2:return"A90";default:return"L45"}}function s(i){switch(i=i&&Number(i),i){case 0:return"LESS";case 1:return"MID";case 2:return"MORE";default:return"LESS"}}function r(i){switch(i=i&&Number(i),i){case 0:return"SPEED_FIRST";case 1:return"COMPLETION_FIRST";default:return"COMPLETION_FIRST"}}return{routingCorner:t(e[0]),isKeep:!!e[1],viaQuantity:s(e[2]),routingEffectPriority:r(e[3]),layers:e[5],ignoreNets:e[6]}}function ru(e){switch(e=e&&Number(e),e){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}function s3(e,t){let s=t;switch(e){case"SAFE":{let r=t;if(r.isForAll=r.isForAll?"LAYERED":"ALL",r.safeSpacing)for(let i of r.safeSpacing)i.isOpen=!!i.isOpen;s=r;break}case"OTHER":break;case"TRACK":{let r=t;r!=null&&r.track&&(r.track.isOpen=!!r.track.isOpen),s=r;break}case"NET_LENGTH":break;case"NET_LENGTH_TOLERANCE":break;case"DIFFER_ENTAIL":{let r=t;r!=null&&r.stroWidth&&(r.stroWidth.isOpen=!!r.stroWidth.isOpen),r!=null&&r.spacing&&(r.spacing.isOpen=!!r.spacing.isOpen),s=r;break}case"BLIND":break;case"RADIUS":break;case"PLANE":{let r=t;if(r!=null&&r.mulPad&&(r.mulPad.isOpen=!!r.mulPad.isOpen),r.mulPad&&r.mulPad.content)for(let i of r.mulPad.content)i.connType=ru(i.connType);s=r;break}case"COPPER":{let r=t;if(r!=null&&r.sglPad&&(r.sglPad.isOpen=!!r.sglPad.isOpen),r!=null&&r.mulPad&&(r.mulPad.isOpen=!!r.mulPad.isOpen),r!=null&&r.track&&(r.track.isOpen=!!r.track.isOpen),r.track&&r.track.content&&(r.track.content=r.track.content.map(i=>(i.connType=Number(i.connType)?"NON_CONNECT":"DIRECT",i))),r.sglPad&&r.sglPad.content)for(let i of r.sglPad.content)i.connType=ru(i.connType);if(r.mulPad&&r.mulPad.content)for(let i of r.mulPad.content)i.connType=ru(i.connType);s=r;break}case"PASTE":break;case"SOLDER":break;case"AUTO_ROUTER":break}return s}function r3(e,t,s,r,i,n){if(!(r instanceof Array))return s3(e,r);let a,o=!1;switch(s&&(s==="NORMAL"?o=!1:s==="DEFAULT"&&(o=!0)),e){case"SAFE":{a=YN(r,n),o&&i.addDefaultSafeSpaceData(a);break}case"OTHER":{a=VN(r);break}case"TRACK":{a=zN(r);break}case"NET_LENGTH":{a=WN(r);break}case"NET_LENGTH_TOLERANCE":{a=qN(r);break}case"DIFFER_ENTAIL":{a=JN(r);break}case"BLIND":{a=KN(r);break}case"RADIUS":{a=XN(r);break}case"PLANE":{let c=r[1],l=r[2];o&&i.addDefaultInnerSpace(c,l),i.addInner2SafeChangeMap(t,"Plane_"+t,o,c,l),a=ZN(r);break}case"COPPER":{let c=r[1],l=r[2];o&&i.addDefaultCopperSpace(c,l),i.addCopper2SafeChangeMap(t,"Copper_"+t,o,c,l),a=$N(r);break}case"PASTE":{a=QN(r);break}case"SOLDER":{a=e3(r);break}case"AUTO_ROUTER":{a=t3(r);break}}return a}function i3(e,t,s,r){if(!r.init)return null;function i(n,a){let o=n?"Copper_":"Plane_",c=["RULE"];c[1]="SAFE",c[2]=o+t,c[3]=0;let l=a.getNewDefaultData(n,t);return l==null?null:(c[4]={unit:a.defaultSafeData.unit,isForAll:"ALL",safeSpacing:[{layerId:1,isOpen:!0,content:l}]},c)}switch(e){case"SAFE":return r.fixSafeData(s),null;case"PLANE":return i(!1,r);case"COPPER":return i(!0,r);default:return null}}function n3(e,t,s,r){if(!r.init)return{ruleKeyValue:s};let i=e[0],n,a;if(t==4){if(i==="NET_CLASS"||i==="NET"){for(let o in s)String(o)==="COPPER"&&(n={COPPER:r.getSafeName4Copper(s[o])}),String(o)==="PLANE"&&(a={PLANE:r.getSafeName4Plane(s[o])});e[1]==""?(n!=null&&n.COPPER||(n={COPPER:"default"}),a!=null&&a.PLANE||(a={PLANE:"default"})):(n!=null&&n.COPPER||(n={COPPER:r.getDefaultCopper()}),a!=null&&a.PLANE||(a={PLANE:r.getDefaultPlane()}))}}else for(let o in s){if(String(o)==="COPPER"){let c=s[o],l=r.getSafeName4Copper(c);if(l==null&&c=="default"&&(l=r.getDefaultCopper()),l==null)continue;n={COPPER:l}}if(String(o)==="PLANE"){let c=s[o],l=r.getSafeName4Plane(c);if(l==null&&c=="default"&&(l=r.getDefaultPlane()),l==null)continue;a={PLANE:l}}}return{ruleKeyValue:s,copperRuleValue:n,innerPlaneRuleValue:a}}function P2(e,t){let s=e.length,r=0;for(;r<s;){let i=e.indexOf(`
`,r);i<0&&(i=s);let n=e.substring(r,i);try{if(t(n)===!1)break}catch(a){console.error(a)}r=i+1}}function a3(e){let t={};return P2(e,s=>{if(s.startsWith('["PAD"')){let r=JSON.parse(s);t[r[5]]||(t[r[5]]=[]),t[r[5]].push(r[1])}}),t}var Q1=class{parseFull(e){P2(e,t=>this.onParseLine(JSON.parse(t))),this.onParseEnd()}},o3=(e=>(e[e.pro1=1]="pro1",e[e.pro2=1.1]="pro2",e[e.pro3=1.2]="pro3",e[e.pro4=1.3]="pro4",e[e.pro5=1.4]="pro5",e[e.pro6=1.5]="pro6",e[e.pro7=1.6]="pro7",e[e.pro8=1.7]="pro8",e[e.pro9=1.8]="pro9",e[e.pro=1.8]="pro",e))(o3||{}),c3=class extends Q1{constructor(e={},t={},s=[],r=[],i=!1){super(),this.deviceName=e,this.footprintName=t,this.footprints=s,this.devices=r,this.footprintIsConnectDevice=i,this.fontCache=[],this.poured={},this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize={data:[],stamp:{h:null,v:null},size:{h:null,v:null}},this.layerPhys=0,this.fac=new gw,this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet=new Set,this.oldId={},this.cachePadNet={},this.creaseIds=[],this.stringId={},this.padNumId={},this.componentPadNum={}}getOldId(e){var t;return(t=this.oldId[e])!=null?t:e}handConnect(){for(let e of this.creaseIds)if(this.connects[e])for(let t of this.connects[e])this.connects[t]?this.connects[t].push(e):this.connects[t]=[e]}getConnect(e){return this.connects[e]||[]}transRuleType(e){return D2(e)}transRuleStatus(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"DEFAULT";default:return"NORMAL"}}transGridType(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"GRID";case 2:return"OUTLETS";default:return"NONE"}}transLayerStatus(e){e=e&&Number(e);let t=!1,s=!1,r=!1;return e!=null&&!isNaN(e)?(e>=4&&(r=!0,e-=4),e>=2&&(s=!0,e-=2),e===1&&(t=!0)):t=!0,{use:t,show:s,locked:r}}transRoutingMode(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"PUSH";case 2:return"SURROUND";case 3:return"OBSTRUCT";case 4:return"SURROUND&PUSH";default:return"NONE"}}transPadDef(e){switch(e==null?void 0:e[0]){case"ELLIPSE":return{padType:"ELLIPSE",width:e[1],height:e[2]};case"RECT":return{padType:"RECT",width:e[1],height:e[2],radius:e[3]};case"OVAL":return{padType:"OVAL",width:e[1],height:e[2]};case"POLYGON":case"POLY":return{padType:"POLYGON",path:e[1]};default:return null}}transHoleDef(e){return e?{holeType:e[0],width:e[1],height:e[2]}:null}transPourDef(e){function t(s){switch(s=s&&Number(s),s){case 0:return"GRID_LINE";case 1:return"HORIZONTAL_LINE";case 2:return"VERTICAL_LINE";default:return"GRID_LINE"}}switch(e==null?void 0:e[0]){case"SOLID":return{pourType:"SOLID",fineness:e[1]};case"LINE":return{pourType:t(e[1]),angle:e[2],strokeWidth:e[3],strokeSpacing:e[4]};default:return null}}transUnusedPadRange(e){switch(e=e&&Number(e),e){case 1:return"ALL";case 2:return"PAD";case 3:return"VIA";default:return"VIA"}}transPathOptimization(e){switch(e=e&&Number(e),e){case 0:return"SINGLE";case 1:return"ALL";case 2:return"NONE";default:return"SINGLE"}}transViaType(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"SUTURE";default:return"NORMAL"}}transPadFuncType(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"TEST";case 2:return"MARKER";default:return"NORMAL"}}transPadConnect(e){switch(e=e&&Number(e),e){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}transFillStyle(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"GRID";case 2:return"PLANE";default:return null}}transProhibitType(e){let t=new Set;if(!e)return[];for(let s of e)switch(s=s&&Number(s),s){case 1:t.add("TRACK"),t.add("FILL");break;case 2:t.add("COMPONENT");break;case 3:t.add("VIA");break;case 4:t.add("COPPER"),t.add("PLANE");break;case 5:t.add("TRACK");break;case 6:t.add("FILL");break;case 7:t.add("COPPER");break;case 8:t.add("PLANE");break}return Array.from(t)}transPushCoverDir(e){switch(e=e&&Number(e),e){case 1:return"X_AXIS_POSITIVE";case 2:return"X_AXIS_NEGATIVE";case 4:return"Y_AXIS_POSITIVE";case 8:return"Y_AXIS_NEGATIVE";default:return"X_AXIS_POSITIVE"}}transEntityBelong(e){switch(e=e&&Number(e),e){case 0:return"AUTO";case 1:return"UPPER_SHELLS";case 2:return"LOWER_SHELLS";default:return"AUTO"}}transSlotOption(e){e=e&&Number(e);let t=e;if(!t||t<4)return["OUTLINE","SCREW_PILLAR","ENTITY"];let s=[];return t>=16&&(s.push("ENTITY"),t-=16),t>=8&&(s.push("SCREW_PILLAR"),t-=8),t>=4&&(s.push("OUTLINE"),t-=4),s}transAlignType(e){switch(e=e&&Number(e),e){case 1:return"LEFT_TOP";case 4:return"CENTER_TOP";case 7:return"RIGHT_TOP";case 2:return"LEFT_MIDDLE";case 5:return"CENTER_MIDDLE";case 8:return"RIGHT_MIDDLE";case 3:return"LEFT_BOTTOM";case 6:return"CENTER_BOTTOM";case 9:return"RIGHT_BOTTOM";default:return"LEFT_BOTTOM"}}onParseLine(e){var s;let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"CANVAS":this.parseCanvas(e);break;case"LAYER":this.parseLayer(e);break;case"LAYER_PHYS":this.parseLayerPhys(e);break;case"ACTIVE_LAYER":this.parseActiveLayer(e);break;case"NET":this.parseNet(e);break;case"PRIMITIVE":this.parsePrimitive(e);break;case"GROUP":this.parseGroup(e);break;case"SILK_OPTS":this.parseSilkOpts(e);break;case"PREFERENCE":this.parsePreference(e);break;case"CONNECT":this.parseConnect(e);break;case"ITEM_ORDER":this.parseItemOrder(e);break;case"PROP":this.parseProp(e);break;case"EQLEN_GRP":this.parseEQLenGrp(e);break;case"EQLEN":this.parseEQLen(e);break;case"FONT":this.parseFont(e);break;case"PAD_NET":{this.cachePadNet[e[1]]||(this.cachePadNet[e[1]]=[]),this.cachePadNet[e[1]].push(e);break}case"REUSE_BLOCK":this.parseReuseBlock(e);break;case"RULE_TEMPLATE":this.parseRuleTemplate(e);break;case"RULE":this.rules.push(e);break;case"RULE_SELECTOR":this.ruleSelectors.push(e);break;case"PANELIZE":this.panelize.data=e;break;case"PANELIZE_STAMP":this.parsePanelizeStamp(e);break;case"PANELIZE_SIDE":this.parsePanelizeSide(e);break;case"POURED":{this.parsePoured(e);break}case"PARTITION":t==="PARTITION"&&(this.curPartition=e[3]?e[1]:"");case"VIA":case"PAD":case"LINE":case"ARC":case"CARC":case"OBJ":case"POLY":case"FILL":if(t==="FILL"&&e[6]===2){this.layerFill[e[4]]||(this.layerFill[e[4]]=[]),this.layerFill[e[4]].push(e);break}case"REGION":case"POUR":case"IMAGE":case"TEARDROP":case"FPC_FILL":case"SHELL":case"CREASE":t==="CREASE"&&this.creaseIds.push(e[1]);case"SHELLCUT":case"SHELL_ENTITY":case"BOSS":case"STRING":if(t==="STRING"&&!/^[a-zA-Z]+\d+$/.test(e[1])){let r=e[1],i=r.split(/([0-9].*)/);if(i.length>=2){let n=i[0],a=i[1];for(let o=0;o<a.length;o++){let c=a.charCodeAt(o);n+=c}r=n}this.stringId[r]=e[1],e[1]=r}case"DIMENSION":case"COMPONENT":{let r=t==="CARC"?"ARC":t,i=qh(e[1]);this.cache[r]||(this.cache[r]={}),i!==null&&!this.cache[r][i]?this.cache[r][i]={part:this.curPartition,value:e}:(this.errorIds[r]||(this.errorIds[r]=[]),this.errorIds[r].push({part:this.curPartition,value:e})),r==="COMPONENT"&&(this.components[e[1]]||(this.components[e[1]]={attrs:{},footprint:"",device:""}),this.components[e[1]].attrs=e[7]||{}),r==="DIMENSION"&&(this.dimension[e[1]]={attr:[]});break}case"ATTR":{if(this.docType==="PCB"&&!e[3])break;if(e[7]==="Footprint"&&(this.components[e[3]]||(this.components[e[3]]={attrs:{},footprint:"",device:""}),this.components[e[3]].footprint=e[8]),e[7]==="Device"&&(this.components[e[3]]||(this.components[e[3]]={attrs:{},footprint:"",device:""}),this.components[e[3]].device=e[8]),this.dimension[e[1]]){this.dimension[e[1]].attr=e;break}let r=Object.keys(((s=this.cache)==null?void 0:s.COMPONENT)||{}).find(n=>this.cache.COMPONENT[n].value[1]===e[3]);if(r){let n=this.cache.COMPONENT[r];n.attr||(n.attr=[]),n.attr.push({part:this.curPartition,value:e});break}let i=qh(e[1]);this.cache[t]||(this.cache[t]={}),i!==null&&!this.cache[t][i]?this.cache[t][i]={part:this.curPartition,value:e}:(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPartition,value:e}));break}default:console.warn("can not find hanlder with",e)}}async secondParseLine(e,t,s){let r=e[0];if(this.idsSet.has(e[1])||!e[1]){let i=qr();if(this.oldId[i]=e[1],e[1]=i,s)for(let n of s)n[3]=i}else this.idsSet.add(e[1]);switch(r){case"DOCTYPE":case"HEAD":case"CANVAS":case"LAYER":case"LAYER_PHYS":case"ACTIVE_LAYER":case"NET":case"PRIMITIVE":case"GROUP":case"SILK_OPTS":case"PREFERENCE":case"ITEM_ORDER":case"RULE_TEMPLATE":case"RULE":case"RULE_SELECTOR":case"PANELIZE":case"PANELIZE_STAMP":case"PANELIZE_SIDE":case"CONNECT":case"EQLEN_GRP":case"EQLEN":case"FONT":case"PAD_NET":case"REUSE_BLOCK":case"PROP":break;case"PARTITION":this.parsePartition(e);break;case"VIA":this.parseVia(e);break;case"PAD":this.parsePad(e);break;case"LINE":await this.parseLine(e);break;case"ARC":this.parseArc(e);break;case"CARC":this.parseCArc(e);break;case"OBJ":this.parseObj(e);break;case"POLY":this.parsePoly(e);break;case"FILL":this.parseFill(e);break;case"REGION":this.parseRegion(e);break;case"POUR":this.parsePour(e);break;case"IMAGE":this.parseImage(e);break;case"TEARDROP":this.parseTeardrop(e);break;case"FPC_FILL":this.parseFpcFill(e);break;case"SHELL":this.parseShell(e);break;case"CREASE":this.parseCrease(e);break;case"SHELLCUT":this.parseShellCut(e);break;case"SHELL_ENTITY":this.parseShellEntity(e);break;case"BOSS":this.parseBoss(e);break;case"STRING":this.parseString(e);break;case"ATTR":this.parseAttr(e,t);break;case"DIMENSION":this.parseDimension(e);break;case"COMPONENT":this.parseComponent(e);break;default:console.warn("can not find hanlder with",e)}}onParseEnd(){for(let t of this.rules)t[1]=this.transRuleType(t[1]),t[3]=this.transRuleStatus(t[3]),t[4]=r3(t[1],t[2],t[3],t[4],this.fac,this.ruleTemplateName);if(this.fac.init){let t=Array.from(this.rules);for(let s of t){let r=i3(s[1],s[2],s[4],this.fac);r&&this.rules.push(r)}}for(let t of this.rules)this.parseRule(t);let e={};for(let t of this.ruleSelectors){let s=n3(t[1],t[2],Wl(t[3]),this.fac),r=JSON.stringify(t[1]);e[r]?(t[2]&&(e[r].ruleOrder=t[2]),s.ruleKeyValue&&(e[r].ruleKeyValue=Object.assign(e[r].ruleKeyValue,s.ruleKeyValue)),(s.copperRuleValue||t[4])&&(e[r].copperValue=s.copperRuleValue||Wl(t[4])),(s.innerPlaneRuleValue||t[5])&&(e[r].innerPlaneValue=s.innerPlaneRuleValue||Wl(t[5]))):e[r]={ruleSelect:t[1],ruleOrder:t[2],ruleKeyValue:s.ruleKeyValue,copperValue:s.copperRuleValue||Wl(t[4])||{},innerPlaneValue:s.innerPlaneRuleValue||Wl(t[5])||{}}}for(let t in e)this.parseRuleSelector(e[t]);this.handConnect(),this.parseEQLenGrpFull(),this.parsePanelize(),this.parseLayerFill();for(let t in this.cache){let s=this.cache[t],r=Object.keys(s).sort((n,a)=>Number(n)-Number(a)),i=-1;for(let n of r){let a=Number(n),o=a-i-1;o>=1&&this.onPHolder(t,o),i=a,this.curPartition=s[a].part,this.secondParseLine(s[a].value,void 0,s[a].attr),s[a].attr&&s[a].attr.forEach(c=>{this.curPartition=c.part,this.secondParseLine(c.value)})}if(this.errorIds[t])for(let n of this.errorIds[t])this.curPartition=n.part,this.secondParseLine(n.value)}this.clearCache()}clearCache(){this.version=void 0,this.docType=void 0,this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize.data.length&&(this.panelize.data.length=0,this.panelize.stamp={h:null,v:null},this.panelize.size={h:null,v:null}),this.layerPhys=0,this.fac.init&&(this.fac=new gw),this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet.clear(),this.oldId={},this.creaseIds.length=0}fixPolygon(e){if(e[0]=="R"){let t=parseFloat(e[3])/10,s=parseFloat(e[4])/10;e[6]=Math.min(t,s)/2*(parseFloat(e[6])||0)*10}}handleSimplePolygon(e){return!e||this.version>=1.5||this.fixPolygon(e),e}handlePolygon(e){if(this.version<1.5&&e&&e.length){if(!Array.isArray(e[0]))return this.handleSimplePolygon(e);for(let t of e)this.fixPolygon(t)}return e}parseEQLen(e){this.eQLenData[e[1]]?this.eQLenData[e[1]].pads?this.eQLenData[e[1]].pads.push(e[2]):this.eQLenData[e[1]].pads=[e[2]]:this.eQLenData[e[1]]={pads:[e[2]]}}parseEQLenGrp(e){this.eQLenData[e[1]]?(this.eQLenData[e[1]].id=e[1],this.eQLenData[e[1]].name=e[2],this.eQLenData[e[1]].sort=++this.eQLenSort):this.eQLenData[e[1]]={id:e[1],name:e[2],sort:++this.eQLenSort}}parseCanvas(e){this.onCanvas(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],this.transGridType(e[10]),this.transGridType(e[11]),e[12])}parseDocType(e){this.docType=e[1];let t=parseFloat(e[2]);this.version=t}parseHead(e){}parseLayer(e){let t=e[8];this.version<1.7&&(t=.5);let s=this.transLayerStatus(e[4]);this.onLayer(e[1],e[2],e[3],s.use,s.show,s.locked,e[5],e[6],e[7],t)}parseLayerPhys(e){this.onLayerPhys(e[1],e[2],e[3],e[4],e[5],!!e[6],++this.layerPhys)}parseActiveLayer(e){this.onActiveLayer(e[1])}parsePartition(e){this.onPartition(e[1],e[2],e[3],this.handlePolygon(e[4]))}parseNet(e){var t,s,r,i;this.onNet(e[1],(t=e[2])!=null?t:null,(s=e[3])!=null?s:null,!!e[4],(r=e[5])!=null?r:null,!!e[6],(i=e[7])!=null?i:null)}parsePrimitive(e){this.onPrimitive(e[1],!!e[2],!!e[3])}parseGroup(e){this.onGroup(e[1],e[2])}parseSilkOpts(e){this.onSilkOpts(e[1],e[2],e[3])}parsePreference(e){this.onPreference(!!e[1],e[2],!!e[3],e[4],e[5],!!e[6],this.transRoutingMode(e[7]),e[8],!!e[9],!!e[10],!!e[11],e[12],e[13],!!e[14],this.transUnusedPadRange(e[15]),e[16],this.transPathOptimization(e[17]),e[18],e[19],e[20])}parseConnect(e){this.connects[e[1]]=e[2]}parseVia(e){var t,s;this.onVia(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transViaType(e[9]),(t=e[10])!=null?t:null,(s=e[11])!=null?s:null,!!e[12],e[13])}parsePad(e){var t,s,r,i,n,a,o,c,l;this.onPad(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transHoleDef(e[9]),this.transPadDef(e[10]),e[11]&&(s=(t=e[11])==null?void 0:t.map(u=>({startLayer:u[0],endLayer:u[1],pad:this.transPadDef(u[2])})))!=null?s:null,e[12],e[13],e[14],!!e[15],this.transPadFuncType(e[16]),(r=e[17])!=null?r:null,(i=e[18])!=null?i:null,(n=e[19])!=null?n:null,(a=e[20])!=null?a:null,!!e[21],this.transPadConnect(e[22]),(o=e[23])!=null?o:null,(c=e[24])!=null?c:null,(l=e[25])!=null?l:null,e[26],this.getConnect(e[1]))}parseLine(e){this.onLine(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],!!e[10])}parseArc(e){this.onArc(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseCArc(e){this.onCArc(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseObj(e){this.onObj(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],!!e[10],e[11],!!e[12],this.specialColors[this.getOldId(e[1])])}parseItemOrder(e){this.itemOrder=e[1]}parseProp(e){this.specialColors[e[1]]=e[2]}parseEQLenGrpFull(){for(let e in this.eQLenData){let t=this.eQLenData[e];t.id&&this.onEQLenGrp(t.id,t.name,t.sort,t.pads||[])}this.eQLenData={},this.eQLenSort=1}parsePoly(e){this.onPoly(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handleSimplePolygon(e[6]),!!e[7],this.specialColors[this.getOldId(e[1])])}parseFill(e){this.onFill(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.transFillStyle(e[6]),this.handlePolygon(e[7]),!!e[8],this.getConnect(e[1]),this.specialColors[this.getOldId(e[1])])}getZIndex1(e){let t=e.match($1);return t!=null&&t.length?t[1]:null}parseLayerFill(){for(let e in this.layerFill){let t=this.layerFill[e];this.onLayerFill(Number(e),{fill:t.map(s=>{let r=this.getZIndex1(s[1]);return{id:s[1],partitionId:this.curPartition||"",groupId:s[2],locked:!!s[8],zIndex:r===null?null:Number(r),netName:s[3],width:s[5],path:this.handlePolygon(s[7]),refs:this.getConnect(s[1]),specialColor:this.specialColors[this.getOldId(s[1])]}})})}}parseRegion(e){let t=e[5],s=t&&t.includes(9)?"CONSTRAINT":"PROHIBIT";t=s?t.filter(r=>r!==9):t,this.onRegion(e[1],this.curPartition||"",e[2],e[3],e[4],this.transProhibitType(t),this.handlePolygon(e[6]),!!e[7],e[8],s)}parsePour(e){let t=e[9];this.version<=1.7&&t&&t[0]==="SOLID"&&t[1]&&(t[1]=8),this.onPour(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],this.handlePolygon(e[8]),this.transPourDef(t),!!e[10],!!e[11]),this.poured[e[1]]&&this.onPoured(e[1],this.poured[e[1]])}parsePoured(e){if(this.version<1.1){if(this.curPourId){let t={id:e[1],strokeWidth:e[2],fill:e[3],path:this.handlePolygon(e[4])};this.poured[this.curPourId]||(this.poured[this.curPourId]={pourFill:[]}),this.poured[this.curPourId].pourFill.push(t)}}else{let t={id:e[1],strokeWidth:e[3],fill:e[4],path:this.handlePolygon(e[5])};this.poured[e[2]]||(this.poured[e[2]]={pourFill:[]}),this.poured[e[2]].pourFill.push(t)}}parseImage(e){this.onImage(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],!!e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseTeardrop(e){let t,s,r;this.version<1.2?(t=e[5],r=e[4]):(t=e[4],s=e[5],r=this.getConnect(e[1])),this.onTeardrop(e[1],this.curPartition||"",e[2],e[3],this.handleSimplePolygon(t),s!=null?s:null,r)}parseFpcFill(e){this.onFpcFill(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handlePolygon(e[6]),!!e[7])}parseShell(e){let t=e[8];t&&t.Direction&&(t.Direction=this.transPushCoverDir(t.Direction)),this.onShell(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],this.handlePolygon(e[7]),t,!!e[9])}parseCrease(e){this.onCrease(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],!!e[9])}parseShellCut(e){this.onShellCut(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handlePolygon(e[6]),!!e[7],this.getConnect(e[1]))}parseShellEntity(e){this.onShellEntity(e[1],this.curPartition||"",e[2],e[3],e[4],this.transEntityBelong(e[5]),this.transSlotOption(e[5]),e[6],e[7],this.handlePolygon(e[8]),!!e[9],this.getConnect(e[1]))}parseBoss(e){var t,s,r,i,n,a;this.version<1.4?this.onBoss(e[1],this.curPartition||"",e[2],e[3],e[5],e[6],(t=e[4])!=null?t:null,e[7],null,null,(s=e[8])!=null?s:null,(r=e[9])!=null?r:null,!!e[10]):this.onBoss(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],(i=e[6])!=null?i:null,e[7],e[8],e[9],(n=e[10])!=null?n:null,(a=e[11])!=null?a:null,!!e[12])}parseDimension(e){var i;let t=this.getOldId(e[1]),s=((i=this.dimension[t])==null?void 0:i.attr)||[];if(s.length){let n=this.fontCache.find(a=>a.id&&a.id===this.getOldId(s[1]));this.version<1.6&&n&&(n.text=s[8],n.fontFamily=s[11],n.fontSize=s[12]/10,n.thickness=s[13],n.bold=s[15],n.italic=s[16],n.reverse=s[18],n.expansion=s[19])}let r={groupId:s[2],layerId:s[4],x:s[5],y:s[6],text:s[8],fontFamily:s[11],fontSize:s[12],strokeWidth:s[13],bold:s[14],italic:s[15],origin:s[16],angle:s[17],reverse:s[18],expansion:s[19],mirror:s[20],locked:s[21],zIndex:null,specialColor:this.specialColors[this.getOldId(s[1])]};this.onDimension(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],!!e[7],e[8],!!e[9],r,this.specialColors[this.getOldId(e[1])],s[2]||"")}parseRuleTemplate(e){this.ruleTemplateName=e[1],this.onRuleTemplate(e[1])}parseRule(e){this.onRule(e[1],e[2],e[3],e[4])}parseRuleSelector(e){this.onRuleSelector(e.ruleSelect,e.ruleOrder,e.ruleKeyValue,e.copperValue,e.innerPlaneValue)}parsePanelize(){let e=this.panelize.data;e.length&&this.onPanelize(!!e[1],e[2],e[3],e[4],e[5],!!e[6],this.panelize.stamp.h,this.panelize.stamp.v,this.panelize.size.h,this.panelize.size.v)}parsePanelizeStamp(e){let t={on:!!e[2],stampHoleGroupQuantity:e[3],stampHoleDiameter:e[4],stampHoleQuantityPerGroup:e[5],stampHoleSpacing:e[6]};e[1]?this.panelize.stamp.v=t:this.panelize.stamp.h=t}parsePanelizeSide(e){let t={on:!!e[2],sideHeight:e[3],positionHoleDiameter:e[4],markDiameter:e[5],markExpansion:e[6]};e[1]?this.panelize.size.v=t:this.panelize.size.h=t}parseComponent(e){let t=this.getOldId(e[1]),s=e[7]||{},r=this.reuseBlock[t];if(r&&Object.assign(s,{"Group ID":r[2]||"","Channel ID":r[3]||""}),this.onComponent(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],s,!!e[8],this.specialColors[t]),this.cachePadNet[t])for(let i of this.cachePadNet[t])this.parsePadNet(i)}parsePadNet(e){let t=this.getOldId(e[1]);if(e[4]===void 0&&this.components[t]){let s=this.components[t].footprint;if(!s){let i=this.components[t].device;s=this.devices.find(n=>n.uuid===i).attributes.Footprint}let r=this.padNumId[s];if(!r){let i=this.footprints.find(n=>n.uuid===s);i&&(this.padNumId[s]=a3(i==null?void 0:i.dataStr),r=this.padNumId[s])}if(r&&r[e[2]]){this.componentPadNum[t]||(this.componentPadNum[t]={}),this.componentPadNum[t][e[2]]===void 0&&(this.componentPadNum[t][e[2]]=-1);let i=++this.componentPadNum[t][e[2]];e[4]=r[e[2]][i]}else e[4]=e[2]}this.onPadNet(e[1],this.curPartition||"",e[2],e[3],e[4])}parseReuseBlock(e){this.reuseBlock[e[1]]=e}getFontCache(e,t,s,r,i,n,a,o){let c;return this.version<1.6?c=this.fontCache.find(l=>l.id===e):c=this.fontCache.find(l=>s==l.fontFamily&&t==l.text&&r/10==l.fontSize&&!!a==l.reverse&&o==l.expansion&&!!i==l.bold&&!!n==l.italic&&l.path.length>0),{paths:c==null?void 0:c.path,width:c==null?void 0:c.width,height:c==null?void 0:c.height}}getTextValue(e,t,s,r,i){let n="";return e!=""&&t===""&&this.docType!="PCB"&&!i&&e!="Footprint"&&!this.footprintIsConnectDevice&&(t=`<${e}>`),s?r?n=e+":"+t:n=e:r?n=t:n="",n}getFormulaName(e,t){if(!e||!e.startsWith("="))return e;e=e.slice(1);let s=/\{([^\}]+)\}/g,r=[],i=[];for(;r=s.exec(e);)i.push(r[1]);for(let n=0;n<i.length;n++){let a=i[n],o=`{${a}!}`;t.has(a)&&(o=t.get(a)),e=e.replace(`{${a}}`,o)}return e}parseAttr(e,t){let s=e[11],r=e[12];r&&this.version<1.2&&(s=="default"||s=="")&&(r*=1.5);let i=e[7],n=e[8],a=!!e[9],o=!!e[10],c=this.getOldId(e[3]),l=n;if(i==="Device"){let h=this.deviceName[n]||n;l=this.getTextValue(i,h,a,o,c)}else if(i==="Footprint"){let h=this.footprintName[n]||n;l=this.getTextValue(i,h,a,o,c)}else if(i==="Name"){let h=new Map;if(c){let p=this.components[c];if(h.set("ID",c),Object.entries(p.attrs).forEach(d=>h.set(d[0],d[1])),p.device){let d=this.devices.find(f=>f.uuid===p.device);d&&Object.entries(d.attributes).forEach(f=>h.set(f[0],f[1]))}}l=this.getTextValue(i,this.getFormulaName(n,h),a,o,c)}else l=this.getTextValue(i,n,a,o,c);let u=this.fontCache.find(h=>h.id&&h.id===this.getOldId(e[1]));this.version<1.6&&u&&(u.text=l,u.fontFamily=s,u.fontSize=r/10,u.thickness=e[13],u.bold=e[15],u.italic=e[16],u.reverse=e[18],u.expansion=e[19]),this.onAttr(e[1],this.curPartition||"",e[2],c,e[4],e[5],e[6],i,n,a,o,s,r,e[13],!!e[14],!!e[15],this.transAlignType(e[16]),e[17],!!e[18],e[19],!!e[20],!!e[21],t,this.specialColors[this.getOldId(e[1])])}parseFont(e){let t;switch(this.version){case 1:case 1.1:t={id:e[1],path:e[2]};break;case 1.2:case 1.3:case 1.4:case 1.5:t={id:e[1],width:e[2],height:e[3],path:e[4]};break;default:t={text:e[1],fontFamily:e[2],fontSize:e[3],thickness:e[4],bold:!!e[5],italic:!!e[6],reverse:!!e[7],expansion:e[8],width:e[9],height:e[10],path:e[11]};break}this.fontCache.push(t)}parseString(e){var T;let[,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b]=e,E=(T=this.stringId[t])!=null?T:t;c&&this.version<1.2&&(o=="default"||o=="")&&(c*=1.5);let y=this.fontCache.find(w=>w.id&&w.id===this.getOldId(E));this.version<1.6&&y&&(y.text=a,y.fontFamily=o,y.fontSize=c/10,y.thickness=l,y.bold=u,y.italic=h,y.reverse=f,y.expansion=m),this.onString(t,this.curPartition||"",s,r,i,n,a,o,c,l,!!u,!!h,this.transAlignType(p),d,!!f,m,!!g,!!b,this.specialColors[this.getOldId(E)])}},l3=Object.create,O2=Object.defineProperty,u3=Object.getOwnPropertyDescriptor,h3=Object.getOwnPropertyNames,d3=Object.getPrototypeOf,p3=Object.prototype.hasOwnProperty,f3=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),m3=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of h3(t))!p3.call(e,i)&&i!==s&&O2(e,i,{get:()=>t[i],enumerable:!(r=u3(t,i))||r.enumerable});return e},g3=(e,t,s)=>(s=e!=null?l3(d3(e)):{},m3(t||!e||!e.__esModule?O2(s,"default",{value:e,enumerable:!0}):s,e)),y3=f3((e,t)=>{"use strict";t.exports=s,t.exports.default=s;function s(O,R,v){v=v||2;var j=R&&R.length,M=j?R[0]*v:O.length,H=r(O,0,M,v,!0),q=[];if(!H||H.next===H.prev)return q;var Q,oe,me,Ee,Pe,Oe,Fe;if(j&&(H=u(O,R,H,v)),O.length>80*v){Q=me=O[0],oe=Ee=O[1];for(var G=v;G<M;G+=v)Pe=O[G],Oe=O[G+1],Pe<Q&&(Q=Pe),Oe<oe&&(oe=Oe),Pe>me&&(me=Pe),Oe>Ee&&(Ee=Oe);Fe=Math.max(me-Q,Ee-oe),Fe=Fe!==0?32767/Fe:0}return n(H,q,v,Q,oe,Fe,0),q}function r(O,R,v,j,M){var H,q;if(M===k(O,R,v,j)>0)for(H=R;H<v;H+=j)q=F(H,O[H],O[H+1],q);else for(H=v-j;H>=R;H-=j)q=F(H,O[H],O[H+1],q);return q&&S(q,q.next)&&(V(q),q=q.next),q}function i(O,R){if(!O)return O;R||(R=O);var v=O,j;do if(j=!1,!v.steiner&&(S(v,v.next)||w(v.prev,v,v.next)===0)){if(V(v),v=R=v.prev,v===v.next)break;j=!0}else v=v.next;while(j||v!==R);return R}function n(O,R,v,j,M,H,q){if(O){!q&&H&&m(O,j,M,H);for(var Q=O,oe,me;O.prev!==O.next;){if(oe=O.prev,me=O.next,H?o(O,j,M,H):a(O)){R.push(oe.i/v|0),R.push(O.i/v|0),R.push(me.i/v|0),V(O),O=me.next,Q=me.next;continue}if(O=me,O===Q){q?q===1?(O=c(i(O),R,v),n(O,R,v,j,M,H,2)):q===2&&l(O,R,v,j,M,H):n(i(O),R,v,j,M,H,1);break}}}}function a(O){var R=O.prev,v=O,j=O.next;if(w(R,v,j)>=0)return!1;for(var M=R.x,H=v.x,q=j.x,Q=R.y,oe=v.y,me=j.y,Ee=M<H?M<q?M:q:H<q?H:q,Pe=Q<oe?Q<me?Q:me:oe<me?oe:me,Oe=M>H?M>q?M:q:H>q?H:q,Fe=Q>oe?Q>me?Q:me:oe>me?oe:me,G=j.next;G!==R;){if(G.x>=Ee&&G.x<=Oe&&G.y>=Pe&&G.y<=Fe&&y(M,Q,H,oe,q,me,G.x,G.y)&&w(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function o(O,R,v,j){var M=O.prev,H=O,q=O.next;if(w(M,H,q)>=0)return!1;for(var Q=M.x,oe=H.x,me=q.x,Ee=M.y,Pe=H.y,Oe=q.y,Fe=Q<oe?Q<me?Q:me:oe<me?oe:me,G=Ee<Pe?Ee<Oe?Ee:Oe:Pe<Oe?Pe:Oe,pe=Q>oe?Q>me?Q:me:oe>me?oe:me,ge=Ee>Pe?Ee>Oe?Ee:Oe:Pe>Oe?Pe:Oe,ie=b(Fe,G,R,v,j),$=b(pe,ge,R,v,j),ae=O.prevZ,ye=O.nextZ;ae&&ae.z>=ie&&ye&&ye.z<=$;){if(ae.x>=Fe&&ae.x<=pe&&ae.y>=G&&ae.y<=ge&&ae!==M&&ae!==q&&y(Q,Ee,oe,Pe,me,Oe,ae.x,ae.y)&&w(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,ye.x>=Fe&&ye.x<=pe&&ye.y>=G&&ye.y<=ge&&ye!==M&&ye!==q&&y(Q,Ee,oe,Pe,me,Oe,ye.x,ye.y)&&w(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;ae&&ae.z>=ie;){if(ae.x>=Fe&&ae.x<=pe&&ae.y>=G&&ae.y<=ge&&ae!==M&&ae!==q&&y(Q,Ee,oe,Pe,me,Oe,ae.x,ae.y)&&w(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;ye&&ye.z<=$;){if(ye.x>=Fe&&ye.x<=pe&&ye.y>=G&&ye.y<=ge&&ye!==M&&ye!==q&&y(Q,Ee,oe,Pe,me,Oe,ye.x,ye.y)&&w(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function c(O,R,v){var j=O;do{var M=j.prev,H=j.next.next;!S(M,H)&&_(M,j,j.next,H)&&I(M,H)&&I(H,M)&&(R.push(M.i/v|0),R.push(j.i/v|0),R.push(H.i/v|0),V(j),V(j.next),j=O=H),j=j.next}while(j!==O);return i(j)}function l(O,R,v,j,M,H){var q=O;do{for(var Q=q.next.next;Q!==q.prev;){if(q.i!==Q.i&&T(q,Q)){var oe=L(q,Q);q=i(q,q.next),oe=i(oe,oe.next),n(q,R,v,j,M,H,0),n(oe,R,v,j,M,H,0);return}Q=Q.next}q=q.next}while(q!==O)}function u(O,R,v,j){var M=[],H,q,Q,oe,me;for(H=0,q=R.length;H<q;H++)Q=R[H]*j,oe=H<q-1?R[H+1]*j:O.length,me=r(O,Q,oe,j,!1),me===me.next&&(me.steiner=!0),M.push(E(me));for(M.sort(h),H=0;H<M.length;H++)v=p(M[H],v);return v}function h(O,R){return O.x-R.x}function p(O,R){var v=d(O,R);if(!v)return R;var j=L(v,O);return i(j,j.next),i(v,v.next)}function d(O,R){var v=R,j=O.x,M=O.y,H=-1/0,q;do{if(M<=v.y&&M>=v.next.y&&v.next.y!==v.y){var Q=v.x+(M-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(Q<=j&&Q>H&&(H=Q,q=v.x<v.next.x?v:v.next,Q===j))return q}v=v.next}while(v!==R);if(!q)return null;var oe=q,me=q.x,Ee=q.y,Pe=1/0,Oe;v=q;do j>=v.x&&v.x>=me&&j!==v.x&&y(M<Ee?j:H,M,me,Ee,M<Ee?H:j,M,v.x,v.y)&&(Oe=Math.abs(M-v.y)/(j-v.x),I(v,O)&&(Oe<Pe||Oe===Pe&&(v.x>q.x||v.x===q.x&&f(q,v)))&&(q=v,Pe=Oe)),v=v.next;while(v!==oe);return q}function f(O,R){return w(O.prev,O,R.prev)<0&&w(R.next,O,O.next)<0}function m(O,R,v,j){var M=O;do M.z===0&&(M.z=b(M.x,M.y,R,v,j)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==O);M.prevZ.nextZ=null,M.prevZ=null,g(M)}function g(O){var R,v,j,M,H,q,Q,oe,me=1;do{for(v=O,O=null,H=null,q=0;v;){for(q++,j=v,Q=0,R=0;R<me&&(Q++,j=j.nextZ,!!j);R++);for(oe=me;Q>0||oe>0&&j;)Q!==0&&(oe===0||!j||v.z<=j.z)?(M=v,v=v.nextZ,Q--):(M=j,j=j.nextZ,oe--),H?H.nextZ=M:O=M,M.prevZ=H,H=M;v=j}H.nextZ=null,me*=2}while(q>1);return O}function b(O,R,v,j,M){return O=(O-v)*M|0,R=(R-j)*M|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,O|R<<1}function E(O){var R=O,v=O;do(R.x<v.x||R.x===v.x&&R.y<v.y)&&(v=R),R=R.next;while(R!==O);return v}function y(O,R,v,j,M,H,q,Q){return(M-q)*(R-Q)>=(O-q)*(H-Q)&&(O-q)*(j-Q)>=(v-q)*(R-Q)&&(v-q)*(H-Q)>=(M-q)*(j-Q)}function T(O,R){return O.next.i!==R.i&&O.prev.i!==R.i&&!D(O,R)&&(I(O,R)&&I(R,O)&&P(O,R)&&(w(O.prev,O,R.prev)||w(O,R.prev,R))||S(O,R)&&w(O.prev,O,O.next)>0&&w(R.prev,R,R.next)>0)}function w(O,R,v){return(R.y-O.y)*(v.x-R.x)-(R.x-O.x)*(v.y-R.y)}function S(O,R){return O.x===R.x&&O.y===R.y}function _(O,R,v,j){var M=x(w(O,R,v)),H=x(w(O,R,j)),q=x(w(v,j,O)),Q=x(w(v,j,R));return!!(M!==H&&q!==Q||M===0&&C(O,v,R)||H===0&&C(O,j,R)||q===0&&C(v,O,j)||Q===0&&C(v,R,j))}function C(O,R,v){return R.x<=Math.max(O.x,v.x)&&R.x>=Math.min(O.x,v.x)&&R.y<=Math.max(O.y,v.y)&&R.y>=Math.min(O.y,v.y)}function x(O){return O>0?1:O<0?-1:0}function D(O,R){var v=O;do{if(v.i!==O.i&&v.next.i!==O.i&&v.i!==R.i&&v.next.i!==R.i&&_(v,v.next,O,R))return!0;v=v.next}while(v!==O);return!1}function I(O,R){return w(O.prev,O,O.next)<0?w(O,R,O.next)>=0&&w(O,O.prev,R)>=0:w(O,R,O.prev)<0||w(O,O.next,R)<0}function P(O,R){var v=O,j=!1,M=(O.x+R.x)/2,H=(O.y+R.y)/2;do v.y>H!=v.next.y>H&&v.next.y!==v.y&&M<(v.next.x-v.x)*(H-v.y)/(v.next.y-v.y)+v.x&&(j=!j),v=v.next;while(v!==O);return j}function L(O,R){var v=new B(O.i,O.x,O.y),j=new B(R.i,R.x,R.y),M=O.next,H=R.prev;return O.next=R,R.prev=O,v.next=M,M.prev=v,j.next=v,v.prev=j,H.next=j,j.prev=H,j}function F(O,R,v,j){var M=new B(O,R,v);return j?(M.next=j.next,M.prev=j,j.next.prev=M,j.next=M):(M.prev=M,M.next=M),M}function V(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function B(O,R,v){this.i=O,this.x=R,this.y=v,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}s.deviation=function(O,R,v,j){var M=R&&R.length,H=M?R[0]*v:O.length,q=Math.abs(k(O,0,H,v));if(M)for(var Q=0,oe=R.length;Q<oe;Q++){var me=R[Q]*v,Ee=Q<oe-1?R[Q+1]*v:O.length;q-=Math.abs(k(O,me,Ee,v))}var Pe=0;for(Q=0;Q<j.length;Q+=3){var Oe=j[Q]*v,Fe=j[Q+1]*v,G=j[Q+2]*v;Pe+=Math.abs((O[Oe]-O[G])*(O[Fe+1]-O[Oe+1])-(O[Oe]-O[Fe])*(O[G+1]-O[Oe+1]))}return q===0&&Pe===0?0:Math.abs((Pe-q)/q)};function k(O,R,v,j){for(var M=0,H=R,q=v-j;H<v;H+=j)M+=(O[q]-O[H])*(O[H+1]+O[q+1]),q=H;return M}s.flatten=function(O){for(var R=O[0][0].length,v={vertices:[],holes:[],dimensions:R},j=0,M=0;M<O.length;M++){for(var H=0;H<O[M].length;H++)for(var q=0;q<R;q++)v.vertices.push(O[M][H][q]);M>0&&(j+=O[M-1].length,v.holes.push(j))}return v}}),E3=(e=>(e[e.MIL=1]="MIL",e[e.INCH=1e3]="INCH",e[e.FT=12e3]="FT",e[e.YARD=36e3]="YARD",e[e.MILE=6336e4]="MILE",e[e.KM=3937007874e-2]="KM",e[e.M=39370]="M",e[e.DM=3937]="DM",e[e.CM=393.7]="CM",e[e.MM=39.37]="MM",e[e.UM=.039]="UM",e[e.NM=394e-7]="NM",e[e.PT=13.88888888888889]="PT",e[e.PX72=13.88888888888889]="PX72",e[e.PX96=10.416666666666666]="PX96",e[e.PX100=10]="PX100",e[e.LTSPICE=6.25]="LTSPICE",e[e.PX1=.1]="PX1",e[e.PX001=.001]="PX001",e))(E3||{}),b3=(e=>(e.MIL="mil",e.INCH="inch",e.FT="ft",e.YARD="yard",e.MILE="mile",e.KM="km",e.M="m",e.DM="dm",e.CM="cm",e.MM="mm",e.UM="um",e.NM="nm",e.PT="pt",e.PX72="px(72)",e.PX96="px(96)",e.PX100="px(100)",e))(b3||{}),Ew={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},LG=(()=>{let e={};for(let t in Ew)e[Ew[t]]=t;return e})();var vc,BG=(vc=class{constructor(t,s){this.ratio=t/s}wrap(t){return t*this.ratio}static convert(t,s,r){return t*s/r}},vc.ASIS=new vc(1,1),vc),Bf=class{conversion(e,t,s){if(e===t)return s;let r=e+2+t;return this[r](s)}conversion1(e,t,s){let r=e+2+t,i=this[r](s);return t=="mil"?Math.round(i*10)/10:Math.round(i*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*393.7007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};Bf.prototype["px(100)2mil"]=e=>e*10,Bf.prototype["px(100)2mm"]=e=>e*.254,Bf.prototype["mil2px(100)"]=e=>e/10,Bf.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var kf=null,eE=new ArrayBuffer(8),t1=new Float64Array(eE),s1=new Uint32Array(eE),bw=new Uint16Array(eE);var Tw=class{static repeat(e,t){let s=new Array(t);for(;t-- >0;)s[t]=e;return s.join("")}static lpad(e,t,s){let r=s-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,s){let r=s-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)|0;return t}else return 0}static arraycopy(e,t,s,r,i){if(e.length>=t+i&&s.length>=r+i)for(;i-- >0;)s[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let s=0,r=e.length-1;r>=0;s++,r--)t[s]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,s=new Array,r=-1;for(let i=0;i<t;i++){let n=e.charAt(i);if(r>=0){if(n===";"){let a=e.substring(r+1,i);switch(a){case"lt":s.push("<");break;case"gt":s.push(">");break;case"quot":s.push('"');break;case"apos":s.push("'");break;case"amp":s.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));s.push(String.fromCharCode(o))}else s.push("&"+a+";")}r=-1}}else n==="&"?r=i:s.push(n)}return r>=0&&s.push(e.substring(r)),s.join("")}static addAll(e,t){for(let s of t)e.push(s)}static addAllSet(e,t){for(let s of t)e.add(s)}static contains(e,t){for(let s of e)if(s.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}else return!1}static remove(e,t){let s=0,r=e.length;for(let i=0;i<r;i++)e[i]===t&&(e.splice(i,1),i--,r--,s++);return s}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++){var r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!kf){let e=this.getUrlVars().version;e?kf="/analyzer/v"+e:kf="/analyzer"}return kf}static add2objS(e,t,s){if(t in e)return e[t];{let r=s(t);return e[t]=r,r}}static downloadFile(e,t){let s=document.createElement("a"),r=URL.createObjectURL(t);s.download=e,s.href=r,s.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;t1[0]=new Date().getTime(),e.push(s1[1].toString(16)),t1[0]=Math.random(),e.push(bw[3].toString(16));let t=bw[2].toString(16);e.push("4"+t.substr(0,3)),t1[0]=performance.now();let s=s1[0].toString(16)+s1[1].toString(16);return e.push("0"+s.substr(0,3)),e.push(s.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}};var I2=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error($l.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error($l.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error($l.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error($l.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},T3=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(T3||{}),w3=/(\.?0+)$/,$l=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let s=this._format(e,t);if(typeof s=="string")return s;throw new Error(this.format("Invalid state on (%d) %s",s,e))}static _format(e,t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c),u=l.charCodeAt(0);switch(r){case 0:u===37?r=1:s.push(l);break;case 1:switch(u){case 100:if(n=t[i++],typeof n=="number")s.push(n.toFixed(0)),r=0;else return c;break;case 102:if(n=t[i++],typeof n=="number")s.push(n.toString()),r=0;else return c;break;case 120:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16)),r=0;else return c;break;case 88:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16).toUpperCase()),r=0;else return c;break;case 115:case 99:n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case 48:a=c+1,o=-1,r=2;break;case 37:s.push("%"),r=0;break;default:return c}break;case 2:switch(u){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=c;break;case 120:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(Tw.lpad((n|0).toString(16),"0",h)),r=0;else return c}else return c;break;case 88:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(Tw.lpad((n|0).toString(16).toUpperCase(),"0",h)),r=0;else return c}else return c;break;default:return c}break;default:return c}}return s.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let s=new Array,r=0;for(;;){let i=e.exec(t);if(i!==null){let n=e.lastIndex-i[0].length;s.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);I2.nullOrEmpty(n)||s.push(n);break}}return s}static fmtNumber(e){return e.toFixed(5).replace(w3,"")}},S3=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(S3||{});function _3(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var A3=(e,t)=>{e===3?console.error(t):console.log(t)},C3=(e,t)=>$l.format("%s %s: %s",new Date,_3(e),t),Ha,Um=(Ha=class{constructor(t,s=A3,r=C3){this.debug=!1,this.level=t,this.writer=s,this.fmt=r}static mix(...t){let s=4;for(let r of t)r.level<s&&(s=r.level);return new Ha(s,(r,i)=>{for(let n of t)n.write1(r,i)},(r,i)=>i)}wrap(t=null,s=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),i=s===null?this.writer:(n,a)=>{s(n,a),this.writer(n,a)};return new Ha(this.level,i,r)}chain(t){return t.wrap(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}write3(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,$l.format(s,...r)))}write2(t,s){this.include(t)&&(s instanceof Error?this.writer(t,this.fmt(t,s.stack)):this.writer(t,this.fmt(t,s.toString())))}write1(t,s){this.include(t)&&this.writer(t,this.fmt(t,s))}debug3(t,...s){this.write3(0,t,s)}debug2(t){this.write2(0,t)}debug1(t){this.write1(0,t)}info3(t,...s){this.write3(1,t,s)}info2(t){this.write2(1,t)}info1(t){this.write1(1,t)}warning3(t,...s){this.write3(2,t,s)}warning2(t){this.write2(2,t)}warning1(t){this.write1(2,t)}error3(t,...s){this.write3(3,t,s)}error2(t){this.write2(3,t)}error1(t){this.write1(3,t)}},Ha.DUMMY=new Ha(4),Ha),tE=new ArrayBuffer(8),r1=new Float64Array(tE),i1=new Uint32Array(tE),ww=new Uint16Array(tE),Sw=ArrayBuffer;try{Sw=self.HTMLImageElement||Sw}catch{}var Mf=null;function Nc(e,t,s=0,r=e.length){i(e,null,t,s,r);function i(a,o,c,l,u){let h,p,d,f;if(l<u-1){let m=u-l;if(m>50)o===null&&(o=new Array(m+1)),n(a,o,c,l,(l+u)/2|0,u);else{h=a[l],p=l,d=l,f=u;let g=p+1;for(;g<f;){if(d!=f){if(f=f+-1,c(h,a[f])<=0)continue;a[d]=a[f],d=f;continue}if(c(h,a[g])>=0){p=g,g=p+1;continue}a[d]=a[g],p=g,d=g,g=p+1}a[d]=h,i(a,o,c,l,d),i(a,o,c,d+1,u)}}}function n(a,o,c,l,u,h){i(a,o,c,l,u),i(a,o,c,u,h);for(var p=l,d=u,f=0,m=a[p],g=a[d];p<u&&d<h;){var b=c(m,g);isNaN(b)?(o[f++]=g,g=a[++d]):(b<=0&&(o[f++]=m,m=a[++p]),b>=0&&(o[f++]=g,g=a[++d]))}for(;p<u;p++)o[f++]=a[p];for(;d<h;d++)o[f++]=a[d];for(p=l,d=0;d<f;p++,d++)a[p]=o[d]}}var Kr=class{static repeat(e,t){let s=new Array(t);for(;t-- >0;)s[t]=e;return s.join("")}static lpad(e,t,s){let r=s-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,s){let r=s-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)|0;return t}else return 0}static arraycopy(e,t,s,r,i){if(e.length>=t+i&&s.length>=r+i)for(;i-- >0;)s[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let s=0,r=e.length-1;r>=0;s++,r--)t[s]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,s=new Array,r=-1;for(let i=0;i<t;i++){let n=e.charAt(i);if(r>=0){if(n===";"){let a=e.substring(r+1,i);switch(a){case"lt":s.push("<");break;case"gt":s.push(">");break;case"quot":s.push('"');break;case"apos":s.push("'");break;case"amp":s.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));s.push(String.fromCharCode(o))}else s.push("&"+a+";")}r=-1}}else n==="&"?r=i:s.push(n)}return r>=0&&s.push(e.substring(r)),s.join("")}static addAll(e,t){for(let s of t)e.push(s)}static addAllSet(e,t){for(let s of t)e.add(s)}static contains(e,t){for(let s of e)if(s.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}else return!1}static remove(e,t){let s=0,r=e.length;for(let i=0;i<r;i++)e[i]===t&&(e.splice(i,1),i--,r--,s++);return s}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++){var r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!Mf){let e=this.getUrlVars().version;e?Mf="/analyzer/v"+e:Mf="/analyzer"}return Mf}static add2objS(e,t,s){if(t in e)return e[t];{let r=s(t);return e[t]=r,r}}static downloadFile(e,t){let s=document.createElement("a"),r=URL.createObjectURL(t);s.download=e,s.href=r,s.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;r1[0]=new Date().getTime(),e.push(i1[1].toString(16)),r1[0]=Math.random(),e.push(ww[3].toString(16));let t=ww[2].toString(16);e.push("4"+t.substr(0,3)),r1[0]=performance.now();let s=i1[0].toString(16)+i1[1].toString(16);return e.push("0"+s.substr(0,3)),e.push(s.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},D3=[1,10,100,1e3];var jf=0,Tc=0;function _w(e,t,s){return jf=Math.abs(e-t),s>=5&&jf>1e-5||isNaN(s)&&jf>1e-8?!1:jf<1e-13?!0:(Tc=Math.min(Aw(e),Aw(t)),Tc<10&&(Tc=10),isNaN(s)||(Tc=Math.min(Tc,s)),Cw(e,Tc)===Cw(t,Tc))}var Ff=0,Uf=0;function Aw(e){return Ff=0,Uf=0,e>0?Ff=e-Math.floor(e):Ff=e-Math.ceil(e),Uf=(Ff.toString()||"").length,Uf>2?Uf-2:0}function Cw(e,t,s){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!s)return Math.round(e);var r=D3[t]||Math.pow(10,t)||10;if(s){var i=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(i+e)}else return Math.round(e*r+1e-10)/r}var P3=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(P3||{}),O3=/(\.?0+)$/,Ql=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let s=this._format(e,t);if(typeof s=="string")return s;throw new Error(this.format("Invalid state on (%d) %s",s,e))}static _format(e,t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c),u=l.charCodeAt(0);switch(r){case 0:u===37?r=1:s.push(l);break;case 1:switch(u){case 100:if(n=t[i++],typeof n=="number")s.push(n.toFixed(0)),r=0;else return c;break;case 102:if(n=t[i++],typeof n=="number")s.push(n.toString()),r=0;else return c;break;case 120:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16)),r=0;else return c;break;case 88:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16).toUpperCase()),r=0;else return c;break;case 115:case 99:n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case 48:a=c+1,o=-1,r=2;break;case 37:s.push("%"),r=0;break;default:return c}break;case 2:switch(u){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=c;break;case 120:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(Kr.lpad((n|0).toString(16),"0",h)),r=0;else return c}else return c;break;case 88:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(Kr.lpad((n|0).toString(16).toUpperCase(),"0",h)),r=0;else return c}else return c;break;default:return c}break;default:return c}}return s.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let s=new Array,r=0;for(;;){let i=e.exec(t);if(i!==null){let n=e.lastIndex-i[0].length;s.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);Ps.nullOrEmpty(n)||s.push(n);break}}return s}static fmtNumber(e){return e.toFixed(5).replace(O3,"")}},Ps=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(Ql.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(Ql.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(Ql.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(Ql.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},Rc,Se=(Rc=class{static regular(t){return Math.round(t*this.precision)/this.precision}static eq(t,s){return Math.abs(t-s)<=this.eps}static neq(t,s){return Math.abs(t-s)>this.eps}static less(t,s){return t-s<-this.eps}static lesseq(t,s){return t-s<=this.eps}static greater(t,s){return t-s>this.eps}static greatereq(t,s){return t-s>=-this.eps}static sqrt(t){return Math.abs(t)<=1e-10?0:Math.sqrt(t)}static sortAsc(t,s){return t-s}static sortDesc(t,s){return s-t}},Rc.eps=1e-8,Rc.precision=1e8,Rc);function iu(e,t){ym(e.iterator(),t)}function ym(e,t){let s=0;for(;e.hasNext();){let r=e.next();t(s++,r)}}var I3=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function A1(e){return new I3(e)}var mr,ct=(mr=class{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%mr.PIx2,t=t<0?mr.PIx2+t:t,t===mr.PIx2?0:t}static toQuarterBase(t){return mr.regular((t+mr.PI_4)/mr.PI_2*mr.PI_2)}static toQuarterBaseD(t){return mr.regularD(((t+45)/90|0)*90)}static transformD(t,s){return mr.toDegrees(mr.transform(mr.toRadians(t),s))}static transform(t,s){let r=Math.cos(t),i=Math.sin(t),n=new he(s.data[6],s.data[7]),a=new he(r,i).multiply3(s);return mr.regular(a.angle(n))}},mr.PIx2=Math.PI*2,mr.PI_2=Math.PI/2,mr.PI_4=Math.PI/4,mr),js=class{static dotProd1(e,t,s,r){return e*s+t*r}static dotProd2(e,t,s,r,i,n){return this.dotProd1(s-e,r-t,i-s,n-r)}static dotProd3(e,t,s){return this.dotProd2(e.x,e.y,t.x,t.y,s.x,s.y)}static crossProd1(e,t,s,r){return e*r-t*s}static crossProd2(e,t,s,r,i,n){return this.crossProd1(s-e,r-t,i-s,n-r)}static crossProd3(e,t,s){return this.crossProd2(e.x,e.y,t.x,t.y,s.x,s.y)}static distance2(e,t,s,r){let i=s-e,n=r-t;return i*i+n*n}static distance1(e,t,s,r){return this.hypot(s-e,r-t)}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y)}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var s=t;t=e,e=s}if(e===0)return t;var r=t/e;return e*Math.sqrt(1+r*r)}},x2=new ArrayBuffer(16),Dw=new Float64Array(x2),Hf=new Int32Array(x2),Pt,he=(Pt=class{static sortByXAsc(t,s){return t.x-s.x}static sortByYAsc(t,s){return t.y-s.y}static sortByXYAsc(t,s){return t.x<s.x?-1:t.x>s.x?1:t.y-s.y}static caculateAngle(t,s){let r=Math.cos(t),i=Math.sin(t),n=r*s.data[0]+i*s.data[4],a=r*s.data[1]+i*s.data[5],o=new Pt(n,a).normalize();return Math.atan2(o.y,o.x)}static normal(t,s,r){let i=s.sub(t),n=r.sub(s);return i.cross(n)}static getVector2(t){return new Pt(Math.cos(t),Math.sin(t))}static getCrossPoint1(t,s,r,i){if(t.equals1(s)||r.equals1(i)||Se.eq(1,Math.abs(s.sub(t).normalize().dot(i.sub(r).normalize()))))return null;let n=s.y-t.y,a=t.x-s.x,o=s.x*t.y-t.x*s.y,c=i.y-r.y,l=r.x-i.x,u=i.x*r.y-r.x*i.y,h=n*l-c*a;return new Pt((u*a-o*l)/h,(o*c-u*n)/h)}static getCrossPoint2(t,s,r,i){return this.getCrossPoint1(t,t.add(s),r,r.add(i))}constructor(t,s){this.x=Ps.normal(t),this.y=Ps.normal(s)}get hashed(){return this._hashed==null&&(Dw[0]=this.x,Dw[1]=this.y,this._hashed=Hf[0]^Hf[1]^Hf[2]^Hf[3]),this._hashed}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(t){var s=this.x-t.x,r=this.y-t.y;return new Pt(s,r)}add(t){var s=this.x+t.x,r=this.y+t.y;return new Pt(s,r)}div(t){return new Pt(this.x/t,this.y/t)}add1(t,s){return new Pt(this.x+t,this.y+s)}mul(t){return new Pt(this.x*t,this.y*t)}cross(t){return this.x*t.y-this.y*t.x}getSin(){return this.y/this.length()}angle2(t){let s=this.y-t.y,r=this.x-t.x;return s=Math.abs(s-0)<10**-4?0:s,r=Math.abs(r-0)<10**-4?0:r,Math.atan2(s,r)}angleD2(t){return ct.toDegrees(this.angle2(t))}angle(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleX(t=Pt.ORIGIN){let s=this.angle(t);return s<0&&(s=Math.PI*2+s),s}angleD(t){return ct.toDegrees(this.angle(t))}distance1(t){let s=t.x-this.x,r=t.y-this.y;return js.hypot(s,r)}distance2(t){let s=t.x-this.x,r=t.y-this.y;return s*s+r*r}rotateD(t,s){return this.rotate(t,ct.toRadians(s))}rotate(t,s){let r=Math.cos(s),i=Math.sin(s),n=this.x-t.x,a=this.y-t.y,o=n*r+a*-i,c=n*i+a*r;return t.add1(o,c)}multiply3(t){let s=this.x*t.data[0]+this.y*t.data[3]+t.data[6],r=this.x*t.data[1]+this.y*t.data[4]+t.data[7];return new Pt(s,r)}multiply4(t){let s=this.x*t.data[0]+this.y*t.data[4]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+t.data[13];return new Pt(s,r)}hashCode(){return this.hashed}equals(t,s){return t instanceof Pt?_w(t.x,this.x,s)&&_w(t.y,this.y,s):!1}equals1(t){return t?Se.eq(this.x,t.x)&&Se.eq(this.y,t.y):!1}equals2(t,s){return t instanceof Pt?Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s:!1}similarEquals(t,s=.5){return Math.abs(this.x*.1-t.x*.1)<=s&&Math.abs(this.y*.1-t.y*.1)<=s}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let t=this.x,s=this.y;return new Jr(t,t,s,s)}normalize(){if(this.x===0&&this.y===0)return new Pt(0,0);let t=this.x/this.length(),s=this.y/this.length();return new Pt(t,s)}regular(t=1e-4){let s=Math.round(1/t);return new Pt(Math.round(this.x*s)/s,Math.round(this.y*s)/s)}round(t=4){let s=10**(t|0);return new Pt(Math.round(this.x*s)/s,Math.round(this.y*s)/s)}mirrorX(t=Pt.ORIGIN){return new Pt(this.x,2*t.y-this.y)}mirrorY(t=Pt.ORIGIN){return new Pt(2*t.x-this.x,this.y)}mirrorCenter(t=Pt.ORIGIN){return new Pt(2*t.x-this.x,2*t.y-this.y)}clone(){return new Pt(this.x,this.y)}mirror(t=Pt.ORIGIN){return new Pt(2*t.x-this.x,2*t.y-this.y)}pointOnRays(t,s){let r=ct.toRadians(t);return new Pt(this.x+Math.cos(r)*s,this.y+Math.sin(r)*s)}pointOnRays2(t,s){let r=t.angle(this);return new Pt(this.x+Math.cos(r)*s,this.y+Math.sin(r)*s)}scale(t){return new Pt(this.x*t,this.y*t)}},Pt.ORIGIN=new Pt(0,0),Pt.X_UNIT_VECTOR=new Pt(1,0),Pt.Y_UNIT_VECTOR=new Pt(0,1),Pt),x3=(e=>(e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT",e))(x3||{}),v3=(e=>(e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM",e))(v3||{}),Qs,Na=(Qs=class{constructor(t,s){this.horizontal=t,this.vertical=s}},Qs.LT=new Qs(0,0),Qs.LC=new Qs(0,1),Qs.LB=new Qs(0,2),Qs.CT=new Qs(1,0),Qs.CC=new Qs(1,1),Qs.CB=new Qs(1,2),Qs.RT=new Qs(2,0),Qs.RC=new Qs(2,1),Qs.RB=new Qs(2,2),Qs),R3=(e=>(e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER",e[e.SEPARATED=2]="SEPARATED",e[e.INTERSECTED=3]="INTERSECTED",e[e.EQ=4]="EQ",e[e.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",e[e.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",e))(R3||{}),Ti=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(e){return this.minX=Math.min(this.minX,e.minX),this.maxX=Math.max(this.maxX,e.maxX),this.minY=Math.min(this.minY,e.minY),this.maxY=Math.max(this.maxY,e.maxY),this}ext2(e){return this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y),this}ext3(e){for(let t=0;t<e.length;t++){let s=e[t];this.ext2(s)}return this}ext4(e){return iu(e,(t,s)=>(this.ext2(s),!0)),this}ext5(e,t,s,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,s),this.maxY=Math.max(this.maxY,r),this}ext6(e,t){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t),this}ext7(e){if(e<0){let t=e*2;if(t<this.minX-this.maxX||t<this.minY-this.maxY)throw new Error("")}return this.minX-=e,this.maxX+=e,this.minY-=e,this.maxY+=e,this}ext8(e){let t=[];for(let s=0;s<e.length;s+=2)t.push(new he(e[s],e[s+1]));return this.ext3(t)}ext9(e,t,s,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e+s),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t+r),this}ext10({x:e,y:t,width:s,height:r}){return this.ext9(e,t,s,r)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new Jr(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new Jr(this.minX,this.maxX,this.minY,this.maxY):new Jr(0,0,0,0)}},Dh=new Float64Array(4),Jr=class nn{static extendRect({x:t,y:s,width:r,height:i}){return new nn(t,t+r,s,s+i)}static extend1(t,s){if(t===null)return new nn(s.x,s.x,s.y,s.y);{let r=Math.min(t.minX,s.x),i=Math.max(t.maxX,s.x),n=Math.min(t.minY,s.y),a=Math.max(t.maxY,s.y);return new nn(r,i,n,a)}}static extend2(t,s){if(t){let r=Math.min(t.minX,s.minX),i=Math.max(t.maxX,s.maxX),n=Math.min(t.minY,s.minY),a=Math.max(t.maxY,s.maxY);return new nn(r,i,n,a)}else return s}static extend3(t,s){let r=Math.min(t.x,s.x),i=Math.max(t.x,s.x),n=Math.min(t.y,s.y),a=Math.max(t.y,s.y);return new nn(r,i,n,a)}static extend4(t,s,r){return new nn(t.x-s/2,t.x+s/2,t.y-r/2,t.y+r/2)}constructor(t,s,r,i){if(this.minX=Ps.normal(t),this.maxX=Ps.normal(s),this.minY=Ps.normal(r),this.maxY=Ps.normal(i),t>s||r>i)throw new Error(`min > max is not permitted: [${t}, ${s}, ${r}, ${i}]`)}get data(){return Dh[0]=this.minX,Dh[1]=this.maxX,Dh[2]=this.minY,Dh[3]=this.maxY,Dh}isContains(t){return this.isContains1(t.x,t.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(t,s){return this.isContainsX(t)&&this.isContainsY(s)}isContains2(t,s){return this.isContainsX1(t)&&this.isContainsY1(s)}isContainsX(t){return t>=this.minX&&t<=this.maxX}isContainsX1(t){return Se.greatereq(t,this.minX)&&Se.lesseq(t,this.maxX)}isContainsY(t){return t>=this.minY&&t<=this.maxY}isContainsY1(t){return Se.greatereq(t,this.minY)&&Se.lesseq(t,this.maxY)}isIntersect(t){return!(this.maxX<t.minX||this.minX>t.maxX||this.maxY<t.minY||this.minY>t.maxY)}extendOfSize(t){return Ps.positiveOr0(this.maxX-this.minX+t*2),Ps.positiveOr0(this.maxY-this.minY+t*2),new nn(this.minX-t,this.maxX+t,this.minY-t,this.maxY+t)}isInside(t){return this.minX>=t.minX&&this.maxX<=t.maxX&&this.minY>=t.minY&&this.maxY<=t.maxY}isContainsBBox(t){return this.maxX>=t.maxX&&this.minX<=t.minX&&this.maxY>=t.maxY&&this.minY<=t.minY}isContainsBBox1(t){return Se.greatereq(this.maxX,t.maxX)&&Se.lesseq(this.minX,t.minX)&&Se.greatereq(this.maxY,t.maxY)&&Se.lesseq(this.minY,t.minY)}intersect(t){let s=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(s>r)return null;let i=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return i>n?null:new nn(s,r,i,n)}intersection1(t){let s=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(Se.greater(s,r))return null;s>r&&(r=s);let i=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return Se.greater(i,n)?null:(i>n&&(n=i),new nn(s,r,i,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new he(this.minX,this.maxY)}UR(){return new he(this.maxX,this.maxY)}LL(){return new he(this.minX,this.minY)}LR(){return new he(this.maxX,this.minY)}center(){return new he(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(t){let s=new Ti;return s.ext2(this.LL().multiply3(t)),s.ext2(this.LR().multiply3(t)),s.ext2(this.UR().multiply3(t)),s.ext2(this.UL().multiply3(t)),s.build()}transform4(t){let s=new Ti;return s.ext2(this.LL().multiply4(t)),s.ext2(this.LR().multiply4(t)),s.ext2(this.UR().multiply4(t)),s.ext2(this.UL().multiply4(t)),s.build()}isSeparated(t){if(t==null||t==null)return!1;let s;this.minX>=t.minX?s=this.minX:s=t.minX;let r;if(this.maxX<=t.maxX?r=this.maxX:r=t.maxX,s>r)return!0;{let i;this.minY>=t.minY?i=this.minY:i=t.minY;let n;return this.maxY<=t.maxY?n=this.maxY:n=t.maxY,i>n}}relation(t){let s=0,r=0,i;this.minX>t.minX?(s++,i=this.minX):this.minX===t.minX?i=this.minX:(r++,i=t.minX);let n;if(this.maxX<t.maxX?(s++,n=this.maxX):this.maxX===t.maxX?n=this.maxX:(r++,n=t.maxX),i>n)return 2;{let a;this.minY>t.minY?(s++,a=this.minY):this.minY===t.minY?a=this.minY:(r++,a=t.minY);let o;return this.maxY<t.maxY?(s++,o=this.maxY):this.maxY===t.maxY?o=this.maxY:(r++,o=t.maxY),a>o?2:s===4?0:r===4?1:s===0&&r===0?4:i===n||a===o?6:s!==r?5:3}}zoom(t){let s=this.width(),r=this.height(),i=this.center();return t!=0&&(s/=t/2,r/=t/2),new nn(i.x-s,i.x+s,i.y-s,i.y+s)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(t){return this.minY==t.minY&&this.minX==t.minX&&this.maxX==t.maxX&&this.maxY==t.maxY}extendSize(t,s){return Object.is(void 0,s)&&(s=t),nn.extend4(this.center(),this.width()+t,this.height()+s)}positionOnBBox(t,s=0){let r=this.center(),i=this.width()*s/2,n=this.height()*s/2,a=t.x-r.x,o=t.y-r.y;return a>i?o>n?Na.RT:o<-n?Na.RB:Na.RC:a<-i?o>n?Na.LT:o<-n?Na.LB:Na.LC:o>n?Na.CT:o<-n?Na.CB:Na.CC}bbox(){return this}},Em=class It{static mul(t,s,r,i,n,a){let o=0,c=0;for(let l=0;l<t;l++){for(let u=0;u<r;u++){let h=u,p=0;for(let d=0;d<s;d++)p+=i[c+d]*n[h],h+=r;a[o++]=p}c+=s}}constructor(t,s,r){this.m=Ps.normal(t),this.n=Ps.normal(s);let i=t*s;if(r.length===i){for(let n=0;n<r.length;n++)Ps.normal(r[n]);this.data=r}else throw new Error("invalid matrix size")}mul(t){if(this.n===t.m){let s=new Array(this.m*t.n);return It.mul(this.m,this.n,t.n,this.data,t.data,s),new It(this.m,t.n,s)}else throw new Error("m !== p")}toString(){let t=[];t.push("Matrix ("),t.push(this.m.toString()),t.push(" x "),t.push(this.n.toString()),t.push(")");let s=0;for(let r=0;r<this.m;r++)for(let i=0;i<this.n;i++){let n=this.data[s++].toString();i===0?(t.push(`
`),t.push("	"),t.push(n)):(t.push(", "),t.push(n))}return t.join("")}static on(t,s,r){return t*s+r}initExpandMatrix(t){let s=this.m,r=this.n,i=r*2,n=new Array(s*i);for(let a=0;a<s;a++)for(let o=0;o<i;o++)o<r?n[It.on(i,a,o)]=t[It.on(r,a,o)]:o===s+a?n[It.on(i,a,o)]=1:n[It.on(i,a,o)]=0;return n}inverseMatrix(t,s,r){for(let i=0;i<s;i++){let n=t[It.on(r,i,i)];for(let a=0;a<r;a++)t[It.on(r,i,a)]/=n}return t}getMatrixRank(t,s,r){let i=Math.min(s,r);for(let n=0;n<s;n++){if(t[It.on(r,n,n)]===0){let a=new Array(r),o;for(o=n;o<s;o++)if(t[It.on(r,o,n)]!==0){Kr.arraycopy(t,It.on(r,o,0),a,0,r),Kr.arraycopy(t,It.on(r,n,0),t,It.on(r,o,0),r),Kr.arraycopy(a,0,t,It.on(r,n,0),r);break}o>=s&&(i-=1)}if(!(i<s))for(let a=0;a<s;a++){if(a===n)continue;let o=t[It.on(r,a,n)]/t[It.on(r,n,n)];for(let c=0;c<r;c++)t[It.on(r,a,c)]-=t[It.on(r,n,c)]*o}}return i}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function t(a){return Se.lesseq(Math.abs(a),0)}let s=this.initExpandMatrix(this.data.slice(0)),r=this.n*2;function i(a,o){for(let c=0;c<r;c++){let l=s[It.on(r,a,c)];s[It.on(r,a,c)]=s[It.on(r,o,c)],s[It.on(r,o,c)]=l}}for(let a=0;a<this.m;a++){let o=Math.abs(s[It.on(r,a,a)]),c=a;if(t(s[It.on(r,a,a)]))for(let u=a+1;u<this.m;u++){if(t(s[It.on(r,u,a)])){Math.abs(s[It.on(r,u,a)])>o&&(o=Math.abs(s[It.on(r,u,a)]),c=u);continue}i(a,u);break}if(t(s[It.on(r,a,a)])){if(o===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),c!==a&&i(a,c)}let l=1/s[It.on(r,a,a)];for(let u=0;u<r;u++)s[It.on(r,a,u)]*=l;for(let u=0;u<this.m;u++){if(a===u)continue;let h=s[It.on(r,u,a)];for(let p=a;p<r;p++)s[It.on(r,u,p)]-=s[It.on(r,a,p)]*h}}let n=[];for(let a=0;a<this.m;a++)for(let o=this.n;o<r;o++)n[It.on(this.n,a,o-this.n)]=s[It.on(r,a,o)];return new It(this.m,this.n,n)}getTransposeMatrix(){let t=new Array(this.data.length);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)t[r*this.n+s]=this.data[s*this.m+r];return new It(this.n,this.m,t)}hashCode(){let t=0;for(let s of this.data)t+=s;return t}equals(t){return this===t?!0:t===null?!1:t instanceof It?!(this.m!=t.m||this.n!=t.n||!Kr.equals(this.data,t.data)):!1}},N3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],us,v2=(us=class extends Em{static translate(t,s,r){return new us([1,0,0,0,0,1,0,0,0,0,1,0,t,s,r,1])}static translate1(t){return new us([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static rotateX(t){let s=Math.cos(t),r=Math.sin(t);return new us([1,0,0,0,0,s,r,0,0,-r,s,0,0,0,0,1])}static rotateY(t){let s=Math.cos(t),r=Math.sin(t);return new us([s,0,-r,0,0,1,0,0,r,0,s,0,0,0,0,1])}static rotateZ(t){let s=Math.cos(t),r=Math.sin(t);return new us([s,r,0,0,-r,s,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(t,s){t=t.normalize();let r=t.x,i=t.y,n=t.z,a=Math.sin(s),o=Math.cos(s);return new us([r*r*(1-o)+o,r*i*(1-o)+n*a,r*n*(1-o)-i*a,0,r*i*(1-o)-n*a,i*i*(1-o)+o,i*n*(1-o)+r*a,0,r*n*(1-o)+i*a,i*n*(1-o)-r*a,n*n*(1-o)+o,0,0,0,0,1])}static scale(t,s=t,r=t){return new us([t,0,0,0,0,s,0,0,0,0,r,0,0,0,0,1])}static flipX(){return new us([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new us([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(t,s){return t.equals1(he.ORIGIN)?us.rotateZ(s):us.translate(-t.x,-t.y,0).rotateZ(s).translate1(t.x,t.y,0)}static getMatrix4(t,s,r,i){let n=Math.cos(s),a=Math.sin(s),o=r*(t.x*n-t.y*a)+i.x,c=t.x*a+t.y*n+i.y,l=[r*n,a,0,0,-a*r,n,0,0,0,0,1,0,o,c,0,1];return new us(l)}constructor(t=N3){super(4,4,t)}translate(t){return this.multiply4(us.translate1(t))}translate1(t,s,r){return this.multiply4(us.translate(t,s,r))}rotateX(t){return this.multiply4(us.rotateX(t))}rotateY(t){return this.multiply4(us.rotateY(t))}rotateZ(t){return this.multiply4(us.rotateZ(t))}scale(t,s=t,r=t){return this.multiply4(us.scale(t,s,r))}scale1(t){return this.multiply4(us.scale(t.x,t.y,t.z))}setOrigin(t,s,r){return us.translate(-t,-s,-r).multiply4(this).translate1(t,s,r)}setOrigin1(t){return this.setOrigin(t.x,t.y,t.z)}multiply4(t){let s=new Array(16);return Em.mul(4,4,4,this.data,t.data,s),new us(s)}getInverseMatrix(){let t=super.getInverseMatrix();return new us(t.data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new us(t.data)}inverse(){let t=this.getInverseMatrix();return new us(t.data)}toMatrix3(){let t=this.data;return new Yt([t[0],t[1],0,t[4],t[5],0,t[12],t[13],1])}},us.ORIGIN=new us,us);function Ph(e){return I2.normal(parseFloat(e))}var L3=[1,0,0,0,1,0,0,0,1],rs,Yt=(rs=class extends Em{static translate(t,s){return new rs([1,0,0,0,1,0,t,s,1])}static translate1(t){return this.translate(t.x,t.y)}static rotate(t){let s=Math.cos(t),r=Math.sin(t);return new rs([s,r,0,-r,s,0,0,0,1])}static rotateD(t){return this.rotate(ct.toRadians(t))}static scale(t,s=t){return new rs([t,0,0,0,s,0,0,0,1])}static scale1(t,s){return new rs([t,0,0,0,s,0,0,0,1])}static toDOMMatrix(t){let[s,r,,i,n,,a,o]=t.data;return`matrix(${[s,r,i,n,a,o].join(",")})`}static svgTrasform(t){let s=t.split(" "),r=null;return s.forEach(i=>{i=i.trim();let n=i.trim().replace(")","").split("("),a=n[0],o=n[1].split(",");switch(a){case"translate":let c=Ph(o[0]),l=Ph(o[1]);r=r?r.translate(c,l):rs.translate(c,l);break;case"rotate":let u=Ph(o[0]),h=Ph(o[1]),p=Ph(o[2]);r=r?r.setOrigin(h,p):rs.translate(h,p),r=r.rotateD(u);break;default:return}}),r}constructor(t=L3){super(3,3,t);let s=t[0],r=t[3],i=t[1],n=t[4];this.iScale=Math.sqrt(s*s+i*i),this.jScale=Math.sqrt(r*r+n*n)}isMirrored(){return this.det()<0}multiply3(t){let s=new Array(9);return Em.mul(3,3,3,this.data,t.data,s),new rs(s)}translate(t,s){return this.multiply3(rs.translate(t,s))}translate1(t){return this.multiply3(rs.translate1(t))}scale(t,s=t){return this.multiply3(rs.scale(t,s))}scale1(t,s){return this.multiply3(rs.scale1(t,s))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let t=this.getInverseMatrix();return new rs(t.data)}rotateD(t){return this.multiply3(rs.rotateD(t))}rotate(t){return this.multiply3(rs.rotate(t))}resetOffset(){let t=this.data;return new rs([t[0],t[1],0,t[3],t[4],0,0,0,1])}setOrigin(t,s){return rs.translate(-t,-s).multiply3(this).translate(t,s)}setOrigin1(t){return this.setOrigin(t.x,t.y)}getInverseMatrix(){return new rs(super.getInverseMatrix().data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new rs(t.data)}toMatrix4(){let t=this.data;return new v2([t[0],t[1],0,t[2],t[3],t[4],0,t[5],0,0,1,0,t[6],t[7],0,t[8]])}scaleNum(t){return!t||isNaN(t)?t:t*this.iScale}},rs.ORIGIN=new rs,rs.MIRROR_Y=new rs([1,0,0,0,-1,0,0,0,1]),rs.MIRROR_X=new rs([-1,0,0,0,1,0,0,0,1]),rs.ROT_90=new rs([0,1,0,-1,0,0,0,0,1]),rs.ROT_N90=new rs([0,-1,0,1,0,0,0,0,1]),rs),B3=(e=>(e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e))(B3||{}),xo=(e=>(e[e.CW=0]="CW",e[e.CCW=1]="CCW",e))(xo||{}),nd=class{},C1=class Lh{constructor(t,s,r){this.p1=t,this.p2=s,this.p3=r}barycentre(){return Lh.barycentre(this.p1,this.p2,this.p3)}incentre(){return Lh.incentre(this.p1,this.p2,this.p3)}static barycentre(t,s,r){let i=t.x+s.x+r.x,n=t.y+s.y+r.y;return new he(i/3,n/3)}static incentre(t,s,r){let i=s.sub(r).length(),n=t.sub(r).length(),a=t.sub(s).length(),o=i+n+a,c=i*t.x+n*s.x+a*r.x,l=i*t.y+n*s.y+a*r.y;return new he(c/o,l/o)}area(){return Lh.area(this.p1,this.p2,this.p3)}static area(t,s,r){return this.area2(t.x,t.y,s.x,s.y,r.x,r.y)/2}static area2(t,s,r,i,n,a){return Math.abs(js.crossProd2(t,s,r,i,n,a))}scale(t,s){let r=Yt.translate(-t.x,-t.y).scale(s).translate1(t),i=this.p1.multiply3(r),n=this.p2.multiply3(r),a=this.p3.multiply3(r);return new Lh(i,n,a)}scaleOnBarycentre(t){return this.scale(this.barycentre(),t)}scaleOnIncentre(t){return this.scale(this.incentre(),t)}extend(t){let s=this.incentre(),r=this.p1.add(this.p2).sub(s).scale(1/2),i=r.length(),n=he.ORIGIN.pointOnRays2(r,i+t).length()/i;return this.scaleOnIncentre(n)}container(t){let s=this.p3.sub(this.p1),r=this.p2.sub(this.p1),i=t.sub(this.p1),n=s.dot(s),a=s.dot(r),o=s.dot(i),c=r.dot(r),l=r.dot(i),u=1/(n*c-a*a),h=(c*o-a*l)*u;if(h<0||h>1)return!1;let p=(n*l-a*o)*u;return p<0||p>1?!1:h+p<=1}};function Gf(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var Rn=class Io{static getMinDistanceWithoutCross(t,s){let r=Gf();return Io.minLine(t,s,r),r.minDistance}static getMinDistance(t,s){return cn(t,s)?0:this.getMinDistanceWithoutCross(t,s)}static getMinLineWithCross(t,s){let r=Gf();return Io.minLine(t,s,r),new ce(r.start,r.end)}static getMinLine(t,s){return Io.intersection(t,s)||this.getMinLineWithCross(t,s)}static getMinDistanceFromPoint(t,s){let r=Gf();if(s instanceof ce)this.point2LineMinLine(r,s,t);else if(s instanceof Te)this.point2ArcMinDistance(t,s,r);else throw new Error("not support");return r.minDistance}constructor(t,s){if(this.pt1=t,this.pt2=s,this.minline=Io.intersection(t,s),this.minline)this.minDistance=0;else{let r=Gf();Io.minLine(t,s,r),this.minline=new ce(r.start,r.end),this.minDistance=r.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(t,s){let r=cn(t,s);if(r===0)return;let i=new Array;for(let n=0;n<r;n+=2){let a=new he(ee[n],ee[n+1]);i.push(a)}return i.length>1?new ce(i[0],i[1]):new ce(i[0],i[0])}static minLine(t,s,r){if(t instanceof ce&&s instanceof ce)return this.minDistanceForLines(t,s,r);if(t instanceof Te&&s instanceof ce)return this.minDistanceForLineAndArc(t,s,r);if(t instanceof ce&&s instanceof Te)return this.minDistanceForLineAndArc(s,t,r);if(t instanceof Te&&s instanceof Te)return this.minDistanceForArcs(t,s,r);throw new Error("not support")}static minDistanceForLines(t,s,r){[t.start(),t.end(),s.start(),s.end()].forEach((i,n)=>{n<2?this.point2LineMinLine(r,s,i):this.point2LineMinLine(r,t,i)})}static minDistanceForLineAndArc(t,s,r){this.point2LineMinLine(r,s,t.start()),this.point2LineMinLine(r,s,t.svgEnd);let i=Io.foot(s,t.center);s.bbox().extendOfSize(1e-8).isContains(i)&&this.point2ArcMinLine(r,t,i),this.point2ArcMinLine(r,t,s.start()),this.point2ArcMinLine(r,t,s.end())}static minDistanceForArcs(t,s,r){this.concentricArc(t,s,r),this.point2ArcMinDistance(s.start(),t,r),this.point2ArcMinDistance(s.svgEnd,t,r),this.point2ArcMinDistance(t.start(),s,r),this.point2ArcMinDistance(t.svgEnd,s,r),(Pn(t,s.center)||Pn(s,t.center))&&this.shortestLineForArcs(t,s,r)}static minLineForArcAndLine(t,s,r){let i=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));this.arcShortestLine(t,s,r,i),this.arcShortestLine(t,s,r,n)}static arcInnerLineFootSegment(t,s,r){let i=r.distance1(t.center);if(i!==0){let n=t.rx*(r.y-t.center.y)/i+t.center.y,a=t.rx*(r.x-t.center.x)/i+t.center.x;i=t.rx-i,i<s.minDistance&&(s.minDistance=i,s.start=new he(a,n),s.end=r)}else i=t.rx-i,i<s.minDistance&&(s.minDistance=i,s.start=t.start(),s.end=r)}static shortestLineForArcs(t,s,r){let i=t.center.angleD(s.center),n=s.center.angleD(t.center),a=t.pointOn(i),o=t.pointOn(n),c=s.pointOn(i),l=s.pointOn(n);Pn(t,a)&&(this.arcShortestLine(s,r,a,c),this.arcShortestLine(s,r,a,l)),Pn(t,o)&&(this.arcShortestLine(s,r,o,c),this.arcShortestLine(s,r,o,l)),this.shortestLineForArcs1(t,s,r)}static shortestLineForArcs1(t,s,r){let i=s.start().sub(t.center).normalize(),n=s.end().sub(t.center).normalize(),a=t.start().sub(s.center).normalize(),o=t.end().sub(s.center).normalize(),c=t.center.add(i.mul(t.rx)),l=t.center.add(n.mul(t.rx)),u=s.center.add(a.mul(s.rx)),h=s.center.add(o.mul(s.rx));Pn(t,c)&&Se.greater(s.start().distance2(t.center),0)&&this.arcShortestLine(t,r,s.start(),c),Pn(t,l)&&Se.greater(s.end().distance2(t.center),0)&&this.arcShortestLine(t,r,s.end(),l),Pn(s,u)&&Se.greater(t.start().distance2(s.center),0)&&this.arcShortestLine(s,r,t.start(),u),Pn(s,h)&&Se.greater(t.end().distance2(s.center),0)&&this.arcShortestLine(s,r,t.end(),h)}static concentricArc(t,s,r){if(!(t.center.distance1(s.center)<1e-5&&t.rx===s.rx&&t.ry===s.ry))return;let i=t.start().distance1(s.svgEnd);i<r.minDistance&&(r.minDistance=i,r.start=t.start(),r.end=s.svgEnd),i=s.start().distance1(t.svgEnd),i<r.minDistance&&(r.minDistance=i,r.start=s.start(),r.end=t.svgEnd)}static point2ArcMinDistance(t,s,r){if(Pn(s,t)){let i=s.pointOn(t.angleD(s.center)),n=s.pointOn(s.center.angleD(t));this.arcShortestLine(s,r,t,i),this.arcShortestLine(s,r,t,n)}else this.minLineSegment(r,s.start(),t),this.minLineSegment(r,s.svgEnd,t)}static point2ArcMinLine(t,s,r){if(Pn(s,r)){let i=r.distance1(s.center);i>s.rx||i>s.ry?this.minLineForArcAndLine(s,t,r):this.arcInnerLineFootSegment(s,t,r)}}static point2LineMinLine(t,s,r){let i=Io.foot(s,r);s.bbox().extendOfSize(1e-8).isContains(i)?this.minLineSegment(t,i,r):(this.minLineSegment(t,s.start(),r),this.minLineSegment(t,s.end(),r))}static minLineSegment(t,s,r){let i=s.distance1(r);i<t.minDistance&&(t.minDistance=i,t.start=s,t.end=r)}static arcShortestLine(t,s,r,i){if(!Pn(t,i))return;let n=r.distance1(i);n<s.minDistance&&(s.minDistance=n,s.start=r,s.end=i)}static foot(t,s){if(t.isPoint())return t.start();if(!Se.eq(t.b,0)&&!Se.eq(t.a,0)){let r=t.start(),i=t.direct,n=(s.x-r.x)*i.x+(s.y-r.y)*i.y;return new he(r.x+i.x*n,r.y+i.y*n)}else return Se.eq(t.b,0)&&!Se.eq(t.a,0)?new he(t.start().x,s.y):!Se.eq(t.b,0)&&Se.eq(t.a,0)?new he(s.x,t.start().y):s}};function Pn(e,t){if(Se.eq(e.sweepAngle,360))return!0;let s=ct.regularD(t.angleD(e.center));return e.sweepAngle>0?(Se.less(s,e.startAngle)&&(s+=360),Se.greatereq(e.endAngle(),s)):(Se.greater(s,e.startAngle)&&(s-=360),Se.lesseq(e.endAngle(),s))}var k3=[1,10,100,1e3],Pw="http://www.w3.org/2000/svg",Ow="http://www.w3.org/1999/xlink",Iw="http://www.w3.org/XML/1998/namespace",xw="https://easyeda.com/",kG=(function(){var e={svg:Pw,xlink:Ow,xml:Iw,c:xw};return e[Pw]="svg",e[Ow]="xlink",e[Iw]="xml",e[xw]="c",e})();var $s=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),MG=(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};e["3D"]=(function(){for(var i=[16,19,3,7,5,1],n=21;n<52;n++)i.push(n+32,n);return i.push(2,6,8,4,17),i})();var t,s,r;for(t in e)if(e.hasOwnProperty(t)&&(r=e[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(s=25;s<=52;s++)r.push(s);return e})(),Sr=(function(){var e={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<53;t++)e[t]="Inner"+(t-20);for(t=53;t<85;t++)e[t]="Substrate"+(t-52);return e})(),jG=(function(){var e=[],t=[];for(var s in $s)if($s.hasOwnProperty(s)){if(s.match(/^BOARD\d+/))continue;e.push($s[s])}e.sort(),t.sort();var r={},i,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};e.forEach(function(o){switch(o){case $s.TOPLAYER:i={name:Sr[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case $s.BOTTOMLAYER:i={name:Sr[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case $s.TOPSILKLAYER:i={name:Sr[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case $s.BOTTOMSILKLAYER:i={name:Sr[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case $s.TOPPASTERLAYER:i={name:Sr[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case $s.BOTTOMPASTERLAYER:i={name:Sr[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case $s.TOPSOLDERLAYER:i={name:Sr[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case $s.BOTTOMSOLDERLAYER:i={name:Sr[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case $s.RATLINES:i={name:Sr[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case $s.BOARDOUTLINE:i={name:Sr[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case $s.ALL:i={name:Sr[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case $s.DOCUMENT:i={name:Sr[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case $s.TOPASSEMBLY:i={name:Sr[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case $s.BOTTOMASSEMBLY:i={name:Sr[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case $s.MECHANICAL:i={name:Sr[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case $s.MODEL3D:i={name:Sr[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case $s.LIBBODY:i={name:Sr[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case $s.PADSURFACE:i={name:Sr[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=$s.INNER1&&o<=$s.INNER32?i={name:Sr[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:i=null;break}i&&(r[o]=i)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var c=parseInt(RegExp.$1,16),l=.5,u=Math.min(255,Math.round((c>>16)*l)),h=Math.min(255,Math.round((c>>8&255)*l)),p=Math.min(255,Math.round((c&255)*l)),d=((u<<16)+(h<<8)+p).toString(16);return"#"+("00000"+d).substr(-6).toUpperCase()}return r})(),vw={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},FG=(function(){var e={};for(let t in vw)e[vw[t]]=t;return e})();var Hm=Math.PI*2,bm=Math.PI/2,UG=Math.sin(Math.PI/180);function M3(e,t,s){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!s)return Math.round(e);var r=k3[t]||Math.pow(10,t)||10;if(s){var i=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(i+e)}else return Math.round(e*r+1e-10)/r}function R2(e,t,s){var r=e-t;return s||(s=1e-10),(r>0?r:-r)<s}function j3(e,t,s){var r=u(e)&&u(t)&&u(s);if(!r)return console.warn("Bad arguments"),null;var i=t.x-s.x>0?t.x:s.x,n=t.y-s.y>0?t.y:s.y,a=t.x-s.x>0?s.x:t.x,o=t.y-s.y>0?s.y:t.y,c=e.x,l=e.y;return c<=i+.001&&c>=a-.001&&l<=n+.001&&l>=o-.001;function u(h){return h?(h.x=Number(h.x),h.y=Number(h.y),isNaN(h.x)||isNaN(h.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function F3(e,t,s,r,i,n){var a=(i-s)*(e-s)+(n-r)*(t-r),o=(i-s)*(i-s)+(n-r)*(n-r),c=a/o,l=s+(i-s)*c,u=r+(n-r)*c;return a<=0?Math.sqrt((e-s)*(e-s)+(t-r)*(t-r)):a>=o?Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)):Math.sqrt((e-l)*(e-l)+(u-t)*(u-t))}function U3(e,t,s){return j3(e,t,s)?R2((e.x-t.x)*(s.y-t.y),(s.x-t.x)*(e.y-t.y),.001):!1}var Bh=1e-4,ee=new Float64Array(100);function cn(e,t){if(e instanceof ce&&t instanceof ce)return oa(e,t);if(e instanceof Te&&t instanceof ce)return D1(e,t);if(e instanceof ce&&t instanceof Te)return D1(t,e);if(e instanceof Te&&t instanceof Te)return L2(e,t);if(e instanceof We&&t instanceof We)return rm(e,t);if(e instanceof We&&t instanceof ce)return rm(e,new We([t.start(),t.end()]));if(e instanceof ce&&t instanceof We)return rm(new We([e.start(),e.end()]),t);if(e instanceof We&&t instanceof Te)return jw(t,e);if(e instanceof Te&&t instanceof We)return jw(e,t);throw new Error("not supported operation")}function H3(e,t){let s=e.bbox();if(s.isContainsY1(t)){let r=new ce(new he(s.minX-1,t),new he(s.maxX+1,t));return oa(r,e)>0?1:0}else return 0}function G3(e,t){if(e.rx===e.ry){let s=e.bbox();if(s.isContainsY1(t)){let r=new ce(new he(s.minX-1,t),new he(s.maxX+1,t));return Tm(e,r)>0?1:0}else return 0}else throw new Error("not supported operation")}function Rw(e,t){let s=e.bbox();return s.isContainsY1(t)&&rm(new We([new he(s.minX-1,t),new he(s.maxX+1,t)]),e)>0?1:0}function Nw(e,t,s){return isFinite(t)&&isFinite(s)?e.isContains2(t,s):!1}function Y3(e,t){let s=t.length(),r=js.crossProd3(t.start(),t.end(),e.start())/s,i=js.crossProd3(t.start(),t.end(),e.end())/s;return Math.abs(r)<1e-8||Math.abs(i)<1e-8||r*i<0}function oa(e,t){let s=e.bbox().intersection1(t.bbox());if(!s)return 0;if(e.isPoint())if(t.isPoint()){let r=s.center();return ee[0]=r.x,ee[1]=r.y,2}else return Lw(t,e,s);else{if(t.isPoint())return Lw(e,t,s);{let r=function(y,T){s.isContains2(y,T)&&(ee[E++]=y,ee[E++]=T)};if(!Y3(e,t))return 0;let i=e.start().x,n=e.start().y,a=e.end().x,o=e.end().y,c=t.start().x,l=t.start().y,u=t.end().x,h=t.end().y,p=t.length(),d=js.crossProd2(i,n,c,l,u,h)/p,f=js.crossProd2(a,o,c,l,u,h)/p;if(d*f>0&&!Se.eq(d,0)&&!Se.eq(f,0))return 0;let m=e.length(),g=js.crossProd2(c,l,i,n,a,o)/m,b=js.crossProd2(u,h,i,n,a,o)/m;if(g*b>0&&!Se.eq(g,0)&&!Se.eq(b,0))return 0;let E=0;if(Se.eq(d,0)&&Se.eq(f,0)){let y=s.UL(),T=s.UR(),w=s.LL(),S=s.LR();if(Se.eq(s.width(),0))Se.eq(s.height(),0)?(ee[E++]=y.x,ee[E++]=y.y):(ee[E++]=y.x,ee[E++]=y.y,ee[E++]=w.x,ee[E++]=w.y);else if(Se.eq(s.height(),0))ee[E++]=y.x,ee[E++]=y.y,ee[E++]=T.x,ee[E++]=T.y;else{let _=C1.area2(y.x,y.y,c,l,u,h),C=C1.area2(T.x,T.y,c,l,u,h);_<C?(ee[E++]=y.x,ee[E++]=y.y,ee[E++]=S.x,ee[E++]=S.y):(ee[E++]=T.x,ee[E++]=T.y,ee[E++]=w.x,ee[E++]=w.y)}}else if(Se.eq(d,0))r(i,n);else if(Se.eq(f,0))r(a,o);else{let y=Math.abs(d/(d-f));r(i+(a-i)*y,n+(o-n)*y)}return E}}}function Lw(e,t,s){let r=t.start(),i=t.end(),n=js.crossProd3(e.start(),e.end(),t.start()),a=js.crossProd3(e.start(),e.end(),t.end());if(n*a<0){let o=s.center();return ee[0]=o.x,ee[1]=o.y,2}else if(Math.abs(n)<Math.abs(a)){if(Se.eq(n/e.length(),0))return ee[0]=r.x,ee[1]=r.y,2}else if(Se.eq(a/e.length(),0))return ee[0]=i.x,ee[1]=i.y,2;return 0}function Tm(e,t){let s=e.bbox().intersection1(t.bbox());if(s!=null){s=s.extendOfSize(Bh);let r=e.center.x,i=e.center.y,n=e.rx,a=e.rx2,o=t.start().x,c=t.start().y,l=t.end().x,u=t.end().y,h=e.center.distance1(t.start()),p=e.center.distance1(t.end()),d=Se.eq(h,n)?0:h>n?1:-1,f=Se.eq(p,n)?0:p>n?1:-1,m=0;if(d===-1&&f===-1)return 0;if(d===0&&f===0)ee[m++]=o,ee[m++]=c,ee[m++]=l,ee[m++]=u;else if(d===1&&f===1){let g=Rn.foot(t,e.center),b=g.distance1(e.center);if(Se.greater(b,n))return 0;if(Se.eq(b,n))Se.eq(t.distance2(e.start()),0)?(ee[m++]=e.start().x,ee[m++]=e.start().y,ee[m++]=e.start().x,ee[m++]=e.start().y):Se.eq(t.distance2(e.end()),0)?(ee[m++]=e.end().x,ee[m++]=e.end().y,ee[m++]=e.end().x,ee[m++]=e.end().y):(ee[m++]=g.x,ee[m++]=g.y,ee[m++]=g.x,ee[m++]=g.y);else{m=N2(r,i,o,c,l,u,m,g);let E=ee[m-2],y=ee[m-1];m-=2;let T=js.distance1(r,i,E,y);if(Se.eq(T,n))ee[m++]=E,ee[m++]=y,ee[m++]=E,ee[m++]=y;else if(T<n)m=Rr(a,r,i,o,c,E,y,m),m=Rr(a,r,i,E,y,l,u,m);else return 0}}else if(d===-1||f===-1)m=Rr(a,r,i,o,c,l,u,m);else{let g=Rn.foot(t,e.center),b=g.distance1(e.center);if(Se.eq(b,n)){let E=function(w){return Nw(s,w.x,w.y)&&Ws(e,w)},y=e.start(),T=e.end();if(d===0){let w=t.start();if(E(w))return ee[m++]=w.x,ee[m++]=w.y,ee[m++]=w.x,ee[m++]=w.y,m;if(E(g))return ee[m++]=g.x,ee[m++]=g.y,ee[m++]=g.x,ee[m++]=g.y,m;if(Se.eq(t.distance2(y),0)&&E(y))return ee[m++]=y.x,ee[m++]=y.y,ee[m++]=y.x,ee[m++]=y.y,m;if(Se.eq(t.distance2(T),0)&&E(T))return ee[m++]=T.x,ee[m++]=T.y,ee[m++]=T.x,ee[m++]=T.y,m;if(h<=n)m=Rr(a,r,i,g.x,g.y,l,u,m),m===2&&(ee[m++]=ee[0],ee[m++]=ee[1]);else if(b<n){if(m=Rr(a,r,i,g.x,g.y,l,u,m),m===2&&E(new he(ee[0],ee[1])))return ee[m++]=ee[0],ee[m++]=ee[1],m;m=Rr(a,r,i,g.x,g.y,o,c,0),m===2&&(ee[m++]=ee[0],ee[m++]=ee[1])}}else{let w=t.end();if(E(w))return ee[m++]=w.x,ee[m++]=w.y,ee[m++]=w.x,ee[m++]=w.y,m;if(E(g))return ee[m++]=g.x,ee[m++]=g.y,ee[m++]=g.x,ee[m++]=g.y,m;if(Se.eq(t.distance2(y),0)&&E(y))return ee[m++]=y.x,ee[m++]=y.y,ee[m++]=y.x,ee[m++]=y.y,m;if(Se.eq(t.distance2(T),0)&&E(T))return ee[m++]=T.x,ee[m++]=T.y,ee[m++]=T.x,ee[m++]=T.y,m;if(p<=n)m=Rr(a,r,i,g.x,g.y,o,c,m),m===2&&(ee[m++]=ee[0],ee[m++]=ee[1]);else if(b<n){if(m=Rr(a,r,i,g.x,g.y,o,c,m),m===2&&E(new he(ee[0],ee[1])))return ee[m++]=ee[0],ee[m++]=ee[1],m;m=Rr(a,r,i,g.x,g.y,l,u,0),m===2&&(ee[m++]=ee[0],ee[m++]=ee[1])}}}else if(d===0){let E=t.start();ee[m++]=E.x,ee[m++]=E.y,(o-g.x)*(l-g.x)+(c-g.y)*(u-g.y)<0&&(m=Rr(a,r,i,g.x,g.y,l,u,m))}else{let E=t.end();ee[m++]=E.x,ee[m++]=E.y,(o-g.x)*(l-g.x)+(c-g.y)*(u-g.y)<0&&(m=Rr(a,r,i,g.x,g.y,o,c,m))}}if(m>0){let g=0;for(let b=0;b<m;b+=2){let E=ee[b],y=ee[b+1];isFinite(E)&&isFinite(y)&&Nw(s,E,y)&&Ws(e,new he(E,y))&&(ee[g++]=E,ee[g++]=y)}return g}else return 0}else return 0}function V3(e,t){if(e.bbox()){let s=e.center.x,r=e.center.y,i=e.rx2,n=t.start().x,a=t.start().y,o=t.end().x,c=t.end().y,l=e.center.distance2(t.start()),u=e.center.distance2(t.end()),h=Se.eq(l,i)?0:l>i?1:-1,p=Se.eq(u,i)?0:u>i?1:-1,d=0;if(h===-1&&p===-1)return 0;if(h===0&&p===0)ee[d++]=n,ee[d++]=a,ee[d++]=o,ee[d++]=c;else if(h===1&&p===1){let f=Rn.foot(t,e.center),m=f.distance2(e.center);if(Se.greater(m,i))return 0;if(Se.eq(m,i)){let g=f.distance2(e.start()),b=f.distance2(e.end());Se.eq(g,0)?(ee[d++]=e.start().x,ee[d++]=e.start().y):Se.eq(b,0)?(ee[d++]=e.end().x,ee[d++]=e.end().y):(ee[d++]=f.x,ee[d++]=f.y)}else{d=N2(s,r,n,a,o,c,d,f);let g=ee[d-2],b=ee[d-1],E=js.distance2(s,r,g,b);if(d-=2,Se.eq(E,i))ee[d++]=g,ee[d++]=b;else if(E<i)d=Rr(i,s,r,n,a,g,b,d),d=Rr(i,s,r,g,b,o,c,d);else return 0}}else if(h===-1||p===-1)d=Rr(i,s,r,n,a,o,c,d);else{let f=Rn.foot(t,e.center);h===0?(ee[d++]=t.start().x,ee[d++]=t.start().y,Se.neq(f.distance2(t.start()),0)&&(n-f.x)*(o-f.x)+(a-f.y)*(c-f.y)<0&&(d=Rr(i,s,r,f.x,f.y,o,c,d))):(ee[d++]=t.end().x,ee[d++]=t.end().y,Se.neq(f.distance2(t.end()),0)&&(n-f.x)*(o-f.x)+(a-f.y)*(c-f.y)<0&&(d=Rr(i,s,r,f.x,f.y,n,a,d)))}if(d>0){let f=0;for(let m=0;m<d;m+=2){let g=ee[m],b=ee[m+1];isFinite(g)&&isFinite(b)&&(ee[f++]=g,ee[f++]=b)}return f}else return 0}else return 0}function Rr(e,t,s,r,i,n,a,o){if(i==a){let y=e-(i-s)*(i-s);if(Se.greater(y,0)){let T=Math.sqrt(y),w=t-T,S=t+T,_=Math.min(r,n),C=Math.max(r,n);return w>=_&&w<=C&&(ee[o++]=w,ee[o++]=i),S>=_&&S<=C&&(ee[o++]=S,ee[o++]=i),o}}let c=js.distance2(r,i,t,s)-e;if(c===0)return ee[o++]=r,ee[o++]=i,o;let l=js.distance2(n,a,t,s)-e;if(l===0)return ee[o++]=n,ee[o++]=a,o;let u=r,h=i,p=n,d=a,f=NaN,m=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let y=Math.max(Math.min(Math.abs(c)/(Math.abs(c)+Math.abs(l)),.75),.25);if(f=u+(p-u)*y,m=h+(d-h)*y,u===f&&h===m||p===f&&d===m){Math.abs(c)>Math.abs(l)?(f=p,m=d,g=l):(f=u,m=h,g=c);break}else g=js.distance2(f,m,t,s)-e,g<0&&c>l||g>0&&c<l?(p=f,d=m,l=g):(u=f,h=m,c=g)}let E=Math.sqrt(e)-js.distance1(f,m,t,s);return(Se.eq(0,g)||Se.eq(0,E))&&(ee[o++]=f,ee[o++]=m),o}function N2(e,t,s,r,i,n,a,o){let c=js.dotProd2(s,r,i,n,e,t),l=js.dotProd2(i,n,s,r,e,t);if(c>=0)return ee[a++]=i,ee[a++]=n,a;if(l>=0)return ee[a++]=s,ee[a++]=r,a;if(js.crossProd2(s,r,i,n,e,t)==0)return ee[a++]=e,ee[a++]=t,a;{let u=NaN,h=NaN,p=s,d=r,f=i,m=n,g=js.distance2(s,r,e,t),b=js.distance2(i,n,e,t),E=Number.POSITIVE_INFINITY,y=0;for(;E>0&&(y++,u=p+(f-p)*.5,h=d+(m-d)*.5,!(g==b||p==u&&d==h||f==u&&m==h));){E=js.distance2(u,h,e,t);let T=js.dotProd2(p,d,u,h,e,t);if(T==0)break;T<0?(f=u,m=h,b=E):(p=u,d=h,g=E)}return js.distance2(u,h,e,t)<js.distance2(o.x,o.y,e,t)?(ee[a++]=u,ee[a++]=h):(ee[a++]=o.x,ee[a++]=o.y),a}}function D1(e,t){if(e.rx===e.ry)return Tm(e,t);throw new Error("not supported")}function z3(e,t){if(e.rx===e.ry)return V3(e,t);throw new Error("not supported")}function L2(e,t){if(e.bbox().intersection1(t.bbox())!=null){if(e.rx===e.ry&&t.rx===t.ry)return W3(e,t);throw new Error("not supported operation")}return 0}function W3(e,t){let s=e.center.x,r=e.center.y,i=t.center.x,n=t.center.y,a=e.rx,o=t.rx,c=e.rx2,l=t.rx2,u=e.center.distance1(t.center),h=Math.abs(a-o),p=a+o;if(Se.greater(u,p)||Se.less(u,h))return 0;if(Se.eq(h+u,0)){let d=0,f;return Ws(e,t.start())&&(ee[d]=t.start().x,ee[d+1]=t.start().y,d+=2,f=t.start()),Ws(e,t.end())&&(ee[d]=t.end().x,ee[d+1]=t.end().y,d+=2,f=t.end()),d===0?(Ws(t,e.start())&&(ee[d]=e.start().x,ee[d+1]=e.start().y,d+=2),Ws(t,e.end())&&(ee[d]=e.end().x,ee[d+1]=e.end().y,d+=2)):d===2&&(!f.equals1(e.start())&&Ws(t,e.start())&&(ee[d]=e.start().x,ee[d+1]=e.start().y,d+=2),!f.equals1(e.end())&&Ws(t,e.end())&&(ee[d]=e.end().x,ee[d+1]=e.end().y,d+=2)),d}else if(Se.eq(u,p)){if(Bw(e,t))return 4;let d=new ce(e.center,t.center),f=Tm(t,d);return f=kw(e,f),f!==0?f:(f=Tm(e,d),kw(t,f))}else if(Se.eq(u,h)){if(Bw(e,t))return 4;if(a>o){let d=(a-o)/a;return ee[0]=s+(i-s)/d,ee[1]=r+(n-r)/d,Mw(e,t,2)}else{let d=(o-a)/o;return ee[0]=i+(s-i)/d,ee[1]=n+(r-n)/d,Mw(e,t,2)}}else{let d=(e.center.distance2(t.center)-l+c)/(u*2)/u,f=(i-s)*d+s,m=(n-r)*d+r,g=i-s,b=n-r,E=Math.max(a,o),y,T,w,S;if(Math.abs(g)<Math.abs(b)){let D=g/-b,I=m-D*f;y=f-E,T=D*y+I,w=f+E,S=D*w+I}else{let D=b/-g,I=f-D*m;T=m-E,y=D*T+I,S=m+E,w=D*S+I}let _=Rr(c,s,r,y,T,f,m,0);if(_=Rr(c,s,r,f,m,w,S,_),_!==4)throw new Error("cnt !== 4");let C=new he(ee[0],ee[1]),x=new he(ee[2],ee[3]);if(Ws(e,C)&&Ws(t,C))return Ws(e,x)&&Ws(t,x)?4:Po(e.start(),t,x,C)?(ee[2]=e.start().x,ee[3]=e.start().y,4):Po(e.end(),t,x,C)?(ee[2]=e.end().x,ee[3]=e.end().y,4):Po(t.start(),e,x,C)?(ee[2]=t.start().x,ee[3]=t.start().y,4):Po(t.end(),e,x,C)?(ee[2]=t.end().x,ee[3]=t.end().y,4):2;if(Ws(e,x)&&Ws(t,x))return Po(e.start(),t,C,x)?(ee[0]=e.start().x,ee[1]=e.start().y,4):Po(e.end(),t,C,x)?(ee[0]=e.end().x,ee[1]=e.end().y,4):Po(t.start(),e,C,x)?(ee[0]=t.start().x,ee[1]=t.start().y,4):Po(t.end(),e,C,x)?(ee[0]=t.end().x,ee[1]=t.end().y,4):(ee[0]=ee[2],ee[1]=ee[3],2);{let D=function(F,V){if(Se.eq(F.distance1(V.center),V.rx)&&Ws(V,F)){if(F.distance2(C)<F.distance2(x)){if(I)return;I=!0}else{if(P)return;P=!0}ee[L++]=F.x,ee[L++]=F.y}},I=!1,P=!1,L=0;return D(e.start(),t),D(e.end(),t),D(t.start(),e),D(t.end(),e),L}}}function Po(e,t,s,r){return Se.eq(e.distance1(t.center),t.rx)&&Ws(t,e)&&e.distance2(s)<e.distance2(r)}function Bw(e,t){return Se.eq(t.start().distance1(e.center),e.rx)&&Ws(e,t.start())?(ee[0]=t.start().x,ee[1]=t.start().y,ee[2]=t.start().x,ee[3]=t.start().y,!0):Se.eq(t.end().distance1(e.center),e.rx)&&Ws(e,t.end())?(ee[0]=t.end().x,ee[1]=t.end().y,ee[2]=t.end().x,ee[3]=t.end().y,!0):Se.eq(e.start().distance1(t.center),t.rx)&&Ws(t,e.start())?(ee[0]=e.start().x,ee[1]=e.start().y,ee[2]=e.start().x,ee[3]=e.start().y,!0):Se.eq(e.end().distance1(t.center),t.rx)&&Ws(t,e.end())?(ee[0]=e.end().x,ee[1]=e.end().y,ee[2]=e.end().x,ee[3]=e.end().y,!0):!1}function kw(e,t){if(t===0)return 0;let s=ee[0],r=ee[1];return Ws(e,new he(s,r))?(ee[0]=s,ee[1]=r,ee[2]=s,ee[3]=r,4):0}function Mw(e,t,s){if(s===0)return 0;let r=ee[0],i=ee[1],n=new he(r,i);return Ws(e,n)&&Ws(t,n)?(ee[0]=r,ee[1]=i,ee[2]=r,ee[3]=i,4):0}function Fl(e,t){return Math.abs(e-t)<=1e-6}function Ws(e,t){let s=e.bbox();if(t.x-s.minX>-Bh&&t.x-s.maxX<Bh&&t.y-s.minY>-Bh&&t.y-s.maxY<Bh){let r=ct.regularD(t.angleD(e.center));return Fl(r,e.startAngle)||Fl(r,e.startAngle+360)||Fl(r,e.startAngle-360)||Fl(r,e.endAngle())||Fl(r,e.endAngle()+360)||Fl(r,e.endAngle()-360)?!0:e.sweepAngle>0?(Se.less(r,e.startAngle)&&(r+=360),Se.greatereq(e.endAngle(),r)):(Se.greater(r,e.startAngle)&&(r-=360),Se.lesseq(e.endAngle(),r))}else return!1}function q3(e,t){let s=e[1].x-e[0].x,r=e[1].y-e[0].y,i=t[1].x-t[0].x,n=t[1].y-t[0].y;if(s===0&&i!==0||s!==0&&i===0)return!1;if(s===0&&i===0)return!0;let a=r/s,o=n/i;return R2(a,o,Math.sin(Math.PI/180))}function J3(e,t,s){var r,i=+t.x,n=+t.y,a=+s.x,o=+s.y,c=+e.x,l=+e.y,u=a-i,h=o-n,p=c-i,d=l-n,f,m,g,b,E,y;return u===0&&h===0?{d:Math.sqrt(p*p+d*d),point:new he(i,n)}:(r=(p*u+d*h)/(u*u+h*h),r<0?{d:Math.sqrt(p*p+d*d),point:new he(i,n)}:r>1?(f=c-a,m=l-o,{d:Math.sqrt(f*f+m*m),point:new he(a,o)}):(E=i+r*u,y=n+r*h,g=c-E,b=l-y,{d:Math.sqrt(g*g+b*b),point:new he(E,y)}))}function In(e,t){if(!e||!t||e.length!=t.length)return!1;let s="equals1";return!e.some((r,i)=>{let n=t[i],a=!1;return r&&n&&typeof r=="object"&&typeof n=="object"?typeof r[s]=="function"&&X3(r,n)?a=!r[s].call(r,n):a=!(r===n||r.toString()===n.toString()):typeof r=="number"&&typeof n=="number"?a=!(K3(r,n)||Number.isNaN(r)&&Number.isNaN(n)):a=r!==n,a})}function K3(e,t,s=5){return Math.abs(e-t)*Math.pow(10,s)<1}function X3(e,t){return!e||!t||typeof e!="object"||typeof t!="object"?e===t:e.constructor===t.constructor}var ht=new Float64Array(100);function rm(e,t){if(e.bbox().extendOfSize(Se.eps).isSeparated(t.bbox()))return 0;let s=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,i=0,n=Number.POSITIVE_INFINITY;for(;s.length!==0;){let a=function(B){I=Math.min(I,B),P=Math.max(P,B)},o=function(B,k){let O=oa(B,k);if(O===0)throw new Error("cnt === 0");for(let R=0;R<O;R+=2)a(ee[R])};if(i>r){for(let B=i-2;B>=2;B-=2)for(let k=B-2;k>=0;k-=2)if(Se.eq(ht[B],ht[k])&&Se.eq(ht[B+1],ht[k+1])){ht[k]=(ht[B]+ht[k])/2,ht[k+1]=(ht[B+1]+ht[k+1])/2;for(let O=i-3;O>=B;O--)ht[O]=ht[O+2];i-=2;break}if(i>r){i=0;let B=t.start(),k=new Float64Array(8);e.getPercent(B)!==null&&(k[i++]=B.x,k[i++]=B.y);let O=t.end();e.getPercent(O)!==null&&(k[i++]=O.x,k[i++]=O.y);let R=e.start();t.getPercent(R)!==null&&(k[i++]=R.x,k[i++]=R.y);let v=e.end();return t.getPercent(v)!==null&&(k[i++]=v.x,k[i++]=v.y),ee.set(k),i}}let[c,l]=s.pop(),u=c.controls,h=l.controls;if(u.length===2&&h.length===2){let B=oa(new ce(u[0],u[1]),new ce(h[0],h[1]));for(let k=0;k<B;k++)ht[i++]=ee[k];continue}let p=u[0],d=u[u.length-1];p.equals1(d)&&(d=p.add1(1,0));let f=d.y-p.y,m=p.x-d.x,g=-f*p.x-m*p.y,b=Math.sqrt(1/(f**2+m**2));f*=b,m*=b,g*=b;let E=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY;if(u.forEach(B=>{let k=f*B.x+m*B.y+g;k<E&&(E=k),k>y&&(y=k)}),Se.eq(E,y)){if(l.controls.length===2){let B=oa(new ce(c.start(),c.end()),new ce(l.start(),l.end()));for(let k=0;k<B;k++)ht[i++]=ee[k];if(B!==0)continue}c=new We([u[0],u[u.length-1]]),u=c.controls}let T=h.map(B=>{let k=f*B.x+m*B.y+g,O=Math.abs(k);return O<n&&(n=O),k}),w=0;for(let B of T){if(Se.less(B,E))w=w|1;else if(Se.greater(B,y))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let S=0,_=0,C=d.x-p.x,x=d.y-p.y,D=Math.sqrt(1/(C**2+x**2));C*=D,x*=D;for(let B=1;B<u.length;B++){let k=u[B],O=(k.x-p.x)*C+(k.y-p.y)*x;O<S?S=O:O>_&&(_=O)}w=0;for(let B of h){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(Se.less(k,S))w=w|1;else if(Se.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let I=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY;n/=2,n<=Se.eps&&(n=Se.eps),E-=n,y+=n,T.forEach((B,k)=>{B>=E&&B<=y&&a(k/(T.length-1))});let L=new ce(new he(0,E),new he(1,E)),F=new ce(new he(0,y),new he(1,y));for(let B=0;B<T.length-1;B++){let k=new he(B/(T.length-1),T[B]),O=k.y<E?1:k.y>y?2:3;for(let R=0;R<T.length;R++){let v=new he(R/(T.length-1),T[R]),j=v.y<E?1:v.y>y?2:3;O!==j&&(O===1?j===2?(o(new ce(k,v),L),o(new ce(k,v),F)):o(new ce(k,v),L):O===2?j===1?(o(new ce(k,v),L),o(new ce(k,v),F)):o(new ce(k,v),F):j===1?o(new ce(k,v),L):o(new ce(k,v),F))}}I!==0&&(l=l.clip(I)[1]),P!==1&&(l=l.clip((P-I)/(1-I))[0]);let V=l.bbox();if(Se.eq(V.minX,V.maxX)&&Se.eq(V.minY,V.maxY)){w=0;for(let B of l.controls){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(Se.less(k,S))w=w|1;else if(Se.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w===3){let B=new he((V.minX+V.maxX)/2,(V.minY+V.maxY)/2);c.getPercent(B)&&(ht[i++]=B.x,ht[i++]=B.y)}continue}if(P-I>.8){let[B,k]=l.clip(.5);s.push([B,c]),s.push([k,c])}else s.push([l,c])}for(let a=0;a<i;a++)ee[a]=ht[a];return i}function Z3(e,t){if(e.bbox().extendOfSize(Se.eps).isSeparated(t.bbox()))return{cnt:0};let s=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,i=0,n=Number.POSITIVE_INFINITY;for(;s.length!==0;){let a=function(B){I=Math.min(I,B),P=Math.max(P,B)},o=function(B,k){let O=oa(B,k);if(O===0)throw new Error("cnt === 0");for(let R=0;R<O;R+=2)a(ee[R])};if(i>r){for(let B=i-2;B>=2;B-=2)for(let k=B-2;k>=0;k-=2)if(Se.eq(ht[B],ht[k])&&Se.eq(ht[B+1],ht[k+1])){ht[k]=(ht[B]+ht[k])/2,ht[k+1]=(ht[B+1]+ht[k+1])/2;for(let O=i-3;O>=B;O--)ht[O]=ht[O+2];i-=2;break}if(i>r){i=0;let B=new Float64Array(8),k=t.end(),O=0;e.getPercent(k)!==null&&(B[i++]=k.x,B[i++]=k.y,O=2);let R=e.end();return t.getPercent(R)!==null&&(B[i++]=R.x,B[i++]=R.y,O=O===0?1:3),ee.set(B),{havOverlap:O,cnt:i}}}let[c,l]=s.pop(),u=c.controls,h=l.controls;if(u.length===2&&h.length===2){let B=oa(new ce(u[0],u[1]),new ce(h[0],h[1]));for(let k=0;k<B;k++)ht[i++]=ee[k];continue}let p=u[0],d=u[u.length-1];p.equals1(d)&&(d=p.add1(1,0));let f=d.y-p.y,m=p.x-d.x,g=-f*p.x-m*p.y,b=Math.sqrt(1/(f**2+m**2));f*=b,m*=b,g*=b;let E=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY;if(u.forEach(B=>{let k=f*B.x+m*B.y+g;k<E&&(E=k),k>y&&(y=k)}),Se.eq(E,y)){if(l.controls.length===2){let B=oa(new ce(c.start(),c.end()),new ce(l.start(),l.end()));for(let k=0;k<B;k++)ht[i++]=ee[k];if(B!==0)continue}c=new We([u[0],u[u.length-1]]),u=c.controls}let T=h.map(B=>{let k=f*B.x+m*B.y+g,O=Math.abs(k);return O<n&&(n=O),k}),w=0;for(let B of T){if(Se.less(B,E))w=w|1;else if(Se.greater(B,y))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let S=0,_=0,C=d.x-p.x,x=d.y-p.y,D=Math.sqrt(1/(C**2+x**2));C*=D,x*=D;for(let B=1;B<u.length;B++){let k=u[B],O=(k.x-p.x)*C+(k.y-p.y)*x;O<S?S=O:O>_&&(_=O)}w=0;for(let B of h){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(Se.less(k,S))w=w|1;else if(Se.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let I=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY;n/=2,n<=Se.eps&&(n=Se.eps),E-=n,y+=n,T.forEach((B,k)=>{B>=E&&B<=y&&a(k/(T.length-1))});let L=new ce(new he(0,E),new he(1,E)),F=new ce(new he(0,y),new he(1,y));for(let B=0;B<T.length-1;B++){let k=new he(B/(T.length-1),T[B]),O=k.y<E?1:k.y>y?2:3;for(let R=0;R<T.length;R++){let v=new he(R/(T.length-1),T[R]),j=v.y<E?1:v.y>y?2:3;O!==j&&(O===1?j===2?(o(new ce(k,v),L),o(new ce(k,v),F)):o(new ce(k,v),L):O===2?j===1?(o(new ce(k,v),L),o(new ce(k,v),F)):o(new ce(k,v),F):j===1?o(new ce(k,v),L):o(new ce(k,v),F))}}I!==0&&(l=l.clip(I)[1]),P!==1&&(l=l.clip((P-I)/(1-I))[0]);let V=l.bbox();if(Se.eq(V.minX,V.maxX)&&Se.eq(V.minY,V.maxY)){w=0;for(let B of l.controls){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(Se.less(k,S))w=w|1;else if(Se.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w===3){let B=new he((V.minX+V.maxX)/2,(V.minY+V.maxY)/2);c.getPercent(B)&&(ht[i++]=B.x,ht[i++]=B.y)}continue}if(P-I>.8){let[B,k]=l.clip(.5);s.push([B,c]),s.push([k,c])}else s.push([l,c])}for(let a=0;a<i;a++)ee[a]=ht[a];return{cnt:i}}var $3=class{constructor(e=Se.eps){this.eps=e}eq(e,t){return Math.abs(e-t)<=this.eps}setEps(e){this.eps=e}},Oh=new $3;function jw(e,t){if(e.bbox().extendOfSize(Se.eps).isSeparated(t.bbox()))return 0;let s=[[e,t]],r=(t.controls.length-1)*16,i=0;for(;s.length!==0;){if(i>r){let a=function(){for(let l=0;l<i;l+=2)for(let u=l+2;u<i;u+=2)if(!(Oh.eq(ht[l],ht[u])&&Oh.eq(ht[l+1],ht[u+1]))){c(ht[u],ht[u+1],o);break}function c(l,u,h){let p=!1;for(let d=0;d<h.length;d+=2)if(Oh.eq(l,h[d])&&Oh.eq(u,h[d+1])){p=!0;break}p||h.push(l,u)}},o=[ht[0],ht[1]];if(a(),o.length>=100&&(Oh.setEps(.001),o=[ht[0],ht[1]],a(),o.length>=100))throw new Error("clearSamePoint()");i=o.length,o.forEach((c,l)=>ht[l]=c)}let n=s.pop();if(n[0]instanceof Te){let a=function(F){x=Math.min(x,F),D=Math.max(D,F)},o=function(F,V){let B=oa(F,V);if(B===0)throw new Error("cnt === 0");for(let k=0;k<B;k+=2)a(ee[k])},[c,l]=n,u=l.controls;if(u.length===2){let F=D1(c,new ce(u[0],u[1]));for(let V=0;V<F;V++)ht[i++]=ee[V];continue}let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d,f,m,g,b;if(Math.abs(c.sweepAngle)>359){let F=c.rx;d=c.center.add1(F,0),f=c.center.add1(-F,0),h=-F,p=F,m=0,g=1,b=-c.center.y}else{d=c.start(),f=c.end(),m=f.y-d.y,g=d.x-f.x,b=-m*d.x-g*d.y;let F=Math.sqrt(1/(m**2+g**2));m*=F,g*=F,b*=F;let V=m*c.center.x+g*c.center.y+b;c.isCCW?(p=c.rx+V,h=0):(h=V-c.rx,p=0)}let E=u.map(F=>m*F.x+g*F.y+b),y=0;for(let F of E){if(Se.less(F,h))y=y|1;else if(Se.greater(F,p))y=y|2;else{y=3;break}if(y===3)break}if(y!==3)continue;let T=0,w=0,S=f.x-d.x,_=f.y-d.y,C=Math.sqrt(1/(S**2+_**2));if(S*=C,_*=C,Math.abs(c.sweepAngle)<=180)T=0,w=(f.x-d.x)*S+(f.y-d.y)*_;else throw new Error("not support");y=0;for(let F of u){let V=(F.x-d.x)*S+(F.y-d.y)*_;if(Se.less(V,T))y=y|1;else if(Se.greater(V,w))y=y|2;else{y=3;break}if(y===3)break}if(y!==3)continue;let x=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY;h-=Se.eps,p+=Se.eps,E.forEach((F,V)=>{F>=h&&F<=p&&a(V/(E.length-1))});let I=new ce(new he(0,h),new he(1,h)),P=new ce(new he(0,p),new he(1,p));for(let F=0;F<E.length-1;F++){let V=new he(F/(E.length-1),E[F]),B=V.y<h?1:V.y>p?2:3;for(let k=0;k<E.length;k++){let O=new he(k/(E.length-1),E[k]),R=O.y<h?1:O.y>p?2:3;B!==R&&(B===1?R===2?(o(new ce(V,O),I),o(new ce(V,O),P)):o(new ce(V,O),I):B===2?R===1?(o(new ce(V,O),I),o(new ce(V,O),P)):o(new ce(V,O),P):R===1?o(new ce(V,O),I):o(new ce(V,O),P))}}x!==0&&(l=l.clip(x)[1]),D!==1&&(l=l.clip((D-x)/(1-x))[0]);let L=l.bbox();if(Se.eq(L.minX,L.maxX)&&Se.eq(L.minY,L.maxY)){y=0;for(let F of l.controls){let V=(F.x-d.x)*S+(F.y-d.y)*_;if(Se.less(V,T))y=y|1;else if(Se.greater(V,w))y=y|2;else{y=3;break}if(y===3)break}y===3&&(ht[i++]=(L.minX+L.maxX)/2,ht[i++]=(L.minY+L.maxY)/2);continue}D-x>.8?l.clip(.5).forEach(F=>s.push([F,c])):s.push([l,c])}else{let[a,o]=n;s.push([Te.build3(o.center,o.startAngle,o.sweepAngle/2,o.rx,o.ry),a]),s.push([Te.build3(o.center,o.startAngle+o.sweepAngle/2,o.sweepAngle/2,o.rx,o.ry),a])}}for(let n=0;n<i;n++)ee[n]=ht[n];return i}var Q3=class{static getSweep(e){if(e.length>2){let t=0,s=e.length;for(let n=0;n<s-1;n++){let a=e[n],o=e[n+1];t+=(o.x+a.x)*(o.y-a.y)}let r=e[0],i=e[s-1];return t+=(r.x+i.x)*(r.y-i.y),t>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(e){return!!(e.primitives.length>0&&e.primitives[0].start().equals1(e.primitives[e.primitives.length-1].end()))}};function eL(e){let t=e.primitives,s=t[0],r=s instanceof Te?s.sweepAngle%360:null;if(t.length===1&&s instanceof Te&&(Se.eq(r,0)||Se.eq(Math.abs(r),360)))return!!s.isCCW;let i=new Array;return e.points(.1,n=>{i.push(n)}),Q3.getSweep(i)}var tL=class{static zoomCorner(e,t){let s=new Array,r=new Array,i=new Array;return this.getPanPrimitive(e,s,i,t),this.rearrange(s,i),this.processStart(s,i),this.getResult(s,i,r,t),r.length>0?Et.build2(r):null}static zoomPolygon(e,t){let s=new Array,r=new Array,i=new Array;return eL(e)&&(e=e.reverse().asClose()),this.getPanPrimitive(e,s,i,t),this.rearrange(s,i),this.processStart(s,i),this.getResult(s,i,r,t),r.length>0?Et.build2(r):null}static zoomLines(e,t){return this.zoomPolygon(Et.build2(e.primitives.concat(e.reverse().primitives)),t/2)}static getPanPrimitive(e,t,s,r){let i=e.primitives;for(let n of i){let a=this.panDistance(n,r);a!==void 0&&(t.push(a),s.push(n))}}static rearrange(e,t){let s=e.length,r=0;for(let a=0;a<s;a++){let o=t[a],c=e[a],l=a==s-1?e[0]:e[a+1];if(!(c instanceof Te&&l instanceof Te)&&!this.isCW(c.end(),l.start(),o.end())){if(cn(c,l)!=0){r=a==s-1?0:a+1;break}}else{r=a;break}}let i=this.start4Index(t,r),n=this.start4Index(e,r);t.length=0,e.length=0,i.forEach(a=>{t.push(a)}),n.forEach(a=>{e.push(a)})}static processStart(e,t){let s=e.length;if(s>2){let r=e[s-1],i=e[0],n=t[s-1];if(!(r instanceof Te&&i instanceof Te)&&!this.isCW(r.end(),i.start(),n.end())){let a=cn(r,i);for(let o=0;o<a;o+=2){let c=new he(ee[o],ee[o+1]);e[s-1]=this.generatePrimitive(r,r.start(),c),e[0]=this.generatePrimitive(i,c,i.end())}}}}static getResult(e,t,s,r){let i=e.length;for(let n=0;n<i;n++){let a=t[n],o=n===i-1?t[0]:t[n+1],c=n==i-1?0:n+1,l=c==i-1?t[0]:t[c+1],u=e[n],h=n==i-1?e[0]:e[n+1],p=c==i-1?e[0]:e[c+1];if(!(u instanceof Te&&h instanceof Te)&&!this.isCW(u.end(),h.start(),a.end())){let f=this.add(e,s,n,u,h,0);f=this.update(e,s,n,h,f);let m=this.generateArc(o,l,h,p,r);if(f=this.add(e,s,n,u,m,f),f=this.update(e,s,n,m,f),f>0)continue}s.push(u);let d=this.generateArc(a,o,u,h,r);d!==void 0&&s.push(d)}}static generateArc(e,t,s,r,i){if(i>0){let n=e.end(),a=t.start(),o=s.end(),c=r.start();if(o.distance2(c)>1e-8)if(n.equals(a)){let l=o.angleD(n),u=c.angleD(n);return Te.build2(n,l,u,i,i,0)}else{let l=o.angleD(n),u=c.angleD(n),h=o.angleD(a),p=c.angleD(a),d=Te.build2(n,l,u,i,i,0),f=Te.build2(a,h,p,i,i,0);return d.pointOn(d.endAngle()).equals1(c)?d:f.pointOn(f.endAngle()).equals1(c)?f:d}}}static updateNews(e,t,s,r){let i=e.length,n=t==i-1?0:t+1;e[n]=this.generatePrimitive(s,r,s.end())}static add(e,t,s,r,i,n){if(n>0)return n;if(r!=null&&i!=null){let a=cn(r,i);for(let o=0;o<a;o+=2){let c=new he(ee[o],ee[o+1]);t.push(this.generatePrimitive(r,r.start(),c)),this.updateNews(e,s,i,c);break}return a}else return 0}static update(e,t,s,r,i){if(i>0)return i;let n=t.length;if(n>0&&r!=null){let a=t[n-1],o=cn(a,r);for(let c=0;c<o;c+=2){let l=new he(ee[c],ee[c+1]);t[n-1]=this.generatePrimitive(a,a.start(),l),this.updateNews(e,s,r,l)}return o}else return 0}static generatePrimitive(e,t,s){if(e instanceof ce)return new ce(t,s);if(e instanceof Te){let r=e,i=t.angleD(r.center),n=s.angleD(r.center);return Te.build2(r.center,i,n,r.rx,r.ry,r.sweep())}else throw new Error("not supported operation")}static start4Index(e,t){let s=e.length,r=new Array;for(let i=t;i<s;i++)r.push(e[i]);for(let i=0;i<t;i++)r.push(e[i]);return r}static isCW(e,t,s){let r=new ce(s,e),i=new ce(s,t),n=r.end().x-r.start().x,a=r.end().y-r.start().y,o=i.end().x-i.start().x,c=i.end().y-i.start().y;return!(n*c-a*o>0)}static panDistance(e,t){if(e instanceof ce){if(e.isPoint())return;{let s=e.panDistance(t);return s.length()>1e-5?s:void 0}}else if(e instanceof Te){let s=e;if(s.sweepAngle>0){if(s.rx-t<=0||s.ry-t<=0)return}else if(s.sweepAngle<0&&(s.rx+t<=0||s.ry+t<=0))return;return s=s.panDistance(t),s.start().distance1(s.end())>1e-5||Se.eq(Math.abs(s.sweepAngle),360)?s:void 0}else throw new Error("not supported operation")}},tt=.001,Zr=tt**2;function Ze(e,t){return e.distance2(t)<Zr}function la(e,t){return Math.abs(e-t)<=1e-4}function sL(e,t){if(e instanceof ce)return new ce(e.start(),t);if(e instanceof Te){let s=t.angleD(e.center);return la(ct.regularD(e.startAngle),ct.regularD(s))?Te.build3(e.center,e.startAngle,0,e.rx,e.ry):Te.build2(e.center,e.startAngle,s,e.rx,e.ry,e.isCCW?1:0)}else{if(e instanceof We)return e.clip(e.getPercent(t,tt))[0];throw new Error("not supported operation")}}function Nn(e,t=ct.toRadians(e.startAngle)){return e.isCCW?t+=bm:t-=bm,new he(Math.cos(t),Math.sin(t))}function Jh(e,t=0){let s=e.controls;if(t===0){let r=s[0],i=s.slice(1).find(n=>!(n.x===r.x&&n.y===r.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return i.sub(r)}else if(t===1){let r=s[s.length-1],i=s.slice(0,-1).reverse().find(n=>!(n.x===r.x&&n.y===r.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return r.sub(i)}if(s.length===3){let[r,i,n]=s;return i.sub(r).mul(2*(1-t)).add(n.sub(i).mul(2*t)).normalize()}else{let[r,i,n,a]=s;return i.sub(r).mul(3*(1-t)**2).add(n.sub(i).mul(6*(1-t)*t)).add(a.sub(n).mul(3*t**2)).normalize()}}function eu(e,t,s){let r=e.slice(1).findIndex(n=>!(n.x===t.x&&n.y===t.y)),i=e[r+1];if(s&&(s.getPercent(i,tt)!==null||new ce(s.start(),s.end()).distance(i)<=tt)&&(i=e[r+2]),!i)throw Error("getSecondPoint(controls: readonly Vector2[])");return i}function et(e,t){if(e instanceof ce)return e.end().sub(e.start()).normalize();if(e instanceof Te)return(t?Nn(e,t.angle(e.center)):Nn(e)).normalize();if(e instanceof We)if(e.controls.length===2){let[s,r]=e.controls;if(Ze(s,r))throw Error("equalsPP(p0, p1)");return r.sub(s).normalize()}else return(t?Jh(e,e.getPercent(t,tt)):Jh(e)).normalize();else throw new Error("not support")}function rL(e,t,s){let r=[],i=t**2-4*e*s;if(i>=0){let n=-t/(2*e),a=Math.sqrt(i)/(2*e),o=n+a;if(r.push(o),i>0){let c=n-a;r.push(c)}}return r}function iL(e,t,s,r,i=0,n=1){let a=[],o=e*Math.pow(i,3)+t*Math.pow(i,2)+s*i+r,c=e*Math.pow(n,3)+t*Math.pow(n,2)+s*n+r,l,u;if(o*c<0)for(;Math.abs(i-n)>tt;)if(l=(i+n)/2,u=e*Math.pow(l,3)+t*Math.pow(l,2)+s*l+r,Math.abs(u)<tt){a.push(l);break}else o*u<0?n=l:c*u<0&&(i=l);else o*c===0&&(o===0&&a.push(i),c===0&&a.push(n));return a}function n1(e,t,s){if(e instanceof ce||t.distance2(s)<=Zr)return new ce(t,s);if(e instanceof Te)return Te.build2(e.center,t.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof We){let r=e.getPercent(t,tt),i=e.getPercent(s,tt);return e.clip(r)[1].clip((i-r)/(1-r))[0]}else throw new Error("not supported operation")}function P1(e){return Se.greater(e,0)&&Se.less(e,1)}function wm(e,t,s,r){let i=e[r]-2*t[r]+s[r],n=t[r]-e[r];if(i===0)return[];let a=-n/i,o=[];return P1(a)&&o.push(a),o}function Sm(e,t,s,r,i){let n,a,o=-e[i]+3*t[i]-3*s[i]+r[i],c=2*(e[i]-2*t[i]+s[i]),l=t[i]-e[i],u=c**2-4*o*l;if(Se.lesseq(u,0))n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;else{let p=Math.sqrt(u);n=(-c-p)/(2*o),a=(-c+p)/(2*o);let d=o*2;if(Se.lesseq(n,1)&&Se.greatereq(n,0)){let f=Number.NEGATIVE_INFINITY;for(;Se.neq(n,f);){f=n;let m=d*n+c;n=-(o*n**2+c*n+l-m*n)/m}}if(Se.lesseq(a,1)&&Se.greatereq(a,0)){let f=Number.NEGATIVE_INFINITY;for(;Se.neq(a,f);){f=a;let m=d*a+c;a=-(o*a**2+c*a+l-m*a)/m}}}let h=[];return P1(a)&&h.push(a),P1(n)&&h.push(n),h}function B2(e,t){if(e.controls.length===2){let[o,c]=e.controls;Ze(o,c)||t.push(new ce(o,c));return}let s,r;if(e.controls.length===3){let[o,c,l]=e.controls;s=wm(o,c,l,"x"),r=wm(o,c,l,"y")}else{let[o,c,l,u]=e.controls;s=Sm(o,c,l,u,"x"),r=Sm(o,c,l,u,"y")}s.sort((o,c)=>c-o),r.sort((o,c)=>c-o);let i=s.pop()||1,n=r.pop()||1,a=0;for(;i!==1||n!==1;)if(Se.eq(i,n))i=s.pop()||1,n=r.pop()||1;else if(i<n){let[o,c]=e.clip((i-a)/(1-a));a=i,t.push(o),e=c,i=s.pop()||1}else{let[o,c]=e.clip((n-a)/(1-a));a=n,t.push(o),e=c,n=r.pop()||1}t.push(e)}var nL=1e-5,sE=1,We=class ci extends nd{constructor(t){if(super(),this._startToEndL=null,t.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=t.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new ce(this.start(),this.end())),this._startToEndL}build1(t){let s=[];return iu(t,(r,i)=>(s.push(i),!0)),new ci(s)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(t,s){if(s.length<1)throw new Error("bezier must have at least 1 point");if(s.length===1)return s[0];{let r=new Array(s.length-1);for(let i=1;i<s.length;i++){let n=s[i-1],a=s[i],o=(a.x-n.x)*t,c=(a.y-n.y)*t;r[i-1]=n.add1(o,c)}return ci.pointOn(t,r)}}clip1(t,s,r,i){if(r.push(s[0]),i.push(s[s.length-1]),s.length<2)throw new Error("bezier clip must have at least 2 point");if(s.length===2){let n=s[0],a=s[1],o=(a.x-n.x)*t,c=(a.y-n.y)*t,l=n.add1(o,c);r.push(l),i.push(l)}else{let n=new Array(s.length-1);for(let a=1;a<s.length;a++){let o=s[a-1],c=s[a],l=(c.x-o.x)*t,u=(c.y-o.y)*t;n[a-1]=o.add1(l,u)}this.clip1(t,n,r,i)}}clip(t){let s=[],r=[];return this.clip1(t,this.controls,s,r),[new ci(s),new ci(r.reverse())]}greater(t,s,r){return t-s>r}less(t,s,r){return t-s<-r}eq(t,s,r){return Math.abs(t-s)<=r}eqPP(t,s,r){return!t||!s?!1:this.eq(t.x,s.x,r)&&this.eq(t.y,s.y,r)}isInRange(t,s=Se.eps){let r=this.controls.map(n=>n.y-t.y),i=0;for(let n of r){if(this.less(n,0,s))i=i|1;else if(this.greater(n,0,s))i=i|2;else{i=3;break}if(i===3)break}if(i!==3)return!1;i=0;for(let n of this.controls){let a=n.x-t.x;if(this.less(a,0,s))i=i|1;else if(this.greater(a,0,s))i=i|2;else{i=3;break}if(i===3)break}return i===3}getPercent(t,s=Se.eps){if(!this.isInRange(t,s))return null;let r=Number.POSITIVE_INFINITY,i=[[this,0,1]];for(;i.length!==0;){let n=function(g){u=Math.min(u,g),h=Math.max(h,g)},a=function(g,b){let E=oa(g,b);if(E===0)throw new Error("cnt === 0");for(let y=0;y<E;y+=2)n(ee[y])},[o,c,l]=i.pop();if(this.eqPP(o.start(),t,s))return c;if(this.eqPP(o.end(),t,s))return l;let u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,p=o.controls.map(g=>g.y-t.y);r=p.reduce((g,b)=>{let E=Math.abs(b);return E<g?E:g},r),r/=2,r<=s&&(r=s),p.forEach((g,b)=>{this.eq(g,0,s)&&n(b/(p.length-1))});let d=new ce(new he(0,-r),new he(1,-r)),f=new ce(new he(0,r),new he(1,r));for(let g=0;g<p.length-1;g++){let b=new he(g/(p.length-1),p[g]),E=this.less(b.y,0,s)?1:this.greater(b.y,0,s)?2:3;for(let y=0;y<p.length;y++){let T=new he(y/(p.length-1),p[y]),w=this.less(T.y,0,s)?1:this.greater(T.y,0,s)?2:3;E!==w&&(E===1?w===2?(a(new ce(b,T),d),a(new ce(b,T),f)):a(new ce(b,T),d):E===2?w===1?(a(new ce(b,T),d),a(new ce(b,T),f)):a(new ce(b,T),f):w===1?a(new ce(b,T),d):a(new ce(b,T),f))}}if(!isFinite(u)){if(Math.max(...p.map(g=>Math.abs(g)))<s*4)return(c+l)/2;continue}if(u!==0&&(o=o.clip(u)[1],c=(l-c)*u+c),h!==1){let g=(h-u)/(1-u);o=o.clip(g)[0],l=(l-c)*g+c}if(!o.isInRange(t,s))continue;let m=o.controls.reduce((g,b)=>g.ext2(b),new Ti).build1();if(this.eq(m.minX,m.maxX,s)&&this.eq(m.minY,m.maxY,s))return(c+l)/2;if(h-u>.8){let[g,b]=o.clip(.5);g.isInRange(t,s)?(i.push([g,c,(c+l)/2]),b.isInRange(t,s)&&i.push([b,(c+l)/2,l])):i.push([b,(c+l)/2,l])}else i.push([o,c,l])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new Ti().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new Ti().ext3(this.controls).build()),this._bbox_controls}multiply3(t){let s=new Array(this.controls.length);for(let r=0;r<this.controls.length;r++){let i=this.controls[r];s[r]=i.multiply3(t)}return new ci(s)}stroke(t,s,r,i=sE){let n=tL.zoomLines(Et.build4(this.points(i)),t);return r===0?n:n.reverse()}points(t){let s=[];return this.getBezierPoints(t,r=>s.push(r)),s}getBezierPoints(t,s){if(this.controls.length===2){s(this.start()),s(this.end());return}let r=[this];for(s(this.start());r.length!==0;){let n=r.pop(),a=new ce(n.start(),n.end());if(i(n.controls,a)<=t)s(n.end());else{let[o,c]=n.clip(.5);r.push(c,o)}}function i(n,a){let o=a.start(),c=a.end();o.equals1(c)&&(c=o.add1(1,0));let l=c.y-o.y,u=o.x-c.x,h=-l*o.x-u*o.y,p=Math.sqrt(1/(l**2+u**2));l*=p,u*=p,h*=p;let d=n.map(f=>Math.abs(l*f.x+u*f.y+h));return Math.max(...d)}}getBezierPoints3(t,s){if(this.controls.length===2){s(this.start()),s(this.end());return}let r=t*t,i=this.controls[0],n=.5;for(;n>nL&&!(i.distance2(ci.pointOn(n,this.controls))<=r);n*=.5);let a=Math.ceil(1/n);n=1/a,s(i);let o=0;for(let c=1;c<a;c++)o+=n,s(ci.pointOn(o,this.controls));s(this.end())}getPointsBySlope(t){if(this.controls.length===4)return this.getPointsBySlope4(t);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(t){let[s,r,i,n]=this.controls,a=-3*s.x+9*r.x-9*i.x+3*n.x,o=6*s.x-12*r.x+6*i.x,c=-3*s.x+3*r.x,l=[];if(Number.isFinite(t)){let u=-3*s.y+9*r.y-9*i.y+3*n.y,h=6*s.y-12*r.y+6*i.y,p=-3*s.y+3*r.y,d=u-a*t,f=h-o*t,m=p-c*t,g=-f/(2*d),b=Math.sqrt(f**2-4*d*m)/(2*d),E=g+b;E>=0&&E<=1&&l.push(ci.pointOn(E,this.controls));let y=g-b;y>=0&&y<=1&&l.push(ci.pointOn(y,this.controls))}else{let u=-o/(2*a),h=Math.sqrt(o**2-4*a*c)/(2*a),p=u+h;p>=0&&p<=1&&l.push(ci.pointOn(p,this.controls));let d=u-h;d>=0&&d<=1&&l.push(ci.pointOn(d,this.controls))}return l}buildConverxHull(t=Se.eps){let s=[...this.controls],r=[],i=s[0],n=1;do{let a=s[n%s.length];this.eqPP(i,a,t)||r.push(new ce(i,a)),i=a,n++}while(i!==s[0]);if(r.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return Et.build7(r).asClose()}getExtremePoints(t){if(!t)return a(this.controls);let s=t.start(),r=t.end(),i=r.x-s.x,n=r.y-s.y;if(Math.abs(i)<=Se.eps||Math.abs(n)<=Se.eps)return a(this.controls);{let o=n/i;if(this.controls.length===3){s.equals1(r)&&(r=s.add1(1,0));let c=r.y-s.y,l=s.x-r.x,u=-c*s.x-l*s.y,h=Math.sqrt(1/(c**2+l**2));c*=h,l*=h,u*=h;let p=this.controls.map(m=>c*m.x+l*m.y+u),d=p[0]-2*p[1]+p[2],f=p[1]-p[0]-o/2;if(d!==0){let m=-f/d;if(Se.greater(m,0)&&Se.less(m,1))return[ci.pointOn(m,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(o)}return[];function a(o){let c,l;if(o.length===3){let[d,f,m]=o;c=wm(d,f,m,"x"),l=wm(d,f,m,"y")}else if(o.length===4){let[d,f,m,g]=o;c=Sm(d,f,m,g,"x"),l=Sm(d,f,m,g,"y")}c.sort((d,f)=>f-d),l.sort((d,f)=>f-d);let u=c.pop()||1,h=l.pop()||1,p=[];for(;u!==1||h!==1;)Se.eq(u,h)?(u=c.pop()||1,h=l.pop()||1):u<h?(p.push(ci.pointOn(u,o)),u=c.pop()||1):(p.push(ci.pointOn(h,o)),h=l.pop()||1);return p}}getToLineMaxDis2(t){let s=this.getExtremePoints(t),r=t.distance2(this.start()),i=t.distance2(this.end()),n=Math.max(r,i);return s.forEach(o=>a(t.distance2(o))),n;function a(o){n=Math.max(n,o)}}getToLineMinAndMaxDis_Controls(t){let s=t.start(),r=t.end();t.start().equals1(t.end())&&(r=s.add1(1,0));let i=r.y-s.y,n=s.x-r.x,a=-i*s.x-n*s.y,o=Math.sqrt(1/(i**2+n**2));i*=o,n*=o,a*=o;let c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return this.controls.forEach(u=>{let h=i*u.x+n*u.y+a;h<c&&(c=h),h>l&&(l=h)}),{minDis:c,maxDis:l}}getPercentInLine(t){let s=[],r=[],i=this.controls,n=t.start(),a=t.end(),o=a.y-n.y,c=n.x-a.x,l=-o*n.x-c*n.y,u=Math.sqrt(1/(o**2+c**2));if(o*=u,c*=u,l*=u,o**2+c**2<=0)return s;if(i.length===3){let[h,p,d]=i,f=o*(h.x-2*p.x+d.x)+c*(h.y-2*p.y+d.y),m=2*(o*(p.x-h.x)+c*(p.y-h.y)),g=o*h.x+c*h.y+l;r=rL(f,m,g)}else if(i.length===4){let[h,p,d,f]=i,m=f.sub(d.mul(3)).add(p.mul(3)).sub(h),g=h.sub(p.mul(2)).add(d).mul(3),b=p.sub(h).mul(3),E=h,y=o*m.x+c*m.y,T=o*g.x+c*g.y,w=o*b.x+c*b.y,S=o*E.x+c*E.y+l,_=Math.sqrt(1/(y**2+T**2));y*=_,T*=_,w*=_,S*=_,r=iL(y,T,w,S)}else throw Error("not support getBeizerPointInLine");return r.forEach(h=>{h>=0&&h<=1&&s.push(h)}),s}reverse(){return new ci(this.controls.slice().reverse())}},ia,k2=(ia=class{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=he.ORIGIN,this.textOffsetCache[1]=new he(0,-.5),this.textOffsetCache[2]=new he(0,-1),this.textOffsetCache[3]=new he(-.5,0),this.textOffsetCache[4]=new he(-.5,-.5),this.textOffsetCache[5]=new he(-.5,-1),this.textOffsetCache[6]=new he(-1,0),this.textOffsetCache[7]=new he(-1,-.5),this.textOffsetCache[8]=new he(-1,-1)}static getCache(){return ia.instance==null&&(ia.instance=new ia),ia.instance}},ia.instance=null,ia),ce=class wc extends nd{constructor(t,s){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=t,this._end=s}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(t){if(Se.eq(this.distance(t),0)){let s=new wc(this._start,t);return s._a=this._a,s._b=this._b,s._c=this._c,s}return new wc(this._start,t)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new We([this._start,this._end])}_hashCode(){let t=31,s=1;return s=t*s+this._start.hashCode(),s=t*s+this._end.hashCode(),s}start(){return this._start}end(){return this._end}center(){let t=this.start(),s=this.end();return t.add(s).mul(.5)}panDistance(t){let s=this._end.x-this._start.x,r=this._end.y-this._start.y,i=this.length();s=s*t/i,r=-r*t/i;let n=new he(this._start.x+r,this._start.y+s),a=new he(this._end.x+r,this._end.y+s);return new wc(n,a)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let t=k2.getCache().boxCache;t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.__bbox=new Jr(t[0],t[1],t[2],t[3])}return this.__bbox}multiply3(t){return new wc(this._start.multiply3(t),this._end.multiply3(t))}hashCode(){return this.hashed}equals(t){let s=t;return this.hashed===s.hashed&&this._start.equals(s._start)&&this._end.equals(s._end)}equals1(t){let s=t;return this.hashed===s.hashed&&this._start.equals1(s._start)&&this._end.equals1(s._end)}equals2(t){let s=[this.start(),this.end()],r=[t.start(),t.end()];return In(s,r)||In(s,r.reverse())}stroke(t,s,r){let i,n,a;this._end.x<this._start.x?(n=this._start.x-this._end.x,a=this._start.y-this._end.y,i=this._end):(n=this._end.x-this._start.x,a=this._end.y-this._start.y,i=this._start);let o=Math.sqrt(n*n+a*a),c=t/2,l,u,h;s===2?(u=-c,h=o+c):(u=0,h=o),s===0||s===2?r===0?l=Et.build5([u,-c,u,c,h,c,h,-c]):l=Et.build5([u,c,u,-c,h,-c,h,c]):r===0?l=Et.build2([Te.build3(new he(u,0),-90,-180,c,c),Te.build3(new he(h,0),90,-180,c,c)]):l=Et.build2([Te.build3(new he(u,0),90,180,c,c),Te.build3(new he(h,0),-90,180,c,c)]);let p=Math.atan2(a,n),d=Yt.rotate(p).translate1(i);return l.asClose().multiply3(d)}points(t){return[this._start,this._end]}mirrorY(t){return new wc(this.start().mirrorY(t),this.end().mirrorY(t))}reverse(){return new wc(this._end,this._start)}inArea(t,s,r){let i=t.x,n=t.y,a=this._start,o=this._end,c=r==1,l=i-a.x,u=n-a.y,h=i-o.x,p=n-o.y,d=o.x-a.x,f=o.y-a.y,m=new he(-f,d).normalize(),g=d+m.x*s/2,b=f+m.y*s/2,E=g*g+b*b,y=l*l+u*u,T=h*h+p*p,w=Math.abs(l*f-u*d)/2,S=Math.sqrt(d*d+f*f)*s/4;if(w<=S&&y<=E&&T<=E){if(c)return!0;{let _=new he(i,n).sub(o).normalize(),C=new he(i,n).sub(a).normalize(),x=new he(m.x,m.y).cross(_),D=new he(m.x,m.y).cross(C);return x>=0&&D<=0}}else if(c){let _=s/2;return y<=_*_?!0:T<=_*_}else return!1}isParallel(t,s=!1){let r=Se.eq(Math.abs(this.direct.cross(t.direct)),0),i=!s||Se.greatereq(this.direct.dot(t.direct),0);return r&&i}distance2(t){return(this.a*t.x+this.b*t.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(t){let{x:s,y:r}=t,{x:i,y:n}=this.start(),{x:a,y:o}=this.end();return((s-i)*(o-n)-(r-n)*(a-i))**2/((o-n)**2+(a-i)**2)}distance(t){return Math.abs(this.a*t.x+this.b*t.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function aL(e,t=.05){if(e.length<3)return e.slice();let s=e.slice(0,1),r=(n,a,o)=>F3(n.x,n.y,a.x,a.y,o.x,o.y);for(;;){s=e.slice(0,1);for(let n=1;n<e.length-1;n+=2)r(e[n],e[n-1],e[n+1])>t&&s.push(e[n]),s.push(e[n+1]);if(s.at(-1).equals1(e.at(-1))||s.push(e.at(-1)),e.length==s.length)break;e=s}let i=e[e.length-1];return s.push(i),s}var oL=g3(y3());var cL=class{constructor(){this.fac=new Ti,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(e){for(this.fac.clear(),this.length=e.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=e[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},lL=new cL,Et=class zs{constructor(t,s){this.__bbox=null,this.primitives=t,this.__bbox=s}static calcBBox(t){return lL.calcBBox(t)}static build1(t){let s=[],r=null;return ym(t,(i,n)=>{let a=n.start();return r!==null&&!a.equals(r)&&s.push(new ce(r,a)),s.push(n),r=n.end(),!0}),s.length===0&&r!=null&&s.push(new ce(r,r)),new zs(s)}static build2(t){return zs.build1(A1(t))}static build3(t){let s=[],r=null;return ym(t,(i,n)=>(r!==null&&s.push(new ce(r,n)),r=n,!0)),new zs(s)}static build4(t){return this.build3(A1(t))}static build5(t){let s=[];for(let r=0;r<t.length;r+=2)s.push(new he(t[r],t[r+1]));return this.build4(s)}static build6(t){return zs.build4([t.LL(),t.LR(),t.UR(),t.UL(),t.LL()])}static build7(t){return new zs(t)}static build8(t){let s=new he(t[0],t[1]),r,i=[],n,a=(o,c)=>o.length==c&&o.every(l=>typeof l=="number");for(let o=2;o<t.length;)switch(typeof t[o]=="string"?n=t[o]:o-=1,n){case"ARC":{let c=t.slice(o+1,o+4);if(!a(c,3))throw new Error("invalid rawData");let l=c[0];r=new he(c[1],c[2]),i.push(Te.build5(s,r,l)),s=r,o+=4;break}case"L":{let c=t.slice(o+1,o+3);if(!a(c,2))throw new Error("invalid rawData");r=new he(c[0],c[1]),i.push(new ce(s,r)),s=r,o+=3;break}case"C":{let c=t.slice(o+1,o+7);if(!a(c,7))throw new Error("invalid rawData");let l=new he(c[0],c[1]),u=new he(c[2],c[3]);r=new he(c[4],c[5]),i.push(new We([s,l,u,r])),s=r,o+=7;break}default:throw new Error("invalid rawData")}return zs.build2(i)}static buildBBox(t,s=0){return s===1?zs.build5([t.minX,t.minY,t.maxX,t.minY,t.maxX,t.maxY,t.minX,t.maxY,t.minX,t.minY]):zs.build5([t.minX,t.minY,t.minX,t.maxY,t.maxX,t.maxY,t.maxX,t.minY,t.minX,t.minY])}static triangulate(t,s,r=1){if(t.length===1){let c=new Array;t[0].asClose().points2(r,p=>c.push(p));let l,u=c[0],h=[];for(let p=0;p<c.length-2;p+=2){let d=c[p+1],f=c[p+2],m=d.sub(u).normalize().cross(f.sub(u).normalize());if(Se.neq(m,0)){if(l===!0){if(m<0){h.length=0;break}}else if(l===!1){if(m>0){h.length=0;break}}else l=m>0;h.push(u),h.push(d),h.push(f)}c.push(u),u=f}if(h.length!==0){for(let p=0;p<h.length;p+=3)s(h[p],h[p+1],h[p+2]);return}}let i=[],n=[];t.forEach(c=>{i.length!==0&&n.push(i.length/2),c.asClose().points2(r,l=>i.push(l.x,l.y))});let a=oL.default(i,n),o=[];for(let c=1;c<i.length;c+=2)o.push(new he(i[c-1],i[c]));for(let c=0;c<a.length;c+=3)s(o[a[c]],o[a[c+1]],o[a[c+2]])}lines(t,s){let r=new Array;this.points(t,n=>r.push(n));let i=r[0];for(let n=1;n<r.length;n++){let a=r[n];s(i),s(a),i=a}}triangles(t,s){zs.triangulate([this],(...r)=>{r.forEach(i=>s(i))},t)}mirror(){let t=[];return this.primitives.forEach(s=>{if(s instanceof ce)s=new ce(s.start().mirror(),s.end().mirror());else if(s instanceof Te)s=s.mirror();else if(s instanceof We){let r=s.controls.map(i=>i.mirror());s=new We(r)}else throw new Error("bug");t.push(s)}),new zs(t,this.__bbox)}getPoints(t){let s=[];for(let r of this.primitives)for(let i of r.points(t))s.push(i);return s}round(t=4){let s=this.primitives.slice();for(let r=0;r<s.length;r++){let i=s[r];if(i instanceof ce){let n=i.start().round(t),a=i.end().round(t);s[r]=new ce(n,a)}else if(i instanceof We){let n=i.controls.map(a=>a.round(t));s[r]=new We(n)}else if(i instanceof Te){let n=i.start().round(t),a=i.end().round(t),o=i.sweepAngle;s[r]=Te.build5(n,a,o)}}return new zs(s,this.__bbox)}simplify(t=.05){let s=[],r=!1,i=[],n=this.closed();if(this.primitives.length<=1)return zs.build2(this.primitives);let a=()=>{if(i.length>2){let c=aL(i,t);for(let l=1;l<c.length;l++)s.push(new ce(c[l-1],c[l]))}else s.push(new ce(i[0],i[1]));i.length=0,r=!1};for(let c=0;c<this.primitives.length;c++){let l=this.primitives[c];l instanceof ce?(r?i.push(l.end()):(i.length=0,i.push(l.start(),l.end()),r=!0),c===this.primitives.length-1&&a()):(r&&a(),s.push(l))}let o=new zs(s,this.__bbox);return n&&!o.closed()&&(o=o.asClose()),o}hasBackLine(){let{primitives:t}=this,s;for(let r=0;r<t.length;r++){let i=t[r];if(i instanceof ce){if(i.end().equals1(i.start()))continue;if(s&&(i.end().equals1(s.start())||U3(i.end(),s.start(),s.end())))return!0;s=i}else s=null}return!1}area(t=.1){let s=0,r=this.end();return this.primitives.forEach(i=>{let n=i.start(),a=i.end();if(s+=(n.x+r.x)*(n.y-r.y),i instanceof ce)s+=(a.x+n.x)*(a.y-n.y);else if(i instanceof Te)s+=(a.x+n.x)*(a.y-n.y),s+=Math.PI*i.rx2*i.sweepAngle/180-he.normal(i.center,i.start(),i.end());else if(i instanceof We){let o=n;i.points(t).forEach(c=>{s+=(c.x+o.x)*(c.y-o.y),o=c}),s+=(a.x+o.x)*(a.y-o.y)}r=a}),s/2}closed(t){return this.primitives.length===0?!1:this.start().equals(this.end(),t)}asClose(){let t=this.primitives[0],s=this.primitives[this.primitives.length-1],r=t.start(),i=s.end();if(r.equals(i))return this;{let n=new Array;return Kr.addAll(n,this.primitives),n.push(new ce(i,r)),zs.build2(n)}}closeEndpoint(){let t=this.primitives[0],s=this.primitives[this.primitives.length-1],r=t.start(),i=s.end();if(r.equals1(i))return this;{let n=new Array;return Kr.addAll(n,this.primitives),n.push(new ce(i,r)),new zs(n)}}reverse(){let t=new Array(this.primitives.length);for(let s=0,r=this.primitives.length-1;r>=0;s++,r--){let i=this.primitives[r];if(i instanceof ce)i=new ce(i.end(),i.start());else if(i instanceof Te)i=i.exchangeSweep();else if(i instanceof We)i=new We(i.controls.slice().reverse());else throw new Error("bug");t[s]=i}return new zs(t,this.__bbox)}reverse1(){let t=new Array(this.primitives.length);for(let s=0,r=this.primitives.length-1;r>=0;s++,r--){let i=this.primitives[r];if(i instanceof ce)i=new ce(i.end(),i.start());else if(i instanceof Te)i=i.exchangeSweep1();else if(i instanceof We)i=new We(i.controls.slice().reverse());else throw new Error("bug");t[s]=i}return new zs(t,this.__bbox)}mirrorY(t){let s=[];return this.primitives.forEach(r=>{if(r instanceof ce)r=r.mirrorY(t);else if(r instanceof Te)r=r.mirrorY(t);else if(r instanceof We){let i=r.controls.map(n=>n.mirrorY(t));r=new We(i)}else throw new Error("bug");s.push(r)}),new zs(s,this.__bbox)}points(t,s){if(this.primitives.length!==0){for(let r=0;r<this.primitives.length-1;r++){let i=this.primitives[r].points(t);i.pop(),i.forEach(n=>s(n))}this.primitives[this.primitives.length-1].points(t).forEach(r=>s(r))}}points1(t,s){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let n=this.primitives[i],a=n instanceof Te?n.points1(t):n.points(t);a.pop(),a.forEach(o=>s(o))}let r=this.primitives[this.primitives.length-1];(r instanceof Te?r.points1(t):r.points(t)).forEach(i=>s(i))}points2(t,s){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let n=this.primitives[i],a=n instanceof Te?n.points2():n.points(t);a.pop(),a.forEach(o=>s(o))}let r=this.primitives[this.primitives.length-1];(r instanceof Te?r.points2():r.points(t)).forEach(i=>s(i))}multiply3(t){let s=new Array(this.primitives.length);for(let r=0;r<this.primitives.length;r++)s[r]=this.primitives[r].multiply3(t);return zs.build7(s)}bbox(){return this.__bbox==null&&(this.__bbox=zs.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(t){if(this.primitives.length<=1&&!(this.primitives[0]instanceof Te))return!1;{let s=this.primitives[0],r=this.primitives[this.primitives.length-1];return s.start().equals(r.end(),t)}}isEqual(t){if(t instanceof zs&&t.primitives.length==this.primitives.length){let s=t.primitives.length;for(let r=0;r<s;r++){let i=t.primitives[r],n=this.primitives[r];if(JSON.stringify(i)!=JSON.stringify(n))return!1}return!0}return!1}equals(t){if(!t)return!1;let s=this.primitives,r=t.primitives;if(s.length!=r.length)return!1;if(t.isClose()){let i=0;for(;i<s.length;){let n=s.slice(i).concat(s.slice(0,i));if(In(n,r)||In(n.reverse(),r))return!0;i++}return!1}else return In(this.primitives,t.primitives)}clone(){return zs.build2(this.primitives)}putItem(t,s){if(!t)return!1;if(t instanceof zs)return this.mergePolyline(t,s);let r=this.start();if(!r){this.primitives.push(t),this.__bbox=t.bbox();return}let i=this.end();if(r.equals(i,s))return!1;let n=t.start(),a=t.end(),o=!1,c=!1;if(r.equals(n,s))o=!0,c=!1;else if(r.equals(a,s))o=!1,c=!1;else if(i.equals(n,s))o=!1,c=!0;else if(i.equals(a,s))o=!0,c=!0;else return!1;return c?this.primitives.push(o?t.reverse():t):this.primitives.unshift(o?t.reverse():t),this.__bbox=Jr.extend2(this.__bbox,t.bbox()),!0}mergePolyline(t,s,r=0){if(!t)return!1;let i=this.start();if(!i){this.primitives.push(...t.primitives),this.__bbox=t.bbox();return}let n=this.end();if(i.equals(n,s))return!1;let a=t.start(),o=t.end(),c=!1,l=!1;if(i.equals(a,s))c=!0,l=!1;else if(i.equals(o,s))c=!1,l=!1;else if(n.equals(a,s))c=!1,l=!0;else if(n.equals(o,s))c=!0,l=!0;else return!1;let u=c?t.reverse():t;return l?this.primitives.push(...u.primitives):this.primitives.unshift(...u.primitives),this.__bbox=Jr.extend2(this.__bbox,t.bbox()),!0}deDuplicationPoint(t){let s=this.primitives[this.primitives.length-1].start(),r=this.primitives[this.primitives.length-1].end(),i=t.primitives[0].start(),n=t.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof ce&&t.primitives[0]instanceof ce&&q3([s,r],[i,n])){this.primitives.pop(),t.primitives.shift();let a=[];a.push(new ce(s,n)),this.primitives.push(...a)}}getMaxBBoxHeightByVec(t){let s=t.normalize(),r=-1/0,i=1/0;if(this.primitives.forEach(a=>{let o=a.start().dot(s),c=a.end().dot(s);if(n(o),n(c),a instanceof Te){let l=t.angleD(he.ORIGIN);if(a.angleIsInArc(l)){let u=a.pointOn(l).dot(s);n(u)}if(a.angleIsInArc(l+180)){let u=a.pointOn(l-180).dot(s);n(u)}}}),r-i<=0)throw new Error("getMaxBBoxHeightByVec");return r-i;function n(a){a>r&&(r=a),a<i&&(i=a)}}getWindingNum(t){let s=this.end(),r=0,{x:i,y:n}=t;for(let o of this.primitives){if(s.y>n?o.bbox().minY>n:o.bbox().maxY<=n){s=o.end();continue}if(o instanceof Te&&(o.isCCW?Math.floor(o.startAngle/90)+1!==Math.ceil(o.endAngle()/90):Math.ceil(o.startAngle/90)-1!==Math.floor(o.endAngle()/90))){let c=o.startAngle,l=o.endAngle();if(o.sweepAngle>0){let u=90;for(;u<=l;)u>c&&(a(Te.build3(o.center,c,u-c,o.rx,o.ry)),c=u),u+=90;c<l&&a(Te.build3(o.center,c,l-c,o.rx,o.ry))}else{let u=270;for(;u>=l;)u<c&&(a(Te.build3(o.center,c,u-c,o.rx,o.ry)),c=u),u-=90;c>l&&a(Te.build3(o.center,c,l-c,o.rx,o.ry))}}else if(o instanceof We){let c=[];B2(o,c),c.forEach(l=>a(l))}else a(o)}return r;function a(o){let c=o.start(),l=o.end();if(s.y>n!=c.y>n&&(s.x>i?c.x>i?r+=c.y>s.y?1:-1:s.y>c.y?(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)<0&&r--:(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)>0&&r++:c.x>i&&(s.y>c.y?(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)<0&&r--:(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)>0&&r++)),c.y>n!=l.y>n){if(c.x>i)if(l.x>i)r+=l.y>c.y?1:-1;else if(o instanceof ce)c.y>l.y?(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)<0&&r--:(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)>0&&r++;else if(o instanceof Te){let{center:u,isCCW:h,rx2:p}=o,d=(u.x-i)**2+(u.y-n)**2;c.y>l.y?(h?d>p:d<p)&&r--:(h?d<p:d>p)&&r++}else if(o instanceof We){if(Rw(o,n)===0)throw new Error("no inters");ee[0]>i&&(r+=l.y>c.y?1:-1)}else throw new Error("not support!");else if(l.x>i)if(o instanceof ce)c.y>l.y?(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)<0&&r--:(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)>0&&r++;else if(o instanceof Te){let{center:u,isCCW:h,rx2:p}=o,d=(u.x-i)**2+(u.y-n)**2;c.y>l.y?(h?d>p:d<p)&&r--:(h?d<p:d>p)&&r++}else if(o instanceof We){if(Rw(o,n)===0)throw new Error("no inters");ee[0]>i&&(r+=l.y>c.y?1:-1)}else throw new Error("not support!")}s=l}}},Yf=Math.PI*2;var HG=Math.PI/2,GG=Math.sin(Math.PI/180);var uL=4,Te=class ls extends nd{constructor(t,s,r,i,n){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=t,this.ry=s,this.center=r,this.startAngle=i,this.sweepAngle=n,this._start=he.ORIGIN,this._end=he.ORIGIN,this._start=this.pointOn(i),this._end=this.pointOn(i+n)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let t=31,s=1;return s=t*s+new he(this.rx,this.rx).hashCode(),s=t*s+this.center.hashCode(),s=t*s+new he(this.startAngle,this.sweepAngle).hashCode(),s}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(t,s,r,i){let n=s>=0?-.01:.01,a=t+s;for(;(s>=0&&a>t||s<0&&a<t)&&r.distance2(i)<2e-4;)n*=2,a+=n,i=this.pointOn(a);return i}static build1(t,s,r,i,n,a){Ps.positive(r),Ps.positive(i);let o=t.equals(s);if(o)return new ls(r,i,t,0,n?360:0);{let c=t.x,l=-t.y,u=s.x,h=-s.y,p=a===0,d=(c-u)/2,f=(l-h)/2,m=Math.cos(0),g=Math.sin(0),b=m*d+g*f,E=-g*d+m*f;r=Math.abs(r),i=Math.abs(i);let y=r*r,T=i*i,w=b*b,S=E*E,_=n===p?-1:1,C=(y*T-y*S-T*w)/(y*S+T*w);C=C<0?0:C;let x=_*Math.sqrt(C),D=x*(r*E/i),I=x*-(i*b/r),P=(c+u)/2,L=(l+h)/2,F=P+(m*D-g*I),V=L+(g*D+m*I),B=(b-D)/r,k=(E-I)/i,O=(-b-D)/r,R=(-E-I)/i,v,j;j=Math.sqrt(B*B+k*k),v=B,_=k<0?-1:1;let M=ct.toDegrees(_*Math.acos(v/j));j=Math.sqrt((B*B+k*k)*(O*O+R*R)),v=B*O+k*R,_=B*R-k*O<0?-1:1;let H=v/j,q;H<-1?q=Math.acos(-1):H>1?q=Math.acos(1):q=Math.acos(H);let Q=ct.toDegrees(_*q);!p&&Q>0?Q-=360:p&&Q<0&&(Q+=360),Ps.normal(M),Ps.normal(Q);let oe=d*d/y+f*f/T,me=t.distance1(s)/2;r<me&&i<me&&(r*=Math.sqrt(oe),i*=Math.sqrt(oe));let Ee=o?0:ct.regularD(-M),Pe=o?n?360:0:-Q;return new ls(r,i,new he(F,-V),Ee,Pe)}}static build2(t,s,r,i,n,a){Ps.positive(i),Ps.positive(n),Ps.normal(s),Ps.normal(r);let o;return s===r?(s=ct.regularD(s),r=ct.regularD(r),o=0):(s=ct.regularD(s),r=ct.regularD(r),a===1?r<=s&&(r+=360):r>=s&&(s+=360),o=r-s),new ls(i,n,t,ct.regularD(s),o)}static build3(t,s,r,i,n){return Ps.positive(i),Ps.positive(n),Ps.normal(r),new ls(i,n,t,ct.regularD(s),r)}static build4(t,s,r,i,n,a){let o=t.angleD(r),c=s.angleD(r);return ls.build2(r,o,c,i,n,a)}static build5(t,s,r){r=ct.toRadians(r);let i=s.sub(t),n=new he(-i.y,i.x).normalize(),a=Math.abs(r)/2,o;if(a!=0)o=i.length()/2/Math.sin(a);else throw new Error("Can't represent circle!!!");let c=n.rotate(he.ORIGIN,a),l,u;r>0?(l=1,u=s.add(c.scale(o))):(l=0,u=t.sub(c.scale(o)));let h=ct.toDegrees(t.angle(u)),p=ct.toDegrees(s.angle(u));return ls.build2(u,h,p,o,o,l)}static buildCircle(t,s,r=0){return ls.build2(t,0,360,s,s,r)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(t){t=ct.regularD(t);let s=this.rx,r=this.ry;if(t===0)return this.center.add1(s,0);if(t===90)return this.center.add1(0,r);if(t===180)return this.center.add1(-s,0);if(t===270)return this.center.add1(0,-r);{let i=this.rx2,n=this.ry2,a=Math.tan(ct.toRadians(t)),o=a*a,c=Math.sqrt(i*n/(i+n/o)),l=Math.sqrt(i*n/(n+i*o));return t>90&&t<270&&(l=-l),t>180&&t<360&&(c=-c),isNaN(l)&&(l=0),isNaN(c)&&(c=0),this.center.add1(l,c)}}exchangeSweep(){return ls.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return ls.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return ls.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(t){let s=this.start(),r=this.end();return s.equals(r)?ls.build3(this.center.mirrorY(),0,360,this.rx,this.ry):ls.build1(s.mirrorY(t),r.mirrorY(t),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(t=he.ORIGIN){let s=this.start(),r=this.end();return s.equals(r)?ls.build3(this.center.mirror(t),0,360,this.rx,this.ry):ls.build1(s.mirror(t),r.mirror(t),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let t=C1.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-t}multiply3(t){let s;t.isMirrored()?s=-this.sweepAngle:s=this.sweepAngle;let r;return t.equals(Yt.ROT_90)?r=ct.regularD(this.startAngle+90):t.equals(Yt.ROT_N90)?r=ct.regularD(this.startAngle-90):r=ct.transformD(this.startAngle,t),ls.build3(this.center.multiply3(t),r,s,t.iScale*this.rx,t.iScale*this.ry)}angleIsInArc(t){return t=ct.regularD(t),this.sweepAngle>0?(t<this.startAngle&&(t+=360),this.endAngle()>t):(t>this.startAngle&&(t-=360),this.endAngle()<t)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let t=this.start(),s=this.end(),r=ct.toRadians(this.sweepAngle)/2,i=4/3*(1-Math.cos(r))/Math.sin(r)*this.rx;return new We([t,t.add(new he(i,0).multiply3(Yt.rotateD(this.startAngle+90))),s.add(new he(i,0).multiply3(Yt.rotateD(this.endAngle()-90))),s])}toBezier2(){let t=[];r(this,90);let s=[];return t.forEach(i=>s.push(i.toBezier())),s;function r(i,n){if(Math.abs(i.sweepAngle)>n){let a=i.sweepAngle/2;r(ls.build3(i.center,i.startAngle,a,i.rx,i.ry),n),r(ls.build3(i.center,i.startAngle+a,a,i.rx,i.ry),n)}else t.push(i)}}buildBBox(){let t=k2.getCache().boxCache,s=this.startAngle+this.sweepAngle;if(t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let r=0;for(;r<s;){if(r>this.startAngle){let i=this.pointOn(r);t[0]=Math.min(t[0],i.x),t[1]=Math.max(t[1],i.x),t[2]=Math.min(t[2],i.y),t[3]=Math.max(t[3],i.y)}r+=90}}else if(this.sweepAngle<0){let r=360;for(;r>s;){if(r<this.startAngle){let i=this.pointOn(r);t[0]=Math.min(t[0],i.x),t[1]=Math.max(t[1],i.x),t[2]=Math.min(t[2],i.y),t[3]=Math.max(t[3],i.y)}r-=90}}return new Jr(t[0],t[1],t[2],t[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return Ql.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(t,s,r){let i=t/2,n=this.rx+i,a=this.ry+i,o=this.rx-i,c=this.ry-i,l=new Yt;o<0&&(o=-o,l=l.multiply3(Yt.MIRROR_Y)),c<0&&(c=-c,l=l.multiply3(Yt.MIRROR_X)),o===0&&(o=.001),c===0&&(c=.001),l=l.setOrigin1(this.center);let u,h;switch(r===this.sweep()?(u=ls.build3(this.center,this.startAngle,this.sweepAngle,n,a),h=ls.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,o,c)):(u=ls.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,n,a),h=ls.build3(this.center,this.startAngle,this.sweepAngle,o,c)),h=h.multiply3(l),s){case 1:{let p=r===1?180:-180,d=r===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),f=r===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),m=u.pointOn(u.endAngle()).angleD(d),g=h.pointOn(h.endAngle()).angleD(f);return Et.build2([u,ls.build3(d,m,p,i,i),h,ls.build3(f,g,p,i,i)])}default:return Et.build2([u,h])}}points2(){let t=Math.ceil(Math.abs(this.sweepAngle)/uL),s=this.sweepAngle/t,r=[this._start];for(let i=1;i<t;i++)r.push(this.pointOn(this.startAngle+s*i));return r.push(this._end),r}points1(t){let s=Math.max(this.rx,this.ry);if(s<=t)return[this.start(),this.svgEnd];let r=(s-t)/s,i=Math.ceil(Math.abs(this.sweepAngle/ct.toDegrees(Math.acos(r))/2)),n=new Array(i+1),a=this.sweepAngle/i,o=this.startAngle;for(let c=0;c<=i;c++,o+=a)n[c]=this.pointOn(o);return n}points(t){let s=Math.max(this.rx,this.ry);if(t=Math.abs(t),s<=t)return[this.start(),this.svgEnd];t=Math.max(t,s*1e-5),t=Math.min(t,s*(1-Math.SQRT1_2));let r=(s-t)/s,i=Math.ceil(Math.abs(this.sweepAngle/ct.toDegrees(Math.acos(r))/2));i=Math.max(i,2);let n=new Array(i+1),a=this.sweepAngle/i,o=this.startAngle+a;n[0]=this.start();for(let c=1;c<i;c++,o+=a)n[c]=this.pointOn(o);return n[i]=this.end(),n}panDistance(t){return this.sweepAngle>0?new ls(this.rx-t,this.ry-t,this.center,this.startAngle,this.sweepAngle):new ls(this.rx+t,this.ry+t,this.center,this.startAngle,this.sweepAngle)}panDistance1(t){if(this.sweepAngle>0){let s=this.rx-t;return s<0?(s=Math.abs(s),ls.build3(this.center,this.startAngle-180,this.sweepAngle,s,s)):new ls(s,s,this.center,this.startAngle,this.sweepAngle)}else{let s=this.rx+t;return s<0?(s=Math.abs(s),ls.build3(this.center,this.startAngle-180,this.sweepAngle,s,s)):new ls(s,s,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let t=Math.abs(M3(this.sweepAngle,3))/180*Math.PI;return Math.tan(t/4)}get midPoint(){let t=ct.toRadians(this.startAngle),s=ct.toRadians(this.endAngle()),r=this.sweep(),i=this.center,n=this.rx;if(r==1)if(s>t){let a=(s-t)/2+t;return i.add(new he(Math.cos(a),Math.sin(a)).mul(n))}else{if(s==t)return i.add(new he(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(s+Yf-t)/2+t;return i.add(new he(Math.cos(a),Math.sin(a)).mul(n))}}else if(s>t){let a=(t+Yf-s)/2+s;return i.add(new he(Math.cos(a),Math.sin(a)).mul(n))}else{if(s==t)return i.add(new he(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(t-s)/2+s;return i.add(new he(Math.cos(a),Math.sin(a)).mul(n))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(t){let s=ct.regularD(this.startAngle),r=ct.regularD(this.sweepAngle),i=ct.regularD(t.startAngle),n=ct.regularD(t.sweepAngle);return In([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(In([r,s],[n,i])||In([ct.regularD(s+r)],[i]))}equals1(t){let s=ct.regularD(this.startAngle),r=ct.regularD(this.sweepAngle),i=ct.regularD(t.startAngle),n=ct.regularD(t.sweepAngle);return In([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(In([r,s],[n,i])||In([ct.regularD(s+r)],[i]))}inArea(t,s){let r=t.x,i=t.y,n=this.center,a=this.rx,o=ct.toRadians(this.startAngle);this.sweep()==0&&(o=ct.toRadians(this.endAngle()));let c=ct.toRadians(this.endAngle());this.sweep()==0&&(c=ct.toRadians(this.startAngle));let l=a-s/2,u=a+s/2;var h=r-n.x,p=i-n.y,d=Math.atan2(p,h);if(d<0&&(d+=Yf),o<=c&&d>=o&&d<=c||o>c&&(d>=o&&d<=Yf||d>=0&&d<=c)||o==c){var f=Math.sqrt(h*h+p*p);return f<=u&&f>=l}else{var f=(u+l)/2,m=new he(n.x+Math.cos(o)*f,n.y+Math.sin(o)*f),g=new he(n.x+Math.cos(c)*f,n.y+Math.sin(c)*f),b=r-m.x,E=i-m.y,y=r-g.x,T=i-g.y;return b*b+E*E<=s*s/4?!0:y*y+T*T<=s*s/4}}isCircle(){return(Se.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return ls.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let t=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+t)%t:(this.startAngle-this.endAngle()+t)%t}isValid(){return this.rx>0&&this.ry>0}},M2=new ArrayBuffer(24),a1=new Float64Array(M2),Ul=new Int32Array(M2),or,YG=(or=class{static normal(t,s,r){let i=s.sub(t),n=r.sub(s);return i.cross(n)}constructor(t,s,r){this.x=Ps.normal(t),this.y=Ps.normal(s),this.z=Ps.normal(r),a1[0]=t,a1[1]=s,a1[2]=r,this.hashed=Ul[0]^Ul[1]^Ul[2]^Ul[3]^Ul[4]^Ul[5]}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(t){return t instanceof or?t.x===this.x&&t.y===this.y&&t.z===this.z:!1}cross(t){return new or(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var t=this.length();return new or(this.x/t,this.y/t,this.z/t)}sub(t){return new or(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new or(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new or(this.x*t,this.y*t,this.z*t)}neg(){return new or(-this.x,-this.y,-this.z)}multiply4(t){var s=this.x*t.data[0]+this.y*t.data[4]+this.z*t.data[8]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+this.z*t.data[9]+t.data[13],i=this.x*t.data[2]+this.y*t.data[6]+this.z*t.data[10]+t.data[14],n=this.x*t.data[3]+this.y*t.data[7]+this.z*t.data[11]+t.data[15];return n!=0?new or(s/n,r/n,i/n):new or(s,r,i)}rotate(t,s){return this.multiply4(v2.rotateAxis(t,s))}toVector2(){return new he(this.x,this.y)}},or.ORIGIN=new or(0,0,0),or.X_UNIT_VECTOR=new or(1,0,0),or.Y_UNIT_VECTOR=new or(0,1,0),or.Z_UNIT_VECTOR=new or(0,0,1),or);var Fs=class ql{static build(t){return t instanceof Et?new ql([new cr([t])]):t instanceof cr?new ql([t]):t}static buildByPolygon(t){return t?new ql([t]):new ql([])}static buildByStroke(t,s,r=1,i){return this.buildByPolygon(cr.buildByStroke(t,s,r,sE,i))}static buildCircle(t,s){return this.buildByPolygon(cr.buildCircle(t,s))}static buildRect(t){return this.buildByPolygon(cr.buildRect(t))}static buildBBox(t){return this.buildByPolygon(cr.buildBBox(t))}constructor(t){this.items=t.slice()}multiply3(t){return new ql(this.items.map(s=>s.multiply3(t)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((t,s)=>t.ext1(s.bbox()),new Ti).build1()),this._bbox}toPolylineGroups(){return this.items.map(t=>t.toPolylineGroup())}},es,Rt=(es=class{static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,s,r,i=255){return new es(t/255,s/255,r/255,i/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let s=t.length;if(s==3)return new es(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(s==6)return new es(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(s==8)return new es(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let s=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),i=parseInt(t.b*255+"").toString(16);return s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),("#"+s+r+i).toUpperCase()}static of5(t,s){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return new es(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,s);if(t.length==6)return new es(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,s);throw new Error("invalid color string")}static of6(t,s){return new es(t.r,t.g,t.b,s)}static of7(t){return t==null?null:es.of3(t)}constructor(t,s,r,i=1){this.r=Ps.positiveOr0(t),this.g=Ps.positiveOr0(s),this.b=Ps.positiveOr0(r),this.alpha=i}hashCode(){return this.r+this.g+this.b+this.alpha}equals(t,s=!1){let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return s?r:r&&this.alpha===t.alpha}add(t,s,r,i){return new es(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+s)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+i)))}mul(t){return new es(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return new es(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),s=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+s.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),s=(this.g*255).toString(16),r=(this.b*255).toString(16),i=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),"#"+t.substr(0,2)+s.substr(0,2)+r.substr(0,2)+i.substr(0,2)}toRGBA(){let t=this.r*255,s=this.g*255,r=this.b*255;return[t,s,r,this.alpha]}toRGBAString(){let t=this.r*255,s=this.g*255,r=this.b*255;return`rgba(${t},${s},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},es.WHITE=new es(1,1,1,1),es.BLACK=new es(0,0,0,1),es.RED=new es(1,0,0,1),es.GREEN=new es(0,1,0,1),es.BLUE=new es(0,0,1,1),es.Gray=es.of3("#9966ff"),es.Silver=es.of3("#D2D2D2"),es.Golden=es.of3("#DCAA14"),es.Pink=es.of3("#ffaec9"),es),Fw=!1,j2=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,s,r,i,n){}onIntersect(e,t,s){}onSegment(e,t,s,r,i,n){}onSegment1(e,t,s){if(Fw){let r=new he(e.getX(s),s),i=new he(t.getX(s),s);this.onSegment(r,e.weight,e,i,t.weight,t)}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t)}onSweep1(e,t,s){if(Fw){let r=new he(e.getX(s),s),i=new he(t.getX(s),s);this.onSweep(r,e.weight,e,i,t.weight,t)}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t)}},zh=class extends j2{constructor(e){super(),this.plGrps=new Array,this.debug=e}onPolylineGroup(e,t){this.plGrps.push(e)}},ad=class{constructor(e){this.cache={},this.levels=e,this.result=new Array(e),this.weights=new Array(e),this.maxIdx=e-1,this.rule=this.decide.bind(this);let t=1;for(let s=0;s<e;s++)this.weights[s]=t,t*=50}weight(e){return this.weights[e]}decide(e){e=Math.abs(e);let t=this.cache[e];if(t===void 0){let s=e;for(let r=this.maxIdx;r>=0;r--){let i=this.weights[r],n=e/i|0,a=e%i;a>(i/2|0)?(e=i-a,n++):e=a,this.result[r]=n>0}t=this.decide1(this.result),this.cache[s]=t}return t}},hL=e=>e!==0;var dL=new class extends ad{decide1(e){return e[0]||e[1]}}(2),im=new class extends ad{decide1(e){return e[0]&&!e[1]}}(2),nm=new class extends ad{decide1(e){return e[0]&&e[1]}}(2),am=new class extends ad{decide1(e){return e[0]&&!e[1]||!e[0]&&e[1]}}(2),pL=(e=>(e[e.UNMARKED=0]="UNMARKED",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE=2]="OUTSIDE",e[e.INVALID=3]="INVALID",e))(pL||{}),uu=class Jl{constructor(t,s,r,i,n,a,o){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=t,this.shape=s,this.baseWeight=r,i.y>n.y?this.weight=-r:i.y==n.y?this.weight=0:this.weight=r,this.start=i,this.end=n,this.polyGrp=a,this.polyIndex=o,this._bbox=new Ti().ext1(s.bbox()).ext2(i).ext2(n).build1(),this.inters.push(i),this.inters.push(n);let c=31,l=1;l=c*l+this.polyGrp,l=c*l+this.polyIndex,this._hashcode=l}static rebuild(t,s,r){if(t instanceof ce||s.distance2(r)<1e-6)return new ce(s,r);if(t instanceof Te){let i=t,n=t.bbox().center().x,a;s.y>r.y?a=n>i.center.x?0:1:a=n>i.center.x?1:0;let o=s.angleD(i.center),c=r.angleD(i.center);return Te.build2(i.center,o,c,i.rx,i.ry,a)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Ti().ext2(this.start).ext2(this.end).build1()}is(t,s){return t===this.polyGrp&&s===this.polyIndex}confidence(t){if(this._confidence_y!=t){let s=this._bbox.height();if(s!==0)if(Math.abs(t-this._bbox.maxY)>5e-4&&Math.abs(t-this._bbox.minY)>5e-4){let r=1-Math.abs(2*t-this._bbox.maxY-this._bbox.minY)/s;this._confidence=r*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=t}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(t){let s=this.confidence(t);return this.outsideWeight-=s,this.invalidWeight+=s,s}revokeInside(t){let s=this.confidence(t);return this.insideWeight-=s,this.invalidWeight+=s,s}setOutside(t){let s=this.confidence(t);return this.outsideWeight+=s,s}setInside(t){let s=this.confidence(t);return this.insideWeight+=s,s}setInvalid(t){let s=this.confidence(t);return this.invalidWeight+=s,s}prevNot0(){let t=this.previous;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.previous}return null}nextNot0(){let t=this.next;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.next}return null}getX(t){if(this.bo!==null)return(this._x_y!=t||isNaN(this._x))&&(wL(this,t)>0?this._x=ee[0]:this._x=NaN,this._x_y=t),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(t){if(t===2)if(this.start.y>this.end.y){let s=Jl.rebuild(this.shape,this.end,this.start),r=new Jl(this.bo,s,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return Kr.addAll(r.connect,this.connect),r}else return this;else if(t===1)if(this.start.y<this.end.y){let s=Jl.rebuild(this.shape,this.end,this.start),r=new Jl(this.bo,s,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return Kr.addAll(r.connect,this.connect),r}else return this;return this}isNeedScan(t){return this.needCountWeight()&&this.confidence(t)>0}hashCode(){return this._hashcode}equals(t){return t instanceof Jl?!(this.polyGrp!==t.polyGrp||this.polyIndex!==t.polyIndex):!1}bbox(){return this._bbox}toString(){return Ql.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function fL(e,t){let s=e.bbox(),r=t.bbox(),i=(s.minY+s.maxY)/2,n=(r.minY+r.maxY)/2;return i-n}function mL(e,t){let s=e.bbox(),r=t.bbox(),i=(s.minX+s.maxX)/2,n=(r.minX+r.maxX)/2;return i-n}var Hl=class{constructor(e){if(this.__bbox=null,typeof e<"u")if(e instanceof Array){this.__items=[];for(let t of e)this.add(t)}else this.__items=e,this.__bbox=e.bbox();else this.__items=[]}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=Jr.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},Kh=class{constructor(e){this.changed=!1,this.root=new Hl,this.capacity=e,this.capacity2=e*e,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(e){this.itemList.push(e),this.changed=!0}remove(e){Kr.remove(this.itemList,e),this.changed=!0}clear(){this.changed=!1,this.root=new Hl,this.itemList.length=0}flushWhenNeed(){if(this.changed){let e=new Array;for(let t of this.itemList)e.push(new Hl(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break}this.root=new Hl(e),this.changed=!1}}organize(e){Nc(e,mL,0,e.length);let t=e.length,s=[];for(let r=0;r<t;)if(r+this.capacity2<=t){let i=r+this.capacity2;Nc(e,fL,r,i);for(let n=r;n<i;n+=this.capacity){let a=new Hl(e.slice(n,n+this.capacity));s.push(a)}r=r+this.capacity*this.capacity}else{let i=new Hl(e.slice(r,r+this.capacity));s.push(i),r=r+this.capacity}return s}search(e){this.flushWhenNeed();let t=[],s=[];for(s.push(this.root);;){let r=s.shift();if(typeof r<"u"){let i=r.items();if(i instanceof Array){for(let n of i)if(!e.isSeparated(n.bbox())){let a=n.items();a instanceof Array?s.push(n):t.push(a)}}else e.isSeparated(r.bbox())||t.push(i)}else break}return t}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e)}_walker(e,t,s){this.flushWhenNeed();let r=e.items();if(r instanceof Array)for(let i of r)this._walker(i,t+1,s);else s(r,t)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};function o1(e,t){gL(e.iterator(),t)}function gL(e,t){let s=0;for(;e.hasNext();){let r=e.next();t(s++,r)}}var Vf=new Error("list is empty"),zf=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},yL=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},EL=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},Cc=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Vf;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Vf;return this.remove(e),e.item}addLast(e){return this.first===null||this.last===null?(this.first=new zf(this,e),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new zf(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Vf;return this.first.item}getLast(){if(this.last===null)throw Vf;return this.last.item}insertAfter(e,t){let s=new zf(this,t);return e.insertAfter(s),e===this.last&&(this.last=s),this.cnt++,s}insertBefore(e,t){let s=new zf(this,t);return e.insertBefore(s),e===this.first&&(this.first=s),this.cnt++,s}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new yL(this.first)}listIterator(){return new EL(this.first)}toArray(){let e=new Array(this.cnt),t=this.first,s=0;for(;t!=null;)e[s]=t.item,t=t.next,s++;return e}};function c1(e){throw new Error("")}var Wf=class{constructor(e,t){this.node1=null,this.node2=null,this.key=e,this.value=t}},bL=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},TL=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},_m=class{constructor(){this.innerList=new Cc,this.innerMap={}}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2)}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e]}put(e,t){let s=e.hashCode(),r=new Wf(e,t),i=this.innerMap[s];if(i===void 0)return r.node1=this.innerList.add(r),this.innerMap[s]=r,null;if(i instanceof Wf){if(i.key.equals(e))return this.innerMap[s]=r,this.replace(i,r),i.value;{r.node1=this.innerList.add(r);let n=new Cc;return i.node2=n.add(i),r.node2=n.add(r),this.innerMap[s]=n,null}}if(i instanceof Cc){let n=null;return o1(i,(a,o)=>o.key.equals(e)?(this.replace(o,r),n=o.value,!1):!0),n===null?(r.node1=this.innerList.add(r),r.node2=i.push(r),null):n}return c1(i)}get(e){let t=e.hashCode(),s=this.innerMap[t];if(s===void 0)return null;if(s instanceof Wf)return s.key.equals(e)?s.value:null;if(s instanceof Cc){let r=null;return o1(s,(i,n)=>n.key.equals(e)?(r=n.value,!1):!0),r}return c1(s)}containsKey(e){return this.get(e)!==null}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2)}remove(e){let t=e.hashCode(),s=this.innerMap[t];if(s===void 0)return null;if(s instanceof Wf)return s.key.equals(e)?(this.delete(s),s.value):null;if(s instanceof Cc){let r=null;return o1(s,(i,n)=>n.key.equals(e)?(r=n.value,this.delete(n),!1):!0),r}return c1(s)}computeIfAbsent(e,t){let s=this.get(e);if(s===null){let r=t(e);return this.put(e,r),r}else return s}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new bL(this.innerList.iterator())}values(){return new TL(this.innerList.iterator())}entries(){return this.innerList.iterator()}},nu=class{constructor(){this.innerMap=new _m}add(e){return this.innerMap.put(e,!0)!==!0}remove(e){this.innerMap.remove(e)}contains(e){return this.innerMap.get(e)===!0}iterator(){return this.innerMap.keys()}addAll(e){let t=e.iterator();for(;t.hasNext();)this.add(t.next())}size(){return this.innerMap.size()}clear(){let e=this.iterator();for(;e.hasNext();){let t=e.next();this.remove(t)}}},Uw=Kr.funcCopy(Nc);function wL(e,t){let s=0;if(Math.abs(e.start.y-t)<=1e-4)ee[s++]=e.start.x;else if(Math.abs(e.end.y-t)<=1e-4)ee[s++]=e.end.x;else if(e.shape instanceof ce)s=H3(e.shape,t);else if(e.shape instanceof Te)s=G3(e.shape,t);else throw new Error("not supported operation");return s}var om=class{constructor(e,t,s,r){this.sides=new Array,this.loader=e,this.loader.bo=this,this.logger=s,this.rule=t,this.event=r}static sortByBBoxMinY(e,t){return e.bbox().minY-t.bbox().minY}static sortByBBoxAreaDesc(e,t){return t.bbox().area()-e.bbox().area()}addPolyline(e,t=1,s=.01,r=!0){for(let i of this.loader.buildGroup(e,t,s,r))this.sides.push(i),this.event.onOriginSide(i)}buildRTree(){let e=new Kh(10);for(let t of this.sides)e.add(t);return e}fillValidSides(e,t,s){for(let r of t)isFinite(r.getX(s))&&e.push(r)}getSortedEndpointsLineAsc(e){let t=new Array;for(let i of e)i.needCountWeight()&&(t.push(i.start),t.push(i.end));Uw(t,he.sortByYAsc,0,t.length);let s=new Array,r=Number.NEGATIVE_INFINITY;for(let i of t){let n=i.y;n>r&&(s.push(n),r=n)}return s}splitSides(e,t,s){let r=e.start,i=e.end,n=new he(i.x+(r.x-i.x)*2,i.y+(r.y-i.y)*2);Uw(e.inters,(o,c)=>o.distance2(n)-c.distance2(n),0,e.inters.length);let a=null;for(let o of e.inters)if(a==null)o.equals(r)&&(a=o);else if(!o.equals(a)){let c=uu.rebuild(e.shape,a,o);c instanceof Te&&Math.abs(c.sweepAngle)>190&&(c=new ce(a,o));let l=new uu(this,c,e.baseWeight,a,o,e.polyGrp,s++);if(t.push(l),l.updateBbox(),o.equals(i))break;a=o}return s}splitSidesByInters(){let e=new Array;for(let t of this.sides)if(t.polyIndex==0){let s=0,r=null,i=null;do{let n=new Array;s=this.splitSides(t,n,s);for(let a of n)r!=null?(r.next=a,a.previous=r):i=a,r=a,this.event.onSplitedSide(a),e.push(a);if(t.next===null)throw new Error("not supported operation");t=t.next}while(t.polyIndex!==0);i!=null&&r!=null&&(i.previous=r,r.next=i)}this.sides.length=0;for(let t of e)this.sides.push(t)}seekIntersection(){if(this.sides.length>0){let e=this.buildRTree(),t=new nu;for(let s of this.sides){t.add(s);let r=s.bbox().extendOfSize(1e-5),i=s.shape instanceof ce;for(let n of e.search(r))if(!t.contains(n)){let a=n.shape instanceof ce;if(!(i&&a&&s.next!==null&&s.previous!==null&&(s.next.equals(n)||s.previous.equals(n)))){let o=cn(s.shape,n.shape);for(let c=0;c<o;c+=2){let l=new he(ee[c],ee[c+1]);s.inters.push(l),n.inters.push(l),this.event.onIntersect(l,s,n)}}}}}}},SL=class F2{constructor(t){this.sides=new nu,this.others=new nu,this.id=t}add(t){this.sides.add(t),t.finalGrp=this.id;for(let s of t.connect)this.others.add(s)}polyline(){let t=new Array;return iu(this.sides,(s,r)=>(t.push(r.shape),!0)),Et.build2(t).asClose()}hashCode(){return this.id}equals(t){return t!=null&&t instanceof F2?this.id===t.id:!1}},U2=class{constructor(e){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=e}completeGroup(e){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new ce(this.prevSide.end,this.firstSide.start),e);let t=new Array,s=null,r=null;for(let i of this.sides)(!this.noWeight0||i.weight!==0)&&(s!=null?(s.next=i,i.previous=s):r=i,s=i,t.push(i));return s!=null&&r!=null&&(r.previous=s,s.next=r),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,t}buildGroup(e,t,s,r=!0){for(let i of e.primitives)if(i instanceof ce)this.addSide(i,t);else if(r&&i instanceof Te&&i.rx===i.ry)this.addArc(i,t);else{let n=null;for(let a of i.points(s))n!=null&&this.addSide(new ce(n,a),t),n=a}return this.completeGroup(t)}addArc(e,t){let s=e.sweepAngle,r=ct.regularD(e.startAngle),i=r+s;if(s>0){let n=90;for(;n<=i;)n>r&&(this.addSide(Te.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n+=90;r<i&&this.addSide(Te.build3(e.center,r,i-r,e.rx,e.ry),t)}else if(s<0){let n=270;for(;n>=i;)n<r&&(this.addSide(Te.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n-=90;r>i&&this.addSide(Te.build3(e.center,r,i-r,e.rx,e.ry),t)}}addSide(e,t){if(e.start().equals(e.end()))return;let s=e.start(),r;this.prevSide!=null?(this.prevSide.end.equals(s)||this.addSide(new ce(this.prevSide.end,s),t),r=new uu(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++)):(r=new uu(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++),this.firstSide=r),this.prevSide=r,this.sides.push(r)}},H2=class{constructor(e,t,s){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=s,this.rule=e,this.bo=t,this.event=t.event}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e,this.start),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y))}out(e,t){if(this.onSameX(t,e))t.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&t.confidence(this.y)>0){let s=t.voteStatus(),r=e.voteStatus();this.isValid(s)&&this.isValid(r)?s==2&&r==1&&(e.connect.push(t),t.connect.push(e)):(e.connect.push(t),t.connect.push(e))}this.event.onSegment1(t,e,this.y),this.eps.push(t),this.eps.push(e),this.prevStart=t,this.prevEnd=e}this.start=null}isValid(e){return e==1||e==2}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&Se.eq(e.getX(this.y),t.getX(this.y))}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),s=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),s!=null&&e.weight===s.weight&&s.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y}},Am=new Error,Hw=new class extends ad{decide1(e){return e[0]&&e[1]}}(2),_L=new class extends j2{onPolylineGroup(e,t){throw Am}onSegment(e,t,s,r,i,n){throw Am}},AL=class{constructor(e,t){this.rtree=e,this.level=t}},CL=class G2 extends om{static isIntersect(t,s,r=Um.DUMMY){let i=new G2(r),n=i.createGroup1(t.items),a=i.createGroup2(s.items);return n.rtree.itemList.length==0||a.rtree.itemList.length==0?!1:i.isIntersect(n,a)}constructor(t){super(new U2(!1),Hw.rule,t,_L)}createGroup1(t){return this.createGroup(t,0)}createGroup2(t){return this.createGroup(t,1)}createGroup(t,s){let r=Hw.weight(s);for(let n of t)this.addPolyline(n,r);let i=this.buildRTree();return this.sides.length=0,new AL(i,s)}isIntersect(t,s){if(t.level!==s.level){let r=t.rtree.bbox().intersection1(s.rtree.bbox());if(r!==null){try{this.inters(t,s);let i=(r.minY+r.maxY)/2;this.sweep(t,s,i)}catch(i){if(i===Am)return!0;throw i}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(t,s){if(t.rtree.size()>s.rtree.size()){let r=t;t=s,s=r}for(let r of t.rtree.items()){r.trans=NaN;let i=r.bbox().extendOfSize(1e-5);for(let n of s.rtree.search(i))if(n.trans=NaN,cn(r.shape,n.shape)>0)throw Am}}sweep(t,s,r){let i=Jr.extend2(t.rtree.bbox(),s.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,t.rtree.search(i),r),this.fillValidSides(n,s.rtree.search(i),r),Nc(n,(o,c)=>o.getX(r)-c.getX(r),0,n.length);let a=new H2(this.rule,this,r);for(let o of n)a.onEp(o)}},rE=class ka{constructor(t){this.items=new Array(t.length),Kr.arraycopy(t,0,this.items,0,t.length),this.__bbox=this.calcBBox()}static build1(t){let s=[];return ym(t,(r,i)=>(s.push(i),!0)),new ka(s)}static build2(t){let s=t.map(r=>Et.build8(r));return new ka(s)}static combinePolylineGroupArr(t){let s=[];for(let r of t)s=s.concat(r.items);return new ka(s)}calcBBox(){let t=new Ti;for(let s=0;s<this.items.length;s++)t.ext1(this.items[s].bbox());return t.build1()}multiply3(t){let s=new Array(this.items.length);for(let r=0;r<s.length;r++)s[r]=this.items[r].multiply3(t);return new ka(s)}bbox(){return this.__bbox}asClose(){return this.items.forEach(t=>t.asClose()),this}mirrorY(t){return this.items.forEach(s=>s.mirrorY(t)),this}closeEndpoint(){return this.items.forEach(t=>t.closeEndpoint()),this}get primitives(){return this.items.map(t=>t.primitives).flat(2)}isEqual(t){return t instanceof ka?this.items.every(s=>t.items.some(r=>r.isEqual(s))):!1}getOutMostPolyline(){return this.items.reduce((t,s)=>s.bbox().area()>t.bbox().area()?s:t,this.items[0])}getOutline(){let t=this.items;if(t.length===1)return{outline:t,hole:new Array};let s=new Set,r=new Set;for(let i=0,n=t.length;i<n;i++){let a=t[i];if(!s.has(a)&&!r.has(a)){i+1>=n&&s.add(a);for(let o=i+1;o<n;o++){let c=t[o];if(!s.has(c)&&!r.has(c)){if(!a.bbox().isInside(c.bbox().extendOfSize(1e-4))&&!c.bbox().isInside(a.bbox().extendOfSize(1e-4)))continue;CL.isIntersect(new ka([a]),new ka([c]))&&(a.bbox().area()>c.bbox().area()?(s.add(a),r.add(c)):(s.add(c),r.add(a)))}}!s.has(a)&&!r.has(a)&&s.add(a)}}return{outline:[...s],hole:[...r]}}round(t=4){let s=this.items.map(r=>r.round(t));return new ka(s)}},DL=Kr.funcCopy(Nc),PL=Kr.funcCopy(Nc),OL=Kr.funcCopy(Nc);function IL(e){return new Array}function xL(e,t){let s=new zh(!1),r=new Wh(e,Um.DUMMY,s);for(let i of t)r.addPolyline(i);return r.simplify(),s.plGrps}var Wh=class extends om{constructor(e,t,s){super(new U2(!1),e,t,s),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(e,t,s){this.scanY=NaN,this.scanLines=0,DL(t,om.sortByBBoxMinY,0,t.length);let r=new Cc;this.curNetIndex=0;let i=Number.POSITIVE_INFINITY;for(let n of e)n>i&&this.scan(r,(i+n)/2,t),i=n;this.getAllMarkPrimitive(s,t),this.logger.debug3("scan %s %d",s,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(e,t=1,s=.01,r=!0){super.addPolyline(e,t,s,r)}scan(e,t,s){if(this.scanY==t)return;this.scanY=t;let r=!1,i=e.listIterator();for(;i.hasNext();){let n=i.next(),a=n.item;Se.less(a.bbox().maxY,t)?e.remove(n):!r&&a.isNeedScan(t)&&(r=!0)}for(;this.curNetIndex<s.length;){let n=s[this.curNetIndex];if(Se.less(n.bbox().minY,t))Se.greatereq(n.bbox().maxY,t)&&(this.add2AET(e,n),!r&&n.isNeedScan(t)&&(r=!0)),this.curNetIndex++;else break}if(r){this.scanLines++;let n=new H2(this.rule,this,t),a=e.iterator();for(;a.hasNext();){let o=a.next();n.onEp(o)}}}add2AET(e,t){let s=t.bbox().minX,r=t.bbox().maxX,i=t.bbox().minY,n=t.bbox().maxY,a=e.listIterator(),o=null;for(;a.hasNext();){let c,l=a.next(),u=l.item,h=u.bbox().minX,p=u.bbox().maxX;if(r<=h)c=-1;else if(p<=s)c=1;else{let f=u.bbox().minY,m=u.bbox().maxY,g=Math.max(i,f),b=Math.min(n,m);c=this.compareBySweep(t,u,(g+b)/2)}let d=u.shape;if(d instanceof ce&&d.length()<.001&&o==null&&c<0){o=l;continue}if(o!=null&&c<0){e.insertBefore(o,t);return}if(c<0){e.insertBefore(l,t);return}else o=null}e.add(t)}getLineAngle(e){let t=e.start().angle(e.end());return t<0&&(t+=Math.PI),t}getArcAngle(e,t){let s=Math.asin((t-e.center.y)/e.rx);return e.startAngle>90&&e.startAngle<270&&(s=-s),s<0&&(s+=Math.PI),(s+Math.PI/2)%Math.PI}compareArcLine(e,t,s){let r=this.getArcAngle(e,s),i=this.getLineAngle(t);return Se.eq(r,i)?-e.sweepAngle:i-r}compareBySweep(e,t,s){let r=e.getX(s);if(!isFinite(r))return 0;let i=t.getX(s);if(!isFinite(i))return 0;if(!Se.eq(r,i))return r-i;if(e.shape instanceof ce)return t.shape instanceof ce?this.getLineAngle(t.shape)-this.getLineAngle(e.shape):-this.compareArcLine(t.shape,e.shape,s);if(t.shape instanceof ce)return this.compareArcLine(e.shape,t.shape,s);{let n=e.shape,a=t.shape,o=this.getArcAngle(n,s),c=this.getArcAngle(a,s);return Se.eq(o,c)?n.sweepAngle*a.sweepAngle<=0?n.sweepAngle<=0?1:-1:n.sweepAngle>0?n.rx-a.rx:a.rx-n.rx:c-o}}getAllMarkPrimitive(e,t){for(let s of t)if(s.status===0&&s.bbox().height()!=0){let r=s.voteStatus();if(r===2||r===1){s.status=r;let i=s.reverse(r);if(e){this.event.onResultSide(i);let n=i.shape.multiply3(Yt.ROT_N90),a=i.start.multiply3(Yt.ROT_N90),o=i.end.multiply3(Yt.ROT_N90);i=new uu(this,n,i.baseWeight,a,o,i.polyGrp,i.polyIndex)}this.finalSides.push(i),this.event.onResultSide(i)}}}flipSides(){for(let e of this.sides)if(e.polyIndex==0){let t=null,s=null;do{let r=e.shape.multiply3(Yt.ROT_90),i=e.start.multiply3(Yt.ROT_90),n=e.end.multiply3(Yt.ROT_90),a=new uu(this,r,e.baseWeight,i,n,e.polyGrp,e.polyIndex);if(a.outsideWeight=e.outsideWeight,a.insideWeight=e.insideWeight,a.invalidWeight=e.invalidWeight,a.status=e.status,t!=null?(t.next=a,a.previous=t):s=a,this.vecSides.push(a),this.event.onSplitedSide(a),t=a,e.next!==null)e=e.next;else break}while(e.polyIndex!=0);s!=null&&(s.previous=t,t.next=s)}}canBeEnd(e,t){if(e.size()==1){let s=e.getFirst().shape;if(s instanceof Te){if(t&&s.rx<=t)return!1}else if(s instanceof ce&&t&&s.length()<=t)return!1}return!0}connectSides(){let e=new _m,t=new Kh(10);for(let n of this.finalSides)e.computeIfAbsent(n.start,IL).push(n),t.add(n.start);let s=0,r=new nu,i=new Array;for(let n of this.finalSides)if(!r.contains(n)){let a=new nu,o=n.start,c=new Cc;c.add(n),r.add(n);let l=n.end;for(;c.size()>0;)if(this.isStart(o,l)&&this.canBeEnd(c,.01)){c.size()>1&&this.fillSideGroups(c,s++);break}else{let u=e.get(l),h=this.findNext(r,u);if(h==null&&(l=this.findNeigber(l,a,t,.01),l!==null&&(u=e.get(l),h=this.findNext(r,u))),h!=null)c.add(h),r.add(h),l=h.end;else if(l!=null?a.add(l):(i.length==0&&c.size()>1&&this.logger.warning3("unable to connect at %s",c.getLast()),i.push(c.removeLast())),c.size()>0)l=c.getLast().end;else break}}}fillSideGroups(e,t){let s=new SL(t);iu(e,(r,i)=>(s.add(i),!0)),this.sideGroups[s.id]=s}isStart(e,t){return e.distance2(t)<=1e-4}findNext(e,t){if(t!=null){for(let s of t)if(!e.contains(s))return s}return null}fillResult(){let e=0,t=new _m;for(let r in this.sideGroups){let i=this.sideGroups[r];iu(i.sides,(n,a)=>(a.polyGrp!=-2&&t.put(a,a),!0))}let s=new nu;for(let r in this.sideGroups){let i=this.sideGroups[r];if(s.add(i)){let n=0,a=new Array;for(a.push(i);n<a.length;){let c=a[n],l=new Array;iu(c.others,(h,p)=>{let d=t.get(p);return d!=null&&l.push(d.finalGrp),!0}),PL(l,Kr.sortAsc,0,l.length);let u=c.id;for(let h of l)if(h!=u&&h!=c.id){let p=this.sideGroups[h];s.add(p)&&a.push(p),u=h}n++}let o=new Array;for(let c of a)o.push(c.polyline());OL(o,om.sortByBBoxAreaDesc,0,o.length),this.event.onPolylineGroup(new rE(o),e++)}}}findNeigber(e,t,s,r){let i=r*r,n=Number.MAX_VALUE,a=null;for(let o of s.search(e.bbox().extendOfSize(r)))if(!t.contains(o)){let c=e.distance2(o);c<n&&(n=c,a=o)}return n<i?a:null}},vL=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(e,t=!0){if(e instanceof ce)this.lines.push(e);else if(e instanceof Te)this.arcs.push(e);else if(e instanceof We)this.beziers.push(e);else throw new Error("not support");t&&this.points.push(e.start())}addPoint(e){this.points.push(e)}addText(e,t,s=1,r=.1,i=!0){this.listText.push({pos:e,str:t,size:s,width:r}),i&&this.points.push(e)}addPly(e,t=!0){e.primitives.forEach(s=>this.addPt(s,t))}build(){let e=[],t=[],s=[],r=[],i=[],n=[];return this.points.forEach(a=>e.push(a.x,a.y)),this.lines.forEach(a=>t.push(a.start().x,a.start().y,a.end().x,a.end().y)),this.arcs.forEach(a=>s.push(a.center.x,a.center.y,a.rx,ct.toRadians(a.startAngle),ct.toRadians(a.endAngle()),a.sweep())),this.beziers.forEach(a=>{a.controls.forEach(o=>{r.push(o.x,o.y)}),r.push("end")}),this.listText.forEach(a=>i.push(a.pos.x,a.pos.y,a.str,a.width,a.size)),this.fonts.forEach(a=>n.push(a)),{points:e,lines:t,arcs:s,texts:i,beziers:r,fonts:n}}},Lo,od=(Lo=class{constructor(t){this.map=new _m,this.bus=t}initColor(t){return this.map.computeIfAbsent(t,()=>new vL)}draw(){let t={},s=this.map.entries();for(;s.hasNext();){let r=s.next();t[r.key.toString()]=r.value.build()}this.bus.publish("/debug/draw",t)}clear(){this.map.clear()}static init(t){if(!t)throw new Error("bus is undefined!");this.palette=new Lo(t)}static initPalette(t){this.palette=t}static getDefaultColor(){for(let t of this.colorBuffersMap)if(t[0]!==null&&t[0])return t[0]=!1,t[1];return this.colorBuffersMap.forEach(t=>{if(t[0]===null){console.log(1);return}t[0]=!0}),this.getDefaultColor()}static clear(){this.palette.clear()}static auto(t,s=this.getDefaultColor()){if(Array.isArray(t))t.forEach(r=>{this.auto(r,s)});else if(t instanceof he)this.point(t,s);else if(t instanceof Jr)this.bbox(t,s);else if(t instanceof nd)this.primitive(t,s);else if(t instanceof Et)this.polyline(t,s);else if(t instanceof cr)this.polygon(t,s);else if(t instanceof Fs)this.group(t,s);else if(t instanceof rE)this.auto(t.items,s);else{debugger;throw new Error("No incoming type!")}}static text(t,s,r=.5,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");this.palette.initColor(i).addText(t,s,r,r/10),this.palette.draw()}static point(t,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(s);Array.isArray(t)?t.forEach(i=>{this.point(i,s)}):r.addPoint(t),this.palette.draw()}static bbox(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.bbox(r,s)}):(this.primitive(new ce(new he(t.maxX,t.maxY),new he(t.maxX,t.minY)),s),this.primitive(new ce(new he(t.maxX,t.maxY),new he(t.minX,t.maxY)),s),this.primitive(new ce(new he(t.minX,t.minY),new he(t.maxX,t.minY)),s),this.primitive(new ce(new he(t.minX,t.minY),new he(t.minX,t.maxY)),s))}static primitive(t,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(s);Array.isArray(t)?t.forEach(i=>{this.primitive(i,s)}):r.addPt(t),this.palette.draw()}static polyline(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polyline(r,s)}):t.primitives.forEach(r=>{this.primitive(r,s)})}static polygon(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polygon(r,s)}):t.items.forEach(r=>{this.polyline(r,s)})}static group(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.group(r,s)}):t.items.forEach(r=>{this.polygon(r,s)})}static async begin(){this.t1=performance.now()}static async end(t){console.log(t||"t1:",performance.now()-this.t1)}static async log(t){console.log(t||"==================")}},Lo.colorBuffersMap=[[!0,Rt.BLUE],[!0,Rt.GREEN],[!0,Rt.WHITE],[!0,Rt.RED],[!0,Rt.Golden],[!0,Rt.Gray]],Lo.t1=0,Lo),RL=0,cd=class O1{constructor(t,s){this.inters=[],this.shape=t,this.start=t.start(),this.end=t.end(),this.judgeOverlapMap=new Map,s&&(this.id=RL++)}reverse(){this.shape=this.shape.reverse();let t=this.start;this.start=this.end,this.end=t}getCenterPoint(t=this.end){let{x:s,y:r}=this.start,{x:i,y:n}=t;if(this.shape instanceof Te){let a=this.shape.rx,o=new he((s+i)/2,(r+n)/2),c=this.shape.center,l;return o.x!==c.x||o.y!==c.y?(l=o.angle(c),Math.abs(this.shape.sweepAngle)>180&&(l+=l>=0?-180:180)):l=(this.shape.startAngle+this.shape.endAngle())/2,new he(c.x+Math.cos(l)*a,c.y+Math.sin(l)*a)}else{if(this.shape instanceof ce)return new he((s+i)/2,(r+n)/2);if(this.shape instanceof We){let a=this.shape.getPercent(t,tt);return We.pointOn(a/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(t,s,r){let i=t.cross(s)>0,n=Math.acos(Math.min(1,Math.max(-1,t.dot(s)/s.length())));return(r?!i:i)&&(n=Hm-n),n}sortInters(){if(this.shape instanceof Te){let t=this.shape.center,s=this.shape.start().sub(t).normalize(),r=this.shape.isCCW;this.inters.sort((i,n)=>{let a=i.coord.sub(t),o=n.coord.sub(t);return O1.finalAngle(s,a,r)-O1.finalAngle(s,o,r)<=0?-1:1})}else if(this.shape instanceof ce){let t=this.start,s=this.end,r=new he(s.x+(t.x-s.x)*2,s.y+(t.y-s.y)*2);this.inters.sort((i,n)=>i.coord.distance2(r)-n.coord.distance2(r)<=0?-1:1)}else if(this.shape instanceof We){let t=this.shape;this.inters.sort((s,r)=>t.getPercent(s.coord,tt)-t.getPercent(r.coord,tt)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((t,s)=>t.setIndex(s))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(t){this.nextSide=t,t.prevSide=this}static returnPolygonList(t){let s=[];return t.forEach(r=>{let i=[];r.forEach((n,a)=>{let o=[];n.forEach(c=>{o.push(c.shape)}),i.push(Et.build7(o))}),s.push(new cr(i))}),s}addInter(t){this.inters.push(t)}static returnPolygonGroup(t){let s=[];return t.forEach(r=>{let i=[];r.forEach((n,a)=>{let o=[];n.forEach(c=>{o.push(c.shape)}),i.push(Et.build7(o))}),s.push(new cr(i))}),new Fs(s)}static rebuild(t,s,r){let i;if(t instanceof ce||s.distance2(r)<1e-6)i=new ce(s,r);else if(t instanceof Te)i=Te.build2(t.center,s.angleD(t.center),r.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);else if(t instanceof We){let n=t.getPercent(s,tt),a=t.clip(n)[1];i=a.clip(a.getPercent(r,tt))[0]}else throw new Error("not supported operation");return et(t,s).dot(et(i,s))<0?null:i}static returnPolyline(t){return Et.build7(t.map(s=>s.shape))}bbox(){return this.shape.bbox()}},NL=(e=>(e[e.END1=0]="END1",e[e.END2=1]="END2",e[e.END12=2]="END12",e[e.LEFT1=3]="LEFT1",e[e.LEFT2=4]="LEFT2",e))(NL||{});function Xr(e,t,s){if(e instanceof Te&&t instanceof Te)return kL(e,t);if(e instanceof Te&&t instanceof ce)return Vw(e,t);if(e instanceof ce&&t instanceof Te)return Yw(e,t);if(e instanceof ce&&t instanceof ce)return Oc(e,t);if(e instanceof We&&t instanceof ce)return e.controls.length===2||Ua(e)?Oc(new ce(e.start(),e.end()),t):Y2(e,t);if(e instanceof ce&&t instanceof We)return t.controls.length===2||Ua(t)?Oc(e,new ce(t.start(),t.end())):I1(e,t);if(e instanceof Te&&t instanceof We)return t.controls.length===2||Ua(t)?Vw(e,new ce(t.start(),t.end())):LL(e,t);if(e instanceof We&&t instanceof Te)return e.controls.length===2||Ua(e)?Yw(new ce(e.start(),e.end()),t):BL(e,t);if(e instanceof We&&t instanceof We)return iE(e,t);throw new Error("not support")}function Gl(e,t){return et(e,t.start()).dot(et(t,t.start()))<=0?!1:Xr(e,t).state<=2}function l1(e,t){let s=t.getPercent(e.end(),tt);if(s===null)return!1;if(s===0)return!0;let r=t.clip(s)[0],i=e.buildConverxHull(tt),n=r.buildConverxHull(tt),a=l(i),o=l(n);return c(a,o);function c(u,h){let p=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),d=u[0],f=h[0];if(!d||!f)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let m=!0;do{let g=d.getShape(),b=f.getShape();if(g instanceof ce&&b instanceof ce){let E=m?Oc(g,b).state:p.get(Oc(b,g).state);if(E===0)d=d.nextSide,m=!1;else if(E===1)f=f.nextSide,m=!0;else if(E===2)d=d.nextSide,f=f.nextSide,m=!0;else return!1}else throw Error("not support")}while(d!==u[0].prevSide&&f!==h[0].prevSide);return!0}function l(u){let h=u.primitives.map(d=>new cd(d)),p=h[h.length-1];return h.forEach(d=>{p.connect(d),p=d}),h}}function Gw(e,t){let s=e.end().distance2(t.center);if(s>(t.rx+tt)**2||s<(t.rx-tt)**2||!(Ze(e.end(),t.end())||nE(t,e.end())))return!1;if(e.center.equals1(t.center))return!0;let r=e.center.distance1(t.center),i=Math.abs(e.rx-t.rx);if(r>Math.min(e.rx,t.rx)){let n=e.center.angleD(t.center);return e.rx>t.rx?!(r+i>tt&&sa(e,n))&&!(r-i>tt&&e.rx+t.rx-r>tt&&sa(e,n+180)):!(r-i>tt&&sa(e,n))&&!(e.rx+t.rx-r>tt&&sa(e,n+180))}else{if(r+i<=tt)return!0;let n=e.rx>t.rx?e.center.angleD(t.center):t.center.angleD(e.center);return sa(e,n)?!1:r-i<=tt?!0:!sa(e,n+180)}}function LL(e,t){let s=aE(e,t.start()).toBezier2(),r,i=0;for(let n=s.length;i<n;i++){let a=s[i];if(r=iE(a,t).state,r!==0)break}return r===2&&i!==s.length-1?{state:1}:{state:r}}function BL(e,t){let s=t.toBezier2(),r,i=0;for(let n=s.length;i<n;i++){let a=s[i];if(r=iE(e,a).state,r!==1)break}return r===2&&i!==s.length-1?{state:0}:{state:r}}function iE(e,t){if(e.controls.length===2||Ua(e))return t.controls.length===2||Ua(t)?Oc(new ce(e.start(),t.end()),new ce(t.start(),t.end())):I1(new ce(t.start(),e.end()),t);if(t.controls.length===2||Ua(t))return Y2(x1(e,t.start()),new ce(t.start(),t.end()));let s=x1(e,t.start());if(Ua(s))return I1(new ce(t.start(),e.end()),t);let r=l1(s,t),i=l1(t,s);if(!r&&!i){let n=Z3(s,t);if(n.havOverlap){let a=n.havOverlap!==2,o=n.havOverlap!==1;return Wa(e,t,a,o)}else{let a=function(){for(let h=0;h<l;h+=2)ee[h]=u[h],ee[h+1]=u[h+1]},o,c,l=n.cnt,u=new Array(l).fill(0).map((h,p)=>ee[p]);for(let h=0;h<l;h+=2){let p=new he(ee[h],ee[h+1]),d=s.getPercent(p,tt),f=t.getPercent(p,tt);if(d===0||f===0)continue;let m=d===1?s:s.clip(d)[0],g=f===1?t:t.clip(f)[0];if(l1(m,g)){let b=et(e,p).cross(et(t,p));if(b===0){o=s.end(),c=t.end();break}return{state:b<0?3:4}}a()}return(!o||!c)&&(o=eu(s.controls,s.controls[0],t),c=eu(t.controls,s.controls[0],s)),{state:o.sub(s.controls[0]).cross(c.sub(s.controls[0]))>0?4:3}}}return Wa(e,t,r,i)}function Y2(e,t){let s=x1(e,t.start());if(Ua(s))return Oc(new ce(s.start(),s.end()),t);let r=z2(s,t),{isIn:i,bezierIsInLeft:n}=V2(t,s);if(!r&&!i){if(n!==void 0)return{state:n?3:4};let a=null,o=e.getPercent(t.start(),tt)+.01;for(let c=o>1?1:o;c<=1;){let l=We.pointOn(c,e.controls);if(Xh(t,l)>Zr){a=l;break}c+=.01,c>1&&(c=1)}if(!a)throw Error("!end1 && !end2 not result");return{state:t.direct.cross(a.sub(t.start()))<0?4:3}}return Wa(s,t,r,i)}function I1(e,t){let{isIn:s,bezierIsInLeft:r}=V2(e,t),i=z2(t,e);if(!s&&!i){if(r!==void 0)return{state:r?4:3};let n=null;for(let a=.01;a<=1;){let o=We.pointOn(a,t.controls);if(Xh(e,o)>Zr){n=o;break}a+=.01,a>1&&(a=1)}if(!n)throw Error("!end1 && !end2 not result");return{state:e.direct.cross(n.sub(e.start()))<0?3:4}}return Wa(t,e,s,i)}function kL(e,t){let s=Gw(aE(e,t.start()),t),r=Gw(t,e);if(!s&&!r){let i=Nn(t);if(e.center.sub(t.start()).dot(t.center.sub(t.start()))>0){if(e.rx===t.rx)return e.isCCW?{state:i.dot(e.center.sub(t.center))<0?3:4,exitIsInvalid:!1}:{state:i.dot(e.center.sub(t.center))>0?3:4,exitIsInvalid:!1};let n,a;return e.rx>t.rx?(n=e,a=t):(n=t,a=e),i.dot(a.center.sub(n.center))>0&&a.rx+a.center.distance1(n.center)-n.rx>tt?e.isCCW?{state:e.rx>t.rx?3:4,exitIsInvalid:!1}:{state:e.rx<t.rx?3:4,exitIsInvalid:!1}:e.isCCW?{state:e.rx<t.rx?3:4,exitIsInvalid:!0}:{state:e.rx>t.rx?3:4,exitIsInvalid:!0}}else return e.rx+t.rx-e.center.distance1(t.center)>tt&&i.dot(e.center.sub(t.center))>0?{state:t.isCCW?3:4,exitIsInvalid:!1}:{state:e.isCCW?3:4,exitIsInvalid:!0}}return Wa(e,t,s,r)}function Yw(e,t){let s=Rn.foot(e,t.center),r=e.end().distance2(t.center),i=e.end().sub(e.start()),n=(t.rx-tt)**2,a=r<=(t.rx+tt)**2&&r>=n&&(i.dot(s.sub(t.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(s)||s.distance2(t.center)>=n)&&(Ze(e.end(),t.end())||nE(t,e.end())),o=W2(t,e);if(!a&&!o){let c=e.distance2(t.center);return c<=Zr?{state:i.cross(Nn(t))>0?4:3}:i.dot(s.sub(t.start()))>=0&&(r<n||e.start().distance2(t.center)<n||c<n)?{state:i.cross(t.center.sub(e.start()))<0?4:3}:{state:i.cross(t.center.sub(e.start()))>0?4:3}}return Wa(t,e,a,o)}function sa(e,t){return t=ct.regularD(t),e.sweepAngle>0?(t<e.startAngle&&(t+=360),e.endAngle()>t):(t>e.startAngle&&(t-=360),e.endAngle()<t)}function nE(e,t){return Ze(e.end(),t)||Ze(e.start(),t)||sa(e,t.angleD(e.center))}function V2(e,t){let s=e.panDistance(tt),r=e.panDistance(-tt),i=zw(t,s),n=zw(t,r);if(!i.length&&!n.length)return{isIn:t.getPercent(e.end(),tt)!==null};let a=[...i,...n].sort((u,h)=>u.t-h.t),o=new ce(r.start(),s.start()),c=[];for(let u=0,h=a.length;u<h;u++){let p=a[u];if(c.push(p),o.distance(p.interP)>e.length()+tt)break;if(c.length===2){let d=(c[1].t*10+c.shift().t*10)/20,f=We.pointOn(d,t.controls);if(e.distance2(f)>Zr)return{isIn:!1,bezierIsInLeft:e.direct.cross(f.sub(e.start()))>0}}}let l=c.length?o.distance(c[0].interP)>=e.length()+tt:!0;return{isIn:l,bezierIsInLeft:l?void 0:e.direct.cross(c[0].interP.sub(e.start()))>0}}function z2(e,t){if(Xh(t,e.end())>Zr||e.getToLineMaxDis2(t)>Zr)return!1;let s=jL(t,Zr);return e.getToLineMaxDis2(s)<=(t.length()+tt)**2}function W2(e,t){let s=t.end().angleD(t.start()),r=ML(t,e.end());if(r>Zr)return!1;if(sa(e,s+90)){if(Rn.foot(t,e.center).distance1(e.pointOn(s+90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}if(sa(e,s-90)){if(Rn.foot(t,e.center).distance1(e.pointOn(s-90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}return r<=Zr&&(Ze(e.end(),t.end())||v1(t,e.end()))}var q2=(tt*2)**2;function aE(e,t){if(Ze(e.end(),t))return Te.build3(e.center,e.endAngle(),0,e.rx,e.ry);if(e.start().distance2(t)<q2)return e;let s=ct.regularD(t.angleD(e.center));if(!sa(e,s))throw new Error("!angleIsInArc(arc, angle)");return Te.build2(e.center,s,e.endAngle(),e.rx,e.ry,e.isCCW?1:0)}function x1(e,t){if(Ze(e.end(),t))return new We([t,t]);if(e.start().distance2(t)<q2)return e;let s=e.getPercent(t,tt);if(s===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return e.clip(s)[1]}function Vw(e,t){let s=W2(aE(e,t.start()),t),r=t.end().distance2(e.center),i=t.end().sub(t.start()),n=Rn.foot(t,e.center),a=(e.rx-tt)**2,o=r<=(e.rx+tt)**2&&r>=a&&(i.dot(n.sub(t.start()))<=0||t.start().distance2(t.end())<=t.start().distance2(n)||n.distance2(e.center)>=a)&&(Ze(e.end(),t.end())||nE(e,t.end()));if(!s&&!o){let c=t.distance2(e.center);return c<=Zr?{state:i.cross(Nn(e,t.start().angle(e.center)))>0?3:4}:i.dot(n.sub(t.start()))>=0&&(r<a||t.start().distance2(e.center)<a||c<a)?{state:i.cross(e.center.sub(t.start()))>0?4:3}:{state:i.cross(e.center.sub(t.start()))<0?4:3}}return Wa(t,e,s,o)}function Oc(e,t){if(Ze(e.end(),t.end()))return Wa(e,t,!0,!0);let s=Xh(t,e.end())<=Zr&&v1(t,e.end()),r=Xh(e,t.end())<=Zr&&v1(e,t.end());if(!s&&!r){let i=e.direct.x===0&&e.direct.y===0,n=t.direct.x===0&&t.direct.y===0;if(i&&n)throw Error("2LineAllIsPoint");return i?{state:t.direct.cross(e.end().sub(t.start()))>0?3:4}:{state:e.end().sub(e.start()).cross(t.end().sub(e.start()))>0?4:3}}return Wa(e,t,s,r)}function v1(e,t){return Rn.foot(e,t).distance2(e.start())<e.end().distance2(e.start())}function Wa(e,t,s,r){if(s)return r?Ze(e.end(),t.end())?{state:2}:{state:0}:{state:0};if(r)return{state:1};throw new Error("!end1 && !end2")}function Xh(e,t){return(e.a*t.x+e.b*t.y+e.c)**2/(e.a**2+e.b**2)}function ML(e,t){return Math.min(e.distance2(t),Rn.foot(e,t).distance2(t))}function jL(e,t){let s=e.panDistance(t),r=e.panDistance(-t);return new ce(r.start(),s.start())}function Ua(e){let t=e.start(),s=e.end();t.equals1(s)&&(s=t.add1(1,0));let r=s.y-t.y,i=t.x-s.x,n=-r*t.x-i*t.y,a=Math.sqrt(1/(r**2+i**2));r*=a,i*=a,n*=a;let o=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return e.controls.forEach(l=>{let u=r*l.x+i*l.y+n;u<o&&(o=u),u>c&&(c=u)}),la(o,c)}function zw(e,t){let s=cn(e,t),r=[],i=new Array(s).fill(0).map((a,o)=>ee[o]);for(let a=0;a<s;a+=2){let o=new he(ee[a],ee[a+1]),c=e.getPercent(o);r.push({interP:o,t:c}),n()}function n(){for(let a=0;a<s;a+=2)ee[a]=i[a],ee[a+1]=i[a+1]}return r}var ea=.01,FL=270;function Mo(e){let t=ea**2,s=e.end(),r=[],i=[];for(let d=0,f=e.primitives.length;d<f;d++){let m=function(D,I){return D instanceof ce&&I instanceof ce&&Math.abs(D.direct.cross(I.direct))<Se.eps&&D.direct.dot(I.direct)>0||D instanceof Te&&I instanceof Te&&Math.abs(D.rx-I.rx)<=Se.eps&&D.center.distance2(I.center)<Se.eps&&D.isCCW===I.isCCW},g=function(D){if(Wi(D,ea))i.push(null);else{if(D instanceof ce)i.push(D);else if(D instanceof Te&&D.rx===D.ry)h(D,i);else if(D instanceof We){let I=[];B2(D,I),I.forEach(P=>{let L=P.start(),F=P.end();u(L,F)||i.push(P)})}else throw new Error("not support!");s=T}},b=function(D){if(D instanceof ce)return D.direct.x===0&&D.direct.y===0;if(D instanceof Te)return D.sweepAngle===0;if(D instanceof We){let I=new Set(D.controls.map(L=>L.x)),P=new Set(D.controls.map(L=>L.y));return I.size===1&&P.size===1}else throw new Error("not support")},E=e.primitives[d],y=E.start(),T=E.end();if(b(E))continue;u(s,y)||(i.push(new ce(s,y)),s=y);let w=(d+1)%f,S=e.primitives[w];for(;m(E,S)&&(w=(w+1)%f,S=e.primitives[w],S!==E););if(w===(d+1)%f){g(E);continue}if(S===E){if(!(E instanceof Te)){if(Math.abs(e.area(.1))<t)return null;throw new Error("simplifyPolyline not support")}let D=E instanceof Te?E.isCCW:e.area(.1)>0;i.length=0;let I=D?180:-180;i.push(Te.build3(E.center,E.startAngle,I,E.rx,E.ry),Te.build3(E.center,E.startAngle+I,I,E.rx,E.ry));break}let _=(()=>{if(E instanceof ce)return(D,I)=>{let P=new ce(D,I);return Wi(P,ea)?null:[P]};if(E instanceof Te)return(D,I)=>{let P;if(D.equals1(I)?P=Te.build3(E.center,E.startAngle,E.sweep()===1?360:-360,E.rx,E.ry):P=Te.build4(D,I,E.center,E.rx,E.ry,E.sweep()),Wi(P,ea))return null;let L=P.pointOn(P.startAngle+P.sweepAngle/2),F=Te.build4(P.start(),L,E.center,E.rx,E.ry,E.sweep()),V=Te.build4(L,P.end(),E.center,E.rx,E.ry,E.sweep());return Wi(F,ea)||Wi(V,ea)?[P]:[F,V]};throw new Error("not support")})(),C=w===0;if(w<d&&!C&&(C=!_(e.primitives[0].start(),e.primitives[w-1].end()),!C)){let D=_(E.start(),e.primitives[f-1].end());if(D)i.push(...D);else{let I=_(E.start(),i[0].end());if(I.length===1)i[0]=I[0];else if(I.length===2)i[0]=I[1],i.push(I[0]);else throw new Error("!!!generatorPt")}break}d=w===0?f-1:w-1,S=e.primitives[d];let x=_(E.start(),S.end());if(x?(x.forEach(D=>i.push(D)),s=S.end()):g(null),C)break}let n=i.length;if(i.forEach((d,f)=>{if(d)r.push(d);else{let m,g;f===n-1&&(m=r[0],g=r[r.length-1]);let b=(f+1)%n;if(m=m!=null?m:i[b],m){let E=f,y=!1;for(;g=g!=null?g:i[(--E+n)%n],g!==m;)if(g){y=!0;break}if(y){if(m.start().equals1(g.end()))return;if(et(g,g.end()).dot(et(m,m.start()))<0){if(!u(g.end(),m.start())){let _=new ce(g.end(),m.start());r.push(_);return}let{rebuildPrevPt:T,rebuildNextPt:w,rebuildLinkLine:S}=Ww(i[(E-1+n)%n],g,new ce(g.end(),m.start()),m,i[(f+2)%n]);T&&w&&(T!==g?(i[(E+n)%n]=T,r[r.length-1]&&(r[r.length-1]=T)):w!==m&&(i[(f+1)%n]=w,r[0]===m&&(r[0]=w)),S&&r.push(S))}}}}}),r.length===0)return null;u(s,r[0].start())||r.push(new ce(s,r[0].start()));let a=r[r.length-1];if(r.length===1)return a instanceof Te?Et.build7([Te.build2(a.center,0,180,a.rx,a.ry,a.sweep()),Te.build2(a.center,180,360,a.rx,a.ry,a.sweep())]):a instanceof We?Et.build7(a.clip(.5)):null;let o=r.map(d=>new UL(d)),c=o[o.length-1];for(o.forEach(d=>{d.connect(c),c=d});!c.isVisited;){let d=function(){c.next.connect(m),c=c.next,c.isConnected=!1,c.isVisited=!1},f=function(){c.connect(m.prev),c.isConnected=!1},m=c.prev;if(c===m)break;let g=c.pt,b=m.pt,E=b.end();if(!c.isConnected&&!E.equals(g.start())){let y=function(w){c.isConnected=!0,c.pt=g=w,c.next.isVisited=!1},T=function(w){c.isConnected=!0,m.pt=w,m.isVisited=!1,c=m};if(g instanceof ce)if(u(E,g.end())){d();continue}else y(new ce(E,g.end()));else if(b instanceof ce){u(b.start(),g.start())?f():T(new ce(b.start(),g.start()));continue}else if(g instanceof We)if(u(E,g.end())&&!(g.controls.length!==2&&g.getToLineMaxDis2(g.startToEndL)>=t)){d();continue}else y(new We([E,...g.controls.slice(1)]));else if(b instanceof We)u(b.start(),g.start())&&!(b.controls.length!==2&&b.getToLineMaxDis2(b.startToEndL)>=t)?f():T(new We([...b.controls.slice(0,-1),g.start()]));else if(g instanceof Te&&b instanceof Te)if(Math.abs(Math.abs(g.sweepAngle)-180)<Math.abs(Math.abs(b.sweepAngle)-180)){let w=Te.build5(E,g.end(),g.sweepAngle);if(u(w.start(),w.end())&&!(w.rx>=ea&&Math.abs(w.sweepAngle)>180)){d();continue}else y(w)}else{let w=Te.build5(b.start(),g.start(),b.sweepAngle);u(w.start(),w.end())&&!(w.rx>=ea&&Math.abs(w.sweepAngle)>180)?f():T(w);continue}else throw new Error("not support")}if(et(g,g.start()).dot(et(b,b.end()))<0){let y=function(S,_,C,x,D,I){if(c.next===m){c=null;return}let{rebuildLinkLine:P,rebuildPrevPt:L,rebuildNextPt:F}=Ww(S,_,C,x,D);L&&F&&(L!==_&&(m.prev.pt=L),F!==x&&(c.next.pt=F),P?I.pt=P:d())},T=function(){c.next===m?c=null:(c.next.connect(m.prev),c=c.next,c.isConnected=!1,c.isVisited=!1)},w=Xr(b.reverse(),g).state;if(w===0){let S=qw(g,b.start(),g.end());if(p(S)){let _=m.prev.pt,C=c.next.pt;if(et(C,C.start()).dot(et(_,_.end()))>=0){if(T(),!c)break;continue}if(y(m.prev.prev.pt,_,S instanceof ce?S:new ce(S.start(),S.end()),C,c.next.next.pt,c),!c)break}else c.pt=S;f();continue}else if(w===1){let S=qw(b,b.start(),g.end());if(p(S)){let _=m.prev.pt,C=c.next.pt;if(et(C,C.start()).dot(et(_,_.end()))>=0){if(T(),!c)break;continue}if(y(m.prev.prev.pt,_,S instanceof ce?S:new ce(S.start(),S.end()),C,c.next.next.pt,m),!c)break}else m.pt=S;d();continue}else if(w===2){if(T(),!c)break;continue}}c.isVisited=!0,c=c.next}if(!c)return null;r.length=0;let l=c;for(r.push(c.pt),c=c.next;c!==l;)r.push(c.pt),c=c.next;if(r.length===1){let d=r[0];return d instanceof Te?(u(d.start(),d.end())?r[0]=Te.buildCircle(d.center,d.rx,d.sweep()):r.push(new ce(d.end(),d.start())),Et.build7(r)):d instanceof We?(u(d.start(),d.end())||r.push(new ce(d.end(),d.start())),Et.build7(r)):null}if(e=Et.build7(r),Math.abs(e.area(.1))<t)return null;return e;function u(d,f){return d.distance2(f)<t}function h(d,f){if(Math.abs(d.sweepAngle)>FL){let m=d.sweepAngle/2;h(Te.build3(d.center,d.startAngle,m,d.rx,d.ry),f),h(Te.build3(d.center,d.startAngle+m,m,d.rx,d.ry),f)}else f.push(d)}function p(d){return d.start().distance2(d.end())<t&&!(d instanceof Te&&d.rx>=ea&&Math.abs(d.sweepAngle)>180||d instanceof We&&d.controls.length!==2&&d.getToLineMaxDis2(new ce(d.start().add1(1,0),d.end()))>=t)}}function Wi(e,t){if(!e)return!0;let s=e.start(),r=e.end();if(s.distance2(r)<t**2)if(e instanceof Te){if(!(e.rx>=t&&Math.abs(e.sweepAngle)>180))return!0}else if(e instanceof We){if(!(e.controls.length!==2&&e.getToLineMaxDis2(new ce(e.start().add1(1,0),e.end()))>=t))return!0}else return!0;return!1}function Yl(e){if(e.direct.x===0&&e.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let t=Math.abs(ea-e.length())+Se.eps,s={x:e.direct.normalize().x*t,y:e.direct.normalize().y*t},r=e.end();return new he(r.x+s.x,r.y+s.y)}function Ww(e,t,s,r,i){if(!e)a();else if(!i)o();else{let c=et(e,e.end()),l=et(t,e.end()),u=c.dot(l);if(u>=0)a();else{let h=et(r,r.end()),p=et(i,r.end()),d=h.dot(p);if(d>=0)o();else if(la(u,-1)&&la(d,-1)){let f=s.center();n(f),s=null}else u>d?a():o()}}function n(c){let l;if(t instanceof ce)l=new ce(t.start(),c);else if(t instanceof We)l=new We([...t.controls.slice(0,-1),c]);else if(t instanceof Te)l=Te.build5(t.start(),c,t.sweepAngle);else throw new Error("not supported");t=Wi(l,tt)?null:l;let u;if(r instanceof ce)u=new ce(c,r.end());else if(r instanceof We)u=new We([c,...r.controls.slice(1)]);else if(r instanceof Te)u=Te.build5(c,r.end(),r.sweepAngle);else throw new Error("supported");r=Wi(u,tt)?null:u}function a(){if(t instanceof ce){let c=Yl(s.reverse());s=new ce(c,s.end());let l=new ce(t.start(),c);t=Wi(l,tt)?null:l}else if(t instanceof We){let c=Yl(s.reverse());s=new ce(c,s.end());let l=new We([...t.controls.slice(0,-1),c]);t=Wi(l,tt)?null:l}else if(t instanceof Te){let c=Yl(s.reverse());s=new ce(c,s.end());let l=Te.build5(t.start(),c,t.sweepAngle);t=Wi(l,tt)?null:l}else throw new Error("not supported")}function o(){if(r instanceof ce){let c=Yl(s);s=new ce(s.start(),c);let l=new ce(c,r.end());r=Wi(l,tt)?null:l}else if(r instanceof We){let c=Yl(s);s=new ce(s.start(),c);let l=new We([c,...r.controls.slice(1)]);r=Wi(l,tt)?null:l}else if(r instanceof Te){let c=Yl(s);s=new ce(s.start(),c);let l=Te.build5(c,r.end(),r.sweepAngle);r=Wi(l,tt)?null:l}else throw new Error("not supported")}return{rebuildPrevPt:t,rebuildNextPt:r,rebuildLinkLine:s}}function qw(e,t,s){if(e instanceof ce||t.distance2(s)<=Zr)return new ce(t,s);if(e instanceof Te)return Te.build2(e.center,t.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof We){let r=e.getPercent(t,tt),i=e.getPercent(s,tt);return e.clip(r)[1].clip((i-r)/(1-r))[0]}else throw new Error("not supported operation")}var UL=class{constructor(e){this.pt=e}connect(e){this.prev=e,e.next=this}};function Cm(e){let t=ld(),s;if(e instanceof Et){let r=Mo(e);if(r===null)return null;s=r}else if(e instanceof cr){let r=e.items.map(i=>Cm(i)).filter(i=>i!==null);if(r.length===0)return null;s=new cr(r)}else{let r=e.items.map(i=>Cm(i)).filter(i=>i!==null);if(r.length===0)return null;s=new Fs(r)}return aa.preprocessPolyline+=vo(t),s}var aa={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function ld(){return{timeIndex:Object.assign({},aa),start:performance.now()}}function Jw(e){return Object.values(e).reduce((t,s)=>t+s,0)}function vo(e){return performance.now()-e.start-(Jw(aa)-Jw(e.timeIndex))}function gr(e,t,s,r){let i=Rt.RED,n=Rt.Golden;function a(){if(!r)return;let p=r.initColor(Rt.Golden);p.addPt(o),p.addPoint(o.end()),r.initColor(Rt.RED).addPt(c),r.draw();debugger}let o=e.getShape(),c=s?t.getShape():t.getShape().reverse(),l=et(o,c.start()),u=et(c),h=l.cross(u);if(la(h,0))if(o instanceof ce)if(c instanceof ce){if(Se.eq(h,0)&&(l.dot(u)>0?!Ze(o.end(),c.start()):!Ze(o.start(),c.start())))throw a(),new Error("line and line");return h<0}else{if(c instanceof Te)return l.cross(c.center.sub(o.start()))<0;if(c instanceof We){let p=c.getExtremePoints(o),d=p.length?p[0]:eu(c.controls,o.start());return l.cross(d.sub(o.start()))<0}else throw new Error("not support")}else if(o instanceof Te){if(c instanceof ce)return o.isCCW;if(c instanceof Te){if(c.center.equals1(o.center)&&(l.dot(u)>0?!Ze(o.end(),c.start())&&o.end().sub(c.start()).dot(u)>0:!Ze(o.start(),c.start())&&o.start().sub(c.start()).dot(u)>0))throw a(),new Error("arc and arc");return c.rx>=o.rx||c.center.distance2(o.center)>o.rx2?o.isCCW:!o.isCCW}else throw new Error("not support")}else if(o instanceof We)if(c instanceof ce){let p=o.getPercent(c.start(),tt),d=o.clip(p)[1],f=d.getExtremePoints(c);return(f.length?f[0]:eu(d.controls,c.start())).sub(c.start()).cross(u)<0}else if(c instanceof We){let p=o.getPercent(c.start(),tt),d=o.clip(p)[1],f=d.getExtremePoints(new ce(c.start(),c.end())),m=c.getExtremePoints(new ce(d.start(),d.end())),g=f.length?f[0]:eu(d.controls,c.start()),b=m.length?m[0]:eu(c.controls,c.start()),E=g.sub(c.start()),y=b.sub(c.start());return E.cross(y)<0}else throw Error("not support");else throw new Error("not support");else return h<0}function Lc(e,t,s,r,i){let n=e.getShape(),a=t.getShape(),o=n instanceof Te?Nn(n,ct.toRadians(n.endAngle())):n instanceof We?Jh(n,1):n.end().sub(n.start()).normalize(),c=et(a),l=o.dot(c);if(la(l,-1))return gr(e,t,!0,i)?gr(e,s,r,i)&&gr(t,s,r,i):gr(e,s,r,i)||gr(t,s,r,i);{let u=o.scale(-1).angle(he.ORIGIN),h=c.angle(he.ORIGIN);u>h&&(u-=Hm);let p=(u+h)/2,d=new he(Math.cos(p),Math.sin(p)),f=r?s.getShape():s.getShape().reverse(),m=et(f);return d.cross(m)<0?gr(e,s,r,i):gr(t,s,r,i)}}function u1(e,t,s,r,i){let n=e.getShape(),a=t.getShape(),o=n instanceof Te?Nn(n,ct.toRadians(n.endAngle())):n instanceof We?Jh(n,1):n.end().sub(n.start()).normalize(),c=et(a),l=o.dot(c);if(la(l,-1))return gr(e,t,!0,i)?gr(e,s,r,i)&&gr(t,s,r,i):gr(e,s,r,i)||gr(t,s,r,i);{let u=o.scale(-1).angle(he.ORIGIN),h=c.angle(he.ORIGIN);u>h&&(u-=Hm);let p=(u+h)/2,d=new he(Math.cos(p),Math.sin(p)),f=r?s.getShape():s.getShape().reverse(),m=et(f);if(d.cross(m)<0){let g=o.dot(m)<0,b=Xr(g?e.getShape().reverse():e.getShape(),f).state;return b!==3&&b!==4?gr(e,s,r,i):b===(g?4:3)}else{let g=c.dot(m)<0,b=Xr(g?t.getShape().reverse():t.getShape(),f).state;return b!==3&&b!==4?gr(t,s,r,i):b===(g?4:3)}}}var HL=(e=>(e[e.NOT_IN=0]="NOT_IN",e[e.IS_IN=1]="IS_IN",e[e.IS_OVERLAP=2]="IS_OVERLAP",e))(HL||{}),GL=(e=>(e[e.AllClear=0]="AllClear",e[e.MapClear=1]="MapClear",e))(GL||{}),ra,No=!1;function qi(e,t,s,r,i,n,a,o=s.side===t,c=!0,l){return ra=i,No=n,J2(K2(e,t,c,l,a,s,o,r),s,o,r,0)}function Ma(e,t,s,r,i,n,a,o=r.side===s){ra=i,No=n;let c=X2(e,t,s,new Map,r,o,a),l=c instanceof Array?-1:1;return J2(c,r,o,a,l)}function J2(e,t,s,r,i){for(;e instanceof Array;)i++,e.length===4?e=X2(...e,t,s,r):e=K2(...e,t,s,r);return{...e,existOverlap:i>0}}function K2(e,t,s,r,i,n,a,o){if(Dm===-1){o.initColor(Rt.RED).addPt(e.getShape()),o.initColor(Rt.Golden).addPt(t.getShape()),o.draw();debugger}let c=e.getShape(),l=a?t.getShape().reverse():t.getShape(),u=(c instanceof Te?Nn(c,s?l.start().angle(c.center):r?ct.toRadians(c.endAngle()):void 0):c instanceof We?et(c,s?l.start():r?c.end():c.start()):c.end().sub(c.start())).normalize(),h=(l instanceof Te?Nn(l,s?void 0:(r?c.end():c.start()).angle(l.center)):l instanceof We?et(l,s?void 0:r?c.end():c.start()):l.end().sub(l.start())).normalize();if(r===void 0){let f=u.dot(h);if(r=f<0,la(f,0))return{state:gr(e,t,!a,o)?1:0,inter:ja(e,t,n,a,s,r,i)}}else if(r?u.dot(h)>0:u.dot(h)<0)if(s){let f,m=!0;if(c instanceof ce&&Ze(Rn.foot(c,l.start()),r?c.end():c.start()))m=!1;else if(c instanceof Te||c instanceof We){let g=r?c.reverse():c,b=Xr(l,sL(g,l.start()).reverse()).state;(b===1||b===2)&&(m=!1)}if(m){let g=!r;f=Xr(g?c.reverse():c,l,o).state===(g?4:3)?1:0}else r?f=Lc(e,e.nextSide,t,!a,o)?1:0:f=Lc(e.prevSide,e,t,!a,o)?1:0;return{state:f,inter:ja(e,t,n,a,s,r,i)}}else return r?{state:gr(e,e.nextSide,!0,o)?0:1,inter:ja(e,t,n,a,s,r,i),isReversed:!0}:{state:gr(e.prevSide,e,!0,o)?0:1,inter:ja(e,t,n,a,s,r,i),isReversed:!0};let p,d=new Map([[3,4],[4,3],[0,1],[1,0],[2,2]]);if(s)if(e.judgeOverlapMap.has(t)&&!No){let f=e.judgeOverlapMap.get(t);p=r?d.get(f.state):f.state}else p=Xr(r?c.reverse():c,l).state,(p===3||p===4)&&e.judgeOverlapMap.set(t,{state:r?d.get(p):p});else{if(t.judgeOverlapMap.has(e)&&!No){let f=t.judgeOverlapMap.get(e);p=a?d.get(f.state):f.state}else p=Xr(l,r?c.reverse():c).state,(p===3||p===4)&&t.judgeOverlapMap.set(e,{state:a?d.get(p):p});p=d.get(p)}if(p===1||p===2){let f=a?t.prevSide:t,m=f.inters,g=f.getEnd();for(let b=m.length-1;b>=0;b--){let E=m[b];if(!(f.getShape()instanceof We)&&!Ze(g,E.coord))break;if(E===n)return{state:2,inter:ja(e,t,n,a,s,r,i)}}}if(p===3||p===4)return{state:p===(r?4:3)?1:0,inter:ja(e,t,n,a,s,r,i)};if(i.has(e)?i.get(e).mapSideList.push(t):i.set(e,{sideIsReversed:r,mapSideList:[t]}),i.has(t)?i.get(t).mapSideList.push(e):i.set(t,{sideIsReversed:a,mapSideList:[e]}),p===2)return r?[e.prevSide,e,a?t.prevSide:t.nextSide,i]:[e,e.nextSide,a?t.prevSide:t.nextSide,i];if(p===0)return[r?e.prevSide:e.nextSide,t,!1,r,i];if(p===1)return[e,a?t.prevSide:t.nextSide,!0,r,i];throw Error("not support")}function ja(e,t,s,r,i,n,a){if(No)return null;let o=e.getShape(),c=r?t.getShape().reverse():t.getShape(),l=r;if(!i){let d=t;t=e,e=d,r=n,s=s.getBindedInter()}let u=d=>!(i?n:l)&&Ze(d,e.prevSide.getEnd())?e.prevSide:e;if(r){let d=t.inters;for(let f=0;f<d.length;f++){let m=d[f];if(m.isInvalid&&n===void 0)continue;if(m===s&&Ze(c.start(),s.coord))return i?m:m.getBindedInter();let g=m.getBindedInter().side,b=u(m.coord);if(g===b&&h(m))return p(m)}for(;;){t=t.nextSide;let f=t.inters;for(let m=0;m<f.length;m++){let g=f[m];if(g===s)return i?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||Ze(g.coord,b.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return p(g);if(a.has(b)){let E=t.getShape().reverse(),y=et(E,g.coord).dot(et(b.getShape(),g.coord))<0,T=y?b.getShape().reverse():b.getShape(),w=Xr(E,y?n1(T,g.coord,T.end()):n1(T,T.start(),g.coord)).state;if(w===1||w===2)return p(g)}else a.has(b.nextSide)}else if(g.side===s.side&&h(g))return p(g)}}}else{let d=t.inters;for(let f=d.length-1;f>=0;f--){let m=d[f];if(m.isInvalid&&n===void 0)continue;if(m===s&&Ze(c.start(),s.coord))return i?m:m.getBindedInter();let g=m.getBindedInter().side,b=u(m.coord);if(g===b&&h(m))return p(m)}for(;;){t=t.prevSide;let f=t.inters;for(let m=f.length-1;m>=0;m--){let g=f[m];if(g===s)return i?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||Ze(g.coord,g.getBindedInter().side.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return p(g);if(!a.has(b)&&a.has(b.prevSide)){let E=t.getShape().reverse(),y=et(E,g.coord).dot(et(b.getShape(),g.coord))<0;if(a.has(b.prevSide)){let T=y?b.getShape().reverse():b.getShape(),w=Xr(t.getShape(),n1(T,g.coord,T.end())).state;if(w===1||w===2)return p(g)}}}else if(g.side===s.side&&h(g))return p(g)}}}function h(d){if(d.isInvalid||d.getBindedInter().side!==(Ze(d.coord,e.prevSide.getEnd())?e.prevSide:e))return!1;let f;if(i){if(Ze(d.coord,c.start()))return!0;f=Xr(n?o.reverse():o,m(c)).state}else{if(Ze(d.coord,n?o.end():o.start()))return!0;f=Xr(c,m(n?o.reverse():o)).state}return f===2||f===1;function m(g){if(g instanceof ce)return Ze(d.coord,g.end())?g:g.cutLine(d.coord);if(g instanceof Te)return Te.build2(g.center,g.startAngle,d.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof We)return g.clip(g.getPercent(d.coord,tt))[0];throw new Error("not supported operation")}}function p(d){let f=s.getBindedInter(),m=s.side,g=f.side,b=s===d,E=s;if(r){let y=s.getIndex()-1;for(;m;){let T=m.inters;for(;y>=0;y--)if(s=T[y],s===d){b||(s.setIsInvalid(),s.isDealed(),E=s),m=null;break}else if(ra===0)!s.isInvalid&&(!Ze(s.coord,d.coord)||s.side===d.side&&s.getBindedInter().side===d.getBindedInter().side)&&(s.setIsInvalid(),s.isDealed(),E=s);else if(ra===1){if(s.isInvalid)continue;let w=s.getBindedInter().side;a.has(m)&&a.get(m).mapSideList.includes(w)&&(s.setIsInvalid(),s.isDealed(),E=s)}m=m==null?void 0:m.prevSide,y=(m==null?void 0:m.inters.length)-1}}else{let y=s.getIndex()+1;for(;m;){let T=m.inters;for(;y<T.length;y++){s=T[y];let w=s.getBindedInter();if(s===d){b||(s.setIsInvalid(),s.isDealed(),E=s),m=null;break}else if(ra===0)!s.isInvalid&&(!Ze(s.coord,d.coord)||m===d.side&&(Ze(w.side.getEnd(),s.coord)?w.side.nextSide:w.side)===d.getBindedInter().side)&&(s.setIsInvalid(),s.isDealed(),E=s);else if(ra===1){let S=w.side;a.has(m)&&a.get(m).mapSideList.includes(S)&&(s.setIsInvalid(),s.isDealed(),E=s)}}m=m==null?void 0:m.nextSide,y=0}}if(ra===0&&!Ze(f.coord,d.coord))if(i?a.has(g)?a.get(g).sideIsReversed:n:l){let y=f.getIndex()-1;for(;g;){let T=a.has(g),w=g.inters;for(;y>=0;y--){if(f=w[y],f===d.getBindedInter()){g=null;break}f.isInvalid||!T||(!Ze(f.coord,d.getBindedInter().coord)||f.side===d.side&&f.getBindedInter().side===d.getBindedInter().side)&&(f.setIsInvalid(),f.isDealed())}g=g==null?void 0:g.prevSide,y=(g==null?void 0:g.inters.length)-1}}else{let y=f.getIndex()+1;for(;g;){let T=g.inters,w=a.has(g);for(;y<T.length;y++){if(f=T[y],f===d.getBindedInter()){g=null;break}let S=Ze(g.getEnd(),f.coord)?a.has(g.nextSide):!1;f.isInvalid||!(w||S)||(!Ze(f.coord,d.getBindedInter().coord)||f.side===d.side&&f.getBindedInter().side===d.getBindedInter().side)&&(f.setIsInvalid(),f.isDealed())}g=g==null?void 0:g.nextSide,y=0}}return i?E:E.getBindedInter()}}function X2(e,t,s,r,i,n,a){let o=e.getShape(),c=t.getShape(),l=n?s.getShape().reverse():s.getShape(),u=(o instanceof Te?Nn(o,l.start().angle(o.center)):o instanceof We?et(o,l.start()):o.end().sub(o.start())).normalize(),h=(c instanceof Te?Nn(c,l.start().angle(c.center)):c instanceof We?et(c,l.start()):c.end().sub(c.start())).normalize(),p=u.dot(h);if(la(p,-1)){let d=n?s.getShape().reverse():s.getShape(),f=et(d).normalize(),m=u.add(h.scale(-1)).normalize().dot(f),g=Xr(o.reverse(),c,a).state;if(m>-.9&&(g===3||g===4))return{state:g===4?0:1,inter:ja(t,s,i,n,!0,!1,r)};let b=qi(e,s,i,a,ra,No,r.size===0?new Map:r,n);return b.state===2?b:g===4?b.state===0||b.inter!==i?b:qi(t,s,i,a,ra,No,r.size===0?new Map:r,n):b.state===1||b.inter!==i?b:qi(t,s,i,a,ra,No,r.size===0?new Map:r,n)}else{let d=u.scale(-1).angle(he.ORIGIN),f=h.angle(he.ORIGIN);d>f&&(d-=Hm);let m=(d+f)/2,g=new he(Math.cos(m),Math.sin(m)),b=et(l).normalize(),E=b.angle(he.ORIGIN),y=d<E&&E<f&&o instanceof ce&&c instanceof ce&&l instanceof ce;if(g.cross(b)<=0){if(u.scale(-1).dot(b)<0){let T;return i.coord.equals1(l.start())?T=et(o,i.coord).dot(et(l,i.coord))<0:l instanceof ce&&(T=et(o,o.end()).dot(l.direct)<0),{state:Lc(e,t,s,!n,a)?1:0,inter:ja(e,s,i,n,!0,T,r)}}return y&&o.distance2(l.start())>Zr?[t,s,!0,void 0,r]:[e,s,!0,void 0,r]}else return h.dot(b)<=0?{state:Lc(e,t,s,!n,a)?1:0,inter:ja(t,s,i,n,!0,void 0,r)}:y&&c.distance2(l.start())>Zr?[e,s,!0,void 0,r]:[t,s,!0,void 0,r]}}var Dm=0;function YL(e,t,s,r){let i=t.getBindedInter(),n=t.side,a=i.side,o=n.getShape(),c=a.getShape();if(r&&(Dm++,Dm===-1)){r.initColor(Rt.RED).addPt(o),r.initColor(Rt.Golden).addPt(c),r.draw();debugger}let l=0,u=!1;if(e===-1){let _=Ma(n,n.nextSide,a,i,l,u,r),C=_.state!==0;if(_.state===2){let D=et(o,t.coord).add(et(n.nextSide.getShape(),t.coord)).normalize(),I=et(c,t.coord).add(et(a.nextSide.getShape(),t.coord)).normalize();return S(C,D.dot(I)>0)}let x=Ma(n,n.nextSide,a.nextSide,i,l,u,r);return _.state!==x.state?(w(_,x),1):S(C,_.state!==Ma(a,a.nextSide,n,t,l,!0,r).state,_.inter,x.inter)}if(e===1){let _=qi(n,a,i,r,l,u,new Map),C=_.state!==0;if(_.state===2)return S(C,et(o,t.coord).dot(et(c,t.coord))>0);let x;if(_.isReversed&&_.existOverlap&&Ze(_.inter.coord,a.getEnd())&&_.inter.getBindedInter().side!==n){let P=_.inter.getBindedInter().side;if(P===n.nextSide)x={state:Lc(n,P,a.nextSide,!0,r)?1:0,inter:i};else if(P===n.prevSide){if(x={state:Lc(P,n,a.nextSide,!0,r)?1:0,inter:_.inter},_.state===x.state&&t!==_.inter){let L=et(c,t.coord),F=et(a.nextSide.getShape(),t.coord),V=et(P.getShape(),t.coord);return S(C,L.add(F).dot(V)>0,_.inter,x.inter)}}else x=qi(n,a.nextSide,i,r,l,u,new Map)}else x=qi(n,a.nextSide,i,r,l,u,new Map);if(_.state!==x.state)return w(_,x),1;let D=et(c,t.coord),I=et(a.nextSide.getShape(),t.coord);if(la(D.dot(I),-1)){let P=gr(a,a.nextSide,!0,r);return S(C,_.state!==qi(a.nextSide,n,t,r,l,!0,new Map,P?!C:C,!1).state,_.inter,x.inter)}else{let P=et(o,t.coord);return S(C,D.add(I).dot(P)>0,_.inter,x.inter)}}if(!(o instanceof We||c instanceof We))return 1;let h=et(o,t.coord),p=et(c,t.coord),d,f;if(c instanceof ce)d=new ce(t.coord,c.start()),f=new ce(t.coord,c.end());else if(c instanceof Te){let _=t.coord.angleD(c.center);d=Te.build2(c.center,_,c.startAngle,c.rx,c.ry,c.isCCW?0:1),f=Te.build2(c.center,_,c.endAngle(),c.rx,c.ry,c.isCCW?1:0)}else if(c instanceof We){let _=c.getPercent(t.coord,tt);[d,f]=c.clip(_),d=d.reverse()}else throw new Error("not support");let m=h.dot(p)>0,g,b;m?(g=Xr(o.reverse(),d).state,b=Xr(o,f).state):(g=Xr(o,d).state,b=Xr(o.reverse(),f).state);let E;g===0?E=qi(m?n.prevSide:n.nextSide,a,i,r,l,u,new Map,!0,!1,m):g===1?E=qi(n,a.prevSide,i,r,l,u,new Map,!0,!0,m):g===2?m?E=Ma(n.prevSide,n,a.prevSide,i,l,u,r,!0):E=Ma(n,n.nextSide,a.prevSide,i,l,u,r,!0):m?g===3?E={inter:i,state:0}:E={inter:i,state:1}:g===3?E={inter:i,state:1}:E={inter:i,state:0};let y=E.state!==0;if(E.state===2)return S(y,m);let T;if(b===0?T=qi(m?n.nextSide:n.prevSide,a,i,r,l,u,new Map,!1,!1,!m):b===1?T=qi(n,a.nextSide,i,r,l,u,new Map,!1,!0,!m):b===2?m?T=Ma(n,n.nextSide,a.nextSide,i,l,u,r,!1):T=Ma(n.prevSide,n,a.nextSide,i,l,u,r,!1):m?b===3?T={inter:i,state:1}:T={inter:i,state:0}:b===3?T={inter:i,state:0}:T={inter:i,state:1},E.state===T.state)return E.inter===T.inter?(t.setIsInvalid(),0):S(y,m,E.inter,T.inter);return w(E,T),1;function w(_,C){let x=_.state!==0;if(_.inter===C.inter){t.setOutToIn(x);return}else Vl(_.inter,C.inter,!0),Vl(C.inter,_.inter,!1);let D=[];if(e===-1){let P=et(o,t.coord),L=et(n.nextSide.getShape(),t.coord),F=et(c,t.coord),V=et(a.nextSide.getShape(),t.coord);D.push(P.dot(F)),D.push(P.dot(V)),D.push(L.dot(F)),D.push(L.dot(V))}else{let P=et(o,t.coord);D.push(et(c,t.coord).dot(P)),D.push(et(a.nextSide.getShape(),t.coord).dot(P))}if(D.reduce((P,L)=>Math.abs(P)>Math.abs(L)?P:L,0)>0)if(s===1||s===0||s===2||s===3)t.setOutToIn(x);else throw new Error("not support");else if(s===1)I(!x);else if(s===0||s===2||s===3)I(x);else throw new Error("not support");function I(P){t.setIsInvalid();let L=(P?_:C).inter;delete L.isInvalid,delete L.getBindedInter().isInvalid,L.setOutToIn(!x)}}function S(_,C,x,D){if(x===D){if(t.side.outline.inters.find(L=>!L.isInvalid&&L!==t&&Ze(L.coord,t.coord)))return t.setIsInvalid(),0;let I=new Fa(t.coord,n,r),P=new Fa(t.coord,a,r);return I.bind(P),C?n.inters.splice(t.getIndex(),0,I):n.inters.splice(t.getIndex()+1,0,I),a.inters.splice(t.getBindedInter().getIndex(),0,P),I.setOutToIn(_),t.setOutToIn(!_),I.isDealed(),n.inters.forEach((L,F)=>L.setIndex(F)),a.inters.forEach((L,F)=>L.setIndex(F)),2}else{let I=function(){let P=x.getBindedInter(),L=D.getBindedInter();delete x.isInvalid,delete P.isInvalid,delete D.isInvalid,delete L.isInvalid,x.setOutToIn(!_),D.setOutToIn(_),Vl(x,D,!0),Vl(D,x,!1),Vl(P,L,C),Vl(L,P,!C)};if(t.setIsInvalid(),C){if(s===1||s===0||s===2||s===3)return I(),2;throw new Error("not support")}else{if(s===1)return _?0:(I(),2);if(s===0||s===2||s===3)return _?(I(),2):0;throw new Error("not support")}}}}function Vl(e,t,s){let{judge:r,changeNum:i}=a(),n=e.getIndex();for(let o=n+i,c=e.side.inters;r(o);o+=i){if(c[o].isInvalid)continue;if(!Ze(c[o].coord,e.coord))break;c[o].setIndex(n),c[n].setIndex(o);let l=c[o];c[o]=c[n],c[n]=l,n=o}function a(){let o=e.side===t.side;if(s){let c=o?t.getIndex():e.side.inters.length;return{judge:l=>l<c,changeNum:1}}else{let c=o?t.getIndex()+1:0;return{judge:l=>l>=c,changeNum:-1}}}}var Kw=0,Fa=class{constructor(e,t,s){this.id=Kw++,this.coord=e,this.side=t,s&&(this.id=Kw++,this.drawDebug=s);let r=new Ti;r.ext2(e),this._bbox=r.build1()}bbox(){return this._bbox}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(e){this.outToIn=e,this.bindedInter.outToIn=!e}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(e){this.bindedInter=e,e.bindedInter=this}setIndex(e){this.index=e}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let e=this.getIndex(),t=this.side.getStart();return e&&(t=this.side.inters[e-1].coord),t}getTangent(){let e=this.side.getShape();if(e instanceof ce)return e.end().sub(e.start());if(e instanceof Te){let t=this.coord.angle(e.center);return e.isCCW?t+=bm:t-=bm,new he(Math.cos(t),Math.sin(t))}else{if(e instanceof We)return Jh(e,e.getPercent(this.coord,tt));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let e=[],t=this,s;if(this.drawDebug){h1++;let r=h1===-1,i=this.drawDebug.initColor(Rt.RED);if(r){this.drawDebug.draw();debugger}s=n=>{if(e.push(n),r){i.addPt(e[e.length-1]),this.drawDebug.draw();debugger}}}else s=r=>e.push(r);for(;!t.visited;){let r=function(o,c){if(Se.eq(o.distance2(c),0))return;let l=cd.rebuild(n.getShape(),o,c);if(!l)return!0;s(l)};t.visit();let i=t.getIndex(),n=t.side,a=n.inters[i+1];for(;a!=null&&a.isInvalid;)a=n.inters[a.getIndex()+1];if(a)r(t.coord,a.coord),t=a.bindedInter;else{let o=r(t.coord,n.getEnd()),c=t.coord;for(n=n.nextSide,t=null;;){for(let l of n.inters)if(!l.isInvalid){t=l.bindedInter;break}if(t)break;o?(r(c,n.getEnd()),o=!1):s(n.getShape()),n=n.nextSide}o?(Se.eq(c.distance2(t.coord),0)?r(c,n.getEnd()):r(c,t.coord),o=!1):Se.eq(n.getEnd().distance2(t.coord),0)?s(n.getShape()):r(n.getStart(),t.coord)}}if(t!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:h1,handleId:Dm,boolId:Mh})),new Error("inter !== this");return Mo(Et.build7(e))}},h1=0,d1=class R1{constructor(t,s,r,i,n){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=t,this.isGroup1=r,this.isOutside=i,this.finalIsOutside=i,this.polyline=s,n&&(this.polygon=n),t.forEach(a=>a.outline=this)}static build(t,s,r,i,n){let a=t.primitives.map(c=>new cd(c,i)),o=a[a.length-1];return a.forEach(c=>{o.connect(c),o=c}),n?new R1(a,t,s,r,n):new R1(a,t,s,r)}setFinalIsOutSide(t){this.finalIsOutside=t}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(t,s){if(!(t.interOutlines&&t.interOutlines===this.interOutlines))if(t.interOutlines)if(this.interOutlines){let r,i;this.interOutlines.length>t.interOutlines.length?(r=this.interOutlines,i=t.interOutlines):(r=t.interOutlines,i=this.interOutlines),i.forEach(n=>{r.push(n),n.interOutlines=r}),s.delete(i)}else t.interOutlines.push(this),this.interOutlines=t.interOutlines;else this.interOutlines?(this.interOutlines.push(t),t.interOutlines=this.interOutlines):(t.interOutlines=this.interOutlines=[this,t],s.add(this.interOutlines))}isContain(t){if(!this.polyline.bbox().extendOfSize(tt).isContainsBBox(t.polyline.bbox()))return!1;let s=t.polyline.primitives[0].start();if(t.hasInter&&t.isAllInterIsInvalid()){let r=t.inters[0];r.getBindedInter().side.outline!==this?s=r.side.getCenterPoint():s=r.side.getCenterPoint(r.coord)}return!!this.polyline.getWindingNum(s)}isInternally(t){return!!this.polyline.getWindingNum(t)}isEqual(t){return this.polyline===t.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let t=this.sides[this.sides.length-1];this.sides.forEach(s=>{s.reverse(),t.connect(s),t=s})}returnPolyline(){let t=this.sides.map(r=>r.getShape()),s=this.polyline.primitives;if(this.sides.length===s.length){let r=new Set(s);if(!t.some(i=>!r.has(i)))return this.polyline}return Et.build7(t)}};function Xw(e,t,s){let r=[];return e.forEach(i=>i.forEach(n=>{if(n.hasInter&&!n.isAllInterIsInvalid())return;let a=n.bbox(),o=t.search(a.extendOfSize(tt)).filter(c=>c.bbox().extendOfSize(tt).isContainsBBox(a)).sort((c,l)=>c.bbox().area()-l.bbox().area());for(let c of o)if(c.isContain(n)){let l=s(!n.isOutside,c.isOutside),u=s(n.isOutside,c.isOutside);l!==u&&(r.push(n),n.setFinalIsOutSide(!l));return}s(n.isOutside,!1)!==s(!n.isOutside,!1)&&r.push(n)})),r}function VL(e,t,s){let r;switch(s){case 0:r=(o,c)=>o&&c;break;case 1:r=(o,c)=>o||c;break;case 2:r=(o,c)=>o&&!c;break;case 3:r=(o,c)=>o&&!c||!o&&c;break;default:throw Error("not support the rule")}let i=new Kh(10),n=new Kh(10);e.forEach(o=>o.forEach(c=>i.add(c))),t.forEach(o=>o.forEach(c=>n.add(c)));let a=Xw(e,n,r);return Xw(t,i,(o,c)=>r(c,o)).forEach(o=>a.push(o)),a}var zL=class{constructor(e){this.roots=[],this.nodes=e.sort((t,s)=>t.bbox().minX-s.bbox().minX).map(t=>new WL(t)),this.nodes.forEach((t,s)=>{t.visit()&&(this.roots.push(t),this.build(s))})}build(e){let t=this.nodes[e];for(let s=e+1,r=this.nodes.length;s<r;s++){let i=this.nodes[s];if(t.key.bbox().maxX<i.key.bbox().minX)break;i.getIsVisit()||t.isContain(i)&&(i.visit(),t.addChild(i),this.build(s))}}getPolygons(){let e=[];return this.roots.forEach(t=>t.getPolygons().forEach(s=>e.push(s))),e}},WL=class{constructor(e){this.children=[],this.isVisit=!1,this.key=e}getIsVisit(){return this.isVisit}isContain(e){return this.key.isContain(e.key)}addChild(e){this.children.push(e)}getPolygons(){let e=[];return this.getPolylineList(e),e.map(t=>{let s=t[0].polygon;if(s&&s.items.length===t.length){let r=t.map(n=>n.returnPolyline()),i=new Set(s.items);return r.some(n=>!i.has(n))?new cr(r):s}else return new cr(t.map(r=>r.returnPolyline()))})}getPolylineList(e,t){t?(t.push(this.key),t=null):(t=[this.key],e.push(t)),this.children.forEach(s=>s.getPolylineList(e,t))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function Zw(e){let t="";return e.items.forEach((s,r)=>{let i="$";if(s.items.forEach((n,a)=>{let o="[";if(n.primitives.forEach((c,l)=>{let u="";if(c instanceof ce)u=`Line,${c.start().x},${c.start().y},${c.end().x},${c.end().y}`;else if(c instanceof Te)u=`Arc,${c.center.x},${c.center.y},${c.startAngle},${c.sweepAngle},${c.rx}`;else if(c instanceof We)u=`Bezier,${c.controls.map(h=>`${h.x},${h.y}`).join(",")}`;else throw new Error("not supported");if(l===n.primitives.length-1){o+=`${u}]`;return}o+=`${u},`}),a===s.items.length-1){i+=`${o}$`;return}i+=`${o}_`}),r===e.items.length-1){t+=`${i}`;return}t+=`${i}^`}),console.log(t),t}function $w(e){let t=e.split("^"),s=[];return t.forEach(i=>{let n=/\$(.*?)\$/,a=i.match(n)[1].split("_"),o=[];a.forEach(l=>{let u=/\[(.*?)\]/,h=l.match(u)[1].split(","),p=[],d=[];for(let m=0;m<h.length;m++){let g=h[m];if(g==="Line"||g==="Arc"||g==="Bezier"){if(p.length){let b=r(p);d.push(b),p.length=0}p.push(g);continue}p.push(Number(g))}p.length&&(d.push(r(p)),p.length=0);let f=Et.build7(d);o.push(f)});let c=new cr(o);s.push(c)}),new Fs(s);function r(i){let n=i[0];if(n==="Line")return new ce(new he(i[1],i[2]),new he(i[3],i[4]));if(n==="Arc")return Te.build3(new he(i[1],i[2]),i[3],i[4],i[5],i[5]);if(n==="Bezier"){let a=[];for(let o=1;o<i.length;o+=2)a.push(new he(i[o],i[o+1]));return new We(a)}else throw new Error("not support")}}var qL=class{constructor(e=1){this.group1Str="$[Line,20193.777980000017,4122.200439600661,20193.77082,4211.848760073709,Arc,20193.972672902382,4211.8487570980205,179.99915535323618,-89.99540000050294,0.2018529024026465,Line,20193.972659672283,4212.050609999989,20193.972660393258,4212.039610000013,Arc,20193.97217289501,4211.848257065248,89.85403133887164,89.99540000041924,0.19135355574930143,Line,20193.78082,4211.848759926291,20193.78897999998,4122.200440479205,Line,20193.78897999998,4122.200440479205,20193.777980000017,4122.200439600661]$",this.group2Str="$[Arc,20209.72784128151,4122.2007625157785,258.46768032837986,-75.66780748375947,4.138846238512183,Line,20205.593935808283,4121.998590004101,20193.97982992629,4121.998600000001,Arc,20193.97983290198,4122.2004529023825,269.9991553532362,-89.99540000050297,0.20185290240401074,Arc,20193.782979999996,4122.20044,180.00375535340328,-180.0000000000027,0.004999999999025513,Arc,20193.979332869207,4122.200952909754,180.15347936671733,89.99540000008247,0.19135355575111057,Line,20193.97983008845,4122.009599999999,20205.603694309226,4122.003828485546,Arc,20209.733142304296,4122.194577876843,182.64475341258483,75.73379999998886,4.133851239977064,Line,20208.900400396684,4118.145470939558,20208.902599535475,4118.156248870184,Arc,20206.972515961093,4108.700057667588,78.46393309088245,-78.46759999998636,9.65115405866796,Arc,20216.618669999996,4108.69944,359.99996825446135,-180,0.004999999999200412,Arc,20206.973015966745,4108.699445349495,359.99996822365375,78.46759999998409,9.640654033253735]$^$[Line,20193.997796883676,4095.399470032799,20205.596133314026,4095.4013992171836,Arc,20209.72470159858,4095.1923799234505,177.10172964919312,-75.64935037184974,4.133855965730166,Arc,20209.73000213952,4095.198565517174,101.5415133143569,75.7293000000185,4.128850963459707,Line,20205.605834328744,4095.395161923586,20193.997203529463,4095.389485743675,Arc,20193.994588809255,4095.197684525904,89.21896662213764,4.544099999999517,0.19181903946188483,Arc,20193.981499796217,4095.1977402038,89.85034659953621,89.9999999995926,0.19135044893494071,Arc,20193.78515,4095.19824,0,-180,0.005,Arc,20193.98200016982,4095.1982398301675,179.99995179248322,-89.99999999974185,0.20185016982129908,Arc,20193.981986624152,4095.198185381971,89.9961078637802,-4.487285276547311,0.2019046184835962]$",this.rule=e}getGroup1(){return $w(this.group1Str)}getGroup2(){return $w(this.group2Str)}},p1=new Um(2),kh=class{getUnion(e,t=!0){return t&&(e=e.map(s=>this.asSameSweep([s])[0])),xL(hL,e)}asSameSweep(e){let t=0;return e.forEach(s=>t+=s.area(.01)),t>0?e.map(s=>s.reverse()):e}getSubtraction(e,t){let s=new zh(!1),r=new Wh(im.rule,p1,s);for(let i of e){let n=im.weight(0);r.addPolyline(i,n)}for(let i of t){let n=im.weight(1);r.addPolyline(i,n)}return r.simplify(),s.plGrps}getIntersection(e,t){let s=new zh(!1),r=new Wh(nm.rule,p1,s);for(let i of e){let n=nm.weight(0);r.addPolyline(i,n)}for(let i of t){let n=nm.weight(1);r.addPolyline(i,n)}return r.simplify(),s.plGrps}getMutuallyExclusive(e,t){let s=new zh(!1),r=new Wh(am.rule,p1,s);for(let i of e){let n=am.weight(0);r.addPolyline(i,n)}for(let i of t){let n=am.weight(1);r.addPolyline(i,n)}return r.simplify(),s.plGrps}},Mh=0,f1=!1;function jh(e,t,s,r,i){let n=ld(),a=[],o=[],c=[],l=new Set,u;if(i){if(u=new od(i),Mh++,f1){debugger;f1=!1;let T=new qL;jh(T.rule,T.getGroup1(),T.getGroup2(),r,i)}if(Mh===-1||f1){console.table({rule:e,group1:Zw(t),group2:Zw(s)}),u.clear();let T=u.initColor(Rt.GREEN),w=u.initColor(Rt.WHITE),S=u.initColor(Rt.BLUE),_=u.initColor(Rt.Gray);t.items.forEach(C=>C.items.forEach((x,D)=>{D>0?w.addPly(x):T.addPly(x)})),s.items.forEach(C=>C.items.forEach((x,D)=>{D>0?_.addPly(x):S.addPly(x)})),u.draw();debugger}}let h=t.items.length!==0&&s.items.length!==0?t.bbox().extendOfSize(tt).intersection1(s.bbox().extendOfSize(tt)):null;if(h){let T=[],w=[];switch(e){case 0:{for(let S of t.items)S.bbox().isIntersect(h)&&T.push(S);for(let S of s.items)S.bbox().isIntersect(h)&&w.push(S);break}case 1:case 3:{for(let S of t.items)S.bbox().isIntersect(h)?T.push(S):a.push(S);for(let S of s.items)S.bbox().isIntersect(h)?w.push(S):a.push(S);break}case 2:{for(let S of t.items)S.bbox().isIntersect(h)?T.push(S):a.push(S);for(let S of s.items)S.bbox().isIntersect(h)&&w.push(S);break}default:throw new Error("not support")}T.length!==t.items.length&&(t=new Fs(T)),w.length!==s.items.length&&(s=new Fs(w))}else{switch(e){case 0:break;case 1:case 3:{t.items.forEach(T=>a.push(T)),s.items.forEach(T=>a.push(T));break}case 2:{t.items.forEach(T=>a.push(T));break}default:throw new Error("not support")}t=new Fs([]),s=new Fs([])}E(t,o,!0),E(s,c,!1);let p=e===2||e===3?(T,w)=>Ze(T.getEnd(),w)?T.nextSide:T:(T,w)=>Ze(T.prevSide.getEnd(),w)?T.prevSide:T,d=(T,w,S)=>{if(Ze(T.getEnd(),S)){if(T.inters.findIndex(_=>_.getBindedInter().side===w&&Ze(_.coord,T.getEnd()))===-1)return new Fa(S,T,u)}else return new Fa(S,T,u)},f=e===2||e===3?(T,w,S)=>{if(Ze(T.getStart(),S)){if(T.inters.findIndex(_=>_.getBindedInter().side===w&&Ze(_.coord,T.getStart()))===-1)return new Fa(S,T,u)}else return new Fa(S,T,u)}:d;r.seek(t,s,(T,w,S,_,C,x)=>{let D=o[T][w],I=c[_][C],P=D.sides[S],L=I.sides[x],F=cn(P.getShape(),L.getShape());if((P.getShape()instanceof We||L.getShape()instanceof We)&&F>=4){if(P.getShape()instanceof Te||L.getShape()instanceof Te){let B=function(O,R){let v=!1;for(let j=0;j<R.length;j+=2)Ze(new he(R[j],R[j+1]),O)&&(v=!0);v||R.push(O.x,O.y)},k=[ee[0],ee[1]];for(let O=0;O<F;O+=2){let R=new he(ee[O],ee[O+1]);for(let v=O+2;v<F;v+=2){let j=new he(ee[v],ee[v+1]);if(!Ze(R,j)){B(j,k);break}}}F=k.length,k.forEach((O,R)=>ee[R]=O)}else for(let B=F-2;B>=2;B-=2)for(let k=B-2;k>=0;k-=2)if(Ze(new he(ee[B],ee[B+1]),new he(ee[k],ee[k+1]))){ee[k]=(ee[B]+ee[k])/2,ee[k+1]=(ee[B+1]+ee[k+1])/2;for(let O=F-3;O>=B;O--)ee[O]=ee[O+2];F-=2;break}}let V=0;if(F===4){let B=function(R){return Ze(P.getEnd(),R)||Ze(P.prevSide.getEnd(),R)||Ze(L.prevSide.getEnd(),R)||Ze(L.getEnd(),R)},k=new he(ee[0],ee[1]),O=()=>{let R=new Fa(k,P,u),v=new Fa(k,L,u);R.bind(v),R.setIsInvalid(),R.isDealed(),D.inters.push(R),I.inters.push(v)};if(ee[0]===ee[2]&&ee[1]===ee[3])if(B(k))V=2;else{O();return}}for(;V<F;V+=2){let B=new he(ee[V],ee[V+1]),k=P,O=L;if(Ze(k.prevSide.getEnd(),B)&&(k=k.prevSide),O=p(O,B),P!==k&&L!==O){let v=e===2||e===3?L.getEnd():O.getEnd();k.getEnd().distance1(B)<v.distance1(B)?(B=k.getEnd(),Ze(v,B)||(O=L)):(B=v,Ze(k.getEnd(),B)||(k=P))}let R=d(k,O,B);if(R){let v=f(O,k,B);v&&(k.addInter(R),D.inters.push(R),O.addInter(v),I.inters.push(v),R.bind(v),D.intersect(I,l))}}return F},i);let m=y(),g=VL(o,c,e);g.forEach(T=>!T.startAndEndIsSameOutsideFlag()&&T.reverse()),new zL(m.concat(g)).getPolygons().forEach(T=>a.push(T));let b=new Fs(a);if(u){if(Mh===-1){let T=u.initColor(Rt.RED),w=u.initColor(Rt.Golden);a.forEach(S=>{T.addPly(S.items[0]),S.items.slice(1).forEach(_=>w.addPly(_))}),u.draw();debugger;throw new Error}b.id=Mh}return aa.BooleanTools+=vo(n),b;function E(T,w,S){T.items.forEach(_=>{let C=[];C.push(d1.build(_.items[0],S,!0,u,_)),_.items.slice(1).forEach(x=>{C.push(d1.build(x,S,!1,u))}),w.push(C)})}function y(){let T=[];return l.forEach(S=>{e===2||e===3?S.forEach(C=>{C.isGroup1||C.reverse(),C.sides.forEach(x=>x.sortInters())}):S.forEach(C=>C.sides.forEach(x=>x.sortInters())),S.map(C=>C.sides.filter(x=>x.inters.length)).flat(2).sort((C,x)=>{let D=C.inters,I=x.inters,P=Ze(D[D.length-1].coord,C.getEnd()),L=Ze(I[I.length-1].coord,x.getEnd());if(P&&L){let F=0,V=0;for(let B=D.length-2;B>=0&&Ze(D[B].coord,C.getEnd());B--)F++;for(let B=I.length-2;B>=0&&Ze(I[B].coord,x.getEnd());B--)V++;return V-F}else return P?-1:1}).forEach(C=>{C.inters.forEach(x=>{if(x.dealed)return;let D=x.side,I=x.getBindedInter().side,P;Ze(D.getEnd(),x.coord)&&Ze(I.getEnd(),x.coord)?P=-1:Ze(D.getEnd(),x.coord)?(P=1,x=x.getBindedInter()):Ze(I.getEnd(),x.coord)&&(P=1);let L=YL(P,x,e,u);x.isDealed(),L&&(D.outline.setAllInterIsInvalidToFalse(),I.outline.setAllInterIsInvalidToFalse())})}),_(S),e===3&&(S.forEach(C=>{C.reverse(),C.sides.forEach(x=>{x.sortInters(),x.inters.forEach(D=>{D.resetVisitStatus()})})}),_(S));function _(C){C.forEach(x=>{x.inters.forEach(D=>{if(D.isInvalid||D.getVisited())return;let I=D.findStartInter(),P=w(e)?I.run():I.getBindedInter().run(),L=x.polyline.primitives;if(P){if(L.length===P.primitives.length){let F=new Set(L);if(!P.primitives.some(V=>!F.has(V))){T.push(x);return}}T.push(d1.build(P,!0,!0,u))}})})}}),T;function w(S){switch(S){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var qf=/\bstablilizetion\b/.test(self.location.href)||!0,Ih={intersect(e,t,s,r){try{return jh(0,e,t,s,r)}catch(i){if(qf){let n=new kh().getIntersection(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Fs(n.map(a=>new cr(a.items)))}throw i}},union(e,t,s,r){try{return jh(1,e,t,s,r)}catch(i){if(qf){let n=new kh,a=e.items.map(c=>c.items.map(l=>l)).flat(2);t.items.forEach(c=>c.items.forEach(l=>a.push(l)));let o=n.getUnion(a);return new Fs(o.map(c=>new cr(c.items)))}throw i}},diff(e,t,s,r){try{return jh(2,e,t,s,r)}catch(i){if(qf){let n=new kh().getSubtraction(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Fs(n.map(a=>new cr(a.items)))}throw i}},xor(e,t,s,r){try{return jh(3,e,t,s,r)}catch(i){if(qf){let n=new kh().getMutuallyExclusive(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Fs(n.map(a=>new cr(a.items)))}throw i}}},JL=class extends Wh{constructor(e,t,s,r,i,n){super(e.rule,Um.DUMMY,t),this.sideGroup1=[],this.sideGroup2=[],this.group1=s,this.group2=r,this.seeker=i,this.addGroup(s,e.weight(0),this.sideGroup1),this.addGroup(r,e.weight(1),this.sideGroup2),this.bus=n}addGroup(e,t,s){if(!e)debugger;e.items.forEach(r=>{let i=[];r.items.forEach(n=>{let a=this.sides.length;this.addPolyline(n,t),i.push(this.sides.slice(a))}),s.push(i)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(e,t,s,r,i,n)=>{let a=this.sideGroup1[e][t][s],o=this.sideGroup2[r][i][n],c=cn(a.shape,o.shape);for(let l=0;l<c;l+=2){let u=new he(ee[l],ee[l+1]);a.inters.push(u),o.inters.push(u),this.event.onIntersect(u,a,o)}return c},this.bus)}},KL=class extends zh{constructor(e){super(!!e),e&&(this.drawDebug=new od(e),this.blueDrawing=this.drawDebug.initColor(Rt.BLUE),this.greenDrawing=this.drawDebug.initColor(Rt.GREEN),this.redDrawing=this.drawDebug.initColor(Rt.RED))}onOriginSide(e){super.onOriginSide(e),this.debug&&this.blueDrawing.addPt(e.shape)}onPolylineGroup(e,t){super.onPolylineGroup(e,t),this.debug&&e.items.forEach(s=>this.greenDrawing.addPly(s))}draw(){this.drawDebug.draw()}};function Jf(e,t,s,r,i){let n=ld(),a=new KL(i);new JL(e,a,t,s,r,i).simplify();let o=[];a.plGrps.forEach(l=>{let u=l.items.map(h=>Cm(h));u[0]&&o.push(new cr(u.filter(h=>h)))});let c=new Fs(o);return aa.BooleanTools+=vo(n),c}var Kf=!0,xh={intersect(e,t,s,r){try{return Ih.intersect(e,t,s,r)}catch(i){if(Kf)throw i;return console.error(i),Jf(nm,e,t,s,r)}},union(e,t,s,r){try{return Ih.union(e,t,s,r)}catch(i){if(Kf)throw i;return console.error(i),Jf(dL,e,t,s,r)}},diff(e,t,s,r){try{return Ih.diff(e,t,s,r)}catch(i){if(Kf)throw i;return console.error(i),Jf(im,e,t,s,r)}},xor(e,t,s,r){return Ih.xor(e,t,s,r)}};var XL=class{init(e){}seek(e,t,s,r){let i=e.bbox().extendOfSize(5e-6).intersection1(t.bbox().extendOfSize(5e-6));if(!i)return;let n=ld(),a=[];for(let p=0,d=e.items.length;p<d;p++){let f=e.items[p];if(i.isIntersect(f.bbox()))for(let m=0,g=f.items.length;m<g;m++){let b=f.items[m];if(i.isIntersect(b.bbox()))for(let E=0,y=b.primitives.length;E<y;E++){let T=b.primitives[E].bbox();i.isIntersect(T)&&a.push({bbox:T,polygonIndex:p,polylineIndex:m,ptIndex:E})}}}let o=a.length;if(o===0){aa.IntersectionSeeker+=vo(n);return}let c=[];for(let p=0,d=t.items.length;p<d;p++){let f=t.items[p];if(i.isIntersect(f.bbox()))for(let m=0,g=f.items.length;m<g;m++){let b=f.items[m];if(i.isIntersect(b.bbox()))for(let E=0,y=b.primitives.length;E<y;E++){let T=b.primitives[E].bbox();i.isIntersect(T)&&c.push({bbox:T,polygonIndex:p,polylineIndex:m,ptIndex:E})}}}let l=c.length;if(l===0){aa.IntersectionSeeker+=vo(n);return}if(o<5||l<5){for(let p=0,d=a.length;p<d;p++)for(let f=0,m=c.length;f<m;f++)if(a[p].bbox.isIntersect(c[f].bbox.extendOfSize(1e-5))){let g=a[p],b=c[f];s(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}aa.IntersectionSeeker+=vo(n);return}a.sort((p,d)=>p.bbox.minX-d.bbox.minX),c.sort((p,d)=>p.bbox.minX-d.bbox.minX);let u=0,h=0;for(;u<o&&h<l;)if(a[u].bbox.minX<c[h].bbox.minX){let p=a[u],d=p.bbox;for(let f=h;f<l;f++){let m=c[f],g=m.bbox;if(g.minX>d.maxX+1e-5)break;(d.minY<g.minY?g.minY:d.minY)<(d.maxY<g.maxY?d.maxY:g.maxY)+1e-5&&s(p.polygonIndex,p.polylineIndex,p.ptIndex,m.polygonIndex,m.polylineIndex,m.ptIndex)}u++}else{let p=c[h],d=p.bbox;for(let f=u;f<o;f++){let m=a[f],g=m.bbox;if(g.minX>d.maxX+1e-5)break;(g.minY<d.minY?d.minY:g.minY)<(g.maxY<d.maxY?g.maxY:d.maxY)+1e-5&&s(m.polygonIndex,m.polylineIndex,m.ptIndex,p.polygonIndex,p.polylineIndex,p.ptIndex)}h++}aa.IntersectionSeeker+=vo(n)}},Ar,Nr=(Ar=class{static getDebug(){return Ar.drawDebug||(Ar.drawDebug=new od(Ar.curBus)),Ar.drawDebug}static getDrawing(t=Rt.GREEN){return this.getDebug().initColor(t)}static clearDrawing(){Ar.getDebug().clear()}static drawText(t,s,r=Rt.GREEN){Ar.getDrawing(r).addText(t,s,1.5,.1,!0)}static drawBBox(t,s=Rt.GREEN){if(!t)return;let r=Ar.getDrawing(s),i=new ce(t.UL(),t.UR()),n=new ce(t.UR(),t.LR()),a=new ce(t.LR(),t.LL()),o=new ce(t.LL(),t.UL());r.addPt(i),r.addPt(n),r.addPt(a),r.addPt(o)}static drawPolyType(t,s){let r=Ar.getDrawing(s);if(t instanceof Et)r.addPly(t);else if(t instanceof cr)for(let i of t.items)i instanceof Et?r.addPly(i):this.drawPolyType(i,s);else if(t instanceof Fs)for(let i of t.items)this.drawPolyType(i,s)}static translate(t){switch(t){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}},Ar.UseRunArrange=!0,Ar.UseOptimizeSplit=!0,Ar.LocalBestThread=4,Ar.HandleDiff=!0,Ar.OcTreeSplitStep=4,Ar.PrintStart=new he(150,-200),Ar),vh=class N1{static getPolyTypeLine(t){let s=[];if(t instanceof Et)for(let r of t.primitives)s.push(r);else if(t instanceof cr)for(let r of t.items)if(r instanceof Et)for(let i of r.primitives)s.push(i);else{let i=this.getPolyTypeLine(r);for(let n of i)s.push(n)}else if(t instanceof Fs)for(let r of t.items){let i=this.getPolyTypeLine(r);for(let n of i)s.push(n)}return s}static getPolyTypePolyLine(t){let s=[];if(t instanceof Et)s.push(t);else if(t instanceof cr)for(let r of t.items)if(r instanceof Et)s.push(r);else{let i=this.getPolyTypePolyLine(r);for(let n of i)s.push(n)}else if(t instanceof Fs)for(let r of t.items){let i=this.getPolyTypePolyLine(r);for(let n of i)s.push(n)}return s}static getListBBox(t){if(t.length<=0)return;let s=new Ti;for(let r of t){let i=N1.getSingleBBox(r);s.ext1(i)}return s.build1()}static getSingleBBox(t){if(t instanceof Array){let s=new Ti,r=N1.getListBBox(t.slice(1));return s.ext1(r),s.build1()}else return t.bbox()}static doDrawRule(t,s=Nr.PrintStart){if(t.length<2)return[s,s,s];let r=5,i=10,n=t[0],a=Nr.translate(n),o=[],c=s.y,l=s.x,u=s.x;s=s.add(new he(0,-i));for(let d=1;d<t.length;d++){let f=t[d];if(f instanceof Array){s=s.add(new he(r,0));let m=this.doDrawRule(f,s);o.push(m[0]),m[1].x<=l&&(l=m[1].x),m[2].x>=u&&(u=m[2].x),s=new he(m[2].x+r,s.y)}else o.push(s.clone()),s.x<=l&&(l=s.x),s.x>=u&&(u=s.x),Nr.drawText(s,f.name),s=s.add(new he(r,0))}let h=0;for(let d of o)h+=d.x;let p=new he(h/o.length,s.y+i);Nr.drawText(p,"N:"+a);for(let d of o){let f=new ce(d,p),m=new Array;m.push(f);let g=Et.build1(A1(m));Nr.drawPolyType(g,Rt.GREEN)}return[p,new he(l,c),new he(u,c)]}static drawRule(t,s=Nr.PrintStart,r=!1,i){Nr.clearDrawing(),this.doDrawRule(t,s),r&&this.doDrawRulePolygon(t,i),Nr.getDebug().draw()}static doDrawRulePolygon(t,s){let r=t[0];for(let i=1;i<t.length;i++){let n=t[i];if(n instanceof Array)this.doDrawRulePolygon(n,s);else{let a=s;r===2&&i===1&&(a=Rt.RED),n.name&&Nr.drawText(n.bbox().UL(),n.name,a),Nr.drawPolyType(n,a)}}}static IsCenterBBoxPointInPolygonType(t,s){let r=t.center();for(let i of s.items)if(i.getOutMostPolyline().getWindingNum(r))return!0;return!1}static KeepBBoxPolygonGroup(t,s){let r=s.bbox().intersection1(t);if(!r)return!1;for(let i of s.items)if(i.bbox().isIntersect(r)){for(let n of i.items)if(n.bbox().isIntersect(r)){for(let a of n.primitives)if(r.isIntersect(a.bbox()))return!0}}return!!this.IsCenterBBoxPointInPolygonType(t,s)}},ZL=class Kl{static createNode(t,s,r){let i=t.UL(),n=t.width()/s,a=t.height()/s,o=~~(r/s),c=r-o*s,l=i.x+c*n,u=i.y-(o+1)*a,h=l+n,p=u+a;return new Jr(l,h,u,p)}static ocTreeSplitNode(t,s,r,i,n=2){if(t.length<=r)return t;let a=[],o=n**2,c=new Array(o),l=new Array(o);for(let d=0;d<o;d++)c[d]=new Array(t.length),l[d]=0;let u=s.UL(),h=s.width()/n,p=s.height()/n;for(let d of t){let f=i(d).center(),m=~~((f.x-u.x)/h),g=~~((u.y-f.y)/p)*n+m;try{c[g][l[g]]=d,l[g]+=1}catch{a.push(d)}}for(let d=0;d<c.length;d++){let f=l[d];if(f<=0)continue;let m=c[d].slice(0,f);if(m.length===t.length)return t;let g=Kl.createNode(s,n,d),b=Kl.ocTreeSplitNode(m,g,r,i,n);if(b.length===t.length)return t;a.push(b)}return a}static ocTreeSplitNodeMinIntersect(t,s,r,i){let n=[];if(t.length<=r)return t;let a=3,o=s.LL(),c=s.UR(),l=s.width()/(a+1),u=s.height()/(a+1),h=-(2**32),p=[],d=[];for(let f=1;f<=a;f++)for(let m=1;m<=a;m++){let g=o.x+l*f,b=o.y+u*m,E=[[],[],[],[]],y=new Array(4),T=new Array(4);T[0]=new Jr(o.x,g,b,c.y),T[1]=new Jr(g,c.x,b,c.y),T[2]=new Jr(o.x,g,o.y,b),T[3]=new Jr(g,c.x,o.y,b);for(let C of t){let x=i(C).center(),D=-1,I=-1;x.x===g?D=Math.random()>=.5?1:-1:x.x>g?D=1:x.x<g&&(D=-1),x.y===b?I=Math.random()>=.5?1:-1:x.y>b?I=1:x.y<b&&(I=-1),D===1&&I===1?E[1].push(C):D===1&&I===-1?E[3].push(C):D===-1&&I===-1?E[2].push(C):D===-1&&I===1&&E[0].push(C)}for(let C=0;C<4;C++){let x=E[C];if(x.length<=0)continue;let D=new Ti;for(let I of x)D.ext1(i(I));y[C]=D.build1()}let w=0,S=0;for(let C of y)C&&(w+=C.area());S=w;let _=(C,x)=>{if(!y[C]||!y[x])return 0;let D=y[C].intersection1(y[x]);return D?D.area():0};S-=_(0,1),S-=_(0,2),S-=_(0,3),S-=_(1,2),S-=_(1,3),S-=_(2,3),S/w>=h&&(p=E,d=T)}for(let f=0;f<p.length;f++){let m=p[f];if(m.length<=0)continue;let g=d[f],b;if(m.length===t.length?b=Kl.ocTreeSplitNode(m,g,r,i):b=Kl.ocTreeSplitNodeMinIntersect(m,g,r,i),b.length===t.length)return t;n.push(b)}return n}static ocTreeSplit(t,s,r,i){return Kl.ocTreeSplitNode(t,s,r,i,Nr.OcTreeSplitStep)}},$L=class Z2{static simplifyRules(t,s){return Nr.UseOptimizeSplit&&(t=this.optimizeSplit(t,s)),t}static OcTreeOptimizeSplit(t){let s=t[0];if(s!==1||t.length<=Nr.LocalBestThread+1)return t;let r=t.slice(1),i=new Array(r.length);for(let l=1;l<t.length;l++)i[l-1]=l;let n=vh.getListBBox(r),a=ZL.ocTreeSplit(i,n,Nr.LocalBestThread,l=>{let u=t[l];return vh.getSingleBBox(u)}),o=(l,u)=>{if(!(l.length<=0))for(let h of l)if(Array.isArray(h)){let p=[u[0]];o(h,p),u.push(p)}else{let p=t[h];u.push(p)}},c=[s];return o(a,c),c}static optimizeSplit(t,s){let r=t[0];if(r===2){if(Nr.HandleDiff){let n=t[1],a;if(Array.isArray(n)){let o=this.optimizeSplit(n,s);if(o.length<=1)return[2];a=L1(o,s)}else a=L1([2,n],s);if(t.length>3){let o;o=[1];for(let c=2;c<t.length;c++){let l=t[c];if(Array.isArray(l)){let u=vh.getListBBox([...l.slice(1)]);vh.KeepBBoxPolygonGroup(u,a)&&o.push(l)}else vh.KeepBBoxPolygonGroup(l.bbox(),a)&&o.push(l)}return o.length<=1?[2,a]:(o=this.optimizeSplit(o,s),o.length>1?[2,a,...o.slice(1)]:[2,a])}else{let o=t[2];if(Array.isArray(o)&&o[0]===1&&o.length>2){let c=o.slice(1);return this.optimizeSplit([2,a,...c],s)}}}else if(t.slice(1).length>2){let n=t[1],a=t.slice(2),o=this.optimizeSplit([1,...a],s);return o.length>1?[2,n,...o.slice(1)]:n}}else if(r===1){if(t.length-1>Nr.LocalBestThread){let n=!1;for(let a=1;a<t.length;a++){let o=t[a];if(!Array.isArray(o)){n=!0;break}}n&&(t=Z2.OcTreeOptimizeSplit(t))}}else if(r===0&&t.length<=2)return[0];let i=[r];for(let n=1;n<t.length;n++){let a=t[n];if(Array.isArray(a)){let o=this.optimizeSplit(a,s);if(o.length<=1)continue;i.push(o)}else i.push(a)}return i}},QL=(e=>(e[e.INTERSECT=0]="INTERSECT",e[e.UNION=1]="UNION",e[e.DIFF=2]="DIFF",e[e.XOR=3]="XOR",e))(QL||{});function Fh(e){let t=e[0],s=[t];switch(t){case 0:for(let i=1;i<e.length;i++){let n=e[i];if(Array.isArray(n)&&(n=Fh(n),!n))return null;s.push(n)}break;case 1:case 3:for(let i=1;i<e.length;i++){let n=e[i];Array.isArray(n)&&(n=Fh(n),!n)||s.push(n)}break;case 2:let r=e[1];if(Array.isArray(r)&&(r=Fh(r)),!r)return null;s.push(r);for(let i=2;i<e.length;i++){let n=e[i];Array.isArray(n)&&(n=Fh(n),!n)||s.push(n)}break;default:throw new Error("not support boolean rule!")}return s.length===1?null:s}function m1(e,t,s){return Array.isArray(e)?$2(e,t,s):e}function g1(e,t,s,r,i=!0){if(i)for(;e.length>1;){let n,a=[];for(e.length%2===1?(a.push(e[0]),n=1):n=0;n<e.length;n+=2)a.push(t(e[n],e[n+1],s,r));e=a}else for(;e.length>1;){if(e.length===2)return t(e[0],e[1],s,r);e=[t(e[0],e[1],s,r),...e.slice(2)]}return e[0]}function $2(e,t,s,r=!0){let i=new Array(e.length-1);for(let n=1;n<e.length;n++)i[n-1]=m1(e[n],t,s);switch(e[0]){case 0:return g1(i,xh.intersect,t,s);case 1:return g1(i,xh.union,t,s);case 2:let n=g1(i.slice(1),xh.union,t,s);return n?xh.diff(i[0],n,t,s):i[0];case 3:let a=m1(e[1],t,s);for(let o=2;o<e.length;o++)a=xh.xor(a,m1(e[o],t,s),t,s);return a;default:throw new Error("not support boolean rule! "+e[0])}}function Q2(e){let t=[e[0]];for(let s=1;s<e.length;s++){let r=e[s];if(Array.isArray(r)){let i=Q2(r);Array.isArray(i)?i.length>1&&t.push(i):t.push(i)}else{let i=Cm(r);i!==null&&t.push(Fs.build(i))}}return t}function e4(e,t){Nr.curBus=t,e=Q2(e);let s;return Nr.UseRunArrange?s=$L.simplifyRules(e,t):s=Fh(e),s.length<=1?new Fs([]):L1(s,t)}function L1(e,t,s=!0){if(!e||e.length===1)return new Fs([]);let r=e,i=new XL,n=[];function a(o){for(let c=1;c<o.length;c++){let l=o[c];Array.isArray(l)?a(l):n.push(l)}}return a(r),i.init(n),$2(r,i,t,s)}var Xf=new Error("list is empty"),Zf=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},t4=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},s4=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},r4=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Xf;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Xf;return this.remove(e),e.item}addLast(e){if(this.first===null||this.last===null){let t=new Zf(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Zf(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Xf;return this.first.item}getLast(){if(this.last===null)throw Xf;return this.last.item}insertAfter(e,t){let s=new Zf(this,t);return e.insertAfter(s),e===this.last&&(this.last=s),this.cnt++,s}insertBefore(e,t){let s=new Zf(this,t);return e.insertBefore(s),e===this.first&&(this.first=s),this.cnt++,s}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new t4(this.first)}listIterator(){return new s4(this.first)}toArray(){let e=new Array,t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e}},cm=class{constructor(e){this.inters=[],e&&(this.inters=e)}addInter(e){this.inters.push(e),e.group=this}findInter(e){let t=this.inters.find(s=>Ze(s.coord,e.coord));return t&&this.inters.find(s=>s.side===e.side)&&e.visitSelf(),t}getOutInter(e){let t=this.inters.filter(s=>!s.getVisited());if(t.length!==0)return t.length===1?t[0]:t.reduce((s,r)=>{if(!s||s.side.getShape()===e)return r;if(r.side.getShape()===e)return s;let i=s.coord,n=et(e,i),a=et(s.side.getShape(),i),o=et(r.side.getShape(),i);return n.dot(a)>n.dot(o)?s:r},void 0)}getEntryInter(){}},y1=0;function eS(e,t){let s=e.primitives[0];if(e.primitives.length===1&&s instanceof Te&&Math.abs(s.sweepAngle)===360)return[e];let r=ld();y1++;let i,n=d4(e);if(n.length===0)return[];let a=a4(n);if(y1===-1){i=new od(t);let u=i.initColor(Rt.BLUE);n.forEach(p=>u.addPt(p.getShape()));let h=i.initColor(Rt.GREEN);a.forEach(p=>h.addPoint(p.coord)),i.draw();debugger;throw new Error}if(a.length===0)return[Et.build7(n.map(u=>u.getShape()))];o4(a);let o=[],c=!1;try{u4(a,i)}catch(u){u.customType==="IS_OVERLAP"?(c=!0,o=new kh().getUnion([e]).map(h=>h.items).flat(2)):console.error(u)}if(c)return o;let l=l4(a);if(!l.length)return[Et.build7(n.map(u=>u.getShape()))];if(o=i4(l,i),o.length===0)return console.warn("=====deSelfIntersection=====",y1),[];if(i)throw o.forEach(u=>{i.initColor(Rt.WHITE).addPly(u),i.draw();debugger}),new Error;return aa.deSelfIntersection+=vo(r),o}function i4(e,t){let s=[];return e.forEach(r=>{let i=r;r.inters.forEach(n=>{if(n.getVisited())return;let a=[],o=[],c;if(t){debugger;let u=t.initColor(Rt.RED);c=h=>{a.push(h),u.addPt(a[a.length-1]),t.draw();debugger}}else c=u=>a.push(u);do{let u=function(m,g){Se.eq(m.distance2(g),0)||c(tS(d.getShape(),m,g))},h=o.findIndex(m=>m===n.group);if(h!==-1){let m=a.findIndex(E=>E===n.group),g=a.splice(m).filter(E=>!(E instanceof cm));if(g.length){let E=Mo(Et.build7(g));E&&s.push(E)}let b=a.filter(E=>!(E instanceof cm));if(n=o[h].getOutInter(b[b.length-1]),o.splice(h),!n)throw Error("interGroup not hav inter!!!2");continue}n.visitSelf(),o.push(n.group),a.push(n.group);let p=n.getIndex(),d=n.side,f=d.inters[p+1];for(;f!=null&&f.isInvalid||f&&f.group===n.group;)f=d.inters[f.getIndex()+1];if(f){u(n.coord,f.coord);let m=f.getBindedInter();if(n=m.getVisited()?m.group.getOutInter(m.side.getShape()):m,!n){if(f.group===i)break;throw new Error("interGroup not hav inter!!!3")}}else{for(u(n.coord,d.getEnd()),d=d.nextSide,n=null;;){for(let m of d.inters)if(!m.isInvalid){let g=m.group.getOutInter(d.getShape());if(!g){if(m.group===i){n=m;break}else if(m.getBindedInter().group===i){n=m.getBindedInter();break}continue}n=g;break}if(n)break;c(d.getShape()),d=d.nextSide}Se.eq(d.getEnd().distance2(n.coord),0)?c(d.getShape()):u(d.getStart(),n.coord)}}while(n.group!==i);let l=Mo(Et.build7(a.filter(u=>!(u instanceof cm))));l&&s.push(l)})}),s}function n4(e){return{next(){return e.hasNext()?{value:e.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function a4(e){let t=[],s=new r4;for(let r of e.slice().sort((i,n)=>i.bbox().minY-n.bbox().minY)){for(let i of n4(s.listIterator())){let n=i.item;if(n.bbox().maxY<r.bbox().minY)s.remove(i);else{let a=function(p,d){let f=new Fa(d,p,null);return p.inters.push(f),t.push(f),f},o=function(p,d){let f=p.getEnd(),m=new he(ee[0],ee[1]),g=new he(ee[2],ee[3]),b=f.distance2(m)>f.distance2(g)?m:g,E=p.prevSide;a(Ze(E.getEnd(),b)?E:p,b).bind(a(d,b))},c=n.getShape(),l=r.getShape(),u=cn(c,l),h=u===4&&ee[0]===ee[2]&&ee[1]===ee[3];if(h&&(u-=2),n.nextSide===r)n.prevSide!==r&&u===4&&o(n,r);else if(n.prevSide===r)u===4&&o(r,n);else if(u!==0){let p=function(f,m){let g=f.prevSide;return a(Ze(g.getEnd(),m)?g:f,m)},d=new he(ee[0],ee[1]);if(h&&!Ze(d,n.prevSide.getEnd())&&!Ze(d,r.prevSide.getEnd())&&et(c,d).dot(et(l,d))>0)continue;for(let f=0;f<u;f+=2){let m=new he(ee[f],ee[f+1]);p(n,m).bind(p(r,m))}}}}s.add(r)}return t.forEach(r=>{r.getIndex()===void 0&&r.side.sortInters()}),t}function o4(e){e.forEach(t=>{let s=t.side.getEnd();if(t.isInvalid||!Ze(t.coord,s))return;let r=t.side.inters,i=t.getBindedInter().side;for(let n=r.length-1;n>=0;n--){let a=r[n];if(!Ze(a.coord,s))break;a!==t&&a.getBindedInter().side===i&&a.setIsInvalid()}})}function c4(e){let t=new Kh(10);return e.forEach(s=>{s.isInvalid||t.add(s)}),t}function l4(e){let t=[],s=c4(e);return e.forEach(r=>{if(r.isInvalid||r.group)return;let i=s.search(r.bbox().extendOfSize(Se.eps)).filter(n=>!n.group);if(i.length){let n=new Set,a=new cm(i);i.forEach(o=>{o.group=a,n.has(o.side)&&o.visitSelf(),n.add(o.side)}),t.push(a)}}),t}function u4(e,t){e.forEach(s=>{if(s.isInvalid||s.dealed)return;let r=s.side,i=s.getBindedInter().side,n;Ze(r.getEnd(),s.coord)&&Ze(i.getEnd(),s.coord)?n=-1:Ze(r.getEnd(),s.coord)?r.nextSide!==i&&(n=1,s=s.getBindedInter()):Ze(i.getEnd(),s.coord)&&i.nextSide!==r&&(n=1),h4(n,s,t),s.isDealed()})}function h4(e,t,s){let r=t.getBindedInter(),i=t.side,n=r.side,a=i.getShape(),o=n.getShape(),c=1,l=!1;if(e===-1){if(Gl(a.reverse(),o.reverse())||Gl(i.nextSide.getShape(),n.nextSide.getShape())){let h=Ma(i,i.nextSide,n,r,c,l,s);if(h.state===2){let d=new Error("info1.state === InState.IS_OVERLAP");throw d.customType="IS_OVERLAP",d}let p=Ma(i,i.nextSide,n.nextSide,r,c,l,s);h.state===p.state&&u(h,p)}else if(!(Gl(a.reverse(),n.nextSide.getShape())||Gl(i.nextSide.getShape(),o.reverse()))){let h=u1(i,i.nextSide,n,!1,s);h===u1(i,i.nextSide,n.nextSide,!0,s)&&h!==u1(n,n.nextSide,i.nextSide,!0,s)&&t.setIsInvalid()}}else if(e===1){let h=function(p,d){return et(p,d.start()).dot(et(d,d.start()))>0};if(Gl(a.reverse(),o.reverse())||Gl(a,n.nextSide.getShape())){let p=qi(i,n,r,s,c,l,new Map);if(p.state===2){let f=new Error("info1.state === InState.IS_OVERLAP");throw f.customType="IS_OVERLAP",f}let d=qi(i,n.nextSide,r,s,c,l,new Map);p.state===d.state&&u(p,d)}else if(h(a.reverse(),o.reverse())&&h(a,n.nextSide.getShape())){let p=gr(i,n,!1,s);p===gr(i,n.nextSide,!0,s)&&p!==Lc(n,n.nextSide,new cd(tS(a,t.coord,a.end()),s),!0,s)&&t.setIsInvalid()}}function u(h,p){h.inter.setIsInvalid(),p.inter.setIsInvalid(),t.setIsInvalid()}}function tS(e,t,s){if(e instanceof ce||t.distance2(s)<1e-6)return new ce(t,s);if(e instanceof Te)return Te.build2(e.center,t.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.sweep());if(e instanceof We){let r=e.getPercent(t,tt),i=e.getPercent(s,tt);return e.clip(r)[1].clip((i-r)/(1-r))[0]}else throw new Error("not supported operation")}function d4(e){let t=Mo(e);if(!t)return[];let s=t.primitives.map(i=>new cd(i,null)),r=s[s.length-1];return s.forEach(i=>{r.connect(i),r=i}),s}var Ga,p4=(Ga=class{static clearData(t){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new od(t):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let t=this.drawDebug.initColor(Rt.WHITE);this.originalPrimitive.forEach(s=>t.addPt(s)),this.drawDebug.draw();debugger}for(let t=0;t<this.originalPrimitive.length;t+=1){let s=this.originalPrimitive[t];this.offsetPrimitive.push({index:t,offsetEdge:this.createOffsetEdge(s)})}if(this.drawDebug){let t=this.drawDebug.initColor(Rt.Golden);this.offsetPrimitive.forEach(s=>t.addPt(s.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let t=0;t<this.offsetPrimitive.length;t+=1)if(t===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[0]);let s=this.rawOffsetPrimitive[0],r;s instanceof Te?r=Te.build4(this.offsetPrimitive[0].offsetEdge.start(),s.end(),s.center,s.rx,s.ry,s.sweep()):r=new ce(this.offsetPrimitive[0].offsetEdge.start(),s.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(r)}else this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[t+1]);else this.rawOffsetPrimitive=[]}static createCirclePrimitive(t,s){let r=t.width()*.5,i=t.height()*.5,n=Math.sqrt(r**2+i**2)+s;return[Te.buildCircle(t.center(),n)]}static getExtendPolyLine(t,s,r=!0,i){var o,c;if(!((o=t==null?void 0:t.primitives)!=null&&o.length))return[];let n=Mo(t);if(!((c=n==null?void 0:n.primitives)!=null&&c.length)){if(this.isExpansion){let l=[1],u=s*2;t.primitives.forEach(p=>l.push(p.stroke(u,1,0)));let h=e4(l,i);if(h.items.length!==1)throw new Error("group.items.length !== 1 ");return[h.items[0].items[0]]}return[]}if(t=n,this.clearData(i),this.originalPrimitive=t.primitives,this.isExpansion=s>0,this.offsetDistance=s,this.createRawOffsetEdge(),this.drawDebug){let l=this.drawDebug.initColor(Rt.BLUE);this.rawOffsetPrimitive.forEach(u=>l.addPt(u)),this.drawDebug.draw();debugger}let a=r?this.createClippingEdge(i):[Et.build2(this.rawOffsetPrimitive)];if(this.drawDebug){let l=this.drawDebug.initColor(Rt.RED);a.forEach(u=>l.addPly(u)),this.drawDebug.draw();debugger}if(a.length&&(!this.isExpansion||this.isExpansion&&a.length>1)&&(a=this.getValidityPrimitive(a)),this.drawDebug){let l=this.drawDebug.initColor(Rt.GREEN);a.forEach(u=>l.addPly(u)),this.drawDebug.draw();debugger;throw new Error}return a}static getValidityPrimitive(t){let s=[],r=Math.abs(this.offsetDistance);for(let i=0;i<t.length;i+=1){let n=!0,a=t[i].primitives;e:for(let o=0;o<a.length;o+=1){let c=a[o],l;if(c instanceof Te)l=c.midPoint;else if(c instanceof ce)l=c.start();else throw new Error("not support!");for(let u=0;u<this.originalPrimitive.length;u+=1){let h=this.originalPrimitive[u],p;if(h instanceof Te?p=this.pointArcClosest(l,h):p=J3(l,h.start(),h.end()).d,r-p>.01){n=!1;break e}}}n&&s.push(t[i])}return s}static getInters(t){let s=[];for(let r=0;r<t;r+=2)s.push(new he(ee[r],ee[r+1]));return s}static pointArcClosest(t,s){let r=s.center;if(t.equals1(s.center))return s.rx;if(s.inArea(t,0)){let a=t.sub(r);return Math.abs(a.length()-s.rx)}let i=t.distance2(s.start()),n=t.distance2(s.end());return Se.less(i,n)?Math.sqrt(i):Math.sqrt(n)}static createClippingEdge(t){let s=[],r=[],i=eS(Et.build2(this.rawOffsetPrimitive),t);i.forEach(a=>{let o=a.area(.01);s.push(o)});let n=Math.min(...s.filter(a=>a<0));for(let a=0;a<s.length;a+=1){let o=s[a];Se.eq(o,0)||(!this.isExpansion&&o<0||this.isExpansion&&(o<0&&s[a]===n||o>0))&&r.push(i[a])}return r}static createOffsetEdge(t){if(t instanceof Te)return t.panDistance1(this.offsetDistance);if(t instanceof ce)return t.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(t,s){t.offsetEdge instanceof ce&&s.offsetEdge instanceof ce?this.lineToLineConnect(t,s):t.offsetEdge instanceof Te&&s.offsetEdge instanceof Te?this.arcToArcConnect(t,s):t.offsetEdge instanceof ce&&s.offsetEdge instanceof Te?this.lineToArcConnect(t,s):this.arcToLineConnect(t,s)}static isFalseIntersection(t){return t>1||t<0}static lineToLineConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=s.index,a=this.originalPrimitive[n].start();if(r.isParallel(i))r.bbox().intersection1(i.bbox())?this.rawOffsetPrimitive.push(r):this.lineToLineUseArcToConnect(a,r,i);else{let o=this.getLineToLineT(r,i),c=o[0],l=o[1];if(this.isFalseIntersection(c)||this.isFalseIntersection(l))c>1&&this.isFalseIntersection(l)?this.lineToLineUseArcToConnect(a,r,i):this.useLineToConnect(r,i);else if(!this.isFalseIntersection(c)&&!this.isFalseIntersection(l)){let u=r.end().sub(r.start()),h=r.start().add(u.mul(c)),p=new ce(r.start(),h);this.rawOffsetPrimitive.push(p);let d=new ce(h,i.end());this.updateNextOffsetPrimitive(n,d)}}}static updateNextOffsetPrimitive(t,s){this.offsetPrimitive[t].offsetEdge=s}static useLineToConnect(t,s){this.rawOffsetPrimitive.push(t);let r=new ce(t.end(),s.start());this.rawOffsetPrimitive.push(r)}static lineToLineUseArcToConnect(t,s,r){let i=this.getSweep(t,s),n=this.getSweepAngel(s.end(),r.start(),t,i);if(n===0){this.useLineToConnect(s,r);return}this.rawOffsetPrimitive.push(s);let a=Te.build5(s.end(),r.start(),n);this.rawOffsetPrimitive.push(a)}static getSweep(t,s,r){let i=null,n=r||r===0?this.originalPrimitive[r]:s;if(n instanceof Te){let a=n.center.sub(n.end()).normalize();n.isCCW?i=new he(a.y,-a.x):i=new he(-a.y,a.x)}else i=s.end().sub(s.start()).normalize();return t.sub(s.end()).normalize().cross(i)>0?0:1}static getLineToLineT(t,s){let r=t.end().sub(t.start()),i=s.end().sub(s.start()),n=r.cross(i),a=s.start().sub(t.start()),o=t.start().sub(s.start()),c=a.cross(i)/n,l=o.cross(r)/-n;return[c,l]}static lineToArcConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=t.index,a=s.index,o=this.getLineJoinArcScalarAndIntersectionNum(r,i),c=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(c,r,i,n);else if(o.intersectionNum===1){let l=o.points[0];this.lineAndArcConnectionDetail(r,i,o.t[0],l,c,n,a)}else if(o.intersectionNum===2){let l=o.points[0],u=o.points[1],h=l.distance2(c),p=u.distance2(c);this.lineAndArcConnectionDetail(r,i,h<p?o.t[0]:o.t[1],h<p?l:u,c,n,a)}}static lineAndArcConnectionDetail(t,s,r,i,n,a,o){let c=this.isTrueArcIntersection(s,i);if(!this.isFalseIntersection(r)&&c){let l=new ce(t.start(),i);this.rawOffsetPrimitive.push(l);let u;!s.center.equals1(i)||s.sweepAngle>1e-4?(u=Te.build4(i,s.end(),s.center,s.rx,s.ry,s.sweep()),u instanceof Te&&u.sweepAngle===0&&(u=new ce(u.start(),u.end()))):u=new ce(s.center,i),this.updateNextOffsetPrimitive(o,u)}else c?this.useLineToConnect(t,s):this.lineAndArcUseArcConnect(n,t,s,a)}static lineAndArcUseArcConnect(t,s,r,i){let n=this.getSweep(t,s,i),a=this.getSweepAngel(s.end(),r.start(),t,n);if(a===0){this.useLineToConnect(s,r);return}let o=Te.build5(s.end(),r.start(),a);this.rawOffsetPrimitive.push(s),this.rawOffsetPrimitive.push(o)}static arcToLineConnectionDetail(t,s,r,i,n,a,o){let c=this.isTrueArcIntersection(t,i);if(!this.isFalseIntersection(r)&&c){let l;t.center.equals1(i)?l=new ce(t.center,i):Math.abs(t.sweepAngle)<1e-4?l=new ce(t.start(),i):(l=Te.build4(t.start(),i,t.center,t.rx,t.ry,t.sweep()),l instanceof Te&&l.sweepAngle===0&&(l=new ce(l.start(),l.end()))),this.rawOffsetPrimitive.push(l);let u=new ce(i,s.end());this.updateNextOffsetPrimitive(o,u)}else c?this.useLineToConnect(t,s):this.lineAndArcUseArcConnect(n,t,s,a)}static isTrueArcIntersection(t,s){return Ws(t,s)}static getSweepAngel(t,s,r,i){let n=t.angleD(r),a=s.angleD(r),o;return n===a?o=0:(n=ct.regularD(n),a=ct.regularD(a),i===1?a<=n&&(a+=360):a>=n&&(n+=360),o=a-n),o}static getLineJoinArcScalarAndIntersectionNum(t,s){let r={t:[],intersectionNum:0,points:[]},i=z3(s,t);if(i){r.intersectionNum=i/2;for(let n=0;n<i-1;n+=2){let a=new he(ee[n],ee[n+1]);r.points.push(a),a.sub(t.start()).x<1e-4||a.sub(t.start()).y<1e-4?r.t.push(0):r.t.push(a.sub(t.start()).x/t.end().sub(t.start()).x)}}else r.intersectionNum=0;return r}static arcToLineConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=t.index,a=s.index,o=this.getLineJoinArcScalarAndIntersectionNum(i,r),c=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(c,r,i,n);else if(o.intersectionNum===1){let l=o.points[0];this.arcToLineConnectionDetail(r,i,o.t[0],l,c,n,a)}else if(o.intersectionNum===2){let l=o.points[0],u=o.points[1],h=l.distance2(c),p=u.distance2(c);this.arcToLineConnectionDetail(r,i,h<p?o.t[0]:o.t[1],h<p?l:u,c,n,a)}}static rxChangeStatus(t){return t===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=L2(r,i);if(n){let a=this.getInters(n),o;if(a.length===2){let u=this.originalPrimitive[s.index].start(),h=a[0],p=a[1],d=h.distance2(u),f=p.distance2(u);d<f?o=h:o=p}else o=a[0];let c,l;o.equals1(r.center)?c=new ce(r.center,o):Math.abs(r.sweepAngle)<1e-4?c=new ce(r.start(),o):(c=Te.build4(r.start(),o,r.center,r.rx,r.ry,r.sweep()),c instanceof Te&&c.sweepAngle===0&&(c=new ce(c.start(),c.end()))),this.rawOffsetPrimitive.push(c),o.equals1(i.center)?l=new ce(o,i.center):Math.abs(i.sweepAngle)<1e-4?l=new ce(o,i.end()):(l=Te.build4(o,i.end(),i.center,i.rx,i.ry,i.sweep()),l instanceof Te&&l.sweepAngle===0&&(l=new ce(l.start(),l.end()))),this.updateNextOffsetPrimitive(s.index,l)}else{let a=this.originalPrimitive[t.index],o=this.originalPrimitive[s.index],c=this.rxChangeStatus(a.sweep()),l=this.rxChangeStatus(o.sweep()),u=this.originalPrimitive[s.index].start(),h=this.getSweep(u,r,t.index),p=Math.abs(this.offsetDistance),d=Te.build2(u,c?a.endAngle():a.endAngle()+180,l?o.startAngle:o.startAngle+180,p,p,h);this.rawOffsetPrimitive.push(r),this.rawOffsetPrimitive.push(d)}}},Ga.originalPrimitive=[],Ga.offsetPrimitive=[],Ga.rawOffsetPrimitive=[],Ga.testI=0,Ga),f4=class Uh extends nd{constructor(t,s,r,i,n,a){if(super(),s<0||r<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=t,this.width=s,this.height=r,this.angle=i,this.isCCW=n,this.radius=Math.min(Math.max(a,0),s/2,r/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new he(this.radius,0).multiply3(Yt.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new he(0,-this.height/2).multiply3(Yt.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new he(this.width,-this.height/2).multiply3(Yt.rotateD(this.angle)))}extend(t){return new Uh(this.leftUpPoint.add(new he(-t,t).rotateD(he.ORIGIN,this.angle)),this.width+t*2,this.height+t*2,this.angle,this.isCCW,this.radius+t)}bbox(){let t=Yt.rotateD(this.angle),{leftUpPoint:s,width:r,height:i,radius:n}=this,a=s.add(new he(n,-n).multiply3(t)),o=s.add(new he(n,n-i).multiply3(t)),c=s.add(new he(r-n,-n).multiply3(t)),l=s.add(new he(r-n,n-i).multiply3(t));return new Jr(Math.min(a.x,o.x,c.x,l.x)-n,Math.max(a.x,o.x,c.x,l.x)+n,Math.min(a.y,o.y,c.y,l.y)-n,Math.max(a.y,o.y,c.y,l.y)+n)}toPolyline(){let t=[],{leftUpPoint:s,width:r,height:i,radius:n}=this;if(n===0){let o=he.ORIGIN,c=new he(r,0),l=new he(r,-i),u=new he(0,-i);t.push(new ce(o,c),new ce(c,l),new ce(l,u),new ce(u,o))}else{let o=new he(0,-n),c=new he(n,0),l=new he(r-n,0),u=new he(r,-n),h=new he(r,n-i),p=new he(r-n,-i),d=new he(n,-i),f=new he(0,n-i);t.push(Te.build1(o,c,n,n,!1,0),new ce(c,l),Te.build1(l,u,n,n,!1,0),new ce(u,h),Te.build1(h,p,n,n,!1,0),new ce(p,d),Te.build1(d,f,n,n,!1,0),new ce(f,o))}t=t.filter(o=>!o.start().equals1(o.end())),this.isCCW&&(t.forEach((o,c)=>t[c]=o.reverse()),t.reverse());let a=Yt.rotateD(this.angle).translate1(s);return Et.build2(t.map(o=>o.multiply3(a)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(t){let s=this.leftUpPoint.multiply3(t),r=new he(this.width,0).multiply3(Yt.rotateD(this.angle)).multiply3(t),i=new he(0,-this.height).multiply3(Yt.rotateD(this.angle)).multiply3(t);return t.isMirrored()?new Uh(s,i.length(),r.length(),i.angleD(he.ORIGIN),this.isCCW===1?0:1,this.radius*r.length()/this.width):new Uh(s,r.length(),i.length(),r.angleD(he.ORIGIN),this.isCCW,this.radius*r.length()/this.width)}reverse(){return new Uh(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(t,s,r){let i=this.stroke1(t,s,r);if(i.length===1)return i[0];{let[n,a]=i;return Et.build2(n.primitives.concat(new ce(n.primitives[0].start(),a.primitives[0].start()),a.primitives,new ce(a.primitives[0].start(),n.primitives[0].start())))}}stroke1(t,s,r){let i=r===this.isCCW?this:this.reverse(),n=t/2,a=Math.min(i.width,i.height)/2,o=i.extend(n).toPolyline();return a<=n?[o]:[o,i.extend(-n).toPolyline().reverse()]}points(t){let s=this.toPolyline(),r=[];return s.points(t,i=>r.push(i)),r}toBezier(){throw new Error("Method not implemented.")}},m4=.01,cr=class On{static simplify(t){return t=Mo(t),t?new On([t]):null}static buildByStroke(t,s,r=1,i=sE,n){if(t instanceof Te&&(t.rx<s/2+m4||Math.abs(t.sweepAngle)>180&&Se.lesseq(t.start().distance1(t.end()),s))){let o=eS(t.stroke(s,r,0),n);if(o.length===0)return null;if(o.length===1)return new On(o);let c=[null],l=Number.POSITIVE_INFINITY;return o.forEach(u=>{let h=u.area(.1);h<0?h<l&&(c[0]=u,l=h):c.push(u)}),new On(c)}else if(t instanceof f4){let o=t.stroke1(s,r,0).map(c=>Mo(c));return o[0]?o[1]?new On(o):new On([o[0]]):null}let a=t.stroke(s,r,0,i);return a?this.simplify(a):null}static buildCircle(t,s){return this.simplify(Et.build7([Te.buildCircle(t,s,0)]))}static buildRect(t){return this.simplify(t.toPolyline())}static buildBBox(t){return this.simplify(Et.buildBBox(t,0))}constructor(t){this.items=t.slice()}multiply3(t){return new On(this.items.map(s=>s.multiply3(t)))}bbox(){return this.items[0].bbox()}isEqual(t){return t instanceof On?this.items.every(s=>t.items.some(r=>r.isEqual(s))):!1}getOutMostPolyline(){return this.items[0]}extend(t,s){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(t===0)return new Fs([this]);let r=this.items[0],i=[];for(let u of r.primitives)if(u instanceof ce)i.push(u);else if(u instanceof Te&&u.rx===u.ry)a(u);else if(u instanceof We)n(u);else throw new Error("not support!");r=Et.build7(i);function n(u){let h=u.points(.1);for(let p=0;p<h.length-1;p++){let d=h[p],f=h[p+1];i.push(new ce(d,f))}}function a(u){if(Math.abs(u.sweepAngle)>270){let h=u.sweepAngle/2;a(Te.build3(u.center,u.startAngle,h,u.rx,u.ry)),a(Te.build3(u.center,u.startAngle+h,h,u.rx,u.ry))}else i.push(u)}let o=[],c=[];p4.getExtendPolyLine(r,t,!0,s).forEach(u=>{(u.area(.1)>0?c:o).push(u)});let l;if(o.length===1)c.forEach(u=>o.push(u)),l=new Fs([new On(o)]);else if(o.length===0)console.warn("outlines.length === 0"),l=new Fs([]);else if(c.length===0)l=new Fs(o.map(u=>new On([u])));else{let u=o.map(h=>[h]);c.forEach(h=>{let p=[],d=h.bbox();if(u.forEach(f=>{f[0].bbox().isContainsBBox1(d)&&p.push(f)}),p.length===1)p[0].push(h);else{if(p.length===0)throw new Error("inPlsArr.length === 0");for(let f of p.sort((m,g)=>m[0].bbox().area()-g[0].bbox().area()))if(f[0].getWindingNum(h.start())===-1){f.push(h);break}}}),l=new Fs(u.map(h=>new On(h)))}return l}toPolylineGroup(){return new rE(this.items)}};var g4=(e=>(e[e.POLYGON=1]="POLYGON",e[e.POLYLINE=2]="POLYLINE",e[e.LINE=3]="LINE",e[e.ARC=4]="ARC",e[e.BEZIER2=5]="BEZIER2",e[e.BEZIER3=6]="BEZIER3",e[e.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",e[e.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",e[e.BOOLEAN_UNION=9]="BOOLEAN_UNION",e[e.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",e[e.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",e[e.LINES=12]="LINES",e[e.ARCS=13]="ARCS",e[e.BEZIER2S=14]="BEZIER2S",e[e.BEZIER3S=15]="BEZIER3S",e[e.CIRCLE_CW=16]="CIRCLE_CW",e[e.CIRCLE_CCW=17]="CIRCLE_CCW",e[e.POLYGON_GROUP=18]="POLYGON_GROUP",e))(g4||{});var y4=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function E4(e){return new y4(e)}function b4(e){return e===32||e===9||e===13||e===10}var T4=class{constructor(){this._line=1,this._col=0}line(){return this._line}col(){return this._col}_feed(e){return e===10?(this._col=0,this._line++):this._col++,this.feed(e)}parse(e){let t=e.length;for(let s=0;s<t;s++){let r=e.charCodeAt(s);if(!this._feed(r))return this}return this.finish(),this}},E1=class{static repeat(e,t){let s=new Array(t);for(;t-- >0;)s[t]=e;return s.join("")}static lpad(e,t,s){let r=s-e.length;return r>0?this.repeat(t,r)+e:e}},w4=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(w4||{}),S4=/(\.?0+)$/,B1=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let s=this._format(e,t);if(typeof s=="string")return s;throw new Error(this.format("Invalid state on (%d) %s",s,e))}static _format(e,t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c),u=l.charCodeAt(0);switch(r){case 0:u===37?r=1:s.push(l);break;case 1:switch(u){case 100:if(n=t[i++],typeof n=="number")s.push(n.toFixed(0)),r=0;else return c;break;case 102:if(n=t[i++],typeof n=="number")s.push(n.toString()),r=0;else return c;break;case 120:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16)),r=0;else return c;break;case 88:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16).toUpperCase()),r=0;else return c;break;case 115:case 99:n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case 48:a=c+1,o=-1,r=2;break;case 37:s.push("%"),r=0;break;default:return c}break;case 2:switch(u){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=c;break;case 100:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(E1.lpad((n|0).toString(10),"0",h)),r=0;else return c}else return c;break;case 120:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(E1.lpad((n|0).toString(16),"0",h)),r=0;else return c}else return c;break;case 88:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(E1.lpad((n|0).toString(16).toUpperCase(),"0",h)),r=0;else return c}else return c;break;default:return c}break;default:return c}}return s.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static fmtNumber(e){return e.toFixed(5).replace(S4,"")}},_4=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(_4||{});function A4(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var C4=(e,t)=>{e===3?console.error(...t):e===2?console.warn(...t):console.log(...t)},D4=(e,t)=>[A4(e)].concat(t),Ya,P4=(Ya=class{static mix(...t){return new Ya(0,(s,r)=>{for(let i of t)i.write(s,r)},(s,r)=>r)}constructor(t,s=C4,r=D4){this.level=t,this.writer=s,this.fmt=r}setLevel(t){this.level=t}prepend(t=null,s=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),i=s===null?this.writer:(n,a)=>{s(n,a),this.writer(n,a)};return new Ya(this.level,i,r)}chain(t){return t.prepend(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}formatWrite(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,[B1.format(s,...r)]))}write(t,s){this.include(t)&&this.writer(t,this.fmt(t,s))}write3(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,[B1.format(s,...r)]))}debug3(t,...s){this.write3(0,t,s)}warning3(t,...s){this.write3(2,t,s)}debugFmt(t,...s){this.formatWrite(0,t,s)}debug(...t){this.write(0,t)}infoFmt(t,...s){this.formatWrite(1,t,s)}info(...t){this.write(1,t)}warningFmt(t,...s){this.formatWrite(2,t,s)}warning(...t){this.write(2,t)}errorFmt(t,...s){this.formatWrite(3,t,s)}error(...t){this.write(3,t)}},Ya.DUMMY=new Ya(4),Ya),b1=500,Qw=String.fromCharCode,O4=class{constructor(){this.buffer=new Array}size(){return this.buffer.length}isEOF(){return!1}write(e){return this.buffer.push(e),1}writen1(e){return this.writen2(e,0,e.length)}writen2(e,t,s){let r=this.buffer;for(let i=0,n=t;i<s;i++,n++)r.push(e[n]);return s}writeAsync(e,t){t(this.write(e))}writenAsync1(e,t){t(this.writen1(e))}writenAsync2(e,t,s,r){r(this.writen2(e,t,s))}writeStr(e){let t=e.length,s=new Array(t);for(let r=0;r<t;r++)s[r]=e.charCodeAt(r);return this.writen1(s)}clear(){this.buffer.length=0}toString(){let e=this.buffer,t=e.length;if(t<=b1)return Qw.apply(null,e);{let s=new Array;for(let r=0;r<e.length;r+=b1){let i=Math.min(t-r,b1),n=Qw.apply(null,e.slice(r,r+i));s.push(n)}return s.join("")}}},sS=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.NUMBER_INTEGER=1]="NUMBER_INTEGER",e[e.NUMBER_DECIMAL=2]="NUMBER_DECIMAL",e[e.NUMBER_E=3]="NUMBER_E",e[e.NUMBER_E_SIGNED=4]="NUMBER_E_SIGNED",e))(sS||{}),rS=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.MOVE_X=1]="MOVE_X",e[e.MOVE_Y=2]="MOVE_Y",e[e.LINE_X=3]="LINE_X",e[e.LINE_Y=4]="LINE_Y",e[e.HORIZONTAL_X=5]="HORIZONTAL_X",e[e.VERTICAL_Y=6]="VERTICAL_Y",e[e.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",e[e.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",e[e.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",e[e.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",e[e.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",e[e.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",e[e.ARC_RX=13]="ARC_RX",e[e.ARC_RY=14]="ARC_RY",e[e.ARC_ROTATION=15]="ARC_ROTATION",e[e.ARC_LARGE=16]="ARC_LARGE",e[e.ARC_SWEEP=17]="ARC_SWEEP",e[e.ARC_X=18]="ARC_X",e[e.ARC_Y=19]="ARC_Y",e[e.SMOOTH_CUBIC_BEZIER_X2=20]="SMOOTH_CUBIC_BEZIER_X2",e[e.SMOOTH_CUBIC_BEZIER_Y2=21]="SMOOTH_CUBIC_BEZIER_Y2",e[e.SMOOTH_CUBIC_BEZIER_X=22]="SMOOTH_CUBIC_BEZIER_X",e[e.SMOOTH_CUBIC_BEZIER_Y=23]="SMOOTH_CUBIC_BEZIER_Y",e[e.QUADRATIC_BEZIER_X1=24]="QUADRATIC_BEZIER_X1",e[e.QUADRATIC_BEZIER_Y1=25]="QUADRATIC_BEZIER_Y1",e[e.QUADRATIC_BEZIER_X=26]="QUADRATIC_BEZIER_X",e[e.QUADRATIC_BEZIER_Y=27]="QUADRATIC_BEZIER_Y",e))(rS||{});function I4(e){return 97<=e&&e<=122||65<=e&&e<=90}function fr(e){let t=parseFloat(e);if(isFinite(t))return t;throw new Error("expect number")}var e2=class extends T4{constructor(e,t=!0,s=P4.DUMMY){super(),this.buffer=new O4,this.group=new Array,this.subPartStart=he.ORIGIN,this.curPoint=he.ORIGIN,this.lexState=0,this.parseState=0,this.isAbsolute=!1,this.isLargeArc=!1,this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=Number.NaN,this.y=Number.NaN,this.rx=Number.NaN,this.ry=Number.NaN,this.rotation=Number.NaN,this.sweep=xo.CCW,this.prevBezierCtrl2=null,this.logger=s,this.cb=e,this.yAxis=t?-1:1}on(e){return this.cb(e)}feed(e){switch(this.logger.include(0)&&this.logger.debug3("L: %c(%s)|%s",e,String.fromCharCode(e),sS[this.lexState]),this.lexState){case 0:return b4(e)?!0:48<=e&&e<=57||e===45||e===43?(this.pushBuffer(e),this.lexState=1,!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):I4(e)?this.feedS(String.fromCharCode(e)):(this.logger.warning3("unknow letter %c",e),!0);case 1:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 2:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 3:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===45||e===43?(this.pushBuffer(e),this.lexState=4,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 4:return 48<=e&&e<=57?(this.pushBuffer(e),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;default:return!0}}finish(){this.feed(32),this.tryNotify()}feedS(e){switch(this.logger.include(0)&&this.logger.debug3("P: %s|%s|%s|%s",e,rS[this.parseState],this.curPoint,this.subPartStart),this.parseState){case 0:switch(e){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new ce(this.curPoint,this.subPartStart));let r=this.tryNotify();return this.curPoint=this.subPartStart,r}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=20;break;case"s":this.isAbsolute=!1,this.parseState=20;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=24;break;case"q":this.isAbsolute=!1,this.parseState=24;break;default:this.logger.warning3("unknow %s",e)}return!0;case 1:let t=this.tryNotify();return this.x=fr(e),this.parseState=2,t;case 2:{this.y=this.yAxis*fr(e);let r;return this.isAbsolute?r=new he(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.curPoint=r,this.subPartStart=r,this.parseState=3,!0}case 3:return this.x=parseFloat(e),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(e));case 4:{this.y=this.yAxis*fr(e);let r;return this.isAbsolute?r=new he(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.group.push(new ce(this.curPoint,r)),this.curPoint=r,this.parseState=3,!0}case 5:if(this.x=parseFloat(e),isFinite(this.x)){let r;return this.isAbsolute?r=new he(this.x,this.curPoint.y):r=this.curPoint.add1(this.x,0),this.group.push(new ce(this.curPoint,r)),this.curPoint=r,!0}else return this.parseState=0,this.feedS(e);case 6:if(this.y=parseFloat(e),isFinite(this.y)){this.y=this.yAxis*this.y;let r;return this.isAbsolute?r=new he(this.curPoint.x,this.y):r=this.curPoint.add1(0,this.y),this.group.push(new ce(this.curPoint,r)),this.curPoint=r,!0}else return this.parseState=0,this.feedS(e);case 7:let s=parseFloat(e);return isFinite(s)?(this.x1=s,this.parseState=8,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 8:return this.y1=this.yAxis*fr(e),this.parseState=9,!0;case 9:return this.x2=fr(e),this.parseState=10,!0;case 10:return this.y2=this.yAxis*fr(e),this.parseState=11,!0;case 11:return this.x=fr(e),this.parseState=12,!0;case 12:{this.y=this.yAxis*fr(e);let r,i,n;return this.isAbsolute?(r=new he(this.x1,this.y1),i=new he(this.x2,this.y2),n=new he(this.x,this.y)):(r=this.curPoint.add1(this.x1,this.y1),i=this.curPoint.add1(this.x2,this.y2),n=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=i,this.group.push(new We([this.curPoint,r,i,n])),this.curPoint=n,this.parseState=7,!0}case 13:return this.rx=parseFloat(e),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(e));case 14:return this.ry=fr(e),this.parseState=15,!0;case 15:return this.rotation=fr(e),this.parseState=16,!0;case 16:return this.isLargeArc=fr(e)===1,this.parseState=17,!0;case 17:return this.sweep=fr(e)===1?xo.CW:xo.CCW,this.parseState=18,!0;case 18:return this.x=fr(e),this.parseState=19,!0;case 19:{this.y=this.yAxis*fr(e);let r;return this.isAbsolute?r=new he(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.rx&&this.ry&&this.group.push(Te.build1(this.curPoint,r,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=r,this.parseState=13,!0}case 20:return this.x2=parseFloat(e),isFinite(this.x2)?(this.parseState=21,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 21:return this.y2=this.yAxis*fr(e),this.parseState=22,!0;case 22:return this.x=fr(e),this.parseState=23,!0;case 23:{this.y=this.yAxis*fr(e);let r,i;this.isAbsolute?(r=new he(this.x2,this.y2),i=new he(this.x,this.y)):(r=this.curPoint.add1(this.x2,this.y2),i=this.curPoint.add1(this.x,this.y));let n;return this.prevBezierCtrl2?n=this.curPoint.add(this.curPoint.sub(this.prevBezierCtrl2)):n=this.curPoint,this.prevBezierCtrl2=r,this.group.push(new We([this.curPoint,n,r,i])),this.curPoint=i,this.parseState=20,!0}case 24:return this.x1=parseFloat(e),isFinite(this.x1)?(this.parseState=25,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 25:return this.y1=this.yAxis*fr(e),this.parseState=26,!0;case 26:return this.x=fr(e),this.parseState=27,!0;case 27:{this.y=this.yAxis*fr(e);let r,i;return this.isAbsolute?(r=new he(this.x1,this.y1),i=new he(this.x,this.y)):(r=this.curPoint.add1(this.x1,this.y1),i=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=r,this.group.push(new We([this.curPoint,r,i])),this.curPoint=i,this.parseState=24,!0}default:return this.logger.warning3("unsupported parse state %s",this.parseState),!0}}pushBuffer(e){this.buffer.write(e)}getCleanBuffer(){let e=this.buffer.toString();return this.buffer.clear(),e}tryNotify(){if(this.group.length===0)return!0;{let e=Et.build1(E4(this.group));return this.group.length=0,this.on(e)}}onException(e){throw e}},x4=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.ENC_LINE=1]="ENC_LINE",e[e.ENC_ARC=2]="ENC_ARC",e[e.ENC_CUBIC_BEZIER=3]="ENC_CUBIC_BEZIER",e[e.ENC_QUADRATIC_BEZIER=4]="ENC_QUADRATIC_BEZIER",e))(x4||{}),VG=B1.fmtNumber,t2=class{constructor(e=!0){this.buffer=new Array,this.state=0,this.prev=null,this.yAxis=e?-1:1}encPl(e){for(let t of e.primitives)this.encPt(t);return this}encPt(e){if(e instanceof ce)this.encLine1(e);else if(e instanceof Te)this.encArc(e);else if(e instanceof We)this.encBezier(e);else throw new Error("");return this}encBezier(e){if(e.controls.length===3){let t=e.controls[0],s=e.controls[1],r=e.controls[2];this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"Q",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):t.equals1(this.prev)?this.state!==4?this.buffer.push("Q",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):this.buffer.push(s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):this.buffer.push("L",t.x,this.yAxis*t.y,"Q",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y),this.prev=r,this.state=4}else if(e.controls.length===4){let t=e.controls[0],s=e.controls[1],r=e.controls[2],i=e.controls[3];this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"C",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y):t.equals1(this.prev)?this.state!==3?this.buffer.push("C",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y):this.buffer.push(s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y):this.buffer.push("L",t.x,this.yAxis*t.y,"C",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y),this.prev=i,this.state=3}else throw new Error("only bezier has 3 or 4 control points supported");return this}encArc(e){let t=e.svgEnd;return this.state===0?this.buffer.push("M",e.start().x,this.yAxis*e.start().y,"A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===xo.CCW?0:1,t.x,this.yAxis*t.y):e.start().equals1(this.prev)?this.state!==2?this.buffer.push("A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===xo.CCW?0:1,t.x,this.yAxis*t.y):this.buffer.push(e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===xo.CCW?0:1,t.x,this.yAxis*t.y):this.buffer.push("L",e.start().x,this.yAxis*e.start().y,"A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===xo.CCW?0:1,t.x,this.yAxis*t.y),this.prev=t,this.state=2,this}encLine1(e){return this.encLine2(e.start(),e.end()),this}encLine2(e,t){return this.state===0?this.buffer.push("M",e.x,this.yAxis*e.y,"L",t.x,this.yAxis*t.y):(this.state!==1&&this.buffer.push("L"),e.equals1(this.prev)?this.buffer.push(t.x,this.yAxis*t.y):this.buffer.push(e.x,this.yAxis*e.y,t.x,this.yAxis*t.y)),this.prev=t,this.state=1,this}close(e){return this.state!==0&&(e&&this.buffer.push("Z"),this.state=0,this.prev=null),this}fixNumber(e=4){return this.buffer.forEach((t,s,r)=>{typeof t=="number"&&(t|0)!==t&&(r[s]=+t.toFixed(e))}),this}toString(){return this.buffer.join(" ")}toArray(){return this.buffer}},v4=class extends Q1{constructor(){super(),this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.zIndex=0,this.zIndexMap=new Map}onParseLine(e){let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"LOCK":this.parseLock(e);break;case"HIDE":this.parseHide(e);break;case"INVISIBLE":this.parseInvisible(e);break;case"COVER":this.parseCover(e);break;case"TRN_CTRL":this.parseTrnCtrl(e);break;case"COMMENT":this.parseComment(e);break;case"FONT_CACHE":this.parseFontCache(e);break;case"TRANSFORM":this.parseTransform(e);break;case"GROUP":{let s=e[1];this.cache[t]||(this.cache[t]={errorIds:[]}),s!==null&&this.cache[t][s]?this.cache[t][s]=e:this.cache[t].errorIds.push(e);break}case"POLY":case"STRING":case"AUXLINE":case"DIMENSION":{this.zIndexMap.set(e[1],++this.zIndex);let s=qh(e[1]);this.cache[t]||(this.cache[t]={errorIds:[]}),s!==null&&!this.cache[t][s]?this.cache[t][s]=e:this.cache[t].errorIds.push(e);break}default:console.warn("can not find hanlder with",e)}}getZIndex(e){var t;return(t=this.zIndexMap.get(e))!=null?t:null}secondParseLine(e){switch(e[0]){case"GROUP":this.parseGroup(e);break;case"POLY":this.parsePoly(e);break;case"STRING":this.parseString(e);break;case"AUXLINE":this.parseAuxLine(e);break;case"DIMENSION":this.parseDimension(e);break}}onParseEnd(){for(let e in this.cache){let t=this.cache[e],s=Object.keys(t).sort((i,n)=>Number(i)-Number(n)),r=0;for(let i of s){if(i==="errorIds")continue;let n=Number(i),a=n-r-1;a>=1&&this.onPHolder(e,a),r=n,this.secondParseLine(t[n])}t.errorIds.forEach(i=>this.secondParseLine(i))}this.clearCache()}clearCache(){this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.version=void 0}parseDocType(e){this.version=Number(e[2])}parseHead(e){this.version<2&&e[1]&&e[1].print==="AHead Side"&&(e[1].print="Ahead Side"),this.onCanvas(e[1])}parseGroup(e){this.onGroup(e[1],e[2],e[3],!!e[4],!!e[5])}parseLock(e){this.lockConfig.push(...e[1])}parseHide(e){this.hideConfig.push(...e[1])}parseInvisible(e){this.invisibleConfig.push(...e[1])}parseCover(e){this.coverConfig[e[1]]=e[2]}parseTrnCtrl(e){this.trnCtrlConfig[e[1]]={scope:e[2],trans_print:e[3],trans_white:e[4]}}parseComment(e){this.commentConfig[e[1]]=e[2]}matrix2svg(e){let[t,s,r,i,n,a,o,c,l]=e.data;return[t,s,i,n,o,c]}encPath(e){let t=new Array;return new e2(s=>(t.push(new t2(!0).encPl(s).toArray().slice(1)),!0),!0).parse(e),t}parseRect(e){var T,w,S,_,C,x,D,I;let[,t,,s,r,i,n,a,o,,,c,l]=e,u=c[0],h=u[1],p=-u[2],d=u[1]+u[3],f=-u[2]+u[4],m=u[5],g=u[6],b=+u[7],E=+u[8],y=Yt.scale(d-h,f-p).rotateD(-b);E&&(y=y.multiply3(Yt.MIRROR_X)),y=y.translate(h,p),y=this.matrix2svg(y),y=this.encMatrix(y),this.onPoly(t,0,s,-b,r,i,n,a,o,!0,[["R",0,0,1,1,m,g,0,0]],!0,!0,this.lockConfig.some(P=>P===e[1]),this.hideConfig.some(P=>P===e[1]),this.invisibleConfig.some(P=>P===e[1]),s===1?1:(T=this.coverConfig[e[1]])!=null?T:null,l||((w=this.commentConfig[e[1]])!=null?w:null),s===2?3:(_=(S=this.trnCtrlConfig[e[1]])==null?void 0:S.scope)!=null?_:null,s===2?o:(x=(C=this.trnCtrlConfig[e[1]])==null?void 0:C.trans_print)!=null?x:null,s===2?1-o:(I=(D=this.trnCtrlConfig[e[1]])==null?void 0:D.trans_white)!=null?I:null,y!=null?y:null)}parseObj(e){var C,x,D,I,P,L,F,V;let[,t,,s,r,i,n,a,o,,,c,l]=e,[u,h,p,d,f,m,g,b,E]=c[0],y=Yt.rotateD(b);E&&(y=y.multiply3(Yt.MIRROR_X));let T;E?T=new ce(new he(0,0),new he(0,-f)).multiply3(y):T=new ce(new he(0,0),new he(d,0)).multiply3(y);let w=T.end().angleD(T.start()),S=E===1;d=E===1?f:d,f=E===1?d:f;let _=Yt.scale(d,f).rotateD(-w);S&&(_=_.multiply3(Yt.MIRROR_X)),_=_.translate(h,-p),_=this.matrix2svg(_),_=this.encMatrix(_),this.onPoly(t,0,s,-w,r,i,n,a,o,!0,[["R",0,0,1,1,0,0,0,0]],!1,!1,this.lockConfig.some(B=>B===e[1]),this.hideConfig.some(B=>B===e[1]),this.invisibleConfig.some(B=>B===e[1]),s===1?1:(C=this.coverConfig[e[1]])!=null?C:null,l||((x=this.commentConfig[e[1]])!=null?x:null),s===2?3:(I=(D=this.trnCtrlConfig[e[1]])==null?void 0:D.scope)!=null?I:null,s===2?o:(L=(P=this.trnCtrlConfig[e[1]])==null?void 0:P.trans_print)!=null?L:null,s===2?1-o:(V=(F=this.trnCtrlConfig[e[1]])==null?void 0:F.trans_white)!=null?V:null,_!=null?_:null)}parseEllipse(e){var E,y,T,w,S,_,C,x;let[,t,,s,r,i,n,a,o,,,c,l]=e,u=c[0],h=u[1],p=-u[2],d=u[3],f=u[4],m=+u[5],g=+u[6],b=Yt.scale(d,f).rotateD(-m);g&&(b=b.multiply3(Yt.MIRROR_X)),b=b.translate(h,p),b=this.matrix2svg(b),b=this.encMatrix(b),this.onPoly(t,0,s,-m,r,i,n,a,o,!0,[["ELLIPSE",0,0,1,1,0,0]],!0,!0,this.lockConfig.some(D=>D===e[1]),this.hideConfig.some(D=>D===e[1]),this.invisibleConfig.some(D=>D===e[1]),s===1?1:(E=this.coverConfig[e[1]])!=null?E:null,l||((y=this.commentConfig[e[1]])!=null?y:null),s===2?3:(w=(T=this.trnCtrlConfig[e[1]])==null?void 0:T.scope)!=null?w:null,s===2?o:(_=(S=this.trnCtrlConfig[e[1]])==null?void 0:S.trans_print)!=null?_:null,s===2?1-o:(x=(C=this.trnCtrlConfig[e[1]])==null?void 0:C.trans_white)!=null?x:null,b!=null?b:null)}parsePolyGroup(e){var d,f,m,g,b,E,y,T;let[,t,,s,r,i,n,a,o,,,c,l]=e,u=!0,h=!0,p=this.decMultiPoly(c).d;this.onPoly(t,0,s,0,r,i,n,a,o,!0,this.encPath(p),u,h,this.lockConfig.some(w=>w===e[1]),this.hideConfig.some(w=>w===e[1]),this.invisibleConfig.some(w=>w===e[1]),s===1?1:(d=this.coverConfig[e[1]])!=null?d:null,l||((f=this.commentConfig[e[1]])!=null?f:null),s===2?3:(g=(m=this.trnCtrlConfig[e[1]])==null?void 0:m.scope)!=null?g:null,s===2?o:(E=(b=this.trnCtrlConfig[e[1]])==null?void 0:b.trans_print)!=null?E:null,s===2?1-o:(T=(y=this.trnCtrlConfig[e[1]])==null?void 0:y.trans_white)!=null?T:null,null)}parsePoly(e){var t,s,r,i,n,a,o,c,l,u;if(this.version<2)if(e[11].length===1)switch(e[11][0][0]){case"R":{let h=e[7];return h.startsWith("data:")||h.startsWith("blob:")?this.parseObj(e):this.parseRect(e)}case"ELLIPSE":return this.parseEllipse(e);default:return this.parsePolyGroup(e)}else return this.parsePolyGroup(e);else this.onPoly(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],!!(e[12]||e[12]===void 0),!!(e[13]||e[13]===void 0),this.lockConfig.some(h=>h===e[1]),this.hideConfig.some(h=>h===e[1]),this.invisibleConfig.some(h=>h===e[1]),(t=this.coverConfig[e[1]])!=null?t:null,(s=this.commentConfig[e[1]])!=null?s:null,(i=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?i:null,(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,(c=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?c:null,(u=(l=this.transformConfig[e[1]])==null?void 0:l.matrix)!=null?u:null)}decMultiPoly(e){let t=new Ti,s=e.map(r=>{let i="";return new e2(n=>(t.ext1(n.bbox()),i=new t2().encPl(n).toString(),!1),!1).parse("M"+r.join(" ")),i}).join(" ");return{bbox:t.build(),d:s}}encMatrix(e){let[t,s,r,i,n,a]=e,o=new Yt([t,s,0,r,i,0,n,a,1]);o=Yt.MIRROR_Y.multiply3(o).multiply3(Yt.MIRROR_Y);let[c,l,u,h,p,d,f,m,g]=o.data;return[c,h,f,l,p,m]}parseString(e){var t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y;if(this.version<2){let[,T,w,S,_,C,x,D,I,P,L,F,V,B,k,O,R,v,j,M]=e;C=xr(C);let H=I;D=D===1,V=V===1,B=B===1,k=k===1;let q=-(O[15]/3|0)+2,Q=O%3;j=j||1,M=M||1;let oe=this.fontCache[e[1]],{bbox:me,d:Ee}=this.decMultiPoly(oe),Pe=me.width(),Oe=me.height();Oe=Oe||0,Pe=Pe||0;let Fe=0;switch(Q){case 1:Fe=-Pe/2;break;case 2:Fe=-Pe;break}let G=0;switch(q){case 1:G=Oe/2;break;case 0:G=Oe;break}let pe=Yt.translate(Fe,G).scale(j,M).rotateD(-x);D&&(pe=pe.multiply3(Yt.MIRROR_X)),pe=pe.translate(_,C);let ge=this.matrix2svg(pe),ie=this.encMatrix(ge);this.onString(T,w,S,x,H,P,L,F,V,B,k,((-q||0)+2)*3+(Q||0),R,v,this.lockConfig.some($=>$===e[1]),this.hideConfig.some($=>$===e[1]),this.invisibleConfig.some($=>$===e[1]),S===1?1:(t=this.coverConfig[e[1]])!=null?t:null,(s=this.commentConfig[e[1]])!=null?s:null,S===2?3:(i=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?i:null,S===2?v:(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,S===2?1-v:(c=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?c:null,ie,!!ie,this.encPath(Ee))}else this.onString(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]===1,e[10]===1,e[11]===1,e[12],e[13],e[14],this.lockConfig.some(T=>T===e[1]),this.hideConfig.some(T=>T===e[1]),this.invisibleConfig.some(T=>T===e[1]),(l=this.coverConfig[e[1]])!=null?l:null,(u=this.commentConfig[e[1]])!=null?u:null,(p=(h=this.trnCtrlConfig[e[1]])==null?void 0:h.scope)!=null?p:null,(f=(d=this.trnCtrlConfig[e[1]])==null?void 0:d.trans_print)!=null?f:null,(g=(m=this.trnCtrlConfig[e[1]])==null?void 0:m.trans_white)!=null?g:null,(E=(b=this.transformConfig[e[1]])==null?void 0:b.matrix)!=null?E:null,!!((y=this.transformConfig[e[1]])!=null&&y.matrix),this.fontCache[e[1]])}parseFontCache(e){this.fontCache[e[1]]=e[2]}parseDimension(e){var t,s,r,i,n,a,o,c,l,u,h,p;this.onDimension(e[1],e[2],e[3],(t=e[4])!=null?t:null,e[5],e[6],e[7],e[8],this.lockConfig.some(d=>d===e[1]),this.hideConfig.some(d=>d===e[1]),this.invisibleConfig.some(d=>d===e[1]),(s=this.coverConfig[e[1]])!=null?s:null,(r=this.commentConfig[e[1]])!=null?r:null,(n=(i=this.trnCtrlConfig[e[1]])==null?void 0:i.scope)!=null?n:null,(o=(a=this.trnCtrlConfig[e[1]])==null?void 0:a.trans_print)!=null?o:null,(l=(c=this.trnCtrlConfig[e[1]])==null?void 0:c.trans_white)!=null?l:null,(h=(u=this.transformConfig[e[1]])==null?void 0:u.matrix)!=null?h:null,!!((p=this.transformConfig[e[1]])!=null&&p.matrix))}parseTransform(e){this.transformConfig[e[1]]={matrix:e[2],strokes:!!e[3]}}parseAuxLine(e){var t,s,r,i,n,a,o,c,l,u,h;this.onAuxLine(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],this.lockConfig.some(p=>p===e[1]),this.hideConfig.some(p=>p===e[1]),this.invisibleConfig.some(p=>p===e[1]),(t=this.coverConfig[e[1]])!=null?t:null,(s=this.commentConfig[e[1]])!=null?s:null,(i=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?i:null,(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,(c=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?c:null,(u=(l=this.transformConfig[e[1]])==null?void 0:l.matrix)!=null?u:null,!!((h=this.transformConfig[e[1]])!=null&&h.matrix))}},R4=class extends Q1{constructor(e={},t=[]){super(),this.symbolPartIds=e,this.device=t,this.defaultPartId="pid8a0e77bacb214e",this.curPart="",this.onlyPart="",this.partIdMap={},this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.zIndex=0,this.zIndexMap=new Map,this.cache={},this.errorIds={},this.tableCell={},this.hasPart=!1,this.components={},this.busEntryMap={},this.defaultLineStyle={strokeColor:null,strokeStyle:null,fillColor:null,strokeWidth:null,fillStyle:null},this.defaultFontStyle={color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:null,underline:null,italic:null,fontWeight:null,hAlign:null,vAlign:null}}getZIndex(e){var t;return(t=this.zIndexMap.get(e))!=null?t:null}transPinAttrKey(e){switch(e){case"NUMBER":{e="Pin Number";break}case"NAME":{e="Pin Name";break}}return e}transFontStyle(e){return{color:e.color,fillColor:e.fillColor,fontFamily:e.fontFamily,fontSize:e.fontSize,strikeout:e.strikeout,underline:e.underline,italic:e.italic,fontWeight:e.fontWeight,align:this.transAlign(e.vAlign,e.hAlign)}}transTableFontStyle(e){return{color:e.color,fillColor:e.fillColor,fontFamily:e.fontFamily,fontSize:e.fontSize,strikeout:e.strikeout,underline:e.underline,italic:e.italic,fontWeight:e.fontWeight,vAlign:this.transVAlign(e.vAlign),hAlign:this.transHAlign(e.hAlign)}}transVAlign(e){switch(e=e&&Number(e),e){case 0:return"TOP";case 1:return"MIDDLE";case 2:return"BOTTOM";default:return null}}transHAlign(e){switch(e=e&&Number(e),e){case 0:return"LEFT";case 1:return"CENTER";case 2:return"RIGHT";default:return null}}transAlign(e,t){if(e=e&&Number(e),t=t&&Number(t),t===0)switch(e){case 0:return"LEFT_TOP";case 1:return"LEFT_MIDDLE";case 2:return"LEFT_BOTTOM";default:return null}if(t===1)switch(e){case 0:return"CENTER_TOP";case 1:return"CENTER_MIDDLE";case 2:return"CENTER_BOTTOM";default:return null}if(t===2)switch(e){case 0:return"RIGHT_TOP";case 1:return"RIGHT_MIDDLE";case 2:return"RIGHT_BOTTOM";default:return null}return null}transStrokeStyle(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transFillStyle(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"SOLID";case 2:return"GRID";case 3:return"HORIZONTAL_LINE";case 4:return"VERTICAL_LINE";case 5:return"RHOMBIC";case 6:return"LEFT_SLASH_LINE";case 7:return"RIGHT_SLASH_LINE";default:return null}}transPinShape(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"CLOCK";case 2:return"INVERTED";case 3:return"INVERTED_CLOCK";default:return"NONE"}}onParseLine(e){var s,r;let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"GROUP":this.parseGroup(e);break;case"FONTSTYLE":this.parseFontStyle(e);break;case"LINESTYLE":this.parseLineStyle(e);break;case"TERM":break;case"PART":this.hasPart=!0,this.parsePart(e);break;case"TABEL_CELL":this.parseTableCell(e);break;case"BUSENTRY":{this.parseBusEntry(e);break}case"WIRE":case"BUS":case"TEXT":case"POLY":case"CIRCLE":case"ARC":case"RECT":case"PIN":case"OBJ":case"COMPONENT":case"ELLIPSE":case"BEZIER":case"TABLE":{this.zIndexMap.set(e[1],++this.zIndex);let i=qh(e[1]);this.cache[t]||(this.cache[t]={}),i!==null&&!this.cache[t][i]?this.cache[t][i]={part:this.curPart,value:e}:(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPart,value:e}));break}case"ATTR":{this.zIndexMap.set(e[1],++this.zIndex),e[3]==="Symbol"&&(this.components[e[2]]||(this.components[e[2]]={symbol:"",device:""}),this.components[e[2]].symbol=e[4]),e[3]==="Device"&&(this.components[e[3]]||(this.components[e[3]]={symbol:"",device:""}),this.components[e[3]].device=e[4]);let i=Object.keys(((s=this.cache)==null?void 0:s.COMPONENT)||{}).find(o=>this.cache.COMPONENT[o].value[1]===e[2]);if(i){let o=this.cache.COMPONENT[i];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:e});break}let n=Object.keys(((r=this.cache)==null?void 0:r.PIN)||{}).find(o=>this.cache.PIN[o].value[1]===e[2]);if(n){let o=this.cache.PIN[n];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:e});break}let a=qh(e[1]);this.cache[t]||(this.cache[t]={}),a!==null?this.cache[t][a]||(this.cache[t][a]={part:this.curPart,value:e}):(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPart,value:e}));break}default:console.warn("can not find hanlder with",e)}}secondParseLine(e){switch(e[0]){case"DOCTYPE":case"HEAD":case"GROUP":case"FONTSTYLE":case"LINESTYLE":break;case"ATTR":this.parseAttr(e);break;case"WIRE":this.parseWire(e);break;case"BUS":this.parseBus(e);break;case"TEXT":this.parseText(e);break;case"POLY":this.parsePoly(e);break;case"CIRCLE":this.parseCircle(e);break;case"ARC":this.parseArc(e);break;case"BUSENTRY":break;case"RECT":this.parseRect(e);break;case"PIN":this.parsePin(e);break;case"OBJ":this.parseObj(e);break;case"COMPONENT":this.parseComponent(e);break;case"ELLIPSE":this.parseEllipse(e);break;case"BEZIER":this.parseBezier(e);break;case"TABLE":this.parseTable(e);break;case"TABEL_CELL":break}}onParseEnd(){this.docType==="SYMBOL"&&!this.hasPart&&(this.curPart=this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[""]=this.curPart,this.onPart(this.curPart,{title:""}));for(let e in this.cache){let t=this.cache[e],s=Object.keys(t).sort((i,n)=>Number(i)-Number(n)),r=0;for(let i of s){let n=Number(i),a=n-r-1;a>=1&&this.onPHolder(e,a),r=n,this.curPart=this.hasPart?t[n].part||this.onlyPart:this.curPart,this.secondParseLine(t[n].value),t[n].attr&&t[n].attr.forEach(o=>{this.curPart=this.hasPart?o.part||this.onlyPart:this.curPart,this.secondParseLine(o.value)})}if(this.errorIds[e])for(let i of this.errorIds[e])this.curPart=this.hasPart?i.part||this.onlyPart:this.curPart,this.secondParseLine(i.value)}this.clearCache()}clearCache(){this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.cache={},this.errorIds={},this.curPart="",this.components={},this.tableCell={},this.hasPart=!1,this.version=void 0,this.docType=void 0}parseDocType(e){this.docType=e[1];let t=parseFloat(e[2]);this.version=t}parseHead(e){this.onCanvas(e[1])}parseFontStyle(e){this.fontStyleIndex[e[1]]={color:e[3]===""?"none":e[3],fillColor:e[2],fontFamily:e[4],fontSize:e[5],strikeout:e[9]===null?null:e[9]===1,underline:e[8]===null?null:e[8]===1,italic:e[6]===null?null:e[6]===1,fontWeight:e[7]===null?null:e[7]===1,vAlign:e[10],hAlign:e[11]}}parseLineStyle(e){this.lineStyleIndex[e[1]]={strokeColor:e[2],strokeStyle:this.transStrokeStyle(e[3]),fillColor:e[4]===""?"none":e[4],strokeWidth:e[5],fillStyle:this.transFillStyle(e[6])}}getGroupId(e){var s;let t=this;for(let r in t.groupIndex)if((s=t.groupIndex[r])!=null&&s.includes(e))return r;return""}parseBezier(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);for(let r=0;r<e[2].length;r+=2)e[2][r+1]=xr(e[2][r+1]);this.onBezier(e[1],this.curPart,s,!!e[4],e[2],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseGroup(e){this.groupIndex[e[1]]=e[4]||[],this.onGroup(e[1],e[2]||"",e[3]||"")}parseBus(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=e[2]||[],r=this.getGroupId(e[1]);this.onBus(e[1],this.curPart,r,!!e[4],s,t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle,this.busEntryMap[e[1]]||{})}parseWire(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=e[2]||[],r=this.getGroupId(e[1]);this.onWire(e[1],this.curPart,r,!!e[4],s,t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseText(e){let t=this.fontStyleIndex[e[6]];t||(t=this.defaultFontStyle,console.warn("font not found",e));let s=this.transFontStyle(t),r=this.getGroupId(e[1]);this.onText(e[1],this.curPart,r,!!e[7],e[2],e[3],e[4],e[5],s.color,s.fillColor,s.fontFamily,s.fontSize,s.strikeout,s.underline,s.italic,s.fontWeight,s.align)}parsePoly(e){let t=this.lineStyleIndex[e[4]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onPoly(e[1],this.curPart,s,!!e[5],e[2]||[],!!e[3],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseCircle(e){let t=this.lineStyleIndex[e[5]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onCircle(e[1],this.curPart,s,!!e[6],e[2],e[3],e[4],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseArc(e){let t=this.lineStyleIndex[e[8]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onArc(e[1],this.curPart,s,!!e[9],e[2],e[3],e[4],e[5],e[6],e[7],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseBusEntry(e){let t=e[2],s={groupId:this.getGroupId(e[1]),locked:!1,zIndex:++this.zIndex,order:e[3],pointX:e[4],pointY:xr(e[5]),rotation:e[6]};this.busEntryMap[t]||(this.busEntryMap[t]={}),this.busEntryMap[t][e[1]]=s}parseRect(e){let t=this.lineStyleIndex[e[9]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onRect(e[1],this.curPart,s,!!e[10],e[2],e[3],e[4],e[5],e[6],e[7],e[8],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parsePin(e){let t=this.getGroupId(e[1]);this.onPin(e[1],this.curPart,t,!!e[10],!!e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transPinShape(e[9]))}parseObj(e){let t=this.getGroupId(e[1]);this.version>=1.1?this.onObj(e[1],this.curPart,t,!!e[10],e[2],e[3],e[4],e[5],e[6],e[7],!!e[8],e[9]):this.onObj(e[1],this.curPart,t,!!e[10],e[2],e[4],e[5],e[6],e[7],e[8],!1,`data:${e[3]},${e[9]}`)}parseComponent(e){var i,n,a;let t=this.getGroupId(e[1]),s=e[2],r=this.components[e[1]];if(r){if(r.symbol){let o=this.symbolPartIds[r.symbol];o&&(s=o[e[2]]||e[2]||o[(i=Object.keys(o))==null?void 0:i[0]]||"")}else if(r.device){let o=this.device.find(l=>l.uuid===r.device),c=o?this.symbolPartIds[(n=o==null?void 0:o.attributes)==null?void 0:n.Symbol]:null;c&&(s=c[e[2]]||e[2]||c[(a=Object.keys(c))==null?void 0:a[0]]||"")}}this.onComponent(e[1],!!e[8],s,t,e[3],e[4],e[5],e[6]===1,e[7])}parseEllipse(e){let t=this.lineStyleIndex[e[7]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onEllipse(e[1],this.curPart,s,!!e[8],e[2],e[3],e[4],e[5],e[6],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseTable(e){let t=this.getGroupId(e[1]);this.onTable(e[1],this.curPart,t,e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.tableCell[e[1]]||[])}parseTableCell(e){let t=this.lineStyleIndex[e[8]],s=this.lineStyleIndex[e[9]],r=this.lineStyleIndex[e[10]],i=this.lineStyleIndex[e[11]],n=this.fontStyleIndex[e[12]],a=Object.assign({},n);a.color=n.fillColor,a.fillColor=n.color,(!t||!s||!r||!i||!a)&&console.warn("style not found",e);let o={id:e[1],value:e[3],rowIndex:e[4],columnIndex:e[5],rowSpan:e[6],colSpan:e[7],topStyle:t||this.defaultLineStyle,rightStyle:s||this.defaultLineStyle,bottomStyle:r||this.defaultLineStyle,leftStyle:i||this.defaultLineStyle,fontStyle:this.transTableFontStyle(a||this.defaultFontStyle),lineHeight:e[13],zIndex:++this.zIndex};this.tableCell[e[2]]||(this.tableCell[e[2]]=[]),this.tableCell[e[2]].push(o)}parseAttr(e){let t=this.fontStyleIndex[e[10]];t||(t=this.defaultFontStyle,console.warn("fontStyle not found",e));let s=this.transFontStyle(t),r=this.getGroupId(e[1]);this.onAttr(e[1],this.curPart,r,!!e[11],e[2]||"",this.transPinAttrKey(String(e[3])),e[4],e[5]===null?null:!!e[5],e[6]===null?null:!!e[6],e[7]!==null?e[7]:null,e[8]!==null?e[8]:null,e[9],s.color,s.fillColor,s.fontFamily,s.fontSize,s.strikeout,s.underline,s.italic,s.fontWeight,s.align)}parsePart(e){this.curPart=e[1]||this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[e[1]]=this.curPart;let t=Object.assign(e[2]||{},{title:e[1]||""});this.onPart(this.curPart,t)}},N4=class{constructor(){}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodeAuxLine(e,t){return{id:e,dataType:"AUXLINE",data:JSON.stringify(t)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}},iS=class{constructor(){}editHead(e,t){let s={uuid:e.uuid,nickname:e.nickname,username:e.username,updateTime:t};return`${JSON.stringify({type:"EDIT_HEAD"})}${xn}${JSON.stringify(s)}`}head(e){return Pc(this.doctype,e.client,e.doc,e.updateTime,e.version||String(e.updateTime),e.user,e.ticket)}creator(e,t){let s=typeof t=="string"?t:JSON.stringify(t);return Bi("META_CREATE",e,"META_CREATE",s)}modifier(e,t){let s=typeof t=="string"?t:JSON.stringify(t);return Bi("META_MODIFY",e,"META_MODIFY",s)}delete(e,t){let s=t||JSON.stringify({isDelete:!0});return Bi("DELETE_DOC",e,"DELETE_DOC",s)}},oE=class extends iS{constructor(){super(...arguments),this.doctype="BLOB"}buildStr(e,t,s){let r=typeof s=="string"?s:JSON.stringify(this.buildData(s));return Bi("BLOB",e,t,r)}buildData(e){return{filename:e.filename,content:e.content}}};var nS=class{constructor(){}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodePanelize(e){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(e)}}encodeRuleSelector(e){let t=JSON.stringify(["RULE_SELECTOR",e.ruleSelect]),s={...e};return delete s.ruleSelect,{id:t,dataType:"RULE_SELECTOR",data:JSON.stringify(s)}}encodeRule(e){let t=JSON.stringify(["RULE",e.ruleType,e.ruleName]),s={...e};return delete s.ruleType,delete s.ruleName,{id:t,dataType:"RULE",data:JSON.stringify(s)}}encodeRuleTemplate(e){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(e)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeBoss(e,t){return{id:e,dataType:"BOSS",data:JSON.stringify(t)}}encodeShellEntity(e,t){return{id:e,dataType:"SHELL_ENTITY",data:JSON.stringify(t)}}encodeShellCut(e,t){return{id:e,dataType:"SHELLCUT",data:JSON.stringify(t)}}encodeCrease(e,t){return{id:e,dataType:"CREASE",data:JSON.stringify(t)}}encodeShell(e,t){return{id:e,dataType:"SHELL",data:JSON.stringify(t)}}encodeFpcFill(e,t){return{id:e,dataType:"FPC_FILL",data:JSON.stringify(t)}}encodeTeardrop(e,t){return{id:e,dataType:"TEARDROP",data:JSON.stringify(t)}}encodeImage(e,t){return{id:e,dataType:"IMAGE",data:JSON.stringify(t)}}encodePoured(e,t){return{id:Li(e,"POURED"),dataType:"POURED",data:JSON.stringify(t)}}encodePour(e,t){return{id:e,dataType:"POUR",data:JSON.stringify(t)}}encodeRegion(e,t){return{id:e,dataType:"REGION",data:JSON.stringify(t)}}encodeFill(e,t){return{id:e,dataType:"FILL",data:JSON.stringify(t)}}encodeLayerFill(e,t){return{id:Li(e,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeEQLenGrp(e,t){return{id:e,dataType:"EQLEN_GRP",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodePad(e,t){return{id:e,dataType:"PAD",data:JSON.stringify(t)}}encodeVia(e,t){return{id:e,dataType:"VIA",data:JSON.stringify(t)}}encodePreference(e){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(e)}}encodeSilkOpts(e,t){return{id:Li(e,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodePrimitive(e,t){return{id:Li(e,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(t)}}encodeNet(e,t){return{id:Li(e,"NET"),dataType:"NET",data:JSON.stringify(t)}}encodeActiveLayer(e){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(e)}}encodeLayerPhys(e,t){return{id:Li(e,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(t)}}encodeLayer(e,t){return{id:Li(e,"LAYER"),dataType:"LAYER",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}},L4=class extends c3{constructor(e=!1){super(void 0,void 0,void 0,void 0,e),this.encode=new nS,this.maxTicket=0,this.blobEncode=new oE,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+tr+Bi(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Bi(e.dataType,++this.maxTicket,e.id,e.data)}getZIndex(e){let t=e.match($1);return t!=null&&t.length?t[1]:null}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:qr(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}onLayerFill(e,t){this.handleData(this.encode.encodeLayerFill(e,t))}onString(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E){let y=this.getZIndex(e);this.handleData(this.encode.encodeString(vt(e),{groupId:s,layerId:r,x:i,y:n,text:a,fontFamily:o,fontSize:c,strokeWidth:l,bold:u,italic:h,origin:p,angle:d,reverse:f,expansion:m,mirror:g,locked:b,zIndex:y===null?null:Number(y),specialColor:E}))}onAttr(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_){let C=this.getZIndex(e);C&&S&&(C=C+"."+String(S)),this.handleData(this.encode.encodeAttr(vt(e),{groupId:s,parentId:r,layerId:i,x:n,y:a,key:o,value:c,keyVisible:l,valueVisible:u,fontFamily:h,fontSize:p,strokeWidth:d,bold:f,italic:m,origin:g,angle:b,reverse:E,expansion:y,mirror:T,locked:w,zIndex:C===null?null:Number(C),specialColor:_}))}onPadNet(e,t,s,r,i){}onComponent(e,t,s,r,i,n,a,o,c){}onPanelize(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodePanelize({on:e,row:t,column:s,rowSpacing:r,columnSpacing:i,onlyOutline:n,horizontalStamp:a,verticalStamp:o,horizontalSize:c,verticalSize:l}))}onRuleSelector(e,t,s,r,i){this.handleData(this.encode.encodeRuleSelector({ruleSelect:e,ruleOrder:t,ruleKeyValue:s,copperValue:r,innerPlaneValue:i}))}onRule(e,t,s,r){this.handleData(this.encode.encodeRule({ruleType:e,ruleName:t,ruleState:s,ruleContext:r}))}onRuleTemplate(e){this.handleData(this.encode.encodeRuleTemplate({name:e}))}onDimension(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeDimension(vt(e),{type:s,layerId:r,unit:i,strokeWidth:n,precision:a,textFollow:o,coords:c,locked:l,zIndex:d===null?null:Number(d),text:u,specialColor:h,groupId:p}))}onBoss(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeBoss(vt(e),{groupId:s,layerId:r,centerX:i,centerY:n,specification:a,depth:o,thickness:c,holeDiameter:l,counterBore:u?{height:u[0],diameter:u[1]}:null,stiffener:h?{topWidth:h[0],bottomWidth:h[1],height:h[2],stiffThickness:h[3]}:null,locked:p,zIndex:d===null?null:Number(d)}))}onShellEntity(e,t,s,r,i,n,a,o,c,l,u,h){let p=this.getZIndex(e),d={groupId:s,layerId:r,type:i?"ENTITY":"SLOT",depth:o,strokeWidth:c,path:l,locked:u,zIndex:p===null?null:Number(p),refs:h};d.type==="ENTITY"&&(d.entityBelong=n),d.type==="SLOT"&&(d.slotOptions=a),this.handleData(this.encode.encodeShellEntity(vt(e),d))}onShellCut(e,t,s,r,i,n,a,o,c){let l=this.getZIndex(e);this.handleData(this.encode.encodeShellCut(vt(e),{groupId:s,layerId:r,depth:i,strokeWidth:n,path:a,locked:o,zIndex:l===null?null:Number(l),refs:c}))}onCrease(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeCrease(vt(e),{groupId:s,layerId:r,startX:i,startY:n,endX:a,endY:o,angle:c,locked:l,zIndex:u===null?null:Number(u)}))}onShell(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e),h={groupId:s,shellType:r,shellHeight:i,pcbHeight:n,strokeWidth:a,path:o,thickness:c.Thickness,locked:l,zIndex:u===null?null:Number(u)};r==="DRAWER"&&(h.direction=c.Direction),r==="T&B"&&(h.bottomHeight=c.BottomHeight,h.topInnerHeight=c.TopInnerHeight,h.bottomInnerHeight=c.BottomInnerHeight),this.handleData(this.encode.encodeShell(vt(e),h))}onFpcFill(e,t,s,r,i,n,a,o){let c=this.getZIndex(e);this.handleData(this.encode.encodeFpcFill(vt(e),{groupId:s,layerId:r,material:i,thickness:n,path:a,locked:o,zIndex:c===null?null:Number(c)}))}onTeardrop(e,t,s,r,i,n,a){this.handleData(this.encode.encodeTeardrop(vt(e),{netName:s,layerId:r,path:i,groupId:n,refs:a,locked:!1}))}onImage(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeImage(vt(e),{groupId:s,layerId:r,startX:i,startY:n,width:a,height:o,angle:c,mirror:l,path:u,locked:h,zIndex:d===null?null:Number(d),specialColor:p}))}onPoured(e,t){this.handleData(this.encode.encodePoured(vt(e),t))}onPour(e,t,s,r,i,n,a,o,c,l,u,h){let p=this.getZIndex(e);this.handleData(this.encode.encodePour(vt(e),{groupId:s,netName:r,layerId:i,width:n,name:a,order:o,path:c,pourType:l,keepIsland:u,locked:h,zIndex:p===null?null:Number(p)}))}onRegion(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeRegion(vt(e),{groupId:s,layerId:r,width:i,prohibitType:n,path:a,locked:o,zIndex:u===null?null:Number(u),name:c,regionType:l}))}onFill(e,t,s,r,i,n,a,o,c,l,u){let h=this.getZIndex(e);this.handleData(this.encode.encodeFill(vt(e),{groupId:s,netName:r,layerId:i,width:n,fillStyle:a,path:o,locked:c,zIndex:h===null?null:Number(h),isBridgingCopper:!1,networkList:[],refs:l,specialColor:u}))}onPoly(e,t,s,r,i,n,a,o,c){let l=this.getZIndex(e);this.handleData(this.encode.encodePoly(vt(e),{groupId:s,netName:r,layerId:i,width:n,path:a,locked:o,zIndex:l===null?null:Number(l),specialColor:c,polyType:i==11?"BOARD_OUTLINE":"NORMAL"}))}onEQLenGrp(e,t,s,r){this.handleData(this.encode.encodeEQLenGrp(vt(e),{name:t,sort:s,pads:r}))}onObj(e,t,s,r,i,n,a,o,c,l,u,h,p,d){if(h.startsWith("data:")){let m=Fm(h);this.blobData.push(this.blobEncode.buildStr(1,m,{filename:i,content:h})),h=`blob:${m}`}let f=this.getZIndex(e);this.handleData(this.encode.encodeObj(vt(e),{groupId:s,layerId:r,fileName:i,startX:n,startY:a,width:o,height:c,angle:l,mirror:u,path:h,locked:p,zIndex:f===null?null:Number(f),specialColor:d}))}onArc(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeArc(vt(e),{groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,angle:l,width:u,locked:h,zIndex:d===null?null:Number(d),arcType:"DOT",specialColor:p}))}onCArc(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeArc(vt(e),{groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,angle:l,width:u,locked:h,zIndex:d===null?null:Number(d),arcType:"CENT",specialColor:p}))}onLine(e,t,s,r,i,n,a,o,c,l,u){let h=this.getZIndex(e);this.handleData(this.encode.encodeLine(vt(e),{groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,width:l,locked:u,zIndex:h===null?null:Number(h)}))}onPad(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C,x,D){let I=this.getZIndex(e);this.handleData(this.encode.encodePad(vt(e),{groupId:s,netName:r,layerId:i,num:n,centerX:a,centerY:o,padAngle:c,hole:l,defaultPad:u,specialPad:h,padOffsetX:p,padOffsetY:d,relativeAngle:f,plated:m,padType:g,topSolderExpansion:b,bottomSolderExpansion:E,topPasteExpansion:y,bottomPasteExpansion:T,locked:w,zIndex:I===null?null:Number(I),connectMode:S,spokeSpace:_,spokeWidth:C,spokeAngle:x,unusedInnerLayers:D,padLen:0}))}onVia(e,t,s,r,i,n,a,o,c,l,u,h,p,d){let f=this.getZIndex(e);this.handleData(this.encode.encodeVia(vt(e),{groupId:s,netName:r,ruleName:i,centerX:n,centerY:a,holeDiameter:o,viaDiameter:c,viaType:l,topSolderExpansion:u,bottomSolderExpansion:h,locked:p,zIndex:f===null?null:Number(f),unusedInnerLayers:d}))}onPreference(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y){this.handleData(this.encode.encodePreference({startTrackWidthFollowLast:e,lastTrackWidth:t,startViaSizeFollowLast:s,lastViaInnerDiameter:r,lastViaDiameter:i,snap:n,routingMode:a,routingCorner:o,removeLoop:c,rotatingObject:l,trackFollow:u,stretchTrackMinCorner:h,preferenceConfig:p,realTimeUpdateUnusedLayers:d,unusedPadRange:f,pushVia:m,pathOptimization4BePushed:g,currentPathOptimization4BePushed:b,removeCircuitsContainingVias:E,removeAntenna:y}))}onSilkOpts(e,t,s){this.handleData(this.encode.encodeSilkOpts(e,{defaultColor:t,baseColor:s}))}onGroup(e,t){this.handleData(this.encode.encodeGroup(e,{groupName:t}))}onPrimitive(e,t,s){this.handleData(this.encode.encodePrimitive(e,{display:t,pick:s}))}onNet(e,t,s,r,i,n,a){this.handleData(this.encode.encodeNet(e,{netType:t,specialColor:s,retLine:r,differentialName:i,isPositiveNet:n,equalLengthGroupName:a}))}onPartition(e,t,s,r){}onActiveLayer(e){this.handleData(this.encode.encodeActiveLayer({layerId:e}))}onLayerPhys(e,t,s,r,i,n,a){this.handleData(this.encode.encodeLayerPhys(e,{material:t,thickness:s,permittivity:r,lossTangent:i,isKeepIsland:n,zIndex:a}))}onLayer(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodeLayer(e,{layerType:t,layerName:s,use:r,show:i,locked:n,activeColor:a,activateTransparency:o,inactiveColor:c,inactiveTransparency:l}))}onCanvas(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodeCanvas({originX:e,originY:t,unit:s,gridXSize:r,gridYSize:i,snapXSize:n,snapYSize:a,altSnapXSize:o,altSnapYSize:c,gridType:l,multiGridType:u,multiGridRatio:h,highlightValue:.5}))}};function B4(e,t,s,r=new Date().getTime(),i=String(r),n){let a=new L4(s),o="",c=qr();if(o=Pc("FOOTPRINT",c,e,r,i,n),a.parseFull(t),a.encodeData&&(o=o+tr+a.encodeData),a.blobData.length&&(o=o+tr+a.blobEncode.head({doc:"BLOB",client:c,updateTime:r,version:i,user:n})+tr+a.blobData.join(tr)),a.fontCache.length){let l=new F4,u=l.head({doc:"FONT",client:c,updateTime:r,version:i,user:n});for(let h of a.fontCache){let p=_1(h.text,h.fontFamily,h.fontSize,h.thickness,h.bold,h.italic,h.reverse,h.expansion),d=l.buildStr(1,p,h);u=u+tr+d}o=u+tr+o}return o}var k4=class{constructor(){}encodePart(e,t){return{id:e,dataType:"PART",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodeTable(e,t){return{id:e,dataType:"TABLE",data:JSON.stringify(t)}}encodeEllipse(e,t){return{id:e,dataType:"ELLIPSE",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodePin(e,t){return{id:e,dataType:"PIN",data:JSON.stringify(t)}}encodeRect(e,t){return{id:e,dataType:"RECT",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeCircle(e,t){return{id:e,dataType:"CIRCLE",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeText(e,t){return{id:e,dataType:"TEXT",data:JSON.stringify(t)}}encodeBezier(e,t){return{id:e,dataType:"BEZIER",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}},M4=class extends R4{constructor(){super(),this.encode=new k4,this.maxTicket=0,this.blobEncode=new oE,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+tr+Bi(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Bi(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:qr(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}onPart(e,t){this.handleData(this.encode.encodePart(e,t||{}))}onAttr(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T){this.handleData(this.encode.encodeAttr(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),parentId:i,key:n,value:a,keyVisible:o,valueVisible:c,x:l,y:xr(u),rotation:h,color:p,fillColor:d,fontFamily:f,fontSize:m,strikeout:g,underline:b,italic:E,fontWeight:y,align:T,version:"2.0"}))}onTable(e,t,s,r,i,n,a,o,c,l,u){this.handleData(this.encode.encodeTable(vt(e),{partId:t,groupId:s,startX:r,startY:xr(i),rowSizes:n,colSizes:a,rowLocked:o,colLocked:c,rotation:l,tableCell:u,zIndex:this.getZIndex(e)}))}onEllipse(e,t,s,r,i,n,a,o,c,l,u,h,p,d){this.handleData(this.encode.encodeEllipse(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),centerX:i,centerY:xr(n),radiusX:a,radiusY:xr(o),rotation:c,strokeColor:l,strokeStyle:u,fillColor:h,strokeWidth:p,fillStyle:d}))}onComponent(){}onObj(e,t,s,r,i,n,a,o,c,l,u,h){if(h.startsWith("data:")){let p=Fm(h);this.blobData.push(this.blobEncode.buildStr(1,p,{filename:"",content:h})),h=`blob:${p}`}this.handleData(this.encode.encodeObj(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),fileName:i,startX:n,startY:xr(a),width:o,height:c,rotation:l,isMirror:u,content:h}))}onPin(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodePin(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),display:i,x:a,y:xr(o),length:c,rotation:l,color:u,pinShape:h}))}onRect(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m){this.handleData(this.encode.encodeRect(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),dotX1:i,dotY1:xr(n),dotX2:a,dotY2:xr(o),radiusX:c,radiusY:l,rotation:u,strokeColor:h,strokeStyle:p,fillColor:d,strokeWidth:f,fillStyle:m}))}onArc(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f){this.handleData(this.encode.encodeArc(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),startX:i,startY:xr(n),referX:a,referY:xr(o),endX:c,endY:xr(l),strokeColor:u,strokeStyle:h,fillColor:p,strokeWidth:d,fillStyle:f}))}onCircle(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodeCircle(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),centerX:i,centerY:xr(n),radius:a,strokeColor:o,strokeStyle:c,fillColor:l,strokeWidth:u,fillStyle:h}))}onPoly(e,t,s,r,i,n,a,o,c,l,u){this.handleData(this.encode.encodePoly(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),points:zR(i,!0),closed:n,strokeColor:a,strokeStyle:o,fillColor:c,strokeWidth:l,fillStyle:u}))}onText(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g){this.handleData(this.encode.encodeText(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),x:i,y:xr(n),rotation:a,value:o,color:c,fillColor:l,fontFamily:u,fontSize:h,strikeout:p,underline:d,italic:f,fontWeight:m,align:g,version:"2.0"}))}onCanvas(e){this.handleData(this.encode.encodeCanvas({originX:e.originX,originY:xr(e.originY)}))}onBezier(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodeBezier(vt(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),controls:i,strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:c,fillStyle:l}))}onGroup(e,t,s){this.handleData(this.encode.encodeGroup(String(e),{parentId:t,title:s}))}onBus(){}onWire(){}};function j4(e,t,s=new Date().getTime(),r=String(s),i){let n=new M4,a="";n.parseFull(t);let o=qr();n.encodeData&&(a=Pc("SYMBOL",o,e,s,r,i)+tr+n.encodeData),a&&n.blobData.length&&(a=a+tr+n.blobEncode.head({doc:"BLOB",client:o,updateTime:s,version:r,user:i})+tr+n.blobData.join(tr));let c=n.partIdMap;return n.partIdMap={},{dataStr:a,partIdMap:c}}var F4=class extends iS{constructor(){super(...arguments),this.doctype="FONT"}buildStr(e,t,s){let r=typeof s=="string"?s:JSON.stringify(this.buildData(s));return Bi("FONT",e,t,r)}buildData(e){return{width:e.width,height:e.height,path:e.path}}};var U4=class extends v4{constructor(){super(),this.encode=new N4,this.maxTicket=0,this.blobEncode=new oE,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+tr+Bi(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Bi(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:qr(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}strokeStyleType(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transScopeType(e){switch(e=e&&Number(e),e){case 1:return"PRINT";case 2:return"COVER";case 3:return"PRINT&COVER";default:return null}}transAlignType(e){switch(e=e&&Number(e),e){case 0:return"LEFT_BOTTOM";case 1:return"CENTER_BOTTOM";case 2:return"RIGHT_BOTTOM";case 3:return"LEFT_MIDDLE";case 4:return"CENTER_MIDDLE";case 5:return"RIGHT_MIDDLE";case 6:return"LEFT_TOP";case 7:return"CENTER_TOP";case 8:return"RIGHT_TOP";default:return null}}onAuxLine(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y){this.handleData(this.encode.encodeAuxLine(vt(e),{groupId:t?`e${t}`:"",layer:s,x:r,y:i,rotation:n,strokeWidth:a,strokeStyle:this.strokeStyleType(o),color:c,length:l,locked:u,zIndex:this.getZIndex(e),visible:!p,cover:d,name:f}))}onDimension(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b){this.handleData(this.encode.encodeDimension(vt(e),{layer:t,dimensionType:s,unit:r,strokeWidth:i,accuracy:n,controlDot:a,relationIds:o,locked:c,zIndex:this.getZIndex(e),valid:!l,visible:!u,cover:h,name:p,rotation:0}))}onString(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C){this.handleData(this.encode.encodeString(vt(e),{groupId:t?`e${t}`:"",layer:s,rotation:r,value:i,fontFamily:n,fontSize:a,fontWeight:o,italic:c,underline:l,strikeout:u,align:this.transAlignType(h),strokeColor:p,opacity:d,locked:f,zIndex:this.getZIndex(e),valid:!m,visible:!g,cover:b,transScope:this.transScopeType(y),transPrint:T,transWhite:w,matrix:S,strokes:_,path:C,name:E}))}onPoly(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w){if(typeof o=="string"&&o.startsWith("data:")){let S=Fm(o);this.blobData.push(this.blobEncode.buildStr(1,S,{filename:"",content:o})),o=`blob:${S}`}this.handleData(this.encode.encodePoly(vt(e),{groupId:t?`e${t}`:"",layer:s,rotation:r,strokeWidth:i,strokeStyle:this.strokeStyleType(n),strokeColor:a,fillColor:o,opacity:c,autoClose:l,ploys:u,displayFill:h,displayStroke:p,locked:d,zIndex:this.getZIndex(e),valid:!f,visible:!m,cover:g,transScope:this.transScopeType(E),transPrint:y,transWhite:T,matrix:w,name:b}))}onGroup(e,t,s,r,i){this.handleData(this.encode.encodeGroup(`e${e}`,{parentId:t?`e${t}`:"",title:s,visible:r,locked:i}))}onCanvas(e){this.handleData(this.encode.encodeCanvas(e))}};function H4(e,t,s,r=new Date().getTime(),i=String(r),n){let a=new U4,o="";a.parseFull(t);let c=qr();return a.encodeData&&(o=Pc(s,c,e,r,i,n)+tr+a.encodeData),o&&a.blobData.length&&(o=o+tr+a.blobEncode.head({doc:"BLOB",client:c,updateTime:r,version:i,user:n})+tr+a.blobData.join(tr)),o}var aS=class extends HN{constructor(e){let t=e||new C2;super(t,0,KR),this.cacheNum=null}onParseLine(e,t,s,r,i,n,a){switch(this.setOrderNum(e,a,t),this.cacheNum=a,t){case"MAX_NUM":if(s)for(let c in s)this.setMaxNum(c,s[c]);break;case"BLOB":s?this.onBlob(e,r,i,s,n):this.onDelBlob(e,r,i,n);break;case"FONT":this.parseFont(e,s,r,i,n);break;case"META":s&&this.parseDetail(s,r,i,n);break;case"ELE_PLACEHOLDER":break;case"CANVAS":s&&this.parseCanvas(s,r,i,n);break;case"BOARD":s?this.parseBoard(s,r,i,n):this.onDelBoard(r,i,n);break;case"LAYER":{let c=Do(e);s?this.parseLayer(c,s,r,i,n):this.onDelLayer(c,r,i,n);break}case"LAYER_PHYS":{let c=Do(e);s?this.parseLayerPhys(c,s,r,i,n):this.onDelLayerPhys(c,r,i,n);break}case"ACTIVE_LAYER":s&&this.parseActiveLayer(e,s,r,i,n);break;case"PARTITION":s?this.parsePartition(e,s,r,i,n):this.onDelPartition(e,r,i,n);break;case"NET":{let c=Do(e);s?this.parseNet(c,s,r,i,n):this.onDelNet(c,r,i,n);break}case"PRIMITIVE":{let c=Do(e);s?this.parsePrimitive(c,s,r,i,n):this.onDelPrimitive(c,r,i,n);break}case"GROUP":s?this.parseGroup(e,s,r,i,n):this.onDelGroup(e,r,i,n);break;case"SILK_OPTS":{let c=Do(e);s?this.parseSilkOpts(c,s,r,i,n):this.onDelSilkOpts(c,r,i,n);break}case"PREFERENCE":s&&this.parsePreference(e,s,r,i,n);break;case"VIA":s?this.parseVia(e,s,r,i,n):this.onDelVia(e,r,i,n);break;case"PAD":s?this.parsePad(e,s,r,i,n):this.onDelPad(e,r,i,n);break;case"LINE":s?this.parseLine(e,s,r,i,n):this.onDelLine(e,r,i,n);break;case"ARC":s?this.parseArc(e,s,r,i,n):this.onDelArc(e,r,i,n);break;case"OBJ":s?this.parseObj(e,s,r,i,n):this.onDelObj(e,r,i,n);break;case"EQLEN_GRP":s?this.parseEQLenGrp(e,s,r,i,n):this.onDelEQLenGrp(e,r,i,n);break;case"POLY":s?this.parsePoly(e,s,r,i,n):this.onDelPoly(e,r,i,n);break;case"FILL":s?this.parseFill(e,s,r,i,n):this.onDelFill(e,r,i,n);break;case"LAYER_FILL":let o=Do(e);s?this.parseLayerFill(o,s,r,i,n):this.onDelLayerFill(o,r,i,n);break;case"REGION":s?this.parseRegion(e,s,r,i,n):this.onDelRegion(e,r,i,n);break;case"POUR":s?this.parsePour(e,s,r,i,n):this.onDelPour(e,r,i,n);break;case"POURED":{e=Do(e),s?this.parsePoured(e,s,r,i,n):this.onDelPoured(e,r,i,n);break}case"IMAGE":s?this.parseImage(e,s,r,i,n):this.onDelImage(e,r,i,n);break;case"TEARDROP":s?this.parseTeardrop(e,s,r,i,n):this.onDelTeardrop(e,r,i,n);break;case"FPC_FILL":s?this.parseFpcFill(e,s,r,i,n):this.onDelFpcFill(e,r,i,n);break;case"SHELL":s?this.parseShell(e,s,r,i,n):this.onDelShell(e,r,i,n);break;case"CREASE":s?this.parseCrease(e,s,r,i,n):this.onDelCrease(e,r,i,n);break;case"SHELLCUT":s?this.parseShellCut(e,s,r,i,n):this.onDelShellCut(e,r,i,n);break;case"SHELL_ENTITY":s?this.parseShellEntity(e,s,r,i,n):this.onDelShellEntity(e,r,i,n);break;case"BOSS":s?this.parseBoss(e,s,r,i,n):this.onDelBoss(e,r,i,n);break;case"STRING":s?this.parseString(e,s,r,i,n):this.onDelString(e,r,i,n);break;case"ATTR":s?this.parseAttr(e,s,r,i,n):this.onDelAttr(e,r,i,n);break;case"DIMENSION":s?this.parseDimension(e,s,r,i,n):this.onDelDimension(e,r,i,n);break;case"COMPONENT":s?this.parseComponent(e,s,r,i,n):this.onDelComponent(e,r,i,n);break;case"PAD_NET":{let c=JSON.parse(e);s?(s.componentId=c[1],s.padNum=c[2],s.padId=c[3],this.parsePadNet(s,r,i,n)):this.onDelPadNet(c[1],c[2],c[3]||"",r,i,n);break}case"RULE_TEMPLATE":s&&this.parseRuleTemplate(e,s,r,i,n);break;case"RULE":{let c=JSON.parse(e);s?(s.ruleType=c[1],s.ruleName=c[2],this.parseRule(s,r,i,n)):this.onDelRule(c[1],c[2],r,i,n);break}case"RULE_SELECTOR":{let c=JSON.parse(e);s?(s.ruleSelect=c[1],this.parseRuleSelector(s,r,i,n)):this.onDelRuleSelector(c[1],r,i,n);break}case"PANELIZE":s?this.parsePanelize(e,s,r,i,n):this.onDelPanelize(r,i,n);break;default:console.warn("can not find hanlder with",s,r,i)}this.cacheNum=null}onOrderNum(e,t,s){switch(this.setOrderNum(e,s,t),t){case"PARTITION":this.onPartitionNum&&this.onPartitionNum(e,s);break;case"VIA":this.onViaNum&&this.onViaNum(e,s);break;case"PAD":this.onPadNum&&this.onPadNum(e,s);break;case"LINE":this.onLineNum&&this.onLineNum(e,s);break;case"ARC":this.onArcNum&&this.onArcNum(e,s);break;case"OBJ":this.onObjNum&&this.onObjNum(e,s);break;case"POLY":this.onPolyNum&&this.onPolyNum(e,s);break;case"FILL":this.onFillNum&&this.onFillNum(e,s);break;case"REGION":this.onRegionNum&&this.onRegionNum(e,s);break;case"POUR":this.onPourNum&&this.onPourNum(e,s);break;case"POURED":let r=Do(e);this.onPouredNum&&this.onPouredNum(r,s);break;case"IMAGE":this.onImageNum&&this.onImageNum(e,s);break;case"TEARDROP":this.onTeardropNum&&this.onTeardropNum(e,s);break;case"FPC_FILL":this.onFpcFillNum&&this.onFpcFillNum(e,s);break;case"SHELL":this.onShellNum&&this.onShellNum(e,s);break;case"CREASE":this.onCreaseNum&&this.onCreaseNum(e,s);break;case"SHELLCUT":this.onShellCutNum&&this.onShellCutNum(e,s);break;case"SHELL_ENTITY":this.onShellEntityNum&&this.onShellEntityNum(e,s);break;case"BOSS":this.onBossNum&&this.onBossNum(e,s);break;case"STRING":this.onStringNum&&this.onStringNum(e,s);break;case"ATTR":this.onAttrNum&&this.onAttrNum(e,s);break;case"DIMENSION":this.onDimensionNum&&this.onDimensionNum(e,s);break;case"COMPONENT":this.onComponentNum&&this.onComponentNum(e,s);break}}onParseEnd(){}parseCanvas(e,t,s,r){this.onCanvas(t,s,e,r)}parseBoard(e,t,s,r){this.onBoard(e,t,s,r)}parseDetail(e,t,s,r){this.onDocDetail(t,s,e,r)}parseFont(e,t,s,r,i){let n=FN(e);t?this.onFont(s,r,Object.assign(t,n),i):this.onDelFont(n,s,r,i)}parseLayer(e,t,s,r,i){this.onLayer(e,s,r,t,i)}parseLayerPhys(e,t,s,r,i){this.onLayerPhys(e,s,r,t,i)}parseActiveLayer(e,t,s,r,i){this.onActiveLayer(s,r,t,i)}parsePartition(e,t,s,r,i){this.onPartition(e,this.cacheNum,s,r,t,i)}parseNet(e,t,s,r,i){this.onNet(e,s,r,t,i)}parsePrimitive(e,t,s,r,i){this.onPrimitive(e,s,r,t,i)}parseGroup(e,t,s,r,i){this.onGroup(e,s,r,t,i)}parseSilkOpts(e,t,s,r,i){this.onSilkOpts(e,s,r,t,i)}parsePreference(e,t,s,r,i){this.onPreference(s,r,t,i)}parseVia(e,t,s,r,i){this.onVia(e,this.cacheNum,s,r,t,i)}parsePad(e,t,s,r,i){this.onPad(e,this.cacheNum,s,r,t,i)}parseLine(e,t,s,r,i){this.onLine(e,this.cacheNum,s,r,t,i)}parseArc(e,t,s,r,i){this.onArc(e,this.cacheNum,s,r,t,i)}parseObj(e,t,s,r,i){this.onObj(e,this.cacheNum,s,r,t,i)}parseEQLenGrp(e,t,s,r,i){this.onEQLenGrp(e,s,r,t,i)}parsePoly(e,t,s,r,i){this.onPoly(e,this.cacheNum,s,r,t,i)}parseFill(e,t,s,r,i){t.fillStyle!=="PLANE"&&this.onFill(e,this.cacheNum,s,r,t,i)}parseLayerFill(e,t,s,r,i){this.onLayerFill(e,s,r,t,i)}parseRegion(e,t,s,r,i){this.onRegion(e,this.cacheNum,s,r,t,i)}parsePour(e,t,s,r,i){this.onPour(e,this.cacheNum,s,r,t,i)}parsePoured(e,t,s,r,i){let n=t;Array.isArray(t)&&(n={pourFill:t}),n.pourFill&&this.onPoured(e,this.cacheNum,s,r,n,i)}parseImage(e,t,s,r,i){this.onImage(e,this.cacheNum,s,r,t,i)}parseTeardrop(e,t,s,r,i){this.onTeardrop(e,this.cacheNum,s,r,t,i)}parseFpcFill(e,t,s,r,i){this.onFpcFill(e,this.cacheNum,s,r,t,i)}parseShell(e,t,s,r,i){this.onShell(e,this.cacheNum,s,r,t,i)}parseCrease(e,t,s,r,i){this.onCrease(e,this.cacheNum,s,r,t,i)}parseShellCut(e,t,s,r,i){this.onShellCut(e,this.cacheNum,s,r,t,i)}parseShellEntity(e,t,s,r,i){this.onShellEntity(e,this.cacheNum,s,r,t,i)}parseBoss(e,t,s,r,i){this.onBoss(e,this.cacheNum,s,r,t,i)}parseDimension(e,t,s,r,i){this.onDimension(e,this.cacheNum,s,r,t,i)}parseRuleTemplate(e,t,s,r,i){this.onRuleTemplate(s,r,t,i)}parseRule(e,t,s,r){this.onRule(t,s,e,r)}parseRuleSelector(e,t,s,r){if(e.ruleKeyValue&&(e.ruleKeyValue=Wl(e.ruleKeyValue)),e.copperValue&&e.copperValue.hasOwnProperty("7")){let i=e.copperValue[7];delete e.copperValue[7],e.copperValue.COPPER=i}if(e.innerPlaneValue&&e.innerPlaneValue.hasOwnProperty("6")){let i=e.innerPlaneValue[6];delete e.innerPlaneValue[6],e.innerPlaneValue.PLANE=i}this.onRuleSelector(t,s,e,r)}parsePanelize(e,t,s,r,i){this.onPanelize(s,r,t,i)}parseComponent(e,t,s,r,i){this.onComponent(e,this.cacheNum,s,r,t,i)}parsePadNet(e,t,s,r){this.onPadNet(t,s,e,r)}parseAttr(e,t,s,r,i){this.onAttr(e,this.cacheNum,s,r,t,i)}parseString(e,t,s,r,i){this.onString(e,this.cacheNum,s,r,t,i)}};var G4=(e=>(e.UNIVERSAL="UNIVERSAL",e))(G4||{}),Y4=(e=>(e.SINGLE="SINGLE",e.MULTIPLE="MULTIPLE",e))(Y4||{}),V4=(e=>(e.NONE="NONE",e.NAME="NAME",e.NUMBER="NUMBER",e))(V4||{}),z4=(e=>(e.NONE="NONE",e.ZONE="ZONE",e))(z4||{});var W4=pu(id());function Zh(){return self.EDITOR_TOP||self}function au(e){return self[e]=self[e]||new W4.BroadcastChannelMessageBus(e)}var Sc=(e,t)=>{let s=/{([^}]*)}/gim,r=[...new Set(e.match(s))];for(let i=0;i<r.length;i++){let n=r[i],a=n.substring(1,n.length-1);t[a]&&(e=e.replace(n,t[a]))}return e};var hs={getTime:"/pro-mgr/serverTime/now",getUserL:"/pro-ui/loginUser/get",subMaxTick:"/pro-mgr/project/ticket",subBlob:"/pro-mgr/canvas/BLOB/update",subFont:"/pro-mgr/canvas/FONT/update",subRevoke:"/pro-mgr/{uuid}/revoke",pushPend:"/pro-mgr/worker/batchPendData",pushSync:"/pro-mgr/dataWorker/sync",pushRevoke:"/pro-mgr/worker/revoke",pullASync:"/pro-mgr/dataWorker/sync/{id}",personDestroy:"/mgr/libWorker/destroy",projectUpdate:"/pro-mgr/canvas/{uuid}/update",personUpdate:"/mgr/libWorker/component/{uuid}/update",personSave:"/mgr/libWorker/save",projectSave:"/mgr/projectWorker/setCanvas",canSavePend:"/mgr/projectWorker/canSavePend",hasSaveData:"/mgr/check/hasSaveData"},q4={projectUpdate:hs.projectUpdate,personUpdate:hs.personUpdate,projectCanSave:hs.canSavePend,getProject:"/mgr/projectWorker/footprint/getCanvas",getPerson:"/mgr/libWorker/getFootprint",unwatch:"/mgr/projectWorker/footprint/unwatchCanvas"},J4={projectUpdate:hs.projectUpdate,projectCanSave:hs.canSavePend,getProject:"/mgr/projectWorker/pcb/getCanvas",unwatch:"/mgr/projectWorker/pcb/unwatchCanvas"},zG={projectUpdate:hs.projectUpdate,projectCanSave:hs.canSavePend,getProject:"/mgr/projectWorker/sheet/getCanvas",unwatch:"/mgr/projectWorker/sheet/unwatchCanvas"},WG={projectUpdate:hs.projectUpdate,getProject:"/mgr/projectWorker/schematic/getCanvas",unwatch:"/mgr/projectWorker/schematic/unwatchCanvas"},qG={projectUpdate:hs.projectUpdate,projectCanSave:hs.canSavePend,getProject:"/mgr/projectWorker/simulation/getCanvas",unwatch:"/mgr/projectWorker/simulation/unwatchCanvas"},JG={projectUpdate:hs.projectUpdate,personUpdate:hs.personUpdate,projectCanSave:hs.canSavePend,getProject:"/mgr/projectWorker/symbol/getCanvasOnCompiler",getPerson:"/mgr/libWorker/getSymbol",unwatch:"/mgr/projectWorker/symbol/unwatchCanvas"},KG={projectUpdate:hs.projectUpdate,personUpdate:hs.personUpdate,projectCanSave:hs.canSavePend,getProject:"/mgr/projectWorker/panel/getCanvas",getPerson:"/mgr/libWorker/getPanelLib",unwatch:"/mgr/projectWorker/panel/unwatchCanvas"};var vi={send:"/pro-mgr/notify/send",sendMsg:"/document/sendMsg/cooperation",unwatch:"/document/unwatch/cooperation",watch:"/document/watch/cooperation",message:"/pro-mgr/notify/message/{path}/{uuid}/cooperation",established:"/pro-mgr/notify/message/ws/established",getWsId:"/pro-mgr/notify/getWsId",disconnect:"/pro-mgr/notify/message/ws/disconnect"},cE=class{constructor(e=!0){this._lockerTicket=0,this.isPull=!1,this.compiler={},this.order={SYMBOL:1,FOOTPRINT:2,DEVICE:3,SCH_PAGE:4,PCB:5},this._locker=e?++this._lockerTicket:0}getOrder(e){return this.order[e]||6}publish(){if(!this.isPull){this.isPull=!0,this._temporaryUnlock=this._locker;try{let e=Object.keys(this.compiler).sort((s,r)=>this.getOrder(s)-this.getOrder(r)),t=!1;for(let s of e){for(let[,r]of this.compiler[s])if(t=r.publish(),t)break;if(t)break}}finally{this._temporaryUnlock=0,this.isPull=!1}}}canPush(){return!this._locker||this._locker===this._temporaryUnlock}addCompiler(e){this.compiler[e.headType]||(this.compiler[e.headType]=new Map),this.compiler[e.headType].set(e.uniqueId,e)}removeCompiler(e){var t,s,r;(r=(s=(t=this.compiler)==null?void 0:t[e.headType])==null?void 0:s.delete)==null||r.call(s,e.uniqueId)}pull(){if(!this._locker)throw Error("\u4E0D\u5141\u8BB8\u5728\u975E pause \u72B6\u6001\u4E0B\u62C9\u53D6\u6570\u636E");this.publish()}resume(){this._locker=0,this.publish()}pause(){this._locker=++this._lockerTicket}dispose(){for(let e in this.compiler)this.compiler[e].clear();this.compiler=null}},Oo={publish:"publish",destroy:"destroy",init:"init",selected:"selected"},K4=class{constructor(e,t,s,r=(a=>(a=Zh())==null?void 0:a._TAB_ID_)(),i,n){var o;this.uuid=e,this.path=t,this.user=s,this.windowId=r,this.initIds={},this.sub=[],this.wsBus=n||au(`/${this.windowId}/notify`),this.dataBus=i||this.wsBus,this._client=(o=Zh())==null?void 0:o._WS_ID_}get client(){return this._client}watch(){this.dataBus.publish(vi.send,{topic:vi.watch,uuid:this.uuid,path:this.path})}initPublish(){var e;this.dataBus.publish(vi.send,{topic:vi.sendMsg,uuid:this.uuid,path:this.path,msg:{type:Oo.publish,user:this.user,client:this.client,data:((e=this.getSelect)==null?void 0:e.call(this))||""}})}async init(){if(!this.isInit){if(this.sub.push(this.wsBus.subscribe(vi.established,e=>{this._client=e,this.watch(),this.initPublish()})),!this.client){let e=await this.wsBus.rpcCall(vi.getWsId);if(!e||this.client)return;this._client=e}this.watch(),this.sub.push(this.wsBus.subscribe(vi.disconnect,e=>{this.initIds[e]&&this.onDestroy(this.initIds[e],e)})),this.sub.push(this.dataBus.subscribe(Sc(vi.message,{uuid:this.uuid,path:this.path}),e=>{if(e.type===1)e.connectId&&this.initIds[e.connectId]&&this.onDestroy(this.initIds[e.connectId],e.connectId);else if(e.msg){let t=e.msg;if(t.client===this.client)return;switch(t.type){case Oo.destroy:this.onDestroy(t.userId,t.client),delete this.initIds[t.client];break;case Oo.init:this.initIds[t.client]||(this.initIds[t.client]=t.user.uuid,this.onSelected(t.user,t.client,t.data||""));break;case Oo.selected:this.onSelected(t.user,t.client,t.data||"");break;case Oo.publish:this.dataBus.publish(vi.send,{topic:vi.sendMsg,uuid:this.uuid,path:this.path,msg:{type:Oo.init,user:this.user,client:this.client,data:this.getSelect()||""}}),this.initIds[t.client]=t.user.uuid,this.onSelected(t.user,t.client,t.data||"");break;default:break}}})),this.initPublish(),this.isInit=!0}}publishSelected(e,t){this.dataBus.publish(vi.send,{topic:vi.sendMsg,uuid:this.uuid,path:this.path,msg:{type:Oo.selected,user:this.user,client:this.client,data:e}}),t&&this.onSelected(this.user,this.client,e)}destroy(){if(this.isInit){this.isInit=!1,this.dataBus.publish(vi.send,{topic:vi.unwatch,uuid:this.uuid,path:this.path,msg:{type:Oo.destroy,userId:this.user.uuid,client:this.client}});for(let e of this.sub)e.cancel();this.sub=[],this.initIds={}}}},s2=class extends K4{constructor(e,t,s,r,i,n,a,o){super(e,t,o,s,i,n),this.channel=r,this.selectedProps=a,this.cache=new Map,this.deleteCache=new Map}rePublish(){var e,t,s,r;if(this.channel.canPush()){for(let[i,n]of this.cache)(t=(e=this.selectedProps)==null?void 0:e.onSelect)==null||t.call(e,n.user,i,n.data);for(let[i,n]of this.deleteCache)(r=(s=this.selectedProps)==null?void 0:s.onQuit)==null||r.call(s,n,i)}}getSelect(){var e,t;return((t=(e=this.selectedProps)==null?void 0:e.getSelect)==null?void 0:t.call(e))||""}onSelected(e,t,s){var r,i;this.channel.canPush()?!this.deleteCache.has(t)&&this.cache.set(t,{user:e,data:s}):(i=(r=this.selectedProps)==null?void 0:r.onSelect)==null||i.call(r,e,t,s)}onDestroy(e,t){var s,r;this.channel.canPush()?(this.deleteCache.set(t,e),this.cache.delete(t)):(r=(s=this.selectedProps)==null?void 0:s.onQuit)==null||r.call(s,e,t)}dispose(){this.destroy(),this.cache.clear(),this.deleteCache.clear()}publishSelected(e,t){super.publishSelected(e,t)}},X4=pu(id()),Z4=class{constructor(e,t,s,r=(b=>(b=Zh())==null?void 0:b._TAB_ID_)(),i=new cE,n=null,a,o,c,l,u,h,p,d,f,m,g){this.uuid=e,this.path=t,this.isProject=s,this.windowId=r,this.channel=i,this.consistencyManager=n,this.selectedProps=c,this.setInit=l,this.onDocDetail=u,this.onUpdate=h,this.handleInit=p,this.onDelete=d,this.publishCache=f,this.onOrderNm=m,this.setMaxNum=g,this.isInit=!1,this.canSave=!0,this.sub=[],this.isInitIng=!1,this.cache={},this.deleteCache=new Map,this.pendTimer=null,this.pendCache={},this.pendCacheLength=0,this.wsBus=au(`/${r}/notify`),n||(this._unique=qr()),this._headType=a,this.busTopic=o}get uniqueId(){return this._unique||this.consistencyManager.getUnique()}get headType(){return this._headType}setIsInitIng(e){var t;(t=this.setInit)==null||t.call(this,e),this.isInitIng=e}consoleDebug(...e){console.debug("[lc-protocol]",this._headType,this.uuid,...e)}publishLine(e,t,s,r,i,n=this.uuid,a,o,c,l,u){if(this.channel.canPush())return this.consistencyManager.remoteChange(t,i,n,e,s,r,void 0,void 0,void 0,a,void 0,o,c,u),!1;this.cache[n]||(this.cache[n]=new Map);let h=this.cache[n].get(e);return(l||!h||h.ticket<t||h.ticket===t&&(h.client<i||h.client===i&&!!h.pend!=!!a))&&this.cache[n].set(e,{client:i,ticket:t,dataType:r,data:s,pend:a,unique:o,pChange:h?void 0:c,num:u}),!0}onDocHead(){}onEnd(){}setDocType(e,t){e===this.uuid&&(this._headType=t)}setBusTopic(e){this.busTopic=e}publish(){var t,s,r;if(this.publishCache)return this.publishCache();let e=!1;for(let[i,n]of this.deleteCache){if(this.channel.canPush()){(t=this.onDelete)==null||t.call(this,n),delete this.cache[i];continue}e=!0;break}if(e)return e;for(let i in this.cache){let n=this.cache[i].keys();for(let a of n){let o=this.cache[i].get(a);if(e=this.publishLine(a,o.ticket,o.data,o.dataType,o.client,i,o.pend,o.unique,o.pChange,!1,o.num),e)break;this.cache[i].delete(a)}if(e)break}return(r=(s=this.selectManager)==null?void 0:s.rePublish)==null||r.call(s),e}publishSelected(e,t){this.selectManager.publishSelected(e,t)}clear(){var e,t;for(let s of this.sub)s.cancel();this.sub.length=0,this.cache={},this.deleteCache.clear(),this.setIsInitIng(!1),this.channel.removeCompiler(this),(t=(e=this.selectManager)==null?void 0:e.dispose)==null||t.call(e),this.selectManager=null,this.isInit=!1,this.setIsInitIng(!1)}async init(e=!0,t=!0,s=!0,r,i,n,a){try{if(this.isInit)return{success:!0};if(this.isInitIng)throw new Error("\u6B63\u5728\u521D\u59CB\u5316\u4E2D");return this.isProject?await this.initProject(e,t,s,r,n,a):await this.initLib(s,r,i,n,a)}catch(o){throw this.clear(),new Error(`${this._headType}+'Compiler' ${this.uuid} init false: ${(o==null?void 0:o.message)||o||""}`,{cause:o})}finally{this.isInitIng=!1}}async flowRead(e){let t=this.consistencyManager.flowParseFull(),s=t.update,r=this;t.update=i=>{if(r.isDestroy)return!0;s(i)},await(0,X4.flowRead)(e,t)}pushOnLine(e,t){if(this.consistencyManager)for(let s of e)this.publishLine(s[0],s[1],s[2],s[3],s[4],t,s[5],s[6],s[7],!1,s[8])}async initProject(e,t,s,r,i,n){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=au(`/${this.windowId}/project/${this.path}`),i&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,c=>{if(this.onOrderNm)for(let l of c)this.onOrderNm(l[0],l[1],l[2])})),s&&this.busTopic.projectUpdate&&this.sub.push(this.dataBus.subscribe(Sc(this.busTopic.projectUpdate,{uuid:this.uuid}),c=>{this.onUpdate?this.onUpdate(c):this.pushOnLine(c,this.uuid)})),s&&this.busTopic.projectCanSave&&this.sub.push(this.dataBus.subscribe(this.busTopic.projectCanSave,c=>{this.canSave=c})),s&&this.busTopic.subDelete&&this.sub.push(this.dataBus.subscribe(this.busTopic.subDelete,c=>{var l;this.channel.canPush()?(l=this.onDelete)==null||l.call(this,c):this.deleteCache.set(c[0],c)})),s&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(hs.subMaxTick,c=>{this.consistencyManager.setMaxTicket(c.ticket,c.force)})),s&&t&&this.sub.push(this.dataBus.subscribe(hs.subBlob,c=>{this.pushOnLine(c,"BLOB")})),s&&e&&this.sub.push(this.dataBus.subscribe(hs.subFont,c=>{this.pushOnLine(c,"FONT")})),s&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(Sc(hs.subRevoke,{uuid:this.uuid}),c=>this.revoke(c))),!this.busTopic.getProject)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");this.isDestroy=!1;let a={doc:[this.uuid],watch:s,needNum:i,needDelete:n};t&&a.doc.push("BLOB"),e&&a.doc.push("FONT");let o=await this.dataBus.rpcCall(this.busTopic.getProject,a);if(this.isWatch=s,!this.isDestroy){if(!o.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",o);if(this.canSave=!(o!=null&&o.readOnly),this.consoleDebug("init",o.result),o.maxTicket&&this.consistencyManager&&this.consistencyManager.setMaxTicket(o.maxTicket),o.data&&this.onDocDetail&&this.onDocDetail(o.client||qr(),0,o.data,!1),o.channel&&await this.flowRead(o.channel),!this.isDestroy){if(this.handleInit?this.handleInit(o):o.result&&this.consistencyManager&&this.consistencyManager.parseFull(o.result,this.uuid,this._headType),r){let c=this.user=this.user||o.user||await this.wsBus.rpcCall(hs.getUserL);this.selectManager=new s2(this.uuid,this.path,this.windowId,this.channel,this.dataBus,this.wsBus,this.selectedProps,c),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}}async initLib(e,t,s,r,i){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=au(`/${this.windowId}/libWorker`),!this.busTopic.getPerson)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");let n=s?qr():"";this.isDestroy=!1;let a=await this.dataBus.rpcCall(this.busTopic.getPerson,{uuid:this.uuid,path:this.path,watch:e,channel:n,needNum:r,needDelete:i});if(this.isWatch=e,this.isDestroy)return;if(!a.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",a);this.consoleDebug("init",a.dataStr);let o=a.data||a.result;if(o&&this.onDocDetail&&this.onDocDetail(a.client||qr(),0,o,!1),r&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,c=>{if(this.onOrderNm)for(let l of c)this.onOrderNm(l[0],l[1],l[2])})),e&&this.busTopic.personUpdate&&this.sub.push(this.dataBus.subscribe(Sc(this.busTopic.personUpdate,{uuid:this.uuid}),c=>{this.pushOnLine(c,this.uuid)})),e&&this.sub.push(this.dataBus.subscribe(Sc(Sc(hs.subRevoke,{uuid:this.uuid}),{uuid:this.uuid}),c=>this.revoke(c))),n&&await this.flowRead(n),!this.isDestroy){if(a.dataStr&&this.consistencyManager&&this.consistencyManager.parseFull(a.dataStr),t){let c=this.user=this.user||a.user||await this.wsBus.rpcCall(hs.getUserL);this.selectManager=new s2(this.uuid,this.path,this.windowId,this.channel,this.wsBus,this.wsBus,this.selectedProps,c),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}revoke(e){for(let t of e)this.consistencyManager&&this.consistencyManager.revoke(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],(...s)=>this.publishLine(...s)),t[10]&&this.setMaxNum&&this.setMaxNum(t[6],t[10],t[1])}cachePendData(e,t,s,r,i,n){this.pendCache[e]||(this.pendCache[e]={type:n,pend:[]}),this.pendCache[e].pend.push([t,s,i,r]),this.pendCacheLength+=r.length+1,this.pendCacheLength>1e7&&this.publishPendData(),this.pendTimer||(this.pendTimer=setTimeout(()=>{this.publishPendData(),this.pendTimer=null},0))}publishPendData(){if(this.pendCacheLength){this.dataBus.publish(hs.pushPend,[this.pendCache,this.consistencyManager.getClient(),this.uniqueId,this.uuid]);for(let e in this.pendCache)this.pendCache[e].pend.length=0;this.pendCache={},this.pendCacheLength=0}}localChange(e,t,s,r=this.uuid,i,n){if(!this.isInit||!this.canSave||!this.consistencyManager)return 0;if(t&&!t.startsWith("{"))return console.error("\u4E0A\u4F20\u7684\u683C\u5F0F\u4E0D\u6B63\u786E",e,s,t),0;let a=this.consistencyManager.localChange(r,e,t,s,i,n);return this.cachePendData(r,e,a,t,s,i||this.headType),a}async sync(){if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u540C\u6B65");let e=qr();this.dataBus.publish(hs.pushSync,e),await this.dataBus.pullA(Sc(hs.pullASync,{id:e}))}async destroy(){return this.isDestroy?{success:!1}:(this.consistencyManager&&this.dataBus&&this.dataBus.publish(hs.pushRevoke,[this.uuid,this.uniqueId,this.consistencyManager.getClient()]),this.clear(),this.isDestroy=!0,this.isWatch&&this.dataBus&&!this.isProject&&this.dataBus.publish(hs.personDestroy,{uuid:this.uuid,path:this.path}),this.isWatch&&this.dataBus&&this.busTopic.unwatch&&this.dataBus.publish(this.busTopic.unwatch,this.uuid),this.isWatch=!1,{success:!0})}async save(e=[this.uuid,"BLOB","FONT"]){try{if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u4FDD\u5B58");if(!this.consistencyManager)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let t=this.isProject?hs.projectSave:hs.personSave;if(!t)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let s=await this.dataBus.rpcCall(t,{uuid:this.uuid,path:this.path,docIds:e,uniqueId:this.uniqueId,client:this.consistencyManager.getClient()});return this.consoleDebug("save",s),s}catch(t){throw new Error(`${this._headType}+'Compiler' ${this.uuid} \u4FDD\u5B58\u5931\u8D25: ${(t==null?void 0:t.message)||t||""}`,{cause:t})}}async getBlob(e){return this.dataBus.rpcCall("/mgr/projectWorker/blob/getBlob",e)}async getFont(e,t,s,r,i,n,a,o){let c={text:e,fontFamily:t,fontSize:s,thickness:r,bold:i,italic:n,reverse:a,expansion:o},l=await this.dataBus.rpcCall("/mgr/projectWorker/font/get",c);return l.success?{success:!0,result:Object.assign(c,JSON.parse(l.result))}:l}async checkSave(){return await this.dataBus.rpcCall(hs.hasSaveData,{uuid:this.uuid,uniqueId:this.uniqueId})}};var $4=(e=>(e.DIFFERENTIAL_PAIR="DIFFERENTIAL_PAIR",e.NET_CLASS="NET_CLASS",e.EQL_NET_GRP="EQL_NET_GRP",e))($4||{});var Q4=class extends aS{constructor(e){super(e)}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var XG=pu(id());var ZG=pu(id());var e5=class extends aS{constructor(e,t,s,r,i,n,a,o=(c=>(c=Zh())==null?void 0:c._TAB_ID_)()){let l=new C2(o);super(l),this.encode=n,this.base=new Z4(e,t,s,o,r,l,i,i==="PCB"?J4:q4,a,(...u)=>this.setIsInit(...u),(...u)=>this.onDocDetail(...u),void 0,void 0,void 0,void 0,(u,h,p)=>this.onOrderNum(u,h,p),(u,h,p)=>{this.setMaxNum(u,h,!!p),p&&this.deleteOrderNum(p)})}get dataBus(){return this.base.dataBus}set dataBus(e){this.base.dataBus=e}async init(e=!0,t=!0,s=!0,r,i=!0,n){return this.setNeedNum(i),this.base.init(e,t,s,r,!0,i,n)}async sync(){return this.base.sync()}async destroy(){return this.base.destroy()}async save(){return this.base.save()}checkSave(){return this.base.checkSave()}publishSelected(e,t){this.base.publishSelected(e,t)}uploadBlob(e,t){let s=Fm(t),r={filename:e,content:t};return{success:!0,ticket:this.localChange({id:s,data:JSON.stringify(r),dataType:"BLOB"},"BLOB","BLOB"),hash:s}}deleteBlob(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"BLOB"},"BLOB","BLOB")}}uploadFont(e){let{text:t,fontFamily:s,fontSize:r,thickness:i,bold:n,italic:a,reverse:o,expansion:c,width:l,height:u,path:h}=e,p={width:l,height:u,path:h},d=_1(t,s,r,i,n,a,o,c);return{success:!0,ticket:this.localChange({id:d,data:JSON.stringify(p),dataType:"FONT"},"FONT","FONT")}}deleteFont(e){let{text:t,fontFamily:s,fontSize:r,thickness:i,bold:n,italic:a,reverse:o,expansion:c}=e,l=_1(t,s,r,i,n,a,o,c);return{success:!0,ticket:this.localChange({id:l,data:"",dataType:"FONT"},"FONT","FONT")}}localChange(e,t=this.base.uuid,s){var i,n;let r=this.getOrderNum(e.id);return(n=(i=this.needOrderType)==null?void 0:i.includes)!=null&&n.call(i,e.dataType)&&r===void 0&&(r=this.getMaxNum(e.dataType),this.setOrderNum(e.id,r,e.dataType),this.onOrderNum(e.id,e.dataType,r)),this.base.localChange(e.id,e.data,e.dataType,t,s,r)}uploadString(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeString(e,t))}}deleteString(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"STRING"})}}uploadAttr(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeAttr(e,t))}}deleteAttr(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"ATTR"})}}uploadPanelize(e){return{success:!0,ticket:this.localChange(this.encode.encodePanelize(e))}}deletePanelize(){return{success:!0,ticket:this.localChange({id:"PANELIZE",data:"",dataType:"PANELIZE"})}}uploadRuleSelector(e){return{success:!0,ticket:this.localChange(this.encode.encodeRuleSelector(e))}}deleteRuleSelector(e){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE_SELECTOR",e]),data:"",dataType:"RULE_SELECTOR"})}}uploadRule(e){return{success:!0,ticket:this.localChange(this.encode.encodeRule(e))}}deleteRule(e,t){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE",e,t]),data:"",dataType:"RULE"})}}uploadRuleTemplate(e){return{success:!0,ticket:this.localChange(this.encode.encodeRuleTemplate(e))}}uploadDimension(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeDimension(e,t))}}deleteDimension(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"DIMENSION"})}}uploadBoss(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeBoss(e,t))}}deleteBoss(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"BOSS"})}}uploadShellEntity(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShellEntity(e,t))}}deleteShellEntity(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELL_ENTITY"})}}uploadShellCut(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShellCut(e,t))}}deleteShellCut(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELLCUT"})}}uploadCrease(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeCrease(e,t))}}deleteCrease(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"CREASE"})}}uploadShell(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShell(e,t))}}deleteShell(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELL"})}}uploadFpcFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeFpcFill(e,t))}}deleteFpcFill(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"FPC_FILL"})}}uploadTeardrop(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeTeardrop(e,t))}}deleteTeardrop(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"TEARDROP"})}}uploadImage(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeImage(e,t))}}deleteImage(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"IMAGE"})}}uploadPoured(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePoured(e,t))}}deletePoured(e){return{success:!0,ticket:this.localChange({id:Li(e,"POURED"),data:"",dataType:"POURED"})}}uploadPour(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePour(e,t))}}deletePour(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"POUR"})}}uploadRegion(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeRegion(e,t))}}deleteRegion(e){let t=this.localChange({id:e,data:"",dataType:"REGION"});return this.onDelRegion(e,this.consistencyManager.getClient(),t,!0),{success:!0,ticket:t}}uploadFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeFill(e,t))}}deleteFill(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"FILL"})}}uploadLayerFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayerFill(e,t))}}deleteLayerFill(e){return{success:!0,ticket:this.localChange({id:Li(e,"LAYER_FILL"),data:"",dataType:"LAYER_FILL"})}}uploadPoly(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePoly(e,t))}}deletePoly(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"POLY"})}}uploadEQLenGrp(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeEQLenGrp(e,t))}}deleteEQLenGrp(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"EQLEN_GRP"})}}uploadObj(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeObj(e,t))}}deleteObj(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"OBJ"})}}uploadArc(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeArc(e,t))}}deleteArc(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"ARC"})}}uploadLine(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLine(e,t))}}deleteLine(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"LINE"})}}uploadPad(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePad(e,t))}}deletePad(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"PAD"})}}uploadVia(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeVia(e,t))}}deleteVia(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"VIA"})}}uploadPreference(e){return{success:!0,ticket:this.localChange(this.encode.encodePreference(e))}}uploadSilkOpts(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeSilkOpts(e,t))}}deleteSilkOpts(e){return{success:!0,ticket:this.localChange({id:Li(e,"SILK_OPTS"),data:"",dataType:"SILK_OPTS"})}}uploadGroup(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeGroup(e,t))}}deleteGroup(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"GROUP"})}}uploadPrimitive(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePrimitive(e,t))}}deletePrimitive(e){return{success:!0,ticket:this.localChange({id:Li(e,"PRIMITIVE"),data:"",dataType:"PRIMITIVE"})}}uploadNet(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeNet(e,t))}}deleteNet(e){return{success:!0,ticket:this.localChange({id:Li(e,"NET"),data:"",dataType:"NET"})}}uploadActiveLayer(e){return{success:!0,ticket:this.localChange(this.encode.encodeActiveLayer(e))}}uploadLayerPhys(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayerPhys(e,t))}}deleteLayerPhys(e){return{success:!0,ticket:this.localChange({id:Li(e,"LAYER_PHYS"),data:"",dataType:"LAYER_PHYS"})}}uploadLayer(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayer(e,t))}}deleteLayer(e){return{success:!0,ticket:this.localChange({id:Li(e,"LAYER"),data:"",dataType:"LAYER"})}}uploadCanvas(e){return{success:!0,ticket:this.localChange(this.encode.encodeCanvas(e))}}uploadBoard(e){return{success:!0,ticket:this.localChange({id:"BOARD",data:JSON.stringify(e),dataType:"BOARD"})}}deleteBoard(){return{success:!0,ticket:this.localChange({id:"BOARD",data:"",dataType:"BOARD"})}}};var oS=class extends e5{constructor(e,t,s,r,i=(n=>(n=Zh())==null?void 0:n._TAB_ID_)()){super(e,t,s,r,"FOOTPRINT",new nS,{getSelect:()=>{var a;return(a=this.canvasSelected)==null?void 0:a.call(this)},onSelect:(...a)=>{var o;return(o=this.onSelectChange)==null?void 0:o.call(this,a[0],a[1],a[2])},onQuit:(...a)=>{var o;return(o=this.onSelectQuit)==null?void 0:o.call(this,a[0],a[1])}},i),this.uuid=e,this.path=t,this.isProject=s,this.windowId=i}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var t5=class extends Q4{constructor(){super(...arguments),this.data={}}onBoard(e,t,s,r){}onDelBoard(e,t,s){}onLayerFill(e,t,s,r,i){}onDelLayerFill(e,t,s,r){}onBlob(e,t,s,r,i){}onDelBlob(e,t,s,r){}onFont(e,t,s,r){}onDelFont(e,t,s,r){}onString(e,t,s,r,i,n){this.data[e]=i}onDelString(e,t,s,r){delete this.data[e]}onStringNum(e,t){}onAttr(e,t,s,r,i,n){this.data[e]=i}onDelAttr(e,t,s,r){delete this.data[e]}onAttrNum(e,t){}onPanelizeSide(e,t,s,r){}onDelPanelizeSide(e,t,s,r){}onPanelizeStamp(e,t,s,r){}onDelPanelizeStamp(e,t,s,r){}onPanelize(e,t,s,r){}onDelPanelize(e,t,s){}onRuleSelector(e,t,s,r){}onDelRuleSelector(e,t,s,r){}onRule(e,t,s,r){}onDelRule(e,t,s,r,i){}onRuleTemplate(e,t,s,r){}onDimension(e,t,s,r,i,n){this.data[e]=i}onDelDimension(e,t,s,r){delete this.data[e]}onDimensionNum(e,t){}onBoss(e,t,s,r,i,n){this.data[e]=i}onDelBoss(e,t,s,r){delete this.data[e]}onBossNum(e,t){}onShellEntity(e,t,s,r,i,n){this.data[e]=i}onDelShellEntity(e,t,s,r){}onShellEntityNum(e,t){}onShellCut(e,t,s,r,i,n){this.data[e]=i}onDelShellCut(e,t,s,r){delete this.data[e]}onShellCutNum(e,t){}onCrease(e,t,s,r,i,n){this.data[e]=i}onDelCrease(e,t,s,r){delete this.data[e]}onCreaseNum(e,t){}onShell(e,t,s,r,i,n){this.data[e]=i}onDelShell(e,t,s,r){delete this.data[e]}onShellNum(e,t){}onFpcFill(e,t,s,r,i,n){this.data[e]=i}onDelFpcFill(e,t,s,r){delete this.data[e]}onFpcFillNum(e,t){}onTeardrop(e,t,s,r,i,n){this.data[e]=i}onDelTeardrop(e,t,s,r){delete this.data[e]}onTeardropNum(e,t){}onImage(e,t,s,r,i,n){this.data[e]=i}onDelImage(e,t,s,r){delete this.data[e]}onImageNum(e,t){}onPoured(e,t,s,r,i,n){this.data[e]=i}onDelPoured(e,t,s,r){delete this.data[e]}onPouredNum(e,t){}onPour(e,t,s,r,i,n){this.data[e]=i}onDelPour(e,t,s,r){delete this.data[e]}onPourNum(e,t){}onRegion(e,t,s,r,i,n){this.data[e]=i}onDelRegion(e,t,s,r){delete this.data[e]}onRegionNum(e,t){}onFill(e,t,s,r,i,n){this.data[e]=i}onDelFill(e,t,s,r){delete this.data[e]}onFillNum(e,t){}onPoly(e,t,s,r,i,n){this.data[e]=i}onDelPoly(e,t,s,r){delete this.data[e]}onPolyNum(e,t){}onEQLenGrp(e,t,s,r,i){this.data[e]=r}onDelEQLenGrp(e,t,s,r){delete this.data[e]}onDelProp(e,t,s,r){delete this.data[e]}onObj(e,t,s,r,i,n){this.data[e]=i}onDelObj(e,t,s,r){delete this.data[e]}onObjNum(e,t){}onArc(e,t,s,r,i,n){this.data[e]=i}onDelArc(e,t,s,r){delete this.data[e]}onArcNum(e,t){}onCArc(e,t,s,r,i,n){this.data[e]=i}onDelCArc(e,t,s,r){delete this.data[e]}onCArcNum(e,t){}onLine(e,t,s,r,i,n){this.data[e]=i}onDelLine(e,t,s,r){delete this.data[e]}onLineNum(e,t){}onPad(e,t,s,r,i,n){this.data[e]=i}onDelPad(e,t,s,r){delete this.data[e]}onPadNum(e,t){}onVia(e,t,s,r,i,n){this.data[e]=i}onDelVia(e,t,s,r){delete this.data[e]}onViaNum(e,t){}onDelConnect(e,t,s,r){}onPreference(e,t,s,r){}onSilkOpts(e,t,s,r,i){this.data[e]=r}onDelSilkOpts(e,t,s,r){delete this.data[e]}onGroup(e,t,s,r,i){this.data[e]=r}onDelGroup(e,t,s,r){delete this.data[e]}onPrimitive(e,t,s,r,i){}onDelPrimitive(e,t,s,r){}onNet(e,t,s,r,i){}onDelNet(e,t,s,r){}onPartition(e,t,s,r,i,n){this.data[e]=i}onDelPartition(e,t,s,r){delete this.data[e]}onPartitionNum(e,t){}onEditorMeta(e,t,s,r){}onDocDetail(e,t,s,r){}onActiveLayer(e,t,s,r){}onLayerPhys(e,t,s,r,i){this.data[e]=r}onDelLayerPhys(e,t,s,r){delete this.data[e]}onLayer(e,t,s,r,i){this.data[e]=r}onDelLayer(e,t,s,r){}onCanvas(e,t,s,r){}},s5=class extends oS{onBoard(e,t,s,r){}onDelBoard(e,t,s){}onLayerFill(e,t,s,r,i){}onDelLayerFill(e,t,s,r){}constructor(e,t,s,r){super(e,t,s,new cE,r)}canvasSelected(){return""}onSelectChange(e,t,s){}onSelectQuit(e,t){}async getByDataType(e){let t="";if(this.isProject?(this.dataBus=this.dataBus||au(`/${this.windowId}/project/${this.path}`),t=await this.dataBus.rpcCall("/mgr/projectWorker/getDataByType",{doc:this.uuid,dataType:e})):(this.dataBus=this.dataBus||au(`/${this.windowId}/libWorker`),t=await this.dataBus.rpcCall("/mgr/libWorker/getDataByType",{uuid:this.uuid,path:this.path,dataType:e,docType:"FOOTPRINT"})),!t)return{};let s=new t5;return s.consistencyManager.parseFull(t,this.uuid,"FOOTPRINT"),s.data}async getPads(){return this.getByDataType("PAD")}onBlob(e,t,s,r,i){}onDelBlob(e,t,s,r){}onFont(e,t,s,r){}onDelFont(e,t,s,r){}onString(e,t,s,r,i,n){}onDelString(e,t,s,r){}onStringNum(e,t){}onAttr(e,t,s,r,i,n){}onDelAttr(e,t,s,r){}onAttrNum(e,t){}onPanelizeSide(e,t,s,r){}onDelPanelizeSide(e,t,s,r){}onPanelizeStamp(e,t,s,r){}onDelPanelizeStamp(e,t,s,r){}onPanelize(e,t,s,r){}onDelPanelize(e,t,s){}onRuleSelector(e,t,s,r){}onDelRuleSelector(e,t,s,r){}onRule(e,t,s,r){}onDelRule(e,t,s,r,i){}onRuleTemplate(e,t,s,r){}onDimension(e,t,s,r,i,n){}onDelDimension(e,t,s,r){}onDimensionNum(e,t){}onBoss(e,t,s,r,i,n){}onDelBoss(e,t,s,r){}onBossNum(e,t){}onShellEntity(e,t,s,r,i,n){}onDelShellEntity(e,t,s,r){}onShellEntityNum(e,t){}onShellCut(e,t,s,r,i,n){}onDelShellCut(e,t,s,r){}onShellCutNum(e,t){}onCrease(e,t,s,r,i,n){}onDelCrease(e,t,s,r){}onCreaseNum(e,t){}onShell(e,t,s,r,i,n){}onDelShell(e,t,s,r){}onShellNum(e,t){}onFpcFill(e,t,s,r,i,n){}onDelFpcFill(e,t,s,r){}onFpcFillNum(e,t){}onTeardrop(e,t,s,r,i,n){}onDelTeardrop(e,t,s,r){}onTeardropNum(e,t){}onImage(e,t,s,r,i,n){}onDelImage(e,t,s,r){}onImageNum(e,t){}onPoured(e,t,s,r,i,n){}onDelPoured(e,t,s,r){}onPouredNum(e,t){}onPour(e,t,s,r,i,n){}onDelPour(e,t,s,r){}onPourNum(e,t){}onRegion(e,t,s,r,i,n){}onDelRegion(e,t,s,r){}onRegionNum(e,t){}onFill(e,t,s,r,i,n){}onDelFill(e,t,s,r){}onFillNum(e,t){}onPoly(e,t,s,r,i,n){}onDelPoly(e,t,s,r){}onPolyNum(e,t){}onEQLenGrp(e,t,s,r,i){}onDelEQLenGrp(e,t,s,r){}onDelProp(e,t,s,r){}onObj(e,t,s,r,i,n){}onDelObj(e,t,s,r){}onObjNum(e,t){}onArc(e,t,s,r,i,n){}onDelArc(e,t,s,r){}onArcNum(e,t){}onCArc(e,t,s,r,i,n){}onDelCArc(e,t,s,r){}onCArcNum(e,t){}onLine(e,t,s,r,i,n){}onDelLine(e,t,s,r){}onLineNum(e,t){}onPad(e,t,s,r,i,n){}onDelPad(e,t,s,r){}onPadNum(e,t){}onVia(e,t,s,r,i,n){}onDelVia(e,t,s,r){}onViaNum(e,t){}onDelConnect(e,t,s,r){}onPreference(e,t,s,r){}onSilkOpts(e,t,s,r,i){}onDelSilkOpts(e,t,s,r){}onGroup(e,t,s,r,i){}onDelGroup(e,t,s,r){}onPrimitive(e,t,s,r,i){}onDelPrimitive(e,t,s,r){}onNet(e,t,s,r,i){}onDelNet(e,t,s,r){}onPartition(e,t,s,r,i,n){}onDelPartition(e,t,s,r){}onPartitionNum(e,t){}onEditorMeta(e,t,s,r){}onDocDetail(e,t,s,r){}onActiveLayer(e,t,s,r){}onLayerPhys(e,t,s,r,i){}onDelLayerPhys(e,t,s,r){}onLayer(e,t,s,r,i){}onDelLayer(e,t,s,r){}onCanvas(e,t,s,r){}},cS=(e=>(e.LIST="/pro-mgr/api/project/list",e.CREATE="/pro-mgr/api/project/create",e.GET="/pro-mgr/api/project/get",e.UPDATE="/pro-mgr/api/project/update",e.DELETE="/pro-mgr/api/project/delete",e.TICKET="/pro-mgr/api/project/ticket",e.TICKET1="/pro-mgr/api/project/ticket1",e.BACKUP_LIST="/pro-mgr/api/project/backupList",e.BACKUP="/pro-mgr/api/project/backup",e.GET_BACKUP="/pro-mgr/api/project/getBackup",e.DELETE_BACKUP="/pro-mgr/api/project/deleteBackup",e.ARCHIVE="/pro-mgr/api/project/archive",e.CREATE_BOARD="/pro-mgr/api/project/createBoards",e.STAR="/pro-mgr/api/project/star",e.UNSTAR="/pro-mgr/api/project/unstar",e.GET_PROFILE="/pro-mgr/api/project/getProfile",e))(cS||{}),lS=(e=>(e.LIST="/pro-mgr/api/schematic/list",e.CREATE="/pro-mgr/api/schematic/create",e.UPLOAD="/pro-mgr/api/schematic/upload",e.DELETE="/pro-mgr/api/schematic/delete",e.UPDATE="/pro-mgr/api/schematic/update",e))(lS||{}),uS=(e=>(e.LIST="/pro-mgr/api/document/list",e.SEARCH_LIST="/pro-mgr/api/document/searchList",e.CREATE="/pro-mgr/api/document/create",e.UPLOAD="/pro-mgr/api/document/upload",e.UPDATE="/pro-mgr/api/document/update",e.BATCH_UPDATE="/pro-mgr/api/document/batchUpdate",e.DELETE="/pro-mgr/api/document/delete",e.GET="/pro-mgr/api/document/get",e.GET_BY_SID="/pro-mgr/api/document/getBySid",e.MOVE="/pro-mgr/api/document/move",e.CHECK_IN="/pro-mgr/api/document/checkIn",e.CHECK_OUT="/pro-mgr/api/document/checkOut",e.GET_CHECK="/pro-mgr/api/document/getCheck",e.DELETE_PCB_RELATED="/pro-mgr/api/document/deletePcbRelated",e))(uS||{}),hS=(e=>(e.LIST="/pro-mgr/api/device/list",e.SEARCH_LIST="/pro-mgr/api/device/searchList",e.CREATE="/pro-mgr/api/device/create",e.UPLOAD="/pro-mgr/api/device/upload",e.UPDATE="/pro-mgr/api/device/update",e.BATCH_UPDATE="/pro-mgr/api/device/batchUpdate",e.GET="/pro-mgr/api/device/get",e.SEARCH_BY_USERS_AND_TITLES="/pro-mgr/api/device/searchByUsersAndTitles",e.GET_ATTR_VALUES="/pro-mgr/api/device/getAttributeValues",e.GET_ATTR_KEYS="/pro-mgr/api/device/getAttrKeys",e.DELETE="/pro-mgr/api/device/delete",e.STAR="/pro-mgr/api/device/star",e.UNSTAR="/pro-mgr/api/device/unstar",e.PLACE="/pro-mgr/api/device/place",e))(hS||{}),dS=(e=>(e.LIST="/pro-mgr/api/component/list",e.SEARCH_LIST="/pro-mgr/api/component/searchList",e.CREATE="/pro-mgr/api/component/create",e.UPLOAD="/pro-mgr/api/component/upload",e.UPDATE="/pro-mgr/api/component/update",e.BATCH_UPDATE="/pro-mgr/api/component/batchUpdate",e.DELETE="/pro-mgr/api/component/delete",e.GET="/pro-mgr/api/component/get",e.SEARCH_BY_USERS_AND_TITLES="/pro-mgr/api/component/searchByUsersAndTitles",e.STAR="/pro-mgr/api/component/star",e.UNSTAR="/pro-mgr/api/component/unstar",e.GET_HISTORY="/pro-mgr/api/component/getHistory",e.SET_HISTORY="/pro-mgr/api/component/setHistory",e.GET_HISTORY_DATA="/pro-mgr/api/component/getHistoryData",e))(dS||{}),pS=(e=>(e.LIST="/pro-mgr/api/tag/list",e.CREATE="/pro-mgr/api/tag/create",e.UPDATE="/pro-mgr/api/tag/update",e.DELETE="/pro-mgr/api/tag/delete",e))(pS||{}),fS=(e=>(e.SEARCH_LIST="/pro-mgr/api/copper/searchList",e.SET="/pro-mgr/api/copper/set",e.DELETE="/pro-mgr/api/copper/delete",e))(fS||{}),mS=(e=>(e.SEARCH_LIST="/pro-mgr/api/font/searchList",e.SET="/pro-mgr/api/font/set",e.DELETE="/pro-mgr/api/font/delete",e))(mS||{}),gS=(e=>(e.SEARCH_LIST="/pro-mgr/api/blob/searchList",e.SET="/pro-mgr/api/blob/set",e))(gS||{}),yS=(e=>(e.LIST="/pro-mgr/api/attr/list",e.SEARCH_LIST="/pro-mgr/api/attr/searchList",e.CREATE="/pro-mgr/api/attr/create",e.UPLOAD="/pro-mgr/api/attr/upload",e.DELETE="/pro-mgr/api/attr/delete",e.TICKET="/pro-mgr/api/attr/ticket",e))(yS||{}),ES=(e=>(e.GET_BACKUP="/pro-mgr/api/client/getBackup",e.GET_LIBS="/pro-mgr/api/client/getLibs",e.CREATE_LIB="/pro-mgr/api/client/createLib",e.CREATE_PROJECT="/pro-mgr/api/client/createProject",e.OPEN_PROJECT="/pro-mgr/api/client/openProject",e.CLOSE_PROJECT="/pro-mgr/api/client/closeProject",e.GET_PROJECT_PATHS="/pro-mgr/api/client/getProjectPaths",e.SELECT_PATH="/pro-mgr/api/client/selectPath",e.OPEN_DIALOG="/pro-mgr/api/client/openDialog",e.SELECT_DIR="/pro-mgr/api/client/selectDir",e.SELECT_FILE="/pro-mgr/api/client/selectFile",e.EXPORT_FILE="/pro-mgr/api/client/exportFile",e.CACHE_LIST="/pro-mgr/api/client/cacheList",e.GET_CACHE="/pro-mgr/api/client/getCache",e.SET_CACHE="/pro-mgr/api/client/setCache",e.DELETE_CACHE="/pro-mgr/api/client/deleteCache",e.PROJECT_HISTORY="/pro-mgr/api/client/projectHistory",e.DELETE_HISTORY="/pro-mgr/api/client/deletHistory",e.SET_KV_CACHE="/pro-mgr/api/client/setKVCache",e.GET_KV_CACHE="/pro-mgr/api/client/getKVCache",e.IS_EXIST_KV_CACHE="/pro-mgr/api/client/isExistKVCache",e.OPEN_URL="/pro-mgr/api/client/openURL",e))(ES||{}),bS=(e=>(e.LOG="/pro-mgr/api/other/log",e.COMPONENT_LOG="/pro-mgr/api/other/componentLog",e.TEAMS="/pro-mgr/api/other/teams",e.GET_EDITOR_VERSION="/pro-mgr/api/other/getEditorVersion",e.SET_EDITOR_VERSION="/pro-mgr/api/other/setEditorVersion",e))(bS||{}),Me={PROJECT:cS,SCHEMATIC:lS,DOCUMENT:uS,DEVICE:hS,COMPONENT:dS,TAG:pS,COPPER:fS,FONT:mS,BLOB:gS,ATTR:yS,CLIENT:ES,OTHER:bS},lE=(e=>(e.GET_DATA_STR="/pro-mgr/public/getDataStr",e))(lE||{}),$f=sd(rd()),Hh={bus:void 0,get messageBus(){if(Hh.bus===void 0)if(typeof window<"u"){let e=du();e._MSG_BUS_=e._MSG_BUS_||new $f.MessageBus,Hh.bus=e._MSG_BUS_}else self._WORKER_BUS_=self._WORKER_BUS_||new $f.WorkerMessageBridge(new $f.MessageBus,self),Hh.bus=self._WORKER_BUS_;return Hh.bus},get messageBus2(){return self._MSG_BUS2_=self._MSG_BUS2_||new $f.MessageBus2},loginedUserUuid:void 0},Je=Hh,r5=(e=>(e.BOTTOM_COMPONENT_LIB="BOTTOM_COMPONENT_LIB",e.DIALOG="DIALOG",e))(r5||{}),i5=["S","F","P","3D"],n5=["F","3D"],Kt=(e=>(e.ZIP=".zip",e.PRJ=".epro",e.PRJ2=".epro2",e.EPRU=".epru",e.SCH=".esch",e.PCB=".epcb",e.PANEL=".epan",e.PANEL_LIB=".epanl",e.SYMBOL=".esym",e.FOOTPRINT=".efoo",e.INSTANCE=".eins",e.COPPER=".ecop",e.BLOB=".eblob",e.FONT=".efon",e.ELIBZ=".elibz",e.ELIBZ2=".elibz2",e.ELIBU=".elibu",e.IMAGE=".webp",e))(Kt||{}),fu="|",a5=/^[^|]+(\|[^|]+)?$/,ki=(e=>(e.Board="Board",e.Schematic="Schematic",e.Sheet="Sheet",e.Pcb="Pcb",e.Panel="Panel",e.SchCanvas="SchCanvas",e.PcbCanvas="PcbCanvas",e.PanelCanvas="PanelCanvas",e))(ki||{}),ud=(e=>(e.Device="Device",e.Symbol="Symbol",e.Footprint="Footprint",e))(ud||{}),r2=[{value:"",text:"All"},{value:2,text:"Component"},{value:20,text:{content:"symbolType",value:"Drawing",options:null}},{value:18,text:"Net Flag"},{value:19,text:"Net Port"},{value:25,text:"Off Page Connector"},{value:31,text:"Differential Pairs Flag"},{value:21,text:{content:"symbolType",value:"Non-Electronic Flag",options:null}},{value:22,text:"Short Flag"}],i2=[{value:"",text:"All"},{value:2,text:"Component Symbol"},{value:20,text:"Drawing Symbol"},{value:18,text:"Netflag Symbol"},{value:19,text:"Netport Symbol"},{value:25,text:"Off Page Connector Symbol"},{value:31,text:"Differential Pairs Flag Symbol"},{value:21,text:"Non-Electronic Symbol"},{value:22,text:"Short Flag"}],o5=["S"],c5=["S"],l5=["S"],u5=["3D"],h5={footprint:n5,device:i5,symbol:o5,model3D:u5,panelLib:c5,cbb:l5,modelSimLib:[]};async function TS(e){let t=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(r=>r.toString(16).padStart(2,"0")).join("")}var wS=[2,20,18,19,21,22,17,25,31];function Pm(e){return e&&wS.indexOf(e)>=0}function SS(e){return wS.indexOf(e)>=0&&e!==17}function d5(e){return e===""?!1:!!(e&&a5.test(e))}var p5=async e=>{let{keys:t,values:s}=_S(e);return await TS([...t,...s].sort().join(""))},_S=e=>{let t=new Set,s=new Set;for(let r in e){let i=e[r];if(t.add(r),Array.isArray(i))s.add(JSON.stringify(i.sort()));else if(Object.prototype.toString.call(i)==="[object Object]"){let{keys:n,values:a}=_S(i);t=new Set([...t,...n]),s=new Set([...s,...a])}else s.add(JSON.stringify(i))}return{keys:t,values:s}};function n2(e){let{uuid:t,path:s}=e;return t?t+(s?`${fu}${s}`:""):void 0}function f5(e){let{source:t,path:s}=e;return t+(s?`${fu}${s}`:"")}async function lm(e,t){if(t)return t;let{updateTime:s}=e;return s?String(s):await p5(e)}async function Ln(e){let{data:t,force:s=!0,defalut:r}=e,{source:i,version:n}=t;i?(d5(i)||(t.source=n2(t)),i.includes(fu)||(t.source=f5(t)),n?n==="1"&&(t.version=await lm(t)):t.version=await lm(t,r)):s&&(t.source=n2(t),t.version=await lm(t,r))}async function Gm(e,t){e.version=await lm(e,t)}function Ym(e,t){let{title:s}=e;return s||(s=`${t?t+"_":""}${AS(!1,4,4)}`),e.title=s,e.title}function AS(e,t,s){t=t||1,s=s||32;var r="",i=t,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(i=Math.round(Math.random()*(s-t))+t);for(var a=0;a<i;a++){let o=Math.round(Math.random()*(n.length-1));r+=n[o]}return r}async function CS(e){if(!e)return[];let{tags:t,custom_tags:s}=e;if(s){try{let r=JSON.parse(s);if(Array.isArray(r))return r}catch{}return s.split(":")}if(Array.isArray(e.tags))return e.tags;if(t&&JSON.stringify(t)!=="[]"){let{message:r}=await Je.messageBus.rpcCall("isEn"),i=t,n=[];if(i.parent_tag){let{name:a,name_cn:o}=i.parent_tag;if(r&&a?n.push(a):!r&&o?n.push(o):a&&n.push(a),i.child_tag){let{name:c,name_cn:l}=i.child_tag;r&&c?n.push(c):!r&&l?n.push(l):c&&n.push(c)}}return n}return[]}function DS(){let e=navigator.userLanguage||navigator.language;return e&&e.includes("zh")?"zh-cn":"en"}function Va(e){let{tags:t,custom_tags:s="[]"}=e;if((!s||s==="[]")&&t){if(Array.isArray(t)&&t.length)s=JSON.stringify(t);else if(Object.prototype.toString.call(t)==="[object Object]"){let r=DS()==="en",i=[];if(t.parent_tag){let{name:n,name_cn:a}=t.parent_tag;if(r&&n?i.push(n):!r&&a?i.push(a):n&&i.push(n),t.child_tag){let{name:o,name_cn:c}=t.child_tag;r&&o?i.push(o):!r&&c?i.push(c):o&&i.push(o)}}s=JSON.stringify(i)}}return e.custom_tags=s,e.custom_tags}function Ke(e){return String(e).length===13?Number(e):String(e).length===10?Number(e)*1e3:Number(e)}var PS=(e=>e)(PS||{}),OS=(e=>(e.GET="/PrjDB/project/getData",e.UPDATE="/PrjDB/project/updateData",e.COUNT_DOC="/PrjDB/project/countDoc",e.GET_HISTORY_NODE="/PrjDB/project/getHistoricalNodes",e.GET_HISTORY_UPDATETIME="/PrjDB/project/getHistoryUpdatetime",e.GET_HISTORY_PROJECT="/PrjDB/project/getHistoricalProject",e.START_BATCH_UPLOAD="/PrjDB/project/startBatchUpload",e.END_BATCH_UPLOAD="/PrjDB/project/endBatchUpload",e.AWAIT_UPLOAD_END="/PrjDB/project/awaitUploadEnd",e.GET_MAX_TICKET="/PrjDB/project/getMaxTicket",e.SAVE_PEND_DATA="/PrjDB/project/savePendData",e.REVOKE_PEND_DATA="/PrjDB/project/revokePendData",e.GET_CLIENT="/PrjDB/project/getClient",e.GET_BRANCH_DATA="/PrjDB/project/getBranchData",e.HISTORIES="/PrjDB/project/histories",e.COMPRESS="/PrjDB/project/compress",e.FLOW_WRITE="/PrjDB/project/flowWrite",e.GET_RELATED="/PrjDB/project/getRelated",e))(OS||{}),IS=(e=>(e.GET="/PrjDB/config/getData",e.UPDATE="/PrjDB/config/updateData",e))(IS||{}),xS=(e=>(e.GET="/PrjDB/board/getData",e.ADD="/PrjDB/board/addData",e.UPDATE="/PrjDB/board/updateData",e.DELETE="/PrjDB/board/deleteData",e.GET_ALL_KV="/PrjDB/board/getAllKVData",e.GET_ALL_ARR="/PrjDB/board/getAllArrData",e.TRY_RENAME="/PrjDB/board/tryRename",e.IS_RENAME="/PrjDB/board/isRename",e.BATCH_DELETE="/PrjDB/board/batchDelete",e.GET_BIND_KEYS="/PrjDB/board/getBindKeys",e))(xS||{}),vS=(e=>(e.GET="/PrjDB/schematic/getData",e.GET_BY_NAME="/PrjDB/schematic/getDataByName",e.TRY_RENAME="/PrjDB/schematic/tryRename",e.UPDATE_IN_LOCAL="/PrjDB/schematic/updateDataInLocal",e.ADD="/PrjDB/schematic/addData",e.UPDATE="/PrjDB/schematic/updateData",e.DEL="/PrjDB/schematic/delData",e.GET_ALL_KV="/PrjDB/schematic/getAllKVDatas",e.GET_UUID_BY_NAME="/PrjDB/schematic/getIdByName",e.GET_NAME_BY_UUID="/PrjDB/schematic/getNameById",e.GET_DISPLAY_NAME_BY_UUID="/PrjDB/schematic/getDisplayNameById",e.GET_ALL_ARR="/PrjDB/schematic/getAllArrDatas",e.GET_BY_SOURCE_VERSION="/PrjDB/schematic/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/schematic/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/schematic/getAllArrDatasBySource",e.IS_RENAME="/PrjDB/schematic/isRename",e.BATCH_DELETE="/PrjDB/schematic/batchDelete",e))(vS||{}),RS=(e=>(e.ADD="/PrjDB/sheet/addData",e.DEL="/PrjDB/sheet/delData",e.UPDATE="/PrjDB/sheet/updateData",e.UPDATE_LOTS="/PrjDB/sheet/updateLotDatas",e.GET_ALL_KV="/PrjDB/sheet/getAllKVDatas",e.GET="/PrjDB/sheet/getData",e.GET_ALL_ARR="/PrjDB/sheet/getAllArrDatas",e.GET_LOTS_ARR="/PrjDB/sheet/getLotsArrDatas",e.GET_CANVAS="/PrjDB/sheet/getCanvas",e.SET_CANVAS="/PrjDB/sheet/setCanvas",e.COVER_CANVAS="/PrjDB/sheet/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/sheet/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/sheet/unwatchCanvas",e.GET_BY_SOURCE_VERSION="/PrjDB/sheet/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/sheet/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/sheet/getAllArrDatasBySource",e.TRY_RENAME="/PrjDB/sheet/tryRename",e.IS_RENAME="/PrjDB/sheet/isRename",e.BATCH_DELETE="/PrjDB/sheet/batchDelete",e.GET_ALL_KEYS="/PrjDB/sheet/getAllPrimaryKeys",e))(RS||{}),NS=(e=>(e.ADD="/PrjDB/simulation/addData",e.DEL="/PrjDB/simulation/delData",e.UPDATE="/PrjDB/simulation/updateData",e.UPDATE_LOTS="/PrjDB/simulation/updateLotDatas",e.GET_ALL_KV="/PrjDB/simulation/getAllKVDatas",e.GET="/PrjDB/simulation/getData",e.GET_ALL_ARR="/PrjDB/simulation/getAllArrDatas",e.GET_LOTS_ARR="/PrjDB/simulation/getLotsArrDatas",e.GET_CANVAS="/PrjDB/simulation/getCanvas",e.SET_CANVAS="/PrjDB/simulation/setCanvas",e.COVER_CANVAS="/PrjDB/simulation/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/simulation/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/simulation/unwatchCanvas",e.GET_BY_SOURCE_VERSION="/PrjDB/simulation/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/simulation/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/simulation/getAllArrDatasBySource",e.TRY_RENAME="/PrjDB/simulation/tryRename",e.IS_RENAME="/PrjDB/simulation/isRename",e.BATCH_DELETE="/PrjDB/simulation/batchDelete",e.GET_ALL_KEYS="/PrjDB/simulation/getAllPrimaryKeys",e))(NS||{}),LS=(e=>(e.GET="/PrjDB/pcb/getData",e.GET_BY_TITLE="/PrjDB/pcb/getDataByTitle",e.GET_UUID_BY_TITLE="/PrjDB/pcb/getIdByTitle",e.ADD="/PrjDB/pcb/addData",e.DEL="/PrjDB/pcb/delData",e.CREATE_SUB="/PrjDB/pcb/createSub",e.UPDATE_SUB="/PrjDB/pcb/updateSubInherit",e.UPDATE="/PrjDB/pcb/updateData",e.UPDATE_LOTS="/PrjDB/pcb/updateLotDatas",e.GET_ALL_KV="/PrjDB/pcb/getAllKVDatas",e.GET_ALL_ARR="/PrjDB/pcb/getAllArrDatas",e.GET_CANVAS="/PrjDB/pcb/getCanvas",e.SET_CANVAS="/PrjDB/pcb/setCanvas",e.COVER_CANVAS="/PrjDB/pcb/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/pcb/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/pcb/unwatchCanvas",e.GET_BY_SOURCE_VERSION="/PrjDB/pcb/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/pcb/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/pcb/getAllArrDatasBySource",e.TRY_RENAME="/PrjDB/pcb/tryRename",e.IS_RENAME="/PrjDB/pcb/isRename",e.BATCH_DELETE="/PrjDB/pcb/batchDelete",e.GET_ALL_KEYS="/PrjDB/pcb/getAllPrimaryKeys",e))(LS||{}),BS=(e=>(e.GET="/PrjDB/panel/getData",e.ADD="/PrjDB/panel/addData",e.DEL="/PrjDB/panel/delData",e.UPDATE="/PrjDB/panel/updateData",e.UPDATE_LOTS="/PrjDB/panel/updateLotDatas",e.GET_ALL_KV="/PrjDB/panel/getAllKVDatas",e.GET_ALL_ARR="/PrjDB/panel/getAllArrDatas",e.GET_CANVAS="/PrjDB/panel/getCanvas",e.SET_CANVAS="/PrjDB/panel/setCanvas",e.COVER_CANVAS="/PrjDB/panel/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/panel/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/panel/unwatchCanvas",e.TRY_RENAME="/PrjDB/panel/tryRename",e.IS_RENAME="/PrjDB/panel/isRename",e.BATCH_DELETE="/PrjDB/panel/batchDelete",e.GET_ALL_KEYS="/PrjDB/panel/getAllPrimaryKeys",e))(BS||{}),kS=(e=>(e.GET_BY_TITLE="/PrjDB/symbol/getDataByTitle",e.GET="/PrjDB/symbol/getData",e.ADD="/PrjDB/symbol/addData",e.CLONE="/PrjDB/symbol/cloneData",e.DEL="/PrjDB/symbol/delData",e.UPDATE="/PrjDB/symbol/updateData",e.GET_UUID_BY_TITLE="/PrjDB/symbol/getIdByTitle",e.GET_TITLE_BY_UUID="/PrjDB/symbol/getTitleById",e.GET_ALL_KV="/PrjDB/symbol/getAllKVDatas",e.GET_BY_SOURCE_VERSION="/PrjDB/symbol/getDataBySourceAndVersion",e.GET_COMPARE_TICKET="/PrjDB/symbol/getDataCompareTicket",e.GET_LAST="/PrjDB/symbol/getLastData",e.IS_EXIST="/PrjDB/symbol/isExist",e.GET_ALL_KEYS="/PrjDB/symbol/getAllPrimaryKeys",e.GET_ALL_ARR="/PrjDB/symbol/getAllArrDatas",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/symbol/getAllArrDatasBySource",e.GET_KEYS_BY_SOURCE="/PrjDB/symbol/getKeysBySource",e.GET_ALL_ARR_BY_TYPE="/PrjDB/symbol/getTypeDatas",e.GET_STR="/PrjDB/symbol/getStr",e.GET_CANVAS="/PrjDB/symbol/getCanvas",e.SET_CANVAS="/PrjDB/symbol/setCanvas",e.COVER_CANVAS="/PrjDB/symbol/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/symbol/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/symbol/unwatchCanvas",e.TRY_RENAME="/PrjDB/symbol/tryRename",e.WITH_ORIGINS="/PrjDB/symbol/withOrigins",e.IS_RENAME="/PrjDB/symbol/isRename",e.IS_CHANGE="/PrjDB/symbol/isChange",e.BATCH_DELETE="/PrjDB/symbol/batchDelete",e.GET_LIST="/PrjDB/symbol/getList",e))(kS||{}),MS=(e=>(e.GET_BY_TITLE="/PrjDB/footprint/getDataByTitle",e.GET="/PrjDB/footprint/getData",e.IS_EXIST="/PrjDB/footprint/isExist",e.ADD="/PrjDB/footprint/addData",e.CLONE="/PrjDB/footprint/cloneData",e.DEL="/PrjDB/footprint/delData",e.GET_ALL_KV="/PrjDB/footprint/getAllKVDatas",e.UPDATE="/PrjDB/footprint/updateData",e.UPDATE_IN_LOCAL="/PrjDB/footprint/updateDataInLocal",e.GET_TITLE_BY_UUID="/PrjDB/footprint/getTitleById",e.GET_BY_SOURCE_VERSION="/PrjDB/footprint/getDataBySourceAndVersion",e.GET_COMPARE_TICKET="/PrjDB/footprint/getDataCompareTicket",e.GET_LAST="/PrjDB/footprint/getLastData",e.GET_ALL_KEYS="/PrjDB/footprint/getAllPrimaryKeys",e.GET_ALL_ARR="/PrjDB/footprint/getAllArrDatas",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/footprint/getAllArrDatasBySource",e.GET_KEYS_BY_SOURCE="/PrjDB/footprint/getKeysBySource",e.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/footprint/getAllArrDatasByPcbId",e.GET_KEYS_BY_PCB_UUID="/PrjDB/footprint/getKeysByPcbId",e.GET_STR="/PrjDB/footprint/getStr",e.GET_CANVAS="/PrjDB/footprint/getCanvas",e.SET_CANVAS="/PrjDB/footprint/setCanvas",e.COVER_CANVAS="/PrjDB/footprint/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/footprint/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/footprint/unwatchCanvas",e.TRY_RENAME="/PrjDB/footprint/tryRename",e.WITH_ORIGINS="/PrjDB/footprint/withOrigins",e.IS_CHANGE="/PrjDB/footprint/isChange",e.IS_RENAME="/PrjDB/footprint/isRename",e.BATCH_DELETE="/PrjDB/footprint/batchDelete",e.GET_LIST="/PrjDB/footprint/getList",e))(MS||{}),jS=(e=>(e.GET="/PrjDB/device/getData",e.GET_BY_TITLE="/PrjDB/device/getDataByTitle",e.ADD="/PrjDB/device/addData",e.DEL="/PrjDB/device/delData",e.GET_ALL_KV="/PrjDB/device/getAllKVDatas",e.UPDATE="/PrjDB/device/updateData",e.GET_TITLE_BY_UUID="/PrjDB/device/getTitleById",e.GET_SYMBOL_UUID="/PrjDB/device/getSymbolIdById",e.GET_BY_SOURCE_VERSION="/PrjDB/device/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/device/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/device/getAllArrDatasBySource",e.GET_KEYS_BY_SOURCE="/PrjDB/device/getKeysBySource",e.GET_COMPARE_TICKET="/PrjDB/device/getDataCompareTicket",e.IS_EXIST="/PrjDB/device/isExist",e.GET_ALL_KEYS="/PrjDB/device/getAllPrimaryKeys",e.GET_ALL_ARR="/PrjDB/device/getAllArrDatas",e.GET_ALL_ARR_BY_SYMBOL_UUID="/PrjDB/device/getAllArrDatasBySymbolId",e.GET_ALL_ARR_BY_FOOTPRINT_UUID="/PrjDB/device/getAllArrDatasByfootprintId",e.TRY_RENAME="/PrjDB/device/tryRename",e.BIND_SYMBOL="/PrjDB/device/bindSymbol",e.BIND_fOOTPRINT="/PrjDB/device/bindFootprint",e.WITH_ORIGINS="/PrjDB/device/withOrigins",e.IS_CHANGE="/PrjDB/device/isChange",e.IS_RENAME="/PrjDB/device/isRename",e.PLACE="/PrjDB/device/place",e.BATCH_DELETE="/PrjDB/device/batchDelete",e.GET_LIST="/PrjDB/device/getList",e))(jS||{}),FS=(e=>(e.GET="/PrjDB/attr/getData",e.UPDATE="/PrjDB/attr/updateData",e.BATCH_UPDATE="/PrjDB/attr/batchUpdateData",e.ADD="/PrjDB/attr/addData",e.DEL="/PrjDB/attr/delData",e.GET_ALL_KV="/PrjDB/attr/getAllKVDatas",e.GET_ALL_ARR="/PrjDB/attr/getAllArrDatas",e.GET_ALL_ARR_BY_HASH="/PrjDB/attr/getAllArrDatasByHash",e.BATCH_DELETE="/PrjDB/attr/batchDelete",e))(FS||{}),US=(e=>(e.GET="/PrjDB/blob/getData",e.ADD="/PrjDB/blob/addData",e.DEL="/PrjDB/blob/delData",e.GET_ALL_ARR="/PrjDB/blob/getAllArrDatas",e.BATCH_DELETE="/PrjDB/blob/batchDelete",e))(US||{}),HS=(e=>(e.GET="/PrjDB/copper/getData",e.ADD="/PrjDB/copper/addData",e.DEL_LOTS="/PrjDB/copper/delLotDatas",e.DEL="/PrjDB/copper/delData",e.GET_ALL_KEYS="/PrjDB/copper/getAllPrimaryKeys",e.UPDATE="/PrjDB/copper/updateData",e.GET_ALL_ARR="/PrjDB/copper/getAllArrDatas",e.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/copper/getAllArrDatasByPcbId",e.GET_ALL_KEYS_BY_PCB_UUID="/PrjDB/copper/getAllArrKeysByPcbId",e))(HS||{}),GS=(e=>(e.GET="/PrjDB/font/getData",e.ADD="/PrjDB/font/addData",e.DEL_LOTS="/PrjDB/font/delLotDatas",e.DEL="/PrjDB/font/delData",e.GET_ALL_KEYS="/PrjDB/font/getAllPrimaryKeys",e.UPDATE="/PrjDB/font/updateData",e.GET_ALL_ARR="/PrjDB/font/getAllArrDatas",e.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/font/getAllArrDatasByPcbId",e.GET_ALL_KEYS_BY_PCB_UUID="/PrjDB/font/getAllArrKeysByPcbId",e))(GS||{}),YS=(e=>(e.BATCH_ADD="/PrjDB/variant/batchAddVariant",e.ADD="/PrjDB/variant/addData",e.DELETE="/PrjDB/variant/deleteData",e.BATCH_DELETE="/PrjDB/variant/batchDeleteData",e.BATCH_RESTORE="/PrjDB/variant/batchRestoreData",e.GET="/PrjDB/variant/getData",e.GET_ALL_ARR_BY_SID="/PrjDB/variant/getAllArrDatasBySid",e.UPDATE_TITLE="/PrjDB/variant/updateTitle",e.UPDATE_NOT_GROUPED="/PrjDB/variant/updateNotGrouped",e.BATCH_UPDATE_SORT="/PrjDB/variant/batchUpdateZIndex",e))(YS||{}),VS=(e=>(e.BATCH_ADD="/PrjDB/componentGroup/batchAddData",e.ADD="/PrjDB/componentGroup/addData",e.DELETE="/PrjDB/componentGroup/deleteData",e.BATCH_DELETE="/PrjDB/componentGroup/batchDeleteData",e.BATCH_RESTORE="/PrjDB/componentGroup/batchRestoreData",e.GET="/PrjDB/componentGroup/getData",e.GET_ALL_ARR_BY_SID="/PrjDB/componentGroup/getAllArrDatasBySid",e.GET_ATTR_DATA="/PrjDB/componentGroup/getComponentGroupData",e.UPDATE_TITLE="/PrjDB/componentGroup/updateTitle",e.BATCH_UPDATE_SORT="/PrjDB/componentGroup/batchUpdateZIndex",e.BATCH_UPLOAD_VARIANT_INDEX="/PrjDB/componentGroup/batchUploadGroupSortInVariant",e.BATCH_DELETE_VARIANT_INDEX="/PrjDB/componentGroup/batchDeleteGroupSortInVariant",e.UPLOAD_ATTR_DATA="/PrjDB/componentGroup/uploadComponentGroupData",e.BATCH_DELETE_ATTR_DATA="/PrjDB/componentGroup/batchDeleteComponentGroupData",e))(VS||{}),re={VARIANT:YS,COMPONENT_GROUP:VS,COMMON:PS,PROJECT:OS,CONFIG:IS,BOARD:xS,SCHEMATIC:vS,SHEET:RS,SIMULATION:NS,PCB:LS,PANEL:BS,SYMBOL:kS,FOOTPRINT:MS,DEVICE:jS,ATTR:FS,BLOB:US,COPPER:HS,FONT:GS},m5=sd(rd());function mu(e){return!e.data}function g5(e){return!!(e.path&&e.uuid&&e.docType&&e.isProject!==void 0&&Object.keys(e).length===4)}async function ua(e){let{origin:t,target:s}=e,r=await td.getProLibSource(t);if(r.success===!1)return{success:!1,code:r.code,message:r.message};let i=r.result;if(s.isProject)if(s.docType===4){let n=[s.uuid,i,s.version,s.path];return{success:!!(await Je.messageBus.rpcCall(re.FOOTPRINT.COVER_CANVAS,n)).message}}else if(Pm(s.docType)){let n=[s.uuid,i,s.version,s.path];return{success:!!(await Je.messageBus.rpcCall(re.SYMBOL.COVER_CANVAS,n)).message}}else throw new Error("Api call error!");else{let n=await td.getProLibSource(s);if(n.success===!1)return{success:!1,code:n.code,message:n.message};let a=n.result,o=qr(),c;if(s.docType===4)c=e1(a,i,{docType:Yh.FOOTPRINT,uuid:s.uuid,client:o});else if(s.docType===29)c=e1(a,i,{docType:Yh.PANEL_LIB,uuid:s.uuid,client:o});else if(Pm(s.docType))c=e1(a,i,{docType:Yh.SYMBOL,uuid:s.uuid,client:o});else throw new Error("Api call error!");let l={uuid:s.uuid,dataStr:c},{message:u}=await Je.messageBus.rpcCall(Me.COMPONENT.SET_HISTORY,l);return u.success===!1?{success:!1,code:u.code,message:u.message}:{success:!0}}}function y5(e){return self[e]=self[e]||new m5.BroadcastChannelMessageBus(e)}var ms=(e=>(e.OPEN="/pro-mgr/project/open",e.CLOSE="/pro-mgr/project/close",e.TEMP_OPEN="/pro-mgr/project/tempOpen",e.TEMP_OPEN_BY_STRING="/pro-mgr/project/tempOpenByString",e.TEMP_CLOSE="/pro-mgr/project/tempClose",e.ON_OPENED="/pro-mgr/project/onOpened",e.ON_TEMP_OPENED="/pro-mgr/project/onTempOpened",e.BEFORE_CLOSE="/pro-mgr/project/beforeClose",e.ON_CLOSED="/pro-mgr/project/onClosed",e.ON_TEMP_CLOSED="/pro-mgr/project/onTempClosed",e.ON_FAILED="/pro-mgr/project/onFailed",e.GET_RECENT_PROJECT_LIST="/pro-mgr/getRecentPrjList",e.UPDATE_PROJECT="/pro-mgr/updateProject",e.DEL_PROJECT="/pro-mgr/deleteProject",e.HAS="/pro-mgr/hasProject",e))(ms||{}),E5=(e=>(e.SYSTEM="system",e.INTERNAL="Internal",e.PERSONAL="personal",e.PROJECT="project",e.STAR="star",e.TEAMS="teams",e.USER="user",e.CLIENT="client",e.PUBLIC="public",e.OSHWHUB="oshwhub",e.EXTEND="extend",e))(E5||{}),b5=(e=>(e.DEVICE="device",e.SYMBOL="symbol",e.FOOTPRINT="footprint",e.CBB="cbb",e.MODEL3D="model3D",e.PANEL_LIB="panelLib",e.MODEL_SIM_LIB="modelSimLib",e))(b5||{}),uE={D3Model:{client3DModelList:"api/client/steps"}},yt,nt=(yt=class{},yt.CANVAS_UNIT_MM="mm",yt.CANVAS_UNIT_MIL="mil",yt.HEX_BLACK_COLOR="#000000",yt.HEX_WHITE_COLOR="#FFFFFF",yt.HEX_RED_COLOR="#FF0000",yt.HEX_GREEN_COLOR="#00FF00",yt.HEX_BLUE_COLOR="#0000FF",yt.HEX_GRAY_COLOR1="#F1F1F1",yt.HEX_GRAY_COLOR2="#EFEFEF",yt.HEX_GRAY_COLOR3="#999999",yt.HEX_GRAY_COLOR4="#666666",yt.HEX_GRAY_COLOR5="#333333",yt.HEX_GRAY_COLOR6="#CCCCCC",yt.DEFAULT_PAGESIZE=50,yt.SYMBOLTYPE_ITEM_ALL_VALUE="@all",yt.SYMBOLTYPE_ITEM_ALL_TITLE="All",yt.D3MVIEW_DEFAULT_TRANSFORM="0, 0, 0, 0, 0, 0, 0, 0, 0",yt.DEVICE_INDEX_TAG="$_",yt.DEVICE_SPLIT_TAG="@_",yt.LIB_SPLIT_TAG="#_",yt.CATEGORY_ITEM_ALL_VALUE="@all",yt.CATEGORY_ITEM_ALL_TITLE="All",yt.FAVORITELIB_UUID="star",yt.SYSTEMLIB_UUID="0819f05c4eef4c71ace90d822a990e87",yt.SYSTEMLIB_UUID_ALIAS="lcsc",yt.USERLIB_ALIAS="mine",yt.PUBLICLIB_ALIAS="user",yt.STD_PUBLIC_LIB_UUID="stdPublic",yt.INTERNAL_LIB_ALIAS="Internal",yt.PERSIONAL_WORKSPACE="Personal",yt.EDU_WORKSPACE="6d84b27f18f540b6a31c4d657314ab13",yt.EDA_TEST_WORKSPACE="407ec92f2a2f4275bf08cbebf64f5e08",yt.LIB_SYSTEM_KEY="system",yt.LIB_PROJECT_KEY="project",yt.LIB_PERSONAL_KEY="personal",yt.LIB_PUBLIC_KEY="public",yt.LIB_INTERNAL_KEY="Internal",yt.LIB_FAVORITE_KEY="favorite",yt.LIB_TEMAS_KEY="teams",yt.API=uE,yt.ERR_CODE={NORMAL:-1,DUP_NAME:-9001},yt),a2={},T5=function(e,t,s,r,i){var n=new Worker(a2[t]||(a2[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return n.onmessage=function(a){var o=a.data,c=o.$e$;if(c){var l=new Error(c[0]);l.code=c[1],l.stack=c[2],i(l,null)}else i(null,o)},n.postMessage(s,r),n},Vt=Uint8Array,bi=Uint16Array,hd=Int32Array,gu=new Vt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yu=new Vt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$h=new Vt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zS=function(e,t){for(var s=new bi(31),r=0;r<31;++r)s[r]=t+=1<<e[r-1];for(var i=new hd(s[30]),r=1;r<30;++r)for(var n=s[r];n<s[r+1];++n)i[n]=n-s[r]<<5|r;return{b:s,r:i}},WS=zS(gu,2),hE=WS.b,Om=WS.r;hE[28]=258,Om[258]=28;var qS=zS(yu,0),JS=qS.b,k1=qS.r,Qh=new bi(32768);for(ks=0;ks<32768;++ks)La=(ks&43690)>>1|(ks&21845)<<1,La=(La&52428)>>2|(La&13107)<<2,La=(La&61680)>>4|(La&3855)<<4,Qh[ks]=((La&65280)>>8|(La&255)<<8)>>1;var ln=function(e,t,s){for(var r=e.length,i=0,n=new bi(t);i<r;++i)e[i]&&++n[e[i]-1];var a=new bi(t);for(i=1;i<t;++i)a[i]=a[i-1]+n[i-1]<<1;var o;if(s){o=new bi(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],h=a[e[i]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)o[Qh[h]>>c]=l}else for(o=new bi(r),i=0;i<r;++i)e[i]&&(o[i]=Qh[a[e[i]-1]++]>>15-e[i]);return o},qa=new Vt(288);for(ks=0;ks<144;++ks)qa[ks]=8;for(ks=144;ks<256;++ks)qa[ks]=9;for(ks=256;ks<280;++ks)qa[ks]=7;for(ks=280;ks<288;++ks)qa[ks]=8;var hu=new Vt(32);for(ks=0;ks<32;++ks)hu[ks]=5;var KS=ln(qa,9,0),XS=ln(qa,9,1),ZS=ln(hu,5,0),$S=ln(hu,5,1),um=function(e){for(var t=e[0],s=1;s<e.length;++s)e[s]>t&&(t=e[s]);return t},an=function(e,t,s){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&s},hm=function(e,t){var s=t/8|0;return(e[s]|e[s+1]<<8|e[s+2]<<16)>>(t&7)},Eu=function(e){return(e+7)/8|0},ca=function(e,t,s){return(t==null||t<0)&&(t=0),(s==null||s>e.length)&&(s=e.length),new Vt(e.subarray(t,s))};var QS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_t=function(e,t,s){var r=new Error(t||QS[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,_t),!s)throw r;return r},Vm=function(e,t,s,r){var i=e.length,n=r?r.length:0;if(!i||t.f&&!t.l)return s||new Vt(0);var a=!s,o=a||t.i!=2,c=t.i;a&&(s=new Vt(i*3));var l=function(Fe){var G=s.length;if(Fe>G){var pe=new Vt(Math.max(G*2,Fe));pe.set(s),s=pe}},u=t.f||0,h=t.p||0,p=t.b||0,d=t.l,f=t.d,m=t.m,g=t.n,b=i*8;do{if(!d){u=an(e,h,1);var E=an(e,h+1,3);if(h+=3,E)if(E==1)d=XS,f=$S,m=9,g=5;else if(E==2){var y=an(e,h,31)+257,T=an(e,h+10,15)+4,w=y+an(e,h+5,31)+1;h+=14;for(var S=new Vt(w),_=new Vt(19),C=0;C<T;++C)_[$h[C]]=an(e,h+C*3,7);h+=T*3;for(var x=um(_),D=(1<<x)-1,I=ln(_,x,1),C=0;C<w;){var P=I[an(e,h,D)];h+=P&15;var L=P>>4;if(L<16)S[C++]=L;else{var F=0,V=0;for(L==16?(V=3+an(e,h,3),h+=2,F=S[C-1]):L==17?(V=3+an(e,h,7),h+=3):L==18&&(V=11+an(e,h,127),h+=7);V--;)S[C++]=F}}var B=S.subarray(0,y),k=S.subarray(y);m=um(B),g=um(k),d=ln(B,m,1),f=ln(k,g,1)}else _t(1);else{var L=Eu(h)+4,O=e[L-4]|e[L-3]<<8,R=L+O;if(R>i){c&&_t(0);break}o&&l(p+O),s.set(e.subarray(L,R),p),t.b=p+=O,t.p=h=R*8,t.f=u;continue}if(h>b){c&&_t(0);break}}o&&l(p+131072);for(var v=(1<<m)-1,j=(1<<g)-1,M=h;;M=h){var F=d[hm(e,h)&v],H=F>>4;if(h+=F&15,h>b){c&&_t(0);break}if(F||_t(2),H<256)s[p++]=H;else if(H==256){M=h,d=null;break}else{var q=H-254;if(H>264){var C=H-257,Q=gu[C];q=an(e,h,(1<<Q)-1)+hE[C],h+=Q}var oe=f[hm(e,h)&j],me=oe>>4;oe||_t(3),h+=oe&15;var k=JS[me];if(me>3){var Q=yu[me];k+=hm(e,h)&(1<<Q)-1,h+=Q}if(h>b){c&&_t(0);break}o&&l(p+131072);var Ee=p+q;if(p<k){var Pe=n-k,Oe=Math.min(k,Ee);for(Pe+p<0&&_t(3);p<Oe;++p)s[p]=r[Pe+p]}for(;p<Ee;++p)s[p]=s[p-k]}}t.l=d,t.p=M,t.b=p,t.f=u,d&&(u=1,t.m=m,t.d=f,t.n=g)}while(!u);return p!=s.length&&a?ca(s,0,p):s.subarray(0,p)},ta=function(e,t,s){s<<=t&7;var r=t/8|0;e[r]|=s,e[r+1]|=s>>8},Xl=function(e,t,s){s<<=t&7;var r=t/8|0;e[r]|=s,e[r+1]|=s>>8,e[r+2]|=s>>16},dm=function(e,t){for(var s=[],r=0;r<e.length;++r)e[r]&&s.push({s:r,f:e[r]});var i=s.length,n=s.slice();if(!i)return{t:Ro,l:0};if(i==1){var a=new Vt(s[0].s+1);return a[s[0].s]=1,{t:a,l:1}}s.sort(function(w,S){return w.f-S.f}),s.push({s:-1,f:25001});var o=s[0],c=s[1],l=0,u=1,h=2;for(s[0]={s:-1,f:o.f+c.f,l:o,r:c};u!=i-1;)o=s[s[l].f<s[h].f?l++:h++],c=s[l!=u&&s[l].f<s[h].f?l++:h++],s[u++]={s:-1,f:o.f+c.f,l:o,r:c};for(var p=n[0].s,r=1;r<i;++r)n[r].s>p&&(p=n[r].s);var d=new bi(p+1),f=Im(s[u-1],d,0);if(f>t){var r=0,m=0,g=f-t,b=1<<g;for(n.sort(function(S,_){return d[_.s]-d[S.s]||S.f-_.f});r<i;++r){var E=n[r].s;if(d[E]>t)m+=b-(1<<f-d[E]),d[E]=t;else break}for(m>>=g;m>0;){var y=n[r].s;d[y]<t?m-=1<<t-d[y]++-1:++r}for(;r>=0&&m;--r){var T=n[r].s;d[T]==t&&(--d[T],++m)}f=t}return{t:new Vt(d),l:f}},Im=function(e,t,s){return e.s==-1?Math.max(Im(e.l,t,s+1),Im(e.r,t,s+1)):t[e.s]=s},M1=function(e){for(var t=e.length;t&&!e[--t];);for(var s=new bi(++t),r=0,i=e[0],n=1,a=function(c){s[r++]=c},o=1;o<=t;++o)if(e[o]==i&&o!=t)++n;else{if(!i&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(i),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(i);n=1,i=e[o]}return{c:s.subarray(0,r),n:t}},Zl=function(e,t){for(var s=0,r=0;r<t.length;++r)s+=e[r]*t[r];return s},dE=function(e,t,s){var r=s.length,i=Eu(t+2);e[i]=r&255,e[i+1]=r>>8,e[i+2]=e[i]^255,e[i+3]=e[i+1]^255;for(var n=0;n<r;++n)e[i+n+4]=s[n];return(i+4+r)*8},j1=function(e,t,s,r,i,n,a,o,c,l,u){ta(t,u++,s),++i[256];for(var h=dm(i,15),p=h.t,d=h.l,f=dm(n,15),m=f.t,g=f.l,b=M1(p),E=b.c,y=b.n,T=M1(m),w=T.c,S=T.n,_=new bi(19),C=0;C<E.length;++C)++_[E[C]&31];for(var C=0;C<w.length;++C)++_[w[C]&31];for(var x=dm(_,7),D=x.t,I=x.l,P=19;P>4&&!D[$h[P-1]];--P);var L=l+5<<3,F=Zl(i,qa)+Zl(n,hu)+a,V=Zl(i,p)+Zl(n,m)+a+14+3*P+Zl(_,D)+2*_[16]+3*_[17]+7*_[18];if(c>=0&&L<=F&&L<=V)return dE(t,u,e.subarray(c,c+l));var B,k,O,R;if(ta(t,u,1+(V<F)),u+=2,V<F){B=ln(p,d,0),k=p,O=ln(m,g,0),R=m;var v=ln(D,I,0);ta(t,u,y-257),ta(t,u+5,S-1),ta(t,u+10,P-4),u+=14;for(var C=0;C<P;++C)ta(t,u+3*C,D[$h[C]]);u+=3*P;for(var j=[E,w],M=0;M<2;++M)for(var H=j[M],C=0;C<H.length;++C){var q=H[C]&31;ta(t,u,v[q]),u+=D[q],q>15&&(ta(t,u,H[C]>>5&127),u+=H[C]>>12)}}else B=KS,k=qa,O=ZS,R=hu;for(var C=0;C<o;++C){var Q=r[C];if(Q>255){var q=Q>>18&31;Xl(t,u,B[q+257]),u+=k[q+257],q>7&&(ta(t,u,Q>>23&31),u+=gu[q]);var oe=Q&31;Xl(t,u,O[oe]),u+=R[oe],oe>3&&(Xl(t,u,Q>>5&8191),u+=yu[oe])}else Xl(t,u,B[Q]),u+=k[Q]}return Xl(t,u,B[256]),u+k[256]},e_=new hd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ro=new Vt(0),t_=function(e,t,s,r,i,n){var a=n.z||e.length,o=new Vt(r+a+5*(1+Math.ceil(a/7e3))+i),c=o.subarray(r,o.length-i),l=n.l,u=(n.r||0)&7;if(t){u&&(c[0]=n.r>>3);for(var h=e_[t-1],p=h>>13,d=h&8191,f=(1<<s)-1,m=n.p||new bi(32768),g=n.h||new bi(f+1),b=Math.ceil(s/3),E=2*b,y=function(ge){return(e[ge]^e[ge+1]<<b^e[ge+2]<<E)&f},T=new hd(25e3),w=new bi(288),S=new bi(32),_=0,C=0,x=n.i||0,D=0,I=n.w||0,P=0;x+2<a;++x){var L=y(x),F=x&32767,V=g[L];if(m[F]=V,g[L]=F,I<=x){var B=a-x;if((_>7e3||D>24576)&&(B>423||!l)){u=j1(e,c,0,T,w,S,C,D,P,x-P,u),D=_=C=0,P=x;for(var k=0;k<286;++k)w[k]=0;for(var k=0;k<30;++k)S[k]=0}var O=2,R=0,v=d,j=F-V&32767;if(B>2&&L==y(x-j))for(var M=Math.min(p,B)-1,H=Math.min(32767,x),q=Math.min(258,B);j<=H&&--v&&F!=V;){if(e[x+O]==e[x+O-j]){for(var Q=0;Q<q&&e[x+Q]==e[x+Q-j];++Q);if(Q>O){if(O=Q,R=j,Q>M)break;for(var oe=Math.min(j,Q-2),me=0,k=0;k<oe;++k){var Ee=x-j+k&32767,Pe=m[Ee],Oe=Ee-Pe&32767;Oe>me&&(me=Oe,V=Ee)}}}F=V,V=m[F],j+=F-V&32767}if(R){T[D++]=268435456|Om[O]<<18|k1[R];var Fe=Om[O]&31,G=k1[R]&31;C+=gu[Fe]+yu[G],++w[257+Fe],++S[G],I=x+O,++_}else T[D++]=e[x],++w[e[x]]}}for(x=Math.max(x,I);x<a;++x)T[D++]=e[x],++w[e[x]];u=j1(e,c,l,T,w,S,C,D,P,x-P,u),l||(n.r=u&7|c[u/8|0]<<3,u-=7,n.h=g,n.p=m,n.i=x,n.w=I)}else{for(var x=n.w||0;x<a+l;x+=65535){var pe=x+65535;pe>=a&&(c[u/8|0]=l,pe=a),u=dE(c,u+1,e.subarray(x,pe))}n.i=a}return ca(o,0,r+Eu(u)+i)},w5=(function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var s=t,r=9;--r;)s=(s&1&&-306674912)^s>>>1;e[t]=s}return e})(),pE=function(){var e=-1;return{p:function(t){for(var s=e,r=0;r<t.length;++r)s=w5[s&255^t[r]]^s>>>8;e=s},d:function(){return~e}}},s_=function(){var e=1,t=0;return{p:function(s){for(var r=e,i=t,n=s.length|0,a=0;a!=n;){for(var o=Math.min(a+2655,n);a<o;++a)i+=r+=s[a];r=(r&65535)+15*(r>>16),i=(i&65535)+15*(i>>16)}e=r,t=i},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},bu=function(e,t,s,r,i){if(!i&&(i={l:1},t.dictionary)){var n=t.dictionary.subarray(-32768),a=new Vt(n.length+e.length);a.set(n),a.set(e,n.length),e=a,i.w=n.length}return t_(e,t.level==null?6:t.level,t.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,s,r,i)},r_=function(e,t){var s={};for(var r in e)s[r]=e[r];for(var r in t)s[r]=t[r];return s},o2=function(e,t,s){for(var r=e(),i=e.toString(),n=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<r.length;++a){var o=r[a],c=n[a];if(typeof o=="function"){t+=";"+c+"=";var l=o.toString();if(o.prototype)if(l.indexOf("[native code]")!=-1){var u=l.indexOf(" ",8)+1;t+=l.slice(u,l.indexOf("(",u))}else{t+=l;for(var h in o.prototype)t+=";"+c+".prototype."+h+"="+o.prototype[h].toString()}else t+=l}else s[c]=o}return t},Qf=[],S5=function(e){var t=[];for(var s in e)e[s].buffer&&t.push((e[s]=new e[s].constructor(e[s])).buffer);return t},_5=function(e,t,s,r){if(!Qf[s]){for(var i="",n={},a=e.length-1,o=0;o<a;++o)i=o2(e[o],i,n);Qf[s]={c:o2(e[a],i,n),e:n}}var c=r_({},Qf[s].e);return T5(Qf[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",s,c,S5(c),r)},fE=function(){return[Vt,bi,hd,gu,yu,$h,hE,JS,XS,$S,Qh,QS,ln,um,an,hm,Eu,ca,_t,Vm,v5,i_,P5]},A5=function(){return[Vt,bi,hd,gu,yu,$h,Om,k1,KS,qa,ZS,hu,Qh,e_,Ro,ln,ta,Xl,dm,Im,M1,Zl,dE,j1,Eu,ca,t_,bu,x5,i_]};var C5=function(){return[mE,a_]};var D5=function(){return[c_]},i_=function(e){return postMessage(e,[e.buffer])},P5=function(e){return e&&{out:e.size&&new Vt(e.size),dictionary:e.dictionary}};var jo=function(e){return e.ondata=function(t,s){return postMessage([t,s],[t.buffer])},function(t){t.data.length?(e.push(t.data[0],t.data[1]),postMessage([t.data[0].length])):e.flush()}},zm=function(e,t,s,r,i,n,a){var o,c=_5(e,r,i,function(l,u){l?(c.terminate(),t.ondata.call(t,l)):Array.isArray(u)?u.length==1?(t.queuedSize-=u[0],t.ondrain&&t.ondrain(u[0])):(u[1]&&c.terminate(),t.ondata.call(t,l,u[0],u[1])):a(u)});c.postMessage(s),t.queuedSize=0,t.push=function(l,u){t.ondata||_t(5),o&&t.ondata(_t(4,0,1),null,!!u),t.queuedSize+=l.length,c.postMessage([l,o=u],[l.buffer])},t.terminate=function(){c.terminate()},n&&(t.flush=function(){c.postMessage([])})},tu=function(e,t){return e[t]|e[t+1]<<8},su=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},T1=function(e,t){return su(e,t)+su(e,t+4)*4294967296},xs=function(e,t,s){for(;s;++t)e[t]=s,s>>>=8},n_=function(e,t){var s=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:t.level==9?2:0,e[9]=3,t.mtime!=0&&xs(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),s){e[3]=8;for(var r=0;r<=s.length;++r)e[r+10]=s.charCodeAt(r)}},mE=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&_t(6,"invalid gzip data");var t=e[3],s=10;t&4&&(s+=(e[10]|e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[s++]);return s+(t&2)},a_=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},o_=function(e){return 10+(e.filename?e.filename.length+1:0)},O5=function(e,t){var s=t.level,r=s==0?0:s<6?1:s==9?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var i=s_();i.p(t.dictionary),xs(e,2,i.d())}},c_=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&_t(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&_t(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function dd(e,t){return typeof e=="function"&&(t=e,e={}),this.ondata=t,e}var za=(function(){function e(t,s){if(typeof t=="function"&&(s=t,t={}),this.ondata=s,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new Vt(98304),this.o.dictionary){var r=this.o.dictionary.subarray(-32768);this.b.set(r,32768-r.length),this.s.i=32768-r.length}}return e.prototype.p=function(t,s){this.ondata(bu(t,this.o,0,0,this.s),s)},e.prototype.push=function(t,s){this.ondata||_t(5),this.s.l&&_t(4);var r=t.length+this.s.z;if(r>this.b.length){if(r>2*this.b.length-32768){var i=new Vt(r&-32768);i.set(this.b.subarray(0,this.s.z)),this.b=i}var n=this.b.length-this.s.z;this.b.set(t.subarray(0,n),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(n),32768),this.s.z=t.length-n+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=s&1,(this.s.z>this.s.w+8191||s)&&(this.p(this.b,s||!1),this.s.w=this.s.i,this.s.i-=2)},e.prototype.flush=function(){this.ondata||_t(5),this.s.l&&_t(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},e})(),I5=(function(){function e(t,s){zm([A5,function(){return[jo,za]}],this,dd.call(this,t,s),function(r){var i=new za(r.data);onmessage=jo(i)},6,1)}return e})();function x5(e,t){return bu(e,t||{},0,0)}var Ji=(function(){function e(t,s){typeof t=="function"&&(s=t,t={}),this.ondata=s;var r=t&&t.dictionary&&t.dictionary.subarray(-32768);this.s={i:0,b:r?r.length:0},this.o=new Vt(32768),this.p=new Vt(0),r&&this.o.set(r)}return e.prototype.e=function(t){if(this.ondata||_t(5),this.d&&_t(4),!this.p.length)this.p=t;else if(t.length){var s=new Vt(this.p.length+t.length);s.set(this.p),s.set(t,this.p.length),this.p=s}},e.prototype.c=function(t){this.s.i=+(this.d=t||!1);var s=this.s.b,r=Vm(this.p,this.s,this.o);this.ondata(ca(r,s,this.s.b),this.d),this.o=ca(r,this.s.b-32768),this.s.b=this.o.length,this.p=ca(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(t,s){this.e(t),this.c(s)},e})(),l_=(function(){function e(t,s){zm([fE,function(){return[jo,Ji]}],this,dd.call(this,t,s),function(r){var i=new Ji(r.data);onmessage=jo(i)},7,0)}return e})();function v5(e,t){return Vm(e,{i:2},t&&t.out,t&&t.dictionary)}var $G=(function(){function e(t,s){this.c=pE(),this.l=0,this.v=1,za.call(this,t,s)}return e.prototype.push=function(t,s){this.c.p(t),this.l+=t.length,za.prototype.push.call(this,t,s)},e.prototype.p=function(t,s){var r=bu(t,this.o,this.v&&o_(this.o),s&&8,this.s);this.v&&(n_(r,this.o),this.v=0),s&&(xs(r,r.length-8,this.c.d()),xs(r,r.length-4,this.l)),this.ondata(r,s)},e.prototype.flush=function(){za.prototype.flush.call(this)},e})();function R5(e,t){t||(t={});var s=pE(),r=e.length;s.p(e);var i=bu(e,t,o_(t),8),n=i.length;return n_(i,t),xs(i,n-8,s.d()),xs(i,n-4,r),i}var F1=(function(){function e(t,s){this.v=1,this.r=0,Ji.call(this,t,s)}return e.prototype.push=function(t,s){if(Ji.prototype.e.call(this,t),this.r+=t.length,this.v){var r=this.p.subarray(this.v-1),i=r.length>3?mE(r):4;if(i>r.length){if(!s)return}else this.v>1&&this.onmember&&this.onmember(this.r-r.length);this.p=r.subarray(i),this.v=0}Ji.prototype.c.call(this,s),this.s.f&&!this.s.l&&!s&&(this.v=Eu(this.s.p)+9,this.s={i:0},this.o=new Vt(0),this.push(new Vt(0),s))},e})(),N5=(function(){function e(t,s){var r=this;zm([fE,C5,function(){return[jo,Ji,F1]}],this,dd.call(this,t,s),function(i){var n=new F1(i.data);n.onmember=function(a){return postMessage(a)},onmessage=jo(n)},9,0,function(i){return r.onmember&&r.onmember(i)})}return e})();function L5(e,t){var s=mE(e);return s+8>e.length&&_t(6,"invalid gzip data"),Vm(e.subarray(s,-8),{i:2},t&&t.out||new Vt(a_(e)),t&&t.dictionary)}var QG=(function(){function e(t,s){this.c=s_(),this.v=1,za.call(this,t,s)}return e.prototype.push=function(t,s){this.c.p(t),za.prototype.push.call(this,t,s)},e.prototype.p=function(t,s){var r=bu(t,this.o,this.v&&(this.o.dictionary?6:2),s&&4,this.s);this.v&&(O5(r,this.o),this.v=0),s&&xs(r,r.length-4,this.c.d()),this.ondata(r,s)},e.prototype.flush=function(){za.prototype.flush.call(this)},e})();var U1=(function(){function e(t,s){Ji.call(this,t,s),this.v=t&&t.dictionary?2:1}return e.prototype.push=function(t,s){if(Ji.prototype.e.call(this,t),this.v){if(this.p.length<6&&!s)return;this.p=this.p.subarray(c_(this.p,this.v-1)),this.v=0}s&&(this.p.length<4&&_t(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),Ji.prototype.c.call(this,s)},e})(),B5=(function(){function e(t,s){zm([fE,D5,function(){return[jo,Ji,U1]}],this,dd.call(this,t,s),function(r){var i=new U1(r.data);onmessage=jo(i)},11,0)}return e})();var c2=(function(){function e(t,s){this.o=dd.call(this,t,s)||{},this.G=F1,this.I=Ji,this.Z=U1}return e.prototype.i=function(){var t=this;this.s.ondata=function(s,r){t.ondata(s,r)}},e.prototype.push=function(t,s){if(this.ondata||_t(5),this.s)this.s.push(t,s);else{if(this.p&&this.p.length){var r=new Vt(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length)}else this.p=t;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,s),this.p=null)}},e})(),eY=(function(){function e(t,s){c2.call(this,t,s),this.queuedSize=0,this.G=N5,this.I=l_,this.Z=B5}return e.prototype.i=function(){var t=this;this.s.ondata=function(s,r,i){t.ondata(s,r,i)},this.s.ondrain=function(s){t.queuedSize-=s,t.ondrain&&t.ondrain(s)}},e.prototype.push=function(t,s){this.queuedSize+=t.length,c2.prototype.push.call(this,t,s)},e})();var l2=typeof TextEncoder<"u"&&new TextEncoder,H1=typeof TextDecoder<"u"&&new TextDecoder,u_=0;try{H1.decode(Ro,{stream:!0}),u_=1}catch{}var h_=function(e){for(var t="",s=0;;){var r=e[s++],i=(r>127)+(r>223)+(r>239);if(s+i>e.length)return{s:t,r:ca(e,s-1)};i?i==3?(r=((r&15)<<18|(e[s++]&63)<<12|(e[s++]&63)<<6|e[s++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?t+=String.fromCharCode((r&31)<<6|e[s++]&63):t+=String.fromCharCode((r&15)<<12|(e[s++]&63)<<6|e[s++]&63):t+=String.fromCharCode(r)}},tY=(function(){function e(t){this.ondata=t,u_?this.t=new TextDecoder:this.p=Ro}return e.prototype.push=function(t,s){if(this.ondata||_t(5),s=!!s,this.t){this.ondata(this.t.decode(t,{stream:!0}),s),s&&(this.t.decode().length&&_t(8),this.t=null);return}this.p||_t(4);var r=new Vt(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length);var i=h_(r),n=i.s,a=i.r;s?(a.length&&_t(8),this.p=null):this.p=a,this.ondata(n,s)},e})(),sY=(function(){function e(t){this.ondata=t}return e.prototype.push=function(t,s){this.ondata||_t(5),this.d&&_t(4),this.ondata(G1(t),this.d=s||!1)},e})();function G1(e,t){if(t){for(var s=new Vt(e.length),r=0;r<e.length;++r)s[r]=e.charCodeAt(r);return s}if(l2)return l2.encode(e);for(var i=e.length,n=new Vt(e.length+(e.length>>1)),a=0,o=function(h){n[a++]=h},r=0;r<i;++r){if(a+5>n.length){var c=new Vt(a+8+(i-r<<1));c.set(n),n=c}var l=e.charCodeAt(r);l<128||t?o(l):l<2048?(o(192|l>>6),o(128|l&63)):l>55295&&l<57344?(l=65536+(l&1047552)|e.charCodeAt(++r)&1023,o(240|l>>18),o(128|l>>12&63),o(128|l>>6&63),o(128|l&63)):(o(224|l>>12),o(128|l>>6&63),o(128|l&63))}return ca(n,0,a)}function k5(e,t){if(t){for(var s="",r=0;r<e.length;r+=16384)s+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return s}else{if(H1)return H1.decode(e);var i=h_(e),n=i.s,s=i.r;return s.length&&_t(8),n}}var d_=function(e){return e==1?3:e<6?2:e==9?1:0};var M5=function(e,t){for(;tu(e,t)!=1;t+=4+tu(e,t+2));return[T1(e,t+12),T1(e,t+4),T1(e,t+20)]},pm=function(e){var t=0;if(e)for(var s in e){var r=e[s].length;r>65535&&_t(9),t+=r+4}return t},u2=function(e,t,s,r,i,n,a,o){var c=r.length,l=s.extra,u=o&&o.length,h=pm(l);xs(e,t,a!=null?33639248:67324752),t+=4,a!=null&&(e[t++]=20,e[t++]=s.os),e[t]=20,t+=2,e[t++]=s.flag<<1|(n<0&&8),e[t++]=i&&8,e[t++]=s.compression&255,e[t++]=s.compression>>8;var p=new Date(s.mtime==null?Date.now():s.mtime),d=p.getFullYear()-1980;if((d<0||d>119)&&_t(10),xs(e,t,d<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),t+=4,n!=-1&&(xs(e,t,s.crc),xs(e,t+4,n<0?-n-2:n),xs(e,t+8,s.size)),xs(e,t+12,c),xs(e,t+14,h),t+=16,a!=null&&(xs(e,t,u),xs(e,t+6,s.attrs),xs(e,t+10,a),t+=14),e.set(r,t),t+=c,h)for(var f in l){var m=l[f],g=m.length;xs(e,t,+f),xs(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(o,t),t+=u),t},j5=function(e,t,s,r,i){xs(e,t,101010256),xs(e,t+8,s),xs(e,t+10,s),xs(e,t+12,r),xs(e,t+16,i)},xm=(function(){function e(t){this.filename=t,this.c=pE(),this.size=0,this.compression=0}return e.prototype.process=function(t,s){this.ondata(null,t,s)},e.prototype.push=function(t,s){this.ondata||_t(5),this.c.p(t),this.size+=t.length,s&&(this.crc=this.c.d()),this.process(t,s||!1)},e})(),rY=(function(){function e(t,s){var r=this;s||(s={}),xm.call(this,t),this.d=new za(s,function(i,n){r.ondata(null,i,n)}),this.compression=8,this.flag=d_(s.level)}return e.prototype.process=function(t,s){try{this.d.push(t,s)}catch(r){this.ondata(r,null,s)}},e.prototype.push=function(t,s){xm.prototype.push.call(this,t,s)},e})(),iY=(function(){function e(t,s){var r=this;s||(s={}),xm.call(this,t),this.d=new I5(s,function(i,n,a){r.ondata(i,n,a)}),this.compression=8,this.flag=d_(s.level),this.terminate=this.d.terminate}return e.prototype.process=function(t,s){this.d.push(t,s)},e.prototype.push=function(t,s){xm.prototype.push.call(this,t,s)},e})(),nY=(function(){function e(t){this.ondata=t,this.u=[],this.d=1}return e.prototype.add=function(t){var s=this;if(this.ondata||_t(5),this.d&2)this.ondata(_t(4+(this.d&1)*8,0,1),null,!1);else{var r=G1(t.filename),i=r.length,n=t.comment,a=n&&G1(n),o=i!=t.filename.length||a&&n.length!=a.length,c=i+pm(t.extra)+30;i>65535&&this.ondata(_t(11,0,1),null,!1);var l=new Vt(c);u2(l,0,t,r,o,-1);var u=[l],h=function(){for(var g=0,b=u;g<b.length;g++){var E=b[g];s.ondata(null,E,!1)}u=[]},p=this.d;this.d=0;var d=this.u.length,f=r_(t,{f:r,u:o,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(h(),p){var g=s.u[d+1];g?g.r():s.d=1}p=1}}),m=0;t.ondata=function(g,b,E){if(g)s.ondata(g,b,E),s.terminate();else if(m+=b.length,u.push(b),E){var y=new Vt(16);xs(y,0,134695760),xs(y,4,t.crc),xs(y,8,m),xs(y,12,t.size),u.push(y),f.c=m,f.b=c+m+16,f.crc=t.crc,f.size=t.size,p&&f.r(),p=1}else p&&h()},this.u.push(f)}},e.prototype.end=function(){var t=this;if(this.d&2){this.ondata(_t(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){t.d&1&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var t=0,s=0,r=0,i=0,n=this.u;i<n.length;i++){var a=n[i];r+=46+a.f.length+pm(a.extra)+(a.o?a.o.length:0)}for(var o=new Vt(r+22),c=0,l=this.u;c<l.length;c++){var a=l[c];u2(o,t,a,a.f,a.u,-a.c-2,s,a.o),t+=46+a.f.length+pm(a.extra)+(a.o?a.o.length:0),s+=a.b}j5(o,t,this.u.length,r,s),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var t=0,s=this.u;t<s.length;t++){var r=s[t];r.t()}this.d=2},e})();var F5=(function(){function e(){}return e.prototype.push=function(t,s){this.ondata(null,t,s)},e.compression=0,e})(),aY=(function(){function e(){var t=this;this.i=new Ji(function(s,r){t.ondata(null,s,r)})}return e.prototype.push=function(t,s){try{this.i.push(t,s)}catch(r){this.ondata(r,null,s)}},e.compression=8,e})(),oY=(function(){function e(t,s){var r=this;s<32e4?this.i=new Ji(function(i,n){r.ondata(null,i,n)}):(this.i=new l_(function(i,n,a){r.ondata(i,n,a)}),this.terminate=this.i.terminate)}return e.prototype.push=function(t,s){this.i.terminate&&(t=ca(t,0)),this.i.push(t,s)},e.compression=8,e})(),cY=(function(){function e(t){this.onfile=t,this.k=[],this.o={0:F5},this.p=Ro}return e.prototype.push=function(t,s){var r=this;if(this.onfile||_t(5),this.p||_t(4),this.c>0){var i=Math.min(this.c,t.length),n=t.subarray(0,i);if(this.c-=i,this.d?this.d.push(n,!this.c):this.k[0].push(n),t=t.subarray(i),t.length)return this.push(t,s)}else{var a=0,o=0,c=void 0,l=void 0;this.p.length?t.length?(l=new Vt(this.p.length+t.length),l.set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var u=l.length,h=this.c,p=h&&this.d,d=function(){var b,E=su(l,o);if(E==67324752){a=1,c=o,f.d=null,f.c=0;var y=tu(l,o+6),T=tu(l,o+8),w=y&2048,S=y&8,_=tu(l,o+26),C=tu(l,o+28);if(u>o+30+_+C){var x=[];f.k.unshift(x),a=2;var D=su(l,o+18),I=su(l,o+22),P=k5(l.subarray(o+30,o+=30+_),!w);D==4294967295?(b=S?[-2]:M5(l,o),D=b[0],I=b[1]):S&&(D=-1),o+=C,f.c=D;var L,F={name:P,compression:T,start:function(){if(F.ondata||_t(5),!D)F.ondata(null,Ro,!0);else{var V=r.o[T];V||F.ondata(_t(14,"unknown compression type "+T,1),null,!1),L=D<0?new V(P):new V(P,D,I),L.ondata=function(R,v,j){F.ondata(R,v,j)};for(var B=0,k=x;B<k.length;B++){var O=k[B];L.push(O,!1)}r.k[0]==x&&r.c?r.d=L:L.push(Ro,!0)}},terminate:function(){L&&L.terminate&&L.terminate()}};D>=0&&(F.size=D,F.originalSize=I),f.onfile(F)}return"break"}else if(h){if(E==134695760)return c=o+=12+(h==-2&&8),a=3,f.c=0,"break";if(E==33639248)return c=o-=4,a=3,f.c=0,"break"}},f=this;o<u-4;++o){var m=d();if(m==="break")break}if(this.p=Ro,h<0){var g=a?l.subarray(0,c-12-(h==-2&&8)-(su(l,c-16)==134695760&&4)):l.subarray(0,o);p?p.push(g,!!a):this.k[+(a==2)].push(g)}if(a&2)return this.push(l.subarray(o),s);this.p=l.subarray(o)}s&&(this.c&&_t(13),this.p=null)},e.prototype.register=function(t){this.o[t.compression]=t},e})();var La,ks,Bn=(e=>(e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.LOGIN_FAIL=402]="LOGIN_FAIL",e[e.PERMISSION_DENIED=422]="PERMISSION_DENIED",e[e.PERMISSION_DENIED1=1111111]="PERMISSION_DENIED1",e[e.PERMISSION_DENIED_PARAMS=1111112]="PERMISSION_DENIED_PARAMS",e[e.DATA_NOT_FOUND=1111113]="DATA_NOT_FOUND",e[e.PARAMS_DATA_NOT_FOUND=1111114]="PARAMS_DATA_NOT_FOUND",e[e.REQUEST_PARAM_ILLEGAL=42222]="REQUEST_PARAM_ILLEGAL",e[e.REQUEST_PARAM_ILLEGAL1=1111115]="REQUEST_PARAM_ILLEGAL1",e[e.REQUEST_PARAMS_ILLEGAL2=1111116]="REQUEST_PARAMS_ILLEGAL2",e[e.REQUEST_PARAMS_NOT_NULL=1111117]="REQUEST_PARAMS_NOT_NULL",e[e.REQUEST_PARAMS_NOT_ALL_NULL=1111118]="REQUEST_PARAMS_NOT_ALL_NULL",e[e.REQUEST_PARAMS_MUST_ARRAY=1111119]="REQUEST_PARAMS_MUST_ARRAY",e[e.REQUEST_PARAMS_MUST_STRING=1111120]="REQUEST_PARAMS_MUST_STRING",e[e.REQUEST_PARAMS_MUST_NUMBER=1111121]="REQUEST_PARAMS_MUST_NUMBER",e[e.REQUEST_PARAMS_MUST_NUMBER_ARRAY=1111122]="REQUEST_PARAMS_MUST_NUMBER_ARRAY",e[e.REQUEST_PARAMS_MUST_STRING_ARRAY=1111123]="REQUEST_PARAMS_MUST_STRING_ARRAY",e[e.REQUEST_PARAMS_LENGTH_ERROR=1111124]="REQUEST_PARAMS_LENGTH_ERROR",e[e.REQUEST_PARAMS_TYPE_ERROR=1111125]="REQUEST_PARAMS_TYPE_ERROR",e[e.ILLEGAL_NAME=2001]="ILLEGAL_NAME",e[e.ILLEGAL_NAME1=1111126]="ILLEGAL_NAME1",e[e.ILLEGAL_NAME_ZH=1111128]="ILLEGAL_NAME_ZH",e[e.UUID_ERROR=1111127]="UUID_ERROR",e[e.DUPLICATE_DATA=1000001]="DUPLICATE_DATA",e[e.DUPLICATE_DATA1=11e3]="DUPLICATE_DATA1",e[e.DUPLICATE_DATA_PARAMS=1000017]="DUPLICATE_DATA_PARAMS",e[e.UPLOAD_LIMIT=10034]="UPLOAD_LIMIT",e[e.MORE_THAN_LIMIT=1000003]="MORE_THAN_LIMIT",e[e.FILE_MORE_THAN_LIMIT=1000004]="FILE_MORE_THAN_LIMIT",e[e.PARAMS_MORE_THAN_LIMIT=1000005]="PARAMS_MORE_THAN_LIMIT",e[e.IMAGE_MORE_THAN_LIMIT_PARAMS=1000006]="IMAGE_MORE_THAN_LIMIT_PARAMS",e[e.FILE_MORE_THAN_LIMIT_PARAMS=1000007]="FILE_MORE_THAN_LIMIT_PARAMS",e[e.END_MUST_AFTER_START=1000019]="END_MUST_AFTER_START",e[e.REQUEST_PARAMS_TIME_ERROR=1000009]="REQUEST_PARAMS_TIME_ERROR",e[e.FILES_PATH_NOT_FOUND=1000018]="FILES_PATH_NOT_FOUND",e[e.FILES_DATA_NOT_FOUND=1000011]="FILES_DATA_NOT_FOUND",e[e.FILES_TYPE_ERROR=1000012]="FILES_TYPE_ERROR",e[e.FILES_TYPE_MUST_BE_ONE=1000013]="FILES_TYPE_MUST_BE_ONE",e[e.SET_WATERMARK_FAIL=1000014]="SET_WATERMARK_FAIL",e[e.MYSQL_CRUD_ERROR=1000015]="MYSQL_CRUD_ERROR",e[e.PARAMS_JSON_FAILED=1000016]="PARAMS_JSON_FAILED",e[e.MYSQL_ERROR=3000001]="MYSQL_ERROR",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.PRJ_NAME_EXISTS=2002]="PRJ_NAME_EXISTS",e[e.BACKUP_NAME_EXISTS=3002]="BACKUP_NAME_EXISTS",e[e.PRJ_NOT_EXIST=2000001]="PRJ_NOT_EXIST",e[e.ERROR_PATH=4000002]="ERROR_PATH",e[e.PROJECT_NOT_FOUND=6000001]="PROJECT_NOT_FOUND",e[e.TITLE_ILLEGAL_LEN=2003]="TITLE_ILLEGAL_LEN",e[e.FILE_READ_ONLY=1000002]="FILE_READ_ONLY",e[e.FILE_READ_ONLY1=1000008]="FILE_READ_ONLY1",e[e.DATA_NOT_EXIST=1000010]="DATA_NOT_EXIST",e[e.LIB_NOT_EXIST=2000001]="LIB_NOT_EXIST",e[e.CONFIG_API_URLS_ERROR=3001001]="CONFIG_API_URLS_ERROR",e[e.ONE_CLICK_ORDER_NOT_OPEN=3001002]="ONE_CLICK_ORDER_NOT_OPEN",e[e.MATERIAL_NOT_OPEN=3001003]="MATERIAL_NOT_OPEN",e[e.SNAPSHOT_DEPTH_LIMIT=3001004]="SNAPSHOT_DEPTH_LIMIT",e[e.OCR_SYMBOL_URL_ERROR=3001005]="OCR_SYMBOL_URL_ERROR",e[e.USER_DATA_NOT_FOUND=4000001]="USER_DATA_NOT_FOUND",e[e.USER_DISABLE_ERROR=4000012]="USER_DISABLE_ERROR",e[e.USER_EXISTS_LOGIN_ERROR=4000003]="USER_EXISTS_LOGIN_ERROR",e[e.USER_UNAUTHORIZED_MODULES_ERROR=4000004]="USER_UNAUTHORIZED_MODULES_ERROR",e[e.USER_UNAUTHORIZED_ACCESS_ERROR=4000005]="USER_UNAUTHORIZED_ACCESS_ERROR",e[e.ADMIN_NOT_CHANGE_PASSWORD=4000006]="ADMIN_NOT_CHANGE_PASSWORD",e[e.SAME_PASSWORD_NEW_PASSWORD=4000007]="SAME_PASSWORD_NEW_PASSWORD",e[e.USER_ONLINE_REGISTRATION_FAILED=4000008]="USER_ONLINE_REGISTRATION_FAILED",e[e.USER_PASSWORD_CAN_NOT_DEFAULT=4000009]="USER_PASSWORD_CAN_NOT_DEFAULT",e[e.USER_BEFORE_PASSWORD_ERROR=4000010]="USER_BEFORE_PASSWORD_ERROR",e[e.USER_PASSWORD_LENGTH_ERROR=4000011]="USER_PASSWORD_LENGTH_ERROR",e[e.ORG_ROLE_NOT_CREATE=5000001]="ORG_ROLE_NOT_CREATE",e[e.ORG_ROLE_NAME_DUPLICATE=5000002]="ORG_ROLE_NAME_DUPLICATE",e[e.ORG_ROLE_ORIGIN_ERROR=5000003]="ORG_ROLE_ORIGIN_ERROR",e[e.ORG_ROLE_NOT_DEFAULT=5000004]="ORG_ROLE_NOT_DEFAULT",e[e.ADMIN_ROLE_NOT_CHANGE=5000005]="ADMIN_ROLE_NOT_CHANGE",e[e.ADMIN_NOT_CHANGE_STATUS=5000006]="ADMIN_NOT_CHANGE_STATUS",e[e.PROJECT_ARCHIVED=6000002]="PROJECT_ARCHIVED",e[e.PROJECT_UUID_NULL=6000003]="PROJECT_UUID_NULL",e[e.PROJECT_UUID_ERROR=6000004]="PROJECT_UUID_ERROR",e[e.PROJECT_OR_TEAM_UUID_ERROR=6000005]="PROJECT_OR_TEAM_UUID_ERROR",e[e.PROJECT_NOT_PERSON_ERROR=6000006]="PROJECT_NOT_PERSON_ERROR",e[e.PROJECT_DUPLICATE_NAME=6000007]="PROJECT_DUPLICATE_NAME",e[e.ANNOTATION_HAS_BE_FOUND=6000008]="ANNOTATION_HAS_BE_FOUND",e[e.ANNOTATION_NOT_FOUND=6000009]="ANNOTATION_NOT_FOUND",e[e.ANNOTATION_CREATE_ERROR=6000010]="ANNOTATION_CREATE_ERROR",e[e.ANNOTATION_UPDATE_ERROR=6000011]="ANNOTATION_UPDATE_ERROR",e[e.ANNOTATION_DELETE_ERROR=6000012]="ANNOTATION_DELETE_ERROR",e[e.PROJECT_DUPLICATE_PATH=6000013]="PROJECT_DUPLICATE_PATH",e[e.TEAM_NOT_FOUND=7000001]="TEAM_NOT_FOUND",e[e.TEAM_UUID_NULL=7000002]="TEAM_UUID_NULL",e[e.TEAM_FOLDER_ERROR=7000003]="TEAM_FOLDER_ERROR",e[e.TEAM_FOLDER_DEEP_ERROR=7000004]="TEAM_FOLDER_DEEP_ERROR",e[e.TEAM_FOLDER_UUID_ERROR=7000005]="TEAM_FOLDER_UUID_ERROR",e[e.TEAM_URL_DUPLICATE=7000006]="TEAM_URL_DUPLICATE",e[e.TEAM_CAN_NOT_DELETE=7000007]="TEAM_CAN_NOT_DELETE",e[e.COMPONENT_UUID_NULL=8000001]="COMPONENT_UUID_NULL",e[e.COMPONENT_DATA_NOT_FOUND=8000002]="COMPONENT_DATA_NOT_FOUND",e[e.COMPONENT_NAME_DUPLICATE=8000003]="COMPONENT_NAME_DUPLICATE",e[e.COMPONENT_TYPE_ERROR=8000004]="COMPONENT_TYPE_ERROR",e[e.DELETE_SON_CATEGORY=8001001]="DELETE_SON_CATEGORY",e[e.LICENSE=9000001]="LICENSE",e[e.START_TIME=9000002]="START_TIME",e[e.END_TIME=9000003]="END_TIME",e[e.PROJECT_LIMIT=9000004]="PROJECT_LIMIT",e[e.USER_LIMIT=9000005]="USER_LIMIT",e[e.ONLINE_NUMBER_LIMIT=9000006]="ONLINE_NUMBER_LIMIT",e[e.COMPANY_CODE=9000007]="COMPANY_CODE",e[e.LIMIT_PCB=9000008]="LIMIT_PCB",e[e.LIMIT_SCH=9000009]="LIMIT_SCH",e[e.LIMIT_PANEL=9000011]="LIMIT_PANEL",e[e.TIME_ERROR=9000010]="TIME_ERROR",e[e.LICENSE_ERROR=9000012]="LICENSE_ERROR",e[e.LICENSE_TYPE_ERROR=9000013]="LICENSE_TYPE_ERROR",e[e.LICENSE_ORIGIN_ERROR=9000014]="LICENSE_ORIGIN_ERROR",e[e.BRANCH_DATA_NOT_FOUND=11000001]="BRANCH_DATA_NOT_FOUND",e[e.PARENT_UUID_ERROR=11000002]="PARENT_UUID_ERROR",e[e.BRANCH_MUST_AFTER_NODE=11000003]="BRANCH_MUST_AFTER_NODE",e[e.BRANCH_NAME_ERROR=11000004]="BRANCH_NAME_ERROR",e[e.BRANCH_NAME_DUPLICATE=11000005]="BRANCH_NAME_DUPLICATE",e[e.BRANCH_UUID_ERROR=11000006]="BRANCH_UUID_ERROR",e[e.BRANCH_NODE_SET_ERROR=11000007]="BRANCH_NODE_SET_ERROR",e[e.BRANCH_DELETE_MAIN_ERROR=11000008]="BRANCH_DELETE_MAIN_ERROR",e[e.BRANCH_CHECK_OUT_ERROR=11000009]="BRANCH_CHECK_OUT_ERROR",e[e.DOCUMENT_UUID_ERROR=12000001]="DOCUMENT_UUID_ERROR",e[e.UPDATE_FAILED=12000002]="UPDATE_FAILED",e[e.INNER_API_KEY_ERROR=1000020]="INNER_API_KEY_ERROR",e[e.BRANCH_MORE_THAN_LIMIT=11000010]="BRANCH_MORE_THAN_LIMIT",e[e.WORKSPACE_API_ERROR=1000021]="WORKSPACE_API_ERROR",e))(Bn||{}),U5=(e=>(e.UNAUTHORIZED="UNAUTHORIZED",e.LOGIN_FAIL="LOGIN_FAIL",e.PERMISSION_DENIED="PERMISSION_DENIED",e.PERMISSION_DENIED1="PERMISSION_DENIED1",e.PERMISSION_DENIED_PARAMS="PERMISSION_DENIED_PARAMS",e.DATA_NOT_FOUND="DATA_NOT_FOUND",e.PARAMS_DATA_NOT_FOUND="PARAMS_DATA_NOT_FOUND",e.REQUEST_PARAM_ILLEGAL="REQUEST_PARAM_ILLEGAL",e.REQUEST_PARAM_ILLEGAL1="REQUEST_PARAM_ILLEGAL1",e.REQUEST_PARAMS_ILLEGAL2="REQUEST_PARAMS_ILLEGAL2",e.REQUEST_PARAMS_NOT_NULL="REQUEST_PARAMS_NOT_NULL",e.REQUEST_PARAMS_NOT_ALL_NULL="REQUEST_PARAMS_NOT_ALL_NULL",e.REQUEST_PARAMS_MUST_ARRAY="REQUEST_PARAMS_MUST_ARRAY",e.REQUEST_PARAMS_MUST_STRING="REQUEST_PARAMS_MUST_STRING",e.REQUEST_PARAMS_MUST_NUMBER="REQUEST_PARAMS_MUST_NUMBER",e.REQUEST_PARAMS_MUST_NUMBER_ARRAY="REQUEST_PARAMS_MUST_NUMBER_ARRAY",e.REQUEST_PARAMS_MUST_STRING_ARRAY="REQUEST_PARAMS_MUST_STRING_ARRAY",e.REQUEST_PARAMS_LENGTH_ERROR="REQUEST_PARAMS_LENGTH_ERROR",e.REQUEST_PARAMS_TYPE_ERROR="REQUEST_PARAMS_TYPE_ERROR",e.ILLEGAL_NAME="ILLEGAL_NAME",e.ILLEGAL_NAME1="ILLEGAL_NAME1",e.ILLEGAL_NAME_ZH="ILLEGAL_NAME_ZH",e.UUID_ERROR="UUID_ERROR",e.DUPLICATE_DATA="DUPLICATE_DATA",e.DUPLICATE_DATA1="DUPLICATE_DATA1",e.DUPLICATE_DATA_PARAMS="DUPLICATE_DATA_PARAMS",e.UPLOAD_LIMIT="UPLOAD_LIMIT",e.MORE_THAN_LIMIT="MORE_THAN_LIMIT",e.FILE_MORE_THAN_LIMIT="FILE_MORE_THAN_LIMIT",e.PARAMS_MORE_THAN_LIMIT="PARAMS_MORE_THAN_LIMIT",e.IMAGE_MORE_THAN_LIMIT_PARAMS="IMAGE_MORE_THAN_LIMIT_PARAMS",e.FILE_MORE_THAN_LIMIT_PARAMS="FILE_MORE_THAN_LIMIT_PARAMS",e.END_MUST_AFTER_START="END_MUST_AFTER_START",e.REQUEST_PARAMS_TIME_ERROR="REQUEST_PARAMS_TIME_ERROR",e.FILES_PATH_NOT_FOUND="FILES_PATH_NOT_FOUND",e.FILES_DATA_NOT_FOUND="FILES_DATA_NOT_FOUND",e.FILES_TYPE_ERROR="FILES_TYPE_ERROR",e.FILES_TYPE_MUST_BE_ONE="FILES_TYPE_MUST_BE_ONE",e.SET_WATERMARK_FAIL="SET_WATERMARK_FAIL",e.MYSQL_CRUD_ERROR="MYSQL_CRUD_ERROR",e.PARAMS_JSON_FAILED="PARAMS_JSON_FAILED",e.MYSQL_ERROR="MYSQL_ERROR",e.NOT_FOUND="NOT_FOUND",e.PRJ_NAME_EXISTS="PRJ_NAME_EXISTS",e.BACKUP_NAME_EXISTS="BACKUP_NAME_EXISTS",e.PRJ_NOT_EXIST="PRJ_NOT_EXIST",e.ERROR_PATH="ERROR_PATH",e.PROJECT_NOT_FOUND="PROJECT_NOT_FOUND",e.TITLE_ILLEGAL_LEN="TITLE_ILLEGAL_LEN",e.FILE_READ_ONLY="FILE_READ_ONLY",e.FILE_READ_ONLY1="FILE_READ_ONLY1",e.DATA_NOT_EXIST="DATA_NOT_EXIST",e.LIB_NOT_EXIST="LIB_NOT_EXIST",e.CONFIG_API_URLS_ERROR="CONFIG_API_URLS_ERROR",e.ONE_CLICK_ORDER_NOT_OPEN="ONE_CLICK_ORDER_NOT_OPEN",e.MATERIAL_NOT_OPEN="MATERIAL_NOT_OPEN",e.SNAPSHOT_DEPTH_LIMIT="SNAPSHOT_DEPTH_LIMIT",e.OCR_SYMBOL_URL_ERROR="OCR_SYMBOL_URL_ERROR",e.USER_DATA_NOT_FOUND="USER_DATA_NOT_FOUND",e.USER_DISABLE_ERROR="USER_DISABLE_ERROR",e.USER_EXISTS_LOGIN_ERROR="USER_EXISTS_LOGIN_ERROR",e.USER_UNAUTHORIZED_MODULES_ERROR="USER_UNAUTHORIZED_MODULES_ERROR",e.USER_UNAUTHORIZED_ACCESS_ERROR="USER_UNAUTHORIZED_ACCESS_ERROR",e.ADMIN_NOT_CHANGE_PASSWORD="ADMIN_NOT_CHANGE_PASSWORD",e.SAME_PASSWORD_NEW_PASSWORD="SAME_PASSWORD_NEW_PASSWORD",e.USER_ONLINE_REGISTRATION_FAILED="USER_ONLINE_REGISTRATION_FAILED",e.USER_PASSWORD_CAN_NOT_DEFAULT="USER_PASSWORD_CAN_NOT_DEFAULT",e.USER_BEFORE_PASSWORD_ERROR="USER_BEFORE_PASSWORD_ERROR",e.USER_PASSWORD_LENGTH_ERROR="USER_PASSWORD_LENGTH_ERROR",e.ORG_ROLE_NOT_CREATE="ORG_ROLE_NOT_CREATE",e.ORG_ROLE_NAME_DUPLICATE="ORG_ROLE_NAME_DUPLICATE",e.ORG_ROLE_ORIGIN_ERROR="ORG_ROLE_ORIGIN_ERROR",e.ORG_ROLE_NOT_DEFAULT="ORG_ROLE_NOT_DEFAULT",e.ADMIN_ROLE_NOT_CHANGE="ADMIN_ROLE_NOT_CHANGE",e.ADMIN_NOT_CHANGE_STATUS="ADMIN_NOT_CHANGE_STATUS",e.PROJECT_ARCHIVED="PROJECT_ARCHIVED",e.PROJECT_UUID_NULL="PROJECT_UUID_NULL",e.PROJECT_UUID_ERROR="PROJECT_UUID_ERROR",e.PROJECT_OR_TEAM_UUID_ERROR="PROJECT_OR_TEAM_UUID_ERROR",e.PROJECT_NOT_PERSON_ERROR="PROJECT_NOT_PERSON_ERROR",e.PROJECT_DUPLICATE_NAME="PROJECT_DUPLICATE_NAME",e.ANNOTATION_HAS_BE_FOUND="ANNOTATION_HAS_BE_FOUND",e.ANNOTATION_NOT_FOUND="ANNOTATION_NOT_FOUND",e.ANNOTATION_CREATE_ERROR="ANNOTATION_CREATE_ERROR",e.ANNOTATION_UPDATE_ERROR="ANNOTATION_UPDATE_ERROR",e.ANNOTATION_DELETE_ERROR="ANNOTATION_DELETE_ERROR",e.PROJECT_DUPLICATE_PATH="PROJECT_DUPLICATE_PATH",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.TEAM_UUID_NULL="TEAM_UUID_NULL",e.TEAM_FOLDER_ERROR="TEAM_FOLDER_ERROR",e.TEAM_FOLDER_DEEP_ERROR="TEAM_FOLDER_DEEP_ERROR",e.TEAM_FOLDER_UUID_ERROR="TEAM_FOLDER_UUID_ERROR",e.TEAM_URL_DUPLICATE="TEAM_URL_DUPLICATE",e.TEAM_CAN_NOT_DELETE="TEAM_CAN_NOT_DELETE",e.COMPONENT_UUID_NULL="COMPONENT_UUID_NULL",e.COMPONENT_DATA_NOT_FOUND="COMPONENT_DATA_NOT_FOUND",e.COMPONENT_NAME_DUPLICATE="COMPONENT_NAME_DUPLICATE",e.COMPONENT_TYPE_ERROR="COMPONENT_TYPE_ERROR",e.DELETE_SON_CATEGORY="DELETE_SON_CATEGORY",e.LICENSE="LICENSE",e.START_TIME="START_TIME",e.END_TIME="END_TIME",e.PROJECT_LIMIT="PROJECT_LIMIT",e.USER_LIMIT="USER_LIMIT",e.ONLINE_NUMBER_LIMIT="ONLINE_NUMBER_LIMIT",e.COMPANY_CODE="COMPANY_CODE",e.LIMIT_PCB="LIMIT_PCB",e.LIMIT_SCH="LIMIT_SCH",e.LIMIT_PANEL="LIMIT_PANEL",e.TIME_ERROR="TIME_ERROR",e.LICENSE_ERROR="LICENSE_ERROR",e.LICENSE_TYPE_ERROR="LICENSE_TYPE_ERROR",e.LICENSE_ORIGIN_ERROR="LICENSE_ORIGIN_ERROR",e.BRANCH_DATA_NOT_FOUND="BRANCH_DATA_NOT_FOUND",e.PARENT_UUID_ERROR="PARENT_UUID_ERROR",e.BRANCH_MUST_AFTER_NODE="BRANCH_MUST_AFTER_NODE",e.BRANCH_NAME_ERROR="BRANCH_NAME_ERROR",e.BRANCH_NAME_DUPLICATE="BRANCH_NAME_DUPLICATE",e.BRANCH_UUID_ERROR="BRANCH_UUID_ERROR",e.BRANCH_NODE_SET_ERROR="BRANCH_NODE_SET_ERROR",e.BRANCH_DELETE_MAIN_ERROR="BRANCH_DELETE_MAIN_ERROR",e.BRANCH_CHECK_OUT_ERROR="BRANCH_CHECK_OUT_ERROR",e.DOCUMENT_UUID_ERROR="DOCUMENT_UUID_ERROR",e.UPDATE_FAILED="UPDATE_FAILED",e.INNER_API_KEY_ERROR="INNER_API_KEY_ERROR",e.BRANCH_MORE_THAN_LIMIT="BRANCH_MORE_THAN_LIMIT",e.WORKSPACE_API_ERROR="WORKSPACE_API_ERROR",e))(U5||{}),gE=(e=>(e[e.DB_INIT_ERROR=0]="DB_INIT_ERROR",e[e.PRJ_NOT_EXIST=1]="PRJ_NOT_EXIST",e[e.NET_ERROR=2]="NET_ERROR",e[e.IS_OPENING=3]="IS_OPENING",e[e.NOT_LOGGED_IN=4]="NOT_LOGGED_IN",e[e.HAS_UNSAVED=5]="HAS_UNSAVED",e[e.DIFF_TICKET=6]="DIFF_TICKET",e))(gE||{});function Dt(e,t={}){if(!e)return"";let{code:s,message:r}=e;switch(s){case 401:return Re("UNAUTHORIZED");case 402:return Re("LOGIN_FAIL");case 422:return Re("PERMISSION_DENIED");case 1111111:return Re("PERMISSION_DENIED1");case 2000001:return Re("PRJ_NOT_EXIST");case 4000002:return Re("ERROR_PATH");case 6000001:return Re("PROJECT_NOT_FOUND");case 1111112:return Re("PERMISSION_DENIED_PARAMS",{type:r});case 1111113:return Re("DATA_NOT_FOUND");case 1111114:return Re("PARAMS_DATA_NOT_FOUND",{type:r});case 42222:return Re("REQUEST_PARAM_ILLEGAL");case 1111115:return Re("REQUEST_PARAM_ILLEGAL1");case 1111116:return Re("REQUEST_PARAMS_ILLEGAL2",{type:r});case 1111117:return Re("REQUEST_PARAMS_NOT_NULL",{type:r});case 1111118:return Re("REQUEST_PARAMS_NOT_ALL_NULL",{type:r});case 1111119:return Re("REQUEST_PARAMS_MUST_ARRAY",{type:r});case 1111120:return Re("REQUEST_PARAMS_MUST_STRING",{type:r});case 1111121:return Re("REQUEST_PARAMS_MUST_NUMBER",{type:r});case 1111122:return Re("REQUEST_PARAMS_MUST_NUMBER_ARRAY",{type:r});case 1111123:return Re("REQUEST_PARAMS_MUST_STRING_ARRAY",{type:r});case 1111124:return Re("REQUEST_PARAMS_LENGTH_ERROR",{type:r});case 1111125:return Re("REQUEST_PARAMS_TYPE_ERROR",{type:r});case 2001:return Re("ILLEGAL_NAME");case 1111126:return Re("ILLEGAL_NAME1");case 1111128:return Re("ILLEGAL_NAME_ZH");case 1111127:return Re("UUID_ERROR");case 1000001:return Re("DUPLICATE_DATA");case 11e3:return Re("DUPLICATE_DATA1");case 1000017:return Re("DUPLICATE_DATA_PARAMS",{type:r});case 10034:return Re("UPLOAD_LIMIT");case 1000003:return Re("MORE_THAN_LIMIT");case 1000004:return Re("FILE_MORE_THAN_LIMIT",{type:r});case 1000005:return Re("PARAMS_MORE_THAN_LIMIT",{type:r});case 1000006:return Re("IMAGE_MORE_THAN_LIMIT_PARAMS");case 1000007:return Re("FILE_MORE_THAN_LIMIT_PARAMS");case 1000019:return Re("END_MUST_AFTER_START");case 1000002:return Re("FILE_READ_ONLY");case 1000008:return Re("FILE_READ_ONLY1");case 1000010:return Re("DATA_NOT_EXIST",{documentName:t.documentName});case 1000009:return Re("REQUEST_PARAMS_TIME_ERROR");case 1000018:return Re("FILES_PATH_NOT_FOUND");case 1000011:return Re("FILES_DATA_NOT_FOUND");case 1000012:return Re("FILES_TYPE_ERROR");case 1000013:return Re("FILES_TYPE_MUST_BE_ONE",{type:r});case 1000014:return Re("SET_WATERMARK_FAIL");case 1000015:return Re("MYSQL_CRUD_ERROR",{type:r});case 1000016:return Re("PARAMS_JSON_FAILED",{type:r});case 3000001:return Re("MYSQL_ERROR");case 404:return Re("NOT_FOUND");case 2002:return Re("PRJ_NAME_EXISTS");case 3002:return Re("BACKUP_NAME_EXISTS");case 2003:return Re("TITLE_ILLEGAL_LEN",{documentName:t.documentName});case 2000001:return Re("LIB_NOT_EXIST");case 3001001:return Re("CONFIG_API_URLS_ERROR");case 3001002:return Re("ONE_CLICK_ORDER_NOT_OPEN");case 3001003:return Re("MATERIAL_NOT_OPEN");case 3001004:return Re("SNAPSHOT_DEPTH_LIMIT");case 3001005:return Re("OCR_SYMBOL_URL_ERROR");case 4000001:return Re("USER_DATA_NOT_FOUND");case 4000012:return Re("USER_DISABLE_ERROR");case 4000003:return Re("USER_EXISTS_LOGIN_ERROR");case 4000004:return Re("USER_UNAUTHORIZED_MODULES_ERROR");case 4000005:return Re("USER_UNAUTHORIZED_ACCESS_ERROR");case 4000006:return Re("ADMIN_NOT_CHANGE_PASSWORD");case 4000007:return Re("SAME_PASSWORD_NEW_PASSWORD");case 4000008:return Re("USER_ONLINE_REGISTRATION_FAILED");case 4000009:return Re("USER_PASSWORD_CAN_NOT_DEFAULT");case 4000010:return Re("USER_BEFORE_PASSWORD_ERROR");case 4000011:return Re("USER_PASSWORD_LENGTH_ERROR");case 5000001:return Re("ORG_ROLE_NOT_CREATE");case 5000002:return Re("ORG_ROLE_NAME_DUPLICATE");case 5000003:return Re("ORG_ROLE_ORIGIN_ERROR",{message:r});case 5000004:return Re("ORG_ROLE_NOT_DEFAULT");case 5000005:return Re("ADMIN_ROLE_NOT_CHANGE");case 5000006:return Re("ADMIN_NOT_CHANGE_STATUS");case 6000002:return Re("PROJECT_ARCHIVED");case 6000003:return Re("PROJECT_UUID_NULL");case 6000004:return Re("PROJECT_UUID_ERROR");case 6000005:return Re("PROJECT_OR_TEAM_UUID_ERROR");case 6000006:return Re("PROJECT_NOT_PERSON_ERROR");case 6000007:return Re("PROJECT_DUPLICATE_NAME");case 6000008:return Re("ANNOTATION_HAS_BE_FOUND");case 6000009:return Re("ANNOTATION_NOT_FOUND");case 6000010:return Re("ANNOTATION_CREATE_ERROR");case 6000011:return Re("ANNOTATION_UPDATE_ERROR");case 6000012:return Re("ANNOTATION_DELETE_ERROR");case 6000013:return Re("PROJECT_DUPLICATE_PATH");case 7000001:return Re("TEAM_NOT_FOUND");case 7000002:return Re("TEAM_UUID_NULL");case 7000003:return Re("TEAM_FOLDER_ERROR");case 7000004:return Re("TEAM_FOLDER_DEEP_ERROR");case 7000005:return Re("TEAM_FOLDER_UUID_ERROR");case 7000006:return Re("TEAM_URL_DUPLICATE");case 7000007:return Re("TEAM_CAN_NOT_DELETE");case 8000001:return Re("COMPONENT_UUID_NULL");case 8000002:return Re("COMPONENT_DATA_NOT_FOUND");case 8000003:return Re("COMPONENT_NAME_DUPLICATE");case 8000004:return Re("COMPONENT_TYPE_ERROR");case 8001001:return Re("DELETE_SON_CATEGORY");case 9000001:return Re("LICENSE");case 9000002:return Re("START_TIME");case 9000003:return Re("END_TIME");case 9000004:return Re("PROJECT_LIMIT");case 9000005:return Re("USER_LIMIT");case 9000006:return Re("ONLINE_NUMBER_LIMIT");case 9000007:return Re("COMPANY_CODE");case 9000008:return Re("LIMIT_PCB");case 9000009:return Re("LIMIT_SCH");case 9000011:return Re("LIMIT_PANEL");case 9000010:return Re("TIME_ERROR");case 9000012:return Re("LICENSE_ERROR");case 9000013:return Re("LICENSE_TYPE_ERROR");case 9000014:return Re("LICENSE_ORIGIN_ERROR",{type:r});case 11000001:return Re("BRANCH_DATA_NOT_FOUND");case 11000002:return Re("PARENT_UUID_ERROR");case 11000003:return Re("BRANCH_MUST_AFTER_NODE");case 11000004:return Re("BRANCH_NAME_ERROR");case 11000005:return Re("BRANCH_NAME_DUPLICATE");case 11000006:return Re("BRANCH_UUID_ERROR");case 11000007:return Re("BRANCH_NODE_SET_ERROR");case 11000008:return Re("BRANCH_DELETE_MAIN_ERROR");case 11000009:return Re("BRANCH_CHECK_OUT_ERROR");case 12000001:return Re("DOCUMENT_UUID_ERROR");case 12000002:return Re("UPDATE_FAILED");case 1000020:return Re("INNER_API_KEY_ERROR");case 11000010:return Re("BRANCH_MORE_THAN_LIMIT");case 1000021:return Re("WORKSPACE_API_ERROR");default:return""}}function Re(e,t){return DS()==="zh-cn"?w1.match("codeCN",e,t)||"":w1.match("codeEN",e,t)||""}function Wm(e){return e===422||e===1111111||e===6000002}var Si=(e=>(e.Text="text/plain;charset=UTF-8",e.Json="application/json",e.Form="application/x-www-form-urlencoded;charset=UTF-8",e.FormData="multipart/form-data",e))(Si||{}),_i=(e=>(e.ContentType="Content-type",e.Editorversion="Editor-Version",e))(_i||{}),H5=(e=>(e[e.Success=200]="Success",e[e.NotFound=404]="NotFound",e[e.NetError=500]="NetError",e))(H5||{}),Fc=(e=>(e.Json="json",e.Blob="blob",e))(Fc||{}),G5=0;function dt(e,t,s={},r={},i){return new Promise((n,a)=>{try{let c=G5++;var o;e=e||"GET",Y5(e,s,r);let l=V5(t,s,r,i);o=(l==null?void 0:l.params)||s,r=(l==null?void 0:l.options)||r;let u=z5(e,t,o,r);o=u.params,t=u.url;let h=new XMLHttpRequest;if(r.withCredentials!==void 0&&(h.withCredentials=r.withCredentials),r.responseType!==void 0&&(h.responseType=r.responseType),h.open(e,t,!0),W5(h,e,s,r),o=J5(h,e,t,o,r),h.onreadystatechange=function(){if(h.readyState===4&&h.status===200)try{if(r.responseType==="blob")n(h.response);else{let p=JSON.parse(h.responseText);p.success===!1&&(p.message=Dt(p)||p.message),n(p)}}catch(p){console.warn("catch ajax error...",p),n({success:!1,message:"Network Error!"})}else h.status===404?(console.warn("catch ajax error...",h.status),n({success:!1,code:h.status,message:"Network Error!"})):h.status===500&&(console.warn("catch ajax error...",h.status),n({success:!1,code:h.status,message:"Network Error!"}))},h.onerror=function(p){console.warn("catch ajax error...",p),n({success:!1,message:"Network Error!"})},o instanceof Uint8Array){let p=new Blob([o]);h.send(p)}else h.send(o)}catch(c){console.warn("catch ajax error...",c),n({success:!1,message:"Network Error!"})}})}function Y5(e,t,s={}){if(e.toLowerCase()!=="get"&&!(t instanceof FormData)&&typeof t!="string"&&(s==null?void 0:s.contentType)!==!1&&(s=s||{},s.headers=Object.assign(s.headers||{},{"Content-type":"application/json"})),s.headers){let r={};for(let i in s.headers){let n=s.headers[i];r[i]=n}s.headers=r}}function V5(e,t,s={},r){var i;if(!(t.path||(i=s==null?void 0:s.headers)!=null&&i.path)){if(e.includes("component")&&r)t.path=r;else if(r){let n=s.headers||{};n=Object.assign(n,{path:r}),s.headers=n}return{params:t,options:s}}}function h2(e,t=50){return typeof e!="string"?!1:e.length*2>t*1024*1024}function z5(e,t,s,r={}){var p;let i,n,a,o=[],c=r.headers,l=!1;if(s instanceof FormData)i=s;else if(typeof s=="string")i=s;else if((p=c==null?void 0:c["Content-type"])!=null&&p.includes("application/json")){if(typeof s=="object"&&s!==null){for(let d in s)if(h2(s[d])){l=!0;break}}if(l){let d=new FormData;for(let f in s){let m=s[f];h2(m)?d.append(f,new Blob([m],{type:"text/plain"})):d.append(f,typeof m=="object"?JSON.stringify(m):m)}i=d,r.headers&&(r.headers["Content-type"]="multipart/form-data")}else i=JSON.stringify(s)}else{for(n in s)if(a=s[n],a instanceof Array)for(let d=0;d<a.length;d++){let f=a[d];o.push(encodeURIComponent(`${n}[]`)+"="+encodeURIComponent(f))}else if(Object.prototype.toString.call(a)==="[object Object]")for(let d in a){let f=a[d];o.push(encodeURIComponent(`${n}[${d}]`)+"="+(f?encodeURIComponent(f):""))}else o.push(encodeURIComponent(n)+"="+encodeURIComponent(a));i=o.join("&"),e==="GET"&&i&&typeof i=="string"&&r.searchParams===!0&&(t=t+"?"+i,i={})}let u=/{[a-zA-Z]+}/gim,h=[...new Set(t.match(u))];for(let d of h){let f=d.substring(1,d.length-1);t=t.replace(d,s[f]||"")}return{params:i,url:t}}function W5(e,t,s,r={}){let i=r.headers;if(i){for(let n in i){let a=i[n];e.setRequestHeader(encodeURI(n),encodeURI(a))}r.contentType!==!1&&!i["Content-type"]&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8")}else r.contentType!==!1&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");if(e.setRequestHeader("Editor-Version",self.PRO_EDITOR_VERSION||""),self.document){let n=t.toUpperCase();if(n!=="GET"&&n!=="HEAD"){let a=/XSRF-TOKEN=(\S+);?/.exec(document.cookie);a&&e.setRequestHeader("X-XSRF-TOKEN",decodeURIComponent(a[1]))}}}var q5=1e4;function J5(e,t,s,r,i={}){return t.match(/post/i)&&s.startsWith("/")&&!s.startsWith("/servicecenter/")&&typeof r=="string"&&r.length>=q5&&(r=R5(new TextEncoder().encode(r),{level:1}),e.setRequestHeader("Content-Encoding","gzip")),r}async function p_(e,t,s,r){if(!r||!s){let a=`invalid parameters ${r}|${s}.`;return{code:nt.ERR_CODE.NORMAL,success:!1,msg:a,message:a,result:null}}let i=await dt("POST",t?`/api/v4/devices/${r}/delete`:`/api/v4/components/${r}/delete`,{},{headers:{"Content-type":"application/json","content-type":"application/json",path:s}});if(i.code===0&&i.success)return{code:0,success:!0,msg:"",message:"",result:{componentId:r}};let n=i.message||i.msg||"Request Error.";return{...i,msg:n,message:n,result:{componentId:r}}}async function K5(e,t,s){if(e){let u="operations not currently supported.";return{code:nt.ERR_CODE.NORMAL,success:!1,msg:u,message:u,result:null}}let r={code:0,success:!0,result:{devices:{succeed:[],failed:[]},symbols:{succeed:[],failed:[]},footprints:{succeed:[],failed:[]},d3models:{succeed:[],failed:[]},cbbs:{succeed:[],failed:[]},panels:{succeed:[],failed:[]}},msg:"",message:""},i=await zl(e,!0,t,s.devices||[]);r.result.devices={...i.result};let n=await zl(e,!1,t,s.symbols||[]);r.result.symbols={...n.result};let a=await zl(e,!1,t,s.footprints||[]);r.result.footprints={...a.result};let o=await zl(e,!1,t,s.d3models||[]);r.result.d3models={...o.result};let c=await zl(e,!1,t,s.cbbs||[]);r.result.cbbs={...c.result};let l=await zl(e,!1,t,s.panels||[]);return r.result.panels={...l.result},r}async function zl(e,t,s,r){let i=[],n=[];for(let a=0;a<r.length;a++){let o=await p_(e,t,s,r[a]);if(o.code===0&&o.success){i.push(r[a]);continue}i.push(r[a])}return{code:0,success:!0,result:{succeed:i,failed:n},msg:"",message:""}}function f_(e){if(!e)return[];if(e instanceof Array)return e;let t=[];return e!=null&&e.parent_tag&&(e!=null&&e.parent_tag.uuid)&&t.push(e==null?void 0:e.parent_tag.uuid),e!=null&&e.child_tag&&(e!=null&&e.child_tag.uuid)&&t.push(e==null?void 0:e.child_tag.uuid),t}function Uc(e){if(!e)return[];if(e instanceof Array)return e;let t=[];return e!=null&&e.parent_tag&&(e!=null&&e.parent_tag.name)&&t.push(e==null?void 0:e.parent_tag.name),e!=null&&e.child_tag&&(e!=null&&e.child_tag.name)&&t.push(e==null?void 0:e.child_tag.name),t}function pd(e,t=!1){return e?t?d2(e):e.indexOf("_")>=0?Z5(e):e.indexOf("@")>=0?X5(e):d2(e):{componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1}}function d2(e){let t={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/\|/i.test(e))return t.isLocaleFilenameMode=!1,t.componentTitleOrId=e,t;let s=e.split("|");return t.componentTitleOrId=s[0],t.path=s[1],/\./.test(s[0])?(t.isLocaleFilenameMode=!0,t):(t.isLocaleFilenameMode=!1,t)}function X5(e){let t={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/\@/i.test(e))return t.isLocaleFilenameMode=!1,t.componentTitleOrId=e,t;let s=e.split("@");return t.componentTitleOrId=s[0],t.path=s[1],/\./.test(s[0])?(t.isLocaleFilenameMode=!0,t):(t.isLocaleFilenameMode=!1,t)}function Z5(e){let t={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/_/i.test(e))return t.isLocaleFilenameMode=!1,t.componentTitleOrId=e,t;let s=e.split("_");return t.componentTitleOrId=s[0],t.path=s[1],/\./.test(s[0])?(t.isLocaleFilenameMode=!0,t):(t.isLocaleFilenameMode=!1,t)}async function yE(e,t){let s=pd(e,!0),r=s.path||t,i={code:nt.ERR_CODE.NORMAL,success:!0,result:null,msg:""};return i.result={createTime:0,created_at:"",creator:null,dataStr:JSON.stringify({model:`${s.componentTitleOrId}|${r}`,unit:"mm"}),display_title:s.componentTitleOrId||"-",uuid:`${s.componentTitleOrId}|${r}`||"",path:r,description:"",docType:16,modifier:null,owner:null,source:"",tags:{child_tag:[],parent_tag:[]},title:s.componentTitleOrId||"",updateTime:0,updated_at:"",version:"",public:void 0},i}var $5=class{constructor(){if(!crypto||!crypto.subtle)throw new Error("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301crypto api");this.tool=crypto.subtle}},Q5=class extends $5{constructor(){super(),this.keyBuffer=null,this.key=null,this.iv=null}async init(e){try{return this.keyBuffer=e.key,this.key=await this.setKey(this.keyBuffer),this.iv=await this.setIV(e.iv),this}catch{throw new Error(`invalid key or iv! ${e}`)}}setKey(e){if(e instanceof ArrayBuffer)return this.tool.importKey("raw",e,"AES-GCM",!0,["encrypt","decrypt"]);throw new Error(`invalid key! ${e}`)}setIV(e){if(e instanceof ArrayBuffer)return e;throw new Error(`invalid iv! ${e}`)}encrypt(e){return this.tool.encrypt({name:"AES-GCM",iv:this.iv},this.key,e)}decrypt(e){return this.tool.decrypt({name:"AES-GCM",iv:this.iv},this.key,e)}decrypt2(e){return this.tool.decrypt({name:"AES-GCM",iv:this.iv,tagLength:128},this.key,e)}getKey(){return this.keyBuffer}getIV(){return this.iv}};function p2(e){let t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map(function(s){return parseInt(s,16)})).buffer:null}function eB(e,t="utf-8"){var s=new TextDecoder(t);return s.decode(e)}async function kn(e){try{if(!e.dataStrId)return null;let t=new Headers;t.append("Content-Type","text/plain;charset=UTF-8");let s=await(await fetch(e.dataStrId,{method:"GET",redirect:"error",headers:t})).arrayBuffer();if(s){let r=await tB(e,s);return eB(r)}return null}catch(t){throw new Error("fetch\u5931\u8D25!!!"+t)}}async function tB(e,t){let s=new Q5;try{let{key:r,iv:i}=e;if(t&&i&&r){let n=p2(r),a=p2(i);await s.init({key:n,iv:a});let o=await s.decrypt(t);return L5(new Uint8Array(o))}else throw new Error(`\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!\u6570\u636E\u4E0D\u6B63\u786E:data:${t},key:${r},iv:${i}`)}catch(r){throw new Error("\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!"+r)}}async function fd(e,t=nt.SYSTEMLIB_UUID){if(!e)return null;let s=null,r=pd(e,!0);if(r.isLocaleFilenameMode)return s=(await yE(r.componentTitleOrId,r.path||nt.SYSTEMLIB_UUID)).result,s;let i=await dt("GET",`/api/v2/components/${r.componentTitleOrId}`,{},{headers:{"Content-type":"application/json","content-type":"application/json",path:r.path||nt.SYSTEMLIB_UUID}});if(i.code===0&&i.success&&typeof i.result=="object"&&(s=i.result),s&&!s.dataStr)try{let n=await kn(s);s.dataStr=n}catch(n){console.error(n)}return s}function Fo(e=new Date,t="yyyy-MM-dd HH:ii:ss"){if(Number.isNaN(e.getTime()))return"-";let s={"M+":e.getMonth()+1,"d+":e.getDate(),"H+":e.getHours(),"h+":e.getHours(),"i+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(let r in s)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length==1?s[r]:("00"+s[r]).substr((""+s[r]).length)));return t}function sB(e,t){function s(u){return u>=10?String(u):"0"+u}e instanceof Date?e.getTime().toString().length>13&&(e=new Date(e.getTime()/1e3)):Number.isNaN(Number(e))||e.toString().length>13&&(e=new Date(Number(e)/1e3));let r=new Date(e);if(Number.isNaN(r.getTime()))return"-";let i=r.getFullYear(),n=s(r.getMonth()+1),a=s(r.getDate()),o=s(r.getHours()),c=s(r.getMinutes()),l=s(r.getSeconds());return t==="downProject"?i+"-"+n+"-"+a:t==="migrateStandardProject"?i+"-"+n+"-"+a+"_"+o+"-"+c+"-"+l:t==="y-m-d"||t==="yyyy-MM-dd"?i+"-"+n+"-"+a:t==="y-m-d_h-m-s"?`${i}-${n}-${a}_${o}-${c}-${l}`:i+"-"+n+"-"+a+" "+o+":"+c+":"+l}function m_(e,t,s){let r=new Date().getTime(),i=Fo(new Date(r)),n={avatar:"",nickname:"",username:"",uuid:""},a=e+(s?`|${s}`:"");return{createTime:r,created_at:i,creator:{...n},dataStr:JSON.stringify({model:a,unit:"mm"}),description:"",display_title:t,docType:16,modifier:{...n},owner:{...n},path:s,public:!1,source:"",std_uuid:"",tags:{child_tag:[],parent_tag:[]},ticket:0,title:t,type:0,updateTime:r,updated_at:i,uuid:e,version:""}}async function rB(e){return e?new Promise((t,s)=>{window.fetch(`https://modules.lceda.cn/3dmodel/${e}`,{method:"GET"}).then(async r=>{let i=await r.blob();t({code:0,success:!0,result:i,message:""})}).catch(async r=>{t({code:r?r.code:-9,success:!1,result:null,message:"fetch 3D model file failed."})})}):{code:-1,success:!1,result:null,message:"missing uuid or path or detail data."}}var EE=class{},iB=(e=>(e.PROJECT_DOCUMENT_LOCKED="PROJECT_DOCUMENT_LOCKED",e.PROJECT_DOCUMENT_UPDATE_REJECT="PROJECT_DOCUMENT_UPDATE_REJECT",e.NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND="NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND",e.NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND="NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND",e.DEVICE_ATTRIBUTES_ERROR="DEVICE_ATTRIBUTES_ERROR",e.DEVICE_DESCRIPTION_ERROR="DEVICE_DESCRIPTION_ERROR",e.SYMBOL_DESCRIPTION_ERROR="SYMBOL_DESCRIPTION_ERROR",e.FOOTPRINT_DESCRIPTION_ERROR="FOOTPRINT_DESCRIPTION_ERROR",e.D3MODEL_DESCRIPTION_ERROR="D3MODEL_DESCRIPTION_ERROR",e.DEVICE_NAMA_ERROR="DEVICE_NAMA_ERROR",e.SYMBOL_NAMA_ERROR="SYMBOL_NAMA_ERROR",e.FOOTPRINT_NAMA_ERROR="FOOTPRINT_NAMA_ERROR",e.PANEL_LIB_NAMA_ERROR="PANEL_LIB_NAMA_ERROR",e.D3MODEL_NAMA_ERROR="D3MODEL_NAMA_ERROR",e.SIM_MODEL_NAMA_ERROR="SIM_MODEL_NAMA_ERROR",e.DEVICE_SAME_NAMA_EXISTS="DEVICE_SAME_NAMA_EXISTS",e.SYMBOL_SAME_NAMA_EXISTS="SYMBOL_SAME_NAMA_EXISTS",e.FOOTPRINT_SAME_NAMA_EXISTS="FOOTPRINT_SAME_NAMA_EXISTS",e.D3MODEL_SAME_NAMA_EXISTS="D3MODEL_SAME_NAMA_EXISTS",e.SIM_MODEL_SAME_NAMA_EXISTS="SIM_MODEL_SAME_NAMA_EXISTS",e.PANELLIB_SAME_NAMA_EXISTS="PANELLIB_SAME_NAMA_EXISTS",e.PARAMETER_VERIFICATION="PARAMETER_VERIFICATION",e.RESULT_VERIFICATION="RESULT_VERIFICATION",e.GET_DEVICE="GET_DEVICE",e.GET_DEVICE_NOT_FOUND="GET_DEVICE_NOT_FOUND",e.GET_DEVICE_LIST="GET_DEVICE_LIST",e.GET_DEVICE_SEARCH_LIST="GET_DEVICE_SEARCH_LIST",e.GET_SYMBOL="GET_SYMBOL",e.GET_SYMBOL_NOT_FOUND="GET_SYMBOL_NOT_FOUND",e.GET_SYMBOL_LIST="GET_SYMBOL_LIST",e.GET_SYMBOL_SEARCH_LIST="GET_SYMBOL_SEARCH_LIST",e.GET_FOOTPRINT="GET_FOOTPRINT",e.GET_FOOTPRINT_NOT_FOUND="GET_FOOTPRINT_NOT_FOUND",e.GET_FOOTPRINT_LIST="GET_FOOTPRINT_LIST",e.GET_FOOTPRINT_SEARCH_LIST="GET_FOOTPRINT_SEARCH_LIST",e.GET_PANEL_LIB_SEARCH_LIST="GET_PANEL_LIB_SEARCH_LIST",e.GET_D3MODEL="GET_D3MODEL",e.GET_D3MODEL_NOT_FOUND="GET_D3MODEL_NOT_FOUND",e.GET_D3MODEL_LIST="GET_D3MODEL_LIST",e.GET_D3MODEL_SEARCH_LIST="GET_D3MODEL_SEARCH_LIST",e.GET_SIM_MODEL="GET_SIM_MODEL",e.GET_SIM_NOT_FOUND="GET_SIM_NOT_FOUND",e.GET_SIM_MODEL_LIST="GET_SIM_MODEL_LIST",e.GET_SIM_MODEL_SEARCH_LIST="GET_SIM_MODEL_SEARCH_LIST",e.CROSS_BIND="CROSS_BIND",e.CROSS_BIND_EXIT="CROSS_BIND_EXIT",e.IMPORT_EXIST_PROJECT="IMPORT_EXIST_PROJECT",e.CREATE_PROJECT="CREATE_PROJECT",e.CREATE_DEVICE="CREATE_DEVICE",e.CREATE_DEVICE_DUP_TITLE="CREATE_DEVICE_DUP_TITLE",e.CREATE_DEVICE_PERMISSIONS="CREATE_DEVICE_PERMISSIONS",e.CREATE_SYMBOL="CREATE_SYMBOL",e.CREATE_SYMBOL_DUP_TITLE="CREATE_SYMBOL_DUP_TITLE",e.CREATE_SYMBOL_PERMISSIONS="CREATE_SYMBOL_PERMISSIONS",e.CREATE_SYMBOL_MIGRATE_CANVAS_ERROR="CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",e.CREATE_FOOTPRINT="CREATE_FOOTPRINT",e.CREATE_FOOTPRINT_DUP_TITLE="CREATE_FOOTPRINT_DUP_TITLE",e.CREATE_FOOTPRINT_PERMISSIONS="CREATE_FOOTPRINT_PERMISSIONS",e.CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR="CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",e.CREATE_D3MODEL="CREATE_D3MODEL",e.CREATE_D3MODEL_DUP_TITLE="CREATE_D3MODEL_DUP_TITLE",e.CREATE_D3MODEL_PERMISSIONS="CREATE_D3MODEL_PERMISSIONS",e.CREATE_PANEL_LIB="CREATE_PANEL_LIB",e.CREATE_PANEL_DUP_TITLE="CREATE_PANEL_DUP_TITLE",e.CREATE_PANEL_PERMISSIONS="CREATE_PANEL_PERMISSIONS",e.CREATE_SIM_MODEL="CREATE_SIM_MODEL",e.CREATE_SIM_MODEL_DUP_TITLE="CREATE_SIM_MODEL_DUP_TITLE",e.CREATE_SIM_MODEL_PERMISSIONS="CREATE_SIM_MODEL_PERMISSIONS",e.CREATE_SIM_MODEL_MIGRATE_CANVAS_ERROR="CREATE_SIM_MODEL_MIGRATE_CANVAS_ERROR",e.UPDATE_DEVICE="UPDATE_DEVICE",e.UPDATE_DEVICE_ATTRIBUTES="UPDATE_DEVICE_ATTRIBUTES",e.UPDATE_DEVICE_PERMISSIONS="CREATE_DEVICE_PERMISSIONS",e.UPDATE_SYMBOL="UPDATE_SYMBOL",e.UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR="UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR",e.UPDATE_SYMBOL_PERMISSIONS="UPDATE_SYMBOL_PERMISSIONS",e.UPDATE_FOOTPRINT="UPDATE_FOOTPRINT",e.UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR="UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",e.UPDATE_FOOTPRINT_PERMISSIONS="UPDATE_FOOTPRINT_PERMISSIONS",e.UPDATE_D3MODEL_PERMISSIONS="UPDATE_D3MODEL_PERMISSIONS",e.UPDATE_SIM_MODEL="UPDATE_SIM_MODEL",e.UPDATE_SIM_MODEL_MIGRATE_CANVAS_ERROR="UPDATE_SIM_MODEL_MIGRATE_CANVAS_ERROR",e.UPDATE_SIM_MODEL_PERMISSIONS="UPDATE_SIM_MODEL_PERMISSIONS",e.DELETE_DEVICE="DELETE_DEVICE",e.DELETE_SYMBOL="DELETE_SYMBOL",e.DELETE_FOOTPRINT="DELETE_FOOTPRINT",e.DELETE_SIM_MODEL="DELETE_SIM_MODEL",e.DELETE_3DMODEL="DELETE_3DMODEL",e.GET_SOURCE="GET_SOURCE",e))(iB||{}),Ce=class{constructor(e,t=""){this._message=t,this._action=e}get message(){return this._message}set message(e){this._message=e}get action(){return this._action}set action(e){this._action=e}toJSON(){return{message:this.message,action:this.action}}};function ds(e){if(!e){let t="missing creator data.";throw new Ce("RESULT_VERIFICATION",t)}return{uuid:e.uuid,nickname:e.nickname,username:e.username}}function ps(e){if(!e){let t="missing modifier data.";throw new Ce("RESULT_VERIFICATION",t)}return{uuid:e.uuid,nickname:e.nickname,username:e.username}}function fs(e){if(!e){let t="missing owner data.";throw new Ce("RESULT_VERIFICATION",t)}return{uuid:e.uuid,nickname:e.nickname,username:e.username}}function wi(e,t){let s=Object.keys(t);for(let r=0;r<s.length;r++)L8.indexOf(s[r])<=-1||(s[r]==="title"&&"display_title"in e&&t.title&&(e.display_title=String(t.title),e.title=String(t.title).toLocaleLowerCase()),e[s[r]]=t[s[r]])}function qm(e,t){return e[t]}function g_(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ce("DEVICE_NAMA_ERROR",t)}}function y_(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ce("SYMBOL_NAMA_ERROR",t)}}function E_(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ce("FOOTPRINT_NAMA_ERROR",t)}}function nB(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ce("D3MODEL_NAMA_ERROR",t)}}function b_(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ce("SIM_MODEL_NAMA_ERROR",t)}}async function ou(e,t){let s=[],r=[],i=async o=>{let{message:c}=await Je.messageBus.rpcCall(Me.TAG.CREATE,o);return c},n=null;try{for(let o=0;o<e.length;o++){let c=await i({...e[o],path:e[o].user_uuid});if(c.code===0&&c.success){let u={...c,message:"",result:{...e[o],path:e[o].user_uuid,...c.result[0]}};s.push(u),t&&t(u,o);continue}let l={...c,result:{...e[o]}};r.push(l)}return{code:0,success:!0,result:{successList:s,failList:r},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Add Categories Batch Error";return{code:n?n.code:nt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}function li(e=[],t,s){if(!e||!e.length||!t)return{index:-1,data:null};let r={index:-1,data:null};for(let i=0;i<e.length;i++)if(typeof e[i]=="object"&&e[i][t]===s){r.data=e[i],r.index=i;break}return r}function aB(e=[],t,s){if(!e||!e.length||!t)return{indexs:[],datas:[]};let r={indexs:[],datas:[]};for(let i=0;i<e.length;i++)typeof e[i]=="object"&&e[i][t]===s&&(r.datas.push(e[i]),r.indexs.push(i));return r}function Rh(e=0,t=Number.MAX_SAFE_INTEGER){return Math.floor(Math.random()*(t-e+1))+e}function ed(e=36){let t=[],s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t[r]=s.substr(Math.floor(Math.random()*16),1);return t[14]&&(t[14]=String(Rh(1,9))),t[19]&&(t[19]=s.substr(+t[19]&3|8,1)),t[8]&&(t[8]=String(Rh(1,9))),t[13]&&(t[13]=String(Rh(1,9))),t[18]&&(t[18]=String(Rh(1,9))),t[23]&&(t[23]=String(Rh(1,9))),t.join("")}function f2(e,t=!0){return(s,r)=>{let i=s[e],n=r[e];return typeof i<"u"&&typeof n<"u"?t?i-n:n-i:0}}var oB=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree,this.getFile=e.getDetail}async getTransformedList(e){let t=await this.getList(e),{count:s,page:r,pageSize:i,lists:n,totalPage:a}=t;return{count:s,page:r,pageSize:i,totalPage:a,lists:n.map(o=>this.extendLib.transformer.transformCbbListItem(o))}}async getTransformedDetail(e){return await this.getDetail(e)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(s=>this.extendLib.transformer.transformCategory(s)))!=null?t:[]}},cB=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getSupportedSymbolTypes=e.getSupportedSymbolTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree}async getTransformedList(e){let t=await this.getList(e),{count:s,page:r,pageSize:i,lists:n,totalPage:a}=t;return{count:s,page:r,pageSize:i,totalPage:a,lists:n.map(o=>this.extendLib.transformer.transformDeviceListItem(o))}}async getTransformedDetail(e){let t=await this.getDetail(e);return this.extendLib.transformer.transformDeviceListItem(t)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(s=>this.extendLib.transformer.transformCategory(s)))!=null?t:[]}},lB=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree}async getTransformedList(e){let t=await this.getList(e),{count:s,page:r,pageSize:i,lists:n=[],totalPage:a}=t,o=[];for(let c of n)o.push(await this.extendLib.transformer.transformFootprintListItem(c));return{count:s,page:r,pageSize:i,totalPage:a,lists:o}}async getTransformedDetail(e){let t=await this.getDetail(e);return await this.extendLib.transformer.transformFootprintListItem(t)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(s=>this.extendLib.transformer.transformCategory(s)))!=null?t:[]}},uB=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getSupportedSymbolTypes=e.getSupportedSymbolTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree}async getTransformedList(e){let t=await this.getList(e),{count:s,page:r,pageSize:i,lists:n,totalPage:a}=t,o=[];for(let c of n)o.push(await this.extendLib.transformer.transformSymbolListItem(c));return{count:s,page:r,pageSize:i,totalPage:a,lists:o}}async getTransformedDetail(e){let t=await this.getDetail(e);return await this.extendLib.transformer.transformSymbolListItem(t)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(s=>this.extendLib.transformer.transformCategory(s)))!=null?t:[]}},hB=class{constructor(e){this.extendLib=e}transformTime(e=Date.now()){return e.toString().length>13?e/1e3:e}transformTimeStr(e=Date.now()){let t=this.transformTime(e);return Fo(new Date(t*1e3))}transformTags(e){let{primaryClassificationName:t,primaryClassificationUuid:s,secondaryClassificationName:r,secondaryClassificationUuid:i}=e||{};return{parent_tag:t?{uuid:s,name:t}:void 0,child_tag:r?{uuid:i,name:r}:void 0}}transformCategory(e,t){var r,i;let s=(r=e.uuid)!=null?r:crypto.randomUUID();return{id:s,title:e.name,children:(i=e.children)==null?void 0:i.map(n=>this.transformCategory(n,s)),parentId:t}}transformDeviceListItem(e){var t,s,r,i,n,a,o,c;return{title:e.name||"",description:e.description||"",images:[],uuid:e.uuid||this.extendLib.getDefaultItemId(),path:this.extendLib.id,source:"",version:"",ticket:0,updateTime:this.transformTime(e.updateTime),createTime:this.transformTime(e.createTime||e.updateTime),display_title:e.name||"",creator:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},attributes:{...(t=e.attributes)!=null?t:{},Footprint:((s=e.footprint)==null?void 0:s.uuid)||"",Symbol:((r=e.symbol)==null?void 0:r.uuid)||"",value:e.value||((i=e.attributes)==null?void 0:i.value)||"",supplierPart:e.supplierPart||((n=e.attributes)==null?void 0:n.supplierPart)||"",manufacturer:e.manufacturer||((a=e.attributes)==null?void 0:a.manufacturer)||"",description:e.description||((o=e.attributes)==null?void 0:o.description)||""},symbol:e.symbol?{display_title:e.symbol.name||""}:void 0,footprint:e.footprint?{display_title:e.footprint.name||""}:void 0,tags:this.transformTags(e.classification),symbol_type:(c=e.symbol)==null?void 0:c.symbolType}}async transformSymbolListItem(e){var t,s,r,i,n,a,o,c,l,u;return{docType:e.symbolType,uuid:e.uuid||this.extendLib.getDefaultItemId(),title:e.name||"",description:e.description||"",path:this.extendLib.id,source:"",version:(t=e.version)!=null?t:"",ticket:0,updateTime:this.transformTime(e.updateTime),createTime:this.transformTime(e.createTime||e.updateTime),display_title:e.name||"",creator:e.creator?{nickname:(s=e.creator.name)!=null?s:"",username:(r=e.creator.name)!=null?r:"",uuid:(i=e.creator.uuid)!=null?i:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:e.modifier?{nickname:(n=e.modifier.name)!=null?n:"",username:(a=e.modifier.name)!=null?a:"",uuid:(o=e.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:e.owner?{nickname:(c=e.owner.name)!=null?c:"",username:(l=e.owner.name)!=null?l:"",uuid:(u=e.owner.uuid)!=null?u:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},dataStr:e.data instanceof Blob?await e.data.text():e.data,tags:this.transformTags(e.classification)}}async transformFootprintListItem(e){var t,s,r,i,n,a,o,c,l,u;return{docType:4,uuid:e.uuid||this.extendLib.getDefaultItemId(),title:e.name||"",description:e.description||"",path:this.extendLib.id,source:"",version:(t=e.version)!=null?t:"",ticket:0,updateTime:this.transformTime(e.updateTime),createTime:this.transformTime(e.createTime||e.updateTime),display_title:e.name||"",creator:e.creator?{nickname:(s=e.creator.name)!=null?s:"",username:(r=e.creator.name)!=null?r:"",uuid:(i=e.creator.uuid)!=null?i:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:e.modifier?{nickname:(n=e.modifier.name)!=null?n:"",username:(a=e.modifier.name)!=null?a:"",uuid:(o=e.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:e.owner?{nickname:(c=e.owner.name)!=null?c:"",username:(l=e.owner.name)!=null?l:"",uuid:(u=e.owner.uuid)!=null?u:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},dataStr:e.data instanceof Blob?await e.data.text():e.data,tags:this.transformTags(e.classification)}}transformCbbListItem(e){var t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C,x,D,I,P,L,F,V,B,k,O,R,v,j;return{cbb_project:!0,content:(t=e.description)!=null?t:"",creator:e.creator?{avatar:"",nickname:(s=e.creator.name)!=null?s:"",username:(r=e.creator.name)!=null?r:"",uuid:(i=e.creator.uuid)!=null?i:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:e.modifier?{nickname:(n=e.modifier.name)!=null?n:"",username:(a=e.modifier.name)!=null?a:"",uuid:(o=e.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:e.owner?{avatar:"",team:!1,nickname:(c=e.owner.name)!=null?c:"",username:(l=e.owner.name)!=null?l:"",uuid:(u=e.owner.uuid)!=null?u:""}:{avatar:"",team:!1,nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},name:e.name,path:this.extendLib.id,block_symbol:(p=(h=e.blockSymbols)==null?void 0:h.map(M=>{var H;return{uuid:M.uuid,display_title:M.name,docType:17,project_uuid:(H=e.uuid)!=null?H:e.name,title:M.name.toLocaleLowerCase()}}))!=null?p:[],schematics:(f=(d=e.schematics)==null?void 0:d.map(M=>{var q,Q;let H=(Q=(q=e.sheets)==null?void 0:q.filter(oe=>oe.belongSchematicUuid===M.uuid).map(oe=>({uuid:oe.uuid,ticket:0})))!=null?Q:[];return{create_at:this.transformTimeStr(M.createTime||M.updateTime),createtime:this.transformTime(M.createTime||M.updateTime),display_name:M.name,name:M.name.toLocaleLowerCase(),project_uuid:e.uuid,sheet_count:H.length,sort:H,ticket:0,update_at:this.transformTimeStr(M.updateTime),uuid:M.uuid,updateTime:this.transformTime(M.updateTime)}}))!=null?f:[],pcb:(g=(m=e.pcbs)==null?void 0:m.map(M=>{var H,q,Q,oe,me,Ee,Pe,Oe,Fe,G,pe;return{description:(H=M.description)!=null?H:"",display_title:M.name,docType:3,project_uuid:(q=e.uuid)!=null?q:"",thumb:M.thumb,title:M.name.toLocaleLowerCase(),updateTime:this.transformTime(M.updateTime),uuid:M.uuid,creator:M.creator?{avatar:"",nickname:(oe=(Q=M.creator)==null?void 0:Q.name)!=null?oe:"",username:(Ee=(me=M.creator)==null?void 0:me.name)!=null?Ee:"",uuid:(Oe=(Pe=M.creator)==null?void 0:Pe.uuid)!=null?Oe:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:M.modifier?{nickname:(Fe=M==null?void 0:M.modifier.name)!=null?Fe:"",username:(G=M==null?void 0:M.modifier.name)!=null?G:"",uuid:(pe=M==null?void 0:M.modifier.uuid)!=null?pe:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id}}}))!=null?g:[],schs:(E=(b=e.sheets)==null?void 0:b.map(M=>{var H,q,Q,oe,me,Ee,Pe,Oe;return{description:(H=M.description)!=null?H:"",display_title:M.name,docType:1,project_uuid:(q=e.uuid)!=null?q:"",schematic_uuid:M.belongSchematicUuid,thumb:M.thumb,title:M.name.toLocaleLowerCase(),updateTime:this.transformTime(M.updateTime),uuid:M.uuid,creator:M.creator?{avatar:"",nickname:(Q=M==null?void 0:M.creator.name)!=null?Q:"",username:(oe=M==null?void 0:M.creator.name)!=null?oe:"",uuid:(me=M==null?void 0:M.creator.uuid)!=null?me:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:M!=null&&M.modifier?{nickname:(Ee=M==null?void 0:M.modifier.name)!=null?Ee:"",username:(Pe=M==null?void 0:M.modifier.name)!=null?Pe:"",uuid:(Oe=M==null?void 0:M.modifier.uuid)!=null?Oe:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id}}}))!=null?E:[],tags:{parent_tag:{name:(T=(y=e.classification)==null?void 0:y.primaryClassificationName)!=null?T:"",name_cn:(S=(w=e.classification)==null?void 0:w.primaryClassificationName)!=null?S:"",title:(C=(_=e.classification)==null?void 0:_.primaryClassificationName)!=null?C:"",uuid:(D=(x=e.classification)==null?void 0:x.primaryClassificationUuid)!=null?D:""},child_tag:{name:(P=(I=e.classification)==null?void 0:I.secondaryClassificationName)!=null?P:"",name_cn:(F=(L=e.classification)==null?void 0:L.secondaryClassificationName)!=null?F:"",title:(B=(V=e.classification)==null?void 0:V.secondaryClassificationName)!=null?B:"",uuid:(O=(k=e.classification)==null?void 0:k.secondaryClassificationUuid)!=null?O:""}},updated_at:this.transformTimeStr(e.updateTime),uuid:(R=e.uuid)!=null?R:e.name,boards:(j=(v=e.boards)==null?void 0:v.map(M=>({name:M.name,pcb:M.pcbUuid,sch:M.schUuid})))!=null?j:[]}}},dB=class T_{constructor(t){this.transformer=new hB(this),this.id=t.id,this.isVisible=s=>t.isVisible?t.isVisible(s)&&this.isInTab(s.tabName):this.isInTab(s.tabName),this.title=t.title,this.position=t.position,t.device&&(this.device=new cB(t.device,this)),t.symbol&&(this.symbol=new uB(t.symbol,this)),t.footprint&&(this.footprint=new lB(t.footprint,this)),t.cbb&&(this.cbb=new oB(t.cbb,this))}static async set(t){var r,i,n,a,o,c,l,u;let s=new T_(t);return s._deviceSupportedSymbolTypes=await((i=(r=t.device)==null?void 0:r.getSupportedSymbolTypes)==null?void 0:i.call(r)),s._symbolSupportedSymbolTypes=await((a=(n=t.symbol)==null?void 0:n.getSupportedSymbolTypes)==null?void 0:a.call(n)),s._deviceSupportedPreviewTypes=await((c=(o=t.device)==null?void 0:o.getSupportedPriviewTypes)==null?void 0:c.call(o)),s._footprintSupportedPreviewTypes=await((u=(l=t.footprint)==null?void 0:l.getSupportedPriviewTypes)==null?void 0:u.call(l)),s}getDefaultItemId(){return crypto.randomUUID().replace("-","")}getLibraryFunctionsClassInTab(t){switch(t){case"cbb":return this==null?void 0:this.cbb;case"device":return this==null?void 0:this.device;case"symbol":return this==null?void 0:this.symbol;case"footprint":return this==null?void 0:this.footprint;default:return null}}isInTab(t){return!!this.getLibraryFunctionsClassInTab(t)}isHasCategoryTreeInTab(t){var s;return!!((s=this.getLibraryFunctionsClassInTab(t))!=null&&s.getClassificationTree)}async getAmountByWd(t,s){var r,i,n;return(n=(i=await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getList({page:1,pageSize:1,query:{wd:s}})))==null?void 0:i.count)!=null?n:0}getTabByCategoryType(t){switch(t){case 1:return"cbb";case 3:return"device";case 2:return"symbol";case 4:return"footprint";default:return null}}async getClassificationTreeInTab(t){var s;return this.isHasCategoryTreeInTab(t)?await((s=this.getLibraryFunctionsClassInTab(t))==null?void 0:s.getClassificationTree()):null}async getCategoryTreeDataItemsInTab(t){var s;return(s=await this.getClassificationTreeInTab(t))==null?void 0:s.map(r=>this.transformer.transformCategory(r))}async getClassificationTreeByCategoryType(t){let s=this.getTabByCategoryType(t);return s&&this.getClassificationTreeInTab(s)}async getCategoryTreeDataItemsByCategoryType(t){let s=this.getTabByCategoryType(t);return s&&this.getCategoryTreeDataItemsInTab(s)}getSelectTypeListInTab(t){let s=[];if(t==="device"){let r=this._deviceSupportedSymbolTypes;s=r?r2.filter(i=>r.includes(Number(i.value))||!i.value):r2}else if(t==="symbol"){let r=this._symbolSupportedSymbolTypes;s=r?i2.filter(i=>r.includes(Number(i.value))||!i.value):i2}return s.length>2?s:[]}getPreviewTypesInTab(t){let s=h5[t];return t==="device"&&this._deviceSupportedPreviewTypes?s=s.filter(r=>{var i;return(i=this._deviceSupportedPreviewTypes)==null?void 0:i.includes(r)}):t==="footprint"&&this._footprintSupportedPreviewTypes&&(s=s.filter(r=>{var i;return(i=this._footprintSupportedPreviewTypes)==null?void 0:i.includes(r)})),s}async getListInTab(t,s){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getList(s))}async getTransformedListInTab(t,s){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getTransformedList(s))}async getDetailInTab(t,s){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getDetail(s))}async getTransformedDetailInTab(t,s){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getTransformedDetail(s))}},pB=class{constructor(e=10){this._runingCount=0,this._handleCount=0,this._queue=[],this._results=[],this._windowSize=e,this._finishCallback=null,this._taskStartCallback=null,this._taskEndCallback=null}pushTask(e){this._queue.push(e)}setFinishCallback(e){this._finishCallback=e}setTaskStartCallback(e){this._taskStartCallback=e}setTaskEndCallback(e){this._taskEndCallback=e}next(){for(;this._runingCount<this._windowSize&&this._queue.length>0;){this._runingCount+=1,this._handleCount+=1;let e=this._handleCount-1,t=this._queue.shift();this._taskStartCallback&&this._taskStartCallback(e),t(e).then(s=>{this._results.push(s)}).catch(s=>{this._results.push(s)}).finally(()=>{this._runingCount-=1,this._taskEndCallback&&this._taskEndCallback(this._results[this._results.length-1]),this.next()})}this._runingCount<=0&&this._finishCallback&&this._finishCallback(this._results)}},bE=class{onString(e,t,s){}onAttr(e,t,s){}onGroup(e,t,s,r,i){}onDelGroup(e,t,s,r){}onDelString(e,t,s,r){}onDelAttr(e,t,s,r){}onPanelizeSide(e,t,s,r){}onDelPanelizeSide(e,t,s,r){}onPanelizeStamp(e,t,s,r){}onDelPanelizeStamp(e,t,s,r){}onPanelize(e,t,s,r){}onDelPanelize(e,t,s){}onRuleSelector(e,t,s,r){}onDelRuleSelector(e,t,s,r){}onRule(e,t,s,r){}onDelRule(e,t,s,r,i){}onRuleTemplate(e,t,s,r){}onDimension(e,t,s,r,i,n){}onDelDimension(e,t,s,r){}onBoss(e,t,s,r,i,n){}onDelBoss(e,t,s,r){}onShellEntity(e,t,s,r,i,n){}onDelShellEntity(e,t,s,r){}onShellCut(e,t,s,r,i,n){}onDelShellCut(e,t,s,r){}onCrease(e,t,s,r,i,n){}onDelCrease(e,t,s,r){}onShell(e,t,s,r,i,n){}onDelShell(e,t,s,r){}onFpcFill(e,t,s,r,i,n){}onDelFpcFill(e,t,s,r){}onTeardrop(e,t,s,r,i,n){}onDelTeardrop(e,t,s,r){}onImage(e,t,s,r,i,n){}onDelImage(e,t,s,r){}onPoured(e,t,s,r,i,n){}onDelPoured(e,t,s,r){}onPour(e,t,s,r,i,n){}onDelPour(e,t,s,r){}onRegion(e,t,s,r,i,n){}onDelRegion(e,t,s,r){}onFill(e,t,s,r,i,n){}onDelFill(e,t,s,r){}onPoly(e,t,s,r,i,n){}onDelPoly(e,t,s,r){}onEQLenGrp(e,t,s,r,i){}onDelEQLenGrp(e,t,s,r){}onDelProp(e,t,s,r){}onObj(e,t,s,r,i,n){}onDelObj(e,t,s,r){}onArc(e,t,s,r,i,n){}onDelArc(e,t,s,r){}onCArc(e,t,s,r,i,n){}onDelCArc(e,t,s,r){}onLine(e,t,s,r,i,n){}onDelLine(e,t,s,r){}onPad(e,t,s,r,i,n){}onDelPad(e,t,s,r){}onVia(e,t,s,r,i,n){}onDelVia(e,t,s,r){}onDelConnect(e,t,s,r){}onPreference(e,t,s,r){}onSilkOpts(e,t,s,r,i){}onDelSilkOpts(e,t,s,r){}onPrimitive(e,t,s,r,i){}onDelPrimitive(e,t,s,r){}onNet(e,t,s,r,i){}onDelNet(e,t,s,r){}onPartition(e,t,s,r,i,n){}onDelPartition(e,t,s,r){}onActiveLayer(e,t,s,r){}onLayerPhys(e,t,s,r,i){}onDelLayerPhys(e,t,s,r){}onLayer(e,t,s,r,i){}onDelLayer(e,t,s,r){}onCanvas(e,t,s,r){}onDocDetail(e,t,s,r){}onStringNum(e,t){}onAttrNum(e,t){}onDimensionNum(e,t){}onBossNum(e,t){}onShellEntityNum(e,t){}onShellCutNum(e,t){}onCreaseNum(e,t){}onShellNum(e,t){}onFpcFillNum(e,t){}onTeardropNum(e,t){}onImageNum(e,t){}onPouredNum(e,t){}onPourNum(e,t){}onRegionNum(e,t){}onFillNum(e,t){}onPolyNum(e,t){}onObjNum(e,t){}onArcNum(e,t){}onCArcNum(e,t){}onLineNum(e,t){}onPadNum(e,t){}onViaNum(e,t){}onPartitionNum(e,t){}},fB=class extends bE{constructor(e){super(),this.source={},this._action=e}get action(){return this._action}getSource(){return this.source}onString(e,t,s){this.source[e]=t}onAttr(e,t,s){s||(this.action&&this.action(e,t),this.source[e]=t)}onDimension(e,t,s,r,i,n){this.source[e]=i}onBoss(e,t,s,r,i,n){this.source[e]=i}onShellEntity(e,t,s,r,i,n){this.source[e]=i}onShellCut(e,t,s,r,i,n){this.source[e]=i}onCrease(e,t,s,r,i,n){this.source[e]=i}onShell(e,t,s,r,i,n){this.source[e]=i}onFpcFill(e,t,s,r,i,n){this.source[e]=i}onTeardrop(e,t,s,r,i,n){this.source[e]=i}onImage(e,t,s,r,i,n){this.source[e]=i}onPoured(e,t,s,r,i,n){this.source[e]=i}onPour(e,t,s,r,i,n){this.source[e]=i}onRegion(e,t,s,r,i,n){this.source[e]=i}onFill(e,t,s,r,i,n){this.source[e]=i}onPoly(e,t,s,r,i,n){this.source[e]=i}onObj(e,t,s,r,i,n){this.source[e]=i}onArc(e,t,s,r,i,n){this.source[e]=i}onCArc(e,t,s,r,i,n){this.source[e]=i}onLine(e,t,s,r,i,n){this.source[e]=i}onPad(e,t,s,r,i,n){this.source[e]=i}onVia(e,t,s,r,i,n){this.source[e]=i}},w_=class extends oS{onBoard(e,t,s,r){}onDelBoard(e,t,s){}constructor(e,t,s){super(e,t,s,new cE(!1)),this._compilerHandler=null}async init(e=!1,t=!1,s=!1,r=!1){return super.init(e,t,s,r)}onBlob(e,t,s,r,i){}onDelBlob(e,t,s,r){}onFont(e,t,s,r){}onDelFont(e,t,s,r){}canvasSelected(){return""}onSelectChange(e,t,s){}onSelectQuit(e,t){}onLayerFill(e,t,s,r,i){}onDelLayerFill(e,t,s,r){}setHandler(e){this._compilerHandler=e}onGroup(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onGroup(e,t,s,r,i)}onDelGroup(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelGroup(e,t,s,r)}onString(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onString(e,i,n)}onDelString(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelString(e,t,s,r)}onAttr(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onAttr(e,i,n)}onDelAttr(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelAttr(e,t,s,r)}onPanelizeSide(e,t,s,r){this._compilerHandler&&this._compilerHandler.onPanelizeSide(e,t,s,r)}onDelPanelizeSide(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPanelizeSide(e,t,s,r)}onPanelizeStamp(e,t,s,r){this._compilerHandler&&this._compilerHandler.onPanelizeStamp(e,t,s,r)}onDelPanelizeStamp(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPanelizeStamp(e,t,s,r)}onPanelize(e,t,s,r){this._compilerHandler&&this._compilerHandler.onPanelize(e,t,s,r)}onDelPanelize(e,t,s){this._compilerHandler&&this._compilerHandler.onDelPanelize(e,t,s)}onRuleSelector(e,t,s,r){this._compilerHandler&&this._compilerHandler.onRuleSelector(e,t,s,r)}onDelRuleSelector(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelRuleSelector(e,t,s,r)}onRule(e,t,s,r){this._compilerHandler&&this._compilerHandler.onRule(e,t,s,r)}onDelRule(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onDelRule(e,t,s,r,i)}onRuleTemplate(e,t,s,r){this._compilerHandler&&this._compilerHandler.onRuleTemplate(e,t,s,r)}onDimension(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onDimension(e,t,s,r,i,n)}onDelDimension(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelDimension(e,t,s,r)}onBoss(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onBoss(e,t,s,r,i,n)}onDelBoss(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelBoss(e,t,s,r)}onShellEntity(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onShellEntity(e,t,s,r,i,n)}onDelShellEntity(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelShellEntity(e,t,s,r)}onShellCut(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onShellCut(e,t,s,r,i,n)}onDelShellCut(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelShellCut(e,t,s,r)}onCrease(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onCrease(e,t,s,r,i,n)}onDelCrease(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelCrease(e,t,s,r)}onShell(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onShell(e,t,s,r,i,n)}onDelShell(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelShell(e,t,s,r)}onFpcFill(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onFpcFill(e,t,s,r,i,n)}onDelFpcFill(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelFpcFill(e,t,s,r)}onTeardrop(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onTeardrop(e,t,s,r,i,n)}onDelTeardrop(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelTeardrop(e,t,s,r)}onImage(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onImage(e,t,s,r,i,n)}onDelImage(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelImage(e,t,s,r)}onPoured(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onPoured(e,t,s,r,i,n)}onDelPoured(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPoured(e,t,s,r)}onPour(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onPour(e,t,s,r,i,n)}onDelPour(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPour(e,t,s,r)}onRegion(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onRegion(e,t,s,r,i,n)}onDelRegion(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelRegion(e,t,s,r)}onFill(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onFill(e,t,s,r,i,n)}onDelFill(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelFill(e,t,s,r)}onPoly(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onPoly(e,t,s,r,i,n)}onDelPoly(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPoly(e,t,s,r)}onEQLenGrp(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onEQLenGrp(e,t,s,r,i)}onDelEQLenGrp(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelEQLenGrp(e,t,s,r)}onDelProp(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelProp(e,t,s,r)}onObj(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onObj(e,t,s,r,i,n)}onDelObj(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelObj(e,t,s,r)}onArc(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onArc(e,t,s,r,i,n)}onDelArc(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelArc(e,t,s,r)}onCArc(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onCArc(e,t,s,r,i,n)}onDelCArc(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelCArc(e,t,s,r)}onLine(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onLine(e,t,s,r,i,n)}onDelLine(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelLine(e,t,s,r)}onPad(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onPad(e,t,s,r,i,n)}onDelPad(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPad(e,t,s,r)}onVia(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onVia(e,t,s,r,i,n)}onDelVia(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelVia(e,t,s,r)}onDelConnect(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelConnect(e,t,s,r)}onPreference(e,t,s,r){this._compilerHandler&&this._compilerHandler.onPreference(e,t,s,r)}onSilkOpts(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onSilkOpts(e,t,s,r,i)}onDelSilkOpts(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelSilkOpts(e,t,s,r)}onPrimitive(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onPrimitive(e,t,s,r,i)}onDelPrimitive(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPrimitive(e,t,s,r)}onNet(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onNet(e,t,s,r,i)}onDelNet(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelNet(e,t,s,r)}onPartition(e,t,s,r,i,n){this._compilerHandler&&this._compilerHandler.onPartition(e,t,s,r,i,n)}onDelPartition(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelPartition(e,t,s,r)}onActiveLayer(e,t,s,r){this._compilerHandler&&this._compilerHandler.onActiveLayer(e,t,s,r)}onLayerPhys(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onLayerPhys(e,t,s,r,i)}onDelLayerPhys(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelLayerPhys(e,t,s,r)}onLayer(e,t,s,r,i){this._compilerHandler&&this._compilerHandler.onLayer(e,t,s,r,i)}onDelLayer(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDelLayer(e,t,s,r)}onCanvas(e,t,s,r){this._compilerHandler&&this._compilerHandler.onCanvas(e,t,s,r)}onDocDetail(e,t,s,r){this._compilerHandler&&this._compilerHandler.onDocDetail(e,t,s,r)}onStringNum(e,t){this._compilerHandler&&this._compilerHandler.onStringNum(e,t)}onAttrNum(e,t){this._compilerHandler&&this._compilerHandler.onAttrNum(e,t)}onDimensionNum(e,t){this._compilerHandler&&this._compilerHandler.onDimensionNum(e,t)}onBossNum(e,t){this._compilerHandler&&this._compilerHandler.onBossNum(e,t)}onShellEntityNum(e,t){this._compilerHandler&&this._compilerHandler.onShellEntityNum(e,t)}onShellCutNum(e,t){this._compilerHandler&&this._compilerHandler.onShellCutNum(e,t)}onCreaseNum(e,t){this._compilerHandler&&this._compilerHandler.onCreaseNum(e,t)}onShellNum(e,t){this._compilerHandler&&this._compilerHandler.onShellNum(e,t)}onFpcFillNum(e,t){this._compilerHandler&&this._compilerHandler.onFpcFillNum(e,t)}onTeardropNum(e,t){this._compilerHandler&&this._compilerHandler.onTeardropNum(e,t)}onImageNum(e,t){this._compilerHandler&&this._compilerHandler.onImageNum(e,t)}onPouredNum(e,t){this._compilerHandler&&this._compilerHandler.onPouredNum(e,t)}onPourNum(e,t){this._compilerHandler&&this._compilerHandler.onPourNum(e,t)}onRegionNum(e,t){this._compilerHandler&&this._compilerHandler.onRegionNum(e,t)}onFillNum(e,t){this._compilerHandler&&this._compilerHandler.onFillNum(e,t)}onPolyNum(e,t){this._compilerHandler&&this._compilerHandler.onPolyNum(e,t)}onObjNum(e,t){this._compilerHandler&&this._compilerHandler.onObjNum(e,t)}onArcNum(e,t){this._compilerHandler&&this._compilerHandler.onArcNum(e,t)}onCArcNum(e,t){this._compilerHandler&&this._compilerHandler.onCArcNum(e,t)}onLineNum(e,t){this._compilerHandler&&this._compilerHandler.onLineNum(e,t)}onPadNum(e,t){this._compilerHandler&&this._compilerHandler.onPadNum(e,t)}onViaNum(e,t){this._compilerHandler&&this._compilerHandler.onViaNum(e,t)}onPartitionNum(e,t){this._compilerHandler&&this._compilerHandler.onPartitionNum(e,t)}},S_=(e=>(e.CREATE="/pro-mgr/library/lib/create",e.UPDATE="/pro-mgr/library/lib/update",e.CANCEL_ASSOCIATE="/pro-mgr/library/lib/cancelAssociate",e.DELETE="/pro-mgr/library/lib/delete",e.BATCH_GET="/pro-mgr/library/lib/batchGet",e.GET="/pro-mgr/library/lib/get",e.GET1="/pro-mgr/library/lib/get1",e.CREATE1="/pro-mgr/library/lib/create1",e.UPDATE1="/pro-mgr/library/lib/update1",e.UPDATE_DEVICES="/pro-mgr/library/lib/updateDevices",e.STAR="/pro-mgr/library/lib/star",e.UNSTAR="/pro-mgr/library/lib/unstar",e.FORCE="/pro-mgr/library/lib/force",e.UPLOAD="/pro-mgr/library/lib/upload",e.DEVICE_LIST="/pro-mgr/library/lib/device/list",e.DEVICE_SEARCH_LIST="/pro-mgr/library/lib/device/searchList",e.DEVICE_SEARCH_BY_USERS_AND_TITLES="/pro-mgr/library/lib/device/searchByUsersAndTitles",e.DEVICE_GET_ATTR_VALUES="/pro-mgr/library/lib/device/getAttributeValues",e.DEVICE_GET_ATTR_KEYS="/pro-mgr/library/lib/device/getAttrKeys",e.COMPONENT_LIST="/pro-mgr/library/lib/component/list",e.COMPONENT_SEARCH_LIST="/pro-mgr/library/lib/component/searchList",e.COMPONENT_SEARCH_BY_USERS_AND_TITLES="/pro-mgr/library/lib/component/searchByUsersAndTitles",e))(S_||{}),__=(e=>(e.GET_DEVICE="/pro-mgr/library/sheetSymbol/getDevice",e.GET_SYMBOL="/pro-mgr/library/sheetSymbol/getSymbol",e.FORCE="/pro-mgr/library/sheetSymbol/force",e.GET="/pro-mgr/library/sheetSymbol/get",e.CREATE="/pro-mgr/library/sheetSymbol/create",e.UPDATE="/pro-mgr/library/sheetSymbol/update",e.SET_CUSTOM="/pro-mgr/library/sheetSymbol/setCustom",e))(__||{}),gs={LIB:S_,SHEET_SYMBOL:__};async function A_(e,t,s,r){let{message:i}=await Je.messageBus.rpcCall(gs.LIB.COMPONENT_SEARCH_LIST,{titles:JSON.stringify([e]),docType:[+t],type:s,user_uuid:r,path:r});return i&&i.success?i:{...i}}async function mB(e,t,s,r,i=!1){let n=await A_(e,t,s,r);if(!n.success||n.result===null)return{isExist:!1,component:null};if(K1)return i===!0?{isExist:!1,component:null}:{isExist:n&&n.result?n.result.length>0:!1,component:n.result};let a=[];n&&n.success&&n.result&&(n.result instanceof Array?a=n.result:a=n.result[e]||[]);let o=a.filter(c=>c.owner.uuid==r);return{isExist:o.length>0,component:o||null}}function gB(e,t){let s=0;return function(...r){let i=new Date().getTime();i-s>t&&(e.apply(this,r),s=i)}}function yB(e,t,s){let r,i,n,a,o,c,l=0,u=!1,h=!1,p=!0;if(typeof e!="function")throw new TypeError("Expected a function");t=Number(t)||0,typeof s=="object"&&(u=!!s.leading,h="maxWait"in s,n=h?Math.max(Number(s.maxWait)||0,t):n,p="trailing"in s?!!s.trailing:p);function d(S){let _=r,C=i;return r=i=void 0,l=S,a=e.apply(C,_),a}function f(S){return l=S,o=window.setTimeout(b,t),u?d(S):a}function m(S){let _=S-c,C=S-l,x=t-_;return h?Math.min(x,n-C):x}function g(S){let _=S-c,C=S-l;return c===void 0||_>=t||_<0||h&&C>=n}function b(){let S=Date.now();if(g(S))return E(S);o=window.setTimeout(b,m(S))}function E(S){return o=void 0,p&&r?d(S):(r=i=void 0,a)}function y(){o!==void 0&&clearTimeout(o),l=0,r=c=i=o=void 0}function T(){return o===void 0?a:E(Date.now())}function w(){let S=Date.now(),_=g(S);if(r=arguments,i=this,c=S,_){if(o===void 0)return f(c);if(h)return o=window.setTimeout(b,t),d(c)}return o===void 0&&(o=window.setTimeout(b,t)),a}return w.cancel=y,w.flush=T,w}var Dc=new Map;Dc.set("<","&lt;"),Dc.set(">","&gt;"),Dc.set('"',"&quot;"),Dc.set("'","&apos;"),Dc.set("&","&amp;");function C_(e){if(typeof e!="string")return e;if(e==null)return"";function t(s){return Dc.get(s)}return e==null?"":Nm(e,Dc)?(e+"").replace(/[<>'"&]/g,t):e}var _c=new Map;_c.set("&lt;","<"),_c.set("&gt;",">"),_c.set("&quot;",'"'),_c.set("&apos;","'"),_c.set("&amp;","&"),_c.set("&#039;","'");function EB(e){if(typeof e!="string")return e;if(e==null)return"";let t={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#039;":"'"};function s(r){return _c.get(r)}return Nm(e,t)?(e+"").replace(/&([^;]+);/g,s):e}var Gh=new Map;Gh.set("~","&#126;"),Gh.set("^","&#94;"),Gh.set("#@$","&#35;&#64;&#36;"),Gh.set("`","&#96;");function bB(e){if(typeof e!="string")return e;if(e==null)return"";let t={"~":"&#126;","^":"&#94;","#@$":"&#35;&#64;&#36;","`":"&#96;"};function s(r){return Gh.get(r)}return Nm(e,t)?e.replace(/(\~|\^|#@\$|\`)/g,s):e}function Y1(e){if(typeof e!="object"||e===null||e===void 0)return e;if(Array.isArray(e))return e.map(Y1);{let t={};for(let s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=Y1(e[s]));return t}}function V1(e){if(typeof e!="object"||e===null||e instanceof Date)return typeof e=="string"&&e.includes("<")&&(e=C_(e)),e;if(Array.isArray(e))return e.map(V1);{let t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=V1(e[s]));return t}}function TB(e,t){let s="",r="";for(let i=0;i<e.length;i++)String(e[i])&&(r+=e[i]+"	");r=r.slice(0,-1),s+=r+`\r
`;for(let i=0;i<t.length;i++){r="";for(let n=0;n<e.length;n++)r+='"'+(typeof t[i][n]<"u"?t[i][n]:"")+'"	';r=r.slice(0,r.length-1),s+=r+`\r
`}return s}function wB(e,t={targetType:"blob"}){let{targetType:s,width:r,height:i}=t,n=new Image(r,i);return new Promise((a,o)=>{n.onload=function(){let c=document.createElement("canvas"),l=c.getContext("2d");switch(c.width=n.width,c.height=n.height,l.drawImage(n,0,0,n.width,n.height),s){case"dataURL":{a(c.toDataURL());break}case"blob":default:{c.toBlob(u=>{a(u)});break}}},n.onerror=c=>{o(c)},n.src=e})}async function SB(e,t={}){return new Promise((s,r)=>{try{let{targetType:i="blob",imageType:n="image/png"}=t,a=document.createElement("canvas"),o=a.getContext("2d");switch(a.width=e.width,a.height=e.height,o.putImageData(e,0,0),i){case"dataURL":{s(a.toDataURL(n));break}case"blob":default:{a.toBlob(c=>{s(c)},n);break}}}catch(i){r(i)}})}var _B=class extends bE{constructor(e){super(),this._action=e}get action(){return this._action}onAttr(e,t,s){s||this.action(t.key,t.value)}};async function AB(e,t,s,r=!0){let i={initResponse:null,d3modelItem:null,d3modelItemName:void 0,d3modelItemTransform:void 0,d3modelItemPath:void 0,d3modelItemId:void 0,compiler:null},n=new Map;return new Promise(async a=>{let o=new w_(e,t,s);i.compiler=o,o.setHandler(new _B(async(c,l)=>{if(typeof l<"u"&&n.set(c,l),n.has("3D Model")&&n.has("3D Model Title")&&n.has("3D Model Transform")){i.d3modelItemId=n.get("3D Model"),i.d3modelItemName=n.get("3D Model Title"),i.d3modelItemTransform=n.get("3D Model Transform");let u=pd(i.d3modelItemId,!0);i.d3modelItemPath=u.path}})),i.initResponse=await o.init().catch(c=>({message:c.message,success:!1})),i.d3modelItemId&&r&&(i.d3modelItem=await fd(i.d3modelItemId)),i.compiler.destroy(),n.clear(),a(i)})}async function CB(e,t){let s={padList:[]};return new Promise(async r=>{try{let i=new s5(e,t,!0),n=await i.getPads()||{},a=Object.keys(n);for(let o=0;o<a.length;o++)s.padList.push({...n[a[o]]});i.destroy(),r(s)}catch{r(s)}})}function DB(e,t,s){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!s)return Math.round(e);let r=[1,10,100,1e3][t]||Math.pow(10,t)||10;if(s){let i=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),i+e}else return Math.round(e*r+1e-10)/r}function PB(e,t){typeof e=="string"&&(e=parseFloat(e));let s=Math.pow(10,t);return Math.round(e*s)/s}var OB={conversion(e,t,s){let r=e+2+t;return this[r](s)},conversion1(e,t,s){let r=e+2+t,i=this[r](s);return t=="mil"?Math.round(i*10)/10:Math.round(i*1e3)/1e3},mil2mil(e){return e},mil2mm(e){return e*.0254},mil2cm(e){return e*.00254},mil2inch(e){return e/1e3},mm2mm(e){return e},mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t},mm2cm(e){return e/10},mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t},cm2mil(e){let t=Math.pow(10,6);return Math.round(e*3.937007874015748*t)/t},cm2mm(e){return e*10},cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t},inch2mil(e){return e*1e3},inch2mm(e){return e*25.4},inch2cm(e){return e*2.54}};function IB(e,t,s){var r=e-t;return s||(s=1e-10),(r>0?r:-r)<s}function xB(e){return e<0?(360+e%360)%360:e>=360?e%360:e}function D_(e,t,s,r){var i=e-s,n=t-r;return i*i+n*n}function vB(e,t,s,r){return Math.sqrt(D_(e,t,s,r))}function RB(e,t,s,r){var i=s-e,n=r-t,a=Math.atan2(n,i);return a=a<0?a+Math.PI+Math.PI:a,a}function NB(e){return P_(e)&&Object.keys(e).length===0}function P_(e){return Object.prototype.toString.call(e).slice(8,-1)==="Object"}function LB(e){return O_(e)||I_(e)}function O_(e){return Object.prototype.toString.call(e).slice(8,-1)==="AsyncFunction"}function I_(e){return Object.prototype.toString.call(e).slice(8,-1)==="Function"}var St,BB=(St=class{},St.unitConversion=OB,St.ConcurrencyTaskQueue=pB,St.FootprintCompilerInstance=w_,St.FootprintCompilerHandlerProxy=bE,St.FootprintCompilerAttr=fB,St.createCSVString=TB,St.svg2png=wB,St.imageData2NewImage=SB,St.htmlEncode=C_,St.htmlDecode=EB,St.strEncode=bB,St.isEmptyObj=NB,St.isPlainObject=P_,St.isFn=LB,St.isAsyncFunction=O_,St.isNormalFunction=I_,St.formatDate=Fo,St.formatDate2=sB,St.deepClone=Y1,St.deepCloneWithHtmlEncode=V1,St.naturalSortComparator=E2,St.naturalSortSplitor=S1,St.naturalSort=vv,St.naturalStrSort=Rv,St.naturalSort1=Nv,St.naturalCompare=Lv,St.isObjKeyInStr=Nm,St.throttle=gB,St.debounce=yB,St.findList=li,St.findListAll=aB,St.randomString=Mv,St.parseJSON=jv,St.splitComponentId2FolderAndFilenameMixin=pd,St.queryExistSameNameDocDetail=A_,St.checkComponentNameDuplicate=mB,St.getFootprintPadInfo=CB,St.getFootprint3DInfo=AB,St),on,lY=(on=class{},on.toFixed=DB,on.toFixed1=PB,on.floatEqual=IB,on.fixAngle=xB,on.getDistance=vB,on.getDistance2=D_,on.getAngleByDot=RB,on),Bo,er=(Bo=class{constructor(){this._changeCbs=new Set,this._map=new Map,this._debounceNotify=BB.debounce(()=>{this._notify()},50)}static get context(){return du()}static getInstance(){var t;return(t=this.context.extendLibManager)!=null?t:this.context.extendLibManager=new Bo}_notify(){for(let t of this._changeCbs)t()}onChange(t){this._changeCbs.add(t)}offChange(t){this._changeCbs.delete(t)}_getLibId(t){return`${Bo.LIB_ID_PREFFIX}${t}`}async addLibWithId(t){this._map.set(t.id,await dB.set(t)),this._debounceNotify()}async addLib(t){let s=this._getLibId(t.title);return await this.addLibWithId({...t,id:s}),s}deleteLib(t){return this._debounceNotify(),this._map.delete(t)}hasLib(t){return this._map.has(t)}getLib(t){return this._map.get(t)}getLibs(){return Array.from(this._map.values())}updateLibTitle(t,s){let r=this._map.get(t);r&&(r.title=s,this._debounceNotify())}updateLibPosition(t,s){let r=this._map.get(t);r&&(r.position=s,this._debounceNotify())}},Bo.LIB_ID_PREFFIX="extend_lib_",Bo),kB=0;async function md(e,t,s,r=!0,i,n){let a=null,o="requestid"+ ++kB;i&&i(o);let c={user_uuid:e,path:t,type:s};n&&n(c);try{if(er.getInstance().hasLib(e))return await MB(e,s,r);let u=await dt("GET","/api/categories",c,{headers:{path:t},searchParams:!0});if(u.success)return{...u,result:await TE(u.result,r)}}catch(u){a=u,console.error("Fetch Category List Error",u)}let l=a?a.msg||a.message:void 0;return{code:a?a.code:nt.ERR_CODE.NORMAL,success:!1,result:null,msg:l||"Fetch Category List Error"}}async function MB(e,t,s){var i;let r=[];for(let n of t){let a=await((i=er.getInstance().getLib(e))==null?void 0:i.getCategoryTreeDataItemsByCategoryType(n));a&&r.push(a)}return{code:0,success:!0,result:await TE(r.flat().map(n=>({uuid:n.id,parent_uuid:n.parentId,user_uuid:e,type:void 0,order_no:void 0,name_cn:void 0,name:n.title,created_at:n.created_at,updated_at:n.updated_at,title:n.title})),s)}}async function jB(e=!0){let t=null;try{let r=await dt("POST","/api/open/deviceCate");if(r.success)return{...r,result:await TE(r.result,e)}}catch(r){t=r,console.error("Fetch Category List Error",r)}let s=t?t.msg||t.message:void 0;return{code:t?t.code:nt.ERR_CODE.NORMAL,success:!1,result:null,msg:s||"Fetch Category List Error"}}async function TE(e,t=!0){let s=[],r=[],i=[],n={},a={};e.forEach(h=>{h.name&&(a[h.name]=h.name_cn||h.name)});let o=e.filter(h=>!h.parent_uuid),c=e.filter(h=>!!h.parent_uuid),l=[],u={};if(o.forEach((h,p)=>{l.push(h.uuid),i.push({name:h.name,name_cn:h.name_cn,title:h.name,titleAdditional:h.name_cn||h.name,disableTranslate:h.name_cn===""?!0:h.name_cn===h.name,id:h.uuid,children:[],order_no:+h.order_no||0,parentId:void 0,created_at:h.created_at,updated_at:h.updated_at}),n[h.uuid]=p}),c.forEach(h=>{l.push(h.uuid);let p=n[h.parent_uuid];if(typeof p<"u"&&i[p]){let d=i[p];d.children.push({name:h.name,name_cn:h.name_cn,title:h.name,titleAdditional:h.name_cn||h.name,disableTranslate:h.name_cn===""?!0:h.name_cn===h.name,id:h.uuid,order_no:+h.order_no||0,children:[],parentId:d.id,created_at:h.created_at,updated_at:h.updated_at})}u[h.uuid]=h.parent_uuid}),i.sort(f2("order_no")),i.forEach(h=>{h.children.length>1&&h.children.sort(f2("order_no"))}),i.forEach(h=>{s.push({...h})}),t){let h=(await Je.messageBus.rpcCall("I18nTranslateService",{str:nt.CATEGORY_ITEM_ALL_TITLE})).message;s.unshift({title:nt.CATEGORY_ITEM_ALL_TITLE,titleAdditional:h||nt.CATEGORY_ITEM_ALL_TITLE,id:nt.CATEGORY_ITEM_ALL_VALUE,order_no:Number.MAX_SAFE_INTEGER,disableTranslate:!1,children:[],parentId:void 0}),r.push(nt.CATEGORY_ITEM_ALL_VALUE)}return{languageHashtable:a,treeData:s,selectedIds:r,categoryIds:l,childCategory2ParentCategoryMap:u,sourceCategoryList:e}}async function Ic(e){let{categories:t,type:s,uuid:r}=e,i=await md(r,r,s),n=i.result?i.result.treeData:[],a=[],o=[],c=[],l=[];for(let f=0;f<t.length;f++){let{parentName:m,childName:g,parent_order_no:b,child_order_no:E}=t[f];if(m){let y=li(n,"title",m);if(y.index>=0){if(a.push({name:y.data.title,type:s,user_uuid:r,order_no:y.data.order_no,parent_uuid:void 0,uuid:y.data.id}),g){let S=li(y.data.children,"title",g);if(S.index>=0){o.push({name:S.data.title,type:s,user_uuid:r,order_no:S.data.order_no,parent_uuid:y.data.id,uuid:S.data.id});continue}l.push({name:g,type:s,user_uuid:r,order_no:f+1,parent_uuid:y.data.id,uuid:void 0});continue}continue}let T=ed(),w=ed();c.push({name:m,type:s,user_uuid:r,order_no:typeof b<"u"?b:f+1,parent_uuid:void 0,uuid:T}),g&&l.push({name:g,type:s,user_uuid:r,order_no:typeof E<"u"?E:f+1,parent_uuid:T,uuid:w})}}let u=[];if(c.length){let f=await ou(c,(m,g)=>{c[g].__remoteId=m.result.uuid});u=f.result?f.result.successList.map(m=>m.result):[]}let h=[];if(l.length){for(let m=0;m<l.length;m++){let g=li(c,"uuid",l[m].parent_uuid);g.index>=0&&g.data.__remoteId&&(l[m].parent_uuid=g.data.__remoteId)}let f=await ou(l);h=f.result?f.result.successList.map(m=>m.result):[]}let p=u.concat(a),d=h.concat(o);return{allParentCreated:p,allChildCreated:d}}async function x_(e){let{uuid:t,path:s,types:r,names:i}=e;return new Promise(async(n,a)=>{let o=await md(t,s,r,!1);if(o.code!==0){n({...o,code:nt.ERR_CODE.NORMAL,success:!1,result:null});return}let c={detail:[],arguments:e},{treeData:l}=o.result;for(let u=0;u<i.length;u++){let h=i[u].primary,p=i[u].secondary,d={primary:{name:h,name_cn:"",uuid:"",exist:!1,undefine:!1},secondary:{name:p,name_cn:"",uuid:"",exist:!1,undefine:!1}};if(typeof h>"u"){d.primary.exist=!1,d.primary.undefine=!0;continue}let f=li(l,"title",h);if(f.index<=-1){d.primary.exist=!1,d.secondary.exist=!1,c.detail.push(d);continue}if(d.primary.exist=!0,d.primary.uuid=f.data.id,d.primary.name_cn=f.data.titleAdditional||h,typeof p>"u"){d.secondary.exist=!1,d.secondary.undefine=!0,c.detail.push(d);continue}let m=li(f.data.children,"title",p);if(m.index<=-1){d.secondary.exist=!1,c.detail.push(d);continue}d.secondary.exist=!0,d.secondary.uuid=m.data.id,d.secondary.name_cn=m.data.titleAdditional||p,c.detail.push(d)}n({code:0,success:!0,result:c})})}function FB(e){let t=new Map,s=[];for(let r of e)(!t.has(r.primary)||t.get(r.primary)!==r.secondary)&&(t.set(r.primary,r.secondary),s.push(r));return s}async function UB(e,t,s,r=!1){let i=await x_(e),n=[],a=[],o=[],c=[],l=[];if(!r&&i.success&&i.result.detail.length){let h=new Map,p=new Map,d=new Map;i.result.detail.forEach((f,m)=>{(f.primary.name||f.primary.name_cn)&&!f.primary.exist&&!h.has(f.primary.name||f.primary.name_cn)&&(h.set(f.primary.name||f.primary.name_cn,!0),n.push({name:f.primary.name||f.primary.name_cn,type:t,user_uuid:s,order_no:0})),(f.primary.name||f.primary.name_cn)&&!f.primary.exist&&(f.secondary.name||f.secondary.name_cn)&&!f.secondary.exist&&p.get(f.secondary.name||f.secondary.name_cn)!==(f.primary.name||f.primary.name_cn)?(p.set(f.secondary.name||f.secondary.name_cn,f.primary.name||f.primary.name_cn),a.push({name:f.secondary.name||f.secondary.name_cn,type:t,user_uuid:s,uuid:f.secondary.uuid,order_no:0,parent_uuid:f.primary.uuid,parent_title:f.primary.name||f.primary.name_cn})):f.primary.exist&&(f.secondary.name||f.secondary.name_cn)&&!f.secondary.exist&&p.get(f.secondary.name||f.secondary.name_cn)!==(f.primary.name||f.primary.name_cn)&&(p.set(f.secondary.name||f.secondary.name_cn,f.primary.name||f.primary.name_cn),a.push({name:f.secondary.name||f.secondary.name_cn,type:t,user_uuid:s,uuid:f.secondary.uuid,order_no:0,parent_uuid:f.primary.uuid,parent_title:f.primary.name||f.primary.name_cn})),f.primary.exist&&!d.has(f.primary.uuid)&&(d.set(f.primary.uuid,f.primary.name||f.primary.name_cn),l.push({title:f.primary.name||f.primary.name_cn,uuid:f.primary.uuid,parent_uuid:""})),f.secondary.exist&&!d.has(f.secondary.uuid)&&(d.set(f.secondary.uuid,f.secondary.name||f.secondary.name_cn),l.push({title:f.secondary.name||f.secondary.name_cn,uuid:f.secondary.uuid,parent_uuid:f.primary.uuid}))})}if(!r&&n.length){let h=await ou(n);if(h.success&&h.result.successList.length&&(o=h.result.successList.map(p=>p.result),a.forEach(p=>{o.forEach(d=>{!p.parent_uuid&&p.parent_title===d.name&&(p.parent_uuid=d.uuid)})})),a.length){let p=await ou(a);p.success&&p.result.successList.length&&(c=p.result.successList.map(d=>d.result))}}else if(!r&&a.length){let h=await ou(a);h.success&&h.result.successList.length&&(c=h.result.successList.map(p=>p.result))}let u=[];return u=o.map(h=>({uuid:h.uuid,title:h.name,name:h.name,parent_uuid:h.parent_uuid})),u=u.concat(c.map(h=>({uuid:h.uuid,parent_uuid:h.parent_uuid,title:h.name,name:h.name}))),u=u.concat(l),u}async function HB(e,t){let s=[],r=[],i=async o=>{let{message:c}=await Je.messageBus.rpcCall(Me.TAG.DELETE,o);return c},n=null;try{for(let o=0;o<e.length;o++){let c=await i({...e[o],path:e[o].user_uuid});if(c.code===0&&c.success){let u={...c,message:"",result:{...e[o],path:e[o].user_uuid,...c.result[0]}};s.push(u),t&&t(u,o);continue}let l={...c,result:{...e[o]}};r.push(l)}return{code:0,success:!0,result:{successList:s,failList:r},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Del Categories Batch Error";return{code:n?n.code:nt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}async function GB(e){let{uuid:t,path:s,types:r,ids:i}=e;return new Promise(async(n,a)=>{let o=await md(t,s,r,!1);if(o.code!==0){n({...o,code:nt.ERR_CODE.NORMAL,success:!1,result:null});return}let c={detail:[],arguments:e},{treeData:l}=o.result;for(let u=0;u<i.length;u++){let h=i[u].primary,p=i[u].secondary,d={primary:{name:"",name_cn:"string",uuid:h,exist:!1,undefine:!1},secondary:{name:"",name_cn:"string",uuid:p,exist:!1,undefine:!1}};if(typeof h>"u"){d.primary.exist=!1,d.primary.undefine=!0;continue}let f=li(l,"id",h);if(f.index<=-1){d.primary.exist=!1,d.secondary.exist=!1,c.detail.push(d);continue}if(d.primary.exist=!0,d.primary.name=f.data.title,d.primary.name_cn=f.data.titleAdditional||d.primary.name,typeof p>"u"){d.secondary.exist=!1,d.secondary.undefine=!0;continue}let m=li(f.data.children,"id",p);if(m.index<=-1){d.secondary.exist=!1,c.detail.push(d);continue}d.secondary.exist=!0,d.secondary.name=m.data.title,d.secondary.name_cn=m.data.titleAdditional||d.secondary.name,c.detail.push(d)}n({code:0,success:!0,result:c})})}var YB=class{constructor(){this._actuatorMap=new Map}clearAll(){this._actuatorMap.clear()}async addActuator(e,t,s,r){let i=e.filter(h=>!!h),n=`${i[0]}_${t[0]||0}_${s}_${r}`,a=`${i[0]}_${i[1]}_${t[1]||t[0]||0}_${s}_${r}`;if(!i[1]){if(this._actuatorMap.has(n))return this._actuatorMap.get(n);let h=new Promise(async(p,d)=>{let f=await Ic({categories:[{parentName:i[0],parent_order_no:t[0]||0}],type:[r],uuid:s});p({uuids:f.allParentCreated.map(m=>m.uuid),titles:f.allParentCreated.map(m=>m.name)}),this._actuatorMap.delete(n)});return this._actuatorMap.set(n,h),h}let o=this._actuatorMap.get(n);o||(o=new Promise(async(h,p)=>{let d=await Ic({categories:[{parentName:i[0],parent_order_no:t[0]||0}],type:[r],uuid:s});h({uuids:d.allParentCreated.map(f=>f.uuid),titles:d.allParentCreated.map(f=>f.name)}),this._actuatorMap.delete(n)}),this._actuatorMap.set(n,o));let c=await o,l=this._actuatorMap.get(a);l||(l=new Promise(async(h,p)=>{let d=await Ic({categories:[{parentName:i[0],childName:i[1],parent_order_no:t[0]||0,child_order_no:t[1]||t[0]||0}],type:[r],uuid:s});h({uuids:d.allChildCreated.map(f=>f.uuid),titles:d.allChildCreated.map(f=>f.name)}),this._actuatorMap.delete(a)}),this._actuatorMap.set(a,l));let u=await l;return{uuids:[c.uuids[0],u.uuids[0]],titles:[c.titles[0],u.titles[0]]}}};async function VB(e,t){let s=[],r=[],i=async o=>{let{message:c}=await Je.messageBus.rpcCall(Me.TAG.UPDATE,o);return c},n=null;try{for(let o=0;o<e.length;o++){let c=await i({...e[o],path:e[o].user_uuid});if(c.code===0&&c.success){let u={...c,message:"",result:{...e[o],path:e[o].user_uuid,...c.result[0]}};s.push(u),t&&t(u,o);continue}let l={...c,result:{...e[o]}};r.push(l)}return{code:0,success:!0,result:{successList:s,failList:r},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Update Categories Batch Error";return{code:n?n.code:nt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}var zr,Hc=(zr=class{},zr.categoryAddtition=new YB,zr.fetchCategoryList=md,zr.fetchInternalCategoryList=jB,zr.addCategoriesBatch=ou,zr.deleteCategoriesBatch=HB,zr.updateCategoriesBatch=VB,zr.addCategoriesBatchByNameArray=Ic,zr.queryCategoryBatchByNames=x_,zr.queryCategoryBatchByIds=GB,zr.formatRepeatCategoryArr=FB,zr.bindAndCreateCategory=UB,zr.getCategoryNamesByTags=Ho,zr);async function Ho(e,t,s){if(!e)return[];if(e instanceof Array)return e;let r=Uc(e);if(r=r.filter(l=>!!l),!r.length)return[];let i=(await Je.messageBus.rpcCall("LocaleCurrFetch",{})).message||"en",n=await md(t,t,s),a=n.result?n.result.sourceCategoryList:[],o=typeof r[1]<"u",c=[];for(let l=0;l<a.length;l++)if(a[l].name===r[0]||a[l].name_cn===r[0]){c.push(i=="en"?a[l].name:a[l].name_cn||a[l].name);break}if(o){for(let l=0;l<a.length;l++)if(a[l].name===r[1]||a[l].name_cn===r[1]){c.push(i=="en"?a[l].name:a[l].name_cn||a[l].name);break}}return c}async function zB(e,t,s){let r=null,i=null,n=[],a=[],o=!1,c,l;if(e)if("data"in e)r=e.data,r.tags&&(r.tags instanceof Array?a=r.tags:a=Uc(r.tags));else{if(!e.uuid||!e.path)throw new Ce("PARAMETER_VERIFICATION","missing 3d-model uuid or path data.");c=e.uuid,l=e.path,i=await vs.getD3Model({isProject:e.isProject,uuid:e.uuid,path:e.path}),i&&(i.title=i.display_title,a=await Ho(i.tags,e.path,[5]))}if(!s){let u=await Hc.categoryAddtition.addActuator(a,[0],t,5);n=u.uuids,a=u.titles}return{d3modelItemOriginUuid:c,d3modelItemOriginPath:l,d3modelItemIn:r,d3modelItemOut:i,d3modelTagIds:n,d3modelTagTitles:a}}async function WB(e){let{d3modelItemIn:t,d3modelItemOut:s,d3modelTagIds:r,d3modelTagTitles:i}=await zB(e.d3model,e.path,e.isProject),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing 3d-model data.");nB(n.title),"path"in e.d3model&&e.d3model.override&&wi(n,e.d3model.override);let a=await dt("POST","/api/v2/components/add",JSON.stringify({...n,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let c=a.result,l=await kn(c);return{title:c.title,description:c.description,path:c.path||e.path,docType:c.docType,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source,dataStrId:c.dataStrId,dataStr:l}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ce("CREATE_D3MODEL_DUP_TITLE",o):a.code===422?new Ce("CREATE_D3MODEL_PERMISSIONS",o):new Ce("CREATE_D3MODEL",o)}async function vm(e=!1,t,s,r,i,n){let a=t.toLocaleLowerCase(),o=n?!!n.forceAsSymbol:!1,c=[];try{if(o||r&&[2,18,19,20,21,22,25,31,7,32,6].indexOf(r)>=0){let l={isProject:e,path:s,titles:[a],docType:r};c=(await vs.getSymbolSearchList(l))[a]||[]}if(r===28){let l={isProject:e,path:s,titles:[a]};c=(await vs.getDeviceSearchList(l))[a]||[]}if(r===4){let l={isProject:e,path:s,titles:[a]};c=(await vs.getFootprintSearchList(l))[a]||[]}return r===16&&(c=(await vs.getD3ModelSearchList({isProject:e,uid:s,path:s,page:1,pageSize:void 0,wd:a})).lists),{code:0,success:!0,result:c,message:""}}catch(l){return console.error(l),{code:-1,success:!1,result:[],message:l instanceof Ce?`${String(l.action)}|${String(l.message)}`:l.message||"QueryComponentsByTitle call error."}}}function m2(e,t){return e.path==t}function g2(e){try{let t=JSON.parse(e);return{parentName:t[0],childName:t[1]}}catch{return{parentName:"",childName:""}}}function qB(e){let t={};return t["device-owner"]=e.userIdSelected,t["device-lib"]=e.userIdSelected,t["footprint-name"]=e.footprintItem?e.footprintItem.display_title:"",t["symbol-name"]=e.symbolItem?e.symbolItem.display_title:"",t["new-symbol"]=e.isNeedCreateSymbolAndAssocia,t}function v_(e,t){typeof e.footprintItemId<"u"&&(t.Footprint=e.footprintItemId),typeof e.symbolItemId<"u"&&(t.Symbol=e.symbolItemId)}async function R_(e,t){let s=qB(e),r=e.footprintItem,i=e.symbolItem,n={},a=async(y,T)=>{let w="",S="",_=!1,C=t==="zh-hans",x=y.parent_tag,D=y.child_tag;if(x&&x.uuid&&(_=!0,w=C&&x.name_cn||x.name),_&&D.uuid){let I=C&&D.name_cn||D.name;w+=`:${I}`}if(w){let I=w.split(":")[0],P=w.split(":")[1],L=await Ic({categories:P?[{parentName:I,childName:P}]:[{parentName:I}],type:[+T],uuid:s["device-owner"]}),F=L.allParentCreated[0]?L.allParentCreated[0].uuid:void 0,V=L.allChildCreated[0]?L.allChildCreated[0].uuid:void 0;F&&(S=V?[F,V]:[F])}return S},o={"file-owner":s["device-owner"],"file-name":s["footprint-name"],"file-describe":"","file-category":await a((r==null?void 0:r.tags)||{},4),"file-lib":s["device-lib"],"file-customTags":[]};if(r&&(r!=null&&r.custom_tags)&&!(o!=null&&o["file-category"])){let{parentName:y,childName:T}=g2(r.custom_tags);if(y){let w=await Ic({categories:T?[{parentName:y,childName:T}]:[{parentName:y}],type:[4],uuid:s["device-owner"]}),S=w.allParentCreated[0]?w.allParentCreated[0].uuid:void 0,_=w.allChildCreated[0]?w.allChildCreated[0].uuid:void 0;S&&(o["file-customTags"]=_?[S,_]:[S])}}let c={"file-owner":s["device-owner"],"file-name":s["symbol-name"],"file-describe":"","file-category":await a((i==null?void 0:i.tags)||{},2),"file-lib":s["device-lib"],"file-customTags":[]};if(i&&(i!=null&&i.custom_tags)&&!c["file-category"]){let{parentName:y,childName:T}=g2(i.custom_tags);if(y){let w=await Ic({categories:T?[{parentName:y,childName:T}]:[{parentName:y}],type:[4],uuid:s["device-owner"]}),S=w.allParentCreated[0]?w.allParentCreated[0].uuid:void 0,_=w.allChildCreated[0]?w.allChildCreated[0].uuid:void 0;S&&(c["file-customTags"]=_?[S,_]:[S])}}let l,u,h,p,d=!1,f=!1,m=!1;async function g(){if(s["footprint-name"])if(m2(r,s["device-owner"]||s["device-lib"]))h=r,l=null;else{let y=await vm(!1,o["file-name"],s["device-lib"],4);y.result.length<=0||(f=!0,h=r,l=y.result)}else h=null,l=null}async function b(){if(!s["new-symbol"]&&s["symbol-name"]&&i)if(m2(i,s["device-owner"]||s["device-lib"]))p=i,u=null;else{let y=await vm(!1,c["file-name"],s["device-lib"],i.docType);y.result.length<=0||(d=!0,u=y.result,p=i)}else p=null,u=null}await g(),await b();let E={isNeedConfirm:!1,updateCache:n,formData:s,newFootPrint:l,oldFootPrint:h,newSymbol:u,oldSymbol:p,confirmRes:e};return!d&&!f&&!m?(E.isNeedConfirm=!1,E):(E.isNeedConfirm=!0,E)}async function wE(e,t,s,r){let i=null,n=null,a=[],o=[],c=!1,l,u;if(e)if("data"in e)e.data&&(i=e.data,i.tags&&(i.tags instanceof Array?o=i.tags:o=Uc(i.tags)));else{if(!e.uuid||!e.path)throw new Ce("PARAMETER_VERIFICATION","missing footprint uuid or path data.");l=e.uuid,u=e.path,n=await vs.getFootprint({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Ho(n.tags,e.path,[4]))}if(!s){let h=await Hc.categoryAddtition.addActuator(o,[0],t,4);a=h.uuids,o=h.titles}return{footprintItemOriginUuid:l,footprintItemOriginPath:u,footprintItemIn:i,footprintItemOut:n,footprintTagIds:a,footprintTagTitles:o}}async function SE(e,t,s,r){let i=null,n=null,a=[],o=[],c=!1,l,u;if(e)if("data"in e)e.data&&(i=e.data,i.tags&&(i.tags instanceof Array?o=i.tags:o=Uc(i.tags)));else{if(!e.uuid||!e.path)throw new Ce("PARAMETER_VERIFICATION","missing symbol uuid or path data.");l=e.uuid,u=e.path,n=await vs.getSymbol({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Ho(n.tags,e.path,[2])),c=e.isProject}if(!s){let h=await Hc.categoryAddtition.addActuator(o,[0],t,2);a=h.uuids,o=h.titles}return{symbolItemOriginUuid:l,symbolItemOriginPath:u,symbolItemIn:i,symbolItemOut:n,symbolTagIds:a,symbolTagTitles:o}}async function N_(e,t,s,r){let i=null,n=null,a=[],o=[],c=!1;if(e)if("data"in e)e.data&&(i=e.data,i.tags&&(i.tags instanceof Array?o=i.tags:o=Uc(i.tags)));else{if(!e.uuid||!e.path)throw new Ce("PARAMETER_VERIFICATION","missing device uuid or path data.");n=await vs.getDevice({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Ho(n.tags,e.path,[3])),c=e.isProject}if(!s){let l=await Hc.categoryAddtition.addActuator(o,[0],t,3);a=l.uuids,o=l.titles}return{deviceItemIn:i,deviceItemOut:n,deviceTagIds:a,deviceTagTitles:o,isDeviceFromProject:c}}async function L_(e,t,s,r,i,n){let a=null,o=null,c=[],l=[],u,h;if(e){let{symbolItemIn:p,symbolItemOut:d,symbolTagIds:f,symbolTagTitles:m,symbolItemOriginUuid:g,symbolItemOriginPath:b}=await SE(e,s,r,"path"in e&&e.override&&Array.isArray(e.override.tags)?e.override.tags:void 0);a=p,o=d,c=f,l=m,u=g,h=b}else if(i)if(n){let p=await vs.getSymbol({isProject:t,uuid:i,path:n});if(u=i,h=n,p){p.title=p.display_title,o=p,l=await Ho(p.tags,n,[2]);let d=await Hc.categoryAddtition.addActuator(l,[0],s,2);c=d.uuids,l=d.titles}}else{let p=null;try{p=await vs.getSymbol({isProject:t,uuid:i,path:s}),u=i,h=s}catch(d){p=null,u=i,h=s,console.warn(d)}p||console.warn("[NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND]: the symbol bound to this device does not exist in the target library.")}return{symbolItemOriginUuid:u,symbolItemOriginPath:h,symbolItemIn:a,symbolItemOut:o,symbolTagIds:c,symbolTagTitles:l}}async function B_(e,t,s,r,i,n){let a=null,o=null,c=[],l=[],u,h;if(e){let{footprintItemIn:p,footprintItemOut:d,footprintTagIds:f,footprintTagTitles:m,footprintItemOriginUuid:g,footprintItemOriginPath:b}=await wE(e,s,r,"path"in e&&e.override&&Array.isArray(e.override.tags)?e.override.tags:void 0);a=p,o=d,c=f,l=m,u=g,h=b}else if(i)if(n){let p=await vs.getFootprint({isProject:t,uuid:i,path:n});if(u=i,h=n,p){p.title=p.display_title,o=p,l=await Ho(p.tags,n,[4]);let d=await Hc.categoryAddtition.addActuator(l,[0],s,4);c=d.uuids,l=d.titles}}else{let p=null;try{p=await vs.getFootprint({isProject:t,uuid:i,path:s}),u=i,h=s}catch(d){p=null,u=i,h=s,console.warn(d)}p||console.warn("[NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND]: the footprint bound to this device does not exist in the target library.")}return{footprintItemOriginUuid:u,footprintItemOriginPath:h,footprintItemIn:a,footprintItemOut:o,footprintTagIds:c,footprintTagTitles:l}}async function Gc(e=!1,t,s,r,i=[]){let n={isDuplicate:!1,path:r,uuids:[]},a=s.toLocaleLowerCase(),o=await vm(e,a,r,t,Je.loginedUserUuid);if(o.success&&o.result&&o.result.length){let c=[];for(let l=0;l<o.result.length;l++){if(i.indexOf(o.result[l].uuid)>=0)continue;let u=(o.result[l].title||o.result[l].display_title).toLocaleLowerCase();if(a===u&&o.result[l].path===r){if(typeof t>"u"||t===28){c.push(o.result[l]);continue}if(typeof o.result[l].docType>"u"){c.push(o.result[l]);continue}if(o.result[l].docType===t){c.push(o.result[l]);continue}}}for(let l=0;l<c.length;l++)n.uuids.push(c[l].uuid);n.isDuplicate=!!n.uuids.length}return n}async function k_(e,t,s,r,i,n){if(!r)return;let a=null;if("data"in r)i.title&&(a=await vs.createSymbol({isProject:e,path:t,symbol:{data:{...i,tags:n},ignoreDuplicateNameCheck:r.ignoreDuplicateNameCheck}})),s.attributes&&a&&typeof a=="object"&&(s.attributes.Symbol=a.uuid);else{r.override&&wi(i,r.override);try{a=await vs.getSymbol({isProject:e,path:t,uuid:r.uuid})}catch{a=null}if(a&&typeof a=="object")s.attributes&&(s.attributes.Symbol=a.uuid);else if(i.title&&(a=await vs.createSymbol({isProject:e,path:t,symbol:{data:{...i,tags:n},ignoreDuplicateNameCheck:r.ignoreDuplicateNameCheck}})),s.attributes&&a&&typeof a=="object"){s.attributes.Symbol=a.uuid;let o=await ua({origin:{docType:i.docType,isProject:r.isProject,uuid:r.uuid,path:r.path},target:{docType:a.docType,isProject:e,uuid:a.uuid,path:a.path}});if(!o.success)throw new Ce("CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",o.message||"migrate canvas error.")}}}async function M_(e,t,s,r,i,n){if(!r)return;let a=null;if("data"in r)i.title&&(a=await vs.createFootprint({isProject:e,path:t,footprint:{data:{...i,tags:n}}})),s.attributes&&a&&typeof a=="object"&&(s.attributes.Footprint=a.uuid);else{r.override&&wi(i,r.override);try{a=await vs.getFootprint({isProject:e,path:t,uuid:r.uuid})}catch{a=null}if(a&&typeof a=="object")s.attributes&&(s.attributes.Footprint=a.uuid);else if(i.title&&(a=await vs.createFootprint({isProject:e,path:t,footprint:{data:{...i,tags:n}}})),s.attributes&&a&&typeof a=="object"){s.attributes.Footprint=a.uuid;let o=await ua({origin:{docType:i.docType,isProject:r.isProject,uuid:r.uuid,path:r.path},target:{docType:a.docType,isProject:e,uuid:a.uuid,path:a.path}});if(!o.success)throw new Ce("CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",o.message||"migrate canvas error.")}}}async function JB(e){let{deviceItemIn:t,deviceItemOut:s,deviceTagIds:r,deviceTagTitles:i,isDeviceFromProject:n}=await N_(e.device,e.path,e.isProject,"path"in e.device&&e.device.override&&Array.isArray(e.device.override.tags)?e.device.override.tags:void 0),a=t||s;if(!a)throw new Ce("PARAMETER_VERIFICATION","missing device data.");if(a.title=e.device&&"path"in e.device&&e.device.override&&qm(e.device.override,"title")||a.title,g_(a.title),(await Gc(e.isProject,28,a.title,e.path)).isDuplicate)throw new Ce("DEVICE_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");let{symbolItemIn:o,symbolItemOut:c,symbolTagIds:l,symbolTagTitles:u,symbolItemOriginUuid:h,symbolItemOriginPath:p}=await L_(e.symbol,n,e.path,e.isProject,a.attributes?a.attributes.Symbol:void 0,"data"in e.device?void 0:e.device.path),d=o||c,f=!!(e.symbol&&"data"in e.symbol);a.attributes&&c&&typeof c=="object"&&(a.attributes.Symbol=c.uuid),e.symbol&&"path"in e.symbol&&e.symbol.override&&wi(d,e.symbol.override);let{footprintItemIn:m,footprintItemOut:g,footprintTagIds:b,footprintTagTitles:E,footprintItemOriginUuid:y,footprintItemOriginPath:T}=await B_(e.footprint,n,e.path,e.isProject,a.attributes?a.attributes.Footprint:void 0,"data"in e.device?void 0:e.device.path),w=m||g;e.footprint&&"path"in e.footprint&&e.footprint.override&&wi(w,e.footprint.override),a.attributes&&g&&typeof g=="object"&&(a.attributes.Footprint=g.uuid);let S=!1,_=!1,C=await R_({symbolItem:d,footprintItem:w,userIdSelected:e.path,isNeedCreateSymbolAndAssocia:f},void 0);if(C.isNeedConfirm){let I=(await Je.messageBus.rpcCall("OpenSameNameSaveAsDlgService",{...C},31536e8)).message;if(!I){let P="an exception occurred while executing the cross-bind program.";throw new Ce("CROSS_BIND",P)}if(I.action==="cancel"||I.action==="close"){let P="quit operate while executing the cross-bind program.";throw new Ce("CROSS_BIND_EXIT",P)}C.updateCache=I.data,a.attributes&&Object.keys(C.updateCache).length&&(C.updateCache.symbolItemId&&(S=!0),C.updateCache.footprintItemId&&(_=!0),v_(C.updateCache,a.attributes))}!S&&d&&await k_(e.isProject,e.path,a,e.symbol,d,u),!_&&w&&await M_(e.isProject,e.path,a,e.footprint,w,E),"path"in e.device&&e.device.override&&(delete e.device.override.tags,wi(a,e.device.override));let x=await dt("POST","/api/devices",{...a,tags:r,owner:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(x.code===0&&x.success){let I=x.result;return{path:I.path||e.path,title:I.title,description:I.description,attributes:I.attributes,images:I.images,uuid:I.uuid,version:I.version,ticket:I.ticket,updateTime:Ke(I.updateTime),createTime:Ke(I.createTime),display_title:I.display_title,creator:ds(I.creator),modifier:ps(I.modifier),owner:fs(I.owner),tags:I.tags,source:I.source,symbol_type:I.symbol_type}}let D=x.message||x.msg||"Request Error.";throw x.code===1000001?new Ce("CREATE_DEVICE_DUP_TITLE",D):x.code===422?new Ce("CREATE_DEVICE_PERMISSIONS",D):new Ce("CREATE_DEVICE",D)}async function KB(e){let{footprintItemIn:t,footprintItemOut:s,footprintTagIds:r,footprintTagTitles:i}=await wE(e.footprint,e.path,e.isProject,"path"in e.footprint&&e.footprint.override&&Array.isArray(e.footprint.override.tags)?e.footprint.override.tags:void 0),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing footprint data.");if(n.title="path"in e.footprint&&e.footprint.override&&qm(e.footprint.override,"title")||n.title,E_(n.title),(await Gc(e.isProject,4,n.title,e.path)).isDuplicate)throw new Ce("FOOTPRINT_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.footprint&&e.footprint.override&&(delete e.footprint.override.tags,wi(n,e.footprint.override));let a=await dt("POST","/api/v2/components/add",{title:n.title,tags:r,docType:n.docType||4,description:n.description,owner:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let c=a.result;if(!("data"in e.footprint)&&e.footprint.uuid&&e.footprint.path){let l=await ua({origin:{docType:n.docType,isProject:!!e.footprint.isProject,uuid:e.footprint.uuid,path:e.footprint.path},target:{docType:c.docType,isProject:!1,uuid:c.uuid,path:c.path}});if(!l.success)throw new Ce("CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",l.message||"migrate canvas error.")}return{title:c.title,description:c.description,path:c.path||e.path,docType:c.docType,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ce("CREATE_FOOTPRINT_DUP_TITLE",o):a.code===422?new Ce("CREATE_FOOTPRINT_PERMISSIONS",o):new Ce("CREATE_FOOTPRINT",o)}async function j_(e,t,s,r){let i=null,n=null,a=[],o=[],c=!1,l,u;if(e)if("data"in e)i=e.data,i.tags&&(i.tags instanceof Array?o=i.tags:o=Uc(i.tags));else{if(!e.uuid||!e.path)throw new Ce("PARAMETER_VERIFICATION","missing simModel uuid or path data.");l=e.uuid,u=e.path,n=await vs.getSimModel({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Ho(n.tags,e.path,[6]))}if(!s){let h=await Hc.categoryAddtition.addActuator(o,[0],t,6);a=h.uuids,o=h.titles}return{simModelItemOriginUuid:l,simModelItemOriginPath:u,simModelItemIn:i,simModelItemOut:n,simModelTagIds:a,simModelTagTitles:o}}async function XB(e){let{simModelItemIn:t,simModelItemOut:s,simModelTagIds:r,simModelTagTitles:i}=await j_(e.simModel,e.path,e.isProject,"path"in e.simModel&&e.simModel.override&&Array.isArray(e.simModel.override.tags)?e.simModel.override.tags:void 0),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing sim-model data.");if(n.title="path"in e.simModel&&e.simModel.override&&qm(e.simModel.override,"title")||n.title,b_(n.title),(await Gc(e.isProject,n.docType,n.title,e.path)).isDuplicate)throw new Ce("SIM_MODEL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.simModel&&e.simModel.override&&(delete e.simModel.override.tags,wi(n,e.simModel.override));let a=await dt("POST","/api/v2/components/add",{...n,tags:r,owner:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let c=a.result;return{title:c.title,path:c.path||e.path,docType:c.docType,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source,dataStr:await kn(c),key:c.key,iv:c.iv,dataStrId:c.dataStrId}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ce("CREATE_SIM_MODEL_DUP_TITLE",o):a.code===422?new Ce("CREATE_SIM_MODEL_PERMISSIONS",o):new Ce("CREATE_SIM_MODEL",o)}async function ZB(e){let{symbolItemIn:t,symbolItemOut:s,symbolTagIds:r,symbolTagTitles:i}=await SE(e.symbol,e.path,e.isProject,"path"in e.symbol&&e.symbol.override&&Array.isArray(e.symbol.override.tags)?e.symbol.override.tags:void 0),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing symbol data.");if(n.title="path"in e.symbol&&e.symbol.override&&qm(e.symbol.override,"title")||n.title,y_(n.title),(await Gc(e.isProject,n.docType,n.title,e.path)).isDuplicate)throw new Ce("SYMBOL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.symbol&&e.symbol.override&&(delete e.symbol.override.tags,wi(n,e.symbol.override));let a=await dt("POST","/api/v2/components/add",{title:n.title,tags:r,docType:n.docType,description:n.description,owner:e.path,ignoreDuplicateNameCheck:e.symbol.ignoreDuplicateNameCheck},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let c=a.result;if(!("data"in e.symbol)&&e.symbol.uuid&&e.symbol.path){let l=await ua({origin:{docType:n.docType,isProject:!!e.symbol.isProject,uuid:e.symbol.uuid,path:e.symbol.path},target:{docType:c.docType,isProject:!1,uuid:c.uuid,path:c.path}});if(!l.success)throw new Ce("CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",l.message||"migrate canvas error.")}return{title:c.title,description:c.description,docType:c.docType,path:c.path||e.path,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ce("CREATE_SYMBOL_DUP_TITLE",o):a.code===422?new Ce("CREATE_SYMBOL_PERMISSIONS",o):new Ce("CREATE_SYMBOL",o)}async function $B(e){let t=await dt("GET",`/api/v2/devices/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;if(typeof r.path<"u"&&r.path!==e.path)throw new Ce("GET_DEVICE_NOT_FOUND","data not found");return{path:r.path,title:r.title,description:r.description,attributes:r.attributes,images:r.images,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ke(r.updateTime),createTime:Ke(r.createTime),display_title:r.display_title,creator:ds(r.creator),modifier:ps(r.modifier),owner:fs(r.owner),tags:r.tags,source:r.source,symbol_type:r.symbol_type,isFavorite:r.isFavorite}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_DEVICE",s)}async function QB(e){let t=await dt("GET",`/api/v2/components/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;if(typeof r.path<"u"&&r.path!==e.path)throw new Ce("GET_FOOTPRINT_NOT_FOUND","data not found");return{title:r.title,description:r.description,path:r.path,docType:r.docType,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ke(r.updateTime),createTime:Ke(r.createTime),display_title:r.display_title,creator:ds(r.creator),modifier:ps(r.modifier),owner:fs(r.owner),tags:r.tags,source:r.source,has_device:r.has_device,history_uuid:r.history_uuid,key:r.key,iv:r.iv,dataStr:await kn(r),dataStrId:r.dataStrId}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_FOOTPRINT",s)}async function e8(e){let t=await dt("GET",`/api/v2/components/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;return{title:r.title,path:r.path,docType:r.docType,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ke(r.updateTime),createTime:Ke(r.createTime),display_title:r.display_title,creator:ds(r.creator),modifier:ps(r.modifier),owner:fs(r.owner),tags:r.tags,source:r.source,history_uuid:r.history_uuid,key:r.key,iv:r.iv,dataStr:await kn(r),dataStrId:r.dataStrId}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_SIM_MODEL",s)}function ha(e={}){let t={},s=Object.keys(e);for(let r=0;r<s.length;r++)s[r]===""||String(s[r])==="undefined"||typeof e[s[r]]>"u"||e[s[r]]==null||(t[s[r]]=e[s[r]]);return t}async function t8(e){let t=await dt("GET","/api/v2/components",{...ha(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:e.docType,tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,i=[];for(let n of r.lists)i.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ke(n.updateTime),createTime:Ke(n.createTime),display_title:n.display_title,creator:ds(n.creator),modifier:ps(n.modifier),owner:fs(n.owner),tags:n.tags,source:n.source,key:n.key,iv:n.iv,dataStr:await kn(r),dataStrId:r.dataStrId});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:i}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_SIM_MODEL_LIST",s)}async function s8(e){let t=await dt("GET",`/api/v2/components/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;if(typeof r.path<"u"&&r.path!==e.path)throw new Ce("GET_SYMBOL_NOT_FOUND","data not found");return{title:r.title,description:r.description,docType:r.docType,path:r.path,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ke(r.updateTime),createTime:Ke(r.createTime),display_title:r.display_title,creator:ds(r.creator),modifier:ps(r.modifier),owner:fs(r.owner),tags:r.tags,source:r.source,has_device:r.has_device,history_uuid:r.history_uuid,key:r.key,iv:r.iv,dataStr:await kn(r),dataStrId:r.dataStrId}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_SYMBOL",s)}async function r8(e){let{deviceItemIn:t,deviceItemOut:s,deviceTagIds:r,deviceTagTitles:i,isDeviceFromProject:n}=await N_(e.device,e.path,e.isProject,"path"in e.device&&e.device.override&&Array.isArray(e.device.override.tags)?e.device.override.tags:void 0),a=t||s;if(!a)throw new Ce("PARAMETER_VERIFICATION","missing device data.");g_(a.title);let{symbolItemIn:o,symbolItemOut:c,symbolTagIds:l,symbolTagTitles:u,symbolItemOriginUuid:h,symbolItemOriginPath:p}=await L_(e.symbol,n,e.path,e.isProject,a.attributes?a.attributes.Symbol:void 0,"data"in e.device?void 0:e.device.path),d=o||c,f=!!(e.symbol&&"data"in e.symbol);e.symbol&&"path"in e.symbol&&e.symbol.override&&wi(d,e.symbol.override),a.attributes&&c&&typeof c=="object"&&(a.attributes.Symbol=c.uuid);let{footprintItemIn:m,footprintItemOut:g,footprintTagIds:b,footprintTagTitles:E,footprintItemOriginUuid:y,footprintItemOriginPath:T}=await B_(e.footprint,n,e.path,e.isProject,a.attributes?a.attributes.Footprint:void 0,"data"in e.device?void 0:e.device.path),w=m||g;e.footprint&&"path"in e.footprint&&e.footprint.override&&wi(w,e.footprint.override),a.attributes&&g&&typeof g=="object"&&(a.attributes.Footprint=g.uuid);let S=!1,_=!1,C=await R_({symbolItem:d,footprintItem:w,userIdSelected:e.path,isNeedCreateSymbolAndAssocia:f},void 0);if(C.isNeedConfirm){let I=(await Je.messageBus.rpcCall("OpenSameNameSaveAsDlgService",{...C},31536e8)).message;if(!I){let P="an exception occurred while executing the cross-bind program.";throw new Ce("CROSS_BIND",P)}if(I.action==="cancel"||I.action==="close"){let P="quit operate while executing the cross-bind program.";throw new Ce("CROSS_BIND_EXIT",P)}C.updateCache=I.data,a.attributes&&Object.keys(C.updateCache).length&&(C.updateCache.symbolItemId&&(S=!0),C.updateCache.footprintItemId&&(_=!0),v_(C.updateCache,a.attributes))}!S&&d&&await k_(e.isProject,e.path,a,e.symbol,d,u),!_&&w&&await M_(e.isProject,e.path,a,e.footprint,w,E),"path"in e.device&&e.device.override&&(delete e.device.override.tags,wi(a,e.device.override));let x=await dt("POST",`/api/v2/devices/${e.uuid}`,JSON.stringify({...a,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(x.code===0&&x.success&&x.result){let I=x.result;return{path:I.path||e.path,title:I.title,description:I.description,attributes:I.attributes,images:I.images,uuid:I.uuid,version:I.version,ticket:I.ticket,updateTime:Ke(I.updateTime),createTime:Ke(I.createTime),display_title:I.display_title,creator:ds(I.creator),modifier:ps(I.modifier),owner:fs(I.owner),tags:I.tags,source:I.source,symbol_type:I.symbol_type}}let D=x.message||x.msg||"Request Error.";throw x.code===422?new Ce("CREATE_DEVICE_PERMISSIONS",D):new Ce("UPDATE_DEVICE",D)}async function i8(e){let{footprintItemIn:t,footprintItemOut:s,footprintTagIds:r,footprintTagTitles:i}=await wE(e.footprint,e.path,e.isProject,"path"in e.footprint&&e.footprint.override&&Array.isArray(e.footprint.override.tags)?e.footprint.override.tags:void 0),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing footprint data.");if(E_(n.title),(await Gc(e.isProject,4,n.title,e.path,[e.uuid])).isDuplicate)throw new Ce("FOOTPRINT_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.footprint&&e.footprint.override&&(delete e.footprint.override.tags,wi(n,e.footprint.override));let a=await dt("POST",`/api/v2/components/${e.uuid}/update`,JSON.stringify({title:n.title,tags:r,docType:n.docType||4,description:n.description,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success&&typeof a.result=="object"){let c=a.result;if(!("data"in e.footprint)&&e.footprint.uuid&&e.footprint.path){let l=await ua({origin:{docType:n.docType,isProject:!!e.footprint.isProject,uuid:e.footprint.uuid,path:e.footprint.path},target:{docType:c.docType,isProject:!1,uuid:c.uuid,path:c.path}});if(!l.success)throw new Ce("UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",l.message||"migrate canvas error.")}return{title:c.title,description:c.description,path:c.path,docType:c.docType,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Ce("UPDATE_FOOTPRINT_PERMISSIONS",o):new Ce("UPDATE_FOOTPRINT",o)}async function n8(e){let{simModelItemIn:t,simModelItemOut:s,simModelTagIds:r,simModelTagTitles:i}=await j_(e.simModel,e.path,e.isProject,"path"in e.simModel&&e.simModel.override&&Array.isArray(e.simModel.override.tags)?e.simModel.override.tags:void 0),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing simModel data.");b_(n.title),"path"in e.simModel&&e.simModel.override&&(delete e.simModel.override.tags,wi(n,e.simModel.override));let a=await dt("POST",`/api/v2/components/${e.uuid}/update`,JSON.stringify({...n,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!a.success){let c=a.message||a.msg||"Request Error.";throw new Ce("UPDATE_SIM_MODEL",c)}if(n.dataStr){let c=await dt("POST",`/api/v2/components/${e.uuid}/update_canvas`,JSON.stringify({...n,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!c.success){let l=c.message||c.msg||"Request Error.";throw new Ce("UPDATE_SIM_MODEL",l)}}if(a.code===0&&a.success&&typeof a.result=="object"){let c=a.result;return{title:c.title,path:c.path,docType:c.docType,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source,dataStr:await kn(c),key:c.key,iv:c.iv,dataStrId:c.dataStrId}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Ce("UPDATE_SIM_MODEL_PERMISSIONS",o):new Ce("UPDATE_SYMBOL",o)}async function a8(e){let{symbolItemIn:t,symbolItemOut:s,symbolTagIds:r,symbolTagTitles:i}=await SE(e.symbol,e.path,e.isProject,"path"in e.symbol&&e.symbol.override&&Array.isArray(e.symbol.override.tags)?e.symbol.override.tags:void 0),n=t||s;if(!n)throw new Ce("PARAMETER_VERIFICATION","missing symbol data.");if(y_(n.title),(await Gc(e.isProject,n.docType,n.title,e.path,[e.uuid])).isDuplicate)throw new Ce("SYMBOL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.symbol&&e.symbol.override&&(delete e.symbol.override.tags,wi(n,e.symbol.override));let a=await dt("POST",`/api/v2/components/${e.uuid}/update`,JSON.stringify({title:n.title,tags:r,docType:n.docType,description:n.description,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success&&typeof a.result=="object"){let c=a.result;if(!("data"in e.symbol)&&e.symbol.uuid&&e.symbol.path){let l=await ua({origin:{docType:n.docType,isProject:!!e.symbol.isProject,uuid:e.symbol.uuid,path:e.symbol.path},target:{docType:c.docType,isProject:!1,uuid:c.uuid,path:c.path}});if(!l.success)throw new Ce("UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR",l.message||"migrate canvas error.")}return{title:c.title,description:c.description,docType:c.docType,path:c.path,uuid:c.uuid,version:c.version,ticket:c.ticket,updateTime:Ke(c.updateTime),createTime:Ke(c.createTime),display_title:c.display_title,creator:ds(c.creator),modifier:ps(c.modifier),owner:fs(c.owner),tags:c.tags,source:c.source}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Ce("UPDATE_SYMBOL_PERMISSIONS",o):new Ce("UPDATE_SYMBOL",o)}async function o8(e){let t=await dt("GET","/api/v2/components",{...e.query||{},path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:[16],tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,i=[];for(let n of r.lists)i.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ke(n.updateTime),createTime:Ke(n.createTime),display_title:n.display_title,creator:ds(n.creator),modifier:ps(n.modifier),owner:fs(n.owner),tags:n.tags,source:n.source,description:n.description,dataStr:await kn(r),dataStrId:r.dataStrId});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:i}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_D3MODEL_LIST",s)}async function c8(e){let t=await dt("GET","/api/v2/components",{...ha(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:[4],tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,i=[];for(let n of r.lists)i.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ke(n.updateTime),createTime:Ke(n.createTime),display_title:n.display_title,creator:ds(n.creator),modifier:ps(n.modifier),owner:fs(n.owner),tags:n.tags,source:n.source,description:n.description});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:i}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_FOOTPRINT_LIST",s)}async function l8(e){let t=await dt("GET","/api/v2/components",{...ha(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:e.docType,tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,i=[];for(let n of r.lists)i.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ke(n.updateTime),createTime:Ke(n.createTime),display_title:n.display_title,creator:ds(n.creator),modifier:ps(n.modifier),owner:fs(n.owner),tags:n.tags,source:n.source,description:n.description});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:i}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_SYMBOL_LIST",s)}function u8(e){return Array.isArray(e)?e:e?[e]:[]}async function h8(e){let t=await dt("GET","/api/v2/devices",{...ha(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,i=[];for(let n of r.lists){let a={title:n.title,path:n.path||e.path,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ke(n.updateTime),createTime:Ke(n.createTime),display_title:n.display_title,creator:ds(n.creator),modifier:ps(n.modifier),owner:fs(n.owner),tags:n.tags,source:n.source,description:n.description,images:u8(n.images),attributes:n.attributes,symbol_type:n.symbol_type,isFavorite:n.isFavorite};e.withPackage&&n.symbol&&(a.symbol=Object.assign(n.symbol,{updateTime:Ke(n.symbol.updateTime)}),a.symbol_info=n.symbol_info),e.withPackage&&n.footprint&&(a.footprint=Object.assign(n.footprint,{updateTime:Ke(n.footprint.updateTime)}),a.footprint_info=n.footprint_info),i.push(a)}return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:i}}let s=t.message||t.msg||"Request Error.";throw new Ce("GET_DEVICE_LIST",s)}async function d8(e,t=!1,s=!1){if(e.titles){let{path:p,titles:d}=e,f=await dt("POST","/api/v2/devices/searchByUserUuidAndTitle",{type:"device",titles:d,user_uuids:[p],path:p},{headers:{"Content-type":"application/json","content-type":"application/json",path:p}});if(f.code===0&&f.success&&f.result){let g={};for(let b in f.result){g[b]=[];let E=f.result[b];for(let y of E){let T=fs(y.owner),w={title:y.title,path:y.path||p,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:Ke(y.updateTime),createTime:Ke(y.createTime),display_title:y.display_title,creator:t?{}:ds(y.creator),modifier:s?{}:ps(y.modifier),owner:T,tags:y.tags,source:y.source,description:y.description,images:y.images,attributes:y.attributes,symbol_type:y.symbol_type,isFavorite:y.isFavorite};e.withPackage&&y.symbol&&(w.symbol=Object.assign(y.symbol,{updateTime:Ke(y.symbol.updateTime)})),e.withPackage&&y.footprint&&(w.footprint=Object.assign(y.footprint,{updateTime:Ke(y.footprint.updateTime)})),g[b].push(w)}}return g}let m=f.message||f.msg||"Request Error.";throw new Ce("GET_DEVICE_SEARCH_LIST",m)}let{path:r,query:i={},uid:n,page:a,pageSize:o,tags:c=[],wd:l}=e,u=await dt("POST","/api/devices/search",{...ha(i),path:r,uid:n,page:a,pageSize:o,tag:c,wd:l},{headers:{path:r},searchParams:!0});if(u.code===0&&u.success&&typeof u.result=="object"){let p=u.result,d=[],f=Object.keys(p.lists);for(let m=0;m<f.length;m++){let g=p.lists[f[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let E=g[b],y={title:E.title,path:E.path||r,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:Ke(E.updateTime),createTime:Ke(E.createTime),display_title:E.display_title,creator:t?{}:ds(E.creator),modifier:s?{}:ps(E.modifier),owner:fs(E.owner),tags:E.tags,source:E.source,description:E.description,images:E.images,attributes:E.attributes,symbol_type:E.symbol_type,isFavorite:E.isFavorite};e.withPackage&&E.symbol&&(y.symbol=Object.assign(E.symbol,{updateTime:E.symbol.updateTime}),y.symbol_info=E.symbol_info),e.withPackage&&E.footprint&&(y.footprint=Object.assign(E.footprint,{updateTime:E.footprint.updateTime}),y.footprint_info=E.footprint_info),d.push(y)}}return{count:p.count,page:p.page,pageSize:p.pageSize,totalPage:p.totalPage,lists:d,facets:p.facets}}let h=u.message||u.msg||"Request Error.";throw new Ce("GET_DEVICE_SEARCH_LIST",h)}async function p8(e,t=!1,s=!1){if(e.titles){let{path:d,titles:f,docType:m}=e,g=await dt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:m,titles:f,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(g.code===0&&g.success&&g.result){let E={};for(let y in g.result){E[y]=[];let T=g.result[y];for(let w of T){let S=fs(w.owner),_={title:w.title,path:w.path||d,docType:w.docType,uuid:w.uuid,version:w.version,ticket:w.ticket,updateTime:Ke(w.updateTime),createTime:Ke(w.createTime),display_title:w.display_title,creator:t?{}:ds(w.creator),modifier:s?{}:ps(w.modifier),owner:S,tags:w.tags,source:w.source,description:w.description};E[y].push(_)}}return E}let b=g.message||g.msg||"Request Error.";throw new Ce("GET_SYMBOL_SEARCH_LIST",b)}let{path:r,query:i,uid:n,page:a,pageSize:o,tags:c=[],wd:l,docType:u}=e,h=await dt("POST","/api/v2/components/search",{...ha(i||{}),path:r,uid:n,page:a,pageSize:o,docType:u,tag:c,wd:l},{headers:{path:r},searchParams:!0});if(h.code===0&&h.success&&typeof h.result=="object"){let d=h.result,f=[],m=Object.keys(d.lists);for(let g=0;g<m.length;g++){let b=d.lists[m[g]];if(Array.isArray(b)&&b.length)for(let E=0;E<b.length;E++){let y=b[E];f.push({title:y.title,path:y.path||r,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:Ke(y.updateTime),createTime:Ke(y.createTime),display_title:y.display_title,creator:t?{}:ds(y.creator),modifier:s?{}:ps(y.modifier),owner:fs(y.owner),tags:y.tags,source:y.source,description:y.description})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:f,facets:d.facets}}let p=h.message||h.msg||"Request Error.";throw new Ce("GET_SYMBOL_SEARCH_LIST",p)}async function f8(e,t=!1,s=!1){if(e.titles){let{path:p,titles:d}=e,f=await dt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:4,titles:d,user_uuids:[p],path:p},{headers:{"Content-type":"application/json","content-type":"application/json",path:p}});if(f.code===0&&f.success&&f.result){let g={};for(let b in f.result){g[b]=[];let E=f.result[b];for(let y of E){let T=fs(y.owner),w={title:y.title,path:y.path||p,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:Ke(y.updateTime),createTime:Ke(y.createTime),display_title:y.display_title,creator:t?{}:ds(y.creator),modifier:s?{}:ps(y.modifier),owner:T,tags:y.tags,source:y.source,description:y.description};g[b].push(w)}}return g}let m=f.message||f.msg||"Request Error.";throw new Ce("GET_FOOTPRINT_SEARCH_LIST",m)}let{path:r,query:i={},uid:n,page:a,pageSize:o,tags:c=[],wd:l}=e,u=await dt("POST","/api/v2/components/search",{...ha(i),path:r,uid:n,page:a,pageSize:o,docType:[4],tag:c,wd:l},{headers:{path:r},searchParams:!0});if(u.code===0&&u.success&&typeof u.result=="object"){let p=u.result,d=[],f=Object.keys(p.lists);for(let m=0;m<f.length;m++){let g=p.lists[f[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let E=g[b];d.push({title:E.title,path:E.path||r,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:Ke(E.updateTime),createTime:Ke(E.createTime),display_title:E.display_title,creator:t?{}:ds(E.creator),modifier:s?{}:ps(E.modifier),owner:fs(E.owner),tags:E.tags,source:E.source,description:E.description})}}return{count:p.count,page:p.page,pageSize:p.pageSize,totalPage:p.totalPage,lists:d,facets:p.facets}}let h=u.message||u.msg||"Request Error.";throw new Ce("GET_FOOTPRINT_SEARCH_LIST",h)}async function m8(e,t=!1,s=!1){if(e.titles){let{path:d,docType:f,titles:m}=e,g=await dt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:f,titles:m,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(g.code===0&&g.success&&g.result){let E={};for(let y in g.result){E[y]=[];let T=g.result[y];for(let w of T){let S=fs(w.owner),_={title:w.title,path:w.path||d,docType:w.docType,uuid:w.uuid,version:w.version,ticket:w.ticket,updateTime:Ke(w.updateTime),createTime:Ke(w.createTime),display_title:w.display_title,creator:t?{}:ds(w.creator),modifier:s?{}:ps(w.modifier),owner:S,tags:w.tags,source:w.source,key:w.key,iv:w.iv,dataStr:void 0,dataStrId:w.dataStrId};T.push(_)}}return E}let b=g.message||g.msg||"Request Error.";throw new Ce("GET_SIM_MODEL_SEARCH_LIST",b)}let{path:r,query:i={},uid:n,page:a,pageSize:o,docType:c,tags:l=[],wd:u}=e,h=await dt("POST","/api/v2/components/search",{...ha(i),path:r,uid:n,page:a,pageSize:o,docType:c,tag:l,wd:u},{headers:{path:r},searchParams:!0});if(h.code===0&&h.success&&typeof h.result=="object"){let d=h.result,f=[],m=Object.keys(d.lists);for(let g=0;g<m.length;g++){let b=d.lists[m[g]];if(Array.isArray(b)&&b.length)for(let E=0;E<b.length;E++){let y=b[E];f.push({title:y.title,path:y.path||r,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:Ke(y.updateTime),createTime:Ke(y.createTime),display_title:y.display_title,creator:t?{}:ds(y.creator),modifier:s?{}:ps(y.modifier),owner:fs(y.owner),tags:y.tags,source:y.source,key:y.key,iv:y.iv,dataStr:await kn(d),dataStrId:d.dataStrId})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:f,facets:d.facets}}let p=h.message||h.msg||"Request Error.";throw new Ce("GET_SIM_MODEL_SEARCH_LIST",p)}async function g8(e){if(e.attributes.Symbol){let n=await vs.getSymbol({isProject:e.isProject,uuid:e.attributes.Symbol,path:e.path})}if(e.attributes.Footprint){let n=await vs.getFootprint({isProject:e.isProject,uuid:e.attributes.Footprint,path:e.path})}let t=await vs.getDevice({isProject:e.isProject,uuid:e.uuid,path:e.path}),s=Object.keys(e.attributes||{});for(let n=0;n<s.length;n++)t.attributes[s[n]]=e.attributes[s[n]];let r=await dt("POST",`/api/v2/devices/${e.uuid}`,JSON.stringify({...t,title:t.display_title||t.title,tags:t.tags?f_(t.tags):[],owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(r.code===0&&r.success&&r.result){let n=r.result;return{path:n.path||e.path,title:n.title,description:n.description,attributes:n.attributes,images:n.images,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ke(n.updateTime),createTime:Ke(n.createTime),display_title:n.display_title,creator:ds(n.creator),modifier:ps(n.modifier),owner:fs(n.owner),tags:n.tags,source:n.source,symbol_type:n.symbol_type}}let i=r.message||r.msg||"Request Error.";throw r.code===422?new Ce("CREATE_DEVICE_PERMISSIONS",i):new Ce("UPDATE_DEVICE_ATTRIBUTES",i)}async function y8(e,t=!1,s=!1){if(e.titles){let{path:p,titles:d}=e;if(K1){let f=await dt("POST","/api/client/model/find",{titles:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:p}});if(f.code===0&&f.success&&f.result){let g={};for(let b in f.result){g[b]=[];let E=f.result[b];for(let y of E){let T={fileName:y.fileName,path:y.path,lib:y.lib};g[b].push(T)}}return g}let m=f.message||f.msg||"Request Error.";throw new Ce("GET_D3MODEL_SEARCH_LIST",m)}else{let f=await dt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:16,titles:d,user_uuids:[p],path:p},{headers:{"Content-type":"application/json","content-type":"application/json",path:p}});if(f.code===0&&f.success&&f.result){let g={};for(let b in f.result){g[b]=[];let E=f.result[b];for(let y of E){let T=fs(y.owner),w={title:y.title,path:y.path||p,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:Ke(y.updateTime),createTime:Ke(y.createTime),display_title:y.display_title,creator:t?{}:ds(y.creator),modifier:s?{}:ps(y.modifier),owner:T,tags:y.tags,source:y.source,description:y.description,dataStr:y.dataStr};g[b].push(w)}}return g}let m=f.message||f.msg||"Request Error.";throw new Ce("GET_D3MODEL_SEARCH_LIST",m)}}let{path:r,query:i={},uid:n,page:a,pageSize:o,tags:c=[],wd:l}=e,u=await dt("POST","/api/v2/components/search",{...ha(i),path:r,uid:n,page:a,pageSize:o,docType:[16],tag:c,wd:l},{headers:{path:r},searchParams:!0});if(u.code===0&&u.success&&typeof u.result=="object"){let p=u.result,d=[],f=Object.keys(p.lists);for(let m=0;m<f.length;m++){let g=p.lists[f[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let E=g[b];d.push({title:E.title,path:E.path||r,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:Ke(E.updateTime),createTime:Ke(E.createTime),display_title:E.display_title,creator:t?{}:ds(E.creator),modifier:s?{}:ps(E.modifier),owner:fs(E.owner),tags:E.tags,source:E.source,description:E.description,dataStr:E.dataStr})}}return{count:p.count,page:p.page,pageSize:p.pageSize,totalPage:p.totalPage,lists:d,facets:p.facets}}let h=u.message||u.msg||"Request Error.";throw new Ce("GET_D3MODEL_SEARCH_LIST",h)}async function E8(e,t=!1,s=!1){if(e.titles){let{path:p,titles:d}=e,f=await dt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:29,titles:d,user_uuids:[p],path:p},{headers:{"Content-type":"application/json","content-type":"application/json",path:p}});if(f.code===0&&f.success&&f.result){let g={};for(let b in f.result){g[b]=[];let E=f.result[b];for(let y of E){let T=fs(y.owner),w={title:y.title,path:y.path||p,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:Ke(y.updateTime),createTime:Ke(y.createTime),display_title:y.display_title,creator:t?{}:ds(y.creator),modifier:s?{}:ps(y.modifier),owner:T,tags:y.tags,source:y.source,description:y.description};g[b].push(w)}}return g}let m=f.message||f.msg||"Request Error.";throw new Ce("GET_PANEL_LIB_SEARCH_LIST",m)}let{path:r,query:i={},uid:n,page:a,pageSize:o,tags:c=[],wd:l}=e,u=await dt("POST","/api/v2/components/search",{...ha(i),path:r,uid:n,page:a,pageSize:o,docType:[29],tag:c,wd:l},{headers:{path:r},searchParams:!0});if(u.code===0&&u.success&&typeof u.result=="object"){let p=u.result,d=[],f=Object.keys(p.lists);for(let m=0;m<f.length;m++){let g=p.lists[f[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let E=g[b];d.push({title:E.title,path:E.path||r,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:Ke(E.updateTime),createTime:Ke(E.createTime),display_title:E.display_title,creator:t?{}:ds(E.creator),modifier:s?{}:ps(E.modifier),owner:fs(E.owner),tags:E.tags,source:E.source,description:E.description})}}return{count:p.count,page:p.page,pageSize:p.pageSize,totalPage:p.totalPage,lists:d,facets:p.facets}}let h=u.message||u.msg||"Request Error.";throw new Ce("GET_PANEL_LIB_SEARCH_LIST",h)}var b8=class extends EE{async getDevice(e){return await $B(e)}async getSymbol(e){return await s8(e)}async getFootprint(e){return await QB(e)}async getD3Model(e){return await fd(e.uuid,e.path)}async getSimModel(e){return await e8(e)}async getDeviceList(e){return await h8(e)}async getSymbolList(e){return await l8(e)}async getFootprintList(e){return await c8(e)}async getD3ModelList(e){return await o8(e)}async getSimModelList(e){return t8(e)}async getDeviceSearchList(e){return await d8(e,!0,!0)}async getSymbolSearchList(e){return await p8(e,!0,!0)}async getFootprintSearchList(e){return await f8(e,!0,!0)}async getPanelLibSearchList(e){return await E8(e,!0,!0)}async getD3ModelSearchList(e){return await y8(e,!0,!0)}async getSimModelSearchList(e){return m8(e,!0,!0)}async createDevice(e){return await JB(e)}async createSymbol(e){return await ZB(e)}async createFootprint(e){return await KB(e)}async createD3Model(e){return await WB(e)}async createSimModel(e){return await XB(e)}async updateDevice(e){return await r8(e)}async updateDeviceAttributes(e){return await g8(e)}async updateSymbol(e){return await a8(e)}async updateFootprint(e){return await i8(e)}async updatesimModel(e){return await n8(e)}async deleteDevice(e){let t=await dt("POST",`/api/v4/devices/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let s=t.message||t.msg||"Request Error.";throw new Ce("DELETE_DEVICE",s)}}async deleteSymbol(e){let t=await dt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let s=t.message||t.msg||"Request Error.";throw new Ce("DELETE_SYMBOL",s)}}async deleteFootprint(e){let t=await dt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let s=t.message||t.msg||"Request Error.";throw new Ce("DELETE_FOOTPRINT",s)}}async deleteSimModel(e){let t=await dt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let s=t.message||t.msg||"Request Error.";throw new Ce("DELETE_SIM_MODEL",s)}}async delete3DModel(e){let t=await dt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let s=t.message||t.msg||"Request Error.";throw new Ce("DELETE_3DMODEL",s)}}},Ja=class{static diffVersionDevice(e){Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["Devices have not been added to the project library, project library has devices with different versions from the same source :",e.join("\u3001")]})}static diffVersionSymbol(e){Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["Symbols have not been added to the project library, project library has symbols with different versions from the same source :",e.join("\u3001")]})}static diffVersionFootprint(e){Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["Footprints have not been added to the project library, project library has footprints with different versions from the same source :",e.join("\u3001")]})}static sameVersionDevice(e){Je.messageBus.publish("logI18nLogView",{type:"info",msg:["Devices have not been added to the project library, project library has devices with same versions from the same source :",e.join("\u3001")]})}static sameVersionSymbol(e){Je.messageBus.publish("logI18nLogView",{type:"info",msg:["Symbols have not been added to the project library, project library has symbols with same versions from the same source :",e.join("\u3001")]})}static sameVersionFootprint(e){Je.messageBus.publish("logI18nLogView",{type:"info",msg:["Footprints have not been added to the project library, project library has footprints with same versions from the same source :",e.join("\u3001")]})}static renamedDevice(e){Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["Devices are automatically renamed when they are added to the project library :",e.join("\u3001")]})}static renamedSymbol(e){Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["Symbols are automatically renamed when they are added to the project library :",e.join("\u3001")]})}static renamedFootprint(e){Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["Footprints are automatically renamed when they are added to the project library :",e.join("\u3001")]})}},T8=class{constructor(e){let{renameKey:t=!0}=e;this.renameKey=t}async rename(e,...t){let{message:s}=await Je.messageBus.rpcCall("allowDuplicateNames");return this.renameKey||!s?this.renaming(e,...t):s?{success:!0}:this.isRename(e,...t)}},_E=class extends T8{constructor(e){let{matchKey:t=!0,byUUID:s=!1,byVersion:r=!1,bySource:i=!1}=e;super(e),this.matchKey=t,this.byUUID=s,this.byVersion=r,this.bySource=i}async match(e){if(this.matchKey)return this.matching(e)}},AE=class extends _E{constructor(e){let{path:t,data:s}=e;super(e),this.origin={},this.path=t,this.data=s}async onAdd(e){let t=JSON.parse(JSON.stringify(e));return t.path||(t.path=this.path),await Ln({data:t}),Va(t),t.project_uuid=t.path=this.path,t}async onUpdate(e){let t=JSON.parse(JSON.stringify(e));return Va(t),t}async getTemplate(e,t={}){let{uuid:s,path:r,updateTime:i}=e,n=`${s}${fu}${r}`,a=i==null?void 0:i.toString(),o=Object.assign(e,{path:r,source:n,version:a},t);return Va(o),o}},F_=class extends AE{async getOrigin(){var r,i;let{path:e,uuid:t,isProject:s}=this.data;if(mu(this.data)){let{override:n}=this.data;if(n&&n.attributes)return{success:!1,message:"Api call error!"};if(s){let{message:a}=await Je.messageBus.rpcCall("/pro-mgr/hasProject",[e]);if(a){let o=[t,e],c=(await Je.messageBus.rpcCall(re.DEVICE.GET,o)).message;if(c){let l=Object.assign(c,{uuid:t,path:e});this.origin=await this.getTemplate(l,n)}else return{success:!1,message:"Device details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(er.getInstance().hasLib(e)){let a=await((i=(r=er.getInstance().getLib(e))==null?void 0:r.device)==null?void 0:i.getTransformedDetail(t));if(a){let o=Object.assign(a,{uuid:t,path:e});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Device details data does not exist"}}else{let a={path:e,uuid:t},{message:o}=await Je.messageBus.rpcCall(Me.DEVICE.GET,a);if(o.success){let c=o.result,l=Object.assign(c,{uuid:t,path:e});this.origin=await this.getTemplate(l,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(e){let t=e.display_title||e.title,s=[t,this.path],r=(await Je.messageBus.rpcCall(re.DEVICE.TRY_RENAME,s)).message;return r&&(e.display_title=e.title=r),t!==r&&Ja.renamedDevice([t]),{success:!0}}},w8=class extends F_{onHandle(e){return this.onAdd(e)}async matching(e){if(this.byUUID){let t=[e.uuid,this.path],s=await(await Je.messageBus.rpcCall(re.DEVICE.GET,t)).message;if(e.ticket&&(s!=null&&s.ticket)&&(s==null?void 0:s.ticket)===e.ticket)return s}if(e.source){if(this.byVersion){let t=[e.source,e.version,this.path],s=(await Je.messageBus.rpcCall(re.DEVICE.GET_BY_SOURCE_VERSION,t)).message;if(s)return Ja.sameVersionDevice([e.display_title||e.title]),s}if(this.bySource){let t=[e.source,this.path],s=(await Je.messageBus.rpcCall(re.DEVICE.GET_LAST,t)).message;if(s)return Ja.diffVersionDevice([e.display_title||e.title]),s}}}async isRename(e){let t=[e.display_title||e.title,this.path];return(await Je.messageBus.rpcCall(re.DEVICE.IS_RENAME,t)).message?{success:!1,message:"Device duplicate name"}:{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};let t,s;if(this.origin){let r=await this.match(this.origin);if(r)t={success:!0,result:r};else{let i=await this.rename(this.origin);if(!i.success)return{success:!1,code:i.code,message:i.message};s=this.origin}}return{success:!0,result:{respond:t,addData:s}}}},U_=class extends AE{async getOrigin(){var r,i;let{path:e,uuid:t,isProject:s}=this.data;if(mu(this.data)){let{override:n}=this.data;if(s){let{message:a}=await Je.messageBus.rpcCall("/pro-mgr/hasProject",[e]);if(a){let o=[t,e],c=(await Je.messageBus.rpcCall(re.FOOTPRINT.GET,o)).message;if(c){let l=Object.assign(c,{uuid:t,path:e});this.origin=await this.getTemplate(l,n)}else return{success:!1,message:"Footprint details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(er.getInstance().hasLib(e)){let a=await((i=(r=er.getInstance().getLib(e))==null?void 0:r.footprint)==null?void 0:i.getTransformedDetail(t));if(a){let o=Object.assign(a,{uuid:t,path:e});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Footprint details data does not exist"}}else{let a={path:e,uuid:t},{message:o}=await Je.messageBus.rpcCall(Me.COMPONENT.GET,a);if(o.success){let c=o.result,l=Object.assign(c,{uuid:t,path:e});this.origin=await this.getTemplate(l,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(e){let t=e.display_title||e.title,s=[t,this.path],r=(await Je.messageBus.rpcCall(re.FOOTPRINT.TRY_RENAME,s)).message;return r&&(e.display_title=e.title=r),t!==r&&Ja.renamedFootprint([t]),{success:!0}}},CE=class extends U_{onHandle(e){return this.onAdd(e)}async matching(e){if(this.byUUID){let t=[e.uuid,this.path],s=(await Je.messageBus.rpcCall(re.FOOTPRINT.GET,t)).message;if(e.ticket&&(s!=null&&s.ticket)&&(s==null?void 0:s.ticket)===e.ticket)return s}if(e.source){if(this.byVersion){let t=[e.source,e.version,this.path],s=(await Je.messageBus.rpcCall(re.FOOTPRINT.GET_BY_SOURCE_VERSION,t)).message;if(s)return Ja.sameVersionFootprint([e.display_title||e.title]),s}if(this.bySource){let t=[e.source,this.path],s=(await Je.messageBus.rpcCall(re.FOOTPRINT.GET_LAST,t)).message;if(s)return Ja.diffVersionFootprint([e.display_title||e.title]),s}}}async isRename(e){let t=[e.display_title||e.title,this.path];return(await Je.messageBus.rpcCall(re.FOOTPRINT.IS_RENAME,t)).message?{success:!1,message:"Library duplicate name"}:{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};let t,s;if(this.origin){let r=await this.match(this.origin);if(r)t={success:!0,result:r};else{let i=await this.rename(this.origin);if(!i.success)return{success:!1,code:i.code,message:i.message};s=this.origin}}return{success:!0,result:{respond:t,addData:s}}}},H_=class extends AE{async getOrigin(){var r,i;let{path:e,uuid:t,isProject:s}=this.data;if(mu(this.data)){let{override:n}=this.data;if(s){let{message:a}=await Je.messageBus.rpcCall("/pro-mgr/hasProject",[e]);if(a){let o=[t,e],c=(await Je.messageBus.rpcCall(re.SYMBOL.GET,o)).message;if(c){let l=Object.assign(c,{uuid:t,path:e});this.origin=await this.getTemplate(l,n)}else return{success:!1,message:"Symbol details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(er.getInstance().hasLib(e)){let a=await((i=(r=er.getInstance().getLib(e))==null?void 0:r.symbol)==null?void 0:i.getTransformedDetail(t));if(a){let o=Object.assign(a,{uuid:t,path:e});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Symbol details data does not exist"}}else{let a={path:e,uuid:t},{message:o}=await Je.messageBus.rpcCall(Me.COMPONENT.GET,a);if(o.success){let c=o.result,l=Object.assign(c,{uuid:t,path:e});this.origin=await this.getTemplate(l,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(e){let t=e.display_title||e.title,s=[t,this.path],r=(await Je.messageBus.rpcCall(re.SYMBOL.TRY_RENAME,s)).message;return r&&(e.display_title=e.title=r),t!==r&&Ja.renamedSymbol([t]),{success:!0}}},DE=class extends H_{onHandle(e){return this.onAdd(e)}async matching(e){if(this.byUUID){let t=[e.uuid,this.path],s=(await Je.messageBus.rpcCall(re.SYMBOL.GET,t)).message;if(e.ticket&&(s!=null&&s.ticket)&&(s==null?void 0:s.ticket)===e.ticket)return s}if(e.source){if(this.byVersion){let t=[e.source,e.version,this.path],s=(await Je.messageBus.rpcCall(re.SYMBOL.GET_BY_SOURCE_VERSION,t)).message;if(s)return Ja.sameVersionSymbol([e.display_title||e.title]),s}if(this.bySource){let t=[e.source,this.path],s=(await Je.messageBus.rpcCall(re.SYMBOL.GET_LAST,t)).message;if(s)return Ja.diffVersionSymbol([e.display_title||e.title]),s}}}async isRename(e){let t=[e.display_title||e.title,this.path];return(await Je.messageBus.rpcCall(re.SYMBOL.IS_RENAME,t)).message?{success:!1,message:"Library duplicate name"}:{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};let t,s;if(this.origin){let r=await this.match(this.origin);if(r)t={success:!0,result:r};else{let i=await this.rename(this.origin);if(!i.success)return{success:!1,code:i.code,message:i.message};s=this.origin}}return{success:!0,result:{respond:t,addData:s}}}},PE=class{constructor(e){this.path=e}async check(){let{message:{hasPermission:e,errMsg:t}}=await Je.messageBus.rpcCall("canAddLib",[this.path]);return e?{success:!0}:{success:!1,message:t||"You don't have permission!"}}},G_=class extends PE{constructor(e){super(e)}async transform(e,t,s){let{device:r,symbol:i,footprint:n}=e,a={device:r,symbol:i,footprint:n};if(i!=null&&i.success&&(i!=null&&i.result)&&t.symbol&&s.symbol){let o=t.symbol,c=i.result,{uuid:l,docType:u,version:h}=c,p=s.symbol.isProject,d=Object.assign(o,{isProject:p}),f={uuid:l,path:this.path,isProject:!0,docType:u,version:h};if((await ua({origin:d,target:f})).success===!1)throw new Error("Library canvas content upload failed!")}if(n!=null&&n.success&&(n!=null&&n.result)&&t.footprint){let o=t.footprint,c=n.result,{uuid:l,docType:u,version:h}=c,p=s.footprint.isProject,d=!!(r!=null&&r.success&&r.result),f=Object.assign(o,{isConnectDevice:d,isProject:p}),m={uuid:l,path:this.path,isProject:!0,docType:u,version:h};if((await ua({origin:f,target:m})).success===!1)throw new Error("Library canvas content upload failed!")}return{success:!0,result:a}}async transformSymbol(){}async onsuccess(e){e.symbol&&!e.symbol.success&&(e.symbol.message=Dt(e.symbol)||e.symbol.message),e.footprint&&!e.footprint.success&&(e.footprint.message=Dt(e.footprint)||e.footprint.message),e.device&&!e.device.success&&(e.device.message=Dt(e.device)||e.device.message)}},S8=class extends G_{constructor(e){let{path:t,data:s,options:r={}}=e,{matchKey:i=!0,byUUID:n=!0,byVersion:a=!0,bySource:o=!0,renameKey:c=!1}=r;super(t),this.addData={},this.result={device:null,symbol:null,footprint:null},this.data=s,this.matchKey=i,this.byUUID=n,this.byVersion=a,this.bySource=o,this.renameKey=c}async start(){var e,t,s,r,i,n,a,o,c,l,u,h;try{let p=await this.check();if(!p.success)return{success:!1,message:p.message};await this.onbefore();let d={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey};if(this.data.device){let g={...d,data:this.data.device},b=await new w8(g).start();if(b.success===!1)return{success:!1,code:b.code,message:b.message};let{respond:E,addData:y}=b.result;if(this.result.device=E,y&&(this.addData.device=y),this.getBind(),!this.addData.device&&((e=this.result.device)==null?void 0:e.success)&&((t=this.result.device)==null?void 0:t.result)){let{attributes:T}=this.result.device.result,{Symbol:w,Footprint:S}=T,_=w&&(await Je.messageBus.rpcCall(re.SYMBOL.GET,[w,this.path])).message,C=S&&(await Je.messageBus.rpcCall(re.FOOTPRINT.GET,[S,this.path])).message;this.result.symbol={success:!0,result:_},this.result.footprint={success:!0,result:C}}}if(this.data.symbol){let g={...d,data:this.data.symbol},b=await new DE(g).start();if(b.success===!1&&b.code===404){if(this.addData.device){this.addData.device.attributes.Symbol="";let{display_title:E,title:y}=this.addData.device,T=E||y;Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["The following devices lose bound symbol data!",T]})}}else{if(b.success===!1)return{success:!1,code:b.code,message:b.message};{let{respond:E,addData:y}=b.result;if(this.result.symbol=E,y&&(this.addData.symbol=y),this.addData.device&&((s=this.result.symbol)==null?void 0:s.success)&&((r=this.result.symbol)==null?void 0:r.result))this.addData.device.attributes.Symbol=this.result.symbol.result.uuid;else if((i=this.addData.device)!=null&&i.attributes.Symbol&&((n=this.result.symbol)!=null&&n.success)&&!((a=this.result.symbol)!=null&&a.result)&&!this.addData.symbol){let T="The symbol associated with the device does not exist!";throw new Ce("CREATE_DEVICE",T)}}}}if(this.data.footprint){let g={...d,data:this.data.footprint},b=await new CE(g).start();if(b.success===!1&&b.code===404){if(this.addData.device){this.addData.device.attributes.Footprint="";let{display_title:E,title:y}=this.addData.device,T=E||y;Je.messageBus.publish("logI18nLogView",{type:"warn",msg:["The following devices lose bound footprint data!",T]})}}else{if(b.success===!1)return{success:!1,code:b.code,message:b.message};{let{respond:E,addData:y}=b.result;if(this.result.footprint=E,y&&(this.addData.footprint=y),this.addData.device&&((o=this.result.footprint)==null?void 0:o.success)&&((c=this.result.footprint)==null?void 0:c.result))this.addData.device.attributes.Footprint=this.result.footprint.result.uuid;else if((l=this.addData.device)!=null&&l.attributes.Footprint&&((u=this.result.footprint)!=null&&u.success)&&!((h=this.result.footprint)!=null&&h.result)&&!this.addData.footprint){let T="The footprint associated with the device does not exist!";throw new Ce("CREATE_DEVICE",T)}}}}let f=await this.create();if(!f.success)return{success:!1,message:f.message};let m=await this.updateBind();if(!m.success)return{success:!1,message:m.message};if(!this.result)throw new Ce("CREATE_DEVICE","Project library device added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}catch(p){return{success:!1,message:p.message}}}getBind(){if(this.addData.device){let{attributes:e}=this.addData.device,{Symbol:t,Footprint:s}=e,{isProject:r}=this.data.device;if(r===void 0)!this.data.symbol&&t&&(this.data.symbol={isProject:!0,path:this.path,uuid:t}),!this.data.footprint&&s&&(this.data.footprint={isProject:!0,path:this.path,uuid:s});else{let[i,n]=this.addData.device.source.split(fu);!this.data.symbol&&t&&(this.data.symbol={isProject:r,path:n,uuid:t}),!this.data.footprint&&s&&(this.data.footprint={isProject:r,path:n,uuid:s})}}}onbeforeCreate(){var e,t,s,r;return(e=this.addData.symbol)!=null&&e.docType&&!SS((t=this.addData.symbol)==null?void 0:t.docType)?{success:!1,message:"invalid symbol docType"}:(s=this.addData.footprint)!=null&&s.docType&&((r=this.addData.footprint)==null?void 0:r.docType)!==4?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){var e;if(Object.keys(this.addData).length>0){let t=this.onbeforeCreate();if(!t.success)return{success:!1,message:t.message};let s=[[this.addData],this.path],{message:r}=await Je.messageBus.rpcCall(re.DEVICE.PLACE,s);if(!r.success)return{success:!1,message:r.message};let{device:i,symbol:n,footprint:a}=(e=r.result)==null?void 0:e[0];i&&(this.result.device=i),n&&(this.result.symbol=n),a&&(this.result.footprint=a);let o=await this.transform(this.result,this.addData,this.data);if(!o.success)return{success:!1,message:o.message}}return{success:!0}}async updateBind(){let{device:e,symbol:t,footprint:s}=this.result,r=e!=null&&e.success?e==null?void 0:e.result:null,i=t!=null&&t.success?t==null?void 0:t.result:null,n=s!=null&&s.success?s==null?void 0:s.result:null;if(r){let a=!1;if(i!=null&&i.uuid&&r.attributes.Symbol&&i.uuid!==r.attributes.Symbol&&(r.attributes.Symbol=i.uuid,a=!0),n!=null&&n.uuid&&r.attributes.Footprint&&n.uuid!==r.attributes.Footprint&&(r.attributes.Footprint=n.uuid,a=!0),a){let o=(await Je.messageBus.rpcCall(re.DEVICE.UPDATE,[r,this.path])).message;this.result.device={success:!!o,result:o}}}return{success:!0}}async onbefore(){}},_8=class extends F_{constructor(e,t){super(t),this.uuid=e}onHandle(e){return this.onUpdate(e)}matching(e){throw new Error("Method not implemented.")}async isRename(e){return{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};if(!this.origin)return{success:!1,message:"Device details data does not exist"};let t=this.origin.display_title||this.origin.title,s=[{uuid:this.uuid,title:t},this.path];if((await Je.messageBus.rpcCall(re.DEVICE.IS_CHANGE,s)).message){let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message}}return{success:!0,result:this.origin}}},A8=class extends G_{constructor(e){let{path:t,uuid:s,data:r,options:i={}}=e,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:c=!1,renameKey:l=!1}=i;super(t),this.addData={},this.map={},this.result={device:null,symbol:null,footprint:null,map:{}},this.uuid=s,this.data=r,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=c,this.renameKey=l}async start(){var e,t,s,r,i,n,a,o,c,l;try{let u=await this.check();if(!u.success)return{success:!1,message:u.message};await this.onbefore();let h={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey};if(this.data.device){let f={...h,data:this.data.device},m=await new _8(this.uuid,f).start();if(m.success){let g=m.result;g&&(this.updateData=g),this.getBind()}else return{success:!1,code:m.code,message:m.message}}if(this.data.symbol){let f={...h,data:this.data.symbol,renameKey:this.renameKey},m=await new DE(f).start();if(!m.success)return{success:!1,code:m.code,message:m.message};let{respond:g,addData:b}=m.result;if(this.result.symbol=g,b&&(this.addData.symbol=b),this.updateData&&this.addData.symbol)this.updateData.attributes.Symbol=this.addData.symbol.uuid;else if(this.updateData&&((e=this.result.symbol)!=null&&e.success)&&this.result.symbol.result)this.updateData.attributes.Symbol=this.result.symbol.result.uuid;else if((t=this.updateData)!=null&&t.attributes.Symbol&&((s=this.result.symbol)!=null&&s.success)&&!((r=this.result.symbol)!=null&&r.result)&&!this.addData.symbol){let E="The symbol associated with the device does not exist!";throw new Ce("UPDATE_DEVICE",E)}}if(this.data.footprint){let f={...h,data:this.data.footprint,renameKey:this.renameKey},m=await new CE(f).start();if(!m.success)return{success:!1,code:m.code,message:m.message};let{respond:g,addData:b}=m.result;if(this.result.footprint=g,b&&(this.addData.footprint=b),this.updateData&&this.addData.footprint)this.updateData.attributes.Footprint=this.addData.footprint.uuid;else if(this.updateData&&((i=this.result.footprint)!=null&&i.success)&&this.result.footprint.result)this.updateData.attributes.Footprint=this.result.footprint.result.uuid;else if((n=this.updateData)!=null&&n.attributes.Footprint&&((a=this.result.footprint)!=null&&a.success)&&!((o=this.result.footprint)!=null&&o.result)&&!this.addData.footprint){let E="The footprint associated with the device does not exist!";throw new Ce("UPDATE_DEVICE",E)}}let p=await this.create();if(!p.success)return{success:!1,code:p.code,message:p.message};let d=await this.update();if(!d.success)return{success:!1,message:d.message};if(!this.result){let f={text:"Failed to update project library device {title}!",args:{title:((c=this.updateData)==null?void 0:c.display_title)||((l=this.updateData)==null?void 0:l.title)||""}};throw new Ce("UPDATE_DEVICE",f)}return await this.onsuccess(this.result),{success:!0,result:Object.assign(this.result,{map:this.map})}}catch(u){return{success:!1,message:u.message}}}getBind(){if(this.updateData){let{attributes:e}=this.updateData,{Symbol:t,Footprint:s}=e||{},{isProject:r}=this.data.device;if(r===void 0)!this.data.symbol&&t&&(this.data.symbol={isProject:!0,path:this.path,uuid:t}),!this.data.footprint&&s&&(this.data.footprint={isProject:!0,path:this.path,uuid:s});else{let[i,n]=this.updateData.source.split(fu);!this.data.symbol&&t&&(this.data.symbol={isProject:r,path:n,uuid:t}),!this.data.footprint&&s&&(this.data.footprint={isProject:r,path:n,uuid:s})}}}onbeforeCreate(){var e,t,s,r;return(e=this.addData.symbol)!=null&&e.docType&&!SS((t=this.addData.symbol)==null?void 0:t.docType)?{success:!1,message:"invalid symbol docType"}:(s=this.addData.footprint)!=null&&s.docType&&((r=this.addData.footprint)==null?void 0:r.docType)!==4?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){let{symbol:e,footprint:t}=this.addData,s=this.onbeforeCreate();if(!s.success)return{success:!1,message:s.message};if(e){let i=(await Je.messageBus.rpcCall(re.SYMBOL.ADD,[e,this.path])).message;if(!i)return{success:!1,message:"Project library symbol added failed!"};this.result.symbol={success:!0,result:i},this.map[e.uuid]=i.uuid}if(t){let i=(await Je.messageBus.rpcCall(re.FOOTPRINT.ADD,[t,this.path])).message;if(!i)return{success:!1,message:"Project library footprint added failed!"};this.result.footprint={success:!0,result:i},this.map[t.uuid]=i.uuid}let r=await this.transform(this.result,this.addData,this.data);return r.success?{success:!0}:{success:!1,message:r.message}}async update(){var t,s,r;let e=this.updateData;if(e){(t=this.result.symbol)!=null&&t.success&&this.result.symbol.result&&(e.attributes.Symbol=(s=this.result.symbol)==null?void 0:s.result.uuid),(r=this.result.footprint)!=null&&r.success&&this.result.footprint.result&&(e.attributes.Footprint=this.result.footprint.result.uuid);let i=[{...e,uuid:this.uuid,keepVersion:this.keepVersion},this.path],n=(await Je.messageBus.rpcCall(re.DEVICE.UPDATE,i)).message;if(!n)return{success:!1,message:{text:"Failed to update project library device {title}!",args:{title:e.display_title||e.title||""}}};this.result.device={success:!0,result:n}}return{success:!0}}async onbefore(){mu(this.data.device)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}},Y_=class extends PE{constructor(e){let{path:t,data:s}=e;super(t),this.data=s}async cloneCanvas(e,t){let{uuid:s,version:r,docType:i}=t,n=Object.assign(e,{isProject:this.data.isProject}),a={uuid:s,path:this.path,isProject:!0,docType:i,version:r};if((await ua({origin:n,target:a})).success===!1)throw new Error("Library canvas content upload failed!");return{success:!0}}},C8=class extends Y_{constructor(e){let{path:t,data:s,options:r={}}=e,{byUUID:i=!0,byVersion:n=!0,bySource:a=!0,renameKey:o=!0,matchKey:c=!0}=r;super({path:t,data:s}),this.byUUID=i,this.byVersion=n,this.bySource=a,this.renameKey=o,this.matchKey=c}async start(){let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey,matchKey:this.matchKey},s=await new DE({...t,data:this.data}).start();if(!s.success)return{success:!1,code:s.code,message:s.message};let{addData:r,respond:i}=s.result;if(i&&!i.success)return{success:!1,code:i.code,message:i.message};if(i&&i.success)this.result=i.result;else if(r){let n=(await Je.messageBus.rpcCall(re.SYMBOL.ADD,[r,this.path])).message;if(!n)return{success:!1,message:"Project library symbol added failed!"};let a=await this.cloneCanvas(r,n);if(!a.success)return{success:!1,code:a.code,message:a.message};this.result=n}if(!this.result)throw new Ce("CREATE_SYMBOL","Project library symbol added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){}async onsuccess(e){}},V_=class extends PE{constructor(e){let{path:t,data:s}=e;super(t),this.data=s}async cloneCanvas(e,t){let{uuid:s,version:r,docType:i}=t,n=Object.assign(e,{isProject:this.data.isProject}),a={uuid:s,path:this.path,isProject:!0,docType:i,version:r};if((await ua({origin:n,target:a})).success===!1)throw new Error("Library canvas content upload failed!");return{success:!0}}},D8=class extends V_{constructor(e){let{path:t,data:s,options:r={}}=e,{byUUID:i=!0,byVersion:n=!0,bySource:a=!0,renameKey:o=!0,matchKey:c=!0}=r;super({path:t,data:s}),this.byUUID=i,this.byVersion=n,this.bySource=a,this.renameKey=o,this.matchKey=c}async start(){let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey,matchKey:this.matchKey},s=await new CE({...t,data:this.data}).start();if(!s.success)return{success:!1,code:s.code,message:s.message};let{addData:r,respond:i}=s.result;if(i&&!i.success)return{success:!1,code:i.code,message:i.message};if(i&&i.success)this.result=i.result;else if(r){let n=(await Je.messageBus.rpcCall(re.FOOTPRINT.ADD,[r,this.path])).message;if(!n)return{success:!1,message:"Project library footprint added failed!"};let a=await this.cloneCanvas(r,n);if(!a.success)return{success:!1,code:a.code,message:a.message};this.result=n}if(!this.result)throw new Ce("CREATE_FOOTPRINT","Project library footprint added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){}async onsuccess(e){}},P8=class extends H_{constructor(e,t){super(t),this.uuid=e}onHandle(e){return this.onUpdate(e)}matching(e){throw new Error("Method not implemented.")}async isRename(e){return{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};if(!this.origin)return{success:!1,message:"Symbol details data does not exist"};let t=this.origin.display_title||this.origin.title,s=[{uuid:this.uuid,title:t},this.path];if((await Je.messageBus.rpcCall(re.SYMBOL.IS_CHANGE,s)).message){let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message}}return{success:!0,result:this.origin}}},O8=class extends Y_{constructor(e){let{path:t,uuid:s,data:r,options:i={}}=e,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:c=!1,renameKey:l=!1}=i;super({path:t,data:r}),this.uuid=s,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=c,this.renameKey=l}async start(){var i,n;let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey,data:this.data},s=await new P8(this.uuid,t).start();if(!s.success)return{success:!1,code:s.code,message:s.message};this.updateData=s.result;let r=[{...this.updateData,uuid:this.uuid,keepVersion:this.keepVersion},this.path];if(this.result=(await Je.messageBus.rpcCall(re.SYMBOL.UPDATE,r)).message,this.result&&this.onlyIdentity){let a=await this.cloneCanvas(this.updateData,this.result);if(!a.success)return{success:!1,code:a.code,message:a.message}}if(!this.result){let a=((i=this.updateData)==null?void 0:i.display_title)||((n=this.updateData)==null?void 0:n.title)||"",o="Failed to update project library symbol {title}!";throw new Ce("UPDATE_SYMBOL",{text:o,args:{title:a}})}return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){mu(this.data)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}async onsuccess(e){}},I8=class extends U_{constructor(e,t){super(t),this.uuid=e}onHandle(e){return this.onUpdate(e)}matching(e){throw new Error("Method not implemented.")}async isRename(e){return{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};if(!this.origin)return{success:!1,message:"Footprint details data does not exist"};let t=this.origin.display_title||this.origin.title,s=[{uuid:this.uuid,title:t},this.path];if((await Je.messageBus.rpcCall(re.FOOTPRINT.IS_CHANGE,s)).message){let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message}}return{success:!0,result:this.origin}}},x8=class extends V_{constructor(e){let{path:t,uuid:s,data:r,options:i={}}=e,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:c=!1,renameKey:l=!1}=i;super({path:t,data:r}),this.uuid=s,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=c,this.renameKey=l}async start(){var i,n;let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey,data:this.data},s=await new I8(this.uuid,t).start();if(!s.success)return{success:!1,code:s.code,message:s.message};this.updateData=s.result;let r=[{...this.updateData,uuid:this.uuid,keepVersion:this.keepVersion},this.path];if(this.result=(await Je.messageBus.rpcCall(re.FOOTPRINT.UPDATE,r)).message,this.result&&this.onlyIdentity){let a=await this.cloneCanvas(this.updateData,this.result);if(!a.success)return{success:!1,code:a.code,message:a.message}}if(!this.result){let a={text:"Failed to update project library footprint {title}!",args:{title:((i=this.updateData)==null?void 0:i.display_title)||((n=this.updateData)==null?void 0:n.title)||""}};throw new Ce("UPDATE_FOOTPRINT",a)}return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){mu(this.data)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}async onsuccess(e){}},v8=class extends EE{async getDevice(e){let t=[e.uuid,e.path],{message:s}=await Je.messageBus.rpcCall(re.DEVICE.GET,t);if(!s)throw new Ce("GET_DEVICE","Device details data does not exist");return this.getDeviceOut(Object.assign(s,{path:e.path}))}async getSymbol(e){let t=[e.uuid,e.path],{message:s}=await Je.messageBus.rpcCall(re.SYMBOL.GET,t);if(!s)throw new Ce("GET_SYMBOL","Symbol details data does not exist");return this.getSymbolOut(Object.assign(s,{path:e.path}))}async getFootprint(e){let t=[e.uuid,e.path],{message:s}=await Je.messageBus.rpcCall(re.FOOTPRINT.GET,t);if(!s)throw new Ce("GET_FOOTPRINT","Footprint details data does not exist");return this.getFootprintOut(Object.assign(s,{path:e.path}))}async createDevice(e){let{path:t,device:s,symbol:r,footprint:i}=e,n={path:t,data:{device:s,symbol:r,footprint:i}},a=await new S8(n).start();if(!a.success)throw new Ce("CREATE_DEVICE",a.message);let o=a.result.device;if(!(o!=null&&o.success))throw new Ce("CREATE_DEVICE",o==null?void 0:o.message);let c=o.result;return this.getDeviceOut(Object.assign(c,{path:e.path}))}async createSymbol(e){let{path:t,symbol:s}=e,r={path:t,data:s},i=await new C8(r).start();if(!i.success)throw new Ce("CREATE_SYMBOL",i.message);let n=i.result;return this.getSymbolOut(Object.assign(n,{path:e.path}))}async createFootprint(e){let{path:t,footprint:s}=e,r={path:t,data:s},i=await new D8(r).start();if(!i.success)throw new Ce("CREATE_FOOTPRINT",i.message);let n=i.result;return this.getFootprintOut(Object.assign(n,{path:e.path}))}async updateDevice(e){let{uuid:t,path:s,device:r,symbol:i,footprint:n}=e,a={path:s,uuid:t,data:{device:r,symbol:i,footprint:n}},o=await new A8(a).start();if(!o.success)throw new Ce("UPDATE_DEVICE",o.message);let c=o.result.device;if(!(c!=null&&c.success))throw new Ce("CREATE_DEVICE",c==null?void 0:c.message);let l=c.result;return this.getDeviceOut(Object.assign(l,{path:e.path}))}async updateDeviceAttributes(e){let t=(await Je.messageBus.rpcCall(re.DEVICE.UPDATE,[e,e.path])).message;if(!t)throw new Ce("UPDATE_DEVICE_ATTRIBUTES",t.message);return this.getDeviceOut(Object.assign(t,{path:e.path}))}async updateSymbol(e){let{uuid:t,path:s,symbol:r}=e,i={path:s,uuid:t,data:r},n=await new O8(i).start();if(!n.success)throw new Ce("UPDATE_SYMBOL",n.message);let a=n.result;return this.getSymbolOut(Object.assign(a,{path:e.path}))}async updateFootprint(e){let{uuid:t,path:s,footprint:r}=e,i={path:s,uuid:t,data:r},n=await new x8(i).start();if(!n.success)throw new Ce("UPDATE_FOOTPRINT",n.message);let a=n.result;return this.getFootprintOut(Object.assign(a,{path:e.path}))}async deleteDevice(e){if(!(await Je.messageBus.rpcCall(re.DEVICE.DEL,e)).message)throw new Ce("DELETE_DEVICE","delete failed!")}async deleteSymbol(e){if(!(await Je.messageBus.rpcCall(re.SYMBOL.DEL,e)).message)throw new Ce("DELETE_SYMBOL","delete failed!")}async deleteFootprint(e){if(!(await Je.messageBus.rpcCall(re.FOOTPRINT.DEL,e)).message)throw new Ce("DELETE_FOOTPRINT","delete failed!")}async getDeviceList(e){let t=(await Je.messageBus.rpcCall(re.DEVICE.GET_LIST,e)).message;if(!t.success)throw new Ce("GET_DEVICE_LIST",t.message);let{count:s,totalPage:r,lists:i,page:n,pageSize:a}=t.result,o=i.map(c=>{let l=this.getDeviceOut(c);return c.symbol&&(l.symbol=this.getSymbolOut(c.symbol)),c.footprint&&(l.footprint=this.getFootprintOut(c.footprint)),l});return{count:s,lists:o,page:n,pageSize:a,totalPage:r}}async getDeviceSearchList(e){let t=(await Je.messageBus.rpcCall(re.DEVICE.GET_LIST,e)).message;if(!t.success)throw new Ce("GET_DEVICE_LIST",t.message);if(e.titles){let s={};for(let r in t.result){let i=t.result[r].map(n=>{let a=this.getDeviceOut(n);return n.symbol&&(a.symbol=this.getSymbolOut(n.symbol)),n.footprint&&(a.footprint=this.getFootprintOut(n.footprint)),a});s[r]=i}return s}else{let{count:s,totalPage:r,lists:i,page:n,pageSize:a}=t.result,o=i.map(c=>{let l=this.getDeviceOut(c);return c.symbol&&(l.symbol=this.getSymbolOut(c.symbol)),c.footprint&&(l.footprint=this.getFootprintOut(c.footprint)),l});return{count:s,lists:o,page:n,pageSize:a,totalPage:r}}}async getSymbolList(e){let t=(await Je.messageBus.rpcCall(re.SYMBOL.GET_LIST,e)).message;if(!t.success)throw new Ce("GET_SYMBOL_LIST",t.message);let{count:s,totalPage:r,lists:i,page:n,pageSize:a}=t.result,o=i.map(this.getSymbolOut);return{count:s,lists:o,page:n,pageSize:a,totalPage:r}}async getSymbolSearchList(e){let t=(await Je.messageBus.rpcCall(re.SYMBOL.GET_LIST,e)).message;if(!t.success)throw new Ce("GET_SYMBOL_LIST",t.message);if(e.titles){let s={};for(let r in t.result)s[r]=t.result[r].map(this.getSymbolOut);return s}else{let{count:s,totalPage:r,lists:i,page:n,pageSize:a}=t.result,o=i.map(this.getSymbolOut);return{count:s,lists:o,page:n,pageSize:a,totalPage:r}}}async getFootprintList(e){let t=(await Je.messageBus.rpcCall(re.FOOTPRINT.GET_LIST,e)).message;if(!t.success)throw new Ce("GET_FOOTPRINT_LIST",t.message);let{count:s,totalPage:r,lists:i,page:n,pageSize:a}=t.result,o=i.map(this.getFootprintOut);return{count:s,lists:o,page:n,pageSize:a,totalPage:r}}async getFootprintSearchList(e){let t=(await Je.messageBus.rpcCall(re.FOOTPRINT.GET_LIST,e)).message;if(!t.success)throw new Ce("GET_FOOTPRINT_LIST",t.message);if(e.titles){let s={};for(let r in t.result)s[r]=t.result[r].map(this.getFootprintOut);return s}else{let{count:s,totalPage:r,lists:i,page:n,pageSize:a}=t.result,o=i.map(this.getFootprintOut);return{count:s,lists:o,page:n,pageSize:a,totalPage:r}}}getDeviceOut(e){return{uuid:e.uuid,path:e.path,title:e.title,display_title:e.display_title,attributes:e.attributes,description:e.description,images:e.images,source:e.source,version:e.version,ticket:e.ticket,creator:e.creator,modifier:e.modifier,createTime:Ke(e.createTime),updateTime:Ke(e.updateTime),owner:e.owner,custom_tags:e.custom_tags,symbol_type:e.symbol_type}}getSymbolOut(e){return{title:e.title,display_title:e.display_title,description:e.description,docType:e.docType,uuid:e.uuid,path:e.path,source:e.source,version:e.version,ticket:e.ticket,creator:e.creator,modifier:e.modifier,updateTime:Ke(e.updateTime),createTime:Ke(e.createTime),owner:e.owner,custom_tags:e.custom_tags}}getFootprintOut(e){return{title:e.title,display_title:e.display_title,description:e.description,docType:e.docType,uuid:e.uuid,path:e.path,source:e.source,version:e.version,ticket:e.ticket,creator:e.creator,modifier:e.modifier,updateTime:Ke(e.updateTime),createTime:Ke(e.createTime),owner:e.owner,custom_tags:e.custom_tags}}},R8=class extends EE{constructor(){super(...arguments),this._normalErrorMsg="Request Error.",this._extendLibManager=er.getInstance()}async getDevice(e){var s;let t=await((s=this._extendLibManager.getLib(e.path))==null?void 0:s.getTransformedDetailInTab("device",e.uuid));if(t)return t;throw new Ce("GET_DEVICE",this._normalErrorMsg)}async getSymbol(e){var s;let t=await((s=this._extendLibManager.getLib(e.path))==null?void 0:s.getTransformedDetailInTab("symbol",e.uuid));if(t)return t;throw new Ce("GET_SYMBOL",this._normalErrorMsg)}async getFootprint(e){var s;let t=await((s=this._extendLibManager.getLib(e.path))==null?void 0:s.getTransformedDetailInTab("footprint",e.uuid));if(t)return t;throw new Ce("GET_FOOTPRINT",this._normalErrorMsg)}async getDeviceList(e){var s,r,i,n,a,o,c,l;let t=await((l=this._extendLibManager.getLib(e.path))==null?void 0:l.getTransformedListInTab("device",{query:{attributes:(r=(s=e.query)==null?void 0:s.attributes)!=null?r:{},symbolType:(i=e.query)==null?void 0:i.symbol_type,classification:{primaryClassificationUuid:(a=(n=e.tags)==null?void 0:n[0])!=null?a:"",secondaryClassificationUuid:(c=(o=e.tags)==null?void 0:o[1])!=null?c:""}},page:e.page,pageSize:e.pageSize}));if(t)return t;throw new Ce("GET_DEVICE_LIST",this._normalErrorMsg)}async getSymbolList(e){var s,r,i,n,a,o,c;let t=await((c=this._extendLibManager.getLib(e.path))==null?void 0:c.getTransformedListInTab("symbol",{query:{symbolType:(r=(s=e.query)==null?void 0:s.docType)==null?void 0:r[0],classification:{primaryClassificationUuid:(n=(i=e.tags)==null?void 0:i[0])!=null?n:"",secondaryClassificationUuid:(o=(a=e.tags)==null?void 0:a[1])!=null?o:""}},page:e.page,pageSize:e.pageSize}));if(t)return t;throw new Ce("GET_SYMBOL_LIST",this._normalErrorMsg)}async getFootprintList(e){var s,r,i,n,a;let t=await((a=this._extendLibManager.getLib(e.path))==null?void 0:a.getTransformedListInTab("footprint",{query:{classification:{primaryClassificationUuid:(r=(s=e.tags)==null?void 0:s[0])!=null?r:"",secondaryClassificationUuid:(n=(i=e.tags)==null?void 0:i[1])!=null?n:""}},page:e.page,pageSize:e.pageSize}));if(t)return t;throw new Ce("GET_FOOTPRINT_LIST",this._normalErrorMsg)}async getDeviceSearchList(e){var c,l,u,h;let{path:t,wd:s,query:r,tags:i,page:n,pageSize:a}=e,o=await((h=this._extendLibManager.getLib(t))==null?void 0:h.getTransformedListInTab("device",{query:{wd:s,attributes:(c=r==null?void 0:r.attributes)!=null?c:{},symbolType:r==null?void 0:r.symbol_type,classification:{primaryClassificationUuid:(l=i==null?void 0:i[0])!=null?l:"",secondaryClassificationUuid:(u=i==null?void 0:i[1])!=null?u:""}},page:n,pageSize:a}));if(o)return o;throw new Ce("GET_DEVICE_LIST",this._normalErrorMsg)}async getSymbolSearchList(e){var c,l,u,h;let{path:t,wd:s,query:r,tags:i,page:n,pageSize:a}=e,o=await((h=this._extendLibManager.getLib(t))==null?void 0:h.getTransformedListInTab("symbol",{query:{wd:s,symbolType:(c=r==null?void 0:r.docType)==null?void 0:c[0],classification:{primaryClassificationUuid:(l=i==null?void 0:i[0])!=null?l:"",secondaryClassificationUuid:(u=i==null?void 0:i[1])!=null?u:""}},page:n,pageSize:a}));if(o)return o;throw new Ce("GET_SYMBOL_LIST",this._normalErrorMsg)}async getFootprintSearchList(e){var c,l,u;let{path:t,wd:s,query:r,tags:i,page:n,pageSize:a}=e,o=await((u=this._extendLibManager.getLib(t))==null?void 0:u.getTransformedListInTab("footprint",{query:{wd:s,classification:{primaryClassificationUuid:(c=i==null?void 0:i[0])!=null?c:"",secondaryClassificationUuid:(l=i==null?void 0:i[1])!=null?l:""}},page:n,pageSize:a}));if(o)return o;throw new Ce("GET_FOOTPRINT_LIST",this._normalErrorMsg)}createDevice(e){throw new Ce("CREATE_DEVICE","Not Supported.")}createSymbol(e){throw new Ce("GET_SYMBOL","Not Supported.")}createFootprint(e){throw new Ce("CREATE_FOOTPRINT","Not Supported.")}updateDevice(e){throw new Ce("UPDATE_DEVICE","Not Supported.")}updateSymbol(e){throw new Ce("GET_SYMBOL","Not Supported.")}updateFootprint(e){throw new Ce("GET_SYMBOL","Not Supported.")}deleteDevice(e){throw new Ce("GET_SYMBOL","Not Supported.")}deleteSymbol(e){throw new Ce("GET_SYMBOL","Not Supported.")}deleteFootprint(e){throw new Ce("GET_SYMBOL","Not Supported.")}},N8=(e=>(e[e.CBB=1]="CBB",e[e.SYMBOL=2]="SYMBOL",e[e.DEVICE=3]="DEVICE",e[e.FOOTPRINT=4]="FOOTPRINT",e[e.MODEL3D=5]="MODEL3D",e[e.MODELSIM=6]="MODELSIM",e[e.PANEL_LIB=29]="PANEL_LIB",e))(N8||{}),L8=["title","description","tags","images"],cs=new b8,_r=new v8,Ba=new R8,vs=class{static getDevice(e){return er.getInstance().hasLib(e.path)?Ba.getDevice(e):e.isProject?_r.getDevice(e):cs.getDevice(e)}static getSymbol(e){return er.getInstance().hasLib(e.path)?Ba.getSymbol(e):e.isProject?_r.getSymbol(e):cs.getSymbol(e)}static getFootprint(e){return er.getInstance().hasLib(e.path)?Ba.getFootprint(e):e.isProject?_r.getFootprint(e):cs.getFootprint(e)}static getD3Model(e){return e.isProject?null:cs.getD3Model(e)}static getSimModel(e){if(e.isProject)throw new Ce("GET_SIM_MODEL","Api call error!");return cs.getSimModel(e)}static getDeviceList(e){return er.getInstance().hasLib(e.path)?Ba.getDeviceList(e):e.isProject?_r.getDeviceList(e):cs.getDeviceList(e)}static getSymbolList(e){return er.getInstance().hasLib(e.path)?Ba.getSymbolList(e):e.isProject?_r.getSymbolList(e):cs.getSymbolList(e)}static getFootprintList(e){return er.getInstance().hasLib(e.path)?Ba.getFootprintList(e):e.isProject?_r.getFootprintList(e):cs.getFootprintList(e)}static getD3ModelList(e){if(e.isProject)throw new Ce("GET_D3MODEL_LIST","Api call error!");return cs.getD3ModelList(e)}static getSimModelList(e){if(e.isProject)throw new Ce("GET_SIM_MODEL_LIST","Api call error!");return cs.getSimModelList(e)}static getDeviceSearchList(e){return er.getInstance().hasLib(e.path)?Ba.getDeviceSearchList(e):e.isProject?_r.getDeviceSearchList(e):cs.getDeviceSearchList(e)}static getSymbolSearchList(e){return er.getInstance().hasLib(e.path)?Ba.getSymbolSearchList(e):e.isProject?_r.getSymbolSearchList(e):cs.getSymbolSearchList(e)}static getFootprintSearchList(e){return er.getInstance().hasLib(e.path)?Ba.getFootprintSearchList(e):e.isProject?_r.getFootprintSearchList(e):cs.getFootprintSearchList(e)}static getPanelLibSearchList(e){if(e.isProject)throw new Ce("GET_PANEL_LIB_SEARCH_LIST","Api call error!");return cs.getPanelLibSearchList(e)}static getD3ModelSearchList(e){if(e.isProject)throw new Ce("GET_D3MODEL_SEARCH_LIST","Api call error!");return cs.getD3ModelSearchList(e)}static getSimModelSearchList(e){if(e.isProject)throw new Ce("GET_SIM_MODEL_SEARCH_LIST","Api call error!");return cs.getSimModelSearchList(e)}static createDevice(e){return e.isProject?_r.createDevice(e):cs.createDevice(e)}static createSymbol(e){return e.isProject?_r.createSymbol(e):cs.createSymbol(e)}static createFootprint(e){return e.isProject?_r.createFootprint(e):cs.createFootprint(e)}static createD3Model(e){return e.isProject?null:cs.createD3Model(e)}static createSimModel(e){if(e.isProject)throw new Ce("CREATE_SIM_MODEL","Api call error!");return cs.createSimModel(e)}static updateDevice(e){return e.isProject?_r.updateDevice(e):cs.updateDevice(e)}static updateDeviceAttributes(e){return e.isProject?_r.updateDeviceAttributes(e):cs.updateDeviceAttributes(e)}static updateSymbol(e){return e.isProject?_r.updateSymbol(e):cs.updateSymbol(e)}static updateFootprint(e){return e.isProject?_r.updateFootprint(e):cs.updateFootprint(e)}static updateSimModel(e){if(e.isProject)throw new Ce("UPDATE_SIM_MODEL","Api call error!");return cs.updatesimModel(e)}static deleteDevice(e){return e.isProject?_r.deleteDevice(e):cs.deleteDevice(e)}static deleteSymbol(e){return e.isProject?_r.deleteSymbol(e):cs.deleteSymbol(e)}static deleteFootprint(e){return e.isProject?_r.deleteFootprint(e):cs.deleteFootprint(e)}static deleteSimModel(e){if(e.isProject)throw new Ce("DELETE_SIM_MODEL","Api call error!");return cs.deleteSimModel(e)}static deleteD3Model(e){if(e.isProject)throw new Ce("DELETE_3DMODEL","Api call error!");return cs.delete3DModel(e)}};async function z_(e,t,s,r={}){r.eachProcessHook&&r.eachProcessHook(.01);let i=s||nt.SYSTEMLIB_UUID,n=null;if(t)try{n=await vs.getDevice({isProject:e,path:s,uuid:t})}catch(u){console.warn(u)}r.eachProcessHook&&r.eachProcessHook(.25);let a=null,o={Footprint:!1,symbol:!1,d3DModel:!1};if(n){let u=(n.attributes||{}).Symbol;if(u){try{a=await vs.getSymbol({isProject:e,path:s,uuid:u})}catch(h){console.warn(h)}a||(o.symbol=!0)}}r.eachProcessHook&&r.eachProcessHook(.5);let c=null;if(n){let u=(n.attributes||{}).Footprint;if(u){try{c=await vs.getFootprint({isProject:e,path:s,uuid:u})}catch(h){console.warn(h)}c||(o.Footprint=!0)}}r.eachProcessHook&&r.eachProcessHook(.75);let l=null;if(n){let u=n.attributes||{},h=u["3D Model"],p=u["3D Model Title"],d=pd(h,!0),f=d.path||nt.SYSTEMLIB_UUID||i;if(d.componentTitleOrId&&(d.isLocaleFilenameMode?l=(await yE(d.componentTitleOrId,f)).result:l=await fd(d.componentTitleOrId,f)),!l&&h&&p){if(r.isCheckD3ModelFileExist){let m=await rB(h);m.success&&m.result instanceof Blob?o.d3DModel=!1:o.d3DModel=!0}else o.d3DModel=!0;l=m_(h,p,d.path)}}return r.eachProcessHook&&r.eachProcessHook(1),{setPath:i,deviceItem:n,symbolItem:a,footprintItem:c,d3modelItem:l,hasIdButNotFound:o}}async function B8(e=!1,t,s,r,i){let n=i?!!i.forceAsSymbol:!1,a=i?!!i.ignoreDoctypeCheck:!1,o=i?!!i.isDevice:!1,c=i?!!i.isCheckD3ModelFileExist:!1;if(!a){if(r===28){let h=i?!!i.attachedDeviceBindingExtra:!1,p=i?i.eachProcessHook:null;try{let d=null;return h?d=await z_(e,t,s,{eachProcessHook:p,isCheckD3ModelFileExist:c}):d=await vs.getDevice({isProject:e,path:s,uuid:t}),{code:0,success:!0,result:d,message:""}}catch(d){return{code:-1,success:!1,result:null,message:d.message.toString()}}}if(r===4)try{return{code:0,success:!0,result:await vs.getFootprint({isProject:e,path:s,uuid:t}),message:""}}catch(h){return{code:-1,success:!1,result:null,message:h.message.toString()}}if(n||r&&[2,18,19,20,21,22,25,31,7,32,6].indexOf(r)>=0)try{return{code:0,success:!0,result:await vs.getSymbol({isProject:e,path:s,uuid:t}),message:""}}catch(h){return{code:-1,success:!1,result:null,message:h.message.toString()}}if(r===16)try{return{code:0,success:!0,result:await fd(t,s),message:""}}catch(h){return{code:-1,success:!1,result:null,message:h.message.toString()}}}let l=await dt("GET",o?`/api/v2/devices/${t}`:`/api/v2/components/${t}`,{uuid:t,path:s},{headers:{"Content-type":"application/json","content-type":"application/json",path:s}});if(l.code===0&&l.success&&typeof l.result=="object")return{code:0,success:!0,result:l.result,message:""};let u=l.message||l.msg||"Request Error.";return{code:l.code||-1,success:!1,result:null,message:u}}function z1(e,t){let s=e.owner||{},r=typeof e.updated_at=="string"?e.updated_at:typeof e.updated_at=="number"?Fo(new Date(e.updated_at)):"",i=typeof e.updateTime=="string"?e.updateTime:typeof e.updateTime=="number"?Fo(new Date(Ke(e.updateTime))):"";return{...e,$id:String(t),numberIndex:t+1,ownerBelong:s.username,updateTimeString:r||i}}function k8(e,t,s){let r=[];for(let i=0;i<e.length;i++){let n=e[i][t]?e[i][t].toLocaleLowerCase():"",a=s?s.toLocaleLowerCase():"";n.indexOf(a)>=0&&r.push(e[i])}return r}async function M8(e,t,s,r){let i=await new Promise(a=>{fetch(uE.D3Model.client3DModelList,{method:"GET",body:JSON.stringify({step_path:e})}).then(o=>{o.json().then(c=>{if(c){a(c);return}a(null)})})}),n={code:0,success:!0,result:{count:0,page:1,pageSize:r,totalPage:1,lists:[]},msg:""};return i&&i.success?(n.result.lists=(i.result||[]).map((a,o)=>{let c=Fo(new Date(a.mtime*1e3)),l={uuid:`${a.fileName}|${t}`,rowFileTag:`${a.fileName}|${t}`,path:t,display_title:a.fileName,description:"",docType:16,isFavorite:!1,modifier:null,owner:null,tags:{child_tag:[],parent_tag:[]},title:a.fileName,updateTime:a.mtime/1e3,updated_at:c,createTime:a.mtime/1e3,created_at:c,creator:null,dataStr:"",public:void 0,type:16};return{...z1(l,o)}}),n.result.count=i.result.length):(n.code=nt.ERR_CODE.NORMAL,n.success=!1,n.msg=i.message||"Fetch local 3D model list error."),n}async function j8(e,t,s,r,i){let n={};for(let l=0;l<t.length;l++){let u=t[l].id,h=await new Promise(p=>{fetch(uE.D3Model.client3DModelList,{method:"GET",body:JSON.stringify({step_path:e})}).then(d=>{d.json().then(f=>{if(f){p(f);return}p(null)})})});if(h&&h.success){n[u]={list:h.result.map((p,d)=>z1(p,d))};continue}n[u]=null}let a={},o={},c={count:0};for(let l=0;l<t.length;l++){let u=t[l].id;if(n[u]){let h=k8(n[u].list,"fileName",r);if(!h.length){a[u]=0,o[u]=[];continue}a[u]=h.length,o[u]=h.map((p,d)=>{let f=Fo(new Date(p.mtime*1e3)),m={uuid:`${p.fileName}|${p.path}`,path:p.path,rowFileTag:`${p.fileName}|${p.path}`,display_title:p.fileName,description:"",docType:16,isFavorite:!1,modifier:null,owner:null,tags:{child_tag:[],parent_tag:[]},title:p.fileName,updateTime:p.mtime/1e3,updated_at:f,createTime:p.mtime/1e3,created_at:f,creator:null,dataStr:"",public:void 0,source:void 0,std_uuid:void 0,ticket:0,type:16};return{...z1(m,d)}}),c.count++;continue}a[u]=0,o[u]=[]}return{code:0,success:!0,result:{count:c.count,facets:a,lists:o,uid:e,wd:r,page:1,pageSize:i,totalPage:1},msg:""}}var F8=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e))(F8||{});function W_(e){let t=null;return t=q_(e.title),!t.success||(t=J_(e.description),!t.success)?t:{code:0,success:!0,message:"",key:"",result:null}}function q_(e){let t={code:0,success:!0,message:"",key:"",result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}function J_(e){let t={code:0,success:!0,message:"",key:"",result:null};return e&&e.length>255&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="Description should be no more than 255 letters"),t}async function U8(e,t,s,r){if(!t||!s||!r)return{code:-1,success:!1,result:null,message:"missing uuid or path or detail data."};let i=W_({title:r.title,description:r.description});if(!i.success)return{code:i.code,success:!1,result:null,message:i.message};let n=await dt("POST",`/api/v2/components/${t}/update`,JSON.stringify({...r,owner:s}),{headers:{"Content-type":"application/json","content-type":"application/json",path:s}});if(n.code===0&&n.success&&typeof n.result=="object")return{code:0,success:!0,result:n.result,message:""};let a=n.message||n.msg||"Request Error.";return{code:n.code||-1,success:!1,result:null,message:a}}var Ri,H8=(Ri=class{},Ri.createDefaultD3modelItem=m_,Ri.fetchD3ModelItemHandle=fd,Ri.updateD3ModelItem=U8,Ri.d3modelInfoVerify=W_,Ri.d3modelInfoTitleVerify=q_,Ri.d3modelInfoDescriptionVerify=J_,Ri.fetchD3ModelListOnLocaleFolder=M8,Ri.fetchD3ModelListBySearchOnLocaleFolder=j8,Ri.fetchD3ModelItemOnLocaleFolder=yE,Ri),G8=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e.COMPONENT_ATTRIBUTES_OVER_SIZE="{0} should be no more than 255 letters",e))(G8||{});function Y8(e,t=void 0){let s=null;if(s=K_(e.title),!s.success||(s=X_(e.description),!s.success)||(s=Z_(e.attributes),!s.success))return s;let r={code:0,success:!0,message:"",key:"",result:null};return typeof t<"u"&&(t.length<=0||t.length>128)&&(r.code=nt.ERR_CODE.NORMAL,r.success=!1,r.message="The title length must be between 1~128 characters!"),r}function K_(e){let t={code:0,success:!0,message:"",key:"",result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}function X_(e){let t={code:0,success:!0,message:"",key:"",result:null};return e&&e.length>255&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="Description should be no more than 255 letters"),t}function Z_(e){let t={code:0,success:!0,message:"",key:"",result:null},s=Object.keys(e);for(let r=0;r<s.length;r++){let i=s[r],n=e[i];if(typeof n=="string"&&n.trim().length>255)return t.code=nt.ERR_CODE.NORMAL,t.message="{0} should be no more than 255 letters",t.key=i,t}return t}var na,V8=(na=class{},na.deviceInfoVerify=Y8,na.deviceInfoTitleVerify=K_,na.deviceInfoDescriptionVerify=X_,na.deviceInfoAttributesVerify=Z_,na.fetchDeviceItem=z_,na);function z8(){return[["DOCTYPE","FOOTPRINT",""],["HEAD",{editorVersion:"dev",importFlag:0}],["CANVAS",0,0,"mm",5,5,5,5,5,5,2,2,5]].map(e=>JSON.stringify(e)).join(`
`)}function W8(e="",t="",s=""){let r=t||"[Empty Footprint Component Item]",i=new Date().getTime(),n=Fo(new Date(i)),a={avatar:"",nickname:"",username:"",uuid:""};return{$emptyItem:!0,createTime:i,created_at:n,creator:{...a},dataStr:e,description:"",display_title:r,docType:4,modifier:{...a},owner:{...a},path:nt.SYSTEMLIB_UUID,public:!1,source:"",std_uuid:"",tags:{child_tag:null,parent_tag:null},ticket:0,title:r,type:0,updateTime:i,updated_at:n,uuid:s||"",version:""}}var q8=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e))(q8||{});function J8(e){let t=null;return t=K8(e.title),t.success?{code:0,success:!0,message:"",key:void 0,result:null}:t}function K8(e){let t={code:0,success:!0,message:"",key:void 0,result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}var ko,X8=(ko=class{},ko.footprintInfoVerify=J8,ko.createEmptyFootprintItem=W8,ko.createEmptyFootprintDataStr=z8,ko),Z8=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e))(Z8||{});function $8(e){let t=null;return t=Q8(e.title),!t.success||(t=e6(e.docType),!t.success)?t:{code:0,success:!0,message:"",key:void 0,result:null}}function Q8(e){let t={code:0,success:!0,message:"",key:void 0,result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}function e6(e){let t={code:0,success:!0,message:"",key:void 0,result:null};return(typeof e>"u"||!e)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="Document data abnormality"),t}var cu,t6=(cu=class{},cu.symbolInfoVerify=$8,cu),bt=(e=>(e.UNZIP="/pro-mgr/unzip",e.EXTRACT="/pro-mgr/unzip/extract",e.FLOW="/pro-mgr/unzip/flow",e.PARSE="/pro-mgr/unzip/parse",e.CHECK="/pro-mgr/unzip/check",e.GET_PROJECT_IN_CLOUD="/pro-mgr/getProjectInCloud",e.GET_PROJECT_IN_LOCAL="/pro-mgr/getProjectInLocal",e.GET_PROJECT_BY_IN_LOCAL="/pro-mgr/getProjectByInLocal",e.EXPORT_ZIP="/pro-mgr/export/zip",e.EXPORT_DOCUMENT="/pro-mgr/export/document",e.EXPORT_DEVICE="/pro-mgr/export/lib/device",e.EXPORT_SYMBOL="/pro-mgr/export/lib/symbol",e.EXPORT_FOOTPRIN="/pro-mgr/export/lib/footprint",e.EXPORT_PANEL_LIB="/pro-mgr/export/lib/panelLib",e.DOWNLOAD_PROJECT="/pro-mgr/export/download/project",e.DOWNLOAD_CBB="/pro-mgr/export/download/cbb",e.DOWNLOAD_DOCUMENT="/pro-mgr/export/download/document",e.BACKUP="/pro-mgr/backup",e.ARCHIVE="/pro-mgr/archive",e.LOAD_FILE="/pro-mgr/loadFile",e.CONVERT_PROJECT="/pro-mgr/convertProject/start",e.CONVERT_PROJECT_FLOWWIRTE="/pro-mgr/convertProject/flowWrite",e.CONVERT_PROJECT_FLOWREAD="/pro-mgr/convertProject/flowRead",e.IMPORT_NEW_PROJECT="/pro-mgr/importNewProject",e.PROJECT_AS_CLOUD="/pro-mgr/projectAsCloud",e.CBB_AS_CLOUD="/pro-mgr/cbbAsCloud",e.DOCUMENT_AS_CLOUD="/pro-mgr/documentAsCloud",e.COMPONENT_AS_CLOUD="/pro-mgr/componentAsCloud",e.IMPORT_TARGET_PROJECT="/pro-mgr/importTargetProject",e.UPDATE_BLOCK_SYMBOL_CONNECT="/pro-mgr/updateBlockSymbolConnect",e.IMPORT_SYMBOLS="/pro-mgr/importSymbols",e.IMPORT_FOOTPRINTS="/pro-mgr/importFootprints",e.IMPORT_DEVICES="/pro-mgr/importDevices",e.COPY_BOARD="/pro-mgr/copyBoards",e.COPY_SCHEMATIC="/pro-mgr/copySchematics",e.COPY_PAGE="/pro-mgr/copyPages",e.COPY_SCH_CANVAS="/pro-mgr/copySchCanvas",e.COPY_PCB_CANVAS="/pro-mgr/copyPcbCanvas",e.COPY_PANEL_CANVAS="/pro-mgr/copyPanelCanvas",e.PASTE_BOARD="/pro-mgr/pasteBoards",e.PASTE_SCHEMATIC="/pro-mgr/pasteSchematics",e.PASTE_PAGE="/pro-mgr/pastePages",e.PASTE_SCH_TOP="/pro-mgr/pasteSchTop",e.PASTE_PCB="/pro-mgr/pastePcb",e.PASTE_PANEL="/pro-mgr/pastePanel",e.PASTE_SCH_BOTTOM="/pro-mgr/pasteSchBottom",e.BUILD_EXPORT="/pro-mgr/buildExport",e.BUILD_TARGET="/pro-mgr/buildTarget",e.PARSE_PROJECT="/pro-mgr/parseProject",e.COMPARE_LOCAL="/pro-mgr/compare/local",e.COMPARE_CLOUD="/pro-mgr/compare/cloud",e.COMPARE_DESTORY="/pro-mgr/compare/destory",e.UPDATE_REUSE_BLOCK="/pro-mgr/updateReuseBlock",e))(bt||{});var gd=class{constructor(e="utf-8"){this.decoder=new TextDecoder(e)}write(e){return this.decoder.decode(e,{stream:!0})}end(){return this.decoder.decode()}},uY=sd(rd());var hY=sd(rd());var s6=(e=>(e[e.Free=1]="Free",e[e.Strict=3]="Strict",e))(s6||{});var r6=(e=>(e.name="name",e.default_sheet="default_sheet",e.cbb_project="cbb_project",e))(r6||{}),i6=(e=>(e.Export2_0="export2.0",e.Export3_0="export3.0",e.Target3_0="exist3.0",e))(i6||{});var dY=sd(rd()),n6=(e=>(e[e.NONE=1]="NONE",e[e.CLIENT_BUT_UUID=2]="CLIENT_BUT_UUID",e[e.ONLINE_BUT_PATH=3]="ONLINE_BUT_PATH",e))(n6||{});var Wr,a6=(Wr=class{},Wr.D3Model=H8,Wr.Device=V8,Wr.Footprint=X8,Wr.Symbol=t6,Wr.deleteComponentItem=p_,Wr.deleteComponents=K5,Wr.fetchComponentItem=B8,Wr.queryComponentsByTitle=vm,Wr.pickUpComponentTags2Ids=f_,Wr.pickUpComponentTags2Names=Uc,Wr.getDataStrById=kn,Wr.duplicateNameDetection=Gc,Wr),td=class Ac{static async getOldLibByNet(t){try{let{dataStrId:s,dataStr:r}=t;return s||r?{success:!0,result:(await Je.messageBus.rpcCall("/pro-mgr/public/getDataStr",t)).message||""}:{success:!1,message:"Failed to obtain the source code of the existing component library!"}}catch(s){return{success:!1,message:s.message}}}static transform(t,s){let{uuid:r,docType:i}=s,n="";if(i===4){let a=s.isConnectDevice;n=B4(r,t,a)}else i===29?n=H4(r,t,Yh.PANEL_LIB):Pm(i)&&(n=j4(r,t).dataStr);return n}static async getOtherLibByNet(t){try{let{isProject:s,uuid:r,path:i,docType:n}=t;if(g5(t)){let l={ignoreDoctypeCheck:!0},u=(await a6.fetchComponentItem(s,r,i,n,l)).result;t=Object.assign(t,u)}let{history_uuid:a,dataStrId:o,dataStr:c}=t;if(a){let l={uuid:r,historyUuid:a},u=(await Je.messageBus.rpcCall(Me.COMPONENT.GET_HISTORY,l)).message;if(!u.success){let h=["Conversion component format failed!",u.message];return{success:!1,code:u.code,message:h}}return{success:!0,result:(await Je.messageBus.rpcCall(Me.COMPONENT.GET_HISTORY_DATA,[u.result])).message}}else if(o||c){let l=await Ac.getOldLibByNet(t);if(!l.success){let p=["Conversion component format failed!",l.message];return{success:!1,code:l.code,message:p}}let u=l.result,h=Ac.transform(u,t);return h?{success:!0,result:h}:{success:!1,message:["Conversion component format failed!","Illegal docType!"]}}else return{success:!0,result:""}}catch(s){return{success:!1,message:s.message}}}static async getOtherLibByWorker(t){try{let s=du();return{success:!0,result:await y5(`/${s._TAB_ID_}/libWorker`).rpcCall("/mgr/libWorker/getDataByType",t)}}catch(s){return{success:!1,message:s.message}}}static async getProjectLibByWorker(t){try{let{path:s,uuid:r,docType:i}=t,{message:n}=await Je.messageBus.rpcCall("/pro-mgr/hasProject",[s]);return n?i===4?{success:!0,result:(await Je.messageBus.rpcCall(re.FOOTPRINT.GET_STR,[r,s])).message||""}:Pm(i)?{success:!0,result:(await Je.messageBus.rpcCall(re.SYMBOL.GET_STR,[r,s])).message||""}:{success:!1,message:"Api call error! The api does not exist!"}:{success:!1,message:"Get project library data source Project is not open!"}}catch(s){return{success:!1,message:s.message}}}static async getExtendLib(t){var a,o;let{path:s,uuid:r}=t,i=await((o=(a=er.getInstance().getLib(s))==null?void 0:a.footprint)==null?void 0:o.getTransformedDetail(r));if(!(i!=null&&i.dataStr))return{success:!1,message:["Conversion component format failed!","Failed to obtain the source code of the existing component library!"]};let n;return i.dataStr.trim().startsWith("[")?n=Ac.transform(i.dataStr,t):n=i.dataStr,n?{success:!0,result:n}:{success:!1,message:["Conversion component format failed!","Illegal docType!"]}}static async getProLibSource(t){try{let{isProject:s,path:r}=t;return er.getInstance().hasLib(r)?Ac.getExtendLib(t):s?Ac.getProjectLibByWorker(t):Ac.getOtherLibByWorker(t)}catch(s){return{success:!1,message:s.message}}}},$_=(e=>(e.INIT_DB="/CommonDB/initDB",e))($_||{}),Q_=(e=>(e.GET="/CommonDB/project/getData",e.GET_ALL="/CommonDB/project/getAllArrData",e))(Q_||{}),eA=(e=>(e.GET="/CommonDB/copyAndPaste/getData",e.SET="/CommonDB/copyAndPaste/setData",e.IS_EXIST="/CommonDB/copyAndPaste/isExist",e.GET_DATA_FROM_PCB_CANVAS="/CommonDB/copyAndPaste/getDataFromPcbCanvas",e))(eA||{}),tA=(e=>(e.GET="/CommonDB/copyAndPasteTableCell/getData",e.SET="/CommonDB/copyAndPasteTableCell/setData",e.IS_EXIST="/CommonDB/copyAndPasteTableCell/isExist",e))(tA||{}),sA=(e=>(e.SET="/CommonDB/log/setData",e.DEL="/CommonDB/log/delData",e.DEL_LOTS="/CommonDB/log/delLotsData",e.GET_ALL="/CommonDB/log/getAllArrData",e))(sA||{}),rA=(e=>(e.SET="/CommonDB/basicLibraryList/addData",e.GET="/CommonDB/basicLibraryList/getData",e.IS_EXIST="/CommonDB/basicLibraryList/isExist",e))(rA||{}),iA=(e=>(e.SET="/CommonDB/clipBoard/addData",e.GET="/CommonDB/clipBoard/getData",e.IS_EXIST="/CommonDB/clipBoard/isExist",e))(iA||{}),nA=(e=>(e.GET="/CommonDB/lockPrj/getData",e.READ_WRITE="/CommonDB/lockPrj/readwriteData",e))(nA||{}),aA=(e=>(e.GET="/CommonDB/prjCache/getData",e.SET="/CommonDB/prjCache/addData",e.DEL="/CommonDB/prjCache/delData",e.DEL_LOTS="/CommonDB/prjCache/delLotsData",e.GET_INDEXS="/CommonDB/prjCache/getAllIndexs",e.GET_COUNT="/CommonDB/prjCache/getCount",e.GET_EARLIEST="/CommonDB/prjCache/getEarliest",e))(aA||{}),_s={COMMON:$_,PROJECT:Q_,COPYANDPASTE:eA,COPYANDPASTE_TABLE_CELL:tA,LOG:sA,LIB:rA,CLIP_BOARD:iA,LOCK_PROJECT:nA,PROJECT_CACHE:aA},Yc=(e=>(e.CREATE="/pro-mgr/library/cbb/create",e.GET_EXPORT="/pro-mgr/library/cbb/getExport",e.GET_TARGET="/pro-mgr/library/cbb/getTarget",e.LIST="/pro-mgr/library/cbb/list",e.PLACE="/pro-mgr/library/cbb/place",e))(Yc||{}),oA=(e=>(e.CREATE="/pro-mgr/new/cloud/create",e.PROJECT="/pro-mgr/new/cloud/project",e.BOARD="/pro-mgr/new/cloud/board",e.SCHEMATIC="/pro-mgr/new/cloud/schematic",e.SHEET="/pro-mgr/new/cloud/sheet",e.SIMULATION="/pro-mgr/new/cloud/simulation",e.PCB="/pro-mgr/new/cloud/pcb",e.PANEL="/pro-mgr/new/cloud/panel",e))(oA||{}),cA=(e=>(e.BOARD="/pro-mgr/new/local/board",e.SCHEMATIC="/pro-mgr/new/local/schematic",e.SHEET="/pro-mgr/new/local/sheet",e.SIMULATION="/pro-mgr/new/local/simulation",e.PCB="/pro-mgr/new/local/pcb",e.PANEL="/pro-mgr/new/local/panel",e))(cA||{}),Ai={CLOUD:oA,LOCAL:cA},lA=(e=>(e.FORCE="/pro-mgr/project/updateData/force",e.SUSPEND="/pro-mgr/project/updateData/suspend",e.RESUME="/pro-mgr/project/updateData/resume",e.GET="/pro-mgr/project/updateData/getLastest",e.IS_PUBLIC="/pro-mgr/project/updateData/isPublic",e.UPDATE_TEAM="/pro-mgr/project/updateData/updateTeam",e))(lA||{}),uA=(e=>(e.UPDATE="/pro-mgr/project/updateData/schematic/update",e.GET="/pro-mgr/project/updateData/schematic/getData",e.MAP="/pro-mgr/project/updateData/schematic/map",e.NOTIFY="/pro-mgr/project/updateData/schematic/notify",e))(uA||{}),hA=(e=>(e.UPDATE="/pro-mgr/project/updateData/sheet/update",e.GET="/pro-mgr/project/updateData/sheet/getData",e.MAP="/pro-mgr/project/updateData/sheet/map",e.NOTIFY="/pro-mgr/project/updateData/sheet/notify",e))(hA||{}),dA=(e=>(e.UPDATE="/pro-mgr/project/updateData/pcb/update",e.GET="/pro-mgr/project/updateData/pcb/getData",e.MAP="/pro-mgr/project/updateData/pcb/map",e.NOTIFY="/pro-mgr/project/updateData/pcb/notify",e))(dA||{}),pA=(e=>(e.UPDATE="/pro-mgr/project/updateData/symbol/update",e.GET="/pro-mgr/project/updateData/symbol/getData",e.MAP="/pro-mgr/project/updateData/symbol/map",e.NOTIFY="/pro-mgr/project/updateData/symbol/notify",e))(pA||{}),fA=(e=>(e.UPDATE="/pro-mgr/project/updateData/footprint/update",e.GET="/pro-mgr/project/updateData/footprint/getData",e.MAP="/pro-mgr/project/updateData/footprint/map",e.NOTIFY="/pro-mgr/project/updateData/footprint/notify",e))(fA||{}),mA=(e=>(e.UPDATE="/pro-mgr/project/updateData/device/update",e.GET="/pro-mgr/project/updateData/device/getData",e.MAP="/pro-mgr/project/updateData/device/map",e.NOTIFY="/pro-mgr/project/updateData/device/notify",e))(mA||{}),Us={PUBLIC:lA,SCHEMATIC:uA,SHEET:hA,PCB:dA,SYMBOL:pA,FOOTPRINT:fA,DEVICE:mA},gA=(e=>(e.PROGRESS="/pro-ui/progressUpdate",e.OPENED_PROJECT="/pro-ui/project/openedProject",e.HAS_UNSAVED="/pro-ui/project/hasUnsaved",e.OPEN="/pro-ui/project/open",e.CLOSE="/pro-ui/project/close",e.ON_OPENED="/pro-ui/project/onOpened",e.ON_FAILED="/pro-mgr/project/onFailed",e.ON_CLOSED="/pro-ui/project/onClosed",e.ADD_HASH="/pro-ui/hash/add/id",e.REMOVE_HASH="/pro-ui/hash/remove/id",e))(gA||{}),yA=(e=>(e.ON_UPDATE="/pro-mgr/project/project/onUpdate",e.UPLOAD_FAILED="/pro-mgr/project/upload/onfailed",e))(yA||{}),EA=(e=>(e.ON_UPDATE="/pro-mgr/project/config/onUpdate",e))(EA||{}),bA=(e=>(e.ON_ADD="/pro-mgr/project/board/onAdd",e.ON_DELETE="/pro-mgr/project/board/onDelete",e.ON_UPDATE="/pro-mgr/project/board/onUpdate",e))(bA||{}),TA=(e=>(e.ON_ADD="/pro-mgr/project/schematic/onAdd",e.ON_DELETE="/pro-mgr/project/schematic/onDelete",e.ON_UPDATE="/pro-mgr/project/schematic/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/schematic/onUpdateTime",e))(TA||{}),wA=(e=>(e.ON_ADD="/pro-mgr/project/sheet/onAdd",e.ON_DELETE="/pro-mgr/project/sheet/onDelete",e.ON_UPDATE="/pro-mgr/project/sheet/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/sheet/onUpdateTime",e))(wA||{}),SA=(e=>(e.ON_ADD="/pro-mgr/project/pcb/onAdd",e.ON_DELETE="/pro-mgr/project/pcb/onDelete",e.ON_UPDATE="/pro-mgr/project/pcb/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/pcb/onUpdateTime",e))(SA||{}),_A=(e=>(e.ON_ADD="/pro-mgr/project/panel/onAdd",e.ON_DELETE="/pro-mgr/project/panel/onDelete",e.ON_UPDATE="/pro-mgr/project/panel/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/panel/onUpdateTime",e))(_A||{}),AA=(e=>(e.ON_ADD="/pro-mgr/project/simulation/onAdd",e.ON_DELETE="/pro-mgr/project/simulation/onDelete",e.ON_UPDATE="/pro-mgr/project/simulation/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/simulation/onUpdateTime",e))(AA||{}),CA=(e=>(e.ON_ADD="/pro-mgr/project/device/onAdd",e.ON_DELETE="/pro-mgr/project/device/onDelete",e.ON_UPDATE="/pro-mgr/project/device/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/device/onUpdateTime",e))(CA||{}),DA=(e=>(e.ON_ADD="/pro-mgr/project/symbol/onAdd",e.ON_DELETE="/pro-mgr/project/symbol/onDelete",e.ON_UPDATE="/pro-mgr/project/symbol/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/symbol/onUpdateTime",e))(DA||{}),PA=(e=>(e.ON_ADD="/pro-mgr/project/footprint/onAdd",e.ON_DELETE="/pro-mgr/project/footprint/onDelete",e.ON_UPDATE="/pro-mgr/project/footprint/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/footprint/onUpdateTime",e))(PA||{}),OA=(e=>(e.ON_ADD="/pro-mgr/project/attr/onAdd",e.ON_DELETE="/pro-mgr/project/attr/onDelete",e.ON_UPDATE="/pro-mgr/project/attr/onUpdate",e))(OA||{}),IA=(e=>(e.ON_ADD="/pro-mgr/project/blob/onAdd",e.ON_DELETE="/pro-mgr/project/blob/onDelete",e.ON_UPDATE="/pro-mgr/project/blob/onUpdate",e))(IA||{}),xA=(e=>(e.ON_ADD="/pro-mgr/project/variant/onAdd",e.ON_DELETE="/pro-mgr/project/variant/onDelete",e.ON_UPDATE_TITLE="/pro-mgr/project/variant/onUpdatetitle",e.ON_UPDATE_NOT_GROUPED="/pro-mgr/project/variant/onUpdateNotGrouped",e.ON_UPDATE_ZINDEX="/pro-mgr/project/variant/onUpdateZIndex",e.ON_ADD_COMPONENT_GROUP="/pro-mgr/project/variant/onAddComponentGroup",e.ON_DELETE_COMPONENT_GROUP="/pro-mgr/project/variant/onDeleteComponentGroup",e.ON_UPDATE_COMPONENT_GROUP_TITLE="/pro-mgr/project/variant/onUpdateComponentGroupTitle",e.ON_UPDATE_COMPONENT_GROUP_ZINDEX="/pro-mgr/project/variant/onUpdateComponentGroupZIndex",e.ON_UPLOAD_COMPONENT_GROUP_INDEX_IN_VARIANT="/pro-mgr/project/variant/onUploadComponentGroupZIndexInVariant",e.ON_DELETE_COMPONENT_GROUP_INDEX_IN_VARIANT="/pro-mgr/project/variant/onDeleteComponentGroupZIndexInVariant",e.ON_UPLOAD_COMPONENT_GROUP_DATA="/pro-mgr/project/variant/onUploadComponentGroupData",e.ON_DELETE_COMPONENT_GROUP_DATA="/pro-mgr/project/variant/onDeleteComponentGroupData",e))(xA||{}),As={PROJECT:yA,CONFIG:EA,BOARD:bA,SCHEMATIC:TA,SHEET:wA,PCB:SA,PANEL:_A,SIMULATION:AA,DEVICE:CA,SYMBOL:DA,FOOTPRINT:PA,ATTR:OA,BLOB:IA,VARIANT:xA},qs=class{constructor(e={}){this.needProgress=e.needProgress||!1,this.progressTip=e.progressTip||`${qr()}`,this.cur=e.cur||0,this.total=e.total||0}get options(){return{needProgress:this.needProgress,progressTip:this.progressTip,cur:this.cur,total:this.total}}get step(){return this.total}set step(e){this.total=e}update(e=!1){if(this.needProgress)if(e){let t={progress:1,title:this.progressTip};Je.messageBus.publish("/pro-ui/progressUpdate",t)}else{let t={progress:++this.cur/this.total,title:this.progressTip};Je.messageBus.publish("/pro-ui/progressUpdate",t)}}},pY=new Error("list is empty");async function Jm(e){let{dataStr:t,config:s,callback:r,options:i,autoClose:n=!0,notify:a}=e,o=s.uuid||await TS(t);try{let c={uuid:o,dataStr:t,config:s,options:i,notify:a},{message:l}=await Je.messageBus.rpcCall("/pro-mgr/project/tempOpenByString",c);if(!l.success)throw new Error("\u4E34\u65F6\u6253\u5F00\u5DE5\u7A0B\u5931\u8D25!",l.message);if(r){let u=await r(o);if(!u.success)return{success:!1,message:u.message}}return{success:!0}}catch(c){throw new Error("\u4E34\u65F6\u6253\u5F00\u5DE5\u7A0B\u5931\u8D25!",c)}finally{if(n){let{message:c}=await Je.messageBus.rpcCall("/pro-mgr/project/tempClose",[o]);if(!c.success)throw new Error("\u5173\u95ED\u4E34\u65F6\u5DE5\u7A0B\u5931\u8D25!",c.message)}}}async function vA(e){try{let{message:t}=await Je.messageBus.rpcCall("/pro-mgr/project/tempClose",[e]);if(!t.success)throw new Error("\u5173\u95ED\u4E34\u65F6\u5DE5\u7A0B\u5931\u8D25!",t.message);return{success:!0}}catch(t){throw new Error("\u5173\u95ED\u4E34\u65F6\u5DE5\u7A0B\u5931\u8D25!",t)}}var o6=(e=>(e.ALL_VALUE="@all",e.ALL_TITLE="All",e.ComponentSymbol="2",e.NetflagSymbol="18",e.NetportSymbol="19",e.DrawingSymbol="20",e.NonElectronicSymbol="21",e.OffPageConnectorSymbol="25",e.DiffPairsFlagSymbol="31",e))(o6||{});async function RA(){let e=await new Promise(t=>{fetch("/api/client/config",{method:"GET"}).then(s=>{s.json().then(r=>{t(r)})})});if(e&&e.success&&e.result){let t=e.result,s=t.projectDir instanceof Array?t.projectDir:[t.projectDir];return{basePath:t.appBaseDir,cbbPath:t.reuseBlock,libPath:t.systemLib,projectPath:s,onlinePrjBackupPath:t.appOnlineBackupDir,appBaseDir:t.appBaseDir,autoCheckVersionUpdate:!!t.checkUpdate,activation:t.activation,appTmpBackupDir:t.appTmpBackupDir,cacheDir:t.cacheDir,proxy:t.proxy,log:t.log}}else return null}function Km(e,t){let s=[],r=[];Lm?r=e:t&&t.length?r=t:r=e;let i=null;return r.forEach(n=>{n.uuid===nt.SYSTEMLIB_UUID?i={title:n.nickname,id:n.uuid,key:nt.LIB_SYSTEM_KEY}:s.push({title:n.nickname,id:n.uuid,key:nt.LIB_PERSONAL_KEY})}),i&&s.unshift(i),s}async function Xm(e,t){let s=Km(e,t)||[],r=[],i=null;return s.forEach((n,a)=>{n.id===nt.SYSTEMLIB_UUID?i=a:r.push({title:n.title,id:n.id,key:n.key})}),(i||i===0)&&r.splice(0,0,{title:s[i].title,id:s[i].id,key:s[i].key}),r.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...r]}async function c6(e,t){let s=await RA();if(!s)return await Xm(e,t);let r=Km(e,t),i=li(r,"id",nt.SYSTEMLIB_UUID),n=[];i.index>=0&&n.splice(0,0,{...i.data});let{projectPath:a,cbbPath:o,libPath:c=[],onlinePrjBackupPath:l,autoCheckVersionUpdate:u}=s;return c.forEach(h=>{n.push({title:y2(h),id:h,key:h})}),n.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...n]}function l6(e,t,s,r){let i=[],n=[],a={},o=[];return e.forEach(c=>{switch(c.titleAdditional=c.title,c.title){case"Project":{if(!r||!s||!s.uuid)return;c.id=s.uuid,o.push(s.uuid);break}default:}c.id||(c.id="@"+ed(new Date().getTime())),typeof a[c.id]<"u"?(a[c.id]+=1,c.id=c.id+nt.LIB_SPLIT_TAG+a[c.id]):a[c.id]=0,t&&t.indexOf(c.id)>=0&&n.push(c.id),i.push(c)}),{treeData:i,projectsIds:o,selectedIds:n}}async function NA(e,t){let s=Km(e,t)||[],r=[],i=null;return s.forEach((n,a)=>{n.id===nt.SYSTEMLIB_UUID?i=a:r.push({title:n.title,id:n.id,key:n.key})}),(i||i===0)&&r.splice(0,0,{title:s[i].title,id:s[i].id,key:s[i].key}),r.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...r]}async function u6(e,t){let s=await RA();if(!s)return await Xm(e,t);let r=[],{projectPath:i,cbbPath:n,libPath:a=[],onlinePrjBackupPath:o,autoCheckVersionUpdate:c}=s;return a.forEach(l=>{r.push({title:y2(l),id:l,key:l})}),r.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...r]}function h6(e,t,s,r){let i=[],n=[],a={},o=[];return e.forEach(c=>{switch(c.titleAdditional=c.title,c.title){case"Project":{if(!r||!s||!s.uuid)return;c.id=s.uuid,o.push(s.uuid);break}default:}c.id||(c.id="@"+ed(new Date().getTime())),typeof a[c.id]<"u"?(a[c.id]+=1,c.id=c.id+nt.LIB_SPLIT_TAG+a[c.id]):a[c.id]=0,t&&t.indexOf(c.id)>=0&&n.push(c.id),i.push(c)}),{treeData:i,projectsIds:o,selectedIds:n}}function LA(e,t){let s=[],r=[];return Lm?r=e:t&&t.length?r=t:r=e,r.forEach(i=>{s.push({title:i.nickname,id:i.uuid,key:nt.LIB_TEMAS_KEY})}),s}async function Rm(e,t){let s=LA(e,t);return[{title:"System",id:nt.SYSTEMLIB_UUID,key:nt.LIB_SYSTEM_KEY},{title:"Project",id:"",key:nt.LIB_PROJECT_KEY},{title:"Personal",id:"",key:nt.LIB_PERSONAL_KEY},{title:"Favorite",id:nt.FAVORITELIB_UUID,key:nt.LIB_FAVORITE_KEY},...s]}function BA(e,t,s,r,i){let n=[],a=[],o={},c=[];return e.forEach(l=>{switch(l.title){case"Project":{if(!i||!r||!r.uuid)return;l.id=r.uuid,c.push(r.uuid);break}case"Personal":{if(!s||!s.uuid)return;l.id=s.uuid;break}case"Public":{l.id=nt.PUBLICLIB_ALIAS;break}default:}l.id||(l.id="@"+ed(new Date().getTime())),typeof o[l.id]<"u"?(o[l.id]+=1,l.id=l.id+nt.LIB_SPLIT_TAG+o[l.id]):o[l.id]=0,t&&t.indexOf(l.id)>=0&&a.push(l.id),n.push(l)}),{treeData:n,projectsIds:c,selectedIds:a}}async function W1(e,t){return await Rm(e,t)}function d6(e,t,s,r,i){return BA(e,t,s,r,i)}async function kA(e,t,s,r,i,n){let a=[];return e==="Normal"?vn?mm?(a=await W1(t,s),n&&em(a),a):fm?(a=await Xm(t,s),n&&em(a),a):(a=await NA(t,s),n&&em(a),a):(a=await Rm(t,s),n&&em(a),a):e==="D3Model"?vn?mm?(a=await W1(t,s),a):fm?(a=await c6(t,s),a):(a=await u6(t,s),a):(a=await Rm(t,s),a):[]}function em(e){let t=li(e,"key",nt.LIB_PROJECT_KEY);t.index>=0&&e.splice(t.index,1)}function MA(e,t,s,r,i,n,a){if(!vn){let c=BA(e,s,r,i,typeof n<"u"?!!n:a);return tm(c,t),sm(c)}if(mm){let c=d6(e,s,r,i,typeof n<"u"?!!n:a);return tm(c,t),sm(c)}if(fm){let c=l6(e,s,i,typeof n<"u"?!!n:a);return tm(c,t),sm(c)}let o=h6(e,s,i,typeof n<"u"?!!n:a);return tm(o,t),sm(o)}function tm(e,t){let s=li(e.treeData,"key",nt.LIB_SYSTEM_KEY);s.index>=0&&e.treeData.splice(s.index,1);let r=li(e.treeData,"key",nt.LIB_PERSONAL_KEY);r.index>=0&&e.treeData.splice(r.index,1);let i=li(e.treeData,"key","project");i.index>=0&&e.treeData.splice(i.index,1);let n=li(e.treeData,"key",nt.LIB_FAVORITE_KEY);n.index>=0&&e.treeData.splice(n.index,1);let a=li(e.treeData,"key","selected");a.index>=0&&e.treeData.splice(a.index,1);let o=li(e.treeData,"key","oshwhub");o.index>=0&&e.treeData.splice(o.index,1),e.treeData.sort((c,l)=>(c.title||"").localeCompare(l.title||"")),n.index>=0&&e.treeData.unshift(n.data),i.index>=0&&e.treeData.unshift(i.data),t==="Personal"?Lm||r.index>=0&&e.treeData.unshift(r.data):e.selectedIds=e.selectedIds.filter(c=>{var l;return c!==((l=r==null?void 0:r.data)==null?void 0:l.id)}),o.index>=0&&e.treeData.unshift(o.data),s.index>=0&&e.treeData.unshift(s.data),a.index>=0&&e.treeData.push(a.data)}function sm(e){return e.selectedIds.length?e.selectedIds:e.selectedIds.push(e.treeData[0].id),e}async function p6(e,t,s,r,i,n,a,o,c=!0,l=!0,u=!0){let h={username:n.username,uuid:n.uuid},{projectId:p,title:d,isCBB:f}=i,m={uuid:p,title:d,isCBB:f},g=await kA(t,a,o,e,s,c),b=MA(g,r,[],h,m,!c),E=[];for(let y=0;y<b.treeData.length;y++){let T=b.treeData[y];T.id===nt.SYSTEMLIB_UUID&&l||T.id===nt.FAVORITELIB_UUID&&u||(km||Mm||T.key===nt.LIB_PERSONAL_KEY&&(T.title=T.titleAdditional=h.username),T.title&&E.push(T))}return E}var f6=(e=>(e.Normal="Normal",e.D3Model="D3Model",e.AssociateDeviceDialog="associateDeviceDialog",e.Cbb="Cbb",e))(f6||{}),Ni,fY=(Ni=class{},Ni.createInitLibList=kA,Ni.createFixLibList=p6,Ni.filterInitLibList=MA,Ni.fetchTeamsLibsFromGVars=LA,Ni.fetchClientTeamsLibsFromGVars=Km,Ni.createSourceLibListByWebMode=Rm,Ni.createSourceLibListByOnlineClientMode=W1,Ni.createSourceLibListByOfflineClientMode=NA,Ni.createSourceLibListByHalfofflineClientMode=Xm,Ni),lu,mY=(lu=class{},lu.syncLoginedUserInfo=t=>{Je.loginedUserUuid=t.uuid},lu);var m6=(e=>(e.PROJECT="project.json",e.DEVICE="device.json",e.SYMBOL="symbol.json",e.FOOTPRINT="footprint.json",e.PANEL_LIB="panel-lib.json",e.PROJECT2="project2.json",e.DEVICE2="device2.json",e.SYMBOL2="symbol2.json",e.FOOTPRINT2="footprint2.json",e.PANEL_LIB2="panel-lib2.json",e))(m6||{}),g6=(e=>(e.EXPORT_DEVICE="EXPORT_DEVICE",e.EXPORT_SYMBOL="EXPORT_SYMBOL",e.EXPORT_FOOTPRINT="EXPORT_FOOTPRINT",e.EXPORT_PANEL_LIB="EXPORT_PANEL_LIB",e))(g6||{});Ov();var Zm=null,xE=new ArrayBuffer(8),OE=new Float64Array(xE),IE=new Uint32Array(xE),jA=new Uint16Array(xE),y6=self[["e","v","a","l"].join("")];var Ki=class{static repeat(t,s){let r=new Array(s);for(;s-- >0;)r[s]=t;return r.join("")}static lpad(t,s,r){let i=r-t.length;return i>0?this.repeat(s,i)+t:t}static rpad(t,s,r){let i=r-t.length;return i>0?t+this.repeat(s,i):t}static strHashcode(t){if(t.length>0){let s=0;for(let r=0;r<t.length;r++)s=31*s+t.charCodeAt(r)|0;return s}else return 0}static arraycopy(t,s,r,i,n){if(t.length>=s+n&&r.length>=i+n)for(;n-- >0;)r[i++]=t[s++];else throw new Error("arraycopy out of range")}static undefAsNull(t){return null}static reverse(t,s){for(let r=0,i=t.length-1;i>=0;r++,i--)s[r]=t[i];return s}static sortAsc(t,s){return t-s}static xmlDecode(t){let s=t.length,r=new Array,i=-1;for(let n=0;n<s;n++){let a=t.charAt(n);if(i>=0){if(a===";"){let o=t.substring(i+1,n);switch(o){case"lt":r.push("<");break;case"gt":r.push(">");break;case"quot":r.push('"');break;case"apos":r.push("'");break;case"amp":r.push("&");break;default:if(o.charAt(0)==="#"){let c=parseInt(o.substring(1));r.push(String.fromCharCode(c))}else r.push("&"+o+";")}i=-1}}else a==="&"?i=n:r.push(a)}return i>=0&&r.push(t.substring(i)),r.join("")}static addAll(t,s){for(let r of s)t.push(r)}static contains(t,s){for(let r of t)if(r.equals(s))return!0;return!1}static equals(t,s){if(t.length==s.length){for(let r=0;r<t.length;r++)if(t[r]!==s[r])return!1;return!0}else return!1}static remove(t,s){let r=0,i=t.length;for(let n=0;n<i;n++)t[n]===s&&(t.splice(n,1),n--,i--,r++);return r}static getUrlVars(){for(var t={},s=location.href.slice(location.href.indexOf("?")+1).split("&"),r=0;r<s.length;r++){var i=s[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}static prefix(){if(!Zm){let t=this.getUrlVars().version;t?Zm="/analyzer/v"+t:Zm="/analyzer"}return Zm}static add2objS(t,s,r){if(s in t)return t[s];{let i=r(s);return t[s]=i,i}}static downloadFile(t,s){let r=document.createElement("a"),i=URL.createObjectURL(s);r.download=t,r.href=i,r.click(),URL.revokeObjectURL(i)}static uuid(){let t=new Array;OE[0]=new Date().getTime(),t.push(IE[1].toString(16)),OE[0]=Math.random(),t.push(jA[3].toString(16));let s=jA[2].toString(16);t.push("4"+s.substr(0,3)),OE[0]=performance.now();let r=IE[0].toString(16)+IE[1].toString(16);return t.push("0"+r.substr(0,3)),t.push(r.substr(3)),t.join("-")}static funcCopy(t){return y6("("+t.toString()+")")}static NVL(...t){for(let s of t)if(s!==null)return s;return null}};var $m=class{static rgb(t){if(0<=t&&t<=255)return t;throw new Error(Ka.format("RGB should not nagative and not over 255(0xFF): %X",t))}static normal(t){if(isFinite(t))return t;throw new Error(Ka.format("%f is not permitted",t))}static positiveOr0(t){if(t>=0)return t;throw new Error(Ka.format("%f must >= 0",t))}static positive(t){if(t>0)return t;throw new Error(Ka.format("%f must > 0",t))}static notnull(t){if(t!=null)return t;throw new Error("invalid null value")}static mustnull(t){if(t===null)return null;throw new Error("value must be null")}static notEmpty(t){if(t==null||t.length===0)throw new Error("invalid empty string");return t}static nullOrEmpty(t){return t==null||t.length===0}static notNullOrUndef(t){if(t!=null)return t;throw new Error("null or undefined is not permitted")}};var E6=/(\.?0+)$/,Ka=class{static format(t,...s){return this.format1(t,s)}static format1(t,s){let r=this._format(t,s);if(typeof r=="string")return r;throw new Error(this.format("Invalid state on (%d) %s",r,t))}static _format(t,s){let r=[],i=0,n=0,a,o=0,c=0;for(let l=0;l<t.length;l++){let u=t.charAt(l),h=u.charCodeAt(0);switch(i){case 0:h===37?i=1:r.push(u);break;case 1:switch(h){case 100:if(a=s[n++],typeof a=="number")r.push(a.toFixed(0)),i=0;else return l;break;case 102:if(a=s[n++],typeof a=="number")r.push(a.toString()),i=0;else return l;break;case 120:if(a=s[n++],typeof a=="number")r.push((a|0).toString(16)),i=0;else return l;break;case 88:if(a=s[n++],typeof a=="number")r.push((a|0).toString(16).toUpperCase()),i=0;else return l;break;case 115:case 99:a=s[n++],r.push(a===null?"null":a.toString()),i=0;break;case 48:o=l+1,c=-1,i=2;break;case 37:r.push("%"),i=0;break;default:return l}break;case 2:switch(h){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:c=l;break;case 100:if(c>=o){let p=parseInt(t.substring(o,c+1));if(a=s[n++],typeof a=="number")r.push(Ki.lpad((a|0).toString(10),"0",p)),i=0;else return l}else return l;break;case 120:if(c>=o){let p=parseInt(t.substring(o,c+1));if(a=s[n++],typeof a=="number")r.push(Ki.lpad((a|0).toString(16),"0",p)),i=0;else return l}else return l;break;case 88:if(c>=o){let p=parseInt(t.substring(o,c+1));if(a=s[n++],typeof a=="number")r.push(Ki.lpad((a|0).toString(16).toUpperCase(),"0",p)),i=0;else return l}else return l;break;default:return l}break;default:return l}}return r.join("")}static startsWith(t,s){return t.length>=s.length?t.substring(0,s.length)===s:!1}static endsWith(t,s){return t.length>=s.length?t.substring(t.length-s.length)===s:!1}static split(t,s){let r=new Array,i=0;for(;;){let n=t.exec(s);if(n!==null){let a=t.lastIndex-n[0].length;r.push(s.substring(i,a)),i=t.lastIndex}else{let a=s.substring(i);$m.nullOrEmpty(a)||r.push(a);break}}return r}static fmtNumber(t){return t.toFixed(5).replace(E6,"")}};function b6(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var T6=(e,t)=>{e===3?console.error(...t):e===2?console.warn(...t):console.log(...t)},w6=(e,t)=>[b6(e)].concat(t),Tu=class Tu{static mix(...t){return new Tu(0,(s,r)=>{for(let i of t)i.write(s,r)},(s,r)=>r)}constructor(t,s=T6,r=w6){this.level=t,this.writer=s,this.fmt=r}setLevel(t){this.level=t}prepend(t=null,s=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),i=s===null?this.writer:(n,a)=>{s(n,a),this.writer(n,a)};return new Tu(this.level,i,r)}chain(t){return t.prepend(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}formatWrite(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,[Ka.format(s,...r)]))}write(t,s){this.include(t)&&this.writer(t,this.fmt(t,s))}debugFmt(t,...s){this.formatWrite(0,t,s)}debug(...t){this.write(0,t)}infoFmt(t,...s){this.formatWrite(1,t,s)}info(...t){this.write(1,t)}warningFmt(t,...s){this.formatWrite(2,t,s)}warning(...t){this.write(2,t)}errorFmt(t,...s){this.formatWrite(3,t,s)}error(...t){this.write(3,t)}};Tu.DUMMY=new Tu(4);var ut=Tu;var wu=class{constructor(){if(!crypto||!crypto.subtle)throw new Error("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301crypto api");this.tool=crypto.subtle}};var Go=class extends wu{constructor(){super()}async init(t){try{return this.keyBuffer=t.key,this.key=await this.setKey(this.keyBuffer),this.iv=await this.setIV(t.iv),this}catch{throw new Error(`invalid key or iv! ${t}`)}}setKey(t){if(t instanceof ArrayBuffer)return this.tool.importKey("raw",t,"AES-GCM",!0,["encrypt","decrypt"]);throw new Error(`invalid key! ${t}`)}setIV(t){if(t instanceof ArrayBuffer)return t;throw new Error(`invalid iv! ${t}`)}encrypt(t){return this.tool.encrypt({name:"AES-GCM",iv:this.iv},this.key,t)}decrypt(t){return this.tool.decrypt({name:"AES-GCM",iv:this.iv},this.key,t)}decrypt2(t){return this.tool.decrypt({name:"AES-GCM",iv:this.iv,tagLength:128},this.key,t)}getKey(){return this.keyBuffer}getIV(){return this.iv}};function Qm(e){let t=e.reduce((i,n)=>i+n.length,0),s=new Uint8Array(t),r=0;return e.forEach(i=>{s.set(i,r),r+=i.length}),s}function Xa(e){return new TextEncoder().encode(e)}function un(e,t="utf-8"){var s=new TextDecoder(t);return s.decode(e)}function eg(e,t="application/octet-stream"){let s=Array.isArray(e)?e:[e];return new Blob(s,{type:t})}function Su(e){var t=new Uint8Array(e.match(/[\da-f]{2}/gi).map(function(s){return parseInt(s,16)}));return t.buffer}var{IS_EASYEDA:KW,IS_LCEDA:XW,IS_CLIENT:Za,IS_PRIVATE:da,IS_ONLINE:FA,IS_OFFLINE:ZW,IS_HALF_OFFLINE:$W,IS_DEV:QW,IS_ECAD:eq}=J1,ve=Za&&!FA,_u=Za&&FA;async function UA(e,t,s){return new Promise((r,i)=>{let n=indexedDB.open(e,t);n.onupgradeneeded=()=>{let a=n.result;console.log("openRequest.onupgradeneeded",a.name,a.version),s(a)},n.onsuccess=()=>{let a=n.result;console.log("openRequest.onsuccess",a.name),r(new vE(a))},n.onerror=()=>{console.error("openRequest.onerror",n.error),i(n.error)},n.onblocked=a=>{console.error("openRequest.onblocked",a),i(a)}})}var vE=class{constructor(t){this.db=t}store(t,s,r=!0){return new sg(t,this,s,r)}async transaction(t,s="readwrite"){let r;return Array.isArray(t)?r=this.db.transaction(t.map(i=>i.name),s):r=this.db.transaction(t.name,s),s!=="readonly"&&(r.onabort=i=>{console.error(i)}),r.onerror=i=>{console.error(i)},r}delete(){return new Promise((t,s)=>{let r=this.db.name,i=indexedDB.deleteDatabase(r);i.onupgradeneeded=n=>{console.log("Database deleted onupgradeneeded...",r,n),s(n)},i.onsuccess=n=>{console.log("Database deleted successfully...",r,n),t(!0)},i.onerror=n=>{console.error("Database deleted failed...",r,n),s(n)},i.onblocked=n=>{console.error("Database deleted onblocked...",r,n),s(n)}})}close(){this.db.close()}createObjectStore(t,s){return this.db.createObjectStore(t,s)}},tg=class{get(t,s){return this.exec(s,(r,i,n)=>{if(!t)return n();let a=r.get(t);$a(a,i,n)})}getAll(t,s,r){return this.exec(r,(i,n,a)=>{let o=i.getAll(t,s);$a(o,n,a)})}getAllBound(t,s,r,i,n,a){return this.getAll(IDBKeyRange.bound(t,s,r,i),n,a)}getAllLB(t,s,r,i){return this.getAll(IDBKeyRange.lowerBound(t,s),r,i)}getAllUB(t,s,r,i){return this.getAll(IDBKeyRange.upperBound(t,s),r,i)}getAllKeys(t,s,r){return this.exec(r,(i,n,a)=>{let o=i.getAllKeys(t,s);$a(o,n,a)})}getAllKeysBound(t,s,r,i,n,a){return this.getAllKeys(IDBKeyRange.bound(t,s,r,i),n,a)}getAllKeysLB(t,s,r,i){return this.getAllKeys(IDBKeyRange.lowerBound(t,s),r,i)}getAllKeysUB(t,s,r,i){return this.getAllKeys(IDBKeyRange.upperBound(t,s),r,i)}getKey(t,s){return this.exec(s,(r,i,n)=>{let a=r.getKey(t);$a(a,i,n)})}getKeyBound(t,s,r,i,n){return this.getKey(IDBKeyRange.bound(t,s,r,i),n)}getKeyLB(t,s,r){return this.getKey(IDBKeyRange.lowerBound(t,s),r)}getKeyUB(t,s,r){return this.getKey(IDBKeyRange.upperBound(t,s),r)}getKeyOnly(t,s){return this.getKey(IDBKeyRange.only(t),s)}itorAll(t,s,r,i){return this.exec(i,(n,a,o)=>{let c=n.openCursor(s,r);c.onerror=()=>{o(c.error)},c.onsuccess=async()=>{let l=c.result;if(l)try{let u=t(l.key,l.value,h=>new Promise((p,d)=>{let f=l.update(h);$a(f,p,d)}));u instanceof Promise&&(u=await u),u!==!1&&l.continue()}catch(u){o(u)}else a()}})}itorAllKeys(t,s,r,i){return this.exec(i,(n,a,o)=>{let c=n.openKeyCursor(s,r);c.onerror=()=>{o(c.error)},c.onsuccess=async()=>{let l=c.result;if(l)try{let u=t(l.primaryKey,l.key,h=>new Promise((p,d)=>{let f=l.update(h);$a(f,p,d)}));u instanceof Promise&&(u=await u),u!==!1&&l.continue()}catch(u){o(u)}else a()}})}count(t,s){return this.exec(s,(r,i,n)=>{let a=r.count(t);$a(a,i,n)})}},sg=class extends tg{constructor(s,r,i,n=!0){super();this.name=s;this.sdb=r;this.options=i;this.verifySwitch=n}exec(s,r){return new Promise(async(i,n)=>{try{s=s||await this.sdb.transaction(this);let a=s.objectStore(this.name);r(a,i,n)}catch(a){n(a)}})}getIndex(s,r,i=!1){return new rg(this.name,s,this.sdb,r,i)}put(s,r,i){return this.exec(i,(n,a,o)=>{if(this.verifySwitch&&!s)return o();let c=n.put(r,s);$a(c,a,o)})}delete(s,r){return this.exec(r,(i,n,a)=>{if(!s)return a();let o=i.delete(s);$a(o,n,a)})}clear(s){return this.exec(s,(r,i,n)=>{let a=r.clear();a.onsuccess=()=>{i(!0)},a.onerror=()=>{n(new Error("Failed to clear data!"))}})}init(){return this.sdb.createObjectStore(this.name,this.options)}},rg=class extends tg{constructor(s,r,i,n=r,a=!1){super();this.name=s;this.index=r;this.sdb=i;this.keys=n;this.unique=a}exec(s,r){return new Promise(async(i,n)=>{try{s=s||await this.sdb.transaction(this);let o=s.objectStore(this.name).index(this.index);r(o,i,n)}catch(a){n(a)}})}init(s){return s.createIndex(this.index,this.keys,{unique:this.unique})}};function $a(e,t,s){e.onsuccess=()=>{t(e.result)},e.onerror=()=>{s(e.error)}}var RE=class{constructor(t){this.cacheName=t}async open(){try{this.cache=await caches.open(this.cacheName)}catch(t){fe.messageBus.publish("/pro-ui/cacheStorageFailWaring"),console.error("Cache Storage cannot be opened properly",t),this.cache=null}}async put(t,s,r){try{return await this.cache.put(t,s.clone())}catch(i){if(console.error(i),!r&&(i==null?void 0:i.name)==="NotFoundError")return await this.open(),this.put(t,s,!0)}}async match(t,s,r){try{return this.cache.match(t)}catch(i){if(console.error(i),!r&&(i==null?void 0:i.name)==="NotFoundError")return await this.open(),this.match(t,s,!0)}}async flowStrMatch(t,s,r,i){var n,a;try{let o=await this.cache.match(t),c=new gd;if(o!=null&&o.body){let l=o.body.getReader();for((n=s==null?void 0:s.start)==null||n.call(s);;){let u=await l.read();if(u.value){let h=c.write(u.value);h&&s.update(h)}if(u.done){let h=c.end();h&&s.update(h),(a=s==null?void 0:s.end)==null||a.call(s);break}}return!0}return!1}catch(o){return console.error(o),!i&&(o==null?void 0:o.name)==="NotFoundError"?(await this.open(),this.flowStrMatch(t,s,r,!0)):!1}}async keys(t,s,r){try{return this.cache.keys(t,s)}catch(i){if(console.error(i),!r&&(i==null?void 0:i.name)==="NotFoundError")return await this.open(),this.keys(t,s,!0)}}async delete(t,s,r){try{return this.cache.delete(t,s)}catch(i){if(console.error(i),!r&&(i==null?void 0:i.name)==="NotFoundError")return await this.open(),this.delete(t,s,!0)}}};async function Au(e){let t=new RE(e);return await t.open(),t}var yd=class{constructor(t,s){this.keyPath=t,this.index=Array.isArray(t)?t.join("_"):t,this.cache=s,this.data={},this.keyValue={}}getPathStr(t,s){if(typeof s!="object")return null;if(typeof t=="string")return{key:s[t],value:s[t]};{let r=[];for(let i=0;i<t.length;++i){let n=s[t[i]];if(n===void 0)return null;r.push(n)}return{key:r.join("_"),value:r}}}update(t,s,r){let{key:i}=this.getPathStr(this.keyPath,s)||{},{key:n,value:a}=this.getPathStr(this.keyPath,t)||{};if(!(i&&n&&i===n)){if(i){let o=this.data[i];o!==void 0&&o.delete(r),o.size<1&&(delete this.data[i],delete this.keyValue[i])}n&&(this.data[n]||(this.data[n]=new Set,this.keyValue[n]=a),this.data[n].add(r))}}count(t){var r;let s=Object.keys(this.data);if(t)return t=Array.isArray(t)?t.join("_"):t,((r=this.data[t])==null?void 0:r.size)||0;{let i=0;return s.forEach(n=>{i+=this.data[n].size}),i}}async get(t){t=Array.isArray(t)?t.join("_"):t;let s=this.data[t];if(!s)return;let r=Array.from(s)[0];return await this.cache.getLocalDataByKey(r)}judgeIDBValidKey(t,s){let r=this.keyValue[t];return s.includes(r)}filterByIDBValidKey(t,s){let r=this;return t.filter(i=>r.judgeIDBValidKey(i,s))}async getAll(t,s){let r=this;if(t instanceof IDBKeyRange){let i=Object.keys(this.data);i=r.filterByIDBValidKey(i,t),s&&i.length>s&&(i=i.slice(0,s));let n=[];for(let o=0;o<i.length;o++){let c=i[o],l=this.data[c];if(l){let u=Array.from(l);for(let h=0;h<u.length;h++){let p=u[h],d=r.cache.getLocalDataByKey(p);n.push(d)}}}return await Promise.all(n)}else if(t){t=Array.isArray(t)?t.join("_"):t;let i=this.data[t],n=i?Array.from(i):[];s&&n.length>s&&(n=n.slice(0,s));let a=[];for(let c=0;c<n.length;c++){let l=await r.cache.getLocalDataByKey(n[c]);a.push(l)}return await Promise.all(a)}else{let i=Object.keys(this.data);s&&i.length>s&&(i=i.slice(0,s));let n=[];for(let o=0;o<i.length;o++){let c=i[o],l=this.data[c];if(l){let u=Array.from(l);for(let h=0;h<u.length;h++){let p=u[h],d=r.cache.getLocalDataByKey(p);n.push(d)}}}return Promise.all(n)}}getAllBound(t,s,r,i,n){return this.getAll(IDBKeyRange.bound(t,s,r,i),n)}getAllLB(t,s,r){return this.getAll(IDBKeyRange.lowerBound(t,s),r)}getAllUB(t,s,r){return this.getAll(IDBKeyRange.upperBound(t,s),r)}getKey(t){let s=this;if(t instanceof IDBKeyRange){let i=null;Object.keys(this.data).some(a=>s.judgeIDBValidKey(a,t)?(i=a,!0):!1);let n=i&&s.data[i]?Array.from(s.data[i])[0]:void 0;return n&&s.cache.getOriginKeys(n)}t=Array.isArray(t)?t.join("_"):t;let r=this.data[t]?Array.from(this.data[t])[0]:void 0;return r&&s.cache.getOriginKeys(r)}getAllKeys(t,s){let r=this;if(t instanceof IDBKeyRange){let i=Object.keys(this.data);i=r.filterByIDBValidKey(i,t),s&&i.length>s&&(i=i.slice(0,s));let n=[];return i.forEach(a=>{let o=r.data[a]?Array.from(r.data[a]):[];n.push(...o)}),n&&r.cache.getOriginKeys(n)}else if(t){t=Array.isArray(t)?t.join("_"):t;let i=this.data[t],n=i?Array.from(i):[];return s&&n.length>s&&(n=n.slice(0,s)),n&&r.cache.getOriginKeys(n)}else{let i=Object.keys(this.data);s&&i.length>s&&(i=i.slice(0,s));let n=[];return i.forEach(a=>{let o=r.data[a]?Array.from(r.data[a]):[];n.push(...o)}),n&&r.cache.getOriginKeys(n)}}getAllKeysBound(t,s,r,i,n){return this.getAllKeys(IDBKeyRange.bound(t,s,r,i),n)}getAllKeysLB(t,s,r){return this.getAllKeys(IDBKeyRange.lowerBound(t,s),r)}getAllKeysUB(t,s,r){return this.getAllKeys(IDBKeyRange.upperBound(t,s),r)}getKeyBound(t,s,r,i){return this.getKey(IDBKeyRange.bound(t,s,r,i))}getKeyLB(t,s){return this.getKey(IDBKeyRange.lowerBound(t,s))}getKeyUB(t,s){return this.getKey(IDBKeyRange.upperBound(t,s))}getKeyOnly(t){return this.getKey(IDBKeyRange.only(t))}getKeyCursor(t,s){let r=this;if(t instanceof IDBKeyRange){let i=Object.keys(this.data);i=r.filterByIDBValidKey(i,t),s&&i.length>s&&(i=i.slice(0,s));let n=[];return i.forEach(a=>{let o=r.data[a]?Array.from(r.data[a]):[];n.push(...o.map(c=>({primaryKey:c,key:r.keyValue[a]})))}),n}else if(t){t=Array.isArray(t)?t.join("_"):t;let i=this.data[t],n=i?Array.from(i):[];return s&&n.length>s&&(n=n.slice(0,s)),n.map(a=>({primaryKey:a,key:r.keyValue[t]}))}else{let i=Object.keys(this.data);s&&i.length>s&&(i=i.slice(0,s));let n=[];return i.forEach(a=>{let o=r.data[a]?Array.from(r.data[a]):[];n.push(...o.map(c=>({primaryKey:c,key:r.keyValue[a]})))}),n}}itorAllKeys(t,s){let r=this;return new Promise(async(i,n)=>{let a=r.getKeyCursor(s);for(let o=0;o<a.length;++o){let c=a[o];if(c)try{let l=t(c.primaryKey,c.key,u=>new Promise(async(h,p)=>{try{await r.cache.put(c.primaryKey,u),h(c.primaryKey)}catch{h(null)}}));if(l instanceof Promise&&(l=await l),l===!1){i(!0);break}}catch(l){n(l)}else i(!1)}i(!0)})}},Os=class{constructor(t,s,r,i,n){this.cache=r,this.chartName=s||"",this.contentType=i||"application/json",this.cacheName=t,this.localData={},this.cacheIndexes={},this.afterGet=n}async getLocalDataByKey(t){let s=this.getLocalData(t);return this.afterGet&&(s=await this.afterGet(s)),s}async init(){return ve?null:!this.cache&&(this.cache=await Au(this.cacheName),!this.cache)?!1:(Object.keys(this.cacheIndexes).length&&await this.getAll(!0),!0)}getIndex(t){let s=typeof t=="string"?t:t.join("_");return this.cacheIndexes[s]||(this.cacheIndexes[s]=new yd(t,this)),this.cacheIndexes[s]}getLocalData(t){if(this.localData[t]){let s=this.localData[t],i=new TextDecoder().decode(s);return JSON.parse(i)}}setLocalData(t,s){if(typeof s!="object")return;let r=JSON.stringify(s),n=new TextEncoder().encode(r).buffer;this.localData[t]=n}updateLocalData(t,s){let r=this.getLocalData(t);this.setLocalData(t,s),this.updateCacheIndex(s,r,t)}deleteLocalData(t){let s=this.getLocalData(t);s&&(delete this.localData[t],this.updateCacheIndex(void 0,s,t))}updateCacheIndex(t,s,r){let i=Object.keys(this.cacheIndexes);for(let n=0;n<i.length;++n)this.cacheIndexes[i[n]].update(t,s,r)}async getAll(t,s,r){!s&&this.chartName&&(s=`${location.origin}/${this.chartName}`,r=Object.assign(r||{},{ignoreSearch:!0}));let i=await this.cache.keys(s,r),n=[];for(let a=0;a<i.length;a++){let o=i[a],c=await this.get(o,t);c&&n.push(c)}return n}async getAllKeys(t){let s,r;this.chartName&&(s=`${location.origin}/${this.chartName}`,r=Object.assign(r||{},{ignoreSearch:!0}));let n=(await this.cache.keys(s,r)).map(a=>a.url);if(t){let[a,o,c,l]=t;c&&l?n=n.filter(u=>u>a&&u<o):c?n=n.filter(u=>u>a&&u<=o):l?n=n.filter(u=>u>=a&&u<o):n=n.filter(u=>u>=a&&u<=o)}return this.getOriginKeys(n)}async resolveResponse(t){let s=t.headers.get("Content-Type"),r;try{switch(s){case"application/json":r=await t.clone().json();break;case"application/pdf":case"application/zip":case"application/blob":case"image/jpeg":case"image/png":case"audio/mpeg":case"video/mp4":case"image/gif":case"zip":r=await t.clone().blob();break;case"application/octet-stream":r=await t.clone().arrayBuffer();break;case"text/html":case"application/xml":let i=await t.clone().text();r=new DOMParser().parseFromString(i,"text/html");default:r=await t.clone().text()}return r}catch{try{return r=await t.clone().text(),r}catch(n){throw new Error(n)}}}getOriginKeys(t){var s,r,i,n;return Array.isArray(t)?this.chartName?t.map(a=>{var o,c;return((c=(o=new URL(a))==null?void 0:o.searchParams)==null?void 0:c.get("key"))||a}):t.map(a=>{var o,c;return((c=(o=new URL(a))==null?void 0:o.pathname)==null?void 0:c.slice(1))||a}):this.chartName?((r=(s=new URL(t))==null?void 0:s.searchParams)==null?void 0:r.get("key"))||t:((n=(i=new URL(t))==null?void 0:i.pathname)==null?void 0:n.slice(1))||t}getUrl(t){var r;return t instanceof Request?t.url:(r=t==null?void 0:t.startsWith)!=null&&r.call(t,location.origin)?t:`${location.origin}/${this.chartName?`${this.chartName}?key=${t}`:t}`}async forceGet(t,s){let r=this.cache,i=this.getUrl(t),n=await r.match(i);return n?await this.resolveResponse(n):null}async get(t,s){let r,i,n;try{let a=this.cache,o=this.getUrl(t),c=await a.match(o);n=c?await this.resolveResponse(c):null}catch(a){console.error(a)}finally{}return n}async forcePut(t,s){if(t===void 0)return null;let r=this.cache,i=typeof s=="string",n=this.getUrl(t),a;return s instanceof Response?a=s:a=new Response(i?s:JSON.stringify(s),{headers:{"Content-Type":i?"text/plain":this.contentType}}),await r.put(n,a),s}async put(t,s,r){if(t===void 0)return null;try{let i=this.getUrl(t);r&&(s=await r(s));let n=this.cache,a;s instanceof Response?a=s:typeof s=="string"?a=new Response(s,{headers:{"Content-Type":"text/plain"}}):s instanceof ArrayBuffer?a=new Response(s,{headers:{"Content-Type":"application/octet-stream"}}):s instanceof Blob?a=new Response(s,{headers:{"Content-Type":"application/blob"}}):a=new Response(JSON.stringify(s),{headers:{"Content-Type":this.contentType}}),await n.put(i,a)}catch(i){console.error(i)}return s}async delete(t){let s;try{let r=this.getUrl(t);s=await this.cache.delete(r),this.deleteLocalData(r)}catch(r){console.error(r)}return s}async clear(){try{return ve?void 0:this.chartName?this.cache.delete(`${location.origin}/${this.chartName}`,{ignoreSearch:!0}):caches.delete(this.cacheName)}catch(t){console.error(t)}}};var ot=class{static notNull(t){if(t||t===0||t===!1)return!0;throw new Error(`invalid null value! ${t}`)}static mustString(t){if(typeof t=="string")return t;throw new Error(`value must be string! ${t}`)}static mustNumber(t){if(typeof t=="number"&&isFinite(t))return t;throw new Error(`value must be number! ${t}`)}static mustDate(t){if(t instanceof Date)return t;throw new Error(`value must be Date! ${t}`)}static mustnull(t){if(t===null)return null;throw new Error(`value must be null! ${t}`)}static mustUndefined(t){if(t!==void 0)throw new Error(`value must be undefined! ${t}`)}static mustArray(t){if(Array.isArray(t))return t;throw new Error(`value must be Array! ${t}`)}static mustBool(t){if(t===!1||t===!0)return t;throw new Error(`value must be Boolean! ${t}`)}static verifyGTicket(t){return typeof t=="number"&&isFinite(t)}};var px=Ei(LE());function ug(e){return hg(e.map(([t,s])=>new Array(t).fill(s,0,t)))}function hg(e){return e.reduce((t,s)=>t.concat(Array.isArray(s)?hg(s):s),[])}var GA=[0,1,2,3].concat(...ug([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Hs(){let e=this;function t(i){let n=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.extra_bits,c=e.stat_desc.extra_base,l=e.stat_desc.max_length,u,h,p,d,f,m,g=0;for(d=0;d<=15;d++)i.bl_count[d]=0;for(n[i.heap[i.heap_max]*2+1]=0,u=i.heap_max+1;u<573;u++)h=i.heap[u],d=n[n[h*2+1]*2+1]+1,d>l&&(d=l,g++),n[h*2+1]=d,!(h>e.max_code)&&(i.bl_count[d]++,f=0,h>=c&&(f=o[h-c]),m=n[h*2],i.opt_len+=m*(d+f),a&&(i.static_len+=m*(a[h*2+1]+f)));if(g!==0){do{for(d=l-1;i.bl_count[d]===0;)d--;i.bl_count[d]--,i.bl_count[d+1]+=2,i.bl_count[l]--,g-=2}while(g>0);for(d=l;d!==0;d--)for(h=i.bl_count[d];h!==0;)p=i.heap[--u],!(p>e.max_code)&&(n[p*2+1]!=d&&(i.opt_len+=(d-n[p*2+1])*n[p*2],n[p*2+1]=d),h--)}}function s(i,n){let a=0;do a|=i&1,i>>>=1,a<<=1;while(--n>0);return a>>>1}function r(i,n,a){let o=[],c=0,l,u,h;for(l=1;l<=15;l++)o[l]=c=c+a[l-1]<<1;for(u=0;u<=n;u++)h=i[u*2+1],h!==0&&(i[u*2]=s(o[h]++,h))}e.build_tree=function(i){let n=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.elems,c,l,u=-1,h;for(i.heap_len=0,i.heap_max=573,c=0;c<o;c++)n[c*2]!==0?(i.heap[++i.heap_len]=u=c,i.depth[c]=0):n[c*2+1]=0;for(;i.heap_len<2;)h=i.heap[++i.heap_len]=u<2?++u:0,n[h*2]=1,i.depth[h]=0,i.opt_len--,a&&(i.static_len-=a[h*2+1]);for(e.max_code=u,c=Math.floor(i.heap_len/2);c>=1;c--)i.pqdownheap(n,c);h=o;do c=i.heap[1],i.heap[1]=i.heap[i.heap_len--],i.pqdownheap(n,1),l=i.heap[1],i.heap[--i.heap_max]=c,i.heap[--i.heap_max]=l,n[h*2]=n[c*2]+n[l*2],i.depth[h]=Math.max(i.depth[c],i.depth[l])+1,n[c*2+1]=n[l*2+1]=h,i.heap[1]=h++,i.pqdownheap(n,1);while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],t(i),r(n,e.max_code,i.bl_count)}}Hs._length_code=[0,1,2,3,4,5,6,7].concat(...ug([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]]));Hs.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0];Hs.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576];Hs.d_code=function(e){return e<256?GA[e]:GA[256+(e>>>7)]};Hs.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];Hs.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];Hs.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];Hs.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function $r(e,t,s,r,i){let n=this;n.static_tree=e,n.extra_bits=t,n.extra_base=s,n.elems=r,n.max_length=i}var _6=[12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227],A6=ug([[144,8],[112,9],[24,7],[8,8]]);$r.static_ltree=hg(_6.map((e,t)=>[e,A6[t]]));var C6=[0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23],D6=ug([[30,5]]);$r.static_dtree=hg(C6.map((e,t)=>[e,D6[t]]));$r.static_l_desc=new $r($r.static_ltree,Hs.extra_lbits,257,286,15);$r.static_d_desc=new $r($r.static_dtree,Hs.extra_dbits,0,30,15);$r.static_bl_desc=new $r(null,Hs.extra_blbits,0,19,7);var P6=9,O6=8;function pa(e,t,s,r,i){let n=this;n.good_length=e,n.max_lazy=t,n.nice_length=s,n.max_chain=r,n.func=i}var VA=0,cg=1,Vc=2,Mn=[new pa(0,0,0,0,VA),new pa(4,4,8,4,cg),new pa(4,5,16,8,cg),new pa(4,6,32,32,cg),new pa(4,4,16,16,Vc),new pa(8,16,32,32,Vc),new pa(8,16,128,128,Vc),new pa(8,32,128,256,Vc),new pa(32,128,258,1024,Vc),new pa(32,258,258,4096,Vc)],ig=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],hn=0,ng=1,Ed=2,ag=3,I6=32,BE=42,og=113,bd=666,kE=8,x6=0,ME=1,v6=2,Js=3,lg=258,Xi=lg+Js+1;function YA(e,t,s,r){let i=e[t*2],n=e[s*2];return i<n||i==n&&r[t]<=r[s]}function R6(){let e=this,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C,x,D,I,P,L,F,V,B,k,O=new Hs,R=new Hs,v=new Hs;e.depth=[];let j,M,H,q,Q,oe;e.bl_count=[],e.heap=[],V=[],B=[],k=[];function me(){l=2*n,h[d-1]=0;for(let U=0;U<d-1;U++)h[U]=0;D=Mn[I].max_lazy,L=Mn[I].good_length,F=Mn[I].nice_length,x=Mn[I].max_chain,w=0,b=0,_=0,E=C=Js-1,T=0,p=0}function Ee(){let U;for(U=0;U<286;U++)V[U*2]=0;for(U=0;U<30;U++)B[U*2]=0;for(U=0;U<19;U++)k[U*2]=0;V[256*2]=1,e.opt_len=e.static_len=0,M=H=0}function Pe(){O.dyn_tree=V,O.stat_desc=$r.static_l_desc,R.dyn_tree=B,R.stat_desc=$r.static_d_desc,v.dyn_tree=k,v.stat_desc=$r.static_bl_desc,Q=0,oe=0,q=8,Ee()}e.pqdownheap=function(U,Z){let J=e.heap,ne=J[Z],ue=Z<<1;for(;ue<=e.heap_len&&(ue<e.heap_len&&YA(U,J[ue+1],J[ue],e.depth)&&ue++,!YA(U,ne,J[ue],e.depth));)J[Z]=J[ue],Z=ue,ue<<=1;J[Z]=ne};function Oe(U,Z){let J=-1,ne,ue=U[1],Ie=0,Ue=7,Ye=4;ue===0&&(Ue=138,Ye=3),U[(Z+1)*2+1]=65535;for(let Qe=0;Qe<=Z;Qe++)ne=ue,ue=U[(Qe+1)*2+1],!(++Ie<Ue&&ne==ue)&&(Ie<Ye?k[ne*2]+=Ie:ne!==0?(ne!=J&&k[ne*2]++,k[32]++):Ie<=10?k[34]++:k[36]++,Ie=0,J=ne,ue===0?(Ue=138,Ye=3):ne==ue?(Ue=6,Ye=3):(Ue=7,Ye=4))}function Fe(){let U;for(Oe(V,O.max_code),Oe(B,R.max_code),v.build_tree(e),U=18;U>=3&&k[Hs.bl_order[U]*2+1]===0;U--);return e.opt_len+=3*(U+1)+5+5+4,U}function G(U){e.pending_buf[e.pending++]=U}function pe(U){G(U&255),G(U>>>8&255)}function ge(U){G(U>>8&255),G(U&255&255)}function ie(U,Z){let J,ne=Z;oe>16-ne?(J=U,Q|=J<<oe&65535,pe(Q),Q=J>>>16-oe,oe+=ne-16):(Q|=U<<oe&65535,oe+=ne)}function $(U,Z){let J=U*2;ie(Z[J]&65535,Z[J+1]&65535)}function ae(U,Z){let J,ne=-1,ue,Ie=U[1],Ue=0,Ye=7,Qe=4;for(Ie===0&&(Ye=138,Qe=3),J=0;J<=Z;J++)if(ue=Ie,Ie=U[(J+1)*2+1],!(++Ue<Ye&&ue==Ie)){if(Ue<Qe)do $(ue,k);while(--Ue!==0);else ue!==0?(ue!=ne&&($(ue,k),Ue--),$(16,k),ie(Ue-3,2)):Ue<=10?($(17,k),ie(Ue-3,3)):($(18,k),ie(Ue-11,7));Ue=0,ne=ue,Ie===0?(Ye=138,Qe=3):ue==Ie?(Ye=6,Qe=3):(Ye=7,Qe=4)}}function ye(U,Z,J){let ne;for(ie(U-257,5),ie(Z-1,5),ie(J-4,4),ne=0;ne<J;ne++)ie(k[Hs.bl_order[ne]*2+1],3);ae(V,U-1),ae(B,Z-1)}function Be(){oe==16?(pe(Q),Q=0,oe=0):oe>=8&&(G(Q&255),Q>>>=8,oe-=8)}function be(){ie(ME<<1,3),$(256,$r.static_ltree),Be(),1+q+10-oe<9&&(ie(ME<<1,3),$(256,$r.static_ltree),Be()),q=7}function xe(U,Z){let J,ne,ue;if(e.dist_buf[M]=U,e.lc_buf[M]=Z&255,M++,U===0?V[Z*2]++:(H++,U--,V[(Hs._length_code[Z]+256+1)*2]++,B[Hs.d_code(U)*2]++),(M&8191)===0&&I>2){for(J=M*8,ne=w-b,ue=0;ue<30;ue++)J+=B[ue*2]*(5+Hs.extra_dbits[ue]);if(J>>>=3,H<Math.floor(M/2)&&J<Math.floor(ne/2))return!0}return M==j-1}function je(U,Z){let J,ne,ue=0,Ie,Ue;if(M!==0)do J=e.dist_buf[ue],ne=e.lc_buf[ue],ue++,J===0?$(ne,U):(Ie=Hs._length_code[ne],$(Ie+256+1,U),Ue=Hs.extra_lbits[Ie],Ue!==0&&(ne-=Hs.base_length[Ie],ie(ne,Ue)),J--,Ie=Hs.d_code(J),$(Ie,Z),Ue=Hs.extra_dbits[Ie],Ue!==0&&(J-=Hs.base_dist[Ie],ie(J,Ue)));while(ue<M);$(256,U),q=U[256*2+1]}function ke(){oe>8?pe(Q):oe>0&&G(Q&255),Q=0,oe=0}function Xe(U,Z,J){ke(),q=8,J&&(pe(Z),pe(~Z)),e.pending_buf.set(c.subarray(U,U+Z),e.pending),e.pending+=Z}function gt(U,Z,J){ie((x6<<1)+(J?1:0),3),Xe(U,Z,!0)}function it(U,Z,J){let ne,ue,Ie=0;I>0?(O.build_tree(e),R.build_tree(e),Ie=Fe(),ne=e.opt_len+3+7>>>3,ue=e.static_len+3+7>>>3,ue<=ne&&(ne=ue)):ne=ue=Z+5,Z+4<=ne&&U!=-1?gt(U,Z,J):ue==ne?(ie((ME<<1)+(J?1:0),3),je($r.static_ltree,$r.static_dtree)):(ie((v6<<1)+(J?1:0),3),ye(O.max_code+1,R.max_code+1,Ie+1),je(V,B)),Ee(),J&&ke()}function Ve(U){it(b>=0?b:-1,w-b,U),b=w,t.flush_pending()}function as(){let U,Z,J,ne;do{if(ne=l-_-w,ne===0&&w===0&&_===0)ne=n;else if(ne==-1)ne--;else if(w>=n+n-Xi){c.set(c.subarray(n,n+n),0),S-=n,w-=n,b-=n,U=d,J=U;do Z=h[--J]&65535,h[J]=Z>=n?Z-n:0;while(--U!==0);U=n,J=U;do Z=u[--J]&65535,u[J]=Z>=n?Z-n:0;while(--U!==0);ne+=n}if(t.avail_in===0)return;U=t.read_buf(c,w+_,ne),_+=U,_>=Js&&(p=c[w]&255,p=(p<<g^c[w+1]&255)&m)}while(_<Xi&&t.avail_in!==0)}function Ds(U){let Z=65535,J;for(Z>r-5&&(Z=r-5);;){if(_<=1){if(as(),_===0&&U==0)return hn;if(_===0)break}if(w+=_,_=0,J=b+Z,(w===0||w>=J)&&(_=w-J,w=J,Ve(!1),t.avail_out===0)||w-b>=n-Xi&&(Ve(!1),t.avail_out===0))return hn}return Ve(U==4),t.avail_out===0?U==4?Ed:hn:U==4?ag:ng}function A(U){let Z=x,J=w,ne,ue,Ie=C,Ue=w>n-Xi?w-(n-Xi):0,Ye=F,Qe=o,ws=w+lg,ar=c[J+Ie-1],yi=c[J+Ie];C>=L&&(Z>>=2),Ye>_&&(Ye=_);do if(ne=U,!(c[ne+Ie]!=yi||c[ne+Ie-1]!=ar||c[ne]!=c[J]||c[++ne]!=c[J+1])){J+=2,ne++;do;while(c[++J]==c[++ne]&&c[++J]==c[++ne]&&c[++J]==c[++ne]&&c[++J]==c[++ne]&&c[++J]==c[++ne]&&c[++J]==c[++ne]&&c[++J]==c[++ne]&&c[++J]==c[++ne]&&J<ws);if(ue=lg-(ws-J),J=ws-lg,ue>Ie){if(S=U,Ie=ue,ue>=Ye)break;ar=c[J+Ie-1],yi=c[J+Ie]}}while((U=u[U&Qe]&65535)>Ue&&--Z!==0);return Ie<=_?Ie:_}function N(U){let Z=0,J;for(;;){if(_<Xi){if(as(),_<Xi&&U==0)return hn;if(_===0)break}if(_>=Js&&(p=(p<<g^c[w+(Js-1)]&255)&m,Z=h[p]&65535,u[w&o]=h[p],h[p]=w),Z!==0&&(w-Z&65535)<=n-Xi&&P!=2&&(E=A(Z)),E>=Js)if(J=xe(w-S,E-Js),_-=E,E<=D&&_>=Js){E--;do w++,p=(p<<g^c[w+(Js-1)]&255)&m,Z=h[p]&65535,u[w&o]=h[p],h[p]=w;while(--E!==0);w++}else w+=E,E=0,p=c[w]&255,p=(p<<g^c[w+1]&255)&m;else J=xe(0,c[w]&255),_--,w++;if(J&&(Ve(!1),t.avail_out===0))return hn}return Ve(U==4),t.avail_out===0?U==4?Ed:hn:U==4?ag:ng}function Y(U){let Z=0,J,ne;for(;;){if(_<Xi){if(as(),_<Xi&&U==0)return hn;if(_===0)break}if(_>=Js&&(p=(p<<g^c[w+(Js-1)]&255)&m,Z=h[p]&65535,u[w&o]=h[p],h[p]=w),C=E,y=S,E=Js-1,Z!==0&&C<D&&(w-Z&65535)<=n-Xi&&(P!=2&&(E=A(Z)),E<=5&&(P==1||E==Js&&w-S>4096)&&(E=Js-1)),C>=Js&&E<=C){ne=w+_-Js,J=xe(w-1-y,C-Js),_-=C-1,C-=2;do++w<=ne&&(p=(p<<g^c[w+(Js-1)]&255)&m,Z=h[p]&65535,u[w&o]=h[p],h[p]=w);while(--C!==0);if(T=0,E=Js-1,w++,J&&(Ve(!1),t.avail_out===0))return hn}else if(T!==0){if(J=xe(0,c[w-1]&255),J&&Ve(!1),w++,_--,t.avail_out===0)return hn}else T=1,w++,_--}return T!==0&&(J=xe(0,c[w-1]&255),T=0),Ve(U==4),t.avail_out===0?U==4?Ed:hn:U==4?ag:ng}function z(U){return U.total_in=U.total_out=0,U.msg=null,e.pending=0,e.pending_out=0,s=og,i=0,Pe(),me(),0}e.deflateInit=function(U,Z,J,ne,ue,Ie){return ne||(ne=kE),ue||(ue=O6),Ie||(Ie=0),U.msg=null,Z==-1&&(Z=6),ue<1||ue>P6||ne!=kE||J<9||J>15||Z<0||Z>9||Ie<0||Ie>2?-2:(U.dstate=e,a=J,n=1<<a,o=n-1,f=ue+7,d=1<<f,m=d-1,g=Math.floor((f+Js-1)/Js),c=new Uint8Array(n*2),u=[],h=[],j=1<<ue+6,e.pending_buf=new Uint8Array(j*4),r=j*4,e.dist_buf=new Uint16Array(j),e.lc_buf=new Uint8Array(j),I=Z,P=Ie,z(U))},e.deflateEnd=function(){return s!=BE&&s!=og&&s!=bd?-2:(e.lc_buf=null,e.dist_buf=null,e.pending_buf=null,h=null,u=null,c=null,e.dstate=null,s==og?-3:0)},e.deflateParams=function(U,Z,J){let ne=0;return Z==-1&&(Z=6),Z<0||Z>9||J<0||J>2?-2:(Mn[I].func!=Mn[Z].func&&U.total_in!==0&&(ne=U.deflate(1)),I!=Z&&(I=Z,D=Mn[I].max_lazy,L=Mn[I].good_length,F=Mn[I].nice_length,x=Mn[I].max_chain),P=J,ne)},e.deflateSetDictionary=function(U,Z,J){let ne=J,ue,Ie=0;if(!Z||s!=BE)return-2;if(ne<Js)return 0;for(ne>n-Xi&&(ne=n-Xi,Ie=J-ne),c.set(Z.subarray(Ie,Ie+ne),0),w=ne,b=ne,p=c[0]&255,p=(p<<g^c[1]&255)&m,ue=0;ue<=ne-Js;ue++)p=(p<<g^c[ue+(Js-1)]&255)&m,u[ue&o]=h[p],h[p]=ue;return 0},e.deflate=function(U,Z){let J,ne,ue,Ie,Ue;if(Z>4||Z<0)return-2;if(!U.next_out||!U.next_in&&U.avail_in!==0||s==bd&&Z!=4)return U.msg=ig[4],-2;if(U.avail_out===0)return U.msg=ig[7],-5;if(t=U,Ie=i,i=Z,s==BE&&(ne=kE+(a-8<<4)<<8,ue=(I-1&255)>>1,ue>3&&(ue=3),ne|=ue<<6,w!==0&&(ne|=I6),ne+=31-ne%31,s=og,ge(ne)),e.pending!==0){if(t.flush_pending(),t.avail_out===0)return i=-1,0}else if(t.avail_in===0&&Z<=Ie&&Z!=4)return t.msg=ig[7],-5;if(s==bd&&t.avail_in!==0)return U.msg=ig[7],-5;if(t.avail_in!==0||_!==0||Z!=0&&s!=bd){switch(Ue=-1,Mn[I].func){case VA:Ue=Ds(Z);break;case cg:Ue=N(Z);break;case Vc:Ue=Y(Z);break;default:}if((Ue==Ed||Ue==ag)&&(s=bd),Ue==hn||Ue==Ed)return t.avail_out===0&&(i=-1),0;if(Ue==ng){if(Z==1)be();else if(gt(0,0,!1),Z==3)for(J=0;J<d;J++)h[J]=0;if(t.flush_pending(),t.avail_out===0)return i=-1,0}}return Z!=4?0:1}}function zA(){let e=this;e.next_in_index=0,e.next_out_index=0,e.avail_in=0,e.total_in=0,e.avail_out=0,e.total_out=0}zA.prototype={deflateInit(e,t){let s=this;return s.dstate=new R6,t||(t=15),s.dstate.deflateInit(s,e,t)},deflate(e){let t=this;return t.dstate?t.dstate.deflate(t,e):-2},deflateEnd(){let e=this;if(!e.dstate)return-2;let t=e.dstate.deflateEnd();return e.dstate=null,t},deflateParams(e,t){let s=this;return s.dstate?s.dstate.deflateParams(s,e,t):-2},deflateSetDictionary(e,t){let s=this;return s.dstate?s.dstate.deflateSetDictionary(s,e,t):-2},read_buf(e,t,s){let r=this,i=r.avail_in;return i>s&&(i=s),i===0?0:(r.avail_in-=i,e.set(r.next_in.subarray(r.next_in_index,r.next_in_index+i),t),r.next_in_index+=i,r.total_in+=i,i)},flush_pending(){let e=this,t=e.dstate.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out,e.dstate.pending_out+t),e.next_out_index),e.next_out_index+=t,e.dstate.pending_out+=t,e.total_out+=t,e.avail_out-=t,e.dstate.pending-=t,e.dstate.pending===0&&(e.dstate.pending_out=0))}};function WA(e){let t=this,s=new zA,r=N6(e&&e.chunkSize?e.chunkSize:64*1024),i=0,n=new Uint8Array(r),a=e?e.level:-1;typeof a>"u"&&(a=-1),s.deflateInit(a),s.next_out=n,t.append=function(o,c){let l,u,h=0,p=0,d=0,f=[];if(o.length){s.next_in_index=0,s.next_in=o,s.avail_in=o.length;do{if(s.next_out_index=0,s.avail_out=r,l=s.deflate(i),l!=0)throw new Error("deflating: "+s.msg);s.next_out_index&&(s.next_out_index==r?f.push(new Uint8Array(n)):f.push(n.subarray(0,s.next_out_index))),d+=s.next_out_index,c&&s.next_in_index>0&&s.next_in_index!=h&&(c(s.next_in_index),h=s.next_in_index)}while(s.avail_in>0||s.avail_out===0);return f.length>1?(u=new Uint8Array(d),f.forEach(function(m){u.set(m,p),p+=m.length})):u=f[0]?new Uint8Array(f[0]):new Uint8Array,u}},t.flush=function(){let o,c,l=0,u=0,h=[];do{if(s.next_out_index=0,s.avail_out=r,o=s.deflate(4),o!=1&&o!=0)throw new Error("deflating: "+s.msg);r-s.avail_out>0&&h.push(n.slice(0,s.next_out_index)),u+=s.next_out_index}while(s.avail_in>0||s.avail_out===0);return s.deflateEnd(),c=new Uint8Array(u),h.forEach(function(p){c.set(p,l),l+=p.length}),c}}function N6(e){return e+5*(Math.floor(e/16383)+1)}var Zi=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],dC=1440,L6=0,B6=4,k6=9,M6=5,j6=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],F6=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],U6=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],H6=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],G6=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Y6=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Yo=15;function HE(){let e=this,t,s,r,i,n,a;function o(l,u,h,p,d,f,m,g,b,E,y){let T,w,S,_,C,x,D,I,P,L,F,V,B,k,O;L=0,C=h;do r[l[u+L]]++,L++,C--;while(C!==0);if(r[0]==h)return m[0]=-1,g[0]=0,0;for(I=g[0],x=1;x<=Yo&&r[x]===0;x++);for(D=x,I<x&&(I=x),C=Yo;C!==0&&r[C]===0;C--);for(S=C,I>C&&(I=C),g[0]=I,k=1<<x;x<C;x++,k<<=1)if((k-=r[x])<0)return-3;if((k-=r[C])<0)return-3;for(r[C]+=k,a[1]=x=0,L=1,B=2;--C!==0;)a[B]=x+=r[L],B++,L++;C=0,L=0;do(x=l[u+L])!==0&&(y[a[x]++]=C),L++;while(++C<h);for(h=a[S],a[0]=C=0,L=0,_=-1,V=-I,n[0]=0,F=0,O=0;D<=S;D++)for(T=r[D];T--!==0;){for(;D>V+I;){if(_++,V+=I,O=S-V,O=O>I?I:O,(w=1<<(x=D-V))>T+1&&(w-=T+1,B=D,x<O))for(;++x<O&&!((w<<=1)<=r[++B]);)w-=r[B];if(O=1<<x,E[0]+O>dC)return-3;n[_]=F=E[0],E[0]+=O,_!==0?(a[_]=C,i[0]=x,i[1]=I,x=C>>>V-I,i[2]=F-n[_-1]-x,b.set(i,(n[_-1]+x)*3)):m[0]=F}for(i[1]=D-V,L>=h?i[0]=192:y[L]<p?(i[0]=y[L]<256?0:96,i[2]=y[L++]):(i[0]=f[y[L]-p]+16+64,i[2]=d[y[L++]-p]),w=1<<D-V,x=C>>>V;x<O;x+=w)b.set(i,(F+x)*3);for(x=1<<D-1;(C&x)!==0;x>>>=1)C^=x;for(C^=x,P=(1<<V)-1;(C&P)!=a[_];)_--,V-=I,P=(1<<V)-1}return k!==0&&S!=1?-5:0}function c(l){let u;for(t||(t=[],s=[],r=new Int32Array(Yo+1),i=[],n=new Int32Array(Yo),a=new Int32Array(Yo+1)),s.length<l&&(s=[]),u=0;u<l;u++)s[u]=0;for(u=0;u<Yo+1;u++)r[u]=0;for(u=0;u<3;u++)i[u]=0;n.set(r.subarray(0,Yo),0),a.set(r.subarray(0,Yo+1),0)}e.inflate_trees_bits=function(l,u,h,p,d){let f;return c(19),t[0]=0,f=o(l,0,19,19,null,null,h,u,p,t,s),f==-3?d.msg="oversubscribed dynamic bit lengths tree":(f==-5||u[0]===0)&&(d.msg="incomplete dynamic bit lengths tree",f=-3),f},e.inflate_trees_dynamic=function(l,u,h,p,d,f,m,g,b){let E;return c(288),t[0]=0,E=o(h,0,l,257,U6,H6,f,p,g,t,s),E!=0||p[0]===0?(E==-3?b.msg="oversubscribed literal/length tree":E!=-4&&(b.msg="incomplete literal/length tree",E=-3),E):(c(288),E=o(h,l,u,0,G6,Y6,m,d,g,t,s),E!=0||d[0]===0&&l>257?(E==-3?b.msg="oversubscribed distance tree":E==-5?(b.msg="incomplete distance tree",E=-3):E!=-4&&(b.msg="empty distance tree with lengths",E=-3),E):0)}}HE.inflate_trees_fixed=function(e,t,s,r){return e[0]=k6,t[0]=M6,s[0]=j6,r[0]=F6,0};var dg=0,qA=1,JA=2,KA=3,XA=4,ZA=5,$A=6,jE=7,QA=8,pg=9;function V6(){let e=this,t,s=0,r,i=0,n=0,a=0,o=0,c=0,l=0,u=0,h,p=0,d,f=0;function m(g,b,E,y,T,w,S,_){let C,x,D,I,P,L,F,V,B,k,O,R,v,j,M,H;F=_.next_in_index,V=_.avail_in,P=S.bitb,L=S.bitk,B=S.write,k=B<S.read?S.read-B-1:S.end-B,O=Zi[g],R=Zi[b];do{for(;L<20;)V--,P|=(_.read_byte(F++)&255)<<L,L+=8;if(C=P&O,x=E,D=y,H=(D+C)*3,(I=x[H])===0){P>>=x[H+1],L-=x[H+1],S.win[B++]=x[H+2],k--;continue}do{if(P>>=x[H+1],L-=x[H+1],(I&16)!==0){for(I&=15,v=x[H+2]+(P&Zi[I]),P>>=I,L-=I;L<15;)V--,P|=(_.read_byte(F++)&255)<<L,L+=8;C=P&R,x=T,D=w,H=(D+C)*3,I=x[H];do if(P>>=x[H+1],L-=x[H+1],(I&16)!==0){for(I&=15;L<I;)V--,P|=(_.read_byte(F++)&255)<<L,L+=8;if(j=x[H+2]+(P&Zi[I]),P>>=I,L-=I,k-=v,B>=j)M=B-j,B-M>0&&2>B-M?(S.win[B++]=S.win[M++],S.win[B++]=S.win[M++],v-=2):(S.win.set(S.win.subarray(M,M+2),B),B+=2,M+=2,v-=2);else{M=B-j;do M+=S.end;while(M<0);if(I=S.end-M,v>I){if(v-=I,B-M>0&&I>B-M)do S.win[B++]=S.win[M++];while(--I!==0);else S.win.set(S.win.subarray(M,M+I),B),B+=I,M+=I,I=0;M=0}}if(B-M>0&&v>B-M)do S.win[B++]=S.win[M++];while(--v!==0);else S.win.set(S.win.subarray(M,M+v),B),B+=v,M+=v,v=0;break}else if((I&64)===0)C+=x[H+2],C+=P&Zi[I],H=(D+C)*3,I=x[H];else return _.msg="invalid distance code",v=_.avail_in-V,v=L>>3<v?L>>3:v,V+=v,F-=v,L-=v<<3,S.bitb=P,S.bitk=L,_.avail_in=V,_.total_in+=F-_.next_in_index,_.next_in_index=F,S.write=B,-3;while(!0);break}if((I&64)===0){if(C+=x[H+2],C+=P&Zi[I],H=(D+C)*3,(I=x[H])===0){P>>=x[H+1],L-=x[H+1],S.win[B++]=x[H+2],k--;break}}else return(I&32)!==0?(v=_.avail_in-V,v=L>>3<v?L>>3:v,V+=v,F-=v,L-=v<<3,S.bitb=P,S.bitk=L,_.avail_in=V,_.total_in+=F-_.next_in_index,_.next_in_index=F,S.write=B,1):(_.msg="invalid literal/length code",v=_.avail_in-V,v=L>>3<v?L>>3:v,V+=v,F-=v,L-=v<<3,S.bitb=P,S.bitk=L,_.avail_in=V,_.total_in+=F-_.next_in_index,_.next_in_index=F,S.write=B,-3)}while(!0)}while(k>=258&&V>=10);return v=_.avail_in-V,v=L>>3<v?L>>3:v,V+=v,F-=v,L-=v<<3,S.bitb=P,S.bitk=L,_.avail_in=V,_.total_in+=F-_.next_in_index,_.next_in_index=F,S.write=B,0}e.init=function(g,b,E,y,T,w){t=dg,l=g,u=b,h=E,p=y,d=T,f=w,r=null},e.proc=function(g,b,E){let y,T,w,S=0,_=0,C=0,x,D,I,P;for(C=b.next_in_index,x=b.avail_in,S=g.bitb,_=g.bitk,D=g.write,I=D<g.read?g.read-D-1:g.end-D;;)switch(t){case dg:if(I>=258&&x>=10&&(g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,E=m(l,u,h,p,d,f,g,b),C=b.next_in_index,x=b.avail_in,S=g.bitb,_=g.bitk,D=g.write,I=D<g.read?g.read-D-1:g.end-D,E!=0)){t=E==1?jE:pg;break}n=l,r=h,i=p,t=qA;case qA:for(y=n;_<y;){if(x!==0)E=0;else return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);x--,S|=(b.read_byte(C++)&255)<<_,_+=8}if(T=(i+(S&Zi[y]))*3,S>>>=r[T+1],_-=r[T+1],w=r[T],w===0){a=r[T+2],t=$A;break}if((w&16)!==0){o=w&15,s=r[T+2],t=JA;break}if((w&64)===0){n=w,i=T/3+r[T+2];break}if((w&32)!==0){t=jE;break}return t=pg,b.msg="invalid literal/length code",E=-3,g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);case JA:for(y=o;_<y;){if(x!==0)E=0;else return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);x--,S|=(b.read_byte(C++)&255)<<_,_+=8}s+=S&Zi[y],S>>=y,_-=y,n=u,r=d,i=f,t=KA;case KA:for(y=n;_<y;){if(x!==0)E=0;else return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);x--,S|=(b.read_byte(C++)&255)<<_,_+=8}if(T=(i+(S&Zi[y]))*3,S>>=r[T+1],_-=r[T+1],w=r[T],(w&16)!==0){o=w&15,c=r[T+2],t=XA;break}if((w&64)===0){n=w,i=T/3+r[T+2];break}return t=pg,b.msg="invalid distance code",E=-3,g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);case XA:for(y=o;_<y;){if(x!==0)E=0;else return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);x--,S|=(b.read_byte(C++)&255)<<_,_+=8}c+=S&Zi[y],S>>=y,_-=y,t=ZA;case ZA:for(P=D-c;P<0;)P+=g.end;for(;s!==0;){if(I===0&&(D==g.end&&g.read!==0&&(D=0,I=D<g.read?g.read-D-1:g.end-D),I===0&&(g.write=D,E=g.inflate_flush(b,E),D=g.write,I=D<g.read?g.read-D-1:g.end-D,D==g.end&&g.read!==0&&(D=0,I=D<g.read?g.read-D-1:g.end-D),I===0)))return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);g.win[D++]=g.win[P++],I--,P==g.end&&(P=0),s--}t=dg;break;case $A:if(I===0&&(D==g.end&&g.read!==0&&(D=0,I=D<g.read?g.read-D-1:g.end-D),I===0&&(g.write=D,E=g.inflate_flush(b,E),D=g.write,I=D<g.read?g.read-D-1:g.end-D,D==g.end&&g.read!==0&&(D=0,I=D<g.read?g.read-D-1:g.end-D),I===0)))return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);E=0,g.win[D++]=a,I--,t=dg;break;case jE:if(_>7&&(_-=8,x++,C--),g.write=D,E=g.inflate_flush(b,E),D=g.write,I=D<g.read?g.read-D-1:g.end-D,g.read!=g.write)return g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);t=QA;case QA:return E=1,g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);case pg:return E=-3,g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E);default:return E=-2,g.bitb=S,g.bitk=_,b.avail_in=x,b.total_in+=C-b.next_in_index,b.next_in_index=C,g.write=D,g.inflate_flush(b,E)}},e.free=function(){}}var eC=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Cu=0,FE=1,tC=2,sC=3,rC=4,iC=5,fg=6,mg=7,nC=8,zc=9;function z6(e,t){let s=this,r=Cu,i=0,n=0,a=0,o,c=[0],l=[0],u=new V6,h=0,p=new Int32Array(dC*3),d=0,f=new HE;s.bitk=0,s.bitb=0,s.win=new Uint8Array(t),s.end=t,s.read=0,s.write=0,s.reset=function(m,g){g&&(g[0]=d),r==fg&&u.free(m),r=Cu,s.bitk=0,s.bitb=0,s.read=s.write=0},s.reset(e,null),s.inflate_flush=function(m,g){let b,E,y;return E=m.next_out_index,y=s.read,b=(y<=s.write?s.write:s.end)-y,b>m.avail_out&&(b=m.avail_out),b!==0&&g==-5&&(g=0),m.avail_out-=b,m.total_out+=b,m.next_out.set(s.win.subarray(y,y+b),E),E+=b,y+=b,y==s.end&&(y=0,s.write==s.end&&(s.write=0),b=s.write-y,b>m.avail_out&&(b=m.avail_out),b!==0&&g==-5&&(g=0),m.avail_out-=b,m.total_out+=b,m.next_out.set(s.win.subarray(y,y+b),E),E+=b,y+=b),m.next_out_index=E,s.read=y,g},s.proc=function(m,g){let b,E,y,T,w,S,_,C;for(T=m.next_in_index,w=m.avail_in,E=s.bitb,y=s.bitk,S=s.write,_=S<s.read?s.read-S-1:s.end-S;;){let x,D,I,P,L,F,V,B;switch(r){case Cu:for(;y<3;){if(w!==0)g=0;else return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);w--,E|=(m.read_byte(T++)&255)<<y,y+=8}switch(b=E&7,h=b&1,b>>>1){case 0:E>>>=3,y-=3,b=y&7,E>>>=b,y-=b,r=FE;break;case 1:x=[],D=[],I=[[]],P=[[]],HE.inflate_trees_fixed(x,D,I,P),u.init(x[0],D[0],I[0],0,P[0],0),E>>>=3,y-=3,r=fg;break;case 2:E>>>=3,y-=3,r=sC;break;case 3:return E>>>=3,y-=3,r=zc,m.msg="invalid block type",g=-3,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g)}break;case FE:for(;y<32;){if(w!==0)g=0;else return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);w--,E|=(m.read_byte(T++)&255)<<y,y+=8}if((~E>>>16&65535)!=(E&65535))return r=zc,m.msg="invalid stored block lengths",g=-3,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);i=E&65535,E=y=0,r=i!==0?tC:h!==0?mg:Cu;break;case tC:if(w===0||_===0&&(S==s.end&&s.read!==0&&(S=0,_=S<s.read?s.read-S-1:s.end-S),_===0&&(s.write=S,g=s.inflate_flush(m,g),S=s.write,_=S<s.read?s.read-S-1:s.end-S,S==s.end&&s.read!==0&&(S=0,_=S<s.read?s.read-S-1:s.end-S),_===0)))return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);if(g=0,b=i,b>w&&(b=w),b>_&&(b=_),s.win.set(m.read_buf(T,b),S),T+=b,w-=b,S+=b,_-=b,(i-=b)!==0)break;r=h!==0?mg:Cu;break;case sC:for(;y<14;){if(w!==0)g=0;else return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);w--,E|=(m.read_byte(T++)&255)<<y,y+=8}if(n=b=E&16383,(b&31)>29||(b>>5&31)>29)return r=zc,m.msg="too many length or distance symbols",g=-3,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);if(b=258+(b&31)+(b>>5&31),!o||o.length<b)o=[];else for(C=0;C<b;C++)o[C]=0;E>>>=14,y-=14,a=0,r=rC;case rC:for(;a<4+(n>>>10);){for(;y<3;){if(w!==0)g=0;else return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);w--,E|=(m.read_byte(T++)&255)<<y,y+=8}o[eC[a++]]=E&7,E>>>=3,y-=3}for(;a<19;)o[eC[a++]]=0;if(c[0]=7,b=f.inflate_trees_bits(o,c,l,p,m),b!=0)return g=b,g==-3&&(o=null,r=zc),s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);a=0,r=iC;case iC:for(;b=n,!(a>=258+(b&31)+(b>>5&31));){let k,O;for(b=c[0];y<b;){if(w!==0)g=0;else return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);w--,E|=(m.read_byte(T++)&255)<<y,y+=8}if(b=p[(l[0]+(E&Zi[b]))*3+1],O=p[(l[0]+(E&Zi[b]))*3+2],O<16)E>>>=b,y-=b,o[a++]=O;else{for(C=O==18?7:O-14,k=O==18?11:3;y<b+C;){if(w!==0)g=0;else return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);w--,E|=(m.read_byte(T++)&255)<<y,y+=8}if(E>>>=b,y-=b,k+=E&Zi[C],E>>>=C,y-=C,C=a,b=n,C+k>258+(b&31)+(b>>5&31)||O==16&&C<1)return o=null,r=zc,m.msg="invalid bit length repeat",g=-3,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);O=O==16?o[C-1]:0;do o[C++]=O;while(--k!==0);a=C}}if(l[0]=-1,L=[],F=[],V=[],B=[],L[0]=9,F[0]=6,b=n,b=f.inflate_trees_dynamic(257+(b&31),1+(b>>5&31),o,L,F,V,B,p,m),b!=0)return b==-3&&(o=null,r=zc),g=b,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);u.init(L[0],F[0],p,V[0],p,B[0]),r=fg;case fg:if(s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,(g=u.proc(s,m,g))!=1)return s.inflate_flush(m,g);if(g=0,u.free(m),T=m.next_in_index,w=m.avail_in,E=s.bitb,y=s.bitk,S=s.write,_=S<s.read?s.read-S-1:s.end-S,h===0){r=Cu;break}r=mg;case mg:if(s.write=S,g=s.inflate_flush(m,g),S=s.write,_=S<s.read?s.read-S-1:s.end-S,s.read!=s.write)return s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);r=nC;case nC:return g=1,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);case zc:return g=-3,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g);default:return g=-2,s.bitb=E,s.bitk=y,m.avail_in=w,m.total_in+=T-m.next_in_index,m.next_in_index=T,s.write=S,s.inflate_flush(m,g)}}},s.free=function(m){s.reset(m,null),s.win=null,p=null},s.set_dictionary=function(m,g,b){s.win.set(m.subarray(g,g+b),0),s.read=s.write=b},s.sync_point=function(){return r==FE?1:0}}var W6=32,q6=8,J6=0,aC=1,oC=2,cC=3,lC=4,uC=5,UE=6,Td=7,hC=12,Vo=13,K6=[0,0,255,255];function X6(){let e=this;e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0;function t(s){return!s||!s.istate?-2:(s.total_in=s.total_out=0,s.msg=null,s.istate.mode=Td,s.istate.blocks.reset(s,null),0)}e.inflateEnd=function(s){return e.blocks&&e.blocks.free(s),e.blocks=null,0},e.inflateInit=function(s,r){return s.msg=null,e.blocks=null,r<8||r>15?(e.inflateEnd(s),-2):(e.wbits=r,s.istate.blocks=new z6(s,1<<r),t(s),0)},e.inflate=function(s,r){let i,n;if(!s||!s.istate||!s.next_in)return-2;let a=s.istate;for(r=r==B6?-5:0,i=-5;;)switch(a.mode){case J6:if(s.avail_in===0)return i;if(i=r,s.avail_in--,s.total_in++,((a.method=s.read_byte(s.next_in_index++))&15)!=q6){a.mode=Vo,s.msg="unknown compression method",a.marker=5;break}if((a.method>>4)+8>a.wbits){a.mode=Vo,s.msg="invalid win size",a.marker=5;break}a.mode=aC;case aC:if(s.avail_in===0)return i;if(i=r,s.avail_in--,s.total_in++,n=s.read_byte(s.next_in_index++)&255,((a.method<<8)+n)%31!==0){a.mode=Vo,s.msg="incorrect header check",a.marker=5;break}if((n&W6)===0){a.mode=Td;break}a.mode=oC;case oC:if(s.avail_in===0)return i;i=r,s.avail_in--,s.total_in++,a.need=(s.read_byte(s.next_in_index++)&255)<<24&4278190080,a.mode=cC;case cC:if(s.avail_in===0)return i;i=r,s.avail_in--,s.total_in++,a.need+=(s.read_byte(s.next_in_index++)&255)<<16&16711680,a.mode=lC;case lC:if(s.avail_in===0)return i;i=r,s.avail_in--,s.total_in++,a.need+=(s.read_byte(s.next_in_index++)&255)<<8&65280,a.mode=uC;case uC:return s.avail_in===0?i:(i=r,s.avail_in--,s.total_in++,a.need+=s.read_byte(s.next_in_index++)&255,a.mode=UE,2);case UE:return a.mode=Vo,s.msg="need dictionary",a.marker=0,-2;case Td:if(i=a.blocks.proc(s,i),i==-3){a.mode=Vo,a.marker=0;break}if(i==0&&(i=r),i!=1)return i;i=r,a.blocks.reset(s,a.was),a.mode=hC;case hC:return s.avail_in=0,1;case Vo:return-3;default:return-2}},e.inflateSetDictionary=function(s,r,i){let n=0,a=i;if(!s||!s.istate||s.istate.mode!=UE)return-2;let o=s.istate;return a>=1<<o.wbits&&(a=(1<<o.wbits)-1,n=i-a),o.blocks.set_dictionary(r,n,a),o.mode=Td,0},e.inflateSync=function(s){let r,i,n,a,o;if(!s||!s.istate)return-2;let c=s.istate;if(c.mode!=Vo&&(c.mode=Vo,c.marker=0),(r=s.avail_in)===0)return-5;for(i=s.next_in_index,n=c.marker;r!==0&&n<4;)s.read_byte(i)==K6[n]?n++:s.read_byte(i)!==0?n=0:n=4-n,i++,r--;return s.total_in+=i-s.next_in_index,s.next_in_index=i,s.avail_in=r,c.marker=n,n!=4?-3:(a=s.total_in,o=s.total_out,t(s),s.total_in=a,s.total_out=o,c.mode=Td,0)},e.inflateSyncPoint=function(s){return!s||!s.istate||!s.istate.blocks?-2:s.istate.blocks.sync_point()}}function pC(){}pC.prototype={inflateInit(e){let t=this;return t.istate=new X6,e||(e=15),t.istate.inflateInit(t,e)},inflate(e){let t=this;return t.istate?t.istate.inflate(t,e):-2},inflateEnd(){let e=this;if(!e.istate)return-2;let t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync(){let e=this;return e.istate?e.istate.inflateSync(e):-2},inflateSetDictionary(e,t){let s=this;return s.istate?s.istate.inflateSetDictionary(s,e,t):-2},read_byte(e){return this.next_in[e]},read_buf(e,t){return this.next_in.subarray(e,e+t)}};function fC(e){let t=this,s=new pC,r=e&&e.chunkSize?Math.floor(e.chunkSize*2):128*1024,i=L6,n=new Uint8Array(r),a=!1;s.inflateInit(),s.next_out=n,t.append=function(o,c){let l=[],u,h,p=0,d=0,f=0;if(o.length!==0){s.next_in_index=0,s.next_in=o,s.avail_in=o.length;do{if(s.next_out_index=0,s.avail_out=r,s.avail_in===0&&!a&&(s.next_in_index=0,a=!0),u=s.inflate(i),a&&u===-5){if(s.avail_in!==0)throw new Error("inflating: bad input")}else if(u!==0&&u!==1)throw new Error("inflating: "+s.msg);if((a||u===1)&&s.avail_in===o.length)throw new Error("inflating: bad input");s.next_out_index&&(s.next_out_index===r?l.push(new Uint8Array(n)):l.push(n.subarray(0,s.next_out_index))),f+=s.next_out_index,c&&s.next_in_index>0&&s.next_in_index!=p&&(c(s.next_in_index),p=s.next_in_index)}while(s.avail_in>0||s.avail_out===0);return l.length>1?(h=new Uint8Array(f),l.forEach(function(m){h.set(m,d),d+=m.length})):h=l[0]?new Uint8Array(l[0]):new Uint8Array,h}},t.flush=function(){s.inflateEnd()}}var GE=new Date(2107,11,31),YE=new Date(1980,0,1),Ks=void 0,Du="undefined",gg="function";var wd=class{constructor(t){return class extends TransformStream{constructor(s,r){let i=new t(r);super({transform(n,a){a.enqueue(i.append(n))},flush(n){let a=i.flush();a&&n.enqueue(a)}})}}}};var Z6=64,mC=2;try{typeof navigator!=Du&&navigator.hardwareConcurrency&&(mC=navigator.hardwareConcurrency)}catch{}var $6={chunkSize:512*1024,maxWorkers:mC,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:Ks,CompressionStreamNative:typeof CompressionStream!=Du&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=Du&&DecompressionStream},Wo=Object.assign({},$6);function Pu(){return Wo}function yg(e){return Math.max(e.chunkSize,Z6)}function Ou(e){let{baseURL:t,chunkSize:s,maxWorkers:r,terminateWorkerTimeout:i,useCompressionStream:n,useWebWorkers:a,Deflate:o,Inflate:c,CompressionStream:l,DecompressionStream:u,workerScripts:h}=e;if(zo("baseURL",t),zo("chunkSize",s),zo("maxWorkers",r),zo("terminateWorkerTimeout",i),zo("useCompressionStream",n),zo("useWebWorkers",a),o&&(Wo.CompressionStream=new wd(o)),c&&(Wo.DecompressionStream=new wd(c)),zo("CompressionStream",l),zo("DecompressionStream",u),h!==Ks){let{deflate:p,inflate:d}=h;if((p||d)&&(Wo.workerScripts||(Wo.workerScripts={})),p){if(!Array.isArray(p))throw new Error("workerScripts.deflate must be an array");Wo.workerScripts.deflate=p}if(d){if(!Array.isArray(d))throw new Error("workerScripts.inflate must be an array");Wo.workerScripts.inflate=d}}}function zo(e,t){t!==Ks&&(Wo[e]=t)}var Sd={application:{"andrew-inset":"ez",annodex:"anx","atom+xml":"atom","atomcat+xml":"atomcat","atomserv+xml":"atomsrv",bbolin:"lin",cap:["cap","pcap"],"cu-seeme":"cu","davmount+xml":"davmount",dsptype:"tsp",ecmascript:["es","ecma"],futuresplash:"spl",hta:"hta","java-archive":"jar","java-serialized-object":"ser","java-vm":"class",javascript:"js",m3g:"m3g","mac-binhex40":"hqx",mathematica:["nb","ma","mb"],msaccess:"mdb",msword:["doc","dot"],mxf:"mxf",oda:"oda",ogg:"ogx",pdf:"pdf","pgp-keys":"key","pgp-signature":["asc","sig"],"pics-rules":"prf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],rar:"rar","rdf+xml":"rdf","rss+xml":"rss",rtf:"rtf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd"],"xspf+xml":"xspf",zip:"zip","vnd.android.package-archive":"apk","vnd.cinderella":"cdy","vnd.google-earth.kml+xml":"kml","vnd.google-earth.kmz":"kmz","vnd.mozilla.xul+xml":"xul","vnd.ms-excel":["xls","xlb","xlt","xlm","xla","xlc","xlw"],"vnd.ms-pki.seccat":"cat","vnd.ms-pki.stl":"stl","vnd.ms-powerpoint":["ppt","pps","pot"],"vnd.oasis.opendocument.chart":"odc","vnd.oasis.opendocument.database":"odb","vnd.oasis.opendocument.formula":"odf","vnd.oasis.opendocument.graphics":"odg","vnd.oasis.opendocument.graphics-template":"otg","vnd.oasis.opendocument.image":"odi","vnd.oasis.opendocument.presentation":"odp","vnd.oasis.opendocument.presentation-template":"otp","vnd.oasis.opendocument.spreadsheet":"ods","vnd.oasis.opendocument.spreadsheet-template":"ots","vnd.oasis.opendocument.text":"odt","vnd.oasis.opendocument.text-master":"odm","vnd.oasis.opendocument.text-template":"ott","vnd.oasis.opendocument.text-web":"oth","vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.openxmlformats-officedocument.spreadsheetml.template":"xltx","vnd.openxmlformats-officedocument.presentationml.presentation":"pptx","vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx","vnd.openxmlformats-officedocument.presentationml.template":"potx","vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","vnd.openxmlformats-officedocument.wordprocessingml.template":"dotx","vnd.smaf":"mmf","vnd.stardivision.calc":"sdc","vnd.stardivision.chart":"sds","vnd.stardivision.draw":"sda","vnd.stardivision.impress":"sdd","vnd.stardivision.math":["sdf","smf"],"vnd.stardivision.writer":["sdw","vor"],"vnd.stardivision.writer-global":"sgl","vnd.sun.xml.calc":"sxc","vnd.sun.xml.calc.template":"stc","vnd.sun.xml.draw":"sxd","vnd.sun.xml.draw.template":"std","vnd.sun.xml.impress":"sxi","vnd.sun.xml.impress.template":"sti","vnd.sun.xml.math":"sxm","vnd.sun.xml.writer":"sxw","vnd.sun.xml.writer.global":"sxg","vnd.sun.xml.writer.template":"stw","vnd.symbian.install":["sis","sisx"],"vnd.visio":["vsd","vst","vss","vsw"],"vnd.wap.wbxml":"wbxml","vnd.wap.wmlc":"wmlc","vnd.wap.wmlscriptc":"wmlsc","vnd.wordperfect":"wpd","vnd.wordperfect5.1":"wp5","x-123":"wk","x-7z-compressed":"7z","x-abiword":"abw","x-apple-diskimage":"dmg","x-bcpio":"bcpio","x-bittorrent":"torrent","x-cbr":["cbr","cba","cbt","cb7"],"x-cbz":"cbz","x-cdf":["cdf","cda"],"x-cdlink":"vcd","x-chess-pgn":"pgn","x-cpio":"cpio","x-csh":"csh","x-debian-package":["deb","udeb"],"x-director":["dcr","dir","dxr","cst","cct","cxt","w3d","fgd","swa"],"x-dms":"dms","x-doom":"wad","x-dvi":"dvi","x-httpd-eruby":"rhtml","x-font":"pcf.Z","x-freemind":"mm","x-gnumeric":"gnumeric","x-go-sgf":"sgf","x-graphing-calculator":"gcf","x-gtar":["gtar","taz"],"x-hdf":"hdf","x-httpd-php":["phtml","pht","php"],"x-httpd-php-source":"phps","x-httpd-php3":"php3","x-httpd-php3-preprocessed":"php3p","x-httpd-php4":"php4","x-httpd-php5":"php5","x-ica":"ica","x-info":"info","x-internet-signup":["ins","isp"],"x-iphone":"iii","x-iso9660-image":"iso","x-java-jnlp-file":"jnlp","x-jmol":"jmz","x-killustrator":"kil","x-koan":["skp","skd","skt","skm"],"x-kpresenter":["kpr","kpt"],"x-kword":["kwd","kwt"],"x-latex":"latex","x-lha":"lha","x-lyx":"lyx","x-lzh":"lzh","x-lzx":"lzx","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-ms-wmd":"wmd","x-ms-wmz":"wmz","x-msdos-program":["com","exe","bat","dll"],"x-msi":"msi","x-netcdf":["nc","cdf"],"x-ns-proxy-autoconfig":["pac","dat"],"x-nwc":"nwc","x-object":"o","x-oz-application":"oza","x-pkcs7-certreqresp":"p7r","x-python-code":["pyc","pyo"],"x-qgis":["qgs","shp","shx"],"x-quicktimeplayer":"qtl","x-redhat-package-manager":"rpm","x-ruby":"rb","x-sh":"sh","x-shar":"shar","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","x-stuffit":"sit","x-sv4cpio":"sv4cpio","x-sv4crc":"sv4crc","x-tar":"tar","x-tcl":"tcl","x-tex-gf":"gf","x-tex-pk":"pk","x-texinfo":["texinfo","texi"],"x-trash":["~","%","bak","old","sik"],"x-troff":["t","tr","roff"],"x-troff-man":"man","x-troff-me":"me","x-troff-ms":"ms","x-ustar":"ustar","x-wais-source":"src","x-wingz":"wz","x-x509-ca-cert":["crt","der","cer"],"x-xcf":"xcf","x-xfig":"fig","x-xpinstall":"xpi",applixware:"aw","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-capability":"cdmia","cdmi-container":"cdmic","cdmi-domain":"cdmid","cdmi-object":"cdmio","cdmi-queue":"cdmiq","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","emma+xml":"emma","epub+zip":"epub",exi:"exi","font-tdpfr":"pfr","gml+xml":"gml","gpx+xml":"gpx",gxf:"gxf",hyperstudio:"stk","inkml+xml":["ink","inkml"],ipfix:"ipfix",json:"json","jsonml+json":"jsonml","lost+xml":"lostxml","mads+xml":"mads",marc:"mrc","marcxml+xml":"mrcx","mathml+xml":"mathml",mbox:"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods",mp21:["m21","mp21"],mp4:"mp4s","oebps-package+xml":"opf","omdoc+xml":"omdoc",onenote:["onetoc","onetoc2","onetmp","onepkg"],oxps:"oxps","patch-ops-error+xml":"xer","pgp-encrypted":"pgp",pkcs10:"p10","pkcs7-mime":["p7m","p7c"],"pkcs7-signature":"p7s",pkcs8:"p8","pkix-attr-cert":"ac","pkix-crl":"crl","pkix-pkipath":"pkipath",pkixcmp:"pki","pls+xml":"pls","prs.cww":"cww","pskc+xml":"pskcxml","reginfo+xml":"rif","relax-ng-compact-syntax":"rnc","resource-lists+xml":"rl","resource-lists-diff+xml":"rld","rls-services+xml":"rs","rpki-ghostbusters":"gbr","rpki-manifest":"mft","rpki-roa":"roa","rsd+xml":"rsd","sbml+xml":"sbml","scvp-cv-request":"scq","scvp-cv-response":"scs","scvp-vp-request":"spq","scvp-vp-response":"spp",sdp:"sdp","set-payment-initiation":"setpay","set-registration-initiation":"setreg","shf+xml":"shf","sparql-query":"rq","sparql-results+xml":"srx",srgs:"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","timestamped-data":"tsd","vnd.3gpp.pic-bw-large":"plb","vnd.3gpp.pic-bw-small":"psb","vnd.3gpp.pic-bw-var":"pvb","vnd.3gpp2.tcap":"tcap","vnd.3m.post-it-notes":"pwn","vnd.accpac.simply.aso":"aso","vnd.accpac.simply.imp":"imp","vnd.acucobol":"acu","vnd.acucorp":["atc","acutc"],"vnd.adobe.air-application-installer-package+zip":"air","vnd.adobe.formscentral.fcdt":"fcdt","vnd.adobe.fxp":["fxp","fxpl"],"vnd.adobe.xdp+xml":"xdp","vnd.adobe.xfdf":"xfdf","vnd.ahead.space":"ahead","vnd.airzip.filesecure.azf":"azf","vnd.airzip.filesecure.azs":"azs","vnd.amazon.ebook":"azw","vnd.americandynamics.acc":"acc","vnd.amiga.ami":"ami","vnd.anser-web-certificate-issue-initiation":"cii","vnd.anser-web-funds-transfer-initiation":"fti","vnd.antix.game-component":"atx","vnd.apple.installer+xml":"mpkg","vnd.apple.mpegurl":"m3u8","vnd.aristanetworks.swi":"swi","vnd.astraea-software.iota":"iota","vnd.audiograph":"aep","vnd.blueice.multipass":"mpm","vnd.bmi":"bmi","vnd.businessobjects":"rep","vnd.chemdraw+xml":"cdxml","vnd.chipnuts.karaoke-mmd":"mmd","vnd.claymore":"cla","vnd.cloanto.rp9":"rp9","vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"vnd.cluetrust.cartomobile-config":"c11amc","vnd.cluetrust.cartomobile-config-pkg":"c11amz","vnd.commonspace":"csp","vnd.contact.cmsg":"cdbcmsg","vnd.cosmocaller":"cmc","vnd.crick.clicker":"clkx","vnd.crick.clicker.keyboard":"clkk","vnd.crick.clicker.palette":"clkp","vnd.crick.clicker.template":"clkt","vnd.crick.clicker.wordbank":"clkw","vnd.criticaltools.wbs+xml":"wbs","vnd.ctc-posml":"pml","vnd.cups-ppd":"ppd","vnd.curl.car":"car","vnd.curl.pcurl":"pcurl","vnd.dart":"dart","vnd.data-vision.rdz":"rdz","vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"vnd.dece.ttml+xml":["uvt","uvvt"],"vnd.dece.unspecified":["uvx","uvvx"],"vnd.dece.zip":["uvz","uvvz"],"vnd.denovo.fcselayout-link":"fe_launch","vnd.dna":"dna","vnd.dolby.mlp":"mlp","vnd.dpgraph":"dpg","vnd.dreamfactory":"dfac","vnd.ds-keypoint":"kpxx","vnd.dvb.ait":"ait","vnd.dvb.service":"svc","vnd.dynageo":"geo","vnd.ecowin.chart":"mag","vnd.enliven":"nml","vnd.epson.esf":"esf","vnd.epson.msf":"msf","vnd.epson.quickanime":"qam","vnd.epson.salt":"slt","vnd.epson.ssf":"ssf","vnd.eszigno3+xml":["es3","et3"],"vnd.ezpix-album":"ez2","vnd.ezpix-package":"ez3","vnd.fdf":"fdf","vnd.fdsn.mseed":"mseed","vnd.fdsn.seed":["seed","dataless"],"vnd.flographit":"gph","vnd.fluxtime.clip":"ftc","vnd.framemaker":["fm","frame","maker","book"],"vnd.frogans.fnc":"fnc","vnd.frogans.ltf":"ltf","vnd.fsc.weblaunch":"fsc","vnd.fujitsu.oasys":"oas","vnd.fujitsu.oasys2":"oa2","vnd.fujitsu.oasys3":"oa3","vnd.fujitsu.oasysgp":"fg5","vnd.fujitsu.oasysprs":"bh2","vnd.fujixerox.ddd":"ddd","vnd.fujixerox.docuworks":"xdw","vnd.fujixerox.docuworks.binder":"xbd","vnd.fuzzysheet":"fzs","vnd.genomatix.tuxedo":"txd","vnd.geogebra.file":"ggb","vnd.geogebra.tool":"ggt","vnd.geometry-explorer":["gex","gre"],"vnd.geonext":"gxt","vnd.geoplan":"g2w","vnd.geospace":"g3w","vnd.gmx":"gmx","vnd.grafeq":["gqf","gqs"],"vnd.groove-account":"gac","vnd.groove-help":"ghf","vnd.groove-identity-message":"gim","vnd.groove-injector":"grv","vnd.groove-tool-message":"gtm","vnd.groove-tool-template":"tpl","vnd.groove-vcard":"vcg","vnd.hal+xml":"hal","vnd.handheld-entertainment+xml":"zmm","vnd.hbci":"hbci","vnd.hhe.lesson-player":"les","vnd.hp-hpgl":"hpgl","vnd.hp-hpid":"hpid","vnd.hp-hps":"hps","vnd.hp-jlyt":"jlt","vnd.hp-pcl":"pcl","vnd.hp-pclxl":"pclxl","vnd.hydrostatix.sof-data":"sfd-hdstx","vnd.ibm.minipay":"mpy","vnd.ibm.modcap":["afp","listafp","list3820"],"vnd.ibm.rights-management":"irm","vnd.ibm.secure-container":"sc","vnd.iccprofile":["icc","icm"],"vnd.igloader":"igl","vnd.immervision-ivp":"ivp","vnd.immervision-ivu":"ivu","vnd.insors.igm":"igm","vnd.intercon.formnet":["xpw","xpx"],"vnd.intergeo":"i2g","vnd.intu.qbo":"qbo","vnd.intu.qfx":"qfx","vnd.ipunplugged.rcprofile":"rcprofile","vnd.irepository.package+xml":"irp","vnd.is-xpr":"xpr","vnd.isac.fcs":"fcs","vnd.jam":"jam","vnd.jcp.javame.midlet-rms":"rms","vnd.jisp":"jisp","vnd.joost.joda-archive":"joda","vnd.kahootz":["ktz","ktr"],"vnd.kde.karbon":"karbon","vnd.kde.kchart":"chrt","vnd.kde.kformula":"kfo","vnd.kde.kivio":"flw","vnd.kde.kontour":"kon","vnd.kde.kpresenter":["kpr","kpt"],"vnd.kde.kspread":"ksp","vnd.kde.kword":["kwd","kwt"],"vnd.kenameaapp":"htke","vnd.kidspiration":"kia","vnd.kinar":["kne","knp"],"vnd.koan":["skp","skd","skt","skm"],"vnd.kodak-descriptor":"sse","vnd.las.las+xml":"lasxml","vnd.llamagraphics.life-balance.desktop":"lbd","vnd.llamagraphics.life-balance.exchange+xml":"lbe","vnd.lotus-1-2-3":"123","vnd.lotus-approach":"apr","vnd.lotus-freelance":"pre","vnd.lotus-notes":"nsf","vnd.lotus-organizer":"org","vnd.lotus-screencam":"scm","vnd.lotus-wordpro":"lwp","vnd.macports.portpkg":"portpkg","vnd.mcd":"mcd","vnd.medcalcdata":"mc1","vnd.mediastation.cdkey":"cdkey","vnd.mfer":"mwf","vnd.mfmp":"mfm","vnd.micrografx.flo":"flo","vnd.micrografx.igx":"igx","vnd.mif":"mif","vnd.mobius.daf":"daf","vnd.mobius.dis":"dis","vnd.mobius.mbk":"mbk","vnd.mobius.mqy":"mqy","vnd.mobius.msl":"msl","vnd.mobius.plc":"plc","vnd.mobius.txf":"txf","vnd.mophun.application":"mpn","vnd.mophun.certificate":"mpc","vnd.ms-artgalry":"cil","vnd.ms-cab-compressed":"cab","vnd.ms-excel.addin.macroenabled.12":"xlam","vnd.ms-excel.sheet.binary.macroenabled.12":"xlsb","vnd.ms-excel.sheet.macroenabled.12":"xlsm","vnd.ms-excel.template.macroenabled.12":"xltm","vnd.ms-fontobject":"eot","vnd.ms-htmlhelp":"chm","vnd.ms-ims":"ims","vnd.ms-lrm":"lrm","vnd.ms-officetheme":"thmx","vnd.ms-powerpoint.addin.macroenabled.12":"ppam","vnd.ms-powerpoint.presentation.macroenabled.12":"pptm","vnd.ms-powerpoint.slide.macroenabled.12":"sldm","vnd.ms-powerpoint.slideshow.macroenabled.12":"ppsm","vnd.ms-powerpoint.template.macroenabled.12":"potm","vnd.ms-project":["mpp","mpt"],"vnd.ms-word.document.macroenabled.12":"docm","vnd.ms-word.template.macroenabled.12":"dotm","vnd.ms-works":["wps","wks","wcm","wdb"],"vnd.ms-wpl":"wpl","vnd.ms-xpsdocument":"xps","vnd.mseq":"mseq","vnd.musician":"mus","vnd.muvee.style":"msty","vnd.mynfc":"taglet","vnd.neurolanguage.nlu":"nlu","vnd.nitf":["ntf","nitf"],"vnd.noblenet-directory":"nnd","vnd.noblenet-sealer":"nns","vnd.noblenet-web":"nnw","vnd.nokia.n-gage.data":"ngdat","vnd.nokia.n-gage.symbian.install":"n-gage","vnd.nokia.radio-preset":"rpst","vnd.nokia.radio-presets":"rpss","vnd.novadigm.edm":"edm","vnd.novadigm.edx":"edx","vnd.novadigm.ext":"ext","vnd.oasis.opendocument.chart-template":"otc","vnd.oasis.opendocument.formula-template":"odft","vnd.oasis.opendocument.image-template":"oti","vnd.olpc-sugar":"xo","vnd.oma.dd2+xml":"dd2","vnd.openofficeorg.extension":"oxt","vnd.openxmlformats-officedocument.presentationml.slide":"sldx","vnd.osgeo.mapguide.package":"mgp","vnd.osgi.dp":"dp","vnd.osgi.subsystem":"esa","vnd.palm":["pdb","pqa","oprc"],"vnd.pawaafile":"paw","vnd.pg.format":"str","vnd.pg.osasli":"ei6","vnd.picsel":"efif","vnd.pmi.widget":"wg","vnd.pocketlearn":"plf","vnd.powerbuilder6":"pbd","vnd.previewsystems.box":"box","vnd.proteus.magazine":"mgz","vnd.publishare-delta-tree":"qps","vnd.pvi.ptid1":"ptid","vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"vnd.realvnc.bed":"bed","vnd.recordare.musicxml":"mxl","vnd.recordare.musicxml+xml":"musicxml","vnd.rig.cryptonote":"cryptonote","vnd.rn-realmedia":"rm","vnd.rn-realmedia-vbr":"rmvb","vnd.route66.link66+xml":"link66","vnd.sailingtracker.track":"st","vnd.seemail":"see","vnd.sema":"sema","vnd.semd":"semd","vnd.semf":"semf","vnd.shana.informed.formdata":"ifm","vnd.shana.informed.formtemplate":"itp","vnd.shana.informed.interchange":"iif","vnd.shana.informed.package":"ipk","vnd.simtech-mindmapper":["twd","twds"],"vnd.smart.teacher":"teacher","vnd.solent.sdkm+xml":["sdkm","sdkd"],"vnd.spotfire.dxp":"dxp","vnd.spotfire.sfs":"sfs","vnd.stepmania.package":"smzip","vnd.stepmania.stepchart":"sm","vnd.sus-calendar":["sus","susp"],"vnd.svd":"svd","vnd.syncml+xml":"xsm","vnd.syncml.dm+wbxml":"bdm","vnd.syncml.dm+xml":"xdm","vnd.tao.intent-module-archive":"tao","vnd.tcpdump.pcap":["pcap","cap","dmp"],"vnd.tmobile-livetv":"tmo","vnd.trid.tpt":"tpt","vnd.triscape.mxs":"mxs","vnd.trueapp":"tra","vnd.ufdl":["ufd","ufdl"],"vnd.uiq.theme":"utz","vnd.umajin":"umj","vnd.unity":"unityweb","vnd.uoml+xml":"uoml","vnd.vcx":"vcx","vnd.visionary":"vis","vnd.vsf":"vsf","vnd.webturbo":"wtb","vnd.wolfram.player":"nbp","vnd.wqd":"wqd","vnd.wt.stf":"stf","vnd.xara":"xar","vnd.xfdl":"xfdl","vnd.yamaha.hv-dic":"hvd","vnd.yamaha.hv-script":"hvs","vnd.yamaha.hv-voice":"hvp","vnd.yamaha.openscoreformat":"osf","vnd.yamaha.openscoreformat.osfpvg+xml":"osfpvg","vnd.yamaha.smaf-audio":"saf","vnd.yamaha.smaf-phrase":"spf","vnd.yellowriver-custom-menu":"cmp","vnd.zul":["zir","zirz"],"vnd.zzazz.deck+xml":"zaz","voicexml+xml":"vxml",widget:"wgt",winhlp:"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-ace-compressed":"ace","x-authorware-bin":["aab","x32","u32","vox"],"x-authorware-map":"aam","x-authorware-seg":"aas","x-blorb":["blb","blorb"],"x-bzip":"bz","x-bzip2":["bz2","boz"],"x-cfs-compressed":"cfs","x-chat":"chat","x-conference":"nsc","x-dgc-compressed":"dgc","x-dtbncx+xml":"ncx","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-eva":"eva","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-freearc":"arc","x-gca-compressed":"gca","x-glulx":"ulx","x-gramps-xml":"gramps","x-install-instructions":"install","x-lzh-compressed":["lzh","lha"],"x-mie":"mie","x-mobipocket-ebook":["prc","mobi"],"x-ms-application":"application","x-ms-shortcut":"lnk","x-ms-xbap":"xbap","x-msbinder":"obd","x-mscardfile":"crd","x-msclip":"clp","x-msdownload":["exe","dll","com","bat","msi"],"x-msmediaview":["mvb","m13","m14"],"x-msmetafile":["wmf","wmz","emf","emz"],"x-msmoney":"mny","x-mspublisher":"pub","x-msschedule":"scd","x-msterminal":"trm","x-mswrite":"wri","x-nzb":"nzb","x-pkcs12":["p12","pfx"],"x-pkcs7-certificates":["p7b","spc"],"x-research-info-systems":"ris","x-silverlight-app":"xap","x-sql":"sql","x-stuffitx":"sitx","x-subrip":"srt","x-t3vm-image":"t3","x-tads":"gam","x-tex":"tex","x-tex-tfm":"tfm","x-tgif":"obj","x-xliff+xml":"xlf","x-xz":"xz","x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"xaml+xml":"xaml","xcap-diff+xml":"xdf","xenc+xml":"xenc","xml-dtd":"dtd","xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xv+xml":["mxml","xhvml","xvml","xvm"],yang:"yang","yin+xml":"yin",envoy:"evy",fractals:"fif","internet-property-stream":"acx",olescript:"axs","vnd.ms-outlook":"msg","vnd.ms-pkicertstore":"sst","x-compress":"z","x-compressed":"tgz","x-gzip":"gz","x-perfmon":["pma","pmc","pml","pmr","pmw"],"x-pkcs7-mime":["p7c","p7m"],"ynd.ms-pkipko":"pko"},audio:{amr:"amr","amr-wb":"awb",annodex:"axa",basic:["au","snd"],flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"prs.sid":"sid","x-aiff":["aif","aiff","aifc"],"x-gsm":"gsm","x-ms-wma":"wma","x-ms-wax":"wax","x-pn-realaudio":"ram","x-realaudio":"ra","x-sd2":"sd2","x-wav":"wav",adpcm:"adp",mp4:"mp4a",s3m:"s3m",silk:"sil","vnd.dece.audio":["uva","uvva"],"vnd.digital-winds":"eol","vnd.dra":"dra","vnd.dts":"dts","vnd.dts.hd":"dtshd","vnd.lucent.voice":"lvp","vnd.ms-playready.media.pya":"pya","vnd.nuera.ecelp4800":"ecelp4800","vnd.nuera.ecelp7470":"ecelp7470","vnd.nuera.ecelp9600":"ecelp9600","vnd.rip":"rip",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},chemical:{"x-alchemy":"alc","x-cache":["cac","cache"],"x-cache-csf":"csf","x-cactvs-binary":["cbin","cascii","ctab"],"x-cdx":"cdx","x-chem3d":"c3d","x-cif":"cif","x-cmdf":"cmdf","x-cml":"cml","x-compass":"cpa","x-crossfire":"bsd","x-csml":["csml","csm"],"x-ctx":"ctx","x-cxf":["cxf","cef"],"x-embl-dl-nucleotide":["emb","embl"],"x-gamess-input":["inp","gam","gamin"],"x-gaussian-checkpoint":["fch","fchk"],"x-gaussian-cube":"cub","x-gaussian-input":["gau","gjc","gjf"],"x-gaussian-log":"gal","x-gcg8-sequence":"gcg","x-genbank":"gen","x-hin":"hin","x-isostar":["istr","ist"],"x-jcamp-dx":["jdx","dx"],"x-kinemage":"kin","x-macmolecule":"mcm","x-macromodel-input":["mmd","mmod"],"x-mdl-molfile":"mol","x-mdl-rdfile":"rd","x-mdl-rxnfile":"rxn","x-mdl-sdfile":["sd","sdf"],"x-mdl-tgf":"tgf","x-mmcif":"mcif","x-mol2":"mol2","x-molconn-Z":"b","x-mopac-graph":"gpt","x-mopac-input":["mop","mopcrt","mpc","zmt"],"x-mopac-out":"moo","x-ncbi-asn1":"asn","x-ncbi-asn1-ascii":["prt","ent"],"x-ncbi-asn1-binary":["val","aso"],"x-pdb":["pdb","ent"],"x-rosdal":"ros","x-swissprot":"sw","x-vamas-iso14976":"vms","x-vmd":"vmd","x-xtel":"xtel","x-xyz":"xyz"},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"vnd.djvu":["djvu","djv"],"vnd.wap.wbmp":"wbmp","x-canon-cr2":"cr2","x-canon-crw":"crw","x-cmu-raster":"ras","x-coreldraw":"cdr","x-coreldrawpattern":"pat","x-coreldrawtemplate":"cdt","x-corelphotopaint":"cpt","x-epson-erf":"erf","x-icon":"ico","x-jg":"art","x-jng":"jng","x-nikon-nef":"nef","x-olympus-orf":"orf","x-photoshop":"psd","x-portable-anymap":"pnm","x-portable-bitmap":"pbm","x-portable-graymap":"pgm","x-portable-pixmap":"ppm","x-rgb":"rgb","x-xbitmap":"xbm","x-xpixmap":"xpm","x-xwindowdump":"xwd",bmp:"bmp",cgm:"cgm",g3fax:"g3",ktx:"ktx","prs.btif":"btif",sgi:"sgi","vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"vnd.dwg":"dwg","vnd.dxf":"dxf","vnd.fastbidsheet":"fbs","vnd.fpx":"fpx","vnd.fst":"fst","vnd.fujixerox.edmics-mmr":"mmr","vnd.fujixerox.edmics-rlc":"rlc","vnd.ms-modi":"mdi","vnd.ms-photo":"wdp","vnd.net-fpx":"npx","vnd.xiff":"xif",webp:"webp","x-3ds":"3ds","x-cmx":"cmx","x-freehand":["fh","fhc","fh4","fh5","fh7"],"x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod",pipeg:"jfif"},message:{rfc822:["eml","mime","mht","mhtml","nws"]},model:{iges:["igs","iges"],mesh:["msh","mesh","silo"],vrml:["wrl","vrml"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"],"x3d+binary":["x3db","x3dbz"],"vnd.collada+xml":"dae","vnd.dwf":"dwf","vnd.gdl":"gdl","vnd.gtw":"gtw","vnd.mts":"mts","vnd.vtu":"vtu"},text:{"cache-manifest":["manifest","appcache"],calendar:["ics","icz","ifb"],css:"css",csv:"csv",h323:"323",html:["html","htm","shtml","stm"],iuls:"uls",mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx",scriptlet:["sct","wsc"],texmacs:["tm","ts"],"tab-separated-values":"tsv","vnd.sun.j2me.app-descriptor":"jad","vnd.wap.wml":"wml","vnd.wap.wmlscript":"wmls","x-bibtex":"bib","x-boo":"boo","x-c++hdr":["h++","hpp","hxx","hh"],"x-c++src":["c++","cpp","cxx","cc"],"x-component":"htc","x-dsrc":"d","x-diff":["diff","patch"],"x-haskell":"hs","x-java":"java","x-literate-haskell":"lhs","x-moc":"moc","x-pascal":["p","pas"],"x-pcs-gcd":"gcd","x-perl":["pl","pm"],"x-python":"py","x-scala":"scala","x-setext":"etx","x-tcl":["tcl","tk"],"x-tex":["tex","ltx","sty","cls"],"x-vcalendar":"vcs","x-vcard":"vcf",n3:"n3","prs.lines.tag":"dsc",sgml:["sgml","sgm"],troff:["t","tr","roff","man","me","ms"],turtle:"ttl","uri-list":["uri","uris","urls"],vcard:"vcard","vnd.curl":"curl","vnd.curl.dcurl":"dcurl","vnd.curl.scurl":"scurl","vnd.curl.mcurl":"mcurl","vnd.dvb.subtitle":"sub","vnd.fly":"fly","vnd.fmi.flexstor":"flx","vnd.graphviz":"gv","vnd.in3d.3dml":"3dml","vnd.in3d.spot":"spot","x-asm":["s","asm"],"x-c":["c","cc","cxx","cpp","h","hh","dic"],"x-fortran":["f","for","f77","f90"],"x-opml":"opml","x-nfo":"nfo","x-sfv":"sfv","x-uuencode":"uu",webviewhtml:"htt"},video:{avif:".avif","3gpp":"3gp",annodex:"axv",dl:"dl",dv:["dif","dv"],fli:"fli",gl:"gl",mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.dece.hd":["uvh","uvvh"],"vnd.dece.mobile":["uvm","uvvm"],"vnd.dece.pd":["uvp","uvvp"],"vnd.dece.sd":["uvs","uvvs"],"vnd.dece.video":["uvv","uvvv"],"vnd.dvb.file":"dvb","vnd.fvt":"fvt","vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"},"x-conference":{"x-cooltalk":"ice"},"x-world":{"x-vrml":["vrm","vrml","wrl","flr","wrz","xaf","xof"]}},Sq=(()=>{let e={};for(let t in Sd)if(Sd.hasOwnProperty(t)){for(let s in Sd[t])if(Sd[t].hasOwnProperty(s)){let r=Sd[t][s];if(typeof r=="string")e[r]=t+"/"+s;else for(let i=0;i<r.length;i++)e[r[i]]=t+"/"+s}}return e})();var gC=[];for(let e=0;e<256;e++){let t=e;for(let s=0;s<8;s++)t&1?t=t>>>1^3988292384:t=t>>>1;gC[e]=t}var Qa=class{constructor(t){this.crc=t||-1}append(t){let s=this.crc|0;for(let r=0,i=t.length|0;r<i;r++)s=s>>>8^gC[(s^t[r])&255];this.crc=s}get(){return~this.crc}};var _d=class extends TransformStream{constructor(){let t,s=new Qa;super({transform(r,i){s.append(r),i.enqueue(r)},flush(){let r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,s.get()),t.value=r}}),t=this}};function Ad(e){if(typeof TextEncoder>"u"){e=unescape(encodeURIComponent(e));let t=new Uint8Array(e.length);for(let s=0;s<t.length;s++)t[s]=e.charCodeAt(s);return t}else return new TextEncoder().encode(e)}var Ci={concat(e,t){if(e.length===0||t.length===0)return e.concat(t);let s=e[e.length-1],r=Ci.getPartial(s);return r===32?e.concat(t):Ci._shiftRight(t,r,s|0,e.slice(0,e.length-1))},bitLength(e){let t=e.length;if(t===0)return 0;let s=e[t-1];return(t-1)*32+Ci.getPartial(s)},clamp(e,t){if(e.length*32<t)return e;e=e.slice(0,Math.ceil(t/32));let s=e.length;return t=t&31,s>0&&t&&(e[s-1]=Ci.partial(t,e[s-1]&2147483648>>t-1,1)),e},partial(e,t,s){return e===32?t:(s?t|0:t<<32-e)+e*1099511627776},getPartial(e){return Math.round(e/1099511627776)||32},_shiftRight(e,t,s,r){for(r===void 0&&(r=[]);t>=32;t-=32)r.push(s),s=0;if(t===0)return r.concat(e);for(let a=0;a<e.length;a++)r.push(s|e[a]>>>t),s=e[a]<<32-t;let i=e.length?e[e.length-1]:0,n=Ci.getPartial(i);return r.push(Ci.partial(t+n&31,t+n>32?s:r.pop(),1)),r}},Cd={bytes:{fromBits(e){let s=Ci.bitLength(e)/8,r=new Uint8Array(s),i;for(let n=0;n<s;n++)(n&3)===0&&(i=e[n/4]),r[n]=i>>>24,i<<=8;return r},toBits(e){let t=[],s,r=0;for(s=0;s<e.length;s++)r=r<<8|e[s],(s&3)===3&&(t.push(r),r=0);return s&3&&t.push(Ci.partial(8*(s&3),r)),t}}},yC={};yC.sha1=class{constructor(e){let t=this;t.blockSize=512,t._init=[1732584193,4023233417,2562383102,271733878,3285377520],t._key=[1518500249,1859775393,2400959708,3395469782],e?(t._h=e._h.slice(0),t._buffer=e._buffer.slice(0),t._length=e._length):t.reset()}reset(){let e=this;return e._h=e._init.slice(0),e._buffer=[],e._length=0,e}update(e){let t=this;typeof e=="string"&&(e=Cd.utf8String.toBits(e));let s=t._buffer=Ci.concat(t._buffer,e),r=t._length,i=t._length=r+Ci.bitLength(e);if(i>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");let n=new Uint32Array(s),a=0;for(let o=t.blockSize+r-(t.blockSize+r&t.blockSize-1);o<=i;o+=t.blockSize)t._block(n.subarray(16*a,16*(a+1))),a+=1;return s.splice(0,16*a),t}finalize(){let e=this,t=e._buffer,s=e._h;t=Ci.concat(t,[Ci.partial(1,1)]);for(let r=t.length+2;r&15;r++)t.push(0);for(t.push(Math.floor(e._length/4294967296)),t.push(e._length|0);t.length;)e._block(t.splice(0,16));return e.reset(),s}_f(e,t,s,r){if(e<=19)return t&s|~t&r;if(e<=39)return t^s^r;if(e<=59)return t&s|t&r|s&r;if(e<=79)return t^s^r}_S(e,t){return t<<e|t>>>32-e}_block(e){let t=this,s=t._h,r=Array(80);for(let l=0;l<16;l++)r[l]=e[l];let i=s[0],n=s[1],a=s[2],o=s[3],c=s[4];for(let l=0;l<=79;l++){l>=16&&(r[l]=t._S(1,r[l-3]^r[l-8]^r[l-14]^r[l-16]));let u=t._S(5,i)+t._f(l,n,a,o)+c+r[l]+t._key[Math.floor(l/20)]|0;c=o,o=a,a=t._S(30,n),n=i,i=u}s[0]=s[0]+i|0,s[1]=s[1]+n|0,s[2]=s[2]+a|0,s[3]=s[3]+o|0,s[4]=s[4]+c|0}};var VE={};VE.aes=class{constructor(e){let t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();let s=t._tables[0][4],r=t._tables[1],i=e.length,n,a,o,c=1;if(i!==4&&i!==6&&i!==8)throw new Error("invalid aes key size");for(t._key=[a=e.slice(0),o=[]],n=i;n<4*i+28;n++){let l=a[n-1];(n%i===0||i===8&&n%i===4)&&(l=s[l>>>24]<<24^s[l>>16&255]<<16^s[l>>8&255]<<8^s[l&255],n%i===0&&(l=l<<8^l>>>24^c<<24,c=c<<1^(c>>7)*283)),a[n]=a[n-i]^l}for(let l=0;n;l++,n--){let u=a[l&3?n:n-4];n<=4||l<4?o[l]=u:o[l]=r[0][s[u>>>24]]^r[1][s[u>>16&255]]^r[2][s[u>>8&255]]^r[3][s[u&255]]}}encrypt(e){return this._crypt(e,0)}decrypt(e){return this._crypt(e,1)}_precompute(){let e=this._tables[0],t=this._tables[1],s=e[4],r=t[4],i=[],n=[],a,o,c,l;for(let u=0;u<256;u++)n[(i[u]=u<<1^(u>>7)*283)^u]=u;for(let u=a=0;!s[u];u^=o||1,a=n[a]||1){let h=a^a<<1^a<<2^a<<3^a<<4;h=h>>8^h&255^99,s[u]=h,r[h]=u,l=i[c=i[o=i[u]]];let p=l*16843009^c*65537^o*257^u*16843008,d=i[h]*257^h*16843008;for(let f=0;f<4;f++)e[f][u]=d=d<<24^d>>>8,t[f][h]=p=p<<24^p>>>8}for(let u=0;u<5;u++)e[u]=e[u].slice(0),t[u]=t[u].slice(0)}_crypt(e,t){if(e.length!==4)throw new Error("invalid aes block size");let s=this._key[t],r=s.length/4-2,i=[0,0,0,0],n=this._tables[t],a=n[0],o=n[1],c=n[2],l=n[3],u=n[4],h=e[0]^s[0],p=e[t?3:1]^s[1],d=e[2]^s[2],f=e[t?1:3]^s[3],m=4,g,b,E;for(let y=0;y<r;y++)g=a[h>>>24]^o[p>>16&255]^c[d>>8&255]^l[f&255]^s[m],b=a[p>>>24]^o[d>>16&255]^c[f>>8&255]^l[h&255]^s[m+1],E=a[d>>>24]^o[f>>16&255]^c[h>>8&255]^l[p&255]^s[m+2],f=a[f>>>24]^o[h>>16&255]^c[p>>8&255]^l[d&255]^s[m+3],m+=4,h=g,p=b,d=E;for(let y=0;y<4;y++)i[t?3&-y:y]=u[h>>>24]<<24^u[p>>16&255]<<16^u[d>>8&255]<<8^u[f&255]^s[m++],g=h,h=p,p=d,d=f,f=g;return i}};var EC={getRandomValues(e){let t=new Uint32Array(e.buffer),s=r=>{let i=987654321,n=4294967295;return function(){return i=36969*(i&65535)+(i>>16)&n,r=18e3*(r&65535)+(r>>16)&n,(((i<<16)+r&n)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let r=0,i;r<e.length;r+=4){let n=s((i||Math.random())*4294967296);i=n()*987654071,t[r/4]=n()*4294967296|0}return e}},zE={};zE.ctrGladman=class{constructor(e,t){this._prf=e,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(e){return this.calculate(this._prf,e,this._iv)}incWord(e){if((e>>24&255)===255){let t=e>>16&255,s=e>>8&255,r=e&255;t===255?(t=0,s===255?(s=0,r===255?r=0:++r):++s):++t,e=0,e+=t<<16,e+=s<<8,e+=r}else e+=1<<24;return e}incCounter(e){(e[0]=this.incWord(e[0]))===0&&(e[1]=this.incWord(e[1]))}calculate(e,t,s){let r;if(!(r=t.length))return[];let i=Ci.bitLength(t);for(let n=0;n<r;n+=4){this.incCounter(s);let a=e.encrypt(s);t[n]^=a[0],t[n+1]^=a[1],t[n+2]^=a[2],t[n+3]^=a[3]}return Ci.clamp(t,i)}};var qo={importKey(e){return new qo.hmacSha1(Cd.bytes.toBits(e))},pbkdf2(e,t,s,r){if(s=s||1e4,r<0||s<0)throw new Error("invalid params to pbkdf2");let i=(r>>5)+1<<2,n,a,o,c,l,u=new ArrayBuffer(i),h=new DataView(u),p=0,d=Ci;for(t=Cd.bytes.toBits(t),l=1;p<(i||1);l++){for(n=a=e.encrypt(d.concat(t,[l])),o=1;o<s;o++)for(a=e.encrypt(a),c=0;c<a.length;c++)n[c]^=a[c];for(o=0;p<(i||1)&&o<n.length;o++)h.setInt32(p,n[o]),p+=4}return u.slice(0,r/8)}};qo.hmacSha1=class{constructor(e){let t=this,s=t._hash=yC.sha1,r=[[],[]];t._baseHash=[new s,new s];let i=t._baseHash[0].blockSize/32;e.length>i&&(e=new s().update(e).finalize());for(let n=0;n<i;n++)r[0][n]=e[n]^909522486,r[1][n]=e[n]^1549556828;t._baseHash[0].update(r[0]),t._baseHash[1].update(r[1]),t._resultHash=new s(t._baseHash[0])}reset(){let e=this;e._resultHash=new e._hash(e._baseHash[0]),e._updated=!1}update(e){let t=this;t._updated=!0,t._resultHash.update(e)}digest(){let e=this,t=e._resultHash.finalize(),s=new e._hash(e._baseHash[1]).update(t).finalize();return e.reset(),s}encrypt(e){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}};var ek=typeof crypto<"u"&&typeof crypto.getRandomValues=="function",jn="Invalid password",Jo="Invalid signature",eo="zipjs-abort-check-password";function Eg(e){return ek?crypto.getRandomValues(e):EC.getRandomValues(e)}var Iu=16,tk="raw",wC={name:"PBKDF2"},sk={name:"HMAC"},rk="SHA-1",ik=Object.assign({hash:sk},wC),WE=Object.assign({iterations:1e3,hash:{name:rk}},wC),nk=["deriveBits"],Pd=[8,12,16],Dd=[16,24,32],Ko=10,ak=[0,0,0,0],SC="undefined",_C="function",wg=typeof crypto!=SC,xd=wg&&crypto.subtle,AC=wg&&typeof xd!=SC,fa=Cd.bytes,ok=VE.aes,ck=zE.ctrGladman,lk=qo.hmacSha1,bC=wg&&AC&&typeof xd.importKey==_C,TC=wg&&AC&&typeof xd.deriveBits==_C,bg=class extends TransformStream{constructor({password:t,signed:s,encryptionStrength:r,checkPasswordOnly:i}){super({start(){Object.assign(this,{ready:new Promise(n=>this.resolveReady=n),password:t,signed:s,strength:r-1,pending:new Uint8Array})},async transform(n,a){let o=this,{password:c,strength:l,resolveReady:u,ready:h}=o;c?(await uk(o,l,c,dn(n,0,Pd[l]+2)),n=dn(n,Pd[l]+2),i?a.error(new Error(eo)):u()):await h;let p=new Uint8Array(n.length-Ko-(n.length-Ko)%Iu);a.enqueue(CC(o,n,p,0,Ko,!0))},async flush(n){let{signed:a,ctr:o,hmac:c,pending:l,ready:u}=this;await u;let h=dn(l,0,l.length-Ko),p=dn(l,l.length-Ko),d=new Uint8Array;if(h.length){let f=Id(fa,h);c.update(f);let m=o.update(f);d=Od(fa,m)}if(a){let f=dn(Od(fa,c.digest()),0,Ko);for(let m=0;m<Ko;m++)if(f[m]!=p[m])throw new Error(Jo)}n.enqueue(d)}})}},Tg=class extends TransformStream{constructor({password:t,encryptionStrength:s}){let r;super({start(){Object.assign(this,{ready:new Promise(i=>this.resolveReady=i),password:t,strength:s-1,pending:new Uint8Array})},async transform(i,n){let a=this,{password:o,strength:c,resolveReady:l,ready:u}=a,h=new Uint8Array;o?(h=await hk(a,c,o),l()):await u;let p=new Uint8Array(h.length+i.length-i.length%Iu);p.set(h,0),n.enqueue(CC(a,i,p,h.length,0))},async flush(i){let{ctr:n,hmac:a,pending:o,ready:c}=this;await c;let l=new Uint8Array;if(o.length){let u=n.update(Id(fa,o));a.update(u),l=Od(fa,u)}r.signature=Od(fa,a.digest()).slice(0,Ko),i.enqueue(qE(l,r.signature))}}),r=this}};function CC(e,t,s,r,i,n){let{ctr:a,hmac:o,pending:c}=e,l=t.length-i;c.length&&(t=qE(c,t),s=fk(s,l-l%Iu));let u;for(u=0;u<=l-Iu;u+=Iu){let h=Id(fa,dn(t,u,u+Iu));n&&o.update(h);let p=a.update(h);n||o.update(p),s.set(Od(fa,p),u+r)}return e.pending=dn(t,u),s}async function uk(e,t,s,r){let i=await DC(e,t,s,dn(r,0,Pd[t])),n=dn(r,Pd[t]);if(i[0]!=n[0]||i[1]!=n[1])throw new Error(jn)}async function hk(e,t,s){let r=Eg(new Uint8Array(Pd[t])),i=await DC(e,t,s,r);return qE(r,i)}async function DC(e,t,s,r){e.password=null;let i=Ad(s),n=await dk(tk,i,ik,!1,nk),a=await pk(Object.assign({salt:r},WE),n,8*(Dd[t]*2+2)),o=new Uint8Array(a),c=Id(fa,dn(o,0,Dd[t])),l=Id(fa,dn(o,Dd[t],Dd[t]*2)),u=dn(o,Dd[t]*2);return Object.assign(e,{keys:{key:c,authentication:l,passwordVerification:u},ctr:new ck(new ok(c),Array.from(ak)),hmac:new lk(l)}),u}async function dk(e,t,s,r,i){if(bC)try{return await xd.importKey(e,t,s,r,i)}catch{return bC=!1,qo.importKey(t)}else return qo.importKey(t)}async function pk(e,t,s){if(TC)try{return await xd.deriveBits(e,t,s)}catch{return TC=!1,qo.pbkdf2(t,e.salt,WE.iterations,s)}else return qo.pbkdf2(t,e.salt,WE.iterations,s)}function qE(e,t){let s=e;return e.length+t.length&&(s=new Uint8Array(e.length+t.length),s.set(e,0),s.set(t,e.length)),s}function fk(e,t){if(t&&t>e.length){let s=e;e=new Uint8Array(t),e.set(s,0)}return e}function dn(e,t,s){return e.subarray(t,s)}function Od(e,t){return e.fromBits(t)}function Id(e,t){return e.toBits(t)}var xu=12,Sg=class extends TransformStream{constructor({password:t,passwordVerification:s,checkPasswordOnly:r}){super({start(){Object.assign(this,{password:t,passwordVerification:s}),xC(this,t)},transform(i,n){let a=this;if(a.password){let o=PC(a,i.subarray(0,xu));if(a.password=null,o[xu-1]!=a.passwordVerification)throw new Error(jn);i=i.subarray(xu)}r?n.error(new Error(eo)):n.enqueue(PC(a,i))}})}},_g=class extends TransformStream{constructor({password:t,passwordVerification:s}){super({start(){Object.assign(this,{password:t,passwordVerification:s}),xC(this,t)},transform(r,i){let n=this,a,o;if(n.password){n.password=null;let c=Eg(new Uint8Array(xu));c[xu-1]=n.passwordVerification,a=new Uint8Array(r.length+c.length),a.set(OC(n,c),0),o=xu}else a=new Uint8Array(r.length),o=0;a.set(OC(n,r),o),i.enqueue(a)}})}};function PC(e,t){let s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=vC(e)^t[r],JE(e,s[r]);return s}function OC(e,t){let s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=vC(e)^t[r],JE(e,t[r]);return s}function xC(e,t){let s=[305419896,591751049,878082192];Object.assign(e,{keys:s,crcKey0:new Qa(s[0]),crcKey2:new Qa(s[2])});for(let r=0;r<t.length;r++)JE(e,t.charCodeAt(r))}function JE(e,t){let[s,r,i]=e.keys;e.crcKey0.append([t]),s=~e.crcKey0.get(),r=IC(Math.imul(IC(r+RC(s)),134775813)+1),e.crcKey2.append([r>>>24]),i=~e.crcKey2.get(),e.keys=[s,r,i]}function vC(e){let t=e.keys[2]|2;return RC(Math.imul(t,t^1)>>>8)}function RC(e){return e&255}function IC(e){return e&4294967295}var NC="deflate-raw",Ag=class extends TransformStream{constructor(t,{chunkSize:s,CompressionStream:r,CompressionStreamNative:i}){super({});let{compressed:n,encrypted:a,useCompressionStream:o,zipCrypto:c,signed:l,level:u}=t,h=this,p,d,f=LC(super.readable);(!a||c)&&l&&(p=new _d,f=ma(f,p)),n&&(f=kC(f,o,{level:u,chunkSize:s},i,r)),a&&(c?f=ma(f,new _g(t)):(d=new Tg(t),f=ma(f,d))),BC(h,f,async()=>{let m;a&&!c&&(m=d.signature),(!a||c)&&l&&(m=new DataView(p.value.buffer).getUint32(0)),h.signature=m})}},Cg=class extends TransformStream{constructor(t,{chunkSize:s,DecompressionStream:r,DecompressionStreamNative:i}){super({});let{zipCrypto:n,encrypted:a,signed:o,signature:c,compressed:l,useCompressionStream:u}=t,h,p,d=LC(super.readable);a&&(n?d=ma(d,new Sg(t)):(p=new bg(t),d=ma(d,p))),l&&(d=kC(d,u,{chunkSize:s},i,r)),(!a||n)&&o&&(h=new _d,d=ma(d,h)),BC(this,d,async()=>{if((!a||n)&&o){let f=new DataView(h.value.buffer);if(c!=f.getUint32(0,!1))throw new Error(Jo)}})}};function LC(e){return ma(e,new TransformStream({transform(t,s){t&&t.length&&s.enqueue(t)}}))}function BC(e,t,s){t=ma(t,new TransformStream({flush:s})),Object.defineProperty(e,"readable",{get(){return t}})}function kC(e,t,s,r,i){try{let n=t&&r?r:i;e=ma(e,new n(NC,s))}catch(n){if(t)e=ma(e,new i(NC,s));else throw n}return e}function ma(e,t){return e.pipeThrough(t)}var MC="message",jC="start",FC="pull",KE="data",UC="ack",HC="close",Pg="deflate",Og="inflate";var Dg=class extends TransformStream{constructor(t,s){super({});let r=this,{codecType:i}=t,n;i.startsWith(Pg)?n=Ag:i.startsWith(Og)&&(n=Cg);let a=0,o=new n(t,s),c=super.readable,l=new TransformStream({transform(u,h){u&&u.length&&(a+=u.length,h.enqueue(u))},flush(){let{signature:u}=o;Object.assign(r,{signature:u,size:a})}});Object.defineProperty(r,"readable",{get(){return c.pipeThrough(o).pipeThrough(l)}})}};var mk=typeof Worker!=Du;var vu=class{constructor(t,{readable:s,writable:r},{options:i,config:n,streamOptions:a,useWebWorkers:o,transferStreams:c,scripts:l},u){let{signal:h}=a;return Object.assign(t,{busy:!0,readable:s.pipeThrough(new ZE(s,a,n),{signal:h}),writable:r,options:Object.assign({},i),scripts:l,transferStreams:c,terminate(){let{worker:p,busy:d}=t;p&&!d&&(p.terminate(),t.interface=null)},onTaskFinished(){t.busy=!1,u(t)}}),(o&&mk?yk:gk)(t,n)}},ZE=class extends TransformStream{constructor(t,{onstart:s,onprogress:r,size:i,onend:n},{chunkSize:a}){let o=0;super({start(){s&&XE(s,i)},async transform(c,l){o+=c.length,r&&await XE(r,o,i),l.enqueue(c)},flush(){t.size=o,n&&XE(n,o)}},{highWaterMark:1,size:()=>a})}};async function XE(e,...t){try{await e(...t)}catch{}}function gk(e,t){return{run:()=>Ek(e,t)}}function yk(e,{baseURL:t,chunkSize:s}){return e.interface||Object.assign(e,{worker:wk(e.scripts[0],t,e),interface:{run:()=>bk(e,{chunkSize:s})}}),e.interface}async function Ek({options:e,readable:t,writable:s,onTaskFinished:r},i){let n=new Dg(e,i);try{await t.pipeThrough(n).pipeTo(s,{preventClose:!0,preventAbort:!0});let{signature:a,size:o}=n;return{signature:a,size:o}}finally{r()}}async function bk(e,t){let s,r,i=new Promise((p,d)=>{s=p,r=d});Object.assign(e,{reader:null,writer:null,resolveResult:s,rejectResult:r,result:i});let{readable:n,options:a,scripts:o}=e,{writable:c,closed:l}=Tk(e.writable);$E({type:jC,scripts:o.slice(1),options:a,config:t,readable:n,writable:c},e)||Object.assign(e,{reader:n.getReader(),writer:c.getWriter()});let h=await i;try{await c.getWriter().close()}catch{}return await l,h}function Tk(e){let t=e.getWriter(),s,r=new Promise(n=>s=n);return{writable:new WritableStream({async write(n){await t.ready,await t.write(n)},close(){t.releaseLock(),s()},abort(n){return t.abort(n)}}),closed:r}}var GC=!0,YC=!0;function wk(e,t,s){let r={type:"module"},i,n;typeof e==gg&&(e=e());try{i=new URL(e,t)}catch{i=e}if(GC)try{n=new Worker(i)}catch{GC=!1,n=new Worker(i,r)}else n=new Worker(i,r);return n.addEventListener(MC,a=>Sk(a,s)),n}function $E(e,{worker:t,writer:s,onTaskFinished:r,transferStreams:i}){try{let{value:n,readable:a,writable:o}=e,c=[];if(n&&(e.value=n.buffer,c.push(e.value)),i&&YC?(a&&c.push(a),o&&c.push(o)):e.readable=e.writable=null,c.length)try{return t.postMessage(e,c),!0}catch{YC=!1,e.readable=e.writable=null,t.postMessage(e)}else t.postMessage(e)}catch(n){throw s&&s.releaseLock(),r(),n}}async function Sk({data:e},t){let{type:s,value:r,messageId:i,result:n,error:a}=e,{reader:o,writer:c,resolveResult:l,rejectResult:u,onTaskFinished:h}=t;try{if(a){let{message:d,stack:f,code:m,name:g}=a,b=new Error(d);Object.assign(b,{stack:f,code:m,name:g}),p(b)}else{if(s==FC){let{value:d,done:f}=await o.read();$E({type:KE,value:d,done:f,messageId:i},t)}s==KE&&(await c.ready,await c.write(new Uint8Array(r)),$E({type:UC,messageId:i},t)),s==HC&&p(null,n)}}catch(d){p(d)}function p(d,f){d?u(d):l(f),c&&c.releaseLock(),h()}}var Wc=[],QE=[];var VC=0;async function Ig(e,t){let{options:s,config:r}=t,{transferStreams:i,useWebWorkers:n,useCompressionStream:a,codecType:o,compressed:c,signed:l,encrypted:u}=s,{workerScripts:h,maxWorkers:p,terminateWorkerTimeout:d}=r;t.transferStreams=i||i===Ks;let f=!c&&!l&&!u&&!t.transferStreams;t.useWebWorkers=!f&&(n||n===Ks&&r.useWebWorkers),t.scripts=t.useWebWorkers&&h?h[o]:[],s.useCompressionStream=a||a===Ks&&r.useCompressionStream;let m,g=Wc.find(E=>!E.busy);if(g)zC(g),m=new vu(g,e,t,b);else if(Wc.length<p){let E={indexWorker:VC};VC++,Wc.push(E),m=new vu(E,e,t,b)}else m=await new Promise(E=>QE.push({resolve:E,stream:e,workerOptions:t}));return m.run();function b(E){if(QE.length){let[{resolve:y,stream:T,workerOptions:w}]=QE.splice(0,1);y(new vu(E,T,w,b))}else E.worker?(zC(E),Number.isFinite(d)&&d>=0&&(E.terminateTimeout=setTimeout(()=>{Wc=Wc.filter(y=>y!=E),E.terminate()},d))):Wc=Wc.filter(y=>y!=E)}}function zC(e){let{terminateTimeout:t}=e;t&&(clearTimeout(t),e.terminateTimeout=null)}function WC(e){let t=()=>URL.createObjectURL(new Blob([`const{Array:e,Object:t,Number:n,Math:r,Error:s,Uint8Array:i,Uint16Array:o,Uint32Array:c,Int32Array:f,Map:a,DataView:l,Promise:u,TextEncoder:w,crypto:h,postMessage:d,TransformStream:p,ReadableStream:y,WritableStream:m,CompressionStream:b,DecompressionStream:g}=self;class k{constructor(e){return class extends p{constructor(t,n){const r=new e(n);super({transform(e,t){t.enqueue(r.append(e))},flush(e){const t=r.flush();t&&e.enqueue(t)}})}}}}const v=[];for(let e=0;256>e;e++){let t=e;for(let e=0;8>e;e++)1&t?t=t>>>1^3988292384:t>>>=1;v[e]=t}class S{constructor(e){this.t=e||-1}append(e){let t=0|this.t;for(let n=0,r=0|e.length;r>n;n++)t=t>>>8^v[255&(t^e[n])];this.t=t}get(){return~this.t}}class z extends p{constructor(){let e;const t=new S;super({transform(e,n){t.append(e),n.enqueue(e)},flush(){const n=new i(4);new l(n.buffer).setUint32(0,t.get()),e.value=n}}),e=this}}const C={concat(e,t){if(0===e.length||0===t.length)return e.concat(t);const n=e[e.length-1],r=C.i(n);return 32===r?e.concat(t):C.o(t,r,0|n,e.slice(0,e.length-1))},l(e){const t=e.length;if(0===t)return 0;const n=e[t-1];return 32*(t-1)+C.i(n)},u(e,t){if(32*e.length<t)return e;const n=(e=e.slice(0,r.ceil(t/32))).length;return t&=31,n>0&&t&&(e[n-1]=C.h(t,e[n-1]&2147483648>>t-1,1)),e},h:(e,t,n)=>32===e?t:(n?0|t:t<<32-e)+1099511627776*e,i:e=>r.round(e/1099511627776)||32,o(e,t,n,r){for(void 0===r&&(r=[]);t>=32;t-=32)r.push(n),n=0;if(0===t)return r.concat(e);for(let s=0;s<e.length;s++)r.push(n|e[s]>>>t),n=e[s]<<32-t;const s=e.length?e[e.length-1]:0,i=C.i(s);return r.push(C.h(t+i&31,t+i>32?n:r.pop(),1)),r}},x={p:{m(e){const t=C.l(e)/8,n=new i(t);let r;for(let s=0;t>s;s++)0==(3&s)&&(r=e[s/4]),n[s]=r>>>24,r<<=8;return n},g(e){const t=[];let n,r=0;for(n=0;n<e.length;n++)r=r<<8|e[n],3==(3&n)&&(t.push(r),r=0);return 3&n&&t.push(C.h(8*(3&n),r)),t}}},_=class{constructor(e){const t=this;t.blockSize=512,t.k=[1732584193,4023233417,2562383102,271733878,3285377520],t.v=[1518500249,1859775393,2400959708,3395469782],e?(t.S=e.S.slice(0),t.C=e.C.slice(0),t._=e._):t.reset()}reset(){const e=this;return e.S=e.k.slice(0),e.C=[],e._=0,e}update(e){const t=this;"string"==typeof e&&(e=x.A.g(e));const n=t.C=C.concat(t.C,e),r=t._,i=t._=r+C.l(e);if(i>9007199254740991)throw new s("Cannot hash more than 2^53 - 1 bits");const o=new c(n);let f=0;for(let e=t.blockSize+r-(t.blockSize+r&t.blockSize-1);i>=e;e+=t.blockSize)t.I(o.subarray(16*f,16*(f+1))),f+=1;return n.splice(0,16*f),t}D(){const e=this;let t=e.C;const n=e.S;t=C.concat(t,[C.h(1,1)]);for(let e=t.length+2;15&e;e++)t.push(0);for(t.push(r.floor(e._/4294967296)),t.push(0|e._);t.length;)e.I(t.splice(0,16));return e.reset(),n}V(e,t,n,r){return e>19?e>39?e>59?e>79?void 0:t^n^r:t&n|t&r|n&r:t^n^r:t&n|~t&r}P(e,t){return t<<e|t>>>32-e}I(t){const n=this,s=n.S,i=e(80);for(let e=0;16>e;e++)i[e]=t[e];let o=s[0],c=s[1],f=s[2],a=s[3],l=s[4];for(let e=0;79>=e;e++){16>e||(i[e]=n.P(1,i[e-3]^i[e-8]^i[e-14]^i[e-16]));const t=n.P(5,o)+n.V(e,c,f,a)+l+i[e]+n.v[r.floor(e/20)]|0;l=a,a=f,f=n.P(30,c),c=o,o=t}s[0]=s[0]+o|0,s[1]=s[1]+c|0,s[2]=s[2]+f|0,s[3]=s[3]+a|0,s[4]=s[4]+l|0}},A={getRandomValues(e){const t=new c(e.buffer),n=e=>{let t=987654321;const n=4294967295;return()=>(t=36969*(65535&t)+(t>>16)&n,(((t<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n)/4294967296+.5)*(r.random()>.5?1:-1))};for(let s,i=0;i<e.length;i+=4){const e=n(4294967296*(s||r.random()));s=987654071*e(),t[i/4]=4294967296*e()|0}return e}},I={importKey:e=>new I.R(x.p.g(e)),B(e,t,n,r){if(n=n||1e4,0>r||0>n)throw new s("invalid params to pbkdf2");const i=1+(r>>5)<<2;let o,c,f,a,u;const w=new ArrayBuffer(i),h=new l(w);let d=0;const p=C;for(t=x.p.g(t),u=1;(i||1)>d;u++){for(o=c=e.encrypt(p.concat(t,[u])),f=1;n>f;f++)for(c=e.encrypt(c),a=0;a<c.length;a++)o[a]^=c[a];for(f=0;(i||1)>d&&f<o.length;f++)h.setInt32(d,o[f]),d+=4}return w.slice(0,r/8)},R:class{constructor(e){const t=this,n=t.M=_,r=[[],[]];t.K=[new n,new n];const s=t.K[0].blockSize/32;e.length>s&&(e=(new n).update(e).D());for(let t=0;s>t;t++)r[0][t]=909522486^e[t],r[1][t]=1549556828^e[t];t.K[0].update(r[0]),t.K[1].update(r[1]),t.U=new n(t.K[0])}reset(){const e=this;e.U=new e.M(e.K[0]),e.N=!1}update(e){this.N=!0,this.U.update(e)}digest(){const e=this,t=e.U.D(),n=new e.M(e.K[1]).update(t).D();return e.reset(),n}encrypt(e){if(this.N)throw new s("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}}},D=void 0!==h&&"function"==typeof h.getRandomValues,V="Invalid password",P="Invalid signature",R="zipjs-abort-check-password";function B(e){return D?h.getRandomValues(e):A.getRandomValues(e)}const E=16,M={name:"PBKDF2"},K=t.assign({hash:{name:"HMAC"}},M),U=t.assign({iterations:1e3,hash:{name:"SHA-1"}},M),N=["deriveBits"],O=[8,12,16],T=[16,24,32],W=10,j=[0,0,0,0],H="undefined",L="function",F=typeof h!=H,q=F&&h.subtle,G=F&&typeof q!=H,J=x.p,Q=class{constructor(e){const t=this;t.O=[[[],[],[],[],[]],[[],[],[],[],[]]],t.O[0][0][0]||t.T();const n=t.O[0][4],r=t.O[1],i=e.length;let o,c,f,a=1;if(4!==i&&6!==i&&8!==i)throw new s("invalid aes key size");for(t.v=[c=e.slice(0),f=[]],o=i;4*i+28>o;o++){let e=c[o-1];(o%i==0||8===i&&o%i==4)&&(e=n[e>>>24]<<24^n[e>>16&255]<<16^n[e>>8&255]<<8^n[255&e],o%i==0&&(e=e<<8^e>>>24^a<<24,a=a<<1^283*(a>>7))),c[o]=c[o-i]^e}for(let e=0;o;e++,o--){const t=c[3&e?o:o-4];f[e]=4>=o||4>e?t:r[0][n[t>>>24]]^r[1][n[t>>16&255]]^r[2][n[t>>8&255]]^r[3][n[255&t]]}}encrypt(e){return this.W(e,0)}decrypt(e){return this.W(e,1)}T(){const e=this.O[0],t=this.O[1],n=e[4],r=t[4],s=[],i=[];let o,c,f,a;for(let e=0;256>e;e++)i[(s[e]=e<<1^283*(e>>7))^e]=e;for(let l=o=0;!n[l];l^=c||1,o=i[o]||1){let i=o^o<<1^o<<2^o<<3^o<<4;i=i>>8^255&i^99,n[l]=i,r[i]=l,a=s[f=s[c=s[l]]];let u=16843009*a^65537*f^257*c^16843008*l,w=257*s[i]^16843008*i;for(let n=0;4>n;n++)e[n][l]=w=w<<24^w>>>8,t[n][i]=u=u<<24^u>>>8}for(let n=0;5>n;n++)e[n]=e[n].slice(0),t[n]=t[n].slice(0)}W(e,t){if(4!==e.length)throw new s("invalid aes block size");const n=this.v[t],r=n.length/4-2,i=[0,0,0,0],o=this.O[t],c=o[0],f=o[1],a=o[2],l=o[3],u=o[4];let w,h,d,p=e[0]^n[0],y=e[t?3:1]^n[1],m=e[2]^n[2],b=e[t?1:3]^n[3],g=4;for(let e=0;r>e;e++)w=c[p>>>24]^f[y>>16&255]^a[m>>8&255]^l[255&b]^n[g],h=c[y>>>24]^f[m>>16&255]^a[b>>8&255]^l[255&p]^n[g+1],d=c[m>>>24]^f[b>>16&255]^a[p>>8&255]^l[255&y]^n[g+2],b=c[b>>>24]^f[p>>16&255]^a[y>>8&255]^l[255&m]^n[g+3],g+=4,p=w,y=h,m=d;for(let e=0;4>e;e++)i[t?3&-e:e]=u[p>>>24]<<24^u[y>>16&255]<<16^u[m>>8&255]<<8^u[255&b]^n[g++],w=p,p=y,y=m,m=b,b=w;return i}},X=class{constructor(e,t){this.j=e,this.H=t,this.L=t}reset(){this.L=this.H}update(e){return this.F(this.j,e,this.L)}q(e){if(255==(e>>24&255)){let t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}else e+=1<<24;return e}G(e){0===(e[0]=this.q(e[0]))&&(e[1]=this.q(e[1]))}F(e,t,n){let r;if(!(r=t.length))return[];const s=C.l(t);for(let s=0;r>s;s+=4){this.G(n);const r=e.encrypt(n);t[s]^=r[0],t[s+1]^=r[1],t[s+2]^=r[2],t[s+3]^=r[3]}return C.u(t,s)}},Y=I.R;let Z=F&&G&&typeof q.importKey==L,$=F&&G&&typeof q.deriveBits==L;class ee extends p{constructor({password:e,signed:n,encryptionStrength:r,checkPasswordOnly:o}){super({start(){t.assign(this,{ready:new u((e=>this.J=e)),password:e,signed:n,X:r-1,pending:new i})},async transform(e,t){const n=this,{password:r,X:c,J:f,ready:a}=n;r?(await(async(e,t,n,r)=>{const i=await re(e,t,n,ie(r,0,O[t])),o=ie(r,O[t]);if(i[0]!=o[0]||i[1]!=o[1])throw new s(V)})(n,c,r,ie(e,0,O[c]+2)),e=ie(e,O[c]+2),o?t.error(new s(R)):f()):await a;const l=new i(e.length-W-(e.length-W)%E);t.enqueue(ne(n,e,l,0,W,!0))},async flush(e){const{signed:t,Y:n,Z:r,pending:o,ready:c}=this;await c;const f=ie(o,0,o.length-W),a=ie(o,o.length-W);let l=new i;if(f.length){const e=ce(J,f);r.update(e);const t=n.update(e);l=oe(J,t)}if(t){const e=ie(oe(J,r.digest()),0,W);for(let t=0;W>t;t++)if(e[t]!=a[t])throw new s(P)}e.enqueue(l)}})}}class te extends p{constructor({password:e,encryptionStrength:n}){let r;super({start(){t.assign(this,{ready:new u((e=>this.J=e)),password:e,X:n-1,pending:new i})},async transform(e,t){const n=this,{password:r,X:s,J:o,ready:c}=n;let f=new i;r?(f=await(async(e,t,n)=>{const r=B(new i(O[t]));return se(r,await re(e,t,n,r))})(n,s,r),o()):await c;const a=new i(f.length+e.length-e.length%E);a.set(f,0),t.enqueue(ne(n,e,a,f.length,0))},async flush(e){const{Y:t,Z:n,pending:s,ready:o}=this;await o;let c=new i;if(s.length){const e=t.update(ce(J,s));n.update(e),c=oe(J,e)}r.signature=oe(J,n.digest()).slice(0,W),e.enqueue(se(c,r.signature))}}),r=this}}function ne(e,t,n,r,s,o){const{Y:c,Z:f,pending:a}=e,l=t.length-s;let u;for(a.length&&(t=se(a,t),n=((e,t)=>{if(t&&t>e.length){const n=e;(e=new i(t)).set(n,0)}return e})(n,l-l%E)),u=0;l-E>=u;u+=E){const e=ce(J,ie(t,u,u+E));o&&f.update(e);const s=c.update(e);o||f.update(s),n.set(oe(J,s),u+r)}return e.pending=ie(t,u),n}async function re(n,r,s,o){n.password=null;const c=(e=>{if(void 0===w){const t=new i((e=unescape(encodeURIComponent(e))).length);for(let n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}return(new w).encode(e)})(s),f=await(async(e,t,n,r,s)=>{if(!Z)return I.importKey(t);try{return await q.importKey("raw",t,n,!1,s)}catch(e){return Z=!1,I.importKey(t)}})(0,c,K,0,N),a=await(async(e,t,n)=>{if(!$)return I.B(t,e.salt,U.iterations,n);try{return await q.deriveBits(e,t,n)}catch(r){return $=!1,I.B(t,e.salt,U.iterations,n)}})(t.assign({salt:o},U),f,8*(2*T[r]+2)),l=new i(a),u=ce(J,ie(l,0,T[r])),h=ce(J,ie(l,T[r],2*T[r])),d=ie(l,2*T[r]);return t.assign(n,{keys:{key:u,$:h,passwordVerification:d},Y:new X(new Q(u),e.from(j)),Z:new Y(h)}),d}function se(e,t){let n=e;return e.length+t.length&&(n=new i(e.length+t.length),n.set(e,0),n.set(t,e.length)),n}function ie(e,t,n){return e.subarray(t,n)}function oe(e,t){return e.m(t)}function ce(e,t){return e.g(t)}class fe extends p{constructor({password:e,passwordVerification:n,checkPasswordOnly:r}){super({start(){t.assign(this,{password:e,passwordVerification:n}),we(this,e)},transform(e,t){const n=this;if(n.password){const t=le(n,e.subarray(0,12));if(n.password=null,t[11]!=n.passwordVerification)throw new s(V);e=e.subarray(12)}r?t.error(new s(R)):t.enqueue(le(n,e))}})}}class ae extends p{constructor({password:e,passwordVerification:n}){super({start(){t.assign(this,{password:e,passwordVerification:n}),we(this,e)},transform(e,t){const n=this;let r,s;if(n.password){n.password=null;const t=B(new i(12));t[11]=n.passwordVerification,r=new i(e.length+t.length),r.set(ue(n,t),0),s=12}else r=new i(e.length),s=0;r.set(ue(n,e),s),t.enqueue(r)}})}}function le(e,t){const n=new i(t.length);for(let r=0;r<t.length;r++)n[r]=de(e)^t[r],he(e,n[r]);return n}function ue(e,t){const n=new i(t.length);for(let r=0;r<t.length;r++)n[r]=de(e)^t[r],he(e,t[r]);return n}function we(e,n){const r=[305419896,591751049,878082192];t.assign(e,{keys:r,ee:new S(r[0]),te:new S(r[2])});for(let t=0;t<n.length;t++)he(e,n.charCodeAt(t))}function he(e,t){let[n,s,i]=e.keys;e.ee.append([t]),n=~e.ee.get(),s=ye(r.imul(ye(s+pe(n)),134775813)+1),e.te.append([s>>>24]),i=~e.te.get(),e.keys=[n,s,i]}function de(e){const t=2|e.keys[2];return pe(r.imul(t,1^t)>>>8)}function pe(e){return 255&e}function ye(e){return 4294967295&e}const me="deflate-raw";class be extends p{constructor(e,{chunkSize:t,CompressionStream:n,CompressionStreamNative:r}){super({});const{compressed:s,encrypted:i,useCompressionStream:o,zipCrypto:c,signed:f,level:a}=e,u=this;let w,h,d=ke(super.readable);i&&!c||!f||(w=new z,d=ze(d,w)),s&&(d=Se(d,o,{level:a,chunkSize:t},r,n)),i&&(c?d=ze(d,new ae(e)):(h=new te(e),d=ze(d,h))),ve(u,d,(async()=>{let e;i&&!c&&(e=h.signature),i&&!c||!f||(e=new l(w.value.buffer).getUint32(0)),u.signature=e}))}}class ge extends p{constructor(e,{chunkSize:t,DecompressionStream:n,DecompressionStreamNative:r}){super({});const{zipCrypto:i,encrypted:o,signed:c,signature:f,compressed:a,useCompressionStream:u}=e;let w,h,d=ke(super.readable);o&&(i?d=ze(d,new fe(e)):(h=new ee(e),d=ze(d,h))),a&&(d=Se(d,u,{chunkSize:t},r,n)),o&&!i||!c||(w=new z,d=ze(d,w)),ve(this,d,(async()=>{if((!o||i)&&c){const e=new l(w.value.buffer);if(f!=e.getUint32(0,!1))throw new s(P)}}))}}function ke(e){return ze(e,new p({transform(e,t){e&&e.length&&t.enqueue(e)}}))}function ve(e,n,r){n=ze(n,new p({flush:r})),t.defineProperty(e,"readable",{get:()=>n})}function Se(e,t,n,r,s){try{e=ze(e,new(t&&r?r:s)(me,n))}catch(r){if(!t)throw r;e=ze(e,new s(me,n))}return e}function ze(e,t){return e.pipeThrough(t)}const Ce="data";class xe extends p{constructor(e,n){super({});const r=this,{codecType:s}=e;let i;s.startsWith("deflate")?i=be:s.startsWith("inflate")&&(i=ge);let o=0;const c=new i(e,n),f=super.readable,a=new p({transform(e,t){e&&e.length&&(o+=e.length,t.enqueue(e))},flush(){const{signature:e}=c;t.assign(r,{signature:e,size:o})}});t.defineProperty(r,"readable",{get:()=>f.pipeThrough(c).pipeThrough(a)})}}const _e=new a,Ae=new a;let Ie=0;async function De(e){try{const{options:t,scripts:r,config:s}=e;r&&r.length&&importScripts.apply(void 0,r),self.initCodec&&self.initCodec(),s.CompressionStreamNative=self.CompressionStream,s.DecompressionStreamNative=self.DecompressionStream,self.Deflate&&(s.CompressionStream=new k(self.Deflate)),self.Inflate&&(s.DecompressionStream=new k(self.Inflate));const i={highWaterMark:1,size:()=>s.chunkSize},o=e.readable||new y({async pull(e){const t=new u((e=>_e.set(Ie,e)));Ve({type:"pull",messageId:Ie}),Ie=(Ie+1)%n.MAX_SAFE_INTEGER;const{value:r,done:s}=await t;e.enqueue(r),s&&e.close()}},i),c=e.writable||new m({async write(e){let t;const r=new u((e=>t=e));Ae.set(Ie,t),Ve({type:Ce,value:e,messageId:Ie}),Ie=(Ie+1)%n.MAX_SAFE_INTEGER,await r}},i),f=new xe(t,s);await o.pipeThrough(f).pipeTo(c,{preventClose:!0,preventAbort:!0});try{await c.getWriter().close()}catch(e){}const{signature:a,size:l}=f;Ve({type:"close",result:{signature:a,size:l}})}catch(e){Pe(e)}}function Ve(e){let{value:t}=e;if(t)if(t.length)try{t=new i(t),e.value=t.buffer,d(e,[e.value])}catch(t){d(e)}else d(e);else d(e)}function Pe(e){const{message:t,stack:n,code:r,name:s}=e;d({error:{message:t,stack:n,code:r,name:s}})}addEventListener("message",(({data:e})=>{const{type:t,messageId:n,value:r,done:s}=e;try{if("start"==t&&De(e),t==Ce){const e=_e.get(n);_e.delete(n),e({value:new i(r),done:s})}if("ack"==t){const e=Ae.get(n);Ae.delete(n),e()}}catch(e){Pe(e)}}));const Re=-2;function Be(t){return Ee(t.map((([t,n])=>new e(t).fill(n,0,t))))}function Ee(t){return t.reduce(((t,n)=>t.concat(e.isArray(n)?Ee(n):n)),[])}const Me=[0,1,2,3].concat(...Be([[2,4],[2,5],[4,6],[4,7],[8,8],[8,9],[16,10],[16,11],[32,12],[32,13],[64,14],[64,15],[2,0],[1,16],[1,17],[2,18],[2,19],[4,20],[4,21],[8,22],[8,23],[16,24],[16,25],[32,26],[32,27],[64,28],[64,29]]));function Ke(){const e=this;function t(e,t){let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}e.ne=n=>{const s=e.re,i=e.ie.se,o=e.ie.oe;let c,f,a,l=-1;for(n.ce=0,n.fe=573,c=0;o>c;c++)0!==s[2*c]?(n.ae[++n.ce]=l=c,n.le[c]=0):s[2*c+1]=0;for(;2>n.ce;)a=n.ae[++n.ce]=2>l?++l:0,s[2*a]=1,n.le[a]=0,n.ue--,i&&(n.we-=i[2*a+1]);for(e.he=l,c=r.floor(n.ce/2);c>=1;c--)n.de(s,c);a=o;do{c=n.ae[1],n.ae[1]=n.ae[n.ce--],n.de(s,1),f=n.ae[1],n.ae[--n.fe]=c,n.ae[--n.fe]=f,s[2*a]=s[2*c]+s[2*f],n.le[a]=r.max(n.le[c],n.le[f])+1,s[2*c+1]=s[2*f+1]=a,n.ae[1]=a++,n.de(s,1)}while(n.ce>=2);n.ae[--n.fe]=n.ae[1],(t=>{const n=e.re,r=e.ie.se,s=e.ie.pe,i=e.ie.ye,o=e.ie.me;let c,f,a,l,u,w,h=0;for(l=0;15>=l;l++)t.be[l]=0;for(n[2*t.ae[t.fe]+1]=0,c=t.fe+1;573>c;c++)f=t.ae[c],l=n[2*n[2*f+1]+1]+1,l>o&&(l=o,h++),n[2*f+1]=l,f>e.he||(t.be[l]++,u=0,i>f||(u=s[f-i]),w=n[2*f],t.ue+=w*(l+u),r&&(t.we+=w*(r[2*f+1]+u)));if(0!==h){do{for(l=o-1;0===t.be[l];)l--;t.be[l]--,t.be[l+1]+=2,t.be[o]--,h-=2}while(h>0);for(l=o;0!==l;l--)for(f=t.be[l];0!==f;)a=t.ae[--c],a>e.he||(n[2*a+1]!=l&&(t.ue+=(l-n[2*a+1])*n[2*a],n[2*a+1]=l),f--)}})(n),((e,n,r)=>{const s=[];let i,o,c,f=0;for(i=1;15>=i;i++)s[i]=f=f+r[i-1]<<1;for(o=0;n>=o;o++)c=e[2*o+1],0!==c&&(e[2*o]=t(s[c]++,c))})(s,e.he,n.be)}}function Ue(e,t,n,r,s){const i=this;i.se=e,i.pe=t,i.ye=n,i.oe=r,i.me=s}Ke.ge=[0,1,2,3,4,5,6,7].concat(...Be([[2,8],[2,9],[2,10],[2,11],[4,12],[4,13],[4,14],[4,15],[8,16],[8,17],[8,18],[8,19],[16,20],[16,21],[16,22],[16,23],[32,24],[32,25],[32,26],[31,27],[1,28]])),Ke.ke=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],Ke.ve=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],Ke.Se=e=>256>e?Me[e]:Me[256+(e>>>7)],Ke.ze=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ke.Ce=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ke.xe=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ke._e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];const Ne=Be([[144,8],[112,9],[24,7],[8,8]]);Ue.Ae=Ee([12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,19,275,147,403,83,339,211,467,51,307,179,435,115,371,243,499,11,267,139,395,75,331,203,459,43,299,171,427,107,363,235,491,27,283,155,411,91,347,219,475,59,315,187,443,123,379,251,507,7,263,135,391,71,327,199,455,39,295,167,423,103,359,231,487,23,279,151,407,87,343,215,471,55,311,183,439,119,375,247,503,15,271,143,399,79,335,207,463,47,303,175,431,111,367,239,495,31,287,159,415,95,351,223,479,63,319,191,447,127,383,255,511,0,64,32,96,16,80,48,112,8,72,40,104,24,88,56,120,4,68,36,100,20,84,52,116,3,131,67,195,35,163,99,227].map(((e,t)=>[e,Ne[t]])));const Oe=Be([[30,5]]);function Te(e,t,n,r,s){const i=this;i.Ie=e,i.De=t,i.Ve=n,i.Pe=r,i.Re=s}Ue.Be=Ee([0,16,8,24,4,20,12,28,2,18,10,26,6,22,14,30,1,17,9,25,5,21,13,29,3,19,11,27,7,23].map(((e,t)=>[e,Oe[t]]))),Ue.Ee=new Ue(Ue.Ae,Ke.ze,257,286,15),Ue.Me=new Ue(Ue.Be,Ke.Ce,0,30,15),Ue.Ke=new Ue(null,Ke.xe,0,19,7);const We=[new Te(0,0,0,0,0),new Te(4,4,8,4,1),new Te(4,5,16,8,1),new Te(4,6,32,32,1),new Te(4,4,16,16,2),new Te(8,16,32,32,2),new Te(8,16,128,128,2),new Te(8,32,128,256,2),new Te(32,128,258,1024,2),new Te(32,258,258,4096,2)],je=["need dictionary","stream end","","","stream error","data error","","buffer error","",""],He=113,Le=666,Fe=262;function qe(e,t,n,r){const s=e[2*t],i=e[2*n];return i>s||s==i&&r[t]<=r[n]}function Ge(){const e=this;let t,n,s,c,f,a,l,u,w,h,d,p,y,m,b,g,k,v,S,z,C,x,_,A,I,D,V,P,R,B,E,M,K;const U=new Ke,N=new Ke,O=new Ke;let T,W,j,H,L,F;function q(){let t;for(t=0;286>t;t++)E[2*t]=0;for(t=0;30>t;t++)M[2*t]=0;for(t=0;19>t;t++)K[2*t]=0;E[512]=1,e.ue=e.we=0,W=j=0}function G(e,t){let n,r=-1,s=e[1],i=0,o=7,c=4;0===s&&(o=138,c=3),e[2*(t+1)+1]=65535;for(let f=0;t>=f;f++)n=s,s=e[2*(f+1)+1],++i<o&&n==s||(c>i?K[2*n]+=i:0!==n?(n!=r&&K[2*n]++,K[32]++):i>10?K[36]++:K[34]++,i=0,r=n,0===s?(o=138,c=3):n==s?(o=6,c=3):(o=7,c=4))}function J(t){e.Ue[e.pending++]=t}function Q(e){J(255&e),J(e>>>8&255)}function X(e,t){let n;const r=t;F>16-r?(n=e,L|=n<<F&65535,Q(L),L=n>>>16-F,F+=r-16):(L|=e<<F&65535,F+=r)}function Y(e,t){const n=2*e;X(65535&t[n],65535&t[n+1])}function Z(e,t){let n,r,s=-1,i=e[1],o=0,c=7,f=4;for(0===i&&(c=138,f=3),n=0;t>=n;n++)if(r=i,i=e[2*(n+1)+1],++o>=c||r!=i){if(f>o)do{Y(r,K)}while(0!=--o);else 0!==r?(r!=s&&(Y(r,K),o--),Y(16,K),X(o-3,2)):o>10?(Y(18,K),X(o-11,7)):(Y(17,K),X(o-3,3));o=0,s=r,0===i?(c=138,f=3):r==i?(c=6,f=3):(c=7,f=4)}}function $(){16==F?(Q(L),L=0,F=0):8>F||(J(255&L),L>>>=8,F-=8)}function ee(t,n){let s,i,o;if(e.Ne[W]=t,e.Oe[W]=255&n,W++,0===t?E[2*n]++:(j++,t--,E[2*(Ke.ge[n]+256+1)]++,M[2*Ke.Se(t)]++),0==(8191&W)&&V>2){for(s=8*W,i=C-k,o=0;30>o;o++)s+=M[2*o]*(5+Ke.Ce[o]);if(s>>>=3,j<r.floor(W/2)&&s<r.floor(i/2))return!0}return W==T-1}function te(t,n){let r,s,i,o,c=0;if(0!==W)do{r=e.Ne[c],s=e.Oe[c],c++,0===r?Y(s,t):(i=Ke.ge[s],Y(i+256+1,t),o=Ke.ze[i],0!==o&&(s-=Ke.ke[i],X(s,o)),r--,i=Ke.Se(r),Y(i,n),o=Ke.Ce[i],0!==o&&(r-=Ke.ve[i],X(r,o)))}while(W>c);Y(256,t),H=t[513]}function ne(){F>8?Q(L):F>0&&J(255&L),L=0,F=0}function re(t,n,r){X(0+(r?1:0),3),((t,n)=>{ne(),H=8,Q(n),Q(~n),e.Ue.set(u.subarray(t,t+n),e.pending),e.pending+=n})(t,n)}function se(n){((t,n,r)=>{let s,i,o=0;V>0?(U.ne(e),N.ne(e),o=(()=>{let t;for(G(E,U.he),G(M,N.he),O.ne(e),t=18;t>=3&&0===K[2*Ke._e[t]+1];t--);return e.ue+=14+3*(t+1),t})(),s=e.ue+3+7>>>3,i=e.we+3+7>>>3,i>s||(s=i)):s=i=n+5,n+4>s||-1==t?i==s?(X(2+(r?1:0),3),te(Ue.Ae,Ue.Be)):(X(4+(r?1:0),3),((e,t,n)=>{let r;for(X(e-257,5),X(t-1,5),X(n-4,4),r=0;n>r;r++)X(K[2*Ke._e[r]+1],3);Z(E,e-1),Z(M,t-1)})(U.he+1,N.he+1,o+1),te(E,M)):re(t,n,r),q(),r&&ne()})(0>k?-1:k,C-k,n),k=C,t.Te()}function ie(){let e,n,r,s;do{if(s=w-_-C,0===s&&0===C&&0===_)s=f;else if(-1==s)s--;else if(C>=f+f-Fe){u.set(u.subarray(f,f+f),0),x-=f,C-=f,k-=f,e=y,r=e;do{n=65535&d[--r],d[r]=f>n?0:n-f}while(0!=--e);e=f,r=e;do{n=65535&h[--r],h[r]=f>n?0:n-f}while(0!=--e);s+=f}if(0===t.We)return;e=t.je(u,C+_,s),_+=e,3>_||(p=255&u[C],p=(p<<g^255&u[C+1])&b)}while(Fe>_&&0!==t.We)}function oe(e){let t,n,r=I,s=C,i=A;const o=C>f-Fe?C-(f-Fe):0;let c=B;const a=l,w=C+258;let d=u[s+i-1],p=u[s+i];R>A||(r>>=2),c>_&&(c=_);do{if(t=e,u[t+i]==p&&u[t+i-1]==d&&u[t]==u[s]&&u[++t]==u[s+1]){s+=2,t++;do{}while(u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&u[++s]==u[++t]&&w>s);if(n=258-(w-s),s=w-258,n>i){if(x=e,i=n,n>=c)break;d=u[s+i-1],p=u[s+i]}}}while((e=65535&h[e&a])>o&&0!=--r);return i>_?_:i}e.le=[],e.be=[],e.ae=[],E=[],M=[],K=[],e.de=(t,n)=>{const r=e.ae,s=r[n];let i=n<<1;for(;i<=e.ce&&(i<e.ce&&qe(t,r[i+1],r[i],e.le)&&i++,!qe(t,s,r[i],e.le));)r[n]=r[i],n=i,i<<=1;r[n]=s},e.He=(t,S,x,W,j,G)=>(W||(W=8),j||(j=8),G||(G=0),t.Le=null,-1==S&&(S=6),1>j||j>9||8!=W||9>x||x>15||0>S||S>9||0>G||G>2?Re:(t.Fe=e,a=x,f=1<<a,l=f-1,m=j+7,y=1<<m,b=y-1,g=r.floor((m+3-1)/3),u=new i(2*f),h=[],d=[],T=1<<j+6,e.Ue=new i(4*T),s=4*T,e.Ne=new o(T),e.Oe=new i(T),V=S,P=G,(t=>(t.qe=t.Ge=0,t.Le=null,e.pending=0,e.Je=0,n=He,c=0,U.re=E,U.ie=Ue.Ee,N.re=M,N.ie=Ue.Me,O.re=K,O.ie=Ue.Ke,L=0,F=0,H=8,q(),(()=>{w=2*f,d[y-1]=0;for(let e=0;y-1>e;e++)d[e]=0;D=We[V].De,R=We[V].Ie,B=We[V].Ve,I=We[V].Pe,C=0,k=0,_=0,v=A=2,z=0,p=0})(),0))(t))),e.Qe=()=>42!=n&&n!=He&&n!=Le?Re:(e.Oe=null,e.Ne=null,e.Ue=null,d=null,h=null,u=null,e.Fe=null,n==He?-3:0),e.Xe=(e,t,n)=>{let r=0;return-1==t&&(t=6),0>t||t>9||0>n||n>2?Re:(We[V].Re!=We[t].Re&&0!==e.qe&&(r=e.Ye(1)),V!=t&&(V=t,D=We[V].De,R=We[V].Ie,B=We[V].Ve,I=We[V].Pe),P=n,r)},e.Ze=(e,t,r)=>{let s,i=r,o=0;if(!t||42!=n)return Re;if(3>i)return 0;for(i>f-Fe&&(i=f-Fe,o=r-i),u.set(t.subarray(o,o+i),0),C=i,k=i,p=255&u[0],p=(p<<g^255&u[1])&b,s=0;i-3>=s;s++)p=(p<<g^255&u[s+2])&b,h[s&l]=d[p],d[p]=s;return 0},e.Ye=(r,i)=>{let o,w,m,I,R;if(i>4||0>i)return Re;if(!r.$e||!r.et&&0!==r.We||n==Le&&4!=i)return r.Le=je[4],Re;if(0===r.tt)return r.Le=je[7],-5;var B;if(t=r,I=c,c=i,42==n&&(w=8+(a-8<<4)<<8,m=(V-1&255)>>1,m>3&&(m=3),w|=m<<6,0!==C&&(w|=32),w+=31-w%31,n=He,J((B=w)>>8&255),J(255&B)),0!==e.pending){if(t.Te(),0===t.tt)return c=-1,0}else if(0===t.We&&I>=i&&4!=i)return t.Le=je[7],-5;if(n==Le&&0!==t.We)return r.Le=je[7],-5;if(0!==t.We||0!==_||0!=i&&n!=Le){switch(R=-1,We[V].Re){case 0:R=(e=>{let n,r=65535;for(r>s-5&&(r=s-5);;){if(1>=_){if(ie(),0===_&&0==e)return 0;if(0===_)break}if(C+=_,_=0,n=k+r,(0===C||C>=n)&&(_=C-n,C=n,se(!1),0===t.tt))return 0;if(C-k>=f-Fe&&(se(!1),0===t.tt))return 0}return se(4==e),0===t.tt?4==e?2:0:4==e?3:1})(i);break;case 1:R=(e=>{let n,r=0;for(;;){if(Fe>_){if(ie(),Fe>_&&0==e)return 0;if(0===_)break}if(3>_||(p=(p<<g^255&u[C+2])&b,r=65535&d[p],h[C&l]=d[p],d[p]=C),0===r||(C-r&65535)>f-Fe||2!=P&&(v=oe(r)),3>v)n=ee(0,255&u[C]),_--,C++;else if(n=ee(C-x,v-3),_-=v,v>D||3>_)C+=v,v=0,p=255&u[C],p=(p<<g^255&u[C+1])&b;else{v--;do{C++,p=(p<<g^255&u[C+2])&b,r=65535&d[p],h[C&l]=d[p],d[p]=C}while(0!=--v);C++}if(n&&(se(!1),0===t.tt))return 0}return se(4==e),0===t.tt?4==e?2:0:4==e?3:1})(i);break;case 2:R=(e=>{let n,r,s=0;for(;;){if(Fe>_){if(ie(),Fe>_&&0==e)return 0;if(0===_)break}if(3>_||(p=(p<<g^255&u[C+2])&b,s=65535&d[p],h[C&l]=d[p],d[p]=C),A=v,S=x,v=2,0!==s&&D>A&&f-Fe>=(C-s&65535)&&(2!=P&&(v=oe(s)),5>=v&&(1==P||3==v&&C-x>4096)&&(v=2)),3>A||v>A)if(0!==z){if(n=ee(0,255&u[C-1]),n&&se(!1),C++,_--,0===t.tt)return 0}else z=1,C++,_--;else{r=C+_-3,n=ee(C-1-S,A-3),_-=A-1,A-=2;do{++C>r||(p=(p<<g^255&u[C+2])&b,s=65535&d[p],h[C&l]=d[p],d[p]=C)}while(0!=--A);if(z=0,v=2,C++,n&&(se(!1),0===t.tt))return 0}}return 0!==z&&(n=ee(0,255&u[C-1]),z=0),se(4==e),0===t.tt?4==e?2:0:4==e?3:1})(i)}if(2!=R&&3!=R||(n=Le),0==R||2==R)return 0===t.tt&&(c=-1),0;if(1==R){if(1==i)X(2,3),Y(256,Ue.Ae),$(),9>1+H+10-F&&(X(2,3),Y(256,Ue.Ae),$()),H=7;else if(re(0,0,!1),3==i)for(o=0;y>o;o++)d[o]=0;if(t.Te(),0===t.tt)return c=-1,0}}return 4!=i?0:1}}function Je(){const e=this;e.nt=0,e.rt=0,e.We=0,e.qe=0,e.tt=0,e.Ge=0}function Qe(e){const t=new Je,n=(o=e&&e.chunkSize?e.chunkSize:65536)+5*(r.floor(o/16383)+1);var o;const c=new i(n);let f=e?e.level:-1;void 0===f&&(f=-1),t.He(f),t.$e=c,this.append=(e,r)=>{let o,f,a=0,l=0,u=0;const w=[];if(e.length){t.nt=0,t.et=e,t.We=e.length;do{if(t.rt=0,t.tt=n,o=t.Ye(0),0!=o)throw new s("deflating: "+t.Le);t.rt&&(t.rt==n?w.push(new i(c)):w.push(c.subarray(0,t.rt))),u+=t.rt,r&&t.nt>0&&t.nt!=a&&(r(t.nt),a=t.nt)}while(t.We>0||0===t.tt);return w.length>1?(f=new i(u),w.forEach((e=>{f.set(e,l),l+=e.length}))):f=w[0]?new i(w[0]):new i,f}},this.flush=()=>{let e,r,o=0,f=0;const a=[];do{if(t.rt=0,t.tt=n,e=t.Ye(4),1!=e&&0!=e)throw new s("deflating: "+t.Le);n-t.tt>0&&a.push(c.slice(0,t.rt)),f+=t.rt}while(t.We>0||0===t.tt);return t.Qe(),r=new i(f),a.forEach((e=>{r.set(e,o),o+=e.length})),r}}Je.prototype={He(e,t){const n=this;return n.Fe=new Ge,t||(t=15),n.Fe.He(n,e,t)},Ye(e){const t=this;return t.Fe?t.Fe.Ye(t,e):Re},Qe(){const e=this;if(!e.Fe)return Re;const t=e.Fe.Qe();return e.Fe=null,t},Xe(e,t){const n=this;return n.Fe?n.Fe.Xe(n,e,t):Re},Ze(e,t){const n=this;return n.Fe?n.Fe.Ze(n,e,t):Re},je(e,t,n){const r=this;let s=r.We;return s>n&&(s=n),0===s?0:(r.We-=s,e.set(r.et.subarray(r.nt,r.nt+s),t),r.nt+=s,r.qe+=s,s)},Te(){const e=this;let t=e.Fe.pending;t>e.tt&&(t=e.tt),0!==t&&(e.$e.set(e.Fe.Ue.subarray(e.Fe.Je,e.Fe.Je+t),e.rt),e.rt+=t,e.Fe.Je+=t,e.Ge+=t,e.tt-=t,e.Fe.pending-=t,0===e.Fe.pending&&(e.Fe.Je=0))}};const Xe=-2,Ye=-3,Ze=-5,$e=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],et=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],tt=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],nt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],rt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],st=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],it=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function ot(){let e,t,n,r,s,i;function o(e,t,o,c,f,a,l,u,w,h,d){let p,y,m,b,g,k,v,S,z,C,x,_,A,I,D;C=0,g=o;do{n[e[t+C]]++,C++,g--}while(0!==g);if(n[0]==o)return l[0]=-1,u[0]=0,0;for(S=u[0],k=1;15>=k&&0===n[k];k++);for(v=k,k>S&&(S=k),g=15;0!==g&&0===n[g];g--);for(m=g,S>g&&(S=g),u[0]=S,I=1<<k;g>k;k++,I<<=1)if(0>(I-=n[k]))return Ye;if(0>(I-=n[g]))return Ye;for(n[g]+=I,i[1]=k=0,C=1,A=2;0!=--g;)i[A]=k+=n[C],A++,C++;g=0,C=0;do{0!==(k=e[t+C])&&(d[i[k]++]=g),C++}while(++g<o);for(o=i[m],i[0]=g=0,C=0,b=-1,_=-S,s[0]=0,x=0,D=0;m>=v;v++)for(p=n[v];0!=p--;){for(;v>_+S;){if(b++,_+=S,D=m-_,D=D>S?S:D,(y=1<<(k=v-_))>p+1&&(y-=p+1,A=v,D>k))for(;++k<D&&(y<<=1)>n[++A];)y-=n[A];if(D=1<<k,h[0]+D>1440)return Ye;s[b]=x=h[0],h[0]+=D,0!==b?(i[b]=g,r[0]=k,r[1]=S,k=g>>>_-S,r[2]=x-s[b-1]-k,w.set(r,3*(s[b-1]+k))):l[0]=x}for(r[1]=v-_,o>C?d[C]<c?(r[0]=256>d[C]?0:96,r[2]=d[C++]):(r[0]=a[d[C]-c]+16+64,r[2]=f[d[C++]-c]):r[0]=192,y=1<<v-_,k=g>>>_;D>k;k+=y)w.set(r,3*(x+k));for(k=1<<v-1;0!=(g&k);k>>>=1)g^=k;for(g^=k,z=(1<<_)-1;(g&z)!=i[b];)b--,_-=S,z=(1<<_)-1}return 0!==I&&1!=m?Ze:0}function c(o){let c;for(e||(e=[],t=[],n=new f(16),r=[],s=new f(15),i=new f(16)),t.length<o&&(t=[]),c=0;o>c;c++)t[c]=0;for(c=0;16>c;c++)n[c]=0;for(c=0;3>c;c++)r[c]=0;s.set(n.subarray(0,15),0),i.set(n.subarray(0,16),0)}this.st=(n,r,s,i,f)=>{let a;return c(19),e[0]=0,a=o(n,0,19,19,null,null,s,r,i,e,t),a==Ye?f.Le="oversubscribed dynamic bit lengths tree":a!=Ze&&0!==r[0]||(f.Le="incomplete dynamic bit lengths tree",a=Ye),a},this.it=(n,r,s,i,f,a,l,u,w)=>{let h;return c(288),e[0]=0,h=o(s,0,n,257,nt,rt,a,i,u,e,t),0!=h||0===i[0]?(h==Ye?w.Le="oversubscribed literal/length tree":-4!=h&&(w.Le="incomplete literal/length tree",h=Ye),h):(c(288),h=o(s,n,r,0,st,it,l,f,u,e,t),0!=h||0===f[0]&&n>257?(h==Ye?w.Le="oversubscribed distance tree":h==Ze?(w.Le="incomplete distance tree",h=Ye):-4!=h&&(w.Le="empty distance tree with lengths",h=Ye),h):0)}}function ct(){const e=this;let t,n,r,s,i=0,o=0,c=0,f=0,a=0,l=0,u=0,w=0,h=0,d=0;function p(e,t,n,r,s,i,o,c){let f,a,l,u,w,h,d,p,y,m,b,g,k,v,S,z;d=c.nt,p=c.We,w=o.ot,h=o.ct,y=o.write,m=y<o.read?o.read-y-1:o.end-y,b=$e[e],g=$e[t];do{for(;20>h;)p--,w|=(255&c.ft(d++))<<h,h+=8;if(f=w&b,a=n,l=r,z=3*(l+f),0!==(u=a[z]))for(;;){if(w>>=a[z+1],h-=a[z+1],0!=(16&u)){for(u&=15,k=a[z+2]+(w&$e[u]),w>>=u,h-=u;15>h;)p--,w|=(255&c.ft(d++))<<h,h+=8;for(f=w&g,a=s,l=i,z=3*(l+f),u=a[z];;){if(w>>=a[z+1],h-=a[z+1],0!=(16&u)){for(u&=15;u>h;)p--,w|=(255&c.ft(d++))<<h,h+=8;if(v=a[z+2]+(w&$e[u]),w>>=u,h-=u,m-=k,v>y){S=y-v;do{S+=o.end}while(0>S);if(u=o.end-S,k>u){if(k-=u,y-S>0&&u>y-S)do{o.lt[y++]=o.lt[S++]}while(0!=--u);else o.lt.set(o.lt.subarray(S,S+u),y),y+=u,S+=u,u=0;S=0}}else S=y-v,y-S>0&&2>y-S?(o.lt[y++]=o.lt[S++],o.lt[y++]=o.lt[S++],k-=2):(o.lt.set(o.lt.subarray(S,S+2),y),y+=2,S+=2,k-=2);if(y-S>0&&k>y-S)do{o.lt[y++]=o.lt[S++]}while(0!=--k);else o.lt.set(o.lt.subarray(S,S+k),y),y+=k,S+=k,k=0;break}if(0!=(64&u))return c.Le="invalid distance code",k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,Ye;f+=a[z+2],f+=w&$e[u],z=3*(l+f),u=a[z]}break}if(0!=(64&u))return 0!=(32&u)?(k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,1):(c.Le="invalid literal/length code",k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,Ye);if(f+=a[z+2],f+=w&$e[u],z=3*(l+f),0===(u=a[z])){w>>=a[z+1],h-=a[z+1],o.lt[y++]=a[z+2],m--;break}}else w>>=a[z+1],h-=a[z+1],o.lt[y++]=a[z+2],m--}while(m>=258&&p>=10);return k=c.We-p,k=k>h>>3?h>>3:k,p+=k,d-=k,h-=k<<3,o.ot=w,o.ct=h,c.We=p,c.qe+=d-c.nt,c.nt=d,o.write=y,0}e.init=(e,i,o,c,f,a)=>{t=0,u=e,w=i,r=o,h=c,s=f,d=a,n=null},e.ut=(e,y,m)=>{let b,g,k,v,S,z,C,x=0,_=0,A=0;for(A=y.nt,v=y.We,x=e.ot,_=e.ct,S=e.write,z=S<e.read?e.read-S-1:e.end-S;;)switch(t){case 0:if(z>=258&&v>=10&&(e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,m=p(u,w,r,h,s,d,e,y),A=y.nt,v=y.We,x=e.ot,_=e.ct,S=e.write,z=S<e.read?e.read-S-1:e.end-S,0!=m)){t=1==m?7:9;break}c=u,n=r,o=h,t=1;case 1:for(b=c;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}if(g=3*(o+(x&$e[b])),x>>>=n[g+1],_-=n[g+1],k=n[g],0===k){f=n[g+2],t=6;break}if(0!=(16&k)){a=15&k,i=n[g+2],t=2;break}if(0==(64&k)){c=k,o=g/3+n[g+2];break}if(0!=(32&k)){t=7;break}return t=9,y.Le="invalid literal/length code",m=Ye,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);case 2:for(b=a;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}i+=x&$e[b],x>>=b,_-=b,c=w,n=s,o=d,t=3;case 3:for(b=c;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}if(g=3*(o+(x&$e[b])),x>>=n[g+1],_-=n[g+1],k=n[g],0!=(16&k)){a=15&k,l=n[g+2],t=4;break}if(0==(64&k)){c=k,o=g/3+n[g+2];break}return t=9,y.Le="invalid distance code",m=Ye,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);case 4:for(b=a;b>_;){if(0===v)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,v--,x|=(255&y.ft(A++))<<_,_+=8}l+=x&$e[b],x>>=b,_-=b,t=5;case 5:for(C=S-l;0>C;)C+=e.end;for(;0!==i;){if(0===z&&(S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z&&(e.write=S,m=e.wt(y,m),S=e.write,z=S<e.read?e.read-S-1:e.end-S,S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z)))return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);e.lt[S++]=e.lt[C++],z--,C==e.end&&(C=0),i--}t=0;break;case 6:if(0===z&&(S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z&&(e.write=S,m=e.wt(y,m),S=e.write,z=S<e.read?e.read-S-1:e.end-S,S==e.end&&0!==e.read&&(S=0,z=S<e.read?e.read-S-1:e.end-S),0===z)))return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);m=0,e.lt[S++]=f,z--,t=0;break;case 7:if(_>7&&(_-=8,v++,A--),e.write=S,m=e.wt(y,m),S=e.write,z=S<e.read?e.read-S-1:e.end-S,e.read!=e.write)return e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);t=8;case 8:return m=1,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);case 9:return m=Ye,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m);default:return m=Xe,e.ot=x,e.ct=_,y.We=v,y.qe+=A-y.nt,y.nt=A,e.write=S,e.wt(y,m)}},e.ht=()=>{}}ot.dt=(e,t,n,r)=>(e[0]=9,t[0]=5,n[0]=et,r[0]=tt,0);const ft=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function at(e,t){const n=this;let r,s=0,o=0,c=0,a=0;const l=[0],u=[0],w=new ct;let h=0,d=new f(4320);const p=new ot;n.ct=0,n.ot=0,n.lt=new i(t),n.end=t,n.read=0,n.write=0,n.reset=(e,t)=>{t&&(t[0]=0),6==s&&w.ht(e),s=0,n.ct=0,n.ot=0,n.read=n.write=0},n.reset(e,null),n.wt=(e,t)=>{let r,s,i;return s=e.rt,i=n.read,r=(i>n.write?n.end:n.write)-i,r>e.tt&&(r=e.tt),0!==r&&t==Ze&&(t=0),e.tt-=r,e.Ge+=r,e.$e.set(n.lt.subarray(i,i+r),s),s+=r,i+=r,i==n.end&&(i=0,n.write==n.end&&(n.write=0),r=n.write-i,r>e.tt&&(r=e.tt),0!==r&&t==Ze&&(t=0),e.tt-=r,e.Ge+=r,e.$e.set(n.lt.subarray(i,i+r),s),s+=r,i+=r),e.rt=s,n.read=i,t},n.ut=(e,t)=>{let i,f,y,m,b,g,k,v;for(m=e.nt,b=e.We,f=n.ot,y=n.ct,g=n.write,k=g<n.read?n.read-g-1:n.end-g;;){let S,z,C,x,_,A,I,D;switch(s){case 0:for(;3>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}switch(i=7&f,h=1&i,i>>>1){case 0:f>>>=3,y-=3,i=7&y,f>>>=i,y-=i,s=1;break;case 1:S=[],z=[],C=[[]],x=[[]],ot.dt(S,z,C,x),w.init(S[0],z[0],C[0],0,x[0],0),f>>>=3,y-=3,s=6;break;case 2:f>>>=3,y-=3,s=3;break;case 3:return f>>>=3,y-=3,s=9,e.Le="invalid block type",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t)}break;case 1:for(;32>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if((~f>>>16&65535)!=(65535&f))return s=9,e.Le="invalid stored block lengths",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);o=65535&f,f=y=0,s=0!==o?2:0!==h?7:0;break;case 2:if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);if(0===k&&(g==n.end&&0!==n.read&&(g=0,k=g<n.read?n.read-g-1:n.end-g),0===k&&(n.write=g,t=n.wt(e,t),g=n.write,k=g<n.read?n.read-g-1:n.end-g,g==n.end&&0!==n.read&&(g=0,k=g<n.read?n.read-g-1:n.end-g),0===k)))return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);if(t=0,i=o,i>b&&(i=b),i>k&&(i=k),n.lt.set(e.je(m,i),g),m+=i,b-=i,g+=i,k-=i,0!=(o-=i))break;s=0!==h?7:0;break;case 3:for(;14>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if(c=i=16383&f,(31&i)>29||(i>>5&31)>29)return s=9,e.Le="too many length or distance symbols",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);if(i=258+(31&i)+(i>>5&31),!r||r.length<i)r=[];else for(v=0;i>v;v++)r[v]=0;f>>>=14,y-=14,a=0,s=4;case 4:for(;4+(c>>>10)>a;){for(;3>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}r[ft[a++]]=7&f,f>>>=3,y-=3}for(;19>a;)r[ft[a++]]=0;if(l[0]=7,i=p.st(r,l,u,d,e),0!=i)return(t=i)==Ye&&(r=null,s=9),n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);a=0,s=5;case 5:for(;i=c,258+(31&i)+(i>>5&31)>a;){let o,w;for(i=l[0];i>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if(i=d[3*(u[0]+(f&$e[i]))+1],w=d[3*(u[0]+(f&$e[i]))+2],16>w)f>>>=i,y-=i,r[a++]=w;else{for(v=18==w?7:w-14,o=18==w?11:3;i+v>y;){if(0===b)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);t=0,b--,f|=(255&e.ft(m++))<<y,y+=8}if(f>>>=i,y-=i,o+=f&$e[v],f>>>=v,y-=v,v=a,i=c,v+o>258+(31&i)+(i>>5&31)||16==w&&1>v)return r=null,s=9,e.Le="invalid bit length repeat",t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);w=16==w?r[v-1]:0;do{r[v++]=w}while(0!=--o);a=v}}if(u[0]=-1,_=[],A=[],I=[],D=[],_[0]=9,A[0]=6,i=c,i=p.it(257+(31&i),1+(i>>5&31),r,_,A,I,D,d,e),0!=i)return i==Ye&&(r=null,s=9),t=i,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);w.init(_[0],A[0],d,I[0],d,D[0]),s=6;case 6:if(n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,1!=(t=w.ut(n,e,t)))return n.wt(e,t);if(t=0,w.ht(e),m=e.nt,b=e.We,f=n.ot,y=n.ct,g=n.write,k=g<n.read?n.read-g-1:n.end-g,0===h){s=0;break}s=7;case 7:if(n.write=g,t=n.wt(e,t),g=n.write,k=g<n.read?n.read-g-1:n.end-g,n.read!=n.write)return n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);s=8;case 8:return t=1,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);case 9:return t=Ye,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t);default:return t=Xe,n.ot=f,n.ct=y,e.We=b,e.qe+=m-e.nt,e.nt=m,n.write=g,n.wt(e,t)}}},n.ht=e=>{n.reset(e,null),n.lt=null,d=null},n.yt=(e,t,r)=>{n.lt.set(e.subarray(t,t+r),0),n.read=n.write=r},n.bt=()=>1==s?1:0}const lt=13,ut=[0,0,255,255];function wt(){const e=this;function t(e){return e&&e.gt?(e.qe=e.Ge=0,e.Le=null,e.gt.mode=7,e.gt.kt.reset(e,null),0):Xe}e.mode=0,e.method=0,e.vt=[0],e.St=0,e.marker=0,e.zt=0,e.Ct=t=>(e.kt&&e.kt.ht(t),e.kt=null,0),e.xt=(n,r)=>(n.Le=null,e.kt=null,8>r||r>15?(e.Ct(n),Xe):(e.zt=r,n.gt.kt=new at(n,1<<r),t(n),0)),e._t=(e,t)=>{let n,r;if(!e||!e.gt||!e.et)return Xe;const s=e.gt;for(t=4==t?Ze:0,n=Ze;;)switch(s.mode){case 0:if(0===e.We)return n;if(n=t,e.We--,e.qe++,8!=(15&(s.method=e.ft(e.nt++)))){s.mode=lt,e.Le="unknown compression method",s.marker=5;break}if(8+(s.method>>4)>s.zt){s.mode=lt,e.Le="invalid win size",s.marker=5;break}s.mode=1;case 1:if(0===e.We)return n;if(n=t,e.We--,e.qe++,r=255&e.ft(e.nt++),((s.method<<8)+r)%31!=0){s.mode=lt,e.Le="incorrect header check",s.marker=5;break}if(0==(32&r)){s.mode=7;break}s.mode=2;case 2:if(0===e.We)return n;n=t,e.We--,e.qe++,s.St=(255&e.ft(e.nt++))<<24&4278190080,s.mode=3;case 3:if(0===e.We)return n;n=t,e.We--,e.qe++,s.St+=(255&e.ft(e.nt++))<<16&16711680,s.mode=4;case 4:if(0===e.We)return n;n=t,e.We--,e.qe++,s.St+=(255&e.ft(e.nt++))<<8&65280,s.mode=5;case 5:return 0===e.We?n:(n=t,e.We--,e.qe++,s.St+=255&e.ft(e.nt++),s.mode=6,2);case 6:return s.mode=lt,e.Le="need dictionary",s.marker=0,Xe;case 7:if(n=s.kt.ut(e,n),n==Ye){s.mode=lt,s.marker=0;break}if(0==n&&(n=t),1!=n)return n;n=t,s.kt.reset(e,s.vt),s.mode=12;case 12:return e.We=0,1;case lt:return Ye;default:return Xe}},e.At=(e,t,n)=>{let r=0,s=n;if(!e||!e.gt||6!=e.gt.mode)return Xe;const i=e.gt;return s<1<<i.zt||(s=(1<<i.zt)-1,r=n-s),i.kt.yt(t,r,s),i.mode=7,0},e.It=e=>{let n,r,s,i,o;if(!e||!e.gt)return Xe;const c=e.gt;if(c.mode!=lt&&(c.mode=lt,c.marker=0),0===(n=e.We))return Ze;for(r=e.nt,s=c.marker;0!==n&&4>s;)e.ft(r)==ut[s]?s++:s=0!==e.ft(r)?0:4-s,r++,n--;return e.qe+=r-e.nt,e.nt=r,e.We=n,c.marker=s,4!=s?Ye:(i=e.qe,o=e.Ge,t(e),e.qe=i,e.Ge=o,c.mode=7,0)},e.Dt=e=>e&&e.gt&&e.gt.kt?e.gt.kt.bt():Xe}function ht(){}function dt(e){const t=new ht,n=e&&e.chunkSize?r.floor(2*e.chunkSize):131072,o=new i(n);let c=!1;t.xt(),t.$e=o,this.append=(e,r)=>{const f=[];let a,l,u=0,w=0,h=0;if(0!==e.length){t.nt=0,t.et=e,t.We=e.length;do{if(t.rt=0,t.tt=n,0!==t.We||c||(t.nt=0,c=!0),a=t._t(0),c&&a===Ze){if(0!==t.We)throw new s("inflating: bad input")}else if(0!==a&&1!==a)throw new s("inflating: "+t.Le);if((c||1===a)&&t.We===e.length)throw new s("inflating: bad input");t.rt&&(t.rt===n?f.push(new i(o)):f.push(o.subarray(0,t.rt))),h+=t.rt,r&&t.nt>0&&t.nt!=u&&(r(t.nt),u=t.nt)}while(t.We>0||0===t.tt);return f.length>1?(l=new i(h),f.forEach((e=>{l.set(e,w),w+=e.length}))):l=f[0]?new i(f[0]):new i,l}},this.flush=()=>{t.Ct()}}ht.prototype={xt(e){const t=this;return t.gt=new wt,e||(e=15),t.gt.xt(t,e)},_t(e){const t=this;return t.gt?t.gt._t(t,e):Xe},Ct(){const e=this;if(!e.gt)return Xe;const t=e.gt.Ct(e);return e.gt=null,t},It(){const e=this;return e.gt?e.gt.It(e):Xe},At(e,t){const n=this;return n.gt?n.gt.At(n,e,t):Xe},ft(e){return this.et[e]},je(e,t){return this.et.subarray(e,e+t)}},self.initCodec=()=>{self.Deflate=Qe,self.Inflate=dt};
`],{type:"text/javascript"}));e({workerScripts:{inflate:[t],deflate:[t]}})}var XC="HTTP error ",Rd="HTTP Range not supported",ZC="Writer iterator completed too soon",_k="text/plain",Ak="Content-Length",Ck="Content-Range",Dk="Accept-Ranges",Pk="Range",Ok="Content-Type",Ik="HEAD",ib="GET",$C="bytes",xk=64*1024,nb="writable",Ru=class{constructor(){this.size=0}init(){this.initialized=!0}},pn=class extends Ru{get readable(){let t=this,{chunkSize:s=xk}=t,r=new ReadableStream({start(){this.chunkOffset=0},async pull(i){let{offset:n=0,size:a,diskNumberStart:o}=r,{chunkOffset:c}=this;i.enqueue(await Qr(t,n+c,Math.min(s,a-c),o)),c+s>a?i.close():this.chunkOffset+=s}});return r}},vd=class extends Ru{constructor(){super();let t=this,s=new WritableStream({write(r){return t.writeUint8Array(r)}});Object.defineProperty(t,nb,{get(){return s}})}writeUint8Array(){}},qc=class extends pn{constructor(t){super();let s=t.length;for(;t.charAt(s-1)=="=";)s--;let r=t.indexOf(",")+1;Object.assign(this,{dataURI:t,dataStart:r,size:Math.floor((s-r)*.75)})}readUint8Array(t,s){let{dataStart:r,dataURI:i}=this,n=new Uint8Array(s),a=Math.floor(t/3)*4,o=atob(i.substring(a+r,Math.ceil((t+s)/3)*4+r)),c=t-Math.floor(a/4)*3;for(let l=c;l<c+s;l++)n[l-c]=o.charCodeAt(l);return n}},Xo=class extends vd{constructor(t){super(),Object.assign(this,{data:"data:"+(t||"")+";base64,",pending:[]})}writeUint8Array(t){let s=this,r=0,i=s.pending,n=s.pending.length;for(s.pending="",r=0;r<Math.floor((n+t.length)/3)*3-n;r++)i+=String.fromCharCode(t[r]);for(;r<t.length;r++)s.pending+=String.fromCharCode(t[r]);i.length>2?s.data+=btoa(i):s.pending=i}getData(){return this.data+btoa(this.pending)}},Mi=class extends pn{constructor(t){super(),Object.assign(this,{blob:t,size:t.size})}async readUint8Array(t,s){let r=this,i=t+s,a=await(t||i<r.size?r.blob.slice(t,i):r.blob).arrayBuffer();return a.byteLength>s&&(a=a.slice(t,i)),new Uint8Array(a)}},Di=class extends Ru{constructor(t){super();let s=this,r=new TransformStream,i=[];t&&i.push([Ok,t]),Object.defineProperty(s,nb,{get(){return r.writable}}),s.blob=new Response(r.readable,{headers:i}).blob()}getData(){return this.blob}},to=class extends Mi{constructor(t){super(new Blob([t],{type:_k}))}},so=class extends Di{constructor(t){super(t),Object.assign(this,{encoding:t,utf8:!t||t.toLowerCase()=="utf-8"})}async getData(){let{encoding:t,utf8:s}=this,r=await super.getData();if(r.text&&s)return r.text();{let i=new FileReader;return new Promise((n,a)=>{Object.assign(i,{onload:({target:o})=>n(o.result),onerror:()=>a(i.error)}),i.readAsText(r,t)})}}},eb=class extends pn{constructor(t,s){super(),QC(this,t,s)}async init(){await eD(this,sb,qC),super.init()}readUint8Array(t,s){return tD(this,t,s,sb,qC)}},tb=class extends pn{constructor(t,s){super(),QC(this,t,s)}async init(){await eD(this,rb,JC),super.init()}readUint8Array(t,s){return tD(this,t,s,rb,JC)}};function QC(e,t,s){let{preventHeadRequest:r,useRangeHeader:i,forceRangeRequests:n}=s;s=Object.assign({},s),delete s.preventHeadRequest,delete s.useRangeHeader,delete s.forceRangeRequests,delete s.useXHR,Object.assign(e,{url:t,options:s,preventHeadRequest:r,useRangeHeader:i,forceRangeRequests:n})}async function eD(e,t,s){let{url:r,useRangeHeader:i,forceRangeRequests:n}=e;if(vk(r)&&(i||n)){let{headers:a}=await t(ib,e,sD(e));if(!n&&a.get(Dk)!=$C)throw new Error(Rd);{let o,c=a.get(Ck);if(c){let l=c.trim().split(/\s*\/\s*/);if(l.length){let u=l[1];u&&u!="*"&&(o=Number(u))}}o===Ks?await KC(e,t,s):e.size=o}}else await KC(e,t,s)}async function tD(e,t,s,r,i){let{useRangeHeader:n,forceRangeRequests:a,options:o}=e;if(n||a){let c=await r(ib,e,sD(e,t,s));if(c.status!=206)throw new Error(Rd);return new Uint8Array(await c.arrayBuffer())}else{let{data:c}=e;return c||await i(e,o),new Uint8Array(e.data.subarray(t,t+s))}}function sD(e,t=0,s=1){return Object.assign({},ab(e),{[Pk]:$C+"="+t+"-"+(t+s-1)})}function ab({options:e}){let{headers:t}=e;if(t)return Symbol.iterator in t?Object.fromEntries(t):t}async function qC(e){await rD(e,sb)}async function JC(e){await rD(e,rb)}async function rD(e,t){let s=await t(ib,e,ab(e));e.data=new Uint8Array(await s.arrayBuffer()),e.size||(e.size=e.data.length)}async function KC(e,t,s){if(e.preventHeadRequest)await s(e,e.options);else{let i=(await t(Ik,e,ab(e))).headers.get(Ak);i?e.size=Number(i):await s(e,e.options)}}async function sb(e,{options:t,url:s},r){let i=await fetch(s,Object.assign({},t,{method:e,headers:r}));if(i.status<400)return i;throw i.status==416?new Error(Rd):new Error(XC+(i.statusText||i.status))}function rb(e,{url:t},s){return new Promise((r,i)=>{let n=new XMLHttpRequest;if(n.addEventListener("load",()=>{if(n.status<400){let a=[];n.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(o=>{let c=o.trim().split(/\s*:\s*/);c[0]=c[0].trim().replace(/^[a-z]|-[a-z]/g,l=>l.toUpperCase()),a.push(c)}),r({status:n.status,arrayBuffer:()=>n.response,headers:new Map(a)})}else i(n.status==416?new Error(Rd):new Error(XC+(n.statusText||n.status)))},!1),n.addEventListener("error",a=>i(a.detail?a.detail.error:new Error("Network error")),!1),n.open(e,t),s)for(let a of Object.entries(s))n.setRequestHeader(a[0],a[1]);n.responseType="arraybuffer",n.send()})}var Nu=class extends pn{constructor(t,s={}){super(),Object.assign(this,{url:t,reader:s.useXHR?new tb(t,s):new eb(t,s)})}set size(t){}get size(){return this.reader.size}async init(){await this.reader.init(),super.init()}readUint8Array(t,s){return this.reader.readUint8Array(t,s)}};var Jc=class extends pn{constructor(t){super(),Object.assign(this,{array:t,size:t.length})}readUint8Array(t,s){return this.array.slice(t,t+s)}},Fn=class extends vd{init(t=0){Object.assign(this,{offset:0,array:new Uint8Array(t)}),super.init()}writeUint8Array(t){let s=this;if(s.offset+t.length>s.array.length){let r=s.array;s.array=new Uint8Array(r.length+t.length),s.array.set(r)}s.array.set(t,s.offset),s.offset+=t.length}getData(){return this.array}},xg=class extends pn{constructor(t){super(),this.readers=t}async init(){let t=this,{readers:s}=t;t.lastDiskNumber=0,t.lastDiskOffset=0,await Promise.all(s.map(async(r,i)=>{await r.init(),i!=s.length-1&&(t.lastDiskOffset+=r.size),t.size+=r.size})),super.init()}async readUint8Array(t,s,r=0){let i=this,{readers:n}=this,a,o=r;o==-1&&(o=n.length-1);let c=t;for(;c>=n[o].size;)c-=n[o].size,o++;let l=n[o],u=l.size;if(c+s<=u)a=await Qr(l,c,s);else{let h=u-c;a=new Uint8Array(s),a.set(await Qr(l,c,h)),a.set(await i.readUint8Array(t+h,s-h,r),h)}return i.lastDiskNumber=Math.max(o,i.lastDiskNumber),a}},Kc=class extends Ru{constructor(t,s=4294967295){super();let r=this;Object.assign(r,{diskNumber:0,diskOffset:0,size:0,maxSize:s,availableSize:s});let i,n,a,o=new WritableStream({async write(u){let{availableSize:h}=r;if(a)u.length>=h?(await c(u.slice(0,h)),await l(),r.diskOffset+=i.size,r.diskNumber++,a=null,await this.write(u.slice(h))):await c(u);else{let{value:p,done:d}=await t.next();if(d&&!p)throw new Error(ZC);i=p,i.size=0,i.maxSize&&(r.maxSize=i.maxSize),r.availableSize=r.maxSize,await ui(i),n=p.writable,a=n.getWriter(),await this.write(u)}},async close(){await a.ready,await l()}});Object.defineProperty(r,nb,{get(){return o}});async function c(u){let h=u.length;h&&(await a.ready,await a.write(u),i.size+=h,r.size+=h,r.availableSize-=h)}async function l(){n.size=i.size,await a.close()}}};function vk(e){let{baseURL:t}=Pu(),{protocol:s}=new URL(e,t);return s=="http:"||s=="https:"}async function ui(e,t){e.init&&!e.initialized&&await e.init(t)}function vg(e){return Array.isArray(e)&&(e=new xg(e)),e instanceof ReadableStream&&(e={readable:e}),e}function Rg(e){e.writable===Ks&&typeof e.next==gg&&(e=new Kc(e)),e instanceof WritableStream&&(e={writable:e});let{writable:t}=e;return t.size===Ks&&(t.size=0),e instanceof Kc||Object.assign(e,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),e}function Qr(e,t,s,r){return e.readUint8Array(t,s,r)}var iD="\0\u263A\u263B\u2665\u2666\u2663\u2660\u2022\u25D8\u25CB\u25D9\u2642\u2640\u266A\u266B\u263C\u25BA\u25C4\u2195\u203C\xB6\xA7\u25AC\u21A8\u2191\u2193\u2192\u2190\u221F\u2194\u25B2\u25BC !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\u2302\xC7\xFC\xE9\xE2\xE4\xE0\xE5\xE7\xEA\xEB\xE8\xEF\xEE\xEC\xC4\xC5\xC9\xE6\xC6\xF4\xF6\xF2\xFB\xF9\xFF\xD6\xDC\xA2\xA3\xA5\u20A7\u0192\xE1\xED\xF3\xFA\xF1\xD1\xAA\xBA\xBF\u2310\xAC\xBD\xBC\xA1\xAB\xBB\u2591\u2592\u2593\u2502\u2524\u2561\u2562\u2556\u2555\u2563\u2551\u2557\u255D\u255C\u255B\u2510\u2514\u2534\u252C\u251C\u2500\u253C\u255E\u255F\u255A\u2554\u2569\u2566\u2560\u2550\u256C\u2567\u2568\u2564\u2565\u2559\u2558\u2552\u2553\u256B\u256A\u2518\u250C\u2588\u2584\u258C\u2590\u2580\u03B1\xDF\u0393\u03C0\u03A3\u03C3\xB5\u03C4\u03A6\u0398\u03A9\u03B4\u221E\u03C6\u03B5\u2229\u2261\xB1\u2265\u2264\u2320\u2321\xF7\u2248\xB0\u2219\xB7\u221A\u207F\xB2\u25A0 ".split(""),Rk=iD.length==256;function nD(e){if(Rk){let t="";for(let s=0;s<e.length;s++)t+=iD[e[s]];return t}else return new TextDecoder().decode(e)}function Ng(e,t){return t&&t.trim().toLowerCase()=="cp437"?nD(e):new TextDecoder(t).decode(e)}var ob="filename",cb="rawFilename",lb="comment",ub="rawComment",hb="uncompressedSize",db="compressedSize",pb="offset",Lg="diskNumberStart",Nd="lastModDate",fb="rawLastModDate",Ld="lastAccessDate",aD="rawLastAccessDate",Bd="creationDate",oD="rawCreationDate",mb="internalFileAttribute",gb="externalFileAttribute",yb="msDosCompatible",Eb="zip64",Nk=[ob,cb,db,hb,Nd,fb,lb,ub,Ld,Bd,pb,Lg,Lg,mb,gb,yb,Eb,"directory","bitFlag","encrypted","signature","filenameUTF8","commentUTF8","compressionMethod","version","versionMadeBy","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"],ga=class{constructor(t){Nk.forEach(s=>this[s]=t[s])}};var Bg="File format is not recognized",hD="End of central directory not found",dD="End of Zip64 central directory not found",pD="End of Zip64 central directory locator not found",fD="Central directory header not found",mD="Local file header not found",gD="Zip64 extra field not found",yD="File contains encrypted entry",ED="Encryption method not supported",Tb="Compression method not supported",wb="Split zip file",cD="utf-8",lD="cp437",Mk=[[hb,4294967295],[db,4294967295],[pb,4294967295],[Lg,65535]],jk={65535:{getValue:dr,bytes:4},4294967295:{getValue:kg,bytes:8}},Zo=class{constructor(t,s={}){Object.assign(this,{reader:vg(t),options:s,config:Pu()})}async*getEntriesGenerator(t={}){let s=this,{reader:r}=s,{config:i}=s;if(await ui(r),(r.size===Ks||!r.readUint8Array)&&(r=new Mi(await new Response(r.readable).blob()),await ui(r)),r.size<22)throw new Error(Bg);r.chunkSize=yg(i);let n=await Yk(r,101010256,r.size,22,65535*16);if(!n){let D=await Qr(r,0,4),I=Mr(D);throw dr(I)==134695760?new Error(wb):new Error(hD)}let a=Mr(n),o=dr(a,12),c=dr(a,16),l=n.offset,u=kr(a,20),h=l+22+u,p=kr(a,4),d=r.lastDiskNumber||0,f=kr(a,6),m=kr(a,8),g=0,b=0;if(c==4294967295||o==4294967295||m==65535||f==65535){let D=await Qr(r,n.offset-20,20),I=Mr(D);if(dr(I,0)!=117853008)throw new Error(dD);c=kg(I,8);let P=await Qr(r,c,56,-1),L=Mr(P),F=n.offset-20-56;if(dr(L,0)!=101075792&&c!=F){let V=c;c=F,g=c-V,P=await Qr(r,c,56,-1),L=Mr(P)}if(dr(L,0)!=101075792)throw new Error(pD);p==65535&&(p=dr(L,16)),f==65535&&(f=dr(L,20)),m==65535&&(m=kg(L,32)),o==4294967295&&(o=kg(L,40)),c-=o}if(d!=p)throw new Error(wb);if(c<0||c>=r.size)throw new Error(Bg);let E=0,y=await Qr(r,c,o,f),T=Mr(y);if(o){let D=n.offset-o;if(dr(T,E)!=33639248&&c!=D){let I=c;c=D,g=c-I,y=await Qr(r,c,o,f),T=Mr(y)}}let w=n.offset-c-(r.lastDiskOffset||0);if(o!=w&&w&&(o=w,y=await Qr(r,c,o,f),T=Mr(y)),c<0||c>=r.size)throw new Error(Bg);let S=fn(s,t,"filenameEncoding"),_=fn(s,t,"commentEncoding");for(let D=0;D<m;D++){let I=new Sb(r,i,s.options);if(dr(T,E)!=33639248)throw new Error(fD);bD(I,T,E+6);let P=!!I.bitFlag.languageEncodingFlag,L=E+46,F=L+I.filenameLength,V=F+I.extraFieldLength,B=kr(T,E+4),k=(B&0)==0,O=y.subarray(L,F),R=kr(T,E+32),v=V+R,j=y.subarray(V,v),M=P,H=P,q=k&&(Lu(T,E+38)&16)==16,Q=dr(T,E+42)+g;Object.assign(I,{versionMadeBy:B,msDosCompatible:k,compressedSize:0,uncompressedSize:0,commentLength:R,directory:q,offset:Q,diskNumberStart:kr(T,E+34),internalFileAttribute:kr(T,E+36),externalFileAttribute:dr(T,E+38),rawFilename:O,filenameUTF8:M,commentUTF8:H,rawExtraField:y.subarray(F,V)});let[oe,me]=await Promise.all([Ng(O,M?cD:S||lD),Ng(j,H?cD:_||lD)]);Object.assign(I,{rawComment:j,filename:oe,comment:me,directory:q||oe.endsWith("/")}),b=Math.max(Q,b),await TD(I,I,T,E+6);let Ee=new ga(I);Ee.getData=(Oe,Fe)=>I.getData(Oe,Ee,Fe),E=v;let{onprogress:Pe}=t;if(Pe)try{await Pe(D+1,m,new ga(I))}catch{}yield Ee}let C=fn(s,t,"extractPrependedData"),x=fn(s,t,"extractAppendedData");return C&&(s.prependedData=b>0?await Qr(r,0,b):new Uint8Array),s.comment=u?await Qr(r,l+22,u):new Uint8Array,x&&(s.appendedData=h<r.size?await Qr(r,h,r.size-h):new Uint8Array),!0}async getEntries(t={}){let s=[];for await(let r of this.getEntriesGenerator(t))s.push(r);return s}async close(){}};var Sb=class{constructor(t,s,r){Object.assign(this,{reader:t,config:s,options:r})}async getData(t,s,r={}){let i=this,{reader:n,offset:a,diskNumberStart:o,extraFieldAES:c,compressionMethod:l,config:u,bitFlag:h,signature:p,rawLastModDate:d,uncompressedSize:f,compressedSize:m}=i,g=i.localDirectory={},b=await Qr(n,a,30,o),E=Mr(b),y=fn(i,r,"password");if(y=y&&y.length&&y,c&&c.originalCompressionMethod!=99)throw new Error(Tb);if(l!=0&&l!=8)throw new Error(Tb);if(dr(E,0)!=67324752)throw new Error(mD);bD(g,E,4),g.rawExtraField=g.extraFieldLength?await Qr(n,a+30+g.filenameLength,g.extraFieldLength,o):new Uint8Array,await TD(i,g,E,4),Object.assign(s,{lastAccessDate:g.lastAccessDate,creationDate:g.creationDate});let T=i.encrypted&&g.encrypted,w=T&&!c;if(T){if(!w&&c.strength===Ks)throw new Error(ED);if(!y)throw new Error(yD)}let S=a+30+g.filenameLength+g.extraFieldLength,_=m,C=n.readable;Object.assign(C,{diskNumberStart:o,offset:S,size:_});let x=fn(i,r,"signal"),D=fn(i,r,"checkPasswordOnly");D&&(t=new WritableStream),t=Rg(t),await ui(t,f);let{writable:I}=t,{onstart:P,onprogress:L,onend:F}=r,V={options:{codecType:Og,password:y,zipCrypto:w,encryptionStrength:c&&c.strength,signed:fn(i,r,"checkSignature"),passwordVerification:w&&(h.dataDescriptor?d>>>8&255:p>>>24&255),signature:p,compressed:l!=0,encrypted:T,useWebWorkers:fn(i,r,"useWebWorkers"),useCompressionStream:fn(i,r,"useCompressionStream"),transferStreams:fn(i,r,"transferStreams"),checkPasswordOnly:D},config:u,streamOptions:{signal:x,size:_,onstart:P,onprogress:L,onend:F}},B=0;try{({outputSize:B}=await Ig({readable:C,writable:I},V))}catch(k){if(!D||k.message!=eo)throw k}finally{let k=fn(i,r,"preventClose");I.size+=B,!k&&!I.locked&&await I.getWriter().close()}return D?void 0:t.getData?t.getData():I}};function bD(e,t,s){let r=e.rawBitFlag=kr(t,s+2),i=(r&1)==1,n=dr(t,s+6);Object.assign(e,{encrypted:i,version:kr(t,s),bitFlag:{level:(r&6)>>1,dataDescriptor:(r&8)==8,languageEncodingFlag:(r&2048)==2048},rawLastModDate:n,lastModDate:Vk(n),filenameLength:kr(t,s+22),extraFieldLength:kr(t,s+24)})}async function TD(e,t,s,r){let{rawExtraField:i}=t,n=t.extraField=new Map,a=Mr(new Uint8Array(i)),o=0;try{for(;o<i.length;){let m=kr(a,o),g=kr(a,o+2);n.set(m,{type:m,data:i.slice(o+4,o+4+g)}),o+=4+g}}catch{}let c=kr(s,r+4);Object.assign(t,{signature:dr(s,r+10),uncompressedSize:dr(s,r+18),compressedSize:dr(s,r+14)});let l=n.get(1);l&&(Fk(l,t),t.extraFieldZip64=l);let u=n.get(28789);u&&(await uD(u,ob,cb,t,e),t.extraFieldUnicodePath=u);let h=n.get(25461);h&&(await uD(h,lb,ub,t,e),t.extraFieldUnicodeComment=h);let p=n.get(39169);p?(Uk(p,t,c),t.extraFieldAES=p):t.compressionMethod=c;let d=n.get(10);d&&(Hk(d,t),t.extraFieldNTFS=d);let f=n.get(21589);f&&(Gk(f,t),t.extraFieldExtendedTimestamp=f)}function Fk(e,t){t.zip64=!0;let s=Mr(e.data),r=Mk.filter(([i,n])=>t[i]==n);for(let i=0,n=0;i<r.length;i++){let[a,o]=r[i];if(t[a]==o){let c=jk[o];t[a]=e[a]=c.getValue(s,n),n+=c.bytes}else if(e[a])throw new Error(gD)}}async function uD(e,t,s,r,i){let n=Mr(e.data),a=new Qa;a.append(i[s]);let o=Mr(new Uint8Array(4));o.setUint32(0,a.get(),!0);let c=dr(n,1);Object.assign(e,{version:Lu(n,0),[t]:Ng(e.data.subarray(5)),valid:!i.bitFlag.languageEncodingFlag&&c==dr(o,0)}),e.valid&&(r[t]=e[t],r[t+"UTF8"]=!0)}function Uk(e,t,s){let r=Mr(e.data),i=Lu(r,4);Object.assign(e,{vendorVersion:Lu(r,0),vendorId:Lu(r,2),strength:i,originalCompressionMethod:s,compressionMethod:kr(r,5)}),t.compressionMethod=e.compressionMethod}function Hk(e,t){let s=Mr(e.data),r=4,i;try{for(;r<e.data.length&&!i;){let n=kr(s,r),a=kr(s,r+2);n==1&&(i=e.data.slice(r+4,r+4+a)),r+=4+a}}catch{}try{if(i&&i.length==24){let n=Mr(i),a=n.getBigUint64(0,!0),o=n.getBigUint64(8,!0),c=n.getBigUint64(16,!0);Object.assign(e,{rawLastModDate:a,rawLastAccessDate:o,rawCreationDate:c});let l=bb(a),u=bb(o),h=bb(c),p={lastModDate:l,lastAccessDate:u,creationDate:h};Object.assign(e,p),Object.assign(t,p)}}catch{}}function Gk(e,t){let s=Mr(e.data),r=Lu(s,0),i=[],n=[];(r&1)==1&&(i.push(Nd),n.push(fb)),(r&2)==2&&(i.push(Ld),n.push(aD)),(r&4)==4&&(i.push(Bd),n.push(oD));let a=1;i.forEach((o,c)=>{if(e.data.length>=a+4){let l=dr(s,a);t[o]=e[o]=new Date(l*1e3);let u=n[c];e[u]=l}a+=4})}async function Yk(e,t,s,r,i){let n=new Uint8Array(4),a=Mr(n);zk(a,0,t);let o=r+i;return await c(r)||await c(Math.min(o,s));async function c(l){let u=s-l,h=await Qr(e,u,l);for(let p=h.length-r;p>=0;p--)if(h[p]==n[0]&&h[p+1]==n[1]&&h[p+2]==n[2]&&h[p+3]==n[3])return{offset:u+p,buffer:h.slice(p,p+r).buffer}}}function fn(e,t,s){return t[s]===Ks?e.options[s]:t[s]}function Vk(e){let t=(e&4294901760)>>16,s=e&65535;try{return new Date(1980+((t&65024)>>9),((t&480)>>5)-1,t&31,(s&63488)>>11,(s&2016)>>5,(s&31)*2,0)}catch{}}function bb(e){return new Date(Number(e/BigInt(1e4)-BigInt(116444736e5)))}function Lu(e,t){return e.getUint8(t)}function kr(e,t){return e.getUint16(t,!0)}function dr(e,t){return e.getUint32(t,!0)}function kg(e,t){return Number(e.getBigUint64(t,!0))}function zk(e,t,s){e.setUint32(t,s,!0)}function Mr(e){return new DataView(e.buffer)}var CD="File already exists",DD="Zip file comment exceeds 64KB",PD="File entry comment exceeds 64KB",OD="File entry name exceeds 64KB",Bb="Version exceeds 65535",ID="The strength must equal 1, 2, or 3",xD="Extra field type exceeds 65535",vD="Extra field data exceeds 64KB",Wg="Zip64 is not supported (make sure 'keepOrder' is set to 'true')",_D=new Uint8Array([7,0,2,0,65,69,3,0,0]),Nb=0,AD=[],$o=class{constructor(t,s={}){t=Rg(t),Object.assign(this,{writer:t,addSplitZipSignature:t instanceof Kc,options:s,config:Pu(),files:new Map,filenames:new Set,offset:t.writable.size,pendingEntriesSize:0,pendingAddFileCalls:new Set,bufferedWrites:0})}async add(t="",s,r={}){let i=this,{pendingAddFileCalls:n,config:a}=i;Nb<a.maxWorkers?Nb++:await new Promise(c=>AD.push(c));let o;try{if(t=t.trim(),i.filenames.has(t))throw new Error(CD);return i.filenames.add(t),o=Kk(i,t,s,r),n.add(o),await o}catch(c){throw i.filenames.delete(t),c}finally{n.delete(o);let c=AD.shift();c?c():Nb--}}async close(t=new Uint8Array,s={}){let r=this,{pendingAddFileCalls:i,writer:n}=this,{writable:a}=n;for(;i.size;)await Promise.all(Array.from(i));return await rM(this,t,s),Gs(r,s,"preventClose")||await a.getWriter().close(),n.getData?n.getData():a}};async function Kk(e,t,s,r){t=t.trim(),r.directory&&!t.endsWith("/")?t+="/":r.directory=t.endsWith("/");let i=Ad(t);if(ys(i)>65535)throw new Error(OD);let n=r.comment||"",a=Ad(n);if(ys(a)>65535)throw new Error(PD);let o=Gs(e,r,"version",20);if(o>65535)throw new Error(Bb);let c=Gs(e,r,"versionMadeBy",20);if(c>65535)throw new Error(Bb);let l=Gs(e,r,Nd,new Date),u=Gs(e,r,Ld),h=Gs(e,r,Bd),p=Gs(e,r,yb,!0),d=Gs(e,r,mb,0),f=Gs(e,r,gb,0),m=Gs(e,r,"password"),g=Gs(e,r,"encryptionStrength",3),b=Gs(e,r,"zipCrypto"),E=Gs(e,r,"extendedTimestamp",!0),y=Gs(e,r,"keepOrder",!0),T=Gs(e,r,"level"),w=Gs(e,r,"useWebWorkers"),S=Gs(e,r,"bufferedWrite"),_=Gs(e,r,"dataDescriptorSignature",!1),C=Gs(e,r,"signal"),x=Gs(e,r,"useCompressionStream"),D=Gs(e,r,"dataDescriptor",!0),I=Gs(e,r,Eb);if(m!==Ks&&g!==Ks&&(g<1||g>3))throw new Error(ID);let P=new Uint8Array,{extraField:L}=r;if(L){let Pe=0,Oe=0;L.forEach(Fe=>Pe+=4+ys(Fe)),P=new Uint8Array(Pe),L.forEach((Fe,G)=>{if(G>65535)throw new Error(xD);if(ys(Fe)>65535)throw new Error(vD);jr(P,new Uint16Array([G]),Oe),jr(P,new Uint16Array([ys(Fe)]),Oe+2),jr(P,Fe,Oe+4),Oe+=4+ys(Fe)})}let F=0,V=0,B=0,k=I===!0;s&&(s=vg(s),await ui(s),s.size===Ks?(D=!0,(I||I===Ks)&&(I=!0,F=4294967295)):(B=s.size,F=iM(B)));let{diskOffset:O,diskNumber:R,maxSize:v}=e.writer,j=k||B>=4294967295,M=k||F>=4294967295,H=k||e.offset+e.pendingEntriesSize-O>=4294967295,Q=Gs(e,r,"supportZip64SplitFile",!0)&&k||R+Math.ceil(e.pendingEntriesSize/v)>=65535;if(H||j||M||Q){if(I===!1||!y)throw new Error(Wg);I=!0}I=I||!1,r=Object.assign({},r,{rawFilename:i,rawComment:a,version:o,versionMadeBy:c,lastModDate:l,lastAccessDate:u,creationDate:h,rawExtraField:P,zip64:I,zip64UncompressedSize:j,zip64CompressedSize:M,zip64Offset:H,zip64DiskNumberStart:Q,password:m,level:T,useWebWorkers:w,encryptionStrength:g,extendedTimestamp:E,zipCrypto:b,bufferedWrite:S,keepOrder:y,dataDescriptor:D,dataDescriptorSignature:_,signal:C,msDosCompatible:p,internalFileAttribute:d,externalFileAttribute:f,useCompressionStream:x});let oe=$k(r),me=Qk(r);V=ys(oe.localHeaderArray,me.dataDescriptorArray)+F,e.pendingEntriesSize+=V;let Ee;try{Ee=await Xk(e,t,s,{headerInfo:oe,dataDescriptorInfo:me},r)}finally{e.pendingEntriesSize-=V}return Object.assign(Ee,{name:t,comment:n,extraField:L}),new ga(Ee)}async function Xk(e,t,s,r,i){let{files:n,writer:a}=e,{keepOrder:o,dataDescriptor:c,signal:l}=i,{headerInfo:u}=r,h=Array.from(n.values()).pop(),p={},d,f,m,g,b,E;n.set(t,p);try{let S;o&&(S=h&&h.lock,y()),i.bufferedWrite||e.writerLocked||e.bufferedWrites&&o||!c?(E=new Di,E.writable.size=0,d=!0,e.bufferedWrites++,await ui(a)):(E=a,await T()),await ui(E);let{writable:_}=a,{diskOffset:C}=a;if(e.addSplitZipSignature){delete e.addSplitZipSignature;let D=new Uint8Array(4),I=Fi(D);Xt(I,0,134695760),await ya(_,D),e.offset+=4}d||(await S,await w(_));let{diskNumber:x}=a;if(b=!0,p.diskNumberStart=x,p=await Zk(s,E,p,r,e.config,i),b=!1,n.set(t,p),p.filename=t,d){await E.writable.getWriter().close();let D=await E.getData();await S,await T(),g=!0,c||(D=await tM(p,D,_,i)),await w(_),p.diskNumberStart=a.diskNumber,C=a.diskOffset,await D.stream().pipeTo(_,{preventClose:!0,preventAbort:!0,signal:l}),_.size+=D.size,g=!1}if(p.offset=e.offset-C,p.zip64)sM(p,i);else if(p.offset>=4294967295)throw new Error(Wg);return e.offset+=p.length,p}catch(S){if(d&&g||!d&&b){if(e.hasCorruptedEntries=!0,S)try{S.corruptedEntry=!0}catch{}d?e.offset+=E.writable.size:e.offset=E.writable.size}throw n.delete(t),S}finally{d&&e.bufferedWrites--,m&&m(),f&&f()}function y(){p.lock=new Promise(S=>m=S)}async function T(){e.writerLocked=!0;let{lockWriter:S}=e;e.lockWriter=new Promise(_=>f=()=>{e.writerLocked=!1,_()}),await S}async function w(S){u.localHeaderArray.length>a.availableSize&&(a.availableSize=0,await ya(S,new Uint8Array))}}async function Zk(e,t,{diskNumberStart:s,lock:r},i,n,a){let{headerInfo:o,dataDescriptorInfo:c}=i,{localHeaderArray:l,headerArray:u,lastModDate:h,rawLastModDate:p,encrypted:d,compressed:f,version:m,compressionMethod:g,rawExtraFieldExtendedTimestamp:b,rawExtraFieldNTFS:E,rawExtraFieldAES:y}=o,{dataDescriptorArray:T}=c,{rawFilename:w,lastAccessDate:S,creationDate:_,password:C,level:x,zip64:D,zip64UncompressedSize:I,zip64CompressedSize:P,zip64Offset:L,zip64DiskNumberStart:F,zipCrypto:V,dataDescriptor:B,directory:k,versionMadeBy:O,rawComment:R,rawExtraField:v,useWebWorkers:j,onstart:M,onprogress:H,onend:q,signal:Q,encryptionStrength:oe,extendedTimestamp:me,msDosCompatible:Ee,internalFileAttribute:Pe,externalFileAttribute:Oe,useCompressionStream:Fe}=a,G={lock:r,versionMadeBy:O,zip64:D,directory:!!k,filenameUTF8:!0,rawFilename:w,commentUTF8:!0,rawComment:R,rawExtraFieldExtendedTimestamp:b,rawExtraFieldNTFS:E,rawExtraFieldAES:y,rawExtraField:v,extendedTimestamp:me,msDosCompatible:Ee,internalFileAttribute:Pe,externalFileAttribute:Oe,diskNumberStart:s},pe=0,ge=0,ie,{writable:$}=t;if(e){e.chunkSize=yg(n),await ya($,l);let ye=e.readable,Be=ye.size=e.size,be={options:{codecType:Pg,level:x,password:C,encryptionStrength:oe,zipCrypto:d&&V,passwordVerification:d&&V&&p>>8&255,signed:!0,compressed:f,encrypted:d,useWebWorkers:j,useCompressionStream:Fe,transferStreams:!1},config:n,streamOptions:{signal:Q,size:Be,onstart:M,onprogress:H,onend:q}},xe=await Ig({readable:ye,writable:$},be);$.size+=xe.size,ie=xe.signature,ge=e.size=ye.size,pe=xe.size}else await ya($,l);let ae;if(D){let ye=4;I&&(ye+=8),P&&(ye+=8),L&&(ye+=8),F&&(ye+=4),ae=new Uint8Array(ye)}else ae=new Uint8Array;return eM({signature:ie,rawExtraFieldZip64:ae,compressedSize:pe,uncompressedSize:ge,headerInfo:o,dataDescriptorInfo:c},a),B&&await ya($,T),Object.assign(G,{uncompressedSize:ge,compressedSize:pe,lastModDate:h,rawLastModDate:p,creationDate:_,lastAccessDate:S,encrypted:d,length:ys(l,T)+pe,compressionMethod:g,version:m,headerArray:u,signature:ie,rawExtraFieldZip64:ae,zip64UncompressedSize:I,zip64CompressedSize:P,zip64Offset:L,zip64DiskNumberStart:F}),G}function $k(e){let{rawFilename:t,lastModDate:s,lastAccessDate:r,creationDate:i,password:n,level:a,zip64:o,zipCrypto:c,dataDescriptor:l,directory:u,rawExtraField:h,encryptionStrength:p,extendedTimestamp:d}=e,f=a!==0&&!u,m=!!(n&&ys(n)),g=e.version,b;if(m&&!c){b=new Uint8Array(ys(_D)+2);let V=Fi(b);Cs(V,0,39169),jr(b,_D,2),zg(V,8,p)}else b=new Uint8Array;let E,y;if(d){y=new Uint8Array(9+(r?4:0)+(i?4:0));let V=Fi(y);Cs(V,0,21589),Cs(V,2,ys(y)-4);let B=1+(r?2:0)+(i?4:0);zg(V,4,B),Xt(V,5,Math.floor(s.getTime()/1e3)),r&&Xt(V,9,Math.floor(r.getTime()/1e3)),i&&Xt(V,13,Math.floor(i.getTime()/1e3));try{E=new Uint8Array(36);let k=Fi(E),O=Lb(s);Cs(k,0,10),Cs(k,2,32),Cs(k,8,1),Cs(k,10,24),ji(k,12,O),ji(k,20,Lb(r)||O),ji(k,28,Lb(i)||O)}catch{E=new Uint8Array}}else E=y=new Uint8Array;let T=2048;l&&(T=T|8);let w=0;f&&(w=8),o&&(g=g>45?g:45),m&&(T=T|1,c||(g=g>51?g:51,w=99,f&&(b[9]=8)));let S=new Uint8Array(26),_=Fi(S);Cs(_,0,g),Cs(_,2,T),Cs(_,4,w);let C=new Uint32Array(1),x=Fi(C),D;s<YE?D=YE:s>GE?D=GE:D=s,Cs(x,0,(D.getHours()<<6|D.getMinutes())<<5|D.getSeconds()/2),Cs(x,2,(D.getFullYear()-1980<<4|D.getMonth()+1)<<5|D.getDate());let I=C[0];Xt(_,6,I),Cs(_,22,ys(t));let P=ys(b,y,E,h);Cs(_,24,P);let L=new Uint8Array(30+ys(t)+P),F=Fi(L);return Xt(F,0,67324752),jr(L,S,4),jr(L,t,30),jr(L,b,30+ys(t)),jr(L,y,30+ys(t,b)),jr(L,E,30+ys(t,b,y)),jr(L,h,30+ys(t,b,y,E)),{localHeaderArray:L,headerArray:S,headerView:_,lastModDate:s,rawLastModDate:I,encrypted:m,compressed:f,version:g,compressionMethod:w,rawExtraFieldExtendedTimestamp:y,rawExtraFieldNTFS:E,rawExtraFieldAES:b}}function Qk(e){let{zip64:t,dataDescriptor:s,dataDescriptorSignature:r}=e,i=new Uint8Array,n,a=0;return s&&(i=new Uint8Array(t?r?24:20:r?16:12),n=Fi(i),r&&(a=4,Xt(n,0,134695760))),{dataDescriptorArray:i,dataDescriptorView:n,dataDescriptorOffset:a}}function eM(e,t){let{signature:s,rawExtraFieldZip64:r,compressedSize:i,uncompressedSize:n,headerInfo:a,dataDescriptorInfo:o}=e,{headerView:c,encrypted:l}=a,{dataDescriptorView:u,dataDescriptorOffset:h}=o,{zip64:p,zip64UncompressedSize:d,zip64CompressedSize:f,zipCrypto:m,dataDescriptor:g}=t;if((!l||m)&&s!==Ks&&(Xt(c,10,s),g&&Xt(u,h,s)),p){let b=Fi(r);Cs(b,0,1),Cs(b,2,r.length-4);let E=4;d&&(Xt(c,18,4294967295),ji(b,E,BigInt(n)),E+=8),f&&(Xt(c,14,4294967295),ji(b,E,BigInt(i))),g&&(ji(u,h+4,BigInt(i)),ji(u,h+12,BigInt(n)))}else Xt(c,14,i),Xt(c,18,n),g&&(Xt(u,h+4,i),Xt(u,h+8,n))}async function tM(e,t,s,{zipCrypto:r}){let i;i=await t.slice(0,26).arrayBuffer(),i.byteLength!=26&&(i=i.slice(0,26));let n=new DataView(i);return(!e.encrypted||r)&&Xt(n,14,e.signature),e.zip64?(Xt(n,18,4294967295),Xt(n,22,4294967295)):(Xt(n,18,e.compressedSize),Xt(n,22,e.uncompressedSize)),await ya(s,new Uint8Array(i)),t.slice(i.byteLength)}function sM(e,t){let{rawExtraFieldZip64:s,offset:r,diskNumberStart:i}=e,{zip64UncompressedSize:n,zip64CompressedSize:a,zip64Offset:o,zip64DiskNumberStart:c}=t,l=Fi(s),u=4;n&&(u+=8),a&&(u+=8),o&&(ji(l,u,BigInt(r)),u+=8),c&&Xt(l,u,i)}async function rM(e,t,s){let{files:r,writer:i}=e,{diskOffset:n,writable:a}=i,{diskNumber:o}=i,c=0,l=0,u=e.offset-n,h=r.size;for(let[,{rawFilename:w,rawExtraFieldZip64:S,rawExtraFieldAES:_,rawExtraField:C,rawComment:x,rawExtraFieldExtendedTimestamp:D,rawExtraFieldNTFS:I}]of r)l+=46+ys(w,x,S,_,D,I,C);let p=new Uint8Array(l),d=Fi(p);await ui(i);let f=0;for(let[w,S]of Array.from(r.values()).entries()){let{offset:_,rawFilename:C,rawExtraFieldZip64:x,rawExtraFieldAES:D,rawExtraFieldNTFS:I,rawExtraField:P,rawComment:L,versionMadeBy:F,headerArray:V,directory:B,zip64:k,zip64UncompressedSize:O,zip64CompressedSize:R,zip64DiskNumberStart:v,zip64Offset:j,msDosCompatible:M,internalFileAttribute:H,externalFileAttribute:q,extendedTimestamp:Q,lastModDate:oe,diskNumberStart:me,uncompressedSize:Ee,compressedSize:Pe}=S,Oe;if(Q){Oe=new Uint8Array(9);let ge=Fi(Oe);Cs(ge,0,21589),Cs(ge,2,ys(Oe)-4),zg(ge,4,1),Xt(ge,5,Math.floor(oe.getTime()/1e3))}else Oe=new Uint8Array;let Fe=ys(x,D,Oe,I,P);Xt(d,c,33639248),Cs(d,c+4,F);let G=Fi(V);O||Xt(G,18,Ee),R||Xt(G,14,Pe),jr(p,V,c+6),Cs(d,c+30,Fe),Cs(d,c+32,ys(L)),Cs(d,c+34,k&&v?65535:me),Cs(d,c+36,H),q?Xt(d,c+38,q):B&&M&&zg(d,c+38,16),Xt(d,c+42,k&&j?4294967295:_),jr(p,C,c+46),jr(p,x,c+46+ys(C)),jr(p,D,c+46+ys(C,x)),jr(p,Oe,c+46+ys(C,x,D)),jr(p,I,c+46+ys(C,x,D,Oe)),jr(p,P,c+46+ys(C,x,D,Oe,I)),jr(p,L,c+46+ys(C)+Fe);let pe=46+ys(C,L)+Fe;if(c-f>i.availableSize&&(i.availableSize=0,await ya(a,p.slice(f,c)),f=c),c+=pe,s.onprogress)try{await s.onprogress(w+1,r.size,new ga(S))}catch{}}await ya(a,f?p.slice(f):p);let m=i.diskNumber,{availableSize:g}=i;g<22&&m++;let b=Gs(e,s,"zip64");if(u>=4294967295||l>=4294967295||h>=65535||m>=65535){if(b===!1)throw new Error(Wg);b=!0}let E=new Uint8Array(b?98:22),y=Fi(E);c=0,b&&(Xt(y,0,101075792),ji(y,4,BigInt(44)),Cs(y,12,45),Cs(y,14,45),Xt(y,16,m),Xt(y,20,o),ji(y,24,BigInt(h)),ji(y,32,BigInt(h)),ji(y,40,BigInt(l)),ji(y,48,BigInt(u)),Xt(y,56,117853008),ji(y,64,BigInt(u)+BigInt(l)),Xt(y,72,m+1),Gs(e,s,"supportZip64SplitFile",!0)&&(m=65535,o=65535),h=65535,u=4294967295,l=4294967295,c+=76),Xt(y,c,101010256),Cs(y,c+4,m),Cs(y,c+6,o),Cs(y,c+8,h),Cs(y,c+10,h),Xt(y,c+12,l),Xt(y,c+16,u);let T=ys(t);if(T)if(T<=65535)Cs(y,c+20,T);else throw new Error(DD);await ya(a,E),T&&await ya(a,t)}async function ya(e,t){let s=e.getWriter();await s.ready,e.size+=ys(t),await s.write(t),s.releaseLock()}function Lb(e){if(e)return(BigInt(e.getTime())+BigInt(116444736e5))*BigInt(1e4)}function Gs(e,t,s,r){let i=t[s]===Ks?e.options[s]:t[s];return i===Ks?r:i}function iM(e){return e+5*(Math.floor(e/16383)+1)}function zg(e,t,s){e.setUint8(t,s)}function Cs(e,t,s){e.setUint16(t,s,!0)}function Xt(e,t,s){e.setUint32(t,s,!0)}function ji(e,t,s){e.setBigUint64(t,s,!0)}function jr(e,t,s){e.set(t,s)}function Fi(e){return new DataView(e.buffer)}function ys(...e){let t=0;return e.forEach(s=>s&&(t+=s.length)),t}var qg=class{constructor(t,s,r,i){let n=this;if(t.root&&i&&i.getChildByName(s))throw new Error("Entry filename already exists");r||(r={}),Object.assign(n,{fs:t,name:s,data:r.data,options:r.options,id:t.entries.length,parent:i,children:[],uncompressedSize:r.uncompressedSize||0}),t.entries.push(n),i&&n.parent.children.push(n)}moveTo(t){let s=this;s.fs.move(s,t)}getFullname(){return this.getRelativeName()}getRelativeName(t=this.fs.root){let s=this,r=s.name,i=s.parent;for(;i&&i!=t;)r=(i.name?i.name+"/":"")+r,i=i.parent;return r}isDescendantOf(t){let s=this.parent;for(;s&&s.id!=t.id;)s=s.parent;return!!s}rename(t){let s=this.parent;if(s&&s.getChildByName(t))throw new Error("Entry filename already exists");this.name=t}},Jg=class e extends qg{constructor(t,s,r,i){super(t,s,r,i);let n=this;n.Reader=r.Reader,n.Writer=r.Writer,r.getData&&(n.getData=r.getData)}clone(){return new e(this.fs,this.name,this)}async getData(t,s={}){let r=this;if(!t||t.constructor==r.Writer&&r.data)return r.data;{let i=r.reader=new r.Reader(r.data,s),n=r.data?r.data.uncompressedSize:i.size;await Promise.all([ui(i),ui(t,n)]);let a=i.readable;return a.size=r.uncompressedSize=i.size,await a.pipeTo(t.writable),t.getData?t.getData():t.writable}}isPasswordProtected(){return this.data.encrypted}async checkPassword(t,s={}){let r=this;if(r.isPasswordProtected()){s.password=t,s.checkPasswordOnly=!0;try{return await r.data.getData(null,s),!0}catch(i){if(i.message==jn)return!1;throw i}}else return!0}getText(t,s){return this.getData(new so(t),s)}getBlob(t,s){return this.getData(new Di(t),s)}getData64URI(t,s){return this.getData(new Xo(t),s)}getUint8Array(t){return this.getData(new Fn,t)}getWritable(t=new WritableStream,s){return this.getData({writable:t},s)}replaceBlob(t){Object.assign(this,{data:t,Reader:Mi,Writer:Di,reader:null})}replaceText(t){Object.assign(this,{data:t,Reader:to,Writer:so,reader:null})}replaceData64URI(t){Object.assign(this,{data:t,Reader:qc,Writer:Xo,reader:null})}replaceUint8Array(t){Object.assign(this,{data:t,Reader:Jc,Writer:Fn,reader:null})}replaceReadable(t){Object.assign(this,{data:null,Reader:function(){return{readable:t}},Writer:null,reader:null})}},Fd=class e extends qg{constructor(t,s,r,i){super(t,s,r,i),this.directory=!0}clone(t){let s=this,r=new e(s.fs,s.name);return t&&(r.children=s.children.map(i=>{let n=i.clone(t);return n.parent=r,n})),r}addDirectory(t,s){return Ea(this,t,{options:s},!0)}addText(t,s,r={}){return Ea(this,t,{data:s,Reader:to,Writer:so,options:r,uncompressedSize:s.length})}addBlob(t,s,r={}){return Ea(this,t,{data:s,Reader:Mi,Writer:Di,options:r,uncompressedSize:s.size})}addData64URI(t,s,r={}){let i=s.length;for(;s.charAt(i-1)=="=";)i--;let n=s.indexOf(",")+1;return Ea(this,t,{data:s,Reader:qc,Writer:Xo,options:r,uncompressedSize:Math.floor((i-n)*.75)})}addUint8Array(t,s,r={}){return Ea(this,t,{data:s,Reader:Jc,Writer:Fn,options:r,uncompressedSize:s.length})}addHttpContent(t,s,r={}){return Ea(this,t,{data:s,Reader:class extends Nu{constructor(i){super(i,r)}},options:r})}addReadable(t,s,r={}){return Ea(this,t,{Reader:function(){return{readable:s}},options:r})}addFileSystemEntry(t,s={}){return ND(this,t,s)}addFileSystemHandle(t,s={}){return ND(this,t,s)}addFile(t,s={}){return s.lastModDate||(s.lastModDate=new Date(t.lastModified)),Ea(this,t.name,{data:t,Reader:function(){let r=t.stream(),i=t.size;return{readable:r,size:i}},options:s,uncompressedSize:t.size})}addData(t,s){return Ea(this,t,s)}importBlob(t,s){return this.importZip(new Mi(t),s)}importData64URI(t,s){return this.importZip(new qc(t),s)}importUint8Array(t,s){return this.importZip(new Jc(t),s)}importHttpContent(t,s){return this.importZip(new Nu(t,s),s)}importReadable(t,s){return this.importZip({readable:t},s)}exportBlob(t={}){return this.exportZip(new Di(t.mimeType||"application/zip"),t)}exportData64URI(t={}){return this.exportZip(new Xo(t.mimeType||"application/zip"),t)}exportUint8Array(t={}){return this.exportZip(new Fn,t)}async exportWritable(t=new WritableStream,s={}){return await this.exportZip({writable:t},s),t}async importZip(t,s={}){await ui(t);let r=new Zo(t,s),i=[],n=await r.getEntries();for(let a of n){let o=this;try{let c=a.filename.split("/"),l=c.pop();c.forEach((u,h)=>{let p=o;o=o.getChildByName(u),o||(o=new e(this.fs,u,{data:h==c.length-1?a:null},p),i.push(o))}),a.directory||i.push(Ea(o,l,{data:a,Reader:aM(Object.assign({},s)),uncompressedSize:a.uncompressedSize}))}catch(c){try{c.cause={entry:a}}catch{}throw c}}return i}async exportZip(t,s){let r=this;await Promise.all([LD(r,s.readerOptions),ui(t)]);let i=new $o(t,s);return await oM(i,r,nM([r],"uncompressedSize"),s),await i.close(),t.getData?t.getData():t.writable}getChildByName(t){let s=this.children;for(let r=0;r<s.length;r++){let i=s[r];if(i.name==t)return i}}isPasswordProtected(){let t=this.children;for(let s=0;s<t.length;s++)if(t[s].isPasswordProtected())return!0;return!1}async checkPassword(t,s={}){let r=this.children;return!(await Promise.all(r.map(n=>n.checkPassword(t,s)))).includes(!1)}},kb=class{constructor(){Bu(this)}get children(){return this.root.children}remove(t){RD(t),this.entries[t.id]=null}move(t,s){if(t==this.root)throw new Error("Root directory cannot be moved");if(s.directory){if(s.isDescendantOf(t))throw new Error("Entry is a ancestor of target entry");if(t!=s){if(s.getChildByName(t.name))throw new Error("Entry filename already exists");RD(t),t.parent=s,s.children.push(t)}}else throw new Error("Target entry is not a directory")}find(t){let s=t.split("/"),r=this.root;for(let i=0;r&&i<s.length;i++)r=r.getChildByName(s[i]);return r}getById(t){return this.entries[t]}getChildByName(t){return this.root.getChildByName(t)}addDirectory(t,s){return this.root.addDirectory(t,s)}addText(t,s,r){return this.root.addText(t,s,r)}addBlob(t,s,r){return this.root.addBlob(t,s,r)}addData64URI(t,s,r){return this.root.addData64URI(t,s,r)}addHttpContent(t,s,r){return this.root.addHttpContent(t,s,r)}addReadable(t,s,r){return this.root.addReadable(t,s,r)}addFileSystemEntry(t,s){return this.root.addFileSystemEntry(t,s)}addFileSystemHandle(t,s){return this.root.addFileSystemHandle(t,s)}addFile(t,s){return this.root.addFile(t,s)}addData(t,s){return this.root.addData(t,s)}importBlob(t,s){return Bu(this),this.root.importBlob(t,s)}importData64URI(t,s){return Bu(this),this.root.importData64URI(t,s)}importUint8Array(t,s){return Bu(this),this.root.importUint8Array(t,s)}importHttpContent(t,s){return Bu(this),this.root.importHttpContent(t,s)}importReadable(t,s){return Bu(this),this.root.importReadable(t,s)}importZip(t,s){return this.root.importZip(t,s)}exportBlob(t){return this.root.exportBlob(t)}exportData64URI(t){return this.root.exportData64URI(t)}exportUint8Array(t){return this.root.exportUint8Array(t)}exportWritable(t,s){return this.root.exportWritable(t,s)}isPasswordProtected(){return this.root.isPasswordProtected()}async checkPassword(t,s){return this.root.checkPassword(t,s)}},Kg={FS:kb,ZipDirectoryEntry:Fd,ZipFileEntry:Jg};function nM(e,t){let s=0;return e.forEach(r),s;function r(i){s+=i[t],i.children&&i.children.forEach(r)}}function aM(e){return class extends pn{constructor(t,s={}){super(),this.entry=t,this.options=s}async init(){let t=this;t.size=t.entry.uncompressedSize;let s=await t.entry.getData(new Di,Object.assign({},t.options,e));t.data=s,t.blobReader=new Mi(s),super.init()}readUint8Array(t,s){return this.blobReader.readUint8Array(t,s)}}}async function LD(e,t){e.children.length&&await Promise.all(e.children.map(async s=>{if(s.directory)await LD(s,t);else{let r=s.reader=new s.Reader(s.data,t);try{await ui(r)}catch(i){try{i.entryId=s.id,i.cause={entry:s}}catch{}throw i}s.uncompressedSize=r.size}}))}function RD(e){if(e.parent){let t=e.parent.children;t.forEach((s,r)=>{s.id==e.id&&t.splice(r,1)})}}async function oM(e,t,s,r){let i=t,n=new Map;await a(e,t);async function a(o,c){await l();async function l(){if(r.bufferedWrite)await Promise.allSettled(c.children.map(u));else for(let h of c.children)await u(h)}async function u(h){let p=r.relativePath?h.getRelativeName(i):h.getFullname(),d,f,m,g,b=h.options||{};h.data instanceof ga&&({externalFileAttribute:d,versionMadeBy:f,comment:m,lastModDate:g}=h.data),await o.add(p,h.reader,Object.assign({directory:h.directory},Object.assign({},r,{externalFileAttribute:d,versionMadeBy:f,comment:m,lastModDate:g,onprogress:async E=>{if(r.onprogress){n.set(p,E);try{await r.onprogress(Array.from(n.values()).reduce((y,T)=>y+T),s)}catch{}}}},b))),await a(o,h)}}}async function ND(e,t,s){return r(e,t,[]);async function r(i,n,a){try{if((n.isFile||n.isDirectory)&&(n=await BD(n)),n.kind=="file"){let o=await n.getFile();a.push(i.addData(o.name,{Reader:function(){let c=o.stream(),l=o.size;return{readable:c,size:l}},options:Object.assign({},{lastModDate:new Date(o.lastModified)},s),uncompressedSize:o.size}))}else if(n.kind=="directory"){let o=i.addDirectory(n.name);a.push(o);for await(let c of n.values())await r(o,c,a)}}catch(o){let c=o.message+(n?" ("+n.name+")":"");throw new Error(c)}return a}}async function BD(e){let t={name:e.name};if(e.isFile&&(t.kind="file",t.getFile=()=>new Promise((s,r)=>e.file(s,r))),e.isDirectory){t.kind="directory";let s=await cM(e);t.values=()=>s}return t}async function cM(e){let t=[];function s(r,i,n){r.readEntries(async a=>{if(!a.length)i(t);else{for(let o of a)t.push(await BD(o));s(r,i,n)}},n)}return await new Promise((r,i)=>s(e.createReader(),r,i)),{[Symbol.iterator](){let r=0;return{next(){let i={value:t[r],done:r===t.length};return r++,i}}}}}function Bu(e){e.entries=[],e.root=new Fd(e)}function Ea(e,t,s,r){if(e.directory)return r?new Fd(e.fs,t,s,e):new Jg(e.fs,t,s,e);throw new Error("Parent entry is not a directory")}var hM={},kD;try{kD=hM.url}catch{}Ou({baseURL:kD});WC(Ou);Ou({Deflate:WA,Inflate:fC});var iH=Ei(VD());var zD="http://www.w3.org/2000/svg",WD="http://www.w3.org/1999/xlink",rK=(function(){var e={svg:zD,xlink:WD};return e[zD]="svg",e[WD]="xlink",e})();var iK=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),Ne={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,OFF_PAGE_CONNECTOR:25,PANEL:26,DIFF_PAIRS_FLAG:31};var Fb={},nK=(function(){let e={},t,s,r=0;for(let i in Fb)if(Object.hasOwnProperty.call(Fb,i))for(t=Fb[i],r=0;r<t.length;r++)s=t[r],Object.hasOwnProperty.call(e,s)||(e[s]=[]),e[s].push(i);return e})(),aK=(function(){var e={};for(let t in Ne)e[Ne[t]]=t;return e})();var Rs="|",Ud="_$",qD="~",Ub="R",JD="_";function KD(e){return navigator.userAgent.indexOf(e)}var cK=KD("Firefox/")>0,lK=KD("Electron/")>0;function Zc(e){if(typeof e!="object"||e===null||e instanceof Date||e instanceof ArrayBuffer||e instanceof Blob||e instanceof FormData)return e;if(Array.isArray(e))return e.map(Zc);{let t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=Zc(e[s]));return t}}function XD(e,t){typeof e=="string"?e=new Blob([e],{type:"text/plain"}):Array.isArray(e)&&(e=new Blob(e,{type:"text/plain"}));let s=document.createElement("a"),r=URL.createObjectURL(e);s.download=t,s.href=r,s.click(),URL.revokeObjectURL(r)}function mn(e){return Reflect.ownKeys(e).length===0}var Qo=class{constructor(){this.map=new Map;this._items=new Array;this.addList=new Set;this.delList=new Set}get items(){return this._items}set items(t){this._items=t}add(t,s){return this.map.set(t,s),this.addList.add(t),this.delList.delete(t),s}del(t){this.map.delete(t),this.delList.add(t),this.addList.delete(t)}get(t){return this.map.get(t)}getAll(){let t=new Array(this.map.size),s=this.map.values(),r=0;for(let i of s)t[r]=i,r++;return t}iterator(t){this.map.forEach((s,r)=>{t(s,r)})}clear(){this.items.length=0,this.map.clear(),this.addList.clear(),this.delList.clear()}count(){return this.map.size}};var $c=class $c extends Qo{static getInstance(){return $c.tool==null&&($c.tool=new $c),$c.tool}constructor(){super()}};$c.tool=null;var ro=$c;var dI=Ei(Vi());var K={public:{createSnapshot:"/mgr/projectWorker/createSnapshot",openProject:"/mgr/projectWorker/openProject",openProjectByString:"/mgr/projectWorker/openProjectByString",closeProject:"/mgr/projectWorker/closeProject",getProjectDetail:"/mgr/projectWorker/getProjectDetail",setProjectDetail:"/mgr/projectWorker/setProjectDetail",getSnapShot:"/mgr/projectWorker/getSnapShot",countDoc:"/mgr/projectWorker/countDoc",getClient:"/mgr/projectWorker/getClient",getBranchData:"/mgr/projectWorker/getBranchData",indexs:"/mgr/projectWorker/indexs",histories:"/mgr/projectWorker/histories",compress:"/mgr/projectWorker/compress",flowWrite:"/mgr/projectWorker/flowWrite",getHistoricalNodes:"/mgr/projectWorker/getHistoricalNodes",getHistoryUpdatetime:"/mgr/projectWorker/getHistoryUpdatetime",getHistoricalProject:"/mgr/projectWorker/getHistoricalProject",savePendData:"/mgr/projectWorker/savePendData",getDataByType:"/mgr/projectWorker/getDataByType",revokePendData:"/mgr/projectWorker/revokePendData",startBatchUpload:"/mgr/startBatchUpload",endBatchUpload:"/mgr/endBatchUpload",getMaxTicket:"/mgr/projectWorker/getMaxTicket",uploadLocal:"/mgr/projectWorker/uploadInlocal",parseData:"/mgr/projectWorker/parseData",import:"/mgr/projectWorker/import",related:"/mgr/projectWorker/related",awaitUploadEnd:"/mgr/projectWorker/awaitUploadEnd"},config:{get:"/mgr/projectWorker/config/get",update:"/mgr/projectWorker/config/update",getStr:"/mgr/projectWorker/config/getStr",getSetting:"/mgr/projectWorker/config/getSetting",setSetting:"/mgr/projectWorker/config/setSetting"},board:{get:"/mgr/projectWorker/board/get",getByTitle:"/mgr/projectWorker/board/getByTitle",isRename:"/mgr/projectWorker/board/isRename",tryRename:"/mgr/projectWorker/board/tryRename",getIdByTitle:"/mgr/projectWorker/board/getIdByTitle",add:"/mgr/projectWorker/board/add",update:"/mgr/projectWorker/board/update",delete:"/mgr/projectWorker/board/delete",batchDelete:"/mgr/projectWorker/board/batchDelete",getAllKVData:"/mgr/projectWorker/board/getAllKVData",getAllArrData:"/mgr/projectWorker/board/getAllArrData",getStr:"/mgr/projectWorker/board/getStr",getKeys:"/mgr/projectWorker/board/getKeys",getBindKeys:"/mgr/projectWorker/board/getBindKeys",buildString:"/mgr/projectWorker/board/buildString"},blob:{get:"/mgr/projectWorker/blob/get",add:"/mgr/projectWorker/blob/add",getList:"/mgr/projectWorker/blob/getList",batchUpload:"/mgr/projectWorker/blob/batchUpload",delete:"/mgr/projectWorker/blob/delete",batchDelete:"/mgr/projectWorker/blob/batchDelete",getAllArrData:"/mgr/projectWorker/blob/getAllArrData",getBlob:"/mgr/projectWorker/blob/getBlob",getStr:"/mgr/projectWorker/blob/getStr",getKeys:"/mgr/projectWorker/blob/getKeys",buildString:"/mgr/projectWorker/blob/buildString"},font:{get:"/mgr/projectWorker/font/get",delete:"/mgr/projectWorker/font/delete",buildString:"/mgr/projectWorker/font/buildString",getStr:"/mgr/projectWorker/font/getStr"},device:{get:"/mgr/projectWorker/device/get",getData:"/mgr/projectWorker/device/getData",getByCompiler:"/mgr/projectWorker/device/getByCompiler",getByTitle:"/mgr/projectWorker/device/getByTitle",isChange:"/mgr/projectWorker/device/isChange",isRename:"/mgr/projectWorker/device/isRename",tryRename:"/mgr/projectWorker/device/tryRename",isExist:"/mgr/projectWorker/device/isExist",getKeys:"/mgr/projectWorker/device/getKeys",watch:"/mgr/projectWorker/device/watch",unwatch:"/mgr/projectWorker/device/unwatch",add:"/mgr/projectWorker/device/add",delete:"/mgr/projectWorker/device/delete",batchDelete:"/mgr/projectWorker/device/batchDelete",update:"/mgr/projectWorker/device/update",getIdByTitle:"/mgr/projectWorker/device/getIdByTitle",getTitleById:"/mgr/projectWorker/device/getTitleById",getAllKVData:"/mgr/projectWorker/device/getAllKVData",getLastData:"/mgr/projectWorker/device/getLastData",getDataBySourceAndVersion:"/mgr/projectWorker/device/getDataBySourceAndVersion",getAllArrData:"/mgr/projectWorker/device/getAllArrData",getLotsArrData:"/mgr/projectWorker/device/getLotsArrDatas",getAllArrDatasBySymbolId:"/mgr/projectWorker/device/getAllArrDatasBySymbolId",getAllArrDatasByFootprintId:"/mgr/projectWorker/device/getAllArrDatasByFootprintId",getAllArrDataBySource:"/mgr/projectWorker/device/getAllArrDataBySource",getKeysBySource:"/mgr/projectWorker/device/getKeysBySource",getSymbolIdById:"/mgr/projectWorker/device/getSymbolIdById",getStr:"/mgr/projectWorker/device/getStr",getAll:"/mgr/projectWorker/device/getAll",buildString:"/mgr/projectWorker/device/buildString",bindSymbol:"/mgr/projectWorker/device/bindSymbol",bindFootprint:"/mgr/projectWorker/device/bindFootprint",withOrigins:"/mgr/projectWorker/device/withOrigins",place:"/mgr/projectWorker/device/place",list:"/mgr/projectWorker/device/list"},symbol:{get:"/mgr/projectWorker/symbol/get",getByTitle:"/mgr/projectWorker/symbol/getByTitle",isChange:"/mgr/projectWorker/symbol/isChange",isRename:"/mgr/projectWorker/symbol/isRename",tryRename:"/mgr/projectWorker/symbol/tryRename",isExist:"/mgr/projectWorker/symbol/isExist",getKeys:"/mgr/projectWorker/symbol/getKeys",add:"/mgr/projectWorker/symbol/add",delete:"/mgr/projectWorker/symbol/delete",batchDelete:"/mgr/projectWorker/symbol/batchDelete",update:"/mgr/projectWorker/symbol/update",setCanvas:"/mgr/projectWorker/symbol/setCanvas",coverCanvas:"/mgr/projectWorker/symbol/coverCanvas",getCanvasOnCompiler:"/mgr/projectWorker/symbol/getCanvasOnCompiler",getCanvas:"/mgr/projectWorker/symbol/getCanvas",watchCanvas:"/mgr/projectWorker/symbol/watchCanvas",unwatchCanvas:"/mgr/projectWorker/symbol/unwatchCanvas",getIdByTitle:"/mgr/projectWorker/symbol/getIdByTitle",getTitleById:"/mgr/projectWorker/symbol/getTitleById",getAllKVData:"/mgr/projectWorker/symbol/getAllKVData",getDataBySourceAndVersion:"/mgr/projectWorker/symbol/getDataBySourceAndVersion",getLastSymbol:"/mgr/projectWorker/symbol/getLastSymbol",getLastBlockSymbol:"/mgr/projectWorker/symbol/getLastBlockSymbol",getAllArrData:"/mgr/projectWorker/symbol/getAllArrData",getLotsArrData:"/mgr/projectWorker/symbol/getLotsArrDatas",getAllArrDataBySource:"/mgr/projectWorker/symbol/getAllArrDataBySource",getKeysBySource:"/mgr/projectWorker/symbol/getKeysBySource",getTypeData:"/mgr/projectWorker/symbol/getTypeData",getStr:"/mgr/projectWorker/symbol/getStr",clone:"/mgr/projectWorker/symbol/clone",buildString:"/mgr/projectWorker/symbol/buildString",withOrigins:"/mgr/projectWorker/symbol/withOrigins",extractCanvas:"/mgr/projectWorker/symbol/extractCanvas",list:"/mgr/projectWorker/symbol/list"},footprint:{get:"/mgr/projectWorker/footprint/get",getByTitle:"/mgr/projectWorker/footprint/getByTitle",isChange:"/mgr/projectWorker/footprint/isChange",isRename:"/mgr/projectWorker/footprint/isRename",tryRename:"/mgr/projectWorker/footprint/tryRename",getKeys:"/mgr/projectWorker/footprint/getKeys",isExist:"/mgr/projectWorker/footprint/isExist",add:"/mgr/projectWorker/footprint/add",clone:"/mgr/projectWorker/footprint/clone",delete:"/mgr/projectWorker/footprint/delete",batchDelete:"/mgr/projectWorker/footprint/batchDelete",update:"/mgr/projectWorker/footprint/update",setCanvas:"/mgr/projectWorker/footprint/setCanvas",coverCanvas:"/mgr/projectWorker/footprint/coverCanvas",getCanvasOnCompiler:"/mgr/projectWorker/footprint/getCanvas",watchCanvas:"/mgr/projectWorker/footprint/watchCanvas",unwatchCanvas:"/mgr/projectWorker/footprint/unwatchCanvas",getIdByTitle:"/mgr/projectWorker/footprint/getIdByTitle",getTitleById:"/mgr/projectWorker/footprint/getTitleById",getAllKVData:"/mgr/projectWorker/footprint/getAllKVData",getLastData:"/mgr/projectWorker/footprint/getLastData",getDataBySourceAndVersion:"/mgr/projectWorker/footprint/getDataBySourceAndVersion",getAllArrData:"/mgr/projectWorker/footprint/getAllArrData",getAllArrDataByPcbId:"/mgr/projectWorker/footprint/getAllArrDataByPcbId",getKeysByPcbId:"/mgr/projectWorker/footprint/getKeysByPcbId",getLotsArrData:"/mgr/projectWorker/footprint/getLotsArrDatas",getAllArrDataBySource:"/mgr/projectWorker/footprint/getAllArrDataBySource",getKeysBySource:"/mgr/projectWorker/footprint/getKeysBySource",getAllPrimaryKeys:"/mgr/projectWorker/footprint/getAllPrimaryKeys",getStr:"/mgr/projectWorker/footprint/getStr",buildString:"/mgr/projectWorker/footprint/buildString",withOrigins:"/mgr/projectWorker/footprint/withOrigins",extractCanvas:"/mgr/projectWorker/footprint/extractCanvas",list:"/mgr/projectWorker/footprint/list"},panel:{get:"/mgr/projectWorker/panel/get",getByTitle:"/mgr/projectWorker/panel/getByTitle",isRename:"/mgr/projectWorker/panel/isRename",tryRename:"/mgr/projectWorker/panel/tryRename",isExist:"/mgr/projectWorker/panel/isExist",add:"/mgr/projectWorker/panel/add",delete:"/mgr/projectWorker/panel/delete",batchDelete:"/mgr/projectWorker/panel/batchDelete",update:"/mgr/projectWorker/panel/update",setCanvas:"/mgr/projectWorker/panel/setCanvas",coverCanvas:"/mgr/projectWorker/panel/coverCanvas",getCanvasOnCompiler:"/mgr/projectWorker/panel/getCanvas",watchCanvas:"/mgr/projectWorker/panel/watchCanvas",unwatchCanvas:"/mgr/projectWorker/panel/unwatchCanvas",getIdByTitle:"/mgr/projectWorker/panel/getIdByTitle",getAllKVData:"/mgr/projectWorker/panel/getAllKVData",getAllArrData:"/mgr/projectWorker/panel/getAllArrData",getLotsArrData:"/mgr/projectWorker/panel/getLotsArrDatas",getStr:"/mgr/projectWorker/panel/getStr",getKeys:"/mgr/projectWorker/panel/getKeys",buildString:"/mgr/projectWorker/panel/buildString",extractCanvas:"/mgr/projectWorker/panel/extractCanvas"},pcb:{get:"/mgr/projectWorker/pcb/get",getByTitle:"/mgr/projectWorker/pcb/getByTitle",isRename:"/mgr/projectWorker/pcb/isRename",tryRename:"/mgr/projectWorker/pcb/tryRename",getArrByBoard:"/mgr/projectWorker/pcb/getArrByBoard",isExist:"/mgr/projectWorker/pcb/isExist",add:"/mgr/projectWorker/pcb/add",delete:"/mgr/projectWorker/pcb/delete",batchDelete:"/mgr/projectWorker/pcb/batchDelete",update:"/mgr/projectWorker/pcb/update",updateSub:"/mgr/projectWorker/pcb/updateSub",createSub:"/mgr/projectWorker/pcb/createSub",setCanvas:"/mgr/projectWorker/pcb/setCanvas",coverCanvas:"/mgr/projectWorker/pcb/coverCanvas",getCanvasOnCompiler:"/mgr/projectWorker/pcb/getCanvas",getCanvasByTicket:"/mgr/projectWorker/pcb/getCanvasByTicket",watchCanvas:"/mgr/projectWorker/pcb/watchCanvas",unwatchCanvas:"/mgr/projectWorker/pcb/unwatchCanvas",getIdByTitle:"/mgr/projectWorker/pcb/getIdByTitle",getAllKVData:"/mgr/projectWorker/pcb/getAllKVData",getAllArrData:"/mgr/projectWorker/pcb/getAllArrData",getLotsArrData:"/mgr/projectWorker/pcb/getLotsArrDatas",getDataBySourceAndVersion:"/mgr/projectWorker/pcb/getDataBySourceAndVersion",getLastData:"/mgr/projectWorker/pcb/getLastData",getAllArrDataBySource:"/mgr/projectWorker/pcb/getAllArrDataBySource",getStr:"/mgr/projectWorker/pcb/getStr",getKeys:"/mgr/projectWorker/pcb/getKeys",buildString:"/mgr/projectWorker/pcb/buildString",extractCanvas:"/mgr/projectWorker/pcb/extractCanvas"},schematic:{watchCanvas:"/mgr/projectWorker/schematic/watchCanvas",unwatchCanvas:"/mgr/projectWorker/schematic/unwatchCanvas",setCanvas:"/mgr/projectWorker/schematic/setCanvas",getCanvasOnCompiler:"/mgr/projectWorker/schematic/getCanvas",get:"/mgr/projectWorker/schematic/get",getByName:"/mgr/projectWorker/schematic/getByName",isRename:"/mgr/projectWorker/schematic/isRename",tryRename:"/mgr/projectWorker/schematic/tryRename",getArrByBoard:"/mgr/projectWorker/schematic/getArrByBoard",isExist:"/mgr/projectWorker/schematic/isExist",add:"/mgr/projectWorker/schematic/add",delete:"/mgr/projectWorker/schematic/delete",batchDelete:"/mgr/projectWorker/schematic/batchDelete",update:"/mgr/projectWorker/schematic/update",getAllKVData:"/mgr/projectWorker/schematic/getAllKVDatas",getIdByName:"/mgr/projectWorker/schematic/getIdByName",getNameById:"/mgr/projectWorker/schematic/getNameById",getDisplayNameById:"/mgr/projectWorker/schematic/getDisplayNameById",getAllArrData:"/mgr/projectWorker/schematic/getAllArrDatas",getLotsArrData:"/mgr/projectWorker/schematic/getLotsArrData",getDataBySourceAndVersion:"/mgr/projectWorker/schematic/getDataBySourceAndVersion",getLastData:"/mgr/projectWorker/schematic/getLastData",getAllArrDataBySource:"/mgr/projectWorker/schematic/getAllArrDataBySource",getStr:"/mgr/projectWorker/schematic/getStr",getKeys:"/mgr/projectWorker/schematic/getKeys",buildString:"/mgr/projectWorker/schematic/buildString"},sheet:{get:"/mgr/projectWorker/sheet/get",getByTitle:"/mgr/projectWorker/sheet/getByTitle",isRename:"/mgr/projectWorker/sheet/isRename",tryRename:"/mgr/projectWorker/sheet/tryRename",isExist:"/mgr/projectWorker/sheet/isExist",add:"/mgr/projectWorker/sheet/add",delete:"/mgr/projectWorker/sheet/delete",batchDelete:"/mgr/projectWorker/sheet/batchDelete",update:"/mgr/projectWorker/sheet/update",setCanvas:"/mgr/projectWorker/sheet/setCanvas",coverCanvas:"/mgr/projectWorker/sheet/coverCanvas",getCanvasOnCompiler:"/mgr/projectWorker/sheet/getCanvas",watchCanvas:"/mgr/projectWorker/sheet/watchCanvas",unwatchCanvas:"/mgr/projectWorker/sheet/unwatchCanvas",getAllKVData:"/mgr/projectWorker/sheet/getAllKVData",getAllArrData:"/mgr/projectWorker/sheet/getAllArrData",getLotsArrData:"/mgr/projectWorker/sheet/getLotsArrDatas",getDataBySourceAndVersion:"/mgr/projectWorker/sheet/getDataBySourceAndVersion",getLastData:"/mgr/projectWorker/sheet/getLastData",getAllArrDataBySource:"/mgr/projectWorker/sheet/getAllArrDataBySource",getStr:"/mgr/projectWorker/sheet/getStr",getKeys:"/mgr/projectWorker/sheet/getKeys",buildString:"/mgr/projectWorker/sheet/buildString",extractCanvas:"/mgr/projectWorker/sheet/extractCanvas"},simulation:{get:"/mgr/projectWorker/simulation/get",getByTitle:"/mgr/projectWorker/simulation/getByTitle",isRename:"/mgr/projectWorker/simulation/isRename",tryRename:"/mgr/projectWorker/simulation/tryRename",isExist:"/mgr/projectWorker/simulation/isExist",add:"/mgr/projectWorker/simulation/add",delete:"/mgr/projectWorker/simulation/delete",batchDelete:"/mgr/projectWorker/simulation/batchDelete",update:"/mgr/projectWorker/simulation/update",setCanvas:"/mgr/projectWorker/simulation/setCanvas",coverCanvas:"/mgr/projectWorker/simulation/coverCanvas",getCanvasOnCompiler:"/mgr/projectWorker/simulation/getCanvas",watchCanvas:"/mgr/projectWorker/simulation/watchCanvas",unwatchCanvas:"/mgr/projectWorker/simulation/unwatchCanvas",getAllKVData:"/mgr/projectWorker/simulation/getAllKVData",getAllArrData:"/mgr/projectWorker/simulation/getAllArrData",getLotsArrData:"/mgr/projectWorker/simulation/getLotsArrDatas",getDataBySourceAndVersion:"/mgr/projectWorker/simulation/getDataBySourceAndVersion",getLastData:"/mgr/projectWorker/simulation/getLastData",getAllArrDataBySource:"/mgr/projectWorker/simulation/getAllArrDataBySource",getStr:"/mgr/projectWorker/simulation/getStr",getKeys:"/mgr/projectWorker/simulation/getKeys",buildString:"/mgr/projectWorker/simulation/buildString",extractCanvas:"/mgr/projectWorker/simulation/extractCanvas"},variant:{batchAdd:"/mgr/projectWorker/variant/batchAddVariant",add:"/mgr/projectWorker/variant/addData",delete:"/mgr/projectWorker/variant/deleteData",batchDelete:"/mgr/projectWorker/variant/batchDeleteData",batchRestore:"/mgr/projectWorker/variant/batchRestoreData",get:"/mgr/projectWorker/variant/getData",getAllArr:"/mgr/projectWorker/variant/getAllArrDatasBySid",updateTitle:"/mgr/projectWorker/variant/updateTitle",updateNotGrouped:"/mgr/projectWorker/variant/updateNotGrouped",batchUpdateZIndex:"/mgr/projectWorker/variant/batchUpdateZIndex"},componentGroup:{batchAdd:"/mgr/projectWorker/componentGroup/batchAddData",add:"/mgr/projectWorker/componentGroup/addData",delete:"/mgr/projectWorker/componentGroup/deleteData",batchDelete:"/mgr/projectWorker/componentGroup/batchDeleteData",batchRestore:"/mgr/projectWorker/componentGroup/batchRestoreData",get:"/mgr/projectWorker/componentGroup/getData",getAllArr:"/mgr/projectWorker/componentGroup/getAllArrDatasBySid",getAttr:"/mgr/projectWorker/componentGroup/getComponentGroupData",updateTitle:"/mgr/projectWorker/componentGroup/updateTitle",batchUpdateZIndex:"/mgr/projectWorker/componentGroup/batchUpdateZIndex",batchUploadGroupSortInVariant:"/mgr/projectWorker/componentGroup/batchUploadGroupSortInVariant",batchDeleteGroupSortInVariant:"/mgr/projectWorker/componentGroup/batchDeleteGroupSortInVariant",uploadComponentGroupData:"/mgr/projectWorker/componentGroup/uploadComponentGroupData",batchDeleteComponentGroupData:"/mgr/projectWorker/componentGroup/batchDeleteComponentGroupData"},instance:{get:"/mgr/projectWorker/instance/get",getAttr:"/mgr/projectWorker/instance/getAttr",saveAttr:"/mgr/projectWorker/instance/saveAttr",isExist:"/mgr/projectWorker/instance/isExist",add:"/mgr/projectWorker/instance/add",batchUpload:"/mgr/projectWorker/instance/batchUpload",delete:"/mgr/projectWorker/instance/delete",batchDelete:"/mgr/projectWorker/instance/batchDelete",getAllKVData:"/mgr/projectWorker/instance/getAllKVData",getAllArrData:"/mgr/projectWorker/instance/getAllArrData",getAllArrDataByHash:"/mgr/projectWorker/instance/getAllArrDatasByHash",getAllArrDataByPath:"/mgr/projectWorker/instance/getAllArrDataByPath",getStr:"/mgr/projectWorker/instance/getStr",getKeys:"/mgr/projectWorker/instance/getKeys",buildString:"/mgr/projectWorker/instance/buildString"},update:{symbol:{getMap:"/mgr/projectWorker/update/symbol/map",update:"/mgr/projectWorker/update/symbol/update",getData:"/mgr/projectWorker/update/symbol/getData",setHasOrigin:"/mgr/projectWorker/update/symbol/setHasOrigin",getHasOrigin:"/mgr/projectWorker/update/symbol/getHasOrigin"},footprint:{getMap:"/mgr/projectWorker/update/footprint/map",update:"/mgr/projectWorker/update/footprint/update",getData:"/mgr/projectWorker/update/footprint/getData",setHasOrigin:"/mgr/projectWorker/update/footprint/setHasOrigin",getHasOrigin:"/mgr/projectWorker/update/footprint/getHasOrigin"},device:{getMap:"/mgr/projectWorker/update/device/map",update:"/mgr/projectWorker/update/device/update",getData:"/mgr/projectWorker/update/device/getData",setHasOrigin:"/mgr/projectWorker/update/device/setHasOrigin",getHasOrigin:"/mgr/projectWorker/update/device/getHasOrigin"},schematic:{getMap:"/mgr/projectWorker/update/schematic/map",update:"/mgr/projectWorker/update/schematic/update",getData:"/mgr/projectWorker/update/schematic/getData",setHasOrigin:"/mgr/projectWorker/update/schematic/setHasOrigin",getHasOrigin:"/mgr/projectWorker/update/schematic/getHasOrigin"},sheet:{getMap:"/mgr/projectWorker/update/sheet/map",update:"/mgr/projectWorker/update/sheet/update",getData:"/mgr/projectWorker/update/sheet/getData",setHasOrigin:"/mgr/projectWorker/update/sheet/setHasOrigin",getHasOrigin:"/mgr/projectWorker/update/sheet/getHasOrigin"},pcb:{getMap:"/mgr/projectWorker/update/pcb/map",update:"/mgr/projectWorker/update/pcb/update",getData:"/mgr/projectWorker/update/pcb/getData",setHasOrigin:"/mgr/projectWorker/update/pcb/setHasOrigin",getHasOrigin:"/mgr/projectWorker/update/pcb/getHasOrigin"},updateTeam:"/mgr/projectWorker/update/updateTeam",isPublic:"/mgr/projectWorker/update/isPublic",getLastest:"/mgr/projectWorker/update/getLastest",force:"/mgr/projectWorker/update/force",suspend:"/mgr/projectWorker/update/suspend",resume:"/mgr/projectWorker/update/resume"}};var Xg=class{constructor(t){this.project=t}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.get,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataByHash(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getAllArrDataByHash,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataByPath(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getAllArrDataByPath,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchUpdate(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.batchUpload,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setAttr(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.saveAttr,{uuid:t,dataStr:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAttr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getAttr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.instance.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Zg=class{constructor(t){this.project=t}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.get,{uuid:t}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isChange(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.isChange,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getTitleById(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getTitleById,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getIdByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getLastData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDatasBySymbolId(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getAllArrDatasBySymbolId,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDatasByFootprintId(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getAllArrDatasByFootprintId,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeysBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getKeysBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getSymbolIdById(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getSymbolIdById,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async place(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.place,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async bindSymbol(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.bindSymbol,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async bindFootprint(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.bindFootprint,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async withOrigins(){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.withOrigins):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async list(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.device.list,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var $g=class{constructor(t){this.project=t}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.get,{uuid:t,need:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isChange(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.isChange,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataByPcbId(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getAllArrDataByPcbId,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeysByPcbId(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getKeysByPcbId,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getTitleById(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getTitleById,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getIdByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllPrimaryKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getAllPrimaryKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getLastData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeysBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getKeysBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async clone(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.clone,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setCanvas(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.setCanvas,{uuid:t,canvas:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async coverCanvas(t,s,r){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.coverCanvas,{uuid:t,canvas:s,version:r}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async withOrigins(){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.withOrigins):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async extractCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.extractCanvas,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async list(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.footprint.list,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Qg=class{constructor(t){this.project=t}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.get,{uuid:t,need:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.getIdByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setCanvas(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.setCanvas,{uuid:t,canvas:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async coverCanvas(t,s,r){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.coverCanvas,{uuid:t,canvas:s,version:r}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async extractCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.panel.extractCanvas,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var ey=class{constructor(t){this.project=t}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.get,{uuid:t,need:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrByBoard(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getArrByBoard,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getIdByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateSubInherit(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.updateSub,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async createSub(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.createSub,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setCanvas(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.setCanvas,{uuid:t,canvas:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async coverCanvas(t,s,r){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.coverCanvas,{uuid:t,canvas:s,version:r}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getLastData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async extractCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.pcb.extractCanvas,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var ty=class{constructor(t){this.project=t}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.get,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataByName(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getByName,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrByBoard(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getArrByBoard,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getNameById(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getNameById,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDisplayNameById(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getDisplayNameById,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByName(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getIdByName,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getLastData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.schematic.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var sy=class{constructor(t){this.project=t}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.get,{uuid:t,need:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getByTitle,{title:t,sid:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.isRename,{title:t,sid:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.tryRename,{title:t,sid:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getAllKVData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getAllArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setCanvas(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.setCanvas,{uuid:t,canvas:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async coverCanvas(t,s,r){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.coverCanvas,{uuid:t,canvas:s,version:r}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getLastData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.getKeys,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async extractCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.sheet.extractCanvas,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var ry=class{constructor(t){this.project=t}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.get,{uuid:t,need:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getAllKVData):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getAllArrData):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setCanvas(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.setCanvas,{uuid:t,canvas:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async coverCanvas(t,s,r){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.coverCanvas,{uuid:t,canvas:s,version:r}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getLastData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.getKeys):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async extractCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.simulation.extractCanvas,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var iy=class{constructor(t){this.project=t}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isExist(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.isExist,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.get,{uuid:t,need:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isChange(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.isChange,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getLotsArrData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getTitleById(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getTitleById,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getIdByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getDataBySourceAndVersion(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getDataBySourceAndVersion,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByType(t=!1){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getTypeData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastSymbol(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getLastSymbol,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastBlockSymbol(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getLastBlockSymbol,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrDataBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getAllArrDataBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeysBySource(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getKeysBySource,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setCanvas(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.setCanvas,{uuid:t,canvas:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async coverCanvas(t,s,r){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.coverCanvas,{uuid:t,canvas:s,version:r}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getCanvas,{uuid:t}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async clone(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.clone,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async withOrigins(t=!1){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.withOrigins,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async extractCanvas(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.extractCanvas,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async list(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.symbol.list,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var ny=class{constructor(t){this.project=t}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getProjectDetail,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.setProjectDetail,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getSnapShot(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getSnapShot,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async countDoc(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.countDoc,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getClient(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getClient,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getBranchData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getBranchData):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async indexs(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.indexs,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getMaxTicket(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getMaxTicket,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHistoricalNodes(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getHistoricalNodes,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHistoryUpdatetime(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getHistoryUpdatetime,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHistoricalProject(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.getHistoricalProject,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async startBatchUpload(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.startBatchUpload,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async endBatchUpload(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.endBatchUpload,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async savePendData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.savePendData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async revokePendData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.revokePendData):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async histories(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.histories,[t,s]):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async compress(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.compress):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async flowWrite(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.flowWrite,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async uploadLocal(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.uploadLocal,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async parseData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.parseData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async import(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.import,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async awaitUploadEnd(){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.awaitUploadEnd,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async related(t,s=!1){return this.project.isReady?await this.project.workerBus.rpcCall(K.public.related,{params:t,isRpc:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Hd=class{constructor(t){this.project=t}async getMap(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.device.getMap,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async update(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.device.update,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.device.getData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setHasOrigin(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.device.setHasOrigin,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHasOrigin(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.device.getHasOrigin,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Gd=class{constructor(t){this.project=t}async getMap(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.footprint.getMap,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async update(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.footprint.update,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.footprint.getData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setHasOrigin(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.footprint.setHasOrigin,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHasOrigin(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.footprint.getHasOrigin,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Yd=class{constructor(t){this.project=t}async getMap(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.pcb.getMap,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async update(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.pcb.update,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.pcb.getData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setHasOrigin(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.pcb.setHasOrigin,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHasOrigin(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.pcb.getHasOrigin,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Vd=class{constructor(t){this.project=t}async getMap(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.schematic.getMap,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async update(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.schematic.update,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.schematic.getData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setHasOrigin(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.schematic.setHasOrigin,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHasOrigin(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.schematic.getHasOrigin,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var zd=class{constructor(t){this.project=t}async getMap(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.sheet.getMap,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async update(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.sheet.update,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.sheet.getData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setHasOrigin(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.sheet.setHasOrigin,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHasOrigin(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.sheet.getHasOrigin,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var Wd=class{constructor(t){this.project=t}async getMap(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.symbol.getMap,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async update(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.symbol.update,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.symbol.getData,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async setHasOrigin(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.symbol.setHasOrigin,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getHasOrigin(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.symbol.getHasOrigin,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var qd=class{constructor(t){this.project=t;this.symbol=null;this.footprint=null;this.device=null;this.schematic=null;this.sheet=null;this.pcb=null;this.symbol=new Wd(t),this.footprint=new Gd(t),this.device=new Hd(t),this.schematic=new Vd(t),this.sheet=new zd(t),this.pcb=new Yd(t)}async updateTeam(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.updateTeam,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isPublic(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.isPublic,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLastest(t,s){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.getLastest,{type:t,source:s}):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async force(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.force):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async suspend(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.suspend):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async resume(){return this.project.isReady?await this.project.workerBus.rpcCall(K.update.resume):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var ay=class{constructor(t){this.project=t}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.get,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getLotsArrByHash(t=[]){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.getList,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchUpdateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.batchUpload,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.blob.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var oy=class{constructor(t){this.project=t}async getData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.config.get):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.config.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.config.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var cy=class{constructor(t){this.project=t}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.get,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getArrDataByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async isRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.isRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async tryRename(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.tryRename,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getIdByTitle(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getIdByTitle,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async addData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.add,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async updateData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.update,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async batchDelete(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllKVData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getAllKVData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getAllArrData(){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getAllArrData,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getKeys(){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getKeys,void 0):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getBindKeys(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.getBindKeys,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.board.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var ZD={},fM=(function(e,t,s,r,i){var n=new Worker(ZD[t]||(ZD[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return n.onmessage=function(a){var o=a.data,c=o.$e$;if(c){var l=new Error(c[0]);l.code=c[1],l.stack=c[2],i(l,null)}else i(null,o)},n.postMessage(s,r),n}),zt=Uint8Array,Pi=Uint16Array,Xd=Int32Array,Hu=new zt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Gu=new zt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jd=new zt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sP=function(e,t){for(var s=new Pi(31),r=0;r<31;++r)s[r]=t+=1<<e[r-1];for(var i=new Xd(s[30]),r=1;r<30;++r)for(var n=s[r];n<s[r+1];++n)i[n]=n-s[r]<<5|r;return{b:s,r:i}},rP=sP(Hu,2),Jb=rP.b,fy=rP.r;Jb[28]=258,fy[258]=28;var iP=sP(Gu,0),nP=iP.b,Gb=iP.r,Kd=new Pi(32768);for(Es=0;Es<32768;++Es)io=(Es&43690)>>1|(Es&21845)<<1,io=(io&52428)>>2|(io&13107)<<2,io=(io&61680)>>4|(io&3855)<<4,Kd[Es]=((io&65280)>>8|(io&255)<<8)>>1;var io,Es,yn=(function(e,t,s){for(var r=e.length,i=0,n=new Pi(t);i<r;++i)e[i]&&++n[e[i]-1];var a=new Pi(t);for(i=1;i<t;++i)a[i]=a[i-1]+n[i-1]<<1;var o;if(s){o=new Pi(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],u=t-e[i],h=a[e[i]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)o[Kd[h]>>c]=l}else for(o=new Pi(r),i=0;i<r;++i)e[i]&&(o[i]=Kd[a[e[i]-1]++]>>15-e[i]);return o}),ao=new zt(288);for(Es=0;Es<144;++Es)ao[Es]=8;var Es;for(Es=144;Es<256;++Es)ao[Es]=9;var Es;for(Es=256;Es<280;++Es)ao[Es]=7;var Es;for(Es=280;Es<288;++Es)ao[Es]=8;var Es,Uu=new zt(32);for(Es=0;Es<32;++Es)Uu[Es]=5;var Es,aP=yn(ao,9,0),oP=yn(ao,9,1),cP=yn(Uu,5,0),lP=yn(Uu,5,1),uy=function(e){for(var t=e[0],s=1;s<e.length;++s)e[s]>t&&(t=e[s]);return t},gn=function(e,t,s){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&s},hy=function(e,t){var s=t/8|0;return(e[s]|e[s+1]<<8|e[s+2]<<16)>>(t&7)},Yu=function(e){return(e+7)/8|0},Ta=function(e,t,s){return(t==null||t<0)&&(t=0),(s==null||s>e.length)&&(s=e.length),new zt(e.subarray(t,s))};var uP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],At=function(e,t,s){var r=new Error(t||uP[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,At),!s)throw r;return r},yy=function(e,t,s,r){var i=e.length,n=r?r.length:0;if(!i||t.f&&!t.l)return s||new zt(0);var a=!s,o=a||t.i!=2,c=t.i;a&&(s=new zt(i*3));var l=function(Fe){var G=s.length;if(Fe>G){var pe=new zt(Math.max(G*2,Fe));pe.set(s),s=pe}},u=t.f||0,h=t.p||0,p=t.b||0,d=t.l,f=t.d,m=t.m,g=t.n,b=i*8;do{if(!d){u=gn(e,h,1);var E=gn(e,h+1,3);if(h+=3,E)if(E==1)d=oP,f=lP,m=9,g=5;else if(E==2){var S=gn(e,h,31)+257,_=gn(e,h+10,15)+4,C=S+gn(e,h+5,31)+1;h+=14;for(var x=new zt(C),D=new zt(19),I=0;I<_;++I)D[Jd[I]]=gn(e,h+I*3,7);h+=_*3;for(var P=uy(D),L=(1<<P)-1,F=yn(D,P,1),I=0;I<C;){var V=F[gn(e,h,L)];h+=V&15;var y=V>>4;if(y<16)x[I++]=y;else{var B=0,k=0;for(y==16?(k=3+gn(e,h,3),h+=2,B=x[I-1]):y==17?(k=3+gn(e,h,7),h+=3):y==18&&(k=11+gn(e,h,127),h+=7);k--;)x[I++]=B}}var O=x.subarray(0,S),R=x.subarray(S);m=uy(O),g=uy(R),d=yn(O,m,1),f=yn(R,g,1)}else At(1);else{var y=Yu(h)+4,T=e[y-4]|e[y-3]<<8,w=y+T;if(w>i){c&&At(0);break}o&&l(p+T),s.set(e.subarray(y,w),p),t.b=p+=T,t.p=h=w*8,t.f=u;continue}if(h>b){c&&At(0);break}}o&&l(p+131072);for(var v=(1<<m)-1,j=(1<<g)-1,M=h;;M=h){var B=d[hy(e,h)&v],H=B>>4;if(h+=B&15,h>b){c&&At(0);break}if(B||At(2),H<256)s[p++]=H;else if(H==256){M=h,d=null;break}else{var q=H-254;if(H>264){var I=H-257,Q=Hu[I];q=gn(e,h,(1<<Q)-1)+Jb[I],h+=Q}var oe=f[hy(e,h)&j],me=oe>>4;oe||At(3),h+=oe&15;var R=nP[me];if(me>3){var Q=Gu[me];R+=hy(e,h)&(1<<Q)-1,h+=Q}if(h>b){c&&At(0);break}o&&l(p+131072);var Ee=p+q;if(p<R){var Pe=n-R,Oe=Math.min(R,Ee);for(Pe+p<0&&At(3);p<Oe;++p)s[p]=r[Pe+p]}for(;p<Ee;++p)s[p]=s[p-R]}}t.l=d,t.p=M,t.b=p,t.f=u,d&&(u=1,t.m=m,t.d=f,t.n=g)}while(!u);return p!=s.length&&a?Ta(s,0,p):s.subarray(0,p)},ba=function(e,t,s){s<<=t&7;var r=t/8|0;e[r]|=s,e[r+1]|=s>>8},ku=function(e,t,s){s<<=t&7;var r=t/8|0;e[r]|=s,e[r+1]|=s>>8,e[r+2]|=s>>16},dy=function(e,t){for(var s=[],r=0;r<e.length;++r)e[r]&&s.push({s:r,f:e[r]});var i=s.length,n=s.slice();if(!i)return{t:ec,l:0};if(i==1){var a=new zt(s[0].s+1);return a[s[0].s]=1,{t:a,l:1}}s.sort(function(w,S){return w.f-S.f}),s.push({s:-1,f:25001});var o=s[0],c=s[1],l=0,u=1,h=2;for(s[0]={s:-1,f:o.f+c.f,l:o,r:c};u!=i-1;)o=s[s[l].f<s[h].f?l++:h++],c=s[l!=u&&s[l].f<s[h].f?l++:h++],s[u++]={s:-1,f:o.f+c.f,l:o,r:c};for(var p=n[0].s,r=1;r<i;++r)n[r].s>p&&(p=n[r].s);var d=new Pi(p+1),f=my(s[u-1],d,0);if(f>t){var r=0,m=0,g=f-t,b=1<<g;for(n.sort(function(S,_){return d[_.s]-d[S.s]||S.f-_.f});r<i;++r){var E=n[r].s;if(d[E]>t)m+=b-(1<<f-d[E]),d[E]=t;else break}for(m>>=g;m>0;){var y=n[r].s;d[y]<t?m-=1<<t-d[y]++-1:++r}for(;r>=0&&m;--r){var T=n[r].s;d[T]==t&&(--d[T],++m)}f=t}return{t:new zt(d),l:f}},my=function(e,t,s){return e.s==-1?Math.max(my(e.l,t,s+1),my(e.r,t,s+1)):t[e.s]=s},Yb=function(e){for(var t=e.length;t&&!e[--t];);for(var s=new Pi(++t),r=0,i=e[0],n=1,a=function(c){s[r++]=c},o=1;o<=t;++o)if(e[o]==i&&o!=t)++n;else{if(!i&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(i),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(i);n=1,i=e[o]}return{c:s.subarray(0,r),n:t}},Mu=function(e,t){for(var s=0,r=0;r<t.length;++r)s+=e[r]*t[r];return s},Kb=function(e,t,s){var r=s.length,i=Yu(t+2);e[i]=r&255,e[i+1]=r>>8,e[i+2]=e[i]^255,e[i+3]=e[i+1]^255;for(var n=0;n<r;++n)e[i+n+4]=s[n];return(i+4+r)*8},Vb=function(e,t,s,r,i,n,a,o,c,l,u){ba(t,u++,s),++i[256];for(var h=dy(i,15),p=h.t,d=h.l,f=dy(n,15),m=f.t,g=f.l,b=Yb(p),E=b.c,y=b.n,T=Yb(m),w=T.c,S=T.n,_=new Pi(19),C=0;C<E.length;++C)++_[E[C]&31];for(var C=0;C<w.length;++C)++_[w[C]&31];for(var x=dy(_,7),D=x.t,I=x.l,P=19;P>4&&!D[Jd[P-1]];--P);var L=l+5<<3,F=Mu(i,ao)+Mu(n,Uu)+a,V=Mu(i,p)+Mu(n,m)+a+14+3*P+Mu(_,D)+2*_[16]+3*_[17]+7*_[18];if(c>=0&&L<=F&&L<=V)return Kb(t,u,e.subarray(c,c+l));var B,k,O,R;if(ba(t,u,1+(V<F)),u+=2,V<F){B=yn(p,d,0),k=p,O=yn(m,g,0),R=m;var v=yn(D,I,0);ba(t,u,y-257),ba(t,u+5,S-1),ba(t,u+10,P-4),u+=14;for(var C=0;C<P;++C)ba(t,u+3*C,D[Jd[C]]);u+=3*P;for(var j=[E,w],M=0;M<2;++M)for(var H=j[M],C=0;C<H.length;++C){var q=H[C]&31;ba(t,u,v[q]),u+=D[q],q>15&&(ba(t,u,H[C]>>5&127),u+=H[C]>>12)}}else B=aP,k=ao,O=cP,R=Uu;for(var C=0;C<o;++C){var Q=r[C];if(Q>255){var q=Q>>18&31;ku(t,u,B[q+257]),u+=k[q+257],q>7&&(ba(t,u,Q>>23&31),u+=Hu[q]);var oe=Q&31;ku(t,u,O[oe]),u+=R[oe],oe>3&&(ku(t,u,Q>>5&8191),u+=Gu[oe])}else ku(t,u,B[Q]),u+=k[Q]}return ku(t,u,B[256]),u+k[256]},hP=new Xd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ec=new zt(0),dP=function(e,t,s,r,i,n){var a=n.z||e.length,o=new zt(r+a+5*(1+Math.ceil(a/7e3))+i),c=o.subarray(r,o.length-i),l=n.l,u=(n.r||0)&7;if(t){u&&(c[0]=n.r>>3);for(var h=hP[t-1],p=h>>13,d=h&8191,f=(1<<s)-1,m=n.p||new Pi(32768),g=n.h||new Pi(f+1),b=Math.ceil(s/3),E=2*b,y=function(ge){return(e[ge]^e[ge+1]<<b^e[ge+2]<<E)&f},T=new Xd(25e3),w=new Pi(288),S=new Pi(32),_=0,C=0,x=n.i||0,D=0,I=n.w||0,P=0;x+2<a;++x){var L=y(x),F=x&32767,V=g[L];if(m[F]=V,g[L]=F,I<=x){var B=a-x;if((_>7e3||D>24576)&&(B>423||!l)){u=Vb(e,c,0,T,w,S,C,D,P,x-P,u),D=_=C=0,P=x;for(var k=0;k<286;++k)w[k]=0;for(var k=0;k<30;++k)S[k]=0}var O=2,R=0,v=d,j=F-V&32767;if(B>2&&L==y(x-j))for(var M=Math.min(p,B)-1,H=Math.min(32767,x),q=Math.min(258,B);j<=H&&--v&&F!=V;){if(e[x+O]==e[x+O-j]){for(var Q=0;Q<q&&e[x+Q]==e[x+Q-j];++Q);if(Q>O){if(O=Q,R=j,Q>M)break;for(var oe=Math.min(j,Q-2),me=0,k=0;k<oe;++k){var Ee=x-j+k&32767,Pe=m[Ee],Oe=Ee-Pe&32767;Oe>me&&(me=Oe,V=Ee)}}}F=V,V=m[F],j+=F-V&32767}if(R){T[D++]=268435456|fy[O]<<18|Gb[R];var Fe=fy[O]&31,G=Gb[R]&31;C+=Hu[Fe]+Gu[G],++w[257+Fe],++S[G],I=x+O,++_}else T[D++]=e[x],++w[e[x]]}}for(x=Math.max(x,I);x<a;++x)T[D++]=e[x],++w[e[x]];u=Vb(e,c,l,T,w,S,C,D,P,x-P,u),l||(n.r=u&7|c[u/8|0]<<3,u-=7,n.h=g,n.p=m,n.i=x,n.w=I)}else{for(var x=n.w||0;x<a+l;x+=65535){var pe=x+65535;pe>=a&&(c[u/8|0]=l,pe=a),u=Kb(c,u+1,e.subarray(x,pe))}n.i=a}return Ta(o,0,r+Yu(u)+i)},mM=(function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var s=t,r=9;--r;)s=(s&1&&-306674912)^s>>>1;e[t]=s}return e})(),pP=function(){var e=-1;return{p:function(t){for(var s=e,r=0;r<t.length;++r)s=mM[s&255^t[r]]^s>>>8;e=s},d:function(){return~e}}},fP=function(){var e=1,t=0;return{p:function(s){for(var r=e,i=t,n=s.length|0,a=0;a!=n;){for(var o=Math.min(a+2655,n);a<o;++a)i+=r+=s[a];r=(r&65535)+15*(r>>16),i=(i&65535)+15*(i>>16)}e=r,t=i},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},Zd=function(e,t,s,r,i){if(!i&&(i={l:1},t.dictionary)){var n=t.dictionary.subarray(-32768),a=new zt(n.length+e.length);a.set(n),a.set(e,n.length),e=a,i.w=n.length}return dP(e,t.level==null?6:t.level,t.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,s,r,i)},mP=function(e,t){var s={};for(var r in e)s[r]=e[r];for(var r in t)s[r]=t[r];return s},$D=function(e,t,s){for(var r=e(),i=e.toString(),n=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<r.length;++a){var o=r[a],c=n[a];if(typeof o=="function"){t+=";"+c+"=";var l=o.toString();if(o.prototype)if(l.indexOf("[native code]")!=-1){var u=l.indexOf(" ",8)+1;t+=l.slice(u,l.indexOf("(",u))}else{t+=l;for(var h in o.prototype)t+=";"+c+".prototype."+h+"="+o.prototype[h].toString()}else t+=l}else s[c]=o}return t},ly=[],gM=function(e){var t=[];for(var s in e)e[s].buffer&&t.push((e[s]=new e[s].constructor(e[s])).buffer);return t},yM=function(e,t,s,r){if(!ly[s]){for(var i="",n={},a=e.length-1,o=0;o<a;++o)i=$D(e[o],i,n);ly[s]={c:$D(e[a],i,n),e:n}}var c=mP({},ly[s].e);return fM(ly[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",s,c,gM(c),r)},Xb=function(){return[zt,Pi,Xd,Hu,Gu,Jd,Jb,nP,oP,lP,Kd,uP,yn,uy,gn,hy,Yu,Ta,At,yy,PM,gP,wM]},EM=function(){return[zt,Pi,Xd,Hu,Gu,Jd,fy,Gb,aP,ao,cP,Uu,Kd,hP,ec,yn,ba,ku,dy,my,Yb,Mu,Kb,Vb,Yu,Ta,dP,Zd,DM,gP]};var bM=function(){return[Zb,yP]};var TM=function(){return[EP]},gP=function(e){return postMessage(e,[e.buffer])},wM=function(e){return e&&{out:e.size&&new zt(e.size),dictionary:e.dictionary}};var tc=function(e){return e.ondata=function(t,s){return postMessage([t,s],[t.buffer])},function(t){t.data.length?(e.push(t.data[0],t.data[1]),postMessage([t.data[0].length])):e.flush()}},Ey=function(e,t,s,r,i,n,a){var o,c=yM(e,r,i,function(l,u){l?(c.terminate(),t.ondata.call(t,l)):Array.isArray(u)?u.length==1?(t.queuedSize-=u[0],t.ondrain&&t.ondrain(u[0])):(u[1]&&c.terminate(),t.ondata.call(t,l,u[0],u[1])):a(u)});c.postMessage(s),t.queuedSize=0,t.push=function(l,u){t.ondata||At(5),o&&t.ondata(At(4,0,1),null,!!u),t.queuedSize+=l.length,c.postMessage([l,o=u],[l.buffer])},t.terminate=function(){c.terminate()},n&&(t.flush=function(){c.postMessage([])})},ju=function(e,t){return e[t]|e[t+1]<<8},Fu=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Hb=function(e,t){return Fu(e,t)+Fu(e,t+4)*4294967296},Ms=function(e,t,s){for(;s;++t)e[t]=s,s>>>=8},SM=function(e,t){var s=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:t.level==9?2:0,e[9]=3,t.mtime!=0&&Ms(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),s){e[3]=8;for(var r=0;r<=s.length;++r)e[r+10]=s.charCodeAt(r)}},Zb=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&At(6,"invalid gzip data");var t=e[3],s=10;t&4&&(s+=(e[10]|e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[s++]);return s+(t&2)},yP=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},_M=function(e){return 10+(e.filename?e.filename.length+1:0)},AM=function(e,t){var s=t.level,r=s==0?0:s<6?1:s==9?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var i=fP();i.p(t.dictionary),Ms(e,2,i.d())}},EP=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&At(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&At(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function $d(e,t){return typeof e=="function"&&(t=e,e={}),this.ondata=t,e}var no=(function(){function e(t,s){if(typeof t=="function"&&(s=t,t={}),this.ondata=s,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new zt(98304),this.o.dictionary){var r=this.o.dictionary.subarray(-32768);this.b.set(r,32768-r.length),this.s.i=32768-r.length}}return e.prototype.p=function(t,s){this.ondata(Zd(t,this.o,0,0,this.s),s)},e.prototype.push=function(t,s){this.ondata||At(5),this.s.l&&At(4);var r=t.length+this.s.z;if(r>this.b.length){if(r>2*this.b.length-32768){var i=new zt(r&-32768);i.set(this.b.subarray(0,this.s.z)),this.b=i}var n=this.b.length-this.s.z;this.b.set(t.subarray(0,n),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(n),32768),this.s.z=t.length-n+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=s&1,(this.s.z>this.s.w+8191||s)&&(this.p(this.b,s||!1),this.s.w=this.s.i,this.s.i-=2)},e.prototype.flush=function(){this.ondata||At(5),this.s.l&&At(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},e})();var CM=(function(){function e(t,s){Ey([EM,function(){return[tc,no]}],this,$d.call(this,t,s),function(r){var i=new no(r.data);onmessage=tc(i)},6,1)}return e})();function DM(e,t){return Zd(e,t||{},0,0)}var $i=(function(){function e(t,s){typeof t=="function"&&(s=t,t={}),this.ondata=s;var r=t&&t.dictionary&&t.dictionary.subarray(-32768);this.s={i:0,b:r?r.length:0},this.o=new zt(32768),this.p=new zt(0),r&&this.o.set(r)}return e.prototype.e=function(t){if(this.ondata||At(5),this.d&&At(4),!this.p.length)this.p=t;else if(t.length){var s=new zt(this.p.length+t.length);s.set(this.p),s.set(t,this.p.length),this.p=s}},e.prototype.c=function(t){this.s.i=+(this.d=t||!1);var s=this.s.b,r=yy(this.p,this.s,this.o);this.ondata(Ta(r,s,this.s.b),this.d),this.o=Ta(r,this.s.b-32768),this.s.b=this.o.length,this.p=Ta(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(t,s){this.e(t),this.c(s)},e})();var bP=(function(){function e(t,s){Ey([Xb,function(){return[tc,$i]}],this,$d.call(this,t,s),function(r){var i=new $i(r.data);onmessage=tc(i)},7,0)}return e})();function PM(e,t){return yy(e,{i:2},t&&t.out,t&&t.dictionary)}var cX=(function(){function e(t,s){this.c=pP(),this.l=0,this.v=1,no.call(this,t,s)}return e.prototype.push=function(t,s){this.c.p(t),this.l+=t.length,no.prototype.push.call(this,t,s)},e.prototype.p=function(t,s){var r=Zd(t,this.o,this.v&&_M(this.o),s&&8,this.s);this.v&&(SM(r,this.o),this.v=0),s&&(Ms(r,r.length-8,this.c.d()),Ms(r,r.length-4,this.l)),this.ondata(r,s)},e.prototype.flush=function(){no.prototype.flush.call(this)},e})();var zb=(function(){function e(t,s){this.v=1,this.r=0,$i.call(this,t,s)}return e.prototype.push=function(t,s){if($i.prototype.e.call(this,t),this.r+=t.length,this.v){var r=this.p.subarray(this.v-1),i=r.length>3?Zb(r):4;if(i>r.length){if(!s)return}else this.v>1&&this.onmember&&this.onmember(this.r-r.length);this.p=r.subarray(i),this.v=0}$i.prototype.c.call(this,s),this.s.f&&!this.s.l&&!s&&(this.v=Yu(this.s.p)+9,this.s={i:0},this.o=new zt(0),this.push(new zt(0),s))},e})();var OM=(function(){function e(t,s){var r=this;Ey([Xb,bM,function(){return[tc,$i,zb]}],this,$d.call(this,t,s),function(i){var n=new zb(i.data);n.onmember=function(a){return postMessage(a)},onmessage=tc(n)},9,0,function(i){return r.onmember&&r.onmember(i)})}return e})();function Qd(e,t){var s=Zb(e);return s+8>e.length&&At(6,"invalid gzip data"),yy(e.subarray(s,-8),{i:2},t&&t.out||new zt(yP(e)),t&&t.dictionary)}var lX=(function(){function e(t,s){this.c=fP(),this.v=1,no.call(this,t,s)}return e.prototype.push=function(t,s){this.c.p(t),no.prototype.push.call(this,t,s)},e.prototype.p=function(t,s){var r=Zd(t,this.o,this.v&&(this.o.dictionary?6:2),s&&4,this.s);this.v&&(AM(r,this.o),this.v=0),s&&Ms(r,r.length-4,this.c.d()),this.ondata(r,s)},e.prototype.flush=function(){no.prototype.flush.call(this)},e})();var Wb=(function(){function e(t,s){$i.call(this,t,s),this.v=t&&t.dictionary?2:1}return e.prototype.push=function(t,s){if($i.prototype.e.call(this,t),this.v){if(this.p.length<6&&!s)return;this.p=this.p.subarray(EP(this.p,this.v-1)),this.v=0}s&&(this.p.length<4&&At(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),$i.prototype.c.call(this,s)},e})();var IM=(function(){function e(t,s){Ey([Xb,TM,function(){return[tc,$i,Wb]}],this,$d.call(this,t,s),function(r){var i=new Wb(r.data);onmessage=tc(i)},11,0)}return e})();var QD=(function(){function e(t,s){this.o=$d.call(this,t,s)||{},this.G=zb,this.I=$i,this.Z=Wb}return e.prototype.i=function(){var t=this;this.s.ondata=function(s,r){t.ondata(s,r)}},e.prototype.push=function(t,s){if(this.ondata||At(5),this.s)this.s.push(t,s);else{if(this.p&&this.p.length){var r=new zt(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length)}else this.p=t;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,s),this.p=null)}},e})();var uX=(function(){function e(t,s){QD.call(this,t,s),this.queuedSize=0,this.G=OM,this.I=bP,this.Z=IM}return e.prototype.i=function(){var t=this;this.s.ondata=function(s,r,i){t.ondata(s,r,i)},this.s.ondrain=function(s){t.queuedSize-=s,t.ondrain&&t.ondrain(s)}},e.prototype.push=function(t,s){this.queuedSize+=t.length,QD.prototype.push.call(this,t,s)},e})();var eP=typeof TextEncoder<"u"&&new TextEncoder,qb=typeof TextDecoder<"u"&&new TextDecoder,TP=0;try{qb.decode(ec,{stream:!0}),TP=1}catch{}var wP=function(e){for(var t="",s=0;;){var r=e[s++],i=(r>127)+(r>223)+(r>239);if(s+i>e.length)return{s:t,r:Ta(e,s-1)};i?i==3?(r=((r&15)<<18|(e[s++]&63)<<12|(e[s++]&63)<<6|e[s++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):i&1?t+=String.fromCharCode((r&31)<<6|e[s++]&63):t+=String.fromCharCode((r&15)<<12|(e[s++]&63)<<6|e[s++]&63):t+=String.fromCharCode(r)}},hX=(function(){function e(t){this.ondata=t,TP?this.t=new TextDecoder:this.p=ec}return e.prototype.push=function(t,s){if(this.ondata||At(5),s=!!s,this.t){this.ondata(this.t.decode(t,{stream:!0}),s),s&&(this.t.decode().length&&At(8),this.t=null);return}this.p||At(4);var r=new zt(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length);var i=wP(r),n=i.s,a=i.r;s?(a.length&&At(8),this.p=null):this.p=a,this.ondata(n,s)},e})();var dX=(function(){function e(t){this.ondata=t}return e.prototype.push=function(t,s){this.ondata||At(5),this.d&&At(4),this.ondata(hi(t),this.d=s||!1)},e})();function hi(e,t){if(t){for(var s=new zt(e.length),r=0;r<e.length;++r)s[r]=e.charCodeAt(r);return s}if(eP)return eP.encode(e);for(var i=e.length,n=new zt(e.length+(e.length>>1)),a=0,o=function(u){n[a++]=u},r=0;r<i;++r){if(a+5>n.length){var c=new zt(a+8+(i-r<<1));c.set(n),n=c}var l=e.charCodeAt(r);l<128||t?o(l):l<2048?(o(192|l>>6),o(128|l&63)):l>55295&&l<57344?(l=65536+(l&1047552)|e.charCodeAt(++r)&1023,o(240|l>>18),o(128|l>>12&63),o(128|l>>6&63),o(128|l&63)):(o(224|l>>12),o(128|l>>6&63),o(128|l&63))}return Ta(n,0,a)}function xM(e,t){if(t){for(var s="",r=0;r<e.length;r+=16384)s+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return s}else{if(qb)return qb.decode(e);var i=wP(e),n=i.s,s=i.r;return s.length&&At(8),n}}var SP=function(e){return e==1?3:e<6?2:e==9?1:0};var vM=function(e,t){for(;ju(e,t)!=1;t+=4+ju(e,t+2));return[Hb(e,t+12),Hb(e,t+4),Hb(e,t+20)]},py=function(e){var t=0;if(e)for(var s in e){var r=e[s].length;r>65535&&At(9),t+=r+4}return t},tP=function(e,t,s,r,i,n,a,o){var c=r.length,l=s.extra,u=o&&o.length,h=py(l);Ms(e,t,a!=null?33639248:67324752),t+=4,a!=null&&(e[t++]=20,e[t++]=s.os),e[t]=20,t+=2,e[t++]=s.flag<<1|(n<0&&8),e[t++]=i&&8,e[t++]=s.compression&255,e[t++]=s.compression>>8;var p=new Date(s.mtime==null?Date.now():s.mtime),d=p.getFullYear()-1980;if((d<0||d>119)&&At(10),Ms(e,t,d<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),t+=4,n!=-1&&(Ms(e,t,s.crc),Ms(e,t+4,n<0?-n-2:n),Ms(e,t+8,s.size)),Ms(e,t+12,c),Ms(e,t+14,h),t+=16,a!=null&&(Ms(e,t,u),Ms(e,t+6,s.attrs),Ms(e,t+10,a),t+=14),e.set(r,t),t+=c,h)for(var f in l){var m=l[f],g=m.length;Ms(e,t,+f),Ms(e,t+2,g),e.set(m,t+4),t+=4+g}return u&&(e.set(o,t),t+=u),t},RM=function(e,t,s,r,i){Ms(e,t,101010256),Ms(e,t+8,s),Ms(e,t+10,s),Ms(e,t+12,r),Ms(e,t+16,i)},gy=(function(){function e(t){this.filename=t,this.c=pP(),this.size=0,this.compression=0}return e.prototype.process=function(t,s){this.ondata(null,t,s)},e.prototype.push=function(t,s){this.ondata||At(5),this.c.p(t),this.size+=t.length,s&&(this.crc=this.c.d()),this.process(t,s||!1)},e})();var _P=(function(){function e(t,s){var r=this;s||(s={}),gy.call(this,t),this.d=new no(s,function(i,n){r.ondata(null,i,n)}),this.compression=8,this.flag=SP(s.level)}return e.prototype.process=function(t,s){try{this.d.push(t,s)}catch(r){this.ondata(r,null,s)}},e.prototype.push=function(t,s){gy.prototype.push.call(this,t,s)},e})();var pX=(function(){function e(t,s){var r=this;s||(s={}),gy.call(this,t),this.d=new CM(s,function(i,n,a){r.ondata(i,n,a)}),this.compression=8,this.flag=SP(s.level),this.terminate=this.d.terminate}return e.prototype.process=function(t,s){this.d.push(t,s)},e.prototype.push=function(t,s){gy.prototype.push.call(this,t,s)},e})();var AP=(function(){function e(t){this.ondata=t,this.u=[],this.d=1}return e.prototype.add=function(t){var s=this;if(this.ondata||At(5),this.d&2)this.ondata(At(4+(this.d&1)*8,0,1),null,!1);else{var r=hi(t.filename),i=r.length,n=t.comment,a=n&&hi(n),o=i!=t.filename.length||a&&n.length!=a.length,c=i+py(t.extra)+30;i>65535&&this.ondata(At(11,0,1),null,!1);var l=new zt(c);tP(l,0,t,r,o,-1);var u=[l],h=function(){for(var g=0,b=u;g<b.length;g++){var E=b[g];s.ondata(null,E,!1)}u=[]},p=this.d;this.d=0;var d=this.u.length,f=mP(t,{f:r,u:o,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(h(),p){var g=s.u[d+1];g?g.r():s.d=1}p=1}}),m=0;t.ondata=function(g,b,E){if(g)s.ondata(g,b,E),s.terminate();else if(m+=b.length,u.push(b),E){var y=new zt(16);Ms(y,0,134695760),Ms(y,4,t.crc),Ms(y,8,m),Ms(y,12,t.size),u.push(y),f.c=m,f.b=c+m+16,f.crc=t.crc,f.size=t.size,p&&f.r(),p=1}else p&&h()},this.u.push(f)}},e.prototype.end=function(){var t=this;if(this.d&2){this.ondata(At(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){t.d&1&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var t=0,s=0,r=0,i=0,n=this.u;i<n.length;i++){var a=n[i];r+=46+a.f.length+py(a.extra)+(a.o?a.o.length:0)}for(var o=new zt(r+22),c=0,l=this.u;c<l.length;c++){var a=l[c];tP(o,t,a,a.f,a.u,-a.c-2,s,a.o),t+=46+a.f.length+py(a.extra)+(a.o?a.o.length:0),s+=a.b}RM(o,t,this.u.length,r,s),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var t=0,s=this.u;t<s.length;t++){var r=s[t];r.t()}this.d=2},e})();var NM=(function(){function e(){}return e.prototype.push=function(t,s){this.ondata(null,t,s)},e.compression=0,e})();var CP=(function(){function e(){var t=this;this.i=new $i(function(s,r){t.ondata(null,s,r)})}return e.prototype.push=function(t,s){try{this.i.push(t,s)}catch(r){this.ondata(r,null,s)}},e.compression=8,e})();var fX=(function(){function e(t,s){var r=this;s<32e4?this.i=new $i(function(i,n){r.ondata(null,i,n)}):(this.i=new bP(function(i,n,a){r.ondata(i,n,a)}),this.terminate=this.i.terminate)}return e.prototype.push=function(t,s){this.i.terminate&&(t=Ta(t,0)),this.i.push(t,s)},e.compression=8,e})();var DP=(function(){function e(t){this.onfile=t,this.k=[],this.o={0:NM},this.p=ec}return e.prototype.push=function(t,s){var r=this;if(this.onfile||At(5),this.p||At(4),this.c>0){var i=Math.min(this.c,t.length),n=t.subarray(0,i);if(this.c-=i,this.d?this.d.push(n,!this.c):this.k[0].push(n),t=t.subarray(i),t.length)return this.push(t,s)}else{var a=0,o=0,c=void 0,l=void 0;this.p.length?t.length?(l=new zt(this.p.length+t.length),l.set(this.p),l.set(t,this.p.length)):l=this.p:l=t;for(var u=l.length,h=this.c,p=h&&this.d,d=function(){var b,E=Fu(l,o);if(E==67324752){a=1,c=o,f.d=null,f.c=0;var y=ju(l,o+6),T=ju(l,o+8),w=y&2048,S=y&8,_=ju(l,o+26),C=ju(l,o+28);if(u>o+30+_+C){var x=[];f.k.unshift(x),a=2;var D=Fu(l,o+18),I=Fu(l,o+22),P=xM(l.subarray(o+30,o+=30+_),!w);D==4294967295?(b=S?[-2]:vM(l,o),D=b[0],I=b[1]):S&&(D=-1),o+=C,f.c=D;var L,F={name:P,compression:T,start:function(){if(F.ondata||At(5),!D)F.ondata(null,ec,!0);else{var V=r.o[T];V||F.ondata(At(14,"unknown compression type "+T,1),null,!1),L=D<0?new V(P):new V(P,D,I),L.ondata=function(R,v,j){F.ondata(R,v,j)};for(var B=0,k=x;B<k.length;B++){var O=k[B];L.push(O,!1)}r.k[0]==x&&r.c?r.d=L:L.push(ec,!0)}},terminate:function(){L&&L.terminate&&L.terminate()}};D>=0&&(F.size=D,F.originalSize=I),f.onfile(F)}return"break"}else if(h){if(E==134695760)return c=o+=12+(h==-2&&8),a=3,f.c=0,"break";if(E==33639248)return c=o-=4,a=3,f.c=0,"break"}},f=this;o<u-4;++o){var m=d();if(m==="break")break}if(this.p=ec,h<0){var g=a?l.subarray(0,c-12-(h==-2&&8)-(Fu(l,c-16)==134695760&&4)):l.subarray(0,o);p?p.push(g,!!a):this.k[+(a==2)].push(g)}if(a&2)return this.push(l.subarray(o),s);this.p=l.subarray(o)}s&&(this.c&&At(13),this.p=null)},e.prototype.register=function(t){this.o[t.compression]=t},e})();var BM=Object.create,yO=Object.defineProperty,kM=Object.getOwnPropertyDescriptor,MM=Object.getOwnPropertyNames,jM=Object.getPrototypeOf,FM=Object.prototype.hasOwnProperty,UM=(e=>typeof wr<"u"?wr:typeof Proxy<"u"?new Proxy(e,{get:(t,s)=>(typeof wr<"u"?wr:t)[s]}):e)(function(e){if(typeof wr<"u")return wr.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Bt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),HM=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of MM(t))!FM.call(e,i)&&i!==s&&yO(e,i,{get:()=>t[i],enumerable:!(r=kM(t,i))||r.enumerable});return e},oh=(e,t,s)=>(s=e!=null?BM(jM(e)):{},HM(t||!e||!e.__esModule?yO(s,"default",{value:e,enumerable:!0}):s,e)),_p=Bt((e,t)=>{"use strict";var s=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(A,N)=>{for(var Y in N)s(A,Y,{get:N[Y],enumerable:!0})},o=(A,N,Y,z)=>{if(N&&typeof N=="object"||typeof N=="function")for(let U of i(N))!n.call(A,U)&&U!==Y&&s(A,U,{get:()=>N[U],enumerable:!(z=r(N,U))||z.enumerable});return A},c=A=>o(s({},"__esModule",{value:!0}),A),l={};a(l,{BroadcastChannelMessageBus:()=>Be,MessageBus:()=>Oe,MessageBus2:()=>ae,MessageBusTask:()=>Pe,MessageBusTask2:()=>ie,WindowMessageBridge:()=>Ee,WorkerMessageBridge:()=>me,createBroadcastP2PStream:()=>gt,createBufferedByteBufferStream:()=>Xe,createBufferedStream:()=>je,createBufferedStringStream:()=>ke,dropP2PStream:()=>it,flowRead:()=>Ds,flowWrite:()=>as}),t.exports=c(l);var u=class{constructor(A=1.5){this.growthFactor=A,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(A){if(this.count===this.capacity){let N=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,N);let Y=new Array(N);for(let z=0;z<this.count;z++)Y[z]=this.buffer[(this.head+z)%this.capacity];this.buffer=Y,this.head=0,this.tail=this.count,this.capacity=N}this.buffer[this.tail]=A,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let A=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,A}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},h=new ArrayBuffer(8),p=new Float64Array(h),d=new Uint32Array(h),f=new Uint16Array(h),m=ArrayBuffer;try{m=self.HTMLImageElement||m}catch{}var g=typeof SharedArrayBuffer<"u";function b(A){if(typeof A!="object"||A===null||A instanceof Date||A instanceof ArrayBuffer||g&&A instanceof SharedArrayBuffer||A instanceof Blob||A instanceof FormData||A instanceof Function||A instanceof Uint8ClampedArray||A instanceof m)return A;if(Array.isArray(A))return A.map(b);{let N={};for(let Y in A)Object.hasOwnProperty.call(A,Y)&&(N[Y]=b(A[Y]));return N}}function E(A,N){return y(A,N,()=>[])}function y(A,N,Y){let z=A[N];return z!==void 0||(z=Y(N),A[N]=z),z}function T(A,N){if(Array.isArray(A)){for(let Y=0,z=A.length;Y<z;Y++)if(N(void 0,A[Y],Y)===!1)return}else{let Y=0;for(let z in A)if(A.hasOwnProperty(z)){let U=A[z];if(N(z,U,Y)===!1)return;Y++}}}var w=Object.prototype.hasOwnProperty;async function S(A,N){if(Array.isArray(A)){for(let Y=0,z=A.length;Y<z;Y++)if(await N(void 0,A[Y],Y)===!1)return}else{let Y=0;for(let z in A)if(w.call(A,z)){let U=A[z];if(await N(z,U,Y)===!1)return;Y++}}}function _(A,N,Y){return typeof A=="string"&&(/https?:/.test(A)||(A=location.origin+A)),Promise.race([fetch(A,N),new Promise((z,U)=>setTimeout(U,Y))])}function C(A,N){let Y=0,z=0;return(...U)=>{let Z=++Y;setTimeout(()=>{let J=performance.now();if(Z===Y||J-z>=A){try{N(...U)}catch(ne){console.log(ne)}z=J}},Math.max(0,A-(performance.now()-z)))}}function x(A,N){let Y=A.length,z=0;for(;z<Y;){let U=A.indexOf(`
`,z);U<0&&(U=Y);let Z=A.substring(z,U);try{if(N(Z)===!1)return}catch(J){console.error(J)}z=U+1}}function D(A){let N=null;return()=>(N===null&&(N=A()),N)}var I=0;function P(){I===0&&(I=Date.now()-performance.now());let A=new Array,N=I+performance.now();p[0]=N,A.push(d[1].toString(16)),p[0]=Math.random(),A.push(f[3].toString(16));let Y=f[2].toString(16);A.push("4"+Y.substr(0,3)),p[0]=N;let z=d[0].toString(16)+d[1].toString(16);return A.push("0"+z.substr(0,3)),A.push(z.substr(3)),A.join("-")}var L=class{constructor(A){this.maxResources=A,this.idle=new u,this.isClosed=!1,this.resources=A}acquire(A){this.isClosed?Promise.resolve(!1).then(A):this.resources>0?(this.resources--,Promise.resolve(!0).then(A)):this.idle.enqueue(A)}acquireSync(){return new Promise(A=>{this.acquire(A)})}release(){if(!this.isClosed){let A=this.idle.dequeue();A?Promise.resolve(!0).then(A):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let A=this.idle.dequeue();Promise.resolve(!1).then(A)}}};function F(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function V(A,N,Y){let z=A.length+N-1;for(let U=0;U<z;U++){let Z=new Array;for(let J=U-N+1;J<=U;J++)Z.push(A[J]);if(Y(Z)===!1)break}}function B(){let A=new Date,N=A.getFullYear(),Y=A.getMonth()+1,z=A.getDate(),U=A.getHours(),Z=A.getMinutes(),J=A.getSeconds(),ne=A.getMilliseconds();return"["+N+"-"+(Y<10?"0"+Y:Y)+"-"+(z<10?"0"+z:z)+" "+(U<10?"0"+U:U)+":"+(Z<10?"0"+Z:Z)+":"+(J<10?"0"+J:J)+"."+(ne<100?ne<10?"00"+ne:"0"+ne:ne)+"] "}function k(A){return new Promise(N=>setTimeout(N,A))}function O(A,N){let Y=0,z=A.length;for(let U=0;U<z;U++)A[U]===N&&(A.splice(U,1),U--,z--,Y++);return Y}var R=F(),v=R.WeakRef||(A=>A);function j(A){if(A!=null){if(typeof A=="object")return new v(A);console.error(A,A instanceof Object,typeof A);return}}function M(A){return A==null?void 0:A.deref()}var H="_MSG_BUS_RPC_",q=300*1e3,Q=(A=>(A.PUBLISH="publish",A.SUBSCRIBE="subscribe",A.PUSH="push",A.PULL="pull",A))(Q||{}),oe=class{constructor(A){this.bus=A}processRemoteMessage(A,N){let Y=j(N),z=A.topic,U=A.type,Z=A.message;switch(U){case"pull":this.bus.pull(z,J=>{this.push(z,J,M(Y))});break;case"subscribe":this.bus.subscribe(z,J=>{this.publish(z,J,M(Y))});break;case"publish":this.bus.publish(z,Z,this,M(Y));break;case"push":this.bus.push(z,Z,this,M(Y));break;default:console.debug("unknown message type "+U)}}rpcCall(A,N,Y,z=q){let U=j(Y),Z=new Promise(J=>{let ne=this.bus.uniqueRpcTopic(A);this.publish(A,{message:N,reply:ne},M(U)),this.bus.pull(ne,(ue,Ie,Ue)=>{J({message:ue,bridge:Ie,source:j(Ue)})})});return z>0?Promise.race([Z,new Promise((J,ne)=>{setTimeout(ne,z)})]):Z}},me=class extends oe{constructor(A,N){super(A),this.worker=N,N.onmessage=Y=>{this.processRemoteMessage(Y.data,void 0)}}publish(A,N){this.postMessage(A,"publish",N)}subscribe(A){this.postMessage(A,"subscribe",null)}push(A,N){this.postMessage(A,"push",N)}pull(A){this.postMessage(A,"pull",null)}rpcCall(A,N,Y=q){return super.rpcCall(A,N,void 0,Y)}postMessage(A,N,Y){let z={topic:A,type:N,message:Y};this.worker.postMessage(z)}discard(){this.worker.terminate()}},Ee=class extends oe{constructor(A){super(A),window.addEventListener("message",N=>{this.processRemoteMessage(N.data,N.source)},!1)}publish(A,N,Y){this.postMessage(A,"publish",N,Y)}subscribe(A,N){if(N===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(A,"subscribe",null,N)}push(A,N,Y){this.postMessage(A,"push",N,Y)}pull(A,N){if(N===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(A,"pull",null,N)}postMessage(A,N,Y,z){let U={topic:A,type:N,message:Y};z&&z.postMessage(U,"*")}},Pe=class{constructor(A){this.isRunning=!0,this.callback=A}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(A,N,Y,z){try{A=z?A:b(A),this.callback(A,N,Y)}catch(U){console.error(U)}}},Oe=class{constructor(A=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=A}uniqueRpcTopic(A){return`${H}-${A}-${this.uuid}-${this.rpcTicket++}`}publish(A,N,Y,z){let U=this.subscribed[A];if(U){let Z;for(let J of U)J.running()?J.execute(N,Y,z,this.unsafe):(Z=Z||new Array,Z.push(J));if(Z)for(let J of Z)O(U,J)}else console.debug("no sub on topic: "+A)}subscribe(A,N){let Y=new Pe(N);return E(this.subscribed,A).push(Y),Y}push(A,N,Y,z){let U=!1,Z=this.pulled[A];if(Z){for(;Z.length>0;){let J=Z.shift();if(J.running()){J.execute(N,Y,z,this.unsafe),U=!0;break}}Z.length===0&&delete this.pulled[A]}U||E(this.pushed,A).push({message:N,bridge:Y,source:j(z)})}pull(A,N){let Y=new Pe(N),z=this.pushed[A];if(z){let U=z.shift();Y.execute(U.message,U.bridge,M(U.source),this.unsafe),z.length===0&&delete this.pushed[A]}else E(this.pulled,A).push(Y);return Y}pullA(A){return new Promise(N=>{this.pull(A,(Y,z,U)=>{N({message:Y,bridge:z,source:j(U)})})})}rpcService(A,N){this.subscribe(A,(Y,z,U)=>{let{message:Z,reply:J}=Y;try{let ne=N(Z);if(ne instanceof Promise){let ue=j(U);ne.then(Ie=>{this.rpcReply(Ie,J,z,M(ue))},Ie=>{console.error(Ie),this.rpcReply(void 0,J,z,M(ue))})}else this.rpcReply(ne,J,z,U)}catch(ne){console.error(ne),this.rpcReply(void 0,J,z,U)}})}rpcCall(A,N,Y=q){let z=new Promise(U=>{let Z=this.uniqueRpcTopic(A);this.publish(A,{message:N,reply:Z}),this.pull(Z,(J,ne,ue)=>{U({message:J,bridge:ne,source:j(ue)})})});return Y>0?Promise.race([z,new Promise((U,Z)=>{setTimeout(Z,Y)})]):z}rpcReply(A,N,Y,z){Y?Y.push(N,A,z):this.push(N,A)}},Fe="_MSG_BUS_RPC_";function G(A,N){let Y=0,z=A.length;for(let U=0;U<z;U++)A[U]===N&&(A.splice(U,1),U--,z--,Y++);return Y}function pe(A,N){return ge(A,N,()=>[])}function ge(A,N,Y){let z=A[N];return z!==void 0||(z=Y(N),A[N]=z),z}var ie=class{constructor(A,N){this.callback=A,this.unsafe=N,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(A){try{A=this.unsafe?A:b(A),this.callback(A)}catch(N){console.error(N)}}},$=class{constructor(A=crypto.randomUUID()){this.uuid=A,this.rpcTicket=0}subscribeOnce(A,N){let Y=this.subscribe(A,z=>{Y.cancel(),N(z)});return Y}pullA(A){return new Promise(N=>{this.pull(A,N)})}rpcService(A,N){let Y=z=>{try{let{message:U,replyTopic:Z}=z;try{let J=N(U);J instanceof Promise?J.then(ne=>{this.publish(Z,{success:!0,result:ne})}).catch(ne=>{console.error(ne),this.publish(Z,{success:!1,err:String(ne)})}):this.publish(Z,{success:!0,result:J})}catch(J){this.publish(Z,{success:!1,err:String(J)})}}finally{this.pull(A,Y)}};this.pull(A,Y)}rpcCall(A,N,Y=0){let z=new Promise((U,Z)=>{let J=`${Fe}-${A}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(J,ne=>{ne.success?U(ne.result):Z(new Error(ne.err))}),this.push(A,{message:N,replyTopic:J})});return Y>0?Promise.race([z,new Promise((U,Z)=>{setTimeout(Z,Y)})]):z}},ae=class extends ${constructor(A=!1){super(),this.unsafe=A,this.subscribed={},this.pulled={},this.pushed={}}publish(A,N){let Y=this.subscribed[A];if(Y){let z;for(let U of Y)U.running()?U.execute(N):(z=z||new Array,z.push(U));if(z)for(let U of z)G(Y,U)}}subscribe(A,N){let Y=new ie(N,this.unsafe);return pe(this.subscribed,A).push(Y),Y}push(A,N){let Y=!1,z=this.pulled[A];if(z){for(;z.length>0;){let U=z.shift();if(U&&U.running()){U.execute(N),Y=!0;break}}z.length===0&&delete this.pulled[A]}Y||pe(this.pushed,A).push(N)}pull(A,N){let Y=new ie(N,this.unsafe);return this.repull(A,Y),Y}repull(A,N){let Y=this.pushed[A];if(Y){let z=Y.shift();z&&(N.execute(z),Y.length===0&&delete this.pushed[A])}else pe(this.pulled,A).push(N)}},ye=class extends ${constructor(A=crypto.randomUUID()){super(A),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(A,N){console.debug("BC",this.uuid,"PUBLISH",A,N),this.broadcastPublish(A,N)}subscribe(A,N){console.debug("BC",this.uuid,"SUBSCRIBE",A);let Y=new ie(N,!0);return pe(this.subscribed,A).push(Y),Y}push(A,N){let Y=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",A,`(${Y})`,N),pe(this.pushed,A).push({id:Y,message:N}),this.broadcastPushedHeadMessage(A)}pull(A,N){console.debug("BC",this.uuid,"PULL",A);let Y=new ie(N,!0);return pe(this.pulled,A).push(Y),this.broadcastWhoHas(A),Y}broadcastPushedHeadMessage(A){let N=this.pushed[A];N&&N[0]&&this.broadcastIHave(A,N[0].id)}onReceivedPublish(A,N,Y){console.debug("BCMSG(",this.uuid,")","from",A,"PUBLISH",N,"message",Y);let z=this.subscribed[N];if(z){let U;for(let Z of z)Z.running()?Z.execute(Y):(U=U||new Array,U.push(Z));if(U)for(let Z of U)G(z,Z);z.length===0&&delete this.subscribed[N]}}onReceivedWhoHas(A,N){console.debug("BCMSG(",this.uuid,")","from",A,"WHOHAS",N),this.broadcastPushedHeadMessage(N)}onReceivedIHave(A,N,Y){console.debug("BCMSG(",this.uuid,")","from",A,"IHAVE",N,"id",Y);let z=this.pulled[N];if(z){let U;for(let Z of z)if(Z.running()){this.broadcastINeed(N,A,Y);break}else U=U||new Array,U.push(Z);if(U)for(let Z of U)G(z,Z);z.length===0&&delete this.pulled[N]}}onReceivedINeed(A,N,Y,z){if(console.debug("BCMSG(",this.uuid,")","from",A,"INEED",N,"source",Y,"id",z),this.uuid===Y){let U=this.pushed[N];if(U&&U[0]&&U[0].id===z){let{message:Z}=U.shift();this.broadcastIGive(N,z,A,Z),this.broadcastPushedHeadMessage(N),U.length===0&&delete this.pushed[N]}}}onReceivedIGive(A,N,Y,z,U){console.debug("BCMSG(",this.uuid,")","from",A,"IGIVE",N,"id",Y,"target",z,"message",U);let Z=this.pulled[N];if(Z&&this.uuid===z){let J=!1;for(;Z.length>0;){let ne=Z.shift();if(ne.running()){ne.execute(U),J=!0;break}}J||this.push(N,U),Z.length===0&&delete this.pulled[N]}}},Be=class extends ye{constructor(A,N=crypto.randomUUID()){super(N),this.bc=new BroadcastChannel(A),this.bc.onmessage=Y=>{this.onMessage(Y.data)}}onMessage(A){let{type:N,uuid:Y,topic:z}=A;switch(N){case"PUBLISH":{let{message:U}=A;this.onReceivedPublish(Y,z,U);break}case"WHOHAS":{this.onReceivedWhoHas(Y,z);break}case"IHAVE":{let{id:U}=A;this.onReceivedIHave(Y,z,U);break}case"INEED":{let{source:U,id:Z}=A;this.onReceivedINeed(Y,z,U,Z);break}case"IGIVE":{let{target:U,id:Z,message:J}=A;this.onReceivedIGive(Y,z,Z,U,J);break}default:console.warn("unsupported",A)}}broadcastPublish(A,N){this.post({type:"PUBLISH",uuid:this.uuid,topic:A,message:N})}broadcastWhoHas(A){this.post({type:"WHOHAS",uuid:this.uuid,topic:A})}broadcastIHave(A,N){this.post({type:"IHAVE",uuid:this.uuid,topic:A,id:N})}broadcastINeed(A,N,Y){this.post({type:"INEED",uuid:this.uuid,topic:A,source:N,id:Y})}broadcastIGive(A,N,Y,z){this.post({type:"IGIVE",uuid:this.uuid,topic:A,id:N,target:Y,message:z})}post(A){this.bc.postMessage(A),Promise.resolve().then(()=>{this.onMessage(A)})}},be=Symbol("BLOCKING_QUEUE_RESET"),xe=class{constructor(A,N=()=>1){if(this.maxSize=A,this.itemSizeOf=N,this.queue=new u,this.waitingConsumers=new u,this.waitingProducers=new u,this.queueSize=0,this.closePromise=null,this.closeResolve=null,A<=0)throw new Error("Max size must be greater than 0")}enqueue(A){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let N=await new Promise(Y=>{this.waitingProducers.enqueue(Y)});return console.debug("queue is not full",this.size(),N),N?(this.innerEnqueue(A),!0):!1})():(this.innerEnqueue(A),!0)}innerEnqueue(A){if(this.waitingConsumers.isEmpty())this.queue.enqueue(A),this.queueSize+=this.itemSizeOf(A),console.debug("queue pushed",A,"size",this.queueSize);else{let N=this.waitingConsumers.dequeue();Promise.resolve(A).then(N),console.debug("queue direct",A,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let A=this.waitingConsumers.dequeue();Promise.resolve(be).then(A)}return setTimeout(()=>this.closeResolve(),0),be}else return new Promise(A=>{this.waitingConsumers.enqueue(A)});else{let A=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(A),!this.waitingProducers.isEmpty()){let N=this.waitingProducers.dequeue();Promise.resolve(!0).then(N)}return A}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(A=>{for(this.closeResolve=A;!this.waitingProducers.isEmpty();){let N=this.waitingProducers.dequeue();Promise.resolve(!1).then(N)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let N=this.waitingConsumers.dequeue();Promise.resolve(be).then(N)}A()}})),this.closePromise}};function je(A,N,Y=Number.MAX_SAFE_INTEGER){let z=new xe(Y,N),U=new ReadableStream({pull(J){let ne=!0,ue=(async()=>{let Ie=new Array;do{let Ue=z.dequeue();if(Ue instanceof Promise){ne=!1;let Ye=await Ue;Ye===be?J.close():Ie.push(Ye)}else{let Ye=Ue;Ye===be?J.close():Ie.push(Ye)}}while(z.size()>0);if(Ie.length>0){let Ue=A(Ie);J.enqueue(Ue)}})();if(!ne)return console.debug("read stream stucked --------------------------------------"),ue},async cancel(){console.debug("buffered readable cancel"),await z.close()}}),Z=new WritableStream({write(J,ne){let ue=!0,Ie=(async()=>{let Ue=z.enqueue(J);typeof Ue=="boolean"?Ue||ne.error(new Error("Write stream closed")):(ue=!1,await Ue||ne.error(new Error("Write stream closed")))})();if(!ue)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),Ie},async close(){console.debug("buffered writable closing",z.size()),await z.close(),console.debug("buffered writable closed",z.size())},async abort(){console.debug("buffered writable aborting",z.size()),await z.close(),console.debug("buffered writable aborted",z.size())}});return{readable:U,writable:Z}}function ke(A=Number.MAX_SAFE_INTEGER){return je(N=>N.join(""),N=>N.length,A)}function Xe(A=Number.MAX_SAFE_INTEGER){return je(N=>{let Y=new Uint8Array(N.reduce((U,Z)=>U+Z.byteLength,0)),z=0;return N.forEach(U=>{Y.set(U,z),z+=U.byteLength}),Y},N=>N.byteLength,A)}function gt(A){return new Promise((N,Y)=>{let z=new BroadcastChannel(A),U=new xe(1),Z=new L(1),J=null,ne=!1,ue=!1,Ie=!1;z.onmessage=Ue=>{let Ye=Ue.data,{type:Qe}=Ye;if(console.debug("p2p",A,"type",Qe,"data",Qe==="DATA"&&Ye.data),Qe==="DATA")U.enqueue(Ye.data);else if(Qe==="HI"){if(!J){z.postMessage({type:"HI"});let Yr=0;J={rs:new ReadableStream({async pull(Or){let Ir=await U.dequeue();Ir===be?(await ar(),Or.close()):(Or.enqueue(Ir),z.postMessage({type:"ACK"}))},cancel(){return ar()}}),ws:new WritableStream({async write(Or,Ir){await Z.acquireSync()?z.postMessage({type:"DATA",id:Yr++,data:Or}):(ws(),Ir.error(new Error("Write stream closed")))},close(){ws()},abort(){ws()}})},N(J)}}else Qe==="REND"?J?Z.close():yi("REND1"):Qe==="WEND"?J?U.close():yi("WEND1"):Qe==="ACK"&&Z.release();function ws(){ne||(ne=!0,console.debug(A,"p2p write stream closed"),Z.close(),z.postMessage({type:"WEND"}),ue&&(console.debug(A,"p2p channel closed on ws"),z.close()))}async function ar(){ue||(ue=!0,console.debug(A,"p2p read stream closed"),z.postMessage({type:"REND"}),await U.close(),ne&&(console.debug(A,"p2p channel closed on rs"),z.close()))}async function yi(Yr){Ie||(Ie=!0,console.debug(A,"p2p channel connection released on",Yr),Z.close(),U.close(),J?(J.rs.locked||(console.debug(A,"p2p unlocked read stream direct cancel"),J.rs.cancel()),J.ws.locked||(console.debug(A,"p2p unlocked write stream direct close"),J.ws.close())):(z.postMessage({type:"HI"}),z.close()),Y(new Error("p2p channel connection released")))}},z.postMessage({type:"HI"})})}function it(A){return new Promise(N=>{let Y=new BroadcastChannel(A);Y.onmessage=z=>{let U=z.data,{type:Z}=U;Z==="HI"&&(Y.postMessage({type:"REND"}),Y.close(),N())},Y.postMessage({type:"REND"})})}async function Ve(A){try{return await gt(A)}catch(N){N.message!=="p2p channel connection released"&&console.error(N)}}async function as(A,N,Y=10*1024*1024,z=!0){let U=await Ve(A);if(!U)return!1;let Z=!1;try{let J,ne=ue=>{if(!J)if(!z)J=U.ws.getWriter();else if(typeof ue=="string"){let Ie=ke(Y);Ie.readable.pipeTo(U.ws),J=Ie.writable.getWriter()}else{let Ie=Xe(Y);Ie.readable.pipeTo(U.ws),J=Ie.writable.getWriter()}return J.write(ue)};if(Array.isArray(N))for(let ue of N)await ne(ue);else await N({write:ne,get desiredSize(){return((J==null?void 0:J.desiredSize)||0)+10}});J&&await J.close(),Z=!0}catch(J){console.error(J)}finally{return U.rs.cancel(),Z}}async function Ds(A,N){var z,U;let Y=await Ve(A);if(Y)try{let Z=Y.rs.getReader();for((z=N.start)==null?void 0:z.call(N);;){let{value:J,done:ne}=await Z.read();if(J!==void 0){let ue;if(N.update instanceof Promise?ue=await N.update(J):ue=N.update(J),ue){await Z.cancel();break}}if(ne){(U=N.end)==null||U.call(N);break}}}catch(Z){console.error(Z)}finally{Y.ws.close()}}}),GM=Bt(()=>{}),$t=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r():typeof define=="function"&&define.amd?define([],r):s.CryptoJS=r()})(e,function(){var s=s||(function(r,i){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto),!n&&typeof UM=="function")try{n=GM()}catch{}var a=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||(function(){function y(){}return function(T){var w;return y.prototype=T,w=new y,y.prototype=null,w}})(),c={},l=c.lib={},u=l.Base=(function(){return{extend:function(y){var T=o(this);return y&&T.mixIn(y),(!T.hasOwnProperty("init")||this.init===T.init)&&(T.init=function(){T.$super.init.apply(this,arguments)}),T.init.prototype=T,T.$super=this,T},create:function(){var y=this.extend();return y.init.apply(y,arguments),y},init:function(){},mixIn:function(y){for(var T in y)y.hasOwnProperty(T)&&(this[T]=y[T]);y.hasOwnProperty("toString")&&(this.toString=y.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),h=l.WordArray=u.extend({init:function(y,T){y=this.words=y||[],T!=i?this.sigBytes=T:this.sigBytes=y.length*4},toString:function(y){return(y||d).stringify(this)},concat:function(y){var T=this.words,w=y.words,S=this.sigBytes,_=y.sigBytes;if(this.clamp(),S%4)for(var C=0;C<_;C++){var x=w[C>>>2]>>>24-C%4*8&255;T[S+C>>>2]|=x<<24-(S+C)%4*8}else for(var D=0;D<_;D+=4)T[S+D>>>2]=w[D>>>2];return this.sigBytes+=_,this},clamp:function(){var y=this.words,T=this.sigBytes;y[T>>>2]&=4294967295<<32-T%4*8,y.length=r.ceil(T/4)},clone:function(){var y=u.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var T=[],w=0;w<y;w+=4)T.push(a());return new h.init(T,y)}}),p=c.enc={},d=p.Hex={stringify:function(y){for(var T=y.words,w=y.sigBytes,S=[],_=0;_<w;_++){var C=T[_>>>2]>>>24-_%4*8&255;S.push((C>>>4).toString(16)),S.push((C&15).toString(16))}return S.join("")},parse:function(y){for(var T=y.length,w=[],S=0;S<T;S+=2)w[S>>>3]|=parseInt(y.substr(S,2),16)<<24-S%8*4;return new h.init(w,T/2)}},f=p.Latin1={stringify:function(y){for(var T=y.words,w=y.sigBytes,S=[],_=0;_<w;_++){var C=T[_>>>2]>>>24-_%4*8&255;S.push(String.fromCharCode(C))}return S.join("")},parse:function(y){for(var T=y.length,w=[],S=0;S<T;S++)w[S>>>2]|=(y.charCodeAt(S)&255)<<24-S%4*8;return new h.init(w,T)}},m=p.Utf8={stringify:function(y){try{return decodeURIComponent(escape(f.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return f.parse(unescape(encodeURIComponent(y)))}},g=l.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(y){typeof y=="string"&&(y=m.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var T,w=this._data,S=w.words,_=w.sigBytes,C=this.blockSize,x=C*4,D=_/x;y?D=r.ceil(D):D=r.max((D|0)-this._minBufferSize,0);var I=D*C,P=r.min(I*4,_);if(I){for(var L=0;L<I;L+=C)this._doProcessBlock(S,L);T=S.splice(0,I),w.sigBytes-=P}return new h.init(T,P)},clone:function(){var y=u.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0}),b=l.Hasher=g.extend({cfg:u.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){y&&this._append(y);var T=this._doFinalize();return T},blockSize:512/32,_createHelper:function(y){return function(T,w){return new y.init(w).finalize(T)}},_createHmacHelper:function(y){return function(T,w){return new E.HMAC.init(y,w).finalize(T)}}}),E=c.algo={};return c})(Math);return s})}),Qy=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.Base,o=n.WordArray,c=i.x64={},l=c.Word=a.extend({init:function(h,p){this.high=h,this.low=p}}),u=c.WordArray=a.extend({init:function(h,p){h=this.words=h||[],p!=r?this.sigBytes=p:this.sigBytes=h.length*8},toX32:function(){for(var h=this.words,p=h.length,d=[],f=0;f<p;f++){var m=h[f];d.push(m.high),d.push(m.low)}return o.create(d,this.sigBytes)},clone:function(){for(var h=a.clone.call(this),p=h.words=this.words.slice(0),d=p.length,f=0;f<d;f++)p[f]=p[f].clone();return h}})})(),s})}),YM=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){if(typeof ArrayBuffer=="function"){var r=s,i=r.lib,n=i.WordArray,a=n.init,o=n.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var l=c.byteLength,u=[],h=0;h<l;h++)u[h>>>2]|=c[h]<<24-h%4*8;a.call(this,u,l)}else a.apply(this,arguments)};o.prototype=n}})(),s.lib.WordArray})}),VM=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.enc,o=a.Utf16=a.Utf16BE={stringify:function(l){for(var u=l.words,h=l.sigBytes,p=[],d=0;d<h;d+=2){var f=u[d>>>2]>>>16-d%4*8&65535;p.push(String.fromCharCode(f))}return p.join("")},parse:function(l){for(var u=l.length,h=[],p=0;p<u;p++)h[p>>>1]|=l.charCodeAt(p)<<16-p%2*16;return n.create(h,u*2)}};a.Utf16LE={stringify:function(l){for(var u=l.words,h=l.sigBytes,p=[],d=0;d<h;d+=2){var f=c(u[d>>>2]>>>16-d%4*8&65535);p.push(String.fromCharCode(f))}return p.join("")},parse:function(l){for(var u=l.length,h=[],p=0;p<u;p++)h[p>>>1]|=c(l.charCodeAt(p)<<16-p%2*16);return n.create(h,u*2)}};function c(l){return l<<8&4278255360|l>>>8&16711935}})(),s.enc.Utf16})}),cl=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.enc,o=a.Base64={stringify:function(l){var u=l.words,h=l.sigBytes,p=this._map;l.clamp();for(var d=[],f=0;f<h;f+=3)for(var m=u[f>>>2]>>>24-f%4*8&255,g=u[f+1>>>2]>>>24-(f+1)%4*8&255,b=u[f+2>>>2]>>>24-(f+2)%4*8&255,E=m<<16|g<<8|b,y=0;y<4&&f+y*.75<h;y++)d.push(p.charAt(E>>>6*(3-y)&63));var T=p.charAt(64);if(T)for(;d.length%4;)d.push(T);return d.join("")},parse:function(l){var u=l.length,h=this._map,p=this._reverseMap;if(!p){p=this._reverseMap=[];for(var d=0;d<h.length;d++)p[h.charCodeAt(d)]=d}var f=h.charAt(64);if(f){var m=l.indexOf(f);m!==-1&&(u=m)}return c(l,u,p)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function c(l,u,h){for(var p=[],d=0,f=0;f<u;f++)if(f%4){var m=h[l.charCodeAt(f-1)]<<f%4*2,g=h[l.charCodeAt(f)]>>>6-f%4*2,b=m|g;p[d>>>2]|=b<<24-d%4*8,d++}return n.create(p,d)}})(),s.enc.Base64})}),zM=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.enc,o=a.Base64url={stringify:function(l,u){u===void 0&&(u=!0);var h=l.words,p=l.sigBytes,d=u?this._safe_map:this._map;l.clamp();for(var f=[],m=0;m<p;m+=3)for(var g=h[m>>>2]>>>24-m%4*8&255,b=h[m+1>>>2]>>>24-(m+1)%4*8&255,E=h[m+2>>>2]>>>24-(m+2)%4*8&255,y=g<<16|b<<8|E,T=0;T<4&&m+T*.75<p;T++)f.push(d.charAt(y>>>6*(3-T)&63));var w=d.charAt(64);if(w)for(;f.length%4;)f.push(w);return f.join("")},parse:function(l,u){u===void 0&&(u=!0);var h=l.length,p=u?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var f=0;f<p.length;f++)d[p.charCodeAt(f)]=f}var m=p.charAt(64);if(m){var g=l.indexOf(m);g!==-1&&(h=g)}return c(l,h,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function c(l,u,h){for(var p=[],d=0,f=0;f<u;f++)if(f%4){var m=h[l.charCodeAt(f-1)]<<f%4*2,g=h[l.charCodeAt(f)]>>>6-f%4*2,b=m|g;p[d>>>2]|=b<<24-d%4*8,d++}return n.create(p,d)}})(),s.enc.Base64url})}),ll=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.algo,l=[];(function(){for(var m=0;m<64;m++)l[m]=r.abs(r.sin(m+1))*4294967296|0})();var u=c.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,g){for(var b=0;b<16;b++){var E=g+b,y=m[E];m[E]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}var T=this._hash.words,w=m[g+0],S=m[g+1],_=m[g+2],C=m[g+3],x=m[g+4],D=m[g+5],I=m[g+6],P=m[g+7],L=m[g+8],F=m[g+9],V=m[g+10],B=m[g+11],k=m[g+12],O=m[g+13],R=m[g+14],v=m[g+15],j=T[0],M=T[1],H=T[2],q=T[3];j=h(j,M,H,q,w,7,l[0]),q=h(q,j,M,H,S,12,l[1]),H=h(H,q,j,M,_,17,l[2]),M=h(M,H,q,j,C,22,l[3]),j=h(j,M,H,q,x,7,l[4]),q=h(q,j,M,H,D,12,l[5]),H=h(H,q,j,M,I,17,l[6]),M=h(M,H,q,j,P,22,l[7]),j=h(j,M,H,q,L,7,l[8]),q=h(q,j,M,H,F,12,l[9]),H=h(H,q,j,M,V,17,l[10]),M=h(M,H,q,j,B,22,l[11]),j=h(j,M,H,q,k,7,l[12]),q=h(q,j,M,H,O,12,l[13]),H=h(H,q,j,M,R,17,l[14]),M=h(M,H,q,j,v,22,l[15]),j=p(j,M,H,q,S,5,l[16]),q=p(q,j,M,H,I,9,l[17]),H=p(H,q,j,M,B,14,l[18]),M=p(M,H,q,j,w,20,l[19]),j=p(j,M,H,q,D,5,l[20]),q=p(q,j,M,H,V,9,l[21]),H=p(H,q,j,M,v,14,l[22]),M=p(M,H,q,j,x,20,l[23]),j=p(j,M,H,q,F,5,l[24]),q=p(q,j,M,H,R,9,l[25]),H=p(H,q,j,M,C,14,l[26]),M=p(M,H,q,j,L,20,l[27]),j=p(j,M,H,q,O,5,l[28]),q=p(q,j,M,H,_,9,l[29]),H=p(H,q,j,M,P,14,l[30]),M=p(M,H,q,j,k,20,l[31]),j=d(j,M,H,q,D,4,l[32]),q=d(q,j,M,H,L,11,l[33]),H=d(H,q,j,M,B,16,l[34]),M=d(M,H,q,j,R,23,l[35]),j=d(j,M,H,q,S,4,l[36]),q=d(q,j,M,H,x,11,l[37]),H=d(H,q,j,M,P,16,l[38]),M=d(M,H,q,j,V,23,l[39]),j=d(j,M,H,q,O,4,l[40]),q=d(q,j,M,H,w,11,l[41]),H=d(H,q,j,M,C,16,l[42]),M=d(M,H,q,j,I,23,l[43]),j=d(j,M,H,q,F,4,l[44]),q=d(q,j,M,H,k,11,l[45]),H=d(H,q,j,M,v,16,l[46]),M=d(M,H,q,j,_,23,l[47]),j=f(j,M,H,q,w,6,l[48]),q=f(q,j,M,H,P,10,l[49]),H=f(H,q,j,M,R,15,l[50]),M=f(M,H,q,j,D,21,l[51]),j=f(j,M,H,q,k,6,l[52]),q=f(q,j,M,H,C,10,l[53]),H=f(H,q,j,M,V,15,l[54]),M=f(M,H,q,j,S,21,l[55]),j=f(j,M,H,q,L,6,l[56]),q=f(q,j,M,H,v,10,l[57]),H=f(H,q,j,M,I,15,l[58]),M=f(M,H,q,j,O,21,l[59]),j=f(j,M,H,q,x,6,l[60]),q=f(q,j,M,H,B,10,l[61]),H=f(H,q,j,M,_,15,l[62]),M=f(M,H,q,j,F,21,l[63]),T[0]=T[0]+j|0,T[1]=T[1]+M|0,T[2]=T[2]+H|0,T[3]=T[3]+q|0},_doFinalize:function(){var m=this._data,g=m.words,b=this._nDataBytes*8,E=m.sigBytes*8;g[E>>>5]|=128<<24-E%32;var y=r.floor(b/4294967296),T=b;g[(E+64>>>9<<4)+15]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,g[(E+64>>>9<<4)+14]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360,m.sigBytes=(g.length+1)*4,this._process();for(var w=this._hash,S=w.words,_=0;_<4;_++){var C=S[_];S[_]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}return w},clone:function(){var m=o.clone.call(this);return m._hash=this._hash.clone(),m}});function h(m,g,b,E,y,T,w){var S=m+(g&b|~g&E)+y+w;return(S<<T|S>>>32-T)+g}function p(m,g,b,E,y,T,w){var S=m+(g&E|b&~E)+y+w;return(S<<T|S>>>32-T)+g}function d(m,g,b,E,y,T,w){var S=m+(g^b^E)+y+w;return(S<<T|S>>>32-T)+g}function f(m,g,b,E,y,T,w){var S=m+(b^(g|~E))+y+w;return(S<<T|S>>>32-T)+g}i.MD5=o._createHelper(u),i.HmacMD5=o._createHmacHelper(u)})(Math),s.MD5})}),EO=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=i.Hasher,o=r.algo,c=[],l=o.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,h){for(var p=this._hash.words,d=p[0],f=p[1],m=p[2],g=p[3],b=p[4],E=0;E<80;E++){if(E<16)c[E]=u[h+E]|0;else{var y=c[E-3]^c[E-8]^c[E-14]^c[E-16];c[E]=y<<1|y>>>31}var T=(d<<5|d>>>27)+b+c[E];E<20?T+=(f&m|~f&g)+1518500249:E<40?T+=(f^m^g)+1859775393:E<60?T+=(f&m|f&g|m&g)-1894007588:T+=(f^m^g)-899497514,b=g,g=m,m=f<<30|f>>>2,f=d,d=T}p[0]=p[0]+d|0,p[1]=p[1]+f|0,p[2]=p[2]+m|0,p[3]=p[3]+g|0,p[4]=p[4]+b|0},_doFinalize:function(){var u=this._data,h=u.words,p=this._nDataBytes*8,d=u.sigBytes*8;return h[d>>>5]|=128<<24-d%32,h[(d+64>>>9<<4)+14]=Math.floor(p/4294967296),h[(d+64>>>9<<4)+15]=p,u.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var u=a.clone.call(this);return u._hash=this._hash.clone(),u}});r.SHA1=a._createHelper(l),r.HmacSHA1=a._createHmacHelper(l)})(),s.SHA1})}),NT=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.algo,l=[],u=[];(function(){function d(b){for(var E=r.sqrt(b),y=2;y<=E;y++)if(!(b%y))return!1;return!0}function f(b){return(b-(b|0))*4294967296|0}for(var m=2,g=0;g<64;)d(m)&&(g<8&&(l[g]=f(r.pow(m,1/2))),u[g]=f(r.pow(m,1/3)),g++),m++})();var h=[],p=c.SHA256=o.extend({_doReset:function(){this._hash=new a.init(l.slice(0))},_doProcessBlock:function(d,f){for(var m=this._hash.words,g=m[0],b=m[1],E=m[2],y=m[3],T=m[4],w=m[5],S=m[6],_=m[7],C=0;C<64;C++){if(C<16)h[C]=d[f+C]|0;else{var x=h[C-15],D=(x<<25|x>>>7)^(x<<14|x>>>18)^x>>>3,I=h[C-2],P=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;h[C]=D+h[C-7]+P+h[C-16]}var L=T&w^~T&S,F=g&b^g&E^b&E,V=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),B=(T<<26|T>>>6)^(T<<21|T>>>11)^(T<<7|T>>>25),k=_+B+L+u[C]+h[C],O=V+F;_=S,S=w,w=T,T=y+k|0,y=E,E=b,b=g,g=k+O|0}m[0]=m[0]+g|0,m[1]=m[1]+b|0,m[2]=m[2]+E|0,m[3]=m[3]+y|0,m[4]=m[4]+T|0,m[5]=m[5]+w|0,m[6]=m[6]+S|0,m[7]=m[7]+_|0},_doFinalize:function(){var d=this._data,f=d.words,m=this._nDataBytes*8,g=d.sigBytes*8;return f[g>>>5]|=128<<24-g%32,f[(g+64>>>9<<4)+14]=r.floor(m/4294967296),f[(g+64>>>9<<4)+15]=m,d.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var d=o.clone.call(this);return d._hash=this._hash.clone(),d}});i.SHA256=o._createHelper(p),i.HmacSHA256=o._createHmacHelper(p)})(Math),s.SHA256})}),WM=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),NT()):typeof define=="function"&&define.amd?define(["./core","./sha256"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=r.algo,o=a.SHA256,c=a.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var l=o._doFinalize.call(this);return l.sigBytes-=4,l}});r.SHA224=o._createHelper(c),r.HmacSHA224=o._createHmacHelper(c)})(),s.SHA224})}),bO=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Qy()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.Hasher,a=r.x64,o=a.Word,c=a.WordArray,l=r.algo;function u(){return o.create.apply(o,arguments)}var h=[u(1116352408,3609767458),u(1899447441,602891725),u(3049323471,3964484399),u(3921009573,2173295548),u(961987163,4081628472),u(1508970993,3053834265),u(2453635748,2937671579),u(2870763221,3664609560),u(3624381080,2734883394),u(310598401,1164996542),u(607225278,1323610764),u(1426881987,3590304994),u(1925078388,4068182383),u(2162078206,991336113),u(2614888103,633803317),u(3248222580,3479774868),u(3835390401,2666613458),u(4022224774,944711139),u(264347078,2341262773),u(604807628,2007800933),u(770255983,1495990901),u(1249150122,1856431235),u(1555081692,3175218132),u(1996064986,2198950837),u(2554220882,3999719339),u(2821834349,766784016),u(2952996808,2566594879),u(3210313671,3203337956),u(3336571891,1034457026),u(3584528711,2466948901),u(113926993,3758326383),u(338241895,168717936),u(666307205,1188179964),u(773529912,1546045734),u(1294757372,1522805485),u(1396182291,2643833823),u(1695183700,2343527390),u(1986661051,1014477480),u(2177026350,1206759142),u(2456956037,344077627),u(2730485921,1290863460),u(2820302411,3158454273),u(3259730800,3505952657),u(3345764771,106217008),u(3516065817,3606008344),u(3600352804,1432725776),u(4094571909,1467031594),u(275423344,851169720),u(430227734,3100823752),u(506948616,1363258195),u(659060556,3750685593),u(883997877,3785050280),u(958139571,3318307427),u(1322822218,3812723403),u(1537002063,2003034995),u(1747873779,3602036899),u(1955562222,1575990012),u(2024104815,1125592928),u(2227730452,2716904306),u(2361852424,442776044),u(2428436474,593698344),u(2756734187,3733110249),u(3204031479,2999351573),u(3329325298,3815920427),u(3391569614,3928383900),u(3515267271,566280711),u(3940187606,3454069534),u(4118630271,4000239992),u(116418474,1914138554),u(174292421,2731055270),u(289380356,3203993006),u(460393269,320620315),u(685471733,587496836),u(852142971,1086792851),u(1017036298,365543100),u(1126000580,2618297676),u(1288033470,3409855158),u(1501505948,4234509866),u(1607167915,987167468),u(1816402316,1246189591)],p=[];(function(){for(var f=0;f<80;f++)p[f]=u()})();var d=l.SHA512=n.extend({_doReset:function(){this._hash=new c.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(f,m){for(var g=this._hash.words,b=g[0],E=g[1],y=g[2],T=g[3],w=g[4],S=g[5],_=g[6],C=g[7],x=b.high,D=b.low,I=E.high,P=E.low,L=y.high,F=y.low,V=T.high,B=T.low,k=w.high,O=w.low,R=S.high,v=S.low,j=_.high,M=_.low,H=C.high,q=C.low,Q=x,oe=D,me=I,Ee=P,Pe=L,Oe=F,Fe=V,G=B,pe=k,ge=O,ie=R,$=v,ae=j,ye=M,Be=H,be=q,xe=0;xe<80;xe++){var je,ke,Xe=p[xe];if(xe<16)ke=Xe.high=f[m+xe*2]|0,je=Xe.low=f[m+xe*2+1]|0;else{var gt=p[xe-15],it=gt.high,Ve=gt.low,as=(it>>>1|Ve<<31)^(it>>>8|Ve<<24)^it>>>7,Ds=(Ve>>>1|it<<31)^(Ve>>>8|it<<24)^(Ve>>>7|it<<25),A=p[xe-2],N=A.high,Y=A.low,z=(N>>>19|Y<<13)^(N<<3|Y>>>29)^N>>>6,U=(Y>>>19|N<<13)^(Y<<3|N>>>29)^(Y>>>6|N<<26),Z=p[xe-7],J=Z.high,ne=Z.low,ue=p[xe-16],Ie=ue.high,Ue=ue.low;je=Ds+ne,ke=as+J+(je>>>0<Ds>>>0?1:0),je=je+U,ke=ke+z+(je>>>0<U>>>0?1:0),je=je+Ue,ke=ke+Ie+(je>>>0<Ue>>>0?1:0),Xe.high=ke,Xe.low=je}var Ye=pe&ie^~pe&ae,Qe=ge&$^~ge&ye,ws=Q&me^Q&Pe^me&Pe,ar=oe&Ee^oe&Oe^Ee&Oe,yi=(Q>>>28|oe<<4)^(Q<<30|oe>>>2)^(Q<<25|oe>>>7),Yr=(oe>>>28|Q<<4)^(oe<<30|Q>>>2)^(oe<<25|Q>>>7),Or=(pe>>>14|ge<<18)^(pe>>>18|ge<<14)^(pe<<23|ge>>>9),Ir=(ge>>>14|pe<<18)^(ge>>>18|pe<<14)^(ge<<23|pe>>>9),Sh=h[xe],H0=Sh.high,_h=Sh.low,Ls=be+Ir,Vr=Be+Or+(Ls>>>0<be>>>0?1:0),Ls=Ls+Qe,Vr=Vr+Ye+(Ls>>>0<Qe>>>0?1:0),Ls=Ls+_h,Vr=Vr+H0+(Ls>>>0<_h>>>0?1:0),Ls=Ls+je,Vr=Vr+ke+(Ls>>>0<je>>>0?1:0),Ah=Yr+ar,G0=yi+ws+(Ah>>>0<Yr>>>0?1:0);Be=ae,be=ye,ae=ie,ye=$,ie=pe,$=ge,ge=G+Ls|0,pe=Fe+Vr+(ge>>>0<G>>>0?1:0)|0,Fe=Pe,G=Oe,Pe=me,Oe=Ee,me=Q,Ee=oe,oe=Ls+Ah|0,Q=Vr+G0+(oe>>>0<Ls>>>0?1:0)|0}D=b.low=D+oe,b.high=x+Q+(D>>>0<oe>>>0?1:0),P=E.low=P+Ee,E.high=I+me+(P>>>0<Ee>>>0?1:0),F=y.low=F+Oe,y.high=L+Pe+(F>>>0<Oe>>>0?1:0),B=T.low=B+G,T.high=V+Fe+(B>>>0<G>>>0?1:0),O=w.low=O+ge,w.high=k+pe+(O>>>0<ge>>>0?1:0),v=S.low=v+$,S.high=R+ie+(v>>>0<$>>>0?1:0),M=_.low=M+ye,_.high=j+ae+(M>>>0<ye>>>0?1:0),q=C.low=q+be,C.high=H+Be+(q>>>0<be>>>0?1:0)},_doFinalize:function(){var f=this._data,m=f.words,g=this._nDataBytes*8,b=f.sigBytes*8;m[b>>>5]|=128<<24-b%32,m[(b+128>>>10<<5)+30]=Math.floor(g/4294967296),m[(b+128>>>10<<5)+31]=g,f.sigBytes=m.length*4,this._process();var E=this._hash.toX32();return E},clone:function(){var f=n.clone.call(this);return f._hash=this._hash.clone(),f},blockSize:1024/32});r.SHA512=n._createHelper(d),r.HmacSHA512=n._createHmacHelper(d)})(),s.SHA512})}),qM=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Qy(),bO()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./sha512"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.x64,n=i.Word,a=i.WordArray,o=r.algo,c=o.SHA512,l=o.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var u=c._doFinalize.call(this);return u.sigBytes-=16,u}});r.SHA384=c._createHelper(l),r.HmacSHA384=c._createHmacHelper(l)})(),s.SHA384})}),JM=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Qy()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.x64,l=c.Word,u=i.algo,h=[],p=[],d=[];(function(){for(var g=1,b=0,E=0;E<24;E++){h[g+5*b]=(E+1)*(E+2)/2%64;var y=b%5,T=(2*g+3*b)%5;g=y,b=T}for(var g=0;g<5;g++)for(var b=0;b<5;b++)p[g+5*b]=b+(2*g+3*b)%5*5;for(var w=1,S=0;S<24;S++){for(var _=0,C=0,x=0;x<7;x++){if(w&1){var D=(1<<x)-1;D<32?C^=1<<D:_^=1<<D-32}w&128?w=w<<1^113:w<<=1}d[S]=l.create(_,C)}})();var f=[];(function(){for(var g=0;g<25;g++)f[g]=l.create()})();var m=u.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],b=0;b<25;b++)g[b]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,b){for(var E=this._state,y=this.blockSize/2,T=0;T<y;T++){var w=g[b+2*T],S=g[b+2*T+1];w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,S=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360;var _=E[T];_.high^=S,_.low^=w}for(var C=0;C<24;C++){for(var x=0;x<5;x++){for(var D=0,I=0,P=0;P<5;P++){var _=E[x+5*P];D^=_.high,I^=_.low}var L=f[x];L.high=D,L.low=I}for(var x=0;x<5;x++)for(var F=f[(x+4)%5],V=f[(x+1)%5],B=V.high,k=V.low,D=F.high^(B<<1|k>>>31),I=F.low^(k<<1|B>>>31),P=0;P<5;P++){var _=E[x+5*P];_.high^=D,_.low^=I}for(var O=1;O<25;O++){var D,I,_=E[O],R=_.high,v=_.low,j=h[O];j<32?(D=R<<j|v>>>32-j,I=v<<j|R>>>32-j):(D=v<<j-32|R>>>64-j,I=R<<j-32|v>>>64-j);var M=f[p[O]];M.high=D,M.low=I}var H=f[0],q=E[0];H.high=q.high,H.low=q.low;for(var x=0;x<5;x++)for(var P=0;P<5;P++){var O=x+5*P,_=E[O],Q=f[O],oe=f[(x+1)%5+5*P],me=f[(x+2)%5+5*P];_.high=Q.high^~oe.high&me.high,_.low=Q.low^~oe.low&me.low}var _=E[0],Ee=d[C];_.high^=Ee.high,_.low^=Ee.low}},_doFinalize:function(){var g=this._data,b=g.words,E=this._nDataBytes*8,y=g.sigBytes*8,T=this.blockSize*32;b[y>>>5]|=1<<24-y%32,b[(r.ceil((y+1)/T)*T>>>5)-1]|=128,g.sigBytes=b.length*4,this._process();for(var w=this._state,S=this.cfg.outputLength/8,_=S/8,C=[],x=0;x<_;x++){var D=w[x],I=D.high,P=D.low;I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,P=(P<<8|P>>>24)&16711935|(P<<24|P>>>8)&4278255360,C.push(P),C.push(I)}return new a.init(C,S)},clone:function(){for(var g=o.clone.call(this),b=g._state=this._state.slice(0),E=0;E<25;E++)b[E]=b[E].clone();return g}});i.SHA3=o._createHelper(m),i.HmacSHA3=o._createHmacHelper(m)})(Math),s.SHA3})}),KM=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.WordArray,o=n.Hasher,c=i.algo,l=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),u=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),h=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),p=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=a.create([0,1518500249,1859775393,2400959708,2840853838]),f=a.create([1352829926,1548603684,1836072691,2053994217,0]),m=c.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(S,_){for(var C=0;C<16;C++){var x=_+C,D=S[x];S[x]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360}var I=this._hash.words,P=d.words,L=f.words,F=l.words,V=u.words,B=h.words,k=p.words,O,R,v,j,M,H,q,Q,oe,me;H=O=I[0],q=R=I[1],Q=v=I[2],oe=j=I[3],me=M=I[4];for(var Ee,C=0;C<80;C+=1)Ee=O+S[_+F[C]]|0,C<16?Ee+=g(R,v,j)+P[0]:C<32?Ee+=b(R,v,j)+P[1]:C<48?Ee+=E(R,v,j)+P[2]:C<64?Ee+=y(R,v,j)+P[3]:Ee+=T(R,v,j)+P[4],Ee=Ee|0,Ee=w(Ee,B[C]),Ee=Ee+M|0,O=M,M=j,j=w(v,10),v=R,R=Ee,Ee=H+S[_+V[C]]|0,C<16?Ee+=T(q,Q,oe)+L[0]:C<32?Ee+=y(q,Q,oe)+L[1]:C<48?Ee+=E(q,Q,oe)+L[2]:C<64?Ee+=b(q,Q,oe)+L[3]:Ee+=g(q,Q,oe)+L[4],Ee=Ee|0,Ee=w(Ee,k[C]),Ee=Ee+me|0,H=me,me=oe,oe=w(Q,10),Q=q,q=Ee;Ee=I[1]+v+oe|0,I[1]=I[2]+j+me|0,I[2]=I[3]+M+H|0,I[3]=I[4]+O+q|0,I[4]=I[0]+R+Q|0,I[0]=Ee},_doFinalize:function(){var S=this._data,_=S.words,C=this._nDataBytes*8,x=S.sigBytes*8;_[x>>>5]|=128<<24-x%32,_[(x+64>>>9<<4)+14]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,S.sigBytes=(_.length+1)*4,this._process();for(var D=this._hash,I=D.words,P=0;P<5;P++){var L=I[P];I[P]=(L<<8|L>>>24)&16711935|(L<<24|L>>>8)&4278255360}return D},clone:function(){var S=o.clone.call(this);return S._hash=this._hash.clone(),S}});function g(S,_,C){return S^_^C}function b(S,_,C){return S&_|~S&C}function E(S,_,C){return(S|~_)^C}function y(S,_,C){return S&C|_&~C}function T(S,_,C){return S^(_|~C)}function w(S,_){return S<<_|S>>>32-_}i.RIPEMD160=o._createHelper(m),i.HmacRIPEMD160=o._createHmacHelper(m)})(Math),s.RIPEMD160})}),LT=Bt((e,t)=>{(function(s,r){typeof e=="object"?t.exports=e=r($t()):typeof define=="function"&&define.amd?define(["./core"],r):r(s.CryptoJS)})(e,function(s){(function(){var r=s,i=r.lib,n=i.Base,a=r.enc,o=a.Utf8,c=r.algo,l=c.HMAC=n.extend({init:function(u,h){u=this._hasher=new u.init,typeof h=="string"&&(h=o.parse(h));var p=u.blockSize,d=p*4;h.sigBytes>d&&(h=u.finalize(h)),h.clamp();for(var f=this._oKey=h.clone(),m=this._iKey=h.clone(),g=f.words,b=m.words,E=0;E<p;E++)g[E]^=1549556828,b[E]^=909522486;f.sigBytes=m.sigBytes=d,this.reset()},reset:function(){var u=this._hasher;u.reset(),u.update(this._iKey)},update:function(u){return this._hasher.update(u),this},finalize:function(u){var h=this._hasher,p=h.finalize(u);h.reset();var d=h.finalize(this._oKey.clone().concat(p));return d}})})()})}),XM=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),NT(),LT()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.Base,a=i.WordArray,o=r.algo,c=o.SHA256,l=o.HMAC,u=o.PBKDF2=n.extend({cfg:n.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,p){for(var d=this.cfg,f=l.create(d.hasher,h),m=a.create(),g=a.create([1]),b=m.words,E=g.words,y=d.keySize,T=d.iterations;b.length<y;){var w=f.update(p).finalize(g);f.reset();for(var S=w.words,_=S.length,C=w,x=1;x<T;x++){C=f.finalize(C),f.reset();for(var D=C.words,I=0;I<_;I++)S[I]^=D[I]}m.concat(w),E[0]++}return m.sigBytes=y*4,m}});r.PBKDF2=function(h,p,d){return u.create(d).compute(h,p)}})(),s.PBKDF2})}),lc=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),EO(),LT()):typeof define=="function"&&define.amd?define(["./core","./sha1","./hmac"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.Base,a=i.WordArray,o=r.algo,c=o.MD5,l=o.EvpKDF=n.extend({cfg:n.extend({keySize:128/32,hasher:c,iterations:1}),init:function(u){this.cfg=this.cfg.extend(u)},compute:function(u,h){for(var p,d=this.cfg,f=d.hasher.create(),m=a.create(),g=m.words,b=d.keySize,E=d.iterations;g.length<b;){p&&f.update(p),p=f.update(u).finalize(h),f.reset();for(var y=1;y<E;y++)p=f.finalize(p),f.reset();m.concat(p)}return m.sigBytes=b*4,m}});r.EvpKDF=function(u,h,p){return l.create(p).compute(u,h)}})(),s.EvpKDF})}),Hr=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),lc()):typeof define=="function"&&define.amd?define(["./core","./evpkdf"],r):r(s.CryptoJS)})(e,function(s){s.lib.Cipher||(function(r){var i=s,n=i.lib,a=n.Base,o=n.WordArray,c=n.BufferedBlockAlgorithm,l=i.enc,u=l.Utf8,h=l.Base64,p=i.algo,d=p.EvpKDF,f=n.Cipher=c.extend({cfg:a.extend(),createEncryptor:function(L,F){return this.create(this._ENC_XFORM_MODE,L,F)},createDecryptor:function(L,F){return this.create(this._DEC_XFORM_MODE,L,F)},init:function(L,F,V){this.cfg=this.cfg.extend(V),this._xformMode=L,this._key=F,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(L){return this._append(L),this._process()},finalize:function(L){L&&this._append(L);var F=this._doFinalize();return F},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function L(F){return typeof F=="string"?P:x}return function(F){return{encrypt:function(V,B,k){return L(B).encrypt(F,V,B,k)},decrypt:function(V,B,k){return L(B).decrypt(F,V,B,k)}}}})()}),m=n.StreamCipher=f.extend({_doFinalize:function(){var L=this._process(!0);return L},blockSize:1}),g=i.mode={},b=n.BlockCipherMode=a.extend({createEncryptor:function(L,F){return this.Encryptor.create(L,F)},createDecryptor:function(L,F){return this.Decryptor.create(L,F)},init:function(L,F){this._cipher=L,this._iv=F}}),E=g.CBC=(function(){var L=b.extend();L.Encryptor=L.extend({processBlock:function(V,B){var k=this._cipher,O=k.blockSize;F.call(this,V,B,O),k.encryptBlock(V,B),this._prevBlock=V.slice(B,B+O)}}),L.Decryptor=L.extend({processBlock:function(V,B){var k=this._cipher,O=k.blockSize,R=V.slice(B,B+O);k.decryptBlock(V,B),F.call(this,V,B,O),this._prevBlock=R}});function F(V,B,k){var O,R=this._iv;R?(O=R,this._iv=r):O=this._prevBlock;for(var v=0;v<k;v++)V[B+v]^=O[v]}return L})(),y=i.pad={},T=y.Pkcs7={pad:function(L,F){for(var V=F*4,B=V-L.sigBytes%V,k=B<<24|B<<16|B<<8|B,O=[],R=0;R<B;R+=4)O.push(k);var v=o.create(O,B);L.concat(v)},unpad:function(L){var F=L.words[L.sigBytes-1>>>2]&255;L.sigBytes-=F}},w=n.BlockCipher=f.extend({cfg:f.cfg.extend({mode:E,padding:T}),reset:function(){var L;f.reset.call(this);var F=this.cfg,V=F.iv,B=F.mode;this._xformMode==this._ENC_XFORM_MODE?L=B.createEncryptor:(L=B.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==L?this._mode.init(this,V&&V.words):(this._mode=L.call(B,this,V&&V.words),this._mode.__creator=L)},_doProcessBlock:function(L,F){this._mode.processBlock(L,F)},_doFinalize:function(){var L,F=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(F.pad(this._data,this.blockSize),L=this._process(!0)):(L=this._process(!0),F.unpad(L)),L},blockSize:128/32}),S=n.CipherParams=a.extend({init:function(L){this.mixIn(L)},toString:function(L){return(L||this.formatter).stringify(this)}}),_=i.format={},C=_.OpenSSL={stringify:function(L){var F,V=L.ciphertext,B=L.salt;return B?F=o.create([1398893684,1701076831]).concat(B).concat(V):F=V,F.toString(h)},parse:function(L){var F,V=h.parse(L),B=V.words;return B[0]==1398893684&&B[1]==1701076831&&(F=o.create(B.slice(2,4)),B.splice(0,4),V.sigBytes-=16),S.create({ciphertext:V,salt:F})}},x=n.SerializableCipher=a.extend({cfg:a.extend({format:C}),encrypt:function(L,F,V,B){B=this.cfg.extend(B);var k=L.createEncryptor(V,B),O=k.finalize(F),R=k.cfg;return S.create({ciphertext:O,key:V,iv:R.iv,algorithm:L,mode:R.mode,padding:R.padding,blockSize:L.blockSize,formatter:B.format})},decrypt:function(L,F,V,B){B=this.cfg.extend(B),F=this._parse(F,B.format);var k=L.createDecryptor(V,B).finalize(F.ciphertext);return k},_parse:function(L,F){return typeof L=="string"?F.parse(L,this):L}}),D=i.kdf={},I=D.OpenSSL={execute:function(L,F,V,B,k){if(B||(B=o.random(64/8)),k)var O=d.create({keySize:F+V,hasher:k}).compute(L,B);else var O=d.create({keySize:F+V}).compute(L,B);var R=o.create(O.words.slice(F),V*4);return O.sigBytes=F*4,S.create({key:O,iv:R,salt:B})}},P=n.PasswordBasedCipher=x.extend({cfg:x.cfg.extend({kdf:I}),encrypt:function(L,F,V,B){B=this.cfg.extend(B);var k=B.kdf.execute(V,L.keySize,L.ivSize,B.salt,B.hasher);B.iv=k.iv;var O=x.encrypt.call(this,L,F,k.key,B);return O.mixIn(k),O},decrypt:function(L,F,V,B){B=this.cfg.extend(B),F=this._parse(F,B.format);var k=B.kdf.execute(V,L.keySize,L.ivSize,F.salt,B.hasher);B.iv=k.iv;var O=x.decrypt.call(this,L,F,k.key,B);return O}})})()})}),ZM=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.CFB=(function(){var r=s.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize;i.call(this,n,a,c,o),this._prevBlock=n.slice(a,a+c)}}),r.Decryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize,l=n.slice(a,a+c);i.call(this,n,a,c,o),this._prevBlock=l}});function i(n,a,o,c){var l,u=this._iv;u?(l=u.slice(0),this._iv=void 0):l=this._prevBlock,c.encryptBlock(l,0);for(var h=0;h<o;h++)n[a+h]^=l[h]}return r})(),s.mode.CFB})}),$M=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.CTR=(function(){var r=s.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize,l=this._iv,u=this._counter;l&&(u=this._counter=l.slice(0),this._iv=void 0);var h=u.slice(0);o.encryptBlock(h,0),u[c-1]=u[c-1]+1|0;for(var p=0;p<c;p++)n[a+p]^=h[p]}});return r.Decryptor=i,r})(),s.mode.CTR})}),QM=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.CTRGladman=(function(){var r=s.lib.BlockCipherMode.extend();function i(o){if((o>>24&255)===255){var c=o>>16&255,l=o>>8&255,u=o&255;c===255?(c=0,l===255?(l=0,u===255?u=0:++u):++l):++c,o=0,o+=c<<16,o+=l<<8,o+=u}else o+=1<<24;return o}function n(o){return(o[0]=i(o[0]))===0&&(o[1]=i(o[1])),o}var a=r.Encryptor=r.extend({processBlock:function(o,c){var l=this._cipher,u=l.blockSize,h=this._iv,p=this._counter;h&&(p=this._counter=h.slice(0),this._iv=void 0),n(p);var d=p.slice(0);l.encryptBlock(d,0);for(var f=0;f<u;f++)o[c+f]^=d[f]}});return r.Decryptor=a,r})(),s.mode.CTRGladman})}),e7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.OFB=(function(){var r=s.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,c=o.blockSize,l=this._iv,u=this._keystream;l&&(u=this._keystream=l.slice(0),this._iv=void 0),o.encryptBlock(u,0);for(var h=0;h<c;h++)n[a+h]^=u[h]}});return r.Decryptor=i,r})(),s.mode.OFB})}),t7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.mode.ECB=(function(){var r=s.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(i,n){this._cipher.encryptBlock(i,n)}}),r.Decryptor=r.extend({processBlock:function(i,n){this._cipher.decryptBlock(i,n)}}),r})(),s.mode.ECB})}),s7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.AnsiX923={pad:function(r,i){var n=r.sigBytes,a=i*4,o=a-n%a,c=n+o-1;r.clamp(),r.words[c>>>2]|=o<<24-c%4*8,r.sigBytes+=o},unpad:function(r){var i=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=i}},s.pad.Ansix923})}),r7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.Iso10126={pad:function(r,i){var n=i*4,a=n-r.sigBytes%n;r.concat(s.lib.WordArray.random(a-1)).concat(s.lib.WordArray.create([a<<24],1))},unpad:function(r){var i=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=i}},s.pad.Iso10126})}),i7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.Iso97971={pad:function(r,i){r.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(r,i)},unpad:function(r){s.pad.ZeroPadding.unpad(r),r.sigBytes--}},s.pad.Iso97971})}),n7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.ZeroPadding={pad:function(r,i){var n=i*4;r.clamp(),r.sigBytes+=n-(r.sigBytes%n||n)},unpad:function(r){for(var i=r.words,n=r.sigBytes-1,n=r.sigBytes-1;n>=0;n--)if(i[n>>>2]>>>24-n%4*8&255){r.sigBytes=n+1;break}}},s.pad.ZeroPadding})}),a7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return s.pad.NoPadding={pad:function(){},unpad:function(){}},s.pad.NoPadding})}),o7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Hr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(r){var i=s,n=i.lib,a=n.CipherParams,o=i.enc,c=o.Hex,l=i.format,u=l.Hex={stringify:function(h){return h.ciphertext.toString(c)},parse:function(h){var p=c.parse(h);return a.create({ciphertext:p})}}})(),s.format.Hex})}),c7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),cl(),ll(),lc(),Hr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.BlockCipher,a=r.algo,o=[],c=[],l=[],u=[],h=[],p=[],d=[],f=[],m=[],g=[];(function(){for(var y=[],T=0;T<256;T++)T<128?y[T]=T<<1:y[T]=T<<1^283;for(var w=0,S=0,T=0;T<256;T++){var _=S^S<<1^S<<2^S<<3^S<<4;_=_>>>8^_&255^99,o[w]=_,c[_]=w;var C=y[w],x=y[C],D=y[x],I=y[_]*257^_*16843008;l[w]=I<<24|I>>>8,u[w]=I<<16|I>>>16,h[w]=I<<8|I>>>24,p[w]=I;var I=D*16843009^x*65537^C*257^w*16843008;d[_]=I<<24|I>>>8,f[_]=I<<16|I>>>16,m[_]=I<<8|I>>>24,g[_]=I,w?(w=C^y[y[y[D^C]]],S^=y[y[S]]):w=S=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],E=a.AES=n.extend({_doReset:function(){var y;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var T=this._keyPriorReset=this._key,w=T.words,S=T.sigBytes/4,_=this._nRounds=S+6,C=(_+1)*4,x=this._keySchedule=[],D=0;D<C;D++)D<S?x[D]=w[D]:(y=x[D-1],D%S?S>6&&D%S==4&&(y=o[y>>>24]<<24|o[y>>>16&255]<<16|o[y>>>8&255]<<8|o[y&255]):(y=y<<8|y>>>24,y=o[y>>>24]<<24|o[y>>>16&255]<<16|o[y>>>8&255]<<8|o[y&255],y^=b[D/S|0]<<24),x[D]=x[D-S]^y);for(var I=this._invKeySchedule=[],P=0;P<C;P++){var D=C-P;if(P%4)var y=x[D];else var y=x[D-4];P<4||D<=4?I[P]=y:I[P]=d[o[y>>>24]]^f[o[y>>>16&255]]^m[o[y>>>8&255]]^g[o[y&255]]}}},encryptBlock:function(y,T){this._doCryptBlock(y,T,this._keySchedule,l,u,h,p,o)},decryptBlock:function(y,T){var w=y[T+1];y[T+1]=y[T+3],y[T+3]=w,this._doCryptBlock(y,T,this._invKeySchedule,d,f,m,g,c);var w=y[T+1];y[T+1]=y[T+3],y[T+3]=w},_doCryptBlock:function(y,T,w,S,_,C,x,D){for(var I=this._nRounds,P=y[T]^w[0],L=y[T+1]^w[1],F=y[T+2]^w[2],V=y[T+3]^w[3],B=4,k=1;k<I;k++){var O=S[P>>>24]^_[L>>>16&255]^C[F>>>8&255]^x[V&255]^w[B++],R=S[L>>>24]^_[F>>>16&255]^C[V>>>8&255]^x[P&255]^w[B++],v=S[F>>>24]^_[V>>>16&255]^C[P>>>8&255]^x[L&255]^w[B++],j=S[V>>>24]^_[P>>>16&255]^C[L>>>8&255]^x[F&255]^w[B++];P=O,L=R,F=v,V=j}var O=(D[P>>>24]<<24|D[L>>>16&255]<<16|D[F>>>8&255]<<8|D[V&255])^w[B++],R=(D[L>>>24]<<24|D[F>>>16&255]<<16|D[V>>>8&255]<<8|D[P&255])^w[B++],v=(D[F>>>24]<<24|D[V>>>16&255]<<16|D[P>>>8&255]<<8|D[L&255])^w[B++],j=(D[V>>>24]<<24|D[P>>>16&255]<<16|D[L>>>8&255]<<8|D[F&255])^w[B++];y[T]=O,y[T+1]=R,y[T+2]=v,y[T+3]=j},keySize:256/32});r.AES=n._createHelper(E)})(),s.AES})}),l7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),cl(),ll(),lc(),Hr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.WordArray,a=i.BlockCipher,o=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],p=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=a.extend({_doReset:function(){for(var b=this._key,E=b.words,y=[],T=0;T<56;T++){var w=c[T]-1;y[T]=E[w>>>5]>>>31-w%32&1}for(var S=this._subKeys=[],_=0;_<16;_++){for(var C=S[_]=[],x=u[_],T=0;T<24;T++)C[T/6|0]|=y[(l[T]-1+x)%28]<<31-T%6,C[4+(T/6|0)]|=y[28+(l[T+24]-1+x)%28]<<31-T%6;C[0]=C[0]<<1|C[0]>>>31;for(var T=1;T<7;T++)C[T]=C[T]>>>(T-1)*4+3;C[7]=C[7]<<5|C[7]>>>27}for(var D=this._invSubKeys=[],T=0;T<16;T++)D[T]=S[15-T]},encryptBlock:function(b,E){this._doCryptBlock(b,E,this._subKeys)},decryptBlock:function(b,E){this._doCryptBlock(b,E,this._invSubKeys)},_doCryptBlock:function(b,E,y){this._lBlock=b[E],this._rBlock=b[E+1],f.call(this,4,252645135),f.call(this,16,65535),m.call(this,2,858993459),m.call(this,8,16711935),f.call(this,1,1431655765);for(var T=0;T<16;T++){for(var w=y[T],S=this._lBlock,_=this._rBlock,C=0,x=0;x<8;x++)C|=h[x][((_^w[x])&p[x])>>>0];this._lBlock=_,this._rBlock=S^C}var D=this._lBlock;this._lBlock=this._rBlock,this._rBlock=D,f.call(this,1,1431655765),m.call(this,8,16711935),m.call(this,2,858993459),f.call(this,16,65535),f.call(this,4,252645135),b[E]=this._lBlock,b[E+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function f(b,E){var y=(this._lBlock>>>b^this._rBlock)&E;this._rBlock^=y,this._lBlock^=y<<b}function m(b,E){var y=(this._rBlock>>>b^this._lBlock)&E;this._lBlock^=y,this._rBlock^=y<<b}r.DES=a._createHelper(d);var g=o.TripleDES=a.extend({_doReset:function(){var b=this._key,E=b.words;if(E.length!==2&&E.length!==4&&E.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var y=E.slice(0,2),T=E.length<4?E.slice(0,2):E.slice(2,4),w=E.length<6?E.slice(0,2):E.slice(4,6);this._des1=d.createEncryptor(n.create(y)),this._des2=d.createEncryptor(n.create(T)),this._des3=d.createEncryptor(n.create(w))},encryptBlock:function(b,E){this._des1.encryptBlock(b,E),this._des2.decryptBlock(b,E),this._des3.encryptBlock(b,E)},decryptBlock:function(b,E){this._des3.decryptBlock(b,E),this._des2.encryptBlock(b,E),this._des1.decryptBlock(b,E)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=a._createHelper(g)})(),s.TripleDES})}),u7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),cl(),ll(),lc(),Hr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.StreamCipher,a=r.algo,o=a.RC4=n.extend({_doReset:function(){for(var u=this._key,h=u.words,p=u.sigBytes,d=this._S=[],f=0;f<256;f++)d[f]=f;for(var f=0,m=0;f<256;f++){var g=f%p,b=h[g>>>2]>>>24-g%4*8&255;m=(m+d[f]+b)%256;var E=d[f];d[f]=d[m],d[m]=E}this._i=this._j=0},_doProcessBlock:function(u,h){u[h]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var u=this._S,h=this._i,p=this._j,d=0,f=0;f<4;f++){h=(h+1)%256,p=(p+u[h])%256;var m=u[h];u[h]=u[p],u[p]=m,d|=u[(u[h]+u[p])%256]<<24-f*8}return this._i=h,this._j=p,d}r.RC4=n._createHelper(o);var l=a.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var u=this.cfg.drop;u>0;u--)c.call(this)}});r.RC4Drop=n._createHelper(l)})(),s.RC4})}),h7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),cl(),ll(),lc(),Hr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.StreamCipher,a=r.algo,o=[],c=[],l=[],u=a.Rabbit=n.extend({_doReset:function(){for(var p=this._key.words,d=this.cfg.iv,f=0;f<4;f++)p[f]=(p[f]<<8|p[f]>>>24)&16711935|(p[f]<<24|p[f]>>>8)&4278255360;var m=this._X=[p[0],p[3]<<16|p[2]>>>16,p[1],p[0]<<16|p[3]>>>16,p[2],p[1]<<16|p[0]>>>16,p[3],p[2]<<16|p[1]>>>16],g=this._C=[p[2]<<16|p[2]>>>16,p[0]&4294901760|p[1]&65535,p[3]<<16|p[3]>>>16,p[1]&4294901760|p[2]&65535,p[0]<<16|p[0]>>>16,p[2]&4294901760|p[3]&65535,p[1]<<16|p[1]>>>16,p[3]&4294901760|p[0]&65535];this._b=0;for(var f=0;f<4;f++)h.call(this);for(var f=0;f<8;f++)g[f]^=m[f+4&7];if(d){var b=d.words,E=b[0],y=b[1],T=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,w=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S=T>>>16|w&4294901760,_=w<<16|T&65535;g[0]^=T,g[1]^=S,g[2]^=w,g[3]^=_,g[4]^=T,g[5]^=S,g[6]^=w,g[7]^=_;for(var f=0;f<4;f++)h.call(this)}},_doProcessBlock:function(p,d){var f=this._X;h.call(this),o[0]=f[0]^f[5]>>>16^f[3]<<16,o[1]=f[2]^f[7]>>>16^f[5]<<16,o[2]=f[4]^f[1]>>>16^f[7]<<16,o[3]=f[6]^f[3]>>>16^f[1]<<16;for(var m=0;m<4;m++)o[m]=(o[m]<<8|o[m]>>>24)&16711935|(o[m]<<24|o[m]>>>8)&4278255360,p[d+m]^=o[m]},blockSize:128/32,ivSize:64/32});function h(){for(var p=this._X,d=this._C,f=0;f<8;f++)c[f]=d[f];d[0]=d[0]+1295307597+this._b|0,d[1]=d[1]+3545052371+(d[0]>>>0<c[0]>>>0?1:0)|0,d[2]=d[2]+886263092+(d[1]>>>0<c[1]>>>0?1:0)|0,d[3]=d[3]+1295307597+(d[2]>>>0<c[2]>>>0?1:0)|0,d[4]=d[4]+3545052371+(d[3]>>>0<c[3]>>>0?1:0)|0,d[5]=d[5]+886263092+(d[4]>>>0<c[4]>>>0?1:0)|0,d[6]=d[6]+1295307597+(d[5]>>>0<c[5]>>>0?1:0)|0,d[7]=d[7]+3545052371+(d[6]>>>0<c[6]>>>0?1:0)|0,this._b=d[7]>>>0<c[7]>>>0?1:0;for(var f=0;f<8;f++){var m=p[f]+d[f],g=m&65535,b=m>>>16,E=((g*g>>>17)+g*b>>>15)+b*b,y=((m&4294901760)*m|0)+((m&65535)*m|0);l[f]=E^y}p[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,p[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,p[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,p[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,p[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,p[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,p[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,p[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.Rabbit=n._createHelper(u)})(),s.Rabbit})}),d7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),cl(),ll(),lc(),Hr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.StreamCipher,a=r.algo,o=[],c=[],l=[],u=a.RabbitLegacy=n.extend({_doReset:function(){var p=this._key.words,d=this.cfg.iv,f=this._X=[p[0],p[3]<<16|p[2]>>>16,p[1],p[0]<<16|p[3]>>>16,p[2],p[1]<<16|p[0]>>>16,p[3],p[2]<<16|p[1]>>>16],m=this._C=[p[2]<<16|p[2]>>>16,p[0]&4294901760|p[1]&65535,p[3]<<16|p[3]>>>16,p[1]&4294901760|p[2]&65535,p[0]<<16|p[0]>>>16,p[2]&4294901760|p[3]&65535,p[1]<<16|p[1]>>>16,p[3]&4294901760|p[0]&65535];this._b=0;for(var g=0;g<4;g++)h.call(this);for(var g=0;g<8;g++)m[g]^=f[g+4&7];if(d){var b=d.words,E=b[0],y=b[1],T=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,w=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S=T>>>16|w&4294901760,_=w<<16|T&65535;m[0]^=T,m[1]^=S,m[2]^=w,m[3]^=_,m[4]^=T,m[5]^=S,m[6]^=w,m[7]^=_;for(var g=0;g<4;g++)h.call(this)}},_doProcessBlock:function(p,d){var f=this._X;h.call(this),o[0]=f[0]^f[5]>>>16^f[3]<<16,o[1]=f[2]^f[7]>>>16^f[5]<<16,o[2]=f[4]^f[1]>>>16^f[7]<<16,o[3]=f[6]^f[3]>>>16^f[1]<<16;for(var m=0;m<4;m++)o[m]=(o[m]<<8|o[m]>>>24)&16711935|(o[m]<<24|o[m]>>>8)&4278255360,p[d+m]^=o[m]},blockSize:128/32,ivSize:64/32});function h(){for(var p=this._X,d=this._C,f=0;f<8;f++)c[f]=d[f];d[0]=d[0]+1295307597+this._b|0,d[1]=d[1]+3545052371+(d[0]>>>0<c[0]>>>0?1:0)|0,d[2]=d[2]+886263092+(d[1]>>>0<c[1]>>>0?1:0)|0,d[3]=d[3]+1295307597+(d[2]>>>0<c[2]>>>0?1:0)|0,d[4]=d[4]+3545052371+(d[3]>>>0<c[3]>>>0?1:0)|0,d[5]=d[5]+886263092+(d[4]>>>0<c[4]>>>0?1:0)|0,d[6]=d[6]+1295307597+(d[5]>>>0<c[5]>>>0?1:0)|0,d[7]=d[7]+3545052371+(d[6]>>>0<c[6]>>>0?1:0)|0,this._b=d[7]>>>0<c[7]>>>0?1:0;for(var f=0;f<8;f++){var m=p[f]+d[f],g=m&65535,b=m>>>16,E=((g*g>>>17)+g*b>>>15)+b*b,y=((m&4294901760)*m|0)+((m&65535)*m|0);l[f]=E^y}p[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,p[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,p[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,p[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,p[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,p[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,p[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,p[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.RabbitLegacy=n._createHelper(u)})(),s.RabbitLegacy})}),p7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),cl(),ll(),lc(),Hr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(s.CryptoJS)})(e,function(s){return(function(){var r=s,i=r.lib,n=i.BlockCipher,a=r.algo;let o=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],l=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var u={pbox:[],sbox:[]};function h(g,b){let E=b>>24&255,y=b>>16&255,T=b>>8&255,w=b&255,S=g.sbox[0][E]+g.sbox[1][y];return S=S^g.sbox[2][T],S=S+g.sbox[3][w],S}function p(g,b,E){let y=b,T=E,w;for(let S=0;S<o;++S)y=y^g.pbox[S],T=h(g,y)^T,w=y,y=T,T=w;return w=y,y=T,T=w,T=T^g.pbox[o],y=y^g.pbox[o+1],{left:y,right:T}}function d(g,b,E){let y=b,T=E,w;for(let S=o+1;S>1;--S)y=y^g.pbox[S],T=h(g,y)^T,w=y,y=T,T=w;return w=y,y=T,T=w,T=T^g.pbox[1],y=y^g.pbox[0],{left:y,right:T}}function f(g,b,E){for(let _=0;_<4;_++){g.sbox[_]=[];for(let C=0;C<256;C++)g.sbox[_][C]=l[_][C]}let y=0;for(let _=0;_<o+2;_++)g.pbox[_]=c[_]^b[y],y++,y>=E&&(y=0);let T=0,w=0,S=0;for(let _=0;_<o+2;_+=2)S=p(g,T,w),T=S.left,w=S.right,g.pbox[_]=T,g.pbox[_+1]=w;for(let _=0;_<4;_++)for(let C=0;C<256;C+=2)S=p(g,T,w),T=S.left,w=S.right,g.sbox[_][C]=T,g.sbox[_][C+1]=w;return!0}var m=a.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,b=g.words,E=g.sigBytes/4;f(u,b,E)}},encryptBlock:function(g,b){var E=p(u,g[b],g[b+1]);g[b]=E.left,g[b+1]=E.right},decryptBlock:function(g,b){var E=d(u,g[b],g[b+1]);g[b]=E.left,g[b+1]=E.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=n._createHelper(m)})(),s.Blowfish})}),f7=Bt((e,t)=>{(function(s,r,i){typeof e=="object"?t.exports=e=r($t(),Qy(),YM(),VM(),cl(),zM(),ll(),EO(),NT(),WM(),bO(),qM(),JM(),KM(),LT(),XM(),lc(),Hr(),ZM(),$M(),QM(),e7(),t7(),s7(),r7(),i7(),n7(),a7(),o7(),c7(),l7(),u7(),h7(),d7(),p7()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./enc-base64url","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy","./blowfish"],r):s.CryptoJS=r(s.CryptoJS)})(e,function(s){return s})}),m7=(e=>(e.Device="Device",e.Symbol="Symbol",e.Footprint="Footprint",e.OBJ="OBJ",e.ModelID="3D Model",e.ModelName="3D Model Title",e.OriginModelName="Origin 3D Model Title",e.ModelTransform="3D Model Transform",e.OriginFootprint="Origin Footprint",e))(m7||{}),ii=(e=>(e.DOCHEAD="DOCHEAD",e.EDIT_HEAD="EDIT_HEAD",e.SCH="SCH",e.SCH_PAGE="SCH_PAGE",e.PCB="PCB",e.PANEL="PANEL",e.PANEL_LIB="PANEL_LIB",e.SYMBOL="SYMBOL",e.FOOTPRINT="FOOTPRINT",e.DEVICE="DEVICE",e.BLOB="BLOB",e.INSTANCE="INSTANCE",e.CONFIG="CONFIG",e.BOARD="BOARD",e.FONT="FONT",e.VARIANT="VARIANT",e.COMPONENT_GROUP="COMPONENT_GROUP",e.COMPONENT_GROUP_DATA="COMPONENT_GROUP_DATA",e.SIMULATION="SIMULATION",e))(ii||{}),e0=(e=>(e.META="META",e.META_SORT="META_SORT",e.META_CREATE="META_CREATE",e.META_MODIFY="META_MODIFY",e.FONT="FONT",e.BLOB="BLOB",e.MAX_NUM="MAX_NUM",e.INSTANCE_ATTR="INSTANCE_ATTR",e.DELETE_DOC="DELETE_DOC",e.META_Z_INDEX="META_Z_INDEX",e.VARIANT_GROUPED="VARIANT_GROUPED",e.GROUP_INDEX="GROUP_INDEX",e.GROUP_DATA="GROUP_DATA",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.META_PLACEHOLDER="META_PLACEHOLDER",e))(e0||{}),Vn="||",Le=`|
`;function mp(e,t,s){return e.slice(t,s)}function ET(e,t,s){let r=e.length,i=0;for(;i<r;){let n=e.indexOf(Le,i);if(n<0){if(s)return e.substring(i);n=r}let a=mp(e,i,n);try{if(a){let o=a.indexOf(Vn),c=o>-1,l=c?mp(a,0,o):a,u=c?mp(a,o+Vn.length):"";if(t(l,u,a,c?i+o+Vn.length:i)===!1){a=null;break}a=null}}catch(o){console.error(o)}i=n+Le.length}e=null}var g7=["SYMBOL","FOOTPRINT","BLOB","FONT","PANEL_LIB","DEVICE","BOARD","INSTANCE","CONFIG","VARIANT","COMPONENT_GROUP","COMPONENT_GROUP_DATA"];function gp(e,t){return g7.includes(t)?t:e}var TO=class{parseFull(e,t,s){let r=t,i=s,n,a=null;ET(e,(o,c,l)=>{let u=JSON.parse(o);if(u.type==="EDIT_HEAD")a=JSON.parse(c),this.onEditHead&&this.onEditHead(a);else if(u.type==="DOCHEAD"){let h=JSON.parse(c);i=h.docType,r=h.uuid,n=h.client,h.ticket=u.ticket,this.onDocHead(h,a,l)}else this.onLine(u.id,u.ticket,c,u.type,u.client||n,i,r,u.firstTicket,u.pend,a,u.num,l)}),this.onEnd(),e=null}flowParseFull(e={}){let{cache:t,chunkLength:s=100*1024*1024,idsData:r,history:i}=e,n="",a=null,o,c=null,l=!0,u="",h=0,p=!1,d={},f=t?{}:void 0,m=E=>{f[E]===void 0&&(f[E]=-1),t(E,++f[E],d[E].data.join(Le)),d[E].data.length=0,d[E].size=0,d[E].data.push(d[E].head),d[E].size+=d[E].head.length},g=E=>{let y=gp(n,a);t&&(d[y].data.push(E),d[y].size+=(d[y].size?Le.length:0)+E.length,d[y].size+E.length>s&&m(y))},b=(E,y)=>ET(E,(T,w,S,_)=>{var x,D,I,P,L,F,V,B;let C=JSON.parse(T);if(C.type==="EDIT_HEAD")c=JSON.parse(w),(x=this.onEditHead)==null||x.call(this,c),(D=e.onEditHead)==null||D.call(e,c),p=!0;else if(C.type==="DOCHEAD"){let k=JSON.parse(w);a=k.docType,n=k.uuid,o=k.client,k.ticket=C.ticket,p||(c={uuid:k.uuid,username:(I=k==null?void 0:k.user)==null?void 0:I.username,nickname:(P=k==null?void 0:k.user)==null?void 0:P.nickname,updateTime:k==null?void 0:k.updateTime},(L=e.onEditHead)==null||L.call(e,c),p=!0),this.onDocHead(k,c,S);let O=gp(n,a);t&&!d[O]&&(d[O]={size:0,data:[],head:""}),t&&(d[O].head=S),g(S)}else{let k=C.num,O=C.client||o;if(r){let R=(B=(V=(F=r.ids)==null?void 0:F[n])==null?void 0:V[O])==null?void 0:B[C.id];if(!R||R[0]!==C.ticket)return;k=R[1],r.size-=1,delete r.ids[n][O][C.id]}if(i){let R=gp(n,a);t&&(i.dNum=(f==null?void 0:f[R])===void 0?0:(f==null?void 0:f[R])+1),i.start=t?d[R].size+Le.length+T.length+Vn.length:h+_}this.onLine(C.id,C.ticket,w,C.type,O,a,n,C.firstTicket,C.pend,c||(i==null?void 0:i.editHead),k,S,i),g(S)}},y);return{start:()=>{l=!0},end:()=>{if(u&&b(u,!1),t)for(let E in d)d[E].size&&d[E].data.length>1&&m(E),d[E]=null;l=!1,u="",n="",n=null,o="",c=null,this.onEnd()},update:E=>{if(!l)throw new Error("\u66F4\u65B0\u524D\u672A\u8C03\u7528 start \u65B9\u6CD5");let y=b(u+E,!0);h=h+u.length+E.length-((y==null?void 0:y.length)||0),u="",y&&(u=y)},docMap:f}}parseLine(e,t,s){let r=e.indexOf(Vn),i=r!==-1,n=i?mp(e,0,r):e,a=i?mp(e,r+Vn.length):"",o=JSON.parse(n);this.onLine(o.id,o.ticket,a,o.type,o.client,s,t,o.firstTicket,o.pend,void 0,o.num,e),e=null}onEditHead(e){}},$b=new Uint8Array(8);function at(){crypto.getRandomValues($b);let e="";for(let t=0;t<$b.length;t++)e+=$b[t].toString(16).padStart(2,"0");return e}function pr(e,t,s,r,i,n,a){let o={docType:e,client:t,uuid:s};return(r||r===0)&&(o.updateTime=r),(i||o.updateTime||o.updateTime===0)&&(o.version=i||String(r)),n&&(o.user=n),`${JSON.stringify({type:"DOCHEAD",ticket:a})}${Vn}${JSON.stringify(o)}`}function Zt(e,t,s,r,i,n,a,o){let c={type:e,ticket:t,id:s};return n!==void 0&&(c.firstTicket=n),a!==void 0&&(c.pend=a),o!==void 0&&(c.num=o),i&&(c.client=i),`${JSON.stringify(c)}${Vn}${r}`}var y7=class extends TO{constructor(e){super(),this.unique=at(),this.maxTicket=0,this.isPendChange=!0,this.isLocalChange=!0,this.cbArr=[],this.tempLocalIds={},this.client=e||at()}onLine(e,t,s,r,i,n,a,o,c,l,u){this.remoteChange(t,i,a,e,s,r,n,void 0,o,c,l,void 0,void 0,u)}getUnique(){return this.unique}setUnique(e){this.unique=e}onDocHead(e,t){}onEnd(){}setIsPendChange(e){this.isPendChange=e}getIsPendChange(){return this.isPendChange}getMaxTicket(){return this.maxTicket}setMaxTicket(e,t){e&&(t||this.maxTicket<e)&&(this.maxTicket=e)}setIsLocalChange(e){this.isLocalChange=e}getIsLocalChange(){return this.isLocalChange}revoke(e,t,s,r,i,n,a,o,c,l,u){var h;if(!((h=this.tempLocalIds[e])!=null&&h[t]))return u?u(t,i,s,a,`${r}-1`,e,n,void 0,void 0,!0,l):this.cbArr.forEach(p=>p(e,t,s,a,`${r}-1`,i,void 0,n,void 0,void 0,void 0,l)),!0}getRandomUuid(){return at()}getClient(){return this.client}onChange(e){this.cbArr.push(e)}localChange(e,t,s,r,i,n){let a=this.maxTicket+1;return this.tempLocalIds[e]||(this.tempLocalIds[e]={}),this.tempLocalIds[e][t]=[this.getClient(),a],this.remoteChange(a,this.client,e,t,s,r,i,!0,void 0,!0,void 0,this.unique,void 0,n),a}remoteChange(e,t,s,r,i,n,a,o,c,l,u,h,p,d){var E;this.setMaxTicket(e);let f=h===this.unique,m=o||f,g=(!m||m&&this.isLocalChange)&&(!p||p&&this.isPendChange),b=(E=this.tempLocalIds[s])==null?void 0:E[r];!o&&f?b?(g=!1,b[0]===t&&b[1]===e&&delete this.tempLocalIds[s][r]):g=!0:!o&&b&&(b[1]>e||b[1]===e&&b[0]>t?g=!1:delete this.tempLocalIds[s][r]),g&&this.cbArr.forEach(y=>y(s,r,i,n,t,e,c,l,void 0,p,h,d))}},E7=class{constructor(e){this.item=e,this.parent=null,this.left=null,this.right=null,this.height=1}getParent(){return this.parent}getLeft(){return this.left}getRight(){return this.right}getHeight(){return this.height}setLeft(e){if(this.left!==null)throw new Error("insert exists left is not permitted");if(e!==null){if(e.parent!==null)throw new Error("insert left with node has parent is not permitted");this.left=e,e.parent=this,this.updateHeight()}}setRight(e){if(this.right!==null)throw new Error("insert exists right is not permitted");if(e!==null){if(e.parent!==null)throw new Error("insert right with node has parent is not permitted");this.right=e,e.parent=this,this.updateHeight()}}removeLeft(){if(this.left===null)return null;{let e=this.left;return e.parent=null,this.left=null,this.updateHeight(),e}}removeRight(){if(this.right===null)return null;{let e=this.right;return e.parent=null,this.right=null,this.updateHeight(),e}}rotateRight(e){let t=this.removeLeft();if(this.setLeft(t.removeRight()),this.parent){let s=this.parent;s.getLeft()===this?(s.removeLeft(),s.setLeft(t)):(s.removeRight(),s.setRight(t)),t.setRight(this)}else t.setRight(this),e(t)}rotateLeft(e){let t=this.removeRight();if(this.setRight(t.removeLeft()),this.parent){let s=this.parent;s.getLeft()===this?(s.removeLeft(),s.setLeft(t)):(s.removeRight(),s.setRight(t)),t.setLeft(this)}else t.setLeft(this),e(t)}updateHeight(){var t,s;let e=this;for(;e!==null;)e.height=Math.max(((t=e.left)==null?void 0:t.height)||0,((s=e.right)==null?void 0:s.height)||0)+1,e=e.parent}},bT=class{constructor(e){this.comparator=e,this.root=null,this.minNode=null,this.maxNode=null,this.size=0}balance(e){var i,n;let t=((i=e.getLeft())==null?void 0:i.getHeight())||0,s=((n=e.getRight())==null?void 0:n.getHeight())||0,r=e.getParent();t>s?t-s>1?(e.rotateRight(a=>this.root=a),this.verify()):r!==null?r.getRight()===e&&(e.rotateRight(a=>this.root=a),this.verify()):(e.rotateRight(a=>this.root=a),this.verify()):s>t&&(s-t>1?(e.rotateLeft(a=>this.root=a),this.verify()):r!==null?r.getLeft()===e&&(e.rotateLeft(a=>this.root=a),this.verify()):(e.rotateLeft(a=>this.root=a),this.verify())),r&&this.balance(r)}forwardTraverse(e){let t=new Array(10),s=this.minNode;for(;s;)switch(t.pop()||2){case 1:s.getLeft()!==null?(t.push(2),t.push(1),s=s.getLeft()):t.push(2);break;case 2:if(!e(s.item))return;s.getRight()!==null?(t.push(3),t.push(1),s=s.getRight()):t.push(3);break;case 3:s=s.getParent();break;default:throw new Error("invalid status")}}backwardTraverse(e){let t=new Array(10),s=this.maxNode;for(;s;)switch(t.pop()||2){case 1:s.getRight()!==null?(t.push(2),t.push(1),s=s.getRight()):t.push(2);break;case 2:if(!e(s.item))return;s.getLeft()!==null?(t.push(3),t.push(1),s=s.getLeft()):t.push(3);break;case 3:s=s.getParent();break;default:throw new Error("invalid status")}}display(e=this.root,t=new Array,s=0){let r="| ".repeat(s);return t.push(r+`\u25CF(${e.item})
`),e.getLeft()?this.display(e.getLeft(),t,s+1):t.push(r+`| \u2609
`),e.getRight()?this.display(e.getRight(),t,s+1):t.push(r+`| \u2609
`),t}getHeight(){var e;return((e=this.root)==null?void 0:e.getHeight())||0}getSize(){return this.size}updateMinMax(e){this.minNode?this.comparator(e.item,this.minNode.item)<0&&(this.minNode=e):this.minNode=e,this.maxNode?this.comparator(e.item,this.maxNode.item)>0&&(this.maxNode=e):this.maxNode=e}insert(e){let t=new E7(e);if(this.root===null)return this.root=t,this.size++,this.updateMinMax(t),!0;{let s=this.root;for(;;){let r=this.comparator(e,s.item);if(r<0){if(s.getLeft()===null)return s.setLeft(t),this.size++,this.updateMinMax(t),this.verify(),this.balance(s),!0;s=s.getLeft()}else if(r>0){if(s.getRight()===null)return s.setRight(t),this.size++,this.updateMinMax(t),this.verify(),this.balance(s),!0;s=s.getRight()}else return!1}}}verify(){}remove(e){let t=this.root;for(this.verify();;){if(t===null)return!1;let s=this.comparator(e,t.item);if(s<0)t=t.getLeft();else if(s>0)t=t.getRight();else return this.minNode===t&&(t.getRight()?this.minNode=this.findMinChild(t.getRight()):this.minNode=t.getParent()),this.maxNode===t&&(t.getLeft()?this.maxNode=this.findMaxChild(t.getLeft()):this.maxNode=t.getParent()),this.removeNode(t),this.size--,this.verify(),!0}}removeNode(e){var s,r;let t=e.getParent();if(t===null)e.getLeft()===null&&e.getRight()===null?(this.root=null,this.minNode=null,this.maxNode=null):((((s=e.getLeft())==null?void 0:s.getHeight())||0)>(((r=e.getRight())==null?void 0:r.getHeight())||0)?(e.rotateRight(i=>this.root=i),this.verify()):(e.rotateLeft(i=>this.root=i),this.verify()),this.removeNode(e));else if(t.getLeft()===e){t.removeLeft();let i=this.combineNodes(e.removeLeft(),e.removeRight());t.setLeft(i),this.verify(),this.balance(t)}else{t.removeRight();let i=this.combineNodes(e.removeLeft(),e.removeRight());t.setRight(i),this.verify(),this.balance(t)}}combineNodes(e,t){if(e&&t)if(e.getHeight()>t.getHeight()){let s=this.findMaxChild(e);if(s){let r=s.getParent();return r.removeRight(),r.setRight(s.removeLeft()),s.setLeft(e),s.setRight(t),s}else return e.setRight(t),e}else{let s=this.findMinChild(t);if(s){let r=s.getParent();return r.removeLeft(),r.setLeft(s.removeRight()),s.setLeft(e),s.setRight(t),s}else return t.setLeft(e),t}else return e||t||null}findMinChild(e){let t=e;for(;;){if(t.getLeft()===null)return t!==e?t:null;t=t.getLeft()}}findMaxChild(e){let t=e;for(;;){if(t.getRight()===null)return t!==e?t:null;t=t.getRight()}}};function*b7(e){for(let t=0;t<e.length;t++)yield e[t],e[t]=null}function Qc(e,t){let s="";for(let r of b7(e))s?s=s+t+r:s=r;return s}var t0=/^(?:ie|e)(\d+)$/;function bp(e){let t=e.match(t0);return t?Number(t[1]):null}function He(e){if(!e||typeof e!="string")return e;let t=e.match(/(?:ie|e)\d+/g);return t&&t.length===2&&t.join("")===e?t.join("-"):e}function ss(e){return e&&typeof e=="number"&&!isNaN(e)?-e:e}function PP(e,t,s){let r=[];for(let i of e)for(let n=0;n<i.length&&!(n+3>i.length);n+=2){let a={lineGroup:s,startX:i[n],startY:ss(i[n+1]),endX:i[n+2],endY:ss(i[n+3]),...t};r.push(a)}return r}function wO(e,t){let s=[];for(let r=0;r<e.length;r+=2){let i={x:e[r],y:t?ss(e[r+1]):e[r+1]};s.push(i)}return s}function Ui(e,t){return JSON.stringify([t,e])}function T7(e){let t=["00000000","77073096","EE0E612C","990951BA","076DC419","706AF48F","E963A535","9E6495A3","0EDB8832","79DCB8A4","E0D5E91E","97D2D988","09B64C2B","7EB17CBD","E7B82D07","90BF1D91","1DB71064","6AB020F2","F3B97148","84BE41DE","1ADAD47D","6DDDE4EB","F4D4B551","83D385C7","136C9856","646BA8C0","FD62F97A","8A65C9EC","14015C4F","63066CD9","FA0F3D63","8D080DF5","3B6E20C8","4C69105E","D56041E4","A2677172","3C03E4D1","4B04D447","D20D85FD","A50AB56B","35B5A8FA","42B2986C","DBBBC9D6","ACBCF940","32D86CE3","45DF5C75","DCD60DCF","ABD13D59","26D930AC","51DE003A","C8D75180","BFD06116","21B4F4B5","56B3C423","CFBA9599","B8BDA50F","2802B89E","5F058808","C60CD9B2","B10BE924","2F6F7C87","58684C11","C1611DAB","B6662D3D","76DC4190","01DB7106","98D220BC","EFD5102A","71B18589","06B6B51F","9FBFE4A5","E8B8D433","7807C9A2","0F00F934","9609A88E","E10E9818","7F6A0DBB","086D3D2D","91646C97","E6635C01","6B6B51F4","1C6C6162","856530D8","F262004E","6C0695ED","1B01A57B","8208F4C1","F50FC457","65B0D9C6","12B7E950","8BBEB8EA","FCB9887C","62DD1DDF","15DA2D49","8CD37CF3","FBD44C65","4DB26158","3AB551CE","A3BC0074","D4BB30E2","4ADFA541","3DD895D7","A4D1C46D","D3D6F4FB","4369E96A","346ED9FC","AD678846","DA60B8D0","44042D73","33031DE5","AA0A4C5F","DD0D7CC9","5005713C","270241AA","BE0B1010","C90C2086","5768B525","206F85B3","B966D409","CE61E49F","5EDEF90E","29D9C998","B0D09822","C7D7A8B4","59B33D17","2EB40D81","B7BD5C3B","C0BA6CAD","EDB88320","9ABFB3B6","03B6E20C","74B1D29A","EAD54739","9DD277AF","04DB2615","73DC1683","E3630B12","94643B84","0D6D6A3E","7A6A5AA8","E40ECF0B","9309FF9D","0A00AE27","7D079EB1","F00F9344","8708A3D2","1E01F268","6906C2FE","F762575D","806567CB","196C3671","6E6B06E7","FED41B76","89D32BE0","10DA7A5A","67DD4ACC","F9B9DF6F","8EBEEFF9","17B7BE43","60B08ED5","D6D6A3E8","A1D1937E","38D8C2C4","4FDFF252","D1BB67F1","A6BC5767","3FB506DD","48B2364B","D80D2BDA","AF0A1B4C","36034AF6","41047A60","DF60EFC3","A867DF55","316E8EEF","4669BE79","CB61B38C","BC66831A","256FD2A0","5268E236","CC0C7795","BB0B4703","220216B9","5505262F","C5BA3BBE","B2BD0B28","2BB45A92","5CB36A04","C2D7FFA7","B5D0CF31","2CD99E8B","5BDEAE1D","9B64C2B0","EC63F226","756AA39C","026D930A","9C0906A9","EB0E363F","72076785","05005713","95BF4A82","E2B87A14","7BB12BAE","0CB61B38","92D28E9B","E5D5BE0D","7CDCEFB7","0BDBDF21","86D3D2D4","F1D4E242","68DDB3F8","1FDA836E","81BE16CD","F6B9265B","6FB077E1","18B74777","88085AE6","FF0F6A70","66063BCA","11010B5C","8F659EFF","F862AE69","616BFFD3","166CCF45","A00AE278","D70DD2EE","4E048354","3903B3C2","A7672661","D06016F7","4969474D","3E6E77DB","AED16A4A","D9D65ADC","40DF0B66","37D83BF0","A9BCAE53","DEBB9EC5","47B2CF7F","30B5FFE9","BDBDF21C","CABAC28A","53B39330","24B4A3A6","BAD03605","CDD70693","54DE5729","23D967BF","B3667A2E","C4614AB8","5D681B02","2A6F2B94","B40BBE37","C30C8EA1","5A05DF1B","2D02EF8D"].join(" "),s=0,r=0,i=0;s=s^-1;for(let n=0,a=e.length;n<a;n++)i=(s^e.charCodeAt(n))&255,r="0x"+t.substr(i*9,8),s=s>>>8^r;return s^-1}function w7(e){return Math.abs(T7(e)%30)}function Qu(e,t,s){let r=e[t];return r!==void 0||(r=s(t),e[t]=r),r}var S7=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.POLY="POLY",e.STRING="STRING",e.AUX_LINE="AUXLINE",e.DIMENSION="DIMENSION",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(S7||{}),_7=(e=>(e.META="META",e.CANVAS="CANVAS",e.LAYER="LAYER",e.LAYER_PHYS="LAYER_PHYS",e.ACTIVE_LAYER="ACTIVE_LAYER",e.PARTITION="PARTITION",e.NET="NET",e.PRIMITIVE="PRIMITIVE",e.GROUP="GROUP",e.SILK_OPTS="SILK_OPTS",e.PREFERENCE="PREFERENCE",e.VIA="VIA",e.PAD="PAD",e.LINE="LINE",e.ARC="ARC",e.OBJ="OBJ",e.EQLEN_GRP="EQLEN_GRP",e.POLY="POLY",e.FILL="FILL",e.LAYER_FILL="LAYER_FILL",e.REGION="REGION",e.POUR="POUR",e.POURED="POURED",e.IMAGE="IMAGE",e.TEARDROP="TEARDROP",e.FPC_FILL="FPC_FILL",e.SHELL="SHELL",e.CREASE="CREASE",e.SHELLCUT="SHELLCUT",e.SHELL_ENTITY="SHELL_ENTITY",e.BOSS="BOSS",e.STRING="STRING",e.ATTR="ATTR",e.DIMENSION="DIMENSION",e.COMPONENT="COMPONENT",e.PAD_NET="PAD_NET",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.PANELIZE="PANELIZE",e.BOARD="BOARD",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(_7||{}),A7=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.ATTR="ATTR",e.LINE="LINE",e.WIRE="WIRE",e.BUS="BUS",e.TEXT="TEXT",e.POLY="POLY",e.CIRCLE="CIRCLE",e.ARC="ARC",e.BUSENTRY="BUSENTRY",e.RECT="RECT",e.MASK_REGION="MASK_REGION",e.PIN="PIN",e.OBJ="OBJ",e.COMPONENT="COMPONENT",e.PART="PART",e.ELLIPSE="ELLIPSE",e.BEZIER="BEZIER",e.TABLE="TABLE",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.NG_SETTING="NG_SETTING",e))(A7||{});function OP(e,t){return e.ticket===t.ticket?e.client<t.client:e.ticket<t.ticket}var Ut=class SO{static find(t,s){return t.last&&s(t.last)?t.last:t.list?t.list.find(s):null}static getFirstTicket(t){var r;if(!t)return 0;let s=SO.getHead(t);return(r=s==null?void 0:s.firstTicket)!=null?r:s==null?void 0:s.ticket}static getHead(t){var s;return((s=t==null?void 0:t.list)==null?void 0:s[0])||t.last}static getPreNode(t,s){if(t.last===s)return t.list?t.list[t.list.length-1]:null;let r=t.list.findIndex(i=>i===s);return t.list[r-1]}static remove(t,s){var r;if(t.last===s)t.last=((r=t.list)==null?void 0:r.pop())||null;else if(t.list){let i=t.list.findIndex(n=>n===s);i>-1&&t.list.slice(i,1)}}static getLength(t){let s=0;return t&&(t.last&&(s+=1),t.list&&(s+=t.list.length)),s}static insert(t,s){if(!t.last){t.last=s;return}if(OP(t.last,s)){let n=t.last;t.last=s,s=n}if(!t.list){t.list=[s];return}let r=0,i=t.list.length;for(;r<i;){let n=Math.floor((r+i)/2);OP(t.list[n],s)?r=n+1:i=n}t.list.splice(r,0,s)}static preForEach(t,s){if(!(!t.last||s(t.last))&&t.list)for(let r=t.list.length-1;r>=0&&!s(t.list[r]);--r);}},C7=["GROUP","POLY","STRING","AUXLINE","DIMENSION"],D7=["PARTITION","VIA","PAD","LINE","ARC","OBJ","POLY","FILL","REGION","POUR","POURED","IMAGE","TEARDROP","FPC_FILL","SHELL","CREASE","SHELLCUT","SHELL_ENTITY","BOSS","STRING","ATTR","DIMENSION","COMPONENT"],P7=["ATTR","WIRE","BUS","TEXT","POLY","CIRCLE","ARC","BUSENTRY","RECT","PIN","OBJ","COMPONENT","PART","ELLIPSE","BEZIER","TABLE","MASK_REGION"],O7=["SCH_PAGE","SIMULATION"],IP=e=>e==="PCB"||e==="FOOTPRINT"?0:1,_O=e=>e==="PCB"||e==="FOOTPRINT"?D7:e==="PANEL"||e==="PANEL_LIB"?C7:e==="SCH_PAGE"||e==="SYMBOL"||e==="SIMULATION"?P7:[];function xP(e,t,s){var h,p;let r=e.get(t),i=e.get(s),n=Ut.getHead(r),a=Ut.getHead(i),o=(h=n.firstTicket)!=null?h:n.ticket,c=(p=a.firstTicket)!=null?p:a.ticket,l=n.client,u=a.client;return o===c?l===u?t===s?0:t<s?-1:1:l<u?-1:1:o<c?-1:1}var I7=class{constructor(e){this.numSets={},this.orderCbArr=[],this.wDocData=e}orderChange(e){this.orderCbArr.push(e)}setOrderNum(e,t,s,r,i,n){var p,d;let a=r.last.dataType,o=1;if(a==="ELE_PLACEHOLDER"){let f=JSON.parse(r.last.data);a=f.dataType,o=f.max}else if(!((d=(p=_O(t))==null?void 0:p.includes)!=null&&d.call(p,a)))return;if(o<1)throw new Error("step must be greater than 0");let c=Qu(this.numSets[e].orderLists,a,()=>new bT((f,m)=>xP(this.wDocData.get(e),f,m))),l=Qu(this.numSets[e].maxNum,a,()=>IP(t)-1),u=this.wDocData.get(e).get(s);if(n&&(c.remove(s),l-=u.step||1),!Ut.getLength(u))return;u.num=0,o>1&&(u.step=o),c.insert(s),l+=o;let h=l;c.backwardTraverse(f=>{let m=this.wDocData.get(e).get(f);return m.num=h,i&&f!==s&&this.orderCbArr.forEach(g=>g(e,f,a,m.num)),h-=m.step||1,f!==s}),this.numSets[e].maxNum[a]=l}removeNode(e,t,s){let r=this.wDocData.get(e).get(s);if(r.num===void 0)return;let i=r.last.dataType,n=Qu(this.numSets[e].orderLists,i,()=>new bT((c,l)=>xP(this.wDocData.get(e),c,l))),a=Qu(this.numSets[e].maxNum,i,()=>IP(t)-1);a-=r.step||1;let o=a;n.backwardTraverse(c=>{if(c===s)return!0;let l=this.wDocData.get(e).get(c);return l.num=o,this.orderCbArr.forEach(u=>u(e,c,i,l.num)),o-=l.step||1,!1}),this.numSets[e].maxNum[i]=a,n.remove(s)}getOrderNum(e,t){var s,r,i;return(i=(r=(s=this.wDocData.get(e))==null?void 0:s.get)==null?void 0:r.call(s,t))==null?void 0:i.num}getMaxNum(e){var t;return((t=this.numSets[e])==null?void 0:t.maxNum)||{}}delete(e){this.numSets[e]&&delete this.numSets[e]}add(e){this.numSets[e]||(this.numSets[e]={orderLists:{},maxNum:{}})}has(e){return!!this.numSets[e]}},x7=(e=>(e.SOLID="SOLID",e.SHORT_DASH="SHORT_DASH",e.DOT="DOT",e.DOT_DASH="DOT_DASH",e))(x7||{}),v7=(e=>(e.PRINT="PRINT",e.COVER="COVER",e.PRINT_AND_COVER="PRINT&COVER",e))(v7||{}),R7=(e=>(e.LEFT="LEFT",e.CENTER="CENTER",e.RIGHT="RIGHT",e))(R7||{}),N7=(e=>(e.TOP="TOP",e.MIDDLE="MIDDLE",e.BOTTOM="BOTTOM",e))(N7||{}),L7=(e=>(e.LEFT_BOTTOM="LEFT_BOTTOM",e.CENTER_BOTTOM="CENTER_BOTTOM",e.RIGHT_BOTTOM="RIGHT_BOTTOM",e.LEFT_MIDDLE="LEFT_MIDDLE",e.CENTER_MIDDLE="CENTER_MIDDLE",e.RIGHT_MIDDLE="RIGHT_MIDDLE",e.LEFT_TOP="LEFT_TOP",e.CENTER_TOP="CENTER_TOP",e.RIGHT_TOP="RIGHT_TOP",e))(L7||{}),B7=(e=>(e.NONE="NONE",e.SOLID="SOLID",e.GRID="GRID",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e.RHOMBIC="RHOMBIC",e.LEFT_SLASH_LINE="LEFT_SLASH_LINE",e.RIGHT_SLASH_LINE="RIGHT_SLASH_LINE",e))(B7||{}),k7=(e=>(e.NONE="NONE",e.CLOCK="CLOCK",e.INVERTED="INVERTED",e.INVERTED_CLOCK="INVERTED_CLOCK",e))(k7||{}),M7=(e=>(e.NONE="NONE",e.GRID="GRID",e.OUTLETS="OUTLETS",e))(M7||{}),j7=(e=>(e.NONE="NONE",e.PUSH="PUSH",e.SURROUND="SURROUND",e.OBSTRUCT="OBSTRUCT",e.SURROUND_AND_PUSH="SURROUND&PUSH",e))(j7||{}),F7=(e=>(e.ELLIPSE="ELLIPSE",e.RECT="RECT",e.OVAL="OVAL",e.POLYGON="POLYGON",e))(F7||{}),U7=(e=>(e.ROUND="ROUND",e.RECT="RECT",e.SLOT="SLOT",e))(U7||{}),H7=(e=>(e.SOLID="SOLID",e.GRID_LINE="GRID_LINE",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e))(H7||{}),G7=(e=>(e.ALL="ALL",e.PAD="PAD",e.VIA="VIA",e))(G7||{}),Y7=(e=>(e.NONE="NONE",e.SINGLE="SINGLE",e.ALL="ALL",e))(Y7||{}),V7=(e=>(e.OPTIMIZA_OPEN="OPTIMIZA_OPEN",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(V7||{}),z7=(e=>(e.OPTIMIZA_STRONG="OPTIMIZA_STRONG",e.OPTIMIZA_WEAK="OPTIMIZA_WEAK",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(z7||{}),W7=(e=>(e.L45="L45",e.L90="L90",e.L="L",e.R45="R45",e.R90="R90",e.R="R",e))(W7||{}),q7=(e=>(e.NORMAL="NORMAL",e.BLIND="BLIND",e.SUTURE="SUTURE",e))(q7||{}),J7=(e=>(e.NORMAL="NORMAL",e.TEST="TEST",e.MARKER="MARKER",e))(J7||{}),K7=(e=>(e.DIVERGENCE="DIVERGENCE",e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(K7||{}),X7=(e=>(e.DOT="DOT",e.CENTER="CENT",e))(X7||{}),Z7=(e=>(e.NORMAL="NORMAL",e.BOARD_OUTLINE="BOARD_OUTLINE",e))(Z7||{}),$7=(e=>(e.SOLID="SOLID",e.GRID="GRID",e.PLANE="PLANE",e))($7||{}),Q7=(e=>(e.PROHIBIT="PROHIBIT",e.CONSTRAINT="CONSTRAINT",e))(Q7||{}),ej=(e=>(e.COMPONENT="COMPONENT",e.VIA="VIA",e.TRACK="TRACK",e.FILL="FILL",e.COPPER="COPPER",e.PLANE="PLANE",e))(ej||{}),tj=(e=>(e.PI="Polyimide",e.FR4="FR4",e.STEEL_SHEET="Stainless Steel",e.M3_DOUBLE_SIDED_TAPE="3M Tape",e.EMI_SHIELDING_FILM="EMI Shielding Film",e))(tj||{}),sj=(e=>(e.PUSH_COVER="DRAWER",e.UPPER_LOWER_SHELLS="T&B",e))(sj||{}),rj=(e=>(e.X_AXIS_POSITIVE="X_AXIS_POSITIVE",e.X_AXIS_NEGATIVE="X_AXIS_NEGATIVE",e.Y_AXIS_POSITIVE="Y_AXIS_POSITIVE",e.Y_AXIS_NEGATIVE="Y_AXIS_NEGATIVE",e))(rj||{}),ij=(e=>(e.SLOT="SLOT",e.ENTITY="ENTITY",e))(ij||{}),nj=(e=>(e.AUTO="AUTO",e.UPPER_SHELLS="UPPER_SHELLS",e.LOWER_SHELLS="LOWER_SHELLS",e))(nj||{}),aj=(e=>(e.OUTLINE="OUTLINE",e.SCREW_PILLAR="SCREW_PILLAR",e.ENTITY="ENTITY",e))(aj||{}),oj=(e=>(e.M2="M2",e.M3="M3",e.M4="M4",e.M5="M5",e.M6="M6",e))(oj||{}),cj=(e=>(e.LENGTH="LENGTH",e.RADIUS="RADIUS",e.ANGLE="ANGLE",e))(cj||{}),lj=(e=>(e.MIL="mil",e.INCH="inch",e.CM="cm",e.MM="mm",e))(lj||{}),uj=(e=>(e.SAFE="SAFE",e.OTHER="OTHER",e.TRACK="TRACK",e.BLIND="BLIND",e.RADIUS="RADIUS",e.PLANE="PLANE",e.COPPER="COPPER",e.PASTE="PASTE",e.SOLDER="SOLDER",e.DIFFER_ENTAIL="DIFFER_ENTAIL",e.NET_LENGTH="NET_LENGTH",e.AUTO_ROUTER="AUTO_ROUTER",e.NET_LENGTH_TOLERANCE="NET_LENGTH_TOLERANCE",e))(uj||{}),hj=(e=>(e.NORMAL="NORMAL",e.DEFAULT="DEFAULT",e))(hj||{}),dj=(e=>(e.ALL="ALL",e.LAYERED="LAYERED",e))(dj||{}),pj=(e=>(e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(pj||{}),fj=(e=>(e.FORTY_FIVE="L45",e.NINETY="L90",e.NINETY_ARC="A90",e))(fj||{}),mj=(e=>(e.LESS="LESS",e.MID="MID",e.MORE="MORE",e))(mj||{}),gj=(e=>(e.SPEED_FIRST="SPEED_FIRST",e.COMPLETION_FIRST="COMPLETION_FIRST",e))(gj||{}),yj=(e=>(e.DesignRule="DesignRule",e.Board="Board",e.SlotRegion="SlotRegion",e.ProhibitedRegion="ProhibitedRegion",e.ConstraintRegion="ConstraintRegion",e.Component="Component",e.Track="Track",e.TestPoint="TestPoint",e.Pad="Pad",e.Via="Via",e.SutureHole="SutureHole",e.Text="Text",e.ColorfulImage="ColorfulImage",e.Image="Image",e.FPCStiffener="FPCStiffener",e.Dimension="Dimension",e.CopperRegion="CopperRegion",e.FillRegion="Fill Region",e.Line="Line",e.Teardrop="Teardrop",e.D3Shell="D3Shell",e))(yj||{}),Ej=oh(f7());function ul(e,t,s,r,i,n){let a=[pr("SYMBOL",at(),e,s,r,i,n)],o={originX:0,originY:0};a.push(Zt("CANVAS",1,"CANVAS",JSON.stringify(o)));let c={title:""},l=at();a.push(Zt("PART",1,l,JSON.stringify(c)));let u={partId:l,groupId:"",locked:!1,zIndex:null,parentId:"",key:"Symbol",value:t||"",keyVisible:!1,valueVisible:!1,x:null,y:0,rotation:0,color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:!1,underline:null,italic:null,fontWeight:null,align:"LEFT_BOTTOM"};a.push(Zt("ATTR",1,at(),JSON.stringify(u)));let h={partId:l,groupId:"",locked:!1,zIndex:null,parentId:"",key:"Designator",value:"CBB?",keyVisible:!1,valueVisible:!1,x:null,y:0,rotation:0,color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:!1,underline:null,italic:null,fontWeight:null,align:"LEFT_BOTTOM"};a.push(Zt("ATTR",2,at(),JSON.stringify(h)));let p={partId:l,groupId:"",locked:!1,zIndex:null,parentId:"",key:"Name",value:"={Symbol}",keyVisible:!1,valueVisible:!1,x:null,y:0,rotation:0,color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:!1,underline:null,italic:null,fontWeight:null,align:"LEFT_BOTTOM"};a.push(Zt("ATTR",3,at(),JSON.stringify(p)));let d={partId:l,groupId:"",locked:!1,zIndex:null,dotX1:0,dotY1:0,dotX2:140,dotY2:-140,radiusX:0,radiusY:0,rotation:0,strokeColor:null,strokeStyle:null,fillColor:null,strokeWidth:null,fillStyle:null};return a.push(Zt("RECT",1,at(),JSON.stringify(d))),a.join(Le)}function Tn(e,t,s){let r="";return ET(e,(i,n)=>{let a=JSON.parse(i);if(n&&a.type==="DOCHEAD"){let o=JSON.parse(n);o.uuid=t[o.docType]||o.uuid,s&&(o.updateTime=s),n=JSON.stringify(o)}r?r=r+Le+i+Vn+n:r=i+Vn+n}),r}function bj(e,t){return e.fontFamily==t.fontFamily&&t.text==e.text&&Math.abs(e.fontSize-t.fontSize)<1e-5&&e.reverse==t.reverse&&e.expansion==t.expansion&&e.bold==t.bold&&e.italic==t.italic}function uo(e,t,s,r,i,n,a,o){return JSON.stringify([e||"",t||"",s,r,i?1:0,n?1:0,a?1:0,o])}function TT(e){let t=JSON.parse(e);return{text:t[0],fontFamily:t[1],fontSize:t[2],thickness:t[3],bold:!!t[4],italic:!!t[5],reverse:!!t[6],expansion:t[7]}}function Hi(e){let t=[];if(e)try{t=JSON.parse(e)}catch{t=[e]}return t}function Ap(e){return Ej.default.SHA256(e).toString()}function ep(e,t,s,r){let i="";return s?r?i=e+":"+t:i=e:r?i=t:i="",i}function Tj(e,t){if(!e||!e.startsWith("="))return e;e=e.slice(1);let s=/\{([^\}]+)\}/g,r=[],i=[];for(;r=s.exec(e);)i.push(r[1]);for(let n=0;n<i.length;n++){let a=i[n],o=`{${a}!}`;t.has(a)&&(o=t.get(a)),e=e.replace(`{${a}}`,o)}return e}var Un=class{static getInitProps(){return{stringData:{},dData:{},oData:{},attrData:{},cData:{}}}static collectPcb(e,t,s,r,i){s==="STRING"&&(i.stringData[e]||(i.stringData[e]={}),i.stringData[e][t]=r),s==="DIMENSION"&&(i.dData[e]||(i.dData[e]={}),i.dData[e][t]=r),s==="ATTR"&&(i.attrData[e]||(i.attrData[e]={}),i.attrData[e][t]=r),s==="COMPONENT"&&(i.cData[e]||(i.cData[e]={}),i.cData[e][t]=r),s==="OBJ"&&(i.oData[e]||(i.oData[e]={}),i.oData[e][t]=r)}static collectFt(e,t,s,r,i){s==="STRING"&&(i.stringData[e]||(i.stringData[e]={}),i.stringData[e][t]=r),s==="DIMENSION"&&(i.dData[e]||(i.dData[e]={}),i.dData[e][t]=r),s==="ATTR"&&(i.attrData[e]||(i.attrData[e]={}),i.attrData[e][t]=r),s==="OBJ"&&(i.oData[e]||(i.oData[e]={}),i.oData[e][t]=r)}static collectPanel(e,t,s,r,i){s==="POLY"&&(i.oData[e]||(i.oData[e]={}),i.oData[e][t]=r)}static collectSheet(e,t,s,r,i){s==="OBJ"&&(i.oData[e]||(i.oData[e]={}),i.oData[e][t]=r),s==="ATTR"&&(i.attrData[e]||(i.attrData[e]={}),i.attrData[e][t]=r)}static collectSymbol(e,t,s,r,i){s==="OBJ"&&(i.oData[e]||(i.oData[e]={}),i.oData[e][t]=r)}static pcb(e={},t={},s={},r){var o,c,l,u;let i={devices:new Set,symbols:new Set,footprints:new Set,blobs:new Set,fonts:new Set},n={};for(let h in r.oData)for(let p in r.oData[h]){let d=r.oData[h][p];if(!d)continue;let f=JSON.parse(d);f.path&&f.path.startsWith("blob:")&&i.blobs.add(f.path.split("blob:").pop())}for(let h in r.stringData)for(let p in r.stringData[h]){let d=r.stringData[h][p];if(!d)continue;let f=JSON.parse(d);f.fontFamily==="default"||!f.text||i.fonts.add(uo(f.text,f.fontFamily,f.fontSize/10,f.strokeWidth,f.bold,f.italic,f.reverse,f.expansion))}for(let h in r.dData)for(let p in r.dData[h]){let d=r.dData[h][p];if(!d)continue;let f=JSON.parse(d).text;f.fontFamily==="default"||!f.text||i.fonts.add(uo(f.text,f.fontFamily,f.fontSize/10,f.strokeWidth,f.bold,f.italic,f.reverse,f.expansion))}let a={};for(let h in r.attrData)for(let p in r.attrData[h]){let d=r.attrData[h][p];if(!d)continue;let f=JSON.parse(d);a[h]||(a[h]={}),a[h][p]=f,f.key==="Device"&&(n[h]||(n[h]={}),n[h][f.parentId]=f.value)}for(let h in a)for(let p in a[h]){let d=a[h][p];if(!d)continue;let f=d;switch(f.key){case"Device":{f.value&&i.devices.add(f.value);break}case"Symbol":{f.value&&i.symbols.add(f.value);break}case"Footprint":{f.value&&i.footprints.add(f.value);break}}if(f.fontFamily==="default")continue;let m=f.value;if(f.key==="Device"){let g=e[m]||m;m=ep(f.key,g,f.keyVisible,f.valueVisible)}else if(f.key==="Footprint"){let g=t[m]||m;m=ep(f.key,g,f.keyVisible,f.valueVisible)}else if(f.key==="Name"){let g=new Map;if(f.parentId){g.set("ID",f.parentId);let b=(c=(o=r.cData)==null?void 0:o[h])==null?void 0:c[f.parentId];if(b){let E=JSON.parse(b);if(Object.entries(E.attrs).forEach(y=>g.set(y[0],y[1])),(l=n==null?void 0:n[h])==null?void 0:l[f.parentId]){let y=(u=n==null?void 0:n[h])==null?void 0:u[f.parentId],T=s[y];T&&Object.entries(T).forEach(w=>g.set(w[0],w[1]))}}}m=ep(f.key,Tj(m,g),f.keyVisible,f.valueVisible)}else m=ep(f.key,m,f.keyVisible,f.valueVisible);m&&i.fonts.add(uo(m,f.fontFamily,f.fontSize/10,f.strokeWidth,f.bold,f.italic,f.reverse,f.expansion))}return i}static footprint(e){let t={blobs:new Set,fonts:new Set};for(let s in e.oData)for(let r in e.oData[s]){let i=e.oData[s][r];if(!i)continue;let n=JSON.parse(i);n.path&&n.path.startsWith("blob:")&&t.blobs.add(n.path.split("blob:").pop())}for(let s in e.stringData)for(let r in e.stringData[s]){let i=e.stringData[s][r];if(!i)continue;let n=JSON.parse(i);n.fontFamily==="default"||!n.text||t.fonts.add(uo(n.text,n.fontFamily,n.fontSize/10,n.strokeWidth,n.bold,n.italic,n.reverse,n.expansion))}for(let s in e.dData)for(let r in e.dData[s]){let i=e.dData[s][r];if(!i)continue;let n=JSON.parse(i).text;n.fontFamily==="default"||!n.text||t.fonts.add(uo(n.text,n.fontFamily,n.fontSize/10,n.strokeWidth,n.bold,n.italic,n.reverse,n.expansion))}for(let s in e.attrData)for(let r in e.attrData[s]){let i=e.attrData[s][r];if(!i)continue;let n=JSON.parse(i);if(n.fontFamily==="default"||!n.value)continue;let a=ep(n.key,n.value,n.keyVisible,n.valueVisible);t.fonts.add(uo(a,n.fontFamily,n.fontSize/10,n.strokeWidth,n.bold,n.italic,n.reverse,n.expansion))}return t}static panel(e){let t={blobs:new Set};for(let s in e.oData)for(let r in e.oData[s]){let i=e.oData[s][r];if(!i)continue;let n=JSON.parse(i);n.fillColor&&n.fillColor.startsWith("blob:")&&t.blobs.add(n.fillColor.split("blob:").pop())}return t}static sheet(e,t){let s={devices:new Set,symbols:new Set,footprints:new Set,blobs:new Set};for(let r in e.oData)for(let i in e.oData[r]){let n=e.oData[r][i];if(!n)continue;let a=JSON.parse(n);a.content&&a.content.startsWith("blob:")&&s.blobs.add(a.content.split("blob:").pop())}for(let r in e.attrData)for(let i in e.attrData[r]){let n=e.attrData[r][i];if(!n)continue;let a=JSON.parse(n);if(a.value)switch(a.key){case"Device":{s.devices.add(a.value);break}case"Symbol":{s.symbols.add(a.value),t&&(t[a.value]=a.parentId);break}case"Footprint":{s.footprints.add(a.value),t&&(t[a.value]=a.parentId);break}}}return{dataSet:s,parentIds:t}}static symbol(e){let t={blobs:new Set};for(let s in e.oData)for(let r in e.oData[s]){let i=e.oData[s][r];if(!i)continue;let n=JSON.parse(i);n.content&&n.content.startsWith("blob:")&&t.blobs.add(n.content.split("blob:").pop())}return t}},wj=oh(_p()),Sj=Object.create(null),s0=class extends y7{constructor(e){super(e),this.creators={},this.headCbArr=[],this.docHead={},this.uniqueIds={},this.cacheType=["META","DELETE_DOC","ELE_PLACEHOLDER","VARIANT_GROUPED"],this.historyMap={},this.clearTime=null,this.currentTime=0,this.wDocData=new Map,this.orderTree=new I7(this.wDocData)}onLine(e,t,s,r,i,n,a,o,c,l,u,h,p){this.remoteChange(t,i,a,e,s,r,n,void 0,o,c,l,void 0,void 0,void 0,p)}onDocHead(e,t){e.updateTime=e.updateTime||(t==null?void 0:t.updateTime),e.user=e.user||{uuid:t==null?void 0:t.uuid,username:t==null?void 0:t.username,nickname:t==null?void 0:t.nickname},this.setMaxTicket(e.ticket),this.docHead[e.uuid]?(!this.docHead[e.uuid].updateTime||this.docHead[e.uuid].updateTime<e.updateTime)&&(this.docHead[e.uuid].client=e.uuid,this.docHead[e.uuid].user=e.user,this.docHead[e.uuid].updateTime=e.updateTime,this.docHead[e.uuid].version=e.version,this.docHead[e.uuid].docType=e.docType,this.docHead[e.uuid].uuid=e.uuid,e.ticket&&e.ticket>this.docHead[e.uuid].ticket&&(this.docHead[e.uuid].ticket=e.ticket)):this.docHead[e.uuid]=e,this.creators[e.uuid]?this.creators[e.uuid].createTime>e.updateTime&&(this.creators[e.uuid].createTime=e.updateTime,this.creators[e.uuid].creator=e.user):this.creators[e.uuid]={createTime:e.updateTime,creator:e.user};for(let s of this.headCbArr)s(e,t)}onHeadChange(e){this.headCbArr.push(e)}setCacheData(e){this.getCache=e}setDoctype(e,t){this.docHead[e]?this.docHead[e].docType=t:this.docHead[e]={docType:t}}getDoctype(e){var t,s;return(s=(t=this.docHead)==null?void 0:t[e])==null?void 0:s.docType}getDataTicket(e,t){var s,r,i,n,a,o;return(o=(a=(n=(i=(r=(s=this.wDocData)==null?void 0:s.get)==null?void 0:r.call(s,e))==null?void 0:i.get)==null?void 0:n.call(i,t))==null?void 0:a.last)==null?void 0:o.ticket}getDataClient(e,t){var s,r,i,n,a,o;return(o=(a=(n=(i=(r=(s=this.wDocData)==null?void 0:s.get)==null?void 0:r.call(s,e))==null?void 0:i.get)==null?void 0:n.call(i,t))==null?void 0:a.last)==null?void 0:o.client}getAtomData(e,t){var s,r,i,n,a;return(a=(n=(i=(r=(s=this.wDocData)==null?void 0:s.get)==null?void 0:r.call(s,e))==null?void 0:i.get)==null?void 0:n.call(i,t))==null?void 0:a.last}getDataSize(e,t){var s,r,i,n;return Ut.getLength((n=(i=(r=(s=this.wDocData)==null?void 0:s.get)==null?void 0:r.call(s,e))==null?void 0:i.get)==null?void 0:n.call(i,t))}getFirst(e,t){var r,i,n,a,o;let s=(a=(n=(i=(r=this.wDocData)==null?void 0:r.get)==null?void 0:i.call(r,e))==null?void 0:n.get)==null?void 0:a.call(n,t);return((o=s==null?void 0:s.list)==null?void 0:o[0])||s.last}getFirstTicket(e,t){var s,r;return Ut.getFirstTicket((r=(s=this.wDocData.get(e))==null?void 0:s.get)==null?void 0:r.call(s,t))}getAllDataId(e){let t=[],s=e||this.wDocData.keys();for(let r of s){let i={doc:r,ids:[]},n=this.wDocData.get(r);if(n){for(let[a]of n)i.ids.push(a);i.ids.length&&t.push(i)}}return t}clear(){for(let[,e]of this.wDocData)e.clear();this.wDocData.clear(),this.creators={}}isHasData(e){if(e){if(this.uniqueIds[e]){for(let t in this.uniqueIds[e])if(this.uniqueIds[e][t].size)return!0}}else for(let[,t]of this.wDocData)for(let[,,]of t)return!0;return!1}delayClear(e=!0){this.clearTime||(this.clearTime=setTimeout(()=>{if(Date.now()-this.currentTime<5e3)this.clearTime=null,this.delayClear(!1);else{let t=!1;for(let s in this.historyMap)for(let r in this.historyMap[s])for(let i in this.historyMap[s][r])for(let n in this.historyMap[s][r][i])this.historyMap[s][r][i][n].promise?(this.clearTime=null,this.delayClear(!1),t=!0):(this.historyMap[s][r][i][n].cache.end(),this.historyMap[s][r][i][n].cache=null,delete this.historyMap[s][r][i][n]);!t&&(this.clearTime=null)}},5e3)),e&&(this.currentTime=Date.now())}getForeachKeys(e){let t=this.wDocData.keys(),s=[],r=[],i=[],n=[],a=[],o=[],c=[],l=[],u=[];for(let h of t)switch(this.getDoctype(h)){case"DEVICE":s.push(h);break;case"FOOTPRINT":i.push(h);break;case"SYMBOL":r.push(h);break;case"BOARD":n.push(h);break;case"SCH":a.push(h);break;case"SCH_PAGE":o.push(h);break;case"PCB":c.push(h);break;case"FONT":case"BLOB":u.push(h);break;default:l.push(h);break}return[...i,...r,...s,...n,...a,...o,...c,...l,...u]}getLastData(e,t,s){let r=this.wDocData.get(e);if(!r)return;let i=r.get(t);if(!i)return;let n=null;return Ut.preForEach(i,a=>!!a.pend==!!s?(n=a,!0):!1),n}revoke(){return!1}getPublishRevoke(e){let t={},s=(n,a,o,c,l,u,h)=>{var d,f,m;let p;h.length&&Ut.getLength(l)===h.length&&this.orderTree.has(n)&&(this.orderTree.removeNode(n,this.getDoctype(n),a),p=(m=(f=(d=this.orderTree.numSets)==null?void 0:d[n])==null?void 0:f.maxNum)==null?void 0:m[c.dataType],delete l.num),e&&e(n,a,u||"",o?o.client:c.client,o?o.ticket:c.ticket,c.client,c.ticket,o?o.pend:void 0,o?o.dataType:c.dataType,Ut.getFirstTicket(l),p),h.forEach(g=>Ut.remove(l,g))},r=(n,a,o,c,l,u)=>{var h;if(!this.getCache||!l||(h=l.data)!=null&&h.length||l.data===""||!l.hId)s(n,a,l,c,o,l==null?void 0:l.data,u);else{let p=l.dNum||0;t[l.hId]||(t[l.hId]={}),t[l.hId][l.hNum]||(t[l.hId][l.hNum]={}),t[l.hId][l.hNum][n]||(t[l.hId][l.hNum][n]=[]),t[l.hId][l.hNum][n][p]||(t[l.hId][l.hNum][n][p]=[]),t[l.hId][l.hNum][n][p].push([a,o,c,l,u])}},i=async(n,a,o,c,l)=>{let u=this.getCache(),h=gp(o,this.getDoctype(o));await u.init(n,a,h,c);for(let p of l){let[d,f,m,g,b]=p;if(f.last===m){let E=u.get(g.start);s(o,d,g,m,f,E,b)}else b.forEach(E=>Ut.remove(f,E))}};return{update:r,end:()=>{if(this.getCache){for(let n in t)for(let a in t[n])for(let o in t[n][a])for(let c in t[n][a][o])i(n,a,o,c,t[n][a][o][c]);t=null}}}}handleRevoke(e,t,s,r,i,n){let a=[];Ut.preForEach(s,o=>{if(o.pend&&(!i||o.client===i)){if(a.push(o),o===s.last){let c=Ut.getPreNode(s,o);if(n)for(;c&&c.pend;)a.push(c),c=Ut.getPreNode(s,c);r.update(e,t,s,o,c,a)}else a.forEach(c=>Ut.remove(s,c));return!0}return!1}),Ut.getLength(s)||this.wDocData.get(e).delete(t)}revokeOne(e,t,s){let r=this.wDocData.get(e);if(!r)return;let i=r.get(t);i&&this.handleRevoke(e,t,i,s)}foreachRevokeAll(e,t=this.getClient()){let s=this.getForeachKeys(),r=this.getPublishRevoke(e);for(let i of s){let n=this.wDocData.get(i);for(let[a,o]of n)this.handleRevoke(i,a,o,r,t,!0)}r.end()}revokeByUnique(e,t,s){let r=this.uniqueIds[e];if(r)for(let i in r)this.revokeAll(i,t,Array.from(r[i]),s),r[i].clear()}revokeAll(e,t,s,r){let i=this.wDocData.get(e);if(!i)return;let n=this.getPublishRevoke(r);for(let a of s){let o=i.get(a);o&&this.handleRevoke(e,a,o,n,t)}n.end()}findPreDataByTime(e,t,s,r,i){let n=this.wDocData.get(e);if(!n)return null;let a=n.get(t);if(!a)return null;let o=null,c=0;return Ut.preForEach(a,l=>{let u=i(l==null?void 0:l.hId,l==null?void 0:l.hNum);return u&&(u<s||u===s&&l.client<r)&&(o?(u>c||u===c&&l.client>o.client)&&(o=l,c=u):(o=l,c=u)),!1}),o}isFilterData(e,t,s){return!!(!e||t.ignoreType&&t.ignoreType.includes(e.dataType)||t.needType&&!t.needType.includes(e.dataType)||t.isPend&&!e.pend||s&&!t.needDelete&&t.needNum&&e.data==="")}getCanvasIds(e){var h;let t=0,s={},r={},i=[],n=[],a=10*1024*1024,o=0,c=(p,d,f)=>{var g;let m=f.last;if(m.pend||(g=m.data)!=null&&g.length){o+m.data.length>a&&(i.push(n),n=[]);let b=[p,d,m.ticket,m.client,m.dataType,m.data,m.pend];e.needNum&&b.push(f.num),n.push(b);return}s[p][m.client]||(s[p][m.client]={}),s[p][m.client][d]=[m.ticket],e.needNum&&s[p][m.client][d].push(f.num),t+=1},l=p=>{let d=p.last;return!!(e.ignoreType&&e.ignoreType.includes(d.dataType)||d.dataType==="ELE_PLACEHOLDER"||!e.needDelete&&d.data==="")};for(let p of e.doc){let d=(h=this.wDocData)==null?void 0:h.get(p);if(!d)continue;s[p]={};let f=this.getDoctype(p);if(e.needNum&&!["BLOB"].includes(f)&&!this.orderTree.has(p)){this.orderTree.add(p);let m=Array.from(d.keys()).sort((g,b)=>{let E=Ut.getHead(d.get(g)),y=Ut.getHead(d.get(b)),T=E.firstTicket||E.ticket,w=y.firstTicket||y.ticket;return T===w?E.client>y.client?1:-1:T-w});for(let g of m){let b=d.get(g);b&&(b.num&&(b.num=void 0),this.orderTree.setOrderNum(p,f,g,b,!1),!l(b)&&c(p,g,b))}}else for(let[m,g]of d)l(g)||c(p,m,g);r[p]=this.orderTree.getMaxNum(p)}n.length&&(i.push(n),n=null);let u;return i.length&&(u=at(),(0,wj.flowWrite)(u,async p=>{for(let d of i)await p.write(JSON.stringify(d)),d.length=0;i.length=0},void 0,void 0)),{ids:s,maxNum:r,size:t,channel:u}}async compress(e,t,s){var S,_,C,x,D,I,P,L,F,V,B,k,O,R,v,j,M,H,q,Q,oe,me,Ee,Pe,Oe,Fe,G,pe,ge,ie,$,ae,ye,Be,be,xe,je,ke,Xe,gt,it;let{updateTime:r,versions:i,keepClient:n,keepFirst:a,notDocHead:o,isPend:c,user:l}=e,{headTicket:u,clearDelete:h,needNum:p,uniqueId:d,client:f,extractData:m}=e,{removeBoard:g,eIds:b}=e,E=e.docIds||(b?[]:void 0),y=h&&!!m;if(d&&this.uniqueIds[d]&&(E=Object.keys(this.uniqueIds[d]),e.docIds&&(E=E.filter(Ve=>e.docIds.includes(Ve)))),E||(E=this.getForeachKeys(y)),b)for(let Ve in b)E.some(as=>as===Ve)||E.push(Ve);let T,w;y&&(T=new Set,w=new Set);for(let Ve of E){let as=(S=this.wDocData)==null?void 0:S.get(Ve);if(!as){p&&!["FONT","BLOB"].includes(Ve)&&!this.orderTree.has(Ve)&&this.orderTree.add(Ve);continue}let Ds=r||((C=(_=this.docHead)==null?void 0:_[Ve])==null?void 0:C.updateTime)||new Date().getTime(),A=(i==null?void 0:i[Ve])||((D=(x=this.docHead)==null?void 0:x[Ve])==null?void 0:D.version)||String(Ds),N=this.getDoctype(Ve);if(h){let J=as.get("DELETE_DOC");if(J&&J.last.data&&((I=JSON.parse(J.last.data))!=null&&I.isDelete)){if(O7.includes(N)){let ne=as.get("META"),ue=ne?JSON.parse(ne.last.data):null,Ie=!!ue;if(N==="SCH_PAGE"&&Ie){let Ue=(P=this.wDocData)==null?void 0:P.get(ue.schematic),Ye=(F=(L=Ue.get("DELETE_DOC"))==null?void 0:L.last)==null?void 0:F.data;Ie=Ue&&(!Ye||Ye&&!((V=JSON.parse(Ye))!=null&&V.isDelete))}if(Ie){let Ue=pr(((k=(B=this.docHead)==null?void 0:B[Ve])==null?void 0:k.docType)||this.mainDocType,f||this.getClient(),Ve,Ds,A,l||((R=(O=this.docHead)==null?void 0:O[Ve])==null?void 0:R.user),u||((j=(v=this.docHead)==null?void 0:v[Ve])==null?void 0:j.ticket));s(Ue)?await t(Ue,!0):t(Ue,!0);let Ye=Zt("DELETE_DOC",Ut.getFirstTicket(J),"DELETE_DOC",J.last.data);if(s(Ye)?await t(Ye):t(Ye),ne){let Qe=as.get(ue.schematic);if(Qe&&Qe.last.dataType==="META_PLACEHOLDER"){let ar=Zt("META_PLACEHOLDER",Ut.getFirstTicket(Qe),ue.schematic,Qe.last.data);s(ar)?await t(ar):t(ar)}let ws=Zt("META",Ut.getFirstTicket(ne),"META",ne.last.data);s(ws)?await t(ws):t(ws)}}}continue}}let Y;if(Ve==="FONT"&&T){Y=[];for(let J of T)Y.push(TT(J))}if(!o){let J=pr(((H=(M=this.docHead)==null?void 0:M[Ve])==null?void 0:H.docType)||this.mainDocType,f||this.getClient(),Ve,Ds,A,l||((Q=(q=this.docHead)==null?void 0:q[Ve])==null?void 0:Q.user),u||((me=(oe=this.docHead)==null?void 0:oe[Ve])==null?void 0:me.ticket));d&&this.onDocHead({docType:((Pe=(Ee=this.docHead)==null?void 0:Ee[Ve])==null?void 0:Pe.docType)||this.mainDocType,uuid:Ve,client:f||this.getClient(),updateTime:Ds,version:A,user:l||((Fe=(Oe=this.docHead)==null?void 0:Oe[Ve])==null?void 0:Fe.user),ticket:u||((pe=(G=this.docHead)==null?void 0:G[Ve])==null?void 0:pe.ticket)}),s(J)?await t(J,!0):t(J,!0)}if(!o&&e.needCreator){let J=pr(((ie=(ge=this.docHead)==null?void 0:ge[Ve])==null?void 0:ie.docType)||this.mainDocType,f||this.getClient(),Ve,(ae=($=this.creators)==null?void 0:$[Ve])==null?void 0:ae.createTime,A,(Be=(ye=this.creators)==null?void 0:ye[Ve])==null?void 0:Be.creator,u||((xe=(be=this.docHead)==null?void 0:be[Ve])==null?void 0:xe.ticket));s(J)?await t(J):t(J)}let z;if(d&&(z=Array.from(this.uniqueIds[d][Ve]),this.uniqueIds[d][Ve].clear(),delete this.uniqueIds[d][Ve]),b&&b[Ve]&&(z=b[Ve]),z||(z=p||h?Array.from(as.keys()).sort((J,ne)=>{let ue=Ut.getHead(as.get(J)),Ie=Ut.getHead(as.get(ne)),Ue=ue.firstTicket||ue.ticket,Ye=Ie.firstTicket||Ie.ticket;return Ue===Ye?ue.client>Ie.client?1:-1:Ue-Ye}):Array.from(as.keys())),p&&!["FONT","BLOB"].includes(N)&&!this.orderTree.has(Ve)){this.orderTree.add(Ve);for(let J of z){let ne=as.get(J);ne&&(this.isFilterData(ne.last,e,!1)||(ne.num&&(ne.num=void 0),this.orderTree.setOrderNum(Ve,N,J,ne,!1)))}}let U={},Z=Un.getInitProps();for(let J of z){let ne=as.get(J);if(!ne)continue;let ue;if(d?Ut.preForEach(ne,Ye=>Ye.unique===d?(ue=Ye,delete Ye.unique,delete Ye.pend,Ye===ne.last&&this.cbArr.forEach(Qe=>Qe(Ve,J,Ye.data,Ye.dataType,Ye.client,Ye.ticket,Ut.getFirstTicket(ne),void 0,void 0,!0,void 0)),!0):!1):ue=ne.last,this.isFilterData(ue,e,!0))continue;if(y&&Ve==="FONT"&&Y){let Ye=TT(J);if(!Y.some(Qe=>bj(Ye,Qe)))continue}if(y&&Ve==="BLOB"&&!w.has(J))continue;if(c&&ue.pend&&(delete ue.pend,this.cbArr.forEach(Ye=>Ye(Ve,J,ue.data,ue.dataType,ue.client,ue.ticket,Ut.getFirstTicket(ne),void 0,void 0,!0,void 0))),h){if(ue.dataType==="ELE_PLACEHOLDER"){let Qe=JSON.parse(ue.data);U[Qe.dataType]===void 0?U[Qe.dataType]=Qe.max:U[Qe.dataType]+=Qe.max;continue}let Ye=_O(N);if(Ye&&Ye.includes(ue.dataType))if(ue.data!==""){if(U[ue.dataType]){let Qe={dataType:ue.dataType,max:U[ue.dataType]},ws=Zt("ELE_PLACEHOLDER",Ut.getFirstTicket(ne)-1,at(),JSON.stringify(Qe));s(ws)?await t(ws):t(ws),delete U[ue.dataType]}}else{U[ue.dataType]===void 0?U[ue.dataType]=1:++U[ue.dataType];continue}}let Ie=ue.data;if(this.getCache&&ue.hId&&ue.data===void 0){let Ye=ue.dNum||0,Qe=gp(Ve,N);if(!((it=(gt=(Xe=(ke=(je=this.historyMap)==null?void 0:je[ue.hId])==null?void 0:ke[ue.hNum])==null?void 0:Xe[Qe])==null?void 0:gt[Ye])!=null&&it.cache)){this.historyMap[ue.hId]||(this.historyMap[ue.hId]={}),this.historyMap[ue.hId][ue.hNum]||(this.historyMap[ue.hId][ue.hNum]={}),this.historyMap[ue.hId][ue.hNum][Qe]||(this.historyMap[ue.hId][ue.hNum][Qe]={}),this.historyMap[ue.hId][ue.hNum][Qe][Ye]||(this.historyMap[ue.hId][ue.hNum][Qe][Ye]={cache:null,promise:null});let ws=this.getCache();this.historyMap[ue.hId][ue.hNum][Qe][Ye].cache=ws;let ar=ws.init(ue.hId,ue.hNum,Qe,Ye);this.historyMap[ue.hId][ue.hNum][Qe][Ye].promise=ar,await ar,delete this.historyMap[ue.hId][ue.hNum][Qe][Ye].promise}this.historyMap[ue.hId][ue.hNum][Qe][Ye].promise&&await this.historyMap[ue.hId][ue.hNum][Qe][Ye].promise,Ie=this.historyMap[ue.hId][ue.hNum][Qe][Ye].cache.get(ue.start)}if(ue.dataType==="META"&&g&&g.includes(Ve)&&Ie){let Ye=JSON.parse(Ie);Ye.board&&(Ye.board="",Ie=JSON.stringify(Ye))}let Ue=Zt(ue.dataType,ue.ticket,J,Ie,n?ue.client:void 0,a&&ue.ticket!==Ut.getFirstTicket(ne)?Ut.getFirstTicket(ne):void 0,void 0,p?ne.num:void 0);if(y)switch(N){case"PCB":{Un.collectPcb(Ve,J,ue.dataType,Ie,Z);break}case"FOOTPRINT":{Un.collectFt(Ve,J,ue.dataType,Ie,Z);break}case"PANEL":{Un.collectPanel(Ve,J,ue.dataType,Ie,Z);break}case"SYMBOL":{Un.collectSymbol(Ve,J,ue.dataType,Ie,Z);break}case"SCH_PAGE":case"SIMULATION":{Un.collectSymbol(Ve,J,ue.dataType,Ie,Z);break}default:break}s(Ue)?await t(Ue):t(Ue)}if(p){let J=Zt("MAX_NUM",1,"MAX_NUM",JSON.stringify(this.orderTree.getMaxNum(Ve)));s(J)?await t(J):t(J)}if(y){let J;switch(N){case"PCB":{J=Un.pcb(m.deviceNames,m.footprintNames,m.deviceAttrs,Z);break}case"FOOTPRINT":{J=Un.footprint(Z);break}case"PANEL":{J=Un.panel(Z);break}case"SYMBOL":{J=Un.symbol(Z);break}case"SCH_PAGE":case"SIMULATION":{J=Un.sheet(Z).dataSet;break}default:break}if(J!=null&&J.fonts)for(let ne of J.fonts)T.add(ne);if(J!=null&&J.blobs)for(let ne of J.blobs)w.add(ne)}}}compressFull(e={}){if(this.getCache)throw new Error("\u6570\u636E\u5DF2\u7F13\u5B58\u5230 cacheStorage, \u4E0D\u5141\u8BB8\u540C\u6B65\u83B7\u53D6");let t=[],s=r=>{t.push(r)};return this.compress(e,s,()=>!1),t.join(Le)}async chunkCompressFull(e={}){let{chunkLength:t=20*1024*1024}=e,s=new Array,r=[],i=0,n="",a=c=>this.getCache?i+c.length>t:!1,o=async(c,l)=>{i+c.length>t&&(r.push(s.join(Le)),s.length=0,!l&&s.push(n),i=0),l&&(n=c),s.push(c),i+=c.length+Le.length};return await this.compress(e,o,a),s.length>0&&(r.push(s.join(Le)),s.length=0,i=0),this.getCache&&this.delayClear(),r}async asyncCompressFull(e={}){let t=[],s=r=>{t.push(r)};return await this.compress(e,s,()=>!1),this.delayClear(),t.join(Le)}async flowCompressFull(e){let{writer:t,chunkLength:s=1e7}=e,r=new Array,i=0,n=o=>i+o.length>s,a=async o=>{i+o.length>s&&(await t(r.join(Le)),r.length=0,r.push(""),i=0),r.push(o),i+=o.length+Le.length};await this.compress(e,a,n),r.length>0&&(await t(r.join(Le)),r.length=0,i=0),this.delayClear()}removeCache(e){if(e)for(let t=0;t<e.length;t++)this.wDocData.delete(e[t]);else this.wDocData.clear()}setMainDoctype(e){this.mainDocType=e}onChange(e){this.cbArr.push(e)}localChange(e,t,s,r,i){let n=this.getMaxTicket()+1;return this.remoteChange(n,this.getClient(),e,t,s,r,i,!0,void 0,!0,void 0,this.getUnique()),n}safeString(e){return e&&(e in Sj,e)}remoteChange(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f){var C,x,D,I,P;this.setMaxTicket(e),a&&this.setDoctype(s,a),o=o||h===this.getUnique();let m=(I=(D=(x=(C=this.wDocData)==null?void 0:C.get)==null?void 0:x.call(C,s))==null?void 0:D.get(r))==null?void 0:I.last;h&&(this.uniqueIds[h]||(this.uniqueIds[h]={}),this.uniqueIds[h][s]||(this.uniqueIds[h][s]=new Set),this.uniqueIds[h][s].add(r)),this.wDocData.get(s)||this.wDocData.set(s,new Map),this.wDocData.get(s).has(r)||this.wDocData.get(s).set(r,{last:null});let g=this.wDocData.get(s).get(r),b=m?Ut.getFirstTicket(g):null,E=m&&m.ticket===e&&m.client===t&&!!m.pend!=!!l,y=n!=="ELE_PLACEHOLDER"&&(!o||o&&this.getIsLocalChange())&&(!E||E&&this.getIsPendChange()),T=Ut.find(g,L=>L.client===t&&L.ticket===e);if(T){f&&(T.hId=f.uuid,T.hNum=f.num,T.start=f.start,f.dNum&&(T.dNum=f.dNum)),this.getCache&&!this.cacheType.includes(n)&&((P=T.data)!=null&&P.length)&&(T!=null&&T.hId)&&delete T.data,T.pend&&!l&&(delete T.pend,y&&T===g.last&&this.cbArr.forEach(L=>L(s,r,i,n,t,e,Ut.getFirstTicket(g),l,void 0,E,h)));return}let w=e;if(l){let L=[];Ut.preForEach(g,F=>F.client===t&&F.pend&&F.ticket<e?(L.push(F),!0):!1),L.length&&L.length===Ut.getLength(g)&&(w=b||e),L.forEach(F=>{Ut.remove(g,F)})}let S={client:t,ticket:w,dataType:n};f&&(S.hId=f.uuid,S.hNum=f.num,S.start=f.start,f.dNum&&(S.dNum=f.dNum)),(!this.getCache||!S.hId||!i||this.cacheType.includes(n)||l)&&(S.data=l?i:this.safeString(i)),c!==void 0&&(S.firstTicket=c),l!==void 0&&(S.pend=l),h!==void 0&&(S.unique=h);let _=!m||m.ticket<e||m.ticket===e&&m.client<t;if(Ut.insert(g,S),this.orderTree.has(s)&&(!m||b>e))try{this.orderTree.setOrderNum(s,this.getDoctype(s),r,g,!0,b&&b>e)}catch(L){console.error(L)}if(_){let L=Ut.getFirstTicket(g);y&&this.cbArr.forEach(F=>F(s,r,i,n,t,e,L,l,void 0,E,h))}}};function _j(e,t){return e.ticket===t.ticket?e.client===t.client?e.id===t.id?0:e.id<t.id?-1:1:e.client<t.client?-1:1:e.ticket<t.ticket?-1:1}var Aj=class{constructor(e=1){this.startNum=e,this.orderLists={},this.idOrderLists=new Map,this.cbArr=new Array,this.maxNum={}}orderChange(e){this.cbArr.push(e)}setOrderNum(e,t,s,r,i=1){if(i<1)throw new Error("step must be greater than 0");let n=Qu(this.orderLists,t,()=>new bT(_j)),a=Qu(this.maxNum,t,()=>this.startNum-1),o=this.idOrderLists.get(e);if(o){if(o.ticket<=s)return;n.remove(o),a-=o.step}let c={id:e,ticket:s,num:0,client:r,step:i};this.idOrderLists.set(e,c),n.insert(c),a+=i;let l=a,u=0;n.backwardTraverse(h=>(u++,h.num=l,this.cbArr.forEach(p=>p(h.id,t,h.num)),l-=h.step,h!==c)),this.maxNum[t]=a,u>1e4&&(console.log("------------------ notify --------",c,"height: ",n.getHeight(),"total: ",n.getSize(),"notifies: ",u),console.log("------------------ all --------"))}getOrderNum(e){var t;return(t=this.idOrderLists.get(e))==null?void 0:t.num}getMaxNum(e){var t;return((t=this.orderLists[e])==null?void 0:t.getSize())||0}clearNum(){this.idOrderLists.clear();for(let e in this.orderLists)delete this.orderLists[e]}};function AO(e){switch(e=String(e),e){case"1":return"SAFE";case"2":return"OTHER";case"3":return"TRACK";case"4":return"BLIND";case"5":return"RADIUS";case"6":return"PLANE";case"7":return"COPPER";case"8":return"PASTE";case"9":return"SOLDER";case"10":return"DIFFER_ENTAIL";case"11":return"NET_LENGTH";case"12":return"AUTO_ROUTER";case"13":return"NET_LENGTH_TOLERANCE"}return e}function tp(e){if(!e)return{};let t=["1","2","3","4","5","6","7","8","9","10","11","12","13"];for(let s of t)if(e.hasOwnProperty(s)){let r=e[s];delete e[s],e[AO(s)]=r}return e}var Cj=(e=>(e[e.TRACK=0]="TRACK",e[e.SMDPad=1]="SMDPad",e[e.THPad=2]="THPad",e[e.SMD_Test_Point=3]="SMD_Test_Point",e[e.TH_Test_Point=4]="TH_Test_Point",e[e.VIA=5]="VIA",e[e.REGION=6]="REGION",e[e.PLANE=7]="PLANE",e[e.SLOT=8]="SLOT",e[e.LINE=9]="LINE",e[e.OTHER=10]="OTHER",e[e.SHEETFRAME=11]="SHEETFRAME",e[e.Hole=12]="Hole",e[e.Copper=13]="Copper",e[e.Inner=14]="Inner",e[e.PROHIBITAREA=15]="PROHIBITAREA",e[e.COMPONENT=16]="COMPONENT",e))(Cj||{}),vP=class{constructor(){this.init=!1,this.defaultSafeData=null,this.defaultCopperSpace=null,this.defaultInnerSpace=null,this.copperChangeMap=new Map,this.innerChangeMap=new Map}addDefaultSafeSpaceData(e){this.init=!0,this.defaultSafeData=e}addDefaultCopperSpace(e,t){this.defaultCopperSpace={netClearance:e,boardClearance:t}}addDefaultInnerSpace(e,t){this.defaultInnerSpace={netClearance:e,boardClearance:t}}getNewDefaultData(e,t){if(e&&this.defaultSafeData==null||!e&&this.defaultInnerSpace==null)return null;let s=e?this.copperChangeMap.get(t):this.innerChangeMap.get(t);if(s==null)return null;let{netClearance:r,boardClearance:i}=s,n=this.defaultSafeData.safeSpacing[0].content,a=new Array(n.length);for(let o=0;o<n.length;o++)a[o]=Array.from(n[o]);return this.updateSafeData(a,r,i),a}fixSafeData(e){if(this.defaultCopperSpace!=null)for(let t of e.safeSpacing)this.updateSafeData(t.content,this.defaultCopperSpace.netClearance,this.defaultCopperSpace.netClearance)}updateSafeData(e,t,s){for(let r=0;r<e.length;r++){let i=e[r];for(let n=0;n<i.length;n++)r==7?n==11||n==8?i[n]=s:i[n]=t:n==7&&(r==11||r==8?i[n]=s:i[n]=t)}}addCopper2SafeChangeMap(e,t,s,r,i){this.copperChangeMap.set(e,{name:t,isDefault:s,netClearance:r,boardClearance:i})}addInner2SafeChangeMap(e,t,s,r,i){this.innerChangeMap.set(e,{name:t,isDefault:s,netClearance:r,boardClearance:i})}getSafeName4Copper(e){var t;return(t=this.copperChangeMap.get(e))==null?void 0:t.name}getSafeName4Plane(e){var t;return(t=this.innerChangeMap.get(e))==null?void 0:t.name}getDefaultCopper(){for(let[,e]of this.copperChangeMap)if(e.isDefault)return e.name;return null}getDefaultPlane(){for(let[,e]of this.innerChangeMap)if(e.isDefault)return e.name;return null}};function RP(e,t){let s=e,r={TWO_LAYERS_BOARD:"JLCPCB Capability(Two Layers Board)",SINGLE_LAYER_BOARD:"JLCPCB Capability(Single Layer Board)",MULTIPLE_LAYERS_BOARD:"JLCPCB Capability(Multiple Layers Board)",HIGH_FREQUENCY_BOARD:"JLCPCB Capability(High Frequency Board)",ALUMINUM_SUBSTRATE_BOARD:"JLCPCB Capability(Aluminum Substrate Board)",COPPER_SUBSTRATE_BOARD:"JLCPCB Capability(Copper Substrate Board)"};if(s.length==8){Object.values(r).includes(t)&&(s[4][0]=11.811,s[5][4]=11.811),s.splice(1,0,s[1].slice(0));for(let n=2;n<s.length;n++)s[n].splice(1,0,s[n][1]);s.push([].concat(s[1][0],s.slice(1).map(n=>n[1])))}s[1].push(s[1][s[1].length-1]),s.splice(3,0,[...s[1]]),s.splice(4,0,[...s[2]]),s[1].pop();for(let n=5;n<s.length;n++)s[n].splice(3,0,s[n][1]),s[n].splice(4,0,s[n][2]);s[3][3]=s[1][1],s[4][3]=s[2][1],s[4][4]=s[2][2];let i=6;s.splice(7,0,new Array(7).fill(i));for(let n=7;n<s.length;n++)s[n].splice(7,0,i);return s}function Dj(e,t){let s=e[0],r=e[1],i=[],n="ALL";if(r instanceof Array){let a=RP(r,t);i.push({layerId:1,isOpen:!0,content:a})}else{for(let a in r){let o=r[a],c=RP(o,t);i.push({layerId:+a,isOpen:!0,content:c})}Object.keys(r).length>1&&(n="LAYERED")}return{unit:s,isForAll:n,safeSpacing:i}}function Pj(e){let t=e[0],s=e[1],r=e[2];isNaN(r)&&(r=0);let i=e[3];return isNaN(i)&&(i=11.8),{unit:t,deviceClearance:s,thru2SmdClearance:r,holeClearance:i}}function Oj(e){let t=e[0],s=e[1],r=!0,i=[];if(s instanceof Object)for(let n in s){let a=s[n];i.push({layerId:+n,stroMin:a[0],stroDef:a[1],stroMax:a[2]})}else i.push({layerId:1,stroMin:e[1],stroDef:e[2],stroMax:e[3]});return{unit:t,track:{isOpen:r,content:i}}}function Ij(e){return{unit:e[0],netLenMin:e[1],netLenMax:e[2]}}function xj(e){return{unit:e[0],netLengthTolerance:e[1]}}function vj(e){let t=e[0],s=e[1],r=!0,i=[],n=[],a=0;if(s instanceof Object)for(let o in s){let c=s[o],{stroke:l,spacing:u,lenTolerMax:h}=c;i.push({layerId:+o,stroMin:l[0],stroDef:l[1],stroMax:l[2]}),n.push({layerId:+o,spacMin:u[0],spacDef:u[1]}),a=h}else i.push({layerId:1,stroMin:e[1],stroDef:e[2],stroMax:e[3]}),n.push({layerId:1,spacMin:e[4],spacDef:e[5]}),a=e[7];return{unit:t,stroWidth:{isOpen:r,content:i},spacing:{isOpen:r,content:n},differPairLenTolerMax:a}}function Rj(e){let t=new Array;for(let s of e){let r=+s[1],i=+s[2];isNaN(r)||r<=0||isNaN(i)||i<=0||r===i||r===1&&i===2||r===2&&i===1||t.push({name:s[0],staLayerId:r,endLayerId:i,viaSizeRule:s[3]})}return{blinds:{content:t}}}function Nj(e){return{unit:e[0],minRadius:e[1],defRadius:e[2],maxRadius:e[3],minInner:e[4],defInner:e[5],maxInner:e[6]}}function Lj(e){let t=[{layerId:1,connType:rh(e[7]!==void 0?e[7]:e[3]),spoWidth:e[8]!==void 0?e[8]:e[4],spoSpac:e[9]!==void 0?e[9]:e[5],spoAng:e[10]?e[10]:e[6]}];return{unit:e[0],mulPad:{isOpen:!0,content:t}}}function Bj(e){let t=[{layerId:1,connType:rh(e[3]),spoWidth:e[4],spoSpac:e[5],spoAng:e[6]}],s=[{layerId:1,connType:Number(e[7])?"NON_CONNECT":"DIRECT"}],r=[{layerId:1,connType:rh(e[8]!==void 0?e[8]:e[3]),spoWidth:e[9]!==void 0?e[9]:e[4],spoSpac:e[10]!==void 0?e[10]:e[5],spoAng:e[11]?e[11]:e[6]}];return{unit:e[0],sglPad:{isOpen:!0,content:t},mulPad:{isOpen:!0,content:r},track:{isOpen:!0,content:s}}}function kj(e){return{unit:e[0],padTopExpan:e[1],padBotExpan:e[2],testPointTopExpan:e[3]?e[3]:-1e3,testPointBotExpan:e[4]?e[4]:-1e3}}function Mj(e){return{unit:e[0],padTopExpan:e[1],padBotExpan:e[2],viaTopExpan:e[3],viaBotExpan:e[4],testPointTopExpan:e[5]?e[5]:2,testPointBotExpan:e[6]?e[6]:2}}function jj(e){function t(i){switch(i=i&&Number(i),i){case 0:return"L45";case 1:return"L90";case 2:return"A90";default:return"L45"}}function s(i){switch(i=i&&Number(i),i){case 0:return"LESS";case 1:return"MID";case 2:return"MORE";default:return"LESS"}}function r(i){switch(i=i&&Number(i),i){case 0:return"SPEED_FIRST";case 1:return"COMPLETION_FIRST";default:return"COMPLETION_FIRST"}}return{routingCorner:t(e[0]),isKeep:!!e[1],viaQuantity:s(e[2]),routingEffectPriority:r(e[3]),layers:e[5],ignoreNets:e[6]}}function rh(e){switch(e=e&&Number(e),e){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}function Fj(e,t){let s=t;switch(e){case"SAFE":{let r=t;if(r.isForAll=r.isForAll?"LAYERED":"ALL",r.safeSpacing)for(let i of r.safeSpacing)i.isOpen=!!i.isOpen;s=r;break}case"OTHER":break;case"TRACK":{let r=t;r!=null&&r.track&&(r.track.isOpen=!!r.track.isOpen),s=r;break}case"NET_LENGTH":break;case"NET_LENGTH_TOLERANCE":break;case"DIFFER_ENTAIL":{let r=t;r!=null&&r.stroWidth&&(r.stroWidth.isOpen=!!r.stroWidth.isOpen),r!=null&&r.spacing&&(r.spacing.isOpen=!!r.spacing.isOpen),s=r;break}case"BLIND":break;case"RADIUS":break;case"PLANE":{let r=t;if(r!=null&&r.mulPad&&(r.mulPad.isOpen=!!r.mulPad.isOpen),r.mulPad&&r.mulPad.content)for(let i of r.mulPad.content)i.connType=rh(i.connType);s=r;break}case"COPPER":{let r=t;if(r!=null&&r.sglPad&&(r.sglPad.isOpen=!!r.sglPad.isOpen),r!=null&&r.mulPad&&(r.mulPad.isOpen=!!r.mulPad.isOpen),r!=null&&r.track&&(r.track.isOpen=!!r.track.isOpen),r.track&&r.track.content&&(r.track.content=r.track.content.map(i=>(i.connType=Number(i.connType)?"NON_CONNECT":"DIRECT",i))),r.sglPad&&r.sglPad.content)for(let i of r.sglPad.content)i.connType=rh(i.connType);if(r.mulPad&&r.mulPad.content)for(let i of r.mulPad.content)i.connType=rh(i.connType);s=r;break}case"PASTE":break;case"SOLDER":break;case"AUTO_ROUTER":break}return s}function Uj(e,t,s,r,i,n){if(!(r instanceof Array))return Fj(e,r);let a,o=!1;switch(s&&(s==="NORMAL"?o=!1:s==="DEFAULT"&&(o=!0)),e){case"SAFE":{a=Dj(r,n),o&&i.addDefaultSafeSpaceData(a);break}case"OTHER":{a=Pj(r);break}case"TRACK":{a=Oj(r);break}case"NET_LENGTH":{a=Ij(r);break}case"NET_LENGTH_TOLERANCE":{a=xj(r);break}case"DIFFER_ENTAIL":{a=vj(r);break}case"BLIND":{a=Rj(r);break}case"RADIUS":{a=Nj(r);break}case"PLANE":{let c=r[1],l=r[2];o&&i.addDefaultInnerSpace(c,l),i.addInner2SafeChangeMap(t,"Plane_"+t,o,c,l),a=Lj(r);break}case"COPPER":{let c=r[1],l=r[2];o&&i.addDefaultCopperSpace(c,l),i.addCopper2SafeChangeMap(t,"Copper_"+t,o,c,l),a=Bj(r);break}case"PASTE":{a=kj(r);break}case"SOLDER":{a=Mj(r);break}case"AUTO_ROUTER":{a=jj(r);break}}return a}function Hj(e,t,s,r){if(!r.init)return null;function i(n,a){let o=n?"Copper_":"Plane_",c=["RULE"];c[1]="SAFE",c[2]=o+t,c[3]=0;let l=a.getNewDefaultData(n,t);return l==null?null:(c[4]={unit:a.defaultSafeData.unit,isForAll:"ALL",safeSpacing:[{layerId:1,isOpen:!0,content:l}]},c)}switch(e){case"SAFE":return r.fixSafeData(s),null;case"PLANE":return i(!1,r);case"COPPER":return i(!0,r);default:return null}}function Gj(e,t,s,r){if(!r.init)return{ruleKeyValue:s};let i=e[0],n,a;if(t==4){if(i==="NET_CLASS"||i==="NET"){for(let o in s)String(o)==="COPPER"&&(n={COPPER:r.getSafeName4Copper(s[o])}),String(o)==="PLANE"&&(a={PLANE:r.getSafeName4Plane(s[o])});e[1]==""?(n!=null&&n.COPPER||(n={COPPER:"default"}),a!=null&&a.PLANE||(a={PLANE:"default"})):(n!=null&&n.COPPER||(n={COPPER:r.getDefaultCopper()}),a!=null&&a.PLANE||(a={PLANE:r.getDefaultPlane()}))}}else for(let o in s){if(String(o)==="COPPER"){let c=s[o],l=r.getSafeName4Copper(c);if(l==null&&c=="default"&&(l=r.getDefaultCopper()),l==null)continue;n={COPPER:l}}if(String(o)==="PLANE"){let c=s[o],l=r.getSafeName4Plane(c);if(l==null&&c=="default"&&(l=r.getDefaultPlane()),l==null)continue;a={PLANE:l}}}return{ruleKeyValue:s,copperRuleValue:n,innerPlaneRuleValue:a}}function CO(e,t){let s=e.length,r=0;for(;r<s;){let i=e.indexOf(`
`,r);i<0&&(i=s);let n=e.substring(r,i);try{if(t(n)===!1)break}catch(a){console.error(a)}r=i+1}}function Yj(e){let t={};return CO(e,s=>{if(s.startsWith('["PAD"')){let r=JSON.parse(s);t[r[5]]||(t[r[5]]=[]),t[r[5]].push(r[1])}}),t}var BT=class{parseFull(e){CO(e,t=>this.onParseLine(JSON.parse(t))),this.onParseEnd()}},Vj=(e=>(e[e.pro1=1]="pro1",e[e.pro2=1.1]="pro2",e[e.pro3=1.2]="pro3",e[e.pro4=1.3]="pro4",e[e.pro5=1.4]="pro5",e[e.pro6=1.5]="pro6",e[e.pro7=1.6]="pro7",e[e.pro8=1.7]="pro8",e[e.pro9=1.8]="pro9",e[e.pro=1.8]="pro",e))(Vj||{}),DO=class extends BT{constructor(e={},t={},s=[],r=[],i=!1){super(),this.deviceName=e,this.footprintName=t,this.footprints=s,this.devices=r,this.footprintIsConnectDevice=i,this.fontCache=[],this.poured={},this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize={data:[],stamp:{h:null,v:null},size:{h:null,v:null}},this.layerPhys=0,this.fac=new vP,this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet=new Set,this.oldId={},this.cachePadNet={},this.creaseIds=[],this.stringId={},this.padNumId={},this.componentPadNum={}}getOldId(e){var t;return(t=this.oldId[e])!=null?t:e}handConnect(){for(let e of this.creaseIds)if(this.connects[e])for(let t of this.connects[e])this.connects[t]?this.connects[t].push(e):this.connects[t]=[e]}getConnect(e){return this.connects[e]||[]}transRuleType(e){return AO(e)}transRuleStatus(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"DEFAULT";default:return"NORMAL"}}transGridType(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"GRID";case 2:return"OUTLETS";default:return"NONE"}}transLayerStatus(e){e=e&&Number(e);let t=!1,s=!1,r=!1;return e!=null&&!isNaN(e)?(e>=4&&(r=!0,e-=4),e>=2&&(s=!0,e-=2),e===1&&(t=!0)):t=!0,{use:t,show:s,locked:r}}transRoutingMode(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"PUSH";case 2:return"SURROUND";case 3:return"OBSTRUCT";case 4:return"SURROUND&PUSH";default:return"NONE"}}transPadDef(e){switch(e==null?void 0:e[0]){case"ELLIPSE":return{padType:"ELLIPSE",width:e[1],height:e[2]};case"RECT":return{padType:"RECT",width:e[1],height:e[2],radius:e[3]};case"OVAL":return{padType:"OVAL",width:e[1],height:e[2]};case"POLYGON":case"POLY":return{padType:"POLYGON",path:e[1]};default:return null}}transHoleDef(e){return e?{holeType:e[0],width:e[1],height:e[2]}:null}transPourDef(e){function t(s){switch(s=s&&Number(s),s){case 0:return"GRID_LINE";case 1:return"HORIZONTAL_LINE";case 2:return"VERTICAL_LINE";default:return"GRID_LINE"}}switch(e==null?void 0:e[0]){case"SOLID":return{pourType:"SOLID",fineness:e[1]};case"LINE":return{pourType:t(e[1]),angle:e[2],strokeWidth:e[3],strokeSpacing:e[4]};default:return null}}transUnusedPadRange(e){switch(e=e&&Number(e),e){case 1:return"ALL";case 2:return"PAD";case 3:return"VIA";default:return"VIA"}}transPathOptimization(e){switch(e=e&&Number(e),e){case 0:return"SINGLE";case 1:return"ALL";case 2:return"NONE";default:return"SINGLE"}}transViaType(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"SUTURE";default:return"NORMAL"}}transPadFuncType(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"TEST";case 2:return"MARKER";default:return"NORMAL"}}transPadConnect(e){switch(e=e&&Number(e),e){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}transFillStyle(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"GRID";case 2:return"PLANE";default:return null}}transProhibitType(e){let t=new Set;if(!e)return[];for(let s of e)switch(s=s&&Number(s),s){case 1:t.add("TRACK"),t.add("FILL");break;case 2:t.add("COMPONENT");break;case 3:t.add("VIA");break;case 4:t.add("COPPER"),t.add("PLANE");break;case 5:t.add("TRACK");break;case 6:t.add("FILL");break;case 7:t.add("COPPER");break;case 8:t.add("PLANE");break}return Array.from(t)}transPushCoverDir(e){switch(e=e&&Number(e),e){case 1:return"X_AXIS_POSITIVE";case 2:return"X_AXIS_NEGATIVE";case 4:return"Y_AXIS_POSITIVE";case 8:return"Y_AXIS_NEGATIVE";default:return"X_AXIS_POSITIVE"}}transEntityBelong(e){switch(e=e&&Number(e),e){case 0:return"AUTO";case 1:return"UPPER_SHELLS";case 2:return"LOWER_SHELLS";default:return"AUTO"}}transSlotOption(e){e=e&&Number(e);let t=e;if(!t||t<4)return["OUTLINE","SCREW_PILLAR","ENTITY"];let s=[];return t>=16&&(s.push("ENTITY"),t-=16),t>=8&&(s.push("SCREW_PILLAR"),t-=8),t>=4&&(s.push("OUTLINE"),t-=4),s}transAlignType(e){switch(e=e&&Number(e),e){case 1:return"LEFT_TOP";case 4:return"CENTER_TOP";case 7:return"RIGHT_TOP";case 2:return"LEFT_MIDDLE";case 5:return"CENTER_MIDDLE";case 8:return"RIGHT_MIDDLE";case 3:return"LEFT_BOTTOM";case 6:return"CENTER_BOTTOM";case 9:return"RIGHT_BOTTOM";default:return"LEFT_BOTTOM"}}onParseLine(e){var s;let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"CANVAS":this.parseCanvas(e);break;case"LAYER":this.parseLayer(e);break;case"LAYER_PHYS":this.parseLayerPhys(e);break;case"ACTIVE_LAYER":this.parseActiveLayer(e);break;case"NET":this.parseNet(e);break;case"PRIMITIVE":this.parsePrimitive(e);break;case"GROUP":this.parseGroup(e);break;case"SILK_OPTS":this.parseSilkOpts(e);break;case"PREFERENCE":this.parsePreference(e);break;case"CONNECT":this.parseConnect(e);break;case"ITEM_ORDER":this.parseItemOrder(e);break;case"PROP":this.parseProp(e);break;case"EQLEN_GRP":this.parseEQLenGrp(e);break;case"EQLEN":this.parseEQLen(e);break;case"FONT":this.parseFont(e);break;case"PAD_NET":{this.cachePadNet[e[1]]||(this.cachePadNet[e[1]]=[]),this.cachePadNet[e[1]].push(e);break}case"REUSE_BLOCK":this.parseReuseBlock(e);break;case"RULE_TEMPLATE":this.parseRuleTemplate(e);break;case"RULE":this.rules.push(e);break;case"RULE_SELECTOR":this.ruleSelectors.push(e);break;case"PANELIZE":this.panelize.data=e;break;case"PANELIZE_STAMP":this.parsePanelizeStamp(e);break;case"PANELIZE_SIDE":this.parsePanelizeSide(e);break;case"POURED":{this.parsePoured(e);break}case"PARTITION":t==="PARTITION"&&(this.curPartition=e[3]?e[1]:"");case"VIA":case"PAD":case"LINE":case"ARC":case"CARC":case"OBJ":case"POLY":case"FILL":if(t==="FILL"&&e[6]===2){this.layerFill[e[4]]||(this.layerFill[e[4]]=[]),this.layerFill[e[4]].push(e);break}case"REGION":case"POUR":case"IMAGE":case"TEARDROP":case"FPC_FILL":case"SHELL":case"CREASE":t==="CREASE"&&this.creaseIds.push(e[1]);case"SHELLCUT":case"SHELL_ENTITY":case"BOSS":case"STRING":if(t==="STRING"&&!/^[a-zA-Z]+\d+$/.test(e[1])){let r=e[1],i=r.split(/([0-9].*)/);if(i.length>=2){let n=i[0],a=i[1];for(let o=0;o<a.length;o++){let c=a.charCodeAt(o);n+=c}r=n}this.stringId[r]=e[1],e[1]=r}case"DIMENSION":case"COMPONENT":{let r=t==="CARC"?"ARC":t,i=bp(e[1]);this.cache[r]||(this.cache[r]={}),i!==null&&!this.cache[r][i]?this.cache[r][i]={part:this.curPartition,value:e}:(this.errorIds[r]||(this.errorIds[r]=[]),this.errorIds[r].push({part:this.curPartition,value:e})),r==="COMPONENT"&&(this.components[e[1]]||(this.components[e[1]]={attrs:{},footprint:"",device:""}),this.components[e[1]].attrs=e[7]||{}),r==="DIMENSION"&&(this.dimension[e[1]]={attr:[]});break}case"ATTR":{if(this.docType==="PCB"&&!e[3])break;if(e[7]==="Footprint"&&(this.components[e[3]]||(this.components[e[3]]={attrs:{},footprint:"",device:""}),this.components[e[3]].footprint=e[8]),e[7]==="Device"&&(this.components[e[3]]||(this.components[e[3]]={attrs:{},footprint:"",device:""}),this.components[e[3]].device=e[8]),this.dimension[e[1]]){this.dimension[e[1]].attr=e;break}let r=Object.keys(((s=this.cache)==null?void 0:s.COMPONENT)||{}).find(n=>this.cache.COMPONENT[n].value[1]===e[3]);if(r){let n=this.cache.COMPONENT[r];n.attr||(n.attr=[]),n.attr.push({part:this.curPartition,value:e});break}let i=bp(e[1]);this.cache[t]||(this.cache[t]={}),i!==null&&!this.cache[t][i]?this.cache[t][i]={part:this.curPartition,value:e}:(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPartition,value:e}));break}default:console.warn("can not find hanlder with",e)}}async secondParseLine(e,t,s){let r=e[0];if(this.idsSet.has(e[1])||!e[1]){let i=at();if(this.oldId[i]=e[1],e[1]=i,s)for(let n of s)n[3]=i}else this.idsSet.add(e[1]);switch(r){case"DOCTYPE":case"HEAD":case"CANVAS":case"LAYER":case"LAYER_PHYS":case"ACTIVE_LAYER":case"NET":case"PRIMITIVE":case"GROUP":case"SILK_OPTS":case"PREFERENCE":case"ITEM_ORDER":case"RULE_TEMPLATE":case"RULE":case"RULE_SELECTOR":case"PANELIZE":case"PANELIZE_STAMP":case"PANELIZE_SIDE":case"CONNECT":case"EQLEN_GRP":case"EQLEN":case"FONT":case"PAD_NET":case"REUSE_BLOCK":case"PROP":break;case"PARTITION":this.parsePartition(e);break;case"VIA":this.parseVia(e);break;case"PAD":this.parsePad(e);break;case"LINE":await this.parseLine(e);break;case"ARC":this.parseArc(e);break;case"CARC":this.parseCArc(e);break;case"OBJ":this.parseObj(e);break;case"POLY":this.parsePoly(e);break;case"FILL":this.parseFill(e);break;case"REGION":this.parseRegion(e);break;case"POUR":this.parsePour(e);break;case"IMAGE":this.parseImage(e);break;case"TEARDROP":this.parseTeardrop(e);break;case"FPC_FILL":this.parseFpcFill(e);break;case"SHELL":this.parseShell(e);break;case"CREASE":this.parseCrease(e);break;case"SHELLCUT":this.parseShellCut(e);break;case"SHELL_ENTITY":this.parseShellEntity(e);break;case"BOSS":this.parseBoss(e);break;case"STRING":this.parseString(e);break;case"ATTR":this.parseAttr(e,t);break;case"DIMENSION":this.parseDimension(e);break;case"COMPONENT":this.parseComponent(e);break;default:console.warn("can not find hanlder with",e)}}onParseEnd(){for(let t of this.rules)t[1]=this.transRuleType(t[1]),t[3]=this.transRuleStatus(t[3]),t[4]=Uj(t[1],t[2],t[3],t[4],this.fac,this.ruleTemplateName);if(this.fac.init){let t=Array.from(this.rules);for(let s of t){let r=Hj(s[1],s[2],s[4],this.fac);r&&this.rules.push(r)}}for(let t of this.rules)this.parseRule(t);let e={};for(let t of this.ruleSelectors){let s=Gj(t[1],t[2],tp(t[3]),this.fac),r=JSON.stringify(t[1]);e[r]?(t[2]&&(e[r].ruleOrder=t[2]),s.ruleKeyValue&&(e[r].ruleKeyValue=Object.assign(e[r].ruleKeyValue,s.ruleKeyValue)),(s.copperRuleValue||t[4])&&(e[r].copperValue=s.copperRuleValue||tp(t[4])),(s.innerPlaneRuleValue||t[5])&&(e[r].innerPlaneValue=s.innerPlaneRuleValue||tp(t[5]))):e[r]={ruleSelect:t[1],ruleOrder:t[2],ruleKeyValue:s.ruleKeyValue,copperValue:s.copperRuleValue||tp(t[4])||{},innerPlaneValue:s.innerPlaneRuleValue||tp(t[5])||{}}}for(let t in e)this.parseRuleSelector(e[t]);this.handConnect(),this.parseEQLenGrpFull(),this.parsePanelize(),this.parseLayerFill();for(let t in this.cache){let s=this.cache[t],r=Object.keys(s).sort((n,a)=>Number(n)-Number(a)),i=-1;for(let n of r){let a=Number(n),o=a-i-1;o>=1&&this.onPHolder(t,o),i=a,this.curPartition=s[a].part,this.secondParseLine(s[a].value,void 0,s[a].attr),s[a].attr&&s[a].attr.forEach(c=>{this.curPartition=c.part,this.secondParseLine(c.value)})}if(this.errorIds[t])for(let n of this.errorIds[t])this.curPartition=n.part,this.secondParseLine(n.value)}this.clearCache()}clearCache(){this.version=void 0,this.docType=void 0,this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize.data.length&&(this.panelize.data.length=0,this.panelize.stamp={h:null,v:null},this.panelize.size={h:null,v:null}),this.layerPhys=0,this.fac.init&&(this.fac=new vP),this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet.clear(),this.oldId={},this.creaseIds.length=0}fixPolygon(e){if(e[0]=="R"){let t=parseFloat(e[3])/10,s=parseFloat(e[4])/10;e[6]=Math.min(t,s)/2*(parseFloat(e[6])||0)*10}}handleSimplePolygon(e){return!e||this.version>=1.5||this.fixPolygon(e),e}handlePolygon(e){if(this.version<1.5&&e&&e.length){if(!Array.isArray(e[0]))return this.handleSimplePolygon(e);for(let t of e)this.fixPolygon(t)}return e}parseEQLen(e){this.eQLenData[e[1]]?this.eQLenData[e[1]].pads?this.eQLenData[e[1]].pads.push(e[2]):this.eQLenData[e[1]].pads=[e[2]]:this.eQLenData[e[1]]={pads:[e[2]]}}parseEQLenGrp(e){this.eQLenData[e[1]]?(this.eQLenData[e[1]].id=e[1],this.eQLenData[e[1]].name=e[2],this.eQLenData[e[1]].sort=++this.eQLenSort):this.eQLenData[e[1]]={id:e[1],name:e[2],sort:++this.eQLenSort}}parseCanvas(e){this.onCanvas(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],this.transGridType(e[10]),this.transGridType(e[11]),e[12])}parseDocType(e){this.docType=e[1];let t=parseFloat(e[2]);this.version=t}parseHead(e){}parseLayer(e){let t=e[8];this.version<1.7&&(t=.5);let s=this.transLayerStatus(e[4]);this.onLayer(e[1],e[2],e[3],s.use,s.show,s.locked,e[5],e[6],e[7],t)}parseLayerPhys(e){this.onLayerPhys(e[1],e[2],e[3],e[4],e[5],!!e[6],++this.layerPhys)}parseActiveLayer(e){this.onActiveLayer(e[1])}parsePartition(e){this.onPartition(e[1],e[2],e[3],this.handlePolygon(e[4]))}parseNet(e){var t,s,r,i;this.onNet(e[1],(t=e[2])!=null?t:null,(s=e[3])!=null?s:null,!!e[4],(r=e[5])!=null?r:null,!!e[6],(i=e[7])!=null?i:null)}parsePrimitive(e){this.onPrimitive(e[1],!!e[2],!!e[3])}parseGroup(e){this.onGroup(e[1],e[2])}parseSilkOpts(e){this.onSilkOpts(e[1],e[2],e[3])}parsePreference(e){this.onPreference(!!e[1],e[2],!!e[3],e[4],e[5],!!e[6],this.transRoutingMode(e[7]),e[8],!!e[9],!!e[10],!!e[11],e[12],e[13],!!e[14],this.transUnusedPadRange(e[15]),e[16],this.transPathOptimization(e[17]),e[18],e[19],e[20])}parseConnect(e){this.connects[e[1]]=e[2]}parseVia(e){var t,s;this.onVia(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transViaType(e[9]),(t=e[10])!=null?t:null,(s=e[11])!=null?s:null,!!e[12],e[13])}parsePad(e){var t,s,r,i,n,a,o,c,l;this.onPad(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transHoleDef(e[9]),this.transPadDef(e[10]),e[11]&&(s=(t=e[11])==null?void 0:t.map(u=>({startLayer:u[0],endLayer:u[1],pad:this.transPadDef(u[2])})))!=null?s:null,e[12],e[13],e[14],!!e[15],this.transPadFuncType(e[16]),(r=e[17])!=null?r:null,(i=e[18])!=null?i:null,(n=e[19])!=null?n:null,(a=e[20])!=null?a:null,!!e[21],this.transPadConnect(e[22]),(o=e[23])!=null?o:null,(c=e[24])!=null?c:null,(l=e[25])!=null?l:null,e[26],this.getConnect(e[1]))}parseLine(e){this.onLine(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],!!e[10])}parseArc(e){this.onArc(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseCArc(e){this.onCArc(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseObj(e){this.onObj(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],!!e[10],e[11],!!e[12],this.specialColors[this.getOldId(e[1])])}parseItemOrder(e){this.itemOrder=e[1]}parseProp(e){this.specialColors[e[1]]=e[2]}parseEQLenGrpFull(){for(let e in this.eQLenData){let t=this.eQLenData[e];t.id&&this.onEQLenGrp(t.id,t.name,t.sort,t.pads||[])}this.eQLenData={},this.eQLenSort=1}parsePoly(e){this.onPoly(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handleSimplePolygon(e[6]),!!e[7],this.specialColors[this.getOldId(e[1])])}parseFill(e){this.onFill(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.transFillStyle(e[6]),this.handlePolygon(e[7]),!!e[8],this.getConnect(e[1]),this.specialColors[this.getOldId(e[1])])}getZIndex1(e){let t=e.match(t0);return t!=null&&t.length?t[1]:null}parseLayerFill(){for(let e in this.layerFill){let t=this.layerFill[e];this.onLayerFill(Number(e),{fill:t.map(s=>{let r=this.getZIndex1(s[1]);return{id:s[1],partitionId:this.curPartition||"",groupId:s[2],locked:!!s[8],zIndex:r===null?null:Number(r),netName:s[3],width:s[5],path:this.handlePolygon(s[7]),refs:this.getConnect(s[1]),specialColor:this.specialColors[this.getOldId(s[1])]}})})}}parseRegion(e){let t=e[5],s=t&&t.includes(9)?"CONSTRAINT":"PROHIBIT";t=s?t.filter(r=>r!==9):t,this.onRegion(e[1],this.curPartition||"",e[2],e[3],e[4],this.transProhibitType(t),this.handlePolygon(e[6]),!!e[7],e[8],s)}parsePour(e){let t=e[9];this.version<=1.7&&t&&t[0]==="SOLID"&&t[1]&&(t[1]=8),this.onPour(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],this.handlePolygon(e[8]),this.transPourDef(t),!!e[10],!!e[11]),this.poured[e[1]]&&this.onPoured(e[1],this.poured[e[1]])}parsePoured(e){if(this.version<1.1){if(this.curPourId){let t={id:e[1],strokeWidth:e[2],fill:e[3],path:this.handlePolygon(e[4])};this.poured[this.curPourId]||(this.poured[this.curPourId]={pourFill:[]}),this.poured[this.curPourId].pourFill.push(t)}}else{let t={id:e[1],strokeWidth:e[3],fill:e[4],path:this.handlePolygon(e[5])};this.poured[e[2]]||(this.poured[e[2]]={pourFill:[]}),this.poured[e[2]].pourFill.push(t)}}parseImage(e){this.onImage(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],!!e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseTeardrop(e){let t,s,r;this.version<1.2?(t=e[5],r=e[4]):(t=e[4],s=e[5],r=this.getConnect(e[1])),this.onTeardrop(e[1],this.curPartition||"",e[2],e[3],this.handleSimplePolygon(t),s!=null?s:null,r)}parseFpcFill(e){this.onFpcFill(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handlePolygon(e[6]),!!e[7])}parseShell(e){let t=e[8];t&&t.Direction&&(t.Direction=this.transPushCoverDir(t.Direction)),this.onShell(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],this.handlePolygon(e[7]),t,!!e[9])}parseCrease(e){this.onCrease(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],!!e[9])}parseShellCut(e){this.onShellCut(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handlePolygon(e[6]),!!e[7],this.getConnect(e[1]))}parseShellEntity(e){this.onShellEntity(e[1],this.curPartition||"",e[2],e[3],e[4],this.transEntityBelong(e[5]),this.transSlotOption(e[5]),e[6],e[7],this.handlePolygon(e[8]),!!e[9],this.getConnect(e[1]))}parseBoss(e){var t,s,r,i,n,a;this.version<1.4?this.onBoss(e[1],this.curPartition||"",e[2],e[3],e[5],e[6],(t=e[4])!=null?t:null,e[7],null,null,(s=e[8])!=null?s:null,(r=e[9])!=null?r:null,!!e[10]):this.onBoss(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],(i=e[6])!=null?i:null,e[7],e[8],e[9],(n=e[10])!=null?n:null,(a=e[11])!=null?a:null,!!e[12])}parseDimension(e){var i;let t=this.getOldId(e[1]),s=((i=this.dimension[t])==null?void 0:i.attr)||[];if(s.length){let n=this.fontCache.find(a=>a.id&&a.id===this.getOldId(s[1]));this.version<1.6&&n&&(n.text=s[8],n.fontFamily=s[11],n.fontSize=s[12]/10,n.thickness=s[13]/10,n.bold=s[15],n.italic=s[16],n.reverse=s[18],n.expansion=s[19]/10)}let r={groupId:s[2],layerId:s[4],x:s[5],y:s[6],text:s[8],fontFamily:s[11],fontSize:s[12],strokeWidth:s[13],bold:s[14],italic:s[15],origin:s[16],angle:s[17],reverse:s[18],expansion:s[19],mirror:s[20],locked:s[21],zIndex:null,specialColor:this.specialColors[this.getOldId(s[1])]};this.onDimension(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],!!e[7],e[8],!!e[9],r,this.specialColors[this.getOldId(e[1])],s[2]||"")}parseRuleTemplate(e){this.ruleTemplateName=e[1],this.onRuleTemplate(e[1])}parseRule(e){this.onRule(e[1],e[2],e[3],e[4])}parseRuleSelector(e){this.onRuleSelector(e.ruleSelect,e.ruleOrder,e.ruleKeyValue,e.copperValue,e.innerPlaneValue)}parsePanelize(){let e=this.panelize.data;e.length&&this.onPanelize(!!e[1],e[2],e[3],e[4],e[5],!!e[6],this.panelize.stamp.h,this.panelize.stamp.v,this.panelize.size.h,this.panelize.size.v)}parsePanelizeStamp(e){let t={on:!!e[2],stampHoleGroupQuantity:e[3],stampHoleDiameter:e[4],stampHoleQuantityPerGroup:e[5],stampHoleSpacing:e[6]};e[1]?this.panelize.stamp.v=t:this.panelize.stamp.h=t}parsePanelizeSide(e){let t={on:!!e[2],sideHeight:e[3],positionHoleDiameter:e[4],markDiameter:e[5],markExpansion:e[6]};e[1]?this.panelize.size.v=t:this.panelize.size.h=t}parseComponent(e){let t=this.getOldId(e[1]),s=e[7]||{},r=this.reuseBlock[t];if(r&&Object.assign(s,{"Group ID":r[2]||"","Channel ID":r[3]||""}),this.onComponent(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],s,!!e[8],this.specialColors[t]),this.cachePadNet[t])for(let i of this.cachePadNet[t])this.parsePadNet(i)}parsePadNet(e){let t=this.getOldId(e[1]);if(e[4]===void 0&&this.components[t]){let s=this.components[t].footprint;if(!s){let i=this.components[t].device;s=this.devices.find(n=>n.uuid===i).attributes.Footprint}let r=this.padNumId[s];if(!r){let i=this.footprints.find(n=>n.uuid===s);i&&(this.padNumId[s]=Yj(i==null?void 0:i.dataStr),r=this.padNumId[s])}if(r&&r[e[2]]){this.componentPadNum[t]||(this.componentPadNum[t]={}),this.componentPadNum[t][e[2]]===void 0&&(this.componentPadNum[t][e[2]]=-1);let i=++this.componentPadNum[t][e[2]];e[4]=r[e[2]][i]}else e[4]=e[2]}this.onPadNet(e[1],this.curPartition||"",e[2],e[3],e[4])}parseReuseBlock(e){this.reuseBlock[e[1]]=e}getFontCache(e,t,s,r,i,n,a,o){let c;return this.version<1.6?c=this.fontCache.find(l=>l.id===e):c=this.fontCache.find(l=>s==l.fontFamily&&t==l.text&&r/10==l.fontSize&&!!a==l.reverse&&o==l.expansion&&!!i==l.bold&&!!n==l.italic&&l.path.length>0),{paths:c==null?void 0:c.path,width:c==null?void 0:c.width,height:c==null?void 0:c.height}}getTextValue(e,t,s,r,i){let n="";return e!=""&&t===""&&this.docType!="PCB"&&!i&&e!="Footprint"&&!this.footprintIsConnectDevice&&(t=`<${e}>`),s?r?n=e+":"+t:n=e:r?n=t:n="",n}getFormulaName(e,t){if(!e||!e.startsWith("="))return e;e=e.slice(1);let s=/\{([^\}]+)\}/g,r=[],i=[];for(;r=s.exec(e);)i.push(r[1]);for(let n=0;n<i.length;n++){let a=i[n],o=`{${a}!}`;t.has(a)&&(o=t.get(a)),e=e.replace(`{${a}}`,o)}return e}parseAttr(e,t){let s=e[11],r=e[12];r&&this.version<1.2&&(s=="default"||s=="")&&(r*=1.5);let i=e[7],n=e[8],a=!!e[9],o=!!e[10],c=this.getOldId(e[3]),l=n;if(i==="Device"){let h=this.deviceName[n]||n;l=this.getTextValue(i,h,a,o,c)}else if(i==="Footprint"){let h=this.footprintName[n]||n;l=this.getTextValue(i,h,a,o,c)}else if(i==="Name"){let h=new Map;if(c){let p=this.components[c];if(h.set("ID",c),Object.entries(p.attrs).forEach(d=>h.set(d[0],d[1])),p.device){let d=this.devices.find(f=>f.uuid===p.device);d&&Object.entries(d.attributes).forEach(f=>h.set(f[0],f[1]))}}l=this.getTextValue(i,this.getFormulaName(n,h),a,o,c)}else l=this.getTextValue(i,n,a,o,c);let u=this.fontCache.find(h=>h.id&&h.id===this.getOldId(e[1]));this.version<1.6&&u&&(u.text=l,u.fontFamily=s,u.fontSize=r/10,u.thickness=e[13]/10,u.bold=e[15],u.italic=e[16],u.reverse=e[18],u.expansion=e[19]/10),this.onAttr(e[1],this.curPartition||"",e[2],c,e[4],e[5],e[6],i,n,a,o,s,r,e[13],!!e[14],!!e[15],this.transAlignType(e[16]),e[17],!!e[18],e[19],!!e[20],!!e[21],t,this.specialColors[this.getOldId(e[1])])}parseFont(e){let t;switch(this.version){case 1:case 1.1:t={id:e[1],path:e[2]};break;case 1.2:case 1.3:case 1.4:case 1.5:t={id:e[1],width:e[2],height:e[3],path:e[4]};break;default:t={text:e[1],fontFamily:e[2],fontSize:e[3],thickness:e[4],bold:!!e[5],italic:!!e[6],reverse:!!e[7],expansion:e[8],width:e[9],height:e[10],path:e[11]};break}this.fontCache.push(t)}parseString(e){var T;let[,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b]=e,E=(T=this.stringId[t])!=null?T:t;c&&this.version<1.2&&(o=="default"||o=="")&&(c*=1.5);let y=this.fontCache.find(w=>w.id&&w.id===this.getOldId(E));this.version<1.6&&y&&(y.text=a,y.fontFamily=o,y.fontSize=c/10,y.thickness=l/10,y.bold=u,y.italic=h,y.reverse=f,y.expansion=m/10),this.onString(t,this.curPartition||"",s,r,i,n,a,o,c,l,!!u,!!h,this.transAlignType(p),d,!!f,m,!!g,!!b,this.specialColors[this.getOldId(E)])}},zj=Object.create,PO=Object.defineProperty,Wj=Object.getOwnPropertyDescriptor,qj=Object.getOwnPropertyNames,Jj=Object.getPrototypeOf,Kj=Object.prototype.hasOwnProperty,Xj=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Zj=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of qj(t))!Kj.call(e,i)&&i!==s&&PO(e,i,{get:()=>t[i],enumerable:!(r=Wj(t,i))||r.enumerable});return e},$j=(e,t,s)=>(s=e!=null?zj(Jj(e)):{},Zj(t||!e||!e.__esModule?PO(s,"default",{value:e,enumerable:!0}):s,e)),Qj=Xj((e,t)=>{"use strict";t.exports=s,t.exports.default=s;function s(O,R,v){v=v||2;var j=R&&R.length,M=j?R[0]*v:O.length,H=r(O,0,M,v,!0),q=[];if(!H||H.next===H.prev)return q;var Q,oe,me,Ee,Pe,Oe,Fe;if(j&&(H=u(O,R,H,v)),O.length>80*v){Q=me=O[0],oe=Ee=O[1];for(var G=v;G<M;G+=v)Pe=O[G],Oe=O[G+1],Pe<Q&&(Q=Pe),Oe<oe&&(oe=Oe),Pe>me&&(me=Pe),Oe>Ee&&(Ee=Oe);Fe=Math.max(me-Q,Ee-oe),Fe=Fe!==0?32767/Fe:0}return n(H,q,v,Q,oe,Fe,0),q}function r(O,R,v,j,M){var H,q;if(M===k(O,R,v,j)>0)for(H=R;H<v;H+=j)q=F(H,O[H],O[H+1],q);else for(H=v-j;H>=R;H-=j)q=F(H,O[H],O[H+1],q);return q&&S(q,q.next)&&(V(q),q=q.next),q}function i(O,R){if(!O)return O;R||(R=O);var v=O,j;do if(j=!1,!v.steiner&&(S(v,v.next)||w(v.prev,v,v.next)===0)){if(V(v),v=R=v.prev,v===v.next)break;j=!0}else v=v.next;while(j||v!==R);return R}function n(O,R,v,j,M,H,q){if(O){!q&&H&&m(O,j,M,H);for(var Q=O,oe,me;O.prev!==O.next;){if(oe=O.prev,me=O.next,H?o(O,j,M,H):a(O)){R.push(oe.i/v|0),R.push(O.i/v|0),R.push(me.i/v|0),V(O),O=me.next,Q=me.next;continue}if(O=me,O===Q){q?q===1?(O=c(i(O),R,v),n(O,R,v,j,M,H,2)):q===2&&l(O,R,v,j,M,H):n(i(O),R,v,j,M,H,1);break}}}}function a(O){var R=O.prev,v=O,j=O.next;if(w(R,v,j)>=0)return!1;for(var M=R.x,H=v.x,q=j.x,Q=R.y,oe=v.y,me=j.y,Ee=M<H?M<q?M:q:H<q?H:q,Pe=Q<oe?Q<me?Q:me:oe<me?oe:me,Oe=M>H?M>q?M:q:H>q?H:q,Fe=Q>oe?Q>me?Q:me:oe>me?oe:me,G=j.next;G!==R;){if(G.x>=Ee&&G.x<=Oe&&G.y>=Pe&&G.y<=Fe&&y(M,Q,H,oe,q,me,G.x,G.y)&&w(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function o(O,R,v,j){var M=O.prev,H=O,q=O.next;if(w(M,H,q)>=0)return!1;for(var Q=M.x,oe=H.x,me=q.x,Ee=M.y,Pe=H.y,Oe=q.y,Fe=Q<oe?Q<me?Q:me:oe<me?oe:me,G=Ee<Pe?Ee<Oe?Ee:Oe:Pe<Oe?Pe:Oe,pe=Q>oe?Q>me?Q:me:oe>me?oe:me,ge=Ee>Pe?Ee>Oe?Ee:Oe:Pe>Oe?Pe:Oe,ie=b(Fe,G,R,v,j),$=b(pe,ge,R,v,j),ae=O.prevZ,ye=O.nextZ;ae&&ae.z>=ie&&ye&&ye.z<=$;){if(ae.x>=Fe&&ae.x<=pe&&ae.y>=G&&ae.y<=ge&&ae!==M&&ae!==q&&y(Q,Ee,oe,Pe,me,Oe,ae.x,ae.y)&&w(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,ye.x>=Fe&&ye.x<=pe&&ye.y>=G&&ye.y<=ge&&ye!==M&&ye!==q&&y(Q,Ee,oe,Pe,me,Oe,ye.x,ye.y)&&w(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;ae&&ae.z>=ie;){if(ae.x>=Fe&&ae.x<=pe&&ae.y>=G&&ae.y<=ge&&ae!==M&&ae!==q&&y(Q,Ee,oe,Pe,me,Oe,ae.x,ae.y)&&w(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;ye&&ye.z<=$;){if(ye.x>=Fe&&ye.x<=pe&&ye.y>=G&&ye.y<=ge&&ye!==M&&ye!==q&&y(Q,Ee,oe,Pe,me,Oe,ye.x,ye.y)&&w(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function c(O,R,v){var j=O;do{var M=j.prev,H=j.next.next;!S(M,H)&&_(M,j,j.next,H)&&I(M,H)&&I(H,M)&&(R.push(M.i/v|0),R.push(j.i/v|0),R.push(H.i/v|0),V(j),V(j.next),j=O=H),j=j.next}while(j!==O);return i(j)}function l(O,R,v,j,M,H){var q=O;do{for(var Q=q.next.next;Q!==q.prev;){if(q.i!==Q.i&&T(q,Q)){var oe=L(q,Q);q=i(q,q.next),oe=i(oe,oe.next),n(q,R,v,j,M,H,0),n(oe,R,v,j,M,H,0);return}Q=Q.next}q=q.next}while(q!==O)}function u(O,R,v,j){var M=[],H,q,Q,oe,me;for(H=0,q=R.length;H<q;H++)Q=R[H]*j,oe=H<q-1?R[H+1]*j:O.length,me=r(O,Q,oe,j,!1),me===me.next&&(me.steiner=!0),M.push(E(me));for(M.sort(h),H=0;H<M.length;H++)v=p(M[H],v);return v}function h(O,R){return O.x-R.x}function p(O,R){var v=d(O,R);if(!v)return R;var j=L(v,O);return i(j,j.next),i(v,v.next)}function d(O,R){var v=R,j=O.x,M=O.y,H=-1/0,q;do{if(M<=v.y&&M>=v.next.y&&v.next.y!==v.y){var Q=v.x+(M-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(Q<=j&&Q>H&&(H=Q,q=v.x<v.next.x?v:v.next,Q===j))return q}v=v.next}while(v!==R);if(!q)return null;var oe=q,me=q.x,Ee=q.y,Pe=1/0,Oe;v=q;do j>=v.x&&v.x>=me&&j!==v.x&&y(M<Ee?j:H,M,me,Ee,M<Ee?H:j,M,v.x,v.y)&&(Oe=Math.abs(M-v.y)/(j-v.x),I(v,O)&&(Oe<Pe||Oe===Pe&&(v.x>q.x||v.x===q.x&&f(q,v)))&&(q=v,Pe=Oe)),v=v.next;while(v!==oe);return q}function f(O,R){return w(O.prev,O,R.prev)<0&&w(R.next,O,O.next)<0}function m(O,R,v,j){var M=O;do M.z===0&&(M.z=b(M.x,M.y,R,v,j)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==O);M.prevZ.nextZ=null,M.prevZ=null,g(M)}function g(O){var R,v,j,M,H,q,Q,oe,me=1;do{for(v=O,O=null,H=null,q=0;v;){for(q++,j=v,Q=0,R=0;R<me&&(Q++,j=j.nextZ,!!j);R++);for(oe=me;Q>0||oe>0&&j;)Q!==0&&(oe===0||!j||v.z<=j.z)?(M=v,v=v.nextZ,Q--):(M=j,j=j.nextZ,oe--),H?H.nextZ=M:O=M,M.prevZ=H,H=M;v=j}H.nextZ=null,me*=2}while(q>1);return O}function b(O,R,v,j,M){return O=(O-v)*M|0,R=(R-j)*M|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,R=(R|R<<8)&16711935,R=(R|R<<4)&252645135,R=(R|R<<2)&858993459,R=(R|R<<1)&1431655765,O|R<<1}function E(O){var R=O,v=O;do(R.x<v.x||R.x===v.x&&R.y<v.y)&&(v=R),R=R.next;while(R!==O);return v}function y(O,R,v,j,M,H,q,Q){return(M-q)*(R-Q)>=(O-q)*(H-Q)&&(O-q)*(j-Q)>=(v-q)*(R-Q)&&(v-q)*(H-Q)>=(M-q)*(j-Q)}function T(O,R){return O.next.i!==R.i&&O.prev.i!==R.i&&!D(O,R)&&(I(O,R)&&I(R,O)&&P(O,R)&&(w(O.prev,O,R.prev)||w(O,R.prev,R))||S(O,R)&&w(O.prev,O,O.next)>0&&w(R.prev,R,R.next)>0)}function w(O,R,v){return(R.y-O.y)*(v.x-R.x)-(R.x-O.x)*(v.y-R.y)}function S(O,R){return O.x===R.x&&O.y===R.y}function _(O,R,v,j){var M=x(w(O,R,v)),H=x(w(O,R,j)),q=x(w(v,j,O)),Q=x(w(v,j,R));return!!(M!==H&&q!==Q||M===0&&C(O,v,R)||H===0&&C(O,j,R)||q===0&&C(v,O,j)||Q===0&&C(v,R,j))}function C(O,R,v){return R.x<=Math.max(O.x,v.x)&&R.x>=Math.min(O.x,v.x)&&R.y<=Math.max(O.y,v.y)&&R.y>=Math.min(O.y,v.y)}function x(O){return O>0?1:O<0?-1:0}function D(O,R){var v=O;do{if(v.i!==O.i&&v.next.i!==O.i&&v.i!==R.i&&v.next.i!==R.i&&_(v,v.next,O,R))return!0;v=v.next}while(v!==O);return!1}function I(O,R){return w(O.prev,O,O.next)<0?w(O,R,O.next)>=0&&w(O,O.prev,R)>=0:w(O,R,O.prev)<0||w(O,O.next,R)<0}function P(O,R){var v=O,j=!1,M=(O.x+R.x)/2,H=(O.y+R.y)/2;do v.y>H!=v.next.y>H&&v.next.y!==v.y&&M<(v.next.x-v.x)*(H-v.y)/(v.next.y-v.y)+v.x&&(j=!j),v=v.next;while(v!==O);return j}function L(O,R){var v=new B(O.i,O.x,O.y),j=new B(R.i,R.x,R.y),M=O.next,H=R.prev;return O.next=R,R.prev=O,v.next=M,M.prev=v,j.next=v,v.prev=j,H.next=j,j.prev=H,j}function F(O,R,v,j){var M=new B(O,R,v);return j?(M.next=j.next,M.prev=j,j.next.prev=M,j.next=M):(M.prev=M,M.next=M),M}function V(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function B(O,R,v){this.i=O,this.x=R,this.y=v,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}s.deviation=function(O,R,v,j){var M=R&&R.length,H=M?R[0]*v:O.length,q=Math.abs(k(O,0,H,v));if(M)for(var Q=0,oe=R.length;Q<oe;Q++){var me=R[Q]*v,Ee=Q<oe-1?R[Q+1]*v:O.length;q-=Math.abs(k(O,me,Ee,v))}var Pe=0;for(Q=0;Q<j.length;Q+=3){var Oe=j[Q]*v,Fe=j[Q+1]*v,G=j[Q+2]*v;Pe+=Math.abs((O[Oe]-O[G])*(O[Fe+1]-O[Oe+1])-(O[Oe]-O[Fe])*(O[G+1]-O[Oe+1]))}return q===0&&Pe===0?0:Math.abs((Pe-q)/q)};function k(O,R,v,j){for(var M=0,H=R,q=v-j;H<v;H+=j)M+=(O[q]-O[H])*(O[H+1]+O[q+1]),q=H;return M}s.flatten=function(O){for(var R=O[0][0].length,v={vertices:[],holes:[],dimensions:R},j=0,M=0;M<O.length;M++){for(var H=0;H<O[M].length;H++)for(var q=0;q<R;q++)v.vertices.push(O[M][H][q]);M>0&&(j+=O[M-1].length,v.holes.push(j))}return v}}),e9=(e=>(e[e.MIL=1]="MIL",e[e.INCH=1e3]="INCH",e[e.FT=12e3]="FT",e[e.YARD=36e3]="YARD",e[e.MILE=6336e4]="MILE",e[e.KM=3937007874e-2]="KM",e[e.M=39370]="M",e[e.DM=3937]="DM",e[e.CM=393.7]="CM",e[e.MM=39.37]="MM",e[e.UM=.039]="UM",e[e.NM=394e-7]="NM",e[e.PT=13.88888888888889]="PT",e[e.PX72=13.88888888888889]="PX72",e[e.PX96=10.416666666666666]="PX96",e[e.PX100=10]="PX100",e[e.LTSPICE=6.25]="LTSPICE",e[e.PX1=.1]="PX1",e[e.PX001=.001]="PX001",e))(e9||{}),t9=(e=>(e.MIL="mil",e.INCH="inch",e.FT="ft",e.YARD="yard",e.MILE="mile",e.KM="km",e.M="m",e.DM="dm",e.CM="cm",e.MM="mm",e.UM="um",e.NM="nm",e.PT="pt",e.PX72="px(72)",e.PX96="px(96)",e.PX100="px(100)",e))(t9||{}),NP={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},mX=(()=>{let e={};for(let t in NP)e[NP[t]]=t;return e})();var il,gX=(il=class{constructor(t,s){this.ratio=t/s}wrap(t){return t*this.ratio}static convert(t,s,r){return t*s/r}},il.ASIS=new il(1,1),il),by=class{conversion(e,t,s){if(e===t)return s;let r=e+2+t;return this[r](s)}conversion1(e,t,s){let r=e+2+t,i=this[r](s);return t=="mil"?Math.round(i*10)/10:Math.round(i*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*393.7007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};by.prototype["px(100)2mil"]=e=>e*10,by.prototype["px(100)2mm"]=e=>e*.254,by.prototype["mil2px(100)"]=e=>e/10,by.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var Ty=null,kT=new ArrayBuffer(8),Qb=new Float64Array(kT),eT=new Uint32Array(kT),LP=new Uint16Array(kT);var BP=class{static repeat(e,t){let s=new Array(t);for(;t-- >0;)s[t]=e;return s.join("")}static lpad(e,t,s){let r=s-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,s){let r=s-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)|0;return t}else return 0}static arraycopy(e,t,s,r,i){if(e.length>=t+i&&s.length>=r+i)for(;i-- >0;)s[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let s=0,r=e.length-1;r>=0;s++,r--)t[s]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,s=new Array,r=-1;for(let i=0;i<t;i++){let n=e.charAt(i);if(r>=0){if(n===";"){let a=e.substring(r+1,i);switch(a){case"lt":s.push("<");break;case"gt":s.push(">");break;case"quot":s.push('"');break;case"apos":s.push("'");break;case"amp":s.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));s.push(String.fromCharCode(o))}else s.push("&"+a+";")}r=-1}}else n==="&"?r=i:s.push(n)}return r>=0&&s.push(e.substring(r)),s.join("")}static addAll(e,t){for(let s of t)e.push(s)}static addAllSet(e,t){for(let s of t)e.add(s)}static contains(e,t){for(let s of e)if(s.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}else return!1}static remove(e,t){let s=0,r=e.length;for(let i=0;i<r;i++)e[i]===t&&(e.splice(i,1),i--,r--,s++);return s}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++){var r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!Ty){let e=this.getUrlVars().version;e?Ty="/analyzer/v"+e:Ty="/analyzer"}return Ty}static add2objS(e,t,s){if(t in e)return e[t];{let r=s(t);return e[t]=r,r}}static downloadFile(e,t){let s=document.createElement("a"),r=URL.createObjectURL(t);s.download=e,s.href=r,s.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;Qb[0]=new Date().getTime(),e.push(eT[1].toString(16)),Qb[0]=Math.random(),e.push(LP[3].toString(16));let t=LP[2].toString(16);e.push("4"+t.substr(0,3)),Qb[0]=performance.now();let s=eT[0].toString(16)+eT[1].toString(16);return e.push("0"+s.substr(0,3)),e.push(s.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}};var OO=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(eh.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(eh.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(eh.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(eh.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},s9=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(s9||{}),r9=/(\.?0+)$/,eh=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let s=this._format(e,t);if(typeof s=="string")return s;throw new Error(this.format("Invalid state on (%d) %s",s,e))}static _format(e,t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c),u=l.charCodeAt(0);switch(r){case 0:u===37?r=1:s.push(l);break;case 1:switch(u){case 100:if(n=t[i++],typeof n=="number")s.push(n.toFixed(0)),r=0;else return c;break;case 102:if(n=t[i++],typeof n=="number")s.push(n.toString()),r=0;else return c;break;case 120:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16)),r=0;else return c;break;case 88:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16).toUpperCase()),r=0;else return c;break;case 115:case 99:n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case 48:a=c+1,o=-1,r=2;break;case 37:s.push("%"),r=0;break;default:return c}break;case 2:switch(u){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=c;break;case 120:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(BP.lpad((n|0).toString(16),"0",h)),r=0;else return c}else return c;break;case 88:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(BP.lpad((n|0).toString(16).toUpperCase(),"0",h)),r=0;else return c}else return c;break;default:return c}break;default:return c}}return s.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let s=new Array,r=0;for(;;){let i=e.exec(t);if(i!==null){let n=e.lastIndex-i[0].length;s.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);OO.nullOrEmpty(n)||s.push(n);break}}return s}static fmtNumber(e){return e.toFixed(5).replace(r9,"")}},i9=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(i9||{});function n9(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var a9=(e,t)=>{e===3?console.error(t):console.log(t)},o9=(e,t)=>eh.format("%s %s: %s",new Date,n9(e),t),mo,r0=(mo=class{constructor(t,s=a9,r=o9){this.debug=!1,this.level=t,this.writer=s,this.fmt=r}static mix(...t){let s=4;for(let r of t)r.level<s&&(s=r.level);return new mo(s,(r,i)=>{for(let n of t)n.write1(r,i)},(r,i)=>i)}wrap(t=null,s=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),i=s===null?this.writer:(n,a)=>{s(n,a),this.writer(n,a)};return new mo(this.level,i,r)}chain(t){return t.wrap(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}write3(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,eh.format(s,...r)))}write2(t,s){this.include(t)&&(s instanceof Error?this.writer(t,this.fmt(t,s.stack)):this.writer(t,this.fmt(t,s.toString())))}write1(t,s){this.include(t)&&this.writer(t,this.fmt(t,s))}debug3(t,...s){this.write3(0,t,s)}debug2(t){this.write2(0,t)}debug1(t){this.write1(0,t)}info3(t,...s){this.write3(1,t,s)}info2(t){this.write2(1,t)}info1(t){this.write1(1,t)}warning3(t,...s){this.write3(2,t,s)}warning2(t){this.write2(2,t)}warning1(t){this.write1(2,t)}error3(t,...s){this.write3(3,t,s)}error2(t){this.write2(3,t)}error1(t){this.write1(3,t)}},mo.DUMMY=new mo(4),mo),MT=new ArrayBuffer(8),tT=new Float64Array(MT),sT=new Uint32Array(MT),kP=new Uint16Array(MT),MP=ArrayBuffer;try{MP=self.HTMLImageElement||MP}catch{}var wy=null;function al(e,t,s=0,r=e.length){i(e,null,t,s,r);function i(a,o,c,l,u){let h,p,d,f;if(l<u-1){let m=u-l;if(m>50)o===null&&(o=new Array(m+1)),n(a,o,c,l,(l+u)/2|0,u);else{h=a[l],p=l,d=l,f=u;let g=p+1;for(;g<f;){if(d!=f){if(f=f+-1,c(h,a[f])<=0)continue;a[d]=a[f],d=f;continue}if(c(h,a[g])>=0){p=g,g=p+1;continue}a[d]=a[g],p=g,d=g,g=p+1}a[d]=h,i(a,o,c,l,d),i(a,o,c,d+1,u)}}}function n(a,o,c,l,u,h){i(a,o,c,l,u),i(a,o,c,u,h);for(var p=l,d=u,f=0,m=a[p],g=a[d];p<u&&d<h;){var b=c(m,g);isNaN(b)?(o[f++]=g,g=a[++d]):(b<=0&&(o[f++]=m,m=a[++p]),b>=0&&(o[f++]=g,g=a[++d]))}for(;p<u;p++)o[f++]=a[p];for(;d<h;d++)o[f++]=a[d];for(p=l,d=0;d<f;p++,d++)a[p]=o[d]}}var ti=class{static repeat(e,t){let s=new Array(t);for(;t-- >0;)s[t]=e;return s.join("")}static lpad(e,t,s){let r=s-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,s){let r=s-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let s=0;s<e.length;s++)t=31*t+e.charCodeAt(s)|0;return t}else return 0}static arraycopy(e,t,s,r,i){if(e.length>=t+i&&s.length>=r+i)for(;i-- >0;)s[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let s=0,r=e.length-1;r>=0;s++,r--)t[s]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,s=new Array,r=-1;for(let i=0;i<t;i++){let n=e.charAt(i);if(r>=0){if(n===";"){let a=e.substring(r+1,i);switch(a){case"lt":s.push("<");break;case"gt":s.push(">");break;case"quot":s.push('"');break;case"apos":s.push("'");break;case"amp":s.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));s.push(String.fromCharCode(o))}else s.push("&"+a+";")}r=-1}}else n==="&"?r=i:s.push(n)}return r>=0&&s.push(e.substring(r)),s.join("")}static addAll(e,t){for(let s of t)e.push(s)}static addAllSet(e,t){for(let s of t)e.add(s)}static contains(e,t){for(let s of e)if(s.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}else return!1}static remove(e,t){let s=0,r=e.length;for(let i=0;i<r;i++)e[i]===t&&(e.splice(i,1),i--,r--,s++);return s}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++){var r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!wy){let e=this.getUrlVars().version;e?wy="/analyzer/v"+e:wy="/analyzer"}return wy}static add2objS(e,t,s){if(t in e)return e[t];{let r=s(t);return e[t]=r,r}}static downloadFile(e,t){let s=document.createElement("a"),r=URL.createObjectURL(t);s.download=e,s.href=r,s.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;tT[0]=new Date().getTime(),e.push(sT[1].toString(16)),tT[0]=Math.random(),e.push(kP[3].toString(16));let t=kP[2].toString(16);e.push("4"+t.substr(0,3)),tT[0]=performance.now();let s=sT[0].toString(16)+sT[1].toString(16);return e.push("0"+s.substr(0,3)),e.push(s.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},c9=[1,10,100,1e3];var Sy=0,el=0;function jP(e,t,s){return Sy=Math.abs(e-t),s>=5&&Sy>1e-5||isNaN(s)&&Sy>1e-8?!1:Sy<1e-13?!0:(el=Math.min(FP(e),FP(t)),el<10&&(el=10),isNaN(s)||(el=Math.min(el,s)),UP(e,el)===UP(t,el))}var _y=0,Ay=0;function FP(e){return _y=0,Ay=0,e>0?_y=e-Math.floor(e):_y=e-Math.ceil(e),Ay=(_y.toString()||"").length,Ay>2?Ay-2:0}function UP(e,t,s){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!s)return Math.round(e);var r=c9[t]||Math.pow(10,t)||10;if(s){var i=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(i+e)}else return Math.round(e*r+1e-10)/r}var l9=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(l9||{}),u9=/(\.?0+)$/,th=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let s=this._format(e,t);if(typeof s=="string")return s;throw new Error(this.format("Invalid state on (%d) %s",s,e))}static _format(e,t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c),u=l.charCodeAt(0);switch(r){case 0:u===37?r=1:s.push(l);break;case 1:switch(u){case 100:if(n=t[i++],typeof n=="number")s.push(n.toFixed(0)),r=0;else return c;break;case 102:if(n=t[i++],typeof n=="number")s.push(n.toString()),r=0;else return c;break;case 120:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16)),r=0;else return c;break;case 88:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16).toUpperCase()),r=0;else return c;break;case 115:case 99:n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case 48:a=c+1,o=-1,r=2;break;case 37:s.push("%"),r=0;break;default:return c}break;case 2:switch(u){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=c;break;case 120:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(ti.lpad((n|0).toString(16),"0",h)),r=0;else return c}else return c;break;case 88:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(ti.lpad((n|0).toString(16).toUpperCase(),"0",h)),r=0;else return c}else return c;break;default:return c}break;default:return c}}return s.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let s=new Array,r=0;for(;;){let i=e.exec(t);if(i!==null){let n=e.lastIndex-i[0].length;s.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);Is.nullOrEmpty(n)||s.push(n);break}}return s}static fmtNumber(e){return e.toFixed(5).replace(u9,"")}},Is=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(th.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(th.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(th.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(th.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},nl,_e=(nl=class{static regular(t){return Math.round(t*this.precision)/this.precision}static eq(t,s){return Math.abs(t-s)<=this.eps}static neq(t,s){return Math.abs(t-s)>this.eps}static less(t,s){return t-s<-this.eps}static lesseq(t,s){return t-s<=this.eps}static greater(t,s){return t-s>this.eps}static greatereq(t,s){return t-s>=-this.eps}static sqrt(t){return Math.abs(t)<=1e-10?0:Math.sqrt(t)}static sortAsc(t,s){return t-s}static sortDesc(t,s){return s-t}},nl.eps=1e-8,nl.precision=1e8,nl);function ih(e,t){Gy(e.iterator(),t)}function Gy(e,t){let s=0;for(;e.hasNext();){let r=e.next();t(s++,r)}}var h9=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function wT(e){return new h9(e)}var Er,lt=(Er=class{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%Er.PIx2,t=t<0?Er.PIx2+t:t,t===Er.PIx2?0:t}static toQuarterBase(t){return Er.regular((t+Er.PI_4)/Er.PI_2*Er.PI_2)}static toQuarterBaseD(t){return Er.regularD(((t+45)/90|0)*90)}static transformD(t,s){return Er.toDegrees(Er.transform(Er.toRadians(t),s))}static transform(t,s){let r=Math.cos(t),i=Math.sin(t),n=new de(s.data[6],s.data[7]),a=new de(r,i).multiply3(s);return Er.regular(a.angle(n))}},Er.PIx2=Math.PI*2,Er.PI_2=Math.PI/2,Er.PI_4=Math.PI/4,Er),Ys=class{static dotProd1(e,t,s,r){return e*s+t*r}static dotProd2(e,t,s,r,i,n){return this.dotProd1(s-e,r-t,i-s,n-r)}static dotProd3(e,t,s){return this.dotProd2(e.x,e.y,t.x,t.y,s.x,s.y)}static crossProd1(e,t,s,r){return e*r-t*s}static crossProd2(e,t,s,r,i,n){return this.crossProd1(s-e,r-t,i-s,n-r)}static crossProd3(e,t,s){return this.crossProd2(e.x,e.y,t.x,t.y,s.x,s.y)}static distance2(e,t,s,r){let i=s-e,n=r-t;return i*i+n*n}static distance1(e,t,s,r){return this.hypot(s-e,r-t)}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y)}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var s=t;t=e,e=s}if(e===0)return t;var r=t/e;return e*Math.sqrt(1+r*r)}},IO=new ArrayBuffer(16),HP=new Float64Array(IO),Cy=new Int32Array(IO),Ot,de=(Ot=class{static sortByXAsc(t,s){return t.x-s.x}static sortByYAsc(t,s){return t.y-s.y}static sortByXYAsc(t,s){return t.x<s.x?-1:t.x>s.x?1:t.y-s.y}static caculateAngle(t,s){let r=Math.cos(t),i=Math.sin(t),n=r*s.data[0]+i*s.data[4],a=r*s.data[1]+i*s.data[5],o=new Ot(n,a).normalize();return Math.atan2(o.y,o.x)}static normal(t,s,r){let i=s.sub(t),n=r.sub(s);return i.cross(n)}static getVector2(t){return new Ot(Math.cos(t),Math.sin(t))}static getCrossPoint1(t,s,r,i){if(t.equals1(s)||r.equals1(i)||_e.eq(1,Math.abs(s.sub(t).normalize().dot(i.sub(r).normalize()))))return null;let n=s.y-t.y,a=t.x-s.x,o=s.x*t.y-t.x*s.y,c=i.y-r.y,l=r.x-i.x,u=i.x*r.y-r.x*i.y,h=n*l-c*a;return new Ot((u*a-o*l)/h,(o*c-u*n)/h)}static getCrossPoint2(t,s,r,i){return this.getCrossPoint1(t,t.add(s),r,r.add(i))}constructor(t,s){this.x=Is.normal(t),this.y=Is.normal(s)}get hashed(){return this._hashed==null&&(HP[0]=this.x,HP[1]=this.y,this._hashed=Cy[0]^Cy[1]^Cy[2]^Cy[3]),this._hashed}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(t){var s=this.x-t.x,r=this.y-t.y;return new Ot(s,r)}add(t){var s=this.x+t.x,r=this.y+t.y;return new Ot(s,r)}div(t){return new Ot(this.x/t,this.y/t)}add1(t,s){return new Ot(this.x+t,this.y+s)}mul(t){return new Ot(this.x*t,this.y*t)}cross(t){return this.x*t.y-this.y*t.x}getSin(){return this.y/this.length()}angle2(t){let s=this.y-t.y,r=this.x-t.x;return s=Math.abs(s-0)<10**-4?0:s,r=Math.abs(r-0)<10**-4?0:r,Math.atan2(s,r)}angleD2(t){return lt.toDegrees(this.angle2(t))}angle(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleX(t=Ot.ORIGIN){let s=this.angle(t);return s<0&&(s=Math.PI*2+s),s}angleD(t){return lt.toDegrees(this.angle(t))}distance1(t){let s=t.x-this.x,r=t.y-this.y;return Ys.hypot(s,r)}distance2(t){let s=t.x-this.x,r=t.y-this.y;return s*s+r*r}rotateD(t,s){return this.rotate(t,lt.toRadians(s))}rotate(t,s){let r=Math.cos(s),i=Math.sin(s),n=this.x-t.x,a=this.y-t.y,o=n*r+a*-i,c=n*i+a*r;return t.add1(o,c)}multiply3(t){let s=this.x*t.data[0]+this.y*t.data[3]+t.data[6],r=this.x*t.data[1]+this.y*t.data[4]+t.data[7];return new Ot(s,r)}multiply4(t){let s=this.x*t.data[0]+this.y*t.data[4]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+t.data[13];return new Ot(s,r)}hashCode(){return this.hashed}equals(t,s){return t instanceof Ot?jP(t.x,this.x,s)&&jP(t.y,this.y,s):!1}equals1(t){return t?_e.eq(this.x,t.x)&&_e.eq(this.y,t.y):!1}equals2(t,s){return t instanceof Ot?Math.abs(this.x-t.x)<=s&&Math.abs(this.y-t.y)<=s:!1}similarEquals(t,s=.5){return Math.abs(this.x*.1-t.x*.1)<=s&&Math.abs(this.y*.1-t.y*.1)<=s}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let t=this.x,s=this.y;return new ei(t,t,s,s)}normalize(){if(this.x===0&&this.y===0)return new Ot(0,0);let t=this.x/this.length(),s=this.y/this.length();return new Ot(t,s)}regular(t=1e-4){let s=Math.round(1/t);return new Ot(Math.round(this.x*s)/s,Math.round(this.y*s)/s)}round(t=4){let s=10**(t|0);return new Ot(Math.round(this.x*s)/s,Math.round(this.y*s)/s)}mirrorX(t=Ot.ORIGIN){return new Ot(this.x,2*t.y-this.y)}mirrorY(t=Ot.ORIGIN){return new Ot(2*t.x-this.x,this.y)}mirrorCenter(t=Ot.ORIGIN){return new Ot(2*t.x-this.x,2*t.y-this.y)}clone(){return new Ot(this.x,this.y)}mirror(t=Ot.ORIGIN){return new Ot(2*t.x-this.x,2*t.y-this.y)}pointOnRays(t,s){let r=lt.toRadians(t);return new Ot(this.x+Math.cos(r)*s,this.y+Math.sin(r)*s)}pointOnRays2(t,s){let r=t.angle(this);return new Ot(this.x+Math.cos(r)*s,this.y+Math.sin(r)*s)}scale(t){return new Ot(this.x*t,this.y*t)}},Ot.ORIGIN=new Ot(0,0),Ot.X_UNIT_VECTOR=new Ot(1,0),Ot.Y_UNIT_VECTOR=new Ot(0,1),Ot),d9=(e=>(e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT",e))(d9||{}),p9=(e=>(e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM",e))(p9||{}),ir,oo=(ir=class{constructor(t,s){this.horizontal=t,this.vertical=s}},ir.LT=new ir(0,0),ir.LC=new ir(0,1),ir.LB=new ir(0,2),ir.CT=new ir(1,0),ir.CC=new ir(1,1),ir.CB=new ir(1,2),ir.RT=new ir(2,0),ir.RC=new ir(2,1),ir.RB=new ir(2,2),ir),f9=(e=>(e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER",e[e.SEPARATED=2]="SEPARATED",e[e.INTERSECTED=3]="INTERSECTED",e[e.EQ=4]="EQ",e[e.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",e[e.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",e))(f9||{}),Oi=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(e){return this.minX=Math.min(this.minX,e.minX),this.maxX=Math.max(this.maxX,e.maxX),this.minY=Math.min(this.minY,e.minY),this.maxY=Math.max(this.maxY,e.maxY),this}ext2(e){return this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y),this}ext3(e){for(let t=0;t<e.length;t++){let s=e[t];this.ext2(s)}return this}ext4(e){return ih(e,(t,s)=>(this.ext2(s),!0)),this}ext5(e,t,s,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,s),this.maxY=Math.max(this.maxY,r),this}ext6(e,t){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t),this}ext7(e){if(e<0){let t=e*2;if(t<this.minX-this.maxX||t<this.minY-this.maxY)throw new Error("")}return this.minX-=e,this.maxX+=e,this.minY-=e,this.maxY+=e,this}ext8(e){let t=[];for(let s=0;s<e.length;s+=2)t.push(new de(e[s],e[s+1]));return this.ext3(t)}ext9(e,t,s,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e+s),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t+r),this}ext10({x:e,y:t,width:s,height:r}){return this.ext9(e,t,s,r)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new ei(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new ei(this.minX,this.maxX,this.minY,this.maxY):new ei(0,0,0,0)}},sp=new Float64Array(4),ei=class En{static extendRect({x:t,y:s,width:r,height:i}){return new En(t,t+r,s,s+i)}static extend1(t,s){if(t===null)return new En(s.x,s.x,s.y,s.y);{let r=Math.min(t.minX,s.x),i=Math.max(t.maxX,s.x),n=Math.min(t.minY,s.y),a=Math.max(t.maxY,s.y);return new En(r,i,n,a)}}static extend2(t,s){if(t){let r=Math.min(t.minX,s.minX),i=Math.max(t.maxX,s.maxX),n=Math.min(t.minY,s.minY),a=Math.max(t.maxY,s.maxY);return new En(r,i,n,a)}else return s}static extend3(t,s){let r=Math.min(t.x,s.x),i=Math.max(t.x,s.x),n=Math.min(t.y,s.y),a=Math.max(t.y,s.y);return new En(r,i,n,a)}static extend4(t,s,r){return new En(t.x-s/2,t.x+s/2,t.y-r/2,t.y+r/2)}constructor(t,s,r,i){if(this.minX=Is.normal(t),this.maxX=Is.normal(s),this.minY=Is.normal(r),this.maxY=Is.normal(i),t>s||r>i)throw new Error(`min > max is not permitted: [${t}, ${s}, ${r}, ${i}]`)}get data(){return sp[0]=this.minX,sp[1]=this.maxX,sp[2]=this.minY,sp[3]=this.maxY,sp}isContains(t){return this.isContains1(t.x,t.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(t,s){return this.isContainsX(t)&&this.isContainsY(s)}isContains2(t,s){return this.isContainsX1(t)&&this.isContainsY1(s)}isContainsX(t){return t>=this.minX&&t<=this.maxX}isContainsX1(t){return _e.greatereq(t,this.minX)&&_e.lesseq(t,this.maxX)}isContainsY(t){return t>=this.minY&&t<=this.maxY}isContainsY1(t){return _e.greatereq(t,this.minY)&&_e.lesseq(t,this.maxY)}isIntersect(t){return!(this.maxX<t.minX||this.minX>t.maxX||this.maxY<t.minY||this.minY>t.maxY)}extendOfSize(t){return Is.positiveOr0(this.maxX-this.minX+t*2),Is.positiveOr0(this.maxY-this.minY+t*2),new En(this.minX-t,this.maxX+t,this.minY-t,this.maxY+t)}isInside(t){return this.minX>=t.minX&&this.maxX<=t.maxX&&this.minY>=t.minY&&this.maxY<=t.maxY}isContainsBBox(t){return this.maxX>=t.maxX&&this.minX<=t.minX&&this.maxY>=t.maxY&&this.minY<=t.minY}isContainsBBox1(t){return _e.greatereq(this.maxX,t.maxX)&&_e.lesseq(this.minX,t.minX)&&_e.greatereq(this.maxY,t.maxY)&&_e.lesseq(this.minY,t.minY)}intersect(t){let s=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(s>r)return null;let i=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return i>n?null:new En(s,r,i,n)}intersection1(t){let s=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(_e.greater(s,r))return null;s>r&&(r=s);let i=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return _e.greater(i,n)?null:(i>n&&(n=i),new En(s,r,i,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new de(this.minX,this.maxY)}UR(){return new de(this.maxX,this.maxY)}LL(){return new de(this.minX,this.minY)}LR(){return new de(this.maxX,this.minY)}center(){return new de(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(t){let s=new Oi;return s.ext2(this.LL().multiply3(t)),s.ext2(this.LR().multiply3(t)),s.ext2(this.UR().multiply3(t)),s.ext2(this.UL().multiply3(t)),s.build()}transform4(t){let s=new Oi;return s.ext2(this.LL().multiply4(t)),s.ext2(this.LR().multiply4(t)),s.ext2(this.UR().multiply4(t)),s.ext2(this.UL().multiply4(t)),s.build()}isSeparated(t){if(t==null||t==null)return!1;let s;this.minX>=t.minX?s=this.minX:s=t.minX;let r;if(this.maxX<=t.maxX?r=this.maxX:r=t.maxX,s>r)return!0;{let i;this.minY>=t.minY?i=this.minY:i=t.minY;let n;return this.maxY<=t.maxY?n=this.maxY:n=t.maxY,i>n}}relation(t){let s=0,r=0,i;this.minX>t.minX?(s++,i=this.minX):this.minX===t.minX?i=this.minX:(r++,i=t.minX);let n;if(this.maxX<t.maxX?(s++,n=this.maxX):this.maxX===t.maxX?n=this.maxX:(r++,n=t.maxX),i>n)return 2;{let a;this.minY>t.minY?(s++,a=this.minY):this.minY===t.minY?a=this.minY:(r++,a=t.minY);let o;return this.maxY<t.maxY?(s++,o=this.maxY):this.maxY===t.maxY?o=this.maxY:(r++,o=t.maxY),a>o?2:s===4?0:r===4?1:s===0&&r===0?4:i===n||a===o?6:s!==r?5:3}}zoom(t){let s=this.width(),r=this.height(),i=this.center();return t!=0&&(s/=t/2,r/=t/2),new En(i.x-s,i.x+s,i.y-s,i.y+s)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(t){return this.minY==t.minY&&this.minX==t.minX&&this.maxX==t.maxX&&this.maxY==t.maxY}extendSize(t,s){return Object.is(void 0,s)&&(s=t),En.extend4(this.center(),this.width()+t,this.height()+s)}positionOnBBox(t,s=0){let r=this.center(),i=this.width()*s/2,n=this.height()*s/2,a=t.x-r.x,o=t.y-r.y;return a>i?o>n?oo.RT:o<-n?oo.RB:oo.RC:a<-i?o>n?oo.LT:o<-n?oo.LB:oo.LC:o>n?oo.CT:o<-n?oo.CB:oo.CC}bbox(){return this}},Yy=class xt{static mul(t,s,r,i,n,a){let o=0,c=0;for(let l=0;l<t;l++){for(let u=0;u<r;u++){let h=u,p=0;for(let d=0;d<s;d++)p+=i[c+d]*n[h],h+=r;a[o++]=p}c+=s}}constructor(t,s,r){this.m=Is.normal(t),this.n=Is.normal(s);let i=t*s;if(r.length===i){for(let n=0;n<r.length;n++)Is.normal(r[n]);this.data=r}else throw new Error("invalid matrix size")}mul(t){if(this.n===t.m){let s=new Array(this.m*t.n);return xt.mul(this.m,this.n,t.n,this.data,t.data,s),new xt(this.m,t.n,s)}else throw new Error("m !== p")}toString(){let t=[];t.push("Matrix ("),t.push(this.m.toString()),t.push(" x "),t.push(this.n.toString()),t.push(")");let s=0;for(let r=0;r<this.m;r++)for(let i=0;i<this.n;i++){let n=this.data[s++].toString();i===0?(t.push(`
`),t.push("	"),t.push(n)):(t.push(", "),t.push(n))}return t.join("")}static on(t,s,r){return t*s+r}initExpandMatrix(t){let s=this.m,r=this.n,i=r*2,n=new Array(s*i);for(let a=0;a<s;a++)for(let o=0;o<i;o++)o<r?n[xt.on(i,a,o)]=t[xt.on(r,a,o)]:o===s+a?n[xt.on(i,a,o)]=1:n[xt.on(i,a,o)]=0;return n}inverseMatrix(t,s,r){for(let i=0;i<s;i++){let n=t[xt.on(r,i,i)];for(let a=0;a<r;a++)t[xt.on(r,i,a)]/=n}return t}getMatrixRank(t,s,r){let i=Math.min(s,r);for(let n=0;n<s;n++){if(t[xt.on(r,n,n)]===0){let a=new Array(r),o;for(o=n;o<s;o++)if(t[xt.on(r,o,n)]!==0){ti.arraycopy(t,xt.on(r,o,0),a,0,r),ti.arraycopy(t,xt.on(r,n,0),t,xt.on(r,o,0),r),ti.arraycopy(a,0,t,xt.on(r,n,0),r);break}o>=s&&(i-=1)}if(!(i<s))for(let a=0;a<s;a++){if(a===n)continue;let o=t[xt.on(r,a,n)]/t[xt.on(r,n,n)];for(let c=0;c<r;c++)t[xt.on(r,a,c)]-=t[xt.on(r,n,c)]*o}}return i}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function t(a){return _e.lesseq(Math.abs(a),0)}let s=this.initExpandMatrix(this.data.slice(0)),r=this.n*2;function i(a,o){for(let c=0;c<r;c++){let l=s[xt.on(r,a,c)];s[xt.on(r,a,c)]=s[xt.on(r,o,c)],s[xt.on(r,o,c)]=l}}for(let a=0;a<this.m;a++){let o=Math.abs(s[xt.on(r,a,a)]),c=a;if(t(s[xt.on(r,a,a)]))for(let u=a+1;u<this.m;u++){if(t(s[xt.on(r,u,a)])){Math.abs(s[xt.on(r,u,a)])>o&&(o=Math.abs(s[xt.on(r,u,a)]),c=u);continue}i(a,u);break}if(t(s[xt.on(r,a,a)])){if(o===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),c!==a&&i(a,c)}let l=1/s[xt.on(r,a,a)];for(let u=0;u<r;u++)s[xt.on(r,a,u)]*=l;for(let u=0;u<this.m;u++){if(a===u)continue;let h=s[xt.on(r,u,a)];for(let p=a;p<r;p++)s[xt.on(r,u,p)]-=s[xt.on(r,a,p)]*h}}let n=[];for(let a=0;a<this.m;a++)for(let o=this.n;o<r;o++)n[xt.on(this.n,a,o-this.n)]=s[xt.on(r,a,o)];return new xt(this.m,this.n,n)}getTransposeMatrix(){let t=new Array(this.data.length);for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++)t[r*this.n+s]=this.data[s*this.m+r];return new xt(this.n,this.m,t)}hashCode(){let t=0;for(let s of this.data)t+=s;return t}equals(t){return this===t?!0:t===null?!1:t instanceof xt?!(this.m!=t.m||this.n!=t.n||!ti.equals(this.data,t.data)):!1}},m9=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ts,xO=(Ts=class extends Yy{static translate(t,s,r){return new Ts([1,0,0,0,0,1,0,0,0,0,1,0,t,s,r,1])}static translate1(t){return new Ts([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static rotateX(t){let s=Math.cos(t),r=Math.sin(t);return new Ts([1,0,0,0,0,s,r,0,0,-r,s,0,0,0,0,1])}static rotateY(t){let s=Math.cos(t),r=Math.sin(t);return new Ts([s,0,-r,0,0,1,0,0,r,0,s,0,0,0,0,1])}static rotateZ(t){let s=Math.cos(t),r=Math.sin(t);return new Ts([s,r,0,0,-r,s,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(t,s){t=t.normalize();let r=t.x,i=t.y,n=t.z,a=Math.sin(s),o=Math.cos(s);return new Ts([r*r*(1-o)+o,r*i*(1-o)+n*a,r*n*(1-o)-i*a,0,r*i*(1-o)-n*a,i*i*(1-o)+o,i*n*(1-o)+r*a,0,r*n*(1-o)+i*a,i*n*(1-o)-r*a,n*n*(1-o)+o,0,0,0,0,1])}static scale(t,s=t,r=t){return new Ts([t,0,0,0,0,s,0,0,0,0,r,0,0,0,0,1])}static flipX(){return new Ts([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new Ts([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(t,s){return t.equals1(de.ORIGIN)?Ts.rotateZ(s):Ts.translate(-t.x,-t.y,0).rotateZ(s).translate1(t.x,t.y,0)}static getMatrix4(t,s,r,i){let n=Math.cos(s),a=Math.sin(s),o=r*(t.x*n-t.y*a)+i.x,c=t.x*a+t.y*n+i.y,l=[r*n,a,0,0,-a*r,n,0,0,0,0,1,0,o,c,0,1];return new Ts(l)}constructor(t=m9){super(4,4,t)}translate(t){return this.multiply4(Ts.translate1(t))}translate1(t,s,r){return this.multiply4(Ts.translate(t,s,r))}rotateX(t){return this.multiply4(Ts.rotateX(t))}rotateY(t){return this.multiply4(Ts.rotateY(t))}rotateZ(t){return this.multiply4(Ts.rotateZ(t))}scale(t,s=t,r=t){return this.multiply4(Ts.scale(t,s,r))}scale1(t){return this.multiply4(Ts.scale(t.x,t.y,t.z))}setOrigin(t,s,r){return Ts.translate(-t,-s,-r).multiply4(this).translate1(t,s,r)}setOrigin1(t){return this.setOrigin(t.x,t.y,t.z)}multiply4(t){let s=new Array(16);return Yy.mul(4,4,4,this.data,t.data,s),new Ts(s)}getInverseMatrix(){let t=super.getInverseMatrix();return new Ts(t.data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new Ts(t.data)}inverse(){let t=this.getInverseMatrix();return new Ts(t.data)}toMatrix3(){let t=this.data;return new Wt([t[0],t[1],0,t[4],t[5],0,t[12],t[13],1])}},Ts.ORIGIN=new Ts,Ts);function rp(e){return OO.normal(parseFloat(e))}var g9=[1,0,0,0,1,0,0,0,1],is,Wt=(is=class extends Yy{static translate(t,s){return new is([1,0,0,0,1,0,t,s,1])}static translate1(t){return this.translate(t.x,t.y)}static rotate(t){let s=Math.cos(t),r=Math.sin(t);return new is([s,r,0,-r,s,0,0,0,1])}static rotateD(t){return this.rotate(lt.toRadians(t))}static scale(t,s=t){return new is([t,0,0,0,s,0,0,0,1])}static scale1(t,s){return new is([t,0,0,0,s,0,0,0,1])}static toDOMMatrix(t){let[s,r,,i,n,,a,o]=t.data;return`matrix(${[s,r,i,n,a,o].join(",")})`}static svgTrasform(t){let s=t.split(" "),r=null;return s.forEach(i=>{i=i.trim();let n=i.trim().replace(")","").split("("),a=n[0],o=n[1].split(",");switch(a){case"translate":let c=rp(o[0]),l=rp(o[1]);r=r?r.translate(c,l):is.translate(c,l);break;case"rotate":let u=rp(o[0]),h=rp(o[1]),p=rp(o[2]);r=r?r.setOrigin(h,p):is.translate(h,p),r=r.rotateD(u);break;default:return}}),r}constructor(t=g9){super(3,3,t);let s=t[0],r=t[3],i=t[1],n=t[4];this.iScale=Math.sqrt(s*s+i*i),this.jScale=Math.sqrt(r*r+n*n)}isMirrored(){return this.det()<0}multiply3(t){let s=new Array(9);return Yy.mul(3,3,3,this.data,t.data,s),new is(s)}translate(t,s){return this.multiply3(is.translate(t,s))}translate1(t){return this.multiply3(is.translate1(t))}scale(t,s=t){return this.multiply3(is.scale(t,s))}scale1(t,s){return this.multiply3(is.scale1(t,s))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let t=this.getInverseMatrix();return new is(t.data)}rotateD(t){return this.multiply3(is.rotateD(t))}rotate(t){return this.multiply3(is.rotate(t))}resetOffset(){let t=this.data;return new is([t[0],t[1],0,t[3],t[4],0,0,0,1])}setOrigin(t,s){return is.translate(-t,-s).multiply3(this).translate(t,s)}setOrigin1(t){return this.setOrigin(t.x,t.y)}getInverseMatrix(){return new is(super.getInverseMatrix().data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new is(t.data)}toMatrix4(){let t=this.data;return new xO([t[0],t[1],0,t[2],t[3],t[4],0,t[5],0,0,1,0,t[6],t[7],0,t[8]])}scaleNum(t){return!t||isNaN(t)?t:t*this.iScale}},is.ORIGIN=new is,is.MIRROR_Y=new is([1,0,0,0,-1,0,0,0,1]),is.MIRROR_X=new is([-1,0,0,0,1,0,0,0,1]),is.ROT_90=new is([0,1,0,-1,0,0,0,0,1]),is.ROT_N90=new is([0,-1,0,1,0,0,0,0,1]),is),y9=(e=>(e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e))(y9||{}),ic=(e=>(e[e.CW=0]="CW",e[e.CCW=1]="CCW",e))(ic||{}),Cp=class{},ST=class cp{constructor(t,s,r){this.p1=t,this.p2=s,this.p3=r}barycentre(){return cp.barycentre(this.p1,this.p2,this.p3)}incentre(){return cp.incentre(this.p1,this.p2,this.p3)}static barycentre(t,s,r){let i=t.x+s.x+r.x,n=t.y+s.y+r.y;return new de(i/3,n/3)}static incentre(t,s,r){let i=s.sub(r).length(),n=t.sub(r).length(),a=t.sub(s).length(),o=i+n+a,c=i*t.x+n*s.x+a*r.x,l=i*t.y+n*s.y+a*r.y;return new de(c/o,l/o)}area(){return cp.area(this.p1,this.p2,this.p3)}static area(t,s,r){return this.area2(t.x,t.y,s.x,s.y,r.x,r.y)/2}static area2(t,s,r,i,n,a){return Math.abs(Ys.crossProd2(t,s,r,i,n,a))}scale(t,s){let r=Wt.translate(-t.x,-t.y).scale(s).translate1(t),i=this.p1.multiply3(r),n=this.p2.multiply3(r),a=this.p3.multiply3(r);return new cp(i,n,a)}scaleOnBarycentre(t){return this.scale(this.barycentre(),t)}scaleOnIncentre(t){return this.scale(this.incentre(),t)}extend(t){let s=this.incentre(),r=this.p1.add(this.p2).sub(s).scale(1/2),i=r.length(),n=de.ORIGIN.pointOnRays2(r,i+t).length()/i;return this.scaleOnIncentre(n)}container(t){let s=this.p3.sub(this.p1),r=this.p2.sub(this.p1),i=t.sub(this.p1),n=s.dot(s),a=s.dot(r),o=s.dot(i),c=r.dot(r),l=r.dot(i),u=1/(n*c-a*a),h=(c*o-a*l)*u;if(h<0||h>1)return!1;let p=(n*l-a*o)*u;return p<0||p>1?!1:h+p<=1}};function Dy(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var zn=class rc{static getMinDistanceWithoutCross(t,s){let r=Dy();return rc.minLine(t,s,r),r.minDistance}static getMinDistance(t,s){return bn(t,s)?0:this.getMinDistanceWithoutCross(t,s)}static getMinLineWithCross(t,s){let r=Dy();return rc.minLine(t,s,r),new le(r.start,r.end)}static getMinLine(t,s){return rc.intersection(t,s)||this.getMinLineWithCross(t,s)}static getMinDistanceFromPoint(t,s){let r=Dy();if(s instanceof le)this.point2LineMinLine(r,s,t);else if(s instanceof we)this.point2ArcMinDistance(t,s,r);else throw new Error("not support");return r.minDistance}constructor(t,s){if(this.pt1=t,this.pt2=s,this.minline=rc.intersection(t,s),this.minline)this.minDistance=0;else{let r=Dy();rc.minLine(t,s,r),this.minline=new le(r.start,r.end),this.minDistance=r.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(t,s){let r=bn(t,s);if(r===0)return;let i=new Array;for(let n=0;n<r;n+=2){let a=new de(te[n],te[n+1]);i.push(a)}return i.length>1?new le(i[0],i[1]):new le(i[0],i[0])}static minLine(t,s,r){if(t instanceof le&&s instanceof le)return this.minDistanceForLines(t,s,r);if(t instanceof we&&s instanceof le)return this.minDistanceForLineAndArc(t,s,r);if(t instanceof le&&s instanceof we)return this.minDistanceForLineAndArc(s,t,r);if(t instanceof we&&s instanceof we)return this.minDistanceForArcs(t,s,r);throw new Error("not support")}static minDistanceForLines(t,s,r){[t.start(),t.end(),s.start(),s.end()].forEach((i,n)=>{n<2?this.point2LineMinLine(r,s,i):this.point2LineMinLine(r,t,i)})}static minDistanceForLineAndArc(t,s,r){this.point2LineMinLine(r,s,t.start()),this.point2LineMinLine(r,s,t.svgEnd);let i=rc.foot(s,t.center);s.bbox().extendOfSize(1e-8).isContains(i)&&this.point2ArcMinLine(r,t,i),this.point2ArcMinLine(r,t,s.start()),this.point2ArcMinLine(r,t,s.end())}static minDistanceForArcs(t,s,r){this.concentricArc(t,s,r),this.point2ArcMinDistance(s.start(),t,r),this.point2ArcMinDistance(s.svgEnd,t,r),this.point2ArcMinDistance(t.start(),s,r),this.point2ArcMinDistance(t.svgEnd,s,r),(Hn(t,s.center)||Hn(s,t.center))&&this.shortestLineForArcs(t,s,r)}static minLineForArcAndLine(t,s,r){let i=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));this.arcShortestLine(t,s,r,i),this.arcShortestLine(t,s,r,n)}static arcInnerLineFootSegment(t,s,r){let i=r.distance1(t.center);if(i!==0){let n=t.rx*(r.y-t.center.y)/i+t.center.y,a=t.rx*(r.x-t.center.x)/i+t.center.x;i=t.rx-i,i<s.minDistance&&(s.minDistance=i,s.start=new de(a,n),s.end=r)}else i=t.rx-i,i<s.minDistance&&(s.minDistance=i,s.start=t.start(),s.end=r)}static shortestLineForArcs(t,s,r){let i=t.center.angleD(s.center),n=s.center.angleD(t.center),a=t.pointOn(i),o=t.pointOn(n),c=s.pointOn(i),l=s.pointOn(n);Hn(t,a)&&(this.arcShortestLine(s,r,a,c),this.arcShortestLine(s,r,a,l)),Hn(t,o)&&(this.arcShortestLine(s,r,o,c),this.arcShortestLine(s,r,o,l)),this.shortestLineForArcs1(t,s,r)}static shortestLineForArcs1(t,s,r){let i=s.start().sub(t.center).normalize(),n=s.end().sub(t.center).normalize(),a=t.start().sub(s.center).normalize(),o=t.end().sub(s.center).normalize(),c=t.center.add(i.mul(t.rx)),l=t.center.add(n.mul(t.rx)),u=s.center.add(a.mul(s.rx)),h=s.center.add(o.mul(s.rx));Hn(t,c)&&_e.greater(s.start().distance2(t.center),0)&&this.arcShortestLine(t,r,s.start(),c),Hn(t,l)&&_e.greater(s.end().distance2(t.center),0)&&this.arcShortestLine(t,r,s.end(),l),Hn(s,u)&&_e.greater(t.start().distance2(s.center),0)&&this.arcShortestLine(s,r,t.start(),u),Hn(s,h)&&_e.greater(t.end().distance2(s.center),0)&&this.arcShortestLine(s,r,t.end(),h)}static concentricArc(t,s,r){if(!(t.center.distance1(s.center)<1e-5&&t.rx===s.rx&&t.ry===s.ry))return;let i=t.start().distance1(s.svgEnd);i<r.minDistance&&(r.minDistance=i,r.start=t.start(),r.end=s.svgEnd),i=s.start().distance1(t.svgEnd),i<r.minDistance&&(r.minDistance=i,r.start=s.start(),r.end=t.svgEnd)}static point2ArcMinDistance(t,s,r){if(Hn(s,t)){let i=s.pointOn(t.angleD(s.center)),n=s.pointOn(s.center.angleD(t));this.arcShortestLine(s,r,t,i),this.arcShortestLine(s,r,t,n)}else this.minLineSegment(r,s.start(),t),this.minLineSegment(r,s.svgEnd,t)}static point2ArcMinLine(t,s,r){if(Hn(s,r)){let i=r.distance1(s.center);i>s.rx||i>s.ry?this.minLineForArcAndLine(s,t,r):this.arcInnerLineFootSegment(s,t,r)}}static point2LineMinLine(t,s,r){let i=rc.foot(s,r);s.bbox().extendOfSize(1e-8).isContains(i)?this.minLineSegment(t,i,r):(this.minLineSegment(t,s.start(),r),this.minLineSegment(t,s.end(),r))}static minLineSegment(t,s,r){let i=s.distance1(r);i<t.minDistance&&(t.minDistance=i,t.start=s,t.end=r)}static arcShortestLine(t,s,r,i){if(!Hn(t,i))return;let n=r.distance1(i);n<s.minDistance&&(s.minDistance=n,s.start=r,s.end=i)}static foot(t,s){if(t.isPoint())return t.start();if(!_e.eq(t.b,0)&&!_e.eq(t.a,0)){let r=t.start(),i=t.direct,n=(s.x-r.x)*i.x+(s.y-r.y)*i.y;return new de(r.x+i.x*n,r.y+i.y*n)}else return _e.eq(t.b,0)&&!_e.eq(t.a,0)?new de(t.start().x,s.y):!_e.eq(t.b,0)&&_e.eq(t.a,0)?new de(s.x,t.start().y):s}};function Hn(e,t){if(_e.eq(e.sweepAngle,360))return!0;let s=lt.regularD(t.angleD(e.center));return e.sweepAngle>0?(_e.less(s,e.startAngle)&&(s+=360),_e.greatereq(e.endAngle(),s)):(_e.greater(s,e.startAngle)&&(s-=360),_e.lesseq(e.endAngle(),s))}var E9=[1,10,100,1e3],GP="http://www.w3.org/2000/svg",YP="http://www.w3.org/1999/xlink",VP="http://www.w3.org/XML/1998/namespace",zP="https://easyeda.com/",yX=(function(){var e={svg:GP,xlink:YP,xml:VP,c:zP};return e[GP]="svg",e[YP]="xlink",e[VP]="xml",e[zP]="c",e})();var rr=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),EX=(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};e["3D"]=(function(){for(var i=[16,19,3,7,5,1],n=21;n<52;n++)i.push(n+32,n);return i.push(2,6,8,4,17),i})();var t,s,r;for(t in e)if(e.hasOwnProperty(t)&&(r=e[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(s=25;s<=52;s++)r.push(s);return e})(),Cr=(function(){var e={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<53;t++)e[t]="Inner"+(t-20);for(t=53;t<85;t++)e[t]="Substrate"+(t-52);return e})(),bX=(function(){var e=[],t=[];for(var s in rr)if(rr.hasOwnProperty(s)){if(s.match(/^BOARD\d+/))continue;e.push(rr[s])}e.sort(),t.sort();var r={},i,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};e.forEach(function(o){switch(o){case rr.TOPLAYER:i={name:Cr[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case rr.BOTTOMLAYER:i={name:Cr[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case rr.TOPSILKLAYER:i={name:Cr[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case rr.BOTTOMSILKLAYER:i={name:Cr[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case rr.TOPPASTERLAYER:i={name:Cr[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case rr.BOTTOMPASTERLAYER:i={name:Cr[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case rr.TOPSOLDERLAYER:i={name:Cr[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case rr.BOTTOMSOLDERLAYER:i={name:Cr[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case rr.RATLINES:i={name:Cr[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case rr.BOARDOUTLINE:i={name:Cr[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case rr.ALL:i={name:Cr[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case rr.DOCUMENT:i={name:Cr[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case rr.TOPASSEMBLY:i={name:Cr[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case rr.BOTTOMASSEMBLY:i={name:Cr[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case rr.MECHANICAL:i={name:Cr[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case rr.MODEL3D:i={name:Cr[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case rr.LIBBODY:i={name:Cr[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case rr.PADSURFACE:i={name:Cr[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=rr.INNER1&&o<=rr.INNER32?i={name:Cr[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:i=null;break}i&&(r[o]=i)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var c=parseInt(RegExp.$1,16),l=.5,u=Math.min(255,Math.round((c>>16)*l)),h=Math.min(255,Math.round((c>>8&255)*l)),p=Math.min(255,Math.round((c&255)*l)),d=((u<<16)+(h<<8)+p).toString(16);return"#"+("00000"+d).substr(-6).toUpperCase()}return r})(),WP={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},TX=(function(){var e={};for(let t in WP)e[WP[t]]=t;return e})();var i0=Math.PI*2,Vy=Math.PI/2,wX=Math.sin(Math.PI/180);function b9(e,t,s){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!s)return Math.round(e);var r=E9[t]||Math.pow(10,t)||10;if(s){var i=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(i+e)}else return Math.round(e*r+1e-10)/r}function vO(e,t,s){var r=e-t;return s||(s=1e-10),(r>0?r:-r)<s}function T9(e,t,s){var r=u(e)&&u(t)&&u(s);if(!r)return console.warn("Bad arguments"),null;var i=t.x-s.x>0?t.x:s.x,n=t.y-s.y>0?t.y:s.y,a=t.x-s.x>0?s.x:t.x,o=t.y-s.y>0?s.y:t.y,c=e.x,l=e.y;return c<=i+.001&&c>=a-.001&&l<=n+.001&&l>=o-.001;function u(h){return h?(h.x=Number(h.x),h.y=Number(h.y),isNaN(h.x)||isNaN(h.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function w9(e,t,s,r,i,n){var a=(i-s)*(e-s)+(n-r)*(t-r),o=(i-s)*(i-s)+(n-r)*(n-r),c=a/o,l=s+(i-s)*c,u=r+(n-r)*c;return a<=0?Math.sqrt((e-s)*(e-s)+(t-r)*(t-r)):a>=o?Math.sqrt((e-i)*(e-i)+(t-n)*(t-n)):Math.sqrt((e-l)*(e-l)+(u-t)*(u-t))}function S9(e,t,s){return T9(e,t,s)?vO((e.x-t.x)*(s.y-t.y),(s.x-t.x)*(e.y-t.y),.001):!1}var lp=1e-4,te=new Float64Array(100);function bn(e,t){if(e instanceof le&&t instanceof le)return Da(e,t);if(e instanceof we&&t instanceof le)return _T(e,t);if(e instanceof le&&t instanceof we)return _T(t,e);if(e instanceof we&&t instanceof we)return NO(e,t);if(e instanceof qe&&t instanceof qe)return ky(e,t);if(e instanceof qe&&t instanceof le)return ky(e,new qe([t.start(),t.end()]));if(e instanceof le&&t instanceof qe)return ky(new qe([e.start(),e.end()]),t);if(e instanceof qe&&t instanceof we)return QP(t,e);if(e instanceof we&&t instanceof qe)return QP(e,t);throw new Error("not supported operation")}function _9(e,t){let s=e.bbox();if(s.isContainsY1(t)){let r=new le(new de(s.minX-1,t),new de(s.maxX+1,t));return Da(r,e)>0?1:0}else return 0}function A9(e,t){if(e.rx===e.ry){let s=e.bbox();if(s.isContainsY1(t)){let r=new le(new de(s.minX-1,t),new de(s.maxX+1,t));return zy(e,r)>0?1:0}else return 0}else throw new Error("not supported operation")}function qP(e,t){let s=e.bbox();return s.isContainsY1(t)&&ky(new qe([new de(s.minX-1,t),new de(s.maxX+1,t)]),e)>0?1:0}function JP(e,t,s){return isFinite(t)&&isFinite(s)?e.isContains2(t,s):!1}function C9(e,t){let s=t.length(),r=Ys.crossProd3(t.start(),t.end(),e.start())/s,i=Ys.crossProd3(t.start(),t.end(),e.end())/s;return Math.abs(r)<1e-8||Math.abs(i)<1e-8||r*i<0}function Da(e,t){let s=e.bbox().intersection1(t.bbox());if(!s)return 0;if(e.isPoint())if(t.isPoint()){let r=s.center();return te[0]=r.x,te[1]=r.y,2}else return KP(t,e,s);else{if(t.isPoint())return KP(e,t,s);{let r=function(y,T){s.isContains2(y,T)&&(te[E++]=y,te[E++]=T)};if(!C9(e,t))return 0;let i=e.start().x,n=e.start().y,a=e.end().x,o=e.end().y,c=t.start().x,l=t.start().y,u=t.end().x,h=t.end().y,p=t.length(),d=Ys.crossProd2(i,n,c,l,u,h)/p,f=Ys.crossProd2(a,o,c,l,u,h)/p;if(d*f>0&&!_e.eq(d,0)&&!_e.eq(f,0))return 0;let m=e.length(),g=Ys.crossProd2(c,l,i,n,a,o)/m,b=Ys.crossProd2(u,h,i,n,a,o)/m;if(g*b>0&&!_e.eq(g,0)&&!_e.eq(b,0))return 0;let E=0;if(_e.eq(d,0)&&_e.eq(f,0)){let y=s.UL(),T=s.UR(),w=s.LL(),S=s.LR();if(_e.eq(s.width(),0))_e.eq(s.height(),0)?(te[E++]=y.x,te[E++]=y.y):(te[E++]=y.x,te[E++]=y.y,te[E++]=w.x,te[E++]=w.y);else if(_e.eq(s.height(),0))te[E++]=y.x,te[E++]=y.y,te[E++]=T.x,te[E++]=T.y;else{let _=ST.area2(y.x,y.y,c,l,u,h),C=ST.area2(T.x,T.y,c,l,u,h);_<C?(te[E++]=y.x,te[E++]=y.y,te[E++]=S.x,te[E++]=S.y):(te[E++]=T.x,te[E++]=T.y,te[E++]=w.x,te[E++]=w.y)}}else if(_e.eq(d,0))r(i,n);else if(_e.eq(f,0))r(a,o);else{let y=Math.abs(d/(d-f));r(i+(a-i)*y,n+(o-n)*y)}return E}}}function KP(e,t,s){let r=t.start(),i=t.end(),n=Ys.crossProd3(e.start(),e.end(),t.start()),a=Ys.crossProd3(e.start(),e.end(),t.end());if(n*a<0){let o=s.center();return te[0]=o.x,te[1]=o.y,2}else if(Math.abs(n)<Math.abs(a)){if(_e.eq(n/e.length(),0))return te[0]=r.x,te[1]=r.y,2}else if(_e.eq(a/e.length(),0))return te[0]=i.x,te[1]=i.y,2;return 0}function zy(e,t){let s=e.bbox().intersection1(t.bbox());if(s!=null){s=s.extendOfSize(lp);let r=e.center.x,i=e.center.y,n=e.rx,a=e.rx2,o=t.start().x,c=t.start().y,l=t.end().x,u=t.end().y,h=e.center.distance1(t.start()),p=e.center.distance1(t.end()),d=_e.eq(h,n)?0:h>n?1:-1,f=_e.eq(p,n)?0:p>n?1:-1,m=0;if(d===-1&&f===-1)return 0;if(d===0&&f===0)te[m++]=o,te[m++]=c,te[m++]=l,te[m++]=u;else if(d===1&&f===1){let g=zn.foot(t,e.center),b=g.distance1(e.center);if(_e.greater(b,n))return 0;if(_e.eq(b,n))_e.eq(t.distance2(e.start()),0)?(te[m++]=e.start().x,te[m++]=e.start().y,te[m++]=e.start().x,te[m++]=e.start().y):_e.eq(t.distance2(e.end()),0)?(te[m++]=e.end().x,te[m++]=e.end().y,te[m++]=e.end().x,te[m++]=e.end().y):(te[m++]=g.x,te[m++]=g.y,te[m++]=g.x,te[m++]=g.y);else{m=RO(r,i,o,c,l,u,m,g);let E=te[m-2],y=te[m-1];m-=2;let T=Ys.distance1(r,i,E,y);if(_e.eq(T,n))te[m++]=E,te[m++]=y,te[m++]=E,te[m++]=y;else if(T<n)m=Fr(a,r,i,o,c,E,y,m),m=Fr(a,r,i,E,y,l,u,m);else return 0}}else if(d===-1||f===-1)m=Fr(a,r,i,o,c,l,u,m);else{let g=zn.foot(t,e.center),b=g.distance1(e.center);if(_e.eq(b,n)){let E=function(w){return JP(s,w.x,w.y)&&Zs(e,w)},y=e.start(),T=e.end();if(d===0){let w=t.start();if(E(w))return te[m++]=w.x,te[m++]=w.y,te[m++]=w.x,te[m++]=w.y,m;if(E(g))return te[m++]=g.x,te[m++]=g.y,te[m++]=g.x,te[m++]=g.y,m;if(_e.eq(t.distance2(y),0)&&E(y))return te[m++]=y.x,te[m++]=y.y,te[m++]=y.x,te[m++]=y.y,m;if(_e.eq(t.distance2(T),0)&&E(T))return te[m++]=T.x,te[m++]=T.y,te[m++]=T.x,te[m++]=T.y,m;if(h<=n)m=Fr(a,r,i,g.x,g.y,l,u,m),m===2&&(te[m++]=te[0],te[m++]=te[1]);else if(b<n){if(m=Fr(a,r,i,g.x,g.y,l,u,m),m===2&&E(new de(te[0],te[1])))return te[m++]=te[0],te[m++]=te[1],m;m=Fr(a,r,i,g.x,g.y,o,c,0),m===2&&(te[m++]=te[0],te[m++]=te[1])}}else{let w=t.end();if(E(w))return te[m++]=w.x,te[m++]=w.y,te[m++]=w.x,te[m++]=w.y,m;if(E(g))return te[m++]=g.x,te[m++]=g.y,te[m++]=g.x,te[m++]=g.y,m;if(_e.eq(t.distance2(y),0)&&E(y))return te[m++]=y.x,te[m++]=y.y,te[m++]=y.x,te[m++]=y.y,m;if(_e.eq(t.distance2(T),0)&&E(T))return te[m++]=T.x,te[m++]=T.y,te[m++]=T.x,te[m++]=T.y,m;if(p<=n)m=Fr(a,r,i,g.x,g.y,o,c,m),m===2&&(te[m++]=te[0],te[m++]=te[1]);else if(b<n){if(m=Fr(a,r,i,g.x,g.y,o,c,m),m===2&&E(new de(te[0],te[1])))return te[m++]=te[0],te[m++]=te[1],m;m=Fr(a,r,i,g.x,g.y,l,u,0),m===2&&(te[m++]=te[0],te[m++]=te[1])}}}else if(d===0){let E=t.start();te[m++]=E.x,te[m++]=E.y,(o-g.x)*(l-g.x)+(c-g.y)*(u-g.y)<0&&(m=Fr(a,r,i,g.x,g.y,l,u,m))}else{let E=t.end();te[m++]=E.x,te[m++]=E.y,(o-g.x)*(l-g.x)+(c-g.y)*(u-g.y)<0&&(m=Fr(a,r,i,g.x,g.y,o,c,m))}}if(m>0){let g=0;for(let b=0;b<m;b+=2){let E=te[b],y=te[b+1];isFinite(E)&&isFinite(y)&&JP(s,E,y)&&Zs(e,new de(E,y))&&(te[g++]=E,te[g++]=y)}return g}else return 0}else return 0}function D9(e,t){if(e.bbox()){let s=e.center.x,r=e.center.y,i=e.rx2,n=t.start().x,a=t.start().y,o=t.end().x,c=t.end().y,l=e.center.distance2(t.start()),u=e.center.distance2(t.end()),h=_e.eq(l,i)?0:l>i?1:-1,p=_e.eq(u,i)?0:u>i?1:-1,d=0;if(h===-1&&p===-1)return 0;if(h===0&&p===0)te[d++]=n,te[d++]=a,te[d++]=o,te[d++]=c;else if(h===1&&p===1){let f=zn.foot(t,e.center),m=f.distance2(e.center);if(_e.greater(m,i))return 0;if(_e.eq(m,i)){let g=f.distance2(e.start()),b=f.distance2(e.end());_e.eq(g,0)?(te[d++]=e.start().x,te[d++]=e.start().y):_e.eq(b,0)?(te[d++]=e.end().x,te[d++]=e.end().y):(te[d++]=f.x,te[d++]=f.y)}else{d=RO(s,r,n,a,o,c,d,f);let g=te[d-2],b=te[d-1],E=Ys.distance2(s,r,g,b);if(d-=2,_e.eq(E,i))te[d++]=g,te[d++]=b;else if(E<i)d=Fr(i,s,r,n,a,g,b,d),d=Fr(i,s,r,g,b,o,c,d);else return 0}}else if(h===-1||p===-1)d=Fr(i,s,r,n,a,o,c,d);else{let f=zn.foot(t,e.center);h===0?(te[d++]=t.start().x,te[d++]=t.start().y,_e.neq(f.distance2(t.start()),0)&&(n-f.x)*(o-f.x)+(a-f.y)*(c-f.y)<0&&(d=Fr(i,s,r,f.x,f.y,o,c,d))):(te[d++]=t.end().x,te[d++]=t.end().y,_e.neq(f.distance2(t.end()),0)&&(n-f.x)*(o-f.x)+(a-f.y)*(c-f.y)<0&&(d=Fr(i,s,r,f.x,f.y,n,a,d)))}if(d>0){let f=0;for(let m=0;m<d;m+=2){let g=te[m],b=te[m+1];isFinite(g)&&isFinite(b)&&(te[f++]=g,te[f++]=b)}return f}else return 0}else return 0}function Fr(e,t,s,r,i,n,a,o){if(i==a){let y=e-(i-s)*(i-s);if(_e.greater(y,0)){let T=Math.sqrt(y),w=t-T,S=t+T,_=Math.min(r,n),C=Math.max(r,n);return w>=_&&w<=C&&(te[o++]=w,te[o++]=i),S>=_&&S<=C&&(te[o++]=S,te[o++]=i),o}}let c=Ys.distance2(r,i,t,s)-e;if(c===0)return te[o++]=r,te[o++]=i,o;let l=Ys.distance2(n,a,t,s)-e;if(l===0)return te[o++]=n,te[o++]=a,o;let u=r,h=i,p=n,d=a,f=NaN,m=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let y=Math.max(Math.min(Math.abs(c)/(Math.abs(c)+Math.abs(l)),.75),.25);if(f=u+(p-u)*y,m=h+(d-h)*y,u===f&&h===m||p===f&&d===m){Math.abs(c)>Math.abs(l)?(f=p,m=d,g=l):(f=u,m=h,g=c);break}else g=Ys.distance2(f,m,t,s)-e,g<0&&c>l||g>0&&c<l?(p=f,d=m,l=g):(u=f,h=m,c=g)}let E=Math.sqrt(e)-Ys.distance1(f,m,t,s);return(_e.eq(0,g)||_e.eq(0,E))&&(te[o++]=f,te[o++]=m),o}function RO(e,t,s,r,i,n,a,o){let c=Ys.dotProd2(s,r,i,n,e,t),l=Ys.dotProd2(i,n,s,r,e,t);if(c>=0)return te[a++]=i,te[a++]=n,a;if(l>=0)return te[a++]=s,te[a++]=r,a;if(Ys.crossProd2(s,r,i,n,e,t)==0)return te[a++]=e,te[a++]=t,a;{let u=NaN,h=NaN,p=s,d=r,f=i,m=n,g=Ys.distance2(s,r,e,t),b=Ys.distance2(i,n,e,t),E=Number.POSITIVE_INFINITY,y=0;for(;E>0&&(y++,u=p+(f-p)*.5,h=d+(m-d)*.5,!(g==b||p==u&&d==h||f==u&&m==h));){E=Ys.distance2(u,h,e,t);let T=Ys.dotProd2(p,d,u,h,e,t);if(T==0)break;T<0?(f=u,m=h,b=E):(p=u,d=h,g=E)}return Ys.distance2(u,h,e,t)<Ys.distance2(o.x,o.y,e,t)?(te[a++]=u,te[a++]=h):(te[a++]=o.x,te[a++]=o.y),a}}function _T(e,t){if(e.rx===e.ry)return zy(e,t);throw new Error("not supported")}function P9(e,t){if(e.rx===e.ry)return D9(e,t);throw new Error("not supported")}function NO(e,t){if(e.bbox().intersection1(t.bbox())!=null){if(e.rx===e.ry&&t.rx===t.ry)return O9(e,t);throw new Error("not supported operation")}return 0}function O9(e,t){let s=e.center.x,r=e.center.y,i=t.center.x,n=t.center.y,a=e.rx,o=t.rx,c=e.rx2,l=t.rx2,u=e.center.distance1(t.center),h=Math.abs(a-o),p=a+o;if(_e.greater(u,p)||_e.less(u,h))return 0;if(_e.eq(h+u,0)){let d=0,f;return Zs(e,t.start())&&(te[d]=t.start().x,te[d+1]=t.start().y,d+=2,f=t.start()),Zs(e,t.end())&&(te[d]=t.end().x,te[d+1]=t.end().y,d+=2,f=t.end()),d===0?(Zs(t,e.start())&&(te[d]=e.start().x,te[d+1]=e.start().y,d+=2),Zs(t,e.end())&&(te[d]=e.end().x,te[d+1]=e.end().y,d+=2)):d===2&&(!f.equals1(e.start())&&Zs(t,e.start())&&(te[d]=e.start().x,te[d+1]=e.start().y,d+=2),!f.equals1(e.end())&&Zs(t,e.end())&&(te[d]=e.end().x,te[d+1]=e.end().y,d+=2)),d}else if(_e.eq(u,p)){if(XP(e,t))return 4;let d=new le(e.center,t.center),f=zy(t,d);return f=ZP(e,f),f!==0?f:(f=zy(e,d),ZP(t,f))}else if(_e.eq(u,h)){if(XP(e,t))return 4;if(a>o){let d=(a-o)/a;return te[0]=s+(i-s)/d,te[1]=r+(n-r)/d,$P(e,t,2)}else{let d=(o-a)/o;return te[0]=i+(s-i)/d,te[1]=n+(r-n)/d,$P(e,t,2)}}else{let d=(e.center.distance2(t.center)-l+c)/(u*2)/u,f=(i-s)*d+s,m=(n-r)*d+r,g=i-s,b=n-r,E=Math.max(a,o),y,T,w,S;if(Math.abs(g)<Math.abs(b)){let D=g/-b,I=m-D*f;y=f-E,T=D*y+I,w=f+E,S=D*w+I}else{let D=b/-g,I=f-D*m;T=m-E,y=D*T+I,S=m+E,w=D*S+I}let _=Fr(c,s,r,y,T,f,m,0);if(_=Fr(c,s,r,f,m,w,S,_),_!==4)throw new Error("cnt !== 4");let C=new de(te[0],te[1]),x=new de(te[2],te[3]);if(Zs(e,C)&&Zs(t,C))return Zs(e,x)&&Zs(t,x)?4:sc(e.start(),t,x,C)?(te[2]=e.start().x,te[3]=e.start().y,4):sc(e.end(),t,x,C)?(te[2]=e.end().x,te[3]=e.end().y,4):sc(t.start(),e,x,C)?(te[2]=t.start().x,te[3]=t.start().y,4):sc(t.end(),e,x,C)?(te[2]=t.end().x,te[3]=t.end().y,4):2;if(Zs(e,x)&&Zs(t,x))return sc(e.start(),t,C,x)?(te[0]=e.start().x,te[1]=e.start().y,4):sc(e.end(),t,C,x)?(te[0]=e.end().x,te[1]=e.end().y,4):sc(t.start(),e,C,x)?(te[0]=t.start().x,te[1]=t.start().y,4):sc(t.end(),e,C,x)?(te[0]=t.end().x,te[1]=t.end().y,4):(te[0]=te[2],te[1]=te[3],2);{let D=function(F,V){if(_e.eq(F.distance1(V.center),V.rx)&&Zs(V,F)){if(F.distance2(C)<F.distance2(x)){if(I)return;I=!0}else{if(P)return;P=!0}te[L++]=F.x,te[L++]=F.y}},I=!1,P=!1,L=0;return D(e.start(),t),D(e.end(),t),D(t.start(),e),D(t.end(),e),L}}}function sc(e,t,s,r){return _e.eq(e.distance1(t.center),t.rx)&&Zs(t,e)&&e.distance2(s)<e.distance2(r)}function XP(e,t){return _e.eq(t.start().distance1(e.center),e.rx)&&Zs(e,t.start())?(te[0]=t.start().x,te[1]=t.start().y,te[2]=t.start().x,te[3]=t.start().y,!0):_e.eq(t.end().distance1(e.center),e.rx)&&Zs(e,t.end())?(te[0]=t.end().x,te[1]=t.end().y,te[2]=t.end().x,te[3]=t.end().y,!0):_e.eq(e.start().distance1(t.center),t.rx)&&Zs(t,e.start())?(te[0]=e.start().x,te[1]=e.start().y,te[2]=e.start().x,te[3]=e.start().y,!0):_e.eq(e.end().distance1(t.center),t.rx)&&Zs(t,e.end())?(te[0]=e.end().x,te[1]=e.end().y,te[2]=e.end().x,te[3]=e.end().y,!0):!1}function ZP(e,t){if(t===0)return 0;let s=te[0],r=te[1];return Zs(e,new de(s,r))?(te[0]=s,te[1]=r,te[2]=s,te[3]=r,4):0}function $P(e,t,s){if(s===0)return 0;let r=te[0],i=te[1],n=new de(r,i);return Zs(e,n)&&Zs(t,n)?(te[0]=r,te[1]=i,te[2]=r,te[3]=i,4):0}function Vu(e,t){return Math.abs(e-t)<=1e-6}function Zs(e,t){let s=e.bbox();if(t.x-s.minX>-lp&&t.x-s.maxX<lp&&t.y-s.minY>-lp&&t.y-s.maxY<lp){let r=lt.regularD(t.angleD(e.center));return Vu(r,e.startAngle)||Vu(r,e.startAngle+360)||Vu(r,e.startAngle-360)||Vu(r,e.endAngle())||Vu(r,e.endAngle()+360)||Vu(r,e.endAngle()-360)?!0:e.sweepAngle>0?(_e.less(r,e.startAngle)&&(r+=360),_e.greatereq(e.endAngle(),r)):(_e.greater(r,e.startAngle)&&(r-=360),_e.lesseq(e.endAngle(),r))}else return!1}function I9(e,t){let s=e[1].x-e[0].x,r=e[1].y-e[0].y,i=t[1].x-t[0].x,n=t[1].y-t[0].y;if(s===0&&i!==0||s!==0&&i===0)return!1;if(s===0&&i===0)return!0;let a=r/s,o=n/i;return vO(a,o,Math.sin(Math.PI/180))}function x9(e,t,s){var r,i=+t.x,n=+t.y,a=+s.x,o=+s.y,c=+e.x,l=+e.y,u=a-i,h=o-n,p=c-i,d=l-n,f,m,g,b,E,y;return u===0&&h===0?{d:Math.sqrt(p*p+d*d),point:new de(i,n)}:(r=(p*u+d*h)/(u*u+h*h),r<0?{d:Math.sqrt(p*p+d*d),point:new de(i,n)}:r>1?(f=c-a,m=l-o,{d:Math.sqrt(f*f+m*m),point:new de(a,o)}):(E=i+r*u,y=n+r*h,g=c-E,b=l-y,{d:Math.sqrt(g*g+b*b),point:new de(E,y)}))}function Yn(e,t){if(!e||!t||e.length!=t.length)return!1;let s="equals1";return!e.some((r,i)=>{let n=t[i],a=!1;return r&&n&&typeof r=="object"&&typeof n=="object"?typeof r[s]=="function"&&R9(r,n)?a=!r[s].call(r,n):a=!(r===n||r.toString()===n.toString()):typeof r=="number"&&typeof n=="number"?a=!(v9(r,n)||Number.isNaN(r)&&Number.isNaN(n)):a=r!==n,a})}function v9(e,t,s=5){return Math.abs(e-t)*Math.pow(10,s)<1}function R9(e,t){return!e||!t||typeof e!="object"||typeof t!="object"?e===t:e.constructor===t.constructor}var pt=new Float64Array(100);function ky(e,t){if(e.bbox().extendOfSize(_e.eps).isSeparated(t.bbox()))return 0;let s=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,i=0,n=Number.POSITIVE_INFINITY;for(;s.length!==0;){let a=function(B){I=Math.min(I,B),P=Math.max(P,B)},o=function(B,k){let O=Da(B,k);if(O===0)throw new Error("cnt === 0");for(let R=0;R<O;R+=2)a(te[R])};if(i>r){for(let B=i-2;B>=2;B-=2)for(let k=B-2;k>=0;k-=2)if(_e.eq(pt[B],pt[k])&&_e.eq(pt[B+1],pt[k+1])){pt[k]=(pt[B]+pt[k])/2,pt[k+1]=(pt[B+1]+pt[k+1])/2;for(let O=i-3;O>=B;O--)pt[O]=pt[O+2];i-=2;break}if(i>r){i=0;let B=t.start(),k=new Float64Array(8);e.getPercent(B)!==null&&(k[i++]=B.x,k[i++]=B.y);let O=t.end();e.getPercent(O)!==null&&(k[i++]=O.x,k[i++]=O.y);let R=e.start();t.getPercent(R)!==null&&(k[i++]=R.x,k[i++]=R.y);let v=e.end();return t.getPercent(v)!==null&&(k[i++]=v.x,k[i++]=v.y),te.set(k),i}}let[c,l]=s.pop(),u=c.controls,h=l.controls;if(u.length===2&&h.length===2){let B=Da(new le(u[0],u[1]),new le(h[0],h[1]));for(let k=0;k<B;k++)pt[i++]=te[k];continue}let p=u[0],d=u[u.length-1];p.equals1(d)&&(d=p.add1(1,0));let f=d.y-p.y,m=p.x-d.x,g=-f*p.x-m*p.y,b=Math.sqrt(1/(f**2+m**2));f*=b,m*=b,g*=b;let E=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY;if(u.forEach(B=>{let k=f*B.x+m*B.y+g;k<E&&(E=k),k>y&&(y=k)}),_e.eq(E,y)){if(l.controls.length===2){let B=Da(new le(c.start(),c.end()),new le(l.start(),l.end()));for(let k=0;k<B;k++)pt[i++]=te[k];if(B!==0)continue}c=new qe([u[0],u[u.length-1]]),u=c.controls}let T=h.map(B=>{let k=f*B.x+m*B.y+g,O=Math.abs(k);return O<n&&(n=O),k}),w=0;for(let B of T){if(_e.less(B,E))w=w|1;else if(_e.greater(B,y))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let S=0,_=0,C=d.x-p.x,x=d.y-p.y,D=Math.sqrt(1/(C**2+x**2));C*=D,x*=D;for(let B=1;B<u.length;B++){let k=u[B],O=(k.x-p.x)*C+(k.y-p.y)*x;O<S?S=O:O>_&&(_=O)}w=0;for(let B of h){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(_e.less(k,S))w=w|1;else if(_e.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let I=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY;n/=2,n<=_e.eps&&(n=_e.eps),E-=n,y+=n,T.forEach((B,k)=>{B>=E&&B<=y&&a(k/(T.length-1))});let L=new le(new de(0,E),new de(1,E)),F=new le(new de(0,y),new de(1,y));for(let B=0;B<T.length-1;B++){let k=new de(B/(T.length-1),T[B]),O=k.y<E?1:k.y>y?2:3;for(let R=0;R<T.length;R++){let v=new de(R/(T.length-1),T[R]),j=v.y<E?1:v.y>y?2:3;O!==j&&(O===1?j===2?(o(new le(k,v),L),o(new le(k,v),F)):o(new le(k,v),L):O===2?j===1?(o(new le(k,v),L),o(new le(k,v),F)):o(new le(k,v),F):j===1?o(new le(k,v),L):o(new le(k,v),F))}}I!==0&&(l=l.clip(I)[1]),P!==1&&(l=l.clip((P-I)/(1-I))[0]);let V=l.bbox();if(_e.eq(V.minX,V.maxX)&&_e.eq(V.minY,V.maxY)){w=0;for(let B of l.controls){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(_e.less(k,S))w=w|1;else if(_e.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w===3){let B=new de((V.minX+V.maxX)/2,(V.minY+V.maxY)/2);c.getPercent(B)&&(pt[i++]=B.x,pt[i++]=B.y)}continue}if(P-I>.8){let[B,k]=l.clip(.5);s.push([B,c]),s.push([k,c])}else s.push([l,c])}for(let a=0;a<i;a++)te[a]=pt[a];return i}function N9(e,t){if(e.bbox().extendOfSize(_e.eps).isSeparated(t.bbox()))return{cnt:0};let s=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,i=0,n=Number.POSITIVE_INFINITY;for(;s.length!==0;){let a=function(B){I=Math.min(I,B),P=Math.max(P,B)},o=function(B,k){let O=Da(B,k);if(O===0)throw new Error("cnt === 0");for(let R=0;R<O;R+=2)a(te[R])};if(i>r){for(let B=i-2;B>=2;B-=2)for(let k=B-2;k>=0;k-=2)if(_e.eq(pt[B],pt[k])&&_e.eq(pt[B+1],pt[k+1])){pt[k]=(pt[B]+pt[k])/2,pt[k+1]=(pt[B+1]+pt[k+1])/2;for(let O=i-3;O>=B;O--)pt[O]=pt[O+2];i-=2;break}if(i>r){i=0;let B=new Float64Array(8),k=t.end(),O=0;e.getPercent(k)!==null&&(B[i++]=k.x,B[i++]=k.y,O=2);let R=e.end();return t.getPercent(R)!==null&&(B[i++]=R.x,B[i++]=R.y,O=O===0?1:3),te.set(B),{havOverlap:O,cnt:i}}}let[c,l]=s.pop(),u=c.controls,h=l.controls;if(u.length===2&&h.length===2){let B=Da(new le(u[0],u[1]),new le(h[0],h[1]));for(let k=0;k<B;k++)pt[i++]=te[k];continue}let p=u[0],d=u[u.length-1];p.equals1(d)&&(d=p.add1(1,0));let f=d.y-p.y,m=p.x-d.x,g=-f*p.x-m*p.y,b=Math.sqrt(1/(f**2+m**2));f*=b,m*=b,g*=b;let E=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY;if(u.forEach(B=>{let k=f*B.x+m*B.y+g;k<E&&(E=k),k>y&&(y=k)}),_e.eq(E,y)){if(l.controls.length===2){let B=Da(new le(c.start(),c.end()),new le(l.start(),l.end()));for(let k=0;k<B;k++)pt[i++]=te[k];if(B!==0)continue}c=new qe([u[0],u[u.length-1]]),u=c.controls}let T=h.map(B=>{let k=f*B.x+m*B.y+g,O=Math.abs(k);return O<n&&(n=O),k}),w=0;for(let B of T){if(_e.less(B,E))w=w|1;else if(_e.greater(B,y))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let S=0,_=0,C=d.x-p.x,x=d.y-p.y,D=Math.sqrt(1/(C**2+x**2));C*=D,x*=D;for(let B=1;B<u.length;B++){let k=u[B],O=(k.x-p.x)*C+(k.y-p.y)*x;O<S?S=O:O>_&&(_=O)}w=0;for(let B of h){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(_e.less(k,S))w=w|1;else if(_e.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w!==3)continue;let I=Number.POSITIVE_INFINITY,P=Number.NEGATIVE_INFINITY;n/=2,n<=_e.eps&&(n=_e.eps),E-=n,y+=n,T.forEach((B,k)=>{B>=E&&B<=y&&a(k/(T.length-1))});let L=new le(new de(0,E),new de(1,E)),F=new le(new de(0,y),new de(1,y));for(let B=0;B<T.length-1;B++){let k=new de(B/(T.length-1),T[B]),O=k.y<E?1:k.y>y?2:3;for(let R=0;R<T.length;R++){let v=new de(R/(T.length-1),T[R]),j=v.y<E?1:v.y>y?2:3;O!==j&&(O===1?j===2?(o(new le(k,v),L),o(new le(k,v),F)):o(new le(k,v),L):O===2?j===1?(o(new le(k,v),L),o(new le(k,v),F)):o(new le(k,v),F):j===1?o(new le(k,v),L):o(new le(k,v),F))}}I!==0&&(l=l.clip(I)[1]),P!==1&&(l=l.clip((P-I)/(1-I))[0]);let V=l.bbox();if(_e.eq(V.minX,V.maxX)&&_e.eq(V.minY,V.maxY)){w=0;for(let B of l.controls){let k=(B.x-p.x)*C+(B.y-p.y)*x;if(_e.less(k,S))w=w|1;else if(_e.greater(k,_))w=w|2;else{w=3;break}if(w===3)break}if(w===3){let B=new de((V.minX+V.maxX)/2,(V.minY+V.maxY)/2);c.getPercent(B)&&(pt[i++]=B.x,pt[i++]=B.y)}continue}if(P-I>.8){let[B,k]=l.clip(.5);s.push([B,c]),s.push([k,c])}else s.push([l,c])}for(let a=0;a<i;a++)te[a]=pt[a];return{cnt:i}}var L9=class{constructor(e=_e.eps){this.eps=e}eq(e,t){return Math.abs(e-t)<=this.eps}setEps(e){this.eps=e}},ip=new L9;function QP(e,t){if(e.bbox().extendOfSize(_e.eps).isSeparated(t.bbox()))return 0;let s=[[e,t]],r=(t.controls.length-1)*16,i=0;for(;s.length!==0;){if(i>r){let a=function(){for(let l=0;l<i;l+=2)for(let u=l+2;u<i;u+=2)if(!(ip.eq(pt[l],pt[u])&&ip.eq(pt[l+1],pt[u+1]))){c(pt[u],pt[u+1],o);break}function c(l,u,h){let p=!1;for(let d=0;d<h.length;d+=2)if(ip.eq(l,h[d])&&ip.eq(u,h[d+1])){p=!0;break}p||h.push(l,u)}},o=[pt[0],pt[1]];if(a(),o.length>=100&&(ip.setEps(.001),o=[pt[0],pt[1]],a(),o.length>=100))throw new Error("clearSamePoint()");i=o.length,o.forEach((c,l)=>pt[l]=c)}let n=s.pop();if(n[0]instanceof we){let a=function(F){x=Math.min(x,F),D=Math.max(D,F)},o=function(F,V){let B=Da(F,V);if(B===0)throw new Error("cnt === 0");for(let k=0;k<B;k+=2)a(te[k])},[c,l]=n,u=l.controls;if(u.length===2){let F=_T(c,new le(u[0],u[1]));for(let V=0;V<F;V++)pt[i++]=te[V];continue}let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,d,f,m,g,b;if(Math.abs(c.sweepAngle)>359){let F=c.rx;d=c.center.add1(F,0),f=c.center.add1(-F,0),h=-F,p=F,m=0,g=1,b=-c.center.y}else{d=c.start(),f=c.end(),m=f.y-d.y,g=d.x-f.x,b=-m*d.x-g*d.y;let F=Math.sqrt(1/(m**2+g**2));m*=F,g*=F,b*=F;let V=m*c.center.x+g*c.center.y+b;c.isCCW?(p=c.rx+V,h=0):(h=V-c.rx,p=0)}let E=u.map(F=>m*F.x+g*F.y+b),y=0;for(let F of E){if(_e.less(F,h))y=y|1;else if(_e.greater(F,p))y=y|2;else{y=3;break}if(y===3)break}if(y!==3)continue;let T=0,w=0,S=f.x-d.x,_=f.y-d.y,C=Math.sqrt(1/(S**2+_**2));if(S*=C,_*=C,Math.abs(c.sweepAngle)<=180)T=0,w=(f.x-d.x)*S+(f.y-d.y)*_;else throw new Error("not support");y=0;for(let F of u){let V=(F.x-d.x)*S+(F.y-d.y)*_;if(_e.less(V,T))y=y|1;else if(_e.greater(V,w))y=y|2;else{y=3;break}if(y===3)break}if(y!==3)continue;let x=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY;h-=_e.eps,p+=_e.eps,E.forEach((F,V)=>{F>=h&&F<=p&&a(V/(E.length-1))});let I=new le(new de(0,h),new de(1,h)),P=new le(new de(0,p),new de(1,p));for(let F=0;F<E.length-1;F++){let V=new de(F/(E.length-1),E[F]),B=V.y<h?1:V.y>p?2:3;for(let k=0;k<E.length;k++){let O=new de(k/(E.length-1),E[k]),R=O.y<h?1:O.y>p?2:3;B!==R&&(B===1?R===2?(o(new le(V,O),I),o(new le(V,O),P)):o(new le(V,O),I):B===2?R===1?(o(new le(V,O),I),o(new le(V,O),P)):o(new le(V,O),P):R===1?o(new le(V,O),I):o(new le(V,O),P))}}x!==0&&(l=l.clip(x)[1]),D!==1&&(l=l.clip((D-x)/(1-x))[0]);let L=l.bbox();if(_e.eq(L.minX,L.maxX)&&_e.eq(L.minY,L.maxY)){y=0;for(let F of l.controls){let V=(F.x-d.x)*S+(F.y-d.y)*_;if(_e.less(V,T))y=y|1;else if(_e.greater(V,w))y=y|2;else{y=3;break}if(y===3)break}y===3&&(pt[i++]=(L.minX+L.maxX)/2,pt[i++]=(L.minY+L.maxY)/2);continue}D-x>.8?l.clip(.5).forEach(F=>s.push([F,c])):s.push([l,c])}else{let[a,o]=n;s.push([we.build3(o.center,o.startAngle,o.sweepAngle/2,o.rx,o.ry),a]),s.push([we.build3(o.center,o.startAngle+o.sweepAngle/2,o.sweepAngle/2,o.rx,o.ry),a])}}for(let n=0;n<i;n++)te[n]=pt[n];return i}var B9=class{static getSweep(e){if(e.length>2){let t=0,s=e.length;for(let n=0;n<s-1;n++){let a=e[n],o=e[n+1];t+=(o.x+a.x)*(o.y-a.y)}let r=e[0],i=e[s-1];return t+=(r.x+i.x)*(r.y-i.y),t>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(e){return!!(e.primitives.length>0&&e.primitives[0].start().equals1(e.primitives[e.primitives.length-1].end()))}};function k9(e){let t=e.primitives,s=t[0],r=s instanceof we?s.sweepAngle%360:null;if(t.length===1&&s instanceof we&&(_e.eq(r,0)||_e.eq(Math.abs(r),360)))return!!s.isCCW;let i=new Array;return e.points(.1,n=>{i.push(n)}),B9.getSweep(i)}var M9=class{static zoomCorner(e,t){let s=new Array,r=new Array,i=new Array;return this.getPanPrimitive(e,s,i,t),this.rearrange(s,i),this.processStart(s,i),this.getResult(s,i,r,t),r.length>0?Tt.build2(r):null}static zoomPolygon(e,t){let s=new Array,r=new Array,i=new Array;return k9(e)&&(e=e.reverse().asClose()),this.getPanPrimitive(e,s,i,t),this.rearrange(s,i),this.processStart(s,i),this.getResult(s,i,r,t),r.length>0?Tt.build2(r):null}static zoomLines(e,t){return this.zoomPolygon(Tt.build2(e.primitives.concat(e.reverse().primitives)),t/2)}static getPanPrimitive(e,t,s,r){let i=e.primitives;for(let n of i){let a=this.panDistance(n,r);a!==void 0&&(t.push(a),s.push(n))}}static rearrange(e,t){let s=e.length,r=0;for(let a=0;a<s;a++){let o=t[a],c=e[a],l=a==s-1?e[0]:e[a+1];if(!(c instanceof we&&l instanceof we)&&!this.isCW(c.end(),l.start(),o.end())){if(bn(c,l)!=0){r=a==s-1?0:a+1;break}}else{r=a;break}}let i=this.start4Index(t,r),n=this.start4Index(e,r);t.length=0,e.length=0,i.forEach(a=>{t.push(a)}),n.forEach(a=>{e.push(a)})}static processStart(e,t){let s=e.length;if(s>2){let r=e[s-1],i=e[0],n=t[s-1];if(!(r instanceof we&&i instanceof we)&&!this.isCW(r.end(),i.start(),n.end())){let a=bn(r,i);for(let o=0;o<a;o+=2){let c=new de(te[o],te[o+1]);e[s-1]=this.generatePrimitive(r,r.start(),c),e[0]=this.generatePrimitive(i,c,i.end())}}}}static getResult(e,t,s,r){let i=e.length;for(let n=0;n<i;n++){let a=t[n],o=n===i-1?t[0]:t[n+1],c=n==i-1?0:n+1,l=c==i-1?t[0]:t[c+1],u=e[n],h=n==i-1?e[0]:e[n+1],p=c==i-1?e[0]:e[c+1];if(!(u instanceof we&&h instanceof we)&&!this.isCW(u.end(),h.start(),a.end())){let f=this.add(e,s,n,u,h,0);f=this.update(e,s,n,h,f);let m=this.generateArc(o,l,h,p,r);if(f=this.add(e,s,n,u,m,f),f=this.update(e,s,n,m,f),f>0)continue}s.push(u);let d=this.generateArc(a,o,u,h,r);d!==void 0&&s.push(d)}}static generateArc(e,t,s,r,i){if(i>0){let n=e.end(),a=t.start(),o=s.end(),c=r.start();if(o.distance2(c)>1e-8)if(n.equals(a)){let l=o.angleD(n),u=c.angleD(n);return we.build2(n,l,u,i,i,0)}else{let l=o.angleD(n),u=c.angleD(n),h=o.angleD(a),p=c.angleD(a),d=we.build2(n,l,u,i,i,0),f=we.build2(a,h,p,i,i,0);return d.pointOn(d.endAngle()).equals1(c)?d:f.pointOn(f.endAngle()).equals1(c)?f:d}}}static updateNews(e,t,s,r){let i=e.length,n=t==i-1?0:t+1;e[n]=this.generatePrimitive(s,r,s.end())}static add(e,t,s,r,i,n){if(n>0)return n;if(r!=null&&i!=null){let a=bn(r,i);for(let o=0;o<a;o+=2){let c=new de(te[o],te[o+1]);t.push(this.generatePrimitive(r,r.start(),c)),this.updateNews(e,s,i,c);break}return a}else return 0}static update(e,t,s,r,i){if(i>0)return i;let n=t.length;if(n>0&&r!=null){let a=t[n-1],o=bn(a,r);for(let c=0;c<o;c+=2){let l=new de(te[c],te[c+1]);t[n-1]=this.generatePrimitive(a,a.start(),l),this.updateNews(e,s,r,l)}return o}else return 0}static generatePrimitive(e,t,s){if(e instanceof le)return new le(t,s);if(e instanceof we){let r=e,i=t.angleD(r.center),n=s.angleD(r.center);return we.build2(r.center,i,n,r.rx,r.ry,r.sweep())}else throw new Error("not supported operation")}static start4Index(e,t){let s=e.length,r=new Array;for(let i=t;i<s;i++)r.push(e[i]);for(let i=0;i<t;i++)r.push(e[i]);return r}static isCW(e,t,s){let r=new le(s,e),i=new le(s,t),n=r.end().x-r.start().x,a=r.end().y-r.start().y,o=i.end().x-i.start().x,c=i.end().y-i.start().y;return!(n*c-a*o>0)}static panDistance(e,t){if(e instanceof le){if(e.isPoint())return;{let s=e.panDistance(t);return s.length()>1e-5?s:void 0}}else if(e instanceof we){let s=e;if(s.sweepAngle>0){if(s.rx-t<=0||s.ry-t<=0)return}else if(s.sweepAngle<0&&(s.rx+t<=0||s.ry+t<=0))return;return s=s.panDistance(t),s.start().distance1(s.end())>1e-5||_e.eq(Math.abs(s.sweepAngle),360)?s:void 0}else throw new Error("not supported operation")}},rt=.001,ri=rt**2;function $e(e,t){return e.distance2(t)<ri}function Pa(e,t){return Math.abs(e-t)<=1e-4}function j9(e,t){if(e instanceof le)return new le(e.start(),t);if(e instanceof we){let s=t.angleD(e.center);return Pa(lt.regularD(e.startAngle),lt.regularD(s))?we.build3(e.center,e.startAngle,0,e.rx,e.ry):we.build2(e.center,e.startAngle,s,e.rx,e.ry,e.isCCW?1:0)}else{if(e instanceof qe)return e.clip(e.getPercent(t,rt))[0];throw new Error("not supported operation")}}function Wn(e,t=lt.toRadians(e.startAngle)){return e.isCCW?t+=Vy:t-=Vy,new de(Math.cos(t),Math.sin(t))}function Tp(e,t=0){let s=e.controls;if(t===0){let r=s[0],i=s.slice(1).find(n=>!(n.x===r.x&&n.y===r.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return i.sub(r)}else if(t===1){let r=s[s.length-1],i=s.slice(0,-1).reverse().find(n=>!(n.x===r.x&&n.y===r.y));if(!i)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return r.sub(i)}if(s.length===3){let[r,i,n]=s;return i.sub(r).mul(2*(1-t)).add(n.sub(i).mul(2*t)).normalize()}else{let[r,i,n,a]=s;return i.sub(r).mul(3*(1-t)**2).add(n.sub(i).mul(6*(1-t)*t)).add(a.sub(n).mul(3*t**2)).normalize()}}function sh(e,t,s){let r=e.slice(1).findIndex(n=>!(n.x===t.x&&n.y===t.y)),i=e[r+1];if(s&&(s.getPercent(i,rt)!==null||new le(s.start(),s.end()).distance(i)<=rt)&&(i=e[r+2]),!i)throw Error("getSecondPoint(controls: readonly Vector2[])");return i}function st(e,t){if(e instanceof le)return e.end().sub(e.start()).normalize();if(e instanceof we)return(t?Wn(e,t.angle(e.center)):Wn(e)).normalize();if(e instanceof qe)if(e.controls.length===2){let[s,r]=e.controls;if($e(s,r))throw Error("equalsPP(p0, p1)");return r.sub(s).normalize()}else return(t?Tp(e,e.getPercent(t,rt)):Tp(e)).normalize();else throw new Error("not support")}function F9(e,t,s){let r=[],i=t**2-4*e*s;if(i>=0){let n=-t/(2*e),a=Math.sqrt(i)/(2*e),o=n+a;if(r.push(o),i>0){let c=n-a;r.push(c)}}return r}function U9(e,t,s,r,i=0,n=1){let a=[],o=e*Math.pow(i,3)+t*Math.pow(i,2)+s*i+r,c=e*Math.pow(n,3)+t*Math.pow(n,2)+s*n+r,l,u;if(o*c<0)for(;Math.abs(i-n)>rt;)if(l=(i+n)/2,u=e*Math.pow(l,3)+t*Math.pow(l,2)+s*l+r,Math.abs(u)<rt){a.push(l);break}else o*u<0?n=l:c*u<0&&(i=l);else o*c===0&&(o===0&&a.push(i),c===0&&a.push(n));return a}function rT(e,t,s){if(e instanceof le||t.distance2(s)<=ri)return new le(t,s);if(e instanceof we)return we.build2(e.center,t.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof qe){let r=e.getPercent(t,rt),i=e.getPercent(s,rt);return e.clip(r)[1].clip((i-r)/(1-r))[0]}else throw new Error("not supported operation")}function AT(e){return _e.greater(e,0)&&_e.less(e,1)}function Wy(e,t,s,r){let i=e[r]-2*t[r]+s[r],n=t[r]-e[r];if(i===0)return[];let a=-n/i,o=[];return AT(a)&&o.push(a),o}function qy(e,t,s,r,i){let n,a,o=-e[i]+3*t[i]-3*s[i]+r[i],c=2*(e[i]-2*t[i]+s[i]),l=t[i]-e[i],u=c**2-4*o*l;if(_e.lesseq(u,0))n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;else{let p=Math.sqrt(u);n=(-c-p)/(2*o),a=(-c+p)/(2*o);let d=o*2;if(_e.lesseq(n,1)&&_e.greatereq(n,0)){let f=Number.NEGATIVE_INFINITY;for(;_e.neq(n,f);){f=n;let m=d*n+c;n=-(o*n**2+c*n+l-m*n)/m}}if(_e.lesseq(a,1)&&_e.greatereq(a,0)){let f=Number.NEGATIVE_INFINITY;for(;_e.neq(a,f);){f=a;let m=d*a+c;a=-(o*a**2+c*a+l-m*a)/m}}}let h=[];return AT(a)&&h.push(a),AT(n)&&h.push(n),h}function LO(e,t){if(e.controls.length===2){let[o,c]=e.controls;$e(o,c)||t.push(new le(o,c));return}let s,r;if(e.controls.length===3){let[o,c,l]=e.controls;s=Wy(o,c,l,"x"),r=Wy(o,c,l,"y")}else{let[o,c,l,u]=e.controls;s=qy(o,c,l,u,"x"),r=qy(o,c,l,u,"y")}s.sort((o,c)=>c-o),r.sort((o,c)=>c-o);let i=s.pop()||1,n=r.pop()||1,a=0;for(;i!==1||n!==1;)if(_e.eq(i,n))i=s.pop()||1,n=r.pop()||1;else if(i<n){let[o,c]=e.clip((i-a)/(1-a));a=i,t.push(o),e=c,i=s.pop()||1}else{let[o,c]=e.clip((n-a)/(1-a));a=n,t.push(o),e=c,n=r.pop()||1}t.push(e)}var H9=1e-5,jT=1,qe=class di extends Cp{constructor(t){if(super(),this._startToEndL=null,t.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=t.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new le(this.start(),this.end())),this._startToEndL}build1(t){let s=[];return ih(t,(r,i)=>(s.push(i),!0)),new di(s)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(t,s){if(s.length<1)throw new Error("bezier must have at least 1 point");if(s.length===1)return s[0];{let r=new Array(s.length-1);for(let i=1;i<s.length;i++){let n=s[i-1],a=s[i],o=(a.x-n.x)*t,c=(a.y-n.y)*t;r[i-1]=n.add1(o,c)}return di.pointOn(t,r)}}clip1(t,s,r,i){if(r.push(s[0]),i.push(s[s.length-1]),s.length<2)throw new Error("bezier clip must have at least 2 point");if(s.length===2){let n=s[0],a=s[1],o=(a.x-n.x)*t,c=(a.y-n.y)*t,l=n.add1(o,c);r.push(l),i.push(l)}else{let n=new Array(s.length-1);for(let a=1;a<s.length;a++){let o=s[a-1],c=s[a],l=(c.x-o.x)*t,u=(c.y-o.y)*t;n[a-1]=o.add1(l,u)}this.clip1(t,n,r,i)}}clip(t){let s=[],r=[];return this.clip1(t,this.controls,s,r),[new di(s),new di(r.reverse())]}greater(t,s,r){return t-s>r}less(t,s,r){return t-s<-r}eq(t,s,r){return Math.abs(t-s)<=r}eqPP(t,s,r){return!t||!s?!1:this.eq(t.x,s.x,r)&&this.eq(t.y,s.y,r)}isInRange(t,s=_e.eps){let r=this.controls.map(n=>n.y-t.y),i=0;for(let n of r){if(this.less(n,0,s))i=i|1;else if(this.greater(n,0,s))i=i|2;else{i=3;break}if(i===3)break}if(i!==3)return!1;i=0;for(let n of this.controls){let a=n.x-t.x;if(this.less(a,0,s))i=i|1;else if(this.greater(a,0,s))i=i|2;else{i=3;break}if(i===3)break}return i===3}getPercent(t,s=_e.eps){if(!this.isInRange(t,s))return null;let r=Number.POSITIVE_INFINITY,i=[[this,0,1]];for(;i.length!==0;){let n=function(g){u=Math.min(u,g),h=Math.max(h,g)},a=function(g,b){let E=Da(g,b);if(E===0)throw new Error("cnt === 0");for(let y=0;y<E;y+=2)n(te[y])},[o,c,l]=i.pop();if(this.eqPP(o.start(),t,s))return c;if(this.eqPP(o.end(),t,s))return l;let u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,p=o.controls.map(g=>g.y-t.y);r=p.reduce((g,b)=>{let E=Math.abs(b);return E<g?E:g},r),r/=2,r<=s&&(r=s),p.forEach((g,b)=>{this.eq(g,0,s)&&n(b/(p.length-1))});let d=new le(new de(0,-r),new de(1,-r)),f=new le(new de(0,r),new de(1,r));for(let g=0;g<p.length-1;g++){let b=new de(g/(p.length-1),p[g]),E=this.less(b.y,0,s)?1:this.greater(b.y,0,s)?2:3;for(let y=0;y<p.length;y++){let T=new de(y/(p.length-1),p[y]),w=this.less(T.y,0,s)?1:this.greater(T.y,0,s)?2:3;E!==w&&(E===1?w===2?(a(new le(b,T),d),a(new le(b,T),f)):a(new le(b,T),d):E===2?w===1?(a(new le(b,T),d),a(new le(b,T),f)):a(new le(b,T),f):w===1?a(new le(b,T),d):a(new le(b,T),f))}}if(!isFinite(u)){if(Math.max(...p.map(g=>Math.abs(g)))<s*4)return(c+l)/2;continue}if(u!==0&&(o=o.clip(u)[1],c=(l-c)*u+c),h!==1){let g=(h-u)/(1-u);o=o.clip(g)[0],l=(l-c)*g+c}if(!o.isInRange(t,s))continue;let m=o.controls.reduce((g,b)=>g.ext2(b),new Oi).build1();if(this.eq(m.minX,m.maxX,s)&&this.eq(m.minY,m.maxY,s))return(c+l)/2;if(h-u>.8){let[g,b]=o.clip(.5);g.isInRange(t,s)?(i.push([g,c,(c+l)/2]),b.isInRange(t,s)&&i.push([b,(c+l)/2,l])):i.push([b,(c+l)/2,l])}else i.push([o,c,l])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new Oi().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new Oi().ext3(this.controls).build()),this._bbox_controls}multiply3(t){let s=new Array(this.controls.length);for(let r=0;r<this.controls.length;r++){let i=this.controls[r];s[r]=i.multiply3(t)}return new di(s)}stroke(t,s,r,i=jT){let n=M9.zoomLines(Tt.build4(this.points(i)),t);return r===0?n:n.reverse()}points(t){let s=[];return this.getBezierPoints(t,r=>s.push(r)),s}getBezierPoints(t,s){if(this.controls.length===2){s(this.start()),s(this.end());return}let r=[this];for(s(this.start());r.length!==0;){let n=r.pop(),a=new le(n.start(),n.end());if(i(n.controls,a)<=t)s(n.end());else{let[o,c]=n.clip(.5);r.push(c,o)}}function i(n,a){let o=a.start(),c=a.end();o.equals1(c)&&(c=o.add1(1,0));let l=c.y-o.y,u=o.x-c.x,h=-l*o.x-u*o.y,p=Math.sqrt(1/(l**2+u**2));l*=p,u*=p,h*=p;let d=n.map(f=>Math.abs(l*f.x+u*f.y+h));return Math.max(...d)}}getBezierPoints3(t,s){if(this.controls.length===2){s(this.start()),s(this.end());return}let r=t*t,i=this.controls[0],n=.5;for(;n>H9&&!(i.distance2(di.pointOn(n,this.controls))<=r);n*=.5);let a=Math.ceil(1/n);n=1/a,s(i);let o=0;for(let c=1;c<a;c++)o+=n,s(di.pointOn(o,this.controls));s(this.end())}getPointsBySlope(t){if(this.controls.length===4)return this.getPointsBySlope4(t);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(t){let[s,r,i,n]=this.controls,a=-3*s.x+9*r.x-9*i.x+3*n.x,o=6*s.x-12*r.x+6*i.x,c=-3*s.x+3*r.x,l=[];if(Number.isFinite(t)){let u=-3*s.y+9*r.y-9*i.y+3*n.y,h=6*s.y-12*r.y+6*i.y,p=-3*s.y+3*r.y,d=u-a*t,f=h-o*t,m=p-c*t,g=-f/(2*d),b=Math.sqrt(f**2-4*d*m)/(2*d),E=g+b;E>=0&&E<=1&&l.push(di.pointOn(E,this.controls));let y=g-b;y>=0&&y<=1&&l.push(di.pointOn(y,this.controls))}else{let u=-o/(2*a),h=Math.sqrt(o**2-4*a*c)/(2*a),p=u+h;p>=0&&p<=1&&l.push(di.pointOn(p,this.controls));let d=u-h;d>=0&&d<=1&&l.push(di.pointOn(d,this.controls))}return l}buildConverxHull(t=_e.eps){let s=[...this.controls],r=[],i=s[0],n=1;do{let a=s[n%s.length];this.eqPP(i,a,t)||r.push(new le(i,a)),i=a,n++}while(i!==s[0]);if(r.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return Tt.build7(r).asClose()}getExtremePoints(t){if(!t)return a(this.controls);let s=t.start(),r=t.end(),i=r.x-s.x,n=r.y-s.y;if(Math.abs(i)<=_e.eps||Math.abs(n)<=_e.eps)return a(this.controls);{let o=n/i;if(this.controls.length===3){s.equals1(r)&&(r=s.add1(1,0));let c=r.y-s.y,l=s.x-r.x,u=-c*s.x-l*s.y,h=Math.sqrt(1/(c**2+l**2));c*=h,l*=h,u*=h;let p=this.controls.map(m=>c*m.x+l*m.y+u),d=p[0]-2*p[1]+p[2],f=p[1]-p[0]-o/2;if(d!==0){let m=-f/d;if(_e.greater(m,0)&&_e.less(m,1))return[di.pointOn(m,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(o)}return[];function a(o){let c,l;if(o.length===3){let[d,f,m]=o;c=Wy(d,f,m,"x"),l=Wy(d,f,m,"y")}else if(o.length===4){let[d,f,m,g]=o;c=qy(d,f,m,g,"x"),l=qy(d,f,m,g,"y")}c.sort((d,f)=>f-d),l.sort((d,f)=>f-d);let u=c.pop()||1,h=l.pop()||1,p=[];for(;u!==1||h!==1;)_e.eq(u,h)?(u=c.pop()||1,h=l.pop()||1):u<h?(p.push(di.pointOn(u,o)),u=c.pop()||1):(p.push(di.pointOn(h,o)),h=l.pop()||1);return p}}getToLineMaxDis2(t){let s=this.getExtremePoints(t),r=t.distance2(this.start()),i=t.distance2(this.end()),n=Math.max(r,i);return s.forEach(o=>a(t.distance2(o))),n;function a(o){n=Math.max(n,o)}}getToLineMinAndMaxDis_Controls(t){let s=t.start(),r=t.end();t.start().equals1(t.end())&&(r=s.add1(1,0));let i=r.y-s.y,n=s.x-r.x,a=-i*s.x-n*s.y,o=Math.sqrt(1/(i**2+n**2));i*=o,n*=o,a*=o;let c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return this.controls.forEach(u=>{let h=i*u.x+n*u.y+a;h<c&&(c=h),h>l&&(l=h)}),{minDis:c,maxDis:l}}getPercentInLine(t){let s=[],r=[],i=this.controls,n=t.start(),a=t.end(),o=a.y-n.y,c=n.x-a.x,l=-o*n.x-c*n.y,u=Math.sqrt(1/(o**2+c**2));if(o*=u,c*=u,l*=u,o**2+c**2<=0)return s;if(i.length===3){let[h,p,d]=i,f=o*(h.x-2*p.x+d.x)+c*(h.y-2*p.y+d.y),m=2*(o*(p.x-h.x)+c*(p.y-h.y)),g=o*h.x+c*h.y+l;r=F9(f,m,g)}else if(i.length===4){let[h,p,d,f]=i,m=f.sub(d.mul(3)).add(p.mul(3)).sub(h),g=h.sub(p.mul(2)).add(d).mul(3),b=p.sub(h).mul(3),E=h,y=o*m.x+c*m.y,T=o*g.x+c*g.y,w=o*b.x+c*b.y,S=o*E.x+c*E.y+l,_=Math.sqrt(1/(y**2+T**2));y*=_,T*=_,w*=_,S*=_,r=U9(y,T,w,S)}else throw Error("not support getBeizerPointInLine");return r.forEach(h=>{h>=0&&h<=1&&s.push(h)}),s}reverse(){return new di(this.controls.slice().reverse())}},Aa,BO=(Aa=class{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=de.ORIGIN,this.textOffsetCache[1]=new de(0,-.5),this.textOffsetCache[2]=new de(0,-1),this.textOffsetCache[3]=new de(-.5,0),this.textOffsetCache[4]=new de(-.5,-.5),this.textOffsetCache[5]=new de(-.5,-1),this.textOffsetCache[6]=new de(-1,0),this.textOffsetCache[7]=new de(-1,-.5),this.textOffsetCache[8]=new de(-1,-1)}static getCache(){return Aa.instance==null&&(Aa.instance=new Aa),Aa.instance}},Aa.instance=null,Aa),le=class tl extends Cp{constructor(t,s){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=t,this._end=s}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(t){if(_e.eq(this.distance(t),0)){let s=new tl(this._start,t);return s._a=this._a,s._b=this._b,s._c=this._c,s}return new tl(this._start,t)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new qe([this._start,this._end])}_hashCode(){let t=31,s=1;return s=t*s+this._start.hashCode(),s=t*s+this._end.hashCode(),s}start(){return this._start}end(){return this._end}center(){let t=this.start(),s=this.end();return t.add(s).mul(.5)}panDistance(t){let s=this._end.x-this._start.x,r=this._end.y-this._start.y,i=this.length();s=s*t/i,r=-r*t/i;let n=new de(this._start.x+r,this._start.y+s),a=new de(this._end.x+r,this._end.y+s);return new tl(n,a)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let t=BO.getCache().boxCache;t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.__bbox=new ei(t[0],t[1],t[2],t[3])}return this.__bbox}multiply3(t){return new tl(this._start.multiply3(t),this._end.multiply3(t))}hashCode(){return this.hashed}equals(t){let s=t;return this.hashed===s.hashed&&this._start.equals(s._start)&&this._end.equals(s._end)}equals1(t){let s=t;return this.hashed===s.hashed&&this._start.equals1(s._start)&&this._end.equals1(s._end)}equals2(t){let s=[this.start(),this.end()],r=[t.start(),t.end()];return Yn(s,r)||Yn(s,r.reverse())}stroke(t,s,r){let i,n,a;this._end.x<this._start.x?(n=this._start.x-this._end.x,a=this._start.y-this._end.y,i=this._end):(n=this._end.x-this._start.x,a=this._end.y-this._start.y,i=this._start);let o=Math.sqrt(n*n+a*a),c=t/2,l,u,h;s===2?(u=-c,h=o+c):(u=0,h=o),s===0||s===2?r===0?l=Tt.build5([u,-c,u,c,h,c,h,-c]):l=Tt.build5([u,c,u,-c,h,-c,h,c]):r===0?l=Tt.build2([we.build3(new de(u,0),-90,-180,c,c),we.build3(new de(h,0),90,-180,c,c)]):l=Tt.build2([we.build3(new de(u,0),90,180,c,c),we.build3(new de(h,0),-90,180,c,c)]);let p=Math.atan2(a,n),d=Wt.rotate(p).translate1(i);return l.asClose().multiply3(d)}points(t){return[this._start,this._end]}mirrorY(t){return new tl(this.start().mirrorY(t),this.end().mirrorY(t))}reverse(){return new tl(this._end,this._start)}inArea(t,s,r){let i=t.x,n=t.y,a=this._start,o=this._end,c=r==1,l=i-a.x,u=n-a.y,h=i-o.x,p=n-o.y,d=o.x-a.x,f=o.y-a.y,m=new de(-f,d).normalize(),g=d+m.x*s/2,b=f+m.y*s/2,E=g*g+b*b,y=l*l+u*u,T=h*h+p*p,w=Math.abs(l*f-u*d)/2,S=Math.sqrt(d*d+f*f)*s/4;if(w<=S&&y<=E&&T<=E){if(c)return!0;{let _=new de(i,n).sub(o).normalize(),C=new de(i,n).sub(a).normalize(),x=new de(m.x,m.y).cross(_),D=new de(m.x,m.y).cross(C);return x>=0&&D<=0}}else if(c){let _=s/2;return y<=_*_?!0:T<=_*_}else return!1}isParallel(t,s=!1){let r=_e.eq(Math.abs(this.direct.cross(t.direct)),0),i=!s||_e.greatereq(this.direct.dot(t.direct),0);return r&&i}distance2(t){return(this.a*t.x+this.b*t.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(t){let{x:s,y:r}=t,{x:i,y:n}=this.start(),{x:a,y:o}=this.end();return((s-i)*(o-n)-(r-n)*(a-i))**2/((o-n)**2+(a-i)**2)}distance(t){return Math.abs(this.a*t.x+this.b*t.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function G9(e,t=.05){if(e.length<3)return e.slice();let s=e.slice(0,1),r=(n,a,o)=>w9(n.x,n.y,a.x,a.y,o.x,o.y);for(;;){s=e.slice(0,1);for(let n=1;n<e.length-1;n+=2)r(e[n],e[n-1],e[n+1])>t&&s.push(e[n]),s.push(e[n+1]);if(s.at(-1).equals1(e.at(-1))||s.push(e.at(-1)),e.length==s.length)break;e=s}let i=e[e.length-1];return s.push(i),s}var Y9=$j(Qj());var V9=class{constructor(){this.fac=new Oi,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(e){for(this.fac.clear(),this.length=e.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=e[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},z9=new V9,Tt=class Xs{constructor(t,s){this.__bbox=null,this.primitives=t,this.__bbox=s}static calcBBox(t){return z9.calcBBox(t)}static build1(t){let s=[],r=null;return Gy(t,(i,n)=>{let a=n.start();return r!==null&&!a.equals(r)&&s.push(new le(r,a)),s.push(n),r=n.end(),!0}),s.length===0&&r!=null&&s.push(new le(r,r)),new Xs(s)}static build2(t){return Xs.build1(wT(t))}static build3(t){let s=[],r=null;return Gy(t,(i,n)=>(r!==null&&s.push(new le(r,n)),r=n,!0)),new Xs(s)}static build4(t){return this.build3(wT(t))}static build5(t){let s=[];for(let r=0;r<t.length;r+=2)s.push(new de(t[r],t[r+1]));return this.build4(s)}static build6(t){return Xs.build4([t.LL(),t.LR(),t.UR(),t.UL(),t.LL()])}static build7(t){return new Xs(t)}static build8(t){let s=new de(t[0],t[1]),r,i=[],n,a=(o,c)=>o.length==c&&o.every(l=>typeof l=="number");for(let o=2;o<t.length;)switch(typeof t[o]=="string"?n=t[o]:o-=1,n){case"ARC":{let c=t.slice(o+1,o+4);if(!a(c,3))throw new Error("invalid rawData");let l=c[0];r=new de(c[1],c[2]),i.push(we.build5(s,r,l)),s=r,o+=4;break}case"L":{let c=t.slice(o+1,o+3);if(!a(c,2))throw new Error("invalid rawData");r=new de(c[0],c[1]),i.push(new le(s,r)),s=r,o+=3;break}case"C":{let c=t.slice(o+1,o+7);if(!a(c,7))throw new Error("invalid rawData");let l=new de(c[0],c[1]),u=new de(c[2],c[3]);r=new de(c[4],c[5]),i.push(new qe([s,l,u,r])),s=r,o+=7;break}default:throw new Error("invalid rawData")}return Xs.build2(i)}static buildBBox(t,s=0){return s===1?Xs.build5([t.minX,t.minY,t.maxX,t.minY,t.maxX,t.maxY,t.minX,t.maxY,t.minX,t.minY]):Xs.build5([t.minX,t.minY,t.minX,t.maxY,t.maxX,t.maxY,t.maxX,t.minY,t.minX,t.minY])}static triangulate(t,s,r=1){if(t.length===1){let c=new Array;t[0].asClose().points2(r,p=>c.push(p));let l,u=c[0],h=[];for(let p=0;p<c.length-2;p+=2){let d=c[p+1],f=c[p+2],m=d.sub(u).normalize().cross(f.sub(u).normalize());if(_e.neq(m,0)){if(l===!0){if(m<0){h.length=0;break}}else if(l===!1){if(m>0){h.length=0;break}}else l=m>0;h.push(u),h.push(d),h.push(f)}c.push(u),u=f}if(h.length!==0){for(let p=0;p<h.length;p+=3)s(h[p],h[p+1],h[p+2]);return}}let i=[],n=[];t.forEach(c=>{i.length!==0&&n.push(i.length/2),c.asClose().points2(r,l=>i.push(l.x,l.y))});let a=Y9.default(i,n),o=[];for(let c=1;c<i.length;c+=2)o.push(new de(i[c-1],i[c]));for(let c=0;c<a.length;c+=3)s(o[a[c]],o[a[c+1]],o[a[c+2]])}lines(t,s){let r=new Array;this.points(t,n=>r.push(n));let i=r[0];for(let n=1;n<r.length;n++){let a=r[n];s(i),s(a),i=a}}triangles(t,s){Xs.triangulate([this],(...r)=>{r.forEach(i=>s(i))},t)}mirror(){let t=[];return this.primitives.forEach(s=>{if(s instanceof le)s=new le(s.start().mirror(),s.end().mirror());else if(s instanceof we)s=s.mirror();else if(s instanceof qe){let r=s.controls.map(i=>i.mirror());s=new qe(r)}else throw new Error("bug");t.push(s)}),new Xs(t,this.__bbox)}getPoints(t){let s=[];for(let r of this.primitives)for(let i of r.points(t))s.push(i);return s}round(t=4){let s=this.primitives.slice();for(let r=0;r<s.length;r++){let i=s[r];if(i instanceof le){let n=i.start().round(t),a=i.end().round(t);s[r]=new le(n,a)}else if(i instanceof qe){let n=i.controls.map(a=>a.round(t));s[r]=new qe(n)}else if(i instanceof we){let n=i.start().round(t),a=i.end().round(t),o=i.sweepAngle;s[r]=we.build5(n,a,o)}}return new Xs(s,this.__bbox)}simplify(t=.05){let s=[],r=!1,i=[],n=this.closed();if(this.primitives.length<=1)return Xs.build2(this.primitives);let a=()=>{if(i.length>2){let c=G9(i,t);for(let l=1;l<c.length;l++)s.push(new le(c[l-1],c[l]))}else s.push(new le(i[0],i[1]));i.length=0,r=!1};for(let c=0;c<this.primitives.length;c++){let l=this.primitives[c];l instanceof le?(r?i.push(l.end()):(i.length=0,i.push(l.start(),l.end()),r=!0),c===this.primitives.length-1&&a()):(r&&a(),s.push(l))}let o=new Xs(s,this.__bbox);return n&&!o.closed()&&(o=o.asClose()),o}hasBackLine(){let{primitives:t}=this,s;for(let r=0;r<t.length;r++){let i=t[r];if(i instanceof le){if(i.end().equals1(i.start()))continue;if(s&&(i.end().equals1(s.start())||S9(i.end(),s.start(),s.end())))return!0;s=i}else s=null}return!1}area(t=.1){let s=0,r=this.end();return this.primitives.forEach(i=>{let n=i.start(),a=i.end();if(s+=(n.x+r.x)*(n.y-r.y),i instanceof le)s+=(a.x+n.x)*(a.y-n.y);else if(i instanceof we)s+=(a.x+n.x)*(a.y-n.y),s+=Math.PI*i.rx2*i.sweepAngle/180-de.normal(i.center,i.start(),i.end());else if(i instanceof qe){let o=n;i.points(t).forEach(c=>{s+=(c.x+o.x)*(c.y-o.y),o=c}),s+=(a.x+o.x)*(a.y-o.y)}r=a}),s/2}closed(t){return this.primitives.length===0?!1:this.start().equals(this.end(),t)}asClose(){let t=this.primitives[0],s=this.primitives[this.primitives.length-1],r=t.start(),i=s.end();if(r.equals(i))return this;{let n=new Array;return ti.addAll(n,this.primitives),n.push(new le(i,r)),Xs.build2(n)}}closeEndpoint(){let t=this.primitives[0],s=this.primitives[this.primitives.length-1],r=t.start(),i=s.end();if(r.equals1(i))return this;{let n=new Array;return ti.addAll(n,this.primitives),n.push(new le(i,r)),new Xs(n)}}reverse(){let t=new Array(this.primitives.length);for(let s=0,r=this.primitives.length-1;r>=0;s++,r--){let i=this.primitives[r];if(i instanceof le)i=new le(i.end(),i.start());else if(i instanceof we)i=i.exchangeSweep();else if(i instanceof qe)i=new qe(i.controls.slice().reverse());else throw new Error("bug");t[s]=i}return new Xs(t,this.__bbox)}reverse1(){let t=new Array(this.primitives.length);for(let s=0,r=this.primitives.length-1;r>=0;s++,r--){let i=this.primitives[r];if(i instanceof le)i=new le(i.end(),i.start());else if(i instanceof we)i=i.exchangeSweep1();else if(i instanceof qe)i=new qe(i.controls.slice().reverse());else throw new Error("bug");t[s]=i}return new Xs(t,this.__bbox)}mirrorY(t){let s=[];return this.primitives.forEach(r=>{if(r instanceof le)r=r.mirrorY(t);else if(r instanceof we)r=r.mirrorY(t);else if(r instanceof qe){let i=r.controls.map(n=>n.mirrorY(t));r=new qe(i)}else throw new Error("bug");s.push(r)}),new Xs(s,this.__bbox)}points(t,s){if(this.primitives.length!==0){for(let r=0;r<this.primitives.length-1;r++){let i=this.primitives[r].points(t);i.pop(),i.forEach(n=>s(n))}this.primitives[this.primitives.length-1].points(t).forEach(r=>s(r))}}points1(t,s){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let n=this.primitives[i],a=n instanceof we?n.points1(t):n.points(t);a.pop(),a.forEach(o=>s(o))}let r=this.primitives[this.primitives.length-1];(r instanceof we?r.points1(t):r.points(t)).forEach(i=>s(i))}points2(t,s){if(this.primitives.length===0)return;for(let i=0;i<this.primitives.length-1;i++){let n=this.primitives[i],a=n instanceof we?n.points2():n.points(t);a.pop(),a.forEach(o=>s(o))}let r=this.primitives[this.primitives.length-1];(r instanceof we?r.points2():r.points(t)).forEach(i=>s(i))}multiply3(t){let s=new Array(this.primitives.length);for(let r=0;r<this.primitives.length;r++)s[r]=this.primitives[r].multiply3(t);return Xs.build7(s)}bbox(){return this.__bbox==null&&(this.__bbox=Xs.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(t){if(this.primitives.length<=1&&!(this.primitives[0]instanceof we))return!1;{let s=this.primitives[0],r=this.primitives[this.primitives.length-1];return s.start().equals(r.end(),t)}}isEqual(t){if(t instanceof Xs&&t.primitives.length==this.primitives.length){let s=t.primitives.length;for(let r=0;r<s;r++){let i=t.primitives[r],n=this.primitives[r];if(JSON.stringify(i)!=JSON.stringify(n))return!1}return!0}return!1}equals(t){if(!t)return!1;let s=this.primitives,r=t.primitives;if(s.length!=r.length)return!1;if(t.isClose()){let i=0;for(;i<s.length;){let n=s.slice(i).concat(s.slice(0,i));if(Yn(n,r)||Yn(n.reverse(),r))return!0;i++}return!1}else return Yn(this.primitives,t.primitives)}clone(){return Xs.build2(this.primitives)}putItem(t,s){if(!t)return!1;if(t instanceof Xs)return this.mergePolyline(t,s);let r=this.start();if(!r){this.primitives.push(t),this.__bbox=t.bbox();return}let i=this.end();if(r.equals(i,s))return!1;let n=t.start(),a=t.end(),o=!1,c=!1;if(r.equals(n,s))o=!0,c=!1;else if(r.equals(a,s))o=!1,c=!1;else if(i.equals(n,s))o=!1,c=!0;else if(i.equals(a,s))o=!0,c=!0;else return!1;return c?this.primitives.push(o?t.reverse():t):this.primitives.unshift(o?t.reverse():t),this.__bbox=ei.extend2(this.__bbox,t.bbox()),!0}mergePolyline(t,s,r=0){if(!t)return!1;let i=this.start();if(!i){this.primitives.push(...t.primitives),this.__bbox=t.bbox();return}let n=this.end();if(i.equals(n,s))return!1;let a=t.start(),o=t.end(),c=!1,l=!1;if(i.equals(a,s))c=!0,l=!1;else if(i.equals(o,s))c=!1,l=!1;else if(n.equals(a,s))c=!1,l=!0;else if(n.equals(o,s))c=!0,l=!0;else return!1;let u=c?t.reverse():t;return l?this.primitives.push(...u.primitives):this.primitives.unshift(...u.primitives),this.__bbox=ei.extend2(this.__bbox,t.bbox()),!0}deDuplicationPoint(t){let s=this.primitives[this.primitives.length-1].start(),r=this.primitives[this.primitives.length-1].end(),i=t.primitives[0].start(),n=t.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof le&&t.primitives[0]instanceof le&&I9([s,r],[i,n])){this.primitives.pop(),t.primitives.shift();let a=[];a.push(new le(s,n)),this.primitives.push(...a)}}getMaxBBoxHeightByVec(t){let s=t.normalize(),r=-1/0,i=1/0;if(this.primitives.forEach(a=>{let o=a.start().dot(s),c=a.end().dot(s);if(n(o),n(c),a instanceof we){let l=t.angleD(de.ORIGIN);if(a.angleIsInArc(l)){let u=a.pointOn(l).dot(s);n(u)}if(a.angleIsInArc(l+180)){let u=a.pointOn(l-180).dot(s);n(u)}}}),r-i<=0)throw new Error("getMaxBBoxHeightByVec");return r-i;function n(a){a>r&&(r=a),a<i&&(i=a)}}getWindingNum(t){let s=this.end(),r=0,{x:i,y:n}=t;for(let o of this.primitives){if(s.y>n?o.bbox().minY>n:o.bbox().maxY<=n){s=o.end();continue}if(o instanceof we&&(o.isCCW?Math.floor(o.startAngle/90)+1!==Math.ceil(o.endAngle()/90):Math.ceil(o.startAngle/90)-1!==Math.floor(o.endAngle()/90))){let c=o.startAngle,l=o.endAngle();if(o.sweepAngle>0){let u=90;for(;u<=l;)u>c&&(a(we.build3(o.center,c,u-c,o.rx,o.ry)),c=u),u+=90;c<l&&a(we.build3(o.center,c,l-c,o.rx,o.ry))}else{let u=270;for(;u>=l;)u<c&&(a(we.build3(o.center,c,u-c,o.rx,o.ry)),c=u),u-=90;c>l&&a(we.build3(o.center,c,l-c,o.rx,o.ry))}}else if(o instanceof qe){let c=[];LO(o,c),c.forEach(l=>a(l))}else a(o)}return r;function a(o){let c=o.start(),l=o.end();if(s.y>n!=c.y>n&&(s.x>i?c.x>i?r+=c.y>s.y?1:-1:s.y>c.y?(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)<0&&r--:(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)>0&&r++:c.x>i&&(s.y>c.y?(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)<0&&r--:(s.x-i)*(c.y-n)-(s.y-n)*(c.x-i)>0&&r++)),c.y>n!=l.y>n){if(c.x>i)if(l.x>i)r+=l.y>c.y?1:-1;else if(o instanceof le)c.y>l.y?(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)<0&&r--:(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)>0&&r++;else if(o instanceof we){let{center:u,isCCW:h,rx2:p}=o,d=(u.x-i)**2+(u.y-n)**2;c.y>l.y?(h?d>p:d<p)&&r--:(h?d<p:d>p)&&r++}else if(o instanceof qe){if(qP(o,n)===0)throw new Error("no inters");te[0]>i&&(r+=l.y>c.y?1:-1)}else throw new Error("not support!");else if(l.x>i)if(o instanceof le)c.y>l.y?(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)<0&&r--:(c.x-i)*(l.y-n)-(c.y-n)*(l.x-i)>0&&r++;else if(o instanceof we){let{center:u,isCCW:h,rx2:p}=o,d=(u.x-i)**2+(u.y-n)**2;c.y>l.y?(h?d>p:d<p)&&r--:(h?d<p:d>p)&&r++}else if(o instanceof qe){if(qP(o,n)===0)throw new Error("no inters");te[0]>i&&(r+=l.y>c.y?1:-1)}else throw new Error("not support!")}s=l}}},Py=Math.PI*2;var SX=Math.PI/2,_X=Math.sin(Math.PI/180);var W9=4,we=class bs extends Cp{constructor(t,s,r,i,n){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=t,this.ry=s,this.center=r,this.startAngle=i,this.sweepAngle=n,this._start=de.ORIGIN,this._end=de.ORIGIN,this._start=this.pointOn(i),this._end=this.pointOn(i+n)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let t=31,s=1;return s=t*s+new de(this.rx,this.rx).hashCode(),s=t*s+this.center.hashCode(),s=t*s+new de(this.startAngle,this.sweepAngle).hashCode(),s}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(t,s,r,i){let n=s>=0?-.01:.01,a=t+s;for(;(s>=0&&a>t||s<0&&a<t)&&r.distance2(i)<2e-4;)n*=2,a+=n,i=this.pointOn(a);return i}static build1(t,s,r,i,n,a){Is.positive(r),Is.positive(i);let o=t.equals(s);if(o)return new bs(r,i,t,0,n?360:0);{let c=t.x,l=-t.y,u=s.x,h=-s.y,p=a===0,d=(c-u)/2,f=(l-h)/2,m=Math.cos(0),g=Math.sin(0),b=m*d+g*f,E=-g*d+m*f;r=Math.abs(r),i=Math.abs(i);let y=r*r,T=i*i,w=b*b,S=E*E,_=n===p?-1:1,C=(y*T-y*S-T*w)/(y*S+T*w);C=C<0?0:C;let x=_*Math.sqrt(C),D=x*(r*E/i),I=x*-(i*b/r),P=(c+u)/2,L=(l+h)/2,F=P+(m*D-g*I),V=L+(g*D+m*I),B=(b-D)/r,k=(E-I)/i,O=(-b-D)/r,R=(-E-I)/i,v,j;j=Math.sqrt(B*B+k*k),v=B,_=k<0?-1:1;let M=lt.toDegrees(_*Math.acos(v/j));j=Math.sqrt((B*B+k*k)*(O*O+R*R)),v=B*O+k*R,_=B*R-k*O<0?-1:1;let H=v/j,q;H<-1?q=Math.acos(-1):H>1?q=Math.acos(1):q=Math.acos(H);let Q=lt.toDegrees(_*q);!p&&Q>0?Q-=360:p&&Q<0&&(Q+=360),Is.normal(M),Is.normal(Q);let oe=d*d/y+f*f/T,me=t.distance1(s)/2;r<me&&i<me&&(r*=Math.sqrt(oe),i*=Math.sqrt(oe));let Ee=o?0:lt.regularD(-M),Pe=o?n?360:0:-Q;return new bs(r,i,new de(F,-V),Ee,Pe)}}static build2(t,s,r,i,n,a){Is.positive(i),Is.positive(n),Is.normal(s),Is.normal(r);let o;return s===r?(s=lt.regularD(s),r=lt.regularD(r),o=0):(s=lt.regularD(s),r=lt.regularD(r),a===1?r<=s&&(r+=360):r>=s&&(s+=360),o=r-s),new bs(i,n,t,lt.regularD(s),o)}static build3(t,s,r,i,n){return Is.positive(i),Is.positive(n),Is.normal(r),new bs(i,n,t,lt.regularD(s),r)}static build4(t,s,r,i,n,a){let o=t.angleD(r),c=s.angleD(r);return bs.build2(r,o,c,i,n,a)}static build5(t,s,r){r=lt.toRadians(r);let i=s.sub(t),n=new de(-i.y,i.x).normalize(),a=Math.abs(r)/2,o;if(a!=0)o=i.length()/2/Math.sin(a);else throw new Error("Can't represent circle!!!");let c=n.rotate(de.ORIGIN,a),l,u;r>0?(l=1,u=s.add(c.scale(o))):(l=0,u=t.sub(c.scale(o)));let h=lt.toDegrees(t.angle(u)),p=lt.toDegrees(s.angle(u));return bs.build2(u,h,p,o,o,l)}static buildCircle(t,s,r=0){return bs.build2(t,0,360,s,s,r)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(t){t=lt.regularD(t);let s=this.rx,r=this.ry;if(t===0)return this.center.add1(s,0);if(t===90)return this.center.add1(0,r);if(t===180)return this.center.add1(-s,0);if(t===270)return this.center.add1(0,-r);{let i=this.rx2,n=this.ry2,a=Math.tan(lt.toRadians(t)),o=a*a,c=Math.sqrt(i*n/(i+n/o)),l=Math.sqrt(i*n/(n+i*o));return t>90&&t<270&&(l=-l),t>180&&t<360&&(c=-c),isNaN(l)&&(l=0),isNaN(c)&&(c=0),this.center.add1(l,c)}}exchangeSweep(){return bs.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return bs.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return bs.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(t){let s=this.start(),r=this.end();return s.equals(r)?bs.build3(this.center.mirrorY(),0,360,this.rx,this.ry):bs.build1(s.mirrorY(t),r.mirrorY(t),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(t=de.ORIGIN){let s=this.start(),r=this.end();return s.equals(r)?bs.build3(this.center.mirror(t),0,360,this.rx,this.ry):bs.build1(s.mirror(t),r.mirror(t),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let t=ST.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-t}multiply3(t){let s;t.isMirrored()?s=-this.sweepAngle:s=this.sweepAngle;let r;return t.equals(Wt.ROT_90)?r=lt.regularD(this.startAngle+90):t.equals(Wt.ROT_N90)?r=lt.regularD(this.startAngle-90):r=lt.transformD(this.startAngle,t),bs.build3(this.center.multiply3(t),r,s,t.iScale*this.rx,t.iScale*this.ry)}angleIsInArc(t){return t=lt.regularD(t),this.sweepAngle>0?(t<this.startAngle&&(t+=360),this.endAngle()>t):(t>this.startAngle&&(t-=360),this.endAngle()<t)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let t=this.start(),s=this.end(),r=lt.toRadians(this.sweepAngle)/2,i=4/3*(1-Math.cos(r))/Math.sin(r)*this.rx;return new qe([t,t.add(new de(i,0).multiply3(Wt.rotateD(this.startAngle+90))),s.add(new de(i,0).multiply3(Wt.rotateD(this.endAngle()-90))),s])}toBezier2(){let t=[];r(this,90);let s=[];return t.forEach(i=>s.push(i.toBezier())),s;function r(i,n){if(Math.abs(i.sweepAngle)>n){let a=i.sweepAngle/2;r(bs.build3(i.center,i.startAngle,a,i.rx,i.ry),n),r(bs.build3(i.center,i.startAngle+a,a,i.rx,i.ry),n)}else t.push(i)}}buildBBox(){let t=BO.getCache().boxCache,s=this.startAngle+this.sweepAngle;if(t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let r=0;for(;r<s;){if(r>this.startAngle){let i=this.pointOn(r);t[0]=Math.min(t[0],i.x),t[1]=Math.max(t[1],i.x),t[2]=Math.min(t[2],i.y),t[3]=Math.max(t[3],i.y)}r+=90}}else if(this.sweepAngle<0){let r=360;for(;r>s;){if(r<this.startAngle){let i=this.pointOn(r);t[0]=Math.min(t[0],i.x),t[1]=Math.max(t[1],i.x),t[2]=Math.min(t[2],i.y),t[3]=Math.max(t[3],i.y)}r-=90}}return new ei(t[0],t[1],t[2],t[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return th.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(t,s,r){let i=t/2,n=this.rx+i,a=this.ry+i,o=this.rx-i,c=this.ry-i,l=new Wt;o<0&&(o=-o,l=l.multiply3(Wt.MIRROR_Y)),c<0&&(c=-c,l=l.multiply3(Wt.MIRROR_X)),o===0&&(o=.001),c===0&&(c=.001),l=l.setOrigin1(this.center);let u,h;switch(r===this.sweep()?(u=bs.build3(this.center,this.startAngle,this.sweepAngle,n,a),h=bs.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,o,c)):(u=bs.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,n,a),h=bs.build3(this.center,this.startAngle,this.sweepAngle,o,c)),h=h.multiply3(l),s){case 1:{let p=r===1?180:-180,d=r===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),f=r===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),m=u.pointOn(u.endAngle()).angleD(d),g=h.pointOn(h.endAngle()).angleD(f);return Tt.build2([u,bs.build3(d,m,p,i,i),h,bs.build3(f,g,p,i,i)])}default:return Tt.build2([u,h])}}points2(){let t=Math.ceil(Math.abs(this.sweepAngle)/W9),s=this.sweepAngle/t,r=[this._start];for(let i=1;i<t;i++)r.push(this.pointOn(this.startAngle+s*i));return r.push(this._end),r}points1(t){let s=Math.max(this.rx,this.ry);if(s<=t)return[this.start(),this.svgEnd];let r=(s-t)/s,i=Math.ceil(Math.abs(this.sweepAngle/lt.toDegrees(Math.acos(r))/2)),n=new Array(i+1),a=this.sweepAngle/i,o=this.startAngle;for(let c=0;c<=i;c++,o+=a)n[c]=this.pointOn(o);return n}points(t){let s=Math.max(this.rx,this.ry);if(t=Math.abs(t),s<=t)return[this.start(),this.svgEnd];t=Math.max(t,s*1e-5),t=Math.min(t,s*(1-Math.SQRT1_2));let r=(s-t)/s,i=Math.ceil(Math.abs(this.sweepAngle/lt.toDegrees(Math.acos(r))/2));i=Math.max(i,2);let n=new Array(i+1),a=this.sweepAngle/i,o=this.startAngle+a;n[0]=this.start();for(let c=1;c<i;c++,o+=a)n[c]=this.pointOn(o);return n[i]=this.end(),n}panDistance(t){return this.sweepAngle>0?new bs(this.rx-t,this.ry-t,this.center,this.startAngle,this.sweepAngle):new bs(this.rx+t,this.ry+t,this.center,this.startAngle,this.sweepAngle)}panDistance1(t){if(this.sweepAngle>0){let s=this.rx-t;return s<0?(s=Math.abs(s),bs.build3(this.center,this.startAngle-180,this.sweepAngle,s,s)):new bs(s,s,this.center,this.startAngle,this.sweepAngle)}else{let s=this.rx+t;return s<0?(s=Math.abs(s),bs.build3(this.center,this.startAngle-180,this.sweepAngle,s,s)):new bs(s,s,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let t=Math.abs(b9(this.sweepAngle,3))/180*Math.PI;return Math.tan(t/4)}get midPoint(){let t=lt.toRadians(this.startAngle),s=lt.toRadians(this.endAngle()),r=this.sweep(),i=this.center,n=this.rx;if(r==1)if(s>t){let a=(s-t)/2+t;return i.add(new de(Math.cos(a),Math.sin(a)).mul(n))}else{if(s==t)return i.add(new de(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(s+Py-t)/2+t;return i.add(new de(Math.cos(a),Math.sin(a)).mul(n))}}else if(s>t){let a=(t+Py-s)/2+s;return i.add(new de(Math.cos(a),Math.sin(a)).mul(n))}else{if(s==t)return i.add(new de(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(t-s)/2+s;return i.add(new de(Math.cos(a),Math.sin(a)).mul(n))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(t){let s=lt.regularD(this.startAngle),r=lt.regularD(this.sweepAngle),i=lt.regularD(t.startAngle),n=lt.regularD(t.sweepAngle);return Yn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Yn([r,s],[n,i])||Yn([lt.regularD(s+r)],[i]))}equals1(t){let s=lt.regularD(this.startAngle),r=lt.regularD(this.sweepAngle),i=lt.regularD(t.startAngle),n=lt.regularD(t.sweepAngle);return Yn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Yn([r,s],[n,i])||Yn([lt.regularD(s+r)],[i]))}inArea(t,s){let r=t.x,i=t.y,n=this.center,a=this.rx,o=lt.toRadians(this.startAngle);this.sweep()==0&&(o=lt.toRadians(this.endAngle()));let c=lt.toRadians(this.endAngle());this.sweep()==0&&(c=lt.toRadians(this.startAngle));let l=a-s/2,u=a+s/2;var h=r-n.x,p=i-n.y,d=Math.atan2(p,h);if(d<0&&(d+=Py),o<=c&&d>=o&&d<=c||o>c&&(d>=o&&d<=Py||d>=0&&d<=c)||o==c){var f=Math.sqrt(h*h+p*p);return f<=u&&f>=l}else{var f=(u+l)/2,m=new de(n.x+Math.cos(o)*f,n.y+Math.sin(o)*f),g=new de(n.x+Math.cos(c)*f,n.y+Math.sin(c)*f),b=r-m.x,E=i-m.y,y=r-g.x,T=i-g.y;return b*b+E*E<=s*s/4?!0:y*y+T*T<=s*s/4}}isCircle(){return(_e.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return bs.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let t=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+t)%t:(this.startAngle-this.endAngle()+t)%t}isValid(){return this.rx>0&&this.ry>0}},kO=new ArrayBuffer(24),iT=new Float64Array(kO),zu=new Int32Array(kO),ur,AX=(ur=class{static normal(t,s,r){let i=s.sub(t),n=r.sub(s);return i.cross(n)}constructor(t,s,r){this.x=Is.normal(t),this.y=Is.normal(s),this.z=Is.normal(r),iT[0]=t,iT[1]=s,iT[2]=r,this.hashed=zu[0]^zu[1]^zu[2]^zu[3]^zu[4]^zu[5]}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(t){return t instanceof ur?t.x===this.x&&t.y===this.y&&t.z===this.z:!1}cross(t){return new ur(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var t=this.length();return new ur(this.x/t,this.y/t,this.z/t)}sub(t){return new ur(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new ur(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new ur(this.x*t,this.y*t,this.z*t)}neg(){return new ur(-this.x,-this.y,-this.z)}multiply4(t){var s=this.x*t.data[0]+this.y*t.data[4]+this.z*t.data[8]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+this.z*t.data[9]+t.data[13],i=this.x*t.data[2]+this.y*t.data[6]+this.z*t.data[10]+t.data[14],n=this.x*t.data[3]+this.y*t.data[7]+this.z*t.data[11]+t.data[15];return n!=0?new ur(s/n,r/n,i/n):new ur(s,r,i)}rotate(t,s){return this.multiply4(xO.rotateAxis(t,s))}toVector2(){return new de(this.x,this.y)}},ur.ORIGIN=new ur(0,0,0),ur.X_UNIT_VECTOR=new ur(1,0,0),ur.Y_UNIT_VECTOR=new ur(0,1,0),ur.Z_UNIT_VECTOR=new ur(0,0,1),ur);var Vs=class Xu{static build(t){return t instanceof Tt?new Xu([new hr([t])]):t instanceof hr?new Xu([t]):t}static buildByPolygon(t){return t?new Xu([t]):new Xu([])}static buildByStroke(t,s,r=1,i){return this.buildByPolygon(hr.buildByStroke(t,s,r,jT,i))}static buildCircle(t,s){return this.buildByPolygon(hr.buildCircle(t,s))}static buildRect(t){return this.buildByPolygon(hr.buildRect(t))}static buildBBox(t){return this.buildByPolygon(hr.buildBBox(t))}constructor(t){this.items=t.slice()}multiply3(t){return new Xu(this.items.map(s=>s.multiply3(t)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((t,s)=>t.ext1(s.bbox()),new Oi).build1()),this._bbox}toPolylineGroups(){return this.items.map(t=>t.toPolylineGroup())}},ts,Lt=(ts=class{static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,s,r,i=255){return new ts(t/255,s/255,r/255,i/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let s=t.length;if(s==3)return new ts(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(s==6)return new ts(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(s==8)return new ts(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let s=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),i=parseInt(t.b*255+"").toString(16);return s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),("#"+s+r+i).toUpperCase()}static of5(t,s){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return new ts(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,s);if(t.length==6)return new ts(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,s);throw new Error("invalid color string")}static of6(t,s){return new ts(t.r,t.g,t.b,s)}static of7(t){return t==null?null:ts.of3(t)}constructor(t,s,r,i=1){this.r=Is.positiveOr0(t),this.g=Is.positiveOr0(s),this.b=Is.positiveOr0(r),this.alpha=i}hashCode(){return this.r+this.g+this.b+this.alpha}equals(t,s=!1){let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return s?r:r&&this.alpha===t.alpha}add(t,s,r,i){return new ts(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+s)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+i)))}mul(t){return new ts(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return new ts(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),s=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+s.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),s=(this.g*255).toString(16),r=(this.b*255).toString(16),i=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),"#"+t.substr(0,2)+s.substr(0,2)+r.substr(0,2)+i.substr(0,2)}toRGBA(){let t=this.r*255,s=this.g*255,r=this.b*255;return[t,s,r,this.alpha]}toRGBAString(){let t=this.r*255,s=this.g*255,r=this.b*255;return`rgba(${t},${s},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},ts.WHITE=new ts(1,1,1,1),ts.BLACK=new ts(0,0,0,1),ts.RED=new ts(1,0,0,1),ts.GREEN=new ts(0,1,0,1),ts.BLUE=new ts(0,0,1,1),ts.Gray=ts.of3("#9966ff"),ts.Silver=ts.of3("#D2D2D2"),ts.Golden=ts.of3("#DCAA14"),ts.Pink=ts.of3("#ffaec9"),ts),eO=!1,MO=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,s,r,i,n){}onIntersect(e,t,s){}onSegment(e,t,s,r,i,n){}onSegment1(e,t,s){if(eO){let r=new de(e.getX(s),s),i=new de(t.getX(s),s);this.onSegment(r,e.weight,e,i,t.weight,t)}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t)}onSweep1(e,t,s){if(eO){let r=new de(e.getX(s),s),i=new de(t.getX(s),s);this.onSweep(r,e.weight,e,i,t.weight,t)}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t)}},yp=class extends MO{constructor(e){super(),this.plGrps=new Array,this.debug=e}onPolylineGroup(e,t){this.plGrps.push(e)}},Dp=class{constructor(e){this.cache={},this.levels=e,this.result=new Array(e),this.weights=new Array(e),this.maxIdx=e-1,this.rule=this.decide.bind(this);let t=1;for(let s=0;s<e;s++)this.weights[s]=t,t*=50}weight(e){return this.weights[e]}decide(e){e=Math.abs(e);let t=this.cache[e];if(t===void 0){let s=e;for(let r=this.maxIdx;r>=0;r--){let i=this.weights[r],n=e/i|0,a=e%i;a>(i/2|0)?(e=i-a,n++):e=a,this.result[r]=n>0}t=this.decide1(this.result),this.cache[s]=t}return t}},q9=e=>e!==0;var J9=new class extends Dp{decide1(e){return e[0]||e[1]}}(2),My=new class extends Dp{decide1(e){return e[0]&&!e[1]}}(2),jy=new class extends Dp{decide1(e){return e[0]&&e[1]}}(2),Fy=new class extends Dp{decide1(e){return e[0]&&!e[1]||!e[0]&&e[1]}}(2),K9=(e=>(e[e.UNMARKED=0]="UNMARKED",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE=2]="OUTSIDE",e[e.INVALID=3]="INVALID",e))(K9||{}),ah=class Zu{constructor(t,s,r,i,n,a,o){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=t,this.shape=s,this.baseWeight=r,i.y>n.y?this.weight=-r:i.y==n.y?this.weight=0:this.weight=r,this.start=i,this.end=n,this.polyGrp=a,this.polyIndex=o,this._bbox=new Oi().ext1(s.bbox()).ext2(i).ext2(n).build1(),this.inters.push(i),this.inters.push(n);let c=31,l=1;l=c*l+this.polyGrp,l=c*l+this.polyIndex,this._hashcode=l}static rebuild(t,s,r){if(t instanceof le||s.distance2(r)<1e-6)return new le(s,r);if(t instanceof we){let i=t,n=t.bbox().center().x,a;s.y>r.y?a=n>i.center.x?0:1:a=n>i.center.x?1:0;let o=s.angleD(i.center),c=r.angleD(i.center);return we.build2(i.center,o,c,i.rx,i.ry,a)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Oi().ext2(this.start).ext2(this.end).build1()}is(t,s){return t===this.polyGrp&&s===this.polyIndex}confidence(t){if(this._confidence_y!=t){let s=this._bbox.height();if(s!==0)if(Math.abs(t-this._bbox.maxY)>5e-4&&Math.abs(t-this._bbox.minY)>5e-4){let r=1-Math.abs(2*t-this._bbox.maxY-this._bbox.minY)/s;this._confidence=r*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=t}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(t){let s=this.confidence(t);return this.outsideWeight-=s,this.invalidWeight+=s,s}revokeInside(t){let s=this.confidence(t);return this.insideWeight-=s,this.invalidWeight+=s,s}setOutside(t){let s=this.confidence(t);return this.outsideWeight+=s,s}setInside(t){let s=this.confidence(t);return this.insideWeight+=s,s}setInvalid(t){let s=this.confidence(t);return this.invalidWeight+=s,s}prevNot0(){let t=this.previous;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.previous}return null}nextNot0(){let t=this.next;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.next}return null}getX(t){if(this.bo!==null)return(this._x_y!=t||isNaN(this._x))&&(rF(this,t)>0?this._x=te[0]:this._x=NaN,this._x_y=t),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(t){if(t===2)if(this.start.y>this.end.y){let s=Zu.rebuild(this.shape,this.end,this.start),r=new Zu(this.bo,s,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return ti.addAll(r.connect,this.connect),r}else return this;else if(t===1)if(this.start.y<this.end.y){let s=Zu.rebuild(this.shape,this.end,this.start),r=new Zu(this.bo,s,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return ti.addAll(r.connect,this.connect),r}else return this;return this}isNeedScan(t){return this.needCountWeight()&&this.confidence(t)>0}hashCode(){return this._hashcode}equals(t){return t instanceof Zu?!(this.polyGrp!==t.polyGrp||this.polyIndex!==t.polyIndex):!1}bbox(){return this._bbox}toString(){return th.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function X9(e,t){let s=e.bbox(),r=t.bbox(),i=(s.minY+s.maxY)/2,n=(r.minY+r.maxY)/2;return i-n}function Z9(e,t){let s=e.bbox(),r=t.bbox(),i=(s.minX+s.maxX)/2,n=(r.minX+r.maxX)/2;return i-n}var Wu=class{constructor(e){if(this.__bbox=null,typeof e<"u")if(e instanceof Array){this.__items=[];for(let t of e)this.add(t)}else this.__items=e,this.__bbox=e.bbox();else this.__items=[]}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=ei.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},wp=class{constructor(e){this.changed=!1,this.root=new Wu,this.capacity=e,this.capacity2=e*e,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(e){this.itemList.push(e),this.changed=!0}remove(e){ti.remove(this.itemList,e),this.changed=!0}clear(){this.changed=!1,this.root=new Wu,this.itemList.length=0}flushWhenNeed(){if(this.changed){let e=new Array;for(let t of this.itemList)e.push(new Wu(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break}this.root=new Wu(e),this.changed=!1}}organize(e){al(e,Z9,0,e.length);let t=e.length,s=[];for(let r=0;r<t;)if(r+this.capacity2<=t){let i=r+this.capacity2;al(e,X9,r,i);for(let n=r;n<i;n+=this.capacity){let a=new Wu(e.slice(n,n+this.capacity));s.push(a)}r=r+this.capacity*this.capacity}else{let i=new Wu(e.slice(r,r+this.capacity));s.push(i),r=r+this.capacity}return s}search(e){this.flushWhenNeed();let t=[],s=[];for(s.push(this.root);;){let r=s.shift();if(typeof r<"u"){let i=r.items();if(i instanceof Array){for(let n of i)if(!e.isSeparated(n.bbox())){let a=n.items();a instanceof Array?s.push(n):t.push(a)}}else e.isSeparated(r.bbox())||t.push(i)}else break}return t}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e)}_walker(e,t,s){this.flushWhenNeed();let r=e.items();if(r instanceof Array)for(let i of r)this._walker(i,t+1,s);else s(r,t)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};function nT(e,t){$9(e.iterator(),t)}function $9(e,t){let s=0;for(;e.hasNext();){let r=e.next();t(s++,r)}}var Oy=new Error("list is empty"),Iy=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},Q9=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},eF=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},sl=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Oy;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Oy;return this.remove(e),e.item}addLast(e){return this.first===null||this.last===null?(this.first=new Iy(this,e),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Iy(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Oy;return this.first.item}getLast(){if(this.last===null)throw Oy;return this.last.item}insertAfter(e,t){let s=new Iy(this,t);return e.insertAfter(s),e===this.last&&(this.last=s),this.cnt++,s}insertBefore(e,t){let s=new Iy(this,t);return e.insertBefore(s),e===this.first&&(this.first=s),this.cnt++,s}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new Q9(this.first)}listIterator(){return new eF(this.first)}toArray(){let e=new Array(this.cnt),t=this.first,s=0;for(;t!=null;)e[s]=t.item,t=t.next,s++;return e}};function aT(e){throw new Error("")}var xy=class{constructor(e,t){this.node1=null,this.node2=null,this.key=e,this.value=t}},tF=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},sF=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},Jy=class{constructor(){this.innerList=new sl,this.innerMap={}}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2)}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e]}put(e,t){let s=e.hashCode(),r=new xy(e,t),i=this.innerMap[s];if(i===void 0)return r.node1=this.innerList.add(r),this.innerMap[s]=r,null;if(i instanceof xy){if(i.key.equals(e))return this.innerMap[s]=r,this.replace(i,r),i.value;{r.node1=this.innerList.add(r);let n=new sl;return i.node2=n.add(i),r.node2=n.add(r),this.innerMap[s]=n,null}}if(i instanceof sl){let n=null;return nT(i,(a,o)=>o.key.equals(e)?(this.replace(o,r),n=o.value,!1):!0),n===null?(r.node1=this.innerList.add(r),r.node2=i.push(r),null):n}return aT(i)}get(e){let t=e.hashCode(),s=this.innerMap[t];if(s===void 0)return null;if(s instanceof xy)return s.key.equals(e)?s.value:null;if(s instanceof sl){let r=null;return nT(s,(i,n)=>n.key.equals(e)?(r=n.value,!1):!0),r}return aT(s)}containsKey(e){return this.get(e)!==null}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2)}remove(e){let t=e.hashCode(),s=this.innerMap[t];if(s===void 0)return null;if(s instanceof xy)return s.key.equals(e)?(this.delete(s),s.value):null;if(s instanceof sl){let r=null;return nT(s,(i,n)=>n.key.equals(e)?(r=n.value,this.delete(n),!1):!0),r}return aT(s)}computeIfAbsent(e,t){let s=this.get(e);if(s===null){let r=t(e);return this.put(e,r),r}else return s}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new tF(this.innerList.iterator())}values(){return new sF(this.innerList.iterator())}entries(){return this.innerList.iterator()}},nh=class{constructor(){this.innerMap=new Jy}add(e){return this.innerMap.put(e,!0)!==!0}remove(e){this.innerMap.remove(e)}contains(e){return this.innerMap.get(e)===!0}iterator(){return this.innerMap.keys()}addAll(e){let t=e.iterator();for(;t.hasNext();)this.add(t.next())}size(){return this.innerMap.size()}clear(){let e=this.iterator();for(;e.hasNext();){let t=e.next();this.remove(t)}}},tO=ti.funcCopy(al);function rF(e,t){let s=0;if(Math.abs(e.start.y-t)<=1e-4)te[s++]=e.start.x;else if(Math.abs(e.end.y-t)<=1e-4)te[s++]=e.end.x;else if(e.shape instanceof le)s=_9(e.shape,t);else if(e.shape instanceof we)s=A9(e.shape,t);else throw new Error("not supported operation");return s}var Uy=class{constructor(e,t,s,r){this.sides=new Array,this.loader=e,this.loader.bo=this,this.logger=s,this.rule=t,this.event=r}static sortByBBoxMinY(e,t){return e.bbox().minY-t.bbox().minY}static sortByBBoxAreaDesc(e,t){return t.bbox().area()-e.bbox().area()}addPolyline(e,t=1,s=.01,r=!0){for(let i of this.loader.buildGroup(e,t,s,r))this.sides.push(i),this.event.onOriginSide(i)}buildRTree(){let e=new wp(10);for(let t of this.sides)e.add(t);return e}fillValidSides(e,t,s){for(let r of t)isFinite(r.getX(s))&&e.push(r)}getSortedEndpointsLineAsc(e){let t=new Array;for(let i of e)i.needCountWeight()&&(t.push(i.start),t.push(i.end));tO(t,de.sortByYAsc,0,t.length);let s=new Array,r=Number.NEGATIVE_INFINITY;for(let i of t){let n=i.y;n>r&&(s.push(n),r=n)}return s}splitSides(e,t,s){let r=e.start,i=e.end,n=new de(i.x+(r.x-i.x)*2,i.y+(r.y-i.y)*2);tO(e.inters,(o,c)=>o.distance2(n)-c.distance2(n),0,e.inters.length);let a=null;for(let o of e.inters)if(a==null)o.equals(r)&&(a=o);else if(!o.equals(a)){let c=ah.rebuild(e.shape,a,o);c instanceof we&&Math.abs(c.sweepAngle)>190&&(c=new le(a,o));let l=new ah(this,c,e.baseWeight,a,o,e.polyGrp,s++);if(t.push(l),l.updateBbox(),o.equals(i))break;a=o}return s}splitSidesByInters(){let e=new Array;for(let t of this.sides)if(t.polyIndex==0){let s=0,r=null,i=null;do{let n=new Array;s=this.splitSides(t,n,s);for(let a of n)r!=null?(r.next=a,a.previous=r):i=a,r=a,this.event.onSplitedSide(a),e.push(a);if(t.next===null)throw new Error("not supported operation");t=t.next}while(t.polyIndex!==0);i!=null&&r!=null&&(i.previous=r,r.next=i)}this.sides.length=0;for(let t of e)this.sides.push(t)}seekIntersection(){if(this.sides.length>0){let e=this.buildRTree(),t=new nh;for(let s of this.sides){t.add(s);let r=s.bbox().extendOfSize(1e-5),i=s.shape instanceof le;for(let n of e.search(r))if(!t.contains(n)){let a=n.shape instanceof le;if(!(i&&a&&s.next!==null&&s.previous!==null&&(s.next.equals(n)||s.previous.equals(n)))){let o=bn(s.shape,n.shape);for(let c=0;c<o;c+=2){let l=new de(te[c],te[c+1]);s.inters.push(l),n.inters.push(l),this.event.onIntersect(l,s,n)}}}}}}},iF=class jO{constructor(t){this.sides=new nh,this.others=new nh,this.id=t}add(t){this.sides.add(t),t.finalGrp=this.id;for(let s of t.connect)this.others.add(s)}polyline(){let t=new Array;return ih(this.sides,(s,r)=>(t.push(r.shape),!0)),Tt.build2(t).asClose()}hashCode(){return this.id}equals(t){return t!=null&&t instanceof jO?this.id===t.id:!1}},FO=class{constructor(e){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=e}completeGroup(e){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new le(this.prevSide.end,this.firstSide.start),e);let t=new Array,s=null,r=null;for(let i of this.sides)(!this.noWeight0||i.weight!==0)&&(s!=null?(s.next=i,i.previous=s):r=i,s=i,t.push(i));return s!=null&&r!=null&&(r.previous=s,s.next=r),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,t}buildGroup(e,t,s,r=!0){for(let i of e.primitives)if(i instanceof le)this.addSide(i,t);else if(r&&i instanceof we&&i.rx===i.ry)this.addArc(i,t);else{let n=null;for(let a of i.points(s))n!=null&&this.addSide(new le(n,a),t),n=a}return this.completeGroup(t)}addArc(e,t){let s=e.sweepAngle,r=lt.regularD(e.startAngle),i=r+s;if(s>0){let n=90;for(;n<=i;)n>r&&(this.addSide(we.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n+=90;r<i&&this.addSide(we.build3(e.center,r,i-r,e.rx,e.ry),t)}else if(s<0){let n=270;for(;n>=i;)n<r&&(this.addSide(we.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n-=90;r>i&&this.addSide(we.build3(e.center,r,i-r,e.rx,e.ry),t)}}addSide(e,t){if(e.start().equals(e.end()))return;let s=e.start(),r;this.prevSide!=null?(this.prevSide.end.equals(s)||this.addSide(new le(this.prevSide.end,s),t),r=new ah(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++)):(r=new ah(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++),this.firstSide=r),this.prevSide=r,this.sides.push(r)}},UO=class{constructor(e,t,s){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=s,this.rule=e,this.bo=t,this.event=t.event}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e,this.start),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y))}out(e,t){if(this.onSameX(t,e))t.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&t.confidence(this.y)>0){let s=t.voteStatus(),r=e.voteStatus();this.isValid(s)&&this.isValid(r)?s==2&&r==1&&(e.connect.push(t),t.connect.push(e)):(e.connect.push(t),t.connect.push(e))}this.event.onSegment1(t,e,this.y),this.eps.push(t),this.eps.push(e),this.prevStart=t,this.prevEnd=e}this.start=null}isValid(e){return e==1||e==2}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&_e.eq(e.getX(this.y),t.getX(this.y))}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),s=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),s!=null&&e.weight===s.weight&&s.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y}},Ky=new Error,sO=new class extends Dp{decide1(e){return e[0]&&e[1]}}(2),nF=new class extends MO{onPolylineGroup(e,t){throw Ky}onSegment(e,t,s,r,i,n){throw Ky}},aF=class{constructor(e,t){this.rtree=e,this.level=t}},oF=class HO extends Uy{static isIntersect(t,s,r=r0.DUMMY){let i=new HO(r),n=i.createGroup1(t.items),a=i.createGroup2(s.items);return n.rtree.itemList.length==0||a.rtree.itemList.length==0?!1:i.isIntersect(n,a)}constructor(t){super(new FO(!1),sO.rule,t,nF)}createGroup1(t){return this.createGroup(t,0)}createGroup2(t){return this.createGroup(t,1)}createGroup(t,s){let r=sO.weight(s);for(let n of t)this.addPolyline(n,r);let i=this.buildRTree();return this.sides.length=0,new aF(i,s)}isIntersect(t,s){if(t.level!==s.level){let r=t.rtree.bbox().intersection1(s.rtree.bbox());if(r!==null){try{this.inters(t,s);let i=(r.minY+r.maxY)/2;this.sweep(t,s,i)}catch(i){if(i===Ky)return!0;throw i}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(t,s){if(t.rtree.size()>s.rtree.size()){let r=t;t=s,s=r}for(let r of t.rtree.items()){r.trans=NaN;let i=r.bbox().extendOfSize(1e-5);for(let n of s.rtree.search(i))if(n.trans=NaN,bn(r.shape,n.shape)>0)throw Ky}}sweep(t,s,r){let i=ei.extend2(t.rtree.bbox(),s.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,t.rtree.search(i),r),this.fillValidSides(n,s.rtree.search(i),r),al(n,(o,c)=>o.getX(r)-c.getX(r),0,n.length);let a=new UO(this.rule,this,r);for(let o of n)a.onEp(o)}},FT=class co{constructor(t){this.items=new Array(t.length),ti.arraycopy(t,0,this.items,0,t.length),this.__bbox=this.calcBBox()}static build1(t){let s=[];return Gy(t,(r,i)=>(s.push(i),!0)),new co(s)}static build2(t){let s=t.map(r=>Tt.build8(r));return new co(s)}static combinePolylineGroupArr(t){let s=[];for(let r of t)s=s.concat(r.items);return new co(s)}calcBBox(){let t=new Oi;for(let s=0;s<this.items.length;s++)t.ext1(this.items[s].bbox());return t.build1()}multiply3(t){let s=new Array(this.items.length);for(let r=0;r<s.length;r++)s[r]=this.items[r].multiply3(t);return new co(s)}bbox(){return this.__bbox}asClose(){return this.items.forEach(t=>t.asClose()),this}mirrorY(t){return this.items.forEach(s=>s.mirrorY(t)),this}closeEndpoint(){return this.items.forEach(t=>t.closeEndpoint()),this}get primitives(){return this.items.map(t=>t.primitives).flat(2)}isEqual(t){return t instanceof co?this.items.every(s=>t.items.some(r=>r.isEqual(s))):!1}getOutMostPolyline(){return this.items.reduce((t,s)=>s.bbox().area()>t.bbox().area()?s:t,this.items[0])}getOutline(){let t=this.items;if(t.length===1)return{outline:t,hole:new Array};let s=new Set,r=new Set;for(let i=0,n=t.length;i<n;i++){let a=t[i];if(!s.has(a)&&!r.has(a)){i+1>=n&&s.add(a);for(let o=i+1;o<n;o++){let c=t[o];if(!s.has(c)&&!r.has(c)){if(!a.bbox().isInside(c.bbox().extendOfSize(1e-4))&&!c.bbox().isInside(a.bbox().extendOfSize(1e-4)))continue;oF.isIntersect(new co([a]),new co([c]))&&(a.bbox().area()>c.bbox().area()?(s.add(a),r.add(c)):(s.add(c),r.add(a)))}}!s.has(a)&&!r.has(a)&&s.add(a)}}return{outline:[...s],hole:[...r]}}round(t=4){let s=this.items.map(r=>r.round(t));return new co(s)}},cF=ti.funcCopy(al),lF=ti.funcCopy(al),uF=ti.funcCopy(al);function hF(e){return new Array}function dF(e,t){let s=new yp(!1),r=new Ep(e,r0.DUMMY,s);for(let i of t)r.addPolyline(i);return r.simplify(),s.plGrps}var Ep=class extends Uy{constructor(e,t,s){super(new FO(!1),e,t,s),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(e,t,s){this.scanY=NaN,this.scanLines=0,cF(t,Uy.sortByBBoxMinY,0,t.length);let r=new sl;this.curNetIndex=0;let i=Number.POSITIVE_INFINITY;for(let n of e)n>i&&this.scan(r,(i+n)/2,t),i=n;this.getAllMarkPrimitive(s,t),this.logger.debug3("scan %s %d",s,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(e,t=1,s=.01,r=!0){super.addPolyline(e,t,s,r)}scan(e,t,s){if(this.scanY==t)return;this.scanY=t;let r=!1,i=e.listIterator();for(;i.hasNext();){let n=i.next(),a=n.item;_e.less(a.bbox().maxY,t)?e.remove(n):!r&&a.isNeedScan(t)&&(r=!0)}for(;this.curNetIndex<s.length;){let n=s[this.curNetIndex];if(_e.less(n.bbox().minY,t))_e.greatereq(n.bbox().maxY,t)&&(this.add2AET(e,n),!r&&n.isNeedScan(t)&&(r=!0)),this.curNetIndex++;else break}if(r){this.scanLines++;let n=new UO(this.rule,this,t),a=e.iterator();for(;a.hasNext();){let o=a.next();n.onEp(o)}}}add2AET(e,t){let s=t.bbox().minX,r=t.bbox().maxX,i=t.bbox().minY,n=t.bbox().maxY,a=e.listIterator(),o=null;for(;a.hasNext();){let c,l=a.next(),u=l.item,h=u.bbox().minX,p=u.bbox().maxX;if(r<=h)c=-1;else if(p<=s)c=1;else{let f=u.bbox().minY,m=u.bbox().maxY,g=Math.max(i,f),b=Math.min(n,m);c=this.compareBySweep(t,u,(g+b)/2)}let d=u.shape;if(d instanceof le&&d.length()<.001&&o==null&&c<0){o=l;continue}if(o!=null&&c<0){e.insertBefore(o,t);return}if(c<0){e.insertBefore(l,t);return}else o=null}e.add(t)}getLineAngle(e){let t=e.start().angle(e.end());return t<0&&(t+=Math.PI),t}getArcAngle(e,t){let s=Math.asin((t-e.center.y)/e.rx);return e.startAngle>90&&e.startAngle<270&&(s=-s),s<0&&(s+=Math.PI),(s+Math.PI/2)%Math.PI}compareArcLine(e,t,s){let r=this.getArcAngle(e,s),i=this.getLineAngle(t);return _e.eq(r,i)?-e.sweepAngle:i-r}compareBySweep(e,t,s){let r=e.getX(s);if(!isFinite(r))return 0;let i=t.getX(s);if(!isFinite(i))return 0;if(!_e.eq(r,i))return r-i;if(e.shape instanceof le)return t.shape instanceof le?this.getLineAngle(t.shape)-this.getLineAngle(e.shape):-this.compareArcLine(t.shape,e.shape,s);if(t.shape instanceof le)return this.compareArcLine(e.shape,t.shape,s);{let n=e.shape,a=t.shape,o=this.getArcAngle(n,s),c=this.getArcAngle(a,s);return _e.eq(o,c)?n.sweepAngle*a.sweepAngle<=0?n.sweepAngle<=0?1:-1:n.sweepAngle>0?n.rx-a.rx:a.rx-n.rx:c-o}}getAllMarkPrimitive(e,t){for(let s of t)if(s.status===0&&s.bbox().height()!=0){let r=s.voteStatus();if(r===2||r===1){s.status=r;let i=s.reverse(r);if(e){this.event.onResultSide(i);let n=i.shape.multiply3(Wt.ROT_N90),a=i.start.multiply3(Wt.ROT_N90),o=i.end.multiply3(Wt.ROT_N90);i=new ah(this,n,i.baseWeight,a,o,i.polyGrp,i.polyIndex)}this.finalSides.push(i),this.event.onResultSide(i)}}}flipSides(){for(let e of this.sides)if(e.polyIndex==0){let t=null,s=null;do{let r=e.shape.multiply3(Wt.ROT_90),i=e.start.multiply3(Wt.ROT_90),n=e.end.multiply3(Wt.ROT_90),a=new ah(this,r,e.baseWeight,i,n,e.polyGrp,e.polyIndex);if(a.outsideWeight=e.outsideWeight,a.insideWeight=e.insideWeight,a.invalidWeight=e.invalidWeight,a.status=e.status,t!=null?(t.next=a,a.previous=t):s=a,this.vecSides.push(a),this.event.onSplitedSide(a),t=a,e.next!==null)e=e.next;else break}while(e.polyIndex!=0);s!=null&&(s.previous=t,t.next=s)}}canBeEnd(e,t){if(e.size()==1){let s=e.getFirst().shape;if(s instanceof we){if(t&&s.rx<=t)return!1}else if(s instanceof le&&t&&s.length()<=t)return!1}return!0}connectSides(){let e=new Jy,t=new wp(10);for(let n of this.finalSides)e.computeIfAbsent(n.start,hF).push(n),t.add(n.start);let s=0,r=new nh,i=new Array;for(let n of this.finalSides)if(!r.contains(n)){let a=new nh,o=n.start,c=new sl;c.add(n),r.add(n);let l=n.end;for(;c.size()>0;)if(this.isStart(o,l)&&this.canBeEnd(c,.01)){c.size()>1&&this.fillSideGroups(c,s++);break}else{let u=e.get(l),h=this.findNext(r,u);if(h==null&&(l=this.findNeigber(l,a,t,.01),l!==null&&(u=e.get(l),h=this.findNext(r,u))),h!=null)c.add(h),r.add(h),l=h.end;else if(l!=null?a.add(l):(i.length==0&&c.size()>1&&this.logger.warning3("unable to connect at %s",c.getLast()),i.push(c.removeLast())),c.size()>0)l=c.getLast().end;else break}}}fillSideGroups(e,t){let s=new iF(t);ih(e,(r,i)=>(s.add(i),!0)),this.sideGroups[s.id]=s}isStart(e,t){return e.distance2(t)<=1e-4}findNext(e,t){if(t!=null){for(let s of t)if(!e.contains(s))return s}return null}fillResult(){let e=0,t=new Jy;for(let r in this.sideGroups){let i=this.sideGroups[r];ih(i.sides,(n,a)=>(a.polyGrp!=-2&&t.put(a,a),!0))}let s=new nh;for(let r in this.sideGroups){let i=this.sideGroups[r];if(s.add(i)){let n=0,a=new Array;for(a.push(i);n<a.length;){let c=a[n],l=new Array;ih(c.others,(h,p)=>{let d=t.get(p);return d!=null&&l.push(d.finalGrp),!0}),lF(l,ti.sortAsc,0,l.length);let u=c.id;for(let h of l)if(h!=u&&h!=c.id){let p=this.sideGroups[h];s.add(p)&&a.push(p),u=h}n++}let o=new Array;for(let c of a)o.push(c.polyline());uF(o,Uy.sortByBBoxAreaDesc,0,o.length),this.event.onPolylineGroup(new FT(o),e++)}}}findNeigber(e,t,s,r){let i=r*r,n=Number.MAX_VALUE,a=null;for(let o of s.search(e.bbox().extendOfSize(r)))if(!t.contains(o)){let c=e.distance2(o);c<n&&(n=c,a=o)}return n<i?a:null}},pF=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(e,t=!0){if(e instanceof le)this.lines.push(e);else if(e instanceof we)this.arcs.push(e);else if(e instanceof qe)this.beziers.push(e);else throw new Error("not support");t&&this.points.push(e.start())}addPoint(e){this.points.push(e)}addText(e,t,s=1,r=.1,i=!0){this.listText.push({pos:e,str:t,size:s,width:r}),i&&this.points.push(e)}addPly(e,t=!0){e.primitives.forEach(s=>this.addPt(s,t))}build(){let e=[],t=[],s=[],r=[],i=[],n=[];return this.points.forEach(a=>e.push(a.x,a.y)),this.lines.forEach(a=>t.push(a.start().x,a.start().y,a.end().x,a.end().y)),this.arcs.forEach(a=>s.push(a.center.x,a.center.y,a.rx,lt.toRadians(a.startAngle),lt.toRadians(a.endAngle()),a.sweep())),this.beziers.forEach(a=>{a.controls.forEach(o=>{r.push(o.x,o.y)}),r.push("end")}),this.listText.forEach(a=>i.push(a.pos.x,a.pos.y,a.str,a.width,a.size)),this.fonts.forEach(a=>n.push(a)),{points:e,lines:t,arcs:s,texts:i,beziers:r,fonts:n}}},oc,Pp=(oc=class{constructor(t){this.map=new Jy,this.bus=t}initColor(t){return this.map.computeIfAbsent(t,()=>new pF)}draw(){let t={},s=this.map.entries();for(;s.hasNext();){let r=s.next();t[r.key.toString()]=r.value.build()}this.bus.publish("/debug/draw",t)}clear(){this.map.clear()}static init(t){if(!t)throw new Error("bus is undefined!");this.palette=new oc(t)}static initPalette(t){this.palette=t}static getDefaultColor(){for(let t of this.colorBuffersMap)if(t[0]!==null&&t[0])return t[0]=!1,t[1];return this.colorBuffersMap.forEach(t=>{if(t[0]===null){console.log(1);return}t[0]=!0}),this.getDefaultColor()}static clear(){this.palette.clear()}static auto(t,s=this.getDefaultColor()){if(Array.isArray(t))t.forEach(r=>{this.auto(r,s)});else if(t instanceof de)this.point(t,s);else if(t instanceof ei)this.bbox(t,s);else if(t instanceof Cp)this.primitive(t,s);else if(t instanceof Tt)this.polyline(t,s);else if(t instanceof hr)this.polygon(t,s);else if(t instanceof Vs)this.group(t,s);else if(t instanceof FT)this.auto(t.items,s);else{debugger;throw new Error("No incoming type!")}}static text(t,s,r=.5,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");this.palette.initColor(i).addText(t,s,r,r/10),this.palette.draw()}static point(t,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(s);Array.isArray(t)?t.forEach(i=>{this.point(i,s)}):r.addPoint(t),this.palette.draw()}static bbox(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.bbox(r,s)}):(this.primitive(new le(new de(t.maxX,t.maxY),new de(t.maxX,t.minY)),s),this.primitive(new le(new de(t.maxX,t.maxY),new de(t.minX,t.maxY)),s),this.primitive(new le(new de(t.minX,t.minY),new de(t.maxX,t.minY)),s),this.primitive(new le(new de(t.minX,t.minY),new de(t.minX,t.maxY)),s))}static primitive(t,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(s);Array.isArray(t)?t.forEach(i=>{this.primitive(i,s)}):r.addPt(t),this.palette.draw()}static polyline(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polyline(r,s)}):t.primitives.forEach(r=>{this.primitive(r,s)})}static polygon(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polygon(r,s)}):t.items.forEach(r=>{this.polyline(r,s)})}static group(t,s=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.group(r,s)}):t.items.forEach(r=>{this.polygon(r,s)})}static async begin(){this.t1=performance.now()}static async end(t){console.log(t||"t1:",performance.now()-this.t1)}static async log(t){console.log(t||"==================")}},oc.colorBuffersMap=[[!0,Lt.BLUE],[!0,Lt.GREEN],[!0,Lt.WHITE],[!0,Lt.RED],[!0,Lt.Golden],[!0,Lt.Gray]],oc.t1=0,oc),fF=0,Op=class CT{constructor(t,s){this.inters=[],this.shape=t,this.start=t.start(),this.end=t.end(),this.judgeOverlapMap=new Map,s&&(this.id=fF++)}reverse(){this.shape=this.shape.reverse();let t=this.start;this.start=this.end,this.end=t}getCenterPoint(t=this.end){let{x:s,y:r}=this.start,{x:i,y:n}=t;if(this.shape instanceof we){let a=this.shape.rx,o=new de((s+i)/2,(r+n)/2),c=this.shape.center,l;return o.x!==c.x||o.y!==c.y?(l=o.angle(c),Math.abs(this.shape.sweepAngle)>180&&(l+=l>=0?-180:180)):l=(this.shape.startAngle+this.shape.endAngle())/2,new de(c.x+Math.cos(l)*a,c.y+Math.sin(l)*a)}else{if(this.shape instanceof le)return new de((s+i)/2,(r+n)/2);if(this.shape instanceof qe){let a=this.shape.getPercent(t,rt);return qe.pointOn(a/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(t,s,r){let i=t.cross(s)>0,n=Math.acos(Math.min(1,Math.max(-1,t.dot(s)/s.length())));return(r?!i:i)&&(n=i0-n),n}sortInters(){if(this.shape instanceof we){let t=this.shape.center,s=this.shape.start().sub(t).normalize(),r=this.shape.isCCW;this.inters.sort((i,n)=>{let a=i.coord.sub(t),o=n.coord.sub(t);return CT.finalAngle(s,a,r)-CT.finalAngle(s,o,r)<=0?-1:1})}else if(this.shape instanceof le){let t=this.start,s=this.end,r=new de(s.x+(t.x-s.x)*2,s.y+(t.y-s.y)*2);this.inters.sort((i,n)=>i.coord.distance2(r)-n.coord.distance2(r)<=0?-1:1)}else if(this.shape instanceof qe){let t=this.shape;this.inters.sort((s,r)=>t.getPercent(s.coord,rt)-t.getPercent(r.coord,rt)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((t,s)=>t.setIndex(s))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(t){this.nextSide=t,t.prevSide=this}static returnPolygonList(t){let s=[];return t.forEach(r=>{let i=[];r.forEach((n,a)=>{let o=[];n.forEach(c=>{o.push(c.shape)}),i.push(Tt.build7(o))}),s.push(new hr(i))}),s}addInter(t){this.inters.push(t)}static returnPolygonGroup(t){let s=[];return t.forEach(r=>{let i=[];r.forEach((n,a)=>{let o=[];n.forEach(c=>{o.push(c.shape)}),i.push(Tt.build7(o))}),s.push(new hr(i))}),new Vs(s)}static rebuild(t,s,r){let i;if(t instanceof le||s.distance2(r)<1e-6)i=new le(s,r);else if(t instanceof we)i=we.build2(t.center,s.angleD(t.center),r.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);else if(t instanceof qe){let n=t.getPercent(s,rt),a=t.clip(n)[1];i=a.clip(a.getPercent(r,rt))[0]}else throw new Error("not supported operation");return st(t,s).dot(st(i,s))<0?null:i}static returnPolyline(t){return Tt.build7(t.map(s=>s.shape))}bbox(){return this.shape.bbox()}},mF=(e=>(e[e.END1=0]="END1",e[e.END2=1]="END2",e[e.END12=2]="END12",e[e.LEFT1=3]="LEFT1",e[e.LEFT2=4]="LEFT2",e))(mF||{});function si(e,t,s){if(e instanceof we&&t instanceof we)return EF(e,t);if(e instanceof we&&t instanceof le)return nO(e,t);if(e instanceof le&&t instanceof we)return iO(e,t);if(e instanceof le&&t instanceof le)return rl(e,t);if(e instanceof qe&&t instanceof le)return e.controls.length===2||fo(e)?rl(new le(e.start(),e.end()),t):GO(e,t);if(e instanceof le&&t instanceof qe)return t.controls.length===2||fo(t)?rl(e,new le(t.start(),t.end())):DT(e,t);if(e instanceof we&&t instanceof qe)return t.controls.length===2||fo(t)?nO(e,new le(t.start(),t.end())):gF(e,t);if(e instanceof qe&&t instanceof we)return e.controls.length===2||fo(e)?iO(new le(e.start(),e.end()),t):yF(e,t);if(e instanceof qe&&t instanceof qe)return UT(e,t);throw new Error("not support")}function qu(e,t){return st(e,t.start()).dot(st(t,t.start()))<=0?!1:si(e,t).state<=2}function oT(e,t){let s=t.getPercent(e.end(),rt);if(s===null)return!1;if(s===0)return!0;let r=t.clip(s)[0],i=e.buildConverxHull(rt),n=r.buildConverxHull(rt),a=l(i),o=l(n);return c(a,o);function c(u,h){let p=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),d=u[0],f=h[0];if(!d||!f)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let m=!0;do{let g=d.getShape(),b=f.getShape();if(g instanceof le&&b instanceof le){let E=m?rl(g,b).state:p.get(rl(b,g).state);if(E===0)d=d.nextSide,m=!1;else if(E===1)f=f.nextSide,m=!0;else if(E===2)d=d.nextSide,f=f.nextSide,m=!0;else return!1}else throw Error("not support")}while(d!==u[0].prevSide&&f!==h[0].prevSide);return!0}function l(u){let h=u.primitives.map(d=>new Op(d)),p=h[h.length-1];return h.forEach(d=>{p.connect(d),p=d}),h}}function rO(e,t){let s=e.end().distance2(t.center);if(s>(t.rx+rt)**2||s<(t.rx-rt)**2||!($e(e.end(),t.end())||HT(t,e.end())))return!1;if(e.center.equals1(t.center))return!0;let r=e.center.distance1(t.center),i=Math.abs(e.rx-t.rx);if(r>Math.min(e.rx,t.rx)){let n=e.center.angleD(t.center);return e.rx>t.rx?!(r+i>rt&&Sa(e,n))&&!(r-i>rt&&e.rx+t.rx-r>rt&&Sa(e,n+180)):!(r-i>rt&&Sa(e,n))&&!(e.rx+t.rx-r>rt&&Sa(e,n+180))}else{if(r+i<=rt)return!0;let n=e.rx>t.rx?e.center.angleD(t.center):t.center.angleD(e.center);return Sa(e,n)?!1:r-i<=rt?!0:!Sa(e,n+180)}}function gF(e,t){let s=GT(e,t.start()).toBezier2(),r,i=0;for(let n=s.length;i<n;i++){let a=s[i];if(r=UT(a,t).state,r!==0)break}return r===2&&i!==s.length-1?{state:1}:{state:r}}function yF(e,t){let s=t.toBezier2(),r,i=0;for(let n=s.length;i<n;i++){let a=s[i];if(r=UT(e,a).state,r!==1)break}return r===2&&i!==s.length-1?{state:0}:{state:r}}function UT(e,t){if(e.controls.length===2||fo(e))return t.controls.length===2||fo(t)?rl(new le(e.start(),t.end()),new le(t.start(),t.end())):DT(new le(t.start(),e.end()),t);if(t.controls.length===2||fo(t))return GO(PT(e,t.start()),new le(t.start(),t.end()));let s=PT(e,t.start());if(fo(s))return DT(new le(t.start(),e.end()),t);let r=oT(s,t),i=oT(t,s);if(!r&&!i){let n=N9(s,t);if(n.havOverlap){let a=n.havOverlap!==2,o=n.havOverlap!==1;return Eo(e,t,a,o)}else{let a=function(){for(let h=0;h<l;h+=2)te[h]=u[h],te[h+1]=u[h+1]},o,c,l=n.cnt,u=new Array(l).fill(0).map((h,p)=>te[p]);for(let h=0;h<l;h+=2){let p=new de(te[h],te[h+1]),d=s.getPercent(p,rt),f=t.getPercent(p,rt);if(d===0||f===0)continue;let m=d===1?s:s.clip(d)[0],g=f===1?t:t.clip(f)[0];if(oT(m,g)){let b=st(e,p).cross(st(t,p));if(b===0){o=s.end(),c=t.end();break}return{state:b<0?3:4}}a()}return(!o||!c)&&(o=sh(s.controls,s.controls[0],t),c=sh(t.controls,s.controls[0],s)),{state:o.sub(s.controls[0]).cross(c.sub(s.controls[0]))>0?4:3}}}return Eo(e,t,r,i)}function GO(e,t){let s=PT(e,t.start());if(fo(s))return rl(new le(s.start(),s.end()),t);let r=VO(s,t),{isIn:i,bezierIsInLeft:n}=YO(t,s);if(!r&&!i){if(n!==void 0)return{state:n?3:4};let a=null,o=e.getPercent(t.start(),rt)+.01;for(let c=o>1?1:o;c<=1;){let l=qe.pointOn(c,e.controls);if(Sp(t,l)>ri){a=l;break}c+=.01,c>1&&(c=1)}if(!a)throw Error("!end1 && !end2 not result");return{state:t.direct.cross(a.sub(t.start()))<0?4:3}}return Eo(s,t,r,i)}function DT(e,t){let{isIn:s,bezierIsInLeft:r}=YO(e,t),i=VO(t,e);if(!s&&!i){if(r!==void 0)return{state:r?4:3};let n=null;for(let a=.01;a<=1;){let o=qe.pointOn(a,t.controls);if(Sp(e,o)>ri){n=o;break}a+=.01,a>1&&(a=1)}if(!n)throw Error("!end1 && !end2 not result");return{state:e.direct.cross(n.sub(e.start()))<0?3:4}}return Eo(t,e,s,i)}function EF(e,t){let s=rO(GT(e,t.start()),t),r=rO(t,e);if(!s&&!r){let i=Wn(t);if(e.center.sub(t.start()).dot(t.center.sub(t.start()))>0){if(e.rx===t.rx)return e.isCCW?{state:i.dot(e.center.sub(t.center))<0?3:4,exitIsInvalid:!1}:{state:i.dot(e.center.sub(t.center))>0?3:4,exitIsInvalid:!1};let n,a;return e.rx>t.rx?(n=e,a=t):(n=t,a=e),i.dot(a.center.sub(n.center))>0&&a.rx+a.center.distance1(n.center)-n.rx>rt?e.isCCW?{state:e.rx>t.rx?3:4,exitIsInvalid:!1}:{state:e.rx<t.rx?3:4,exitIsInvalid:!1}:e.isCCW?{state:e.rx<t.rx?3:4,exitIsInvalid:!0}:{state:e.rx>t.rx?3:4,exitIsInvalid:!0}}else return e.rx+t.rx-e.center.distance1(t.center)>rt&&i.dot(e.center.sub(t.center))>0?{state:t.isCCW?3:4,exitIsInvalid:!1}:{state:e.isCCW?3:4,exitIsInvalid:!0}}return Eo(e,t,s,r)}function iO(e,t){let s=zn.foot(e,t.center),r=e.end().distance2(t.center),i=e.end().sub(e.start()),n=(t.rx-rt)**2,a=r<=(t.rx+rt)**2&&r>=n&&(i.dot(s.sub(t.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(s)||s.distance2(t.center)>=n)&&($e(e.end(),t.end())||HT(t,e.end())),o=zO(t,e);if(!a&&!o){let c=e.distance2(t.center);return c<=ri?{state:i.cross(Wn(t))>0?4:3}:i.dot(s.sub(t.start()))>=0&&(r<n||e.start().distance2(t.center)<n||c<n)?{state:i.cross(t.center.sub(e.start()))<0?4:3}:{state:i.cross(t.center.sub(e.start()))>0?4:3}}return Eo(t,e,a,o)}function Sa(e,t){return t=lt.regularD(t),e.sweepAngle>0?(t<e.startAngle&&(t+=360),e.endAngle()>t):(t>e.startAngle&&(t-=360),e.endAngle()<t)}function HT(e,t){return $e(e.end(),t)||$e(e.start(),t)||Sa(e,t.angleD(e.center))}function YO(e,t){let s=e.panDistance(rt),r=e.panDistance(-rt),i=aO(t,s),n=aO(t,r);if(!i.length&&!n.length)return{isIn:t.getPercent(e.end(),rt)!==null};let a=[...i,...n].sort((u,h)=>u.t-h.t),o=new le(r.start(),s.start()),c=[];for(let u=0,h=a.length;u<h;u++){let p=a[u];if(c.push(p),o.distance(p.interP)>e.length()+rt)break;if(c.length===2){let d=(c[1].t*10+c.shift().t*10)/20,f=qe.pointOn(d,t.controls);if(e.distance2(f)>ri)return{isIn:!1,bezierIsInLeft:e.direct.cross(f.sub(e.start()))>0}}}let l=c.length?o.distance(c[0].interP)>=e.length()+rt:!0;return{isIn:l,bezierIsInLeft:l?void 0:e.direct.cross(c[0].interP.sub(e.start()))>0}}function VO(e,t){if(Sp(t,e.end())>ri||e.getToLineMaxDis2(t)>ri)return!1;let s=TF(t,ri);return e.getToLineMaxDis2(s)<=(t.length()+rt)**2}function zO(e,t){let s=t.end().angleD(t.start()),r=bF(t,e.end());if(r>ri)return!1;if(Sa(e,s+90)){if(zn.foot(t,e.center).distance1(e.pointOn(s+90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}if(Sa(e,s-90)){if(zn.foot(t,e.center).distance1(e.pointOn(s-90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}return r<=ri&&($e(e.end(),t.end())||OT(t,e.end()))}var WO=(rt*2)**2;function GT(e,t){if($e(e.end(),t))return we.build3(e.center,e.endAngle(),0,e.rx,e.ry);if(e.start().distance2(t)<WO)return e;let s=lt.regularD(t.angleD(e.center));if(!Sa(e,s))throw new Error("!angleIsInArc(arc, angle)");return we.build2(e.center,s,e.endAngle(),e.rx,e.ry,e.isCCW?1:0)}function PT(e,t){if($e(e.end(),t))return new qe([t,t]);if(e.start().distance2(t)<WO)return e;let s=e.getPercent(t,rt);if(s===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return e.clip(s)[1]}function nO(e,t){let s=zO(GT(e,t.start()),t),r=t.end().distance2(e.center),i=t.end().sub(t.start()),n=zn.foot(t,e.center),a=(e.rx-rt)**2,o=r<=(e.rx+rt)**2&&r>=a&&(i.dot(n.sub(t.start()))<=0||t.start().distance2(t.end())<=t.start().distance2(n)||n.distance2(e.center)>=a)&&($e(e.end(),t.end())||HT(e,t.end()));if(!s&&!o){let c=t.distance2(e.center);return c<=ri?{state:i.cross(Wn(e,t.start().angle(e.center)))>0?3:4}:i.dot(n.sub(t.start()))>=0&&(r<a||t.start().distance2(e.center)<a||c<a)?{state:i.cross(e.center.sub(t.start()))>0?4:3}:{state:i.cross(e.center.sub(t.start()))<0?4:3}}return Eo(t,e,s,o)}function rl(e,t){if($e(e.end(),t.end()))return Eo(e,t,!0,!0);let s=Sp(t,e.end())<=ri&&OT(t,e.end()),r=Sp(e,t.end())<=ri&&OT(e,t.end());if(!s&&!r){let i=e.direct.x===0&&e.direct.y===0,n=t.direct.x===0&&t.direct.y===0;if(i&&n)throw Error("2LineAllIsPoint");return i?{state:t.direct.cross(e.end().sub(t.start()))>0?3:4}:{state:e.end().sub(e.start()).cross(t.end().sub(e.start()))>0?4:3}}return Eo(e,t,s,r)}function OT(e,t){return zn.foot(e,t).distance2(e.start())<e.end().distance2(e.start())}function Eo(e,t,s,r){if(s)return r?$e(e.end(),t.end())?{state:2}:{state:0}:{state:0};if(r)return{state:1};throw new Error("!end1 && !end2")}function Sp(e,t){return(e.a*t.x+e.b*t.y+e.c)**2/(e.a**2+e.b**2)}function bF(e,t){return Math.min(e.distance2(t),zn.foot(e,t).distance2(t))}function TF(e,t){let s=e.panDistance(t),r=e.panDistance(-t);return new le(r.start(),s.start())}function fo(e){let t=e.start(),s=e.end();t.equals1(s)&&(s=t.add1(1,0));let r=s.y-t.y,i=t.x-s.x,n=-r*t.x-i*t.y,a=Math.sqrt(1/(r**2+i**2));r*=a,i*=a,n*=a;let o=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return e.controls.forEach(l=>{let u=r*l.x+i*l.y+n;u<o&&(o=u),u>c&&(c=u)}),Pa(o,c)}function aO(e,t){let s=bn(e,t),r=[],i=new Array(s).fill(0).map((a,o)=>te[o]);for(let a=0;a<s;a+=2){let o=new de(te[a],te[a+1]),c=e.getPercent(o);r.push({interP:o,t:c}),n()}function n(){for(let a=0;a<s;a+=2)te[a]=i[a],te[a+1]=i[a+1]}return r}var wa=.01,wF=270;function cc(e){let t=wa**2,s=e.end(),r=[],i=[];for(let d=0,f=e.primitives.length;d<f;d++){let m=function(D,I){return D instanceof le&&I instanceof le&&Math.abs(D.direct.cross(I.direct))<_e.eps&&D.direct.dot(I.direct)>0||D instanceof we&&I instanceof we&&Math.abs(D.rx-I.rx)<=_e.eps&&D.center.distance2(I.center)<_e.eps&&D.isCCW===I.isCCW},g=function(D){if(Qi(D,wa))i.push(null);else{if(D instanceof le)i.push(D);else if(D instanceof we&&D.rx===D.ry)h(D,i);else if(D instanceof qe){let I=[];LO(D,I),I.forEach(P=>{let L=P.start(),F=P.end();u(L,F)||i.push(P)})}else throw new Error("not support!");s=T}},b=function(D){if(D instanceof le)return D.direct.x===0&&D.direct.y===0;if(D instanceof we)return D.sweepAngle===0;if(D instanceof qe){let I=new Set(D.controls.map(L=>L.x)),P=new Set(D.controls.map(L=>L.y));return I.size===1&&P.size===1}else throw new Error("not support")},E=e.primitives[d],y=E.start(),T=E.end();if(b(E))continue;u(s,y)||(i.push(new le(s,y)),s=y);let w=(d+1)%f,S=e.primitives[w];for(;m(E,S)&&(w=(w+1)%f,S=e.primitives[w],S!==E););if(w===(d+1)%f){g(E);continue}if(S===E){if(!(E instanceof we)){if(Math.abs(e.area(.1))<t)return null;throw new Error("simplifyPolyline not support")}let D=E instanceof we?E.isCCW:e.area(.1)>0;i.length=0;let I=D?180:-180;i.push(we.build3(E.center,E.startAngle,I,E.rx,E.ry),we.build3(E.center,E.startAngle+I,I,E.rx,E.ry));break}let _=(()=>{if(E instanceof le)return(D,I)=>{let P=new le(D,I);return Qi(P,wa)?null:[P]};if(E instanceof we)return(D,I)=>{let P;if(D.equals1(I)?P=we.build3(E.center,E.startAngle,E.sweep()===1?360:-360,E.rx,E.ry):P=we.build4(D,I,E.center,E.rx,E.ry,E.sweep()),Qi(P,wa))return null;let L=P.pointOn(P.startAngle+P.sweepAngle/2),F=we.build4(P.start(),L,E.center,E.rx,E.ry,E.sweep()),V=we.build4(L,P.end(),E.center,E.rx,E.ry,E.sweep());return Qi(F,wa)||Qi(V,wa)?[P]:[F,V]};throw new Error("not support")})(),C=w===0;if(w<d&&!C&&(C=!_(e.primitives[0].start(),e.primitives[w-1].end()),!C)){let D=_(E.start(),e.primitives[f-1].end());if(D)i.push(...D);else{let I=_(E.start(),i[0].end());if(I.length===1)i[0]=I[0];else if(I.length===2)i[0]=I[1],i.push(I[0]);else throw new Error("!!!generatorPt")}break}d=w===0?f-1:w-1,S=e.primitives[d];let x=_(E.start(),S.end());if(x?(x.forEach(D=>i.push(D)),s=S.end()):g(null),C)break}let n=i.length;if(i.forEach((d,f)=>{if(d)r.push(d);else{let m,g;f===n-1&&(m=r[0],g=r[r.length-1]);let b=(f+1)%n;if(m=m!=null?m:i[b],m){let E=f,y=!1;for(;g=g!=null?g:i[(--E+n)%n],g!==m;)if(g){y=!0;break}if(y){if(m.start().equals1(g.end()))return;if(st(g,g.end()).dot(st(m,m.start()))<0){if(!u(g.end(),m.start())){let _=new le(g.end(),m.start());r.push(_);return}let{rebuildPrevPt:T,rebuildNextPt:w,rebuildLinkLine:S}=oO(i[(E-1+n)%n],g,new le(g.end(),m.start()),m,i[(f+2)%n]);T&&w&&(T!==g?(i[(E+n)%n]=T,r[r.length-1]&&(r[r.length-1]=T)):w!==m&&(i[(f+1)%n]=w,r[0]===m&&(r[0]=w)),S&&r.push(S))}}}}}),r.length===0)return null;u(s,r[0].start())||r.push(new le(s,r[0].start()));let a=r[r.length-1];if(r.length===1)return a instanceof we?Tt.build7([we.build2(a.center,0,180,a.rx,a.ry,a.sweep()),we.build2(a.center,180,360,a.rx,a.ry,a.sweep())]):a instanceof qe?Tt.build7(a.clip(.5)):null;let o=r.map(d=>new SF(d)),c=o[o.length-1];for(o.forEach(d=>{d.connect(c),c=d});!c.isVisited;){let d=function(){c.next.connect(m),c=c.next,c.isConnected=!1,c.isVisited=!1},f=function(){c.connect(m.prev),c.isConnected=!1},m=c.prev;if(c===m)break;let g=c.pt,b=m.pt,E=b.end();if(!c.isConnected&&!E.equals(g.start())){let y=function(w){c.isConnected=!0,c.pt=g=w,c.next.isVisited=!1},T=function(w){c.isConnected=!0,m.pt=w,m.isVisited=!1,c=m};if(g instanceof le)if(u(E,g.end())){d();continue}else y(new le(E,g.end()));else if(b instanceof le){u(b.start(),g.start())?f():T(new le(b.start(),g.start()));continue}else if(g instanceof qe)if(u(E,g.end())&&!(g.controls.length!==2&&g.getToLineMaxDis2(g.startToEndL)>=t)){d();continue}else y(new qe([E,...g.controls.slice(1)]));else if(b instanceof qe)u(b.start(),g.start())&&!(b.controls.length!==2&&b.getToLineMaxDis2(b.startToEndL)>=t)?f():T(new qe([...b.controls.slice(0,-1),g.start()]));else if(g instanceof we&&b instanceof we)if(Math.abs(Math.abs(g.sweepAngle)-180)<Math.abs(Math.abs(b.sweepAngle)-180)){let w=we.build5(E,g.end(),g.sweepAngle);if(u(w.start(),w.end())&&!(w.rx>=wa&&Math.abs(w.sweepAngle)>180)){d();continue}else y(w)}else{let w=we.build5(b.start(),g.start(),b.sweepAngle);u(w.start(),w.end())&&!(w.rx>=wa&&Math.abs(w.sweepAngle)>180)?f():T(w);continue}else throw new Error("not support")}if(st(g,g.start()).dot(st(b,b.end()))<0){let y=function(S,_,C,x,D,I){if(c.next===m){c=null;return}let{rebuildLinkLine:P,rebuildPrevPt:L,rebuildNextPt:F}=oO(S,_,C,x,D);L&&F&&(L!==_&&(m.prev.pt=L),F!==x&&(c.next.pt=F),P?I.pt=P:d())},T=function(){c.next===m?c=null:(c.next.connect(m.prev),c=c.next,c.isConnected=!1,c.isVisited=!1)},w=si(b.reverse(),g).state;if(w===0){let S=cO(g,b.start(),g.end());if(p(S)){let _=m.prev.pt,C=c.next.pt;if(st(C,C.start()).dot(st(_,_.end()))>=0){if(T(),!c)break;continue}if(y(m.prev.prev.pt,_,S instanceof le?S:new le(S.start(),S.end()),C,c.next.next.pt,c),!c)break}else c.pt=S;f();continue}else if(w===1){let S=cO(b,b.start(),g.end());if(p(S)){let _=m.prev.pt,C=c.next.pt;if(st(C,C.start()).dot(st(_,_.end()))>=0){if(T(),!c)break;continue}if(y(m.prev.prev.pt,_,S instanceof le?S:new le(S.start(),S.end()),C,c.next.next.pt,m),!c)break}else m.pt=S;d();continue}else if(w===2){if(T(),!c)break;continue}}c.isVisited=!0,c=c.next}if(!c)return null;r.length=0;let l=c;for(r.push(c.pt),c=c.next;c!==l;)r.push(c.pt),c=c.next;if(r.length===1){let d=r[0];return d instanceof we?(u(d.start(),d.end())?r[0]=we.buildCircle(d.center,d.rx,d.sweep()):r.push(new le(d.end(),d.start())),Tt.build7(r)):d instanceof qe?(u(d.start(),d.end())||r.push(new le(d.end(),d.start())),Tt.build7(r)):null}if(e=Tt.build7(r),Math.abs(e.area(.1))<t)return null;return e;function u(d,f){return d.distance2(f)<t}function h(d,f){if(Math.abs(d.sweepAngle)>wF){let m=d.sweepAngle/2;h(we.build3(d.center,d.startAngle,m,d.rx,d.ry),f),h(we.build3(d.center,d.startAngle+m,m,d.rx,d.ry),f)}else f.push(d)}function p(d){return d.start().distance2(d.end())<t&&!(d instanceof we&&d.rx>=wa&&Math.abs(d.sweepAngle)>180||d instanceof qe&&d.controls.length!==2&&d.getToLineMaxDis2(new le(d.start().add1(1,0),d.end()))>=t)}}function Qi(e,t){if(!e)return!0;let s=e.start(),r=e.end();if(s.distance2(r)<t**2)if(e instanceof we){if(!(e.rx>=t&&Math.abs(e.sweepAngle)>180))return!0}else if(e instanceof qe){if(!(e.controls.length!==2&&e.getToLineMaxDis2(new le(e.start().add1(1,0),e.end()))>=t))return!0}else return!0;return!1}function Ju(e){if(e.direct.x===0&&e.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let t=Math.abs(wa-e.length())+_e.eps,s={x:e.direct.normalize().x*t,y:e.direct.normalize().y*t},r=e.end();return new de(r.x+s.x,r.y+s.y)}function oO(e,t,s,r,i){if(!e)a();else if(!i)o();else{let c=st(e,e.end()),l=st(t,e.end()),u=c.dot(l);if(u>=0)a();else{let h=st(r,r.end()),p=st(i,r.end()),d=h.dot(p);if(d>=0)o();else if(Pa(u,-1)&&Pa(d,-1)){let f=s.center();n(f),s=null}else u>d?a():o()}}function n(c){let l;if(t instanceof le)l=new le(t.start(),c);else if(t instanceof qe)l=new qe([...t.controls.slice(0,-1),c]);else if(t instanceof we)l=we.build5(t.start(),c,t.sweepAngle);else throw new Error("not supported");t=Qi(l,rt)?null:l;let u;if(r instanceof le)u=new le(c,r.end());else if(r instanceof qe)u=new qe([c,...r.controls.slice(1)]);else if(r instanceof we)u=we.build5(c,r.end(),r.sweepAngle);else throw new Error("supported");r=Qi(u,rt)?null:u}function a(){if(t instanceof le){let c=Ju(s.reverse());s=new le(c,s.end());let l=new le(t.start(),c);t=Qi(l,rt)?null:l}else if(t instanceof qe){let c=Ju(s.reverse());s=new le(c,s.end());let l=new qe([...t.controls.slice(0,-1),c]);t=Qi(l,rt)?null:l}else if(t instanceof we){let c=Ju(s.reverse());s=new le(c,s.end());let l=we.build5(t.start(),c,t.sweepAngle);t=Qi(l,rt)?null:l}else throw new Error("not supported")}function o(){if(r instanceof le){let c=Ju(s);s=new le(s.start(),c);let l=new le(c,r.end());r=Qi(l,rt)?null:l}else if(r instanceof qe){let c=Ju(s);s=new le(s.start(),c);let l=new qe([c,...r.controls.slice(1)]);r=Qi(l,rt)?null:l}else if(r instanceof we){let c=Ju(s);s=new le(s.start(),c);let l=we.build5(c,r.end(),r.sweepAngle);r=Qi(l,rt)?null:l}else throw new Error("not supported")}return{rebuildPrevPt:t,rebuildNextPt:r,rebuildLinkLine:s}}function cO(e,t,s){if(e instanceof le||t.distance2(s)<=ri)return new le(t,s);if(e instanceof we)return we.build2(e.center,t.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof qe){let r=e.getPercent(t,rt),i=e.getPercent(s,rt);return e.clip(r)[1].clip((i-r)/(1-r))[0]}else throw new Error("not supported operation")}var SF=class{constructor(e){this.pt=e}connect(e){this.prev=e,e.next=this}};function Xy(e){let t=Ip(),s;if(e instanceof Tt){let r=cc(e);if(r===null)return null;s=r}else if(e instanceof hr){let r=e.items.map(i=>Xy(i)).filter(i=>i!==null);if(r.length===0)return null;s=new hr(r)}else{let r=e.items.map(i=>Xy(i)).filter(i=>i!==null);if(r.length===0)return null;s=new Vs(r)}return Ca.preprocessPolyline+=nc(t),s}var Ca={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function Ip(){return{timeIndex:Object.assign({},Ca),start:performance.now()}}function lO(e){return Object.values(e).reduce((t,s)=>t+s,0)}function nc(e){return performance.now()-e.start-(lO(Ca)-lO(e.timeIndex))}function br(e,t,s,r){let i=Lt.RED,n=Lt.Golden;function a(){if(!r)return;let p=r.initColor(Lt.Golden);p.addPt(o),p.addPoint(o.end()),r.initColor(Lt.RED).addPt(c),r.draw();debugger}let o=e.getShape(),c=s?t.getShape():t.getShape().reverse(),l=st(o,c.start()),u=st(c),h=l.cross(u);if(Pa(h,0))if(o instanceof le)if(c instanceof le){if(_e.eq(h,0)&&(l.dot(u)>0?!$e(o.end(),c.start()):!$e(o.start(),c.start())))throw a(),new Error("line and line");return h<0}else{if(c instanceof we)return l.cross(c.center.sub(o.start()))<0;if(c instanceof qe){let p=c.getExtremePoints(o),d=p.length?p[0]:sh(c.controls,o.start());return l.cross(d.sub(o.start()))<0}else throw new Error("not support")}else if(o instanceof we){if(c instanceof le)return o.isCCW;if(c instanceof we){if(c.center.equals1(o.center)&&(l.dot(u)>0?!$e(o.end(),c.start())&&o.end().sub(c.start()).dot(u)>0:!$e(o.start(),c.start())&&o.start().sub(c.start()).dot(u)>0))throw a(),new Error("arc and arc");return c.rx>=o.rx||c.center.distance2(o.center)>o.rx2?o.isCCW:!o.isCCW}else throw new Error("not support")}else if(o instanceof qe)if(c instanceof le){let p=o.getPercent(c.start(),rt),d=o.clip(p)[1],f=d.getExtremePoints(c);return(f.length?f[0]:sh(d.controls,c.start())).sub(c.start()).cross(u)<0}else if(c instanceof qe){let p=o.getPercent(c.start(),rt),d=o.clip(p)[1],f=d.getExtremePoints(new le(c.start(),c.end())),m=c.getExtremePoints(new le(d.start(),d.end())),g=f.length?f[0]:sh(d.controls,c.start()),b=m.length?m[0]:sh(c.controls,c.start()),E=g.sub(c.start()),y=b.sub(c.start());return E.cross(y)<0}else throw Error("not support");else throw new Error("not support");else return h<0}function ol(e,t,s,r,i){let n=e.getShape(),a=t.getShape(),o=n instanceof we?Wn(n,lt.toRadians(n.endAngle())):n instanceof qe?Tp(n,1):n.end().sub(n.start()).normalize(),c=st(a),l=o.dot(c);if(Pa(l,-1))return br(e,t,!0,i)?br(e,s,r,i)&&br(t,s,r,i):br(e,s,r,i)||br(t,s,r,i);{let u=o.scale(-1).angle(de.ORIGIN),h=c.angle(de.ORIGIN);u>h&&(u-=i0);let p=(u+h)/2,d=new de(Math.cos(p),Math.sin(p)),f=r?s.getShape():s.getShape().reverse(),m=st(f);return d.cross(m)<0?br(e,s,r,i):br(t,s,r,i)}}function cT(e,t,s,r,i){let n=e.getShape(),a=t.getShape(),o=n instanceof we?Wn(n,lt.toRadians(n.endAngle())):n instanceof qe?Tp(n,1):n.end().sub(n.start()).normalize(),c=st(a),l=o.dot(c);if(Pa(l,-1))return br(e,t,!0,i)?br(e,s,r,i)&&br(t,s,r,i):br(e,s,r,i)||br(t,s,r,i);{let u=o.scale(-1).angle(de.ORIGIN),h=c.angle(de.ORIGIN);u>h&&(u-=i0);let p=(u+h)/2,d=new de(Math.cos(p),Math.sin(p)),f=r?s.getShape():s.getShape().reverse(),m=st(f);if(d.cross(m)<0){let g=o.dot(m)<0,b=si(g?e.getShape().reverse():e.getShape(),f).state;return b!==3&&b!==4?br(e,s,r,i):b===(g?4:3)}else{let g=c.dot(m)<0,b=si(g?t.getShape().reverse():t.getShape(),f).state;return b!==3&&b!==4?br(t,s,r,i):b===(g?4:3)}}}var _F=(e=>(e[e.NOT_IN=0]="NOT_IN",e[e.IS_IN=1]="IS_IN",e[e.IS_OVERLAP=2]="IS_OVERLAP",e))(_F||{}),AF=(e=>(e[e.AllClear=0]="AllClear",e[e.MapClear=1]="MapClear",e))(AF||{}),_a,ac=!1;function en(e,t,s,r,i,n,a,o=s.side===t,c=!0,l){return _a=i,ac=n,qO(JO(e,t,c,l,a,s,o,r),s,o,r,0)}function lo(e,t,s,r,i,n,a,o=r.side===s){_a=i,ac=n;let c=KO(e,t,s,new Map,r,o,a),l=c instanceof Array?-1:1;return qO(c,r,o,a,l)}function qO(e,t,s,r,i){for(;e instanceof Array;)i++,e.length===4?e=KO(...e,t,s,r):e=JO(...e,t,s,r);return{...e,existOverlap:i>0}}function JO(e,t,s,r,i,n,a,o){if(Zy===-1){o.initColor(Lt.RED).addPt(e.getShape()),o.initColor(Lt.Golden).addPt(t.getShape()),o.draw();debugger}let c=e.getShape(),l=a?t.getShape().reverse():t.getShape(),u=(c instanceof we?Wn(c,s?l.start().angle(c.center):r?lt.toRadians(c.endAngle()):void 0):c instanceof qe?st(c,s?l.start():r?c.end():c.start()):c.end().sub(c.start())).normalize(),h=(l instanceof we?Wn(l,s?void 0:(r?c.end():c.start()).angle(l.center)):l instanceof qe?st(l,s?void 0:r?c.end():c.start()):l.end().sub(l.start())).normalize();if(r===void 0){let f=u.dot(h);if(r=f<0,Pa(f,0))return{state:br(e,t,!a,o)?1:0,inter:ho(e,t,n,a,s,r,i)}}else if(r?u.dot(h)>0:u.dot(h)<0)if(s){let f,m=!0;if(c instanceof le&&$e(zn.foot(c,l.start()),r?c.end():c.start()))m=!1;else if(c instanceof we||c instanceof qe){let g=r?c.reverse():c,b=si(l,j9(g,l.start()).reverse()).state;(b===1||b===2)&&(m=!1)}if(m){let g=!r;f=si(g?c.reverse():c,l,o).state===(g?4:3)?1:0}else r?f=ol(e,e.nextSide,t,!a,o)?1:0:f=ol(e.prevSide,e,t,!a,o)?1:0;return{state:f,inter:ho(e,t,n,a,s,r,i)}}else return r?{state:br(e,e.nextSide,!0,o)?0:1,inter:ho(e,t,n,a,s,r,i),isReversed:!0}:{state:br(e.prevSide,e,!0,o)?0:1,inter:ho(e,t,n,a,s,r,i),isReversed:!0};let p,d=new Map([[3,4],[4,3],[0,1],[1,0],[2,2]]);if(s)if(e.judgeOverlapMap.has(t)&&!ac){let f=e.judgeOverlapMap.get(t);p=r?d.get(f.state):f.state}else p=si(r?c.reverse():c,l).state,(p===3||p===4)&&e.judgeOverlapMap.set(t,{state:r?d.get(p):p});else{if(t.judgeOverlapMap.has(e)&&!ac){let f=t.judgeOverlapMap.get(e);p=a?d.get(f.state):f.state}else p=si(l,r?c.reverse():c).state,(p===3||p===4)&&t.judgeOverlapMap.set(e,{state:a?d.get(p):p});p=d.get(p)}if(p===1||p===2){let f=a?t.prevSide:t,m=f.inters,g=f.getEnd();for(let b=m.length-1;b>=0;b--){let E=m[b];if(!(f.getShape()instanceof qe)&&!$e(g,E.coord))break;if(E===n)return{state:2,inter:ho(e,t,n,a,s,r,i)}}}if(p===3||p===4)return{state:p===(r?4:3)?1:0,inter:ho(e,t,n,a,s,r,i)};if(i.has(e)?i.get(e).mapSideList.push(t):i.set(e,{sideIsReversed:r,mapSideList:[t]}),i.has(t)?i.get(t).mapSideList.push(e):i.set(t,{sideIsReversed:a,mapSideList:[e]}),p===2)return r?[e.prevSide,e,a?t.prevSide:t.nextSide,i]:[e,e.nextSide,a?t.prevSide:t.nextSide,i];if(p===0)return[r?e.prevSide:e.nextSide,t,!1,r,i];if(p===1)return[e,a?t.prevSide:t.nextSide,!0,r,i];throw Error("not support")}function ho(e,t,s,r,i,n,a){if(ac)return null;let o=e.getShape(),c=r?t.getShape().reverse():t.getShape(),l=r;if(!i){let d=t;t=e,e=d,r=n,s=s.getBindedInter()}let u=d=>!(i?n:l)&&$e(d,e.prevSide.getEnd())?e.prevSide:e;if(r){let d=t.inters;for(let f=0;f<d.length;f++){let m=d[f];if(m.isInvalid&&n===void 0)continue;if(m===s&&$e(c.start(),s.coord))return i?m:m.getBindedInter();let g=m.getBindedInter().side,b=u(m.coord);if(g===b&&h(m))return p(m)}for(;;){t=t.nextSide;let f=t.inters;for(let m=0;m<f.length;m++){let g=f[m];if(g===s)return i?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||$e(g.coord,b.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return p(g);if(a.has(b)){let E=t.getShape().reverse(),y=st(E,g.coord).dot(st(b.getShape(),g.coord))<0,T=y?b.getShape().reverse():b.getShape(),w=si(E,y?rT(T,g.coord,T.end()):rT(T,T.start(),g.coord)).state;if(w===1||w===2)return p(g)}else a.has(b.nextSide)}else if(g.side===s.side&&h(g))return p(g)}}}else{let d=t.inters;for(let f=d.length-1;f>=0;f--){let m=d[f];if(m.isInvalid&&n===void 0)continue;if(m===s&&$e(c.start(),s.coord))return i?m:m.getBindedInter();let g=m.getBindedInter().side,b=u(m.coord);if(g===b&&h(m))return p(m)}for(;;){t=t.prevSide;let f=t.inters;for(let m=f.length-1;m>=0;m--){let g=f[m];if(g===s)return i?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||$e(g.coord,g.getBindedInter().side.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return p(g);if(!a.has(b)&&a.has(b.prevSide)){let E=t.getShape().reverse(),y=st(E,g.coord).dot(st(b.getShape(),g.coord))<0;if(a.has(b.prevSide)){let T=y?b.getShape().reverse():b.getShape(),w=si(t.getShape(),rT(T,g.coord,T.end())).state;if(w===1||w===2)return p(g)}}}else if(g.side===s.side&&h(g))return p(g)}}}function h(d){if(d.isInvalid||d.getBindedInter().side!==($e(d.coord,e.prevSide.getEnd())?e.prevSide:e))return!1;let f;if(i){if($e(d.coord,c.start()))return!0;f=si(n?o.reverse():o,m(c)).state}else{if($e(d.coord,n?o.end():o.start()))return!0;f=si(c,m(n?o.reverse():o)).state}return f===2||f===1;function m(g){if(g instanceof le)return $e(d.coord,g.end())?g:g.cutLine(d.coord);if(g instanceof we)return we.build2(g.center,g.startAngle,d.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof qe)return g.clip(g.getPercent(d.coord,rt))[0];throw new Error("not supported operation")}}function p(d){let f=s.getBindedInter(),m=s.side,g=f.side,b=s===d,E=s;if(r){let y=s.getIndex()-1;for(;m;){let T=m.inters;for(;y>=0;y--)if(s=T[y],s===d){b||(s.setIsInvalid(),s.isDealed(),E=s),m=null;break}else if(_a===0)!s.isInvalid&&(!$e(s.coord,d.coord)||s.side===d.side&&s.getBindedInter().side===d.getBindedInter().side)&&(s.setIsInvalid(),s.isDealed(),E=s);else if(_a===1){if(s.isInvalid)continue;let w=s.getBindedInter().side;a.has(m)&&a.get(m).mapSideList.includes(w)&&(s.setIsInvalid(),s.isDealed(),E=s)}m=m==null?void 0:m.prevSide,y=(m==null?void 0:m.inters.length)-1}}else{let y=s.getIndex()+1;for(;m;){let T=m.inters;for(;y<T.length;y++){s=T[y];let w=s.getBindedInter();if(s===d){b||(s.setIsInvalid(),s.isDealed(),E=s),m=null;break}else if(_a===0)!s.isInvalid&&(!$e(s.coord,d.coord)||m===d.side&&($e(w.side.getEnd(),s.coord)?w.side.nextSide:w.side)===d.getBindedInter().side)&&(s.setIsInvalid(),s.isDealed(),E=s);else if(_a===1){let S=w.side;a.has(m)&&a.get(m).mapSideList.includes(S)&&(s.setIsInvalid(),s.isDealed(),E=s)}}m=m==null?void 0:m.nextSide,y=0}}if(_a===0&&!$e(f.coord,d.coord))if(i?a.has(g)?a.get(g).sideIsReversed:n:l){let y=f.getIndex()-1;for(;g;){let T=a.has(g),w=g.inters;for(;y>=0;y--){if(f=w[y],f===d.getBindedInter()){g=null;break}f.isInvalid||!T||(!$e(f.coord,d.getBindedInter().coord)||f.side===d.side&&f.getBindedInter().side===d.getBindedInter().side)&&(f.setIsInvalid(),f.isDealed())}g=g==null?void 0:g.prevSide,y=(g==null?void 0:g.inters.length)-1}}else{let y=f.getIndex()+1;for(;g;){let T=g.inters,w=a.has(g);for(;y<T.length;y++){if(f=T[y],f===d.getBindedInter()){g=null;break}let S=$e(g.getEnd(),f.coord)?a.has(g.nextSide):!1;f.isInvalid||!(w||S)||(!$e(f.coord,d.getBindedInter().coord)||f.side===d.side&&f.getBindedInter().side===d.getBindedInter().side)&&(f.setIsInvalid(),f.isDealed())}g=g==null?void 0:g.nextSide,y=0}}return i?E:E.getBindedInter()}}function KO(e,t,s,r,i,n,a){let o=e.getShape(),c=t.getShape(),l=n?s.getShape().reverse():s.getShape(),u=(o instanceof we?Wn(o,l.start().angle(o.center)):o instanceof qe?st(o,l.start()):o.end().sub(o.start())).normalize(),h=(c instanceof we?Wn(c,l.start().angle(c.center)):c instanceof qe?st(c,l.start()):c.end().sub(c.start())).normalize(),p=u.dot(h);if(Pa(p,-1)){let d=n?s.getShape().reverse():s.getShape(),f=st(d).normalize(),m=u.add(h.scale(-1)).normalize().dot(f),g=si(o.reverse(),c,a).state;if(m>-.9&&(g===3||g===4))return{state:g===4?0:1,inter:ho(t,s,i,n,!0,!1,r)};let b=en(e,s,i,a,_a,ac,r.size===0?new Map:r,n);return b.state===2?b:g===4?b.state===0||b.inter!==i?b:en(t,s,i,a,_a,ac,r.size===0?new Map:r,n):b.state===1||b.inter!==i?b:en(t,s,i,a,_a,ac,r.size===0?new Map:r,n)}else{let d=u.scale(-1).angle(de.ORIGIN),f=h.angle(de.ORIGIN);d>f&&(d-=i0);let m=(d+f)/2,g=new de(Math.cos(m),Math.sin(m)),b=st(l).normalize(),E=b.angle(de.ORIGIN),y=d<E&&E<f&&o instanceof le&&c instanceof le&&l instanceof le;if(g.cross(b)<=0){if(u.scale(-1).dot(b)<0){let T;return i.coord.equals1(l.start())?T=st(o,i.coord).dot(st(l,i.coord))<0:l instanceof le&&(T=st(o,o.end()).dot(l.direct)<0),{state:ol(e,t,s,!n,a)?1:0,inter:ho(e,s,i,n,!0,T,r)}}return y&&o.distance2(l.start())>ri?[t,s,!0,void 0,r]:[e,s,!0,void 0,r]}else return h.dot(b)<=0?{state:ol(e,t,s,!n,a)?1:0,inter:ho(t,s,i,n,!0,void 0,r)}:y&&c.distance2(l.start())>ri?[e,s,!0,void 0,r]:[t,s,!0,void 0,r]}}var Zy=0;function CF(e,t,s,r){let i=t.getBindedInter(),n=t.side,a=i.side,o=n.getShape(),c=a.getShape();if(r&&(Zy++,Zy===-1)){r.initColor(Lt.RED).addPt(o),r.initColor(Lt.Golden).addPt(c),r.draw();debugger}let l=0,u=!1;if(e===-1){let _=lo(n,n.nextSide,a,i,l,u,r),C=_.state!==0;if(_.state===2){let D=st(o,t.coord).add(st(n.nextSide.getShape(),t.coord)).normalize(),I=st(c,t.coord).add(st(a.nextSide.getShape(),t.coord)).normalize();return S(C,D.dot(I)>0)}let x=lo(n,n.nextSide,a.nextSide,i,l,u,r);return _.state!==x.state?(w(_,x),1):S(C,_.state!==lo(a,a.nextSide,n,t,l,!0,r).state,_.inter,x.inter)}if(e===1){let _=en(n,a,i,r,l,u,new Map),C=_.state!==0;if(_.state===2)return S(C,st(o,t.coord).dot(st(c,t.coord))>0);let x;if(_.isReversed&&_.existOverlap&&$e(_.inter.coord,a.getEnd())&&_.inter.getBindedInter().side!==n){let P=_.inter.getBindedInter().side;if(P===n.nextSide)x={state:ol(n,P,a.nextSide,!0,r)?1:0,inter:i};else if(P===n.prevSide){if(x={state:ol(P,n,a.nextSide,!0,r)?1:0,inter:_.inter},_.state===x.state&&t!==_.inter){let L=st(c,t.coord),F=st(a.nextSide.getShape(),t.coord),V=st(P.getShape(),t.coord);return S(C,L.add(F).dot(V)>0,_.inter,x.inter)}}else x=en(n,a.nextSide,i,r,l,u,new Map)}else x=en(n,a.nextSide,i,r,l,u,new Map);if(_.state!==x.state)return w(_,x),1;let D=st(c,t.coord),I=st(a.nextSide.getShape(),t.coord);if(Pa(D.dot(I),-1)){let P=br(a,a.nextSide,!0,r);return S(C,_.state!==en(a.nextSide,n,t,r,l,!0,new Map,P?!C:C,!1).state,_.inter,x.inter)}else{let P=st(o,t.coord);return S(C,D.add(I).dot(P)>0,_.inter,x.inter)}}if(!(o instanceof qe||c instanceof qe))return 1;let h=st(o,t.coord),p=st(c,t.coord),d,f;if(c instanceof le)d=new le(t.coord,c.start()),f=new le(t.coord,c.end());else if(c instanceof we){let _=t.coord.angleD(c.center);d=we.build2(c.center,_,c.startAngle,c.rx,c.ry,c.isCCW?0:1),f=we.build2(c.center,_,c.endAngle(),c.rx,c.ry,c.isCCW?1:0)}else if(c instanceof qe){let _=c.getPercent(t.coord,rt);[d,f]=c.clip(_),d=d.reverse()}else throw new Error("not support");let m=h.dot(p)>0,g,b;m?(g=si(o.reverse(),d).state,b=si(o,f).state):(g=si(o,d).state,b=si(o.reverse(),f).state);let E;g===0?E=en(m?n.prevSide:n.nextSide,a,i,r,l,u,new Map,!0,!1,m):g===1?E=en(n,a.prevSide,i,r,l,u,new Map,!0,!0,m):g===2?m?E=lo(n.prevSide,n,a.prevSide,i,l,u,r,!0):E=lo(n,n.nextSide,a.prevSide,i,l,u,r,!0):m?g===3?E={inter:i,state:0}:E={inter:i,state:1}:g===3?E={inter:i,state:1}:E={inter:i,state:0};let y=E.state!==0;if(E.state===2)return S(y,m);let T;if(b===0?T=en(m?n.nextSide:n.prevSide,a,i,r,l,u,new Map,!1,!1,!m):b===1?T=en(n,a.nextSide,i,r,l,u,new Map,!1,!0,!m):b===2?m?T=lo(n,n.nextSide,a.nextSide,i,l,u,r,!1):T=lo(n.prevSide,n,a.nextSide,i,l,u,r,!1):m?b===3?T={inter:i,state:1}:T={inter:i,state:0}:b===3?T={inter:i,state:0}:T={inter:i,state:1},E.state===T.state)return E.inter===T.inter?(t.setIsInvalid(),0):S(y,m,E.inter,T.inter);return w(E,T),1;function w(_,C){let x=_.state!==0;if(_.inter===C.inter){t.setOutToIn(x);return}else Ku(_.inter,C.inter,!0),Ku(C.inter,_.inter,!1);let D=[];if(e===-1){let P=st(o,t.coord),L=st(n.nextSide.getShape(),t.coord),F=st(c,t.coord),V=st(a.nextSide.getShape(),t.coord);D.push(P.dot(F)),D.push(P.dot(V)),D.push(L.dot(F)),D.push(L.dot(V))}else{let P=st(o,t.coord);D.push(st(c,t.coord).dot(P)),D.push(st(a.nextSide.getShape(),t.coord).dot(P))}if(D.reduce((P,L)=>Math.abs(P)>Math.abs(L)?P:L,0)>0)if(s===1||s===0||s===2||s===3)t.setOutToIn(x);else throw new Error("not support");else if(s===1)I(!x);else if(s===0||s===2||s===3)I(x);else throw new Error("not support");function I(P){t.setIsInvalid();let L=(P?_:C).inter;delete L.isInvalid,delete L.getBindedInter().isInvalid,L.setOutToIn(!x)}}function S(_,C,x,D){if(x===D){if(t.side.outline.inters.find(L=>!L.isInvalid&&L!==t&&$e(L.coord,t.coord)))return t.setIsInvalid(),0;let I=new po(t.coord,n,r),P=new po(t.coord,a,r);return I.bind(P),C?n.inters.splice(t.getIndex(),0,I):n.inters.splice(t.getIndex()+1,0,I),a.inters.splice(t.getBindedInter().getIndex(),0,P),I.setOutToIn(_),t.setOutToIn(!_),I.isDealed(),n.inters.forEach((L,F)=>L.setIndex(F)),a.inters.forEach((L,F)=>L.setIndex(F)),2}else{let I=function(){let P=x.getBindedInter(),L=D.getBindedInter();delete x.isInvalid,delete P.isInvalid,delete D.isInvalid,delete L.isInvalid,x.setOutToIn(!_),D.setOutToIn(_),Ku(x,D,!0),Ku(D,x,!1),Ku(P,L,C),Ku(L,P,!C)};if(t.setIsInvalid(),C){if(s===1||s===0||s===2||s===3)return I(),2;throw new Error("not support")}else{if(s===1)return _?0:(I(),2);if(s===0||s===2||s===3)return _?(I(),2):0;throw new Error("not support")}}}}function Ku(e,t,s){let{judge:r,changeNum:i}=a(),n=e.getIndex();for(let o=n+i,c=e.side.inters;r(o);o+=i){if(c[o].isInvalid)continue;if(!$e(c[o].coord,e.coord))break;c[o].setIndex(n),c[n].setIndex(o);let l=c[o];c[o]=c[n],c[n]=l,n=o}function a(){let o=e.side===t.side;if(s){let c=o?t.getIndex():e.side.inters.length;return{judge:l=>l<c,changeNum:1}}else{let c=o?t.getIndex()+1:0;return{judge:l=>l>=c,changeNum:-1}}}}var uO=0,po=class{constructor(e,t,s){this.id=uO++,this.coord=e,this.side=t,s&&(this.id=uO++,this.drawDebug=s);let r=new Oi;r.ext2(e),this._bbox=r.build1()}bbox(){return this._bbox}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(e){this.outToIn=e,this.bindedInter.outToIn=!e}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(e){this.bindedInter=e,e.bindedInter=this}setIndex(e){this.index=e}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let e=this.getIndex(),t=this.side.getStart();return e&&(t=this.side.inters[e-1].coord),t}getTangent(){let e=this.side.getShape();if(e instanceof le)return e.end().sub(e.start());if(e instanceof we){let t=this.coord.angle(e.center);return e.isCCW?t+=Vy:t-=Vy,new de(Math.cos(t),Math.sin(t))}else{if(e instanceof qe)return Tp(e,e.getPercent(this.coord,rt));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let e=[],t=this,s;if(this.drawDebug){lT++;let r=lT===-1,i=this.drawDebug.initColor(Lt.RED);if(r){this.drawDebug.draw();debugger}s=n=>{if(e.push(n),r){i.addPt(e[e.length-1]),this.drawDebug.draw();debugger}}}else s=r=>e.push(r);for(;!t.visited;){let r=function(o,c){if(_e.eq(o.distance2(c),0))return;let l=Op.rebuild(n.getShape(),o,c);if(!l)return!0;s(l)};t.visit();let i=t.getIndex(),n=t.side,a=n.inters[i+1];for(;a!=null&&a.isInvalid;)a=n.inters[a.getIndex()+1];if(a)r(t.coord,a.coord),t=a.bindedInter;else{let o=r(t.coord,n.getEnd()),c=t.coord;for(n=n.nextSide,t=null;;){for(let l of n.inters)if(!l.isInvalid){t=l.bindedInter;break}if(t)break;o?(r(c,n.getEnd()),o=!1):s(n.getShape()),n=n.nextSide}o?(_e.eq(c.distance2(t.coord),0)?r(c,n.getEnd()):r(c,t.coord),o=!1):_e.eq(n.getEnd().distance2(t.coord),0)?s(n.getShape()):r(n.getStart(),t.coord)}}if(t!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:lT,handleId:Zy,boolId:hp})),new Error("inter !== this");return cc(Tt.build7(e))}},lT=0,uT=class IT{constructor(t,s,r,i,n){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=t,this.isGroup1=r,this.isOutside=i,this.finalIsOutside=i,this.polyline=s,n&&(this.polygon=n),t.forEach(a=>a.outline=this)}static build(t,s,r,i,n){let a=t.primitives.map(c=>new Op(c,i)),o=a[a.length-1];return a.forEach(c=>{o.connect(c),o=c}),n?new IT(a,t,s,r,n):new IT(a,t,s,r)}setFinalIsOutSide(t){this.finalIsOutside=t}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(t,s){if(!(t.interOutlines&&t.interOutlines===this.interOutlines))if(t.interOutlines)if(this.interOutlines){let r,i;this.interOutlines.length>t.interOutlines.length?(r=this.interOutlines,i=t.interOutlines):(r=t.interOutlines,i=this.interOutlines),i.forEach(n=>{r.push(n),n.interOutlines=r}),s.delete(i)}else t.interOutlines.push(this),this.interOutlines=t.interOutlines;else this.interOutlines?(this.interOutlines.push(t),t.interOutlines=this.interOutlines):(t.interOutlines=this.interOutlines=[this,t],s.add(this.interOutlines))}isContain(t){if(!this.polyline.bbox().extendOfSize(rt).isContainsBBox(t.polyline.bbox()))return!1;let s=t.polyline.primitives[0].start();if(t.hasInter&&t.isAllInterIsInvalid()){let r=t.inters[0];r.getBindedInter().side.outline!==this?s=r.side.getCenterPoint():s=r.side.getCenterPoint(r.coord)}return!!this.polyline.getWindingNum(s)}isInternally(t){return!!this.polyline.getWindingNum(t)}isEqual(t){return this.polyline===t.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let t=this.sides[this.sides.length-1];this.sides.forEach(s=>{s.reverse(),t.connect(s),t=s})}returnPolyline(){let t=this.sides.map(r=>r.getShape()),s=this.polyline.primitives;if(this.sides.length===s.length){let r=new Set(s);if(!t.some(i=>!r.has(i)))return this.polyline}return Tt.build7(t)}};function hO(e,t,s){let r=[];return e.forEach(i=>i.forEach(n=>{if(n.hasInter&&!n.isAllInterIsInvalid())return;let a=n.bbox(),o=t.search(a.extendOfSize(rt)).filter(c=>c.bbox().extendOfSize(rt).isContainsBBox(a)).sort((c,l)=>c.bbox().area()-l.bbox().area());for(let c of o)if(c.isContain(n)){let l=s(!n.isOutside,c.isOutside),u=s(n.isOutside,c.isOutside);l!==u&&(r.push(n),n.setFinalIsOutSide(!l));return}s(n.isOutside,!1)!==s(!n.isOutside,!1)&&r.push(n)})),r}function DF(e,t,s){let r;switch(s){case 0:r=(o,c)=>o&&c;break;case 1:r=(o,c)=>o||c;break;case 2:r=(o,c)=>o&&!c;break;case 3:r=(o,c)=>o&&!c||!o&&c;break;default:throw Error("not support the rule")}let i=new wp(10),n=new wp(10);e.forEach(o=>o.forEach(c=>i.add(c))),t.forEach(o=>o.forEach(c=>n.add(c)));let a=hO(e,n,r);return hO(t,i,(o,c)=>r(c,o)).forEach(o=>a.push(o)),a}var PF=class{constructor(e){this.roots=[],this.nodes=e.sort((t,s)=>t.bbox().minX-s.bbox().minX).map(t=>new OF(t)),this.nodes.forEach((t,s)=>{t.visit()&&(this.roots.push(t),this.build(s))})}build(e){let t=this.nodes[e];for(let s=e+1,r=this.nodes.length;s<r;s++){let i=this.nodes[s];if(t.key.bbox().maxX<i.key.bbox().minX)break;i.getIsVisit()||t.isContain(i)&&(i.visit(),t.addChild(i),this.build(s))}}getPolygons(){let e=[];return this.roots.forEach(t=>t.getPolygons().forEach(s=>e.push(s))),e}},OF=class{constructor(e){this.children=[],this.isVisit=!1,this.key=e}getIsVisit(){return this.isVisit}isContain(e){return this.key.isContain(e.key)}addChild(e){this.children.push(e)}getPolygons(){let e=[];return this.getPolylineList(e),e.map(t=>{let s=t[0].polygon;if(s&&s.items.length===t.length){let r=t.map(n=>n.returnPolyline()),i=new Set(s.items);return r.some(n=>!i.has(n))?new hr(r):s}else return new hr(t.map(r=>r.returnPolyline()))})}getPolylineList(e,t){t?(t.push(this.key),t=null):(t=[this.key],e.push(t)),this.children.forEach(s=>s.getPolylineList(e,t))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function dO(e){let t="";return e.items.forEach((s,r)=>{let i="$";if(s.items.forEach((n,a)=>{let o="[";if(n.primitives.forEach((c,l)=>{let u="";if(c instanceof le)u=`Line,${c.start().x},${c.start().y},${c.end().x},${c.end().y}`;else if(c instanceof we)u=`Arc,${c.center.x},${c.center.y},${c.startAngle},${c.sweepAngle},${c.rx}`;else if(c instanceof qe)u=`Bezier,${c.controls.map(h=>`${h.x},${h.y}`).join(",")}`;else throw new Error("not supported");if(l===n.primitives.length-1){o+=`${u}]`;return}o+=`${u},`}),a===s.items.length-1){i+=`${o}$`;return}i+=`${o}_`}),r===e.items.length-1){t+=`${i}`;return}t+=`${i}^`}),console.log(t),t}function pO(e){let t=e.split("^"),s=[];return t.forEach(i=>{let n=/\$(.*?)\$/,a=i.match(n)[1].split("_"),o=[];a.forEach(l=>{let u=/\[(.*?)\]/,h=l.match(u)[1].split(","),p=[],d=[];for(let m=0;m<h.length;m++){let g=h[m];if(g==="Line"||g==="Arc"||g==="Bezier"){if(p.length){let b=r(p);d.push(b),p.length=0}p.push(g);continue}p.push(Number(g))}p.length&&(d.push(r(p)),p.length=0);let f=Tt.build7(d);o.push(f)});let c=new hr(o);s.push(c)}),new Vs(s);function r(i){let n=i[0];if(n==="Line")return new le(new de(i[1],i[2]),new de(i[3],i[4]));if(n==="Arc")return we.build3(new de(i[1],i[2]),i[3],i[4],i[5],i[5]);if(n==="Bezier"){let a=[];for(let o=1;o<i.length;o+=2)a.push(new de(i[o],i[o+1]));return new qe(a)}else throw new Error("not support")}}var IF=class{constructor(e=1){this.group1Str="$[Line,20193.777980000017,4122.200439600661,20193.77082,4211.848760073709,Arc,20193.972672902382,4211.8487570980205,179.99915535323618,-89.99540000050294,0.2018529024026465,Line,20193.972659672283,4212.050609999989,20193.972660393258,4212.039610000013,Arc,20193.97217289501,4211.848257065248,89.85403133887164,89.99540000041924,0.19135355574930143,Line,20193.78082,4211.848759926291,20193.78897999998,4122.200440479205,Line,20193.78897999998,4122.200440479205,20193.777980000017,4122.200439600661]$",this.group2Str="$[Arc,20209.72784128151,4122.2007625157785,258.46768032837986,-75.66780748375947,4.138846238512183,Line,20205.593935808283,4121.998590004101,20193.97982992629,4121.998600000001,Arc,20193.97983290198,4122.2004529023825,269.9991553532362,-89.99540000050297,0.20185290240401074,Arc,20193.782979999996,4122.20044,180.00375535340328,-180.0000000000027,0.004999999999025513,Arc,20193.979332869207,4122.200952909754,180.15347936671733,89.99540000008247,0.19135355575111057,Line,20193.97983008845,4122.009599999999,20205.603694309226,4122.003828485546,Arc,20209.733142304296,4122.194577876843,182.64475341258483,75.73379999998886,4.133851239977064,Line,20208.900400396684,4118.145470939558,20208.902599535475,4118.156248870184,Arc,20206.972515961093,4108.700057667588,78.46393309088245,-78.46759999998636,9.65115405866796,Arc,20216.618669999996,4108.69944,359.99996825446135,-180,0.004999999999200412,Arc,20206.973015966745,4108.699445349495,359.99996822365375,78.46759999998409,9.640654033253735]$^$[Line,20193.997796883676,4095.399470032799,20205.596133314026,4095.4013992171836,Arc,20209.72470159858,4095.1923799234505,177.10172964919312,-75.64935037184974,4.133855965730166,Arc,20209.73000213952,4095.198565517174,101.5415133143569,75.7293000000185,4.128850963459707,Line,20205.605834328744,4095.395161923586,20193.997203529463,4095.389485743675,Arc,20193.994588809255,4095.197684525904,89.21896662213764,4.544099999999517,0.19181903946188483,Arc,20193.981499796217,4095.1977402038,89.85034659953621,89.9999999995926,0.19135044893494071,Arc,20193.78515,4095.19824,0,-180,0.005,Arc,20193.98200016982,4095.1982398301675,179.99995179248322,-89.99999999974185,0.20185016982129908,Arc,20193.981986624152,4095.198185381971,89.9961078637802,-4.487285276547311,0.2019046184835962]$",this.rule=e}getGroup1(){return pO(this.group1Str)}getGroup2(){return pO(this.group2Str)}},hT=new r0(2),up=class{getUnion(e,t=!0){return t&&(e=e.map(s=>this.asSameSweep([s])[0])),dF(q9,e)}asSameSweep(e){let t=0;return e.forEach(s=>t+=s.area(.01)),t>0?e.map(s=>s.reverse()):e}getSubtraction(e,t){let s=new yp(!1),r=new Ep(My.rule,hT,s);for(let i of e){let n=My.weight(0);r.addPolyline(i,n)}for(let i of t){let n=My.weight(1);r.addPolyline(i,n)}return r.simplify(),s.plGrps}getIntersection(e,t){let s=new yp(!1),r=new Ep(jy.rule,hT,s);for(let i of e){let n=jy.weight(0);r.addPolyline(i,n)}for(let i of t){let n=jy.weight(1);r.addPolyline(i,n)}return r.simplify(),s.plGrps}getMutuallyExclusive(e,t){let s=new yp(!1),r=new Ep(Fy.rule,hT,s);for(let i of e){let n=Fy.weight(0);r.addPolyline(i,n)}for(let i of t){let n=Fy.weight(1);r.addPolyline(i,n)}return r.simplify(),s.plGrps}},hp=0,dT=!1;function dp(e,t,s,r,i){let n=Ip(),a=[],o=[],c=[],l=new Set,u;if(i){if(u=new Pp(i),hp++,dT){debugger;dT=!1;let T=new IF;dp(T.rule,T.getGroup1(),T.getGroup2(),r,i)}if(hp===-1||dT){console.table({rule:e,group1:dO(t),group2:dO(s)}),u.clear();let T=u.initColor(Lt.GREEN),w=u.initColor(Lt.WHITE),S=u.initColor(Lt.BLUE),_=u.initColor(Lt.Gray);t.items.forEach(C=>C.items.forEach((x,D)=>{D>0?w.addPly(x):T.addPly(x)})),s.items.forEach(C=>C.items.forEach((x,D)=>{D>0?_.addPly(x):S.addPly(x)})),u.draw();debugger}}let h=t.items.length!==0&&s.items.length!==0?t.bbox().extendOfSize(rt).intersection1(s.bbox().extendOfSize(rt)):null;if(h){let T=[],w=[];switch(e){case 0:{for(let S of t.items)S.bbox().isIntersect(h)&&T.push(S);for(let S of s.items)S.bbox().isIntersect(h)&&w.push(S);break}case 1:case 3:{for(let S of t.items)S.bbox().isIntersect(h)?T.push(S):a.push(S);for(let S of s.items)S.bbox().isIntersect(h)?w.push(S):a.push(S);break}case 2:{for(let S of t.items)S.bbox().isIntersect(h)?T.push(S):a.push(S);for(let S of s.items)S.bbox().isIntersect(h)&&w.push(S);break}default:throw new Error("not support")}T.length!==t.items.length&&(t=new Vs(T)),w.length!==s.items.length&&(s=new Vs(w))}else{switch(e){case 0:break;case 1:case 3:{t.items.forEach(T=>a.push(T)),s.items.forEach(T=>a.push(T));break}case 2:{t.items.forEach(T=>a.push(T));break}default:throw new Error("not support")}t=new Vs([]),s=new Vs([])}E(t,o,!0),E(s,c,!1);let p=e===2||e===3?(T,w)=>$e(T.getEnd(),w)?T.nextSide:T:(T,w)=>$e(T.prevSide.getEnd(),w)?T.prevSide:T,d=(T,w,S)=>{if($e(T.getEnd(),S)){if(T.inters.findIndex(_=>_.getBindedInter().side===w&&$e(_.coord,T.getEnd()))===-1)return new po(S,T,u)}else return new po(S,T,u)},f=e===2||e===3?(T,w,S)=>{if($e(T.getStart(),S)){if(T.inters.findIndex(_=>_.getBindedInter().side===w&&$e(_.coord,T.getStart()))===-1)return new po(S,T,u)}else return new po(S,T,u)}:d;r.seek(t,s,(T,w,S,_,C,x)=>{let D=o[T][w],I=c[_][C],P=D.sides[S],L=I.sides[x],F=bn(P.getShape(),L.getShape());if((P.getShape()instanceof qe||L.getShape()instanceof qe)&&F>=4){if(P.getShape()instanceof we||L.getShape()instanceof we){let B=function(O,R){let v=!1;for(let j=0;j<R.length;j+=2)$e(new de(R[j],R[j+1]),O)&&(v=!0);v||R.push(O.x,O.y)},k=[te[0],te[1]];for(let O=0;O<F;O+=2){let R=new de(te[O],te[O+1]);for(let v=O+2;v<F;v+=2){let j=new de(te[v],te[v+1]);if(!$e(R,j)){B(j,k);break}}}F=k.length,k.forEach((O,R)=>te[R]=O)}else for(let B=F-2;B>=2;B-=2)for(let k=B-2;k>=0;k-=2)if($e(new de(te[B],te[B+1]),new de(te[k],te[k+1]))){te[k]=(te[B]+te[k])/2,te[k+1]=(te[B+1]+te[k+1])/2;for(let O=F-3;O>=B;O--)te[O]=te[O+2];F-=2;break}}let V=0;if(F===4){let B=function(R){return $e(P.getEnd(),R)||$e(P.prevSide.getEnd(),R)||$e(L.prevSide.getEnd(),R)||$e(L.getEnd(),R)},k=new de(te[0],te[1]),O=()=>{let R=new po(k,P,u),v=new po(k,L,u);R.bind(v),R.setIsInvalid(),R.isDealed(),D.inters.push(R),I.inters.push(v)};if(te[0]===te[2]&&te[1]===te[3])if(B(k))V=2;else{O();return}}for(;V<F;V+=2){let B=new de(te[V],te[V+1]),k=P,O=L;if($e(k.prevSide.getEnd(),B)&&(k=k.prevSide),O=p(O,B),P!==k&&L!==O){let v=e===2||e===3?L.getEnd():O.getEnd();k.getEnd().distance1(B)<v.distance1(B)?(B=k.getEnd(),$e(v,B)||(O=L)):(B=v,$e(k.getEnd(),B)||(k=P))}let R=d(k,O,B);if(R){let v=f(O,k,B);v&&(k.addInter(R),D.inters.push(R),O.addInter(v),I.inters.push(v),R.bind(v),D.intersect(I,l))}}return F},i);let m=y(),g=DF(o,c,e);g.forEach(T=>!T.startAndEndIsSameOutsideFlag()&&T.reverse()),new PF(m.concat(g)).getPolygons().forEach(T=>a.push(T));let b=new Vs(a);if(u){if(hp===-1){let T=u.initColor(Lt.RED),w=u.initColor(Lt.Golden);a.forEach(S=>{T.addPly(S.items[0]),S.items.slice(1).forEach(_=>w.addPly(_))}),u.draw();debugger;throw new Error}b.id=hp}return Ca.BooleanTools+=nc(n),b;function E(T,w,S){T.items.forEach(_=>{let C=[];C.push(uT.build(_.items[0],S,!0,u,_)),_.items.slice(1).forEach(x=>{C.push(uT.build(x,S,!1,u))}),w.push(C)})}function y(){let T=[];return l.forEach(S=>{e===2||e===3?S.forEach(C=>{C.isGroup1||C.reverse(),C.sides.forEach(x=>x.sortInters())}):S.forEach(C=>C.sides.forEach(x=>x.sortInters())),S.map(C=>C.sides.filter(x=>x.inters.length)).flat(2).sort((C,x)=>{let D=C.inters,I=x.inters,P=$e(D[D.length-1].coord,C.getEnd()),L=$e(I[I.length-1].coord,x.getEnd());if(P&&L){let F=0,V=0;for(let B=D.length-2;B>=0&&$e(D[B].coord,C.getEnd());B--)F++;for(let B=I.length-2;B>=0&&$e(I[B].coord,x.getEnd());B--)V++;return V-F}else return P?-1:1}).forEach(C=>{C.inters.forEach(x=>{if(x.dealed)return;let D=x.side,I=x.getBindedInter().side,P;$e(D.getEnd(),x.coord)&&$e(I.getEnd(),x.coord)?P=-1:$e(D.getEnd(),x.coord)?(P=1,x=x.getBindedInter()):$e(I.getEnd(),x.coord)&&(P=1);let L=CF(P,x,e,u);x.isDealed(),L&&(D.outline.setAllInterIsInvalidToFalse(),I.outline.setAllInterIsInvalidToFalse())})}),_(S),e===3&&(S.forEach(C=>{C.reverse(),C.sides.forEach(x=>{x.sortInters(),x.inters.forEach(D=>{D.resetVisitStatus()})})}),_(S));function _(C){C.forEach(x=>{x.inters.forEach(D=>{if(D.isInvalid||D.getVisited())return;let I=D.findStartInter(),P=w(e)?I.run():I.getBindedInter().run(),L=x.polyline.primitives;if(P){if(L.length===P.primitives.length){let F=new Set(L);if(!P.primitives.some(V=>!F.has(V))){T.push(x);return}}T.push(uT.build(P,!0,!0,u))}})})}}),T;function w(S){switch(S){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var vy=/\bstablilizetion\b/.test(self.location.href)||!0,np={intersect(e,t,s,r){try{return dp(0,e,t,s,r)}catch(i){if(vy){let n=new up().getIntersection(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Vs(n.map(a=>new hr(a.items)))}throw i}},union(e,t,s,r){try{return dp(1,e,t,s,r)}catch(i){if(vy){let n=new up,a=e.items.map(c=>c.items.map(l=>l)).flat(2);t.items.forEach(c=>c.items.forEach(l=>a.push(l)));let o=n.getUnion(a);return new Vs(o.map(c=>new hr(c.items)))}throw i}},diff(e,t,s,r){try{return dp(2,e,t,s,r)}catch(i){if(vy){let n=new up().getSubtraction(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Vs(n.map(a=>new hr(a.items)))}throw i}},xor(e,t,s,r){try{return dp(3,e,t,s,r)}catch(i){if(vy){let n=new up().getMutuallyExclusive(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Vs(n.map(a=>new hr(a.items)))}throw i}}},xF=class extends Ep{constructor(e,t,s,r,i,n){super(e.rule,r0.DUMMY,t),this.sideGroup1=[],this.sideGroup2=[],this.group1=s,this.group2=r,this.seeker=i,this.addGroup(s,e.weight(0),this.sideGroup1),this.addGroup(r,e.weight(1),this.sideGroup2),this.bus=n}addGroup(e,t,s){if(!e)debugger;e.items.forEach(r=>{let i=[];r.items.forEach(n=>{let a=this.sides.length;this.addPolyline(n,t),i.push(this.sides.slice(a))}),s.push(i)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(e,t,s,r,i,n)=>{let a=this.sideGroup1[e][t][s],o=this.sideGroup2[r][i][n],c=bn(a.shape,o.shape);for(let l=0;l<c;l+=2){let u=new de(te[l],te[l+1]);a.inters.push(u),o.inters.push(u),this.event.onIntersect(u,a,o)}return c},this.bus)}},vF=class extends yp{constructor(e){super(!!e),e&&(this.drawDebug=new Pp(e),this.blueDrawing=this.drawDebug.initColor(Lt.BLUE),this.greenDrawing=this.drawDebug.initColor(Lt.GREEN),this.redDrawing=this.drawDebug.initColor(Lt.RED))}onOriginSide(e){super.onOriginSide(e),this.debug&&this.blueDrawing.addPt(e.shape)}onPolylineGroup(e,t){super.onPolylineGroup(e,t),this.debug&&e.items.forEach(s=>this.greenDrawing.addPly(s))}draw(){this.drawDebug.draw()}};function Ry(e,t,s,r,i){let n=Ip(),a=new vF(i);new xF(e,a,t,s,r,i).simplify();let o=[];a.plGrps.forEach(l=>{let u=l.items.map(h=>Xy(h));u[0]&&o.push(new hr(u.filter(h=>h)))});let c=new Vs(o);return Ca.BooleanTools+=nc(n),c}var Ny=!0,ap={intersect(e,t,s,r){try{return np.intersect(e,t,s,r)}catch(i){if(Ny)throw i;return console.error(i),Ry(jy,e,t,s,r)}},union(e,t,s,r){try{return np.union(e,t,s,r)}catch(i){if(Ny)throw i;return console.error(i),Ry(J9,e,t,s,r)}},diff(e,t,s,r){try{return np.diff(e,t,s,r)}catch(i){if(Ny)throw i;return console.error(i),Ry(My,e,t,s,r)}},xor(e,t,s,r){return np.xor(e,t,s,r)}};var RF=class{init(e){}seek(e,t,s,r){let i=e.bbox().extendOfSize(5e-6).intersection1(t.bbox().extendOfSize(5e-6));if(!i)return;let n=Ip(),a=[];for(let p=0,d=e.items.length;p<d;p++){let f=e.items[p];if(i.isIntersect(f.bbox()))for(let m=0,g=f.items.length;m<g;m++){let b=f.items[m];if(i.isIntersect(b.bbox()))for(let E=0,y=b.primitives.length;E<y;E++){let T=b.primitives[E].bbox();i.isIntersect(T)&&a.push({bbox:T,polygonIndex:p,polylineIndex:m,ptIndex:E})}}}let o=a.length;if(o===0){Ca.IntersectionSeeker+=nc(n);return}let c=[];for(let p=0,d=t.items.length;p<d;p++){let f=t.items[p];if(i.isIntersect(f.bbox()))for(let m=0,g=f.items.length;m<g;m++){let b=f.items[m];if(i.isIntersect(b.bbox()))for(let E=0,y=b.primitives.length;E<y;E++){let T=b.primitives[E].bbox();i.isIntersect(T)&&c.push({bbox:T,polygonIndex:p,polylineIndex:m,ptIndex:E})}}}let l=c.length;if(l===0){Ca.IntersectionSeeker+=nc(n);return}if(o<5||l<5){for(let p=0,d=a.length;p<d;p++)for(let f=0,m=c.length;f<m;f++)if(a[p].bbox.isIntersect(c[f].bbox.extendOfSize(1e-5))){let g=a[p],b=c[f];s(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}Ca.IntersectionSeeker+=nc(n);return}a.sort((p,d)=>p.bbox.minX-d.bbox.minX),c.sort((p,d)=>p.bbox.minX-d.bbox.minX);let u=0,h=0;for(;u<o&&h<l;)if(a[u].bbox.minX<c[h].bbox.minX){let p=a[u],d=p.bbox;for(let f=h;f<l;f++){let m=c[f],g=m.bbox;if(g.minX>d.maxX+1e-5)break;(d.minY<g.minY?g.minY:d.minY)<(d.maxY<g.maxY?d.maxY:g.maxY)+1e-5&&s(p.polygonIndex,p.polylineIndex,p.ptIndex,m.polygonIndex,m.polylineIndex,m.ptIndex)}u++}else{let p=c[h],d=p.bbox;for(let f=u;f<o;f++){let m=a[f],g=m.bbox;if(g.minX>d.maxX+1e-5)break;(g.minY<d.minY?d.minY:g.minY)<(g.maxY<d.maxY?g.maxY:d.maxY)+1e-5&&s(m.polygonIndex,m.polylineIndex,m.ptIndex,p.polygonIndex,p.polylineIndex,p.ptIndex)}h++}Ca.IntersectionSeeker+=nc(n)}},Dr,Ur=(Dr=class{static getDebug(){return Dr.drawDebug||(Dr.drawDebug=new Pp(Dr.curBus)),Dr.drawDebug}static getDrawing(t=Lt.GREEN){return this.getDebug().initColor(t)}static clearDrawing(){Dr.getDebug().clear()}static drawText(t,s,r=Lt.GREEN){Dr.getDrawing(r).addText(t,s,1.5,.1,!0)}static drawBBox(t,s=Lt.GREEN){if(!t)return;let r=Dr.getDrawing(s),i=new le(t.UL(),t.UR()),n=new le(t.UR(),t.LR()),a=new le(t.LR(),t.LL()),o=new le(t.LL(),t.UL());r.addPt(i),r.addPt(n),r.addPt(a),r.addPt(o)}static drawPolyType(t,s){let r=Dr.getDrawing(s);if(t instanceof Tt)r.addPly(t);else if(t instanceof hr)for(let i of t.items)i instanceof Tt?r.addPly(i):this.drawPolyType(i,s);else if(t instanceof Vs)for(let i of t.items)this.drawPolyType(i,s)}static translate(t){switch(t){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}},Dr.UseRunArrange=!0,Dr.UseOptimizeSplit=!0,Dr.LocalBestThread=4,Dr.HandleDiff=!0,Dr.OcTreeSplitStep=4,Dr.PrintStart=new de(150,-200),Dr),op=class xT{static getPolyTypeLine(t){let s=[];if(t instanceof Tt)for(let r of t.primitives)s.push(r);else if(t instanceof hr)for(let r of t.items)if(r instanceof Tt)for(let i of r.primitives)s.push(i);else{let i=this.getPolyTypeLine(r);for(let n of i)s.push(n)}else if(t instanceof Vs)for(let r of t.items){let i=this.getPolyTypeLine(r);for(let n of i)s.push(n)}return s}static getPolyTypePolyLine(t){let s=[];if(t instanceof Tt)s.push(t);else if(t instanceof hr)for(let r of t.items)if(r instanceof Tt)s.push(r);else{let i=this.getPolyTypePolyLine(r);for(let n of i)s.push(n)}else if(t instanceof Vs)for(let r of t.items){let i=this.getPolyTypePolyLine(r);for(let n of i)s.push(n)}return s}static getListBBox(t){if(t.length<=0)return;let s=new Oi;for(let r of t){let i=xT.getSingleBBox(r);s.ext1(i)}return s.build1()}static getSingleBBox(t){if(t instanceof Array){let s=new Oi,r=xT.getListBBox(t.slice(1));return s.ext1(r),s.build1()}else return t.bbox()}static doDrawRule(t,s=Ur.PrintStart){if(t.length<2)return[s,s,s];let r=5,i=10,n=t[0],a=Ur.translate(n),o=[],c=s.y,l=s.x,u=s.x;s=s.add(new de(0,-i));for(let d=1;d<t.length;d++){let f=t[d];if(f instanceof Array){s=s.add(new de(r,0));let m=this.doDrawRule(f,s);o.push(m[0]),m[1].x<=l&&(l=m[1].x),m[2].x>=u&&(u=m[2].x),s=new de(m[2].x+r,s.y)}else o.push(s.clone()),s.x<=l&&(l=s.x),s.x>=u&&(u=s.x),Ur.drawText(s,f.name),s=s.add(new de(r,0))}let h=0;for(let d of o)h+=d.x;let p=new de(h/o.length,s.y+i);Ur.drawText(p,"N:"+a);for(let d of o){let f=new le(d,p),m=new Array;m.push(f);let g=Tt.build1(wT(m));Ur.drawPolyType(g,Lt.GREEN)}return[p,new de(l,c),new de(u,c)]}static drawRule(t,s=Ur.PrintStart,r=!1,i){Ur.clearDrawing(),this.doDrawRule(t,s),r&&this.doDrawRulePolygon(t,i),Ur.getDebug().draw()}static doDrawRulePolygon(t,s){let r=t[0];for(let i=1;i<t.length;i++){let n=t[i];if(n instanceof Array)this.doDrawRulePolygon(n,s);else{let a=s;r===2&&i===1&&(a=Lt.RED),n.name&&Ur.drawText(n.bbox().UL(),n.name,a),Ur.drawPolyType(n,a)}}}static IsCenterBBoxPointInPolygonType(t,s){let r=t.center();for(let i of s.items)if(i.getOutMostPolyline().getWindingNum(r))return!0;return!1}static KeepBBoxPolygonGroup(t,s){let r=s.bbox().intersection1(t);if(!r)return!1;for(let i of s.items)if(i.bbox().isIntersect(r)){for(let n of i.items)if(n.bbox().isIntersect(r)){for(let a of n.primitives)if(r.isIntersect(a.bbox()))return!0}}return!!this.IsCenterBBoxPointInPolygonType(t,s)}},NF=class $u{static createNode(t,s,r){let i=t.UL(),n=t.width()/s,a=t.height()/s,o=~~(r/s),c=r-o*s,l=i.x+c*n,u=i.y-(o+1)*a,h=l+n,p=u+a;return new ei(l,h,u,p)}static ocTreeSplitNode(t,s,r,i,n=2){if(t.length<=r)return t;let a=[],o=n**2,c=new Array(o),l=new Array(o);for(let d=0;d<o;d++)c[d]=new Array(t.length),l[d]=0;let u=s.UL(),h=s.width()/n,p=s.height()/n;for(let d of t){let f=i(d).center(),m=~~((f.x-u.x)/h),g=~~((u.y-f.y)/p)*n+m;try{c[g][l[g]]=d,l[g]+=1}catch{a.push(d)}}for(let d=0;d<c.length;d++){let f=l[d];if(f<=0)continue;let m=c[d].slice(0,f);if(m.length===t.length)return t;let g=$u.createNode(s,n,d),b=$u.ocTreeSplitNode(m,g,r,i,n);if(b.length===t.length)return t;a.push(b)}return a}static ocTreeSplitNodeMinIntersect(t,s,r,i){let n=[];if(t.length<=r)return t;let a=3,o=s.LL(),c=s.UR(),l=s.width()/(a+1),u=s.height()/(a+1),h=-(2**32),p=[],d=[];for(let f=1;f<=a;f++)for(let m=1;m<=a;m++){let g=o.x+l*f,b=o.y+u*m,E=[[],[],[],[]],y=new Array(4),T=new Array(4);T[0]=new ei(o.x,g,b,c.y),T[1]=new ei(g,c.x,b,c.y),T[2]=new ei(o.x,g,o.y,b),T[3]=new ei(g,c.x,o.y,b);for(let C of t){let x=i(C).center(),D=-1,I=-1;x.x===g?D=Math.random()>=.5?1:-1:x.x>g?D=1:x.x<g&&(D=-1),x.y===b?I=Math.random()>=.5?1:-1:x.y>b?I=1:x.y<b&&(I=-1),D===1&&I===1?E[1].push(C):D===1&&I===-1?E[3].push(C):D===-1&&I===-1?E[2].push(C):D===-1&&I===1&&E[0].push(C)}for(let C=0;C<4;C++){let x=E[C];if(x.length<=0)continue;let D=new Oi;for(let I of x)D.ext1(i(I));y[C]=D.build1()}let w=0,S=0;for(let C of y)C&&(w+=C.area());S=w;let _=(C,x)=>{if(!y[C]||!y[x])return 0;let D=y[C].intersection1(y[x]);return D?D.area():0};S-=_(0,1),S-=_(0,2),S-=_(0,3),S-=_(1,2),S-=_(1,3),S-=_(2,3),S/w>=h&&(p=E,d=T)}for(let f=0;f<p.length;f++){let m=p[f];if(m.length<=0)continue;let g=d[f],b;if(m.length===t.length?b=$u.ocTreeSplitNode(m,g,r,i):b=$u.ocTreeSplitNodeMinIntersect(m,g,r,i),b.length===t.length)return t;n.push(b)}return n}static ocTreeSplit(t,s,r,i){return $u.ocTreeSplitNode(t,s,r,i,Ur.OcTreeSplitStep)}},LF=class XO{static simplifyRules(t,s){return Ur.UseOptimizeSplit&&(t=this.optimizeSplit(t,s)),t}static OcTreeOptimizeSplit(t){let s=t[0];if(s!==1||t.length<=Ur.LocalBestThread+1)return t;let r=t.slice(1),i=new Array(r.length);for(let l=1;l<t.length;l++)i[l-1]=l;let n=op.getListBBox(r),a=NF.ocTreeSplit(i,n,Ur.LocalBestThread,l=>{let u=t[l];return op.getSingleBBox(u)}),o=(l,u)=>{if(!(l.length<=0))for(let h of l)if(Array.isArray(h)){let p=[u[0]];o(h,p),u.push(p)}else{let p=t[h];u.push(p)}},c=[s];return o(a,c),c}static optimizeSplit(t,s){let r=t[0];if(r===2){if(Ur.HandleDiff){let n=t[1],a;if(Array.isArray(n)){let o=this.optimizeSplit(n,s);if(o.length<=1)return[2];a=vT(o,s)}else a=vT([2,n],s);if(t.length>3){let o;o=[1];for(let c=2;c<t.length;c++){let l=t[c];if(Array.isArray(l)){let u=op.getListBBox([...l.slice(1)]);op.KeepBBoxPolygonGroup(u,a)&&o.push(l)}else op.KeepBBoxPolygonGroup(l.bbox(),a)&&o.push(l)}return o.length<=1?[2,a]:(o=this.optimizeSplit(o,s),o.length>1?[2,a,...o.slice(1)]:[2,a])}else{let o=t[2];if(Array.isArray(o)&&o[0]===1&&o.length>2){let c=o.slice(1);return this.optimizeSplit([2,a,...c],s)}}}else if(t.slice(1).length>2){let n=t[1],a=t.slice(2),o=this.optimizeSplit([1,...a],s);return o.length>1?[2,n,...o.slice(1)]:n}}else if(r===1){if(t.length-1>Ur.LocalBestThread){let n=!1;for(let a=1;a<t.length;a++){let o=t[a];if(!Array.isArray(o)){n=!0;break}}n&&(t=XO.OcTreeOptimizeSplit(t))}}else if(r===0&&t.length<=2)return[0];let i=[r];for(let n=1;n<t.length;n++){let a=t[n];if(Array.isArray(a)){let o=this.optimizeSplit(a,s);if(o.length<=1)continue;i.push(o)}else i.push(a)}return i}},BF=(e=>(e[e.INTERSECT=0]="INTERSECT",e[e.UNION=1]="UNION",e[e.DIFF=2]="DIFF",e[e.XOR=3]="XOR",e))(BF||{});function pp(e){let t=e[0],s=[t];switch(t){case 0:for(let i=1;i<e.length;i++){let n=e[i];if(Array.isArray(n)&&(n=pp(n),!n))return null;s.push(n)}break;case 1:case 3:for(let i=1;i<e.length;i++){let n=e[i];Array.isArray(n)&&(n=pp(n),!n)||s.push(n)}break;case 2:let r=e[1];if(Array.isArray(r)&&(r=pp(r)),!r)return null;s.push(r);for(let i=2;i<e.length;i++){let n=e[i];Array.isArray(n)&&(n=pp(n),!n)||s.push(n)}break;default:throw new Error("not support boolean rule!")}return s.length===1?null:s}function pT(e,t,s){return Array.isArray(e)?ZO(e,t,s):e}function fT(e,t,s,r,i=!0){if(i)for(;e.length>1;){let n,a=[];for(e.length%2===1?(a.push(e[0]),n=1):n=0;n<e.length;n+=2)a.push(t(e[n],e[n+1],s,r));e=a}else for(;e.length>1;){if(e.length===2)return t(e[0],e[1],s,r);e=[t(e[0],e[1],s,r),...e.slice(2)]}return e[0]}function ZO(e,t,s,r=!0){let i=new Array(e.length-1);for(let n=1;n<e.length;n++)i[n-1]=pT(e[n],t,s);switch(e[0]){case 0:return fT(i,ap.intersect,t,s);case 1:return fT(i,ap.union,t,s);case 2:let n=fT(i.slice(1),ap.union,t,s);return n?ap.diff(i[0],n,t,s):i[0];case 3:let a=pT(e[1],t,s);for(let o=2;o<e.length;o++)a=ap.xor(a,pT(e[o],t,s),t,s);return a;default:throw new Error("not support boolean rule! "+e[0])}}function $O(e){let t=[e[0]];for(let s=1;s<e.length;s++){let r=e[s];if(Array.isArray(r)){let i=$O(r);Array.isArray(i)?i.length>1&&t.push(i):t.push(i)}else{let i=Xy(r);i!==null&&t.push(Vs.build(i))}}return t}function kF(e,t){Ur.curBus=t,e=$O(e);let s;return Ur.UseRunArrange?s=LF.simplifyRules(e,t):s=pp(e),s.length<=1?new Vs([]):vT(s,t)}function vT(e,t,s=!0){if(!e||e.length===1)return new Vs([]);let r=e,i=new RF,n=[];function a(o){for(let c=1;c<o.length;c++){let l=o[c];Array.isArray(l)?a(l):n.push(l)}}return a(r),i.init(n),ZO(r,i,t,s)}var Ly=new Error("list is empty"),By=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},MF=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},jF=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},FF=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Ly;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Ly;return this.remove(e),e.item}addLast(e){if(this.first===null||this.last===null){let t=new By(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new By(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Ly;return this.first.item}getLast(){if(this.last===null)throw Ly;return this.last.item}insertAfter(e,t){let s=new By(this,t);return e.insertAfter(s),e===this.last&&(this.last=s),this.cnt++,s}insertBefore(e,t){let s=new By(this,t);return e.insertBefore(s),e===this.first&&(this.first=s),this.cnt++,s}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new MF(this.first)}listIterator(){return new jF(this.first)}toArray(){let e=new Array,t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e}},Hy=class{constructor(e){this.inters=[],e&&(this.inters=e)}addInter(e){this.inters.push(e),e.group=this}findInter(e){let t=this.inters.find(s=>$e(s.coord,e.coord));return t&&this.inters.find(s=>s.side===e.side)&&e.visitSelf(),t}getOutInter(e){let t=this.inters.filter(s=>!s.getVisited());if(t.length!==0)return t.length===1?t[0]:t.reduce((s,r)=>{if(!s||s.side.getShape()===e)return r;if(r.side.getShape()===e)return s;let i=s.coord,n=st(e,i),a=st(s.side.getShape(),i),o=st(r.side.getShape(),i);return n.dot(a)>n.dot(o)?s:r},void 0)}getEntryInter(){}},mT=0;function QO(e,t){let s=e.primitives[0];if(e.primitives.length===1&&s instanceof we&&Math.abs(s.sweepAngle)===360)return[e];let r=Ip();mT++;let i,n=JF(e);if(n.length===0)return[];let a=GF(n);if(mT===-1){i=new Pp(t);let u=i.initColor(Lt.BLUE);n.forEach(p=>u.addPt(p.getShape()));let h=i.initColor(Lt.GREEN);a.forEach(p=>h.addPoint(p.coord)),i.draw();debugger;throw new Error}if(a.length===0)return[Tt.build7(n.map(u=>u.getShape()))];YF(a);let o=[],c=!1;try{WF(a,i)}catch(u){u.customType==="IS_OVERLAP"?(c=!0,o=new up().getUnion([e]).map(h=>h.items).flat(2)):console.error(u)}if(c)return o;let l=zF(a);if(!l.length)return[Tt.build7(n.map(u=>u.getShape()))];if(o=UF(l,i),o.length===0)return console.warn("=====deSelfIntersection=====",mT),[];if(i)throw o.forEach(u=>{i.initColor(Lt.WHITE).addPly(u),i.draw();debugger}),new Error;return Ca.deSelfIntersection+=nc(r),o}function UF(e,t){let s=[];return e.forEach(r=>{let i=r;r.inters.forEach(n=>{if(n.getVisited())return;let a=[],o=[],c;if(t){debugger;let u=t.initColor(Lt.RED);c=h=>{a.push(h),u.addPt(a[a.length-1]),t.draw();debugger}}else c=u=>a.push(u);do{let u=function(m,g){_e.eq(m.distance2(g),0)||c(eI(d.getShape(),m,g))},h=o.findIndex(m=>m===n.group);if(h!==-1){let m=a.findIndex(E=>E===n.group),g=a.splice(m).filter(E=>!(E instanceof Hy));if(g.length){let E=cc(Tt.build7(g));E&&s.push(E)}let b=a.filter(E=>!(E instanceof Hy));if(n=o[h].getOutInter(b[b.length-1]),o.splice(h),!n)throw Error("interGroup not hav inter!!!2");continue}n.visitSelf(),o.push(n.group),a.push(n.group);let p=n.getIndex(),d=n.side,f=d.inters[p+1];for(;f!=null&&f.isInvalid||f&&f.group===n.group;)f=d.inters[f.getIndex()+1];if(f){u(n.coord,f.coord);let m=f.getBindedInter();if(n=m.getVisited()?m.group.getOutInter(m.side.getShape()):m,!n){if(f.group===i)break;throw new Error("interGroup not hav inter!!!3")}}else{for(u(n.coord,d.getEnd()),d=d.nextSide,n=null;;){for(let m of d.inters)if(!m.isInvalid){let g=m.group.getOutInter(d.getShape());if(!g){if(m.group===i){n=m;break}else if(m.getBindedInter().group===i){n=m.getBindedInter();break}continue}n=g;break}if(n)break;c(d.getShape()),d=d.nextSide}_e.eq(d.getEnd().distance2(n.coord),0)?c(d.getShape()):u(d.getStart(),n.coord)}}while(n.group!==i);let l=cc(Tt.build7(a.filter(u=>!(u instanceof Hy))));l&&s.push(l)})}),s}function HF(e){return{next(){return e.hasNext()?{value:e.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function GF(e){let t=[],s=new FF;for(let r of e.slice().sort((i,n)=>i.bbox().minY-n.bbox().minY)){for(let i of HF(s.listIterator())){let n=i.item;if(n.bbox().maxY<r.bbox().minY)s.remove(i);else{let a=function(p,d){let f=new po(d,p,null);return p.inters.push(f),t.push(f),f},o=function(p,d){let f=p.getEnd(),m=new de(te[0],te[1]),g=new de(te[2],te[3]),b=f.distance2(m)>f.distance2(g)?m:g,E=p.prevSide;a($e(E.getEnd(),b)?E:p,b).bind(a(d,b))},c=n.getShape(),l=r.getShape(),u=bn(c,l),h=u===4&&te[0]===te[2]&&te[1]===te[3];if(h&&(u-=2),n.nextSide===r)n.prevSide!==r&&u===4&&o(n,r);else if(n.prevSide===r)u===4&&o(r,n);else if(u!==0){let p=function(f,m){let g=f.prevSide;return a($e(g.getEnd(),m)?g:f,m)},d=new de(te[0],te[1]);if(h&&!$e(d,n.prevSide.getEnd())&&!$e(d,r.prevSide.getEnd())&&st(c,d).dot(st(l,d))>0)continue;for(let f=0;f<u;f+=2){let m=new de(te[f],te[f+1]);p(n,m).bind(p(r,m))}}}}s.add(r)}return t.forEach(r=>{r.getIndex()===void 0&&r.side.sortInters()}),t}function YF(e){e.forEach(t=>{let s=t.side.getEnd();if(t.isInvalid||!$e(t.coord,s))return;let r=t.side.inters,i=t.getBindedInter().side;for(let n=r.length-1;n>=0;n--){let a=r[n];if(!$e(a.coord,s))break;a!==t&&a.getBindedInter().side===i&&a.setIsInvalid()}})}function VF(e){let t=new wp(10);return e.forEach(s=>{s.isInvalid||t.add(s)}),t}function zF(e){let t=[],s=VF(e);return e.forEach(r=>{if(r.isInvalid||r.group)return;let i=s.search(r.bbox().extendOfSize(_e.eps)).filter(n=>!n.group);if(i.length){let n=new Set,a=new Hy(i);i.forEach(o=>{o.group=a,n.has(o.side)&&o.visitSelf(),n.add(o.side)}),t.push(a)}}),t}function WF(e,t){e.forEach(s=>{if(s.isInvalid||s.dealed)return;let r=s.side,i=s.getBindedInter().side,n;$e(r.getEnd(),s.coord)&&$e(i.getEnd(),s.coord)?n=-1:$e(r.getEnd(),s.coord)?r.nextSide!==i&&(n=1,s=s.getBindedInter()):$e(i.getEnd(),s.coord)&&i.nextSide!==r&&(n=1),qF(n,s,t),s.isDealed()})}function qF(e,t,s){let r=t.getBindedInter(),i=t.side,n=r.side,a=i.getShape(),o=n.getShape(),c=1,l=!1;if(e===-1){if(qu(a.reverse(),o.reverse())||qu(i.nextSide.getShape(),n.nextSide.getShape())){let h=lo(i,i.nextSide,n,r,c,l,s);if(h.state===2){let d=new Error("info1.state === InState.IS_OVERLAP");throw d.customType="IS_OVERLAP",d}let p=lo(i,i.nextSide,n.nextSide,r,c,l,s);h.state===p.state&&u(h,p)}else if(!(qu(a.reverse(),n.nextSide.getShape())||qu(i.nextSide.getShape(),o.reverse()))){let h=cT(i,i.nextSide,n,!1,s);h===cT(i,i.nextSide,n.nextSide,!0,s)&&h!==cT(n,n.nextSide,i.nextSide,!0,s)&&t.setIsInvalid()}}else if(e===1){let h=function(p,d){return st(p,d.start()).dot(st(d,d.start()))>0};if(qu(a.reverse(),o.reverse())||qu(a,n.nextSide.getShape())){let p=en(i,n,r,s,c,l,new Map);if(p.state===2){let f=new Error("info1.state === InState.IS_OVERLAP");throw f.customType="IS_OVERLAP",f}let d=en(i,n.nextSide,r,s,c,l,new Map);p.state===d.state&&u(p,d)}else if(h(a.reverse(),o.reverse())&&h(a,n.nextSide.getShape())){let p=br(i,n,!1,s);p===br(i,n.nextSide,!0,s)&&p!==ol(n,n.nextSide,new Op(eI(a,t.coord,a.end()),s),!0,s)&&t.setIsInvalid()}}function u(h,p){h.inter.setIsInvalid(),p.inter.setIsInvalid(),t.setIsInvalid()}}function eI(e,t,s){if(e instanceof le||t.distance2(s)<1e-6)return new le(t,s);if(e instanceof we)return we.build2(e.center,t.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.sweep());if(e instanceof qe){let r=e.getPercent(t,rt),i=e.getPercent(s,rt);return e.clip(r)[1].clip((i-r)/(1-r))[0]}else throw new Error("not supported operation")}function JF(e){let t=cc(e);if(!t)return[];let s=t.primitives.map(i=>new Op(i,null)),r=s[s.length-1];return s.forEach(i=>{r.connect(i),r=i}),s}var go,KF=(go=class{static clearData(t){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new Pp(t):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let t=this.drawDebug.initColor(Lt.WHITE);this.originalPrimitive.forEach(s=>t.addPt(s)),this.drawDebug.draw();debugger}for(let t=0;t<this.originalPrimitive.length;t+=1){let s=this.originalPrimitive[t];this.offsetPrimitive.push({index:t,offsetEdge:this.createOffsetEdge(s)})}if(this.drawDebug){let t=this.drawDebug.initColor(Lt.Golden);this.offsetPrimitive.forEach(s=>t.addPt(s.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let t=0;t<this.offsetPrimitive.length;t+=1)if(t===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[0]);let s=this.rawOffsetPrimitive[0],r;s instanceof we?r=we.build4(this.offsetPrimitive[0].offsetEdge.start(),s.end(),s.center,s.rx,s.ry,s.sweep()):r=new le(this.offsetPrimitive[0].offsetEdge.start(),s.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(r)}else this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[t+1]);else this.rawOffsetPrimitive=[]}static createCirclePrimitive(t,s){let r=t.width()*.5,i=t.height()*.5,n=Math.sqrt(r**2+i**2)+s;return[we.buildCircle(t.center(),n)]}static getExtendPolyLine(t,s,r=!0,i){var o,c;if(!((o=t==null?void 0:t.primitives)!=null&&o.length))return[];let n=cc(t);if(!((c=n==null?void 0:n.primitives)!=null&&c.length)){if(this.isExpansion){let l=[1],u=s*2;t.primitives.forEach(p=>l.push(p.stroke(u,1,0)));let h=kF(l,i);if(h.items.length!==1)throw new Error("group.items.length !== 1 ");return[h.items[0].items[0]]}return[]}if(t=n,this.clearData(i),this.originalPrimitive=t.primitives,this.isExpansion=s>0,this.offsetDistance=s,this.createRawOffsetEdge(),this.drawDebug){let l=this.drawDebug.initColor(Lt.BLUE);this.rawOffsetPrimitive.forEach(u=>l.addPt(u)),this.drawDebug.draw();debugger}let a=r?this.createClippingEdge(i):[Tt.build2(this.rawOffsetPrimitive)];if(this.drawDebug){let l=this.drawDebug.initColor(Lt.RED);a.forEach(u=>l.addPly(u)),this.drawDebug.draw();debugger}if(a.length&&(!this.isExpansion||this.isExpansion&&a.length>1)&&(a=this.getValidityPrimitive(a)),this.drawDebug){let l=this.drawDebug.initColor(Lt.GREEN);a.forEach(u=>l.addPly(u)),this.drawDebug.draw();debugger;throw new Error}return a}static getValidityPrimitive(t){let s=[],r=Math.abs(this.offsetDistance);for(let i=0;i<t.length;i+=1){let n=!0,a=t[i].primitives;e:for(let o=0;o<a.length;o+=1){let c=a[o],l;if(c instanceof we)l=c.midPoint;else if(c instanceof le)l=c.start();else throw new Error("not support!");for(let u=0;u<this.originalPrimitive.length;u+=1){let h=this.originalPrimitive[u],p;if(h instanceof we?p=this.pointArcClosest(l,h):p=x9(l,h.start(),h.end()).d,r-p>.01){n=!1;break e}}}n&&s.push(t[i])}return s}static getInters(t){let s=[];for(let r=0;r<t;r+=2)s.push(new de(te[r],te[r+1]));return s}static pointArcClosest(t,s){let r=s.center;if(t.equals1(s.center))return s.rx;if(s.inArea(t,0)){let a=t.sub(r);return Math.abs(a.length()-s.rx)}let i=t.distance2(s.start()),n=t.distance2(s.end());return _e.less(i,n)?Math.sqrt(i):Math.sqrt(n)}static createClippingEdge(t){let s=[],r=[],i=QO(Tt.build2(this.rawOffsetPrimitive),t);i.forEach(a=>{let o=a.area(.01);s.push(o)});let n=Math.min(...s.filter(a=>a<0));for(let a=0;a<s.length;a+=1){let o=s[a];_e.eq(o,0)||(!this.isExpansion&&o<0||this.isExpansion&&(o<0&&s[a]===n||o>0))&&r.push(i[a])}return r}static createOffsetEdge(t){if(t instanceof we)return t.panDistance1(this.offsetDistance);if(t instanceof le)return t.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(t,s){t.offsetEdge instanceof le&&s.offsetEdge instanceof le?this.lineToLineConnect(t,s):t.offsetEdge instanceof we&&s.offsetEdge instanceof we?this.arcToArcConnect(t,s):t.offsetEdge instanceof le&&s.offsetEdge instanceof we?this.lineToArcConnect(t,s):this.arcToLineConnect(t,s)}static isFalseIntersection(t){return t>1||t<0}static lineToLineConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=s.index,a=this.originalPrimitive[n].start();if(r.isParallel(i))r.bbox().intersection1(i.bbox())?this.rawOffsetPrimitive.push(r):this.lineToLineUseArcToConnect(a,r,i);else{let o=this.getLineToLineT(r,i),c=o[0],l=o[1];if(this.isFalseIntersection(c)||this.isFalseIntersection(l))c>1&&this.isFalseIntersection(l)?this.lineToLineUseArcToConnect(a,r,i):this.useLineToConnect(r,i);else if(!this.isFalseIntersection(c)&&!this.isFalseIntersection(l)){let u=r.end().sub(r.start()),h=r.start().add(u.mul(c)),p=new le(r.start(),h);this.rawOffsetPrimitive.push(p);let d=new le(h,i.end());this.updateNextOffsetPrimitive(n,d)}}}static updateNextOffsetPrimitive(t,s){this.offsetPrimitive[t].offsetEdge=s}static useLineToConnect(t,s){this.rawOffsetPrimitive.push(t);let r=new le(t.end(),s.start());this.rawOffsetPrimitive.push(r)}static lineToLineUseArcToConnect(t,s,r){let i=this.getSweep(t,s),n=this.getSweepAngel(s.end(),r.start(),t,i);if(n===0){this.useLineToConnect(s,r);return}this.rawOffsetPrimitive.push(s);let a=we.build5(s.end(),r.start(),n);this.rawOffsetPrimitive.push(a)}static getSweep(t,s,r){let i=null,n=r||r===0?this.originalPrimitive[r]:s;if(n instanceof we){let a=n.center.sub(n.end()).normalize();n.isCCW?i=new de(a.y,-a.x):i=new de(-a.y,a.x)}else i=s.end().sub(s.start()).normalize();return t.sub(s.end()).normalize().cross(i)>0?0:1}static getLineToLineT(t,s){let r=t.end().sub(t.start()),i=s.end().sub(s.start()),n=r.cross(i),a=s.start().sub(t.start()),o=t.start().sub(s.start()),c=a.cross(i)/n,l=o.cross(r)/-n;return[c,l]}static lineToArcConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=t.index,a=s.index,o=this.getLineJoinArcScalarAndIntersectionNum(r,i),c=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(c,r,i,n);else if(o.intersectionNum===1){let l=o.points[0];this.lineAndArcConnectionDetail(r,i,o.t[0],l,c,n,a)}else if(o.intersectionNum===2){let l=o.points[0],u=o.points[1],h=l.distance2(c),p=u.distance2(c);this.lineAndArcConnectionDetail(r,i,h<p?o.t[0]:o.t[1],h<p?l:u,c,n,a)}}static lineAndArcConnectionDetail(t,s,r,i,n,a,o){let c=this.isTrueArcIntersection(s,i);if(!this.isFalseIntersection(r)&&c){let l=new le(t.start(),i);this.rawOffsetPrimitive.push(l);let u;!s.center.equals1(i)||s.sweepAngle>1e-4?(u=we.build4(i,s.end(),s.center,s.rx,s.ry,s.sweep()),u instanceof we&&u.sweepAngle===0&&(u=new le(u.start(),u.end()))):u=new le(s.center,i),this.updateNextOffsetPrimitive(o,u)}else c?this.useLineToConnect(t,s):this.lineAndArcUseArcConnect(n,t,s,a)}static lineAndArcUseArcConnect(t,s,r,i){let n=this.getSweep(t,s,i),a=this.getSweepAngel(s.end(),r.start(),t,n);if(a===0){this.useLineToConnect(s,r);return}let o=we.build5(s.end(),r.start(),a);this.rawOffsetPrimitive.push(s),this.rawOffsetPrimitive.push(o)}static arcToLineConnectionDetail(t,s,r,i,n,a,o){let c=this.isTrueArcIntersection(t,i);if(!this.isFalseIntersection(r)&&c){let l;t.center.equals1(i)?l=new le(t.center,i):Math.abs(t.sweepAngle)<1e-4?l=new le(t.start(),i):(l=we.build4(t.start(),i,t.center,t.rx,t.ry,t.sweep()),l instanceof we&&l.sweepAngle===0&&(l=new le(l.start(),l.end()))),this.rawOffsetPrimitive.push(l);let u=new le(i,s.end());this.updateNextOffsetPrimitive(o,u)}else c?this.useLineToConnect(t,s):this.lineAndArcUseArcConnect(n,t,s,a)}static isTrueArcIntersection(t,s){return Zs(t,s)}static getSweepAngel(t,s,r,i){let n=t.angleD(r),a=s.angleD(r),o;return n===a?o=0:(n=lt.regularD(n),a=lt.regularD(a),i===1?a<=n&&(a+=360):a>=n&&(n+=360),o=a-n),o}static getLineJoinArcScalarAndIntersectionNum(t,s){let r={t:[],intersectionNum:0,points:[]},i=P9(s,t);if(i){r.intersectionNum=i/2;for(let n=0;n<i-1;n+=2){let a=new de(te[n],te[n+1]);r.points.push(a),a.sub(t.start()).x<1e-4||a.sub(t.start()).y<1e-4?r.t.push(0):r.t.push(a.sub(t.start()).x/t.end().sub(t.start()).x)}}else r.intersectionNum=0;return r}static arcToLineConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=t.index,a=s.index,o=this.getLineJoinArcScalarAndIntersectionNum(i,r),c=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(c,r,i,n);else if(o.intersectionNum===1){let l=o.points[0];this.arcToLineConnectionDetail(r,i,o.t[0],l,c,n,a)}else if(o.intersectionNum===2){let l=o.points[0],u=o.points[1],h=l.distance2(c),p=u.distance2(c);this.arcToLineConnectionDetail(r,i,h<p?o.t[0]:o.t[1],h<p?l:u,c,n,a)}}static rxChangeStatus(t){return t===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(t,s){let r=t.offsetEdge,i=s.offsetEdge,n=NO(r,i);if(n){let a=this.getInters(n),o;if(a.length===2){let u=this.originalPrimitive[s.index].start(),h=a[0],p=a[1],d=h.distance2(u),f=p.distance2(u);d<f?o=h:o=p}else o=a[0];let c,l;o.equals1(r.center)?c=new le(r.center,o):Math.abs(r.sweepAngle)<1e-4?c=new le(r.start(),o):(c=we.build4(r.start(),o,r.center,r.rx,r.ry,r.sweep()),c instanceof we&&c.sweepAngle===0&&(c=new le(c.start(),c.end()))),this.rawOffsetPrimitive.push(c),o.equals1(i.center)?l=new le(o,i.center):Math.abs(i.sweepAngle)<1e-4?l=new le(o,i.end()):(l=we.build4(o,i.end(),i.center,i.rx,i.ry,i.sweep()),l instanceof we&&l.sweepAngle===0&&(l=new le(l.start(),l.end()))),this.updateNextOffsetPrimitive(s.index,l)}else{let a=this.originalPrimitive[t.index],o=this.originalPrimitive[s.index],c=this.rxChangeStatus(a.sweep()),l=this.rxChangeStatus(o.sweep()),u=this.originalPrimitive[s.index].start(),h=this.getSweep(u,r,t.index),p=Math.abs(this.offsetDistance),d=we.build2(u,c?a.endAngle():a.endAngle()+180,l?o.startAngle:o.startAngle+180,p,p,h);this.rawOffsetPrimitive.push(r),this.rawOffsetPrimitive.push(d)}}},go.originalPrimitive=[],go.offsetPrimitive=[],go.rawOffsetPrimitive=[],go.testI=0,go),XF=class fp extends Cp{constructor(t,s,r,i,n,a){if(super(),s<0||r<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=t,this.width=s,this.height=r,this.angle=i,this.isCCW=n,this.radius=Math.min(Math.max(a,0),s/2,r/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new de(this.radius,0).multiply3(Wt.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new de(0,-this.height/2).multiply3(Wt.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new de(this.width,-this.height/2).multiply3(Wt.rotateD(this.angle)))}extend(t){return new fp(this.leftUpPoint.add(new de(-t,t).rotateD(de.ORIGIN,this.angle)),this.width+t*2,this.height+t*2,this.angle,this.isCCW,this.radius+t)}bbox(){let t=Wt.rotateD(this.angle),{leftUpPoint:s,width:r,height:i,radius:n}=this,a=s.add(new de(n,-n).multiply3(t)),o=s.add(new de(n,n-i).multiply3(t)),c=s.add(new de(r-n,-n).multiply3(t)),l=s.add(new de(r-n,n-i).multiply3(t));return new ei(Math.min(a.x,o.x,c.x,l.x)-n,Math.max(a.x,o.x,c.x,l.x)+n,Math.min(a.y,o.y,c.y,l.y)-n,Math.max(a.y,o.y,c.y,l.y)+n)}toPolyline(){let t=[],{leftUpPoint:s,width:r,height:i,radius:n}=this;if(n===0){let o=de.ORIGIN,c=new de(r,0),l=new de(r,-i),u=new de(0,-i);t.push(new le(o,c),new le(c,l),new le(l,u),new le(u,o))}else{let o=new de(0,-n),c=new de(n,0),l=new de(r-n,0),u=new de(r,-n),h=new de(r,n-i),p=new de(r-n,-i),d=new de(n,-i),f=new de(0,n-i);t.push(we.build1(o,c,n,n,!1,0),new le(c,l),we.build1(l,u,n,n,!1,0),new le(u,h),we.build1(h,p,n,n,!1,0),new le(p,d),we.build1(d,f,n,n,!1,0),new le(f,o))}t=t.filter(o=>!o.start().equals1(o.end())),this.isCCW&&(t.forEach((o,c)=>t[c]=o.reverse()),t.reverse());let a=Wt.rotateD(this.angle).translate1(s);return Tt.build2(t.map(o=>o.multiply3(a)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(t){let s=this.leftUpPoint.multiply3(t),r=new de(this.width,0).multiply3(Wt.rotateD(this.angle)).multiply3(t),i=new de(0,-this.height).multiply3(Wt.rotateD(this.angle)).multiply3(t);return t.isMirrored()?new fp(s,i.length(),r.length(),i.angleD(de.ORIGIN),this.isCCW===1?0:1,this.radius*r.length()/this.width):new fp(s,r.length(),i.length(),r.angleD(de.ORIGIN),this.isCCW,this.radius*r.length()/this.width)}reverse(){return new fp(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(t,s,r){let i=this.stroke1(t,s,r);if(i.length===1)return i[0];{let[n,a]=i;return Tt.build2(n.primitives.concat(new le(n.primitives[0].start(),a.primitives[0].start()),a.primitives,new le(a.primitives[0].start(),n.primitives[0].start())))}}stroke1(t,s,r){let i=r===this.isCCW?this:this.reverse(),n=t/2,a=Math.min(i.width,i.height)/2,o=i.extend(n).toPolyline();return a<=n?[o]:[o,i.extend(-n).toPolyline().reverse()]}points(t){let s=this.toPolyline(),r=[];return s.points(t,i=>r.push(i)),r}toBezier(){throw new Error("Method not implemented.")}},ZF=.01,hr=class Gn{static simplify(t){return t=cc(t),t?new Gn([t]):null}static buildByStroke(t,s,r=1,i=jT,n){if(t instanceof we&&(t.rx<s/2+ZF||Math.abs(t.sweepAngle)>180&&_e.lesseq(t.start().distance1(t.end()),s))){let o=QO(t.stroke(s,r,0),n);if(o.length===0)return null;if(o.length===1)return new Gn(o);let c=[null],l=Number.POSITIVE_INFINITY;return o.forEach(u=>{let h=u.area(.1);h<0?h<l&&(c[0]=u,l=h):c.push(u)}),new Gn(c)}else if(t instanceof XF){let o=t.stroke1(s,r,0).map(c=>cc(c));return o[0]?o[1]?new Gn(o):new Gn([o[0]]):null}let a=t.stroke(s,r,0,i);return a?this.simplify(a):null}static buildCircle(t,s){return this.simplify(Tt.build7([we.buildCircle(t,s,0)]))}static buildRect(t){return this.simplify(t.toPolyline())}static buildBBox(t){return this.simplify(Tt.buildBBox(t,0))}constructor(t){this.items=t.slice()}multiply3(t){return new Gn(this.items.map(s=>s.multiply3(t)))}bbox(){return this.items[0].bbox()}isEqual(t){return t instanceof Gn?this.items.every(s=>t.items.some(r=>r.isEqual(s))):!1}getOutMostPolyline(){return this.items[0]}extend(t,s){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(t===0)return new Vs([this]);let r=this.items[0],i=[];for(let u of r.primitives)if(u instanceof le)i.push(u);else if(u instanceof we&&u.rx===u.ry)a(u);else if(u instanceof qe)n(u);else throw new Error("not support!");r=Tt.build7(i);function n(u){let h=u.points(.1);for(let p=0;p<h.length-1;p++){let d=h[p],f=h[p+1];i.push(new le(d,f))}}function a(u){if(Math.abs(u.sweepAngle)>270){let h=u.sweepAngle/2;a(we.build3(u.center,u.startAngle,h,u.rx,u.ry)),a(we.build3(u.center,u.startAngle+h,h,u.rx,u.ry))}else i.push(u)}let o=[],c=[];KF.getExtendPolyLine(r,t,!0,s).forEach(u=>{(u.area(.1)>0?c:o).push(u)});let l;if(o.length===1)c.forEach(u=>o.push(u)),l=new Vs([new Gn(o)]);else if(o.length===0)console.warn("outlines.length === 0"),l=new Vs([]);else if(c.length===0)l=new Vs(o.map(u=>new Gn([u])));else{let u=o.map(h=>[h]);c.forEach(h=>{let p=[],d=h.bbox();if(u.forEach(f=>{f[0].bbox().isContainsBBox1(d)&&p.push(f)}),p.length===1)p[0].push(h);else{if(p.length===0)throw new Error("inPlsArr.length === 0");for(let f of p.sort((m,g)=>m[0].bbox().area()-g[0].bbox().area()))if(f[0].getWindingNum(h.start())===-1){f.push(h);break}}}),l=new Vs(u.map(h=>new Gn(h)))}return l}toPolylineGroup(){return new FT(this.items)}};var $F=(e=>(e[e.POLYGON=1]="POLYGON",e[e.POLYLINE=2]="POLYLINE",e[e.LINE=3]="LINE",e[e.ARC=4]="ARC",e[e.BEZIER2=5]="BEZIER2",e[e.BEZIER3=6]="BEZIER3",e[e.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",e[e.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",e[e.BOOLEAN_UNION=9]="BOOLEAN_UNION",e[e.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",e[e.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",e[e.LINES=12]="LINES",e[e.ARCS=13]="ARCS",e[e.BEZIER2S=14]="BEZIER2S",e[e.BEZIER3S=15]="BEZIER3S",e[e.CIRCLE_CW=16]="CIRCLE_CW",e[e.CIRCLE_CCW=17]="CIRCLE_CCW",e[e.POLYGON_GROUP=18]="POLYGON_GROUP",e))($F||{});var QF=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function eU(e){return new QF(e)}function tU(e){return e===32||e===9||e===13||e===10}var sU=class{constructor(){this._line=1,this._col=0}line(){return this._line}col(){return this._col}_feed(e){return e===10?(this._col=0,this._line++):this._col++,this.feed(e)}parse(e){let t=e.length;for(let s=0;s<t;s++){let r=e.charCodeAt(s);if(!this._feed(r))return this}return this.finish(),this}},gT=class{static repeat(e,t){let s=new Array(t);for(;t-- >0;)s[t]=e;return s.join("")}static lpad(e,t,s){let r=s-e.length;return r>0?this.repeat(t,r)+e:e}},rU=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(rU||{}),iU=/(\.?0+)$/,RT=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let s=this._format(e,t);if(typeof s=="string")return s;throw new Error(this.format("Invalid state on (%d) %s",s,e))}static _format(e,t){let s=[],r=0,i=0,n,a=0,o=0;for(let c=0;c<e.length;c++){let l=e.charAt(c),u=l.charCodeAt(0);switch(r){case 0:u===37?r=1:s.push(l);break;case 1:switch(u){case 100:if(n=t[i++],typeof n=="number")s.push(n.toFixed(0)),r=0;else return c;break;case 102:if(n=t[i++],typeof n=="number")s.push(n.toString()),r=0;else return c;break;case 120:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16)),r=0;else return c;break;case 88:if(n=t[i++],typeof n=="number")s.push((n|0).toString(16).toUpperCase()),r=0;else return c;break;case 115:case 99:n=t[i++],s.push(n===null?"null":n.toString()),r=0;break;case 48:a=c+1,o=-1,r=2;break;case 37:s.push("%"),r=0;break;default:return c}break;case 2:switch(u){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=c;break;case 100:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(gT.lpad((n|0).toString(10),"0",h)),r=0;else return c}else return c;break;case 120:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(gT.lpad((n|0).toString(16),"0",h)),r=0;else return c}else return c;break;case 88:if(o>=a){let h=parseInt(e.substring(a,o+1));if(n=t[i++],typeof n=="number")s.push(gT.lpad((n|0).toString(16).toUpperCase(),"0",h)),r=0;else return c}else return c;break;default:return c}break;default:return c}}return s.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static fmtNumber(e){return e.toFixed(5).replace(iU,"")}},nU=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(nU||{});function aU(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var oU=(e,t)=>{e===3?console.error(...t):e===2?console.warn(...t):console.log(...t)},cU=(e,t)=>[aU(e)].concat(t),yo,lU=(yo=class{static mix(...t){return new yo(0,(s,r)=>{for(let i of t)i.write(s,r)},(s,r)=>r)}constructor(t,s=oU,r=cU){this.level=t,this.writer=s,this.fmt=r}setLevel(t){this.level=t}prepend(t=null,s=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),i=s===null?this.writer:(n,a)=>{s(n,a),this.writer(n,a)};return new yo(this.level,i,r)}chain(t){return t.prepend(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}formatWrite(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,[RT.format(s,...r)]))}write(t,s){this.include(t)&&this.writer(t,this.fmt(t,s))}write3(t,s,r){this.include(t)&&this.writer(t,this.fmt(t,[RT.format(s,...r)]))}debug3(t,...s){this.write3(0,t,s)}warning3(t,...s){this.write3(2,t,s)}debugFmt(t,...s){this.formatWrite(0,t,s)}debug(...t){this.write(0,t)}infoFmt(t,...s){this.formatWrite(1,t,s)}info(...t){this.write(1,t)}warningFmt(t,...s){this.formatWrite(2,t,s)}warning(...t){this.write(2,t)}errorFmt(t,...s){this.formatWrite(3,t,s)}error(...t){this.write(3,t)}},yo.DUMMY=new yo(4),yo),yT=500,fO=String.fromCharCode,uU=class{constructor(){this.buffer=new Array}size(){return this.buffer.length}isEOF(){return!1}write(e){return this.buffer.push(e),1}writen1(e){return this.writen2(e,0,e.length)}writen2(e,t,s){let r=this.buffer;for(let i=0,n=t;i<s;i++,n++)r.push(e[n]);return s}writeAsync(e,t){t(this.write(e))}writenAsync1(e,t){t(this.writen1(e))}writenAsync2(e,t,s,r){r(this.writen2(e,t,s))}writeStr(e){let t=e.length,s=new Array(t);for(let r=0;r<t;r++)s[r]=e.charCodeAt(r);return this.writen1(s)}clear(){this.buffer.length=0}toString(){let e=this.buffer,t=e.length;if(t<=yT)return fO.apply(null,e);{let s=new Array;for(let r=0;r<e.length;r+=yT){let i=Math.min(t-r,yT),n=fO.apply(null,e.slice(r,r+i));s.push(n)}return s.join("")}}},tI=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.NUMBER_INTEGER=1]="NUMBER_INTEGER",e[e.NUMBER_DECIMAL=2]="NUMBER_DECIMAL",e[e.NUMBER_E=3]="NUMBER_E",e[e.NUMBER_E_SIGNED=4]="NUMBER_E_SIGNED",e))(tI||{}),sI=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.MOVE_X=1]="MOVE_X",e[e.MOVE_Y=2]="MOVE_Y",e[e.LINE_X=3]="LINE_X",e[e.LINE_Y=4]="LINE_Y",e[e.HORIZONTAL_X=5]="HORIZONTAL_X",e[e.VERTICAL_Y=6]="VERTICAL_Y",e[e.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",e[e.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",e[e.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",e[e.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",e[e.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",e[e.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",e[e.ARC_RX=13]="ARC_RX",e[e.ARC_RY=14]="ARC_RY",e[e.ARC_ROTATION=15]="ARC_ROTATION",e[e.ARC_LARGE=16]="ARC_LARGE",e[e.ARC_SWEEP=17]="ARC_SWEEP",e[e.ARC_X=18]="ARC_X",e[e.ARC_Y=19]="ARC_Y",e[e.SMOOTH_CUBIC_BEZIER_X2=20]="SMOOTH_CUBIC_BEZIER_X2",e[e.SMOOTH_CUBIC_BEZIER_Y2=21]="SMOOTH_CUBIC_BEZIER_Y2",e[e.SMOOTH_CUBIC_BEZIER_X=22]="SMOOTH_CUBIC_BEZIER_X",e[e.SMOOTH_CUBIC_BEZIER_Y=23]="SMOOTH_CUBIC_BEZIER_Y",e[e.QUADRATIC_BEZIER_X1=24]="QUADRATIC_BEZIER_X1",e[e.QUADRATIC_BEZIER_Y1=25]="QUADRATIC_BEZIER_Y1",e[e.QUADRATIC_BEZIER_X=26]="QUADRATIC_BEZIER_X",e[e.QUADRATIC_BEZIER_Y=27]="QUADRATIC_BEZIER_Y",e))(sI||{});function hU(e){return 97<=e&&e<=122||65<=e&&e<=90}function yr(e){let t=parseFloat(e);if(isFinite(t))return t;throw new Error("expect number")}var mO=class extends sU{constructor(e,t=!0,s=lU.DUMMY){super(),this.buffer=new uU,this.group=new Array,this.subPartStart=de.ORIGIN,this.curPoint=de.ORIGIN,this.lexState=0,this.parseState=0,this.isAbsolute=!1,this.isLargeArc=!1,this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=Number.NaN,this.y=Number.NaN,this.rx=Number.NaN,this.ry=Number.NaN,this.rotation=Number.NaN,this.sweep=ic.CCW,this.prevBezierCtrl2=null,this.logger=s,this.cb=e,this.yAxis=t?-1:1}on(e){return this.cb(e)}feed(e){switch(this.logger.include(0)&&this.logger.debug3("L: %c(%s)|%s",e,String.fromCharCode(e),tI[this.lexState]),this.lexState){case 0:return tU(e)?!0:48<=e&&e<=57||e===45||e===43?(this.pushBuffer(e),this.lexState=1,!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):hU(e)?this.feedS(String.fromCharCode(e)):(this.logger.warning3("unknow letter %c",e),!0);case 1:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 2:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 3:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===45||e===43?(this.pushBuffer(e),this.lexState=4,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 4:return 48<=e&&e<=57?(this.pushBuffer(e),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;default:return!0}}finish(){this.feed(32),this.tryNotify()}feedS(e){switch(this.logger.include(0)&&this.logger.debug3("P: %s|%s|%s|%s",e,sI[this.parseState],this.curPoint,this.subPartStart),this.parseState){case 0:switch(e){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new le(this.curPoint,this.subPartStart));let r=this.tryNotify();return this.curPoint=this.subPartStart,r}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=20;break;case"s":this.isAbsolute=!1,this.parseState=20;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=24;break;case"q":this.isAbsolute=!1,this.parseState=24;break;default:this.logger.warning3("unknow %s",e)}return!0;case 1:let t=this.tryNotify();return this.x=yr(e),this.parseState=2,t;case 2:{this.y=this.yAxis*yr(e);let r;return this.isAbsolute?r=new de(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.curPoint=r,this.subPartStart=r,this.parseState=3,!0}case 3:return this.x=parseFloat(e),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(e));case 4:{this.y=this.yAxis*yr(e);let r;return this.isAbsolute?r=new de(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.group.push(new le(this.curPoint,r)),this.curPoint=r,this.parseState=3,!0}case 5:if(this.x=parseFloat(e),isFinite(this.x)){let r;return this.isAbsolute?r=new de(this.x,this.curPoint.y):r=this.curPoint.add1(this.x,0),this.group.push(new le(this.curPoint,r)),this.curPoint=r,!0}else return this.parseState=0,this.feedS(e);case 6:if(this.y=parseFloat(e),isFinite(this.y)){this.y=this.yAxis*this.y;let r;return this.isAbsolute?r=new de(this.curPoint.x,this.y):r=this.curPoint.add1(0,this.y),this.group.push(new le(this.curPoint,r)),this.curPoint=r,!0}else return this.parseState=0,this.feedS(e);case 7:let s=parseFloat(e);return isFinite(s)?(this.x1=s,this.parseState=8,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 8:return this.y1=this.yAxis*yr(e),this.parseState=9,!0;case 9:return this.x2=yr(e),this.parseState=10,!0;case 10:return this.y2=this.yAxis*yr(e),this.parseState=11,!0;case 11:return this.x=yr(e),this.parseState=12,!0;case 12:{this.y=this.yAxis*yr(e);let r,i,n;return this.isAbsolute?(r=new de(this.x1,this.y1),i=new de(this.x2,this.y2),n=new de(this.x,this.y)):(r=this.curPoint.add1(this.x1,this.y1),i=this.curPoint.add1(this.x2,this.y2),n=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=i,this.group.push(new qe([this.curPoint,r,i,n])),this.curPoint=n,this.parseState=7,!0}case 13:return this.rx=parseFloat(e),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(e));case 14:return this.ry=yr(e),this.parseState=15,!0;case 15:return this.rotation=yr(e),this.parseState=16,!0;case 16:return this.isLargeArc=yr(e)===1,this.parseState=17,!0;case 17:return this.sweep=yr(e)===1?ic.CW:ic.CCW,this.parseState=18,!0;case 18:return this.x=yr(e),this.parseState=19,!0;case 19:{this.y=this.yAxis*yr(e);let r;return this.isAbsolute?r=new de(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.rx&&this.ry&&this.group.push(we.build1(this.curPoint,r,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=r,this.parseState=13,!0}case 20:return this.x2=parseFloat(e),isFinite(this.x2)?(this.parseState=21,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 21:return this.y2=this.yAxis*yr(e),this.parseState=22,!0;case 22:return this.x=yr(e),this.parseState=23,!0;case 23:{this.y=this.yAxis*yr(e);let r,i;this.isAbsolute?(r=new de(this.x2,this.y2),i=new de(this.x,this.y)):(r=this.curPoint.add1(this.x2,this.y2),i=this.curPoint.add1(this.x,this.y));let n;return this.prevBezierCtrl2?n=this.curPoint.add(this.curPoint.sub(this.prevBezierCtrl2)):n=this.curPoint,this.prevBezierCtrl2=r,this.group.push(new qe([this.curPoint,n,r,i])),this.curPoint=i,this.parseState=20,!0}case 24:return this.x1=parseFloat(e),isFinite(this.x1)?(this.parseState=25,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 25:return this.y1=this.yAxis*yr(e),this.parseState=26,!0;case 26:return this.x=yr(e),this.parseState=27,!0;case 27:{this.y=this.yAxis*yr(e);let r,i;return this.isAbsolute?(r=new de(this.x1,this.y1),i=new de(this.x,this.y)):(r=this.curPoint.add1(this.x1,this.y1),i=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=r,this.group.push(new qe([this.curPoint,r,i])),this.curPoint=i,this.parseState=24,!0}default:return this.logger.warning3("unsupported parse state %s",this.parseState),!0}}pushBuffer(e){this.buffer.write(e)}getCleanBuffer(){let e=this.buffer.toString();return this.buffer.clear(),e}tryNotify(){if(this.group.length===0)return!0;{let e=Tt.build1(eU(this.group));return this.group.length=0,this.on(e)}}onException(e){throw e}},dU=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.ENC_LINE=1]="ENC_LINE",e[e.ENC_ARC=2]="ENC_ARC",e[e.ENC_CUBIC_BEZIER=3]="ENC_CUBIC_BEZIER",e[e.ENC_QUADRATIC_BEZIER=4]="ENC_QUADRATIC_BEZIER",e))(dU||{}),CX=RT.fmtNumber,gO=class{constructor(e=!0){this.buffer=new Array,this.state=0,this.prev=null,this.yAxis=e?-1:1}encPl(e){for(let t of e.primitives)this.encPt(t);return this}encPt(e){if(e instanceof le)this.encLine1(e);else if(e instanceof we)this.encArc(e);else if(e instanceof qe)this.encBezier(e);else throw new Error("");return this}encBezier(e){if(e.controls.length===3){let t=e.controls[0],s=e.controls[1],r=e.controls[2];this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"Q",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):t.equals1(this.prev)?this.state!==4?this.buffer.push("Q",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):this.buffer.push(s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):this.buffer.push("L",t.x,this.yAxis*t.y,"Q",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y),this.prev=r,this.state=4}else if(e.controls.length===4){let t=e.controls[0],s=e.controls[1],r=e.controls[2],i=e.controls[3];this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"C",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y):t.equals1(this.prev)?this.state!==3?this.buffer.push("C",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y):this.buffer.push(s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y):this.buffer.push("L",t.x,this.yAxis*t.y,"C",s.x,this.yAxis*s.y,r.x,this.yAxis*r.y,i.x,this.yAxis*i.y),this.prev=i,this.state=3}else throw new Error("only bezier has 3 or 4 control points supported");return this}encArc(e){let t=e.svgEnd;return this.state===0?this.buffer.push("M",e.start().x,this.yAxis*e.start().y,"A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===ic.CCW?0:1,t.x,this.yAxis*t.y):e.start().equals1(this.prev)?this.state!==2?this.buffer.push("A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===ic.CCW?0:1,t.x,this.yAxis*t.y):this.buffer.push(e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===ic.CCW?0:1,t.x,this.yAxis*t.y):this.buffer.push("L",e.start().x,this.yAxis*e.start().y,"A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===ic.CCW?0:1,t.x,this.yAxis*t.y),this.prev=t,this.state=2,this}encLine1(e){return this.encLine2(e.start(),e.end()),this}encLine2(e,t){return this.state===0?this.buffer.push("M",e.x,this.yAxis*e.y,"L",t.x,this.yAxis*t.y):(this.state!==1&&this.buffer.push("L"),e.equals1(this.prev)?this.buffer.push(t.x,this.yAxis*t.y):this.buffer.push(e.x,this.yAxis*e.y,t.x,this.yAxis*t.y)),this.prev=t,this.state=1,this}close(e){return this.state!==0&&(e&&this.buffer.push("Z"),this.state=0,this.prev=null),this}fixNumber(e=4){return this.buffer.forEach((t,s,r)=>{typeof t=="number"&&(t|0)!==t&&(r[s]=+t.toFixed(e))}),this}toString(){return this.buffer.join(" ")}toArray(){return this.buffer}},pU=class extends BT{constructor(){super(),this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.zIndex=0,this.zIndexMap=new Map}onParseLine(e){let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"LOCK":this.parseLock(e);break;case"HIDE":this.parseHide(e);break;case"INVISIBLE":this.parseInvisible(e);break;case"COVER":this.parseCover(e);break;case"TRN_CTRL":this.parseTrnCtrl(e);break;case"COMMENT":this.parseComment(e);break;case"FONT_CACHE":this.parseFontCache(e);break;case"TRANSFORM":this.parseTransform(e);break;case"GROUP":{let s=e[1];this.cache[t]||(this.cache[t]={errorIds:[]}),s!==null&&this.cache[t][s]?this.cache[t][s]=e:this.cache[t].errorIds.push(e);break}case"POLY":case"STRING":case"AUXLINE":case"DIMENSION":{this.zIndexMap.set(e[1],++this.zIndex);let s=bp(e[1]);this.cache[t]||(this.cache[t]={errorIds:[]}),s!==null&&!this.cache[t][s]?this.cache[t][s]=e:this.cache[t].errorIds.push(e);break}default:console.warn("can not find hanlder with",e)}}getZIndex(e){var t;return(t=this.zIndexMap.get(e))!=null?t:null}secondParseLine(e){switch(e[0]){case"GROUP":this.parseGroup(e);break;case"POLY":this.parsePoly(e);break;case"STRING":this.parseString(e);break;case"AUXLINE":this.parseAuxLine(e);break;case"DIMENSION":this.parseDimension(e);break}}onParseEnd(){for(let e in this.cache){let t=this.cache[e],s=Object.keys(t).sort((i,n)=>Number(i)-Number(n)),r=0;for(let i of s){if(i==="errorIds")continue;let n=Number(i),a=n-r-1;a>=1&&this.onPHolder(e,a),r=n,this.secondParseLine(t[n])}t.errorIds.forEach(i=>this.secondParseLine(i))}this.clearCache()}clearCache(){this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.version=void 0}parseDocType(e){this.version=Number(e[2])}parseHead(e){this.version<2&&e[1]&&e[1].print==="AHead Side"&&(e[1].print="Ahead Side"),this.onCanvas(e[1])}parseGroup(e){this.onGroup(e[1],e[2],e[3],!!e[4],!!e[5])}parseLock(e){this.lockConfig.push(...e[1])}parseHide(e){this.hideConfig.push(...e[1])}parseInvisible(e){this.invisibleConfig.push(...e[1])}parseCover(e){this.coverConfig[e[1]]=e[2]}parseTrnCtrl(e){this.trnCtrlConfig[e[1]]={scope:e[2],trans_print:e[3],trans_white:e[4]}}parseComment(e){this.commentConfig[e[1]]=e[2]}matrix2svg(e){let[t,s,r,i,n,a,o,c,l]=e.data;return[t,s,i,n,o,c]}encPath(e){let t=new Array;return new mO(s=>(t.push(new gO(!0).encPl(s).toArray().slice(1)),!0),!0).parse(e),t}parseRect(e){var S,_,C,x,D,I,P,L;let[,t,,s,r,i,n,a,o,,,c,l]=e,u=c[0],h=u[1],p=-u[2],d=u[1]+u[3],f=-u[2]+u[4],m=u[5],g=u[6],b=+u[7],E=+u[8],y=Wt.scale(d-h,f-p).rotateD(-b);E&&(y=y.multiply3(Wt.MIRROR_X)),y=y.translate(h,p),y=this.matrix2svg(y),y=this.encMatrix(y),this.onPoly(t,0,s,-b,r,i,n,a,o,!0,[["R",0,0,1,1,m,g,0,0]],!0,!0,this.lockConfig.some(F=>F===e[1]),this.hideConfig.some(F=>F===e[1]),this.invisibleConfig.some(F=>F===e[1]),s===1?1:(S=this.coverConfig[e[1]])!=null?S:null,l||((_=this.commentConfig[e[1]])!=null?_:null),s===2?3:(x=(C=this.trnCtrlConfig[e[1]])==null?void 0:C.scope)!=null?x:null,s===2?o:(I=(D=this.trnCtrlConfig[e[1]])==null?void 0:D.trans_print)!=null?I:null,s===2?1-o:(L=(P=this.trnCtrlConfig[e[1]])==null?void 0:P.trans_white)!=null?L:null,y!=null?y:null)}parseObj(e){var C,x,D,I,P,L,F,V;let[,t,,s,r,i,n,a,o,,,c,l]=e,[u,h,p,d,f,m,g,b,E]=c[0],y=Wt.rotateD(b);E&&(y=y.multiply3(Wt.MIRROR_X));let T;E?T=new le(new de(0,0),new de(0,-f)).multiply3(y):T=new le(new de(0,0),new de(d,0)).multiply3(y);let w=T.end().angleD(T.start()),S=E===1;d=E===1?f:d,f=E===1?d:f;let _=Wt.scale(d,f).rotateD(-w);S&&(_=_.multiply3(Wt.MIRROR_X)),_=_.translate(h,-p),_=this.matrix2svg(_),_=this.encMatrix(_),this.onPoly(t,0,s,-w,r,i,n,a,o,!0,[["R",0,0,1,1,0,0,0,0]],!1,!1,this.lockConfig.some(B=>B===e[1]),this.hideConfig.some(B=>B===e[1]),this.invisibleConfig.some(B=>B===e[1]),s===1?1:(C=this.coverConfig[e[1]])!=null?C:null,l||((x=this.commentConfig[e[1]])!=null?x:null),s===2?3:(I=(D=this.trnCtrlConfig[e[1]])==null?void 0:D.scope)!=null?I:null,s===2?o:(L=(P=this.trnCtrlConfig[e[1]])==null?void 0:P.trans_print)!=null?L:null,s===2?1-o:(V=(F=this.trnCtrlConfig[e[1]])==null?void 0:F.trans_white)!=null?V:null,_!=null?_:null)}parseEllipse(e){var T,w,S,_,C,x,D,I;let[,t,,s,r,i,n,a,o,,,c,l]=e,u=c[0],h=u[1],p=-u[2],d=u[3],f=u[4],m=+u[5],g=+u[6],b=Wt.scale(d,f).rotateD(-m);g&&(b=b.multiply3(Wt.MIRROR_X)),b=b.translate(h,p),b=this.matrix2svg(b),b=this.encMatrix(b),this.onPoly(t,0,s,-m,r,i,n,a,o,!0,[["ELLIPSE",0,0,1,1,0,0]],!0,!0,this.lockConfig.some(P=>P===e[1]),this.hideConfig.some(P=>P===e[1]),this.invisibleConfig.some(P=>P===e[1]),s===1?1:(T=this.coverConfig[e[1]])!=null?T:null,l||((w=this.commentConfig[e[1]])!=null?w:null),s===2?3:(_=(S=this.trnCtrlConfig[e[1]])==null?void 0:S.scope)!=null?_:null,s===2?o:(x=(C=this.trnCtrlConfig[e[1]])==null?void 0:C.trans_print)!=null?x:null,s===2?1-o:(I=(D=this.trnCtrlConfig[e[1]])==null?void 0:D.trans_white)!=null?I:null,b!=null?b:null)}parsePolyGroup(e){var d,f,m,g,b,E,y,T;let[,t,,s,r,i,n,a,o,,,c,l]=e,u=!0,h=!0,p=this.decMultiPoly(c).d;this.onPoly(t,0,s,0,r,i,n,a,o,!0,this.encPath(p),u,h,this.lockConfig.some(w=>w===e[1]),this.hideConfig.some(w=>w===e[1]),this.invisibleConfig.some(w=>w===e[1]),s===1?1:(d=this.coverConfig[e[1]])!=null?d:null,l||((f=this.commentConfig[e[1]])!=null?f:null),s===2?3:(g=(m=this.trnCtrlConfig[e[1]])==null?void 0:m.scope)!=null?g:null,s===2?o:(E=(b=this.trnCtrlConfig[e[1]])==null?void 0:b.trans_print)!=null?E:null,s===2?1-o:(T=(y=this.trnCtrlConfig[e[1]])==null?void 0:y.trans_white)!=null?T:null,null)}parsePoly(e){var t,s,r,i,n,a,o,c,l,u;if(this.version<2)if(e[11].length===1)switch(e[11][0][0]){case"R":{let h=e[7];return h.startsWith("data:")||h.startsWith("blob:")?this.parseObj(e):this.parseRect(e)}case"ELLIPSE":return this.parseEllipse(e);default:return this.parsePolyGroup(e)}else return this.parsePolyGroup(e);else this.onPoly(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],!!(e[12]||e[12]===void 0),!!(e[13]||e[13]===void 0),this.lockConfig.some(h=>h===e[1]),this.hideConfig.some(h=>h===e[1]),this.invisibleConfig.some(h=>h===e[1]),(t=this.coverConfig[e[1]])!=null?t:null,(s=this.commentConfig[e[1]])!=null?s:null,(i=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?i:null,(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,(c=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?c:null,(u=(l=this.transformConfig[e[1]])==null?void 0:l.matrix)!=null?u:null)}decMultiPoly(e){let t=new Oi,s=e.map(r=>{let i="";return new mO(n=>(t.ext1(n.bbox()),i=new gO().encPl(n).toString(),!1),!1).parse("M"+r.join(" ")),i}).join(" ");return{bbox:t.build(),d:s}}encMatrix(e){let[t,s,r,i,n,a]=e,o=new Wt([t,s,0,r,i,0,n,a,1]);o=Wt.MIRROR_Y.multiply3(o).multiply3(Wt.MIRROR_Y);let[c,l,u,h,p,d,f,m,g]=o.data;return[c,h,f,l,p,m]}parseString(e){var t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y;if(this.version<2){let[,T,w,S,_,C,x,D,I,P,L,F,V,B,k,O,R,v,j,M]=e;C=ss(C);let H=I;D=D===1,V=V===1,B=B===1,k=k===1;let q=-(O[15]/3|0)+2,Q=O%3;j=j||1,M=M||1;let oe=this.fontCache[e[1]],{bbox:me,d:Ee}=this.decMultiPoly(oe),Pe=me.width(),Oe=me.height();Oe=Oe||0,Pe=Pe||0;let Fe=0;switch(Q){case 1:Fe=-Pe/2;break;case 2:Fe=-Pe;break}let G=0;switch(q){case 1:G=Oe/2;break;case 0:G=Oe;break}let pe=Wt.translate(Fe,G).scale(j,M).rotateD(-x);D&&(pe=pe.multiply3(Wt.MIRROR_X)),pe=pe.translate(_,C);let ge=this.matrix2svg(pe),ie=this.encMatrix(ge);this.onString(T,w,S,x,H,P,L,F,V,B,k,((-q||0)+2)*3+(Q||0),R,v,this.lockConfig.some($=>$===e[1]),this.hideConfig.some($=>$===e[1]),this.invisibleConfig.some($=>$===e[1]),S===1?1:(t=this.coverConfig[e[1]])!=null?t:null,(s=this.commentConfig[e[1]])!=null?s:null,S===2?3:(i=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?i:null,S===2?v:(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,S===2?1-v:(c=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?c:null,ie,!!ie,this.encPath(Ee))}else this.onString(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]===1,e[10]===1,e[11]===1,e[12],e[13],e[14],this.lockConfig.some(T=>T===e[1]),this.hideConfig.some(T=>T===e[1]),this.invisibleConfig.some(T=>T===e[1]),(l=this.coverConfig[e[1]])!=null?l:null,(u=this.commentConfig[e[1]])!=null?u:null,(p=(h=this.trnCtrlConfig[e[1]])==null?void 0:h.scope)!=null?p:null,(f=(d=this.trnCtrlConfig[e[1]])==null?void 0:d.trans_print)!=null?f:null,(g=(m=this.trnCtrlConfig[e[1]])==null?void 0:m.trans_white)!=null?g:null,(E=(b=this.transformConfig[e[1]])==null?void 0:b.matrix)!=null?E:null,!!((y=this.transformConfig[e[1]])!=null&&y.matrix),this.fontCache[e[1]])}parseFontCache(e){this.fontCache[e[1]]=e[2]}parseDimension(e){var t,s,r,i,n,a,o,c,l,u,h,p;this.onDimension(e[1],e[2],e[3],(t=e[4])!=null?t:null,e[5],e[6],e[7],e[8],this.lockConfig.some(d=>d===e[1]),this.hideConfig.some(d=>d===e[1]),this.invisibleConfig.some(d=>d===e[1]),(s=this.coverConfig[e[1]])!=null?s:null,(r=this.commentConfig[e[1]])!=null?r:null,(n=(i=this.trnCtrlConfig[e[1]])==null?void 0:i.scope)!=null?n:null,(o=(a=this.trnCtrlConfig[e[1]])==null?void 0:a.trans_print)!=null?o:null,(l=(c=this.trnCtrlConfig[e[1]])==null?void 0:c.trans_white)!=null?l:null,(h=(u=this.transformConfig[e[1]])==null?void 0:u.matrix)!=null?h:null,!!((p=this.transformConfig[e[1]])!=null&&p.matrix))}parseTransform(e){this.transformConfig[e[1]]={matrix:e[2],strokes:!!e[3]}}parseAuxLine(e){var t,s,r,i,n,a,o,c,l,u,h;this.onAuxLine(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],this.lockConfig.some(p=>p===e[1]),this.hideConfig.some(p=>p===e[1]),this.invisibleConfig.some(p=>p===e[1]),(t=this.coverConfig[e[1]])!=null?t:null,(s=this.commentConfig[e[1]])!=null?s:null,(i=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?i:null,(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,(c=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?c:null,(u=(l=this.transformConfig[e[1]])==null?void 0:l.matrix)!=null?u:null,!!((h=this.transformConfig[e[1]])!=null&&h.matrix))}},rI=class extends BT{constructor(e={},t=[]){super(),this.symbolPartIds=e,this.device=t,this.defaultPartId="pid8a0e77bacb214e",this.curPart="",this.onlyPart="",this.partIdMap={},this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.zIndex=0,this.zIndexMap=new Map,this.cache={},this.errorIds={},this.tableCell={},this.hasPart=!1,this.components={},this.busEntryMap={},this.defaultLineStyle={strokeColor:null,strokeStyle:null,fillColor:null,strokeWidth:null,fillStyle:null},this.defaultFontStyle={color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:null,underline:null,italic:null,fontWeight:null,hAlign:null,vAlign:null}}getZIndex(e){var t;return(t=this.zIndexMap.get(e))!=null?t:null}transPinAttrKey(e){switch(e){case"NUMBER":{e="Pin Number";break}case"NAME":{e="Pin Name";break}}return e}transFontStyle(e){return{color:e.color,fillColor:e.fillColor,fontFamily:e.fontFamily,fontSize:e.fontSize,strikeout:e.strikeout,underline:e.underline,italic:e.italic,fontWeight:e.fontWeight,align:this.transAlign(e.vAlign,e.hAlign)}}transTableFontStyle(e){return{color:e.color,fillColor:e.fillColor,fontFamily:e.fontFamily,fontSize:e.fontSize,strikeout:e.strikeout,underline:e.underline,italic:e.italic,fontWeight:e.fontWeight,vAlign:this.transVAlign(e.vAlign),hAlign:this.transHAlign(e.hAlign)}}transVAlign(e){switch(e=e&&Number(e),e){case 0:return"TOP";case 1:return"MIDDLE";case 2:return"BOTTOM";default:return null}}transHAlign(e){switch(e=e&&Number(e),e){case 0:return"LEFT";case 1:return"CENTER";case 2:return"RIGHT";default:return null}}transAlign(e,t){if(e=e&&Number(e),t=t&&Number(t),t===0)switch(e){case 0:return"LEFT_TOP";case 1:return"LEFT_MIDDLE";case 2:return"LEFT_BOTTOM";default:return null}if(t===1)switch(e){case 0:return"CENTER_TOP";case 1:return"CENTER_MIDDLE";case 2:return"CENTER_BOTTOM";default:return null}if(t===2)switch(e){case 0:return"RIGHT_TOP";case 1:return"RIGHT_MIDDLE";case 2:return"RIGHT_BOTTOM";default:return null}return null}transStrokeStyle(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transFillStyle(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"SOLID";case 2:return"GRID";case 3:return"HORIZONTAL_LINE";case 4:return"VERTICAL_LINE";case 5:return"RHOMBIC";case 6:return"LEFT_SLASH_LINE";case 7:return"RIGHT_SLASH_LINE";default:return null}}transPinShape(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"CLOCK";case 2:return"INVERTED";case 3:return"INVERTED_CLOCK";default:return"NONE"}}onParseLine(e){var s,r;let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"GROUP":this.parseGroup(e);break;case"FONTSTYLE":this.parseFontStyle(e);break;case"LINESTYLE":this.parseLineStyle(e);break;case"TERM":break;case"PART":this.hasPart=!0,this.parsePart(e);break;case"TABEL_CELL":this.parseTableCell(e);break;case"BUSENTRY":{this.parseBusEntry(e);break}case"WIRE":case"BUS":case"TEXT":case"POLY":case"CIRCLE":case"ARC":case"RECT":case"PIN":case"OBJ":case"COMPONENT":case"ELLIPSE":case"BEZIER":case"TABLE":{this.zIndexMap.set(e[1],++this.zIndex);let i=bp(e[1]);this.cache[t]||(this.cache[t]={}),i!==null&&!this.cache[t][i]?this.cache[t][i]={part:this.curPart,value:e}:(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPart,value:e}));break}case"ATTR":{this.zIndexMap.set(e[1],++this.zIndex),e[3]==="Symbol"&&(this.components[e[2]]||(this.components[e[2]]={symbol:"",device:""}),this.components[e[2]].symbol=e[4]),e[3]==="Device"&&(this.components[e[3]]||(this.components[e[3]]={symbol:"",device:""}),this.components[e[3]].device=e[4]);let i=Object.keys(((s=this.cache)==null?void 0:s.COMPONENT)||{}).find(o=>this.cache.COMPONENT[o].value[1]===e[2]);if(i){let o=this.cache.COMPONENT[i];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:e});break}let n=Object.keys(((r=this.cache)==null?void 0:r.PIN)||{}).find(o=>this.cache.PIN[o].value[1]===e[2]);if(n){let o=this.cache.PIN[n];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:e});break}let a=bp(e[1]);this.cache[t]||(this.cache[t]={}),a!==null?this.cache[t][a]||(this.cache[t][a]={part:this.curPart,value:e}):(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPart,value:e}));break}default:console.warn("can not find hanlder with",e)}}secondParseLine(e){switch(e[0]){case"DOCTYPE":case"HEAD":case"GROUP":case"FONTSTYLE":case"LINESTYLE":break;case"ATTR":this.parseAttr(e);break;case"WIRE":this.parseWire(e);break;case"BUS":this.parseBus(e);break;case"TEXT":this.parseText(e);break;case"POLY":this.parsePoly(e);break;case"CIRCLE":this.parseCircle(e);break;case"ARC":this.parseArc(e);break;case"BUSENTRY":break;case"RECT":this.parseRect(e);break;case"PIN":this.parsePin(e);break;case"OBJ":this.parseObj(e);break;case"COMPONENT":this.parseComponent(e);break;case"ELLIPSE":this.parseEllipse(e);break;case"BEZIER":this.parseBezier(e);break;case"TABLE":this.parseTable(e);break;case"TABEL_CELL":break}}onParseEnd(){this.docType==="SYMBOL"&&!this.hasPart&&(this.curPart=this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[""]=this.curPart,this.onPart(this.curPart,{title:""}));for(let e in this.cache){let t=this.cache[e],s=Object.keys(t).sort((i,n)=>Number(i)-Number(n)),r=0;for(let i of s){let n=Number(i),a=n-r-1;a>=1&&this.onPHolder(e,a),r=n,this.curPart=this.hasPart?t[n].part||this.onlyPart:this.curPart,this.secondParseLine(t[n].value),t[n].attr&&t[n].attr.forEach(o=>{this.curPart=this.hasPart?o.part||this.onlyPart:this.curPart,this.secondParseLine(o.value)})}if(this.errorIds[e])for(let i of this.errorIds[e])this.curPart=this.hasPart?i.part||this.onlyPart:this.curPart,this.secondParseLine(i.value)}this.clearCache()}clearCache(){this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.cache={},this.errorIds={},this.curPart="",this.components={},this.tableCell={},this.hasPart=!1,this.version=void 0,this.docType=void 0}parseDocType(e){this.docType=e[1];let t=parseFloat(e[2]);this.version=t}parseHead(e){this.onCanvas(e[1])}parseFontStyle(e){this.fontStyleIndex[e[1]]={color:e[3]===""?"none":e[3],fillColor:e[2],fontFamily:e[4],fontSize:e[5],strikeout:e[9]===null?null:e[9]===1,underline:e[8]===null?null:e[8]===1,italic:e[6]===null?null:e[6]===1,fontWeight:e[7]===null?null:e[7]===1,vAlign:e[10],hAlign:e[11]}}parseLineStyle(e){this.lineStyleIndex[e[1]]={strokeColor:e[2],strokeStyle:this.transStrokeStyle(e[3]),fillColor:e[4]===""?"none":e[4],strokeWidth:e[5],fillStyle:this.transFillStyle(e[6])}}getGroupId(e){var s;let t=this;for(let r in t.groupIndex)if((s=t.groupIndex[r])!=null&&s.includes(e))return r;return""}parseBezier(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);for(let r=0;r<e[2].length;r+=2)e[2][r+1]=ss(e[2][r+1]);this.onBezier(e[1],this.curPart,s,!!e[4],e[2],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseGroup(e){this.groupIndex[e[1]]=e[4]||[],this.onGroup(e[1],e[2]||"",e[3]||"")}parseBus(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=e[2]||[],r=this.getGroupId(e[1]);this.onBus(e[1],this.curPart,r,!!e[4],s,t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle,this.busEntryMap[e[1]]||{})}parseWire(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=e[2]||[],r=this.getGroupId(e[1]);this.onWire(e[1],this.curPart,r,!!e[4],s,t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseText(e){let t=this.fontStyleIndex[e[6]];t||(t=this.defaultFontStyle,console.warn("font not found",e));let s=this.transFontStyle(t),r=this.getGroupId(e[1]);this.onText(e[1],this.curPart,r,!!e[7],e[2],e[3],e[4],e[5],s.color,s.fillColor,s.fontFamily,s.fontSize,s.strikeout,s.underline,s.italic,s.fontWeight,s.align)}parsePoly(e){let t=this.lineStyleIndex[e[4]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onPoly(e[1],this.curPart,s,!!e[5],e[2]||[],!!e[3],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseCircle(e){let t=this.lineStyleIndex[e[5]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onCircle(e[1],this.curPart,s,!!e[6],e[2],e[3],e[4],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseArc(e){let t=this.lineStyleIndex[e[8]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onArc(e[1],this.curPart,s,!!e[9],e[2],e[3],e[4],e[5],e[6],e[7],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseBusEntry(e){let t=e[2],s={groupId:this.getGroupId(e[1]),locked:!1,zIndex:++this.zIndex,order:e[3],pointX:e[4],pointY:ss(e[5]),rotation:e[6]};this.busEntryMap[t]||(this.busEntryMap[t]={}),this.busEntryMap[t][e[1]]=s}parseRect(e){let t=this.lineStyleIndex[e[9]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onRect(e[1],this.curPart,s,!!e[10],e[2],e[3],e[4],e[5],e[6],e[7],e[8],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parsePin(e){let t=this.getGroupId(e[1]);this.onPin(e[1],this.curPart,t,!!e[10],!!e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transPinShape(e[9]))}parseObj(e){let t=this.getGroupId(e[1]);this.version>=1.1?this.onObj(e[1],this.curPart,t,!!e[10],e[2],e[3],e[4],e[5],e[6],e[7],!!e[8],e[9]):this.onObj(e[1],this.curPart,t,!!e[10],e[2],e[4],e[5],e[6],e[7],e[8],!1,`data:${e[3]},${e[9]}`)}parseComponent(e){var i,n,a;let t=this.getGroupId(e[1]),s=e[2],r=this.components[e[1]];if(r){if(r.symbol){let o=this.symbolPartIds[r.symbol];o&&(s=o[e[2]]||e[2]||o[(i=Object.keys(o))==null?void 0:i[0]]||"")}else if(r.device){let o=this.device.find(l=>l.uuid===r.device),c=o?this.symbolPartIds[(n=o==null?void 0:o.attributes)==null?void 0:n.Symbol]:null;c&&(s=c[e[2]]||e[2]||c[(a=Object.keys(c))==null?void 0:a[0]]||"")}}this.onComponent(e[1],!!e[8],s,t,e[3],e[4],e[5],e[6]===1,e[7])}parseEllipse(e){let t=this.lineStyleIndex[e[7]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let s=this.getGroupId(e[1]);this.onEllipse(e[1],this.curPart,s,!!e[8],e[2],e[3],e[4],e[5],e[6],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseTable(e){let t=this.getGroupId(e[1]);this.onTable(e[1],this.curPart,t,e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.tableCell[e[1]]||[])}parseTableCell(e){let t=this.lineStyleIndex[e[8]],s=this.lineStyleIndex[e[9]],r=this.lineStyleIndex[e[10]],i=this.lineStyleIndex[e[11]],n=this.fontStyleIndex[e[12]],a=Object.assign({},n);a.color=n.fillColor,a.fillColor=n.color,(!t||!s||!r||!i||!a)&&console.warn("style not found",e);let o={id:e[1],value:e[3],rowIndex:e[4],columnIndex:e[5],rowSpan:e[6],colSpan:e[7],topStyle:t||this.defaultLineStyle,rightStyle:s||this.defaultLineStyle,bottomStyle:r||this.defaultLineStyle,leftStyle:i||this.defaultLineStyle,fontStyle:this.transTableFontStyle(a||this.defaultFontStyle),lineHeight:e[13],zIndex:++this.zIndex};this.tableCell[e[2]]||(this.tableCell[e[2]]=[]),this.tableCell[e[2]].push(o)}parseAttr(e){let t=this.fontStyleIndex[e[10]];t||(t=this.defaultFontStyle,console.warn("fontStyle not found",e));let s=this.transFontStyle(t),r=this.getGroupId(e[1]);this.onAttr(e[1],this.curPart,r,!!e[11],e[2]||"",this.transPinAttrKey(String(e[3])),e[4],e[5]===null?null:!!e[5],e[6]===null?null:!!e[6],e[7]!==null?e[7]:null,e[8]!==null?e[8]:null,e[9],s.color,s.fillColor,s.fontFamily,s.fontSize,s.strikeout,s.underline,s.italic,s.fontWeight,s.align)}parsePart(e){this.curPart=e[1]||this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[e[1]]=this.curPart;let t=Object.assign(e[2]||{},{title:e[1]||""});this.onPart(this.curPart,t)}},fU=class{constructor(){}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodeAuxLine(e,t){return{id:e,dataType:"AUXLINE",data:JSON.stringify(t)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}},n0=class{constructor(){}editHead(e,t){let s={uuid:e.uuid,nickname:e.nickname,username:e.username,updateTime:t};return`${JSON.stringify({type:"EDIT_HEAD"})}${Vn}${JSON.stringify(s)}`}head(e){return pr(this.doctype,e.client,e.doc,e.updateTime,e.version||String(e.updateTime),e.user,e.ticket)}creator(e,t){let s=typeof t=="string"?t:JSON.stringify(t);return Zt("META_CREATE",e,"META_CREATE",s)}modifier(e,t){let s=typeof t=="string"?t:JSON.stringify(t);return Zt("META_MODIFY",e,"META_MODIFY",s)}delete(e,t){let s=t||JSON.stringify({isDelete:!0});return Zt("DELETE_DOC",e,"DELETE_DOC",s)}},ch=class extends n0{constructor(){super(...arguments),this.doctype="BLOB"}buildStr(e,t,s){let r=typeof s=="string"?s:JSON.stringify(this.buildData(s));return Zt("BLOB",e,t,r)}buildData(e){return{filename:e.filename,content:e.content}}},xp=class extends n0{meta(e,t){let s=typeof t=="string"?t:JSON.stringify(this.metaData(t));return Zt("META",e,"META",s)}},mU=class extends xp{constructor(){super(...arguments),this.doctype="BOARD"}metaData(e){return{title:e.title,zIndex:e.zIndex}}},gU=class extends xp{constructor(){super(...arguments),this.doctype="CONFIG"}head(e){let{client:t,updateTime:s,user:r}=e,i=s||new Date().getTime();return pr(this.doctype,t,"CONFIG",i,String(i),r,e.ticket)}metaData(e){return{defaultSheet:e.defaultSheet}}},yU=class extends xp{constructor(){super(...arguments),this.doctype="DEVICE"}metaData(e){return{title:e.title,tags:e.tags,source:e.source,images:e.images,attributes:e.attributes}}},EU=class{constructor(){}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodePadNet(e){let t=JSON.stringify(["PAD_NET",e.componentId,e.padNum,e.padId||""]),s={...e};return delete s.componentId,delete s.padNum,delete s.padId,{id:t,dataType:"PAD_NET",data:JSON.stringify(s)}}encodeComponent(e,t){return{id:e,dataType:"COMPONENT",data:JSON.stringify(t)}}encodePanelize(e){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(e)}}encodeRuleSelector(e){let t=JSON.stringify(["RULE_SELECTOR",e.ruleSelect]),s={...e};return delete s.ruleSelect,{id:t,dataType:"RULE_SELECTOR",data:JSON.stringify(s)}}encodeRule(e){let t=JSON.stringify(["RULE",e.ruleType,e.ruleName]),s={...e};return delete s.ruleType,delete s.ruleName,{id:t,dataType:"RULE",data:JSON.stringify(s)}}encodeRuleTemplate(e){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(e)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeBoss(e,t){return{id:e,dataType:"BOSS",data:JSON.stringify(t)}}encodeShellEntity(e,t){return{id:e,dataType:"SHELL_ENTITY",data:JSON.stringify(t)}}encodeShellCut(e,t){return{id:e,dataType:"SHELLCUT",data:JSON.stringify(t)}}encodeCrease(e,t){return{id:e,dataType:"CREASE",data:JSON.stringify(t)}}encodeShell(e,t){return{id:e,dataType:"SHELL",data:JSON.stringify(t)}}encodeFpcFill(e,t){return{id:e,dataType:"FPC_FILL",data:JSON.stringify(t)}}encodeTeardrop(e,t){return{id:e,dataType:"TEARDROP",data:JSON.stringify(t)}}encodeImage(e,t){return{id:e,dataType:"IMAGE",data:JSON.stringify(t)}}encodePoured(e,t){return{id:Ui(e,"POURED"),dataType:"POURED",data:JSON.stringify(t)}}encodePour(e,t){return{id:e,dataType:"POUR",data:JSON.stringify(t)}}encodeRegion(e,t){return{id:e,dataType:"REGION",data:JSON.stringify(t)}}encodeFill(e,t){return{id:e,dataType:"FILL",data:JSON.stringify(t)}}encodeLayerFill(e,t){return{id:Ui(e,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeEQLenGrp(e,t){return{id:e,dataType:"EQLEN_GRP",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodePad(e,t){return{id:e,dataType:"PAD",data:JSON.stringify(t)}}encodeVia(e,t){return{id:e,dataType:"VIA",data:JSON.stringify(t)}}encodePreference(e){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(e)}}encodeSilkOpts(e,t){return{id:Ui(e,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodePrimitive(e,t){return{id:Ui(e,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(t)}}encodeNet(e,t){return{id:Ui(e,"NET"),dataType:"NET",data:JSON.stringify(t)}}encodePartition(e,t){return{id:e,dataType:"PARTITION",data:JSON.stringify(t)}}encodeActiveLayer(e){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(e)}}encodeLayerPhys(e,t){return{id:Ui(e,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(t)}}encodeLayer(e,t){return{id:Ui(e,"LAYER"),dataType:"LAYER",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}},bU=class{constructor(){}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodePanelize(e){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(e)}}encodeRuleSelector(e){let t=JSON.stringify(["RULE_SELECTOR",e.ruleSelect]),s={...e};return delete s.ruleSelect,{id:t,dataType:"RULE_SELECTOR",data:JSON.stringify(s)}}encodeRule(e){let t=JSON.stringify(["RULE",e.ruleType,e.ruleName]),s={...e};return delete s.ruleType,delete s.ruleName,{id:t,dataType:"RULE",data:JSON.stringify(s)}}encodeRuleTemplate(e){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(e)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeBoss(e,t){return{id:e,dataType:"BOSS",data:JSON.stringify(t)}}encodeShellEntity(e,t){return{id:e,dataType:"SHELL_ENTITY",data:JSON.stringify(t)}}encodeShellCut(e,t){return{id:e,dataType:"SHELLCUT",data:JSON.stringify(t)}}encodeCrease(e,t){return{id:e,dataType:"CREASE",data:JSON.stringify(t)}}encodeShell(e,t){return{id:e,dataType:"SHELL",data:JSON.stringify(t)}}encodeFpcFill(e,t){return{id:e,dataType:"FPC_FILL",data:JSON.stringify(t)}}encodeTeardrop(e,t){return{id:e,dataType:"TEARDROP",data:JSON.stringify(t)}}encodeImage(e,t){return{id:e,dataType:"IMAGE",data:JSON.stringify(t)}}encodePoured(e,t){return{id:Ui(e,"POURED"),dataType:"POURED",data:JSON.stringify(t)}}encodePour(e,t){return{id:e,dataType:"POUR",data:JSON.stringify(t)}}encodeRegion(e,t){return{id:e,dataType:"REGION",data:JSON.stringify(t)}}encodeFill(e,t){return{id:e,dataType:"FILL",data:JSON.stringify(t)}}encodeLayerFill(e,t){return{id:Ui(e,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeEQLenGrp(e,t){return{id:e,dataType:"EQLEN_GRP",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodePad(e,t){return{id:e,dataType:"PAD",data:JSON.stringify(t)}}encodeVia(e,t){return{id:e,dataType:"VIA",data:JSON.stringify(t)}}encodePreference(e){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(e)}}encodeSilkOpts(e,t){return{id:Ui(e,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodePrimitive(e,t){return{id:Ui(e,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(t)}}encodeNet(e,t){return{id:Ui(e,"NET"),dataType:"NET",data:JSON.stringify(t)}}encodeActiveLayer(e){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(e)}}encodeLayerPhys(e,t){return{id:Ui(e,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(t)}}encodeLayer(e,t){return{id:Ui(e,"LAYER"),dataType:"LAYER",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}},iI=class extends DO{constructor(e=!1){super(void 0,void 0,void 0,void 0,e),this.encode=new bU,this.maxTicket=0,this.blobEncode=new ch,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Le+Zt(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Zt(e.dataType,++this.maxTicket,e.id,e.data)}getZIndex(e){let t=e.match(t0);return t!=null&&t.length?t[1]:null}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:at(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}onLayerFill(e,t){this.handleData(this.encode.encodeLayerFill(e,t))}onString(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E){let y=this.getZIndex(e);this.handleData(this.encode.encodeString(He(e),{groupId:s,layerId:r,x:i,y:n,text:a,fontFamily:o,fontSize:c,strokeWidth:l,bold:u,italic:h,origin:p,angle:d,reverse:f,expansion:m,mirror:g,locked:b,zIndex:y===null?null:Number(y),specialColor:E}))}onAttr(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_){let C=this.getZIndex(e);C&&S&&(C=C+"."+String(S)),this.handleData(this.encode.encodeAttr(He(e),{groupId:s,parentId:r,layerId:i,x:n,y:a,key:o,value:c,keyVisible:l,valueVisible:u,fontFamily:h,fontSize:p,strokeWidth:d,bold:f,italic:m,origin:g,angle:b,reverse:E,expansion:y,mirror:T,locked:w,zIndex:C===null?null:Number(C),specialColor:_}))}onPadNet(e,t,s,r,i){}onComponent(e,t,s,r,i,n,a,o,c){}onPanelize(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodePanelize({on:e,row:t,column:s,rowSpacing:r,columnSpacing:i,onlyOutline:n,horizontalStamp:a,verticalStamp:o,horizontalSize:c,verticalSize:l}))}onRuleSelector(e,t,s,r,i){this.handleData(this.encode.encodeRuleSelector({ruleSelect:e,ruleOrder:t,ruleKeyValue:s,copperValue:r,innerPlaneValue:i}))}onRule(e,t,s,r){this.handleData(this.encode.encodeRule({ruleType:e,ruleName:t,ruleState:s,ruleContext:r}))}onRuleTemplate(e){this.handleData(this.encode.encodeRuleTemplate({name:e}))}onDimension(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeDimension(He(e),{type:s,layerId:r,unit:i,strokeWidth:n,precision:a,textFollow:o,coords:c,locked:l,zIndex:d===null?null:Number(d),text:u,specialColor:h,groupId:p}))}onBoss(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeBoss(He(e),{groupId:s,layerId:r,centerX:i,centerY:n,specification:a,depth:o,thickness:c,holeDiameter:l,counterBore:u?{height:u[0],diameter:u[1]}:null,stiffener:h?{topWidth:h[0],bottomWidth:h[1],height:h[2],stiffThickness:h[3]}:null,locked:p,zIndex:d===null?null:Number(d)}))}onShellEntity(e,t,s,r,i,n,a,o,c,l,u,h){let p=this.getZIndex(e),d={groupId:s,layerId:r,type:i?"ENTITY":"SLOT",depth:o,strokeWidth:c,path:l,locked:u,zIndex:p===null?null:Number(p),refs:h};d.type==="ENTITY"&&(d.entityBelong=n),d.type==="SLOT"&&(d.slotOptions=a),this.handleData(this.encode.encodeShellEntity(He(e),d))}onShellCut(e,t,s,r,i,n,a,o,c){let l=this.getZIndex(e);this.handleData(this.encode.encodeShellCut(He(e),{groupId:s,layerId:r,depth:i,strokeWidth:n,path:a,locked:o,zIndex:l===null?null:Number(l),refs:c}))}onCrease(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeCrease(He(e),{groupId:s,layerId:r,startX:i,startY:n,endX:a,endY:o,angle:c,locked:l,zIndex:u===null?null:Number(u)}))}onShell(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e),h={groupId:s,shellType:r,shellHeight:i,pcbHeight:n,strokeWidth:a,path:o,thickness:c.Thickness,locked:l,zIndex:u===null?null:Number(u)};r==="DRAWER"&&(h.direction=c.Direction),r==="T&B"&&(h.bottomHeight=c.BottomHeight,h.topInnerHeight=c.TopInnerHeight,h.bottomInnerHeight=c.BottomInnerHeight),this.handleData(this.encode.encodeShell(He(e),h))}onFpcFill(e,t,s,r,i,n,a,o){let c=this.getZIndex(e);this.handleData(this.encode.encodeFpcFill(He(e),{groupId:s,layerId:r,material:i,thickness:n,path:a,locked:o,zIndex:c===null?null:Number(c)}))}onTeardrop(e,t,s,r,i,n,a){this.handleData(this.encode.encodeTeardrop(He(e),{netName:s,layerId:r,path:i,groupId:n,refs:a,locked:!1}))}onImage(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeImage(He(e),{groupId:s,layerId:r,startX:i,startY:n,width:a,height:o,angle:c,mirror:l,path:u,locked:h,zIndex:d===null?null:Number(d),specialColor:p}))}onPoured(e,t){this.handleData(this.encode.encodePoured(He(e),t))}onPour(e,t,s,r,i,n,a,o,c,l,u,h){let p=this.getZIndex(e);this.handleData(this.encode.encodePour(He(e),{groupId:s,netName:r,layerId:i,width:n,name:a,order:o,path:c,pourType:l,keepIsland:u,locked:h,zIndex:p===null?null:Number(p)}))}onRegion(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeRegion(He(e),{groupId:s,layerId:r,width:i,prohibitType:n,path:a,locked:o,zIndex:u===null?null:Number(u),name:c,regionType:l}))}onFill(e,t,s,r,i,n,a,o,c,l,u){let h=this.getZIndex(e);this.handleData(this.encode.encodeFill(He(e),{groupId:s,netName:r,layerId:i,width:n,fillStyle:a,path:o,locked:c,zIndex:h===null?null:Number(h),isBridgingCopper:!1,networkList:[],refs:l,specialColor:u}))}onPoly(e,t,s,r,i,n,a,o,c){let l=this.getZIndex(e);this.handleData(this.encode.encodePoly(He(e),{groupId:s,netName:r,layerId:i,width:n,path:a,locked:o,zIndex:l===null?null:Number(l),specialColor:c,polyType:i==11?"BOARD_OUTLINE":"NORMAL"}))}onEQLenGrp(e,t,s,r){this.handleData(this.encode.encodeEQLenGrp(He(e),{name:t,sort:s,pads:r}))}onObj(e,t,s,r,i,n,a,o,c,l,u,h,p,d){if(h.startsWith("data:")){let m=Ap(h);this.blobData.push(this.blobEncode.buildStr(1,m,{filename:i,content:h})),h=`blob:${m}`}let f=this.getZIndex(e);this.handleData(this.encode.encodeObj(He(e),{groupId:s,layerId:r,fileName:i,startX:n,startY:a,width:o,height:c,angle:l,mirror:u,path:h,locked:p,zIndex:f===null?null:Number(f),specialColor:d}))}onArc(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeArc(He(e),{groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,angle:l,width:u,locked:h,zIndex:d===null?null:Number(d),arcType:"DOT",specialColor:p}))}onCArc(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeArc(He(e),{groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,angle:l,width:u,locked:h,zIndex:d===null?null:Number(d),arcType:"CENT",specialColor:p}))}onLine(e,t,s,r,i,n,a,o,c,l,u){let h=this.getZIndex(e);this.handleData(this.encode.encodeLine(He(e),{groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,width:l,locked:u,zIndex:h===null?null:Number(h)}))}onPad(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C,x,D){let I=this.getZIndex(e);this.handleData(this.encode.encodePad(He(e),{groupId:s,netName:r,layerId:i,num:n,centerX:a,centerY:o,padAngle:c,hole:l,defaultPad:u,specialPad:h,padOffsetX:p,padOffsetY:d,relativeAngle:f,plated:m,padType:g,topSolderExpansion:b,bottomSolderExpansion:E,topPasteExpansion:y,bottomPasteExpansion:T,locked:w,zIndex:I===null?null:Number(I),connectMode:S,spokeSpace:_,spokeWidth:C,spokeAngle:x,unusedInnerLayers:D,padLen:0}))}onVia(e,t,s,r,i,n,a,o,c,l,u,h,p,d){let f=this.getZIndex(e);this.handleData(this.encode.encodeVia(He(e),{groupId:s,netName:r,ruleName:i,centerX:n,centerY:a,holeDiameter:o,viaDiameter:c,viaType:l,topSolderExpansion:u,bottomSolderExpansion:h,locked:p,zIndex:f===null?null:Number(f),unusedInnerLayers:d}))}onPreference(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y){this.handleData(this.encode.encodePreference({startTrackWidthFollowLast:e,lastTrackWidth:t,startViaSizeFollowLast:s,lastViaInnerDiameter:r,lastViaDiameter:i,snap:n,routingMode:a,routingCorner:o,removeLoop:c,rotatingObject:l,trackFollow:u,stretchTrackMinCorner:h,preferenceConfig:p,realTimeUpdateUnusedLayers:d,unusedPadRange:f,pushVia:m,pathOptimization4BePushed:g,currentPathOptimization4BePushed:b,removeCircuitsContainingVias:E,removeAntenna:y}))}onSilkOpts(e,t,s){this.handleData(this.encode.encodeSilkOpts(e,{defaultColor:t,baseColor:s}))}onGroup(e,t){this.handleData(this.encode.encodeGroup(e,{groupName:t}))}onPrimitive(e,t,s){this.handleData(this.encode.encodePrimitive(e,{display:t,pick:s}))}onNet(e,t,s,r,i,n,a){this.handleData(this.encode.encodeNet(e,{netType:t,specialColor:s,retLine:r,differentialName:i,isPositiveNet:n,equalLengthGroupName:a}))}onPartition(e,t,s,r){}onActiveLayer(e){this.handleData(this.encode.encodeActiveLayer({layerId:e}))}onLayerPhys(e,t,s,r,i,n,a){this.handleData(this.encode.encodeLayerPhys(e,{material:t,thickness:s,permittivity:r,lossTangent:i,isKeepIsland:n,zIndex:a}))}onLayer(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodeLayer(e,{layerType:t,layerName:s,use:r,show:i,locked:n,activeColor:a,activateTransparency:o,inactiveColor:c,inactiveTransparency:l}))}onCanvas(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodeCanvas({originX:e,originY:t,unit:s,gridXSize:r,gridYSize:i,snapXSize:n,snapYSize:a,altSnapXSize:o,altSnapYSize:c,gridType:l,multiGridType:u,multiGridRatio:h,highlightValue:.5}))}},TU=class extends DO{constructor(e=[],t=[]){let s={};e.forEach(i=>s[i.uuid]=i.display_title||i.title);let r={};t.forEach(i=>r[i.uuid]=i.display_title||i.title),super(r,s,e,t),this.encode=new EU,this.maxTicket=0,this.blobEncode=new ch,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Le+Zt(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Zt(e.dataType,++this.maxTicket,e.id,e.data)}getZIndex(e){let t=e.match(t0);return t!=null&&t.length?t[1]:null}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:at(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}onLayerFill(e,t){this.handleData(this.encode.encodeLayerFill(e,t))}onString(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E){let y=this.getZIndex(e);this.handleData(this.encode.encodeString(He(e),{partitionId:He(t),groupId:s,layerId:r,x:i,y:n,text:a,fontFamily:o,fontSize:c,strokeWidth:l,bold:u,italic:h,origin:p,angle:d,reverse:f,expansion:m,mirror:g,locked:b,zIndex:y===null?null:Number(y),specialColor:E}))}onAttr(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_){let C=this.getZIndex(e);C&&S&&(C=C+"."+String(S)),this.handleData(this.encode.encodeAttr(He(e),{partitionId:He(t),groupId:s,parentId:He(r),layerId:i,x:n,y:a,key:o,value:c,keyVisible:l,valueVisible:u,fontFamily:h,fontSize:p,strokeWidth:d,bold:f,italic:m,origin:g,angle:b,reverse:E,expansion:y,mirror:T,locked:w,zIndex:C===null?null:Number(C),specialColor:_}))}onPadNet(e,t,s,r,i){this.handleData(this.encode.encodePadNet({partitionId:He(t),componentId:He(e),padNum:s,padNet:r,padId:He(i),padLen:0}))}onComponent(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeComponent(He(e),{partitionId:He(t),groupId:s,layerId:r,x:i,y:n,angle:a,attrs:o,locked:c,zIndex:u===null?null:Number(u),specialColor:l}))}onPanelize(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodePanelize({on:e,row:t,column:s,rowSpacing:r,columnSpacing:i,onlyOutline:n,horizontalStamp:a,verticalStamp:o,horizontalSize:c,verticalSize:l}))}onRuleSelector(e,t,s,r,i){this.handleData(this.encode.encodeRuleSelector({ruleSelect:e,ruleOrder:t,ruleKeyValue:s,copperValue:r,innerPlaneValue:i}))}onRule(e,t,s,r){this.handleData(this.encode.encodeRule({ruleType:e,ruleName:t,ruleState:s,ruleContext:r}))}onRuleTemplate(e){this.handleData(this.encode.encodeRuleTemplate({name:e}))}onDimension(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeDimension(He(e),{partitionId:He(t),type:s,layerId:r,unit:i,strokeWidth:n,precision:a,textFollow:o,coords:c,locked:l,zIndex:d===null?null:Number(d),text:u,specialColor:h,groupId:p}))}onBoss(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeBoss(He(e),{partitionId:He(t),groupId:s,layerId:r,centerX:i,centerY:n,specification:a,depth:o,thickness:c,holeDiameter:l,counterBore:u?{height:u[0],diameter:u[1]}:null,stiffener:h?{topWidth:h[0],bottomWidth:h[1],height:h[2],stiffThickness:h[3]}:null,locked:p,zIndex:d===null?null:Number(d)}))}onShellEntity(e,t,s,r,i,n,a,o,c,l,u,h){let p=this.getZIndex(e),d={groupId:s,layerId:r,type:i?"ENTITY":"SLOT",depth:o,strokeWidth:c,path:l,locked:u,zIndex:p===null?null:Number(p),refs:h};d.type==="ENTITY"&&(d.entityBelong=n),d.type==="SLOT"&&(d.slotOptions=a),this.handleData(this.encode.encodeShellEntity(He(e),d))}onShellCut(e,t,s,r,i,n,a,o,c){let l=this.getZIndex(e);this.handleData(this.encode.encodeShellCut(He(e),{partitionId:He(t),groupId:s,layerId:r,depth:i,strokeWidth:n,path:a,locked:o,zIndex:l===null?null:Number(l),refs:c}))}onCrease(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeCrease(He(e),{partitionId:He(t),groupId:s,layerId:r,startX:i,startY:n,endX:a,endY:o,angle:c,locked:l,zIndex:u===null?null:Number(u)}))}onShell(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e),h={groupId:s,shellType:r,shellHeight:i,pcbHeight:n,strokeWidth:a,path:o,thickness:c.Thickness,locked:l,zIndex:u===null?null:Number(u)};r==="DRAWER"&&(h.direction=c.Direction),r==="T&B"&&(h.bottomHeight=c.BottomHeight,h.topInnerHeight=c.TopInnerHeight,h.bottomInnerHeight=c.BottomInnerHeight),this.handleData(this.encode.encodeShell(He(e),h))}onFpcFill(e,t,s,r,i,n,a,o){let c=this.getZIndex(e);this.handleData(this.encode.encodeFpcFill(He(e),{partitionId:He(t),groupId:s,layerId:r,material:i,thickness:n,path:a,locked:o,zIndex:c===null?null:Number(c)}))}onTeardrop(e,t,s,r,i,n,a){this.handleData(this.encode.encodeTeardrop(He(e),{partitionId:He(t),netName:s,layerId:r,path:i,groupId:n,refs:a,locked:!1}))}onImage(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeImage(He(e),{partitionId:He(t),groupId:s,layerId:r,startX:i,startY:n,width:a,height:o,angle:c,mirror:l,path:u,locked:h,zIndex:d===null?null:Number(d),specialColor:p}))}onPoured(e,t){this.handleData(this.encode.encodePoured(He(e),t))}onPour(e,t,s,r,i,n,a,o,c,l,u,h){let p=this.getZIndex(e);this.handleData(this.encode.encodePour(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,width:n,name:a,order:o,path:c,pourType:l,keepIsland:u,locked:h,zIndex:p===null?null:Number(p)}))}onRegion(e,t,s,r,i,n,a,o,c,l){let u=this.getZIndex(e);this.handleData(this.encode.encodeRegion(He(e),{partitionId:He(t),groupId:s,layerId:r,width:i,prohibitType:n,path:a,locked:o,zIndex:u===null?null:Number(u),name:c,regionType:l}))}onFill(e,t,s,r,i,n,a,o,c,l,u){let h=this.getZIndex(e);this.handleData(this.encode.encodeFill(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,width:n,fillStyle:a,path:o,locked:c,zIndex:h===null?null:Number(h),isBridgingCopper:!1,networkList:[],refs:l,specialColor:u}))}onPoly(e,t,s,r,i,n,a,o,c){let l=this.getZIndex(e);this.handleData(this.encode.encodePoly(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,width:n,path:a,locked:o,zIndex:l===null?null:Number(l),specialColor:c,polyType:i==11?"BOARD_OUTLINE":"NORMAL"}))}onEQLenGrp(e,t,s,r){this.handleData(this.encode.encodeEQLenGrp(He(e),{name:t,sort:s,pads:r}))}onObj(e,t,s,r,i,n,a,o,c,l,u,h,p,d){if(h.startsWith("data:")){let m=Ap(h);this.blobData.push(this.blobEncode.buildStr(1,m,{filename:i,content:h})),h=`blob:${m}`}let f=this.getZIndex(e);this.handleData(this.encode.encodeObj(He(e),{partitionId:He(t),groupId:s,layerId:r,fileName:i,startX:n,startY:a,width:o,height:c,angle:l,mirror:u,path:h,locked:p,zIndex:f===null?null:Number(f),specialColor:d}))}onArc(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeArc(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,angle:l,width:u,locked:h,zIndex:d===null?null:Number(d),arcType:"DOT",specialColor:p}))}onCArc(e,t,s,r,i,n,a,o,c,l,u,h,p){let d=this.getZIndex(e);this.handleData(this.encode.encodeArc(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,angle:l,width:u,locked:h,zIndex:d===null?null:Number(d),arcType:"CENT",specialColor:p}))}onLine(e,t,s,r,i,n,a,o,c,l,u){let h=this.getZIndex(e);this.handleData(this.encode.encodeLine(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,startX:n,startY:a,endX:o,endY:c,width:l,locked:u,zIndex:h===null?null:Number(h)}))}onPad(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C,x,D){let I=this.getZIndex(e);this.handleData(this.encode.encodePad(He(e),{partitionId:He(t),groupId:s,netName:r,layerId:i,num:n,centerX:a,centerY:o,padAngle:c,hole:l,defaultPad:u,specialPad:h,padOffsetX:p,padOffsetY:d,relativeAngle:f,plated:m,padType:g,topSolderExpansion:b,bottomSolderExpansion:E,topPasteExpansion:y,bottomPasteExpansion:T,locked:w,zIndex:I===null?null:Number(I),connectMode:S,spokeSpace:_,spokeWidth:C,spokeAngle:x,unusedInnerLayers:D,padLen:0}))}onVia(e,t,s,r,i,n,a,o,c,l,u,h,p,d){let f=this.getZIndex(e);this.handleData(this.encode.encodeVia(He(e),{partitionId:He(t),groupId:s,netName:r,ruleName:i,centerX:n,centerY:a,holeDiameter:o,viaDiameter:c,viaType:l,topSolderExpansion:u,bottomSolderExpansion:h,locked:p,zIndex:f===null?null:Number(f),unusedInnerLayers:d}))}onPreference(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y){this.handleData(this.encode.encodePreference({startTrackWidthFollowLast:e,lastTrackWidth:t,startViaSizeFollowLast:s,lastViaInnerDiameter:r,lastViaDiameter:i,snap:n,routingMode:a,routingCorner:o,removeLoop:c,rotatingObject:l,trackFollow:u,stretchTrackMinCorner:h,preferenceConfig:p,realTimeUpdateUnusedLayers:d,unusedPadRange:f,pushVia:m,pathOptimization4BePushed:g,currentPathOptimization4BePushed:b,removeCircuitsContainingVias:E,removeAntenna:y}))}onSilkOpts(e,t,s){this.handleData(this.encode.encodeSilkOpts(e,{defaultColor:t,baseColor:s}))}onGroup(e,t){this.handleData(this.encode.encodeGroup(e,{groupName:t}))}onPrimitive(e,t,s){this.handleData(this.encode.encodePrimitive(e,{display:t,pick:s}))}onNet(e,t,s,r,i,n,a){this.handleData(this.encode.encodeNet(e,{netType:t,specialColor:s,retLine:r,differentialName:i,isPositiveNet:n,equalLengthGroupName:a}))}onPartition(e,t,s,r){this.handleData(this.encode.encodePartition(He(e),{name:t,fileUuid:s,path:r}))}onActiveLayer(e){this.handleData(this.encode.encodeActiveLayer({layerId:e}))}onLayerPhys(e,t,s,r,i,n,a){this.handleData(this.encode.encodeLayerPhys(e,{material:t,thickness:s,permittivity:r,lossTangent:i,isKeepIsland:n,zIndex:a}))}onLayer(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodeLayer(e,{layerType:t,layerName:s,use:r,show:i,locked:n,activeColor:a,activateTransparency:o,inactiveColor:c,inactiveTransparency:l}))}onCanvas(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodeCanvas({originX:e,originY:t,unit:s,gridXSize:r,gridYSize:i,snapXSize:n,snapYSize:a,altSnapXSize:o,altSnapYSize:c,gridType:l,multiGridType:u,multiGridRatio:h,highlightValue:.5}))}};function wU(e,t,s,r,i,n,a=new Date().getTime(),o=String(a),c){var m,g;let l=at(),u=t.split(`

`),h=u.filter(b=>!b.startsWith('["DOCTYPE","PCB"')),p=u.filter(b=>b.startsWith('["DOCTYPE","PCB"'))[0],d="";for(let b=0;b<h.length;b++){let E=new iI;E.parseFull(h[b]);let y=E.metaData;i.push({uuid:y.uuid,title:y.title,dataStr:h[b]});let T=pr("FOOTPRINT",l,y.uuid,a,o,c);if(T=T+Le+Zt("META",1,"META",JSON.stringify({source:y.source,version:y.version,title:(m=y==null?void 0:y.title)==null?void 0:m.replace(/[A-Z]+/g,w=>w.toLowerCase()),display_title:y.title,description:y.description||"",custom_tags:y.custom_tags||"",tags:y.tags||{},docType:4})),E.blobData.length&&(T=T+Le+E.blobEncode.head({doc:"BLOB",client:l,updateTime:a,version:o,user:c})+Le+E.blobData.join(Le)),E.fontCache.length){let w=new $y,S=w.head({doc:"FONT",client:at(),updateTime:a,version:o,user:c});for(let _ of E.fontCache){let C=uo(_.text,_.fontFamily,_.fontSize,_.thickness,_.bold,_.italic,_.reverse,_.expansion),x=w.buildStr(1,C,_);S=S+Le+x}T=S+Le+T}E.encodeData&&(T=T+Le+E.encodeData),d=d?T+Le+d:T}let f=new TU(i,n);d?d=d+Le+pr("PCB",l,e,a,o,c):d=pr("PCB",l,e,a,o,c),f.parseFull(s.join(`
`));for(let b=0;b<r.length;b++){let E=r[b];f.curPourId=(g=E.path.split("_"))==null?void 0:g[1],f.parseFull(E.dataStr)}if(f.parseFull(p),f.encodeData&&(d=d+Le+f.encodeData),f.blobData.length&&(d=d+Le+f.blobEncode.head({doc:"BLOB",client:l,updateTime:a,version:o,user:c})+Le+f.blobData.join(Le)),f.fontCache.length){let b=new $y,E=b.head({doc:"FONT",client:at(),updateTime:a,version:o,user:c});for(let y of f.fontCache){let T=uo(y.text,y.fontFamily,y.fontSize,y.thickness,y.bold,y.italic,y.reverse,y.expansion),w=b.buildStr(1,T,y);E=E+Le+w}d=E+Le+d}return d}function vp(e,t,s,r=new Date().getTime(),i=String(r),n){let a=new iI(s),o="",c=at();if(o=pr("FOOTPRINT",c,e,r,i,n),a.parseFull(t),a.encodeData&&(o=o+Le+a.encodeData),a.blobData.length&&(o=o+Le+a.blobEncode.head({doc:"BLOB",client:c,updateTime:r,version:i,user:n})+Le+a.blobData.join(Le)),a.fontCache.length){let l=new $y,u=l.head({doc:"FONT",client:c,updateTime:r,version:i,user:n});for(let h of a.fontCache){let p=uo(h.text,h.fontFamily,h.fontSize,h.thickness,h.bold,h.italic,h.reverse,h.expansion),d=l.buildStr(1,p,h);u=u+Le+d}o=u+Le+o}return o}var hl=class extends xp{canvas(e){let{client:t,ticket:s,data:r,id:i,dataType:n,firstTicket:a,pend:o}=e;return Zt(n,s,i,r,t,a,o)}},SU=class extends hl{constructor(){super(...arguments),this.doctype="FOOTPRINT"}metaData(e){return{title:e.title,description:e.description,tags:e.tags,source:e.source}}transform(e){let{doc:t,dataStr:s,has_device:r,updateTime:i,version:n,user:a}=e;return vp(t,s,r,i,n,a)}},_U=class extends n0{constructor(){super(...arguments),this.doctype="INSTANCE"}attr(e,t){let s=[];for(let r in t){let i=JSON.stringify(t[r]);s.push(Zt("INSTANCE_ATTR",e,r,i))}return s.join(Le)}},AU=class extends hl{constructor(){super(...arguments),this.doctype="PANEL"}metaData(e){return{title:e.title,zIndex:e.zIndex||null}}transform(e){let{doc:t,dataStr:s,updateTime:r,version:i,user:n}=e;return a0(t,s,"PANEL",r,i,n)}},CU=class extends hl{constructor(){super(...arguments),this.doctype="PCB"}metaData(e){return{title:e.title,parent:e.parent,source:e.source,board:e.board,zIndex:e.zIndex||null}}transform(e){let{doc:t,dataStr:s,fonts:r,coppers:i,footprints:n,devices:a,updateTime:o,version:c,user:l}=e;return wU(t,s,r,i,n,a,o,c,l)}},DU=class extends xp{constructor(){super(...arguments),this.doctype="SCH"}metaData(e){return{title:e.title,source:e.source,board:e.board,zIndex:e.zIndex||null}}sort(e){let{doc:t,client:s,ticket:r,data:i}=e,n=typeof i=="string"?i:JSON.stringify(i);return Zt("META_SORT",r,"META_SORT",n)}},PU=class{constructor(){}encodeNGSetting(e){return{id:"NG_SETTING",dataType:"NG_SETTING",data:JSON.stringify(e)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodeTable(e,t){return{id:e,dataType:"TABLE",data:JSON.stringify(t)}}encodeEllipse(e,t){return{id:e,dataType:"ELLIPSE",data:JSON.stringify(t)}}encodeComponent(e,t){return{id:e,dataType:"COMPONENT",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodePin(e,t){return{id:e,dataType:"PIN",data:JSON.stringify(t)}}encodeRect(e,t){return{id:e,dataType:"RECT",data:JSON.stringify(t)}}encodeMaskRegion(e,t){return{id:e,dataType:"MASK_REGION",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeCircle(e,t){return{id:e,dataType:"CIRCLE",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeText(e,t){return{id:e,dataType:"TEXT",data:JSON.stringify(t)}}encodeBezier(e,t){return{id:e,dataType:"BEZIER",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodeBus(e,t){return{id:e,dataType:"BUS",data:JSON.stringify(t)}}encodeWire(e,t){return{id:e,dataType:"WIRE",data:JSON.stringify(t)}}},OU=class{constructor(){}encodePart(e,t){return{id:e,dataType:"PART",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodeTable(e,t){return{id:e,dataType:"TABLE",data:JSON.stringify(t)}}encodeEllipse(e,t){return{id:e,dataType:"ELLIPSE",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodePin(e,t){return{id:e,dataType:"PIN",data:JSON.stringify(t)}}encodeRect(e,t){return{id:e,dataType:"RECT",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeCircle(e,t){return{id:e,dataType:"CIRCLE",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeText(e,t){return{id:e,dataType:"TEXT",data:JSON.stringify(t)}}encodeBezier(e,t){return{id:e,dataType:"BEZIER",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}},IU=class extends rI{constructor(){super(),this.encode=new OU,this.maxTicket=0,this.blobEncode=new ch,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Le+Zt(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Zt(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:at(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}onPart(e,t){this.handleData(this.encode.encodePart(e,t||{}))}onAttr(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T){this.handleData(this.encode.encodeAttr(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),parentId:i,key:n,value:a,keyVisible:o,valueVisible:c,x:l,y:ss(u),rotation:h,color:p,fillColor:d,fontFamily:f,fontSize:m,strikeout:g,underline:b,italic:E,fontWeight:y,align:T,version:"2.0"}))}onTable(e,t,s,r,i,n,a,o,c,l,u){this.handleData(this.encode.encodeTable(He(e),{partId:t,groupId:s,startX:r,startY:ss(i),rowSizes:n,colSizes:a,rowLocked:o,colLocked:c,rotation:l,tableCell:u,zIndex:this.getZIndex(e)}))}onEllipse(e,t,s,r,i,n,a,o,c,l,u,h,p,d){this.handleData(this.encode.encodeEllipse(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),centerX:i,centerY:ss(n),radiusX:a,radiusY:ss(o),rotation:c,strokeColor:l,strokeStyle:u,fillColor:h,strokeWidth:p,fillStyle:d}))}onComponent(){}onObj(e,t,s,r,i,n,a,o,c,l,u,h){if(h.startsWith("data:")){let p=Ap(h);this.blobData.push(this.blobEncode.buildStr(1,p,{filename:"",content:h})),h=`blob:${p}`}this.handleData(this.encode.encodeObj(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),fileName:i,startX:n,startY:ss(a),width:o,height:c,rotation:l,isMirror:u,content:h}))}onPin(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodePin(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),display:i,x:a,y:ss(o),length:c,rotation:l,color:u,pinShape:h}))}onRect(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m){this.handleData(this.encode.encodeRect(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),dotX1:i,dotY1:ss(n),dotX2:a,dotY2:ss(o),radiusX:c,radiusY:l,rotation:u,strokeColor:h,strokeStyle:p,fillColor:d,strokeWidth:f,fillStyle:m}))}onArc(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f){this.handleData(this.encode.encodeArc(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),startX:i,startY:ss(n),referX:a,referY:ss(o),endX:c,endY:ss(l),strokeColor:u,strokeStyle:h,fillColor:p,strokeWidth:d,fillStyle:f}))}onCircle(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodeCircle(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),centerX:i,centerY:ss(n),radius:a,strokeColor:o,strokeStyle:c,fillColor:l,strokeWidth:u,fillStyle:h}))}onPoly(e,t,s,r,i,n,a,o,c,l,u){this.handleData(this.encode.encodePoly(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),points:wO(i,!0),closed:n,strokeColor:a,strokeStyle:o,fillColor:c,strokeWidth:l,fillStyle:u}))}onText(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g){this.handleData(this.encode.encodeText(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),x:i,y:ss(n),rotation:a,value:o,color:c,fillColor:l,fontFamily:u,fontSize:h,strikeout:p,underline:d,italic:f,fontWeight:m,align:g,version:"2.0"}))}onCanvas(e){this.handleData(this.encode.encodeCanvas({originX:e.originX,originY:ss(e.originY)}))}onBezier(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodeBezier(He(e),{partId:t,groupId:s,locked:r,zIndex:this.getZIndex(e),controls:i,strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:c,fillStyle:l}))}onGroup(e,t,s){this.handleData(this.encode.encodeGroup(String(e),{parentId:t,title:s}))}onBus(){}onWire(){}},xU=class extends rI{constructor(e,t=[]){super(e,t),this.encode=new PU,this.maxTicket=0,this.blobEncode=new ch,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Le+Zt(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Zt(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:at(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}onPart(e,t){}onAttr(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T){this.handleData(this.encode.encodeAttr(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),parentId:He(i),key:n,value:a,keyVisible:o,valueVisible:c,x:l,y:ss(u),rotation:h,color:p,fillColor:d,fontFamily:f,fontSize:m,strikeout:g,underline:b,italic:E,fontWeight:y,align:T,version:"2.0"}))}onTableCell(e,t,s,r,i,n,a,o,c,l,u,h,p,d){}onTable(e,t,s,r,i,n,a,o,c,l,u){this.handleData(this.encode.encodeTable(He(e),{groupId:s,startX:r,startY:ss(i),rowSizes:n,colSizes:a,rowLocked:o,colLocked:c,rotation:l,tableCell:u,zIndex:this.getZIndex(e)}))}onEllipse(e,t,s,r,i,n,a,o,c,l,u,h,p,d){this.handleData(this.encode.encodeEllipse(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),centerX:i,centerY:ss(n),radiusX:a,radiusY:o,rotation:c,strokeColor:l,strokeStyle:u,fillColor:h,strokeWidth:p,fillStyle:d}))}onComponent(e,t,s,r,i,n,a,o,c){this.handleData(this.encode.encodeComponent(He(e),{locked:t,zIndex:this.getZIndex(e),partId:s,groupId:r,x:i,y:ss(n),rotation:a,isMirror:o,attrs:c||{}}))}onObj(e,t,s,r,i,n,a,o,c,l,u,h){if(h.startsWith("data:")){let p=Ap(h);this.blobData.push(this.blobEncode.buildStr(1,p,{filename:"",content:h})),h=`blob:${p}`}this.handleData(this.encode.encodeObj(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),fileName:i,startX:n,startY:ss(a),width:o,height:c,rotation:l,isMirror:u,content:h}))}onPin(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodePin(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),display:i,x:a,y:ss(o),length:c,rotation:l,color:u,pinShape:h}))}onRect(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m){this.handleData(this.encode.encodeRect(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),dotX1:i,dotY1:ss(n),dotX2:a,dotY2:ss(o),radiusX:c,radiusY:l,rotation:u,strokeColor:h,strokeStyle:p,fillColor:d,strokeWidth:f,fillStyle:m}))}onArc(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f){this.handleData(this.encode.encodeArc(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),startX:i,startY:ss(n),referX:a,referY:ss(o),endX:c,endY:ss(l),strokeColor:u,strokeStyle:h,fillColor:p,strokeWidth:d,fillStyle:f}))}onCircle(e,t,s,r,i,n,a,o,c,l,u,h){this.handleData(this.encode.encodeCircle(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),centerX:i,centerY:ss(n),radius:a,strokeColor:o,strokeStyle:c,fillColor:l,strokeWidth:u,fillStyle:h}))}onPoly(e,t,s,r,i,n,a,o,c,l,u){this.handleData(this.encode.encodePoly(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),points:wO(i,!0),closed:n,strokeColor:a,strokeStyle:o,fillColor:c,strokeWidth:l,fillStyle:u}))}onText(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g){this.handleData(this.encode.encodeText(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),x:i,y:ss(n),rotation:a,value:o,color:c,fillColor:l,fontFamily:u,fontSize:h,strikeout:p,underline:d,italic:f,fontWeight:m,align:g,version:"2.0"}))}onCanvas(e){this.handleData(this.encode.encodeCanvas({originX:e.originX,originY:ss(e.originY)}))}onBezier(e,t,s,r,i,n,a,o,c,l){this.handleData(this.encode.encodeBezier(He(e),{groupId:s,locked:r,zIndex:this.getZIndex(e),controls:i,strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:c,fillStyle:l}))}onGroup(e,t,s){this.handleData(this.encode.encodeGroup(String(e),{parentId:t,title:s}))}onBus(e,t,s,r,i,n,a,o,c,l,u){let h=He(e),p=PP(i,{strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:c,fillStyle:l},h);this.handleData(this.encode.encodeBus(h,{groupId:s,locked:r,zIndex:this.getZIndex(e),busEntry:u}));for(let d of p)this.handleData(this.encode.encodeLine(at(),d))}onWire(e,t,s,r,i,n,a,o,c,l){let u=He(e),h=PP(i,{strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:c,fillStyle:l},u);this.handleData(this.encode.encodeWire(u,{groupId:s,locked:r,zIndex:this.getZIndex(e)}));for(let p of h)this.handleData(this.encode.encodeLine(at(),p))}};function vU(e,t,s,r=[],i=new Date().getTime(),n=String(i),a){let o=new xU(s,r),c="";o.parseFull(t);let l=at();return o.encodeData&&(c=pr("SCH_PAGE",l,e,i,n,a)+Le+o.encodeData),c&&o.blobData.length&&(c=c+Le+o.blobEncode.head({doc:"BLOB",client:l,updateTime:i,version:n,user:a})+Le+o.blobData.join(Le)),c}function Rp(e,t,s=new Date().getTime(),r=String(s),i){let n=new IU,a="";n.parseFull(t);let o=at();n.encodeData&&(a=pr("SYMBOL",o,e,s,r,i)+Le+n.encodeData),a&&n.blobData.length&&(a=a+Le+n.blobEncode.head({doc:"BLOB",client:o,updateTime:s,version:r,user:i})+Le+n.blobData.join(Le));let c=n.partIdMap;return n.partIdMap={},{dataStr:a,partIdMap:c}}var RU=class extends hl{constructor(){super(...arguments),this.doctype="SCH_PAGE"}metaData(e){return{title:e.title,schematic:e.schematic,source:e.source,zIndex:e.zIndex}}transform(e){let{doc:t,dataStr:s,partIdMap:r,device:i,updateTime:n,version:a,user:o}=e;return vU(t,s,r,i,n,a,o)}},NU=class extends hl{constructor(){super(...arguments),this.doctype="SYMBOL"}metaData(e){return{title:e.title,description:e.description,tags:e.tags,docType:e.docType,source:e.source}}transform(e,t={}){let{doc:s,dataStr:r,updateTime:i,version:n,user:a}=e,o=Rp(s,r,i,n,a);return Object.assign(t,o.partIdMap||{}),o.dataStr}},$y=class extends n0{constructor(){super(...arguments),this.doctype="FONT"}buildStr(e,t,s){let r=typeof s=="string"?s:JSON.stringify(this.buildData(s));return Zt("FONT",e,t,r)}buildData(e){return{width:e.width,height:e.height,path:e.path}}},LU=class extends hl{constructor(){super(...arguments),this.doctype="PANEL_LIB"}metaData(e){return{title:e.display_title||e.title,tags:e.tags,description:e.description||""}}transform(e){let{doc:t,dataStr:s}=e;return a0(t,s,"PANEL_LIB")}},BU=class extends hl{constructor(){super(...arguments),this.doctype="SIMULATION"}metaData(e){return{title:e.title,docType:e.docType,source:e.source,zIndex:e.zIndex}}},Gi=class{constructor(){this.blob=new ch,this.font=new $y,this.board=new mU,this.config=new gU,this.device=new yU,this.footprint=new SU,this.panel=new AU,this.pcb=new CU,this.schematic=new DU,this.sheet=new RU,this.symbol=new NU,this.instance=new _U,this.panelLib=new LU,this.simulation=new BU}},kU=class extends pU{constructor(){super(),this.encode=new fU,this.maxTicket=0,this.blobEncode=new ch,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Le+Zt(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Zt(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let s={dataType:e,max:t};this.handleData({id:at(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(s)})}strokeStyleType(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transScopeType(e){switch(e=e&&Number(e),e){case 1:return"PRINT";case 2:return"COVER";case 3:return"PRINT&COVER";default:return null}}transAlignType(e){switch(e=e&&Number(e),e){case 0:return"LEFT_BOTTOM";case 1:return"CENTER_BOTTOM";case 2:return"RIGHT_BOTTOM";case 3:return"LEFT_MIDDLE";case 4:return"CENTER_MIDDLE";case 5:return"RIGHT_MIDDLE";case 6:return"LEFT_TOP";case 7:return"CENTER_TOP";case 8:return"RIGHT_TOP";default:return null}}onAuxLine(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y){this.handleData(this.encode.encodeAuxLine(He(e),{groupId:t?`e${t}`:"",layer:s,x:r,y:i,rotation:n,strokeWidth:a,strokeStyle:this.strokeStyleType(o),color:c,length:l,locked:u,zIndex:this.getZIndex(e),visible:!p,cover:d,name:f}))}onDimension(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b){this.handleData(this.encode.encodeDimension(He(e),{layer:t,dimensionType:s,unit:r,strokeWidth:i,accuracy:n,controlDot:a,relationIds:o,locked:c,zIndex:this.getZIndex(e),valid:!l,visible:!u,cover:h,name:p,rotation:0}))}onString(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w,S,_,C){this.handleData(this.encode.encodeString(He(e),{groupId:t?`e${t}`:"",layer:s,rotation:r,value:i,fontFamily:n,fontSize:a,fontWeight:o,italic:c,underline:l,strikeout:u,align:this.transAlignType(h),strokeColor:p,opacity:d,locked:f,zIndex:this.getZIndex(e),valid:!m,visible:!g,cover:b,transScope:this.transScopeType(y),transPrint:T,transWhite:w,matrix:S,strokes:_,path:C,name:E}))}onPoly(e,t,s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b,E,y,T,w){if(typeof o=="string"&&o.startsWith("data:")){let S=Ap(o);this.blobData.push(this.blobEncode.buildStr(1,S,{filename:"",content:o})),o=`blob:${S}`}this.handleData(this.encode.encodePoly(He(e),{groupId:t?`e${t}`:"",layer:s,rotation:r,strokeWidth:i,strokeStyle:this.strokeStyleType(n),strokeColor:a,fillColor:o,opacity:c,autoClose:l,ploys:u,displayFill:h,displayStroke:p,locked:d,zIndex:this.getZIndex(e),valid:!f,visible:!m,cover:g,transScope:this.transScopeType(E),transPrint:y,transWhite:T,matrix:w,name:b}))}onGroup(e,t,s,r,i){this.handleData(this.encode.encodeGroup(`e${e}`,{parentId:t?`e${t}`:"",title:s,visible:r,locked:i}))}onCanvas(e){this.handleData(this.encode.encodeCanvas(e))}};function a0(e,t,s,r=new Date().getTime(),i=String(r),n){let a=new kU,o="";a.parseFull(t);let c=at();return a.encodeData&&(o=pr(s,c,e,r,i,n)+Le+a.encodeData),o&&a.blobData.length&&(o=o+Le+a.blobEncode.head({doc:"BLOB",client:c,updateTime:r,version:i,user:n})+Le+a.blobData.join(Le)),o}var MU=(e=>(e.UNIVERSAL="UNIVERSAL",e))(MU||{}),jU=(e=>(e.SINGLE="SINGLE",e.MULTIPLE="MULTIPLE",e))(jU||{}),FU=(e=>(e.NONE="NONE",e.NAME="NAME",e.NUMBER="NUMBER",e))(FU||{}),UU=(e=>(e.NONE="NONE",e.ZONE="ZONE",e))(UU||{});var HU=oh(_p());function nI(e){return self[e]=self[e]||new HU.BroadcastChannelMessageBus(e)}var pi={getTime:"/pro-mgr/serverTime/now",getUserL:"/pro-ui/loginUser/get",subMaxTick:"/pro-mgr/project/ticket",subBlob:"/pro-mgr/canvas/BLOB/update",subFont:"/pro-mgr/canvas/FONT/update",subRevoke:"/pro-mgr/{uuid}/revoke",pushPend:"/pro-mgr/worker/batchPendData",pushSync:"/pro-mgr/dataWorker/sync",pushRevoke:"/pro-mgr/worker/revoke",pullASync:"/pro-mgr/dataWorker/sync/{id}",personDestroy:"/mgr/libWorker/destroy",projectUpdate:"/pro-mgr/canvas/{uuid}/update",personUpdate:"/mgr/libWorker/component/{uuid}/update",personSave:"/mgr/libWorker/save",projectSave:"/mgr/projectWorker/setCanvas",canSavePend:"/mgr/projectWorker/canSavePend",hasSaveData:"/mgr/check/hasSaveData"},DX={projectUpdate:pi.projectUpdate,personUpdate:pi.personUpdate,projectCanSave:pi.canSavePend,getProject:"/mgr/projectWorker/footprint/getCanvas",getPerson:"/mgr/libWorker/getFootprint",unwatch:"/mgr/projectWorker/footprint/unwatchCanvas"},PX={projectUpdate:pi.projectUpdate,projectCanSave:pi.canSavePend,getProject:"/mgr/projectWorker/pcb/getCanvas",unwatch:"/mgr/projectWorker/pcb/unwatchCanvas"},OX={projectUpdate:pi.projectUpdate,projectCanSave:pi.canSavePend,getProject:"/mgr/projectWorker/sheet/getCanvas",unwatch:"/mgr/projectWorker/sheet/unwatchCanvas"},IX={projectUpdate:pi.projectUpdate,getProject:"/mgr/projectWorker/schematic/getCanvas",unwatch:"/mgr/projectWorker/schematic/unwatchCanvas"},xX={projectUpdate:pi.projectUpdate,projectCanSave:pi.canSavePend,getProject:"/mgr/projectWorker/simulation/getCanvas",unwatch:"/mgr/projectWorker/simulation/unwatchCanvas"},vX={projectUpdate:pi.projectUpdate,personUpdate:pi.personUpdate,projectCanSave:pi.canSavePend,getProject:"/mgr/projectWorker/symbol/getCanvasOnCompiler",getPerson:"/mgr/libWorker/getSymbol",unwatch:"/mgr/projectWorker/symbol/unwatchCanvas"},RX={projectUpdate:pi.projectUpdate,personUpdate:pi.personUpdate,projectCanSave:pi.canSavePend,getProject:"/mgr/projectWorker/panel/getCanvas",getPerson:"/mgr/libWorker/getPanelLib",unwatch:"/mgr/projectWorker/panel/unwatchCanvas"};var NX=oh(_p());var GU=(e=>(e.DIFFERENTIAL_PAIR="DIFFERENTIAL_PAIR",e.NET_CLASS="NET_CLASS",e.EQL_NET_GRP="EQL_NET_GRP",e))(GU||{});var bo=class extends TO{constructor(){super(),this.isExtractComponent=!1,this.extractAttrKey=["Footprint","Device","Origin Footprint","3D Model Transform","3D Model","3D Model Title","Origin 3D Model Title"],this.calculation=new Aj,this.schComponents={},this.pcbComponents={},this.footprintAttr={},this.otherData={},this.notCanvas=!1,this.canvas={},this.cLine=null,this.maxTicket=0,this.datas={config:{},boards:{},schematics:{},sheets:{},pcbs:{},panels:{},panelLibs:{},symbols:{},footprints:{},devices:{},blobs:{},fonts:{},instances:{},simulations:{}}}get project(){return this.datas}setIsExtractComponent(e){this.isExtractComponent=e,this.setNotCanvas(e)}setNotCanvas(e){this.notCanvas=e}onLine(e,t,s,r,i,n,a,o,c,l,u,h){switch(t>this.maxTicket&&(this.maxTicket=t),this.cLine=this.isExtractComponent?null:h,n){case"CONFIG":{this.parseConfig(r,a,s);break}case"BOARD":{this.parseBoard(r,a,s);break}case"SCH":{this.parseSchematic(r,a,s);break}case"SCH_PAGE":{this.parseSheet(r,a,s,t,e,n,i,o);break}case"SIMULATION":{this.parseSimulation(r,a,s,t,e,n,i,o);break}case"PCB":{this.parsePcb(r,a,s,t,e,n,i,o);break}case"PANEL":{this.parsePanel(r,a,s,t,e,n,i);break}case"PANEL_LIB":{this.parsePanelLib(r,a,s,t,e,n,i);break}case"SYMBOL":{this.parseSymbol(r,a,s,t,e,n,i);break}case"FOOTPRINT":{this.parseFootprint(r,a,s,t,e,n,i);break}case"DEVICE":{this.parseDevice(r,a,s);break}case"BLOB":{this.parseBlob(r,e,s);break}case"FONT":{this.parseFont(r,e,s);break}case"INSTANCE":{this.parseInstance(r,a,e,s);break}default:this.otherData[a]||(this.otherData[a]=pr(n,i,a)),this.otherData[a]=this.otherData[a]+Le+Zt(r,t,e,s)}this.cLine=null}onDocHead(e,t){let s=e.user||{uuid:t==null?void 0:t.uuid,username:t==null?void 0:t.username,nickname:t==null?void 0:t.nickname},{docType:r,uuid:i}=e,n=e.updateTime||(t==null?void 0:t.updateTime),a=e.version||String(n);switch(r){case"CONFIG":break;case"BOARD":break;case"SCH":{if(!this.datas.schematics[i])this.datas.schematics[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.schematics[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"SCH_PAGE":{if(!this.datas.sheets[i])this.datas.sheets[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.sheets[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"SIMULATION":{if(!this.datas.simulations[i])this.datas.simulations[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.simulations[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"PCB":{if(!this.datas.pcbs[i])this.datas.pcbs[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.pcbs[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"PANEL":{if(!this.datas.panels[i])this.datas.panels[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.panels[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"PANEL_LIB":{if(!this.datas.panelLibs[i])this.datas.panelLibs[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.panelLibs[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"SYMBOL":{if(!this.datas.symbols[i])this.datas.symbols[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.symbols[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"FOOTPRINT":{if(!this.datas.footprints[i])this.datas.footprints[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.footprints[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"DEVICE":{if(!this.datas.devices[i])this.datas.devices[i]={uuid:i,creator:s,createTime:n,modifier:s,updateTime:n,version:a};else{let o=this.datas.devices[i];(!o.createTime||n<o.createTime)&&(o.createTime=n,o.creator=s),(!o.updateTime||o.updateTime<n)&&(o.updateTime=n,o.modifier=s,o.version=a)}break}case"BLOB":break;case"INSTANCE":break}}onEnd(){}parse(e){if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error("\u5DE5\u7A0B\u6570\u636E\u89E3\u6790\u9519\u8BEF",t),null}}handleCanvas(){if(this.datas.sheets)for(let e in this.datas.sheets)this.canvas[e]&&(this.datas.sheets[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e]),this.datas.sheets[e].doc_id=this.calculation.getOrderNum(e);if(this.datas.simulations)for(let e in this.datas.simulations)this.canvas[e]&&(this.datas.simulations[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e]);if(this.datas.pcbs)for(let e in this.datas.pcbs)this.canvas[e]&&(this.datas.pcbs[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e]);if(this.datas.panels)for(let e in this.datas.panels)this.canvas[e]&&(this.datas.panels[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e]);if(this.datas.panelLibs)for(let e in this.datas.panelLibs)this.canvas[e]&&(this.datas.panelLibs[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e]);if(this.datas.symbols)for(let e in this.datas.symbols)this.canvas[e]&&(this.datas.symbols[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e]);if(this.datas.footprints)for(let e in this.datas.footprints)this.canvas[e]&&(this.datas.footprints[e].canvas=Qc(this.canvas[e],Le),delete this.canvas[e])}start(e){return this.parseFull(e),this.datas.otherData=this.otherData,this.handleCanvas(),this.datas}getProject(){return this.datas.otherData=this.otherData,this.handleCanvas(),this.datas}parseConfig(e,t,s){if(!this.isExtractComponent)switch(e){case"META":{let r=this.parse(s);this.datas.config=r;break}}}parseBoard(e,t,s){if(!this.isExtractComponent)switch(this.datas.boards[t]||(this.datas.boards[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let r=this.parse(s);r&&Object.assign(this.datas.boards[t],r);break}}}parseSchematic(e,t,s){if(!this.isExtractComponent)switch(this.datas.schematics[t]||(this.datas.schematics[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let r=this.parse(s);r&&Object.assign(this.datas.schematics[t],r);break}}}parseSheet(e,t,s,r,i,n,a,o){switch(this.datas.sheets[t]||(this.datas.sheets[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let c=this.parse(s);e==="META"&&this.calculation.setOrderNum(t,c.schematic,o||r,a),c&&Object.assign(this.datas.sheets[t],c);break}case"META_PLACEHOLDER":{let c=this.parse(s);if(c.max<1){console.error("META_PLACEHOLDER more than 1",c);break}this.calculation.setOrderNum(t+1,i,o||r,a,c.max),c.dataType==="META"&&delete this.datas.sheets[t];break}case"COMPONENT":if(this.isExtractComponent&&s){let c=this.parse(s);if(this.schComponents[t]||(this.schComponents[t]=new Map),!this.schComponents[t].has(i))this.schComponents[t].set(i,{component:{ticket:r,data:c},attr:{}});else{let l=this.schComponents[t].get(i);l.component.ticket<=r&&(l.component.ticket=r,l.component.data=c)}break}case"ATTR":if(this.isExtractComponent&&s){let c=this.parse(s);if(this.extractAttrKey.includes(c.key)){if(this.schComponents[t]||(this.schComponents[t]=new Map),!this.schComponents[t].has(c.parentId))this.schComponents[t].set(c.parentId,{component:{ticket:0,data:null},attr:{[i]:{ticket:r,data:c}}});else{let l=this.schComponents[t].get(c.parentId);(!l.attr[i]||l.attr[i].ticket<=r)&&(l.attr[i]={ticket:r,data:c})}break}}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:c,version:l}=this.datas.sheets[t];this.canvas[t]=[pr(n,a,t,c,l)]}this.canvas[t].push(this.cLine);break}}}parseSimulation(e,t,s,r,i,n,a,o){switch(this.datas.simulations[t]||(this.datas.simulations[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let c=this.parse(s);c&&Object.assign(this.datas.simulations[t],c);break}case"COMPONENT":if(this.isExtractComponent&&s){let c=this.parse(s);if(this.schComponents[t]||(this.schComponents[t]=new Map),!this.schComponents[t].has(i))this.schComponents[t].set(i,{component:{ticket:r,data:c},attr:{}});else{let l=this.schComponents[t].get(i);l.component.ticket<=r&&(l.component.ticket=r,l.component.data=c)}break}case"ATTR":if(this.isExtractComponent&&s){let c=this.parse(s);if(this.extractAttrKey.includes(c.key)){if(this.schComponents[t]||(this.schComponents[t]=new Map),!this.schComponents[t].has(c.parentId))this.schComponents[t].set(c.parentId,{component:{ticket:0,data:null},attr:{[i]:{ticket:r,data:c}}});else{let l=this.schComponents[t].get(c.parentId);(!l.attr[i]||l.attr[i].ticket<=r)&&(l.attr[i]={ticket:r,data:c})}break}}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:c,version:l}=this.datas.simulations[t];this.canvas[t]=[pr(n,a,t,c,l)]}this.canvas[t].push(this.cLine);break}}}parsePcb(e,t,s,r,i,n,a,o){switch(this.datas.pcbs[t]||(this.datas.pcbs[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let c=this.parse(s);c&&Object.assign(this.datas.pcbs[t],c);break}case"COMPONENT":if(this.isExtractComponent&&s){let c=this.parse(s);if(this.pcbComponents[t]||(this.pcbComponents[t]=new Map),!this.pcbComponents[t].has(i))this.pcbComponents[t].set(i,{component:{ticket:r,data:c},attr:{}});else{let l=this.pcbComponents[t].get(i);l.component.ticket<=r&&(l.component.ticket=r,l.component.data=c)}break}case"ATTR":if(this.isExtractComponent&&s){let c=this.parse(s);if(this.extractAttrKey.includes(c.key)){if(this.pcbComponents[t]||(this.pcbComponents[t]=new Map),!this.pcbComponents[t].has(c.parentId))this.pcbComponents[t].set(c.parentId,{component:{ticket:0,data:null},attr:{[i]:{ticket:r,data:c}}});else{let l=this.pcbComponents[t].get(c.parentId);(!l.attr[i]||l.attr[i].ticket<=r)&&(l.attr[i]={ticket:r,data:c})}break}}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:c,version:l}=this.datas.pcbs[t];this.canvas[t]=[pr(n,a,t,c,l)]}this.canvas[t].push(this.cLine);break}}}parsePanel(e,t,s,r,i,n,a){switch(this.datas.panels[t]||(this.datas.panels[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let o=this.parse(s);o&&Object.assign(this.datas.panels[t],o);break}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:o,version:c}=this.datas.panels[t];this.canvas[t]=[pr(n,a,t,o,c)]}this.canvas[t].push(this.cLine);break}}}parsePanelLib(e,t,s,r,i,n,a){switch(this.datas.panelLibs[t]||(this.datas.panelLibs[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let o=this.parse(s);o&&Object.assign(this.datas.panelLibs[t],o);break}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:o,version:c}=this.datas.panelLibs[t];this.canvas[t]=[pr(n,a,t,o,c)]}this.canvas[t].push(this.cLine);break}}}parseSymbol(e,t,s,r,i,n,a){switch(this.datas.symbols[t]||(this.datas.symbols[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let o=this.parse(s);o&&Object.assign(this.datas.symbols[t],o);break}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:o,version:c}=this.datas.symbols[t];this.canvas[t]=[pr(n,a,t,o,c)]}this.canvas[t].push(this.cLine);break}}}parseFootprint(e,t,s,r,i,n,a){switch(this.datas.footprints[t]||(this.datas.footprints[t]={uuid:t,docType:4}),e){case"META":case"DELETE_DOC":{let o=this.parse(s);o&&Object.assign(this.datas.footprints[t],o);break}case"ATTR":if(this.isExtractComponent&&s){let o=this.parse(s);if(this.extractAttrKey.includes(o.key)){this.footprintAttr[t]||(this.footprintAttr[t]={}),this.footprintAttr[t][i]={ticket:r,data:o};break}}default:{if(this.notCanvas)break;if(!this.canvas[t]){let{updateTime:o,version:c}=this.datas.footprints[t];this.canvas[t]=[pr(n,a,t,o,c)]}this.canvas[t].push(this.cLine);break}}}parseDevice(e,t,s){switch(this.datas.devices[t]||(this.datas.devices[t]={uuid:t}),e){case"META":case"DELETE_DOC":{let r=this.parse(s);r&&Object.assign(this.datas.devices[t],r);break}}}parseBlob(e,t,s){if(!this.notCanvas)switch(e){case"BLOB":{this.datas.blobs[t]||(this.datas.blobs[t]={hash:t});let r=this.parse(s);r?Object.assign(this.datas.blobs[t],r):delete this.datas.blobs[t];break}}}parseFont(e,t,s){if(!this.notCanvas)switch(this.datas.fonts[t]||(this.datas.fonts[t]={uuid:t}),e){case"FONT":{let r=this.parse(s);r?Object.assign(this.datas.fonts[t],TT(t),r):delete this.datas.fonts[t];break}}}parseInstance(e,t,s,r){if(!this.notCanvas)switch(this.datas.instances[t]||(this.datas.instances[t]={path:t,hash:w7(t),attr:{}}),e){case"INSTANCE_ATTR":{let i=this.parse(r);this.datas.instances[t].attr[s]=i;break}case"DELETE_DOC":{let i=this.parse(r);this.datas.instances[t].isDelete=i.isDelete;break}}}};var LX=oh(_p());var BX=oh(_p());var dl=class{constructor(){this.cache=[],this.headStart='{"type":"DOCHEAD"',this.chunkLength=1e8}setChunkLength(e){this.chunkLength=Math.max(1e6,e)}onChunk(e){this.callback=e}onData(e,t){var r;if(!(e!=null&&e.length))return;let s=e.join("");if(s){if(!t&&!(this.cache.length&&this.cache[0].startsWith(this.headStart))){let i=s.lastIndexOf(this.headStart),n=s.indexOf(Le,i),a=s.slice(i,n>-1?n:void 0);a&&this.cache.unshift(a,Le)}(r=this.callback)==null||r.call(this,s)}}push(e){let t="|",s=`
`,r=this.cache.reduce((i,n)=>i+n.length,0);if(e.length+r<this.chunkLength)this.cache.push(e);else if(e.length>this.chunkLength){for(;e.length>this.chunkLength;){let i,n=e.lastIndexOf(Le,this.chunkLength-r);if(n<0&&(n=e.indexOf(Le,this.chunkLength-r)),n>-1){i=this.cache,this.cache=[];let a=e.slice(0,n);a&&i.push(a),e=e.slice(n+Le.length),i.length&&this.onData(i,e.startsWith(this.headStart))}else this.cache.push(e),e=""}e.length&&this.cache.push(e)}else{this.cache.push(e);let i=!1,n=this.cache;this.cache=[];let a=[];for(let o=n.length-1;o>=0;--o){let c=n[o];if(i){a.unshift(c);continue}if(this.cache[0]&&this.cache[0].startsWith(s)&&c[c.length-1]&&c[c.length-1].endsWith(t)){c.length>1&&a.unshift(c.slice(0,-1)),this.cache[0].length>1?this.cache[0]=this.cache[0].slice(1):this.cache.shift(),i=!0;continue}if(c===Le){i=!0;continue}let l=c.lastIndexOf(Le);if(l>-1){let u=c.slice(0,l);u.length&&a.unshift(u);let h=c.slice(l+Le.length);h.length&&this.cache.unshift(h),i=!0}else this.cache.unshift(c)}this.onData(a)}}end(){var e;this.cache.length&&((e=this.callback)==null||e.call(this,this.cache.join(""))),this.cache.length=0}};function aI(e){var s;return e instanceof Request?e.url:(s=e==null?void 0:e.startsWith)!=null&&s.call(e,location.origin)?e:`${location.origin}/${e}`}var kt=(e,t)=>{let s=/{([^}]*)}/gim,r=[...new Set(e.match(s))];for(let i=0;i<r.length;i++){let n=r[i],a=n.substring(1,n.length-1);t[a]&&(e=e.replace(n,t[a]))}return e};async function YU(e,t,s){let r=new Go;try{let{key:i}=e,n=s&&e.snapshot?e.snapshot:e.iv||e.uuid;if(t&&n&&i){let a=Su(i),o=Su(n);await r.init({key:a,iv:o});try{let c=await r.decrypt2(t),l=Qd(new Uint8Array(c));return un(l)}catch{let l=await r.decrypt(t),u=Qd(new Uint8Array(l));return un(u)}}throw new Error(`\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!\u6570\u636E\u4E0D\u6B63\u786E:data:${e},key:${i},iv:${n}`)}catch(i){throw new Error("\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!"+i)}}async function VU(e,t=e.dataStrUrl,s=!1){let r=new Headers;r.append(_i.ContentType,Si.Text);let n=await(await fetch(t,{method:"GET",redirect:"error",headers:r})).arrayBuffer();return n&&await YU(e,n,s)}function zU(e,t,s){return s&&e.snapshot?e.snapshotUrl+t:e.dataStrUrl+t}async function o0(e,t,s){try{let r="",n=e.snapshot?0:s,a=e.snapshot?e.snapshot_num||0:e.num||0,o=[];for(let u=n||0;u<=a;u++){let h=u?`-${u}`:"",p=zU(e,h,!0);o.push([e,p,!0])}let c=await pl(1,VU,o),l=[];for(let u=0;u<c.length;u++){let h=c[u];r=r?r+Le+h:h,l.push([h,u+n])}return t&&l.length&&await pl(1,t,l),r}catch(r){return console.error(e.uuid,r),""}}function oI(e){return`project_${e}_v${6}`}async function Np(e,t){if(ve)return;let s={projectId:e,projectName:t.title,timeOfOpenProject:t.timeOfOpenProject,updateTime:t.updated_at,cbb_project:t.cbb_project,owner:t.owner,modifier:t.modifier,members:t.members,filePath:t.filePath};return await ft.stores.project.addData(e,s)}async function cI(e){if(ve)return;let t=await ft.stores.project.delData(e),s=await JU(e);return t&&s}async function JU(e){let t=await caches.delete(oI(e)),r=await(await caches.open(`project_lists_v${1}`)).delete(aI(e));return t&&r}async function lI(e,t){var n,a;if(ve)return nr(As.PROJECT.ON_UPDATE,{ops:t,projectId:e}),!0;let s=X(e),r=(n=await s.project.getData())==null?void 0:n.result;if(!r)return!1;let i=(a=await s.project.updateData(t))==null?void 0:a.result;if(i){let o=t.project||t.initPrj;o&&r.title!==o.title&&await ft.stores.project.updateData(e,{projectName:o.title,timeOfOpenProject:new Date}),nr(As.PROJECT.ON_UPDATE,{ops:t,projectId:e})}return i}async function uI(e){let{message:t}=await fe.messageBus.rpcCall("getUserId"),s=(await ft.stores.project.getAllArrData()).filter(r=>{var i,n;return(r==null?void 0:r.cbb_project)!==!0&&((n=(i=r==null?void 0:r.members)==null?void 0:i.filter(a=>a.uuid===t))==null?void 0:n.length)});return!s||!s.length?Promise.resolve([]):(s.sort((r,i)=>Date.parse(i.timeOfOpenProject)-Date.parse(r.timeOfOpenProject)),e?s.slice(0,e):s)}var c0=class{constructor(t){this.project=t}};var hI=Ei(Vi());function To(e){return self[e]=self[e]||new hI.BroadcastChannelMessageBus(e)}async function Ht(){return To(`/${du()._TAB_ID_}/notify`).rpcCall("/pro-mgr/serverTime/now")}async function fi(){return To(`/${du()._TAB_ID_}/notify`).rpcCall("/pro-ui/loginUser/get")}var l0=class{constructor(t){this.project=t}async getData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.font.get,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async deleteData(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.font.delete,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async buildString(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.font.buildString,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}async getStr(t){return this.project.isReady?await this.project.workerBus.rpcCall(K.font.getStr,t):{success:!1,message:"\u5DE5\u7A0B\u8FD8\u6CA1\u6253\u5F00\u5B8C"}}};var fl=class{constructor(t,s={}){this.uuid=t;this.options=s;this.isReady=!1;this._isOpening=!1;this._isClosing=!1;if(!t)throw new Error(`invalid project uuid: ${t}`);this.config=new oy(this),this.board=new cy(this),this.instance=new Xg(this),this.device=new Zg(this),this.footprint=new $g(this),this.panel=new Qg(this),this.pcb=new ey(this),this.schematic=new ty(this),this.sheet=new sy(this),this.simulation=new ry(this),this.symbol=new iy(this),this.blob=new ay(this),this.font=new l0(this),this.variant=new c0(this),this.project=new ny(this),this.updateData=new qd(this)}get projectDetail(){return this._projectDetail}get isOpening(){return this._isOpening}set isOpening(t){this._isOpening=t}get isClosing(){return this._isClosing}set isClosing(t){this._isClosing=t}getDetail(){return this.project.getData()}async open(...t){try{console.log("[OPEN PROJECT] Start open project in MGR"),Lp(this.uuid,this),this.isOpening=!0,this.worker=new Worker(`editor?entry=mgr-project-worker.js&cll=${self.PRO_LOG_LEVEL}`,{name:`project_${this.uuid}_${window._TAB_ID_}`}),this.workerBus=To(`/${window._TAB_ID_}/project/${this.uuid}`),new dI.WorkerMessageBridge(fe.messageBus,this.worker),this.mainBus=fe.messageBus,console.time("Open project in worker..."),console.log("[OPEN PROJECT] Open project in worker");let s=await this.workerBus.rpcCall(K.public.openProject,[this.uuid,window._TAB_ID_,this.options,!!self._WS_ID_],30*6e4);return console.timeEnd("Open project in worker..."),s.success?(this._projectDetail=s.result,await this.onSuccess(),console.log("[OPEN PROJECT] onSuccess in MGR")):(this.onFailed(),console.log("[OPEN PROJECT] Succeed to open the project in MGR")),s}catch(s){return console.error(s),this.onFailed(),console.log("[OPEN PROJECT] Failed to open project"+s.message),{success:!1,message:s.message}}}async onSuccess(){console.log("[OPEN PROJECT] Add project to DB"),await Np(this.uuid,this.projectDetail);let t={projectId:this.uuid,title:this.projectDetail.name,isCBB:this.projectDetail.cbb_project,branchUuid:this.projectDetail.currentBranch};fe.currentProject=t,this.isOpening=!1,this.isReady=!0,fe.messageBus.publish(ms.ON_OPENED,[this.uuid,this.projectDetail.currentBranch])}onFailed(){this.isOpening=!1,this.worker.terminate(),console.log("[OPEN PROJECT] Destory"),this.destory(),this.uuid===fe.currentProject.projectId&&(fe.currentProject={}),fe.messageBus.publish(ms.ON_FAILED,this.uuid)}async close(){try{return console.log("[OPEN PROJECT] Start close project in MGR",this.uuid),this.isClosing=!0,console.log("[OPEN PROJECT] Before closing the project",this.uuid),await fe.messageBus.rpcCall(ms.BEFORE_CLOSE,[this.uuid]),console.log("[OPEN PROJECT] Close project in worker",this.uuid),await this.workerBus.rpcCall(K.public.closeProject,void 0),console.log("[OPEN PROJECT] Worker terminate",this.uuid),this.worker.terminate(),console.log("[OPEN PROJECT] Destory"),this.destory(),this.isOpening=!1,this.uuid===fe.currentProject.projectId&&(fe.currentProject={}),fe.messageBus.publish(ms.ON_CLOSED,[this.uuid,this.projectDetail.currentBranch]),this.isClosing=!1,console.log("[OPEN PROJECT] End close project in MGR",this.uuid),{success:!0}}catch(t){return this.isClosing=!1,console.error(t),console.log("[OPEN PROJECT] Failed to close project"+t.message),{success:!1,message:t.message}}}destory(){pI(this.uuid)}};var YT=Ei(Vi());var ml=class extends fl{constructor(t){let{uuid:s,options:r,notify:i=!1}=t;super(s,r),this.notify=i}async open(){try{Lp(this.uuid,this),this.isOpening=!0,this.worker=new Worker(`editor?entry=mgr-project-worker.js&cll=${self.PRO_LOG_LEVEL}`,{name:`project_${this.uuid}_${window._TAB_ID_}`}),this.workerBus=To(`/${window._TAB_ID_}/project/${this.uuid}`),new YT.WorkerMessageBridge(fe.messageBus,this.worker),this.mainBus=fe.messageBus;let t=await this.workerBus.rpcCall(K.public.openProject,[this.uuid,window._TAB_ID_,this.options,!!self._WS_ID_],30*6e4);return t.success?(this._projectDetail=t.result,await this.onSuccess()):this.onFailed(),t}catch(t){return this.onFailed(),{success:!1,message:t.message}}}async openByString(t,s){try{Lp(this.uuid,this),this.isOpening=!0,this.worker=new Worker(`editor?entry=mgr-project-worker.js&cll=${self.PRO_LOG_LEVEL}`,{name:`project_${this.uuid}_${window._TAB_ID_}`}),this.workerBus=To(`/${window._TAB_ID_}/project/${this.uuid}`),new YT.WorkerMessageBridge(fe.messageBus,this.worker),this.mainBus=fe.messageBus;let r=[this.uuid,window._TAB_ID_,this.options,t,s,!!self._WS_ID_],i=await this.workerBus.rpcCall(K.public.openProjectByString,r);return i.success?(this._projectDetail=i.result,await this.onSuccess()):this.onFailed(),i}catch(r){return this.onFailed(),{success:!1,message:r.message}}}async close(){try{return this.isClosing=!0,await this.workerBus.rpcCall(K.public.closeProject,void 0),this.worker.terminate(),this.destory(),this.isOpening=!1,this.isClosing=!1,this.notify&&fe.messageBus.publish(ms.ON_TEMP_CLOSED,this.uuid),{success:!0}}catch(t){return this.isClosing=!1,{success:!1,message:t.message}}}async onSuccess(){if(await Np(this.uuid,this.projectDetail),this.isOpening=!1,this.isReady=!0,fe.messageBus.publish(ms.ON_OPENED,[this.uuid,this.projectDetail.currentBranch]),this.notify){let t={projectId:this.uuid,title:this.projectDetail.name,isCBB:this.projectDetail.cbb_project,branchUuid:this.projectDetail.currentBranch};fe.currentProject=t,fe.messageBus.publish(ms.ON_TEMP_OPENED,this.projectDetail)}}onFailed(){this.isOpening=!1,this.worker.terminate(),this.destory()}};function Lp(e,t){return ro.getInstance().add(e,t)}function Ge(e=fe.currentProject.projectId){return!!ro.getInstance().get(e)}function X(e=fe.currentProject.projectId){let s=ro.getInstance().get(e);if(!s)throw new Error("Get an illegal project!");return s}function gl(e){return ro.getInstance().get(e)}function pI(e){return ro.getInstance().del(e)}async function fI(e,t){let s=gl(e);return s?{success:!0,result:(await s.project.getData(e)).result}:(s=new fl(e,t),await s.open())}async function mI(e){let t=gl(e);if(t)return await t.close()}async function lh(e){let{uuid:t,options:s,notify:r}=e,i=gl(t);return i?{success:!0,result:(await i.project.getData(t)).result}:(i=new ml({uuid:t,options:s,notify:r}),await i.open())}async function gI(e){let{uuid:t,dataStr:s,config:r,options:i,notify:n}=e,a=gl(t);return a?{success:!0,result:(await a.project.getData(t)).result}:(a=new ml({uuid:t,options:i,notify:n}),await a.openByString(s,r))}async function Bp(e){let t=gl(e);if(t&&t instanceof ml)return await t.close()}var yI=(E=>(E.LIST="/api/projects",E.CBB_LIST="/api/cbbProject",E.CREATE="/api/v4/projects/add",E.GET="/api/v4/projects/{uuid}",E.UPDATE="/api/projects/{uuid}/update",E.DELETE="/api/v4/projects/{uuid}/delete",E.TICKET="/api/projects/{uuid}/ticket",E.BACKUP_LIST="/api/backups",E.BACKUP="/api/backups",E.OPERATE_BACKUP="/api/backups/{uuid}",E.ARCHIVE="/api/backups/archive",E.CREATE_BOARD="/api/projects/{uuid}/boards",E.STAR="/api/projects/{uuid}/star",E.UNSTAR="/api/projects/{uuid}/unstar",E.STRUCTURE="/api/v4/projects/{project_uuid}/branches/{branch_uuid}/structures",E.UPDATE_IMAGES="/api/v4/projects/{projectUuid}/branches/{branchUuid}/thumbs",E.DELETE_IMAGES="/api/v4/projects/{projectUuid}/branches/{branchUuid}/thumbs/{thumbUuid}",E.GET_IMAGES="/api/v4/projects/{projectUuid}/branches/{branchUuid}/thumbs",E))(yI||{}),EI=(n=>(n.CREATE="/api/v4/projects/{project_uuid}/branches",n.LIST="/api/v4/projects/{project_uuid}/branches",n.GET="/api/v4/projects/{project_uuid}/branches/{branch_uuid}",n.UPDATE="/api/v4/projects/{project_uuid}/branches/{branch_uuid}",n.DELETE="/api/v4/projects/{project_uuid}/branches/{branch_uuid}",n))(EI||{}),bI=(s=>(s.SET="/api/v4/projects/{project_uuid}/branches/{branch_uuid}/histories",s.GET="/api/v4/projects/{project_uuid}/branches/{branch_uuid}/histories/{history_uuid}",s))(bI||{}),TI=(s=>(s.SET="/api/v4/components/{uuid}/histories",s.GET="/api/v4/components/{uuid}/histories/{historyUuid}",s))(TI||{}),wI=(o=>(o.LIST="/api/schematic/lists",o.CREATE="/api/schematic/create",o.UPLOAD="/api/schematic/upload",o.DELETE="/api/schematic/{uuid}/delete",o.UPDATE="/api/schematic/{uuid}/update",o.UPDATE_SORT="/api/schematic/{uuid}/update_sort",o.UPDATE_SORT1="/api/v2/documents/updateSorts",o))(wI||{}),SI=(m=>(m.LIST="/api/v2/documents/lists",m.CREATE="/api/v2/documents/create",m.UPLOAD="/api/v2/documents/upload",m.UPDATE="/api/v2/documents/{uuid}/update",m.UPDATE_CANVAS="/api/v2/documents/{uuid}/update_canvas",m.BATCH_UPDATE="/api/v2/documents/updateMany",m.DELETE="/api/v2/documents/{uuid}/delete",m.GET="/api/v2/documents/{uuid}",m.GET_BY_TITLE="/api/v2/documents/searchByName",m.GET_BY_SID="/api/v2/schematic/{schematicUuid}/documents",m.MOVE="/api/v2/documents/{uuid}/sort",m.CHECK_IN="/api/v4/documents/checkin/{project}/{branch}",m.CHECK_OUT="/api/v4/documents/checkout/{project}/{branch}",m.GET_CHECK="/api/v4/documents/checkout/{project}/{branch}",m.DELETE_PCB_RELATED="/api/v2/deleteCopperFontComponents",m))(SI||{}),_I=(m=>(m.LIST="/api/v2/devices",m.SEARCH_LIST="/api/devices/search",m.CREATE="/api/devices",m.UPLOAD="/api/devices/upload",m.UPDATE="/api/devices/{uuid}",m.BATCH_UPDATE="/api/devices/updateMany",m.GET="/api/devices/{uuid}",m.GET_ATTR_VALUE="/api/devices/attributes",m.GET_ATTR_KEYS="/api/devices/attributeKeys",m.GET_BY_USER_AND_TITLE="/api/devices/searchByUserUuidAndTitle",m.BATCH_GET="/api/devices/searchByIds",m.DELETE="/api/v4/devices/{uuid}/delete",m.STAR="/api/devices/{uuid}/star",m.UNSTAR="/api/devices/{uuid}/unstar",m.PLACE="/api/v2/upload",m))(_I||{}),AI=(g=>(g.LIST="/api/v2/components",g.SEARCH_LIST="/api/v2/components/search",g.CREATE="/api/v2/components/add",g.UPLOAD="/api/v2/components/upload",g.UPDATE="/api/v2/components/{uuid}/update",g.UPDATE_CANVAS="/api/v2/components/{uuid}/update_canvas",g.BATCH_UPDATE="/api/v2/components/updateMany",g.DELETE="/api/v4/components/{uuid}/delete",g.GET="/api/v2/components/{uuid}",g.GET_BY_TITLE="/api/v2/searchByTitles",g.GET_BY_DOC_UUID="/api/v2/components/searchByPcbId",g.GET_BY_USER_AND_TITLE="/api/v2/components/searchByUserUuidAndTitle",g.GET_BY_C="/api/searchProductByCode",g.BATCH_GET="/api/v2/components/searchByIds",g.STAR="/api/v2/components/{uuid}/star",g.UNSTAR="/api/v2/components/{uuid}/unstar",g))(AI||{}),CI=(i=>(i.LIST="/api/categories",i.CREATE="/api/categories",i.DELETE="/api/categories/{uuid}/delete",i.UPDATE="/api/categories/{uuid}",i))(CI||{}),DI=(i=>(i.SEARCH_LIST="/api/coppers/search",i.SEARCH_BY_PCB_UUID="/api/coppers/searchByPcbId",i.SET="/api/coppers/upload",i.DELETE="/api/coppers/delete",i))(DI||{}),PI=(i=>(i.SEARCH_LIST="/api/textpath/search",i.SEARCH_BY_PCB_UUID="/api/textpath/searchByPcbId",i.SET="/api/textpath/upload",i.DELETE="/api/textpath/delete",i))(PI||{}),OI=(s=>(s.SEARCH_LIST="/api/v2/resources/search",s.SET="/api/v2/resources/upload",s))(OI||{}),II=(a=>(a.LIST="/api/projects/projectUuid/attributes",a.SEARCH_LIST="/api/block_symbol_attributes/search",a.CREATE="/api/block_symbol_attributes",a.UPLOAD="/api/block_symbol_attributes/upload",a.DELETE="/api/block_symbol_attributes/delete",a.TICKET="/api/block_symbol_attributes/tickets",a))(II||{}),xI=(P=>(P.GET_BACKUP="/api/backups/{name}",P.GET_COMPONENT="/api/v2/components/clientSearch",P.GET_DEVICE="/api/devices/clientSearch",P.GET_LIBS="/api/client/libraryPaths",P.CREATE_LIB="/api/client/createPath",P.CREATE_PROJECT="/api/client/createProject",P.OPEN_PROJECT="/api/client/openProject",P.CLOSE_PROJECT="/api/client/closeProject",P.GET_PROJECT_PATHS="/api/client/projectPaths",P.SELECT_PATH_ON_OFFLINE="/api/fileDialog/saveFile",P.SELECT_PATH_ON_LINE="app://api/fileDialog/saveFile",P.OPEN_DIALOG="/api/fileDialog/openPath",P.SELECT_DIR_ON_OFFLINE="/api/fileDialog/dirtory",P.SELECT_DIR_ON_LINE="app://api/client/openDir",P.SELECT_FILE="/api/fileDialog/file",P.EXPORT_FILE_ON_OFFLINE="/api/client/uploadFile",P.EXPORT_FILE_ON_LINE="app://api/client/uploadFile",P.GET_PRJ_CACHE_LIST="/api/client/tmpBackupList",P.OPERATE_PRJ_CACHE="/api/client/tmpBackup",P.CREATE_PRJ_CACHE_ONLINE="/api/client/tmpBackup/create",P.DELETE_PRJ_CACHE_ONLINE="/api/client/tmpBackup/delete",P.GET_RECENT_PROJECT="/api/client/projectHistory",P.DELETE_RECENT_PROJECT="/api/client/projectHistory/delete",P.SET_KV_CACHE="/api/client/setEditorCache",P.GET_KV_CACHE="/api/client/getEditorCache",P.IS_EXIST_KV_CACHE="/api/client/existEditorCache",P.SEARCH_SCHEMATIC_BY_NAME="/api/schematic/searchByName",P.OPEN_URL="app://api/system/openURL",P))(xI||{}),vI=(n=>(n.LOG="/api/v3/editor_log/upload",n.COMPONENT_LOG="/api/v4/componentLogs",n.TEAMS="/api/teams",n.GET_EDITOR_VERSION="/api/editor/version",n.SET_EDITOR_VERSION="/api/editor/changeVersion",n))(vI||{}),Ae={PROJECT:yI,BRANCH:EI,PROJECT_HISTORY:bI,COMPONENT_HISTORY:TI,SCHEMATIC:wI,DOCUMENT:SI,DEVICE:_I,COMPONENT:AI,TAG:CI,COPPER:DI,FONT:PI,BLOB:OI,ATTR:II,CLIENT:xI,OTHER:vI};var ns=class{verify(t){if(Object.prototype.toString.call(t)==="[object Object]")for(let s in t){let r=t[s];if(r==="")return!0;ot.notNull(r)}return!0}exec(t){return t}async GET(t,s,r){if(this.verify(s))return this.exec(await dt("GET",t,s,r,fe.currentProject.projectId))}async POST(t,s,r){if(this.verify(s))return this.exec(await dt("POST",t,s,r,fe.currentProject.projectId))}async DELETE(t,s,r){if(this.verify(s))return this.exec(await dt("DELETE",t,s,r,fe.currentProject.projectId))}async PUT(t,s,r){if(this.verify(s))return this.exec(await dt("PUT",t,s,r,fe.currentProject.projectId))}async FETCH(t,s,r){return this.exec(await fetch(t,{method:s,body:r}).then(i=>i.json()))}encode(t){return encodeURIComponent(t)}parseOptions(t,s){for(let r in s)r in t?t[r]=Object.assign(t[r],s[r]):t[r]=s[r];return t}};var kp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{let{projectId:r,paths:i}=s;if(Ge(r))return X(r).instance.getAllArrDataByPath(i);let n=Ae.ATTR.LIST,a={paths:i,project_uuid:r},o={headers:Object.assign(Qt,{path:r})};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async searchList(s){try{let{projectId:r,paths:i}=s;return r&&i?this.searchByPaths(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}async searchByPaths(s){try{let{projectId:r,paths:i}=s;if(Ge(r))return X(r).instance.getAllArrDataByPath(i);let n=Ae.ATTR.SEARCH_LIST,a={path:i,project_uuid:r},o={headers:Object.assign(Qt,{path:r})};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async create(s){try{let{projectId:r,path:i,attr:n}=s;if(Ge(r))return X(r).instance.addData({path:i,attr:n});let a=Ae.ATTR.CREATE,o={project_uuid:r,path:i,attr:JSON.stringify(n)},c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async upload(s){try{let{projectId:r,datas:i}=s;if(Ge(r))return X(r).instance.batchUpdate(i);let n=Ae.ATTR.UPLOAD,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{projectId:r,paths:i}=s;if(Ge(r))return X(r).instance.batchDelete(i);let n=Ae.ATTR.DELETE,a={project_uuid:r,paths:i},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async ticket(s){try{let{projectId:r,hash:i}=s,n=Ae.ATTR.TICKET+`?project_uuid=${r}&hash=${i}`,a={project_uuid:r,hash:i},o={headers:{path:r}};return this.GET(n,a,o)}catch(r){return{success:!1,message:r.message}}}};var Mp=class extends ns{constructor(s){super();this.parent=s}async searchList(s){try{let{projectId:r,hashs:i}=s;return r&&i?this.searchByHashs(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}async searchByHashs(s){try{let{projectId:r,hashs:i}=s;if(Ge(r))return X(r).blob.getLotsArrByHash(i);let n=Ae.BLOB.SEARCH_LIST,a={hash:i,project_uuid:r},o={headers:Object.assign(Qt,{path:r})};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async set(s){try{let{projectId:r,datas:i}=s;if(Ge(r))return X(r).blob.batchUpdateData(i);let n=Ae.BLOB.SET,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}};var jp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{let r=kt(Ae.BRANCH.LIST,{project_uuid:s}),i={headers:Object.assign(Qt,{path:s})};return this.GET(r,void 0,i)}catch(r){return{success:!1,message:r.message}}}async get(s){try{let{projectId:r,branch_uuid:i}=s;if(!i)return{success:!1,message:"Missing branch_uuid!"};let n=kt(Ae.BRANCH.GET,{project_uuid:r,branch_uuid:i}),a={headers:Object.assign(Qt,{path:r})};return this.GET(n,void 0,a)}catch(r){return{success:!1,message:r.message}}}async create(s){try{let{projectId:r,node:i=!1}=s,n=kt(Ae.BRANCH.CREATE,{project_uuid:r}),a={node:i};s.history_uuid&&(a.history_uuid=s.history_uuid);let o={headers:Object.assign(Qt,{path:r})};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async update(s){try{let{projectId:r,branchUuid:i,name:n}=s,a=kt(Ae.BRANCH.UPDATE,{project_uuid:r,branch_uuid:i}),o={name:n},c={headers:Object.assign(Qt,{path:r})};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{projectId:r,branchUuid:i}=s,n=kt(Ae.BRANCH.DELETE,{project_uuid:r,branch_uuid:i}),a={headers:Object.assign(Qt,{path:r})};return this.DELETE(n,void 0,a)}catch(r){return{success:!1,message:r.message}}}};async function tn(e){var t;if(e){if(Array.isArray(e.tags))e.tags=e.tags;else if(!Array.isArray(e.tags)&&((t=e.tags)!=null&&t.parent_tag)){let s=[];e.tags.parent_tag&&e.tags.parent_tag.uuid&&(s.push(e.tags.parent_tag.uuid),e.tags.child_tag&&e.tags.child_tag.uuid&&s.push(e.tags.child_tag.uuid));let r;e.project_uuid&&!e.custom_tags&&(r=Va({tags:e.tags})),e.tags=s,e.custom_tags=r}}return e}function uh(e){return Array.isArray(e)?e:[e]}function NI(e){if(e.attributes)for(let t in e.attributes)e.attributes[t]=RI(e.attributes[t]);return e.description&&(e.description=RI(e.description)),e}function RI(e){return e==null?e="":typeof e=="string"&&(e=e.replace(/\n|\r|\t/g,""),e=e.replace(/[\x00-\x1F\x7F]+/g,"")),e}var LI=[Ne.PART,Ne.SHEET_SYMBOL,Ne.NETFLAG,Ne.NETPORT,Ne.NONEELEC_SYMBOL,Ne.SHORT_SYMBOL,Ne.BLOCK_SYMBOL,Ne.OFF_PAGE_CONNECTOR,Ne.DIFF_PAIRS_FLAG];function u0(e){return LI.indexOf(e)>=0}function hh(e){return LI.indexOf(e)>=0&&e!==Ne.BLOCK_SYMBOL}async function BI(e,t){try{return{success:!0,result:t?await h0(e,t):e}}catch(s){return{success:!1,message:s.message}}}async function kI(e,t,s,r){try{if(ve){let i={blob:e,title:t,extension:s};return r!==void 0&&(i.isExport=r),await se.getInstance().client.exportFile(i)}else return XD(e,t+s),{success:!0}}catch(i){throw new Error(`DownLoad zip failed! ${t} ${i.message}`)}}var Fp=class extends ns{constructor(s){super();this.parent=s}check(){if(!Za)throw new Error("Api call error! The api does not exist!")}async searchComponentByTitle(s,r){try{if(this.check(),Ge(s)){let o=X(s),c=(await o.symbol.getArrDataByTitle(r)).result||[],l=(await o.footprint.getArrDataByTitle(r)).result||[];return{success:!0,result:c.concat(l)}}let i=Ae.CLIENT.GET_COMPONENT,n={headers:{path:this.encode(s)}},a={title:r,path:s};return this.POST(i,a,n)}catch(i){return{success:!1,message:i.message}}}async searchComponentBySource(s,r,i){try{if(this.check(),i&&ot.mustArray(i),Ge(s)){let c=X(s),l=(await c.symbol.getAllArrDataBySource(r)).result||[],u=(await c.footprint.getAllArrDataBySource(r)).result||[],h=l.concat(u);return{success:!0,result:i?h.filter(d=>i.includes(d.docType)):h}}let n=Ae.CLIENT.GET_COMPONENT,a={headers:{path:this.encode(s)}},o={source:r,path:s};return i&&(o.docType=i),this.POST(n,o,a)}catch(n){return{success:!1,message:n.message}}}async searchComponentBySourceAndVersion(s,r,i,n){var a;try{if(this.check(),Ge(s)){if(n===Ne.FOOTPRINT)return X(s).footprint.getDataBySourceAndVersion({source:r,version:i});if(u0(n))return X(s).symbol.getDataBySourceAndVersion({source:r,version:i});throw new Error("Api call error!")}let o=Ae.CLIENT.GET_COMPONENT,c={headers:{path:this.encode(s)}},l={source:r,version:i,path:s};n&&(l.docType=n);let u=await this.POST(o,l,c);return u.success===!1?{success:!1,...u}:{success:!0,result:(a=u.result)==null?void 0:a[0]}}catch(o){return{success:!1,message:o.message}}}async searchDeviceBySource(s,r){try{if(this.check(),Ge(s))return X(s).device.getAllArrDataBySource(r);let i=Ae.CLIENT.GET_DEVICE,n={headers:{path:this.encode(s)}},a={source:r};return this.POST(i,a,n)}catch(i){return{success:!1,message:i.message}}}async searchDeviceByTitle(s,r){try{if(this.check(),Ge(s))return X(s).device.getArrDataByTitle(r);let i=Ae.CLIENT.GET_DEVICE,n={headers:{path:this.encode(s)}},a={title:r};return this.POST(i,a,n)}catch(i){return{success:!1,message:i.message}}}async searchDeviceBySourceAndVersion(s,r,i){var n;try{if(this.check(),Ge(s))return X(s).device.getDataBySourceAndVersion({source:r,version:i});let a=Ae.CLIENT.GET_DEVICE,o={headers:{path:this.encode(s)}},c={source:r,version:i},l=await this.POST(a,c,o);return l.success===!1?{success:!1,code:l.code,message:l.message}:{success:!0,result:(n=l.result)==null?void 0:n[0]}}catch(a){return{success:!1,message:a.message}}}async getBackup(s){try{this.check();let{name:r}=s,i=fe.currentProject.projectId,n=kt(Ae.CLIENT.GET_BACKUP,{name:r}),a={responseType:Fc.Blob,headers:{path:i}};return this.GET(n,void 0,a)}catch(r){return{success:!1,message:r.message}}}async getLibs(s={}){try{this.check();let{refresh:r}=s,i=Ae.CLIENT.GET_LIBS+`?_=${new Date().getTime()}`,n={};return r&&(n.refresh=r),this.GET(i,n)}catch(r){return{success:!1,message:r.message}}}async createLib(s){try{this.check();let{name:r,path:i}=s,n=Ae.CLIENT.CREATE_LIB,a={name:r,path:i};return this.POST(n,a)}catch(r){return{success:!1,message:r.message}}}async createProject(s){try{this.check();let{cbb_project:r,name:i,introduction:n,description:a,path:o,public:c,user_uuid:l,default_sheet:u=""}=s,h=Ae.CLIENT.CREATE_PROJECT,p={cbb_project:r,name:i,introduction:n,content:a,path:o,public:c,user_uuid:l,default_sheet:u};return r&&s.tags?p.tags=s.tags:r&&!s.tags&&(p.tags=[]),this.POST(h,p)}catch(r){return{success:!1,message:r.message}}}async openProject(s){try{this.check();let r=Ae.CLIENT.OPEN_PROJECT,i={path:s};return this.POST(r,i)}catch(r){return{success:!1,message:r.message}}}async closeProject(s){try{this.check();let r=Ae.CLIENT.CLOSE_PROJECT,i={path:s};return this.POST(r,i)}catch(r){return{success:!1,message:r.message}}}async getProjectPaths(s){try{this.check();let r=Ae.CLIENT.GET_PROJECT_PATHS,i={};return s.cbb&&(i.cbb=s.cbb),s.refresh&&(i.refresh=s.refresh),s.cbb&&s.tags&&(i.tag=s.tags),this.GET(r,i)}catch(r){return{success:!1,message:r.message}}}async selectPath(s){try{return this.check(),ve?this.selectPathOnOffline(s):_u?this.selectPathOnLine(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}selectPathOnOffline(s){let{path:r,isExport:i,filters:n}=s,a=Ae.CLIENT.SELECT_PATH_ON_OFFLINE,o={title:r,isExport:i,filters:JSON.stringify(n)};return this.POST(a,o)}async selectPathOnLine(s){let{path:r,isExport:i,filters:n}=s,a=Ae.CLIENT.SELECT_PATH_ON_LINE,o={title:r,isExport:i,filters:JSON.stringify(n)};return await(await fetch(a,{method:"post",body:JSON.stringify(o)})).json()}async openDialog(s){try{this.check();let r=Ae.CLIENT.OPEN_DIALOG,i={path:s},n={searchParams:!0};return this.GET(r,i,n)}catch(r){return{success:!1,message:r.message}}}async selectDir(s){try{return this.check(),ve?this.selectDirOnOffline(s):_u?this.selectDirOnLine(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}async selectDirOnOffline(s){let r=Ae.CLIENT.SELECT_DIR_ON_OFFLINE,i={path:s};return this.GET(r,i)}async selectDirOnLine(s){let r=Ae.CLIENT.SELECT_DIR_ON_LINE;return(await fetch(r,{method:"post",body:JSON.stringify({path:s})})).json()}async selectFile(s){try{let{path:r,filters:i}=s,n=Ae.CLIENT.SELECT_FILE,a={path:r,filters:JSON.stringify(i)};return this.GET(n,a)}catch(r){return{success:!1,message:r.message}}}async exportFile(s){var r,i;try{this.check();let{blob:n,title:a,extension:o,isExport:c=!0}=s,l=await uc(n);a=a.replace(/[*:;"|\/\\<>?\r\n\t]|\.\./g,"_");let u=await De("EasyEDA Professional File"),h=[{extensions:[o.replace(/\./,"")],name:u}],p=await this.selectPath({path:a,isExport:c,filters:h});if(p.success){if(!((r=p.result)!=null&&r.path))return{success:!1,message:"The projectPath is empty"}}else return{success:!1,...p};let d=p.result.path,f=d.lastIndexOf("."),m=d.substring(f);(f==-1||m!==o)&&(d=d.substring(0,f)+o);let g=/[^\/\\]+\.(epro|epro2|esym|efoo|epcb|esch|epan|epanl|zip|eprj|elib|xlsx|csv|pdf|dxf|txt|json|step|tel|enet|png|svg|pcbdoc|schdoc|asc|net|d|c)$/i,b=d.replace(g,""),E=(i=d.match(g))==null?void 0:i[0];return E?ve?this.exportFileOnOffline({buffer:l.data,targetPath:b,fileName:E,path:d}):_u?this.exportFileOnLine({buffer:l.data,targetPath:b,fileName:E}):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}:{success:!1,message:["Format is not supported!",d]}}catch(n){return{success:!1,message:n.message}}}exportFileOnOffline(s){try{let{buffer:r,targetPath:i,fileName:n,path:a}=s,o=new File([r],n),c=Ae.CLIENT.EXPORT_FILE_ON_OFFLINE,l=new FormData;l.append("file",o),l.append("dirname",i);let u={contentType:!1,headers:{path:a}};return this.POST(c,l,u)}catch(r){return{success:!1,message:r.message}}}async exportFileOnLine(s){try{let{buffer:r,targetPath:i,fileName:n}=s,a=new File([r],n),o=new URLSearchParams;o.append("savePath",i),o.append("fileName",n);let c=Ae.CLIENT.EXPORT_FILE_ON_LINE+`?${o.toString()}`.replace(/\+/g,"%20"),l=await new Promise((h,p)=>{let d=new FileReader;d.onloadend=()=>{let f=d.result,m=f.indexOf(",");h(f.substring(m+1))},d.onerror=p,d.readAsDataURL(a)});return await(await fetch(c,{method:"post",body:l})).json()}catch(r){return{success:!1,message:r.message}}}async cacheList(s){try{this.check();let{path:r,title:i}=s,n=Ae.CLIENT.GET_PRJ_CACHE_LIST,a;return i&&(n+=`?projetName=${encodeURIComponent(i)}`),r&&(a={headers:{path:r}}),this.GET(n,void 0,a)}catch(r){return{success:!1,message:r.message}}}async getCache(s){try{this.check();let r=Ae.CLIENT.OPERATE_PRJ_CACHE+`?fileName=${encodeURIComponent(s)}`,i={responseType:Fc.Blob};return this.GET(r,void 0,i)}catch(r){return{success:!1,message:r.message}}}async setCache(s){try{this.check();let{title:r,upload:i,path:n}=s,a=ve?Ae.CLIENT.OPERATE_PRJ_CACHE:Ae.CLIENT.CREATE_PRJ_CACHE_ONLINE,o=new FormData;o.append("projectName",r),o.append("upload",i);let c={headers:{path:n},contentType:!1};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async deleteCache(s,r={}){try{this.check();let{path:i,fileNames:n=[],dir:a=[]}=s,o=new FormData;n.length&&o.append("fileNames",JSON.stringify(n)),a.length&&o.append("dir",JSON.stringify(a));let c=Object.assign({headers:{path:i},contentType:!1},r),l=ve?Ae.CLIENT.OPERATE_PRJ_CACHE:Ae.CLIENT.DELETE_PRJ_CACHE_ONLINE;return this.DELETE(l,o,c)}catch(i){return{success:!1,message:i.message}}}async projectHistory(){try{this.check();let s=Ae.CLIENT.GET_RECENT_PROJECT;return this.GET(s)}catch(s){return{success:!1,message:s.message}}}async deletHistory(s){try{this.check();let r=Ae.CLIENT.DELETE_RECENT_PROJECT,i={path:s};return this.POST(r,i)}catch(r){return{success:!1,message:r.message}}}async setKVCache(s,r={}){try{this.check();let{path:i,key:n,value:a}=s,o=Ae.CLIENT.SET_KV_CACHE,c={key:n,value:JSON.stringify(a)};return r.headers&&(r.headers=Object.assign({path:i},r.headers)),this.POST(o,c,r)}catch(i){return{success:!1,message:i.message}}}async getKVCache(s){try{this.check();let{path:r,key:i}=s,n=Ae.CLIENT.GET_KV_CACHE+`?key=${i}`,a={key:i},o={headers:{path:r}},c=await this.GET(n,a,o);if(c.success===!1)return{success:!1,code:c.code,message:c.message};let l=c.result;return l&&l.value&&Object.prototype.toString.call(l.value)==="[object String]"?{success:!0,result:JSON.parse(l.value)}:{success:!0,result:l==null?void 0:l.value}}catch(r){return{success:!1,message:r.message}}}async isExistKVCache(s){var r;try{this.check();let{path:i,key:n}=s,a=Ae.CLIENT.IS_EXIST_KV_CACHE+`?key=${n}`,o={key:n},c={headers:{path:i}},l=await this.GET(a,o,c);return l.success===!1?{success:!1,code:l.code,message:l.message}:{success:!0,result:((r=l.result)==null?void 0:r.isExist)||!1}}catch(i){return{success:!1,message:i.message}}}async searchSchematicByName(s){try{this.check();let{projectId:r,name:i}=s;if(Ge(r))return X(r).schematic.getDataByName(i);let n=Ae.CLIENT.SEARCH_SCHEMATIC_BY_NAME,a={name:i},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async openURL(s){try{let r=Ae.CLIENT.OPEN_URL;return await(await fetch(r,{method:"post",body:JSON.stringify({url:s})})).json()}catch(r){return{success:!1,message:r.message}}}};var MI=Number.MAX_VALUE,mt={SCHEMATIC:"SCHEMATIC",SHEET:"SHEET",SYMBOL:"SYMBOL",BLOCK_SYMBOL:"BLOCK_SYMBOL",ATTR:"BLOCK_SYMBOL_ATTR",PCB:"PCB",PANEL:"PANEL",DEVICE:"DEVICE",FOOTPRINT:"FOOTPRINT",ATTRHASH:"ATTRHASH",BLOB:"BLOB",COPPER:"COPPER_POUR",FONT:"FONT"};var jI=`

`;var d0={DEVICE:"device",SYMBOL:"symbol",FOOTPRINT:"footprint"};var Up=class extends ns{constructor(s){super();this.parent=s}async list(s){var r,i;try{let{path:n,uid:a,page:o,pageSize:c,docType:l,tags:u}=s;if(Ge(n)){let f=X(n),m=((r=await f.symbol.getAllArrData())==null?void 0:r.result)||[],g=((i=await f.footprint.getAllArrData())==null?void 0:i.result)||[],b=m.concat(g),E;for(let T of b){if(a&&(E=E||{},T.owner&&a===T.owner.uuid)){E[T.uuid]=!0;break}if(l&&l.length&&l.indexOf(T.docType)>-1){E[T.uuid]=!0;break}}return{success:!0,result:E?b.filter(T=>E[T.uuid]):b}}let h=Ae.COMPONENT.LIST,p={path:n,uid:a,page:o,pageSize:c};s.tags&&(p.tag=s.tags),s.docType&&(ot.mustArray(s.docType),p.docType=s.docType),s.tagNotExists&&(p.tagNotExists=s.tagNotExists);let d={headers:{path:this.encode(n)},searchParams:!0};return this.GET(h,p,d)}catch(n){return{success:!1,message:n.message}}}async searchList(s){try{let{path:r,uid:i,wd:n,title:a,source:o,version:c,docType:l,uuids:u,titles:h,type:p,user_uuid:d,docUuid:f,codes:m}=s,g;return ve&&a?g=await this.parent.client.searchComponentByTitle(r,a):o&&c?g=await this.searchBySourceAndVersion(s):o?g=await this.searchBySource(s):i||n?g=await this.searchPages(s):h&&p&&d?g=await this.searchByTitles(h,p,d,r,l):m?g=await this.searchByC(m,r):f?g=await this.searchByDocUuid(f,r):u?g=await this.searchByIds(s):g=await{success:!1,message:`Api call error! The api does not exist! data: ${s}`},g}catch(r){return{success:!1,message:r.message}}}async searchByTitles(s,r,i,n,a=[]){try{if(a&&ot.mustArray(a),Ge(n)){let u=X(n),h;if(r===d0.DEVICE)h=await u.device.getAllArrData();else if(r===d0.SYMBOL)h=await u.symbol.getAllArrData();else if(r===d0.FOOTPRINT)h=await u.footprint.getAllArrData();else return{success:!1,message:`Api call error! The api does not exist! type: ${r}`};if(!h.success)return{success:!1,message:h.message};let p=h.result,d;for(let m of p){if(i&&(d=d||{},m.owner&&i===m.owner.uuid)){d[m.uuid]=!0;break}if(a&&a.length&&a.indexOf(m.docType)>-1){d[m.uuid]=!0;break}if(s&&s.length&&(d=d||{},s.indexOf(m.title)>-1)){d[m.uuid]=!0;break}}return{success:!0,result:d?p.filter(m=>d[m.uuid]):p}}let o=Ae.COMPONENT.GET_BY_TITLE,c={titles:s,docType:a,type:r,user_uuid:i,path:n},l={headers:Object.assign(Qt,{path:this.encode(n)})};return this.POST(o,c,l)}catch(o){return{success:!1,message:o.message}}}searchPages(s){try{let r=Ae.COMPONENT.SEARCH_LIST,{path:i}=s;if(Ge(i))throw new Error("Api call error!");let n={path:i};s.uid&&(n.uid=s.uid),s.page&&(n.page=s.page),s.pageSize&&(n.pageSize=s.pageSize),s.docType&&(ot.mustArray(s.docType),n.docType=s.docType),s.tags&&(n.tag=s.tags),s.wd&&(n.wd=s.wd),s.returnListStyle&&(n.returnListStyle=s.returnListStyle);let a={headers:{path:this.encode(i)}};return s.options&&(a=this.parseOptions(a,s.options)),this.POST(r,n,a)}catch(r){return{success:!1,message:r.message}}}searchByC(s,r=""){try{if(Ge(r))throw new Error("Api call error!");let i=Ae.COMPONENT.GET_BY_C,n={codes:s},a={headers:{path:this.encode(r)}};return this.POST(i,n,a)}catch(i){return{success:!1,message:i.message}}}async searchByDocUuid(s,r){try{if(Ge(r)){let o=X(r),c=await o.footprint.getAllPrimaryKeys();if(!c.success)return{success:!1,message:c.message};let l=c.result.filter(h=>h.startsWith(s)),u=[];return l.forEach(h=>{let p=o.footprint.getData(h);p&&u.push(p)}),{success:!0,result:u}}let i=Ae.COMPONENT.GET_BY_DOC_UUID,n={pcbId:s,path:r},a={headers:{path:this.encode(r)}};return this.POST(i,n,a)}catch(i){return{success:!1,message:i.message}}}async searchByIds(s){var r,i;try{let{uuids:n,path:a}=s;if(Ge(a)){let h=X(a),p=((r=await h.symbol.getLotsArrData(n))==null?void 0:r.result)||[],d=((i=await h.footprint.getLotsArrData(n))==null?void 0:i.result)||[];return{success:!0,result:p.concat(d)}}let o=Ae.COMPONENT.BATCH_GET,c={uuids:n};s.path&&(c.path=s.path),s.forceOnline&&(c.forceOnline=s.forceOnline);let l=Qt;s.path&&(l.path=this.encode(s.path));let u={headers:l};return this.POST(o,c,u)}catch(n){return{success:!1,message:n.message}}}verifyOwner(s){if(ve||s)return!0;throw new Error(`Missing parameters! owner: ${s}`)}async create(s,r=!1){try{let{path:i,title:n,docType:a,description:o="",tags:c=[]}=s;s.project_uuid||this.verifyOwner(s.owner),await tn(s);let l=await Ht();if(Ge(i)){let d=X(i);return s.docType===Ss.FOOTPRINT?d.footprint.addData(s):ni(s.docType)?d.symbol.addData(s):{success:!1,message:`The docType is incorrect! ${s.docType}`}}let u=Ae.COMPONENT.CREATE,h={title:n,docType:a,description:o,tags:c};s.owner&&(h.owner=s.owner),s.tags&&(h.tags=s.tags),s.source&&(h.source=s.source),s.version&&(h.version=s.version),s.project_uuid&&(h.project_uuid=s.project_uuid),s.ignoreDuplicateNameCheck&&(h.ignoreDuplicateNameCheck=s.ignoreDuplicateNameCheck),s.checkDevice&&(h.checkDevice=s.checkDevice),r&&s.dataStr&&(h.dataStr=s.dataStr);let p={headers:Object.assign(Qt,{path:this.encode(i)})};return this.POST(u,h,p)}catch(i){return{success:!1,message:i.message}}}async upload(s){try{let{path:r,datas:i,newProject:n="no"}=s,a=await Ht();for(let u of i)await tn(u);if(Ge(r)){let u=X(r),h=[];for(let d=0;d<i.length;d++){let f=i[d];f.docType===Ss.FOOTPRINT?h.push(await u.footprint.addData(f)):ni(f.docType)&&h.push(await u.symbol.addData(f))}return{success:!0,result:await Promise.all(h)}}let o=Ae.COMPONENT.UPLOAD,c={path:r,data:JSON.stringify(i),newProject:n},l={headers:{path:this.encode(r)}};return this.POST(o,c,l)}catch(r){return{success:!1,message:r.message}}}async update(s,r=!1){try{let{path:i,uuid:n,docType:a}=s;if(await tn(s),Ge(i)){let u=X(i),h;if(a===Ss.FOOTPRINT)h=u.footprint;else if(ni(s.docType))h=u.symbol;else return{success:!1,message:`Api call error! The api does not exist! docType: ${a}`};let p=await h.updateData(s);return p.success===!1?{success:!1,message:p.message}:{success:!0,result:p.result}}let o={headers:Object.assign(Qt,{path:this.encode(i)})},c={};s.title&&(c.title=s.title),s.source&&(c.source=s.source),s.version&&(c.version=s.version),s.docType&&(c.docType=s.docType),s.owner&&(c.owner=s.owner),s.description&&(c.description=s.description),s.tags&&(c.tags=s.tags),s.title&&s.ignoreDuplicateNameCheck&&(c.ignoreDuplicateNameCheck=s.ignoreDuplicateNameCheck),s.docType===Ss.BLOCK_SYMBOL&&s.title&&s.dontChangeSchName&&(c.dontChangeSchName=s.dontChangeSchName),r&&s.dataStr&&(c.dataStr=s.dataStr);let l=kt(Ae.COMPONENT.UPDATE,{uuid:n});return c.uuid=s.uuid,c.path=s.path,this.POST(l,c,o)}catch(i){return{success:!1,message:i.message}}}async batchUpdate(s){try{let{path:r,datas:i}=s,n=await Ht();for(let l of i)await tn(l);if(Ge(r)){let l=X(r),u=[];for(let p=0;p<i.length;p++){let d=i[p];d.docType===Ss.FOOTPRINT?u.push(await l.footprint.updateData(d)):ni(d.docType)&&u.push(await l.symbol.updateData(d))}return{success:!0,result:await Promise.all(u)}}let a=Ae.COMPONENT.BATCH_UPDATE,o={path:r,data:JSON.stringify(i)},c={headers:{path:this.encode(r)}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{path:r,uuid:i,docType:n}=s;if(Ge(r)){let l=X(r);return n===Ss.FOOTPRINT?l.footprint.deleteData(i):ni(n)?l.symbol.deleteData(i):{success:!1,message:`Illegal data type! docType: ${n}, data: ${s}`}}let a=Ae.COMPONENT.DELETE,o={uuid:i,path:r},c={headers:{path:this.encode(r)}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async get(s){var r,i,n,a,o,c,l;try{let{path:u,uuid:h,docType:p}=s;if(!h)return{success:!1,message:"Missing uuid!"};let d=Ge(u);if(d){let E=X(u),y,T;return p===Ss.FOOTPRINT?T=E.footprint:ni(p)&&(T=E.symbol),T?y=await((r=T.getData(h))==null?void 0:r.result):(y=!y&&((i=await E.symbol.getData(h))==null?void 0:i.result),y=!y&&((n=await E.footprint.getData(h))==null?void 0:n.result)),y.docType===Ss.BLOCK_SYMBOL&&s.withSchematic==="on"&&(y.schematic=((o=(a=await E.schematic.getDataByName(y.title))==null?void 0:a.result)==null?void 0:o[0])||null),y.docType===Ss.BLOCK_SYMBOL&&s.withPcb==="on"&&(y.pcb=((l=(c=await E.pcb.getDataByTitle(y.title))==null?void 0:c.result)==null?void 0:l[0])||null),{success:!0,result:y}}let f=Ae.COMPONENT.GET,m={uuid:this.encode(h),path:this.encode(u)};s.withSchematic&&(m.withSchematic=s.withSchematic),s.withPcb&&(m.withPcb=s.withPcb);let g={headers:{path:this.encode(u)}};Za&&(g.contentType=!1);let b=await this.GET(f,m,g);if(b.success===!0&&s.needStr){let E=b.result,y=await td.getProLibSource({...E,isProject:d});if(y.success===!1)return{success:!1,code:y.code,message:y.message};E.canvas=y.result,E.history_uuid=E.history_uuid}else if(b.success===!0&&s.needTransform){let E=b.result,y=await td.getProLibSource({...E,path:u,isProject:d});if(y.success===!1)return{success:!1,code:y.code,message:y.message};E.canvas=y.result,E.history_uuid=E.history_uuid}return b}catch(u){return{success:!1,message:u.message}}}async create1(s){return this.create(s,!0)}async update1(s){return this.update(s,!0)}async searchBySourceAndVersion(s){var o,c;let{path:r,source:i,version:n,docType:a}=s;if(Ge(r)){let l=X(r),u=(o=await l.symbol.getDataBySourceAndVersion({source:i,version:n}))==null?void 0:o.result;return u=!u&&((c=await l.footprint.getDataBySourceAndVersion({source:i,version:n}))==null?void 0:c.result),{success:!0,result:[u]}}if(ve&&i&&n){let l=await this.parent.client.searchComponentBySourceAndVersion(r,i,n,a);return l.success===!1?{success:!1,...l}:{success:!0,result:[l.result]}}return{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}async searchBySource(s){var a,o;let{path:r,source:i,docType:n}=s;if(Ge(r)){let c=X(r),l=(a=await c.symbol.getAllArrDataBySource(i))==null?void 0:a.result;return l=!l&&((o=await c.footprint.getAllArrDataBySource(i))==null?void 0:o.result),{success:!0,result:l}}return ve&&i?await this.parent.client.searchComponentBySource(r,i,n&&[n]):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}async searchByUsersAndTitles(s){var r,i;try{let{path:n,titles:a=[],user_uuids:o=[],docType:c=""}=s;if(Ge(n)){let p=X(n),d=((r=await p.symbol.getAllArrData())==null?void 0:r.result)||[],f=((i=await p.footprint.getAllArrData())==null?void 0:i.result)||[],m=d.concat(f),g;for(let E of m){if(o&&o.length&&(g=g||{},o.indexOf(E.owner.uuid)>-1)){g[E.uuid]=!0;break}if(a&&a.length&&(g=g||{},a.indexOf(E.title)>-1)){g[E.uuid]=!0;break}if(c&&(g=g||{},c===E.docType)){g[E.uuid]=!0;break}}return{success:!0,result:g?m.filter(E=>g[E.uuid]):m}}let l=Ae.COMPONENT.GET_BY_USER_AND_TITLE,u={path:n,titles:a,user_uuids:o,docType:c},h={headers:Object.assign(Qt,{path:this.encode(n)})};return this.POST(l,u,h)}catch(n){return{success:!1,message:n.message}}}async star(s){try{let{path:r,uuid:i}=s,n=Ae.COMPONENT.STAR,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async unstar(s){try{let{path:r,uuid:i}=s,n=Ae.COMPONENT.UNSTAR,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}};var Hp=class extends ns{constructor(s){super();this.parent=s}async searchList(s){try{let{projectId:r,paths:i,pcbId:n}=s;return r&&i?this.searchByPaths(s):n?this.searchByPcbId(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}async searchByPaths(s){try{let{projectId:r,paths:i}=s,n=Ae.COPPER.SEARCH_LIST,a={paths:i,project_uuid:r,path:r},o={headers:Object.assign(Qt,{path:r})};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async searchByPcbId(s){try{let{projectId:r,pcbId:i}=s,n=Ae.COPPER.SEARCH_BY_PCB_UUID,a={pcbId:i,path:r},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async set(s){try{let{projectId:r,datas:i}=s,n=Ae.COPPER.SET,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{projectId:r,paths:i}=s,n=Ae.COPPER.DELETE,a={path:i,project_uuid:r},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}};var Gp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{let{path:r,uid:i,page:n,pageSize:a}=s;if(Ge(r)){let u=X(r),h=await u.device.getAllArrData();if(!h.success)return{success:!1,message:h.message};let p=h.result,d;for(let m of p){if(s.symbol_type&&m.symbol_type===s.symbol_type){d=d||{},d[m.uuid]=!0;break}if(s.footprint_type&&m.footprint_type===s.footprint_type){d=d||{},d[m.uuid]=!0;break}if(s.attributes){d=d||{};for(let g in s.attributes)if(m.attributes[g]===s.attributes[g]){d[m.uuid]=!0;break}if(d[m.uuid])break}}let f=d?p.filter(m=>d[m.uuid]):p;for(let m of f)if(s.withSymbolPackage){let g=m.attributes.Symbol,b=m.attributes.Footprint;m.symbol=g&&(await u.symbol.getData(g)).result,m.footprint=b&&(await u.footprint.getData(b)).result}return{success:!0,result:f}}let o=Ae.DEVICE.LIST,c={path:r,uid:i,page:n,pageSize:a},l={headers:{path:this.encode(r)},searchParams:!0};return s.symbol_type&&(ot.mustNumber(s.symbol_type),c.symbol_type=s.symbol_type),s.footprint_type&&(ot.mustNumber(s.footprint_type),c.footprint_type=s.footprint_type),s.attributes&&!mn(s.attributes)&&(c.attributes=s.attributes),s.tags&&(c.tag=s.tags),s.withSymbolPackage&&(c.withSymbolPackage=s.withSymbolPackage),s.tagNotExists&&(c.tagNotExists=s.tagNotExists),this.GET(o,c,l)}catch(r){return{success:!1,message:r.message}}}async searchList(s){try{let{path:r,uid:i,wd:n,title:a,source:o,version:c,uuids:l}=s,u;if(ve&&a)u=await this.parent.client.searchDeviceByTitle(r,a);else if(o&&c)u=await this.searchBySourceAndVersion(s);else if(o)u=await this.searchBySource(s);else if(i||n)u=await this.searchPages(s);else if(l)u=await this.searchByIds(l,r);else return{success:!1,message:`Api call error! The api does not exist! data: ${s}`};return u}catch(r){return{success:!1,message:r.message}}}async searchByIds(s,r=""){try{if(!s.length)return{success:!0,result:[]};if(Ge(r)){let c=await X(r).device.getLotsArrData(s);return c.success?{success:!0,result:c.result}:{success:!1,message:c.message}}let i=Ae.DEVICE.BATCH_GET,n={uuids:s},a={headers:Object.assign(Qt,{path:this.encode(r)})};return this.POST(i,n,a)}catch(i){return{success:!1,message:i.message}}}searchPages(s){try{let{path:r}=s;if(Ge(r))throw new Error("Api call error!");let i=Ae.DEVICE.SEARCH_LIST,n={path:r};s.uid&&(n.uid=s.uid),s.page&&(n.page=s.page),s.pageSize&&(n.pageSize=s.pageSize),s.attributes&&!mn(s.attributes)&&(n.attributes=s.attributes),s.tags&&(n.tag=s.tags),s.symbol_type&&(ot.mustNumber(s.symbol_type),n.symbol_type=s.symbol_type),s.wd&&(n.wd=s.wd),s.returnListStyle&&(n.returnListStyle=s.returnListStyle),s.withSymbolPackage&&(n.withSymbolPackage=s.withSymbolPackage);let a={headers:{path:this.encode(r)}};return this.POST(i,n,a)}catch(r){return{success:!1,message:r.message}}}verifyOwner(s){if(ve||s)return!0;throw new Error(`Missing parameters! owner: ${s}`)}async create(s){try{let{path:r,title:i,description:n,attributes:a}=s;s.project_uuid||this.verifyOwner(s.owner),await tn(s),this.filterAttr(s);let o=await Ht();if(Ge(r))return X(r).device.addData(s);let c=Ae.DEVICE.CREATE,l={path:r,title:i,description:n,attributes:a};s.owner&&(l.owner=s.owner),s.tags&&(l.tags=s.tags),s.symbol_type&&(ot.mustNumber(s.symbol_type),l.symbol_type=s.symbol_type),s.footprint_type&&(ot.mustNumber(s.footprint_type),l.footprint_type=s.footprint_type),s.images&&(l.images=s.images),s.project_uuid&&(l.project_uuid=s.project_uuid),s.source&&(l.source=s.source),s.version&&(l.version=s.version),s.project_uuid&&(l.project_uuid=s.project_uuid);let u={headers:Object.assign(Qt,{path:this.encode(r)})};return this.POST(c,l,u)}catch(r){return{success:!1,message:r.message}}}filterAttr(s){for(let r in s.attributes||{})r==="Description"&&delete s.attributes[r],typeof s.attributes[r]=="string"&&(s.attributes[r]=s.attributes[r].replace(/\n|\r|\t/g," "));return s}async upload(s){try{let{path:r,datas:i,newProject:n="no"}=s,a=await Ht();for(let u of i)await tn(u),this.filterAttr(u);if(Ge(r)){let u=X(r),h=[];for(let d=0;d<i.length;d++){let f=i[d];h.push(await u.device.addData(f))}return{success:!0,result:await Promise.all(h)}}let o=Ae.DEVICE.UPLOAD,c={data:JSON.stringify(i),newProject:n},l={headers:{path:this.encode(r)}};return this.POST(o,c,l)}catch(r){return{success:!1,message:r.message}}}async update(s){try{let{path:r,uuid:i}=s;await tn(s),this.filterAttr(s);let n=await Ht();if(Ge(r)){let u=await X(r).device.updateData(s);return u.success?{success:!0,result:u.result}:{success:!1,message:u.message}}let a=kt(Ae.DEVICE.UPDATE,{uuid:i}),o={uuid:i};s.title&&(o.title=s.title),s.source&&(o.source=s.source),s.version&&(o.version=s.version),s.tags&&(o.tags=s.tags),s.custom_tags&&(o.custom_tags=s.custom_tags),s.description&&(o.description=s.description),s.attributes&&(o.attributes=s.attributes),s.symbol_type&&(ot.mustNumber(s.symbol_type),o.symbol_type=s.symbol_type),s.footprint_type&&(ot.mustNumber(s.footprint_type),o.footprint_type=s.footprint_type),s.images&&(o.images=s.images),this.filterAttr(o);let c={headers:Object.assign(Qt,{path:this.encode(r)})};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async batchUpdate(s){try{let{path:r,datas:i}=s;if(!i.length)return{success:!0,result:[]};let n=await Ht();for(let l of i)await tn(l),this.filterAttr(l);if(Ge(r)){let l=X(r),u=[];for(let p=0;p<i.length;p++){let d=i[p];u.push(await l.device.updateData(d))}return{success:!0,result:await Promise.all(u)}}let a=Ae.DEVICE.BATCH_UPDATE,o={data:JSON.stringify(i)},c={headers:{path:this.encode(r)}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async get(s){try{let{path:r,uuid:i}=s;if(!i)return{success:!1,message:"Missing uuid!"};if(Ge(r)){let l=await X(r).device.getData(i);return l.success?{success:!0,result:l.result}:{success:!1,message:l.message}}let n=Ae.DEVICE.GET,a={uuid:this.encode(i),path:this.encode(r)},o={headers:{path:this.encode(r)}};return Za&&(o.contentType=!1),this.GET(n,a,o)}catch(r){return{success:!1,message:r.message}}}async searchBySourceAndVersion(s){let{path:r,source:i,version:n}=s;if(Ge(r)){let o=await X(r).device.getDataBySourceAndVersion({source:i,version:n});return o.success?{success:!0,result:[o.result]}:{success:!1,message:o.message}}if(ve&&i&&n){let a=await this.parent.client.searchDeviceBySourceAndVersion(r,i,n);return a.success?{success:!0,result:[a.result]}:{success:!1,message:a.message}}return{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}async searchBySource(s){let{path:r,source:i}=s;if(Ge(r)){let a=await X(r).device.getAllArrDataBySource(i);return a.success?{success:!0,result:a.result}:{success:!1,message:a.message}}return ve&&i?this.parent.client.searchDeviceBySource(r,i):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}async searchByUsersAndTitles(s){try{let{path:r,user_uuids:i,titles:n}=s;if(Ge(r)){let u=await X(r).device.getAllArrData();if(!u.success)return{success:!1,message:u.message};let h,p=u.result;for(let f of p){if(i&&i.length&&(h=h||{},i.indexOf(f.owner.uuid)>-1)){h[f.uuid]=!0;break}if(n&&n.length&&(h=h||{},n.indexOf(f.title)>-1)){h[f.uuid]=!0;break}}return{success:!0,result:h?p.filter(f=>h[f.uuid]):p}}let a=Ae.DEVICE.GET_BY_USER_AND_TITLE,o={path:r,user_uuids:i,titles:n},c={headers:Object.assign(Qt,{path:this.encode(r)})};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async getAttributeValues(s){try{let{path:r,uid:i,key:n,tags:a}=s;if(Ge(r)){let h=await X(r).device.getAllArrData();if(!h.success)return{success:!1,message:h.message};let p,d=h.result;for(let g of d)if(i&&(p=p||{},i===g.owner.uuid)){p[g.uuid]=!0;break}let f=p?d.filter(g=>p[g.uuid]):d,m=[];for(let g of f)g.attributes[n]&&m.push(g.attributes[n]);return{success:!0,result:m}}let o=Ae.DEVICE.GET_ATTR_VALUE,c={uid:i,key:n,tag:a,path:r},l={headers:{path:this.encode(r)}};return this.POST(o,c,l)}catch(r){return{success:!1,message:r.message}}}async getAttrKeys(s){try{let{path:r,uid:i,tags:n}=s;if(Ge(r)){let u=await X(r).device.getAllArrData();if(!u.success)return{success:!1,message:u.message};let h,p=u.result;for(let m of p)if(i&&(h=h||{},i===m.owner.uuid)){h[m.uuid]=!0;break}let d=h?p.filter(m=>h[m.uuid]):p,f=[];for(let m of d)f=f.concat(Object.keys(m.attributes));return{success:!0,result:f}}let a=Ae.DEVICE.GET_ATTR_KEYS,o={path:r,uid:i};s.tags&&(o.tag=s.tags);let c={headers:{path:this.encode(r)}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{path:r,uuid:i}=s;if(Ge(r))return X(r).device.deleteData(i);let n=Ae.DEVICE.DELETE,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async star(s){try{let{path:r,uuid:i}=s,n=Ae.DEVICE.STAR,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async unstar(s){try{let{path:r,uuid:i}=s,n=Ae.DEVICE.UNSTAR,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async place(s){try{let{path:r,datas:i}=s;if(Ge(r))return X(r).device.place(i);let n=[],a=await Ht();for(let u=0;u<i.length;u++){let h=i[u],p={};h.device&&(await tn(h.device),this.filterAttr(h.device),p.device=h.device),h.symbol&&(await tn(h.symbol),this.filterAttr(h.symbol),p.symbol=h.symbol),h.footprint&&(await tn(h.footprint),this.filterAttr(h.footprint),p.footprint=h.footprint),n.push(p)}let o=Ae.DEVICE.PLACE,c=JSON.stringify({data:n}),l={headers:Object.assign(Qt,{path:this.encode(r)})};return this.POST(o,c,l)}catch(r){return{success:!1,message:r.message}}}};var qt=class{constructor(t,s){this.data=t;this.prjDB=s;if(!t)throw new Error("Get source code parameter error!");this.tool=new Go}async getStr(){if(this.data.dataStr&&!this.data.dataStrId)return this.data.dataStr;let t=await this.getBuffer();return t.success?this.toString(t.buffer):""}async getBuffer(){try{if(this.data.dataStrId){if(this.prjDB){let s=await this.prjDB.getData(this.data.dataStrId);if(s)return{success:!0,buffer:Xa(s)}}let t=await this.getInNet();if(t)return{success:!0,buffer:t}}return{success:!1,message:"Missing dataStrId!"}}catch(t){return{success:!1,message:t.message}}}async getInLocal(){try{let{dataStrId:t}=this.data;if(t){let s=fe.currentProject.projectId,r=this.prjDB||s&&wt(s).db||null;return r==null?void 0:r.buffers.get(t)}}catch(t){throw new Error("Get buffer in local \u5931\u8D25!!!"+t)}}async getInNet(){try{let t=this.data.dataStrId,s=new Headers;s.append(_i.ContentType,Si.Text);let i=await(await fetch(t,{method:"GET",redirect:"error",headers:s})).arrayBuffer();return i&&await this.decrypt(i)}catch(t){throw new Error("fetch\u5931\u8D25!!!"+t)}}async decrypt(t){try{let{key:s,iv:r}=this.data;if(t&&r&&s){let i=Su(s),n=Su(r);await this.tool.init({key:i,iv:n});let a=await this.tool.decrypt(t);return Qd(new Uint8Array(a))}else throw new Error(`\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!\u6570\u636E\u4E0D\u6B63\u786E:data:${t},key:${s},iv:${r}`)}catch(s){throw new Error("\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!"+s)}}toString(t){return un(t)}};var Yp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{let{projectId:r,uuids:i,docType:n}=s;if(Ge(r)){let l=X(r),u;if(n===Ne.SCH)u=l.sheet;else if([Ne.SUBCKT,Ne.NETLIST].includes(n))u=l.simulation;else if(n===Ne.PCB)u=l.pcb;else if(n===Ne.PANEL)u=l.panel;else return{success:!1,message:`Api call error! The api does not exist! docType: ${n}`};let h=await u.getAllArrData();if(!h.success)return{success:!1,message:h.message};let p=h.result,d;return i&&i.length&&(d=d||{},p.filter(m=>i.indexOf(m.uuid)>-1).map(m=>d[m.uuid]=!0)),{success:!0,result:d?p.filter(m=>d[m.uuid]):p}}let a=Ae.DOCUMENT.LIST,o={uuids:i,docType:n},c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async searchList(s){try{let{projectId:r,uuids:i,docType:n,source:a,version:o}=s,c;if(i)c=await this.searchByIds({projectId:r,uuids:i,docType:n});else if(a&&o)c=await this.searchBySourceAndVersion({projectId:r,docType:n,source:a,version:o});else if(o)c=await this.searchBySource({projectId:r,docType:n,source:a});else return{success:!1,message:`Api call error! The api does not exist! data: ${s}`};let l=c.result,u;return n&&(u=u||{},l.filter(p=>p.docType===n).map(p=>u[p.uuid]=!0)),{success:!0,result:u?l.filter(p=>u[p.uuid]):l}}catch(r){return{success:!1,message:r.message}}}async searchByIds(s){try{let{projectId:r,uuids:i,docType:n}=s;if(Ge(r)){let l=X(r),u;if(n===Ne.SCH)u=l.sheet;else if([Ne.SUBCKT,Ne.NETLIST].includes(n))u=l.simulation;else if(n===Ne.PCB)u=l.pcb;else if(n===Ne.PANEL)u=l.panel;else return{success:!1,message:`Api call error! The api does not exist! docType: ${n}`};let h=await u.getLotsArrData(i);return h.success?{success:!0,result:h.result}:{success:!1,message:h.message}}let a=Ae.DOCUMENT.LIST,o={uuids:i,docType:n},c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async searchBySourceAndVersion(s){try{let{projectId:r,docType:i,source:n,version:a}=s;if(Ge(r)){let h=X(r),p;if(i===Ne.SCH)p=h.sheet;else if([Ne.SUBCKT,Ne.NETLIST].includes(i))p=h.simulation;else if(i===Ne.PCB)p=h.pcb;else if(i===Ne.PANEL)p=h.panel;else return{success:!1,message:`Api call error! The api does not exist! docType: ${i}`};let d=await p.getDataBySourceAndVersion(n,a);return d.success?{success:!0,result:[d.result]}:{success:!1,message:d.message}}let o=Ae.DOCUMENT.LIST,c={path:r,docType:i,source:n,version:a},l={headers:{path:r}},u=await this.POST(o,c,l);return u.success===!1?{success:!1,message:u.message}:{success:!0,result:[u.result]}}catch(r){return{success:!1,message:r.message}}}async searchBySource(s){try{let{projectId:r,docType:i,source:n}=s;if(Ge(r)){let l=X(r),u;if(i===Ne.SCH)u=l.sheet;else if([Ne.SUBCKT,Ne.NETLIST].includes(i))u=l.simulation;else if(i===Ne.PCB)u=l.pcb;else if(i===Ne.PANEL)u=l.panel;else return{success:!1,message:`Api call error! The api does not exist! docType: ${i}`};let h=await u.getAllArrDatasBySource(n);return h.success?{success:!0,result:h.result}:{success:!1,message:h.message}}let a=Ae.DOCUMENT.LIST,o={path:r,docType:i,source:n},c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async create(s){try{let{projectId:r,docType:i,description:n="",title:a,blockSymbolId:o,sid:c}=s,l=await Ht();if(Ge(r)){let d,f=X(r);return f?i===Ne.SCH?(d={...s,project_uuid:r,schematic_uuid:c,path:r},f.sheet.addData(d)):[Ne.SUBCKT,Ne.NETLIST].includes(i)?f.simulation.addData(d):i===Ne.PCB?(d={...s,project_uuid:r},f.pcb.addData(d)):i===Ne.PANEL?(d={...s,project_uuid:r,unSaved:!0},f.panel.addData(d)):{success:!1,message:`Illegal data type! docType: ${i}, data: ${s}`}:{success:!1,message:"\u5DE5\u7A0B\u672A\u6253\u5F00"}}let u=Ae.DOCUMENT.CREATE,h={headers:{path:r}},p={pid:r,docType:i,description:n,title:a};return s.sid&&(p.sid=s.sid),s.blockSymbolId&&(p.blockSymbolId=s.blockSymbolId),s.source&&(p.source=s.source),s.version&&(p.version=s.version),s.blockSymbolId&&(p.blockSymbolId=s.blockSymbolId),this.verify(p)?this.POST(u,p,h):{success:!1,message:`Missing parameters! params: ${p}`}}catch(r){return{success:!1,message:r.message}}}async upload(s){try{let{projectId:r,datas:i}=s;if(Ge(r)){let c=X(r),l=[];for(let h=0;h<i.length;h++){let p=i[h];p.docType===Ne.SCH?l.push(await c.sheet.addData({...p,sid:p.schematic_uuid})):[Ne.SUBCKT,Ne.NETLIST].includes(p.docType)?l.push(await c.simulation.addData(p)):p.docType===Ne.PCB?l.push(await c.pcb.addData(p)):p.docType===Ne.PANEL&&l.push(await c.panel.addData(p))}return{success:!0,result:await Promise.all(l)}}let n=Ae.DOCUMENT.UPLOAD,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async update(s){try{let{projectId:r,uuid:i,title:n,docType:a}=s,o=await Ht();if(Ge(r)){let h=X(r),p;if(a===Ne.SCH)p=h.sheet;else if([Ne.SUBCKT,Ne.NETLIST].includes(a))p=h.simulation;else if(a===Ne.PCB)p=h.pcb;else if(a===Ne.PANEL)p=h.panel;else return{success:!1,message:`Api call error! The api does not exist! docType: ${a}`};let d=await p.updateData(s);return d.success?{success:!0,result:d.result}:{success:!1,message:d.message}}let c={headers:{path:r}},l=kt(Ae.DOCUMENT.UPDATE,{uuid:i}),u={projectId:r,uuid:i,docType:a};return s.title&&(u.title=s.title),s.source&&(u.source=s.source),s.version&&(u.version=s.version),this.POST(l,u,c)}catch(r){return{success:!1,message:r.message}}}async batchUpdate(s){try{let{projectId:r,datas:i}=s;if(!i.length)return{success:!0,result:[]};if(Ge(r)){let c=X(r),l=[];for(let h=0;h<i.length;h++){let p=i[h];p.docType===Ne.SCH?l.push(await c.sheet.updateData(p)):[Ne.SUBCKT,Ne.NETLIST].includes(p.docType)?l.push(await c.simulation.updateData(p)):p.docType===Ne.PCB?l.push(await c.pcb.updateData(p)):p.docType===Ne.PANEL&&l.push(await c.panel.updateData(p))}return{success:!0,result:await Promise.all(l)}}let n=Ae.DOCUMENT.BATCH_UPDATE,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{projectId:r,uuid:i,docType:n}=s;if(Ge(r)){let l=X(r);return l?n===Ne.SCH?l.sheet.deleteData(i):[Ne.SUBCKT,Ne.NETLIST].includes(s.docType)?l.simulation.deleteData(i):n===Ne.PCB?l.pcb.deleteData(i):n===Ne.PANEL?l.panel.deleteData(i):{success:!1,message:`Illegal data type! docType: ${n}, data: ${s}`}:{success:!1,message:"\u5DE5\u7A0B\u672A\u6253\u5F00"}}let a=Ae.DOCUMENT.DELETE,o={uuid:i},c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async get(s){var r,i,n,a,o,c,l,u,h,p,d,f,m,g,b;try{let{projectId:E,uuid:y,title:T,docType:w}=s;if(Ge(E)){let D=X(E),I,P;if(w===Ne.SCH?P=D.sheet:[Ne.SUBCKT,Ne.NETLIST].includes(w)?P=D.simulation:w===Ne.PCB?P=D.pcb:w===Ne.PANEL&&(P=D.panel),y)P?I=await((r=P.getData(y))==null?void 0:r.result):(I=!I&&((i=await D.sheet.getData(y))==null?void 0:i.result),I=!I&&((n=await D.simulation.getData(y))==null?void 0:n.result),I=!I&&((a=await D.pcb.getData(y))==null?void 0:a.result),I=!I&&((o=await D.panel.getData(y))==null?void 0:o.result));else if(T)P?I=await((l=(c=P.getDataByTitle(T))==null?void 0:c.result)==null?void 0:l[0]):(I=!I&&((h=(u=await D.sheet.getArrDataByTitle(T))==null?void 0:u.result)==null?void 0:h[0]),I=!I&&((d=(p=await D.simulation.getArrDataByTitle(T))==null?void 0:p.result)==null?void 0:d[0]),I=!I&&((m=(f=await D.pcb.getDataByTitle(T))==null?void 0:f.result)==null?void 0:m[0]),I=!I&&((b=(g=await D.panel.getArrDataByTitle(T))==null?void 0:g.result)==null?void 0:b[0]));else return{success:!1,message:`Missing parameters! data: ${s}`};return{success:!0,result:I}}let S,_,C,x={headers:{path:E}};if(y)S=Ae.DOCUMENT.GET,_={uuid:y,path:E},C=await this.GET(S,_,x);else if(T)S=Ae.DOCUMENT.GET_BY_TITLE,_={title:Mt(T),docType:w},C=await this.POST(S,_,x);else return{success:!1,message:`Missing parameters! data: ${s}`};if(C.success&&s.needStr){let D=await new qt(C.result).getStr();if(!D)return{success:!1,message:`Failed to get document content! params: ${s}`};C.result.dataStr=D}return{success:!0,result:C.result}}catch(E){return{success:!1,message:E.message}}}async getBySid(s){try{let{projectId:r,sid:i}=s;if(Ge(r)){let c=await X(r).sheet.getAllArrData(i);return c.success?{success:!0,result:c.result}:{success:!1,message:c.message}}let n=kt(Ae.DOCUMENT.GET_BY_SID,{schematicUuid:i}),a={headers:{path:r}};return this.GET(n,void 0,a)}catch(r){return{success:!1,message:r.message}}}async move(s){try{let{projectId:r,uuid:i,position:n}=s,a=Ae.DOCUMENT.MOVE,o={uuid:i,position:n};s.moveDown&&(o.moveDown=s.moveDown);let c={headers:{path:r}};return this.GET(a,o,c)}catch(r){return{success:!1,message:r.message}}}async checkIn(s){var r,i;try{let{projectId:n,uuids:a}=s,o=s.branchUuid?s.branchUuid:(i=(r=X(n))==null?void 0:r.projectDetail)==null?void 0:i.currentBranch,c=kt(Ae.DOCUMENT.CHECK_IN,{project:n,branch:o}),l={uuids:a},u={headers:Object.assign(Qt,{path:n})};return this.POST(c,l,u)}catch(n){return{success:!1,message:n.message}}}async checkOut(s){var r,i;try{let{projectId:n,uuids:a}=s,o=s.branchUuid?s.branchUuid:(i=(r=X(n))==null?void 0:r.projectDetail)==null?void 0:i.currentBranch,c=kt(Ae.DOCUMENT.CHECK_OUT,{project:n,branch:o}),l={uuids:a},u={headers:Object.assign(Qt,{path:n})};return this.POST(c,l,u)}catch(n){return{success:!1,message:n.message}}}async getCheck(s){var r,i;try{let{projectId:n}=s,a=s.branchUuid?s.branchUuid:(i=(r=X(n))==null?void 0:r.projectDetail)==null?void 0:i.currentBranch,o=kt(Ae.DOCUMENT.GET_CHECK,{project:n,branch:a});return this.GET(o)}catch(n){return{success:!1,message:n.message}}}async deletePcbRelated(s){try{let{projectId:r}=s;if(Ge(r)){let{coppers:o=[],fonts:c=[],components:l=[]}=s,u=X(r),h=[];for(let f=0;f<o.length;f++);for(let f=0;f<c.length;f++);for(let f=0;f<l.length;f++){let m=l[f];h.push(await u.footprint.deleteData(m))}let p=await Promise.all(h),d=!0;for(let f of p)if(!f.success){d=!1;break}return{success:d}}let i=Ae.DOCUMENT.DELETE_PCB_RELATED,n={headers:{path:r}},a={project_uuid:r};return s.coppers&&(a.copper_uuids=s.coppers),s.fonts&&(a.font_hashes=s.fonts),s.components&&(a.component_uuids=s.components),this.POST(i,a,n)}catch(r){return{success:!1,message:r.message}}}};var Vp=class extends ns{constructor(s){super();this.parent=s}async searchList(s){try{let{projectId:r,paths:i,pcbId:n}=s;return r&&i?this.searchByPaths(s):n?this.searchByPcbId(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}async searchByPaths(s){try{let{projectId:r,paths:i}=s,n=Ae.FONT.SEARCH_LIST,a={paths:i,project_uuid:r,path:r},o={headers:Object.assign(Qt,{path:r})};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async searchByPcbId(s){try{let{projectId:r,pcbId:i}=s,n=Ae.FONT.SEARCH_BY_PCB_UUID,a={pcbId:i,path:r},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async set(s){try{let{projectId:r,datas:i}=s,n=Ae.FONT.SET,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{projectId:r,paths:i}=s,n=Ae.FONT.DELETE,a={paths:i,project_uuid:r},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}};var zp=class extends ns{constructor(s){super();this.parent=s}async set(s){try{let{projectId:r,branchData:i,dataStr:n}=s,{uuid:a,history_uuid:o}=i,c=kt(Ae.PROJECT_HISTORY.SET,{project_uuid:r,branch_uuid:a}),l={headers:Object.assign({[_i.ContentType]:Si.Text},{path:r})},u=await this.POST(c,n,l);return u.success===!0&&!o&&(i.history_uuid=u.result),u}catch(r){return{success:!1,message:r.message}}}async get(s){try{let{projectId:r,branchUuid:i,historyUuid:n}=s,a=kt(Ae.PROJECT_HISTORY.GET,{project_uuid:r,branch_uuid:i,history_uuid:n}),o={headers:Object.assign(Qt,{path:r})};return this.GET(a,void 0,o)}catch(r){return{success:!1,message:r.message}}}async getHistoryData(s,r=[]){let i=[];for(let a=0;a<s.length;++a){let o=s[a];if(r.includes(o.uuid)||(i.unshift(o0(o)),o.snapshot))break}return(await Promise.all(i)).join(Le)}};var Wp=class extends ns{constructor(s){super();this.parent=s}async log(s){try{let{path:r,logs:i}=s,n=Ae.OTHER.LOG,a={logs:i},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async componentLog(s){try{let{path:r,uuid:i,lib_type:n,operate_type:a}=s,o=Ae.OTHER.COMPONENT_LOG,c={path:r,uuid:i,lib_type:n,operate_type:a},l={headers:{path:r}};return this.POST(o,c,l)}catch(r){return{success:!1,message:r.message}}}async teams(s={}){try{let r=Ae.OTHER.TEAMS,i={};return s.org_uuid&&(i.org_uuid=s.org_uuid),s.form&&(i.form=s.form),s.pageSize&&(i.pageSize=s.pageSize),s.page&&(i.page=s.page),s.leftTree!==void 0&&(i.leftTree=s.leftTree),this.GET(r,i,{searchParams:!0})}catch(r){return{success:!1,message:r.message}}}async getEditorVersion(){try{let s=Ae.OTHER.GET_EDITOR_VERSION;return this.GET(s)}catch(s){return{success:!1,message:s.message}}}async setEditorVersion(s){try{let r=Ae.OTHER.SET_EDITOR_VERSION,i={version:s};return this.POST(r,i)}catch(r){return{success:!1,message:r.message}}}};var qp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{return ve?this.parent.client.projectHistory():this.projects(s)}catch(r){return{success:!1,message:r.message}}}projects(s){let{isCbb:r=!1}=s,i=r?Ae.PROJECT.CBB_LIST:Ae.PROJECT.LIST,n={};s.org_uuid&&(n.org_uuid=s.org_uuid),s.leftTree&&(n.leftTree=s.leftTree),s.page&&(n.page=s.page),s.pageSize&&(n.pageSize=s.pageSize),s.user_uuid&&(n.user_uuid=s.user_uuid),s.tags&&(n.tag=s.tags),s.tagNotExists&&(n.tagNotExists=s.tagNotExists);let a={searchParams:!0};return this.GET(i,n,a)}async check(s){try{let{name:r}=s,{message:i}=await fe.messageBus.rpcCall("notLegalTitle",[r,1,128,!1]);if(i)return{success:!1,message:"Invalid name"};if(s.cbb_project){let n=await await se.getInstance().project.list({isCbb:!0,user_uuid:s.user_uuid});if(n.success&&n.result.filter(c=>c.cbb_project&&c.name===r).length)return{success:!1,message:"Duplicated title"}}return{success:!0}}catch(r){return{success:!1,message:r.message}}}onBeforeCreate(s){let{name:r,cbb_project:i=!1}=s;return s.name=r.trim(),s.cbb_project=i,s}async create(s){try{let r=await this.check(s);if(r.success===!1)return{success:!1,message:r.message};this.onBeforeCreate(s);let i=setTimeout(()=>{clearTimeout(i);let a=s.cbb_project?"New reuse module project timeout!":"New project timeout!";return Promise.resolve({success:!1,message:a})},5e3),n=ve?await this.createInClient(s):await this.createOnLine(s);return n.success===!1?{success:!1,code:n.code,message:n.message||"Create new project failed!"}:{success:!0,result:n.result}}catch(r){return{success:!1,message:r.message}}}async createInClient(s){try{let r=await se.getInstance().client.createProject(s);if(r.success===!1)return{success:!1,code:r.code,message:Dt(r)||r.message};let i=Object.keys(r.result)[0],n=r.result[i].path,a=await se.getInstance().client.openProject(n);if(a.success===!1)return{success:!1,code:a.code,message:Dt(a)||a.message};let o=a.result[i],{default_sheet:c}=s,{name:l,isCbb:u,path:h,owner:p}=o;return{success:!0,result:{uuid:i,name:l,cbb_project:u,path:h,owner:p,default_sheet:c}}}catch(r){return{success:!1,message:r.message}}}async createOnLine(s){try{let{name:r,public:i=!1,user_uuid:n,cbb_project:a,introduction:o="",description:c="",default_sheet:l=""}=s,u=Ae.PROJECT.CREATE,h={name:r,public:i,user_uuid:n,cbb_project:a,introduction:o,content:c,default_sheet:l};s.editorVersion&&(h.editorVersion=s.editorVersion),s.tags&&(h.tags=s.tags),s.project_path&&(h.project_path=s.project_path),s.mode&&(h.mode=s.mode),h.cbb_project=!!h.cbb_project;let p=await this.POST(u,h);if(!p.success)return{success:!1,...p};let{uuid:d,name:f,path:m,owner:g}=p.result;return{success:!0,result:{uuid:d,name:f,cbb_project:a,path:m,owner:g.uuid,default_sheet:l}}}catch(r){return{success:!1,message:r.message}}}async get(s){try{let r=Ae.PROJECT.GET,i={headers:Object.assign(Qt,{path:s})},n={uuid:s},a=await this.GET(r,n,i);return a.success===!1?{success:!1,code:a.code,message:Dt(a)||a.message}:{success:!0,result:a.result}}catch(r){return{success:!1,message:r.message}}}async update(s){var r,i;try{let{uuid:n,tags:a,custom_tags:o}=s,c=Ae.PROJECT.UPDATE;if(a&&!o){let h=((r=a.parent_tag)==null?void 0:r.name)||"",p=((i=a.child_tag)==null?void 0:i.name)||"";o=JSON.stringify([h,p])}let l={uuid:n};s.name&&(l.name=s.name),a&&(l.tags=a),o&&(l.custom_tags=o),s.introduction!==void 0&&(l.introduction=s.introduction),s.description!==void 0&&(l.content=s.description),s.default_sheet&&(l.default_sheet=s.default_sheet),s.editorVersion&&(l.editorVersion=s.editorVersion);let u={headers:{path:n}};return this.POST(c,l,u)}catch(n){return{success:!1,message:n.message}}}async delete(s){try{let{uuid:r,path:i=r}=s,n=Ae.PROJECT.DELETE,a={headers:{path:i}},o={uuid:r};return this.POST(n,o,a)}catch(r){return{success:!1,message:r.message}}}async ticket(s){try{let{uuid:r,g_ticket:i=-1}=s,n=Ae.PROJECT.TICKET,a={headers:Object.assign(Qt,{path:r})},o={uuid:r,g_ticket:i};return this.GET(n,o,a)}catch(r){return{success:!1,message:r.message}}}async ticket1(s){try{let r=await this.ticket(s);if(!r.success)return{success:!1,...r};let i=r.result,n=i.block_symbol_attrs_groups;i.attrs={};let{uuid:a}=s,o={headers:{path:a}};for(let c in n){let l=n[c],u=Ae.ATTR.TICKET+`?project_uuid=${a}&hash=${c}`,h={project_uuid:a,hash:c},p=await this.GET(u,h,o);if(!p.success)return{success:!1,...p};i.attrs[c]=p.result.paths}return{success:!0,result:i}}catch(r){return{success:!1,message:r.message}}}async backupList(s){try{let r=Ae.PROJECT.BACKUP_LIST,i={project_uuid:s,path:s},n={headers:{path:s},searchParams:!0};return this.GET(r,i,n)}catch(r){return{success:!1,message:r.message}}}async backup(s){try{let{upload:r,limit:i,project_uuid:n,auto:a,name:o,description:c,projectName:l,backupTime:u,branch_uuid:h,branch_time:p}=s;if(_u){if(!l||!u)return{success:!1,message:`Missing parameters! projectName: ${l}, backupTime: ${u}`};let b=await this.online(r,`${l}_${u}`,n,l);if(!b.success)return{success:!1,...b}}let d=Ae.PROJECT.BACKUP,f={upload:r,limit:i,project_uuid:n,auto:a,name:o,description:c,path:n,branch_uuid:h,branch_time:p},m=new FormData;for(let[b,E]of Object.entries(f))typeof E=="number"?m.append(b,String(E)):m.append(b,E);f.auto==="no"&&m.delete("limit");let g={contentType:!1,headers:{path:f.project_uuid}};return this.POST(d,m,g)}catch(r){return{success:!1,message:r.message}}}async online(s,r,i,n){try{let a=new URLSearchParams;a.append("projectId",i),a.append("name",r),a.append("projectName",n);let o=`app://api/client/online/backup?${a.toString()}`,c=await new Promise((h,p)=>{let d=new FileReader;d.onloadend=()=>{let f=d.result,m=f.indexOf(",");h(f.substring(m+1))},d.onerror=p,d.readAsDataURL(s)});return{success:!0,...await(await fetch(o,{method:"post",body:c})).json()}}catch(a){return{success:!1,message:a||"Backup failed!"}}}async getBackup(s){try{let{uuid:r,name:i}=s;return ve&&i?this.parent.client.getBackup(s):r?this.getBackUpById(r):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}getBackUpById(s){let r=kt(Ae.PROJECT.OPERATE_BACKUP,{uuid:s})+"?path="+s,i={responseType:Fc.Blob,headers:{path:s},contentType:!1};return this.GET(r,void 0,i)}async deleteBackup(s){try{let{uuid:r}=s,i=kt(Ae.PROJECT.OPERATE_BACKUP,{uuid:r}),n={uuid:r},a={responseType:Fc.Json,headers:{path:fe.currentProject.projectId}};return this.DELETE(i,n,a)}catch(r){return{success:!1,message:r.message}}}async archive(s){try{let{upload:r,project_uuid:i,name:n,description:a}=s,o=Ae.PROJECT.ARCHIVE,c={upload:r,project_uuid:i,name:n,description:a},l=new FormData;for(let[h,p]of Object.entries(c))l.append(h,p);let u={contentType:!1,headers:{path:c.project_uuid}};return this.POST(o,l,u)}catch(r){return{success:!1,message:r.message}}}async createBoards(s){throw new Error("Interface is deprecated!")}async star(s){try{let{path:r,uuid:i}=s,n=Ae.PROJECT.STAR,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async unstar(s){try{let{path:r,uuid:i}=s,n=Ae.PROJECT.UNSTAR,a={uuid:i,path:r},o={headers:{path:this.encode(r)}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}setProfile(s){try{let{uuid:r,branch_uuid:i,ticket:n,datas:a}=s,o=kt(Ae.PROJECT.STRUCTURE,{project_uuid:r,branch_uuid:i}),c={ticket:n,structure:JSON.stringify(a)};return this.POST(o,c)}catch(r){return{success:!1,message:r.message}}}async getProfile(s){try{let{uuid:r,branch_uuid:i}=s,n=kt(Ae.PROJECT.STRUCTURE,{project_uuid:r,branch_uuid:i});return this.GET(n)}catch(r){return{success:!1,message:r.message}}}async uploadThumbs(s){try{let{uuid:i,projectId:n,branchUuid:a,ticket:o,blob:c}=s,l=kt(Ae.PROJECT.UPDATE_IMAGES,{projectUuid:n,branchUuid:a});var r=new FormData;r.append("image",c,"image.webp"),r.append("uuid",i),r.append("ticket",String(o));let u={contentType:!1,headers:{path:n}};return this.POST(l,r,u)}catch(i){return{success:!1,message:i.message}}}async deleteThumbs(s){try{let{thumbUuid:r,projectId:i,branchUuid:n}=s,a=kt(Ae.PROJECT.DELETE_IMAGES,{projectUuid:i,branchUuid:n,thumbUuid:r}),o={contentType:!1,headers:{path:i}};return this.POST(a,void 0,o)}catch(r){return{success:!1,message:r.message}}}async getThumbs(s){try{let{projectId:r,branchUuid:i}=s,n=kt(Ae.PROJECT.GET_IMAGES,{projectUuid:r,branchUuid:i}),a={contentType:!1,headers:{path:r}};return this.GET(n,void 0,a)}catch(r){return{success:!1,message:r.message}}}};var Jp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{let{projectId:r,uuids:i,name:n}=s;if(Ge(r)){let u=await X(r).schematic.getAllArrData();if(!u.success)return{success:!1,message:u.message};let h=u.result,p;return i&&i.length&&(p=p||{},h.filter(f=>i.indexOf(f.uuid)>-1).map(f=>p[f.uuid]=!0)),n&&(p=p||{},h.filter(f=>f.name===Mt(n)).map(f=>p[f.uuid]=!0)),{success:!0,result:p?h.filter(f=>p[f.uuid]):h}}let a=Ae.SCHEMATIC.LIST,o={};s.uuids&&(o.uuids=s.uuids),s.name&&(o.name=s.name);let c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async searchList(s){try{let{uuids:r,name:i,source:n,version:a}=s;return r?this.searchByIds(s):i?this.searchByName(s):n&&a?this.searchBySourceAndVersion(s):n?this.searchBySource(s):{success:!1,message:`Api call error! The api does not exist! data: ${s}`}}catch(r){return{success:!1,message:r.message}}}async searchByIds(s){try{let{projectId:r,uuids:i}=s;if(Ge(r)){let l=await X(r).schematic.getLotsArrData(i);return l.success?{success:!0,result:l.result}:{success:!1,message:l.message}}let n=Ae.SCHEMATIC.LIST,a={uuids:i},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async searchByName(s){try{let{projectId:r,name:i}=s;if(Ge(r)){let a=await X(r).schematic.getAllArrData();if(!a.success)return{success:!1,message:a.message};let o=a.result,c;return i&&(c=c||{},o.filter(u=>u.name===Mt(i)).map(u=>c[u.uuid]=!0)),{success:!0,result:c?o.filter(u=>c[u.uuid]):o}}if(ve)return this.parent.client.searchSchematicByName(s);{let{projectId:n,name:a}=s,o=Ae.SCHEMATIC.LIST,c={name:a},l={headers:{path:n}};return this.POST(o,c,l)}}catch(r){return{success:!1,message:r.message}}}async searchBySourceAndVersion(s){try{let{projectId:r,source:i,version:n}=s;if(Ge(r)){let h=await X(r).schematic.getDataBySourceAndVersion({source:i,version:n});return h.success?{success:!0,result:[h.result]}:{success:!1,message:h.message}}let a=Ae.SCHEMATIC.LIST,o={path:r,source:i,version:n},c={headers:{path:r}},l=await this.POST(a,o,c);return l.success===!1?{success:!1,message:l.message}:{success:!0,result:[l.result]}}catch(r){return{success:!1,message:r.message}}}async searchBySource(s){try{let{projectId:r,source:i}=s;if(Ge(r)){let l=await X(r).schematic.getAllArrDataBySource(i);return l.success?{success:!0,result:l.result}:{success:!1,message:l.message}}let n=Ae.SCHEMATIC.LIST,a={path:r,source:i},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async create(s){try{let{projectId:r,name:i}=s,n=await Ht();if(Ge(r))return X(r).schematic.addData(s);let a=Ae.SCHEMATIC.CREATE,o={project_uuid:r,name:i};s.source&&(o.source=s.source),s.version&&(o.version=s.version);let c={headers:{path:r}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async upload(s){try{let{projectId:r,datas:i}=s;if(Ge(r)){let c=X(r),l=[];for(let h=0;h<i.length;h++){let p=i[h];l.push(await c.schematic.addData(p))}return{success:!0,result:await Promise.all(l)}}let n=Ae.SCHEMATIC.UPLOAD,a={data:JSON.stringify(i)},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{projectId:r,uuid:i}=s;if(Ge(r))return await X(r).schematic.deleteData(i);let n=Ae.SCHEMATIC.DELETE,a={uuid:i},o={headers:{path:r}};return this.POST(n,a,o)}catch(r){return{success:!1,message:r.message}}}async update(s){var r,i;try{let{projectId:n,uuid:a,name:o,title:c,position:l,uuids:u}=s,h=await Ht();if(Ge(n)){let m=X(n),g=await m.schematic.updateData(s);if(!g.success)return{success:!1,message:g.message};if(a&&c){let b=(r=await m.schematic.getData(a))==null?void 0:r.result,E=b&&b.name,y=E&&((i=await m.pcb.getIdByTitle(E))==null?void 0:i.result),T=await m.schematic.updateData({uuid:a,name:c});if(!T.success)return{success:!1,message:T.message};if(T=await m.pcb.updateData({uuid:y,title:c}),!T.success)return{success:!1,message:T.message}}return{success:!0}}let p={headers:{path:n}},d,f;if(a&&o)d=kt(Ae.SCHEMATIC.UPDATE,{uuid:a}),f={name:o};else if(a&&c)d=kt(Ae.SCHEMATIC.UPDATE,{uuid:a}),f={title:c};else if(l&&u)d=Ae.SCHEMATIC.UPDATE_SORT1,f={position:l,uuids:u};else return{success:!1,message:`Missing parameters! data: ${s}`};return s.source&&(f.source=s.source),s.version&&(f.version=s.version),this.verify(f)?this.POST(d,f,p):{success:!1,message:`Missing parameters! params: ${f}`}}catch(n){return{success:!1,message:n.message}}}};var Kp=class extends ns{constructor(s){super();this.parent=s}async list(s){try{let{path:r,user_uuid:i,types:n}=s,a=Ae.TAG.LIST,o={path:r,user_uuid:i,type:n},c={headers:{path:this.encode(r)},searchParams:!0};return this.GET(a,o,c)}catch(r){return{success:!1,message:r.message}}}async create(s){try{let{path:r,name:i,type:n,user_uuid:a}=s,o=Ae.TAG.CREATE,c={path:r,name:i,type:n,user_uuid:a};s.parent_uuid&&(c.parent_uuid=s.parent_uuid),s.order_no&&(c.order_no=s.order_no);let l={headers:{path:this.encode(r)}};return this.POST(o,c,l)}catch(r){return{success:!1,message:r.message}}}async update(s){try{let{path:r,uuid:i,user_uuid:n}=s,a=kt(Ae.TAG.UPDATE,{uuid:i}),o={path:r,uuid:i,user_uuid:n};s.name&&(o.name=s.name),s.parent_uuid&&(o.parent_uuid=s.parent_uuid),s.order_no&&(o.order_no=s.order_no);let c={headers:{path:this.encode(r)}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}async delete(s){try{let{path:r,uuid:i,user_uuid:n}=s,a=kt(Ae.TAG.DELETE,{uuid:i}),o={path:r,uuid:i,user_uuid:n},c={headers:{path:this.encode(r)}};return this.POST(a,o,c)}catch(r){return{success:!1,message:r.message}}}};var Xp=class extends ns{constructor(s){super();this.parent=s}async set(s){try{let{uuid:r,dataStr:i}=s;ot.mustString(r),ot.mustString(i),ot.notNull(r),ot.notNull(i);let n={headers:Object.assign({[_i.ContentType]:Si.Text})},a=kt(Ae.COMPONENT_HISTORY.SET,{uuid:r});return this.POST(a,i,n)}catch(r){return{success:!1,message:r.message}}}async get(s){try{let{uuid:r,historyUuid:i}=s;ot.mustString(r),ot.mustString(i),ot.notNull(r),ot.notNull(i);let n=kt(Ae.COMPONENT_HISTORY.GET,{uuid:r,historyUuid:i});return this.GET(n)}catch(r){return{success:!1,message:r.message}}}async getHistoryData(s,r){let i=[];for(let a=0;a<s.length;++a){let o=s[a];if(o.uuid===(r==null?void 0:r.uuid)&&o.num===r.num||(i.push(o0(o,void 0,o.uuid===(r==null?void 0:r.uuid)?r==null?void 0:r.num:void 0)),o.uuid===(r==null?void 0:r.uuid))||o.snapshot)break}let n=await Promise.all(i);return this.getSnapshot(n.join(Le))}getSnapshot(s){let r=new s0;return r.parseFull(s),r.compressFull({keepFirst:!0,keepClient:!0})}};var El=class El{constructor(){this.project=new qp(this),this.branch=new jp(this),this.projectHistory=new zp(this),this.componentHistory=new Xp(this),this.schematic=new Jp(this),this.document=new Yp(this),this.device=new Gp(this),this.component=new Up(this),this.tag=new Kp(this),this.copper=new Hp(this),this.font=new Vp(this),this.blob=new Mp(this),this.attr=new kp(this),this.client=new Fp(this),this.other=new Wp(this)}static getInstance(){return El.tool==null&&(El.tool=new El),El.tool}};El.tool=null;var se=El;var Bs={ZINDEX:1,COUNT:1,TICKET:1,BOARD:""},bl={BOARD:"Board1",SCHMEATIC:"Schematic1",SHEET:"P1",SIMULATION:"Simulation1",PCB:"PCB1",PANEL:"Panel_1"};var f0=/^[a-zA-Z0-9]+$/;var Tr=class{constructor(t){this.result={};this.documents=new Set;let{uuid:s,datas:r,origin:i={}}=t;this.uuid=s,this.instance=X(s),this.datas=r,this.origin={schematicIds:i.schematicIds||[],sheetIds:i.sheetIds||[],simulationIds:i.simulationIds||[],pcbIds:i.pcbIds||[],panelIds:i.panelIds||[],deviceIds:i.deviceIds||[],symbolIds:i.symbolIds||[],footprintIds:i.footprintIds||[],boardIds:i.boardIds||[]},this.result={uuid:this.uuid,boards:[],schematics:[],schs:{},sheets:[],simulations:[],pcbs:[],panels:[],symbols:[],footprints:[],devices:[],attrs:[],blobs:[],fonts:{},images:{},origin:null}}async start(){try{console.time("build target--------------------"),console.time("build target getorigin..."),await this.getOrigin(),console.timeEnd("build target getorigin..."),console.time("build target getBoards..."),await this.getBoards(),console.timeEnd("build target getBoards..."),console.time("build target getSchs..."),await this.getSchs(),console.timeEnd("build target getSchs..."),console.time("build target getSchematics..."),await this.getSchematics(),console.timeEnd("build target getSchematics..."),console.time("build target getSheets..."),await this.getSheets(),console.timeEnd("build target getSheets..."),console.time("build target getSimulations..."),await this.getSimulations(),console.timeEnd("build target getSimulations..."),console.time("build target getPcbs..."),await this.getPcbs(),console.timeEnd("build target getPcbs..."),console.time("build target getPanels..."),await this.getPanels(),console.timeEnd("build target getPanels..."),console.time("build target getSymbols...");let{exist:t}=await this.getSymbols();console.timeEnd("build target getSymbols..."),console.time("build target getFootprints...");let{exist:s}=await this.getFootprints();return console.timeEnd("build target getFootprints..."),console.time("build target getDevices..."),await this.getDevices(t,s),console.timeEnd("build target getDevices..."),console.time("build target getAttrs..."),await this.getAttrs(),console.timeEnd("build target getAttrs..."),console.time("build target getBlobs..."),await this.getBlobs(),console.timeEnd("build target getBlobs..."),console.time("build target getFonts..."),await this.getFonts(),console.timeEnd("build target getFonts..."),console.time("build target getImages..."),await this.getImages(),console.timeEnd("build target getImages..."),this.fix(),console.timeEnd("build target--------------------"),{success:!0,result:this.result}}catch(t){return{success:!1,message:t.message}}}async rpc(t){return this.datas=this.parse(t.datas),this.start()}parse(t){let s={};for(let r in t){let i=t[r];s[r]=new Set(i)}return s}async getOrigin(){for(let t of this.origin.schematicIds){let s=(await this.instance.sheet.getKeys(t)).result;if(!(!s||!s.length))for(let r of s)this.origin.sheetIds.push(r)}this.result.origin=this.origin}async getBoards(){if(!this.datas.boards||!this.datas.boards.size)return{};let t=new Set,s=new Set;for(let r of this.datas.boards){let i=(await this.instance.board.getData(r)).result;if(!i)s.add(r);else{let n=!!this.origin.boardIds.includes(r);this.result.boards.push(Object.assign(i,{origin:n})),t.add(r)}}if(s.size){let r=await De("Board"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSchs(){if(!this.datas.schs||!this.datas.schs.size)return{};let t=new Set,s=new Set;for(let r of this.datas.schs){let{uuid:i,sheets:n}=r,a=(await this.instance.schematic.getData(i)).result;if(!a)s.add(i);else{let o=!!this.origin.schematicIds.includes(i);this.result.schematics.push(Object.assign(a,{origin:o})),t.add(i),await this.getSheetsBySid1(i,n)}}if(s.size){let r=await De("Schematic"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSheetsBySid1(t,s){if(this.result.schs[t]=[],!s||!s.length)return{};let r=new Set,i=new Set;for(let n of s){let a=(await this.instance.sheet.getData(n,!0)).result;if(!a)i.add(n);else{let o=!!this.origin.sheetIds.includes(n);this.result.schs[t].push(Object.assign(a,{origin:o})),r.add(n),this.documents.add(n)}}if(i.size){let n=await De("Sheet"),a=await De("File missing!");ze("warn",[n,Array.from(i).join("\u3001"),a])}return{exist:r,lost:i}}async getSchematics(){if(!this.datas.schematics||!this.datas.schematics.size)return{};let t=new Set,s=new Set;for(let r of this.datas.schematics){console.time("build target getSchematics schematic.getData...");let i=(await this.instance.schematic.getData(r)).result;if(!i)s.add(r);else{let n=!!this.origin.schematicIds.includes(r);this.result.schematics.push(Object.assign(i,{origin:n})),t.add(r),console.timeEnd("build target getSchematics schematic.getData..."),console.time("build target getSchematics getSheetsBySid2..."),await this.getSheetsBySid2(r),console.timeEnd("build target getSchematics getSheetsBySid2...")}}if(s.size){let r=await De("Schematic"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSheetsBySid2(t){this.result.schs[t]=[];let s=(await this.instance.sheet.getKeys(t)).result;if(!s||!s.length)return{};let r=new Set,i=new Set;for(let n of s){let a=(await this.instance.sheet.getData(n,!0)).result;if(!a)i.add(n);else{let o=!!this.origin.sheetIds.includes(n);this.result.schs[t].push(Object.assign(a,{origin:o})),r.add(n),this.documents.add(n)}}if(i.size){let n=await De("Sheet"),a=await De("File missing!");ze("warn",[n,Array.from(i).join("\u3001"),a])}return{exist:r,lost:i}}async getSheets(){if(!this.datas.sheets||!this.datas.sheets.size)return{};let t=new Set,s=new Set;for(let r of this.datas.sheets){let i=(await this.instance.sheet.getData(r,!0)).result;if(!i)s.add(r);else{let n=!!this.origin.sheetIds.includes(r);this.result.sheets.push(Object.assign(i,{origin:n})),t.add(r),this.documents.add(r)}}if(s.size){let r=await De("Sheet"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSimulations(){if(!this.datas.simulations||!this.datas.simulations.size)return{};let t=new Set,s=new Set;for(let r of this.datas.simulations){let i=(await this.instance.simulation.getData(r,!0)).result;if(!i)s.add(r);else{let n=!!this.origin.simulationIds.includes(r);this.result.simulations.push(Object.assign(i,{origin:n})),t.add(r)}}if(s.size){let r=await De("Simulation"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getPcbs(){if(!this.datas.pcbs||!this.datas.pcbs.size)return{};let t=new Set,s=new Set;for(let r of this.datas.pcbs){console.time("build target getPcbs...getData");let i=(await this.instance.pcb.getData(r,!0)).result;if(console.timeEnd("build target getPcbs...getData"),!i)s.add(r);else{console.time("build target getPcbs...assign");let n=!!this.origin.pcbIds.includes(r);this.result.pcbs.push(Object.assign(i,{origin:n})),t.add(r),this.documents.add(r),console.timeEnd("build target getPcbs...assign")}}if(s.size){let r=await De("Pcb"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getPanels(){if(!this.datas.panels||!this.datas.panels.size)return{};let t=new Set,s=new Set;for(let r of this.datas.panels){let i=(await this.instance.panel.getData(r,!0)).result;if(!i)s.add(r);else{let n=!!this.origin.panelIds.includes(r);this.result.panels.push(Object.assign(i,{origin:n})),t.add(r),this.documents.add(r)}}if(s.size){let r=await De("Panel"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSymbols(){if(!this.datas.symbols||!this.datas.symbols.size)return{};let t=new Set,s=new Set;for(let r of this.datas.symbols){let i=(await this.instance.symbol.getData(r,!0)).result;if(!i)s.add(r);else{let n=!!this.origin.symbolIds.includes(r);this.result.symbols.push(Object.assign(i,{origin:n})),t.add(r),this.documents.add(r)}}if(s.size){let r=await De("Symbol"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getFootprints(){if(!this.datas.footprints||!this.datas.footprints.size)return{};let t=new Set,s=new Set;for(let r of this.datas.footprints){let i=(await this.instance.footprint.getData(r,!0)).result;if(!i)s.add(r);else{let n=!!this.origin.footprintIds.includes(r);this.result.footprints.push(Object.assign(i,{origin:n})),t.add(r)}}if(s.size){let r=await De("Footprint"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getDevices(t=new Set,s=new Set){if(!this.datas.devices||!this.datas.devices.size)return{};let r=new Set,i=new Set,n=[],a=[];for(let o of this.datas.devices){let c=(await this.instance.device.getData(o)).result;if(!c)i.add(o);else{let{title:l,attributes:u}=c,{Symbol:h,Footprint:p}=u;h&&!t.has(h)&&n.push(l),p&&!s.has(p)&&a.push(l);let d=!!this.origin.deviceIds.includes(o);this.result.devices.push(Object.assign(c,{origin:d})),r.add(o)}}if(i.size){let o=await De("Device"),c=await De("File missing!");ze("warn",[o,Array.from(i).join("\u3001"),c])}if(n.length){let o=await De("The following devices lose bound symbol data!");ze("warn",[o,":",n.join("\u3001")])}if(a.length){let o=await De("The following devices lose bound footprint data!");ze("warn",[o,":",a.join("\u3001")])}return{exist:r,lost:i}}async getAttrs(){if(!this.datas.attrs||!this.datas.attrs.size)return{};let t=new Set,s=new Set;for(let r of this.datas.attrs){let i=(await this.instance.instance.getData(r)).result;i?(this.result.attrs.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Instance properties"),i=await De("Missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getBlobs(){if(!this.datas.blobs||!this.datas.blobs.size)return{};let t=new Set,s=new Set;for(let r of this.datas.blobs){let i=(await this.instance.blob.getData(r)).result;i?(this.result.blobs.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Colorful Image"),i=await De("Missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getFonts(){if(!this.datas.fonts||!this.datas.fonts.size)return{};let t=new Set,s=new Set;for(let r of this.datas.fonts){let i=(await this.instance.font.getData(r)).result;i?(this.result.fonts[r]=i,t.add(r)):s.add(r)}if(s.size){let r=await De("Font"),i=await De("Missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getImages(){let t=new Set,s=new Set,{branch_uuid:r}=(await this.instance.getDetail()).result||{},i=await se.getInstance().project.getThumbs({projectId:this.uuid,branchUuid:r});if(i.success){let n=i.result,a=new Map,o=[];for(let c of n){let{uuid:l,url:u}=c;if(this.documents.has(l)){if(!u){s.add(l);continue}this.result.images[l]=u,t.add(l)}}}if(s.size){let n=await De("Thumb"),a=await De("Missing!");ze("warn",[n,Array.from(s).join("\u3001"),a])}return{exist:t,lost:s}}fix(){this.fixBindBoard()}fixBindBoard(){let{schematics:t,pcbs:s,boards:r}=this.result,i=r.map(n=>n.uuid);for(let n of t)n.board&&i.indexOf(n.board)<0&&(n.board="");for(let n of s)n.board&&i.indexOf(n.board)<0&&(n.board="")}};var Tl=class{constructor(t){let{uuid:s,progressOptions:r}=t;this.uuid=s,this.progress=new qs(r)}onsuccess(){this.progress.update(!0)}onfailed(){this.progress.update(!0)}};var VT=class{constructor(t){let{uuid:s,progressOptions:r}=t;this.uuid=s,this.progress=new qs(r)}async getImages(t){let s={},r=0;for(let i in t.schematics)for(let n of t.schematics[i].sheets)n.thumb&&(s[n.uuid]=n.thumb);for(let i of t.pcbs)i.thumb&&(s[i.uuid]=i.thumb);for(let i of t.panels)i.thumb&&(s[i.uuid]=i.thumb);for(let i of t.symbols)i.thumb&&(s[i.uuid]=i.thumb);for(let i of t.block_symbol)i.thumb&&(s[i.uuid]=i.thumb);return t.images=s,{success:!0,result:{successful:s,failed:r}}}onfailed(){this.progress.update(!0)}onsuccess(){this.progress.update(!0)}};var wo=class extends VT{constructor(t){let{progressOptions:s={}}=t,i={needProgress:!0,progressTip:"Get project in cloud...",total:15,...s};super({...t,progressOptions:i})}async getExport(t={}){try{t.progress&&(this.progress=t.progress),console.time("getProjec--------------------"),console.time("getProject getProjectDetail");let s=await this.getProjectDetail();if(!s.success)return this.onfailed(),{success:!1,...s};this.progress.update(),console.timeEnd("getProject getProjectDetail"),console.time("getProject getProjectSnapshot");let r=await this.getProjectSnapshot();if(!r.success)return this.onfailed(),{success:!1,code:r.code,message:r.message};this.progress.update(),console.timeEnd("getProject getProjectSnapshot");let i=s.result,n=r.result;console.time("getProject getHashAttrBySnapshot");let a=await this.getHashAttrBySnapshot(i,n);if(!a.success)return this.onfailed(),{success:!1,code:a.code,message:a.message};this.progress.update(),console.timeEnd("getProject getHashAttrBySnapshot"),console.time("getProject getSchBySnapshot");let o=await this.getSchBySnapshot(i,n);if(!o.success)return this.onfailed(),{success:!1,code:o.code,message:o.message};this.progress.update(),console.timeEnd("getProject getSchBySnapshot"),console.time("getProject getSheetBySnapshot");let c=await this.getSheetBySnapshot(i,n);if(!c.success)return this.onfailed(),{success:!1,code:c.code,message:c.message};this.progress.update(),console.timeEnd("getProject getSheetBySnapshot"),console.time("getProject getPcbBySnapshot");let l=await this.getPcbBySnapshot(i,n);if(!l.success)return this.onfailed(),{success:!1,code:l.code,message:l.message};this.progress.update(),console.timeEnd("getProject getPcbBySnapshot"),console.time("getProject getPanelBySnapshot");let u=await this.getPanelBySnapshot(i,n);if(!u.success)return this.onfailed(),{success:!1,code:u.code,message:u.message};this.progress.update(),console.timeEnd("getProject getPanelBySnapshot"),console.time("getProject getSymbolBySnapshot");let h=await this.getSymbolBySnapshot(i,n);if(!h.success)return this.onfailed(),{success:!1,code:h.code,message:h.message};this.progress.update(),console.timeEnd("getProject getSymbolBySnapshot"),console.time("getProject getBlockSymbolBySnapshot");let p=await this.getBlockSymbolBySnapshot(i,n);if(!p.success)return this.onfailed(),{success:!1,code:p.code,message:p.message};this.progress.update(),console.timeEnd("getProject getBlockSymbolBySnapshot"),console.time("getProject getFootprintBySnapshot");let d=await this.getFootprintBySnapshot(i,n);if(!d.success)return this.onfailed(),{success:!1,code:d.code,message:d.message};this.progress.update(),console.timeEnd("getProject getFootprintBySnapshot"),console.time("getProject getDeviceBySnapshot");let f=await this.getDeviceBySnapshot(i,n);if(!f.success)return this.onfailed(),{success:!1,code:f.code,message:f.message};this.progress.update(),console.timeEnd("getProject getDeviceBySnapshot"),console.time("getProject getCopperBySnapshot");let m=await this.getCopperBySnapshot(i,n);if(!m.success)return this.onfailed(),{success:!1,code:m.code,message:m.message};this.progress.update(),console.timeEnd("getProject getCopperBySnapshot"),console.time("getProject getFontBySnapshot");let g=await this.getFontBySnapshot(i,n);if(!g.success)return this.onfailed(),{success:!1,code:g.code,message:g.message};this.progress.update(),console.timeEnd("getProject getFontBySnapshot"),console.time("getProject getBlobBySnapshot");let b=await this.getBlobBySnapshot(i,n);return b.success?(this.progress.update(),console.timeEnd("getProject getBlobBySnapshot"),console.time("getProject getImages"),await this.getImages(i),this.progress.update(),console.timeEnd("getProject getImages"),this.onsuccess(),console.timeEnd("getProjec--------------------"),{success:!0,result:i}):(this.onfailed(),{success:!1,code:b.code,message:b.message})}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async batchData(t,s,r,i,n,a,o=!1){let c=[];if(await yl(r,s,async l=>{let u=await pl(r,i,[[l]]);for(let h of u)if(h.success)c=c.concat(h.result);else{let p=[{text:"Bulk acquisition of {dataType} data:",args:{params:{dataType:t}}},{text:h.message}];a(p)}}),o){let l=await FI(r,qt,"getStr",c,c);for(let u=0;u<c.length;u++){let h=c[u];h.dataStr=l[u]||""}}await n(c)}async getHashAttrBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.block_symbol_attrs_groups);for(let a of n){let o=await se.getInstance().attr.ticket({projectId:this.uuid,hash:+a});if(o.success===!1){t.block_symbol_attribute=[];let d=["Gets the ticket for blockSymbolAttrs based on the hash:",o.message];return ze("error",d),{success:!1,message:d,code:o.code}}let c=Object.keys(o.result.paths),l=d=>{r=r.concat(d)},u=d=>{i++,jt("error",d)},h=this.uuid,p=async d=>await se.getInstance().attr.searchList({projectId:h,paths:d});await this.batchData(mt.ATTR,c,30,p,l,u)}return t.block_symbol_attribute=r,{success:!0,result:{successful:r,failed:i}}}async getSchBySnapshot(t,s){let r={},i=0,n=Object.keys(s.schematics),a=u=>{Ft(u,(h,p)=>{r[p.uuid]=p,r[p.uuid].sheets=[]})},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().schematic.list({projectId:c,uuids:u});return await this.batchData(mt.SCHEMATIC,n,30,l,a,o),t.schematics=r,{success:!0,result:{successful:r,failed:i}}}async getSheetBySnapshot(t,s,r={getDataStr:!0}){let i=[],n=0,a=Object.keys(s.schs),o=h=>{Ft(h,(p,d)=>{let f=d.schematic_uuid;t.schematics[f].sheets.push(d),i.push(d)})},c=h=>{n++,jt("error",h)},l=this.uuid,u=async h=>await se.getInstance().document.list({projectId:l,uuids:h,docType:Ne.SCH});await this.batchData(mt.SHEET,a,30,u,o,c,!0);for(let h in t.schematics){let p=t.schematics[h],{sort:d,sheets:f}=(await fe.messageBus.rpcCall("getSort",{sort:p.sort,sheets:p.sheets})).message;p.sort=d,p.sheets=f}return{success:!0,result:{successful:i,failed:n}}}async getPcbBySnapshot(t,s,r={getDataStr:!0}){let i=[],n=0,a=Object.keys(s.pcbs),o=h=>{i=h},c=h=>{n++,jt("error",h)},l=this.uuid,u=async h=>await se.getInstance().document.list({projectId:l,uuids:h,docType:Ne.PCB});return await this.batchData(mt.PCB,a,30,u,o,c,!0),t.pcbs=i,{success:!0,result:{successful:i,failed:n}}}async getPanelBySnapshot(t,s,r={getDataStr:!0}){let i=[],n=0,a=Object.keys(s.panels),o=h=>{i=h},c=h=>{n++,jt("error",h)},l=this.uuid,u=async h=>await se.getInstance().document.list({projectId:l,uuids:h,docType:Ne.PANEL});return await this.batchData(mt.PANEL,a,30,u,o,c,!0),t.panels=i,{success:!0,result:{successful:i,failed:n}}}async getSymbolBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.symbols),a=u=>{r=u},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().component.searchList({path:c,uuids:u});return await this.batchData(mt.SYMBOL,n,30,l,a,o,!0),t.symbols=r,{success:!0,result:{successful:r,failed:i}}}async getBlockSymbolBySnapshot(t,s,r={getDataStr:!0}){let i=[],n=0,a=Object.keys(s.block_symbol),o=h=>{i=h},c=h=>{n++,jt("error",h)},l=this.uuid,u=async h=>await se.getInstance().component.searchList({path:l,uuids:h});return await this.batchData(mt.BLOCK_SYMBOL,a,30,u,o,c,!0),t.block_symbol=i,{success:!0,result:{successful:i,failed:n}}}async getFootprintBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.footprints),a=u=>{r=u},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().component.searchList({path:c,uuids:u});return await this.batchData(mt.FOOTPRINT,n,30,l,a,o,!0),t.footprints=r,{success:!0,result:{successful:r,failed:i}}}async getDeviceBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.devices),a=u=>{r=u},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().device.searchList({path:c,uuids:u});return await this.batchData(mt.DEVICE,n,30,l,a,o),t.devices=r,{success:!0,result:{successful:r,failed:i}}}async getCopperBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.coppers),a=u=>{r=u},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().copper.searchList({projectId:c,paths:u});return await this.batchData(mt.COPPER,n,30,l,a,o),t.coppers=r,{success:!0,result:{successful:r,failed:i}}}async getFontBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.textpath),a=u=>{r=u},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().font.searchList({projectId:c,paths:u});return await this.batchData(mt.FONT,n,30,l,a,o),t.fonts=r,{success:!0,result:{successful:r,failed:i}}}async getBlobBySnapshot(t,s){let r=[],i=0,n=Object.keys(s.blobs),a=u=>{r=u},o=u=>{i++,jt("error",u)},c=this.uuid,l=async u=>await se.getInstance().blob.searchList({projectId:c,hashs:u});return await this.batchData(mt.BLOB,n,30,l,a,o,!0),t.blobs=r,{success:!0,result:{successful:r,failed:i}}}async getProjectDetail(){try{let t=await se.getInstance().project.get(this.uuid);return t.success===!1?{success:!1,code:t.code,message:t.message}:{success:!0,result:t.result}}catch(t){return{success:!1,message:t.message}}}async getProjectSnapshot(){try{let t={uuid:this.uuid,g_ticket:-1},s=await se.getInstance().project.ticket(t);return s.success?{success:!0,result:s.result}:{success:!1,code:s.code,message:s.message}}catch(t){return{success:!1,message:t.message}}}};var wl=class{constructor(t){this.result=[];let{uuid:s,datas:r={}}=t;this.uuid=s,this.instance=X(s),this.datas=this.parse(r)}parse(t){for(let s in t){let r=t[s];Array.isArray(r)&&(t[s]=new Set(r))}return t}async start(){try{console.time("build export--------------------"),await this.getBoards(),await this.getSchs(),await this.getSchematics(),await this.getSimulations(),await this.getPcbs(),await this.getPanels();let{exist:t}=await this.getSymbols(),{exist:s}=await this.getFootprints();await this.getDevices(t,s),await this.getAttrs(),await this.getBlobs(),await this.getFonts();let r=this.fix(this.result.join(Le));return console.timeEnd("build export--------------------"),{success:!0,result:r}}catch(t){return{success:!1,message:t.message}}}async getBoards(){if(!this.datas.boards||!this.datas.boards.size)return;let t=new Set,s=new Set;for(let r of this.datas.boards){let i=(await this.instance.board.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Board"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSchs(){if(!this.datas.schs||!this.datas.schs.size)return;let t=new Set,s=new Set,r=new Set,i=new Set;for(let n of this.datas.schs){let{uuid:a,sheets:o}=n,c=(await this.instance.schematic.getStr(a)).result;c?(this.result.push(c),t.add(a)):s.add(a);for(let l of o){let u=(await this.instance.sheet.getStr(l)).result;u?(this.result.push(u),r.add(l)):i.add(l)}}if(s.size){let n=await De("Schematic"),a=await De("File missing!");ze("warn",[n,Array.from(s).join("\u3001"),a])}if(i.size){let n=await De("Sheet"),a=await De("File missing!");ze("warn",[n,Array.from(s).join("\u3001"),a])}return{exist:t,lost:s,exist1:r,lost1:i}}async getSchematics(){if(!this.datas.schematics||!this.datas.schematics.size)return;let t=new Set,s=new Set;for(let r of this.datas.schematics){let i=(await this.instance.schematic.getStr(r)).result;i?(this.result.push(i),t.add(r),await this.getSheets(r)):s.add(r)}if(s.size){let r=await De("Schematic"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSheets(t){let s=(await this.instance.sheet.getKeys(t)).result;if(!s||!s.length)return;let r=new Set,i=new Set;for(let n of s){let a=(await this.instance.sheet.getStr(n)).result;a?(this.result.push(a),r.add(n)):i.add(n)}if(i.size){let n=await De("Sheet"),a=await De("File missing!");ze("warn",[n,Array.from(i).join("\u3001"),a])}return{exist:r,lost:i}}async getSimulations(){if(!this.datas.simulations||!this.datas.simulations.size)return;let t=new Set,s=new Set;for(let r of this.datas.simulations){let i=(await this.instance.simulation.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Simulation"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getPcbs(){if(!this.datas.pcbs||!this.datas.pcbs.size)return;let t=new Set,s=new Set;for(let r of this.datas.pcbs){let i=(await this.instance.pcb.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Pcb"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getPanels(){if(!this.datas.panels||!this.datas.panels.size)return;let t=new Set,s=new Set;for(let r of this.datas.panels){let i=(await this.instance.panel.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Panel"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getSymbols(){let t=new Set,s=new Set;if(this.datas.symbols&&this.datas.symbols.size)for(let r of this.datas.symbols){let i=(await this.instance.symbol.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Symbol"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getFootprints(){let t=new Set,s=new Set;if(this.datas.footprints&&this.datas.footprints.size)for(let r of this.datas.footprints){let i=(await this.instance.footprint.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Footprint"),i=await De("File missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getDevices(t,s){if(!this.datas.devices||!this.datas.devices.size)return;let r=new Set,i=[],n=[],a=new Set;for(let c of this.datas.devices){let l=(await this.instance.device.getData(c)).result;if(!l){r.add(c);continue}let{title:u,attributes:h}=l,{Symbol:p,Footprint:d}=h;p&&!t.has(p)&&i.push(u),d&&!s.has(d)&&n.push(u),a.add(c)}let o=new Set;for(let c of a){let l=(await this.instance.device.getStr(c)).result;l?(this.result.push(l),o.add(c)):r.add(c)}if(r.size){let c=await De("Device"),l=await De("File missing!");ze("warn",[c,Array.from(r).join("\u3001"),l])}if(i.length){let c=await De("The following devices lose bound symbol data!");ze("warn",[c,":",i.join("\u3001")])}if(n.length){let c=await De("The following devices lose bound footprint data!");ze("warn",[c,":",n.join("\u3001")])}return{exist:o,lost:r}}async getAttrs(){if(!this.datas.attrs||!this.datas.attrs.size)return;let t=new Set,s=new Set;for(let r of this.datas.attrs){let i=(await this.instance.instance.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Instance properties"),i=await De("Missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getBlobs(){if(!this.datas.blobs||!this.datas.blobs.size)return;let t=new Set,s=new Set;for(let r of this.datas.blobs){let i=(await this.instance.blob.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}if(s.size){let r=await De("Colorful Image"),i=await De("Missing!");ze("warn",[r,Array.from(s).join("\u3001"),i])}return{exist:t,lost:s}}async getFonts(){if(!this.datas.fonts||!this.datas.fonts.size)return;let t=new Set,s=new Set;for(let r of this.datas.fonts){let i=(await this.instance.font.getStr(r)).result;i?(this.result.push(i),t.add(r)):s.add(r)}return{exist:t,lost:s}}fix(t){return this.fixBindBoard(t),t}fixBindBoard(t){let s=t.match(/"board":"[a-zA-Z0-9]+"/gim);if(s&&s.length)for(let r=0;r<s.length;r++){let i=s[r],[n,a]=i.split(":");!a||new RegExp(`{"docType":"BOARD","client":"[a-zA-Z0-9]+","uuid":${a}`,"gim").test(t)||(t=t.replace(new RegExp(`"board":${a}`,"gim"),'"board":""'))}return t}};var _n=class{constructor(t){this.result={};let{str:s,uuid:r=""}=t;this.uuid=r,this.str=Array.isArray(s)?s:[s],this.result={uuid:this.uuid,boards:[],schematics:[],schs:{},sheets:[],pcbs:[],panels:[],symbols:[],footprints:[],devices:[],attrs:[],blobs:[],fonts:{},simulations:[],images:{},origin:null}}async start(){try{let t=new bo,s=t.flowParseFull();for(let r of this.str)s.update(r);return s.end(),this.build(t.getProject()),{success:!0,result:this.result}}catch(t){return{success:!1,message:t.message}}}build(t){for(let s in t.boards){let r=t.boards[s];r.isDelete||this.result.boards.push(r)}for(let s in t.schematics){let r=t.schematics[s];if(r.isDelete)continue;let i={display_name:r.title,name:Mt(r.title)};this.result.schematics.push({...r,...i})}for(let s in t.sheets){let r=t.sheets[s];if(r.isDelete)continue;let{schematic:i}=r;this.result.schs[i]=this.result.schs[i]||[];let n={display_title:r.title,title:Mt(r.title),project_uuid:this.uuid};this.result.schs[i].push({...r,...n})}for(let s in t.pcbs){let r=t.pcbs[s];if(r.isDelete)continue;let i={display_title:r.title,title:Mt(r.title),project_uuid:this.uuid,parent_uuid:r.parent};this.result.pcbs.push({...r,...i})}for(let s in t.panels){let r=t.panels[s];if(r.isDelete)continue;let i={display_title:r.title,title:Mt(r.title),project_uuid:this.uuid};this.result.panels.push({...r,...i})}for(let s in t.symbols){let r=t.symbols[s];if(r.isDelete)continue;let i={display_title:r.title,title:Mt(r.title),project_uuid:this.uuid,path:this.uuid};this.result.symbols.push({...r,...i})}for(let s in t.footprints){let r=t.footprints[s];if(r.isDelete)continue;let i={display_title:r.title,title:Mt(r.title),project_uuid:this.uuid,path:this.uuid,docType:Ne.FOOTPRINT};this.result.footprints.push({...r,...i})}for(let s in t.devices){let r=t.devices[s];r.isDelete||this.result.devices.push(r)}for(let s in t.instances){let r=t.instances[s];r.isDelete||this.result.attrs.push(r)}for(let s in t.blobs){let r=t.blobs[s];r.isDelete||this.result.blobs.push(r)}for(let s in t.fonts){let r=t.fonts[s],i={width:r.width,height:r.height,path:r.path};this.result.fonts[s]=JSON.stringify(i)}}};var Zp=class{constructor(t){let{uuid:s,progressOptions:r}=t;this.uuid=s,this.progress=new qs(r),this.bus=nI(`/${self._TAB_ID_}/project/${this.uuid}`)}parse(t){let s={};for(let r in t){let i=t[r];s[r]=new Set(i)}return s}async getAllImages(t,s){let r=await se.getInstance().project.getThumbs({projectId:t,branchUuid:s}),i={};if(r.success){let n=r.result;for(let a of n){let{uuid:o,url:c}=a;c&&(i[o]=c)}}return{success:!0,result:i}}async writeDataStr(t,s){let r=at(),i={channelId:r,options:t,additionalData:s},n=await this.bus.rpcCall(K.public.flowWrite,i);return n.success?{success:!0,result:r}:{success:!1,code:n.code,message:n.message}}onfailed(){this.progress.update(!0)}onsuccess(){this.progress.update(!0)}},Oa=class extends Zp{constructor(t){let{extractHistory:s=!1,progressOptions:r={}}=t,i={needProgress:!0,progressTip:"Get project in local...",total:4,...r};super({...t,progressOptions:i}),this.extractHistory=s}async getExport(t){try{t!=null&&t.progress&&(this.progress=t.progress);let s=(await this.bus.rpcCall(K.public.getProjectDetail)).result||{},{cbb_project:r,name:i,branch_uuid:n,introduction:a,content:o,tags:c}=s,l={uuid:this.uuid,cbb_project:r,name:i,introduction:a,description:o,tags:c};this.progress.update();let u=await this.getHistories();if(u.success===!1)return this.onfailed(),{success:!1,code:u.code,message:u.message};let h=u.result;this.progress.update();let p=await this.getAllImages(this.uuid,n);if(p.success===!1)return this.onfailed(),{success:!1,code:p.code,message:p.message};this.progress.update();let d=p.result,f={config:l,dataStr:h,images:d};return this.onsuccess(),{success:!0,result:f}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async getHistories(){try{console.time("histories");let t;return this.extractHistory?t=((await this.bus.rpcCall(K.public.histories)).result||[]).join(Le):t=(await this.bus.rpcCall(K.public.compress)).result||"",console.timeEnd("histories"),t?{success:!0,result:t}:{success:!1,message:"Failed to obtain project data!"}}catch(t){return{success:!1,message:t.message}}}async flow(t={}){try{t!=null&&t.progress&&(this.progress=t.progress);let s=(await this.bus.rpcCall(K.public.getProjectDetail)).result||{},{cbb_project:r,name:i,branch_uuid:n,introduction:a,content:o,tags:c}=s,l={uuid:this.uuid,cbb_project:r,name:i,introduction:a,description:o,tags:c};this.progress.update();let u=await this.flowHistories({clearDelete:!0},t.additionalData);if(u.success===!1)return this.onfailed(),{success:!1,message:u.message};let h=u.result;this.progress.update();let p=await this.getAllImages(this.uuid,n);if(p.success===!1)return this.onfailed(),{success:!1,code:p.code,message:p.message};this.progress.update();let d=p.result,f={config:l,channelId:h,images:d};return this.onsuccess(),{success:!0,result:f}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async flowHistories(t,s){try{let r;if(this.extractHistory){let i=await this.writeDataStr1();if(i.success===!1)return this.onfailed(),{success:!1,message:i.message};r=i.result}else{let i=await this.writeDataStr({clearDelete:!0},s);if(i.success===!1)return this.onfailed(),{success:!1,message:i.message};r=i.result}return{success:!0,result:r}}catch(r){return this.onfailed(),{success:!1,message:r.message}}}async writeDataStr1(){let t=at();return(await this.bus.rpcCall(K.public.histories,[void 0,t])).result?{success:!0,result:t}:{success:!1,message:"Failed to obtain the project log from the local stream!"}}async getTarget(t){try{t!=null&&t.progress&&(this.progress=t.progress);let s=await this.getExport(t);if(s.success===!1)return this.onfailed(),{success:!1,message:s.message};let{dataStr:r,images:i}=s.result,n=await new _n({str:r,uuid:this.uuid}).start();if(n.success===!1)return this.onfailed(),{success:!1,message:n.message};let a=Object.assign(n.result,{images:i});return this.onsuccess(),{success:!0,result:a}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}},An=class extends Zp{constructor(s){let{datas:r,name:i,cbb_project:n=!1,progressOptions:a={}}=s,o={needProgress:!0,progressTip:"Get project in local...",total:4,...a};super({...s,progressOptions:o});this.channelId=at();this.datas=r,this.name=i,this.cbb_project=n}async getExport(s){try{s!=null&&s.progress&&(this.progress=s.progress);let r=await this.bus.rpcCall(K.public.related,{params:{uuid:this.uuid,...this.datas},isRpc:!0});if(r.success===!1)return{success:!1,code:r.code,message:r.message};this.progress.update(),this.related=this.parse(r.result);let i=await new wl({uuid:this.uuid,datas:this.related}).start();if(!i.success)return{success:!1,code:i.code,message:i.message};let n=i.result;this.progress.update();let a={uuid:this.uuid,name:this.name,default_sheet:"",cbb_project:this.cbb_project,introduction:"",description:"",tags:[]},o=await this.imagesBy();if(o.success===!1)return this.onfailed(),{success:!1,code:o.code,message:o.message};let c=o.result;this.progress.update();let l={config:a,dataStr:n,images:c};return this.onsuccess(),{success:!0,result:l}}catch(r){return this.onfailed(),{success:!1,message:r.message}}}async imagesBy(){let s=(await this.bus.rpcCall(K.public.getProjectDetail)).result||{},{branch_uuid:r}=s,i=await this.getAllImages(this.uuid,r);if(i.success===!1)return{success:!1,code:i.code,message:i.message};let n={},a=i.result,o=new Set;for(let h of this.related.schs||[]){let{sheets:p}=h;for(let d of p||[])o.add(d)}for(let h of this.related.sheets||[])o.add(h);let{pcbs:c,panels:l,symbols:u}=this.related;for(let h in a)o&&o.has(h)&&(n[h]=a[h]),c&&c.has(h)&&(n[h]=a[h]),l&&l.has(h)&&(n[h]=a[h]),u&&u.has(h)&&(n[h]=a[h]);return{success:!0,result:n}}async flow(s={}){try{s!=null&&s.progress&&(this.progress=s.progress);let r=await this.bus.rpcCall(K.public.related,{params:{uuid:this.uuid,...this.datas},isRpc:!0});if(r.success===!1)return this.onfailed(),{success:!1,code:r.code,message:r.message};this.progress.update(),this.related=this.parse(r.result);let{docIds:i,eIds:n}=await this.getIds(),a=await this.getRemoveBoard(),o=await this.writeDataStr({docIds:i,eIds:n,clearDelete:!0,removeBoard:a},s.additionalData);if(o.success===!1)return this.onfailed(),{success:!1,message:o.message};let c=o.result;this.progress.update();let l={uuid:this.uuid,name:this.name,default_sheet:"",cbb_project:this.cbb_project,introduction:"",description:"",tags:[]},u=await this.imagesBy();if(u.success===!1)return this.onfailed(),{success:!1,code:u.code,message:u.message};let h=u.result;this.progress.update();let p={config:l,channelId:c,images:h};return this.onsuccess(),{success:!0,result:p}}catch(r){return this.onfailed(),{success:!1,message:r.message}}}async getIds(){let s=[],r={BLOB:[],FONT:[]},i;for(i in this.related){let n=this.related[i];if(i==="schs")for(let a of n){let{uuid:o,sheets:c}=a;s.push(o),s.push(...c)}else if(i==="schematics")for(let a of n){s.push(a);let o=(await this.bus.rpcCall(K.sheet.getKeys,a)).result||[];o&&s.push(...o)}else i==="blobs"?r.BLOB.push(...n):i==="fonts"?r.FONT.push(...n):s.push(...n)}return{docIds:s,eIds:r}}async getRemoveBoard(){let s=[],{boards:r,schematics:i,pcbs:n,schs:a}=this.related,o=new Set,c=new Set;for(let l of r){let u=(await this.bus.rpcCall(K.board.getBindKeys,l)).result;if(u){let{schematic:h,pcb:p}=u;h&&o.add(h),p&&c.add(p)}}for(let l of i)o.has(l)||s.push(l);for(let l of n)c.has(l)||s.push(l);for(let l of a){let{uuid:u}=l;o.has(u)||s.push(u)}return s}async getTarget(s){try{s!=null&&s.progress&&(this.progress=s.progress);let r=await this.bus.rpcCall(K.public.related,{params:{uuid:this.uuid,...this.datas},isRpc:!0});if(r.success===!1)return this.onfailed(),{success:!1,code:r.code,message:r.message};this.progress.update(),this.related=this.parse(r.result);let i=await new Tr({uuid:this.uuid,datas:this.related}).start();if(i.success===!1)return this.onfailed(),{success:!1,code:i.code,message:i.message};this.progress.update();let n=await this.imagesBy();if(n.success===!1)return this.onfailed(),{success:!1,code:n.code,message:n.message};let a=n.result;this.progress.update();let o=Object.assign(i.result,{images:a});return this.onsuccess(),{success:!0,result:o}}catch(r){return this.onfailed(),{success:!1,message:r.message}}}},Ia=class extends Zp{constructor(t){let{extractHistory:s=!1,progressOptions:r={}}=t,n={needProgress:!0,progressTip:"Get project in cloud...",total:5,...r};super({...t,progressOptions:n}),this.extractHistory=s}async getExport(t){try{t!=null&&t.progress&&(this.progress=t.progress);let s=await this.getProject();if(s.success===!1)return this.onfailed(),{success:!1,code:s.code,message:s.message};this.progress.update();let r=s.result,i=await this.getBranch(r);if(i.success===!1)return this.onfailed(),{success:!1,code:i.code,message:i.message};this.progress.update();let n=await this.getHistories(i.result);if(n.success===!1)return this.onfailed(),{success:!1,code:n.code,message:n.message};this.progress.update();let{name:a,cbb_project:o,branch_uuid:c,introduction:l,content:u,tags:h}=r,p=await this.getAllImages(this.uuid,c);if(p.success===!1)return this.onfailed(),{success:!1,code:p.code,message:p.message};this.progress.update();let d=p.result,m={config:{uuid:this.uuid,name:a,cbb_project:o,introduction:l,description:u,tags:h},dataStr:n.result,images:d};return this.onsuccess(),{success:!0,result:m}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async getProject(){try{let t=await se.getInstance().project.get(this.uuid);if(t.success===!1)return{success:!1,code:t.code,message:t.message};let s=t.result;return s.branch_uuid?{success:!0,result:s}:{success:!1,message:await De("Project {name} missing branch information!",{name:s.name})}}catch(t){return{success:!1,message:t.message}}}async getBranch(t){try{let{branch_uuid:s}=t;if(!s)return{success:!1,message:await De("Project {name} missing branch information!",{name:t.name})};let r=await se.getInstance().branch.get({projectId:this.uuid,branch_uuid:s});return r.success===!1?{success:!1,code:r.code,message:r.message}:{success:!0,result:r.result}}catch(s){return{success:!1,message:s.message}}}async getHistories(t){try{let{uuid:s,history_uuid:r}=t,i=await se.getInstance().projectHistory.get({projectId:this.uuid,branchUuid:s,historyUuid:r});if(i.success===!1)return{success:!1,code:i.code,message:i.message};let n=await se.getInstance().projectHistory.getHistoryData(i.result);if(!this.extractHistory){let a=new s0;a.parseFull(n),n=a.compressFull({keepFirst:!0})}return n?{success:!0,result:n}:{success:!1,message:"Failed to obtain project data!"}}catch(s){return{success:!1,message:s.message}}}async getTarget(t){try{t!=null&&t.progress&&(this.progress=t.progress);let s=await this.getExport(t);if(s.success===!1)return this.onfailed(),{success:!1,message:s.message};this.progress.update();let{dataStr:r,images:i}=s.result,n=await new _n({str:r,uuid:this.uuid}).start();if(n.success===!1)return this.onfailed(),{success:!1,message:n.message};this.progress.update();let a=Object.assign(n.result,{images:i});return this.onsuccess(),{success:!0,result:a}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}};var dh=class extends Tl{constructor(s){let{related:r,origin:i,progressOptions:n}=s,o={needProgress:!0,progressTip:"Get reuse block in cloud...",total:4,...n};super({...s,progressOptions:o});this.channelId=at();this.related=r,this.origin=i}async open2Export(){try{let s=await lh({uuid:this.uuid});if(!s.success)return{success:!1,code:s.code,message:s.message};this.instance=X(this.uuid),this.progress.update();let r=await new Oa({uuid:this.uuid}).getExport();return r.success===!1?{success:!1,code:r.code,message:r.message}:(this.progress.update(),{success:!0,result:r.result})}catch(s){return{success:!1,message:s.message}}finally{await Bp(this.uuid)}}async getExport(){try{let s=await se.getInstance().project.get(this.uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{branch_uuid:i}=r;return i?new Ia({uuid:this.uuid}).getExport():new wo({uuid:this.uuid}).getExport()}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async flow(){try{let s=await lh({uuid:this.uuid});if(!s.success)return{success:!1,code:s.code,message:s.message};this.progress.update();let r=await new Oa({uuid:this.uuid}).flow();return r.success===!1?{success:!1,code:r.code,message:r.message}:(this.progress.update(),this.onsuccess(),{success:!0,result:r.result})}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async open2Target(){try{let s=await lh({uuid:this.uuid});if(!s.success)return{success:!1,code:s.code,message:s.message};this.instance=X(this.uuid),this.progress.update();let r=await this.detail();if(r.success===!1)return{success:!1,code:r.code,message:r.message};let{config:i,branch_uuid:n}=r.result;this.progress.update();let a=await this.getRelated();if(a.success===!1)return{success:!1,code:a.code,message:a.message};let o=a.result;this.progress.update();let c=await new Tr({uuid:this.uuid,datas:o,origin:this.origin}).start();return c.success===!1?{success:!1,code:c.code,message:c.message}:(this.progress.update(),{success:!0,result:Object.assign(c.result,{config:i,branch_uuid:n})})}catch(s){return{success:!1,message:s.message}}finally{await Bp(this.uuid)}}async getTarget(){try{let s=await se.getInstance().project.get(this.uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{branch_uuid:i}=r;if(i){let n=await this.open2Target();return n.success===!1?(this.onfailed(),{success:!1,code:n.code,message:n.message}):(this.onsuccess(),{success:!0,result:n.result})}else{let n=await new wo({uuid:this.uuid}).getExport();if(n.success===!1)return this.onfailed(),{success:!1,code:n.code,message:n.message};let{name:a,cbb_project:o,default_sheet:c}=r,l=self.PRO_EDITOR_VERSION||"",u={title:a,cbbProject:o,defaultSheet:c,editorVersion:l},h=Object.assign(n.result,{config:u});return this.onsuccess(),{success:!0,result:h}}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async getRelated(){try{if(this.related){let s=await this.instance.project.related({uuid:this.uuid,...this.related});return s.success===!1?{success:!1,code:s.code,message:s.message}:{success:!0,result:s.result}}else{let s=new Set((await this.instance.board.getKeys()).result),r=new Set((await this.instance.schematic.getKeys()).result),i=new Set((await this.instance.device.getKeys()).result),n=new Set((await this.instance.symbol.getKeys()).result),a=new Set((await this.instance.footprint.getKeys()).result),o=new Set((await this.instance.instance.getKeys()).result),c=new Set((await this.instance.blob.getKeys()).result),l=new Set((await this.instance.pcb.getKeys()).result),u=new Set((await this.instance.panel.getKeys()).result);return{success:!0,result:{boards:s,schematics:r,devices:i,symbols:n,footprints:a,attrs:o,blobs:c,pcbs:l,panels:u}}}}catch(s){return{success:!1,message:s.message}}}async detail(){try{let{cbb_project:s,name:r,branch_uuid:i,introduction:n,description:a,tags:o,default_sheet:c}=(await this.instance.project.getData()).result||{};return{success:!0,result:{config:{uuid:this.uuid,cbb_project:s,name:r,introduction:n,description:a,tags:o,default_sheet:c},branch_uuid:i}}}catch(s){return{success:!1,message:s.message}}}};var g0=class extends Tl{constructor(s){let{related:r,origin:i}=s;super(s);this.channelId=at();this.ticket={schematic:Bs.TICKET,pcb:Bs.TICKET,blockSymbol:Bs.TICKET};this.instance=X(this.uuid),this.client=crypto.randomUUID(),this.related=r,this.origin=i,this.encoder=new Gi}async getARelated(s,r){this.related||(this.related={uuid:this.uuid});let{blockSymbol:i,schematic:n,pcb:a}=s;return n&&(this.related.schematicIds=this.related.schematicIds||[],this.related.schematicIds.push(n.uuid)),a&&(this.related.pcbIds=this.related.pcbIds||[],this.related.pcbIds.push(a.uuid)),await this.defaultSheet(this.related,r),this.addSelf(this.related,i.uuid),this.related}async getRRelated(s,r){try{let i=await this.getARelated(s,r),n=await this.instance.project.related({uuid:this.uuid,...i});return n.success===!1?{success:!1,code:n.code,message:n.message}:{success:!0,result:n.result}}catch(i){return{success:!1,message:i.message}}}async defaultSheet(s,r){if(!r)return;let{symbolIds:i=[],deviceIds:n=[]}=s;(await this.instance.device.isExist(r)).result&&!n.includes(r)&&n.push(r),s.deviceIds=n,(await this.instance.symbol.isExist(r)).result&&!i.includes(r)&&i.push(r),s.symbolIds=i}addSelf(s,r){let{symbolIds:i=[]}=s;r&&!i.includes(r)&&i.push(r),s.symbolIds=i}async getBoard(s){try{let{title:r,schematic:i,pcb:n}=s,{uuid:a,name:o}=i,{uuid:c,title:l}=n,u=[],h=at(),p=await Ht(),d=await fi();u.push(this.encoder.board.head({doc:h,client:this.client,updateTime:p,user:d}));let f={uuid:h,title:r,zIndex:Bs.ZINDEX};u.push(this.encoder.board.meta(Bs.TICKET,f));let m=a&&(await this.instance.schematic.getData(a)).result;if(m){let b=m.uuid;this.ticket.schematic=Math.max(this.ticket.schematic,m.ticket)+1,u.push(this.encoder.schematic.head({doc:b,user:d,client:this.client,updateTime:p,version:m.version||String(p)}));let E=this.encoder.schematic.metaData({source:m.source||"",title:o,board:h,zIndex:null});u.push(this.encoder.schematic.meta(this.ticket.schematic,E))}let g=c&&(await this.instance.pcb.getData(c)).result;if(g){let b=g.uuid;this.ticket.pcb=Math.max(this.ticket.pcb,g.ticket)+1,u.push(this.encoder.pcb.head({user:d,doc:b,client:this.client,updateTime:p,version:g.version||String(p)}));let E=this.encoder.pcb.metaData({title:l,board:h,parent:g.parent_uuid,source:g.source||"",zIndex:g.zIndex||null});u.push(this.encoder.pcb.meta(this.ticket.pcb,E))}return{success:!0,result:u.join(Le)}}catch(r){return{success:!1,message:r.message}}}geExportCbbConfig3_0(s=""){let r=Bs.TICKET,i=at(),n=[this.encoder.config.head({client:i})],a=this.encoder.config.metaData({defaultSheet:s});return n.push(this.encoder.config.meta(r,a)),{success:!0,result:n.join(Le)}}async getExport(){try{let s=await this.getTData();if(s.success===!1)return this.onfailed(),{success:!1,code:s.code,message:s.message};this.progress.update();let r=s.result,{default_sheet:i}=(await this.instance.config.getData()).result||{},n=await this.getARelated(r,i),o=await new An({uuid:this.uuid,datas:n,name:this.title,cbb_project:!0}).getExport({progress:this.progress});if(o.success===!1)return this.onfailed(),{success:!1,code:o.code,message:o.message};this.progress.update();let c=o.result.images,l=[o.result.dataStr],u=await this.onExport();if(u.success===!1)return this.onfailed(),{success:!1,code:u.code,message:u.message};u.result&&l.push(u.result),this.progress.update();let h=await this.getBoard(r);if(h.success===!1)return this.onfailed(),{success:!1,code:h.code,message:h.message};this.progress.update(),l.push(h.result);let{introduction:p,description:d,tags:f}=await this.config(r),m={uuid:this.uuid,name:r.title,default_sheet:i,cbb_project:!0,introduction:p,description:d,tags:f},g=this.geExportCbbConfig3_0(i);if(g.success===!1)return this.onfailed(),{success:!1,code:g.code,message:g.message};this.progress.update(),l.push(g.result);let b=l.join(Le),E={config:m,dataStr:b,images:c};return this.progress.update(),this.onsuccess(),{success:!0,result:E}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async flow(){try{let s=await this.getTData();if(s.success===!1)return this.onfailed(),{success:!1,code:s.code,message:s.message};this.progress.update();let r=s.result,i=[],n=await this.onFlow();if(n.success===!1)return this.onfailed(),{success:!1,code:n.code,message:n.message};this.progress.update(),n.result&&i.push(n.result);let a=await this.getBoard(r);if(a.success===!1)return this.onfailed(),{success:!1,code:a.code,message:a.message};this.progress.update(),a.result&&i.push(a.result);let{default_sheet:o}=(await this.instance.config.getData()).result||{},c=await this.getARelated(r,o),l=i.join(Le),h=await new An({uuid:this.uuid,datas:c,name:this.title,cbb_project:!0}).flow({additionalData:l});if(h.success===!1)return this.onfailed(),{success:!1,code:h.code,message:h.message};this.progress.update();let p=h.result.images,d=h.result.channelId,{introduction:f,description:m,tags:g}=await this.config(r),E={config:{uuid:this.uuid,name:r.title,default_sheet:o,cbb_project:!0,introduction:f,description:m,tags:g},channelId:d,images:p};return this.progress.update(),this.onsuccess(),{success:!0,result:E}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}async getTarget(){try{let s=await this.getTData();if(s.success===!1)return this.onfailed(),{success:!1,code:s.code,message:s.message};this.progress.update();let r=s.result,{branch_uuid:i}=(await this.instance.project.getData()).result||{},n=await this.config(r);this.progress.update();let{default_sheet:a}=(await this.instance.config.getData()).result||{},o=await this.getRRelated(r,a);if(o.success===!1)return this.onfailed(),{success:!1,code:o.code,message:o.message};this.progress.update();let c=this.getOrigin(r),l=await this.buildTarget(o.result,c);if(l.success===!1)return this.onfailed(),{success:!1,code:l.code,message:l.message};this.progress.update();let u=await this.getBoard1(l.result.boards,r);if(u.success===!1)return this.onfailed(),{success:!1,code:u.code,message:u.message};this.progress.update();let{introduction:h,description:p,tags:d}=n,f={uuid:this.uuid,name:r.title,default_sheet:a,cbb_project:!0,introduction:h,description:p,tags:d},m=Object.assign(l.result,{config:f,branch_uuid:i});return this.onsuccess(),{success:!0,result:m}}catch(s){return this.onfailed(),{success:!1,message:s.message}}}getOrigin(s){this.origin||(this.origin={});let{blockSymbol:r,schematic:i,pcb:n}=s;return i&&(this.origin.schematicIds=this.origin.schematicIds||[],this.origin.schematicIds.push(i.uuid)),n&&(this.origin.pcbIds=this.origin.pcbIds||[],this.origin.pcbIds.push(n.uuid)),r&&(this.origin.symbolIds=this.origin.symbolIds||[],this.origin.symbolIds.push(r.uuid)),this.origin}async buildTarget(s,r){try{return await new Tr({uuid:this.uuid,datas:s,origin:r}).start()}catch(i){return{success:!1,message:i.message}}}async getBoard1(s,r){try{let{title:i}=r,n=at();return s.push({uuid:n,title:i,zIndex:Bs.ZINDEX}),{success:!0,result:s}}catch(i){return{success:!1,message:i.message}}}},ph=class extends g0{constructor(t){let{title:s,progressOptions:r={}}=t,i={needProgress:!0,progressTip:"Get reuse block in local...",total:8,...r};super({...t,progressOptions:i}),this.title=s}async getTData(){try{let t={},s=await this.instance.symbol.getArrDataByTitle(this.title);if(!s.success||!s.result.length)return{success:!1,message:await De("Project does not have the reuse module {title}!",{title:this.title})};t.blockSymbol=s.result[0];let r=await this.instance.schematic.getDataByName(this.title);if(r.success){let n=r.result[0];t.schematic={uuid:n.uuid,name:n.display_name||n.name}}let i=await this.instance.pcb.getDataByTitle(this.title);if(i.success){let n=i.result[0];t.pcb={uuid:n.uuid,title:n.display_title||n.title}}return{success:!0,result:t}}catch(t){return{success:!1,message:t.message}}}async onExport(){return{success:!0,result:null}}async onFlow(){return{success:!0,result:null}}async config(t){let{introduction:s,default_sheet:r}=(await this.instance.project.getData()).result||{},{description:i,custom_tags:n}=(await this.instance.symbol.getData(t.blockSymbol.uuid)).result||{};return{uuid:this.uuid,name:this.title,cbb_project:!0,introduction:s,description:i,default_sheet:r,tags:n&&JSON.parse(n)}}},fh=class extends g0{constructor(t){let{data:s,introduction:r="",description:i="",custom_tags:n="",progressOptions:a={}}=t,c={needProgress:!0,progressTip:"Get the reuse module of the project by specifying the data",total:8,...a};super({...t,progressOptions:c}),this.data=s,this.title=s.title,this.introduction=r,this.description=i,this.custom_tags=n}async getTData(){return{success:!0,result:this.data}}async onExport(){let{title:t,blockSymbol:s,schematic:r,pcb:i}=this.data,n=crypto.randomUUID(),a=[],o=await Ht(),c=await fi();if(!s.uuid){let u=at(),h=Bs.TICKET;a.push(this.encoder.symbol.head({doc:u,client:n,updateTime:o,version:"",user:c}));let p={source:"",title:t,description:this.description,tags:Hi(this.custom_tags),docType:Ss.BLOCK_SYMBOL};a.push(this.encoder.symbol.meta(h,p)),a.push(ul(u,t,o,"",c))}if(r){r.name=t;let{uuid:l}=r,u=l&&(await this.instance.schematic.getData(l)).result;if(u){let h=l;this.ticket.schematic=Math.max(this.ticket.schematic,u.ticket)+1,a.push(this.encoder.schematic.head({doc:h,user:c,client:this.client,updateTime:o,version:u.version||String(o)}));let p=this.encoder.schematic.metaData({source:u.source||"",title:t,board:u.board,zIndex:null});a.push(this.encoder.schematic.meta(this.ticket.schematic,p))}}if(i){i.title=t;let{uuid:l}=i,u=l&&(await this.instance.pcb.getData(l)).result;if(u){let h=l;this.ticket.pcb=Math.max(this.ticket.pcb,u.ticket)+1,a.push(this.encoder.pcb.head({user:c,doc:h,client:this.client,updateTime:o,version:u.version||String(o)}));let p=this.encoder.pcb.metaData({title:t,board:u.board,parent:u.parent_uuid,source:u.source||"",zIndex:u.zIndex||null});a.push(this.encoder.pcb.meta(this.ticket.pcb,p))}}if(s){s.title=t;let{uuid:l}=s,u=l&&(await this.instance.symbol.getData(l)).result;if(u){let h=l;this.ticket.blockSymbol=Math.max(this.ticket.blockSymbol,u.ticket)+1,a.push(this.encoder.symbol.head({user:c,doc:h,client:this.client,updateTime:o,version:u.version||String(o)}));let p=this.encoder.symbol.metaData({title:t,description:u.description,tags:Hi(this.custom_tags),docType:u.docType,source:u.source||""});a.push(this.encoder.symbol.meta(this.ticket.blockSymbol,p))}}return{success:!0,result:a.join(Le)}}async onFlow(){let{title:t,blockSymbol:s,schematic:r,pcb:i}=this.data,n=crypto.randomUUID(),a=[],o=await Ht(),c=await fi();if(!s.uuid){let u=at(),h=Bs.TICKET;a.push(this.encoder.symbol.head({doc:u,client:n,updateTime:o,version:"",user:c}));let p={source:"",title:t,description:this.description,tags:Hi(this.custom_tags),docType:Ss.BLOCK_SYMBOL};a.push(this.encoder.symbol.meta(h,p)),a.push(ul(u,t,o,"",c))}if(r){r.name=t;let{uuid:l}=r,u=l&&(await this.instance.schematic.getData(l)).result;if(u){let h=l;this.ticket.schematic=Math.max(this.ticket.schematic,u.ticket)+1,a.push(this.encoder.schematic.head({doc:h,user:c,client:this.client,updateTime:o,version:u.version||String(o)}));let p=this.encoder.schematic.metaData({source:u.source||"",title:t,board:u.board,zIndex:null});a.push(this.encoder.schematic.meta(this.ticket.schematic,p))}}if(i){i.title=t;let{uuid:l}=i,u=l&&(await this.instance.pcb.getData(l)).result;if(u){let h=l;this.ticket.pcb=Math.max(this.ticket.pcb,u.ticket)+1,a.push(this.encoder.pcb.head({user:c,doc:h,client:this.client,updateTime:o,version:u.version||String(o)}));let p=this.encoder.pcb.metaData({title:t,board:u.board,parent:u.parent_uuid,source:u.source||"",zIndex:u.zIndex||null});a.push(this.encoder.pcb.meta(this.ticket.pcb,p))}}if(s){s.title=t;let{uuid:l}=s,u=l&&(await this.instance.symbol.getData(l)).result;if(u){let h=l;this.ticket.blockSymbol=Math.max(this.ticket.blockSymbol,u.ticket)+1,a.push(this.encoder.symbol.head({user:c,doc:h,client:this.client,updateTime:o,version:u.version||String(o)}));let p=this.encoder.symbol.metaData({title:t,description:u.description,tags:Hi(this.custom_tags),docType:u.docType,source:u.source||""});a.push(this.encoder.symbol.meta(this.ticket.blockSymbol,p))}}return{success:!0,result:a.join(Le)}}async config(t){let{default_sheet:s}=(await this.instance.project.getData()).result||{};return{uuid:this.uuid,name:this.title,cbb_project:!0,introduction:this.introduction,description:this.description,default_sheet:s,tags:this.custom_tags&&JSON.parse(this.custom_tags)}}};var Cn=class{constructor(t,s=!0){this.uuid=t;this.instance=X(t),this.renameKey=s}async create(t={}){try{this.onBefore(t);let s=null,r=null,i=null,n=null,a=null,o=null,c=null;if(t.createBoard){let h=await this.board(t.createBoard);if(h.success===!1)return{success:!1,message:h.message};s=h.result.board}if(t.createSchematic){let h=await this.schematic({...t.createSchematic,board:s==null?void 0:s.uuid});if(h.success===!1)return{success:!1,message:h.message};r=h.result.schematic}if(t.createSheet&&r){let h=await this.sheet({...t.createSheet,sid:r.uuid,sTicket:r.ticket});if(h.success===!1)return{success:!1,message:h.message};i=h.result}if(t.createPcb){let h=await this.pcb({...t.createPcb,board:s==null?void 0:s.uuid});if(h.success===!1)return{success:!1,message:h.message};n=h.result}if(t.createPanel){let h=await this.panel(t.createPanel);if(h.success===!1)return{success:!1,message:h.message};a=h.result}if(t.createComponent){let h=await this.component(t.createComponent);if(h.success===!1)return{success:!1,message:h.message};o=h.result}if(t.createDevice){let h=await this.device({...t.createDevice,component:o});if(h.success===!1)return{success:!1,message:h.message};c=h.result}return{success:!0,result:{schematic:r,pcb:n,sheet:i,panel:a,boards:s?[s]:[],component:o,device:c}}}catch{}}onBefore(t={}){t.createSchematic===!0&&(t.createSchematic={}),t.createBoard===!0&&(t.createBoard={}),t.createConfig===void 0&&(t.createConfig=!0),t.needTips===void 0&&(t.needTips=!0)}async project(){try{if(!this.uuid)throw new Error("Api call error!");let t=(await this.instance.project.getData()).result;return{success:!0,result:{uuid:this.uuid,project:t,user:null}}}catch(t){return{success:!1,message:t.message}}}async board(t={},s={}){try{let{title:r}=t,i=r&&(await this.instance.board.getArrDataByTitle(r)).result;if(!this.renameKey&&(i!=null&&i.length))return{success:!1,message:await De("Board {value} duplicate name",{value:r})};if(this.renameKey&&(i!=null&&i.length)){let u=(await this.instance.board.tryRename(r)).result;t.title=u}let n=await this.instance.board.addData(t);if(!n.success)return{success:!1,message:n.message};let a=n.result,o={board:a,schematic:null,sheet:null,pcb:null},c=await this.createSchematic(s.createSchematic,a);c.success&&(o.schematic=c.result.schematic,o.sheet=c.result.sheet);let l=await this.createPcb(s.createPcb,a);return l.success&&(o.pcb=l.result.pcb),{success:!0,result:o}}catch(r){return{success:!1,message:r.message}}}async createSchematic(t,s){try{return t?(t===!0&&(t={}),this.schematic({...t,board:s.uuid},{createSheet:!0})):{}}catch(r){return{success:!1,message:r.message}}}async createPcb(t,s){try{if(!t)return{};let r={...t,board:s.uuid},i=await this.pcb(r);return i.success===!1?{success:!1,message:i.message}:{success:!0,result:{pcb:i.result}}}catch(r){return{success:!1,message:r.message}}}async schematic(t={},s={}){try{let{name:r}=t,i=r&&(await this.instance.schematic.getDataByName(r)).result;if(!this.renameKey&&(i!=null&&i.length))return{success:!1,message:await De("Schematic {value} duplicate name",{value:r})};if(this.renameKey&&(i!=null&&i.length)){let c=(await this.instance.schematic.tryRename(r)).result;t.name=c}let n=await this.instance.schematic.addData(t);if(!n.success)return{success:!1,message:n.message};let a=n.result,o=null;if(s.createSheet===!0){let c=await this.sheet({sid:a.uuid,sTicket:a.ticket});c.success===!0&&(o=c.result)}else if(s.createSheet){let c=await this.sheet({...s.createSheet,sid:a.uuid,sTicket:a.ticket});c.success===!0&&(o=c.result)}return{success:!0,result:{schematic:a,sheet:o}}}catch(r){return{success:!1,message:r.message}}}async sheet(t={}){try{let{sid:s,title:r}=t,i=r&&(await this.instance.sheet.getArrDataByTitle(r,s)).result;if(!this.renameKey&&(i!=null&&i.length))return{success:!1,message:await De("Sheet {value} duplicate name",{value:r})};if(this.renameKey&&(i!=null&&i.length)){let n=(await this.instance.sheet.tryRename(r,s)).result;t.title=n}return await this.instance.sheet.addData({...t,schematic_uuid:s})}catch(s){return{success:!1,message:s.message}}}async simulation(t={}){try{let{title:s}=t,r=s&&(await this.instance.simulation.getArrDataByTitle(s)).result;if(!this.renameKey&&(r!=null&&r.length))return{success:!1,message:await De("Simulation {value} duplicate name",{value:s})};if(this.renameKey&&(r!=null&&r.length)){let i=(await this.instance.simulation.tryRename(s)).result;t.title=i}return await this.instance.simulation.addData(t)}catch(s){return{success:!1,message:s.message}}}async pcb(t={}){try{let{title:s}=t,r=s&&(await this.instance.pcb.getDataByTitle(s)).result;if(!this.renameKey&&(r!=null&&r.length))return{success:!1,message:await De("Pcb {value} duplicate name",{value:s})};if(this.renameKey&&(r!=null&&r.length)){let i=(await this.instance.pcb.tryRename(s)).result;t.title=i}return await this.instance.pcb.addData(t)}catch(s){return{success:!1,message:s.message}}}async panel(t={}){try{let{title:s}=t,r=s&&(await this.instance.panel.getArrDataByTitle(s)).result;if(!this.renameKey&&(r!=null&&r.length))return{success:!1,message:await De("Panel {value} duplicate name",{value:s})};if(this.renameKey&&(r!=null&&r.length)){let i=(await this.instance.panel.tryRename(s)).result;t.title=i}return this.instance.panel.addData(t)}catch(s){return{success:!1,message:s.message}}}async component(t={}){try{if(t.docType===Ne.FOOTPRINT){let{title:s}=t,r=s&&(await this.instance.footprint.getArrDataByTitle(s)).result;if(!this.renameKey&&(r!=null&&r.length))return{success:!1,message:await De("Footprint {value} duplicate name",{value:s})};if(this.renameKey&&(r!=null&&r.length)){let i=(await this.instance.footprint.tryRename(s)).result;t.title=i}return await this.instance.footprint.addData(t)}else if(t.docType===Ne.BLOCK_SYMBOL){let{title:s}=t,r=s&&(await this.instance.symbol.getArrDataByTitle(s)).result;if(!this.renameKey&&(r!=null&&r.length))return{success:!1,message:await De("Symbol {value} duplicate name",{value:s})};if(this.renameKey&&(r!=null&&r.length)){let n=(await this.instance.symbol.tryRename(s)).result;t.title=n}let i=await this.instance.symbol.addData(t);if(!i.success)return{success:!1,message:i.message};if(t.useTemplate){let{uuid:n,version:a}=i.result,o=await Ht(),c=await fi(),l=ul(n,s,o,a||String(o),c),u=await this.instance.symbol.setCanvas(n,l);if(!u.success)return{success:!1,message:u.message}}return{success:!0,result:i.result}}else{let{title:s}=t,r=s&&(await this.instance.symbol.getArrDataByTitle(s)).result;if(!this.renameKey&&(r!=null&&r.length))return{success:!1,message:await De("Symbol {value} duplicate name",{value:s})};if(this.renameKey&&(r!=null&&r.length)){let i=(await this.instance.symbol.tryRename(s)).result;t.title=i}return await this.instance.symbol.addData(t)}}catch(s){return{success:!1,message:s.message}}}async device(t={}){var s;try{let{title:r}=t,i=r&&(await this.instance.device.getArrDataByTitle(r)).result;if(!this.renameKey&&(i!=null&&i.length))return{success:!1,message:await De("Device {value} duplicate name",{value:r})};if(this.renameKey&&(i!=null&&i.length)){let a=(await this.instance.device.tryRename(r)).result;t.title=a}let n=(s=t.component)==null?void 0:s.docType;return n===Ne.FOOTPRINT?t.attributes.Footprint=t.component.uuid:ni(n)&&n!==Ne.BLOCK_SYMBOL&&(t.attributes.Symbol=t.component.uuid),this.instance.device.addData(t)}catch(r){return{success:!1,message:r.message}}}async config(t={}){try{return this.instance.config.updateData(t)}catch(s){return{success:!1,message:s.message}}}async branch(){try{let t=await this.instance.project.getBranchData();return t.success===!1?{success:!1,message:t.message}:{success:!0,result:t.result}}catch(t){return{success:!1,message:t.message}}}async uploadLocal(t){return this.instance.project.uploadLocal(t)}};var UI=(s=>(s.CREATE_SUCCEEDED="/pro-mgr/project/create/succeeded",s.CREATE_FAILED="/pro-mgr/project/create/failed",s))(UI||{}),HI=(e=>e)(HI||{}),GI=(e=>e)(GI||{}),YI=(e=>e)(YI||{}),VI=(e=>e)(VI||{}),zI=(e=>e)(zI||{}),WI=(e=>e)(WI||{}),qI=(e=>e)(qI||{}),JI=(e=>e)(JI||{}),KI=(e=>e)(KI||{}),XI=(e=>e)(XI||{}),ZI=(t=>(t.UPDATE_TICKET="/pro-mgr/other/updateTicket",t))(ZI||{}),KU={PROJECT:UI,SCHEMATIC:HI,DOCUMENT:GI,DEVICE:YI,COMPONENT:VI,TAG:zI,COPPER:WI,FONT:qI,BLOB:JI,ATTR:KI,CLIENT:XI,OTHER:ZI},sn=KU;var $p=class{constructor(t){this.uuid=t,this.client=crypto.randomUUID()}async branch1(t){if(!t){let r=await se.getInstance().project.get(this.uuid);if(r.success===!1)return{success:!1,code:r.code,message:r.message};t=r.result.branch_uuid}let s=await se.getInstance().branch.get({projectId:this.uuid,branch_uuid:t});return s.success===!1?{success:!1,code:s.code,message:s.message}:{success:!0,result:s.result}}board1(t){let s=this.client,{title:r=bl.BOARD,zIndex:i=Bs.ZINDEX,ticket:n=Bs.TICKET}=t,a=at(),o=new Gi,c=[],l=a;return c.push(o.board.head({doc:l,client:s,updateTime:this.serverTime,user:this.user})),c.push(o.board.meta(n,{uuid:a,title:r,zIndex:i})),{dataStr:c.join(Le),board:{uuid:a,title:r,zIndex:i}}}schematic1(t){let s=this.client,r=this.user,i=t.name||bl.SCHMEATIC,n=t.board||"",a=t.source||"",o=t.ticket||Bs.TICKET,c=t.version||"",l=at(),u=l,h=new Gi,p=[];return p.push(h.schematic.head({doc:u,client:s,updateTime:this.serverTime,user:this.user,version:c})),p.push(h.schematic.meta(o,{title:i,board:n,source:a,zIndex:null})),{dataStr:p.join(Le),schematic:{uuid:l,ticket:o,display_name:i,name:Mt(i),source:a,version:c,board:n}}}sheet1(t){let s=this.client,r=t.sid,i=at(),n=t.title||bl.SHEET,a=t.zIndex||Bs.ZINDEX,o=t.ticket||Bs.TICKET,c=t.source||"",l=t.version||"",u=t.description||"",h=new Gi,p=[],d=i;return p.push(h.sheet.head({doc:d,client:s,updateTime:this.serverTime,user:this.user,version:l})),p.push(h.sheet.meta(o,{title:n,source:c,description:u,schematic:r,zIndex:a})),{dataStr:p.join(Le),sheet:{uuid:i,display_title:n,title:Mt(n),schematic_uuid:r,source:c,version:l,description:u,zIndex:a}}}simulation1(t){let s=this.client,r=this.user,i=at(),n=t.docType,a=t.title||bl.SIMULATION,o=t.zIndex||Bs.ZINDEX,c=t.ticket||Bs.TICKET,l=t.source||"",u=t.version||"",h=t.description||"",p=new Gi,d=[],f=i;return d.push(p.simulation.head({doc:f,client:s,updateTime:this.serverTime,user:this.user,version:u})),d.push(p.simulation.meta(c,{title:a,source:l,description:h,zIndex:o,docType:n})),{dataStr:d.join(Le),simulation:{uuid:i,display_title:a,title:Mt(a),source:l,version:u,description:h,zIndex:o}}}pcb1(t){let s=this.client,r=this.user,i=at(),n=i,a=new Gi,o=[],c=(t==null?void 0:t.title)||bl.PCB,l=t.ticket||Bs.TICKET,u=t.source||"",h=t.version||"",p=t.description||"",d=t.parent_uuid||"",f=t.board||"";return o.push(a.pcb.head({doc:n,client:s,updateTime:this.serverTime,user:this.user,version:h})),o.push(a.pcb.meta(l,{title:c,source:u,description:p,parent:d,board:f,zIndex:null})),{dataStr:o.join(Le),pcb:{uuid:i,display_title:c,title:Mt(c),source:u,version:h,description:p,board:f,parent_uuid:d}}}panel1(t){let s=this.client,r=this.user,i=at(),n=i,a=new Gi,o=[],c=(t==null?void 0:t.title)||bl.PANEL,l=t.ticket||Bs.TICKET,u=t.description||"";return o.push(a.panel.head({doc:n,client:s,updateTime:this.serverTime,user:this.user})),o.push(a.panel.meta(l,{title:c,description:u,zIndex:null})),{dataStr:o.join(Le),panel:{uuid:i,display_title:c,title:Mt(c),description:u}}}component1(t){let s=this.client,r=this.user,i=at(),n=i,a=new Gi,o=[],c=t.title,l=t.docType,u=t.ticket||Bs.TICKET,h=t.source||"",p=t.version||"",d=t.description||"",f=t.custom_tags||"",m;if(l===Ne.FOOTPRINT){o.push(a.footprint.head({doc:n,client:s,updateTime:this.serverTime,user:this.user,version:p}));let g={source:h,title:c,description:d,tags:Hi(f),docType:l};o.push(a.footprint.meta(u,g)),m=o.join(Le)}else if(l===Ne.BLOCK_SYMBOL)o.push(a.symbol.head({doc:n,client:s,updateTime:this.serverTime,user:this.user,version:p})),o.push(a.symbol.meta(u,{source:h,title:c,description:d,tags:Hi(f),docType:t.docType})),t.useTemplate&&o.push(ul(n,c,this.serverTime,p,this.user)),m=o.join(Le);else if(ni(l))o.push(a.symbol.head({doc:n,client:s,updateTime:this.serverTime,user:this.user,version:p})),o.push(a.symbol.meta(u,{source:h,title:c,description:d,tags:Hi(f),docType:t.docType})),m=o.join(Le);else throw new Error(`The docType is incorrect! ${l}`);return{dataStr:m,component:{uuid:i,display_title:c,title:Mt(c),docType:l,source:h,version:p,custom_tags:f}}}device1(t){let s=this.client,r=this.user,i=at(),n=i,a=new Gi,o=[],c=t.title,l=t.ticket||Bs.TICKET,u=t.source||"",h=t.version||"",p=t.attributes||{Symbol:"",Footprint:""},d=t.custom_tags||"",f=t.description||"",m=t.images,g=t.symbol_type,b=t.footprint_type,E=t.component;E&&E.docType&&(E.docType===Ne.FOOTPRINT?(p.Footprint=E.uuid,b=E.docType):(p.Symbol=E.uuid,g=E.docType)),o.push(a.device.head({doc:n,client:s,updateTime:this.serverTime,user:this.user,version:h}));let y={title:c,tags:Hi(d),description:f,source:u,images:m,attributes:p,symbol_type:g,footprint_type:b};return o.push(a.device.meta(l,y)),{dataStr:o.join(Le),device:{uuid:i,display_title:c,title:Mt(c),attributes:p}}}config1(t){let s=this.client,{uuid:r,name:i,component:n,device:a}=t,o=t.default_sheet;if((n==null?void 0:n.docType)===Ne.SHEET_SYMBOL&&(a==null?void 0:a.attributes.Symbol)===n.uuid&&(o=a.uuid),!o)return{dataStr:""};let c=t.ticket||Bs.TICKET,l=new Gi,u=[];return u.push(l.config.head({client:s})),u.push(l.config.meta(c,{defaultSheet:o})),{dataStr:u.join(Le)}}async upload1(t){let{branchData:s,datas:r}=t,i=[],n=new dl;n.onChunk(a=>{i.push(se.getInstance().projectHistory.set({projectId:this.uuid,branchData:s,dataStr:a}))});for(let a=0;a<r.length;++a)n.push(r[a]),r[a]=null;return n.end(),await Promise.all(i),{success:!0}}};var Pr=class extends $p{constructor(t){super(t)}async create(t,s={}){try{this.onBefore(s);let r;if(typeof t=="string"){let b=await se.getInstance().project.get(this.uuid);if(b.success===!1)return{success:!1,code:b.code,message:b.message};r=b.result,this.uuid=b.result.uuid,this.user=b.result.owner}else if(t){let b=await this.project(t);if(b.success===!1)return{success:!1,code:b.code,message:b.message};this.uuid=b.result.uuid,this.user=b.result.user,r=b.result.project}else{let b=["Missing project id!"];return this.onProjectFailed({message:b}),{success:!1,message:b}}let{branch_uuid:i}=r;this.serverTime=await Ht();let n=await this.branch1(i);if(n.success===!1)return{success:!1,code:n.code,message:n.message};let a=n.result,o=[],c=null,l=null,u=null,h=null,p=null,d=null,f=null;if(s.createBoard){let b=this.board1({...s.createBoard});c=b.board,o.push(b.dataStr)}if(s.createSchematic){let b=this.schematic1({board:c==null?void 0:c.uuid,...s.createSchematic});l=b.schematic,o.push(b.dataStr)}if(s.createSheet&&l){let{uuid:b,ticket:E}=l,y={sid:b,sTicket:E,...s.createSheet},T=this.sheet1(y);u=T.sheet,o.push(T.dataStr)}if(s.createPcb){let b=this.pcb1({...s.createPcb,board:c==null?void 0:c.uuid});h=b.pcb,o.push(b.dataStr)}if(s.createPanel){let b=this.panel1({...s.createPanel});p=b.panel,o.push(b.dataStr)}if(s.createComponent){let b=this.component1({...s.createComponent});d=b.component,o.push(b.dataStr)}if(s.createDevice){let b=this.device1({...s.createDevice,component:d});f=b.device,o.push(b.dataStr)}if(s.createConfig&&r){let b=r.default_sheet,E=this.config1({...r,default_sheet:b,component:d,device:f});E!=null&&E.dataStr&&o.push(E.dataStr)}if(o.length){let b=await this.upload1({branchData:a,datas:[o.join(Le)]});if(b.success===!1)return this.onCreateFailed({name:r.name||"",code:b.code,message:b.message},s),{success:!1,code:b.code,message:b.message}}return this.onCreateSuccess(r,s),{success:!0,result:Object.assign({project:r},{branchData:a,schematic:l,pcb:h,sheet:u,panel:p,boards:c?[c]:[],component:d,device:f})}}catch(r){return this.onCreateFailed({name:(t==null?void 0:t.name)||"",message:r.message},s),{success:!1,message:r.message}}}onBefore(t={}){t.createSchematic===!0&&(t.createSchematic={}),t.createBoard===!0&&(t.createBoard={}),t.createConfig===void 0&&(t.createConfig=!0),t.needTips===void 0&&(t.needTips=!0)}onCreateSuccess(t,s={}){s.needTips&&fe.messageBus.publish("ui/toastMsg",{type:"info",msg:"Create new project success!"})}onCreateFailed(t,s={}){let{code:r,message:i}=t;if(s.needTips){let n=["Create new project failed!",Dt({code:r})||i];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:n}),ze("error",n)}}async project(t){try{let s=await se.getInstance().project.create(t);if(s.success===!1){let n=uh(s.message||"Create new project failed!");return this.onProjectFailed({message:n}),{success:!1,code:s.code,message:s.message||"Create new project failed!"}}let r=s.result;this.uuid=r.uuid,this.user=r.owner;let i=await se.getInstance().branch.create({projectId:this.uuid});if(i.success===!1){let n=uh(i.message||"Create new project failed!");return this.onProjectFailed({message:n}),{success:!1,code:i.code,message:i.message||"Create new project failed!"}}return this.serverTime=await Ht(),this.onProjectSuccess({data:t,result:r}),{success:!0,result:{uuid:this.uuid,user:this.user,project:r}}}catch(s){return{success:!1,message:s.message}}}onProjectSuccess(t){let{data:s,result:r}=t,i=s?{ownerSelectId:s.ownerSelectId,ownerBelongId:s.user_uuid}:{};fe.messageBus.publish(sn.PROJECT.CREATE_SUCCEEDED,{...r,...i})}onProjectFailed(t,s={}){fe.messageBus.publish(sn.PROJECT.CREATE_FAILED,{...t,options:s})}async board(t={},s={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let r=await this.branch1(t.branch_uuid);if(r.success===!1)return{success:!1,code:r.code,message:r.message};let i=r.result,{dataStr:n,board:a}=this.board1(t),o=[n],{dataStr:c,schematic:l,sheet:u}=this.createSchematic(s.createSchematic,a);c&&o.push(c);let{dataStr:h,pcb:p}=this.createPcb(s.createPcb,a);h&&o.push(h);let d=await this.upload1({branchData:i,datas:[o.join(Le)]});return d.success===!1?{success:!1,code:d.code,message:d.message}:{success:!0,result:{board:a,schematic:l,sheet:u,pcb:p}}}catch(r){return{success:!1,message:r.message}}}createSchematic(t,s){if(!t)return{};t===!0&&(t={});let r={...t,board:s.uuid},{dataStr:i,schematic:n}=this.schematic1(r),{uuid:a,ticket:o}=n,{dataStr:c,sheet:l}=this.sheet1({sid:a,sTicket:o});return{dataStr:[i,c].join(Le),schematic:n,sheet:l}}createPcb(t,s){if(!t)return{};let r={...t,board:s.uuid};return this.pcb1(r)}async schematic(t={},s={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let r=await this.branch1(t.branch_uuid);if(r.success===!1)return{success:!1,code:r.code,message:r.message};let i=r.result,{dataStr:n,schematic:a}=this.schematic1(t),o=[n],{dataStr:c,sheet:l}=this.createSheet(s.createSheet,a);c&&o.push(c);let u=await this.upload1({branchData:i,datas:[o.join(Le)]});return u.success===!1?{success:!1,code:u.code,message:u.message}:{success:!0,result:{schematic:a,sheet:l}}}catch(r){return{success:!1,message:r.message}}}createSheet(t,s){if(!t)return{};t===!0&&(t={});let{uuid:r,ticket:i}=s,n={...t,sid:r,sTicket:i};return this.sheet1(n)}async sheet(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i,sheet:n}=this.sheet1(t),a=await this.upload1({branchData:r,datas:[i]});return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:n}}catch(s){return{success:!1,message:s.message}}}async simulation(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i,simulation:n}=this.simulation1(t),a=await this.upload1({branchData:r,datas:[i]});return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:n}}catch(s){return{success:!1,message:s.message}}}async pcb(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i,pcb:n}=this.pcb1(t),a=await this.upload1({branchData:r,datas:[i]});return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:n}}catch(s){return{success:!1,message:s.message}}}async panel(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i,panel:n}=this.panel1(t),a=await this.upload1({branchData:r,datas:[i]});return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:n}}catch(s){return{success:!1,message:s.message}}}async component(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i,component:n}=this.component1(t),a=await this.upload1({branchData:r,datas:[i]});return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:n}}catch(s){return{success:!1,message:s.message}}}async device(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i,device:n}=this.device1(t),a=await this.upload1({branchData:r,datas:[i]});return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:n}}catch(s){return{success:!1,message:s.message}}}async config(t={}){try{if(!this.uuid)return{success:!1,message:"Missing project id!"};let s=await this.branch1(t.branch_uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{dataStr:i}=this.config1(t);if(i){let n=await this.upload1({branchData:r,datas:[i]});if(n.success===!1)return{success:!1,code:n.code,message:n.message}}return{success:!0,result:null}}catch(s){return{success:!1,message:s.message}}}async branch(t){return this.branch1(t)}async upload(t){return this.upload1(t)}};var Sl=class{constructor(t,s=[]){this.type=t;this.folders=s}async itorFile(t){let s=/[A-Za-z\d]+[\///]$/;for(let r in t){if(s.test(r))continue;let i=t[r],n=r.split("/");if(this.folders.includes(n[0])){let a=eg(i);this.getBlob(a,n)}else{let a=un(i);this.getContent(a,n)}}}async getData(t){return await this.itorFile(t),await this.get()}},mh=class extends Sl{async build(t){let s=/[A-Za-z\d]+[\///]$/;for(let r of t){if(s.test(r))continue;let i=r.split("/"),n=at();this.oneach(i,n)}return await this.onparse()}};var Qp=class extends Sl{constructor(s,r){Ki.remove(r,s),r.unshift(s);super(s,[Gt.IMAGE]);this.result={};this.map={};this.attrs={};this.coppers={};this.fonts={};this.blobs={};this.images={}}getContent(s,r){let i=r[r.length-1];if(r.includes(this.type))this.json=JSON.parse(s);else if(r.includes(Gt.SHEET)){let n=i.split(".")[0],a=r[r.length-2];this.map[a+n]=s}else if(r.includes(Gt.INSTANCE)){let n=i.split(".")[0];this.attrs[n]=s}else if(r.includes(Gt.POUR)){let n=i.split(".")[0];this.coppers[n]=s}else if(r.includes(Gt.FONT)){let n=i.split(".")[0];this.fonts[n]=s}else if(r.includes(Gt.BLOB)){let n=i.split(".")[0];this.blobs[n]=s}else{let n=i.split(".")[0];this.map[n]=s}}getBlob(s,r){let i=r[r.length-1];if(r.includes(Gt.IMAGE)){let n=i.split(".")[0];this.images[n]=s}}async get(){try{if(!this.json)return{success:!1,message:`The project lost the configuration file ${this.type}\uFF01`};let s=await this.check();return s.success===!1?{success:!1,...s}:(this.parseSchematics(),this.parsePcbs(),this.parsePanels(),this.parseSymbols(),this.parseFootprints(),this.parseDevices(),this.parseAttrs(),this.parseCoppers(),this.parseFonts(),this.parseBlobs(),this.parseImages(),this.parseProject(),this.parseConfig(),{success:!0,result:this.result})}catch(s){return{success:!1,message:s.message}}}async check(){return{success:!0}}async checkDevice(){let s=[],r=[],i=this.json.devices;for(let a in i){let o=i[a],{title:c,attributes:l}=o,{Symbol:u,Footprint:h}=l;u&&!this.json.symbols[u]&&s.push(c),h&&!this.json.footprints[h]&&r.push(c)}let n=[];if(s.length){let o=`${await De("The following devices lose bound symbol data!")}: ${s.join("\u3001")}`;n.push(o)}if(r.length){let o=`${await De("The following devices lose bound footprint data!")}: ${r.join("\u3001")}`;n.push(o)}return n.length&&ze("warn",n),{success:!(s.length+r.length),message:n.join(" ")}}parseSchematics(){this.result.schematics={};for(let s in this.json.schematics){let r=this.json.schematics[s],i=this.parseSheets(s,r.sheets);this.result.schematics[s]={...r,display_name:r.name,name:Mt(r.name),sheets:i}}}parseSheets(s,r){let i=[];for(let n=0;n<r.length;n++){let a=r[n],o={...a,display_title:a.name,title:Mt(a.name),sheet_id:a.id,docType:Ne.SCH,dataStr:this.map[s+a.id]};o.uuid||(o.uuid=at()),i.push(o)}return i}parsePcbs(){var s,r,i;this.result.pcbs=[];for(let n in this.json.pcbs){let a=this.json.pcbs[n],o=((i=(r=(s=this.json)==null?void 0:s.pcbData)==null?void 0:r[n])==null?void 0:i.parent_uuid)||null,c;typeof a=="string"?c={title:a,dataStr:this.map[n],uuid:n,parent_uuid:o}:c={...a,dataStr:this.map[n],uuid:n,parent_uuid:o},this.result.pcbs.push(c)}}parsePanels(){this.result.panels=[];for(let s in this.json.panels){let i={title:this.json.panels[s],dataStr:this.map[s],uuid:s};this.result.panels.push(i)}}parseSymbols(){this.result.symbols=[],this.result.block_symbol=[];for(let s in this.json.symbols){let r=this.json.symbols[s],i={...r,uuid:s,docType:r.type,description:r.desc,dataStr:this.map[s]};i.docType===Ne.BLOCK_SYMBOL?this.result.block_symbol.push(i):this.result.symbols.push(i)}}parseFootprints(){this.result.footprints=[];for(let s in this.json.footprints){let i={...this.json.footprints[s],dataStr:this.map[s],uuid:s,docType:Ne.FOOTPRINT};this.result.footprints.push(i)}}parseDevices(){this.result.devices=[];for(let s in this.json.devices){let i={...this.json.devices[s],uuid:s};this.result.devices.push(i)}}parseAttrs(){this.result.block_symbol_attribute=[];for(let s in this.attrs){let r=this.attrs[s];y0(r,i=>{if(!i)return;let n=JSON.parse(i);if(n[0]==="OVERRIDE"&&Array.isArray(n[1])){let a={path:n[1].join("_"),attr:n[2]};this.result.block_symbol_attribute.push(a)}})}}parseCoppers(){this.result.coppers=[];for(let s in this.coppers){let i={dataStr:this.coppers[s],path:atob(s)};this.result.coppers.push(i)}}parseFonts(){this.result.fonts=[];for(let s in this.fonts){let i={dataStr:this.fonts[s],path:atob(s)};this.result.fonts.push(i)}}parseBlobs(){this.result.blobs=[];for(let s in this.blobs){let r=this.blobs[s],i="";y0(r,a=>{if(!a)return;let o=JSON.parse(a);o[0]==="BLOB"&&(i=o[2])});let n={dataStr:r,hash:atob(s),filename:i};this.result.blobs.push(n)}}parseImages(){this.result.images={};for(let s in this.images){let r=this.images[s];this.result.images[s]=r}}parseProject(){let s=this.json.config||{};this.result.cbb_project=s.cbbProject||!1,this.result.default_sheet=s.defaultSheet,this.result.boards=[];for(let r in this.json.boards){let{schematic:i,pcb:n}=this.json.boards[r],a={name:r,sch:i,pcb:n};this.result.boards.push(a)}}parseConfig(){let s=this.json.config||{};this.result.config=s}};var ef=class{static validate(t){if(this.scanChunks(t,0,this.LOCAL_HEADER,"Missing local file header"),this.findSignatureAcrossChunks(t,this.CENTRAL_DIR).chunkIndex===-1)throw new Error("Central directory signature not found")}static scanChunks(t,s,r,i){let n=r.length,a=0;for(let o of t){for(let c=0;c<o.length&&a<r.length;c++){if(o[c]!==r[a])throw new Error(`${i} at position ${s+c}`);a++,n--}if(s+=o.length,n<=0)break}}static findSignatureAcrossChunks(t,s){let r=0;for(let i=0;i<t.length;i++){let n=t[i];for(let a=0;a<=n.length-s.length;a++){let o=!0;for(let c=0;c<s.length;c++)if(a+c>=n.length){if(i+1>=t.length){o=!1;break}if(t[i+1][a+c-n.length]!==s[c]){o=!1;break}}else if(n[a+c]!==s[c]){o=!1;break}if(o)return{chunkIndex:i,position:a}}r+=n.length}return{chunkIndex:-1,position:-1}}};ef.LOCAL_HEADER=[80,75,3,4],ef.CENTRAL_DIR=[80,75,1,2];var tf=class{constructor(t=6){this.files={};this.chunks=[];this.zip=new AP((s,r)=>{if(s)throw s;this.chunks.push(r)}),this.level=t}addFolder(t){let s=`${t}/`;this.addFile(s)}addFile(t){let s=new _P(t,{level:this.level});this.files[t]=s,this.zip.add(s)}appendData(t,s){if(!this.files[t])throw new Error(`File ${t} not exists`);this.files[t].push(s)}async finalize(){return Object.values(this.files).forEach(t=>{t.push(new Uint8Array(0),!0)}),this.zip.end(),ef.validate(this.chunks),this.chunks}async unit8array(){let t=await this.finalize();return Qm(t)}async blob(){let t=await this.finalize();return new Blob(t,{type:"application/zip"})}},xa=class{constructor(t){this.file=t;this.isAborted=!1;this.abortController=new AbortController;this._onfile=()=>!0;this._ondata=async()=>{};this._toAbort=()=>!1;this._onabort=()=>{}}set onfile(t){t&&(this._onfile=t)}set ondata(t){t&&(this._ondata=t)}set toAbort(t){t&&(this._toAbort=t)}set onabort(t){t&&(this._onabort=t)}async read(){return new Promise(async(t,s)=>{console.time("StreamReader----------------");let r=this.file.stream().getReader(),i=new DP,n=null;i.register(CP),this.abortController.signal.addEventListener("abort",()=>{this.isAborted=!0,this._onabort(),r.cancel()}),i.onfile=a=>{this.isAborted||this._onfile(a)&&(a.ondata=(o,c,l)=>{if(o)return this.abort(),s(`The file may be damaged. Please download it again! filename: ${a.name}, message: ${o.message}`);this.isAborted||(n=new Promise(async u=>{await this._ondata(a.name,o,c,l),u(),n=null}),this._toAbort(a.name,o,c,l)&&this.abort())},a.start())};try{for(;!this.isAborted;){n&&await n;let{done:a,value:o}=await r.read();if(a){i.push(new Uint8Array(0));break}i.push(new Uint8Array(o))}return console.timeEnd("StreamReader----------------"),t()}catch(a){this.abort(),s(`Zip processing failed: ${a instanceof Error?a.message:String(a)}`)}})}abort(){this.abortController.abort()}};var zT=Ei(Vi());var _l=class extends mh{constructor(s,r){super(s,[Gt.IMAGE]);this.result={images:{}};this.result1={images:{}}}getContent(s,r){let i=r[r.length-1];r.includes(this.type)?this.result.config=JSON.parse(s):i.endsWith(Kt.EPRU)&&(this.result.dataStr=s)}getBlob(s,r){let i=r[r.length-1];if(r.includes(Gt.IMAGE)){let n=i.split(".")[0];this.result.images[n]=s}}async get(){return this.result.config?{success:!0,result:this.result}:{success:!1,message:`The project lost the configuration file ${this.type}\uFF01`}}async check(){return{success:!0}}oneach(s,r){let i=s[s.length-1];if(s.includes(this.type))this.result1.config=r;else if(i.endsWith(Kt.EPRU))this.result1.dataStr=r;else if(s.includes(Gt.IMAGE)){let n=i.split(".")[0];this.result1.images[n]=r}}async onparse(){return this.result1.config?{success:!0,result:this.result1}:{success:!1,message:`The project lost the configuration file ${this.type}\uFF01`}}async write(s,r){return new Promise((i,n)=>{let{dataStr:a,config:o,images:c}=s,l=[];l.push(this.writeDataStr(a,r)),l.push(this.writeImages(c,r)),Promise.all(l).then(()=>{i()}).catch(u=>{n(u)})})}async writeDataStr(s,r){s&&(await(0,zT.flowWrite)(s,async i=>{let n=new xa(r);n.onfile=a=>!!a.name.endsWith(Kt.EPRU),n.ondata=async(a,o,c,l)=>{await i.write(c)},n.toAbort=(a,o,c,l)=>a.endsWith(Kt.EPRU)?l:!1,await n.read(),console.warn("flow1 readDataStr--------------------",s)},void 0,!1),console.warn("flow1 writeDataStr--------------------"))}async writeImages(s,r){if(!(!s||mn(s))){for(let i in s){let n=s[i];await(0,zT.flowWrite)(n,async a=>{let o=new xa(r);o.onfile=c=>!!c.name.includes(i),o.ondata=async(c,l,u,h)=>{await a.write(u)},o.toAbort=(c,l,u,h)=>c.includes(c)?h:!1,await o.read(),console.warn("flow1 readImages--------------------",n)},void 0,!1)}console.warn("flow1 writeImages--------------------")}}};var WT=Ei(Vi()),rn=class extends mh{constructor(s,r){Ki.remove(r,s),r.unshift(s);super(s);this.result={};this.result1={}}getContent(s,r){let i=r[r.length-1];r.includes(this.type)?this.result.config=JSON.parse(s):this.result.dataStr=s}getBlob(s,r){}async get(){try{if(!this.result.config)return{success:!1,message:`Lost the configuration file ${this.type}\uFF01`};let s=await this.check();return s.success===!1?{success:!1,...s}:{success:!0,result:this.result}}catch(s){return{success:!1,message:s.message}}}async check(){let s=await this.checkDevice();return s.success?{success:!0}:{success:!1,...s}}async checkDevice(){var n,a,o;let s=[],r=[],i=((n=this.result.config)==null?void 0:n.devices)||{};for(let c in i){let l=i[c],{display_title:u,attributes:h}=l,{Symbol:p,Footprint:d}=h;p&&!((a=this.result.config)!=null&&a.symbols[p])&&s.push(u),d&&!((o=this.result.config)!=null&&o.footprints[d])&&r.push(u)}if(s.length){let l=`${await De("The following devices lose bound symbol data!")}: ${s.join("\u3001")}`;hc("warn",l)}if(r.length){let l=`${await De("The following devices lose bound footprint data!")}: ${r.join("\u3001")}`;hc("warn",l)}return{success:!(s.length+r.length)}}oneach(s,r){let i=s[s.length-1];s.includes(this.type)?this.result1.config=r:this.result1.dataStr=r}async onparse(){return this.result1.config?{success:!0,result:this.result1}:{success:!1,message:`Lost the configuration file ${this.type}\uFF01`}}async write(s,r){return new Promise((i,n)=>{let{dataStr:a,config:o}=s,c=[];c.push(this.writeDataStr(a,r)),c.push(this.writeConfig(o,r)),Promise.all(c).then(()=>{i()}).catch(l=>{n(l)})})}async writeDataStr(s,r){s&&(await(0,WT.flowWrite)(s,async i=>{let n=new xa(r);n.onfile=a=>!a.name.includes(this.type),n.ondata=async(a,o,c,l)=>{await i.write(c)},n.toAbort=(a,o,c,l)=>a.includes(this.type)?!1:l,await n.read(),console.warn("flow1 readDataStr--------------------",s)},void 0,!1),console.warn("flow1 writeDataStr==============="))}async writeConfig(s,r){await(0,WT.flowWrite)(s,async i=>{let n=new xa(r);n.onfile=a=>!!a.name.includes(this.type),n.ondata=async(a,o,c,l)=>{await i.write(c)},n.toAbort=(a,o,c,l)=>a.includes(this.type)?l:!1,await n.read()}),console.warn("flow1 writeConfig===============")}};var dc=class extends Sl{constructor(s,r){Ki.remove(r,s),r.unshift(s);super(s);this.result={};this.map={}}getContent(s,r){let i=r[r.length-1];if(r.includes(this.type))this.json=this.parse(JSON.parse(s));else{let n=i.split(".")[0];this.map[n]=s}}parse(s){let{devices:r={},symbols:i={},footprints:n={},"panel-lib":a={}}=s;return{devices:r,symbols:i,footprints:n,"panel-lib":a}}getBlob(s,r){}async get(){try{if(!this.json)return{success:!1,message:`Lost the configuration file ${this.type}\uFF01`};let s=await this.check();return s.success===!1?{success:!1,...s}:(this.parseSymbols(),this.parseFootprints(),this.parseDevices(),this.parsePanelLib(),{success:!0,result:this.result})}catch(s){return{success:!1,message:s.message}}}async check(){let s=await this.checkDevice();return s.success?{success:!0}:{success:!1,...s}}async checkDevice(){let s=[],r=[],i=this.json.devices;for(let n in i){let a=i[n],{display_title:o,attributes:c}=a,{Symbol:l,Footprint:u}=c;l&&!this.json.symbols[l]&&s.push(o),u&&!this.json.footprints[u]&&r.push(o)}if(s.length){let a=`${await De("The following devices lose bound symbol data!")}: ${s.join("\u3001")}`;hc("warn",a)}if(r.length){let a=`${await De("The following devices lose bound footprint data!")}: ${r.join("\u3001")}`;hc("warn",a)}return{success:!(s.length+r.length)}}parseSymbols(){this.result.symbols=[],this.result.block_symbol=[];for(let s in this.json.symbols){let i={...this.json.symbols[s],uuid:s,dataStr:this.map[s]};i.docType===Ne.BLOCK_SYMBOL?this.result.block_symbol.push(i):this.result.symbols.push(i)}}parseFootprints(){this.result.footprints=[];for(let s in this.json.footprints){let i={...this.json.footprints[s],dataStr:this.map[s],uuid:s,docType:Ne.FOOTPRINT};this.result.footprints.push(i)}}parseDevices(){this.result.devices=[];for(let s in this.json.devices){let i={...this.json.devices[s],uuid:s};this.result.devices.push(i)}}parsePanelLib(){this.result["panel-lib"]=[];for(let s in this.json["panel-lib"]){let i={...this.json["panel-lib"][s],dataStr:this.map[s],uuid:s};this.result["panel-lib"].push(i)}}};var $I=Ei(LE());async function QI(e){let t=new $I.default;await t.loadAsync(e);let s=await t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}});return new File([s],e.name,{type:s.type})}var E0="The imported file format incorrect or doesn't match current type, please re-select and import.",Ii=class{constructor(t){let{file:s,ignore:r=[],progressOptions:i={}}=t;this.file=s,this.ignore=r;let n={needProgress:!0,progressTip:"unzip...",total:2,...i};this.progress=new qs(n)}async decrypt(){await sf(this.file)&&(this.file=(await qT(this.file,b0[this.file.name]))[0])}async decompress(t,s,r,i,n,a){try{let o={},c=new xa(t);c.onfile=r;let l=async(u,h,p,d)=>{o[u]||(o[u]=[]),o[u].push(p),d&&s&&(o[u]=Qm(o[u]))};return c.ondata=i||l,c.toAbort=n,c.onabort=a,await c.read(),o}catch(o){if(o.includes("unexpected EOF")){console.warn("Decompress and downgrade. Use jszip for decompression!");let c=await QI(t);return this.decompress(c,s,r,i,n,a)}throw new Error(o)}}async start(t={}){try{t.progress&&(this.progress=t.progress),await this.decrypt();let s=await this.decompress(this.file,!0);this.progress.update();let r=Object.keys(s),i,n;return r.indexOf("project.json")>=0?(i="project.json",n=await new Qp(i,r).getData(s)):r.indexOf("device.json")>=0?(i="device.json",n=await new dc(i,r).getData(s)):r.indexOf("symbol.json")>=0?(i="symbol.json",n=await new dc(i,r).getData(s)):r.indexOf("footprint.json")>=0?(i="footprint.json",n=await new dc(i,r).getData(s)):r.indexOf("panel-lib.json")>=0?(i="panel-lib.json",n=await new dc(i,r).getData(s)):r.indexOf("project2.json")>=0?(i="project2.json",n=await new _l(i,r).getData(s)):r.indexOf("device2.json")>=0?(i="device2.json",n=await new rn(i,r).getData(s)):r.indexOf("symbol2.json")>=0?(i="symbol2.json",n=await new rn(i,r).getData(s)):r.indexOf("footprint2.json")>=0?(i="footprint2.json",n=await new rn(i,r).getData(s)):r.indexOf("panel-lib2.json")>=0&&(i="panel-lib2.json",n=await new rn(i,r).getData(s)),n?(this.progress.update(!0),{...n,type:i}):(this.progress.update(!0),{success:!1,message:E0,type:i})}catch(s){return{success:!1,message:["The imported ZIP does not conform to the format standard!",s.message]}}}async extract(t={}){try{t.progress&&(this.progress=t.progress),console.time("unzip--------------------"),await this.decrypt();let s=await this.ondata(this.file);this.progress.update();let r=Object.keys(s),i;if(r.indexOf("project.json")>=0){let n=un(s["project.json"]),a=JSON.parse(n).config;i={title:a.title,cbbProject:a.cbbProject,editorVersion:a.editorVersion}}else if(r.indexOf("project2.json")>=0){let n=un(s["project2.json"]),a=JSON.parse(n);i={title:a.title,cbbProject:a.cbb_project,editorVersion:a.editorVersion,introduction:a.introduction,description:a.description,tags:a.tags}}return i?(this.progress.update(!0),console.timeEnd("unzip--------------------"),{success:!0,result:i}):(this.progress.update(!0),{success:!1,message:E0})}catch(s){return{success:!1,message:["The imported ZIP does not conform to the format standard!",s.message]}}}async ondata(t){let s=i=>i.name==="project.json"||i.name==="project2.json",r=(i,n,a,o)=>i==="project.json"||i==="project2.json"?o:!1;return await this.decompress(t,!0,s,void 0,r,void 0)}async flow(t={}){try{return new Promise(async s=>{t.progress&&(this.progress=t.progress);let r=await this.getNames();this.progress.update();let i=await this.build(r);if(this.progress.update(),i.success===!1)return s({success:!1,message:i.message});let n=i.type,a=i.result;console.warn("flow1 resolve--------------------"),s({success:!0,result:a}),await this.write(n,r,a),console.warn("flow1 write end--------------------")})}catch(s){throw new Error(`'The imported ZIP does not conform to the format standard!', ${s.message}`)}}async getNames(){await this.decrypt();let t=[],s=r=>(this.ignore.find(i=>r.name.includes(i))||t.push(r.name),!1);return await this.decompress(this.file,!1,s),t}async build(t){let s,r;return t.indexOf("project2.json")>=0?(s="project2.json",r=await new _l(s,t).build(t)):t.indexOf("device2.json")>=0?(s="device2.json",r=await new rn(s,t).build(t)):t.indexOf("symbol2.json")>=0?(s="symbol2.json",r=await new rn(s,t).build(t)):t.indexOf("footprint2.json")>=0?(s="footprint2.json",r=await new rn(s,t).build(t)):t.indexOf("panel-lib2.json")>=0&&(s="panel-lib2.json",r=await new rn(s,t).build(t)),r?{...r,type:s}:(this.progress.update(!0),{success:!1,message:E0,type:s})}async write(t,s,r){switch(t){case"project2.json":return await new _l(t,s).write(r,this.file);case"device2.json":case"symbol2.json":case"footprint2.json":case"panel-lib2.json":return await new rn(t,s).write(r,this.file)}}async parse(t={}){try{t.progress&&(this.progress=t.progress);let s=await this.start(t);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let{type:r,result:i}=s;if(r==="project.json")return{success:!0,result:Object.assign(i,{type:r})};if(r==="project2.json"){let{images:n,dataStr:a,config:o}=i,c=new bo;c.setNotCanvas(!0);let l=c.flowParseFull();l.update(a),l.end();let u=c.getProject();return{success:!0,result:Object.assign(u,{images:n,config:o,type:r})}}else throw new Error("Api call error!")}catch(s){return{success:!1,message:["The imported ZIP does not conform to the format standard!",s.message]}}}async check(t={}){try{t.progress&&(this.progress=t.progress);let s=await this.getNames();this.progress.update();let r;return s.indexOf("project.json")>=0?r="project.json":s.indexOf("device.json")>=0?r="device.json":s.indexOf("symbol.json")>=0?r="symbol.json":s.indexOf("footprint.json")>=0?r="footprint.json":s.indexOf("panel-lib.json")>=0?r="panel-lib.json":s.indexOf("project2.json")>=0?r="project2.json":s.indexOf("device2.json")>=0?r="device2.json":s.indexOf("symbol2.json")>=0?r="symbol2.json":s.indexOf("footprint2.json")>=0?r="footprint2.json":s.indexOf("panel-lib2.json")>=0&&(r="panel-lib2.json"),r?(this.progress.update(!0),{success:!0,result:r}):(this.progress.update(!0),{success:!1,message:E0})}catch(s){return{success:!1,message:["The imported ZIP does not conform to the format standard!",s.message]}}}};function rf(e){return e&&er.getInstance().hasLib(e)}async function JT(e){let{fromLibUuid:t,uuid:s}=e,i=await er.getInstance().getLib(t).cbb.getDetail(s),n=`${at()+Kt.ZIP}`,a=new File([i],n,{type:"zip"}),o=await new Ii({file:a}).start();return o.success===!1?{success:!1,code:o.code,message:o.message}:{success:!0,result:o.result}}async function tx(e){let{fromLibUuid:t,uuid:s}=e,r=await JT({fromLibUuid:t,uuid:s});if(r.success===!1)return{success:!1,code:r.code,message:r.message};let i=r.result;if(i.dataStr){let{images:n,config:a,dataStr:o}=i,c=await new _n({str:o}).start();if(c.success===!1)return{success:!1,code:c.code,message:c.message};let l={uuid:a.uuid,name:a.title,cbb_project:a.cbb_project,introduction:a.introduction,description:a.description,tags:a.tags&&JSON.parse(a.tags)};return{success:!0,result:Object.assign(c.result,{images:n,config:l})}}else return{success:!0,result:i}}var mi=class{async check(t){try{let{message:s}=await fe.messageBus.rpcCall("isLogined");return!ve&&!s?(fe.messageBus.publish("login"),{success:!1,message:"Not logged in yet, please log in and try again"}):t.title.length<1||t.title.length>128?{success:!1,message:"The title length must be between 1~128 characters!"}:!ve&&!t.owner?{success:!1,message:'Please fill in "Belonging"'}:{success:!0}}catch(s){return{success:!1,message:s.message}}}async onBeforeCreate(t,s){s.project||(s.project=fe.currentProject.projectId),typeof s.project=="string"&&Ge(s.project)||delete t.source,s.createBoard&&(s.createSchematic=s.createSchematic||!0,s.createPcb=s.createPcb||!0,s.createSheet=s.createSheet||{}),s.createSchematic&&(s.createSheet=s.createSheet||{})}async create(t){try{let{data:s,options:r={}}=t,i=await this.check(s);return i.success===!1?{success:!1,message:i.message}:(await this.onBeforeCreate(s,r),typeof r.project=="string"&&Ge(r.project)?this.createInLocal({...t,uuid:r.project}):this.createInCloud(t))}catch(s){return{success:!1,message:s.message}}}async createInLocal(t){let{uuid:s,data:r,options:i={}}=t,n=await this.createDataInLocal(s,r,i);return n.success===!1?{success:!1,code:n.code,message:n.message}:{success:!0,result:n.result}}getCreateData(t,s,r,i,n){let a=i.createBoard&&{title:s},o=i.createSchematic&&{projectId:t,name:s},c=i.createSheet&&{...i.createSheet,projectId:t,docType:Ne.SCH},l=i.createPcb&&{title:s,projectId:t,docType:Ne.PCB},u=i.createBlockSymbol&&Object.assign(r,{docType:Ne.BLOCK_SYMBOL,path:n,project_uuid:t,custom_tags:JSON.stringify(r.tags)});return{createBoard:a,createSchematic:o,createSheet:c,createPcb:l,createComponent:u}}async createDataInLocal(t,s,r){try{let i=s.title,n={projectId:t,title:i},{createBoard:a,createSchematic:o,createSheet:c,createPcb:l,createComponent:u}=this.getCreateData(t,i,s,r,t),h={createBoard:a,createSchematic:o,createSheet:c,createPcb:l,createComponent:u},p=await new Cn(t).create(h);if(p.success===!1)return{success:!1,code:p.code,message:p.message};let d=p.result.boards||null,f=p.result.schematic||null,m=p.result.sheet||null,g=p.result.pcb||null,b=p.result.component||null;return{success:!0,result:Object.assign(n,{boards:d,schematic:f,sheet:m,pcb:g,blockSymbol:b})}}catch(i){return{success:!1,message:i.message}}}async createInCloud(t){let{data:s,options:r={}}=t,i=await new Pr().project(r.project);if(i.success===!1)return{success:!1,code:i.code,message:i.message};let n=i.result.project.uuid,a=await this.createDataInCloud(n,s,r);return a.success===!1?{success:!1,code:a.code,message:a.message}:{success:!0,result:a.result}}async createDataInCloud(t,s,r){try{let i=s.title,n={projectId:t,title:i},a=s.path||t,{createBoard:o,createSchematic:c,createSheet:l,createPcb:u,createComponent:h}=this.getCreateData(t,i,s,r,a),p={createBoard:o,createSchematic:c,createSheet:l,createPcb:u,createComponent:h},d=await new Pr(t).create(t,p);if(d.success===!1)return{success:!1,code:d.code,message:d.message};let f=d.result.boards||null,m=d.result.schematic||null,g=d.result.sheet||null,b=d.result.pcb||null,E=d.result.component||null;return{success:!0,result:Object.assign(n,{boards:f,schematic:m,sheet:g,pcb:b,blockSymbol:E})}}catch(i){return{success:!1,message:i.message}}}async getExport(t){try{return t!=null&&t.data?new fh(t).getExport():t!=null&&t.title?new ph(t).getExport():rf(t.fromLibUuid)?await JT(t):new dh(t).getExport()}catch(s){return{success:!1,message:s.message}}}async flow(t){try{if(t!=null&&t.data)return new fh(t).flow();if(t!=null&&t.title)return new ph(t).flow();if(rf(t.fromLibUuid))throw new Error("Api call error!");return new dh(t).flow()}catch(s){return{success:!1,message:s.message}}}async getTarget(t){try{return t!=null&&t.data?new fh(t).getTarget():t!=null&&t.title?new ph(t).getTarget():rf(t.fromLibUuid)?await tx(t):new dh(t).getTarget()}catch(s){return{success:!1,message:s.message}}}async list(t){try{let{isProject:s,path:r}=t;if(s){let n=await X(r).symbol.getArrDataByType(!0);return n.success?{success:!0,result:n.result}:{success:!1,message:n.message}}else{let i=await se.getInstance().project.list(Object.assign(t,{isCbb:!0,user_uuid:r}));return i.success===!1?{success:!1,message:i.message}:{success:!0,result:i.result}}}catch(s){return{success:!1,message:s.message}}}async place(t){let{projectId:s,cbb:r}=t;try{let i=X(s),{project_uuid:n}=r;if(n===s){let{uuid:a}=r,o=await i.symbol.getData(a);return o.success?{success:!0,result:o.result}:{success:!1,message:"Failed to get the blockSymbol data!"}}else{console.time("CBB PLACE");let{title:a,display_title:o,docType:c,owner:l,byUUID:u,byVersion:h,bySource:p,fixCBB:d,fixLib:f}=r,m=Mt(o||a);console.time("CBB PLACE getTarget"),console.timeEnd("CBB PLACE getTarget");let g;if(rf(r.fromLibUuid)?g=await this.getTarget({uuid:r.project_uuid,fromLibUuid:r.fromLibUuid}):g=await this.getTarget({uuid:n}),g.success===!1)return{success:!1,code:g.code,message:g.message};let b=g.result,{symbols:E}=g.result;console.time("CBB PLACE getEmptyBlockSymbol");let y,T=E.some(D=>D.title===m);if(c!==Ne.SCH&&c!==Ne.PCB&&c!==Ne.BLOCK_SYMBOL&&!T){let D=await this.getEmptyBlockSymbol({title:m,display_title:o,owner:l,project_uuid:n});y=D.uuid,b.symbols.push(D)}console.timeEnd("CBB PLACE getEmptyBlockSymbol"),console.time("CBB PLACE ImportTarget");let w={uuid:s,byUUID:u,byVersion:h,bySource:p,fixCBB:d,fixLib:f},S=await i.project.import({datas:b,...w});if(S.success===!1)return{success:!1,code:S.code,message:S.message};console.timeEnd("CBB PLACE ImportTarget"),console.time("CBB PLACE getData");let{map:_,attrs:C}=S.result,x={map:_,attrs:C,newBlockSymbol:null};return y&&_.symbolMap[y]&&(x.newBlockSymbol=(await i.symbol.getData(_.symbolMap[y])).result),console.timeEnd("CBB PLACE getData"),console.timeEnd("CBB PLACE"),{success:!0,result:x}}}catch(i){return{success:!1,message:i.message}}}async getEmptyBlockSymbol(t){let s=at(),{title:r,display_title:i,owner:n,project_uuid:a}=t,o=new Date().getTime();return{uuid:s,title:r,display_title:i,docType:Ne.BLOCK_SYMBOL,creator:n,createTime:o,modifier:n,updateTime:o,description:"",path:a,project_uuid:a,source:"",version:""}}};var sx=Ei(Vi()),qn=class e{static async get(t,s=10){try{let r=[];if(t.length){let i=new Headers;i.append(_i.ContentType,Si.Text);let n=t.map(a=>[a,{method:"GET",redirect:"error",headers:i}]);r=await rx(s,n,"blob")}return{success:!0,result:r}}catch(r){return{success:!1,message:r.message}}}static async read(t){let s={};for(let r in t){let i=t[r];if(typeof i=="string"&&f0.test(i)){let n=[];await(0,sx.flowRead)(i,{update:o=>{n.push(o)}}),s[r]=eg(n)}else s[r]=i}return s}static async upload(t,s,r,i){try{let n=[],a=[],o={},c=[];for(let p in t){let d=t[p];typeof d=="string"&&(o[p]=c.length,c.push(d))}let l=[],u,h=c.length&&await e.get(c);(h==null?void 0:h.success)===!0&&(u=h.result);for(let p in t){let d=t[p];if(typeof d=="string"){let f=u==null?void 0:u[o[p]];f?(i=i+1,l.push({uuid:p,projectId:s,branchUuid:r,ticket:i,blob:f})):a.push(p)}else d instanceof Blob?(i=i+1,l.push({uuid:p,projectId:s,branchUuid:r,ticket:i,blob:d})):a.push(p)}if(l.length){let d=se.getInstance().project,f=await pl(10,d.uploadThumbs.bind(d),l);for(let m=0;m<f.length;m++)f[m].success===!1?a.push(l[m].uuid):n.push(l[m].uuid)}return{success:!0,result:{succeed:n,failed:a}}}catch(n){return{success:!1,message:n.message}}}};var ix=Ei(Vi());async function pc(e){try{let{config:t,images:s={}}=e,{name:r,cbb_project:i,introduction:n="",description:a="",tags:o=[]}=t,c=new tf(9);console.time("buildProjectZip3 Thumb.get"),c.addFolder(Gt.IMAGE);let l=[],u=[];for(let E in s){let y=s[E];if(typeof y=="string")l.push(E),u.push(y);else if(y instanceof Blob){let{data:T}=await uc(y),w=`${Gt.IMAGE}/${E+Kt.IMAGE}`;c.addFile(w),c.appendData(w,new Uint8Array(T))}}let h=await qn.get(u);if(h.success===!0)for(let E=0;E<h.result.length;E++){let y=h.result[E],T=l[E],{data:w}=await uc(y),S=`${Gt.IMAGE}/${T+Kt.IMAGE}`;c.addFile(S),c.appendData(S,new Uint8Array(w))}console.timeEnd("buildProjectZip3 Thumb.get"),console.time("buildProjectZip3 getEditorMainVersion");let p=self.PRO_EDITOR_VERSION||"";console.timeEnd("buildProjectZip3 getEditorMainVersion");let d=JSON.stringify(await CS({tags:o})),f={uuid:this.uuid,title:r,cbb_project:i,editorVersion:p,introduction:n,description:a,tags:d},m="project2.json";c.addFile(m),c.appendData(m,new Uint8Array(new Uint8Array(hi(JSON.stringify(f,null,2))))),console.time("buildProjectZip3 zipSync");let g=r.replace(/[\\/]/g,"_");if(e.dataStr){let E=g+Kt.EPRU;c.addFile(E),c.appendData(E,hi(e.dataStr))}else if(e.channelId){let E=g+Kt.EPRU;c.addFile(E);let y=T=>{c.appendData(E,typeof T=="string"?hi(T):T)};await(0,ix.flowRead)(e.channelId,{update:y})}let b=await c.blob();return console.timeEnd("buildProjectZip3 zipSync"),{success:!0,result:{blob:b,suffix:Kt.PRJ2}}}catch(t){return{success:!1,message:t.message}}}async function KT(e){let t={schematics:{},pcbs:{},panels:{},symbols:{},footprints:{},devices:{},boards:{},pcbData:{},config:{}},s=new tf(9);try{console.time("buildProjectZip2 handleSchs"),r(e),console.timeEnd("buildProjectZip2 handleSchs"),console.time("buildProjectZip2 handlePcbs"),i(e),console.timeEnd("buildProjectZip2 handlePcbs"),console.time("buildProjectZip2 handlePanels"),n(e),console.timeEnd("buildProjectZip2 handlePanels"),console.time("buildProjectZip2 handleSymbols"),a(e),console.timeEnd("buildProjectZip2 handleSymbols"),console.time("buildProjectZip2 handleFootprints"),o(e),console.timeEnd("buildProjectZip2 handleFootprints"),console.time("buildProjectZip2 handleDevices"),c(e),console.timeEnd("buildProjectZip2 handleDevices"),console.time("buildProjectZip2 handleInstances"),await l(e),console.timeEnd("buildProjectZip2 handleInstances"),console.time("buildProjectZip2 handleCoppers"),u(e),console.timeEnd("buildProjectZip2 handleCoppers"),console.time("buildProjectZip2 handleFonts"),h(e),console.timeEnd("buildProjectZip2 handleFonts"),console.time("buildProjectZip2 handleBlobs"),p(e),console.timeEnd("buildProjectZip2 handleBlobs"),console.time("buildProjectZip2 handleImages"),d(e),console.timeEnd("buildProjectZip2 handleImages"),console.time("buildProjectZip2 handleJSON"),await f(e),console.timeEnd("buildProjectZip2 handleJSON"),console.time("buildProjectZip2 zipSync");let b=await s.blob();return console.timeEnd("buildProjectZip2 zipSync"),{success:!0,result:{blob:b,suffix:Kt.PRJ}}}catch(b){return{success:!1,message:b.message}}function r(b){let E=b.schematics;s.addFolder(Gt.SHEET);for(let y in E){let T=E[y],w=T.sheets||[],S=w.map(_=>({name:_.display_title||_.title,id:_.sheet_id,uuid:_.uuid,source:_.source||"",version:_.version||"",thumb:_.thumb||""}));t.schematics[y]={name:T.display_name||T.name,source:T.source||"",version:T.version||"",sheets:S};for(let _ of w){let{sheet_id:C,dataStr:x}=_,D=`${Gt.SHEET}/${y}/${C+Kt.SCH}`;s.addFile(D),s.appendData(D,hi(x))}}}function i(b){let E=b.pcbs;s.addFolder(Gt.PCB);for(let y of E){let{uuid:T,dataStr:w}=y;t.pcbs[T]={title:y.display_title||y.title,source:y.source||"",version:y.version||"",thumb:y.thumb||""},y!=null&&y.parent_uuid&&(t.pcbData[T]={parent_uuid:y.parent_uuid});let S=`${Gt.PCB}/${T+Kt.PCB}`;s.addFile(S),s.appendData(S,hi(w))}}function n(b){let E=b.panels;s.addFolder(Gt.PANEL);for(let y of E){let{uuid:T,dataStr:w}=y;t.panels[T]=y.display_title||y.title;let S=`${Gt.PANEL}/${T+Kt.PANEL}`;s.addFile(S),s.appendData(S,hi(w))}}function a(b){let E=b.symbols.concat(b.block_symbol);s.addFolder(Gt.SYMBOL);for(let y of E){let{uuid:T,dataStr:w}=y;t.symbols[T]={uuid:T,source:y.source,desc:y.description,title:y.display_title||y.title,version:y.version,type:y.docType,custom_tags:y.custom_tags};let S=`${Gt.SYMBOL}/${T+Kt.SYMBOL}`;s.addFile(S),s.appendData(S,hi(w))}}function o(b){let E=b.footprints;s.addFolder(Gt.FOOTPRINT);for(let y of E){let{uuid:T,dataStr:w}=y;t.footprints[T]={title:y.display_title||y.title,source:y.source,version:y.version,type:y.docType,desc:y.description,custom_tags:y.custom_tags};let S=`${Gt.FOOTPRINT}/${T+Kt.FOOTPRINT}`;s.addFile(S),s.appendData(S,hi(w))}}function c(b){let E=b.devices;for(let y of E){let{uuid:T}=y;t.devices[T]={title:y.display_title||y.title,attributes:y.attributes,description:y.description,images:y.images,source:y.source,version:y.version,custom_tags:y.custom_tags}}}async function l(b){let E=b.block_symbol_attribute;s.addFolder(Gt.INSTANCE);for(let y of E){let{path:T,attr:w}=y,S=[];S.push(JSON.stringify(["DOCTYPE","INSTANCE","1.0"])),S.push(`
`),S.push(JSON.stringify(["OVERRIDE",T.split("_"),w]));let _=btoa(T),{data:C}=await uc(new Blob(S)),x=`${Gt.INSTANCE}/${_+Kt.INSTANCE}`;s.addFile(x),s.appendData(x,new Uint8Array(C))}}function u(b){let E=b.coppers;s.addFolder(Gt.POUR);for(let y of E){let{path:T,dataStr:w}=y,S=`${Gt.POUR}/${btoa(T)+Kt.COPPER}`;s.addFile(S),s.appendData(S,hi(w))}}function h(b){let E=b.coppers;s.addFolder(Gt.FONT);for(let y of E){let{path:T,dataStr:w}=y,S=`${Gt.FONT}/${btoa(T)+Kt.FONT}`;s.addFile(S),s.appendData(S,hi(w))}}function p(b){let E=b.blobs;s.addFolder(Gt.BLOB);for(let y of E){let{hash:T,dataStr:w}=y,S=`${Gt.BLOB}/${btoa(T)+Kt.BLOB}`;s.addFile(S),s.appendData(S,hi(w))}}async function d(b){let{images:E={}}=b;s.addFolder(Gt.IMAGE);let y=[],T=[];for(let S in E){let _=E[S];if(typeof _=="string")y.push(S),T.push(_);else if(_ instanceof Blob){let{data:C}=await uc(_),x=`${Gt.IMAGE}/${S+Kt.IMAGE}`;s.addFile(x),s.appendData(x,new Uint8Array(C))}}let w=await qn.get(T);if(w.success===!0)for(let S=0;S<w.result.length;S++){let _=w.result[S],C=y[S],{data:x}=await uc(_),D=`${Gt.IMAGE}/${C+Kt.IMAGE}`;s.addFile(D),s.appendData(D,new Uint8Array(x))}}async function f(b){m(b),await g(b);let E="project.json";s.addFile(E),s.appendData(E,hi(JSON.stringify(t,null,2)))}function m(b){let E=b.boards;for(let y of E){let{name:T,sch:w,pcb:S}=y;t.boards[T]={schematic:w,pcb:S}}}async function g(b){let E=self.PRO_EDITOR_VERSION||"";t.config={title:b.name,cbbProject:b.cbb_project,defaultSheet:b.default_sheet,editorVersion:E}}}var Al=class{constructor(t){let{uuid:s,data:r,suffix:i,progressOptions:n={}}=t,a={needProgress:!0,progressTip:"Export zip...",total:2,...n};this.uuid=s,this.data=r,this.suffix=i,this.progress=new qs(a)}async zip(t={}){if(t.progress&&(this.progress=t.progress),!this.data){console.time("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u65E5\u5FD7");let a=await this.getData({progress:this.progress});if(console.timeEnd("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u65E5\u5FD7"),a.success===!1)return this.onfailed(),{success:!1,code:a.code,message:a.message};this.data=a.result}this.progress.update(),console.time("\u5DE5\u7A0B\u6253\u5305: \u5DE5\u7A0B\u65E5\u5FD7\u6253\u5305\u6210 ZIP");let s=await this.getZip(this.data);if(console.timeEnd("\u5DE5\u7A0B\u6253\u5305: \u5DE5\u7A0B\u65E5\u5FD7\u6253\u5305\u6210 ZIP"),s.success===!1)return this.onfailed(),{success:!1,code:s.code,message:s.message};this.progress.update();let{blob:r,suffix:i}=s.result,n=this.data.config;return this.onsuccess(),{success:!0,result:{blob:r,config:n,suffix:i}}}async flow(t={}){if(t.progress&&(this.progress=t.progress),!this.data){console.time("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u65E5\u5FD7");let a=await this.flowData({progress:this.progress});if(console.timeEnd("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u65E5\u5FD7"),a.success===!1)return this.onfailed(),{success:!1,code:a.code,message:a.message};this.data=a.result}this.progress.update(),console.time("\u5DE5\u7A0B\u6253\u5305: \u5DE5\u7A0B\u65E5\u5FD7\u6253\u5305\u6210 ZIP");let s=await this.flowZip(this.data);if(console.timeEnd("\u5DE5\u7A0B\u6253\u5305: \u5DE5\u7A0B\u65E5\u5FD7\u6253\u5305\u6210 ZIP"),s.success===!1)return this.onfailed(),{success:!1,code:s.code,message:s.message};this.progress.update();let{blob:r,suffix:i}=s.result,n=this.data.config;return this.onsuccess(),{success:!0,result:{blob:r,config:n,suffix:i}}}async blob(t=!0){try{let s;if(t){console.time("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u6587\u4EF6\u7684 flowZip");let a=await this.flow();if(console.timeEnd("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u6587\u4EF6\u7684 flowZip"),a.success===!1)return this.onfailed(),{success:!1,code:a.code,message:a.message};s=a.result}else{console.time("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u6587\u4EF6\u7684 zip");let a=await this.zip();if(console.timeEnd("\u5DE5\u7A0B\u6253\u5305: \u83B7\u53D6\u5DE5\u7A0B\u6587\u4EF6\u7684 zip"),a.success===!1)return this.onfailed(),{success:!1,code:a.code,message:a.message};s=a.result}let{blob:r,config:i,suffix:n}=s;return console.time("\u5DE5\u7A0B\u6253\u5305: JS ZIP \u538B\u7F29: zip.generateAsync"),console.timeEnd("\u5DE5\u7A0B\u6253\u5305: JS ZIP \u538B\u7F29: zip.generateAsync"),this.onsuccess(),{success:!0,result:{blob:r,config:i,suffix:n}}}catch(s){return{success:!1,message:s.message}}}async file(t={}){try{let{name:s,flow:r}=t,i=await this.blob(r);if(i.success===!1)return this.onfailed(),{success:!1,code:i.code,message:i.message};let{blob:n,config:a,suffix:o}=i.result,c=this.encodeTitle(s||a.name),l=t.suffix||o||Kt.PRJ2,u=gh?await h0(n,gh):n;yh("",null);let h=new File([u],c+l,{type:"zip"});return this.onsuccess(),{success:!0,result:{file:h,config:a,title:c}}}catch(s){return{success:!1,message:s.message}}}encodeTitle(t){let s=/[%<>:"\/\\|?*#\x00-\x1F]/g;return t.replace(s,r=>r==="*"?"%2A":encodeURIComponent(r))}onsuccess(){this.progress.update(!0)}onfailed(){this.progress.update(!0)}};var XU=[mt.SCHEMATIC,mt.SHEET,mt.SYMBOL,mt.ATTR,mt.PCB,mt.PANEL,mt.DEVICE,mt.FOOTPRINT,mt.BLOB,mt.COPPER,mt.FONT];function nx(e,t){let s=[],r=[];for(let i of e){if(!i)continue;let n=ZU(i);if(!n)continue;let[a,o]=n,{source:c,uuid:l,title:u}=o,[h,p]=c.split(Rs);if(t.indexOf(h)<0){r.push(u);continue}let d={display_title:u,title:Mt(u),source:c,uuid:l,dataStr:i};s.push(d)}return{customFootprints:s,lostTemplate:r}}function ZU(e){let t=/\["HEAD".+/,s=e.match(t);if(s){let r=s[0];return JSON.parse(r)}else return null}var S0=Ei(Vi());var fc=class{static board(t){return{uuid:t.uuid,title:t.title,zIndex:t.zIndex}}static panel(t){return{uuid:t.uuid,title:t.title,zIndex:t.zIndex,docType:t.docType}}static pcb(t){return{uuid:t.uuid,title:t.title,board:t.board,zIndex:t.zIndex,docType:t.docType,parent_uuid:t.parent,source:t.source,version:t.version,updateTime:t.updateTime}}static schematic(t){return{uuid:t.uuid,name:t.title,board:t.board,source:t.source,version:t.version,updateTime:t.updateTime}}static sheet(t){return{uuid:t.uuid,title:t.title,schematic_uuid:t.schematic,docType:t.docType,zIndex:t.zIndex,source:t.source,version:t.version,updateTime:t.updateTime}}static blockSymbol(t){return{uuid:t.uuid,title:t.title,docType:t.docType,source:t.source,version:t.version,updateTime:t.updateTime}}};function T0(e,t){let s={boards:{},schematics:{},sheets:{},pcbs:{},panels:{},blockSymbols:{},owner:t};for(let r in e.boards){let i=e.boards[r];s.boards[r]=fc.board(i)}for(let r in e.schematics){let i=e.schematics[r];s.schematics[r]=fc.schematic(i)}for(let r in e.sheets){let i=e.sheets[r];s.sheets[r]=fc.sheet(i)}for(let r in e.pcbs){let i=e.pcbs[r];s.pcbs[r]=fc.pcb(i)}for(let r in e.panels){let i=e.panels[r];s.panels[r]=fc.panel(i)}for(let r in e.symbols){let i=e.symbols[r];i.docType===Ss.BLOCK_SYMBOL&&(s.blockSymbols[r]=fc.blockSymbol(i))}return s}var Yi=class{constructor(t){this.logger=new kc(Bc.WARN);this.text="Conversion project format failed!";this.needDlg=!0;this.createStructure=!0;this.map={};this.symbolPartMap={};this.maxTicket=0;let{datas:s,info:r,options:i={},progressOptions:n={}}=t;this.datas=this.format(s),this.info=r,this.options={createProject:!1,getProject:!1,deleteProject:!0,...i},this.needDlg=this.options.needDlg||!0,this.createStructure=this.options.createStructure||!0,this.needConfig=this.options.needConfig||!0,this.branchData=this.options.branchData,this.keepTime=this.options.keepTime||!1;let a=this.count(),o={needProgress:!0,progressTip:"Convert Project...",total:a,...n};this.progress=new qs(o),this.encoder=new Gi}format(t){return t.schematics=t.schematics||{},t.symbols=t.symbols||[],t.block_symbol=t.block_symbol||[],t.block_symbol_attribute=t.block_symbol_attribute||[],t.footprints=t.footprints||[],t.devices=t.devices||[],t.pcbs=t.pcbs||[],t.panels=t.panels||[],t.blobs=t.blobs||[],t.coppers=t.coppers||[],t.boards=t.boards||[],t.fonts=t.fonts||[],t}count(){let t=Object.values(this.datas.schematics).reduce((r,i)=>{var n;return r+((n=i.sheets)==null?void 0:n.length)||0},0);return 3+this.datas.boards.length+Object.keys(this.datas.schematics).length+t+this.datas.pcbs.length+this.datas.panels.length+this.datas.devices.length+this.datas.symbols.length+this.datas.block_symbol.length+this.datas.footprints.length+this.datas.blobs.length+this.datas.block_symbol_attribute.length}async onpreprocess(){await this.fixCbb(),await this.fixLib()}async fixCbb(){let t=String(this.time);for(let s in this.datas.schematics){let r=this.datas.schematics[s];await Ln({data:r,defalut:t,force:!1});let{sheets:i}=r;for(let n=0;n<i.length;n++){let a=i[n];await Ln({data:a,defalut:t,force:!1})}}for(let s=0;s<this.datas.pcbs.length;s++){let r=this.datas.pcbs[s];await Ln({data:r,defalut:t,force:!1})}for(let s=0;s<this.datas.block_symbol.length;s++){let r=this.datas.block_symbol[s];await Ln({data:r,defalut:t,force:!1})}}async fixLib(){let t=String(this.time),s={},r={device:{},symbol:{},footprint:{}};for(let i=0;i<this.datas.symbols.length;i++){let n=this.datas.symbols[i];s[n.uuid]=n.docType,n.version===r.symbol[n.source]?await Gm(n):n.source&&(r.symbol[n.source]=n.version),await Ln({data:n,defalut:t}),Ym(n,ud.Symbol)}for(let i=0;i<this.datas.footprints.length;i++){let n=this.datas.footprints[i];s[n.uuid]=n.docType,n.version===r.footprint[n.source]?await Gm(n):n.source&&(r.footprint[n.source]=n.version),await Ln({data:n,defalut:t}),Ym(n,ud.Footprint)}for(let i=0;i<this.datas.devices.length;i++){let n=this.datas.devices[i];n.symbol_type=n.attributes.Symbol&&s[n.attributes.Symbol],n.footprint_type=n.attributes.Footprint&&s[n.attributes.Footprint],n.version===r.device[n.source]?await Gm(n):n.source&&(r.device[n.source]=n.version),await Ln({data:n,defalut:t}),Ym(n,ud.Device),NI(n)}}async start(t={}){try{console.time("convert project"),t.progress&&(this.progress=t.progress);let s=[];console.time("convert project getServerTime"),this.time=await Ht(),console.timeEnd("convert project getServerTime"),console.time("convert project getLoginUser"),this.user=await fi(),console.timeEnd("convert project getLoginUser"),console.time("convert project onpreprocess"),await this.onpreprocess(),console.timeEnd("convert project onpreprocess"),this.progress.update(),console.time("convert project init");let r=await this.init();if(r.success===!1)return this.onfailed(),{success:!1,code:r.code,message:this.getMessage(r.message),args:{uuid:this.uuid}};console.timeEnd("convert project init"),console.time("convert project createBoard");let{result:i,sch2Board:n,pcb2Board:a}=this.createBoard();s.push(...i),console.timeEnd("convert project createBoard"),console.time("convert project createSchematic");let{result:o,schematicMap:c,sid2Sheets:l}=this.createSchematic(n);s.push(...o),console.timeEnd("convert project createSchematic"),console.time("convert project createSymbol");let{result:u}=await this.createSymbol();s.push(...u),console.timeEnd("convert project createSymbol"),console.time("convert project createSheet");let{result:h,pathMap:p,gidMap:d}=await this.createSheet(l,c);s.push(...h),console.timeEnd("convert project createSheet"),console.time("convert project createPcb");let{result:f,customFootprints:m}=await this.createPcb(a);s.push(...f),console.timeEnd("convert project createPcb"),console.time("convert project createFootprint");let{result:g}=await this.createFootprint(m);s.push(...g),console.timeEnd("convert project createFootprint"),console.time("convert project createDevice");let{result:b}=await this.createDevice();s.push(...b),console.timeEnd("convert project createDevice"),console.time("convert project createPanel");let{result:E}=await this.createPanel();s.push(...E),console.timeEnd("convert project createPanel"),console.time("convert project createAttr");let{result:y}=await this.createAttr(p,d);s.push(...y),console.timeEnd("convert project createAttr"),console.time("convert project createBlob");let{result:T}=await this.createBlob();s.push(...T),console.timeEnd("convert project createBlob"),console.time("convert project createVariant");let{result:w}=await this.createVariant();if(s.push(...w),console.timeEnd("convert project createVariant"),this.needConfig){console.time("convert project createConfig");let{result:C}=this.createConfig(this.project);s.push(...C),console.timeEnd("convert project createConfig")}let S=s.join(Le),_={map:this.map,dataStr:[S]};if(this.uuid){console.time("convert project upload");let C=await this.getBranch();if(C.success===!1){let I={uuid:this.uuid};return Wm(C.code)&&(I.dataStr=s),ze("warn",this.getMessage(C.message)),{success:!1,code:C.code,message:C.message,args:I}}let x=C.result,D=await this.upload(x,[S]);if(D.success===!1){this.onfailed();let I={uuid:this.uuid};return Wm(D.code)&&(I.dataStr=s),{success:!1,code:D.code,message:D.message,args:I}}_.project=this.project,_.branchData=x,this.onsuccess(),console.timeEnd("convert project upload")}else this.onsuccess();return console.timeEnd("convert project"),{success:!0,result:_}}catch(s){return this.onfailed(),{success:!1,message:this.getMessage(s.message),args:{uuid:this.uuid}}}}async flow(t={},s){try{t.progress&&(this.progress=t.progress),console.time("convert project getServerTime"),this.time=await Ht(),console.timeEnd("convert project getServerTime"),console.time("convert project getLoginUser"),this.user=await fi(),console.timeEnd("convert project getLoginUser"),console.time("convert project onpreprocess"),await this.onpreprocess(),console.timeEnd("convert project onpreprocess"),this.progress.update(),console.time("convert project init");let r=await this.init();if(r.success===!1)return this.onfailed(),{success:!1,code:r.code,message:this.getMessage(r.message),args:{uuid:this.uuid}};console.timeEnd("convert project init");let i=at();return(0,S0.flowWrite)(i,async n=>{let a=0;console.time("convert project createBoard");let{result:o,sch2Board:c,pcb2Board:l}=this.createBoard();await this.writeData(n,o),a+=o.length,console.timeEnd("convert project createBoard"),console.time("convert project createSchematic");let{result:u,schematicMap:h,sid2Sheets:p}=this.createSchematic(c);a&&u.length&&await this.writeCharacter(n),await this.writeData(n,u),a+=u.length,console.timeEnd("convert project createSchematic"),console.time("convert project createSymbol");let{result:d}=await this.createSymbol();a&&d.length&&await this.writeCharacter(n),await this.writeData(n,d),a+=d.length,console.timeEnd("convert project createSymbol"),console.time("convert project createSheet");let{result:f,pathMap:m,gidMap:g}=await this.createSheet(p,h);a&&f.length&&await this.writeCharacter(n),await this.writeData(n,f),a+=f.length,console.timeEnd("convert project createSheet"),console.time("convert project createPcb");let{result:b,customFootprints:E}=await this.createPcb(l);a&&b.length&&await this.writeCharacter(n),await this.writeData(n,b),a+=b.length,console.timeEnd("convert project createPcb"),console.time("convert project createFootprint");let{result:y}=await this.createFootprint(E);a&&y.length&&await this.writeCharacter(n),await this.writeData(n,y),a+=y.length,console.timeEnd("convert project createFootprint"),console.time("convert project createDevice");let{result:T}=await this.createDevice();a&&T.length&&await this.writeCharacter(n),await this.writeData(n,T),a+=T.length,console.timeEnd("convert project createDevice"),console.time("convert project createPanel");let{result:w}=await this.createPanel();a&&w.length&&await this.writeCharacter(n),await this.writeData(n,w),a+=w.length,console.timeEnd("convert project createPanel"),console.time("convert project attrs");let{result:S}=await this.createAttr(m,g);a&&S.length&&await this.writeCharacter(n),await this.writeData(n,S),a+=S.length,console.timeEnd("convert project attrs"),console.time("convert project createBlob");let{result:_}=await this.createBlob();a&&_.length&&await this.writeCharacter(n),await this.writeData(n,_),a+=_.length,console.timeEnd("convert project createBlob"),console.time("convert project createVariant");let{result:C}=await this.createVariant();if(a&&C.length&&await this.writeCharacter(n),await this.writeData(n,C),a+=C.length,console.timeEnd("convert project createVariant"),this.needConfig){console.time("convert project createConfig");let{result:x}=this.createConfig(this.project);a&&x.length&&await this.writeCharacter(n),await this.writeData(n,x),a+=x.length,console.timeEnd("convert project createConfig")}s==null||s()}),{success:!0,result:i}}catch(r){return this.onfailed(),{success:!1,message:this.getMessage(r.message),args:{uuid:this.uuid}}}}async writeCharacter(t){await t.write(Le)}async writeData(t,s){for(let r=0;r<s.length;r++){let i=s[r];r!==s.length-1?await t.write(i+Le):await t.write(i)}}async flowWrite(t={}){t.progress&&(this.progress=t.progress);let s=()=>{},r=await this.flow(t,s);if(r.success===!1)return this.progress.update(!0),{success:!1,code:r.code,message:r.message};let i=r.result;return this.progress.update(!0),{success:!0,result:i}}async flowUpload(t={}){var s;try{t.progress&&(this.progress=t.progress),console.time("convert project");let r=await this.flow(t);if(r.success===!1)return this.onfailed(),{success:!1,code:r.code,message:r.message};let i=r.result,n={map:this.map,channelId:i};if(!this.uuid)return this.onfailed(),{success:!1,message:"Missing project id!"};console.time("convert project upload");let a=await this.getBranch();if(a.success===!1){let g={uuid:this.uuid};return Wm(a.code)&&(g.channelId=i),this.onfailed(),ze("warn",this.getMessage(a.message)),{success:!1,code:a.code,message:a.message,args:g}}let o=a.result,c=this.createStructure?new bo:null;(s=c==null?void 0:c.setNotCanvas)==null||s.call(c,!0);let l=this.createStructure?c.flowParseFull():null,u=[],h="",p=new dl;p.onChunk(g=>{u.push(se.getInstance().projectHistory.set({projectId:this.uuid,branchData:o,dataStr:g}))}),await(0,S0.flowRead)(i,{update:g=>{p.push(g),l==null||l.update(g),h+=g}}),p.end(),l==null||l.end();let m=(await Promise.all(u)).filter(g=>g.success===!1);if(m&&m.length){this.onfailed();let g={uuid:this.uuid};return h&&h.length&&(g.dataStr=[h]),console.error("The upload of the project log failed!",m),{success:!1,code:m[0].code,message:"The upload of the project log failed!",args:g}}return n.project=this.project,n.branchData=o,l&&await this.buildStructure(c.getProject(),this.info.owner,o.uuid),this.onsuccess(),console.timeEnd("convert project upload"),console.timeEnd("convert project"),{success:!0,result:n}}catch(r){return this.onfailed(),{success:!1,message:this.getMessage(r.message),args:{uuid:this.uuid}}}}async buildStructure(t,s,r){let i=T0(t,s),n={uuid:this.uuid,datas:i,ticket:Bs.TICKET,branch_uuid:r},a=await se.getInstance().project.setProfile(n);console.log("setProfile...........",a),a&&!(a!=null&&a.success)&&ze("warn",["Project tree structure generation failed!"])}async init(){try{if(this.options.createProject){let t=await this.createProject();if(t.success===!1)return{success:!1,code:t.code,message:t.message};this.project=t.result.project,this.branchData=t.result.branchData}else if(this.options.getProject){let t=await this.getProject();if(t.success===!1)return{success:!1,code:t.code,message:t.message};this.project=t.result}else this.project={};return this.uuid=this.project.uuid,this.client=crypto.randomUUID(),{success:!0}}catch(t){return{success:!1,message:t.message}}}async createProject(){try{let{owner:t,name:s,content:r="",tags:i,public:n,editorVersion:a,mode:o,project_path:c,path:l,ownerSelectId:u}=this.info,h=this.datas.default_sheet,p=this.datas.cbb_project,d=r,f=t.uuid,m={name:s,user_uuid:f,cbb_project:p,description:d,public:n,editorVersion:a,tags:i,default_sheet:h,mode:o,project_path:c,path:l,ownerSelectId:u},g=await new Pr().create(m,{createConfig:!1});return g.success===!1?{success:!1,code:g.code,message:g.message}:(this.progress.update(),{success:!0,result:g.result})}catch(t){return{success:!1,message:t.message}}}async getProject(){try{let t="Failed to get historical project data!",s=this.datas.uuid;if(!s)return{success:!1,message:[t,`invalid null value! ${s}`]};let r=await se.getInstance().project.get(s);if(r.success===!1){let i=Array.isArray(r.message)?r.message:[r.message];return{success:!1,message:[t,...i]}}return{success:!0,result:r.result}}catch(t){return{success:!1,message:t.message}}}async getBranch(){try{if(!this.branchData){let t="Failed to get historical project data!",s=await se.getInstance().branch.create({projectId:this.uuid});if(s.success===!1){let r=Array.isArray(s.message)?s.message:[s.message];return{success:!1,code:s.code,message:[t,...r]}}this.branchData=s.result}return{success:!!this.branchData,result:this.branchData}}catch(t){return{success:!1,message:t.message}}}getCreateTime(t){if(this.keepTime){if(t.createtime||t.createTime)return Ke(Number(t.createtime||t.createTime));if(t.created_at)return Ke(Number(new Date(t.created_at)))}return this.time}getUpdateTime(t){if(this.keepTime){if(t.updateTime)return Ke(Number(t.updateTime));if(t.updated_at)return Ke(Number(new Date(t.updated_at)))}return this.time}createBoard(){try{let t=[],s={},r={},i=this.datas.boards,n=this.client;for(let a=0;a<i.length;a++){let o=i[a],c=[],{name:l,sch:u,pcb:h}=o,p=l,d=o.uuid||at(),f=d,m=a+1,g=++this.maxTicket,b=this.time;c.push(this.encoder.board.head({doc:f,client:n,updateTime:b,user:this.user,ticket:++this.maxTicket})),c.push(this.encoder.board.meta(g,{uuid:d,title:p,zIndex:m}));let E=c.join(Le);u&&(s[u]=d),h&&(r[h]=d),t.push(E),this.progress.update()}return{result:t,sch2Board:s,pcb2Board:r}}catch(t){throw new Error(t.message)}}createSchematic(t){try{let s=[],r={},i={},n=this.datas.schematics,a=this.client;for(let o in n){let c=n[o];this.project.cbb_project&&c.name===this.info.name&&(c.display_name=c.name=this.project.name);let l=o,u=c.display_name||c.name,h=t[o]||"",p=[],d=this.getCreateTime(c),f=this.getUpdateTime(c);p.push(this.encoder.schematic.head({doc:l,client:a,updateTime:d,version:c.version,user:this.user,ticket:++this.maxTicket})),p.push(this.encoder.schematic.head({doc:l,client:a,updateTime:f,version:c.version,user:this.user,ticket:++this.maxTicket}));let m=++this.maxTicket;p.push(this.encoder.schematic.meta(m,{...c,title:u,board:h,zIndex:null}));let g=p.join(Le);r[o]=o,i[o]={name:u,sheets:c.sheets},s.push(g),this.progress.update()}return this.map.schematicMap=r,{result:s,schematicMap:r,sid2Sheets:i}}catch(s){throw new Error(s.message)}}async createSheet(t,s){var r,i,n;try{let a=[],o=this.datas.block_symbol.map(f=>f.uuid),c={},l={},u={},h=[],p=[],d=this.client;for(let f in t){let m=t[f],g=m.sheets.map(T=>T),b=(i=(r=m.sheets)==null?void 0:r[0])!=null&&i.sheet_id?m.sheets.sort((T,w)=>T.sheet_id-w.sheet_id):m.sheets;if(!b.length)continue;let E=s[f],y=0;for(let T=0;T<b.length;T++){let w=b[T],S="";if(w.sheet_id&&w.sheet_id-y-1>0){let O={dataType:e0.META_PLACEHOLDER,max:w.sheet_id-y-1};S=Zt(e0.META_PLACEHOLDER,++this.maxTicket,E,JSON.stringify(O))}w.sheet_id&&(y=w.sheet_id);let{uuid:_}=w,C=w.display_title||w.title;if(!w.dataStr){h.push(C);continue}if(!Cl(w.dataStr,"['DOCTYPE','SCH'")){p.push(C);continue}let x=[],D=w.description||w.desc||"",I=_,P=w.sheet_id||T+1,L=g.findIndex(O=>O.uuid===w.uuid)+1,F=this.getCreateTime(w),V=this.getUpdateTime(w);x.push(this.encoder.sheet.head({doc:I,client:d,updateTime:F,version:w.version,user:this.user,ticket:++this.maxTicket})),x.push(this.encoder.sheet.head({doc:I,client:d,updateTime:V,version:w.version,user:this.user,ticket:++this.maxTicket})),S&&x.push(S);let B={...w,title:C,description:D,schematic:E,zIndex:L};x.push(this.encoder.sheet.meta(++this.maxTicket,B)),x.push(this.encoder.sheet.transform({doc:I,dataStr:w.dataStr,partIdMap:this.symbolPartMap,device:this.datas.devices,updateTime:V,version:w.version,user:this.user}));let k=x.join(Le);for(let O of o){let R=w.dataStr.replaceAll('"',"'").replaceAll(" ",""),v=new RegExp(`\\['COMPONENT','.+,'Symbol','${O}'`,"gims"),j=R.match(v);if(j!=null&&j.length){let M=j[0].match(/\['COMPONENT','e\d+'/gim);if(!M)continue;let q=(n=M[M.length-1].match(/e\d+/gim))==null?void 0:n[0];u[q]=O}}c[_]=_,l[`${E}${Ud}${P}`]=`${E}${Ud}${_}`,a.push(k),this.progress.update()}this.progress.update()}if(h.length){let f=await De("Sheet"),m=await De("File missing!");ze("warn",[f,h.join("\u3001"),m])}if(p.length){let f=await De("Sheet"),m=await De("The format of the {type} document is invalid",{type:f});ze("warn",[m,p.join("\u3001")])}return this.map.sheetMap=c,{result:a,sheetMap:c,pathMap:l,gidMap:u}}catch(a){throw new Error(a.message)}}async createPcb(t){try{let E=function(y,T,w,S){let{uuid:_}=y,C=[],x=y.display_title||y.title,D=y.description||y.desc||"",I=y.parent_uuid||"",P=_,L=t[_]||"",F=this.getCreateTime(y),V=this.getUpdateTime(y);C.push(this.encoder.pcb.head({doc:P,client:l,updateTime:F,version:y.version,user:this.user,ticket:++this.maxTicket})),C.push(this.encoder.pcb.head({doc:P,client:l,updateTime:V,version:y.version,user:this.user,ticket:++this.maxTicket}));let B={title:x,parent:I,board:L,zIndex:null,source:y.source},k=++this.maxTicket;C.push(this.encoder.pcb.meta(k,B));let O=w.map(M=>M.dataStr),R=y.dataStr,v={doc:P,dataStr:R,fonts:O,coppers:S,footprints:g,devices:b,updateTime:V,version:y.version,user:this.user};return C.push(this.encoder.pcb.transform(v)),C.join(Le)},s=[],r={},i=[],n=[],a=[],o=[],c=[],l=this.client,{pcbs:u,footprints:h,fonts:p,coppers:d}=this.datas,f=[],m=[];for(let y=0;y<u.length;y++){let T=u[y],w=T.display_title||T.title;if(!T.dataStr){n.push(w);continue}if(!Cl(T.dataStr,"['DOCTYPE','PCB'")&&!Cl(T.dataStr,"['DOCTYPE','FOOTPRINT'")){a.push(w);continue}let{dataStr:S,customFootprints:_}=this.split(T.dataStr);if(!S){n.push(w);continue}T.dataStr=S;let C=h.map(I=>I.uuid),{customFootprints:x,lostTemplate:D}=nx(_,C);i=i.concat(x),c=c.concat(D),this.project.cbb_project&&T.title===this.info.name&&(T.display_title=T.title=this.project.name),T.parent_uuid?m.push(T):f.push(T)}let g=this.datas.footprints.concat(i),b=this.datas.devices;for(let y=0;y<f.length;y++){let T=f[y],{uuid:w}=T,S=p.filter(x=>x.path.startsWith(w)),_=d.filter(x=>x.path.startsWith(w)),C=E.call(this,T,y,S,_);r[w]=w,s.push(C),this.progress.update()}for(let y=0;y<m.length;y++){let T=m[y],{uuid:w,display_title:S,title:_,parent_uuid:C}=T,x=S||_;if(!r[C]){o.push(x);continue}let D=p.filter(L=>L.path.startsWith(w)),I=d.filter(L=>L.path.startsWith(w)),P=E.call(this,T,y,D,I);r[w]=w,s.push(P),this.progress.update()}if(n.length){let y=await De("Pcb"),T=await De("File missing!");ze("warn",[y,n.join("\u3001"),T])}if(a.length){let y=await De("Pcb"),T=await De("The format of the {type} document is invalid",{type:y});ze("warn",[T,a.join("\u3001")])}if(c.length){let y=await De("Custom footprint lost template data!");ze("warn",[y,c.join("\u3001")])}if(o.length){let y=o.join("\u3001"),T=await De("Child PCB {title} lost the parent PCB!",{title:y});ze("warn",[T])}return this.map.pcbMap=r,{result:s,pcbMap:r,customFootprints:i}}catch(s){throw new Error(s.message)}}split(t){let s=t.split(jI),r=s.pop()||"",i=[];for(let n of s)n&&i.push(n);return{dataStr:r,customFootprints:i}}async createSymbol(){try{let p=function(d){let{uuid:f}=d,m=[],g=d.display_title||d.title,b=d.docType||d.type,E=f,y=d.description||d.desc||"",T=this.getCreateTime(d),w=this.getUpdateTime(d);return m.push(this.encoder.symbol.head({doc:E,client:h,updateTime:T,version:d.version,user:this.user,ticket:++this.maxTicket})),m.push(this.encoder.symbol.head({doc:E,client:h,updateTime:w,version:d.version,user:this.user,ticket:++this.maxTicket})),m.push(this.encoder.symbol.meta(++this.maxTicket,{...d,title:g,docType:b,description:y,tags:Hi(d.custom_tags)})),this.symbolPartMap[f]={},m.push(this.encoder.symbol.transform({doc:E,dataStr:d.dataStr,updateTime:w,version:d.version,user:this.user},this.symbolPartMap[f])),m.join(Le)},t=[],s={},r=[],i=[],n=[],a=[],o=this.datas.symbols.concat(this.datas.block_symbol),c=[],l=[];for(let d of o){let{uuid:f}=d,m=d.display_title||d.title;if(!d.dataStr){r.push(m);continue}if(!Cl(d.dataStr,"['DOCTYPE','SYMBOL'")){n.push(m);continue}d.docType===Ne.BLOCK_SYMBOL&&d.title===this.info.name&&(d.title=d.display_title=this.info.name,d.custom_tags=this.info.custom_tags,d.description=this.info.content),mc.test(f)?c.push(d):l.push(d)}let{datas:u}=await w0(l),h=this.client;for(let d of u){let{uuid:f}=d,m=p.call(this,d);s[f]=f,t.push(m),this.progress.update()}for(let d of c){let{uuid:f,source:m}=d,g=d.display_title||d.title,[b]=m.split(Rs);if(!s[b]){a.push(g);continue}d.source=`${s[b]}${Rs}${this.uuid}`;let E=p.call(this,d);s[f]=f,t.push(E),this.progress.update()}if(r.length){let d=await De("Symbol"),f=await De("File missing!");ze("warn",[d,r.join("\u3001"),f])}if(n.length){let d=await De("Symbol"),f=await De("The format of the {type} document is invalid",{type:d});ze("warn",[f,n.join("\u3001")])}if(i.length){let d=await De("The owning Sheet is missing");ze("warn",[d,":",i.join("\u3001")])}if(a.length){let d=await De("Custom symbol lost template data!");ze("warn",[d,a.join("\u3001")])}return this.map.symbolMap=s,{result:t,symbolMap:s}}catch(t){throw new Error(t.message)}}async createFootprint(t){try{let f=function(m){let{uuid:g}=m,b=[],E=m.display_title||m.title,y=g,T=m.description||m.desc||"",w=this.getCreateTime(m),S=this.getUpdateTime(m);b.push(this.encoder.footprint.head({doc:y,client:d,updateTime:w,version:m.version,user:this.user,ticket:++this.maxTicket})),b.push(this.encoder.footprint.head({doc:y,client:d,updateTime:S,version:m.version,user:this.user,ticket:++this.maxTicket}));let _={title:E,description:T,source:m.source,tags:Hi(m.custom_tags)};b.push(this.encoder.footprint.meta(++this.maxTicket,_));let C=this.datas.devices.some(x=>{var D;return((D=x==null?void 0:x.attributes)==null?void 0:D.Footprint)===m.uuid});return b.push(this.encoder.footprint.transform({doc:y,dataStr:m.dataStr,has_device:C,updateTime:S,version:m.version,user:this.user})),b.join(Le)},s=[],r={},i=[],n=[],a=[],o=[],c=this.map.pcbMap,l=this.datas.footprints.concat(t),u=[],h=[];for(let m of l){let{uuid:g}=m,b=m.display_title||m.title;if(!m.dataStr){i.push(b);continue}if(!Cl(m.dataStr,"['DOCTYPE','FOOTPRINT'")){n.push(b);continue}mc.test(g)?u.push(m):h.push(m)}let{datas:p}=await w0(h),d=this.client;for(let m of p){let{uuid:g}=m,b=f.call(this,m);r[g]=g,s.push(b),this.progress.update()}for(let m of u){let{uuid:g,source:b}=m,E=m.display_title||m.title,[y,T]=g.split(JD);if(!c[y]){a.push(E);continue}let[w]=b.split(Rs);if(!r[w]){o.push(E);continue}m.source=`${r[w]}${Rs}${this.uuid}`;let S=f.call(this,m);r[g]=g,s.push(S),this.progress.update()}if(i.length){let m=await De("Footprint"),g=await De("File missing!");ze("warn",[m,i.join("\u3001"),g])}if(n.length){let m=await De("Footprint"),g=await De("The format of the {type} document is invalid",{type:m});ze("warn",[g,n.join("\u3001")])}if(a.length){let m=await De("The owning PCB is missing");ze("warn",[m,":",a.join("\u3001")])}if(o.length){let m=await De("Custom footprint lost template data!");ze("warn",[m,o.join("\u3001")])}return this.map.footprintMap=r,{result:s,footprintMap:r}}catch(s){throw new Error(s.message)}}async createDevice(){try{let t=[],s={},r=this.datas.devices,{symbolMap:i,footprintMap:n}=this.map,a=[],o=[],{datas:c}=await w0(r),l=this.client;for(let u of c){let h=u.display_title||u.title,p=u.attributes,{uuid:d}=u,f=[],m=d,g=u.description||u.desc||"";p.Symbol&&!i[p.Symbol]&&(a.push(h),p.Symbol=""),p.Footprint&&!n[p.Footprint]&&(o.push(h),p.Footprint="");let b=this.getCreateTime(u),E=this.getUpdateTime(u);f.push(this.encoder.device.head({doc:m,client:l,updateTime:b,version:u.version,user:this.user,ticket:++this.maxTicket})),f.push(this.encoder.device.head({doc:m,client:l,updateTime:E,version:u.version,user:this.user,ticket:++this.maxTicket})),f.push(this.encoder.device.meta(++this.maxTicket,{...u,tags:Hi(u.custom_tags),title:h,description:g,attributes:p}));let y=f.join(Le);s[d]=d,t.push(y),this.progress.update()}if(a.length){let u=await De("The following devices lose bound symbol data!");ze("warn",[u,":",a.join("\u3001")])}if(o.length){let u=await De("The following devices lose bound footprint data!");ze("warn",[u,":",o.join("\u3001")])}return this.map.deviceMap=s,{result:t,deviceMap:s}}catch(t){throw new Error(t.message)}}async createPanel(){try{let t=[],s={},r=[],i=[],n=this.client,a=this.datas.panels;for(let o=0;o<a.length;o++){let c=a[o],{uuid:l}=c,u=c.display_title||c.title;if(!c.dataStr){r.push(u);continue}if(!Cl(c.dataStr,"['DOCTYPE','PANEL'")){i.push(u);continue}let h=[],p=c.description||c.desc||"",d=l,f=this.getCreateTime(c),m=this.getUpdateTime(c);h.push(this.encoder.panel.head({doc:d,client:n,updateTime:f,user:this.user,ticket:++this.maxTicket})),h.push(this.encoder.panel.head({doc:d,client:n,updateTime:m,user:this.user,ticket:++this.maxTicket})),h.push(this.encoder.panel.meta(++this.maxTicket,{title:u,description:p,zIndex:null})),h.push(this.encoder.panel.transform({doc:d,dataStr:c.dataStr,updateTime:m,user:this.user}));let g=h.join(Le);s[l]=l,t.push(g),this.progress.update()}if(r.length){let o=await De("Panel"),c=await De("File missing!");ze("warn",[o,r.join("\u3001"),c])}if(i.length){let o=await De("Panel"),c=await De("The format of the {type} document is invalid",{type:o});ze("warn",[c,i.join("\u3001")])}return this.map.panelMap=s,{result:t,panelMap:s}}catch(t){throw new Error(t.message)}}async createAttr(t,s){try{let r=[],i={},n={},a=this.client,o=this.datas.block_symbol_attribute,c={};this.datas.block_symbol.forEach(h=>c[h.uuid]=Mt(h.title));let l={},u=this.datas.schematics;for(let h in u)l[Mt(u[h].name)]=h;for(let h=0;h<o.length;h++){let p=o[h],d=this.getNewPath(p.path,t,s,c,l);if(d.success===!1){n[p.path]=d.message;continue}let f=d.result,m=f;p.path=f;let g=[],b=this.time;g.push(this.encoder.instance.head({doc:m,client:a,updateTime:b,user:this.user,ticket:++this.maxTicket})),g.push(this.encoder.instance.attr(++this.maxTicket,p.attr));let E=g.join(Le);i[f]=f,r.push(E),this.progress.update()}if(!mn(n))for(let h in n){let p=await De(n[h]);this.logger.warn(`${h}: ${p}`)}return this.map.instanceMap=i,{result:r,instanceMap:i}}catch(r){throw new Error(r.message)}}getNewPath(t,s,r,i,n){var h,p;let a=/[0-9a-z]+_\$\d+?/,o=(h=t.match(a))==null?void 0:h[0];if(o&&!s[o])return{success:!1,message:"Instance properties missing top-level schematics!"};t=t.replace(a,s[o]);let c=/e\d+(R\d+)?_\$\d+/gm,l=t.match(c),u="Instance attribute conversion path failed!";if(l!=null&&l.length)for(let d of l){let[f,m]=d.split(Ud),[g,b]=f.split(Ub),E=r[g];if(!E)return{success:!1,message:u};let y=i[E];if(!y)return{success:!1,message:u};let T=n[y];if(!T)return{success:!1,message:u};let S=(p=this.datas.schematics[T].sheets.filter(_=>_.sheet_id===Number(m))[0])==null?void 0:p.uuid;if(!S)return{success:!1,message:u};t=t.replace(d,`${qD}${g}${b?`${Ub}${b}`:""}${Ud}${S}`)}return{success:!0,result:t}}async createBlob(){try{let t=[],s={},r=[],i=this.client,n=this.datas.blobs;for(let a of n){let{hash:o}=a;a.filename||r.push(o);let c=o,l=[],u=ax(a.dataStr),h=this.time;l.push(this.encoder.blob.head({doc:ii.BLOB,client:i,updateTime:h,user:this.user,ticket:++this.maxTicket})),l.push(this.encoder.blob.buildStr(++this.maxTicket,c,{filename:a.filename,content:u}));let p=l.join(Le);s[o]=o,t.push(p),this.progress.update()}return this.map.blobMap=s,{result:t,blobMap:s}}catch(t){throw new Error(t.message)}}async createImages(t,s){let r=[],i={};for(let o in this.datas.images){let c;if(this.map.sheetMap[o]?c=this.map.sheetMap[o]:this.map.pcbMap[o]?c=this.map.pcbMap[o]:this.map.panelMap[o]?c=this.map.panelMap[o]:this.map.symbolMap[o]&&(c=this.map.symbolMap[o]),!c){r.push(o);continue}i[c]=this.datas.images[o]}let n=await qn.upload(i,t,s,this.maxTicket);if(n.success===!1)return{success:!1,code:n.code,message:n.message};let{failed:a}=n.result;for(let o of a)r.push(o);if(r.length){let o=await De("The preview images of the following documents are missing:");ze("warn",[o,r.join("\u3001")])}}async createVariant(){return da?{result:[]}:{result:[]}}createConfig(t){let s=[],{default_sheet:r="",name:i,uuid:n,cbb_project:a}=t,o=this.map.deviceMap;r&&!o[r]&&(ze("warn",["Project drawing symbol failed to update!",r]),r="");let c=[],l=this.time;c.push(this.encoder.config.head({client:this.client,updateTime:l,user:this.user,ticket:++this.maxTicket})),c.push(this.encoder.config.meta(++this.maxTicket,{defaultSheet:r}));let u=c.join(Le);return s.push(u),this.progress.update(),{result:s}}async upload(t,s){if(s&&s.length){let r=this.createStructure?new bo:null,i=this.createStructure?r.flowParseFull():null,n=[],a=new dl;a.onChunk(l=>{n.push(se.getInstance().projectHistory.set({projectId:this.uuid,branchData:t,dataStr:l}))});for(let l of s)a.push(l),i==null||i.update(l);a.end(),i==null||i.end();let c=(await Promise.all(n)).filter(l=>l.success===!1);if(c&&c.length)return console.error("The upload of the project log failed!",c),{success:!1,message:"The upload of the project log failed!"};i&&await this.buildStructure(r.getProject(),this.info.owner,t.uuid)}return{success:!0}}getMessage(t){return typeof t=="string"?[this.text,t]:[this.text,...t]}onfailed(){this.progress.progressTip==="Convert Project..."&&this.progress.update(!0)}onsuccess(){var t;this.progress.progressTip==="Convert Project..."&&this.progress.update(!0),this.uuid&&((t=this.branchData)!=null&&t.uuid)&&(console.time("convert project createImages"),this.createImages(this.uuid,this.branchData.uuid),console.timeEnd("convert project createImages"))}};var Eh=class extends Al{constructor(t){let{uuid:s,project:r,suffix:i,progressOptions:n}=t,{extractHistory:a}=t;super({uuid:s,data:r,suffix:i,progressOptions:n}),this.extractHistory=a}setProgress(t){let{needProgress:s,progressTip:r}=this.progress;this.progress=new qs({needProgress:s,progressTip:r,total:t})}async getData(t){var s,r,i,n;try{t.progress&&(this.progress=t.progress);let a=await se.getInstance().project.get(this.uuid);if(a.success===!1)return{success:!1,code:a.code,message:a.message};this.progress.update();let{branch_uuid:o}=a.result;o?(await fe.messageBus.rpcCall(ms.HAS,[this.uuid])).message?this.tool=new Oa({uuid:this.uuid,extractHistory:this.extractHistory,progressOptions:this.progress.options}):this.tool=new Ia({uuid:this.uuid,extractHistory:this.extractHistory,progressOptions:this.progress.options}):this.tool=new wo({uuid:this.uuid,progressOptions:this.progress.options});let c=2+this.tool.progress.step;this.setProgress(c);let l=await this.tool.getExport();if(l.success===!1)return{success:!1,code:l.code,message:l.message};this.progress.update();let u=l.result,h=u.name||((s=u.config)==null?void 0:s.name),p=u.cbb_project||((r=u.config)==null?void 0:r.cbb_project),d=u.content||((i=u.config)==null?void 0:i.introduction),f=u.content||((n=u.config)==null?void 0:n.description),m={uuid:this.uuid,name:h,cbb_project:p,introduction:d,description:f};return{success:!0,result:Object.assign(u,{config:m})}}catch(a){return{success:!1,message:a.message}}}async getZip(t){if(t.dataStr!==void 0){let s=await pc(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}else{let s=await KT(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}}async flowData(t){t.progress&&(this.progress=t.progress),this.tool=new Oa({uuid:this.uuid,extractHistory:this.extractHistory,progressOptions:this.progress.options});let s=2+this.tool.progress.step;this.setProgress(s);let r=await this.tool.flow();return r.success===!1?{success:!1,code:r.code,message:r.message}:(this.progress.update(),{success:!0,result:r.result})}async flowZip(t){let s=await pc(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}},bh=class extends Al{constructor(t){let{uuid:s,name:r,cbb_project:i=!1,suffix:n,progressOptions:a={}}=t,o=5;super({uuid:s,suffix:n,progressOptions:{...a,total:o}}),this.name=r,this.cbb_project=i,this.ARelated=t}async getData(t){try{t.progress&&(this.progress=t.progress);let r=await new An({uuid:this.uuid,datas:this.ARelated,name:this.name,cbb_project:this.cbb_project,progressOptions:this.progress.options}).getExport({progress:this.progress});return r.success===!1?{success:!1,code:r.code,message:r.message}:(this.progress.update(),{success:!0,result:r.result})}catch(s){return{success:!1,message:s.message}}}async getZip(t){let s=await pc(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}async flowData(t){t.progress&&(this.progress=t.progress);let r=await new An({uuid:this.uuid,datas:this.ARelated,name:this.name,cbb_project:this.cbb_project,progressOptions:this.progress.options}).flow();return r.success===!1?{success:!1,code:r.code,message:r.message}:(this.progress.update(),{success:!0,result:r.result})}async flowZip(t){let s=await pc(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}},_0=class extends Al{constructor(t){let{uuid:s,project:r,suffix:i,progressOptions:n={}}=t,a=4;super({uuid:s,data:r,suffix:i,progressOptions:{...n,total:a}}),this.args=t}async getData(t){var s,r,i,n,a,o,c;try{t.progress&&(this.progress=t.progress);let l=await new mi().getExport(this.args);if(l.success===!1)return{success:!1,code:l.code,message:l.message};this.progress.update();let u=l.result,h=u.name||((s=u.config)==null?void 0:s.title)||((r=u.config)==null?void 0:r.name),p=u.cbb_project||((i=u.config)==null?void 0:i.cbbProject)||((n=u.config)==null?void 0:n.cbb_project),d=u.content||((a=u.config)==null?void 0:a.introduction),f=u.content||((o=u.config)==null?void 0:o.description),m=u.tags||((c=u.config)==null?void 0:c.tags),g={uuid:this.uuid,name:h,cbb_project:p,introduction:d,description:f,tags:m};return{success:!0,result:Object.assign(u,{config:g})}}catch(l){return{success:!1,message:l.message}}}async getZip(t){if(this.suffix===Kt.PRJ2&&!t.dataStr){let{name:s,cbb_project:r,images:i}=t,n={name:s,cbb_project:r},a=await new Yi({datas:t,info:n,progressOptions:{needProgress:!1}}).start();if(a.success===!1)return{success:!1,code:a.code,message:a.message};let{dataStr:o}=a.result,c=t.content,l=t.content,u=t.tags,h={uuid:this.uuid,name:s,cbb_project:r,introduction:c,description:l,tags:u},p=await pc({dataStr:o.join(Le),images:i,config:h});return p.success===!1?{success:!1,code:p.code,message:p.message}:(this.progress.update(),{success:!0,result:p.result})}else if(t.dataStr!==void 0){let s=await pc(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}else{let s=await KT(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}}async flowData(t){try{t.progress&&(this.progress=t.progress);let s=await new mi().flow(this.args);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}catch(s){return{success:!1,message:s.message}}}async flowZip(t){let s=await pc(t);return s.success===!1?{success:!1,code:s.code,message:s.message}:(this.progress.update(),{success:!0,result:s.result})}};function ox(e,t){let s="";return s+=t?"ReuseBlock_":"ProPrj_",s+=e+"_",s+=cx(new Date,"downProject"),s}var Dl=class{constructor(t={}){let{name:s,uuid:r,password:i,suffix:n=Kt.PRJ2,progressOptions:a={}}=t;this.name=s,this.uuid=r,this.password=i||gh,this.suffix=n;let o={needProgress:!0,progressTip:"save as local...",total:5,...a};this.progress=new qs(o)}async start(t={}){try{t.progress&&(this.progress=t.progress);let s=await this.getData({progress:this.progress});if(s.success===!1)return this.failed(s.code,s.message),{success:!1,code:s.code,message:s.message};this.progress.update();let{blob:r,config:i,suffix:n}=s.result,a=this.getName(i);if(a.success===!1)return this.failed(a.code,a.message),{success:!1,code:a.code,message:a.message};this.progress.update();let o=await BI(r,this.password);if(yh("",null),o.success===!1)return this.failed(o.code,o.message),{success:!1,code:o.code,message:o.message};this.progress.update();let c=await kI(o.result,this.name,n);return c.success===!1?(this.failed(c.code,c.message),{success:!1,code:c.code,message:c.message}):(this.progress.update(),this.succeed(),{success:!0})}catch(s){throw new Error(`DownLoad zip failed! ${this.name} ${s}`)}}getName(t){return!this.name&&t&&(this.name=ox(t.name,t.cbb_project)),{success:!0}}succeed(){this.onsucceed(),this.progress.update(!0)}failed(t,s){this.onfailed(t,s),this.progress.update(!0)}};var nf=class extends Dl{constructor(t){let{progressOptions:s}=t,r=new Eh(t),i=5+r.progress.step;super({...t,progressOptions:{...s,total:i}}),this.tool=r}async getData(t){try{let s=Ge(this.uuid);return await this.tool.blob(s)}catch(s){return{success:!1,message:s.message}}}onsucceed(){fe.messageBus.publish("ui/toastMsg",{type:"success",msg:"Project saves successfully!"})}onfailed(t,s){let r=["Project save as failure!",s||""];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:r})}},A0=class extends Dl{constructor(t){let{progressOptions:s}=t,r=new bh(t),i=5+r.progress.step;super({...t,progressOptions:{...s,total:i}}),this.tool=r}async getData(t){try{let s=Ge(this.uuid);return await this.tool.blob(s)}catch(s){return{success:!1,message:s.message}}}onsucceed(){fe.messageBus.publish("ui/toastMsg",{type:"success",msg:"Document saves successfully!"})}onfailed(t,s){let r=["Document save as failure!",s||""];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:r})}},C0=class extends Dl{constructor(t){let{progressOptions:s}=t,r=new _0(t),i=5+r.progress.step;super({...t,progressOptions:{...s,total:i}}),this.tool=r}async getData(t){try{let s=Ge(this.uuid);return await this.tool.blob(s)}catch(s){return{success:!1,message:s.message}}}onsucceed(){fe.messageBus.publish("ui/toastMsg",{type:"success",msg:"Project saves successfully!"})}onfailed(t,s){let r=["Project save as failure!",s||""];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:r})}};var Pl=class{constructor(t,s=[]){this.interval=t;this.conditions=s;this._timer=-1}get timer(){return this._timer}set timer(t){this._timer=t}get switch(){return this.timer>-1}async loop(t=!1,...s){let r=this,i=performance.now(),n,a=()=>{if(typeof this.interval=="function")return this.interval(i);if(typeof this.interval=="number")return i-r.timer>this.interval};if(r.timer>-1&&(!r.timer||!t||a()))try{let o=!0;for(let c=0;c<this.conditions.length;c++){let l=this.conditions[c];if(l instanceof Promise?o=await l(t,i):o=l(t,i),!o)break}o&&(r.timer=i,n=await r.todo(i,...s))}catch(o){console.log("\u4E0A\u4F20\u65E5\u5FD7\u5931\u8D25\uFF1Axxxxxxxxxxxxxxxxxxxx..........",o)}return this.animation=requestAnimationFrame(function(){r.loop(!0)}),n}async mount(){this.beforeMount(),this.timer=1,await this.loop(!1),this.mounted()}destory(){this.timer=-1,this.animation&&cancelAnimationFrame(this.animation),this.destoryed()}suspend(){this.timer=-1,this.suspended()}resume(){this.timer=1,this.resumed()}async force(...t){if(this.timer>-1)return await this.loop(!1,...t);console.warn("loop is closed!")}};var Ol=class Ol extends Qo{static getInstance(){return Ol.tool==null&&(Ol.tool=new Ol),Ol.tool}constructor(){super()}};Ol.tool=null;var gc=Ol;var D0=new ut(2);function XT(e){return new Promise(t=>{if(ve)return t(!0);let s=window.indexedDB.deleteDatabase(e);s.onsuccess=r=>{D0.debug(e,"Database deleted successfully",r),t(!0)},s.onerror=r=>{D0.debug(e,"Database deleted failed",r),t(!1)},s.onblocked=async r=>{D0.debug(e,"onblocked....",r),t(!1)},s.onupgradeneeded=r=>{D0.debug(e,"onupgradeneeded....",r),t(!1)}})}function wt(e=fe.currentProject.projectId){let s=gc.getInstance().get(e);if(!s)throw new Error("Get an illegal project!");return s}function Mt(e){return ve?e.toLocaleLowerCase():typeof e!="string"?(console.warn("Title must be a string!title is "+e),e):e.replace(/[A-Z]+/g,t=>t.toLowerCase())}function cx(e,t){function s(u){return u>=10?u:"0"+u}let r=new Date(e),i=r.getFullYear(),n=s(r.getMonth()+1),a=s(r.getDate()),o=s(r.getHours()),c=s(r.getMinutes()),l=s(r.getSeconds());return t==="downProject"||t==="y-m-d"?i+"-"+n+"-"+a:i+"-"+n+"-"+a+" "+o+":"+c+":"+l}function nr(e,t){wt().ready&&!lH()&&fe.messageBus.publish(e,t)}async function De(e,t){return(await fe.messageBus.rpcCall("i18n",[e,t])).message}async function yl(e,t,s){let r=t.length;for(let i=0;i<r;i+=e){let n=Math.min(r,i+e);await s(t.slice(i,n))}}function $T(e){let t=[],s=0,r=()=>{s--,t.length>0&&t.shift()()},i=async(o,c,...l)=>{s++;let u=(async()=>o(...l))();try{let h=await u;c(h)}catch{}r()},n=(o,c,...l)=>{t.push(i.bind(null,o,c,...l)),s<e&&t.length>0&&t.shift()()};return(o,...c)=>{let l=Zc(c);return new Promise(u=>{n(o,u,...l)})}}function pl(e,t,s){let r=$T(e),i=[];if(s)for(let n of s){let a=Array.isArray(n)?n:[n];i.push(r(t,...a))}else i.push(r(t));return Promise.all(i)}function FI(e,t,s,r,i){let n=$T(e),a=[];if(r)for(let o=0;o<r.length;o++){let c=r[o],l=Array.isArray(c)?c:[c],u=new t(...l),h=u[s].bind(u);if(i&&i.length===r.length){let p=i[o],d=Array.isArray(p)?p:[p];a.push(n(h,...d))}else a.push(n(h))}else{let o=new t,c=o[s].bind(o);if(i)for(let l of i){let u=Array.isArray(l)?l:[l];a.push(n(c,...u))}else a.push(n(c))}return Promise.all(a)}async function rx(e,t,s){let r=(i,n)=>fetch(i,n).then(a=>a.ok?a[s]():{success:!1,url:i,error:a.status}).catch(a=>({success:!1,url:i,error:a.message}));return new Promise(i=>{let n=$T(e),a=[];for(let o of t){let c=Array.isArray(o)?o:[o];a.push(n(r,...c))}Promise.all(a).then(o=>{let c=[];for(let l of o)l instanceof Blob?c.push(l):l.success&&c.push(l.result);i(c)})})}function hc(e,t){fe.messageBus.publish("logPublishProxy",{type:e,msg:t})}function ze(e,t){fe.messageBus.publish("logI18nLogView",{type:e,msg:t})}function jt(e,t){fe.messageBus.publish("logI18nLogView1",{type:e,msg:t})}function Ft(e,t){if(Array.isArray(e)){for(let s=0,r=e.length;s<r;s++)if(t(void 0,e[s],s)===!1)return}else{let s=0;for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let i=e[r];if(t(r,i,s)===!1)return;s++}}}async function Ct(e,t){if(Array.isArray(e)){for(let s=0,r=e.length;s<r;s++)if(await t(void 0,e[s],s)===!1)return}else{let s=0;for(let r in e)if(e.hasOwnProperty(r)){let i=e[r];if(await t(r,i,s)===!1)return;s++}}}function QT(e){return t=>e.apply(e,Array.isArray(t)?t:[t])}var Qt={[_i.ContentType]:Si.Json},fx={[_i.ContentType]:Si.Form},kye={[_i.ContentType]:Si.FormData};function y0(e,t){let s=e.length,r=0;for(;r<s;){let i=e.indexOf(`
`,r);i<0&&(i=s);let n=e.substring(r,i);if(t(n)===!1)break;r=i+1}}function ax(e){let t="";return y0(e,s=>{if(!s)return;let r=JSON.parse(s);r[0]==="BLOB"&&(t=r[3])}),t}function nH(e){e==null&&(e="");let t=e.split("_"),s=t.length-1,r=t[s];return t.length===1||isNaN(Number(r))?`${e}_1`:/^_+$/gim.test(e)?`${e}_1`:(t[s]=(Number(r)+1).toString(),t.join("_"))}var aH=1e3;async function w0(e){let{message:t}=await fe.messageBus.rpcCall("allowDuplicateNames");if(t)return{datas:e,duplicateNameAllowed:t};let s={},r=[];return e.forEach(i=>{let n=0;do{let a=i.display_title||i.title;if(a in s)i.display_title=nH(a),i.title=Mt(i.display_title);else{s[a]={source:i.source,version:i.version},r.push(i);break}n++}while(n<aH)}),{datas:r,duplicateNameAllowed:t}}async function uc(e){return new Promise((t,s)=>{let r=new FileReader;r.onload=i=>{t({data:r.result,error:null})},r.oneror=i=>{t({data:null,error:i})},r.readAsArrayBuffer(e)})}async function mx(e){return new Promise((t,s)=>{let r=new FileReader;r.onload=i=>{t({data:r.result,error:null})},r.oneror=i=>{t({data:null,error:i})},r.readAsText(e)})}async function gx(e){return new Blob([e],{type:"text/plain"})}var oH=[Ne.PART,Ne.SHEET_SYMBOL,Ne.NETFLAG,Ne.NETPORT,Ne.NONEELEC_SYMBOL,Ne.SHORT_SYMBOL,Ne.OFF_PAGE_CONNECTOR,Ne.DIFF_PAIRS_FLAG],cH=oH.concat([Ne.BLOCK_SYMBOL]);function ni(e){return cH.indexOf(e)>=0}var mc=/[a-zA-Z0-9]_[a-zA-Z0-9]+/;function lH(){return(self==null?void 0:self.name)==="cacheWorker"}async function yx(e){await sf(e)&&(e=(await qT(e,b0[e.name]))[0]);let t=new px.default;await t.loadAsync(e);let s=t.files;return Object.keys(s)}async function sf(e){let t=e.name.split("."),s="."+t[t.length-1];if(s==Kt.PRJ||s==Kt.PRJ2)try{let r=new Kg.FS;return await r.importBlob(e),!!r.children.find(a=>a.data.encrypted)}catch{return!1}else return!1}async function h0(e,t){let r=await new Zo(new Mi(e)).getEntries(),i=new Di("application/zip"),n=new $o(i);return await Promise.all(r.map(async a=>{let o=await a.getData(new so);o!==""?n.add(a.filename,new to(o),{password:t}):n.add(a.filename,new to(o))})),await n.close(),await i.getData()}async function qT(e,t){let r=await new Zo(new Mi(e)).getEntries(),i,n=new Di("application/zip"),a=new $o(n);return await Promise.all(r.map(async l=>{let u;l.encrypted?u=await l.getData(new Fn,{password:t}):u=await l.getData(new Fn);let h=new ReadableStream({start(p){p.enqueue(u),p.close()}});await a.add(l.filename,h)})),await a.close(),i=await n.getData(),[new File([i],e.name)]}var b0={};async function Ex(e,t){let s=new Kg.FS;await s.importBlob(e[0]);let r=await s.checkPassword(t);if(r){let i=e[0].name;b0[i]=t}return r}var gh=null;async function yh(e,t){gh=t}var Gt={SHEET:"SHEET",INSTANCE:"INSTANCE",SYMBOL:"SYMBOL",PCB:"PCB",FOOTPRINT:"FOOTPRINT",POUR:"POUR",PANEL:"PANEL",BLOB:"BLOB",FONT:"FONT",IMAGE:"IMAGE"};function Cl(e,t){return!!e.trim().replaceAll('"',"'").replaceAll(" ","").startsWith(t)}var oi=class{constructor(t,s="",r={},i=!0){this.verifySwitch=i;this.OFF_LINE=void 0;this.store=t,this.key=s;for(let n in r)r[n]instanceof yd||delete r[n];this.indexs=r}verify(...t){for(let s of t)if(s!==0&&!ot.notNull(s))throw new Error(`invalid data! ${t}`)}verify1(...t){for(let r of t)Array.isArray(r)?r.forEach(i=>this.verify1.call(this,i)):Object.prototype.toString.call(r)==="[object Object]"?Object.values(r).forEach(n=>this.verify1.call(this,n)):s(r);function s(r){if(r!==""&&!ot.notNull(r))throw new Error(`invalid data! ${t}`);return r}}getSimpleStore(){return this.store}getIndexs(){return this.indexs}getIndex(t){return this.verify(t),ve?this.OFF_LINE:this.indexs[t]}async readwriteData(t,s){if(ve)return s(null),!0;let r=!1;try{let i=await this.store.forceGet(t),n=await(s==null?void 0:s(i));n&&(await this.store.forcePut(t,n),r=!0)}catch(i){console.error(i)}return r}async getCompareTicket(t,s){this.verify(t);let r=await this.get(t);if(r&&(r.ticket!==s||r.ticket<0))return r}async get(t){return this.verify(t),await this.getInDB(t)}async getInDB(t){return this.verify(t),ve?this.OFF_LINE:this.indexs[this.key]?await this.indexs[this.key].get(t):await this.store.get(t)}getByIndexName(t,s){return this.verify(t,s),ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].get(s):null}async getLotsArr(t){if(this.verify(t),ve)return this.OFF_LINE;let s=new Array,r=this.store;return await Ct(t,async(i,n)=>{let a=this.key?await this.indexs[this.key].get(n):await r.get(n);a&&s.push(a)}),s}getAllArrBound(t){return ve?this.OFF_LINE:this.indexs[this.key].getAllBound(...t)}getAllArrBoundByIndexName(t,s){return this.verify(t),ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].getAllBound(...s):null}getAllArrByIndexName(t,s){return this.verify(t,s),ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].getAll(s):null}async getAllPrimaryKeys(t){return ve?this.OFF_LINE:await this.getAllKeys(t)}async update(t,s,r=!1){this.verify(t);let i=null,n=await this.readwriteData(t,async a=>{if(!a&&!r)return null;let o;return a?(o=a.ticket,!o||o>=0?o=-1:o-=1):o=-1,i=await s(a),i.ticket=o,i});return i}async updateInlocal(t,s){this.verify(t);let r=await this.get(t);return r?this.updateInDB(t,r,s).then(()=>r,()=>null):null}updateInDB(t,s,r){return this.verify(t,s),ve?Promise.resolve():this.store.put(t,s,r)}async addLots(t,s,r,i){if(this.verify(t),ve)Ft(t,(n,a)=>{s&&s(a)});else{let n=this.store;await Ct(t,async(a,o)=>{await n.put(o[this.key],o,i).then(()=>{s&&s(o)},c=>{r&&r({key:o[this.key],msg:c})})})}}async delLots(t,s,r){if(this.verify(t),ve)Ft(t,(i,n)=>{s&&s(n)});else{let i=this.store;await Ct(t,async(n,a)=>{await i.delete(a).then(()=>{s&&s(a)},()=>{r&&r(a)})})}}async add(t,s,r){return this.verifySwitch&&this.verify(t),this.verify(s),this.addInDB(t,s,r).then(()=>!0,()=>!1)}addInDB(t,s,r){return this.verifySwitch&&this.verify(t),this.verify(s),ve?Promise.resolve():this.store.put(t,s,r)}del(t){return this.verify(t),this.delInDB(t).then(()=>!0,()=>!1)}delInDB(t){return this.verify(t),ve?Promise.resolve():this.store.delete(t)}getTicketUB(t){return this.indexs.ticket?this.indexs.ticket.getAllUB(...t):null}async getAllKV(){let t={},s=await this.getAllInDB()||[];return Ft(s,(r,i)=>{t[i[this.key]]=i}),t||{}}async getAllArr(){return await this.getAllInDB()}getAllInDB(){return ve?this.OFF_LINE:this.indexs[this.key]?this.indexs[this.key].getAll():this.store.getAll()}getAllKeys(t){return this.indexs[this.key]?this.indexs[this.key].getAllKeys(IDBKeyRange.bound(...t)):this.store.getAllKeys(t)}getKeyOnly(t,s){return ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].getKeyOnly(s):null}getKeyLB(t,s=[]){return ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].getKeyLB(...s):null}getKeyUB(t,s=[]){return ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].getKeyUB(...s):null}itorAllKeys(t,s,r,i){return ve?this.OFF_LINE:this.indexs[t]?this.indexs[t].itorAllKeys(r,s&&IDBKeyRange.bound(...s)):Promise.resolve()}};var n0e=new ut(2);var y0e=new ut(2);var B0e=new ut(2);var C1e=new ut(2);var Y1e=new ut(2);var oEe=new ut(2);var TEe=new ut(2);var FEe=new ut(2);var P0=class extends oi{constructor(t,s){let r=new Os(s.dbName,"copyAndPaste",t);super(r)}async getData(){var s;let t="copyAndPaste";if(ve){let r=await se.getInstance().client.getKVCache({path:fe.currentProject.projectId,key:t});return r.success===!0&&r.result&&r.result.value&&Object.prototype.toString.call(r.result.value)==="[object String]"?JSON.parse(r.result.value):(s=r.result)==null?void 0:s.value}else{let r=await this.get(t);return r instanceof Blob?JSON.parse((await mx(r)).data):r}}async setData(t){let s="copyAndPaste";console.debug("copyAndPaste data...",t);let r=JSON.stringify(t,null,2);if(ve){let i={path:fe.currentProject.projectId,key:s,value:r};return(await se.getInstance().client.setKVCache(i)).success}else{let i=await gx(r);return await this.add(s,i)}}async isExist(){let t="copyAndPaste";return ve?(await se.getInstance().client.isExistKVCache({path:fe.currentProject.projectId,key:t})).result:(await this.getAllPrimaryKeys()).indexOf(t)>-1}async getDataFromPcbCanvas(){var r;let t=await this.getData(),s=(r=t==null?void 0:t.canvas)==null?void 0:r.PcbCanvas;if(s&&s.canvas){let{devices:i,footprints:n}=s.canvas;return{devices:i,footprints:n}}return null}};var O0=class extends oi{constructor(t,s){let r=new Os(s.dbName,"copyAndPasteTableCell",t);super(r)}async getData(){var s;let t="copyAndPasteTableCell";if(ve){let r=await se.getInstance().client.getKVCache({path:fe.currentProject.projectId,key:t});return r.success===!0&&r.result&&r.result.value&&Object.prototype.toString.call(r.result.value)==="[object String]"?JSON.parse(r.result.value):(s=r.result)==null?void 0:s.value}else return this.get(t)}async isExist(){let t="copyAndPasteTableCell";return ve?(await se.getInstance().client.isExistKVCache({path:fe.currentProject.projectId,key:t})).result:(await this.getAllPrimaryKeys()).indexOf(t)>-1}async setData(t){let s="copyAndPasteTableCell";if(ve){let r={path:fe.currentProject.projectId,key:s,value:JSON.stringify(t)};return(await se.getInstance().client.setKVCache(r)).success}else return this.add(s,t)}};var I0=class extends oi{constructor(t,s){let r=new Os(s.dbName,"lockPrj",t);super(r,"projectId")}getData(t){if(!ve)return this.get(t)}addData(t,s){if(!ve)return this.add(t,s)}delData(t){if(!ve)return this.del(t)}};var x0=class extends oi{constructor(t,s){let r=new Os(s.dbName,"clipboard",t);super(r)}async getData(t){var s;if(!t)return null;if(ve){let r=await se.getInstance().client.getKVCache({path:fe.currentProject.projectId,key:t});return r.success===!0&&r.result&&r.result.value&&Object.prototype.toString.call(r.result.value)==="[object String]"?JSON.parse(r.result.value):(s=r.result)==null?void 0:s.value}else return this.get(t)}async addData(t,s){if(ve){let r={path:fe.currentProject.projectId,key:t,value:JSON.stringify(s)};return(await se.getInstance().client.setKVCache(r)).success}else return this.add(t,s)}async isExist(t){return ve?(await se.getInstance().client.isExistKVCache({path:fe.currentProject.projectId,key:t})).result:(await this.getAllPrimaryKeys()).indexOf(t)>-1}};var uH=new ut(2),v0=class extends oi{constructor(t,s){let r=`${t}_projectInfo_${s}`,i=new Os(r);super(i,"projectId")}verifyKey(t){ot.mustString(t)}verifyData(t){ot.mustString(t.projectId),ot.mustString(t.projectName),ot.mustString(t.updateTime),ot.mustDate(t.timeOfOpenProject)}getData(t){if(!ve)return this.verifyKey(t),this.get(t)}addData(t,s){if(!ve)return this.verifyKey(t),this.verifyData(s),this.add(t,s)}delData(t){if(!ve)return this.verifyKey(t),this.del(t)}async updateData(t,s){if(ve)return!0;this.verifyKey(t);let r=await this.get(t);return r?(Ft(s,(n,a)=>{switch(n){case"projectId":case"projectName":case"timeOfOpenProject":case"updateTime":r[n]=a;break;default:uH.error("DBCommon\u7684projectInfo\u5B58\u5165\u9519\u8BEF\u4FE1\u606F...");break}}),!!await this.updateInlocal(t,()=>r)):!1}async getAllArrData(){return ve?[]:await this.getAllArr()||[]}};var R0=class extends oi{constructor(t,s){let r=new Os(s.dbName,"basicLibraryList",t);super(r)}async addData(t,s){if(ve){let r={headers:{path:fe.currentProject.projectId}};t==="systemBasicLibraryList"&&(r={headers:{...fx,path:fe.currentProject.projectId,Accept:"text/plain,*/*;q=0.01"}});let i={path:fe.currentProject.projectId,key:t,value:s};return(await se.getInstance().client.setKVCache(i,r)).success}else return this.add(t,s)}async getData(t){var s;if(ve){let r=await se.getInstance().client.getKVCache({path:fe.currentProject.projectId,key:t});return r.success===!0&&r.result&&r.result.value&&Object.prototype.toString.call(r.result.value)==="[object String]"?JSON.parse(r.result.value):(s=r.result)==null?void 0:s.value}else return this.get(t)}async isExist(t){return ve?(await se.getInstance().client.isExistKVCache({path:fe.currentProject.projectId,key:t})).result:(await this.getAllPrimaryKeys()).indexOf(t)>-1}};var N0=class extends oi{constructor(t,s){let r=new Os(s.dbName,"log",t);super(r,void 0,void 0,!1),this.ticket=0}verifyKey(t){ot.mustString(t)}verifyData(t){ot.notNull(t.content),ot.notNull(t.type),ot.notNull(t.owner)}async setData(t={}){let{message:s}=await fe.messageBus.rpcCall("getUserId"),r=fe.currentProject.projectId||t.project_uuid;this.ticket=this.ticket+1;let i=`${window._TAB_ID_}-${this.ticket}`,n=Object.assign(t,{id:i,time:Number(new Date),owner:s,project_uuid:r});if(this.verifyData(n),!ve){if(da)return this.add(n.id,n)}}async delData(t){if(!ve){if(da)return this.del(t)}}async delLotsData(t,s,r){if(ve)return;t.forEach(this.verifyKey.bind(this));let i=[],n=[],a=c=>{i.push(c),s&&s(c)},o=c=>{n.push(c),r&&r(c)};return await this.delLots(t,a,o),{successData:i,failedData:n}}getAllArrData(){if(!ve){if(da)return this.getAllArr()}}};var m0=49,bx=50,ZT="Common";async function Tx(e){let t=e.dbName,s=bx,r=null;if(!ve&&(r=await Au(`${t}_${bx}`),!r))return null;let i={copyAndPaste:new P0(r,e),copyAndPasteTableCell:new O0(r,e),log:new N0(r,e),basicLibraryList:new R0(r,e),lockPrj:new I0(r,e),clipBoard:new x0(r,e),project:new v0(t,s)};if(!ve){let n=Object.keys(i);for(let a=0;a<n.length;++a)await i[n[a]].store.init()}return i}var zTe=new ut(2),L0=class{constructor(){this.dbName=ZT;self.MGR=self.MGR||{},self.MGR.CommonDB=this}async initDB(){let t=this;return new Promise(async r=>(t.stores=await Tx(t),t.stores?r(!0):r(!1)));async function s(){var a,o;let r=m0-1,i=`${t.dbName}_v${r}`,n=await t.getPreDB(i,r);if(n){if((o=(a=n.db)==null?void 0:a.objectStoreNames)!=null&&o.length){let c=await t.getPreDBPrjCache(n);if(c&&c.length){let l=c.map(u=>`${u.uuid}_v${r}`);await t.setPreDBPrjCache(c),await Ct(l,async(u,h)=>{await XT(h)})}}n.close(),await XT(i)}}}closeDB(){}getPreDB(t,s){return new Promise(r=>{ve||UA(t,s,i=>{}).then(async i=>{r(i)},i=>{r(null)})})}getPreDBPrjCache(t){}async setPreDBPrjCache(t){}};var ft=new L0;function W(e,t){return fe.messageBus.rpcService(e,async s=>QT(t)(s))}function gi(e,t){return fe.messageBus.subscribe(e,async s=>QT(t)(s))}var rwe=new ut(1),iwe=new ut(2),nwe=new ut(3);function wx(){let e=fe.messageBus;hH(e),dH(e),pH(e),fH(e),mH(e),gH(e),yH(e)}function hH(e){W(_s.COMMON.INIT_DB,async()=>await ft.initDB())}function dH(e){W(_s.PROJECT.GET,async t=>await ft.stores.project.getData(t)),W(_s.PROJECT.GET_ALL,async()=>await ft.stores.project.getAllArrData())}function pH(e){W(_s.COPYANDPASTE.GET,async()=>await ft.stores.copyAndPaste.getData()),W(_s.COPYANDPASTE.IS_EXIST,async()=>await ft.stores.copyAndPaste.isExist()),W(_s.COPYANDPASTE.GET_DATA_FROM_PCB_CANVAS,async()=>await ft.stores.copyAndPaste.getDataFromPcbCanvas()),W(_s.COPYANDPASTE_TABLE_CELL.GET,async()=>await ft.stores.copyAndPasteTableCell.getData()),W(_s.COPYANDPASTE_TABLE_CELL.SET,async t=>await ft.stores.copyAndPasteTableCell.setData(t)),W(_s.COPYANDPASTE_TABLE_CELL.IS_EXIST,async()=>await ft.stores.copyAndPasteTableCell.isExist())}function fH(e){W(_s.LOG.SET,async t=>await ft.stores.log.setData(t)),W(_s.LOG.DEL,async t=>await ft.stores.log.delData(t)),W(_s.LOG.DEL_LOTS,async(t,s,r)=>await ft.stores.log.delLotsData(t,s,r)),W(_s.LOG.GET_ALL,async()=>await ft.stores.log.getAllArrData())}function mH(e){W(_s.LIB.GET,async t=>await ft.stores.basicLibraryList.getData(t)),W(_s.LIB.SET,async(t,s)=>await ft.stores.basicLibraryList.addData(t,s)),W(_s.LIB.IS_EXIST,async t=>await ft.stores.basicLibraryList.isExist(t))}function gH(e){W(_s.CLIP_BOARD.GET,async t=>await ft.stores.clipBoard.getData(t)),W(_s.CLIP_BOARD.SET,async(t,s)=>await ft.stores.clipBoard.addData(t,s)),W(_s.CLIP_BOARD.IS_EXIST,async t=>await ft.stores.clipBoard.isExist(t))}function yH(e){W(_s.LOCK_PROJECT.GET,async t=>await ft.stores.lockPrj.getData(t)),W(_s.LOCK_PROJECT.READ_WRITE,async(t,s)=>await ft.stores.lockPrj.readwriteData(t,s))}var Swe=new ut(1),_we=new ut(2),Ns=new ut(3);function Sx(){let e=fe.messageBus;EH(e),bH(e),TH(e),wH(e),SH(e),_H(e),AH(e),CH(e),DH(e),PH(e),OH(e),IH(e),xH(e),vH(e),RH(e),NH(e)}function EH(e){W(re.PROJECT.GET_HISTORY_NODE,async t=>{let s=X(t);if(s)return await s.project.getHistoricalNodes()}),W(re.PROJECT.GET_HISTORY_UPDATETIME,async t=>{let s=X(t);if(s)return await s.project.getHistoryUpdatetime()}),W(re.PROJECT.GET_HISTORY_PROJECT,async t=>{let s=X(t.uuid);if(s)return await s.project.getHistoricalProject(t)}),W(re.PROJECT.START_BATCH_UPLOAD,async t=>{let s=X(t);if(s)return await s.project.startBatchUpload()}),W(re.PROJECT.END_BATCH_UPLOAD,async t=>{let s=X(t);if(s)return await s.project.endBatchUpload()}),W(re.PROJECT.AWAIT_UPLOAD_END,async t=>{let s=X(t);if(s)return await s.project.awaitUploadEnd()}),W(re.PROJECT.SAVE_PEND_DATA,async t=>{let s=X(t.uuid);if(s)return await s.project.savePendData(t.docs)}),W(re.PROJECT.REVOKE_PEND_DATA,async t=>{let s=X(t);if(s)return await s.project.revokePendData()}),W(re.PROJECT.GET_MAX_TICKET,async t=>{let s=X(t);if(s)return(await s.project.getMaxTicket()).result}),W(re.PROJECT.GET,async(t,s)=>{var i;let r=X(t);if(r)return(i=await r.project.getData(s))==null?void 0:i.result}),W(re.PROJECT.UPDATE,async(t,s)=>{let r=X(t);if(r)return await r.project.updateData(s)}),W(re.PROJECT.COUNT_DOC,async t=>{var r;let s=X(t);if(s)return(r=await s.project.countDoc())==null?void 0:r.result}),W(re.PROJECT.GET_CLIENT,async t=>{var r;let s=X(t);if(s)return(r=await s.project.getClient())==null?void 0:r.result}),W(re.PROJECT.GET_BRANCH_DATA,async t=>{let s=X(t);if(s){let r=await s.project.getBranchData();if(!r.success)throw new Error("Missing branch data!");let i=await s.project.getHistoryUpdatetime();if(!i.success)throw new Error("Missing historical data!");let{uuid:n}=r.result,a=i.result;return{branch_uuid:n,branch_time:a}}}),W(re.PROJECT.HISTORIES,async(t,s,r)=>{var n;let i=X(t);if(i)return(n=await i.project.histories(s,r))==null?void 0:n.result}),W(re.PROJECT.COMPRESS,async t=>{var r;let s=X(t);if(s)return(r=await s.project.compress())==null?void 0:r.result}),W(re.PROJECT.FLOW_WRITE,async(t,s)=>{let r=X(s);if(r)return await r.project.flowWrite(t)}),W(re.PROJECT.GET_RELATED,async(t,s)=>{let r=X(s);if(r)return await r.project.related(t,!0)})}function bH(e){W(re.CONFIG.GET,async t=>{var r;return(r=await X(t).config.getData())==null?void 0:r.result}),W(re.CONFIG.UPDATE,async(t,s)=>await X(t).config.updateData(s))}function TH(e){W(re.BOARD.GET,async(t,s)=>{var i;return(i=await X(s).board.getData(t))==null?void 0:i.result}),W(re.BOARD.ADD,async(t,s)=>{var i;return(i=await X(s).board.addData(t))==null?void 0:i.result}),W(re.BOARD.UPDATE,async(t,s)=>{var i;return(i=await X(s).board.updateData(t))==null?void 0:i.result}),W(re.BOARD.DELETE,async(t,s)=>(await X(s).board.deleteData(t)).success),W(re.BOARD.GET_ALL_KV,async t=>{var r;return(r=await X(t).board.getAllKVData())==null?void 0:r.result}),W(re.BOARD.GET_ALL_ARR,async t=>{var r;return(r=await X(t).board.getAllArrData())==null?void 0:r.result}),W(re.BOARD.TRY_RENAME,async(t,s)=>(await X(s).board.tryRename(t)).result),W(re.BOARD.BATCH_DELETE,async(t,s)=>(await X(s).board.batchDelete(t)).result),W(re.BOARD.GET_BIND_KEYS,async(t,s)=>(await X(s).board.getBindKeys(t)).result)}function wH(e){W(re.SCHEMATIC.GET,async(t,s)=>{var i;return(i=await X(s).schematic.getData(t))==null?void 0:i.result}),W(re.SCHEMATIC.GET_BY_NAME,async(t,s)=>{var i,n;return(n=(i=await X(s).schematic.getDataByName(t))==null?void 0:i.result)==null?void 0:n[0]}),W(re.SCHEMATIC.UPDATE_IN_LOCAL,async t=>{throw new Error("Interface is deprecated!")}),W(re.SCHEMATIC.ADD,async(t,s)=>(await X(s).schematic.addData(t)).result),W(re.SCHEMATIC.UPDATE,async(t,s)=>await X(s).schematic.updateData(t)),W(re.SCHEMATIC.DEL,async(t,s)=>(await X(s).schematic.deleteData(t)).success),W(re.SCHEMATIC.GET_ALL_KV,async t=>(await X(t).schematic.getAllKVData()).result),W(re.SCHEMATIC.GET_UUID_BY_NAME,async(t,s)=>{var i;return(i=await X(s).schematic.getIdByName(t))==null?void 0:i.result}),W(re.SCHEMATIC.GET_NAME_BY_UUID,async(t,s)=>{var i;return(i=await X(s).schematic.getNameById(t))==null?void 0:i.result}),W(re.SCHEMATIC.GET_DISPLAY_NAME_BY_UUID,async(t,s)=>{var i;return(i=await X(s).schematic.getDisplayNameById(t))==null?void 0:i.result}),W(re.SCHEMATIC.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).schematic.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.SCHEMATIC.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).schematic.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.SCHEMATIC.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).schematic.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SCHEMATIC.GET_LAST,async(t,s)=>{var i;return(i=await X(s).schematic.getLastData(t))==null?void 0:i.result}),W(re.SCHEMATIC.TRY_RENAME,async(t,s)=>(await X(s).schematic.tryRename(t)).result),W(re.SCHEMATIC.BATCH_DELETE,async(t,s)=>(await X(s).schematic.batchDelete(t)).result)}function SH(e){W(re.SHEET.ADD,async(t,s)=>(await X(s).sheet.addData(t)).result),W(re.SHEET.DEL,async(t,s)=>(await X(s).sheet.deleteData(t)).success),W(re.SHEET.UPDATE,async(t,s)=>await X(s).sheet.updateData(t)),W(re.SHEET.UPDATE_LOTS,async(t,s)=>{throw new Error("Interface is deprecated!")}),W(re.SHEET.GET_ALL_KV,async(t,s)=>{var i;return(i=await X(s).sheet.getAllKVData(t))==null?void 0:i.result}),W(re.SHEET.GET,async(t,s)=>{var i;return(i=await X(s).sheet.getData(t))==null?void 0:i.result}),W(re.SHEET.GET_ALL_ARR,async(t,s)=>{var r;try{return(r=await X(s).sheet.getAllArrData(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SHEET.GET_LOTS_ARR,async(t,s)=>{var r;try{return(r=await X(s).sheet.getLotsArrData(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SHEET.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).sheet.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.SHEET.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).sheet.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SHEET.GET_LAST,async(t,s)=>{var i;return(i=await X(s).sheet.getLastData(t))==null?void 0:i.result}),W(re.SHEET.TRY_RENAME,async(t,s,r)=>(await X(r).sheet.tryRename(t,s)).result),W(re.SHEET.SET_CANVAS,async(t,s,r)=>{var n;return(n=await X(r).sheet.setCanvas(t,s))==null?void 0:n.success}),W(re.SHEET.COVER_CANVAS,async(t,s,r,i)=>{var a;return(a=await X(i).sheet.coverCanvas(t,s,r))==null?void 0:a.result}),W(re.SHEET.BATCH_DELETE,async(t,s)=>(await X(s).sheet.batchDelete(t)).result),W(re.SHEET.GET_ALL_KEYS,async(t,s)=>(await X(s).sheet.getKeys(t)).result)}function _H(e){W(re.SIMULATION.ADD,async(t,s)=>(await X(s).simulation.addData(t)).result),W(re.SIMULATION.DEL,async(t,s)=>(await X(s).simulation.deleteData(t)).success),W(re.SIMULATION.UPDATE,async(t,s)=>await X(s).simulation.updateData(t)),W(re.SIMULATION.UPDATE_LOTS,async(t,s)=>{throw new Error("Interface is deprecated!")}),W(re.SIMULATION.GET_ALL_KV,async t=>{var r;return(r=await X(t).simulation.getAllKVData())==null?void 0:r.result}),W(re.SIMULATION.GET,async(t,s)=>{var i;return(i=await X(s).simulation.getData(t))==null?void 0:i.result}),W(re.SIMULATION.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).simulation.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.SIMULATION.GET_LOTS_ARR,async(t,s)=>{var r;try{return(r=await X(s).simulation.getLotsArrData(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SIMULATION.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).simulation.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.SIMULATION.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).simulation.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SIMULATION.GET_LAST,async(t,s)=>{var i;return(i=await X(s).simulation.getLastData(t))==null?void 0:i.result}),W(re.SIMULATION.TRY_RENAME,async(t,s)=>(await X(s).simulation.tryRename(t)).result),W(re.SIMULATION.SET_CANVAS,async(t,s,r)=>{var n;return(n=await X(r).simulation.setCanvas(t,s))==null?void 0:n.success}),W(re.SIMULATION.COVER_CANVAS,async(t,s,r,i)=>{var a;return(a=await X(i).simulation.coverCanvas(t,s,r))==null?void 0:a.result}),W(re.SIMULATION.BATCH_DELETE,async(t,s)=>(await X(s).simulation.batchDelete(t)).result),W(re.SIMULATION.GET_ALL_KEYS,async t=>(await X(t).simulation.getKeys()).result)}function AH(e){W(re.PCB.GET_BY_TITLE,async(t,s)=>{var i,n;return(n=(i=await X(s).pcb.getDataByTitle(t))==null?void 0:i.result)==null?void 0:n[0]}),W(re.PCB.GET,async(t,s)=>{var i;return(i=await X(s).pcb.getData(t))==null?void 0:i.result}),W(re.PCB.GET_UUID_BY_TITLE,async(t,s)=>{var i;return(i=await X(s).pcb.getIdByTitle(t))==null?void 0:i.result}),W(re.PCB.ADD,async(t,s)=>{var i;return(i=await X(s).pcb.addData(t))==null?void 0:i.result}),W(re.PCB.DEL,async(t,s)=>{var i;return(i=await X(s).pcb.deleteData(t))==null?void 0:i.success}),W(re.PCB.UPDATE,async(t,s)=>await X(s).pcb.updateData(t)),W(re.PCB.CREATE_SUB,async(t,s)=>await X(s).pcb.createSub(t)),W(re.PCB.UPDATE_SUB,async(t,s)=>await X(s).pcb.updateSubInherit(t)),W(re.PCB.UPDATE_LOTS,async(t,s)=>{throw new Error("Interface is deprecated!")}),W(re.PCB.GET_ALL_KV,async t=>{var r;return(r=await X(t).pcb.getAllKVData())==null?void 0:r.result}),W(re.PCB.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).pcb.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.PCB.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).pcb.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.PCB.GET_LAST,async(t,s)=>{var i;return(i=await X(s).pcb.getLastData(t))==null?void 0:i.result}),W(re.PCB.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).pcb.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.PCB.TRY_RENAME,async(t,s)=>(await X(s).pcb.tryRename(t)).result),W(re.PCB.SET_CANVAS,async(t,s,r)=>{var n;return(n=await X(r).pcb.setCanvas(t,s))==null?void 0:n.success}),W(re.PCB.COVER_CANVAS,async(t,s,r,i)=>{var a;return(a=await X(i).pcb.coverCanvas(t,s,r))==null?void 0:a.result}),W(re.PCB.BATCH_DELETE,async(t,s)=>(await X(s).pcb.batchDelete(t)).result),W(re.PCB.GET_ALL_KEYS,async t=>(await X(t).pcb.getKeys()).result)}function CH(e){W(re.PANEL.ADD,async(t,s)=>(await X(s).panel.addData(t)).result),W(re.PANEL.DEL,async(t,s)=>(await X(s).panel.deleteData(t)).success),W(re.PANEL.GET,async(t,s)=>{var i;return(i=await X(s).panel.getData(t))==null?void 0:i.result}),W(re.PANEL.UPDATE,async(t,s)=>await X(s).panel.updateData(t)),W(re.PANEL.GET_ALL_KV,async t=>{var r;return(r=await X(t).panel.getAllKVData())==null?void 0:r.result}),W(re.PANEL.UPDATE_LOTS,async(t,s)=>{throw new Error("Interface is deprecated!")}),W(re.PANEL.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).panel.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.PANEL.TRY_RENAME,async(t,s)=>(await X(s).panel.tryRename(t)).result),W(re.PANEL.SET_CANVAS,async(t,s,r)=>{var n;return(n=await X(r).panel.setCanvas(t,s))==null?void 0:n.success}),W(re.PANEL.COVER_CANVAS,async(t,s,r,i)=>{var a;return(a=await X(i).panel.coverCanvas(t,s,r))==null?void 0:a.result}),W(re.PANEL.BATCH_DELETE,async(t,s)=>(await X(s).panel.batchDelete(t)).result),W(re.PANEL.GET_ALL_KEYS,async t=>(await X(t).panel.getKeys()).result)}function DH(e){W(re.SYMBOL.GET_BY_TITLE,async(t,s)=>{var i;return(i=await X(s).symbol.getArrDataByTitle(t))==null?void 0:i.result}),W(re.SYMBOL.GET,async(t,s)=>{var i;return(i=await X(s).symbol.getData(t))==null?void 0:i.result}),W(re.SYMBOL.ADD,async(t,s)=>{var i;return(i=await X(s).symbol.addData(t))==null?void 0:i.result}),W(re.SYMBOL.CLONE,async(t,s)=>{var i;return(i=await X(s).symbol.clone(t))==null?void 0:i.result}),W(re.SYMBOL.DEL,async(t,s)=>{var i;return(i=await X(s).symbol.deleteData(t))==null?void 0:i.success}),W(re.SYMBOL.UPDATE,async(t,s)=>(await X(s).symbol.updateData(t)).result),W(re.SYMBOL.GET_UUID_BY_TITLE,async(t,s)=>{var i;return(i=await X(s).symbol.getIdByTitle(t))==null?void 0:i.result}),W(re.SYMBOL.GET_TITLE_BY_UUID,async(t,s)=>{var i;return(i=await X(s).symbol.getTitleById(t))==null?void 0:i.result}),W(re.SYMBOL.GET_ALL_KV,async t=>{var r;return(r=await X(t).symbol.getAllKVData())==null?void 0:r.result}),W(re.SYMBOL.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).symbol.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.SYMBOL.GET_COMPARE_TICKET,async(t,s,r)=>{}),W(re.SYMBOL.GET_LAST,async(t,s)=>{var i;return(i=await X(s).symbol.getLastSymbol(t))==null?void 0:i.result}),W(re.SYMBOL.GET_ALL_KEYS,async t=>{var r;return(r=await X(t).symbol.getKeys())==null?void 0:r.result}),W(re.SYMBOL.IS_EXIST,async(t,s)=>{var i;return(i=await X(s).symbol.isExist(t))==null?void 0:i.result}),W(re.SYMBOL.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).symbol.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.SYMBOL.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).symbol.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SYMBOL.GET_KEYS_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).symbol.getKeysBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SYMBOL.GET_ALL_ARR_BY_TYPE,async(t=!1,s)=>{var r;try{return(r=await X(s).symbol.getArrDataByType(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.SYMBOL.IS_CHANGE,async(t,s)=>(await X(s).symbol.isChange(t)).result),W(re.SYMBOL.IS_RENAME,async(t,s)=>(await X(s).symbol.isRename(t)).result),W(re.SYMBOL.TRY_RENAME,async(t,s)=>(await X(s).symbol.tryRename(t)).result),W(re.SYMBOL.WITH_ORIGINS,async(t=!1,s)=>{var i;return(i=await X(s).symbol.withOrigins(t))==null?void 0:i.result}),W(re.SYMBOL.GET_STR,async(t,s)=>{var i;return(i=await X(s).symbol.getStr(t))==null?void 0:i.result}),W(re.SYMBOL.SET_CANVAS,async(t,s,r)=>{var n;return(n=await X(r).symbol.setCanvas(t,s))==null?void 0:n.success}),W(re.SYMBOL.COVER_CANVAS,async(t,s,r,i)=>{var a;return(a=await X(i).symbol.coverCanvas(t,s,r))==null?void 0:a.result}),W(re.SYMBOL.BATCH_DELETE,async(t,s)=>(await X(s).symbol.batchDelete(t)).result),W(re.SYMBOL.GET_LIST,async t=>await X(t.path).symbol.list(t))}function PH(e){W(re.FOOTPRINT.GET,async(t,s)=>{var i;return(i=await X(s).footprint.getData(t))==null?void 0:i.result}),W(re.FOOTPRINT.GET_BY_TITLE,async(t,s)=>{var i;return(i=await X(s).footprint.getArrDataByTitle(t))==null?void 0:i.result}),W(re.FOOTPRINT.IS_EXIST,async(t,s)=>{var i;return(i=await X(s).footprint.isExist(t))==null?void 0:i.result}),W(re.FOOTPRINT.ADD,async(t,s)=>{var i;return(i=await X(s).footprint.addData(t))==null?void 0:i.result}),W(re.FOOTPRINT.CLONE,async(t,s)=>{var i;return(i=await X(s).footprint.clone(t))==null?void 0:i.result}),W(re.FOOTPRINT.DEL,async(t,s)=>{var i;return(i=await X(s).footprint.deleteData(t))==null?void 0:i.success}),W(re.FOOTPRINT.UPDATE,async(t,s)=>(await X(s).footprint.updateData(t)).result),W(re.FOOTPRINT.GET_ALL_KV,async t=>{var r;return(r=await X(t).footprint.getAllKVData())==null?void 0:r.result}),W(re.FOOTPRINT.UPDATE_IN_LOCAL,async(t,s,r)=>{throw new Error("Interface is deprecated!")}),W(re.FOOTPRINT.GET_TITLE_BY_UUID,async(t,s)=>{var i;return(i=await X(s).footprint.getTitleById(t))==null?void 0:i.result}),W(re.FOOTPRINT.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).footprint.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.FOOTPRINT.GET_COMPARE_TICKET,async(t,s,r)=>{}),W(re.FOOTPRINT.GET_LAST,async(t,s)=>{var i;return(i=await X(s).footprint.getLastData(t))==null?void 0:i.result}),W(re.FOOTPRINT.GET_ALL_KEYS,async t=>{var r;return(r=await X(t).footprint.getKeys())==null?void 0:r.result}),W(re.FOOTPRINT.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).footprint.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.FOOTPRINT.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).footprint.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.FOOTPRINT.GET_KEYS_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).footprint.getKeysBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.FOOTPRINT.GET_ALL_ARR_BY_PCB_UUID,async(t,s)=>{var r;try{return(r=await X(s).footprint.getAllArrDataByPcbId(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.FOOTPRINT.GET_KEYS_BY_PCB_UUID,async(t,s)=>{var r;try{return(r=await X(s).footprint.getKeysByPcbId(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.FOOTPRINT.IS_CHANGE,async(t,s)=>(await X(s).footprint.isChange(t)).result),W(re.FOOTPRINT.IS_RENAME,async(t,s)=>(await X(s).footprint.isRename(t)).result),W(re.FOOTPRINT.TRY_RENAME,async(t,s)=>(await X(s).footprint.tryRename(t)).result),W(re.FOOTPRINT.WITH_ORIGINS,async t=>{var r;return(r=await X(t).footprint.withOrigins())==null?void 0:r.result}),W(re.FOOTPRINT.GET_STR,async(t,s)=>{var i;return(i=await X(s).footprint.getStr(t))==null?void 0:i.result}),W(re.FOOTPRINT.SET_CANVAS,async(t,s,r)=>{var n;return(n=await X(r).footprint.setCanvas(t,s))==null?void 0:n.success}),W(re.FOOTPRINT.COVER_CANVAS,async(t,s,r,i)=>{var a;return(a=await X(i).footprint.coverCanvas(t,s,r))==null?void 0:a.result}),W(re.FOOTPRINT.BATCH_DELETE,async(t,s)=>(await X(s).footprint.batchDelete(t)).result),W(re.FOOTPRINT.GET_LIST,async t=>await X(t.path).footprint.list(t))}function OH(e){W(re.DEVICE.GET,async(t,s)=>{var i;return(i=await X(s).device.getData(t))==null?void 0:i.result}),W(re.DEVICE.GET_BY_TITLE,async(t,s)=>{var i;return(i=await X(s).device.getArrDataByTitle(t))==null?void 0:i.result}),W(re.DEVICE.ADD,async(t,s)=>{var i;return(i=await X(s).device.addData(t))==null?void 0:i.result}),W(re.DEVICE.DEL,async(t,s)=>{var i;return(i=await X(s).device.deleteData(t))==null?void 0:i.success}),W(re.DEVICE.GET_ALL_KV,async t=>{var r;return(r=await X(t).device.getAllKVData())==null?void 0:r.result}),W(re.DEVICE.PLACE,async(t,s)=>await X(s).device.place(t)),W(re.DEVICE.UPDATE,async(t,s)=>(await X(s).device.updateData(t)).result),W(re.DEVICE.GET_TITLE_BY_UUID,async(t,s)=>{var i;return(i=await X(s).device.getTitleById(t))==null?void 0:i.result}),W(re.DEVICE.GET_SYMBOL_UUID,async(t,s)=>{var i;return(i=await X(s).device.getSymbolIdById(t))==null?void 0:i.result}),W(re.DEVICE.GET_BY_SOURCE_VERSION,async(t,s,r)=>{var n;return(n=await X(r).device.getDataBySourceAndVersion({source:t,version:s}))==null?void 0:n.result}),W(re.DEVICE.GET_LAST,async(t,s)=>{var i;return(i=await X(s).device.getLastData(t))==null?void 0:i.result}),W(re.DEVICE.GET_ALL_KEYS,async t=>{var r;return(r=await X(t).device.getKeys())==null?void 0:r.result}),W(re.DEVICE.GET_ALL_ARR_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).device.getAllArrDataBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.DEVICE.GET_KEYS_BY_SOURCE,async(t,s)=>{var r;try{return(r=await X(s).device.getKeysBySource(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.DEVICE.GET_COMPARE_TICKET,async(t,s,r)=>{}),W(re.DEVICE.IS_EXIST,async(t,s)=>{var i;return(i=await X(s).device.isExist(t))==null?void 0:i.result}),W(re.DEVICE.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).device.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.DEVICE.GET_ALL_ARR_BY_SYMBOL_UUID,async(t,s)=>{var r;try{return(r=await X(s).device.getAllArrDatasBySymbolId(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.DEVICE.GET_ALL_ARR_BY_FOOTPRINT_UUID,async(t,s)=>{var r;try{return(r=await X(s).device.getAllArrDatasByFootprintId(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.DEVICE.TRY_RENAME,async(t,s)=>(await X(s).device.tryRename(t)).result),W(re.DEVICE.IS_CHANGE,async(t,s)=>(await X(s).device.isChange(t)).result),W(re.DEVICE.IS_RENAME,async(t,s)=>(await X(s).device.isRename(t)).result),W(re.DEVICE.BIND_SYMBOL,async(t,s)=>(await X(s).device.bindSymbol(t)).result),W(re.DEVICE.BIND_fOOTPRINT,async(t,s)=>(await X(s).device.bindFootprint(t)).result),W(re.DEVICE.WITH_ORIGINS,async t=>{var r;return(r=await X(t).device.withOrigins())==null?void 0:r.result}),W(re.DEVICE.BATCH_DELETE,async(t,s)=>(await X(s).device.batchDelete(t)).result),W(re.DEVICE.GET_LIST,async t=>await X(t.path).device.list(t))}function IH(e){W(re.ATTR.GET,async(t,s)=>{var i;return(i=await X(s).instance.getData(t))==null?void 0:i.result}),W(re.ATTR.UPDATE,async(t,s)=>(await X(s).instance.batchUpdate([t])).success),W(re.ATTR.BATCH_UPDATE,async(t,s)=>{var i;return(i=await X(s).instance.batchUpdate(t))==null?void 0:i.success}),W(re.ATTR.ADD,async(t,s)=>{var i;return(i=await X(s).instance.addData(t))==null?void 0:i.result}),W(re.ATTR.DEL,async(t,s)=>{var i;return(i=await X(s).instance.deleteData(t))==null?void 0:i.success}),W(re.ATTR.GET_ALL_KV,async t=>{var r;return(r=await X(t).instance.getAllKVData())==null?void 0:r.result}),W(re.ATTR.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).instance.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.ATTR.GET_ALL_ARR_BY_HASH,async(t,s)=>{var r;try{return(r=await X(s).instance.getAllArrDataByHash(t))==null?void 0:r.result}catch(i){return Ns.error(i),[]}}),W(re.ATTR.BATCH_DELETE,async(t,s)=>(await X(s).instance.batchDelete(t)).result)}function xH(e){W(re.BLOB.GET,async(t,s)=>{var i;return(i=await X(s).blob.getData(t))==null?void 0:i.result}),W(re.BLOB.ADD,async(t,s)=>{var i;return(i=await X(s).blob.addData(t))==null?void 0:i.result}),W(re.BLOB.DEL,async(t,s)=>{var i;return(i=await X(s).blob.deleteData(t))==null?void 0:i.success}),W(re.BLOB.GET_ALL_ARR,async t=>{var s;try{return(s=await X(t).blob.getAllArrData())==null?void 0:s.result}catch(r){return Ns.error(r),[]}}),W(re.BLOB.BATCH_DELETE,async(t,s)=>(await X(s).blob.batchDelete(t)).result)}function vH(e){W(re.VARIANT.BATCH_ADD,async(t,s)=>X(s).workerBus.rpcCall(K.variant.batchAdd,t)),W(re.VARIANT.ADD,async(t,s)=>X(s).workerBus.rpcCall(K.variant.add,t)),W(re.VARIANT.DELETE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.delete,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.BATCH_DELETE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.BATCH_RESTORE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.batchRestore,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.GET,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.get,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.GET_ALL_ARR_BY_SID,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.getAllArr,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.UPDATE_TITLE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.updateTitle,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.UPDATE_NOT_GROUPED,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.updateNotGrouped,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.VARIANT.BATCH_UPDATE_SORT,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.variant.batchUpdateZIndex,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.BATCH_ADD,async(t,s)=>X(s).workerBus.rpcCall(K.componentGroup.batchAdd,t)),W(re.COMPONENT_GROUP.ADD,async(t,s)=>X(s).workerBus.rpcCall(K.componentGroup.add,t)),W(re.COMPONENT_GROUP.DELETE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.delete,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.BATCH_DELETE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.batchDelete,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.BATCH_RESTORE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.batchRestore,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.GET,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.get,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.GET_ALL_ARR_BY_SID,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.getAllArr,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.GET_ATTR_DATA,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.getAttr,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.UPDATE_TITLE,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.updateTitle,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.BATCH_UPDATE_SORT,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.batchUpdateZIndex,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.BATCH_UPLOAD_VARIANT_INDEX,async(t,s)=>X(s).workerBus.rpcCall(K.componentGroup.batchUploadGroupSortInVariant,t)),W(re.COMPONENT_GROUP.BATCH_DELETE_VARIANT_INDEX,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.batchDeleteGroupSortInVariant,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.UPLOAD_ATTR_DATA,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.uploadComponentGroupData,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}}),W(re.COMPONENT_GROUP.BATCH_DELETE_ATTR_DATA,async(t,s)=>{let r=X(s);return r!=null&&r.isReady?r.workerBus.rpcCall(K.componentGroup.batchDeleteComponentGroupData,t):{success:!1,message:"\u5DE5\u7A0B\u5C1A\u672A\u6253\u5F00"}})}function RH(e){W(re.COPPER.GET,async t=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.ADD,async t=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.DEL_LOTS,async(t,s,r)=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.DEL,async t=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.GET_ALL_KEYS,async t=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.UPDATE,async(t,s)=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.GET_ALL_ARR,async()=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.GET_ALL_ARR_BY_PCB_UUID,async t=>{throw new Error("Interface is deprecated!")}),W(re.COPPER.GET_ALL_KEYS_BY_PCB_UUID,async t=>{throw new Error("Interface is deprecated!")})}function NH(e){W(re.FONT.GET,async t=>{throw new Error("Interface is deprecated!")}),W(re.FONT.ADD,async t=>{throw new Error("Interface is deprecated!")}),W(re.FONT.DEL_LOTS,async(t,s,r)=>{throw new Error("Interface is deprecated!")}),W(re.FONT.DEL,async t=>{throw new Error("Interface is deprecated!")}),W(re.FONT.GET_ALL_KEYS,async t=>{throw new Error("Interface is deprecated!")}),W(re.FONT.UPDATE,async(t,s)=>{throw new Error("Interface is deprecated!")}),W(re.FONT.GET_ALL_ARR,async()=>{throw new Error("Interface is deprecated!")}),W(re.FONT.GET_ALL_ARR_BY_PCB_UUID,async t=>{throw new Error("Interface is deprecated!")}),W(re.FONT.GET_ALL_KEYS_BY_PCB_UUID,async t=>{throw new Error("Interface is deprecated!")})}var Th=class e extends Pl{static getInstance(t=6e4,s=[]){if(e.tool==null)throw new Error("The upload log module does not exist!");return e.tool}static setInstance(t=6e4,s=[]){return e.tool==null&&(e.tool=new e(t,s)),e.tool}beforeMount(){}mounted(){}destoryed(){e.tool=null}suspended(){}resumed(){}async todo(){let t=await this.upload();await this.del(t)}async upload(){let t=await ft.stores.log.getAllArrData();if(!t||!t.length)return;let{message:s}=await fe.messageBus.rpcCall("getUserId"),r=t.filter(a=>a.owner===s);if(!r||!r.length)return;let i=[],{projectId:n}=fe.currentProject;return await yl(MI,r,async a=>{let o=a.map(l=>({...l,type:l.type,content:l.content,time:l.time,project_uuid:l.project_uuid})),c=await se.getInstance().other.log({path:n,logs:o});if(c.success===!0)i=i.concat(a);else{let l=Dt(c)||c.message;jt("error",[{text:l}]),console.error("\u65E5\u5FD7\u4E0A\u4F20\u5931\u8D25:",o)}}),i}async del(t){if(!t||!t.length)return null;let s=t.map(i=>i.id);return await ft.stores.log.delLotsData(s)}};var Wwe=new ut(1),qwe=new ut(2),Jwe=new ut(3);function _x(){let e=fe.messageBus;BH(e),kH(e),MH(e),jH(e)}function BH(e){W(ms.OPEN,async(t,s)=>await fI(t,s)),W(ms.CLOSE,async t=>{if(X(t).uuid===t)return await mI(t);throw new Error("Close non-current projects!")}),W(ms.TEMP_OPEN,async t=>await lh(t)),W(ms.TEMP_OPEN_BY_STRING,async t=>await gI(t)),W(ms.TEMP_CLOSE,async t=>await Bp(t)),gi(ms.ON_OPENED,t=>{da&&Th.setInstance().mount()}),W(ms.BEFORE_CLOSE,async t=>{}),gi(ms.ON_CLOSED,t=>{da&&Th.getInstance().destory()}),gi(ms.ON_FAILED,t=>{}),W(ms.GET_RECENT_PROJECT_LIST,async t=>await uI(t)),W(ms.DEL_PROJECT,async t=>await cI(t)),W(ms.UPDATE_PROJECT,async(t,s)=>await lI(t,s)),W(ms.HAS,async t=>await Ge(t))}function kH(e){W("/pro-mgr/project/sync/force",async t=>{}),gi("/pro-mgr/project/sync/suspend",t=>{}),gi("/pro-mgr/project/sync/resume",t=>{})}function MH(e){W("/pro-mgr/project/upload/force",async t=>{}),W("/pro-mgr/project/upload/processing",t=>{}),W("/pro-mgr/project/upload/needUpload",async t=>{}),W("/pro-mgr/project/upload/getStatus",t=>{})}function jH(e){W(Us.PUBLIC.FORCE,async t=>await X(t).updateData.force()),gi(Us.PUBLIC.SUSPEND,t=>X(t).updateData.suspend()),gi(Us.PUBLIC.RESUME,t=>X(t).updateData.resume()),W(Us.PUBLIC.IS_PUBLIC,async(t,s)=>await X(s).updateData.isPublic(t)),W(Us.PUBLIC.UPDATE_TEAM,async t=>await X(t).updateData.updateTeam()),W(Us.PUBLIC.GET,async(t,s,r)=>await X(r).updateData.getLastest(t,s)),W(Us.SCHEMATIC.UPDATE,async t=>await X(t).updateData.schematic.update()),W(Us.SHEET.UPDATE,async t=>await X(t).updateData.sheet.update()),W(Us.PCB.UPDATE,async t=>await X(t).updateData.pcb.update()),W(Us.SYMBOL.UPDATE,async t=>await X(t).updateData.symbol.update()),W(Us.FOOTPRINT.UPDATE,async t=>await X(t).updateData.footprint.update()),W(Us.DEVICE.UPDATE,async t=>await X(t).updateData.device.update()),W(Us.SCHEMATIC.GET,async(t,s)=>await X(s).updateData.schematic.getData(t)),W(Us.SHEET.GET,async(t,s)=>await X(s).updateData.sheet.getData(t)),W(Us.PCB.GET,async(t,s)=>await X(s).updateData.pcb.getData(t)),W(Us.SYMBOL.GET,async(t,s)=>await X(s).updateData.symbol.getData(t)),W(Us.FOOTPRINT.GET,async(t,s)=>await X(s).updateData.footprint.getData(t)),W(Us.DEVICE.GET,async(t,s)=>await X(s).updateData.device.getData(t)),W(Us.SCHEMATIC.MAP,async t=>await X(t).updateData.schematic.getMap()),W(Us.SHEET.MAP,async t=>await X(t).updateData.sheet.getMap()),W(Us.PCB.MAP,async t=>await X(t).updateData.pcb.getMap()),W(Us.SYMBOL.MAP,async t=>await X(t).updateData.symbol.getMap()),W(Us.FOOTPRINT.MAP,async t=>await X(t).updateData.footprint.getMap()),W(Us.DEVICE.MAP,async t=>await X(t).updateData.device.getMap())}function Ax(){let e=To(`/${window._TAB_ID_}/notify`),t=!1,s;function r(n){t&&n&&(fe.messageBus.publish("/pro-mgr/project/ws/settimer",performance.now()),s=e.subscribe(`/pro-mgr/notify/message/project/${n}/g_ticket`,({msg:a})=>{let{g_ticket:o}=a,c=wt();!c.isClosing&&c.sync.switch&&o&&c.ticket.gTicket&&o>c.ticket.gTicket&&(fe.messageBus.publish("/pro-mgr/project/ws/settimer",performance.now()),fe.messageBus.rpcCall("/pro-mgr/project/sync/force"))}))}function i(){s&&(s.cancel(),s=null),fe.currentProject.projectId&&fe.messageBus.publish("/pro-mgr/project/ws/settimer",null)}e.subscribe("/pro-mgr/notify/established",()=>{console.log("ws established"),t=!0}),e.subscribe("/pro-mgr/notify/closed",()=>{console.log("ws closed"),t=!1}),e.rpcService("/pro-mgr/notify/getWsId",()=>self._WS_ID_),e.rpcService("/pro-mgr/notify/hasProject",n=>{let a=gl(n);return!!a&&a.isReady}),fe.messageBus.subscribe("/pro-mgr/organization/init",([n])=>{e.publish("/pro-mgr/notify/send",{topic:"/org/watch/openLib",uuid:n})}),fe.messageBus.subscribe("/pro-mgr/organization/init",([n])=>{e.publish("/pro-mgr/notify/send",{topic:"/org/watch/openLib",uuid:n})}),fe.messageBus.subscribe(ms.ON_OPENED,([n])=>{console.log("project opened",n)}),fe.messageBus.subscribe(ms.ON_CLOSED,([n])=>{console.log("project closed",n),i()}),fe.messageBus.subscribe("/pro-mgr/project/ws/settimer",n=>{let a=wt();a&&(a.sync.wsTimer=n)})}var h2e=new ut(1),d2e=new ut(2),p2e=new ut(3);function Cx(){let e=fe.messageBus;W("/pro-mgr/isEncrypted",async t=>await sf(t)),W("/pro-mgr/checkPassword",async(t,s)=>await Ex(t,s)),W("/pro-mgr/savePassword",async(t,s)=>await yh(t,s)),W("/pro-mgr/getFileNameArrByJSZip",async t=>await yx(t)),W("/pro-mgr/handleTargetDuplicateNames",async({type:t,title:s})=>{throw new Error("Interface is deprecated!")}),W("/pro-mgr/filterIllegalSource",async t=>{throw new Error("Interface is deprecated!")})}var A2e=new ut(1),C2e=new ut(2),D2e=new ut(3);function Dx(){let e=fe.messageBus;W(lE.GET_DATA_STR,async t=>await new qt(t).getStr()),W("/pro-mgr/delSheetRelatedData",async({uuids:t,projectId:s})=>{throw new Error("Api call error!")}),W("/pro-mgr/delPcbRelatedData",async({uuid:t,projectId:s})=>{throw new Error("Api call error!")}),W("/pro-mgr/savePcbRelatedData",async({pcbId:t,relatedData:s})=>{throw new Error("Api call error!")}),W("/pro-mgr/setBlob",async({dataUrl:t,fileName:s})=>{throw new Error("Api call error!")}),W("/pro-mgr/getBlob",async({hash:t})=>{throw new Error("Api call error!")}),gi(As.PROJECT.ON_UPDATE,async({ops:t,projectId:s})=>{let r=(t==null?void 0:t.project)||(t==null?void 0:t.initPrj)||t||{};r.title&&r.title!==fe.currentProject.title&&(fe.currentProject.title=r.title),r.cbb_project!==void 0&&r.cbb_project!==fe.currentProject.isCBB&&(fe.currentProject.isCBB=r.cbb_project)}),W("/pro-mgr/getDataStr",async t=>{throw new Error("Illegally obtained source code!")}),gi(As.SYMBOL.ON_ADD,async t=>{let{uuid:s,projectId:r}=t;X(r).updateData.symbol.setHasOrigin(!0)}),gi(As.FOOTPRINT.ON_ADD,async t=>{let{uuid:s,projectId:r}=t;X(r).updateData.footprint.setHasOrigin(!0)}),gi(As.DEVICE.ON_ADD,async t=>{let{uuid:s,projectId:r}=t;X(r).updateData.device.setHasOrigin(!0)}),gi(As.SCHEMATIC.ON_ADD,async t=>{let{uuid:s,projectId:r}=t;X(r).updateData.schematic.setHasOrigin(!0)}),gi(As.SHEET.ON_ADD,async t=>{let{uuid:s,projectId:r}=t;X(r).updateData.sheet.setHasOrigin(!0)}),gi(As.PCB.ON_ADD,async t=>{let{uuid:s,projectId:r}=t;X(r).updateData.pcb.setHasOrigin(!0)})}var FH="__LOCAL_HELPER__",tw=class{constructor(){self[FH]=this}async project(t){let{message:s}=await fe.messageBus.rpcCall(_s.PROJECT.GET,[t]);return console.log(s),s}async copy(){let{message:t}=await fe.messageBus.rpcCall(_s.COPYANDPASTE.GET);return console.log(t),t}async copytable(){let{message:t}=await fe.messageBus.rpcCall(_s.COPYANDPASTE_TABLE_CELL.GET);return console.log(t),t}async lib(t){let{message:s}=await fe.messageBus.rpcCall(_s.LIB.GET,[t]);return console.log(s),s}async clioBoard(t){let{message:s}=await fe.messageBus.rpcCall(_s.CLIP_BOARD.GET,[t]);return console.log(s),s}async lockPorject(t){let{message:s}=await fe.messageBus.rpcCall(_s.LOCK_PROJECT.GET,[t]);return console.log(s),s}async projectCache(t){let{message:s}=await fe.messageBus.rpcCall(_s.PROJECT_CACHE.GET,[t]);return console.log(s),s}async project1(t){let{message:s}=await fe.messageBus.rpcCall(re.PROJECT.GET,[t]);return console.log(s),s}async schematic(t){let{message:s}=await fe.messageBus.rpcCall(re.SCHEMATIC.GET,[t]);return console.log(s),s}async sheet(t){let{message:s}=await fe.messageBus.rpcCall(re.SHEET.GET,[t]);return console.log(s),s}async pcb(t){let{message:s}=await fe.messageBus.rpcCall(re.PCB.GET,[t]);return console.log(s),s}async panel(t){let{message:s}=await fe.messageBus.rpcCall(re.PANEL.GET,[t]);return console.log(s),s}async symbol(t){let{message:s}=await fe.messageBus.rpcCall(re.SYMBOL.GET,[t]);return console.log(s),s}async footprint(t){let{message:s}=await fe.messageBus.rpcCall(re.FOOTPRINT.GET,[t]);return console.log(s),s}async device(t){let{message:s}=await fe.messageBus.rpcCall(re.DEVICE.GET,[t]);return console.log(s),s}async attr(t){let{message:s}=await fe.messageBus.rpcCall(re.ATTR.GET,[t]);return console.log(s),s}async blob(t){let{message:s}=await fe.messageBus.rpcCall(re.BLOB.GET,[t]);return console.log(s),s}async copper(t){let{message:s}=await fe.messageBus.rpcCall(re.COPPER.GET,[t]);return console.log(s),s}async font(t){let{message:s}=await fe.messageBus.rpcCall(re.FONT.GET,[t]);return console.log(s),s}};function Px(){new tw}var B2e=new kc(Bc.INFO),k2e=new kc(Bc.WARN),M2e=new kc(Bc.ERROR);function Ox(){let e=fe.messageBus;UH(e),HH(e),YH(e),VH(e),zH(e),WH(e),qH(e),JH(e),KH(e),XH(e),ZH(e),$H(e)}function UH(e){W(Me.PROJECT.LIST,async t=>await se.getInstance().project.list(t)),W(Me.PROJECT.CREATE,async t=>await se.getInstance().project.create(t)),W(Me.PROJECT.GET,async t=>await se.getInstance().project.get(t)),W(Me.PROJECT.UPDATE,async t=>await se.getInstance().project.update(t)),W(Me.PROJECT.DELETE,async t=>await se.getInstance().project.delete(t)),W(Me.PROJECT.TICKET,async t=>await se.getInstance().project.ticket(t)),W(Me.PROJECT.TICKET1,async t=>await se.getInstance().project.ticket1(t)),W(Me.PROJECT.BACKUP_LIST,async t=>await se.getInstance().project.backupList(t)),W(Me.PROJECT.BACKUP,async t=>await se.getInstance().project.backup(t)),W(Me.PROJECT.GET_BACKUP,async t=>await se.getInstance().project.getBackup(t)),W(Me.PROJECT.DELETE_BACKUP,async t=>await se.getInstance().project.deleteBackup(t)),W(Me.PROJECT.ARCHIVE,async t=>await se.getInstance().project.archive(t)),W(Me.PROJECT.CREATE_BOARD,async t=>await se.getInstance().project.createBoards(t)),W(Me.PROJECT.STAR,async t=>await se.getInstance().project.star(t)),W(Me.PROJECT.UNSTAR,async t=>await se.getInstance().project.unstar(t)),W(Me.PROJECT.GET_PROFILE,async t=>await se.getInstance().project.getProfile(t))}function HH(e){W(Me.SCHEMATIC.LIST,async t=>await se.getInstance().schematic.list(t)),W(Me.SCHEMATIC.CREATE,async t=>await se.getInstance().schematic.create(t)),W(Me.SCHEMATIC.UPLOAD,async t=>await se.getInstance().schematic.upload(t)),W(Me.SCHEMATIC.DELETE,async t=>await se.getInstance().schematic.delete(t)),W(Me.SCHEMATIC.UPDATE,async t=>await se.getInstance().schematic.update(t))}function GH(e){return e.needStr=!1,e}function YH(e){W(Me.DOCUMENT.LIST,async t=>await se.getInstance().document.list(t)),W(Me.DOCUMENT.CREATE,async t=>await se.getInstance().document.create(t)),W(Me.DOCUMENT.UPLOAD,async t=>await se.getInstance().document.upload(t)),W(Me.DOCUMENT.UPDATE,async t=>await se.getInstance().document.update(t)),W(Me.DOCUMENT.BATCH_UPDATE,async t=>await se.getInstance().document.batchUpdate(t)),W(Me.DOCUMENT.DELETE,async t=>await se.getInstance().document.delete(t)),W(Me.DOCUMENT.GET,async t=>await se.getInstance().document.get(GH(t))),W(Me.DOCUMENT.GET_BY_SID,async t=>await se.getInstance().document.getBySid(t)),W(Me.DOCUMENT.MOVE,async t=>await se.getInstance().document.move(t)),W(Me.DOCUMENT.CHECK_IN,async t=>await se.getInstance().document.checkIn(t)),W(Me.DOCUMENT.CHECK_OUT,async t=>await se.getInstance().document.checkOut(t)),W(Me.DOCUMENT.GET_CHECK,async t=>await se.getInstance().document.getCheck(t)),W(Me.DOCUMENT.DELETE_PCB_RELATED,async t=>await se.getInstance().document.deletePcbRelated(t))}function VH(e){W(Me.DEVICE.LIST,async t=>await se.getInstance().device.list(t)),W(Me.DEVICE.SEARCH_LIST,async t=>await se.getInstance().device.searchList(t)),W(Me.DEVICE.CREATE,async t=>await se.getInstance().device.create(t)),W(Me.DEVICE.UPLOAD,async t=>await se.getInstance().device.upload(t)),W(Me.DEVICE.UPDATE,async t=>await se.getInstance().device.update(t)),W(Me.DEVICE.BATCH_UPDATE,async t=>await se.getInstance().device.batchUpdate(t)),W(Me.DEVICE.GET,async t=>await se.getInstance().device.get(t)),W(Me.DEVICE.SEARCH_BY_USERS_AND_TITLES,async t=>await se.getInstance().device.searchByUsersAndTitles(t)),W(Me.DEVICE.GET_ATTR_VALUES,async t=>await se.getInstance().device.getAttributeValues(t)),W(Me.DEVICE.GET_ATTR_KEYS,async t=>await se.getInstance().device.getAttrKeys(t)),W(Me.DEVICE.DELETE,async t=>await se.getInstance().device.delete(t)),W(Me.DEVICE.STAR,async t=>await se.getInstance().device.star(t)),W(Me.DEVICE.UNSTAR,async t=>await se.getInstance().device.unstar(t)),W(Me.DEVICE.PLACE,async t=>await se.getInstance().device.place(t))}function zH(e){W(Me.COMPONENT.LIST,async t=>await se.getInstance().component.list(t)),W(Me.COMPONENT.SEARCH_LIST,async t=>await se.getInstance().component.searchList(t)),W(Me.COMPONENT.CREATE,async t=>await se.getInstance().component.create(t)),W(Me.COMPONENT.UPLOAD,async t=>await se.getInstance().component.upload(t)),W(Me.COMPONENT.UPDATE,async t=>await se.getInstance().component.update(t)),W(Me.COMPONENT.BATCH_UPDATE,async t=>await se.getInstance().component.batchUpdate(t)),W(Me.COMPONENT.DELETE,async t=>await se.getInstance().component.delete(t)),W(Me.COMPONENT.GET,async t=>await se.getInstance().component.get(t)),W(Me.COMPONENT.SEARCH_BY_USERS_AND_TITLES,async t=>await se.getInstance().component.searchByUsersAndTitles(t)),W(Me.COMPONENT.STAR,async t=>await se.getInstance().component.star(t)),W(Me.COMPONENT.UNSTAR,async t=>await se.getInstance().component.unstar(t)),W(Me.COMPONENT.GET_HISTORY,async t=>await se.getInstance().componentHistory.get(t)),W(Me.COMPONENT.SET_HISTORY,async t=>await se.getInstance().componentHistory.set(t)),W(Me.COMPONENT.GET_HISTORY_DATA,async t=>await se.getInstance().componentHistory.getHistoryData(t))}function WH(e){W(Me.TAG.LIST,async t=>await se.getInstance().tag.list(t)),W(Me.TAG.CREATE,async t=>await se.getInstance().tag.create(t)),W(Me.TAG.UPDATE,async t=>await se.getInstance().tag.update(t)),W(Me.TAG.DELETE,async t=>await se.getInstance().tag.delete(t))}function qH(e){W(Me.COPPER.SEARCH_LIST,async t=>await se.getInstance().copper.searchList(t)),W(Me.COPPER.SET,async t=>await se.getInstance().copper.set(t)),W(Me.COPPER.DELETE,async t=>await se.getInstance().copper.delete(t))}function JH(e){W(Me.FONT.SEARCH_LIST,async t=>await se.getInstance().font.searchList(t)),W(Me.FONT.SET,async t=>await se.getInstance().font.set(t)),W(Me.FONT.DELETE,async t=>await se.getInstance().font.delete(t))}function KH(e){W(Me.BLOB.SEARCH_LIST,async t=>await se.getInstance().blob.searchList(t)),W(Me.BLOB.SET,async t=>await se.getInstance().blob.set(t))}function XH(e){W(Me.ATTR.LIST,async t=>await se.getInstance().attr.list(t)),W(Me.ATTR.SEARCH_LIST,async t=>await se.getInstance().attr.searchList(t)),W(Me.ATTR.CREATE,async t=>await se.getInstance().attr.create(t)),W(Me.ATTR.UPLOAD,async t=>await se.getInstance().attr.upload(t)),W(Me.ATTR.DELETE,async t=>await se.getInstance().attr.delete(t)),W(Me.ATTR.TICKET,async t=>await se.getInstance().attr.ticket(t))}function ZH(e){W(Me.CLIENT.GET_BACKUP,async t=>await se.getInstance().client.getBackup(t)),W(Me.CLIENT.GET_LIBS,async t=>await se.getInstance().client.getLibs(t)),W(Me.CLIENT.CREATE_LIB,async t=>await se.getInstance().client.createLib(t)),W(Me.CLIENT.CREATE_PROJECT,async t=>await se.getInstance().client.createProject(t)),W(Me.CLIENT.OPEN_PROJECT,async t=>await se.getInstance().client.openProject(t)),W(Me.CLIENT.CLOSE_PROJECT,async t=>await se.getInstance().client.closeProject(t)),W(Me.CLIENT.GET_PROJECT_PATHS,async t=>await se.getInstance().client.getProjectPaths(t)),W(Me.CLIENT.SELECT_PATH,async t=>await se.getInstance().client.selectPath(t)),W(Me.CLIENT.OPEN_DIALOG,async t=>await se.getInstance().client.openDialog(t)),W(Me.CLIENT.SELECT_DIR,async t=>await se.getInstance().client.selectDir(t)),W(Me.CLIENT.SELECT_FILE,async t=>await se.getInstance().client.selectFile(t)),W(Me.CLIENT.EXPORT_FILE,async t=>await se.getInstance().client.exportFile(t)),W(Me.CLIENT.CACHE_LIST,async t=>await se.getInstance().client.cacheList(t)),W(Me.CLIENT.GET_CACHE,async t=>await se.getInstance().client.getCache(t)),W(Me.CLIENT.SET_CACHE,async t=>await se.getInstance().client.setCache(t)),W(Me.CLIENT.DELETE_CACHE,async(t,s)=>await se.getInstance().client.deleteCache(t,s)),W(Me.CLIENT.PROJECT_HISTORY,async t=>await se.getInstance().client.projectHistory()),W(Me.CLIENT.DELETE_HISTORY,async t=>await se.getInstance().client.deletHistory(t)),W(Me.CLIENT.SET_KV_CACHE,async(t,s)=>await se.getInstance().client.setKVCache(t,s)),W(Me.CLIENT.GET_KV_CACHE,async t=>await se.getInstance().client.getKVCache(t)),W(Me.CLIENT.IS_EXIST_KV_CACHE,async t=>await se.getInstance().client.isExistKVCache(t)),W(Me.CLIENT.OPEN_URL,async t=>await se.getInstance().client.openURL(t))}function $H(e){W(Me.OTHER.LOG,async t=>await se.getInstance().other.log(t)),W(Me.OTHER.COMPONENT_LOG,async t=>await se.getInstance().other.componentLog(t)),W(Me.OTHER.TEAMS,async t=>await se.getInstance().other.teams(t)),W(Me.OTHER.GET_EDITOR_VERSION,async()=>await se.getInstance().other.getEditorVersion()),W(Me.OTHER.SET_EDITOR_VERSION,async t=>await se.getInstance().other.setEditorVersion(t))}var Ix=Ei(Vi());var uf=class{constructor(t){this.needDlg=!0;this.createStructure=!0;this.maxTicket=0;this.tool=new Pr;let{dataStr:s,images:r,info:i,options:n={},progressOptions:a}=t;this.dataStr=s,this.images=r,this.info=i,this.needDlg=n.needDlg||!0,this.createStructure=n.createStructure||!0;let c={needProgress:!0,progressTip:"Import Project...",total:4,...a};this.progress=new qs(c)}async start(t={}){try{t.progress&&(this.progress=t.progress);let{owner:s,introduction:r,description:i}=this.info,n={...this.info,user_uuid:s.uuid,introduction:r,description:i},a=await this.tool.project(n);if(a.success===!1)return{success:!1,code:a.code,message:a.message};this.progress.update();let{uuid:o,project:c,user:l}=a.result;this.uuid=c.uuid;let u=await this.tool.branch();if(u.success===!1)return{success:!1,code:u.code,message:u.message};let h=u.result;this.progress.update();let p=await this.upload(h);return p.success===!1?{success:!1,code:p.code,message:p.message}:(this.createImages(this.uuid,h.uuid),this.progress.update(),{success:!0,result:{project:c,branchData:h}})}catch(s){return{success:!1,message:s.message}}}async upload(t){var i,n,a;let s=this.createStructure?new bo:null;(i=s==null?void 0:s.setNotCanvas)==null||i.call(s,!0);let r=this.createStructure?s.flowParseFull():null;if(f0.test(this.dataStr)){let o=[],c=new dl;c.setChunkLength(50*1024*1024),c.onChunk(f=>{o.push(se.getInstance().projectHistory.set({projectId:this.uuid,branchData:t,dataStr:f}))});let l=new gd,u=f=>{var m,g;if(f instanceof Uint8Array){let b=l.write(f);b&&(c.push(b),(m=r==null?void 0:r.update)==null||m.call(r,b))}else c.push(f),(g=r==null?void 0:r.update)==null||g.call(r,f)},h=()=>{var m,g;let f=l.end();f&&(c.push(f),(m=r==null?void 0:r.update)==null||m.call(r,f)),(g=r==null?void 0:r.end)==null||g.call(r),c.end()};await(0,Ix.flowRead)(this.dataStr,{update:u,end:h});let d=(await Promise.all(o)).filter(f=>f.success===!1);if(d&&d.length)return console.error("The upload of the project log failed!",d),{success:!1,message:"The upload of the project log failed!"}}else{let o=await this.tool.upload({branchData:t,datas:[this.dataStr]});if(o.success===!1)return{success:!1,code:o.code,message:o.message};(n=r==null?void 0:r.update)==null||n.call(r,this.dataStr),(a=r==null?void 0:r.end)==null||a.call(r)}return r&&await this.buildStructure(s.getProject(),this.info.owner,t.uuid),{success:!0}}async buildStructure(t,s,r){let i=T0(t,s),n={uuid:this.uuid,datas:i,ticket:Bs.TICKET,branch_uuid:r},a=await se.getInstance().project.setProfile(n);console.log("setProfile...........",a),a&&!(a!=null&&a.success)&&ze("warn",["Project tree structure generation failed!"])}async createImages(t,s){if(!this.images)return;let r=[],i=await qn.upload(await qn.read(this.images),t,s,this.maxTicket);if(i.success===!1)return{success:!1,code:i.code,message:i.message};let{failed:n}=i.result;for(let a of n)r.push(a);if(r.length){let a=await De("The preview images of the following documents are missing:");ze("warn",[a,r.join("\u3001")])}}};var Ao=class{constructor(t){this.needDlg=!0;this.autoOpen=!0;this.needTip=!0;this.map={};let{datas:s,info:r,options:i={},progressOptions:n={}}=t;this.datas=s,this.info=r,this.options={...i,createProject:!0,createStructure:!0,deleteProject:!0};let{needDlg:a=!0,autoOpen:o=!0,needTip:c=!0}=this.options;this.needDlg=a,this.autoOpen=o,this.needTip=c;let l=n.total||3;this.progressOptions={needProgress:!0,total:l,...n},this.progress=new qs(this.progressOptions)}async start(t={}){var s;try{if(t.progress&&(this.progress=t.progress),!this.datas){let a=await this.getData();if(a.success===!1)return{success:!1,message:a.message};this.datas=a.result}if(this.progress.update(),!this.datas)return{success:!1,message:"Missing project data!"};let r;if(typeof this.datas.dataStr=="string"?r=await this.import3_0(this.datas):r=await this.import2_0(this.datas),this.progress.update(),r.success===!1)return this.uuid=(s=r.args)==null?void 0:s.uuid,this.failed({code:r.code,message:r.message}),{success:!1,code:r.code,message:r.message};let{project:i,branchData:n}=r.result;return this.project=i,this.map=r.result.map,this.uuid=this.project.uuid,await this.succeed({uuid:this.uuid,branchData:n}),{success:!0,...r}}catch(r){return this.failed({message:r.message}),{success:!1,message:r.message}}}async import2_0(t){try{let s=new Yi({datas:t,info:this.info,options:this.options,progressOptions:this.progressOptions});return this.progress.step=this.progress.step+s.progress.step,await s.flowUpload({progress:this.progress})}catch(s){return{success:!1,message:s.message}}}async import3_0(t){try{let s=new uf({...t,info:this.info,options:this.options,progressOptions:this.progressOptions});return this.progress.step=this.progress.step+s.progress.step,await s.start({progress:this.progress})}catch(s){return{success:!1,message:s.message}}}async onsucceedBefore(){await fe.messageBus.rpcCall("handleModelAndFootprint",[this.project,this.map,this.uuid])}async succeed(t){await this.onsucceedBefore(),await this.onsucceed(t),this.progress.update(!0);let s={projectId:this.uuid,needDlg:this.needDlg,autoOpen:this.autoOpen};fe.messageBus.publish("/pro-mgr/import/new/onsucceed",s)}async failed(t){let{code:s,message:r}=t,i=Array.isArray(r)?r:[r],n;if(s===Bn.PERMISSION_DENIED&&i.includes("\u4E0D\u80FD\u521B\u5EFA\u76F8\u540C\u7684\u8DEF\u5F84"))n=i;else{let a=Dt({code:s});n=a?[a]:i}this.options.deleteProject&&!ve&&this.uuid&&se.getInstance().project.delete({uuid:this.uuid}),await this.onfailed({code:s,message:n}),this.progress.update(!0),fe.messageBus.publish("/pro-mgr/import/new/onfailed",t)}};var hf=class{constructor(t){this.path=t;if(!t)throw new Error("invalid path")}async check1(t){let{message:s}=await fe.messageBus.rpcCall("isLogined");return!ve&&!s?(fe.messageBus.publish("login"),{success:!1,message:"Not logged in yet, please log in and try again"}):t.symbol&&!hh(t.symbol.docType)?{success:!1,message:"invalid symbol docType"}:t.footprint&&t.footprint.docType!==Ss.FOOTPRINT?{success:!1,message:"invalid footprint docType"}:{success:!0}}async check2(t){let s=await this.check1(t);if(!s.success)return{success:!1,...s};let i=[n(t.device),n(t.symbol),n(t.footprint)].filter(a=>a.success===!1);if(i.length)return{success:!1,message:i.map(a=>a.message)[0]};return{success:!0};function n(a){if(a){if(a.title.length<1||a.title.length>128)return{success:!1,message:"The title length must be between 1~128 characters!"};if(!ve&&!a.owner)return{success:!1,message:'Please fill in "Belonging"'}}return{success:!0}}}async onBeforeCreate(t,s){r.call(this,t.device,s),r.call(this,t.symbol,s),r.call(this,t.footprint,s),r.call(this,t.component,s);function r(i,n){if(i)return i.path=this.path,i.description=i.description||"",i.tags=i.tags||[],i.source&&delete i.source,n.ignoreDuplicateNameCheck!=null&&(i.ignoreDuplicateNameCheck=n.ignoreDuplicateNameCheck),i.docType&&n.checkDevice!=null&&(i.checkDevice=n.checkDevice),i}}async create(t){var s,r,i,n,a,o,c,l,u,h,p,d,f,m,g,b;try{let{data:E,options:y={}}=t,T=await this.check2(E);if(!T.success)return{success:!1,...T};await this.onBeforeCreate(E,y);let w={device:null,symbol:null,footprint:null,component:null};if(E.device||E.symbol||E.footprint){let S={device:E.device,symbol:E.symbol,footprint:E.footprint},_=await se.getInstance().device.place({path:this.path,datas:[S]});if(_.success===!0){let D=(s=_.result)==null?void 0:s[0],I=await this.transform(E,D);if(!I.success)w=I.result;else{if(((r=D.device)==null?void 0:r.success)===!0)w.device=D.device;else if(D.device){let P=D.device.message||D.device.result;w.device={success:!1,code:D.device.code,message:P}}if(((i=D.symbol)==null?void 0:i.success)===!0)w.symbol=D.symbol;else if(D.symbol){let P=D.symbol.message||D.symbol.result;w.symbol={success:!1,code:D.symbol.code,message:P}}if(((n=D.footprint)==null?void 0:n.success)===!0)w.footprint=D.footprint;else if(D.footprint){let P=D.footprint.message||D.footprint.result;w.footprint={success:!1,code:D.footprint.code,message:P}}}}else{let D=[((a=E.device)==null?void 0:a.title)||"",((o=E.symbol)==null?void 0:o.title)||"",((c=E.footprint)==null?void 0:c.title)||""].join(", "),I=Dt(_,{value:D})||_.message;return{success:!1,message:_.code==Bn.REQUEST_PARAM_ILLEGAL?_.message:await De("Creation failed! {message}",{message:I}),code:_.code}}let C=(u=(l=E.device)==null?void 0:l.attributes)==null?void 0:u.Symbol,x=(p=(h=E.device)==null?void 0:h.attributes)==null?void 0:p.Footprint;if(!E.symbol&&C){let D=await se.getInstance().component.get({path:this.path,uuid:C});if(D.success)w.symbol={success:!0,result:D.result};else throw new Error("The symbol associated with the device does not exist!")}if(!E.footprint&&x){let D=await se.getInstance().component.get({path:this.path,uuid:x});if(D.success)w.footprint={success:!0,result:D.result};else throw new Error("The footprint associated with the device does not exist!")}}if(E.component){let S={path:this.path,...E.component},_=await se.getInstance().component.create(S);if(_.success===!0){let C=await this.transform(E,{component:_});if(!C.success)w=C.result;else{let x=C.result;if((d=x.component)!=null&&d.success)w.component=x.component;else{let D=((f=x.component)==null?void 0:f.message)||((m=x.component)==null?void 0:m.result);w.component={success:!1,code:(g=x.component)==null?void 0:g.code,message:D}}}}else{let C=((b=E.component)==null?void 0:b.title)||"",x=Dt(_,{value:C})||_.message,I=_.code==Bn.REQUEST_PARAM_ILLEGAL?_.message:await De("Creation failed! {message}",{message:x});w.component={success:!1,message:I,code:_.code}}}return{success:!0,result:w}}catch(E){return{success:!1,message:E.message}}}async transform(t,s){var p,d,f,m,g,b,E,y,T,w,S,_,C,x,D,I,P,L,F,V,B;let{device:r,symbol:i,footprint:n,component:a}=s,o={device:r,symbol:i,footprint:n,component:a},c=ni((p=i==null?void 0:i.result)==null?void 0:p.docType),l=await Ht();if(i!=null&&i.result&&((d=t.symbol)!=null&&d.canvas))await se.getInstance().componentHistory.set({uuid:i.result.uuid,dataStr:Tn(t.symbol.canvas,{[ii.SYMBOL]:i.result.uuid},l)});else if(i!=null&&i.result&&c&&((f=t.symbol)!=null&&f.uuid)&&((m=t.symbol)!=null&&m.history_uuid)){let k={uuid:t.symbol.uuid,historyUuid:t.symbol.history_uuid},O=await se.getInstance().componentHistory.get(k);if(O.success===!1)return{success:!1,code:O.code,message:["Conversion component format failed!",O.message]};let R=i.result.uuid,v=await se.getInstance().componentHistory.getHistoryData(O.result);await se.getInstance().componentHistory.set({uuid:R,dataStr:Tn(v,{[ii.SYMBOL]:R},l)})}else if(i!=null&&i.result&&c&&!((g=t.symbol)!=null&&g.history_uuid)&&((b=t.symbol)!=null&&b.dataStrId||(E=t.symbol)!=null&&E.dataStr)){let k=await new qt(t.symbol).getStr(),O=await Ht(),R=await fi(),{dataStr:v}=Rp(i.result.uuid,k,O,"",R);v&&await se.getInstance().componentHistory.set({uuid:i.result.uuid,dataStr:t.symbol.dataStr})}let u=((y=n==null?void 0:n.result)==null?void 0:y.docType)===Ss.FOOTPRINT;if(n!=null&&n.result&&((T=t.footprint)!=null&&T.canvas))await se.getInstance().componentHistory.set({uuid:n.result.uuid,dataStr:Tn(t.footprint.canvas,{[ii.FOOTPRINT]:n.result.uuid},l)});else if(n!=null&&n.result&&u&&((w=t.footprint)!=null&&w.uuid)&&((S=t.footprint)!=null&&S.history_uuid)){let k={uuid:t.footprint.uuid,historyUuid:t.footprint.history_uuid},O=await se.getInstance().componentHistory.get(k);if(O.success===!1)return{success:!1,code:O.code,message:["Conversion component format failed!",O.message]};let R=n.result.uuid,v=await se.getInstance().componentHistory.getHistoryData(O.result);await se.getInstance().componentHistory.set({uuid:R,dataStr:Tn(v,{[ii.FOOTPRINT]:R},l)})}else if(n!=null&&n.result&&u&&!((_=t.footprint)!=null&&_.history_uuid)&&((C=t.footprint)!=null&&C.dataStrId||(x=t.footprint)!=null&&x.dataStr)){let k=await new qt(t.footprint).getStr(),O=await Ht(),R=await fi();vp(n.result.uuid,k,!!(r!=null&&r.result),O,"",R)&&await se.getInstance().componentHistory.set({uuid:n.result.uuid,dataStr:t.footprint.dataStr})}let h=((D=a==null?void 0:a.result)==null?void 0:D.docType)===Ss.PANEL_LIB;if(a!=null&&a.result&&((I=t.component)!=null&&I.canvas))await se.getInstance().componentHistory.set({uuid:a.result.uuid,dataStr:Tn(t.component.canvas,{[ii.PANEL_LIB]:a.result.uuid},l)});else if(a!=null&&a.result&&h&&((P=t.component)!=null&&P.uuid)&&((L=t.component)!=null&&L.history_uuid)){let k={uuid:t.component.uuid,historyUuid:t.component.history_uuid},O=await se.getInstance().componentHistory.get(k);if(O.success===!1)return{success:!1,code:O.code,message:["Conversion component format failed!",O.message]};let R=a.result.uuid,v=await se.getInstance().componentHistory.getHistoryData(O.result);await se.getInstance().componentHistory.set({uuid:R,dataStr:Tn(v,{[ii.PANEL_LIB]:R},l)})}else if(a!=null&&a.result&&h&&!((F=t.component)!=null&&F.history_uuid)&&((V=t.component)!=null&&V.dataStrId||(B=t.component)!=null&&B.dataStr)){let k=await new qt(t.component).getStr(),O=await Ht(),R=await fi();a0(a.result.uuid,k,ii.PANEL_LIB,O,"",R)&&await se.getInstance().componentHistory.set({uuid:a.result.uuid,dataStr:t.component.dataStr})}return{success:!0,result:o}}async get1(t){return se.getInstance().component.get(t)}async create1(t){return se.getInstance().component.create1(t)}async update1(t){return se.getInstance().component.update1(t)}async update(t){var s,r,i,n,a,o;try{let{data:c,force:l=!0}=t,u=await this.check1(c);if(!u.success)return{success:!1,...u};let h={},p={device:null,symbol:null,footprint:null,component:null},{device:d,symbol:f,footprint:m,component:g}=c,b={},E=((s=d==null?void 0:d.attributes)==null?void 0:s.Symbol)||"",y=((r=d==null?void 0:d.attributes)==null?void 0:r.Footprint)||"";if(d){let T=await se.getInstance().device.update({path:this.path,...d});if(T.success===!0&&T.result)p.device={success:!0,result:T.result};else if(T.success===!1&&T.code===Bn.LIB_NOT_EXIST)b.device=d,p.device={success:!1,message:T.message};else{let w=T.result,S=w.display_title||w.title||"",_=T.message,C=await De("Failed to update personal library device {title}: {reason}",{title:S,reason:_});p.device={success:!1,message:C}}}if(f){let T=await se.getInstance().component.update({path:this.path,...f});if(T.success&&T.result)p.symbol={success:!0,result:T.result};else if(T.success===!1&&T.code===Bn.LIB_NOT_EXIST)b.symbol=f,p.symbol={success:!1,message:T.message};else{let w=T.result,S=w.display_title||w.title||"",_=T.message,C=await De("Failed to update personal library symbol {title}: {reason}",{title:S,reason:_});p.symbol={success:!1,message:C}}}else if(E){let T=await se.getInstance().component.get({path:this.path,uuid:E});T.success&&T.result?(b.symbol=T.result,p.symbol={success:!1,message:T.message}):p.symbol={success:!1,message:T.message}}if(m){let T=await se.getInstance().component.update({path:this.path,...m});if(T.success&&T.result)p.footprint={success:!0,result:T.result};else if(T.code===Bn.LIB_NOT_EXIST)b.footprint=m,p.footprint={success:!1,message:T.message};else{let w=T.result,S=w.display_title||w.title||"",_=T.message,C=await De("Failed to update personal library footprint {title}: {reason}",{title:S,reason:_});p.footprint={success:!1,message:C}}}else if(y){let T=await se.getInstance().component.get({path:this.path,uuid:y});T.success&&T.result?(b.footprint=T.result,p.footprint={success:!1,message:T.message}):p.footprint={success:!1,message:T.message}}if(g){let T=await se.getInstance().component.update({path:this.path,...g});if(T.success&&T.result)p.component={success:!0,result:T.result};else if(T.code===Bn.LIB_NOT_EXIST)b.component=g,p.component={success:!1,message:T.message};else{let w=T.result,S=w.display_title||w.title||"",_=T.message,C=await De("Failed to update personal library component {title}: {reason}",{title:S,reason:_});p.component={success:!1,message:C}}}if(l&&Object.keys(b).length){let T=await this.create({data:b});if(!T.success)return{success:!1,message:T.message};let w=T.result;if((i=w.device)!=null&&i.success){let S=w.device.result;p.device={success:!0,result:S};let _=b.device.uuid;_&&(h[_]=S.uuid)}else w.device&&(p.device=w.device);if((n=w.symbol)!=null&&n.success){let S=w.symbol.result;p.symbol={success:!0,result:S};let _=b.symbol.uuid;_&&(h[_]=S.uuid)}else w.symbol&&(p.symbol=w.symbol);if((a=w.footprint)!=null&&a.success){let S=w.footprint.result;p.footprint={success:!0,result:S};let _=b.footprint.uuid;_&&(h[_]=S.uuid)}else w.footprint&&(p.footprint=w.footprint);if((o=w.component)!=null&&o.success){let S=w.component.result;p.component={success:!0,result:S};let _=b.component.uuid;_&&(h[_]=S.uuid)}else w.component&&(p.component=w.component)}return{success:!0,result:{...p,map:h}}}catch(c){return{success:!1,message:c.message}}}async cancelAssociate(t){var s;try{let{datas:r,options:i={}}=t,n=[],a=[];for(let o=0;o<r.length;o++){let c=r[o];i.cancelSymbol&&delete c.attributes.Symbol,i.cancelFootprint&&delete c.attributes.Footprint;let l=await this.update({data:{device:{path:this.path,...c}},force:!1}),u=(s=l.result)==null?void 0:s.device;l.success&&u.success?n.push({uuid:c.uuid,title:c.display_title}):a.push({uuid:c.uuid,title:c.display_title,message:(u==null?void 0:u.message)||l.message})}return{success:!0,result:{succeed:n,failed:a}}}catch(r){return{success:!1,message:r.message}}}async delete(t){try{let s={},{devices:r,symbols:i,footprints:n,components:a}=t;if(r&&r.length){s.devices={succeed:[],failed:[]};for(let o=0;o<r.length;o++){let c=r[o];(await se.getInstance().device.delete({path:this.path,uuid:c})).success?s.devices.succeed.push(c):s.devices.failed.push(c)}}if(i&&i.length){s.symbols={succeed:[],failed:[]};for(let o=0;o<i.length;o++){let c=i[o];(await se.getInstance().component.delete({path:this.path,uuid:c})).success?s.symbols.succeed.push(c):s.symbols.failed.push(c)}}if(n&&n.length){s.footprints={succeed:[],failed:[]};for(let o=0;o<n.length;o++){let c=n[o];(await se.getInstance().component.delete({path:this.path,uuid:c})).success?s.footprints.succeed.push(c):s.footprints.failed.push(c)}}if(a&&a.length){s.components={succeed:[],failed:[]};for(let o=0;o<a.length;o++){let c=a[o];(await se.getInstance().component.delete({path:this.path,uuid:c})).success?s.components.succeed.push(c):s.components.failed.push(c)}}return{success:!0,result:s}}catch(s){return{success:!1,message:s.message}}}async get(t){var s,r,i,n;try{let{data:a,options:o={}}=t,c=a.device?[a.device]:void 0,l=a.symbol?[a.symbol]:void 0,u=a.footprint?[a.footprint]:void 0,h=a.component?[a.component]:void 0,p=await this.batchGet({devices:c,symbols:l,footprints:u,components:h},o);if(!p.success)return{success:!1,code:p.code,message:p.message};let d=p.result,f=((s=d.devices)==null?void 0:s[0])||null,m=((r=d.symbols)==null?void 0:r[0])||null,g=((i=d.footprints)==null?void 0:i[0])||null,b=((n=d.components)==null?void 0:n[0])||null;return{success:!0,result:{device:f,symbol:m,footprint:g,component:b}}}catch(a){return{success:!1,message:a.message}}}async batchGet(t,s={}){try{let{devices:r,symbols:i,footprints:n,components:a}=t,{needStr:o=!1,withRelated:c=!1}=s,l={};if(r&&r.length){l.devices=[];for(let h=0;h<r.length;h++){let p=r[h],d=await se.getInstance().device.get({path:this.path,uuid:p,...s});d.success?(c&&await u.call(this,d.result,o),l.devices.push(d.result)):l.devices.push(null)}}if(i&&i.length){l.symbols=[];for(let h=0;h<i.length;h++){let p=i[h],d=await se.getInstance().component.get({path:this.path,uuid:p,...s});d.success?l.symbols.push(d.result):l.symbols.push(null)}}if(n&&n.length){l.footprints=[];for(let h=0;h<n.length;h++){let p=n[h],d=await se.getInstance().component.get({path:this.path,uuid:p,...s});d.success?l.footprints.push(d.result):l.footprints.push(null)}}if(a&&a.length){l.components=[];for(let h=0;h<a.length;h++){let p=a[h],d=await se.getInstance().component.get({path:this.path,uuid:p,...s});d.success?l.components.push(d.result):l.components.push(null)}}return{success:!0,result:l};async function u(h,p=!1){let d=h.attributes.Symbol,f=h.attributes.Footprint,m=d&&(await se.getInstance().component.get({path:this.path,uuid:d,...s})).result,g=f&&(await se.getInstance().component.get({path:this.path,uuid:f,...s})).result;return h.symbol=m||null,h.footprint=g||null,h}}catch(r){return{success:!1,message:r.message}}}async updateDevices(t){try{let{datas:s}=t,r=await se.getInstance().device.batchUpdate({path:this.path,datas:s}),i=[],n=[];if(!r.success)return{success:!1,result:{succeed:[],failed:s.map(o=>({uuid:o.uuid,title:o.display_title,message:r.message}))}};let a=r.result;for(let o=0;o<a.length;o++){let c=a[o],l=s[o];c.success?i.push({uuid:l.uuid,title:l.display_title}):n.push({uuid:l.uuid,title:l.display_title,message:c.message})}return{success:!0,result:{succeed:i,failed:n}}}catch(s){return{success:!1,message:s.message}}}async force(t){var s,r,i;try{let{device:n,symbol:a,footprint:o}=t,c={},l={device:null,symbol:null,footprint:null},u={},h="",p="";if(n){let d=await se.getInstance().device.get({path:this.path,uuid:n.uuid});if(d.success&&d.result){let f=d.result;l.device={success:!0,result:f},h=f.attributes.Symbol,p=f.attributes.Footprint}else u.device=n}if(h!==(a==null?void 0:a.uuid))u.symbol=a;else if(h){let d=await se.getInstance().component.get({path:this.path,uuid:h});l.symbol={success:d.success,result:d.result}}else l.symbol=null;if(p!==(o==null?void 0:o.uuid))u.footprint=o;else if(p){let d=await se.getInstance().component.get({path:this.path,uuid:p});l.footprint={success:d.success,result:d.result}}else l.footprint=null;if(Object.keys(u).length){let d=await this.create({data:u});if(!d.success)return{success:!1,message:d.message};let f=d.result;if((s=f.device)!=null&&s.success){let m=f.device.result;l.device={success:!0,result:m};let g=u.device.uuid;g&&(c[g]=m.uuid)}else f.device&&(l.device=f.device);if((r=f.symbol)!=null&&r.success){let m=f.symbol.result;l.symbol={success:!0,result:m};let g=u.symbol.uuid;g&&(c[g]=m.uuid)}else f.symbol&&(l.symbol=f.symbol);if((i=f.footprint)!=null&&i.success){let m=f.footprint.result;l.footprint={success:!0,result:m};let g=u.footprint.uuid;g&&(c[g]=m.uuid)}else f.footprint&&(l.footprint=f.footprint)}else n&&(l.device=await se.getInstance().device.update(n)),a&&(l.symbol=await se.getInstance().component.update(a)),o&&(l.footprint=await se.getInstance().component.update(o));return{success:!0,result:{...l,map:c}}}catch(n){return{success:!1,message:n.message}}}async star(t){try{let s,r;if(t.device){let i=await se.getInstance().device.star({uuid:t.device,path:this.path});s=i.success,r=i.success?"":i.message}if(t.component){let i=await se.getInstance().component.star({uuid:t.component,path:this.path});s=i.success,r=i.success?"":i.message}return{success:s,message:r}}catch(s){return{success:!1,message:s.message}}}async unstar(t){try{let s,r;if(t.device){let i=await se.getInstance().device.unstar({uuid:t.device,path:this.path});s=i.success,r=i.success?"":i.message}if(t.component){let i=await se.getInstance().component.unstar({uuid:t.component,path:this.path});s=i.success,r=i.success?"":i.message}return{success:s,message:r}}catch(s){return{success:!1,message:s.message}}}async upload(t){try{let{devices:s,components:r}=t,i={};if(s&&s.length&&(i.devices=await se.getInstance().device.upload({path:this.path,datas:s})),r&&r.length){let n=await se.getInstance().component.upload({path:this.path,datas:r});i.components=n}return{success:!0,result:i}}catch(s){return{success:!1,message:s.message}}}async getSource(t){try{let{uuid:s,docType:r}=t,i=await se.getInstance().component.get({path:this.path,uuid:s,docType:r,needTransform:!0});if(!i.success)return{success:!1,message:i.message};let n=i.result,a=n.canvas;return{success:!0,result:Object.assign(n,{canvas:a})}}catch(s){return{success:!1,message:s.message}}}};var xi=class extends _E{constructor(t){let{uuid:s,data:r,byUUID:i=!0,byVersion:n=!0,bySource:a=!0}=t;super(t),this.uuid=s,this.params=r,this.instance=X(s),this.byUUID=i,this.byVersion=n,this.bySource=a}onlyIdentity(){return!!(Object.keys(this.params).length===2&&this.params.uuid&&this.params.path)}async handle(t){return t.path||(t.path=this.uuid),await Ln({data:t}),t.project_uuid=t.path=this.uuid,{success:!0,result:t}}};var df=class extends xi{async getData(){let{path:t,uuid:s}=this.params;if(this.onlyIdentity()){let r=await se.getInstance().device.get({path:t,uuid:s});if(r.success===!1)return{success:!1,code:r.code,message:r.message};{let i=r.result,n=`${s}${Rs}${t}`,a=i.updateTime.toString();this.data=Object.assign(i,{path:t,source:n,version:a})}}else this.data=this.params;return{success:!0,result:this.data}}async matching(t){if(this.byUUID){let s=(await this.instance.device.getData(t.uuid)).result;if(t.ticket&&(s!=null&&s.ticket)&&(s==null?void 0:s.ticket)===t.ticket)return s}if(t.source){if(this.byVersion){let s=(await this.instance.device.getDataBySourceAndVersion({source:t.source,version:t.version})).result;if(s)return s}if(this.bySource){let s=(await this.instance.device.getLastData(t.source)).result;if(s)return s}}}async isRename(t){return(await this.instance.device.isRename(t.display_title||t.title)).result?{success:!1,message:"Device duplicate name"}:{success:!0}}async renaming(t){let s=(await this.instance.device.tryRename(t.display_title||t.title)).result;return t.display_title=t.title=s,{success:!0}}async start(){let t=await this.getData();if(!t.success)return{success:!1,code:t.code,message:t.message};let s=null,r=null;if(this.data){let i=await this.match(this.data);if(i)s={success:!0,result:i};else{let n=await this.rename(this.data);if(n.success===!1)return{success:!1,code:n.code,message:n.message};let a=await this.handle(this.data);if(a.success)r=a.result;else return{success:!1,message:a.message}}}return{success:!0,result:{respond:s,addData:r}}}};var pf=class extends xi{async getData(){let{path:t,uuid:s}=this.params;if(this.onlyIdentity()){let r=await se.getInstance().component.get({path:t,uuid:s});if(r.success===!1)return{success:!1,code:r.code,message:r.message};{let i=r.result,n=`${s}${Rs}${t}`,a=i.updateTime.toString();this.data=Object.assign(i,{path:t,source:n,version:a})}}else this.data=this.params;return{success:!0,result:this.data}}async matching(t){if(this.byUUID){let s=(await this.instance.footprint.getData(t.uuid)).result;if(t.ticket&&(s!=null&&s.ticket)&&(s==null?void 0:s.ticket)===t.ticket)return s}if(t.source){if(this.byVersion){let s=(await this.instance.footprint.getDataBySourceAndVersion({source:t.source,version:t.version})).result;if(s)return s}if(this.bySource){let s=(await this.instance.footprint.getLastData(t.source)).result;if(s)return s}}}async isRename(t){return(await this.instance.footprint.isRename(t.display_title||t.title)).result?{success:!1,message:"Library duplicate name"}:{success:!0}}async renaming(t){let s=(await this.instance.footprint.tryRename(t.display_title||t.title)).result;return t.display_title=t.title=s,{success:!0}}async start(){let t=await this.getData();if(!t.success)return{success:!1,code:t.code,message:t.message};let s=null,r=null;if(this.data){let i=await this.match(this.data);if(i)s={success:!0,result:i};else{let n=await this.rename(this.data);if(!n.success)return{success:!1,code:n.code,message:n.message};let a=await this.handle(this.data);if(a.success)r=a.result;else return{success:!1,message:a.message}}}return{success:!0,result:{respond:s,addData:r}}}};var ff=class extends xi{async getData(){let{path:t,uuid:s}=this.params;if(this.onlyIdentity()){let r=await se.getInstance().component.get({path:t,uuid:s});if(r.success===!1)return{success:!1,code:r.code,message:r.message};{let i=r.result,n=`${s}${Rs}${t}`,a=i.updateTime.toString();this.data=Object.assign(i,{path:t,source:n,version:a})}}else this.data=this.params;return{success:!0,result:this.data}}async matching(t){if(this.byUUID){let s=(await this.instance.symbol.getData(t.uuid)).result;if(t.ticket&&(s!=null&&s.ticket)&&(s==null?void 0:s.ticket)===t.ticket)return s}if(t.source){if(this.byVersion){let s=(await this.instance.symbol.getDataBySourceAndVersion({source:t.source,version:t.version})).result;if(s)return s}if(this.bySource){let s=(await this.instance.symbol.getLastSymbol(t.source)).result;if(s)return s}}}async isRename(t){return(await this.instance.symbol.isRename(t.display_title||t.title)).result?{success:!1,message:"Library duplicate name"}:{success:!0}}async renaming(t){let s=(await this.instance.symbol.tryRename(t.display_title||t.title)).result;return t.display_title=t.title=s,{success:!0}}async start(){let t=await this.getData();if(!t.success)return{success:!1,code:t.code,message:t.message};let s=null,r=null;if(this.data){let i=await this.match(this.data);if(i)s={success:!0,result:i};else{let n=await this.rename(this.data);if(!n.success)return{success:!1,code:n.code,message:n.message};let a=await this.handle(this.data);if(a.success)r=a.result;else return{success:!1,message:a.message}}}return{success:!0,result:{respond:s,addData:r}}}};var Il=class{constructor(t){this.uuid=t,this.instance=X(t)}async convertTags(t){t.symbol&&(t.symbol.custom_tags=Va(t.symbol.tags)),t.footprint&&(t.footprint.custom_tags=Va(t.footprint.tags)),t.device&&(t.device.custom_tags=Va(t.device.tags))}async transform(t,s){var p,d;let{device:r,symbol:i,footprint:n}=t,a={device:r,symbol:i,footprint:n},o=u0((p=i==null?void 0:i.result)==null?void 0:p.docType),c=s.symbol,l=await Ht();if(i!=null&&i.result&&(c!=null&&c.canvas))await this.instance.symbol.setCanvas(i.result.uuid,Tn(c.canvas,{[ii.SYMBOL]:i.result.uuid},l));else if(i!=null&&i.result&&o&&(c!=null&&c.uuid)&&(c!=null&&c.history_uuid)){let f={uuid:c.uuid,historyUuid:c.history_uuid},m=await se.getInstance().componentHistory.get(f);if(m.success===!1)return{success:!1,code:m.code,message:["Conversion component format failed!",...uh(m.message)]};let g=i.result.uuid,b=await se.getInstance().componentHistory.getHistoryData(m.result);await this.instance.symbol.setCanvas(g,Tn(b,{[ii.SYMBOL]:g},l))}else if(i!=null&&i.result&&o&&!(c!=null&&c.history_uuid)&&(c!=null&&c.dataStrId||c!=null&&c.dataStr)){let f=await new qt(c).getStr(),m=await Ht(),g=await fi(),{dataStr:b}=Rp(i.result.uuid,f,m,i.result.version||String(m),g);b&&await this.instance.symbol.setCanvas(i.result.uuid,b)}let u=((d=n==null?void 0:n.result)==null?void 0:d.docType)===Ss.FOOTPRINT,h=s.footprint;if(n!=null&&n.result&&(h!=null&&h.canvas))await this.instance.footprint.setCanvas(n.result.uuid,Tn(h.canvas,{[ii.FOOTPRINT]:n.result.uuid},l));else if(n!=null&&n.result&&u&&(h!=null&&h.uuid)&&(h!=null&&h.history_uuid)){let f={uuid:h.uuid,historyUuid:h.history_uuid},m=await se.getInstance().componentHistory.get(f);if(m.success===!1)return{success:!1,code:m.code,message:["Conversion component format failed!",...uh(m.message)]};let g=n.result.uuid,b=await se.getInstance().componentHistory.getHistoryData(m.result);await this.instance.footprint.setCanvas(g,Tn(b,{[ii.FOOTPRINT]:g},l))}else if(n!=null&&n.result&&u&&!(h!=null&&h.history_uuid)&&(h!=null&&h.dataStrId||h!=null&&h.dataStr)){let f=await new qt(h).getStr(),m=await Ht(),g=await fi(),b=vp(n.result.uuid,f,!!(r!=null&&r.result),m,n.result.version||String(m),g);b&&await this.instance.footprint.setCanvas(n.result.uuid,b)}return{success:!0,result:a}}async onsuccess(t){t.symbol&&!t.symbol.success&&(t.symbol.message=Dt(t.symbol)||t.symbol.message),t.footprint&&!t.footprint.success&&(t.footprint.message=Dt(t.footprint)||t.footprint.message),t.device&&!t.device.success&&(t.device.message=Dt(t.device)||t.device.message)}};var mf=class extends Il{constructor(s){let{uuid:r,data:i={},options:n={}}=s,{matchKey:a=!0,byUUID:o=!0,byVersion:c=!0,bySource:l=!0,renameKey:u=!1}=n;super(r);this.addData={};this.result={device:null,symbol:null,footprint:null};this.data=i,this.matchKey=a,this.byUUID=o,this.byVersion=c,this.bySource=l,this.renameKey=u}async start(){var s,r,i,n,a,o;try{let c=await this.check();if(!c.success)return{success:!1,...c};await this.onBefore();let l={uuid:this.uuid,matchKey:this.matchKey,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey};if(this.data.device){let p=await new df({...l,data:this.data.device}).start();if(p.success){let{respond:d,addData:f}=p.result;if(this.result.device=d,f&&(this.addData.device=f),this.getBind(),!this.addData.device&&this.result.device.result){let{attributes:m}=this.result.device.result,{Symbol:g,Footprint:b}=m,E=g&&(await this.instance.symbol.getData(g)).result,y=b&&(await this.instance.footprint.getData(b)).result;this.result.symbol={success:!0,result:E},this.result.footprint={success:!0,result:y}}}else return{success:!1,code:p.code,message:p.message}}if(this.data.symbol){let p=await new ff({...l,data:this.data.symbol}).start();if(p.success){let{respond:d,addData:f}=p.result;if(this.result.symbol=d,f&&(this.addData.symbol=f),this.addData.device&&((s=this.result.symbol)!=null&&s.result))this.addData.device.attributes.Symbol=this.result.symbol.result.uuid;else if((r=this.addData.device)!=null&&r.attributes.Symbol&&!((i=this.result.symbol)!=null&&i.result)&&!this.addData.symbol)throw new Error("The symbol associated with the device does not exist!")}else return{success:!1,code:p.code,message:p.message}}if(this.data.footprint){let p=await new pf({...l,data:this.data.footprint}).start();if(p.success){let{respond:d,addData:f}=p.result;if(this.result.footprint=d,f&&(this.addData.footprint=f),this.addData.device&&((n=this.result.footprint)!=null&&n.result))this.addData.device.attributes.Footprint=this.result.footprint.result.uuid;else if((a=this.addData.device)!=null&&a.attributes.Footprint&&!((o=this.result.footprint)!=null&&o.result)&&!this.addData.footprint)throw new Error("The footprint associated with the device does not exist!")}else return{success:!1,code:p.code,message:p.message}}let u=await this.create();if(!u.success)return{success:!1,message:u.message};let h=await this.updateBind();return h.success?(await this.onsuccess(this.result),{success:!0,result:this.result}):{success:!1,message:h.message}}catch(c){return{success:!1,message:c.message}}}async check(){let{message:{hasPermission:s,errMsg:r}}=await fe.messageBus.rpcCall("canAddLib",[this.uuid]);return s?{success:!0}:{success:!1,message:r||"You don't have permission!"}}async onBefore(){}getBind(){var s,r;if(this.addData.device){let[i,n]=this.addData.device.source.split(Rs);!this.data.symbol&&((s=this.addData.device.attributes)!=null&&s.Symbol)&&(this.data.symbol={path:n,uuid:this.addData.device.attributes.Symbol}),!this.data.footprint&&((r=this.addData.device.attributes)!=null&&r.Footprint)&&(this.data.footprint={path:n,uuid:this.addData.device.attributes.Footprint})}}onbeforeCreate(){var s,r,i,n;return(s=this.addData.symbol)!=null&&s.docType&&!hh((r=this.addData.symbol)==null?void 0:r.docType)?{success:!1,message:"invalid symbol docType"}:(i=this.addData.footprint)!=null&&i.docType&&((n=this.addData.footprint)==null?void 0:n.docType)!==Ne.FOOTPRINT?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){var s;if(Object.keys(this.addData).length>0){let r=this.onbeforeCreate();if(!r.success)return{success:!1,message:r.message};this.convertTags(this.addData);let i=await this.instance.device.place([this.addData]);if(!i.success)return{success:!1,message:i.message};let{device:n,symbol:a,footprint:o}=(s=i.result)==null?void 0:s[0];n&&(this.result.device=n),a&&(this.result.symbol=a),o&&(this.result.footprint=o);let c=await this.transform(this.result,this.addData);if(!c.success)return{success:!1,message:c.message}}return{success:!0}}async updateBind(){var c;let{device:s,symbol:r,footprint:i}=this.result,n=s==null?void 0:s.result,a=r==null?void 0:r.result,o=i==null?void 0:i.result;if(n&&(n.attributes.Symbol!==(a==null?void 0:a.uuid)||n.attributes.Footprint!==(o==null?void 0:o.uuid))){let l=!1;if(a&&a.uuid&&(n.attributes.Symbol=a.uuid||n.attributes.Symbol,l=!0),o&&o.uuid&&(n.attributes.Footprint=o.uuid||n.attributes.Footprint,l=!0),l){let u=this.instance&&((c=await this.instance.device.updateData(n))==null?void 0:c.result);this.result.device={success:!!u,result:u}}}return{success:!0}}};var gf=class extends xi{matching(t){return null}async getData(){let{path:t,uuid:s}=this.params;if(this.onlyIdentity()){if(Ge(t))return{success:!1,message:"Please open the project first, and then get the device of the specified project!"};let r=await X(t).device.getData(s);if(r.success)this.data=r.result;else return{success:!1,message:r.message}}else this.data=this.params.data;return{success:!0,result:this.data}}async isRename(t){return(await this.instance.device.isRename(t.display_title||t.title)).result?{success:!1,message:"Device duplicate name"}:{success:!0}}async renaming(t){let s=(await this.instance.device.tryRename(t.display_title||t.title)).result;return t.display_title=t.title=s,{success:!0}}async start(){let t=await this.getData();if(!t.success)return{success:!1,code:t.code,message:t.message};let s=null;if(this.data){let r=await this.rename(this.data);if(!r.success)return{success:!1,code:r.code,message:r.message};let i=await this.handle(this.data);if(i.success)s=i.result;else return{success:!1,message:i.message}}return{success:!0,result:{updateData:s}}}};var yf=class extends xi{matching(t){return null}async getData(){let{path:t,uuid:s}=this.params;if(this.onlyIdentity())if(Ge(t)){let r=await X(t).symbol.getData(s);if(r.success)this.data=r.result;else return{success:!1,message:r.message}}else{let r=await se.getInstance().component.get({path:t,uuid:s});if(r.success===!1)return{success:!1,code:r.code,message:r.message};{let i=r.result,n=`${s}${Rs}${t}`,a=i.updateTime.toString();this.data=Object.assign(i,{path:t,source:n,version:a})}}else this.data=this.params.data;return{success:!0,result:this.data}}async isRename(t){return(await this.instance.symbol.isRename(t.display_title||t.title)).result?{success:!1,message:"Library duplicate name"}:{success:!0}}async renaming(t){let s=(await this.instance.symbol.tryRename(t.display_title||t.title)).result;return t.display_title=t.title=s,{success:!0}}async start(){let t=await this.getData();if(!t.success)return{success:!1,code:t.code,message:t.message};let s=null,r=null;if(this.data){let i=await this.rename(this.data);if(!i.success)return{success:!1,code:i.code,message:i.message};let n=await this.handle(this.data);if(n.success)(await this.instance.symbol.isExist(this.data.uuid)).result?r=n.result:s=n.result;else return{success:!1,message:n.message}}return{success:!0,result:{addData:s,updateData:r}}}};var Ef=class extends xi{matching(t){return null}async getData(){let{path:t,uuid:s}=this.params;if(this.onlyIdentity())if(Ge(t)){let r=await X(t).footprint.getData(s);if(r.success)this.data=r.result;else return{success:!1,message:r.message}}else{let r=await se.getInstance().component.get({path:t,uuid:s});if(r.success===!1)return{success:!1,code:r.code,message:r.message};{let i=r.result,n=`${s}${Rs}${t}`,a=i.updateTime.toString();this.data=Object.assign(i,{path:t,source:n,version:a})}}else this.data=this.params.data;return{success:!0,result:this.data}}async isRename(t){return(await this.instance.footprint.isRename(t.display_title||t.title)).result?{success:!1,message:"Library duplicate name"}:{success:!0}}async renaming(t){let s=(await this.instance.footprint.tryRename(t.display_title||t.title)).result;return t.display_title=t.title=s,{success:!0}}async start(){let t=await this.getData();if(!t.success)return{success:!1,code:t.code,message:t.message};let s=null,r=null;if(this.data){let i=await this.rename(this.data);if(!i.success)return{success:!1,code:i.code,message:i.message};let n=await this.handle(this.data);if(n.success)(await this.instance.footprint.isExist(this.data.uuid)).result?r=n.result:s=n.result;else return{success:!1,message:n.message}}return{success:!0,result:{addData:s,updateData:r}}}};var bf=class extends Il{constructor(s){let{uuid:r,data:i={}}=s;super(r);this.addData={};this.updateData={};this.map={};this.result={device:null,symbol:null,footprint:null,map:null};this.data=i}async start(){try{let s=await this.check();if(!s.success)return{success:!1,...s};await this.onBefore();let r={uuid:this.uuid};if(this.data.device){let a=await new gf({...r,data:this.data.device}).start();if(a.success){let{updateData:o}=a.result;o&&(this.updateData.device=o),this.getBind()}else return{success:!1,code:a.code,message:a.message}}if(this.data.symbol){let a=await new yf({...r,data:this.data.symbol}).start();if(a.success){let{addData:o,updateData:c}=a.result;o&&(this.addData.symbol=o),c&&(this.updateData.symbol=c)}else return{success:!1,code:a.code,message:a.message}}if(this.data.footprint){let a=await new Ef({...r,data:this.data.footprint}).start();if(a.success){let{addData:o,updateData:c}=a.result;o&&(this.addData.footprint=o),c&&(this.updateData.footprint=c),o?this.updateData.device.attributes.Footprint=o.uuid:c&&(this.updateData.device.attributes.Footprint=c.uuid)}else return{success:!1,code:a.code,message:a.message}}let i=await this.create();if(!i.success)return{success:!1,code:i.code,message:i.message};let n=await this.update();return n.success?(await this.onsuccess(this.result),{success:!0,result:Object.assign(this.result,{map:this.map})}):{success:!1,message:n.message}}catch(s){return{success:!1,message:s.message}}}getBind(){var s,r;if(this.updateData.device){let[i,n]=this.updateData.device.source.split(Rs);!this.data.symbol&&((s=this.updateData.device.attributes)!=null&&s.Symbol)&&(this.data.symbol={path:n,uuid:this.updateData.device.attributes.Symbol}),!this.data.footprint&&((r=this.updateData.device.attributes)!=null&&r.Footprint)&&(this.data.footprint={path:n,uuid:this.updateData.device.attributes.Footprint})}}async check(){let{message:{hasPermission:s,errMsg:r}}=await fe.messageBus.rpcCall("canAddLib",[this.uuid]);return s?{success:!0}:{success:!1,message:r||"You don't have permission!"}}async onBefore(){}onbeforeCreate(){var s,r,i,n;return(s=this.addData.symbol)!=null&&s.docType&&!hh((r=this.addData.symbol)==null?void 0:r.docType)?{success:!1,message:"invalid symbol docType"}:(i=this.addData.footprint)!=null&&i.docType&&((n=this.addData.footprint)==null?void 0:n.docType)!==Ss.FOOTPRINT?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){let{symbol:s,footprint:r}=this.addData,i=this.onbeforeCreate();if(!i.success)return{success:!1,message:i.message};if(this.convertTags(this.addData),s){let a=await this.instance.symbol.addData(s);if(!a.success)return{success:!1,message:a.message};this.result.symbol=a,this.map[s.uuid]=a.result.uuid}if(r){let a=await this.instance.footprint.addData(r);if(!a.success)return{success:!1,message:a.message};this.result.footprint=a,this.map[r.uuid]=a.result.uuid}let n=await this.transform(this.result,this.addData);return n.success?{success:!0}:{success:!1,message:n.message}}async update(){var n,a;let{device:s,symbol:r,footprint:i}=this.updateData;if(r){let o=await this.instance.symbol.updateData(r);if(!o.success){let c=r.display_title||r.title||"";return{success:!1,message:await De("Failed to update project library symbol {title}!",{title:c})}}this.result.symbol=o}if(i){let o=await this.instance.footprint.updateData(i);if(!o.success){let c=i.display_title||i.title||"";return{success:!1,message:await De("Failed to update project library footprint {title}!",{title:c})}}this.result.footprint=o}if(s){(n=this.result.symbol)!=null&&n.result&&(s.attributes.Symbol=this.result.symbol.result.uuid),(a=this.result.footprint)!=null&&a.result&&(s.attributes.Footprint=this.result.footprint.result.uuid);let o=await this.instance.device.updateData(s);if(!o.success){let c=s.display_title||s.title||"";return{success:!1,message:await De("Failed to update project library device {title}!",{title:c})}}this.result.device=o}return{success:!0}}};var Tf=class{constructor(t){if(!t)throw new Error("invalid projectId");this.uuid=t,Ge(this.uuid)&&(this.project=X(this.uuid))}async create(t){return new mf({...t,uuid:this.uuid}).start()}async update(t){let{data:{device:s,symbol:r,footprint:i}}=t;return new bf({data:{device:{data:s},symbol:{data:r},footprint:{data:i}},uuid:this.uuid}).start()}async cancelAssociate(t){var s;try{let{datas:r,options:i={}}=t,n=[],a=[];for(let o=0;o<r.length;o++){let c=r[o];i.cancelSymbol&&delete c.attributes.Symbol,i.cancelFootprint&&delete c.attributes.Footprint;let l=await this.update({data:{device:c}}),u=(s=l.result)==null?void 0:s.device;l.success&&u.success?n.push({uuid:c.uuid,title:c.display_title}):a.push({uuid:c.uuid,title:c.display_title,message:(u==null?void 0:u.message)||l.message})}return{success:!0,result:{succeed:n,failed:a}}}catch(r){return{success:!1,message:r.message}}}async delete(t){try{let s={devices:null,symbols:null,footprints:null},{devices:r,symbols:i,footprints:n}=t;if(r&&r.length){s.devices={succeed:[],failed:[]};for(let a=0;a<r.length;a++){let o=r[a];(await this.project.device.deleteData(o)).success?s.devices.succeed.push(o):s.devices.failed.push(o)}}if(i&&i.length){s.symbols={succeed:[],failed:[]};for(let a=0;a<i.length;a++){let o=i[a];(await this.project.symbol.deleteData(o)).success?s.symbols.succeed.push(o):s.symbols.failed.push(o)}}if(n&&n.length){s.footprints={succeed:[],failed:[]};for(let a=0;a<n.length;a++){let o=n[a];(await this.project.footprint.deleteData(o)).success?s.footprints.succeed.push(o):s.footprints.failed.push(o)}}return{success:!0,result:s}}catch(s){return{success:!1,message:s.message}}}async get(t){var s,r,i;try{let{data:n,options:a={}}=t,o=n.device?[n.device]:void 0,c=n.symbol?[n.symbol]:void 0,l=n.footprint?[n.footprint]:void 0,u=await this.batchGet({devices:o,symbols:c,footprints:l},a);if(!u.success)return{success:!1,code:u.code,message:u.message};let h=u.result,p=((s=h.devices)==null?void 0:s[0])||null,d=((r=h.symbols)==null?void 0:r[0])||null,f=((i=h.footprints)==null?void 0:i[0])||null;return{success:!0,result:{device:p,symbol:d,footprint:f}}}catch(n){return{success:!1,message:n.message}}}async batchGet(t,s={}){var r,i,n;try{let{devices:a,symbols:o,footprints:c}=t,{needStr:l=!1,withRelated:u=!1}=s,h={devices:null,symbols:null,footprints:null};if(a&&a.length){h.devices=[];for(let d=0;d<a.length;d++){let f=a[d],m=this.project&&((r=await this.project.device.getData(f))==null?void 0:r.result);if(m)if(h.devices.push(m),u){let{symbol:g,foortpint:b}=await p.call(this,m);h.devices.push(Object.assign(m,{symbol:g,foortpint:b}))}else h.devices.push(m);else h.devices.push(null)}}if(o&&o.length){h.symbols=[];for(let d=0;d<o.length;d++){let f=o[d],m=this.project&&((i=await this.project.symbol.getData(f))==null?void 0:i.result);m?h.symbols.push(m):h.symbols.push(null)}}if(c&&c.length){h.footprints=[];for(let d=0;d<c.length;d++){let f=c[d],m=this.project&&((n=await this.project.footprint.getData(f))==null?void 0:n.result);m?h.footprints.push(m):h.footprints.push(null)}}return{success:!0,result:h};async function p(d){let f=d.attributes.Symbol,m=d.attributes.Footprint,g=f&&this.project&&await this.project.symbol.getData(f),b=m&&this.project&&await this.project.footprint.getData(m);return{symbol:g,footprint:b}}}catch(a){return{success:!1,message:a.message}}}async updateDevices(t){var s;try{let r=[],i=[],n=t.map(a=>({device:a}));if(this.project){let a=((s=await this.project.device.place(n))==null?void 0:s.result)||[];for(let o=0;o<a.length;o++){let{device:c}=a[o];c.success?r.push({uuid:c.result.uuid,title:c.result.display_title}):i.push({uuid:c.result.uuid,title:c.result.display_title})}}return{success:!0,result:{succeed:r,failed:i}}}catch(r){return{success:!1,message:r.message}}}async force(t){var s,r,i,n,a,o;try{let{device:c,symbol:l,footprint:u}=t,h={},p={device:null,symbol:null,footprint:null},d={},f="",m="";if(c){let E=this.project&&((s=await this.project.device.getData(c.uuid))==null?void 0:s.result);E?(p.device={success:!0,result:E},f=E.attributes.Symbol,m=E.attributes.Footprint):d.device=c}let g=f&&this.project&&((r=await this.project.symbol.getData(f))==null?void 0:r.result);!g||f!==(l==null?void 0:l.uuid)?d.symbol=l:f?p.symbol={success:!0,result:g}:p.symbol=null;let b=m&&this.project&&((i=await this.project.footprint.getData(m))==null?void 0:i.result);if(!b||m!==(u==null?void 0:u.uuid)?d.footprint=u:m?p.footprint={success:!0,result:b}:p.footprint=null,Object.keys(d).length){let E=await this.create({data:d});if(!E.success)return{success:!1,message:E.message};let y=E.result;if((n=y.device)!=null&&n.success){let T=y.device.result;p.device={success:!0,result:T},h[d.device.uuid]=T.uuid}else y.device&&(p.device=y.device);if((a=y.symbol)!=null&&a.success){let T=y.symbol.result;p.symbol={success:!0,result:T},h[d.symbol.uuid]=T.uuid}else y.symbol&&(p.symbol=y.symbol);if((o=y.footprint)!=null&&o.success){let T=y.footprint.result;p.footprint={success:!0,result:T},h[d.footprint.uuid]=T.uuid}else y.footprint&&(p.footprint=y.footprint)}else c&&(p.device=this.project&&await this.project.device.updateData(c)),l&&(p.symbol=this.project&&await this.project.symbol.updateData(l)),u&&(p.footprint=this.project&&await this.project.footprint.updateData(u));return{success:!0,result:{...p,map:h}}}catch(c){return{success:!1,message:c.message}}}async upload(t){try{let{devices:s,components:r}=t,i={devices:null,components:null};if(s&&s.length){let n=[];for(let o=0;o<s.length;o++){let c=s[o];n.push(await this.project.device.addData(c))}let a=(await Promise.all(n)).map(o=>o.result);i.devices={success:!0,result:a}}if(r&&r.length){let n=[];for(let o=0;o<r.length;o++){let c=r[o];c.docType===Ne.FOOTPRINT?n.push(await this.project.footprint.addData(c)):ni(c.docType)&&n.push(await this.project.symbol.addData(c))}let a=(await Promise.all(n)).map(o=>o.result);i.components={success:!0,result:a}}return{success:!0,result:i}}catch(s){return{success:!1,message:s.message}}}async getSource(t){try{let{uuid:s,docType:r}=t;return r===Ne.FOOTPRINT?this.getFootprint(s):ni(r)?this.getSymbol(s):{success:!1,message:"Api call error! The api does not exist!"}}catch(s){return{success:!1,message:s.message}}}async getSymbol(t){let s=await this.project.symbol.getData(t);if(!s.success)return{success:!1,message:s.message};let r=s.result,i=await this.project.symbol.getStr(t);if(!i.success)return{success:!1,message:i.message};let n=i.result;return{success:!0,result:Object.assign(r,{canvas:n})}}async getFootprint(t){let s=await this.project.footprint.getData(t);if(!s.success)return{success:!1,message:s.message};let r=s.result,i=await this.project.footprint.getStr(t);if(!i.success)return{success:!1,message:i.message};let n=i.result;return{success:!0,result:Object.assign(r,{canvas:n})}}};function os(e){if(Ge(e))return new Tf(e);if(e)return new hf(e);throw new Error(`Api call error! The api does not exist! params: ${e}`)}var xl=class{constructor(t){let{info:s,set:r,symbol:i,footprint:n,component:a,options:o={}}=t;this.info=s,this.set=r,this.symbol=i,this.footprint=n,this.component=a,this.options=o,this.progress=new qs({progressTip:"Component save as cloud...",total:4})}async start(){try{let t;return this.symbol?t=await this.createSymbol():this.footprint?t=await this.createFootprint():t=await this.createComponent(),t.success?(await this.onsucceed(),{success:!0,...t}):(this.onfailed({code:t.code,message:t.message}),{success:!1,code:t.code,message:t.message})}catch(t){return{success:!1,message:t.message}}}getDevice(){return this.options.createDevice===!0?{path:this.set,title:this.info.title,tags:this.info.tags,custom_tags:this.info.custom_tags,description:this.info.description,attributes:{Symbol:this.symbol||"",Footprint:this.footprint||""}}:this.options.createDevice}async onsucceed(){this.progress.update(!0),ze("info",["Document saves successfully!"])}async onfailed(t){this.progress.update(!0);let{code:s,message:r}=t,i=Dt({code:s}),a=["Document saves failure information:",...i?[i]:Array.isArray(r)?r:[r]];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:a}),ze("error",a)}};var wf=class extends xl{constructor(t){let{get:s}=t;super(t),this.get=s}async createSymbol(){let t=await se.getInstance().component.get({uuid:this.symbol,path:this.get,needTransform:!0});if(t.success===!1)return{success:!1,code:t.code,message:t.message};let s=t.result;if(this.progress.update(),!s.canvas)return{success:!1,message:"Please select data again!"};let i=Object.assign(s,this.info,{path:this.set}),n=this.getDevice(),a=await os(this.set).create({data:{device:n,symbol:i}});if(!a.success)return{success:!1,code:a.code,message:a.message};this.progress.update();let o=a.result;if(!o.symbol.success)return{success:!1,code:o.symbol.code,message:o.symbol.message};let c=o.symbol,l=o.device;return this.progress.update(),{success:!0,result:{device:l,symbol:c,footprint:null}}}async createFootprint(){let t=await se.getInstance().component.get({uuid:this.footprint,path:this.get,needTransform:!0});if(t.success===!1)return{success:!1,code:t.code,message:t.message};let s=t.result;if(this.progress.update(),!s.canvas)return{success:!1,message:"Please select data again!"};let i=Object.assign(s,this.info,{path:this.set}),n=this.getDevice(),a=await os(this.set).create({data:{device:n,footprint:i}});if(!a.success)return{success:!1,code:a.code,message:a.message};this.progress.update();let o=a.result;if(!o.footprint.success)return{success:!1,code:o.footprint.code,message:o.footprint.message};let c=o.footprint,l=o.device;return this.progress.update(),{success:!0,result:{device:l,symbol:null,footprint:c}}}async createComponent(){let t=await se.getInstance().component.get({uuid:this.component,path:this.get,needStr:!0});if(t.success===!1)return{success:!1,code:t.code,message:t.message};let s=t.result;if(this.progress.update(),!s.canvas)return{success:!1,message:"Please select data again!"};let i=Object.assign(s,this.info,{path:this.set});return s.docType===Ss.PANEL_LIB?this.createPanelLib(i):this.createOtherLib(i)}async createPanelLib(t){let s=await os(this.set).create({data:{component:t}});if(!s.success)return{success:!1,code:s.code,message:s.message};this.progress.update();let r=s.result;if(!r.component.success)return{success:!1,code:r.component.code,message:r.component.message};let i=r.component;return this.progress.update(),{success:!0,result:{device:null,symbol:null,footprint:null,component:i}}}async createOtherLib(t){let s=await os(this.set).create1(t);return s.success?(this.progress.update(),{success:!0,result:{device:null,symbol:null,footprint:null,component:s}}):{success:!1,code:s.code,message:s.message}}};var Sf=class extends xl{constructor(t){let{get:s}=t;super(t),this.uuid=s,this.instance=X(this.uuid)}async createSymbol(){let t=(await this.instance.symbol.getStr(this.symbol)).result;if(!t)return{success:!1,message:"Please select data again!"};this.progress.update();let s=Object.assign(this.info,{path:this.set,canvas:t}),r=this.getDevice(),i=await os(this.set).create({data:{device:r,symbol:s}});if(!i.success)return{success:!1,code:i.code,message:i.message};this.progress.update();let n=i.result;if(!n.symbol.success)return{success:!1,code:n.symbol.code,message:n.symbol.message||n.symbol.result};let a=n.symbol,o=n.device;return this.progress.update(),{success:!0,result:{device:o,symbol:a,footprint:null}}}async createFootprint(){let t=(await this.instance.footprint.getStr(this.footprint)).result;if(!t)return{success:!1,message:"Please select data again!"};this.progress.update();let s=Object.assign(this.info,{path:this.set,canvas:t}),r=this.getDevice(),i=await os(this.set).create({data:{device:r,footprint:s}});if(!i.success)return{success:!1,code:i.code,message:i.message};this.progress.update();let n=i.result;if(!n.footprint.success)return{success:!1,code:n.footprint.code,message:n.footprint.message||n.footprint.result};let a=n.footprint,o=n.device;return this.progress.update(),{success:!0,result:{device:o,symbol:null,footprint:a}}}async createComponent(){return{success:!1,message:"Api call error! The api does not exist!"}}};var B0=class extends Ao{constructor(t){let{progressOptions:s={}}=t,r={progressTip:"save as cloud...",...s};super({...t,progressOptions:r})}async getData(){return{success:!0,result:this.datas}}onsucceed(t){this.needTip&&ze("info",["Project saves successfully!"])}onfailed(t){if(this.needTip){let s=["Project saves failure information:",...t.message];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:s}),ze("error",s)}}},k0=class extends Ao{constructor(t){let{uuid:s,progressOptions:r={}}=t,n={progressTip:"Document save as cloud...",total:5,...r};super({...t,progressOptions:n}),this.from=s,this.ARelated=t}async getData(){try{let{name:t,cbb_project:s}=this.info,i=await new An({uuid:this.from,datas:this.ARelated,name:t,cbb_project:s}).flow({progress:this.progress});if(i.success===!1)return{success:!1,code:i.code,message:i.message};this.progress.update();let{channelId:n,images:a}=i.result;return{success:!0,result:{dataStr:n,images:a}}}catch(t){return{success:!1,message:t.message}}}onsucceed(t){this.needTip&&ze("info",["Document saves successfully!"])}onfailed(t){if(this.needTip){let s=["Document saves failure information:",...t.message];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:s}),ze("error",s)}}},M0=class extends Ao{constructor(t){let{cbb:s,info:r,progressOptions:i={}}=t,n={progressTip:"Cbb save as cloud...",...i};super({...t,progressOptions:n});let{owner:a,content:o,custom_tags:c}=r;this.args={...s,description:o,custom_tags:c,progressOptions:i}}async getData(){let t=await new mi().flow(this.args);if(t.success===!1)return{success:!1,code:t.code,message:t.message};let{channelId:s,images:r}=t.result;return{success:!0,result:{dataStr:s,images:r}}}onsucceed(t){this.needTip&&ze("info",["Reuse block saves successfully!"])}onfailed(t){if(this.needTip){let s=["Reuse block saves failure information:",...t.message];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:s}),ze("error",s)}}},j0=class{constructor(t){Ge(t.get)?this.tool=new Sf(t):this.tool=new wf(t)}async start(t={}){try{return this.tool.start()}catch(s){return{success:!1,message:s.message}}}};var F0=class extends Ao{constructor(t){let{progressOptions:s={}}=t,r={progressTip:"Import Project...",...s};super({...t,progressOptions:r})}async getData(){return{success:!0,result:this.datas}}onsucceed(t){this.needTip&&ze("info",["Import project successfully!"])}onfailed(t){if(this.needTip){let s=["Import project failure information:",...t.message];fe.messageBus.publish("ui/toastMsg",{type:"error",msg:s}),ze("error",s)}}};var xx="project_document_update",vx="project_pastingOtherDocumentToCurrentProject";var vl=class{constructor(t){let{cmd:s,uuid:r=fe.currentProject.projectId,renameKey:i=!0,byUUID:n=!0,byVersion:a=!0,isCanvas:o=!1,fixLib:c=!0}=t;if(!Ge(r))throw new Error("'Target Project not Opened!'");this.cmd=s,this.uuid=r,this.insatnce=X(this.uuid),this.apaste={...t,renameKey:i,byUUID:n,byVersion:a,fixLib:c},this.isCanvas=o}async check(){try{let t=await this.hasPermission();return t.success===!1?{success:!1,code:t.code,message:t.message}:{success:!0}}catch(t){return{success:!1,message:t.message}}}async hasPermission(){var i;let t=((i=this.from)==null?void 0:i.uuid)!==this.uuid?vx:xx,s={projectId:this.uuid,type:t,showErrorMsg:!0},{message:r}=await fe.messageBus.rpcCall("/pro-ui/judgePermission",s);return r!=null&&r.hasPermission?{success:!0}:{success:!1,message:"You don't have copy and paste permission!"}}};var yc=class extends vl{async getData(){var s,r;let t=await ft.stores.copyAndPaste.getData();return this.datas=(s=t==null?void 0:t.tree)==null?void 0:s.datas,this.from=(r=t==null?void 0:t.tree)==null?void 0:r.from,this.datas?{success:!0}:{success:!1,message:"No need to paste data!"}}async start(){try{console.time("paste getData");let t=await this.getData();if(t.success===!1)return{success:!1,code:t.code,message:t.message};console.timeEnd("paste getData"),console.time("paste check");let s=await this.check();if(s.success===!1)return{success:!1,code:s.code,message:s.message};console.timeEnd("paste check");let r="exist3.0",i={...this.apaste,uuid:this.uuid,datas:this.datas,from:this.from,isCanvas:this.isCanvas,structure:r};console.time("paste ImportTarget");let n=await this.insatnce.project.import(i);return n.success===!1?{success:!1,code:n.code,message:n.message}:(console.timeEnd("paste ImportTarget"),{success:!0,result:n.result})}catch(t){return{success:!1,message:t.message}}}};var _f=class extends yc{};var Ec=class extends vl{constructor(t={}){super({...t,isCanvas:!0})}async getData(){var s,r,i,n;let t=await ft.stores.copyAndPaste.getData();return this.canvas=(r=(s=t==null?void 0:t.canvas)==null?void 0:s[this.cmd])==null?void 0:r.canvas,this.from=(n=(i=t==null?void 0:t.canvas)==null?void 0:i[this.cmd])==null?void 0:n.from,this.canvas?{success:!0}:{success:!1,message:"No need to paste data!"}}async start(){try{let t=await this.getData();if(t.success===!1)return{success:!1,code:t.code,message:t.message};let s=await this.check();if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r="exist3.0",i={...this.apaste,uuid:this.uuid,datas:this.canvas,from:this.from,isCanvas:this.isCanvas,structure:r},n=await this.insatnce.project.import(i);return n.success===!1?{success:!1,code:n.code,message:n.message}:{success:!0,result:Object.assign(n.result,{from:this.from})}}catch(t){return{success:!1,message:t.message}}}};var Af=class extends yc{};var Cf=class extends yc{};var wh=class extends Ec{async getData1(){var s,r,i,n;let t=await ft.stores.copyAndPaste.getData();return this.reuseBlocks=(r=(s=t==null?void 0:t.canvas)==null?void 0:s[this.cmd])==null?void 0:r.reuseBlocks,this.from=(n=(i=t==null?void 0:t.canvas)==null?void 0:i[this.cmd])==null?void 0:n.from,{success:!0}}async bottom(t){try{let s=await this.getData1();if(s.success===!1)return{success:!1,code:s.code,message:s.message};if(this.reuseBlocks){let r=await this.handleBlockSymbol(t);if(r.success===!1)return{success:!1,code:r.code,message:r.message};let i=await this.check();if(i.success===!1)return{success:!1,code:i.code,message:i.message};let n="exist3.0",a={...this.apaste,uuid:this.uuid,datas:this.reuseBlocks,from:this.from,isCanvas:this.isCanvas,structure:n},o=await this.insatnce.project.import(a);return o.success===!1?{success:!1,code:o.code,message:o.message}:{success:!0,result:Object.assign(o.result,{from:this.from})}}return{success:!0,result:null}}catch(s){return{success:!1,message:s.message}}}async handleBlockSymbol(t){var n;let{symbols:s}=this.reuseBlocks,r=s.filter(a=>a.docType===Ss.BLOCK_SYMBOL),i=X(this.uuid);for(let a of r){let o=(n=t==null?void 0:t.symbolMap)==null?void 0:n[a.uuid],c=o&&(await i.symbol.getData(o)).result;c&&(Object.assign(a,c),a.origin=!1)}return{success:!0}}};var Xn=class{async boards(t={}){try{return t.cmd=ki.Board,new _f(t).start()}catch(s){return{success:!1,message:s.message}}}async schematics(t={}){try{return t.cmd=ki.Schematic,new Cf(t).start()}catch(s){return{success:!1,message:s.message}}}async pages(t={}){try{if(!t.cmd)throw new Error(`Missing cmd!!! ${t.cmd}`);return new Af(t).start()}catch(s){return{success:!1,message:s.message}}}async schTop(t={}){try{return t.cmd=ki.SchCanvas,new wh(t).start()}catch(s){return{success:!1,message:s.message}}}async schBottom(t={}){try{return t.cmd=ki.SchCanvas,new wh(t).bottom(t.map)}catch(s){return{success:!1,message:s.message}}}async pcbCanvas(t={}){try{return t.cmd=ki.PcbCanvas,new Ec(t).start()}catch(s){return{success:!1,message:s.message}}}async panelCanvas(t={}){try{return t.cmd=ki.PanelCanvas,new Ec(t).start()}catch(s){return{success:!1,message:s.message}}}};var Rl=class{constructor(){this.datas=[]}async compareByString(t,s){try{let i=await Jm({dataStr:t,config:s,callback:async n=>{this.tempUUID=n;let o=await X(n).pcb.getAllArrData();if(!o.success)return{success:!1,message:o.message};for(let c of o.result)this.datas.push({uuid:c.uuid,title:c.display_title||c.title});return{success:!0}},autoClose:!1});return i.success===!1?{success:!1,message:i.message}:{success:!0,result:{id:this.tempUUID,datas:this.datas}}}catch(r){return{success:!1,message:r.message}}}async destory(){this.tempUUID&&await vA(this.tempUUID)}};var Df=class extends Rl{constructor(s){super();this.uuid=s}async load(){try{let s=await se.getInstance().project.get(this.uuid);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result,{branch_uuid:i}=r;if(i){let n=await new Ia({uuid:this.uuid}).getExport();if(n.success===!1)return{success:!1,message:n.message};let{dataStr:a,config:o}=n.result,c={title:o.name,cbbProject:o.cbb_project,uuid:this.uuid};return this.compareByString(a,c)}else{let n=await new wo({uuid:this.uuid}).getExport();if(n.success===!1)return{success:!1,message:n.message};let a=n.result;for(let o of a.pcbs)this.datas.push({uuid:o.uuid,title:o.display_title||o.title});return{success:!0,result:{datas:this.datas}}}}catch(s){return{success:!1,message:s.message}}}};var Pf=class extends Rl{constructor(s){super();this.file=s}async load(){try{let s=await new Ii({file:this.file}).start();if(s.success===!1)return{success:!1,code:s.code,message:s.message};if(s.result.dataStr!==void 0){let{dataStr:r,config:i}=s.result,n={title:i.title,cbbProject:i.cbb_project};return this.compareByString(r,n)}else{let r=s.result;for(let i of r.pcbs)this.datas.push({uuid:i.uuid,title:i.display_title||i.title});return{success:!0,result:{datas:this.datas}}}}catch(s){return{success:!1,message:s.message}}}};var va=class va extends Qo{static getInstance(){return va.tool==null&&(va.tool=new va),va.tool}constructor(){super()}async cloud(t){try{let s=va.getInstance(),r=new Df(t),i=await r.load();if(i.success===!1)return{success:!1,message:i.message};let{datas:n,id:a}=i.result;return a&&s.add(a,r),{success:!0,result:{id:a,datas:n}}}catch(s){return{success:!1,message:s.message}}}async local(t){try{let s=va.getInstance(),r=new Pf(t),i=await r.load();if(i.success===!1)return{success:!1,message:i.message};let{datas:n,id:a}=i.result;return a&&s.add(a,r),{success:!0,result:{id:a,datas:n}}}catch(s){return{success:!1,message:s.message}}}async destory(t){if(t){let s=va.getInstance(),r=s.get(t);if(!r)throw new Error("Destroy non-existent compare instances!");await r.destory(),s.del(t)}}};va.tool=null;var Nl=va;var Of=class{constructor(t){this.file=t;if(!t)throw new Error("invalid file!")}async start(){let t=await this.unzip();if(t.success===!1)return{success:!1,message:t.message};let{dataStr:s,config:r}=t.result;if(!s)return{success:!1,message:"Open up illegal project!"};let i=await Jm({dataStr:s,config:r,autoClose:!1,notify:!0});return i.success===!1?{success:!1,message:i.message}:{success:!0}}async unzip(){let t=await new Ii({file:this.file}).start();if(t.success===!1)return{success:!1,message:t.message};let{type:s,result:r}=t;if(s==="project.json"){let{title:i,cbbProject:n}=r.config,a={name:i,cbb_project:n},o=await new Yi({datas:r,info:a}).start();if(o.success===!1)return{success:!1,message:o.message};let{dataStr:c}=o.result,l={title:i,cbbProject:n};return{success:!0,result:{dataStr:c.join(Le),config:l}}}else if(s==="project2.json"){let{dataStr:i,config:n}=r,{uuid:a,title:o,cbb_project:c}=n;return{success:!0,result:{dataStr:i,config:{title:o,cbbProject:c,uuid:a}}}}else return{success:!1,message:"Illegal file!"}}};var If=class{constructor(t){this.failed=[];this.map={};let{uuid:s,datas:r}=t;if(!s)throw new Error(`invalid uuid!${s}`);if(!Ge(this.uuid))throw new Error(`Target Project not Opened!${s}`);this.uuid=s,this.instance=X(this.uuid),this.datas=this.parse(r);let i=this.total(r,Object.keys(this.datas).length);this.progress=new qs({needProgress:!0,progressTip:"Update reuse block...",total:i})}parse(t){let{schematics:s,pcbs:r,blockSymbols:i}=t,n={};if(s&&s.length)for(let a of s){let{uuid:o,title:c,source:l}=a,[u,h]=l.split(Rs);if(!h){this.failed.push(`invalid path! path: ${h}`);continue}n[h]||(n[h]={schematics:[],pcbs:[],blockSymbols:[]}),n[h].schematics.push({uuid:o,title:c,source:u})}if(r&&r.length)for(let a of r){let{uuid:o,title:c,source:l}=a,[u,h]=l.split(Rs);if(!h){this.failed.push(`invalid path! path: ${h}`);continue}n[h]||(n[h]={schematics:[],pcbs:[],blockSymbols:[]}),n[h].pcbs.push({uuid:o,title:c,source:u})}if(i&&i.length)for(let a of i){let{uuid:o,title:c,source:l}=a,[u,h]=l.split(Rs);if(!h){this.failed.push(`invalid path! path: ${h}`);continue}n[h]||(n[h]={schematics:[],pcbs:[],blockSymbols:[]}),n[h].blockSymbols.push({uuid:o,title:c,source:u})}return n}total(t,s){return Object.entries(t).reduce((r,[i,n])=>r+n.length,0)*2+2+s*2+2}async start(){console.time("UpdateReuseBlock--------------------"),this.progress.update();for(let t in this.datas){let s=this.datas[t];console.time("UpdateReuseBlock analyze");let r=await this.analyze(s);this.progress.update(),console.timeEnd("UpdateReuseBlock analyze"),console.time("UpdateReuseBlock getTarget");let i=await new mi().getTarget({uuid:t,origin:this.getOrigin(s)});if(i.success===!1){let l=await De("Failed to obtain project data!");this.failed.push(`${l} path: ${t}`);continue}if(this.progress.update(),console.timeEnd("UpdateReuseBlock getTarget"),console.time("UpdateReuseBlock copyOld"),(await this.copyOld(s)).success===!1)continue;console.timeEnd("UpdateReuseBlock copyOld"),console.time("UpdateReuseBlock convert");let a=await this.convert(i.result);if(a.success===!1)continue;let o=a.result;console.timeEnd("UpdateReuseBlock convert"),console.time("UpdateReuseBlock update"),(await this.update(r,o)).success!==!1&&console.timeEnd("UpdateReuseBlock update")}for(let t of this.failed)ze("error",[t]);return this.progress.update(!0),console.timeEnd("UpdateReuseBlock--------------------"),{success:!0,result:this.map}}async analyze(t){let{schematics:s,pcbs:r,blockSymbols:i}=t,n=[],a=[],o=[],c={};for(let u of s){let{uuid:h,title:p}=u,d=(await this.instance.schematic.getData(h)).result;if(!d){n.push(p);continue}c[p]=c[p]||{},c[p].schematic=Object.assign(u,{version:d.version,board:d.board})}for(let u of r){let{uuid:h,title:p}=u,d=(await this.instance.pcb.getData(h)).result;if(!d){a.push(p);continue}c[p]=c[p]||{},c[p].pcb=Object.assign(u,{version:d.version,board:d.board})}for(let u of i){let{uuid:h,title:p}=u,d=(await this.instance.symbol.getData(h)).result;if(!d){o.push(p);continue}c[p]=c[p]||{},c[p].blockSymbol=Object.assign(u,{version:d.version})}let l=await De("File missing!");if(n.length){let u=await De("Schematic");this.failed.push(`${u} ${n.join("\u3001")} ${l}`)}if(a.length){let u=await De("Pcb");this.failed.push(`${u} ${a.join("\u3001")} ${l}`)}if(o.length){let u=await De("Reuse Block symbol");this.failed.push(`${u} ${o.join("\u3001")} ${l}`)}return c}getOrigin(t){return{schematicIds:t.schematics.map(s=>s.source),pcbIds:t.pcbs.map(s=>s.source),symbolIds:t.blockSymbols.map(s=>s.source)}}async copyOld(t){let{schematics:s,pcbs:r}=t;for(let i of s){let{uuid:n,title:a}=i,o={uuid:n,display_name:this.getOldTitle(a),renameKey:!0,board:"",source:"",version:"",keepVersion:!0};if((await this.instance.schematic.updateData(o)).success===!1){let l=await De("Clone schematic {title} copy failed!",{title:a});this.failed.push(l)}this.progress.update()}for(let i of r){let{uuid:n,title:a}=i,o={uuid:n,display_title:this.getOldTitle(a),renameKey:!0,board:"",source:"",version:"",keepVersion:!0};if((await this.instance.pcb.updateData(o)).success===!1){let l=await De("Clone PCB {title} copy failed!",{title:a});this.failed.push(l)}this.progress.update()}return{success:!this.failed.length}}async convert(t){if(t.branch_uuid)return this.progress.update(),{success:!0,result:t};{let{config:s}=t,r={name:s.title,cbb_project:s.cbbProject},i=await new Yi({datas:t,info:r}).start();if(i.success===!1)return this.failed.push(i.message),{success:!1};let n=await new _n({str:i.result.dataStr}).start();return n.success===!1?(this.failed.push(n.message),{success:!1}):(this.progress.update(),{success:!0,result:n.result})}}getOldTitle(t){return`${t}_old`}async update(t,s){let r=Object.keys(t).sort();for(let i of r){let n=t[i],a=await this.handleOrigin(n,s);if(a.success===!1)return this.failed.push(a.message),{success:!1};let o=await this.instance.project.import({uuid:this.uuid,datas:a.result,fixCBB:!0});if(o.success===!1)return this.failed.push(o.message),{success:!1};let{map:c}=o.result;if(Object.entries(c).forEach(([u,h])=>{this.map[u]=this.map[u]||{},Object.entries(h).forEach(([p,d])=>{this.map[u][p]=d})}),(await this.updateBlockSymbol(n.blockSymbol)).success===!1)return{success:!1}}return{success:!0}}async handleOrigin(t,s){let{schematic:r,pcb:i,blockSymbol:n}=t,a=[],o={},c=[],l=[],u=[],h=new Set,{schematics:p,pcbs:d,symbols:f,schs:m,boards:g}=s;for(let b of p){let{uuid:E,board:y}=b;(r==null?void 0:r.source)===E&&(y&&h.add(y),b.board=r.board,a.push(b))}for(let b in m)(r==null?void 0:r.source)===b&&(o[b]=m[b]);for(let b of d){let{uuid:E,board:y}=b;(i==null?void 0:i.source)===E&&(y&&h.add(y),b.board=i.board,c.push(b))}for(let b of f){let{uuid:E,docType:y}=b;(y!==Ss.BLOCK_SYMBOL||(n==null?void 0:n.source)===E)&&l.push(b)}for(let b of g){let{uuid:E}=b;h.has(E)||u.push(b)}return{success:!0,result:Object.assign(s,{schematics:a,pcbs:c,schs:o,symbols:l,boards:u})}}async updateBlockSymbol(t){var s;if(t){let{uuid:r,title:i,source:n}=t,a=(s=this.map.symbolMap)==null?void 0:s[n],o=a&&(await this.instance.symbol.getData(a)).result;if(o){let c=o.version,l={uuid:r,display_title:o.display_title,title:o.title,docType:o.docType,description:o.description,custom_tags:o.custom_tags,version:c,keepVersion:!0};if(!(await this.instance.symbol.updateData(l)).result){let d=await De("Failed to update old blockSymbol {title}!",{title:i});this.failed.push(d);return}let h=(await this.instance.symbol.getCanvas(a)).result;if(!await this.instance.symbol.coverCanvas(r,h,c)){let d=await De("Failed to update old blockSymbol {title}!",{title:i});this.failed.push(d);return}await this.instance.symbol.deleteData(a),this.map.symbolMap[n]=r}}return this.progress.update(),{success:!this.failed.length}}};var Nx=Ei(Vi());async function sw(e){let t=new Worker(`editor?entry=mgr-backup.js&cll=${self.PRO_LOG_LEVEL}`,{name:`backup_${window._TAB_ID_}`}),s=new Nx.WorkerMessageBridge(fe.messageBus,t);try{return(await s.rpcCall("/mgr/backup/start",e)).message}catch(r){throw new Error(`backup error:${r}`)}finally{t.terminate()}}var Lx="copy";var Zn=class{constructor(t){let{cmd:s,datas:r,analyzeReuseBlock:i=!1,uuid:n=fe.currentProject.projectId}=t;this.analyzeReuseBlock=i,this.cmd=s,n&&(this.uuid=n,this.instance=X(this.uuid)),this.datas=r}async start(){try{console.time("copy...."),console.time("copy check");let t=await this.check();if(t.success===!1)return{success:!1,code:t.code,message:t.message};console.timeEnd("copy check"),console.time("copy onpreprocessing"),await this.onpreprocessing(),console.timeEnd("copy onpreprocessing"),console.time("copy getRelated");let s=await this.getRelated();if(s.success===!1)return{success:!1,code:s.code,message:s.message};console.timeEnd("copy getRelated"),console.time("copy getOrigin"),this.origin=await this.getOrigin(),console.timeEnd("copy getOrigin"),console.time("copy getForm");let r=this.getForm()||{uuid:this.uuid};console.timeEnd("copy getForm"),console.time("copy specified");let i=await this.specified(r);if(i.success===!1)return{success:!1,code:i.code,message:i.message};console.timeEnd("copy specified");let n=this.getOut(i.result);if(n){console.time("copy checkAbnormalData");let a=await this.checkAbnormalData(n);if(a.success===!1)return{success:!1,code:a.code,message:a.message};console.timeEnd("copy checkAbnormalData");let o=a.result;if(console.time("copy setData"),!await ft.stores.copyAndPaste.setData(o))return{success:!1,message:"Copy failed"};console.timeEnd("copy setData")}return console.timeEnd("copy...."),{success:!0}}catch(t){return{success:!1,message:t.message}}}async check(){try{let t=await this.hasPermission();return t.success===!1?{success:!1,code:t.code,message:t.message}:{success:!0}}catch(t){return{success:!1,message:t.message}}}async hasPermission(){if(this.uuid){let t={projectId:this.uuid,type:Lx,showErrorMsg:!0},{message:s}=await fe.messageBus.rpcCall("/pro-ui/judgePermission",t);if(!(s!=null&&s.hasPermission))return{success:!1,message:"You don't have copy and paste permission!"}}return{success:!0}}getOut(t){return{tree:t.tree,canvas:t.canvas}}async checkDevice(t){if(t){let{devices:s=[],symbols:r=[],footprints:i=[]}=t,n=[],a=[],o=r.reduce((u,h)=>u.add(h.uuid),new Set),c=i.reduce((u,h)=>u.add(h.uuid),new Set);for(let u in s){let h=s[u],{title:p,attributes:d}=h,{Symbol:f,Footprint:m}=d;f&&!o.has(f)&&n.push(p),m&&!c.has(m)&&a.push(p)}let l=[];if(n.length){let h=`${await De("The following devices lose bound symbol data!")}: ${n.join("\u3001")}`;l.push(h)}if(a.length){let h=`${await De("The following devices lose bound footprint data!")}: ${a.join("\u3001")}`;l.push(h)}if(l.length)return ze("warn",l),{success:!1,message:l.join(" ")}}return{success:!0}}};var xf=class extends Zn{onpreprocessing(){}async getRelated(){let t=await this.instance.project.related({uuid:this.uuid,boardIds:this.datas});return t.success===!1?{success:!1,message:t.message}:(this.related=t.result,{success:!0})}async getOrigin(){let t=new Array,s=new Array,r=new Array;for(let i of this.datas){let n=(await this.instance.schematic.getArrByBoard(i)).result;n!=null&&n.length&&n.forEach(o=>s.push(o.uuid));let a=(await this.instance.pcb.getArrByBoard(i)).result;a!=null&&a.length&&a.forEach(o=>r.push(o.uuid)),t.push(i)}return{boardIds:t,schematicIds:s,pcbIds:r}}getForm(){return{uuid:this.uuid,cmd:this.cmd,self:this.datas}}async specified(t){if(Object.values(this.related).reduce((s,r)=>s+r.size,0)){let s=await new Tr({uuid:this.uuid,datas:this.related,origin:this.origin}).start();if(s.success===!1)return{success:!1,code:s.code,message:s.message};let i={datas:s.result,from:t},n=await ft.stores.copyAndPaste.getData();return{success:!0,result:Object.assign(n||{},{tree:i})}}return{success:!0,result:null}}async checkAbnormalData(t){var r;let s=await this.checkDevice((r=t.tree)==null?void 0:r.datas);return s.success===!1?{success:!1,message:s.message}:{success:!0,result:t}}};var vf=class extends Zn{constructor(){super(...arguments);this.sheetIds=new Array;this.pcbIds=new Array;this.panelIds=new Array}onpreprocessing(){let{sheets:s={},pcbs:r=[],panels:i=[]}=this.datas;for(let n in s)this.sheetIds.push(n);this.pcbIds=r,this.panelIds=i,this.pathMap=s}async getRelated(){let s={uuid:this.uuid,sheetIds:Array.from(this.sheetIds),pcbIds:Array.from(this.pcbIds),panelIds:Array.from(this.panelIds),analyzeReuseBlock:this.analyzeReuseBlock,pathMap:this.pathMap},r=await this.instance.project.related(s);return r.success===!1?{success:!1,message:r.message}:(this.related=r.result,{success:!0})}async getOrigin(){return{sheetIds:this.sheetIds,pcbIds:this.pcbIds,panelIds:this.panelIds}}getForm(){let s,r;return this.sheetIds.length?(s=this.cmd,r=[...this.sheetIds]):this.panelIds.length?(s=this.cmd,r=[...this.panelIds]):(s=this.cmd,r=[...this.pcbIds]),{map:this.pathMap,uuid:this.uuid,cmd:s,self:r}}async specified(s){if(Object.values(this.related).reduce((r,i)=>r+i.size,0)){let r=await new Tr({uuid:this.uuid,datas:this.related,origin:this.origin}).start();if(r.success===!1)return{success:!1,code:r.code,message:r.message};let n={datas:r.result,from:s},a=await ft.stores.copyAndPaste.getData();return{success:!0,result:Object.assign(a||{},{from:s,tree:n})}}return{success:!0,result:null}}async checkAbnormalData(s){var i;let r=await this.checkDevice((i=s==null?void 0:s.tree)==null?void 0:i.datas);return r.success===!1?{success:!1,message:r.message}:{success:!0,result:s}}};var Rf=class extends Zn{onpreprocessing(){}async getRelated(){let t=await this.instance.project.related({uuid:this.uuid,schematicIds:this.datas,analyzeReuseBlock:this.analyzeReuseBlock});return t.success===!1?{success:!1,message:t.message}:(this.related=t.result,{success:!0})}async getOrigin(){let t=new Array;for(let s of this.datas)t.push(s);return{schematicIds:t}}getForm(){return{uuid:this.uuid,cmd:this.cmd,self:this.datas}}async specified(t){if(Object.values(this.related).reduce((s,r)=>s+r.size,0)){let s=await new Tr({uuid:this.uuid,datas:this.related,origin:this.origin}).start();if(s.success===!1)return{success:!1,code:s.code,message:s.message};let i={datas:s.result,from:t},n=await ft.stores.copyAndPaste.getData();return{success:!0,result:Object.assign(n||{},{from:t,tree:i})}}return{success:!0,result:null}}async checkAbnormalData(t){var r;let s=await this.checkDevice((r=t==null?void 0:t.tree)==null?void 0:r.datas);return s.success===!1?{success:!1,message:s.message}:{success:!0,result:t}}};var Ll=class extends Zn{constructor(){super(...arguments);this.schematicIds=new Set;this.pcbIds=new Set;this.boardIds=new Set;this.blockSymbolIds=new Set}async onpreprocessing(){let{pathMap:s}=this.datas;this.pathMap=s}async getRelated(){var o,c;let{symbols:s,footprints:r,devices:i,blobs:n,reuseBlocks:a}=this.datas;if(a)if(this.analyzeReuseBlock){for(let u in a.blockSymbols){let h=a.blockSymbols[u],p=(await this.instance.symbol.getIdByTitle(h)).result;p&&this.blockSymbolIds.add(p);let d=(o=(await this.instance.schematic.getDataByName(h)).result)==null?void 0:o[0];if(d){let{uuid:m,board:g}=d;this.schematicIds.add(m),g&&this.boardIds.add(g)}let f=(c=(await this.instance.pcb.getDataByTitle(h)).result)==null?void 0:c[0];if(f){let{uuid:m,board:g}=f;this.pcbIds.add(m),g&&this.boardIds.add(g)}}let l=await this.instance.project.related({uuid:this.uuid,tabs:Array.from([a]),analyzeReuseBlock:this.analyzeReuseBlock,pathMap:this.pathMap});if(l.success===!1)return{success:!1,message:l.message};this.related2=l.result}else for(let l in a.blockSymbols){let u=a.blockSymbols[l],h=(await this.instance.symbol.getIdByTitle(u)).result;h&&this.blockSymbolIds.add(h)}if(this.instance){let l=(s||[]).concat(Array.from(this.blockSymbolIds)),u=await this.instance.project.related({uuid:this.uuid,symbolIds:l,footprintIds:r,deviceIds:i,blobHashes:n});if(u.success===!1)return{success:!1,message:u.message};this.related1=u.result}else this.related1=null;return{success:!0}}async getOrigin(){return{schematicIds:Array.from(this.schematicIds),pcbIds:Array.from(this.pcbIds),symbolIds:Array.from(this.blockSymbolIds),boardIds:Array.from(this.boardIds)}}getForm(){return{map:this.pathMap,uuid:this.uuid,cmd:this.cmd}}async specified(s){let r=await this.getCanvasDatas(s);if(r.success===!1)return{success:!1,code:r.code,message:r.message};let i=r.result;if(i){let n=await ft.stores.copyAndPaste.getData()||{};return n.canvas=Object.assign((n==null?void 0:n.canvas)||{},i),{success:!0,result:n}}return{success:!0,result:null}}async getCanvasDatas(s){let r={[this.cmd]:null};if(this.related1&&Object.values(this.related1).reduce((i,n)=>i+n.size,0)){let i=await new Tr({uuid:this.uuid,datas:this.related1}).start();if(i.success===!1)return{success:!1,message:i.message};let n=i.result;n&&(r[this.cmd]=r[this.cmd]||{},r[this.cmd].canvas=n)}else this.related1===null&&delete r[this.cmd];if(this.related2&&Object.values(this.related2).reduce((i,n)=>i+n.size,0)){let i=await new Tr({uuid:this.uuid,datas:this.related2,origin:this.origin}).start();if(i.success===!1)return{success:!1,message:i.message};let n=i.result;for(let a of this.boardIds){if(this.related2.boards.has(a))continue;let o=(await this.instance.board.getData(a)).result;n.boards.push(o)}n&&(r[this.cmd]=r[this.cmd]||{},r[this.cmd].reuseBlocks=n)}return r&&r[this.cmd]&&(r[this.cmd].from=s),{success:!0,result:r}}async checkAbnormalData(s){var n,a,o,c;let r=await this.checkDevice((a=(n=s==null?void 0:s.canvas)==null?void 0:n[this.cmd])==null?void 0:a.canvas);if(r.success===!1)return{success:!1,message:r.message};let i=await this.checkDevice((c=(o=s==null?void 0:s.canvas)==null?void 0:o[this.cmd])==null?void 0:c.reuseBlocks);return i.success===!1?{success:!1,message:i.message}:{success:!0,result:s}}};var Ra=class{async boards(t){try{return t.cmd=ki.Board,new xf(t).start()}catch(s){return{success:!1,message:s.message}}}async schematics(t){try{return t.cmd=ki.Schematic,new Rf(t).start()}catch(s){return{success:!1,message:s.message}}}async schCanvas(t){try{return t.cmd=ki.SchCanvas,new Ll(t).start()}catch(s){return{success:!1,message:s.message}}}async pcbCanvas(t){try{return t.cmd=ki.PcbCanvas,new Ll(t).start()}catch(s){return{success:!1,message:s.message}}}async panelCanvas(t){try{return t.cmd=ki.PanelCanvas,new Ll(t).start()}catch(s){return{success:!1,message:s.message}}}async pages(t){try{if(!t.cmd)throw new Error(`Missing cmd!!! ${t.cmd}`);return new vf(t).start()}catch(s){return{success:!1,message:s.message}}}};var RDe=new ut(1),NDe=new ut(2),LDe=new ut(3);function Bx(){let e=fe.messageBus;W(bt.UNZIP,async t=>await new Ii(t).start(t)),W(bt.EXTRACT,async t=>await new Ii(t).extract(t)),W(bt.FLOW,async t=>await new Ii(t).flow(t)),W(bt.PARSE,async t=>await new Ii(t).parse(t)),W(bt.CHECK,async t=>await new Ii(t).check(t)),W(bt.GET_PROJECT_IN_CLOUD,async t=>await new Ia(t).getExport(t)),W(bt.GET_PROJECT_IN_LOCAL,async t=>await new Oa(t).getExport(t)),W(bt.GET_PROJECT_BY_IN_LOCAL,async t=>await new An(t).getExport(t)),W(bt.EXPORT_ZIP,async t=>await new Eh(t).file(t)),W(bt.EXPORT_DOCUMENT,async t=>await new bh(t).file(t)),W(bt.DOWNLOAD_PROJECT,async t=>await new nf(t).start()),W(bt.DOWNLOAD_CBB,async t=>await new C0(t).start()),W(bt.DOWNLOAD_DOCUMENT,async t=>await new A0(t).start()),W(bt.CONVERT_PROJECT,async t=>await new Yi(t).start()),W(bt.CONVERT_PROJECT_FLOWWIRTE,async t=>await new Yi(t).flowWrite(t)),W(bt.CONVERT_PROJECT_FLOWREAD,async t=>await new Yi(t).flowUpload()),W(bt.IMPORT_NEW_PROJECT,async t=>await new F0(t).start(t)),W(bt.PROJECT_AS_CLOUD,async t=>await new B0(t).start(t)),W(bt.DOCUMENT_AS_CLOUD,async t=>await new k0(t).start(t)),W(bt.CBB_AS_CLOUD,async t=>await new M0(t).start(t)),W(bt.COMPONENT_AS_CLOUD,async t=>await new j0(t).start(t)),W(bt.BACKUP,async t=>sw(t)),W(bt.LOAD_FILE,async t=>await new Of(t).start()),W(bt.IMPORT_TARGET_PROJECT,async t=>await X(t.uuid).project.import(t)),W(bt.COPY_BOARD,async t=>await new Ra().boards(t)),W(bt.COPY_SCHEMATIC,async t=>await new Ra().schematics(t)),W(bt.COPY_PAGE,async t=>await new Ra().pages(t)),W(bt.COPY_SCH_CANVAS,async t=>await new Ra().schCanvas(t)),W(bt.COPY_PCB_CANVAS,async t=>await new Ra().pcbCanvas(t)),W(bt.COPY_PANEL_CANVAS,async t=>await new Ra().panelCanvas(t)),W(bt.PASTE_BOARD,async t=>await new Xn().boards(t)),W(bt.PASTE_SCHEMATIC,async t=>await new Xn().schematics(t)),W(bt.PASTE_PAGE,async t=>await new Xn().pages(t)),W(bt.PASTE_SCH_TOP,async t=>await new Xn().schTop(t)),W(bt.PASTE_SCH_BOTTOM,async t=>await new Xn().schBottom(t)),W(bt.PASTE_PCB,async t=>await new Xn().pcbCanvas(t)),W(bt.PASTE_PANEL,async t=>await new Xn().panelCanvas(t)),W(bt.BUILD_EXPORT,async t=>await new wl(t).start()),W(bt.BUILD_TARGET,async t=>await new Tr(t).rpc(t)),W(bt.PARSE_PROJECT,async t=>await new _n(t).start()),W(bt.COMPARE_CLOUD,async t=>await Nl.getInstance().cloud(t)),W(bt.COMPARE_LOCAL,async t=>await Nl.getInstance().local(t)),W(bt.COMPARE_DESTORY,async t=>await Nl.getInstance().destory(t)),W(bt.UPDATE_REUSE_BLOCK,async t=>await new If(t).start())}var $n="No Sheet";var Qn=class{constructor(){}async getDevice(t){try{let{uuid:s,path:r,needStr:i,withRelated:n}=t;if(!s)return{success:!1,message:`invalid null value! ${s}`};if(s===$n)return{success:!0,result:$n};let a=await os(r).get({data:{device:s},options:{needStr:i,withRelated:n}});return a.success?{success:!0,result:a.result.device}:{success:!1,code:a.code,message:a.message}}catch(s){return{success:!1,message:s.message}}}async getSymbol(t){try{let{uuid:s,path:r,needStr:i}=t;if(!s)return{success:!1,message:`invalid null value! ${s}`};if(s===$n)return{success:!0,result:$n};let n=await os(r).get({data:{symbol:s},options:{needStr:i}});return n.success?{success:!0,result:n.result.symbol}:{success:!1,code:n.code,message:n.message}}catch(s){return{success:!1,message:s.message}}}async force(t){var r,i,n,a;try{let{path:o,temp:c,needStr:l=!0}=t;if(Ge(o)){let u=X(o),h=(i=(r=await u.config.getData())==null?void 0:r.result)==null?void 0:i.default_sheet;if(h){if(h===$n)return{success:!0,result:$n};{let p=(n=await u.device.getData(h))==null?void 0:n.result;if(!p&&c)return s(t);if(p){let d=((a=await u.symbol.getData(p.attributes.Symbol))==null?void 0:a.result)||null;return{success:!0,result:{device:p,symbol:d}}}else return await u.config.updateData({default_sheet:""}),{success:!0,result:null}}}else return c&&c.uuid===$n?{success:!0,result:$n}:c?s(t):{success:!0,result:null}}else{if(c)return s(t);throw new Error(`Api call error! The api does not exist! params: ${t}`)}}catch(o){return{success:!1,message:o.message}}async function s(o){var y,T;let{path:c,temp:l,needStr:u=!0}=o;if(l&&l.uuid===$n)return{success:!0,result:$n};let h=await os(l.path).get({data:{device:l.uuid}});if(!h.success)return{success:!1,message:h.message,code:h.code};let p=(y=h.result.device)==null?void 0:y.symbol;(T=h.result.device)==null||delete T.symbol;let d=h.result.device,f=await os(c).create({data:{device:d,symbol:p}});if(!f.success)return{success:!1,message:f.message,code:f.code};let m=f.result.device;if(d&&!(m!=null&&m.success))return{success:!1,message:m.message,code:m.code};let g=f.result.symbol;if(p&&!(g!=null&&g.success))return{success:!1,message:g.message,code:g.code};let b=m.result,E=g.result;return Ge(c)&&await X(c).config.updateData({default_sheet:b.uuid}),{success:!0,result:{device:b,symbol:E}}}}async get(t){try{let{path:s,datas:r,needStr:i,withRelated:n}=t,a=r.device||void 0,o=r.symbol||void 0,c={device:a,symbol:o},l=await os(s).get({data:c,options:{needStr:i,withRelated:n}}),u=l.success?l.result.device:null,h=l.success?l.result.symbol||(u==null?void 0:u.symbol):null;return!n&&u&&delete u.symbol,{success:l.success,result:{device:u,symbol:h}}}catch(s){return{success:!1,message:s.message}}}async create(t){var s,r,i,n,a,o,c,l,u,h,p,d;try{let{path:f,data:m,options:g={}}=t,b=await os(f).create({data:m,options:g});if(!(b.success&&((r=(s=b.result)==null?void 0:s.device)==null?void 0:r.success)&&((n=(i=b.result)==null?void 0:i.symbol)==null?void 0:n.success)))return{success:!1,message:b.message||((o=(a=b.result)==null?void 0:a.device)==null?void 0:o.message)||((l=(c=b.result)==null?void 0:c.symbol)==null?void 0:l.message)};let y=((h=(u=b.result)==null?void 0:u.device)==null?void 0:h.result)||null,T=((d=(p=b.result)==null?void 0:p.symbol)==null?void 0:d.result)||null;return{success:b.success,result:{device:y,symbol:T}}}catch(f){return{success:!1,message:f.message}}}async update(t){var s,r,i,n,a,o,c,l,u,h,p,d;try{let{path:f,data:m}=t,g=await os(f).update({data:m});if(!(g.success&&((r=(s=g.result)==null?void 0:s.device)==null?void 0:r.success)&&((n=(i=g.result)==null?void 0:i.symbol)==null?void 0:n.success)))return{success:!1,message:g.message||((o=(a=g.result)==null?void 0:a.device)==null?void 0:o.message)||((l=(c=g.result)==null?void 0:c.symbol)==null?void 0:l.message)};let E=((h=(u=g.result)==null?void 0:u.device)==null?void 0:h.result)||null,y=((d=(p=g.result)==null?void 0:p.symbol)==null?void 0:d.result)||null;return{success:g.success,result:{device:E,symbol:y}}}catch(f){return{success:!1,message:f.message}}}async setCustom(t){var s,r;try{let{path:i,data:n}=t,{uuid:a}=n,o=X(i),c=(s=await o.symbol.isExist(a))==null?void 0:s.result;if(mc.test(a)&&c){let l=await this.update({path:i,data:{symbol:n}}),u=(r=await o.symbol.getData(a))==null?void 0:r.result;return{success:l.success,result:u}}else if(mc.test(a)||!c){let l=Object.assign(n,{uuid:a,docType:Ne.SHEET_SYMBOL,project_uuid:i,path:i}),u=await this.create({path:i,data:{symbol:l}});return u.success?{success:!0,result:u.result.symbol}:{success:!1,code:u.code,message:u.message}}else throw new Error(`Api call error! The api does not exist! params: ${t}`)}catch(i){return{success:!1,message:i.message}}}};var ZDe=new ut(1),$De=new ut(2),QDe=new ut(3);function kx(){let e=fe.messageBus;QH(e),sG(e),rG(e)}function QH(e){function t(s){return s.options=Object.assign(s.options||{force:!0},{needStr:!1}),s}W(gs.LIB.CREATE,async s=>await os(s.path).create(t(s))),W(gs.LIB.GET1,async s=>await os(s.path).get1(s)),W(gs.LIB.CREATE1,async s=>await os(s.path).create1(s)),W(gs.LIB.UPDATE1,async s=>await os(s.path).update1(s)),W(gs.LIB.UPDATE,async s=>await os(s.path).update(s)),W(gs.LIB.CANCEL_ASSOCIATE,async s=>await os(s.path).cancelAssociate(s)),W(gs.LIB.DELETE,async s=>await os(s.path).delete(s)),W(gs.LIB.BATCH_GET,async s=>await os(s.path).batchGet(t(s))),W(gs.LIB.GET,async s=>await os(s.path).get(t(s))),W(gs.LIB.UPDATE_DEVICES,async s=>await os(s.path).updateDevices(s)),W(gs.LIB.STAR,async s=>await os(s.path).star(s)),W(gs.LIB.UNSTAR,async s=>await os(s.path).unstar(s)),W(gs.LIB.FORCE,async s=>await os(s.path).force(s)),W(gs.LIB.UPLOAD,async s=>await os(s.path).upload(s)),eG(e),tG(e)}function eG(e){W(gs.LIB.DEVICE_LIST,async t=>await se.getInstance().device.list(t)),W(gs.LIB.DEVICE_SEARCH_LIST,async t=>await se.getInstance().device.searchList(t)),W(gs.LIB.DEVICE_SEARCH_BY_USERS_AND_TITLES,async t=>await se.getInstance().device.searchByUsersAndTitles(t)),W(gs.LIB.DEVICE_GET_ATTR_VALUES,async t=>await se.getInstance().device.getAttributeValues(t)),W(gs.LIB.DEVICE_GET_ATTR_KEYS,async t=>await se.getInstance().device.getAttrKeys(t))}function tG(e){W(gs.LIB.COMPONENT_LIST,async t=>await se.getInstance().component.list(t)),W(gs.LIB.COMPONENT_SEARCH_LIST,async t=>await se.getInstance().component.searchList(t)),W(gs.LIB.COMPONENT_SEARCH_BY_USERS_AND_TITLES,async t=>await se.getInstance().component.searchByUsersAndTitles(t))}function sG(e){W(Yc.CREATE,async t=>await new mi().create(t)),W(Yc.GET_EXPORT,async t=>await new mi().getExport(t)),W(Yc.GET_TARGET,async t=>await new mi().getTarget(t)),W(Yc.LIST,async t=>await new mi().list(t)),W(Yc.PLACE,async t=>await new mi().place(t))}function rG(e){W(gs.SHEET_SYMBOL.GET_DEVICE,async t=>await new Qn().getDevice(t)),W(gs.SHEET_SYMBOL.GET_SYMBOL,async t=>await new Qn().getSymbol(t)),W(gs.SHEET_SYMBOL.FORCE,async t=>await new Qn().force(t)),W(gs.SHEET_SYMBOL.GET,async t=>await new Qn().get(t)),W(gs.SHEET_SYMBOL.CREATE,async t=>await new Qn().create(t)),W(gs.SHEET_SYMBOL.UPDATE,async t=>await new Qn().update(t)),W(gs.SHEET_SYMBOL.SET_CUSTOM,async t=>await new Qn().setCustom(t))}var oPe=new ut(1),cPe=new ut(2),lPe=new ut(3);function Mx(){let e=fe.messageBus;iG(),nG()}function iG(){W(Ai.CLOUD.CREATE,async e=>await new Pr().create(e.project,e.options)),W(Ai.CLOUD.PROJECT,async e=>await new Pr().project(e.project)),W(Ai.CLOUD.BOARD,async e=>await new Pr(e.uuid).board(e.data,e.options)),W(Ai.CLOUD.SCHEMATIC,async e=>await new Pr(e.uuid).schematic(e.data,e.options)),W(Ai.CLOUD.SHEET,async e=>await new Pr(e.uuid).sheet(e.data)),W(Ai.CLOUD.SIMULATION,async e=>await new Pr(e.uuid).simulation(e.data)),W(Ai.CLOUD.PCB,async e=>await new Pr(e.uuid).pcb(e.data)),W(Ai.CLOUD.PANEL,async e=>await new Pr(e.uuid).panel(e.data))}function nG(){let e=fe.messageBus;W(Ai.LOCAL.BOARD,async(t={})=>await new Cn(t.uuid,t.renameKey).board(t.data,t.options)),W(Ai.LOCAL.SCHEMATIC,async(t={})=>await new Cn(t.uuid,t.renameKey).schematic(t.data,t.options)),W(Ai.LOCAL.SHEET,async t=>await new Cn(t.uuid,t.renameKey).sheet(t.data)),W(Ai.LOCAL.SIMULATION,async(t={})=>await new Cn(t.uuid,t.renameKey).simulation(t.data)),W(Ai.LOCAL.PCB,async(t={})=>await new Cn(t.uuid,t.renameKey).pcb(t.data)),W(Ai.LOCAL.PANEL,async(t={})=>await new Cn(t.uuid,t.renameKey).panel(t.data))}var jx=Ei(Vi());function Fx(){let e=new Worker(`editor?entry=mgr-lib-worker.js&cll=${self.PRO_LOG_LEVEL}`,{name:`lib_${window._TAB_ID_}`});new jx.WorkerMessageBridge(fe.messageBus,e)}fe.messageBus=window._MSG_BUS_=window._MSG_BUS_||new U0.MessageBus;fe.windowBridge=window._MSG_BUS_WIN_=window._MSG_BUS_WIN_||new U0.WindowMessageBridge(fe.messageBus);Fx();Ox();kx();wx();Sx();Dx();_x();Mx();Px();Bx();Cx();Ax();window.onerror=console.error;window.onunhandledrejection=console.error;})();
/*! Bundled license information:

jszip/dist/jszip.min.js:
  (*!
  
  JSZip v3.10.1 - A JavaScript class for generating and reading zip files
  <http://stuartk.com/jszip>
  
  (c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
  Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.
  
  JSZip uses the library pako released under the MIT license :
  https://github.com/nodeca/pako/blob/main/LICENSE
  *)

is-buffer/index.js:
  (*!
   * Determine if an object is a Buffer
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

lc-editor-common/dist/index.js:
  (*! Bundled license information:
  
  lc-protocol/dist/index.js:
    (*! Bundled license information:
    
    crypto-js/ripemd160.js:
      (** @preserve
      	(c) 2012 by Cdric Mesnil. All rights reserved.
      
      	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
      
      	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
      	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
      
      	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      	*)
    
    crypto-js/mode-ctr-gladman.js:
      (** @preserve
       * Counter block mode compatible with  Dr Brian Gladman fileenc.c
       * derived from CryptoJS.mode.CTR
       * Jan Hruby jhruby.web@gmail.com
       *)
    *)
  *)

lc-protocol/dist/index.js:
  (*! Bundled license information:
  
  crypto-js/ripemd160.js:
    (** @preserve
    	(c) 2012 by Cdric Mesnil. All rights reserved.
    
    	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    
    	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    
    	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    	*)
  
  crypto-js/mode-ctr-gladman.js:
    (** @preserve
     * Counter block mode compatible with  Dr Brian Gladman fileenc.c
     * derived from CryptoJS.mode.CTR
     * Jan Hruby jhruby.web@gmail.com
     *)
  *)
*/
//# sourceMappingURL=https://modules.lceda.cn/pro-mgr/3.1.49.c934ba86/js/pro-mgr.js.map
