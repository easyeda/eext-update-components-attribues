(()=>{var _d=Object.create;var gl=Object.defineProperty;var Sd=Object.getOwnPropertyDescriptor;var Id=Object.getOwnPropertyNames;var Ad=Object.getPrototypeOf,Od=Object.prototype.hasOwnProperty;var ps=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Rd=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Dd=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Id(e))!Od.call(t,r)&&r!==i&&gl(t,r,{get:()=>e[r],enumerable:!(s=Sd(e,r))||s.enumerable});return t};var wd=(t,e,i)=>(i=t!=null?_d(Ad(t)):{},Dd(e||!t||!t.__esModule?gl(i,"default",{value:t,enumerable:!0}):i,t));var fd=Rd((tA,pd)=>{"use strict";var ll=Object.defineProperty,Cb=Object.getOwnPropertyDescriptor,Nb=Object.getOwnPropertyNames,Pb=Object.prototype.hasOwnProperty,Lb=(t,e)=>{for(var i in e)ll(t,i,{get:e[i],enumerable:!0})},vb=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Nb(e))!Pb.call(t,r)&&r!==i&&ll(t,r,{get:()=>e[r],enumerable:!(s=Cb(e,r))||s.enumerable});return t},xb=t=>vb(ll({},"__esModule",{value:!0}),t),nd={};Lb(nd,{BroadcastChannelMessageBus:()=>$b,MessageBus:()=>Xb,MessageBus2:()=>Jb,MessageBusTask:()=>al,MessageBusTask2:()=>cn,WindowMessageBridge:()=>zb,WorkerMessageBridge:()=>Vb,createBroadcastP2PStream:()=>hd,createBufferedByteBufferStream:()=>cd,createBufferedStream:()=>hl,createBufferedStringStream:()=>ud,dropP2PStream:()=>Zb,flowRead:()=>t_,flowWrite:()=>Qb});pd.exports=xb(nd);var Oa=class{constructor(t=1.5){this.growthFactor=t,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(t){if(this.count===this.capacity){let e=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,e);let i=new Array(e);for(let s=0;s<this.count;s++)i[s]=this.buffer[(this.head+s)%this.capacity];this.buffer=i,this.head=0,this.tail=this.count,this.capacity=e}this.buffer[this.tail]=t,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let t=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,t}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},ul=new ArrayBuffer(8),$I=new Float64Array(ul),ZI=new Uint32Array(ul),QI=new Uint16Array(ul),nl=ArrayBuffer;try{nl=self.HTMLImageElement||nl}catch{}var Mb=typeof SharedArrayBuffer<"u";function Ra(t){if(typeof t!="object"||t===null||t instanceof Date||t instanceof ArrayBuffer||Mb&&t instanceof SharedArrayBuffer||t instanceof Blob||t instanceof FormData||t instanceof Function||t instanceof Uint8ClampedArray||t instanceof nl)return t;if(Array.isArray(t))return t.map(Ra);{let e={};for(let i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=Ra(t[i]));return e}}function rl(t,e){return Bb(t,e,()=>[])}function Bb(t,e,i){let s=t[e];return s!==void 0||(s=i(e),t[e]=s),s}var kb=class{constructor(t){this.maxResources=t,this.idle=new Oa,this.isClosed=!1,this.resources=t}acquire(t){this.isClosed?Promise.resolve(!1).then(t):this.resources>0?(this.resources--,Promise.resolve(!0).then(t)):this.idle.enqueue(t)}acquireSync(){return new Promise(t=>{this.acquire(t)})}release(){if(!this.isClosed){let t=this.idle.dequeue();t?Promise.resolve(!0).then(t):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let t=this.idle.dequeue();Promise.resolve(!1).then(t)}}};function Fb(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function Ub(t,e){let i=0,s=t.length;for(let r=0;r<s;r++)t[r]===e&&(t.splice(r,1),r--,s--,i++);return i}var jb=Fb(),Gb=jb.WeakRef||(t=>t);function xs(t){if(t!=null){if(typeof t=="object")return new Gb(t);console.error(t,t instanceof Object,typeof t);return}}function us(t){return t==null?void 0:t.deref()}var Hb="_MSG_BUS_RPC_",cl=300*1e3,Yb=(t=>(t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.PUSH="push",t.PULL="pull",t))(Yb||{}),ad=class{constructor(t){this.bus=t}processRemoteMessage(t,e){let i=xs(e),s=t.topic,r=t.type,n=t.message;switch(r){case"pull":this.bus.pull(s,a=>{this.push(s,a,us(i))});break;case"subscribe":this.bus.subscribe(s,a=>{this.publish(s,a,us(i))});break;case"publish":this.bus.publish(s,n,this,us(i));break;case"push":this.bus.push(s,n,this,us(i));break;default:console.debug("unknown message type "+r)}}rpcCall(t,e,i,s=cl){let r=xs(i),n=new Promise(a=>{let o=this.bus.uniqueRpcTopic(t);this.publish(t,{message:e,reply:o},us(r)),this.bus.pull(o,(l,u,c)=>{a({message:l,bridge:u,source:xs(c)})})});return s>0?Promise.race([n,new Promise((a,o)=>{setTimeout(o,s)})]):n}},Vb=class extends ad{constructor(t,e){super(t),this.worker=e,e.onmessage=i=>{this.processRemoteMessage(i.data,void 0)}}publish(t,e){this.postMessage(t,"publish",e)}subscribe(t){this.postMessage(t,"subscribe",null)}push(t,e){this.postMessage(t,"push",e)}pull(t){this.postMessage(t,"pull",null)}rpcCall(t,e,i=cl){return super.rpcCall(t,e,void 0,i)}postMessage(t,e,i){let s={topic:t,type:e,message:i};this.worker.postMessage(s)}discard(){this.worker.terminate()}},zb=class extends ad{constructor(t){super(t),window.addEventListener("message",e=>{this.processRemoteMessage(e.data,e.source)},!1)}publish(t,e,i){this.postMessage(t,"publish",e,i)}subscribe(t,e){if(e===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(t,"subscribe",null,e)}push(t,e,i){this.postMessage(t,"push",e,i)}pull(t,e){if(e===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(t,"pull",null,e)}postMessage(t,e,i,s){let r={topic:t,type:e,message:i};s&&s.postMessage(r,"*")}},al=class{constructor(t){this.isRunning=!0,this.callback=t}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(t,e,i,s){try{t=s?t:Ra(t),this.callback(t,e,i)}catch(r){console.error(r)}}},Xb=class{constructor(t=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=t}uniqueRpcTopic(t){return`${Hb}-${t}-${this.uuid}-${this.rpcTicket++}`}publish(t,e,i,s){let r=this.subscribed[t];if(r){let n;for(let a of r)a.running()?a.execute(e,i,s,this.unsafe):(n=n||new Array,n.push(a));if(n)for(let a of n)Ub(r,a)}else console.debug("no sub on topic: "+t)}subscribe(t,e){let i=new al(e);return rl(this.subscribed,t).push(i),i}push(t,e,i,s){let r=!1,n=this.pulled[t];if(n){for(;n.length>0;){let a=n.shift();if(a.running()){a.execute(e,i,s,this.unsafe),r=!0;break}}n.length===0&&delete this.pulled[t]}r||rl(this.pushed,t).push({message:e,bridge:i,source:xs(s)})}pull(t,e){let i=new al(e),s=this.pushed[t];if(s){let r=s.shift();i.execute(r.message,r.bridge,us(r.source),this.unsafe),s.length===0&&delete this.pushed[t]}else rl(this.pulled,t).push(i);return i}pullA(t){return new Promise(e=>{this.pull(t,(i,s,r)=>{e({message:i,bridge:s,source:xs(r)})})})}rpcService(t,e){this.subscribe(t,(i,s,r)=>{let{message:n,reply:a}=i;try{let o=e(n);if(o instanceof Promise){let l=xs(r);o.then(u=>{this.rpcReply(u,a,s,us(l))},u=>{console.error(u),this.rpcReply(void 0,a,s,us(l))})}else this.rpcReply(o,a,s,r)}catch(o){console.error(o),this.rpcReply(void 0,a,s,r)}})}rpcCall(t,e,i=cl){let s=new Promise(r=>{let n=this.uniqueRpcTopic(t);this.publish(t,{message:e,reply:n}),this.pull(n,(a,o,l)=>{r({message:a,bridge:o,source:xs(l)})})});return i>0?Promise.race([s,new Promise((r,n)=>{setTimeout(n,i)})]):s}rpcReply(t,e,i,s){i?i.push(e,t,s):this.push(e,t)}},qb="_MSG_BUS_RPC_";function ol(t,e){let i=0,s=t.length;for(let r=0;r<s;r++)t[r]===e&&(t.splice(r,1),r--,s--,i++);return i}function yr(t,e){return Wb(t,e,()=>[])}function Wb(t,e,i){let s=t[e];return s!==void 0||(s=i(e),t[e]=s),s}var cn=class{constructor(t,e){this.callback=t,this.unsafe=e,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(t){try{t=this.unsafe?t:Ra(t),this.callback(t)}catch(e){console.error(e)}}},od=class{constructor(t=crypto.randomUUID()){this.uuid=t,this.rpcTicket=0}subscribeOnce(t,e){let i=this.subscribe(t,s=>{i.cancel(),e(s)});return i}pullA(t){return new Promise(e=>{this.pull(t,e)})}rpcService(t,e){let i=s=>{try{let{message:r,replyTopic:n}=s;try{let a=e(r);a instanceof Promise?a.then(o=>{this.publish(n,{success:!0,result:o})}).catch(o=>{console.error(o),this.publish(n,{success:!1,err:String(o)})}):this.publish(n,{success:!0,result:a})}catch(a){this.publish(n,{success:!1,err:String(a)})}}finally{this.pull(t,i)}};this.pull(t,i)}rpcCall(t,e,i=0){let s=new Promise((r,n)=>{let a=`${qb}-${t}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(a,o=>{o.success?r(o.result):n(new Error(o.err))}),this.push(t,{message:e,replyTopic:a})});return i>0?Promise.race([s,new Promise((r,n)=>{setTimeout(n,i)})]):s}},Jb=class extends od{constructor(t=!1){super(),this.unsafe=t,this.subscribed={},this.pulled={},this.pushed={}}publish(t,e){let i=this.subscribed[t];if(i){let s;for(let r of i)r.running()?r.execute(e):(s=s||new Array,s.push(r));if(s)for(let r of s)ol(i,r)}}subscribe(t,e){let i=new cn(e,this.unsafe);return yr(this.subscribed,t).push(i),i}push(t,e){let i=!1,s=this.pulled[t];if(s){for(;s.length>0;){let r=s.shift();if(r&&r.running()){r.execute(e),i=!0;break}}s.length===0&&delete this.pulled[t]}i||yr(this.pushed,t).push(e)}pull(t,e){let i=new cn(e,this.unsafe);return this.repull(t,i),i}repull(t,e){let i=this.pushed[t];if(i){let s=i.shift();s&&(e.execute(s),i.length===0&&delete this.pushed[t])}else yr(this.pulled,t).push(e)}},Kb=class extends od{constructor(t=crypto.randomUUID()){super(t),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(t,e){console.debug("BC",this.uuid,"PUBLISH",t,e),this.broadcastPublish(t,e)}subscribe(t,e){console.debug("BC",this.uuid,"SUBSCRIBE",t);let i=new cn(e,!0);return yr(this.subscribed,t).push(i),i}push(t,e){let i=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",t,`(${i})`,e),yr(this.pushed,t).push({id:i,message:e}),this.broadcastPushedHeadMessage(t)}pull(t,e){console.debug("BC",this.uuid,"PULL",t);let i=new cn(e,!0);return yr(this.pulled,t).push(i),this.broadcastWhoHas(t),i}broadcastPushedHeadMessage(t){let e=this.pushed[t];e&&e[0]&&this.broadcastIHave(t,e[0].id)}onReceivedPublish(t,e,i){console.debug("BCMSG(",this.uuid,")","from",t,"PUBLISH",e,"message",i);let s=this.subscribed[e];if(s){let r;for(let n of s)n.running()?n.execute(i):(r=r||new Array,r.push(n));if(r)for(let n of r)ol(s,n);s.length===0&&delete this.subscribed[e]}}onReceivedWhoHas(t,e){console.debug("BCMSG(",this.uuid,")","from",t,"WHOHAS",e),this.broadcastPushedHeadMessage(e)}onReceivedIHave(t,e,i){console.debug("BCMSG(",this.uuid,")","from",t,"IHAVE",e,"id",i);let s=this.pulled[e];if(s){let r;for(let n of s)if(n.running()){this.broadcastINeed(e,t,i);break}else r=r||new Array,r.push(n);if(r)for(let n of r)ol(s,n);s.length===0&&delete this.pulled[e]}}onReceivedINeed(t,e,i,s){if(console.debug("BCMSG(",this.uuid,")","from",t,"INEED",e,"source",i,"id",s),this.uuid===i){let r=this.pushed[e];if(r&&r[0]&&r[0].id===s){let{message:n}=r.shift();this.broadcastIGive(e,s,t,n),this.broadcastPushedHeadMessage(e),r.length===0&&delete this.pushed[e]}}}onReceivedIGive(t,e,i,s,r){console.debug("BCMSG(",this.uuid,")","from",t,"IGIVE",e,"id",i,"target",s,"message",r);let n=this.pulled[e];if(n&&this.uuid===s){let a=!1;for(;n.length>0;){let o=n.shift();if(o.running()){o.execute(r),a=!0;break}}a||this.push(e,r),n.length===0&&delete this.pulled[e]}}},$b=class extends Kb{constructor(t,e=crypto.randomUUID()){super(e),this.bc=new BroadcastChannel(t),this.bc.onmessage=i=>{this.onMessage(i.data)}}onMessage(t){let{type:e,uuid:i,topic:s}=t;switch(e){case"PUBLISH":{let{message:r}=t;this.onReceivedPublish(i,s,r);break}case"WHOHAS":{this.onReceivedWhoHas(i,s);break}case"IHAVE":{let{id:r}=t;this.onReceivedIHave(i,s,r);break}case"INEED":{let{source:r,id:n}=t;this.onReceivedINeed(i,s,r,n);break}case"IGIVE":{let{target:r,id:n,message:a}=t;this.onReceivedIGive(i,s,n,r,a);break}default:console.warn("unsupported",t)}}broadcastPublish(t,e){this.post({type:"PUBLISH",uuid:this.uuid,topic:t,message:e})}broadcastWhoHas(t){this.post({type:"WHOHAS",uuid:this.uuid,topic:t})}broadcastIHave(t,e){this.post({type:"IHAVE",uuid:this.uuid,topic:t,id:e})}broadcastINeed(t,e,i){this.post({type:"INEED",uuid:this.uuid,topic:t,source:e,id:i})}broadcastIGive(t,e,i,s){this.post({type:"IGIVE",uuid:this.uuid,topic:t,id:e,target:i,message:s})}post(t){this.bc.postMessage(t),Promise.resolve().then(()=>{this.onMessage(t)})}},Tr=Symbol("BLOCKING_QUEUE_RESET"),ld=class{constructor(t,e=()=>1){if(this.maxSize=t,this.itemSizeOf=e,this.queue=new Oa,this.waitingConsumers=new Oa,this.waitingProducers=new Oa,this.queueSize=0,this.closePromise=null,this.closeResolve=null,t<=0)throw new Error("Max size must be greater than 0")}enqueue(t){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let e=await new Promise(i=>{this.waitingProducers.enqueue(i)});return console.debug("queue is not full",this.size(),e),e?(this.innerEnqueue(t),!0):!1})():(this.innerEnqueue(t),!0)}innerEnqueue(t){if(this.waitingConsumers.isEmpty())this.queue.enqueue(t),this.queueSize+=this.itemSizeOf(t),console.debug("queue pushed",t,"size",this.queueSize);else{let e=this.waitingConsumers.dequeue();Promise.resolve(t).then(e),console.debug("queue direct",t,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let t=this.waitingConsumers.dequeue();Promise.resolve(Tr).then(t)}return setTimeout(()=>this.closeResolve(),0),Tr}else return new Promise(t=>{this.waitingConsumers.enqueue(t)});else{let t=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(t),!this.waitingProducers.isEmpty()){let e=this.waitingProducers.dequeue();Promise.resolve(!0).then(e)}return t}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(t=>{for(this.closeResolve=t;!this.waitingProducers.isEmpty();){let e=this.waitingProducers.dequeue();Promise.resolve(!1).then(e)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let e=this.waitingConsumers.dequeue();Promise.resolve(Tr).then(e)}t()}})),this.closePromise}};function hl(t,e,i=Number.MAX_SAFE_INTEGER){let s=new ld(i,e),r=new ReadableStream({pull(a){let o=!0,l=(async()=>{let u=new Array;do{let c=s.dequeue();if(c instanceof Promise){o=!1;let h=await c;h===Tr?a.close():u.push(h)}else{let h=c;h===Tr?a.close():u.push(h)}}while(s.size()>0);if(u.length>0){let c=t(u);a.enqueue(c)}})();if(!o)return console.debug("read stream stucked --------------------------------------"),l},async cancel(){console.debug("buffered readable cancel"),await s.close()}}),n=new WritableStream({write(a,o){let l=!0,u=(async()=>{let c=s.enqueue(a);typeof c=="boolean"?c||o.error(new Error("Write stream closed")):(l=!1,await c||o.error(new Error("Write stream closed")))})();if(!l)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),u},async close(){console.debug("buffered writable closing",s.size()),await s.close(),console.debug("buffered writable closed",s.size())},async abort(){console.debug("buffered writable aborting",s.size()),await s.close(),console.debug("buffered writable aborted",s.size())}});return{readable:r,writable:n}}function ud(t=Number.MAX_SAFE_INTEGER){return hl(e=>e.join(""),e=>e.length,t)}function cd(t=Number.MAX_SAFE_INTEGER){return hl(e=>{let i=new Uint8Array(e.reduce((r,n)=>r+n.byteLength,0)),s=0;return e.forEach(r=>{i.set(r,s),s+=r.byteLength}),i},e=>e.byteLength,t)}function hd(t){return new Promise((e,i)=>{let s=new BroadcastChannel(t),r=new ld(1),n=new kb(1),a=null,o=!1,l=!1,u=!1;s.onmessage=c=>{let h=c.data,{type:f}=h;if(console.debug("p2p",t,"type",f,"data",f==="DATA"&&h.data),f==="DATA")r.enqueue(h.data);else if(f==="HI"){if(!a){s.postMessage({type:"HI"});let g=0;a={rs:new ReadableStream({async pull(b){let y=await r.dequeue();y===Tr?(await p(),b.close()):(b.enqueue(y),s.postMessage({type:"ACK"}))},cancel(){return p()}}),ws:new WritableStream({async write(b,y){await n.acquireSync()?s.postMessage({type:"DATA",id:g++,data:b}):(d(),y.error(new Error("Write stream closed")))},close(){d()},abort(){d()}})},e(a)}}else f==="REND"?a?n.close():m("REND1"):f==="WEND"?a?r.close():m("WEND1"):f==="ACK"&&n.release();function d(){o||(o=!0,console.debug(t,"p2p write stream closed"),n.close(),s.postMessage({type:"WEND"}),l&&(console.debug(t,"p2p channel closed on ws"),s.close()))}async function p(){l||(l=!0,console.debug(t,"p2p read stream closed"),s.postMessage({type:"REND"}),await r.close(),o&&(console.debug(t,"p2p channel closed on rs"),s.close()))}async function m(g){u||(u=!0,console.debug(t,"p2p channel connection released on",g),n.close(),r.close(),a?(a.rs.locked||(console.debug(t,"p2p unlocked read stream direct cancel"),a.rs.cancel()),a.ws.locked||(console.debug(t,"p2p unlocked write stream direct close"),a.ws.close())):(s.postMessage({type:"HI"}),s.close()),i(new Error("p2p channel connection released")))}},s.postMessage({type:"HI"})})}function Zb(t){return new Promise(e=>{let i=new BroadcastChannel(t);i.onmessage=s=>{let r=s.data,{type:n}=r;n==="HI"&&(i.postMessage({type:"REND"}),i.close(),e())},i.postMessage({type:"REND"})})}async function dd(t){try{return await hd(t)}catch(e){e.message!=="p2p channel connection released"&&console.error(e)}}async function Qb(t,e,i=10*1024*1024,s=!0){let r=await dd(t);if(!r)return!1;let n=!1;try{let a,o=l=>{if(!a)if(!s)a=r.ws.getWriter();else if(typeof l=="string"){let u=ud(i);u.readable.pipeTo(r.ws),a=u.writable.getWriter()}else{let u=cd(i);u.readable.pipeTo(r.ws),a=u.writable.getWriter()}return a.write(l)};if(Array.isArray(e))for(let l of e)await o(l);else await e({write:o,get desiredSize(){return((a==null?void 0:a.desiredSize)||0)+10}});a&&await a.close(),n=!0}catch(a){console.error(a)}finally{return r.rs.cancel(),n}}async function t_(t,e){var s,r;let i=await dd(t);if(i)try{let n=i.rs.getReader();for((s=e.start)==null?void 0:s.call(e);;){let{value:a,done:o}=await n.read();if(a!==void 0){let l;if(e.update instanceof Promise?l=await e.update(a):l=e.update(a),l){await n.cancel();break}}if(o){(r=e.end)==null||r.call(e);break}}}catch(n){console.error(n)}finally{i.ws.close()}}});var Cd=Object.create,Ro=Object.defineProperty,Nd=Object.getOwnPropertyDescriptor,Pd=Object.getOwnPropertyNames,Ld=Object.getPrototypeOf,vd=Object.prototype.hasOwnProperty,ks=(t=>typeof ps<"u"?ps:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof ps<"u"?ps:e)[i]}):t)(function(t){if(typeof ps<"u")return ps.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),xd=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Md=(t,e)=>{for(var i in e)Ro(t,i,{get:e[i],enumerable:!0})},Bd=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Pd(e))!vd.call(t,r)&&r!==i&&Ro(t,r,{get:()=>e[r],enumerable:!(s=Nd(e,r))||s.enumerable});return t},Kr=(t,e,i)=>(i=t!=null?Cd(Ld(t)):{},Bd(e||!t||!t.__esModule?Ro(i,"default",{value:t,enumerable:!0}):i,t)),$r=xd((t,e)=>{"use strict";var i=Object.defineProperty,s=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(T,I)=>{for(var D in I)i(T,D,{get:I[D],enumerable:!0})},o=(T,I,D,C)=>{if(I&&typeof I=="object"||typeof I=="function")for(let U of r(I))!n.call(T,U)&&U!==D&&i(T,U,{get:()=>I[U],enumerable:!(C=s(I,U))||C.enumerable});return T},l=T=>o(i({},"__esModule",{value:!0}),T),u={};a(u,{BroadcastChannelMessageBus:()=>cs,MessageBus:()=>ft,MessageBus2:()=>Ct,MessageBusTask:()=>pt,MessageBusTask2:()=>ae,WindowMessageBridge:()=>at,WorkerMessageBridge:()=>nt,createBroadcastP2PStream:()=>zi,createBufferedByteBufferStream:()=>pi,createBufferedStream:()=>he,createBufferedStringStream:()=>je,dropP2PStream:()=>fi,flowRead:()=>Bs,flowWrite:()=>br}),e.exports=l(u);var c=class{constructor(T=1.5){this.growthFactor=T,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(T){if(this.count===this.capacity){let I=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,I);let D=new Array(I);for(let C=0;C<this.count;C++)D[C]=this.buffer[(this.head+C)%this.capacity];this.buffer=D,this.head=0,this.tail=this.count,this.capacity=I}this.buffer[this.tail]=T,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let T=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,T}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},h=new ArrayBuffer(8),f=new Float64Array(h),d=new Uint32Array(h),p=new Uint16Array(h),m=ArrayBuffer;try{m=self.HTMLImageElement||m}catch{}var g=typeof SharedArrayBuffer<"u";function b(T){if(typeof T!="object"||T===null||T instanceof Date||T instanceof ArrayBuffer||g&&T instanceof SharedArrayBuffer||T instanceof Blob||T instanceof FormData||T instanceof Function||T instanceof Uint8ClampedArray||T instanceof m)return T;if(Array.isArray(T))return T.map(b);{let I={};for(let D in T)Object.hasOwnProperty.call(T,D)&&(I[D]=b(T[D]));return I}}function y(T,I){return E(T,I,()=>[])}function E(T,I,D){let C=T[I];return C!==void 0||(C=D(I),T[I]=C),C}function _(T,I){if(Array.isArray(T)){for(let D=0,C=T.length;D<C;D++)if(I(void 0,T[D],D)===!1)return}else{let D=0;for(let C in T)if(T.hasOwnProperty(C)){let U=T[C];if(I(C,U,D)===!1)return;D++}}}var S=Object.prototype.hasOwnProperty;async function A(T,I){if(Array.isArray(T)){for(let D=0,C=T.length;D<C;D++)if(await I(void 0,T[D],D)===!1)return}else{let D=0;for(let C in T)if(S.call(T,C)){let U=T[C];if(await I(C,U,D)===!1)return;D++}}}function w(T,I,D){return typeof T=="string"&&(/https?:/.test(T)||(T=location.origin+T)),Promise.race([fetch(T,I),new Promise((C,U)=>setTimeout(U,D))])}function R(T,I){let D=0,C=0;return(...U)=>{let J=++D;setTimeout(()=>{let $=performance.now();if(J===D||$-C>=T){try{I(...U)}catch(st){console.log(st)}C=$}},Math.max(0,T-(performance.now()-C)))}}function L(T,I){let D=T.length,C=0;for(;C<D;){let U=T.indexOf(`
`,C);U<0&&(U=D);let J=T.substring(C,U);try{if(I(J)===!1)return}catch($){console.error($)}C=U+1}}function M(T){let I=null;return()=>(I===null&&(I=T()),I)}var B=0;function q(){B===0&&(B=Date.now()-performance.now());let T=new Array,I=B+performance.now();f[0]=I,T.push(d[1].toString(16)),f[0]=Math.random(),T.push(p[3].toString(16));let D=p[2].toString(16);T.push("4"+D.substr(0,3)),f[0]=I;let C=d[0].toString(16)+d[1].toString(16);return T.push("0"+C.substr(0,3)),T.push(C.substr(3)),T.join("-")}var H=class{constructor(T){this.maxResources=T,this.idle=new c,this.isClosed=!1,this.resources=T}acquire(T){this.isClosed?Promise.resolve(!1).then(T):this.resources>0?(this.resources--,Promise.resolve(!0).then(T)):this.idle.enqueue(T)}acquireSync(){return new Promise(T=>{this.acquire(T)})}release(){if(!this.isClosed){let T=this.idle.dequeue();T?Promise.resolve(!0).then(T):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let T=this.idle.dequeue();Promise.resolve(!1).then(T)}}};function V(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function W(T,I,D){let C=T.length+I-1;for(let U=0;U<C;U++){let J=new Array;for(let $=U-I+1;$<=U;$++)J.push(T[$]);if(D(J)===!1)break}}function v(){let T=new Date,I=T.getFullYear(),D=T.getMonth()+1,C=T.getDate(),U=T.getHours(),J=T.getMinutes(),$=T.getSeconds(),st=T.getMilliseconds();return"["+I+"-"+(D<10?"0"+D:D)+"-"+(C<10?"0"+C:C)+" "+(U<10?"0"+U:U)+":"+(J<10?"0"+J:J)+":"+($<10?"0"+$:$)+"."+(st<100?st<10?"00"+st:"0"+st:st)+"] "}function j(T){return new Promise(I=>setTimeout(I,T))}function O(T,I){let D=0,C=T.length;for(let U=0;U<C;U++)T[U]===I&&(T.splice(U,1),U--,C--,D++);return D}var x=V(),k=x.WeakRef||(T=>T);function F(T){if(T!=null){if(typeof T=="object")return new k(T);console.error(T,T instanceof Object,typeof T);return}}function P(T){return T==null?void 0:T.deref()}var z="_MSG_BUS_RPC_",Y=300*1e3,tt=(T=>(T.PUBLISH="publish",T.SUBSCRIBE="subscribe",T.PUSH="push",T.PULL="pull",T))(tt||{}),it=class{constructor(T){this.bus=T}processRemoteMessage(T,I){let D=F(I),C=T.topic,U=T.type,J=T.message;switch(U){case"pull":this.bus.pull(C,$=>{this.push(C,$,P(D))});break;case"subscribe":this.bus.subscribe(C,$=>{this.publish(C,$,P(D))});break;case"publish":this.bus.publish(C,J,this,P(D));break;case"push":this.bus.push(C,J,this,P(D));break;default:console.debug("unknown message type "+U)}}rpcCall(T,I,D,C=Y){let U=F(D),J=new Promise($=>{let st=this.bus.uniqueRpcTopic(T);this.publish(T,{message:I,reply:st},P(U)),this.bus.pull(st,(Et,It,qt)=>{$({message:Et,bridge:It,source:F(qt)})})});return C>0?Promise.race([J,new Promise(($,st)=>{setTimeout(st,C)})]):J}},nt=class extends it{constructor(T,I){super(T),this.worker=I,I.onmessage=D=>{this.processRemoteMessage(D.data,void 0)}}publish(T,I){this.postMessage(T,"publish",I)}subscribe(T){this.postMessage(T,"subscribe",null)}push(T,I){this.postMessage(T,"push",I)}pull(T){this.postMessage(T,"pull",null)}rpcCall(T,I,D=Y){return super.rpcCall(T,I,void 0,D)}postMessage(T,I,D){let C={topic:T,type:I,message:D};this.worker.postMessage(C)}discard(){this.worker.terminate()}},at=class extends it{constructor(T){super(T),window.addEventListener("message",I=>{this.processRemoteMessage(I.data,I.source)},!1)}publish(T,I,D){this.postMessage(T,"publish",I,D)}subscribe(T,I){if(I===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(T,"subscribe",null,I)}push(T,I,D){this.postMessage(T,"push",I,D)}pull(T,I){if(I===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(T,"pull",null,I)}postMessage(T,I,D,C){let U={topic:T,type:I,message:D};C&&C.postMessage(U,"*")}},pt=class{constructor(T){this.isRunning=!0,this.callback=T}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(T,I,D,C){try{T=C?T:b(T),this.callback(T,I,D)}catch(U){console.error(U)}}},ft=class{constructor(T=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=T}uniqueRpcTopic(T){return`${z}-${T}-${this.uuid}-${this.rpcTicket++}`}publish(T,I,D,C){let U=this.subscribed[T];if(U){let J;for(let $ of U)$.running()?$.execute(I,D,C,this.unsafe):(J=J||new Array,J.push($));if(J)for(let $ of J)O(U,$)}else console.debug("no sub on topic: "+T)}subscribe(T,I){let D=new pt(I);return y(this.subscribed,T).push(D),D}push(T,I,D,C){let U=!1,J=this.pulled[T];if(J){for(;J.length>0;){let $=J.shift();if($.running()){$.execute(I,D,C,this.unsafe),U=!0;break}}J.length===0&&delete this.pulled[T]}U||y(this.pushed,T).push({message:I,bridge:D,source:F(C)})}pull(T,I){let D=new pt(I),C=this.pushed[T];if(C){let U=C.shift();D.execute(U.message,U.bridge,P(U.source),this.unsafe),C.length===0&&delete this.pushed[T]}else y(this.pulled,T).push(D);return D}pullA(T){return new Promise(I=>{this.pull(T,(D,C,U)=>{I({message:D,bridge:C,source:F(U)})})})}rpcService(T,I){this.subscribe(T,(D,C,U)=>{let{message:J,reply:$}=D;try{let st=I(J);if(st instanceof Promise){let Et=F(U);st.then(It=>{this.rpcReply(It,$,C,P(Et))},It=>{console.error(It),this.rpcReply(void 0,$,C,P(Et))})}else this.rpcReply(st,$,C,U)}catch(st){console.error(st),this.rpcReply(void 0,$,C,U)}})}rpcCall(T,I,D=Y){let C=new Promise(U=>{let J=this.uniqueRpcTopic(T);this.publish(T,{message:I,reply:J}),this.pull(J,($,st,Et)=>{U({message:$,bridge:st,source:F(Et)})})});return D>0?Promise.race([C,new Promise((U,J)=>{setTimeout(J,D)})]):C}rpcReply(T,I,D,C){D?D.push(I,T,C):this.push(I,T)}},xt="_MSG_BUS_RPC_";function gt(T,I){let D=0,C=T.length;for(let U=0;U<C;U++)T[U]===I&&(T.splice(U,1),U--,C--,D++);return D}function bt(T,I){return Wt(T,I,()=>[])}function Wt(T,I,D){let C=T[I];return C!==void 0||(C=D(I),T[I]=C),C}var ae=class{constructor(T,I){this.callback=T,this.unsafe=I,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(T){try{T=this.unsafe?T:b(T),this.callback(T)}catch(I){console.error(I)}}},ce=class{constructor(T=crypto.randomUUID()){this.uuid=T,this.rpcTicket=0}subscribeOnce(T,I){let D=this.subscribe(T,C=>{D.cancel(),I(C)});return D}pullA(T){return new Promise(I=>{this.pull(T,I)})}rpcService(T,I){let D=C=>{try{let{message:U,replyTopic:J}=C;try{let $=I(U);$ instanceof Promise?$.then(st=>{this.publish(J,{success:!0,result:st})}).catch(st=>{console.error(st),this.publish(J,{success:!1,err:String(st)})}):this.publish(J,{success:!0,result:$})}catch($){this.publish(J,{success:!1,err:String($)})}}finally{this.pull(T,D)}};this.pull(T,D)}rpcCall(T,I,D=0){let C=new Promise((U,J)=>{let $=`${xt}-${T}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce($,st=>{st.success?U(st.result):J(new Error(st.err))}),this.push(T,{message:I,replyTopic:$})});return D>0?Promise.race([C,new Promise((U,J)=>{setTimeout(J,D)})]):C}},Ct=class extends ce{constructor(T=!1){super(),this.unsafe=T,this.subscribed={},this.pulled={},this.pushed={}}publish(T,I){let D=this.subscribed[T];if(D){let C;for(let U of D)U.running()?U.execute(I):(C=C||new Array,C.push(U));if(C)for(let U of C)gt(D,U)}}subscribe(T,I){let D=new ae(I,this.unsafe);return bt(this.subscribed,T).push(D),D}push(T,I){let D=!1,C=this.pulled[T];if(C){for(;C.length>0;){let U=C.shift();if(U&&U.running()){U.execute(I),D=!0;break}}C.length===0&&delete this.pulled[T]}D||bt(this.pushed,T).push(I)}pull(T,I){let D=new ae(I,this.unsafe);return this.repull(T,D),D}repull(T,I){let D=this.pushed[T];if(D){let C=D.shift();C&&(I.execute(C),D.length===0&&delete this.pushed[T])}else bt(this.pulled,T).push(I)}},Dt=class extends ce{constructor(T=crypto.randomUUID()){super(T),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(T,I){console.debug("BC",this.uuid,"PUBLISH",T,I),this.broadcastPublish(T,I)}subscribe(T,I){console.debug("BC",this.uuid,"SUBSCRIBE",T);let D=new ae(I,!0);return bt(this.subscribed,T).push(D),D}push(T,I){let D=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",T,`(${D})`,I),bt(this.pushed,T).push({id:D,message:I}),this.broadcastPushedHeadMessage(T)}pull(T,I){console.debug("BC",this.uuid,"PULL",T);let D=new ae(I,!0);return bt(this.pulled,T).push(D),this.broadcastWhoHas(T),D}broadcastPushedHeadMessage(T){let I=this.pushed[T];I&&I[0]&&this.broadcastIHave(T,I[0].id)}onReceivedPublish(T,I,D){console.debug("BCMSG(",this.uuid,")","from",T,"PUBLISH",I,"message",D);let C=this.subscribed[I];if(C){let U;for(let J of C)J.running()?J.execute(D):(U=U||new Array,U.push(J));if(U)for(let J of U)gt(C,J);C.length===0&&delete this.subscribed[I]}}onReceivedWhoHas(T,I){console.debug("BCMSG(",this.uuid,")","from",T,"WHOHAS",I),this.broadcastPushedHeadMessage(I)}onReceivedIHave(T,I,D){console.debug("BCMSG(",this.uuid,")","from",T,"IHAVE",I,"id",D);let C=this.pulled[I];if(C){let U;for(let J of C)if(J.running()){this.broadcastINeed(I,T,D);break}else U=U||new Array,U.push(J);if(U)for(let J of U)gt(C,J);C.length===0&&delete this.pulled[I]}}onReceivedINeed(T,I,D,C){if(console.debug("BCMSG(",this.uuid,")","from",T,"INEED",I,"source",D,"id",C),this.uuid===D){let U=this.pushed[I];if(U&&U[0]&&U[0].id===C){let{message:J}=U.shift();this.broadcastIGive(I,C,T,J),this.broadcastPushedHeadMessage(I),U.length===0&&delete this.pushed[I]}}}onReceivedIGive(T,I,D,C,U){console.debug("BCMSG(",this.uuid,")","from",T,"IGIVE",I,"id",D,"target",C,"message",U);let J=this.pulled[I];if(J&&this.uuid===C){let $=!1;for(;J.length>0;){let st=J.shift();if(st.running()){st.execute(U),$=!0;break}}$||this.push(I,U),J.length===0&&delete this.pulled[I]}}},cs=class extends Dt{constructor(T,I=crypto.randomUUID()){super(I),this.bc=new BroadcastChannel(T),this.bc.onmessage=D=>{this.onMessage(D.data)}}onMessage(T){let{type:I,uuid:D,topic:C}=T;switch(I){case"PUBLISH":{let{message:U}=T;this.onReceivedPublish(D,C,U);break}case"WHOHAS":{this.onReceivedWhoHas(D,C);break}case"IHAVE":{let{id:U}=T;this.onReceivedIHave(D,C,U);break}case"INEED":{let{source:U,id:J}=T;this.onReceivedINeed(D,C,U,J);break}case"IGIVE":{let{target:U,id:J,message:$}=T;this.onReceivedIGive(D,C,J,U,$);break}default:console.warn("unsupported",T)}}broadcastPublish(T,I){this.post({type:"PUBLISH",uuid:this.uuid,topic:T,message:I})}broadcastWhoHas(T){this.post({type:"WHOHAS",uuid:this.uuid,topic:T})}broadcastIHave(T,I){this.post({type:"IHAVE",uuid:this.uuid,topic:T,id:I})}broadcastINeed(T,I,D){this.post({type:"INEED",uuid:this.uuid,topic:T,source:I,id:D})}broadcastIGive(T,I,D,C){this.post({type:"IGIVE",uuid:this.uuid,topic:T,id:I,target:D,message:C})}post(T){this.bc.postMessage(T),Promise.resolve().then(()=>{this.onMessage(T)})}},ge=Symbol("BLOCKING_QUEUE_RESET"),De=class{constructor(T,I=()=>1){if(this.maxSize=T,this.itemSizeOf=I,this.queue=new c,this.waitingConsumers=new c,this.waitingProducers=new c,this.queueSize=0,this.closePromise=null,this.closeResolve=null,T<=0)throw new Error("Max size must be greater than 0")}enqueue(T){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let I=await new Promise(D=>{this.waitingProducers.enqueue(D)});return console.debug("queue is not full",this.size(),I),I?(this.innerEnqueue(T),!0):!1})():(this.innerEnqueue(T),!0)}innerEnqueue(T){if(this.waitingConsumers.isEmpty())this.queue.enqueue(T),this.queueSize+=this.itemSizeOf(T),console.debug("queue pushed",T,"size",this.queueSize);else{let I=this.waitingConsumers.dequeue();Promise.resolve(T).then(I),console.debug("queue direct",T,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let T=this.waitingConsumers.dequeue();Promise.resolve(ge).then(T)}return setTimeout(()=>this.closeResolve(),0),ge}else return new Promise(T=>{this.waitingConsumers.enqueue(T)});else{let T=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(T),!this.waitingProducers.isEmpty()){let I=this.waitingProducers.dequeue();Promise.resolve(!0).then(I)}return T}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(T=>{for(this.closeResolve=T;!this.waitingProducers.isEmpty();){let I=this.waitingProducers.dequeue();Promise.resolve(!1).then(I)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let I=this.waitingConsumers.dequeue();Promise.resolve(ge).then(I)}T()}})),this.closePromise}};function he(T,I,D=Number.MAX_SAFE_INTEGER){let C=new De(D,I),U=new ReadableStream({pull($){let st=!0,Et=(async()=>{let It=new Array;do{let qt=C.dequeue();if(qt instanceof Promise){st=!1;let ue=await qt;ue===ge?$.close():It.push(ue)}else{let ue=qt;ue===ge?$.close():It.push(ue)}}while(C.size()>0);if(It.length>0){let qt=T(It);$.enqueue(qt)}})();if(!st)return console.debug("read stream stucked --------------------------------------"),Et},async cancel(){console.debug("buffered readable cancel"),await C.close()}}),J=new WritableStream({write($,st){let Et=!0,It=(async()=>{let qt=C.enqueue($);typeof qt=="boolean"?qt||st.error(new Error("Write stream closed")):(Et=!1,await qt||st.error(new Error("Write stream closed")))})();if(!Et)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),It},async close(){console.debug("buffered writable closing",C.size()),await C.close(),console.debug("buffered writable closed",C.size())},async abort(){console.debug("buffered writable aborting",C.size()),await C.close(),console.debug("buffered writable aborted",C.size())}});return{readable:U,writable:J}}function je(T=Number.MAX_SAFE_INTEGER){return he(I=>I.join(""),I=>I.length,T)}function pi(T=Number.MAX_SAFE_INTEGER){return he(I=>{let D=new Uint8Array(I.reduce((U,J)=>U+J.byteLength,0)),C=0;return I.forEach(U=>{D.set(U,C),C+=U.byteLength}),D},I=>I.byteLength,T)}function zi(T){return new Promise((I,D)=>{let C=new BroadcastChannel(T),U=new De(1),J=new H(1),$=null,st=!1,Et=!1,It=!1;C.onmessage=qt=>{let ue=qt.data,{type:be}=ue;if(console.debug("p2p",T,"type",be,"data",be==="DATA"&&ue.data),be==="DATA")U.enqueue(ue.data);else if(be==="HI"){if(!$){C.postMessage({type:"HI"});let mi=0;$={rs:new ReadableStream({async pull(si){let ri=await U.dequeue();ri===ge?(await hs(),si.close()):(si.enqueue(ri),C.postMessage({type:"ACK"}))},cancel(){return hs()}}),ws:new WritableStream({async write(si,ri){await J.acquireSync()?C.postMessage({type:"DATA",id:mi++,data:si}):(wi(),ri.error(new Error("Write stream closed")))},close(){wi()},abort(){wi()}})},I($)}}else be==="REND"?$?J.close():ds("REND1"):be==="WEND"?$?U.close():ds("WEND1"):be==="ACK"&&J.release();function wi(){st||(st=!0,console.debug(T,"p2p write stream closed"),J.close(),C.postMessage({type:"WEND"}),Et&&(console.debug(T,"p2p channel closed on ws"),C.close()))}async function hs(){Et||(Et=!0,console.debug(T,"p2p read stream closed"),C.postMessage({type:"REND"}),await U.close(),st&&(console.debug(T,"p2p channel closed on rs"),C.close()))}async function ds(mi){It||(It=!0,console.debug(T,"p2p channel connection released on",mi),J.close(),U.close(),$?($.rs.locked||(console.debug(T,"p2p unlocked read stream direct cancel"),$.rs.cancel()),$.ws.locked||(console.debug(T,"p2p unlocked write stream direct close"),$.ws.close())):(C.postMessage({type:"HI"}),C.close()),D(new Error("p2p channel connection released")))}},C.postMessage({type:"HI"})})}function fi(T){return new Promise(I=>{let D=new BroadcastChannel(T);D.onmessage=C=>{let U=C.data,{type:J}=U;J==="HI"&&(D.postMessage({type:"REND"}),D.close(),I())},D.postMessage({type:"REND"})})}async function ii(T){try{return await zi(T)}catch(I){I.message!=="p2p channel connection released"&&console.error(I)}}async function br(T,I,D=10*1024*1024,C=!0){let U=await ii(T);if(!U)return!1;let J=!1;try{let $,st=Et=>{if(!$)if(!C)$=U.ws.getWriter();else if(typeof Et=="string"){let It=je(D);It.readable.pipeTo(U.ws),$=It.writable.getWriter()}else{let It=pi(D);It.readable.pipeTo(U.ws),$=It.writable.getWriter()}return $.write(Et)};if(Array.isArray(I))for(let Et of I)await st(Et);else await I({write:st,get desiredSize(){return(($==null?void 0:$.desiredSize)||0)+10}});$&&await $.close(),J=!0}catch($){console.error($)}finally{return U.rs.cancel(),J}}async function Bs(T,I){var C,U;let D=await ii(T);if(D)try{let J=D.rs.getReader();for((C=I.start)==null?void 0:C.call(I);;){let{value:$,done:st}=await J.read();if($!==void 0){let Et;if(I.update instanceof Promise?Et=await I.update($):Et=I.update($),Et){await J.cancel();break}}if(st){(U=I.end)==null||U.call(I);break}}}catch(J){console.error(J)}finally{D.ws.close()}}}),kd={UNAUTHORIZED:"Not logged in yet, please log in and try again",LOGIN_FAIL:"The login status is invalid",PERMISSION_DENIED:"No permission or project does not exist",PERMISSION_DENIED1:"No permission",PRJ_NOT_EXIST:"No permission or project does not exist",ERROR_PATH:"No permission or project does not exist",PROJECT_NOT_FOUND:"The project was not found",PERMISSION_DENIED_PARAMS:"No permission to operate {type}",DATA_NOT_FOUND:"Data not found",PARAMS_DATA_NOT_FOUND:"The {type} data was not found",REQUEST_PARAM_ILLEGAL:"Parameter error",REQUEST_PARAM_ILLEGAL1:"Parameter error",REQUEST_PARAMS_ILLEGAL2:"The {type} parameter request is incorrect",REQUEST_PARAMS_NOT_NULL:"The {type} parameter of the request cannot be empty",REQUEST_PARAMS_NOT_ALL_NULL:"The {type} parameter of the request cannot be empty simultaneously",REQUEST_PARAMS_MUST_ARRAY:"The request parameter {type} must be an array",REQUEST_PARAMS_MUST_STRING:"The request parameter {type} must be a string",REQUEST_PARAMS_MUST_NUMBER:"The request parameter {type} must be a number",REQUEST_PARAMS_MUST_NUMBER_ARRAY:"The request parameter {type} must be a numeric array",REQUEST_PARAMS_MUST_STRING_ARRAY:"The request parameter {type} must be a string array",REQUEST_PARAMS_LENGTH_ERROR:"The length of the request parameter {type} is incorrect",REQUEST_PARAMS_TYPE_ERROR:"The request parameter {type} is of incorrect type",ILLEGAL_NAME:'The name is illegal and contains illegal characters such as /:*?"<>|',ILLEGAL_NAME1:'The name is illegal and contains illegal characters such as /:*?"<>|',ILLEGAL_NAME_ZH:"The name cannot contain Chinese characters",UUID_ERROR:"uuid error",DUPLICATE_DATA:"Duplicate title",DUPLICATE_DATA1:"Library duplicate name",DUPLICATE_DATA_PARAMS:"{type} Duplicate data",UPLOAD_LIMIT:"Document {documentName} size over 15MB, it is too big to save in the server, please modify and then try again.",MORE_THAN_LIMIT:"Exceed the maximum limit",FILE_MORE_THAN_LIMIT:"Exceed the maximum upload limit of {type}",PARAMS_MORE_THAN_LIMIT:"Exceed the maximum upload limit of the parameter {type}",IMAGE_MORE_THAN_LIMIT_PARAMS:"The picture exceeds the maximum upload limit",FILE_MORE_THAN_LIMIT_PARAMS:"The file exceeds the maximum upload limit",END_MUST_AFTER_START:"The start time cannot be later than the end time",FILE_READ_ONLY:"The project file eprj or library file elib property was set as read only, please enable the read only property at File Manager and try again, and contact with support",FILE_READ_ONLY1:"The project file eprj or library file elib property was set as read only, please enable the read only property at File Manager and try again, and contact with support",DATA_NOT_EXIST:"document {documentName} not exists",REQUEST_PARAMS_TIME_ERROR:"The time request parameter is incorrect",FILES_PATH_NOT_FOUND:"The file address cannot be found",FILES_DATA_NOT_FOUND:"The file data cannot be found",FILES_TYPE_ERROR:"File type error",FILES_TYPE_MUST_BE_ONE:"The file type must be {type}",SET_WATERMARK_FAIL:"Watermark setting failed",MYSQL_CRUD_ERROR:"{type} data execution failed. Please contact technical support for resolution",PARAMS_JSON_FAILED:"{type} data parsing failed",MYSQL_ERROR:"Database operation anomaly",NOT_FOUND:"The request does not exist",PRJ_NAME_EXISTS:"The name of the project already exists",BACKUP_NAME_EXISTS:"Backup Name already exists",TITLE_ILLEGAL_LEN:"The {documentName} length must be 1~128 bytes!",LIB_NOT_EXIST:"The component library does not exist",CONFIG_API_URLS_ERROR:"Real-time prices and inventory are not enabled. Please contact the administrator",ONE_CLICK_ORDER_NOT_OPEN:"The order placement function is not enabled. Please contact the administrator",MATERIAL_NOT_OPEN:"The material warehouse is not open. Please contact the administrator",SNAPSHOT_DEPTH_LIMIT:"There is a snapshot near the latest node or the snapshot has been applied for",OCR_SYMBOL_URL_ERROR:"The OCR request address is not configured",USER_DATA_NOT_FOUND:"The user does not exist",USER_DISABLE_ERROR:"The account has been deactivated",USER_EXISTS_LOGIN_ERROR:"The user has logged in elsewhere",USER_UNAUTHORIZED_MODULES_ERROR:"This account has not authorized the module",USER_UNAUTHORIZED_ACCESS_ERROR:"Access type error",ADMIN_NOT_CHANGE_PASSWORD:"The super administrator cannot reset the password",SAME_PASSWORD_NEW_PASSWORD:"The original password is the same as the new one",USER_ONLINE_REGISTRATION_FAILED:"The registration of the user online failed",USER_PASSWORD_CAN_NOT_DEFAULT:"The default password cannot be used",USER_BEFORE_PASSWORD_ERROR:"The original password is incorrect",USER_PASSWORD_LENGTH_ERROR:"The password length is 8 to 255 characters",ORG_ROLE_NOT_CREATE:"System roles cannot be created. Please make the necessary modifications",ORG_ROLE_NAME_DUPLICATE:"The character name already exists. Please modify it",ORG_ROLE_ORIGIN_ERROR:"Unknown character source {message}",ORG_ROLE_NOT_DEFAULT:"This character is not a preset one and cannot be operated",ADMIN_ROLE_NOT_CHANGE:"Administrator privileges do not allow for modification",ADMIN_NOT_CHANGE_STATUS:"The admin account cannot change its status",PROJECT_ARCHIVED:"The project has been locked",PROJECT_UUID_NULL:"The project uuid cannot be empty",PROJECT_UUID_ERROR:"uuid error or the project uuid already exists",PROJECT_OR_TEAM_UUID_ERROR:"The project uuid is incorrect or the team uuid already exists",PROJECT_NOT_PERSON_ERROR:"Personal projects are not allowed to be created",PROJECT_DUPLICATE_NAME:"Duplicate title",ANNOTATION_HAS_BE_FOUND:"The annotation has been created",ANNOTATION_NOT_FOUND:"The annotation block does not exist",ANNOTATION_CREATE_ERROR:"The annotation block creation failed",ANNOTATION_UPDATE_ERROR:"The update of the annotation block failed",ANNOTATION_DELETE_ERROR:"The annotation failed to be deleted",PROJECT_DUPLICATE_PATH:"The same path cannot be created",TEAM_NOT_FOUND:"The team does not exist",TEAM_UUID_NULL:"The team uuid cannot be empty",TEAM_FOLDER_ERROR:"The parent folder does not exist or does not belong to the current team",TEAM_FOLDER_UUID_ERROR:"The folder uuid is incorrect or the project uuid already exists",TEAM_URL_DUPLICATE:"Team link repetition",TEAM_CAN_NOT_DELETE:"There are still projects in the team. Please transfer or delete them first",COMPONENT_UUID_NULL:"The uuid of a component cannot be empty",COMPONENT_DATA_NOT_FOUND:"The component library data does not exist",COMPONENT_NAME_DUPLICATE:"Component libraries cannot have the same name",COMPONENT_TYPE_ERROR:"Library type error",DELETE_SON_CATEGORY:"The subcategories need to be deleted first",LICENSE:"License not found",START_TIME:"The start time of the license is incorrect",END_TIME:"The end time of the license is incorrect",PROJECT_LIMIT:"The maximum number of projects has been reached",USER_LIMIT:"The maximum number of accounts has been reached",ONLINE_NUMBER_LIMIT:"The maximum number of online users has been reached",LIMIT_PCB:"The PCB authorization quota has been reached and the addition failed",LIMIT_SCH:"The schematic authorization number is full, and the addition failed",LIMIT_PANEL:"The panel authorization number is full and the addition failed",TIME_ERROR:"If the system time is incorrect, please restart the server or fix the system time. After fixing, the private service needs to be restarted",LICENSE_ERROR:"Authorization error",LICENSE_TYPE_ERROR:"The type of authorized application is incorrect",LICENSE_ORIGIN_ERROR:"Unknown authorized application {type}",BRANCH_DATA_NOT_FOUND:"There is no engineering branch",PARENT_UUID_ERROR:"parent uuid error",BRANCH_MUST_AFTER_NODE:"The branch must be after the node",BRANCH_NAME_ERROR:"Incorrect branch name",BRANCH_NAME_DUPLICATE:"The branch name already exists",BRANCH_UUID_ERROR:"The branch uuid is incorrect",BRANCH_NODE_SET_ERROR:"Nodes cannot be set as default branches or marked as master",BRANCH_DELETE_MAIN_ERROR:"Nodes or branches on the main branch cannot be deleted",BRANCH_CHECK_OUT_ERROR:"There are documents that have been checked out",DOCUMENT_UUID_ERROR:"The document uuid is incorrect",UPDATE_FAILED:"Update failed",INNER_API_KEY_ERROR:"The ApiKey of the internal interface of the server is incorrect",BRANCH_MORE_THAN_LIMIT:"The version exceeds the maximum limit",WORKSPACE_API_ERROR:"The workspace request response is abnormal"},Fd={UNAUTHORIZED:"\u5C1A\u672A\u767B\u5F55\uFF0C\u8BF7\u767B\u5F55\u540E\u518D\u8BD5",LOGIN_FAIL:"\u767B\u5F55\u72B6\u6001\u5F02\u5E38",PERMISSION_DENIED:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",PERMISSION_DENIED1:"\u6CA1\u6709\u6743\u9650",PRJ_NOT_EXIST:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",ERROR_PATH:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",PROJECT_NOT_FOUND:"\u5DE5\u7A0B\u672A\u627E\u5230",PERMISSION_DENIED_PARAMS:"\u6CA1\u6709\u6743\u9650\u64CD\u4F5C{type}",DATA_NOT_FOUND:"\u6570\u636E\u672A\u627E\u5230",PARAMS_DATA_NOT_FOUND:"{type}\u6570\u636E\u672A\u627E\u5230",REQUEST_PARAM_ILLEGAL:"\u53C2\u6570\u9519\u8BEF",REQUEST_PARAM_ILLEGAL1:"\u53C2\u6570\u9519\u8BEF",REQUEST_PARAMS_ILLEGAL2:"\u8BF7\u6C42{type}\u53C2\u6570\u9519\u8BEF",REQUEST_PARAMS_NOT_NULL:"\u8BF7\u6C42{type}\u53C2\u6570\u4E0D\u80FD\u4E3A\u7A7A",REQUEST_PARAMS_NOT_ALL_NULL:"\u8BF7\u6C42{type}\u53C2\u6570\u4E0D\u80FD\u540C\u65F6\u4E3A\u7A7A",REQUEST_PARAMS_MUST_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u7EC4",REQUEST_PARAMS_MUST_STRING:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u5B57\u7B26\u4E32",REQUEST_PARAMS_MUST_NUMBER:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u5B57",REQUEST_PARAMS_MUST_NUMBER_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u5B57\u6570\u7EC4",REQUEST_PARAMS_MUST_STRING_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u5B57\u7B26\u4E32\u6570\u7EC4",REQUEST_PARAMS_LENGTH_ERROR:"\u8BF7\u6C42\u53C2\u6570{type}\u957F\u5EA6\u9519\u8BEF",REQUEST_PARAMS_TYPE_ERROR:"\u8BF7\u6C42\u53C2\u6570{type}\u7C7B\u578B\u9519\u8BEF",ILLEGAL_NAME:'\u540D\u79F0\u975E\u6CD5, \u5305\u542B /:*?"<>| \u7B49\u975E\u6CD5\u5B57\u7B26',ILLEGAL_NAME1:'\u540D\u79F0\u975E\u6CD5, \u5305\u542B /:*?"<>| \u7B49\u975E\u6CD5\u5B57\u7B26',ILLEGAL_NAME_ZH:"\u540D\u79F0\u4E0D\u80FD\u5305\u542B\u4E2D\u6587",UUID_ERROR:"uuid \u9519\u8BEF",DUPLICATE_DATA:"\u6807\u9898\u5DF2\u5B58\u5728",DUPLICATE_DATA1:"\u5E93\u91CD\u540D",DUPLICATE_DATA_PARAMS:"{type}\u91CD\u590D\u6570\u636E",UPLOAD_LIMIT:"\u6587\u6863 {documentName} \u8D85\u8FC715MB\uFF0C\u5BFC\u81F4\u65E0\u6CD5\u6B63\u5E38\u4FDD\u5B58\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u5BFC\u5165",MORE_THAN_LIMIT:"\u8D85\u8FC7\u6700\u5927\u9650\u5236",FILE_MORE_THAN_LIMIT:"\u8D85\u8FC7{type}\u6700\u5927\u4E0A\u4F20\u9650\u5236",PARAMS_MORE_THAN_LIMIT:"\u8D85\u8FC7\u53C2\u6570{type}\u7684\u6700\u5927\u4E0A\u4F20\u9650\u5236",IMAGE_MORE_THAN_LIMIT_PARAMS:"\u56FE\u7247\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236",FILE_MORE_THAN_LIMIT_PARAMS:"\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236",END_MUST_AFTER_START:"\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u665A\u4E8E\u7ED3\u675F\u65F6\u95F4",FILE_READ_ONLY:"\u5DE5\u7A0B\u6587\u4EF6eprj\u6216\u5E93\u6587\u4EF6elib\u5C5E\u6027\u53D8\u4E3A\u53EA\u8BFB\uFF0C\u8BF7\u5728\u8D44\u6E90\u7BA1\u7406\u5668\u53D6\u6D88\u53EA\u8BFB\u540E\u518D\u8BD5\uFF0C\u5E76\u8054\u7CFB\u6280\u672F\u652F\u6301",FILE_READ_ONLY1:"\u5DE5\u7A0B\u6587\u4EF6eprj\u6216\u5E93\u6587\u4EF6elib\u5C5E\u6027\u53D8\u4E3A\u53EA\u8BFB\uFF0C\u8BF7\u5728\u8D44\u6E90\u7BA1\u7406\u5668\u53D6\u6D88\u53EA\u8BFB\u540E\u518D\u8BD5\uFF0C\u5E76\u8054\u7CFB\u6280\u672F\u652F\u6301",DATA_NOT_EXIST:"\u6587\u6863{documentName}\u4E0D\u5B58\u5728",REQUEST_PARAMS_TIME_ERROR:"\u65F6\u95F4\u8BF7\u6C42\u53C2\u6570\u9519\u8BEF",FILES_PATH_NOT_FOUND:"\u627E\u4E0D\u5230\u6587\u4EF6\u5730\u5740",FILES_DATA_NOT_FOUND:"\u627E\u4E0D\u5230\u6587\u4EF6\u6570\u636E",FILES_TYPE_ERROR:"\u6587\u4EF6\u7C7B\u578B\u9519\u8BEF",FILES_TYPE_MUST_BE_ONE:"\u6587\u4EF6\u7C7B\u578B\u5FC5\u987B\u4E3A{type}",SET_WATERMARK_FAIL:"\u6C34\u5370\u8BBE\u7F6E\u5931\u8D25",MYSQL_CRUD_ERROR:"{type}\u6570\u636E\u6267\u884C\u5931\u8D25, \u8BF7\u8054\u7CFB\u6280\u672F\u652F\u6301\u89E3\u51B3",PARAMS_JSON_FAILED:"{type}\u6570\u636E\u89E3\u6790\u5931\u8D25",MYSQL_ERROR:"\u6570\u636E\u5E93\u64CD\u4F5C\u5F02\u5E38",NOT_FOUND:"\u8BF7\u6C42\u4E0D\u5B58\u5728",PRJ_NAME_EXISTS:"\u5DE5\u7A0B\u540D\u79F0\u5DF2\u5B58\u5728",BACKUP_NAME_EXISTS:"\u5907\u4EFD\u540D\u79F0\u5DF2\u5B58\u5728",TITLE_ILLEGAL_LEN:"{documentName}\u957F\u5EA6\u5FC5\u987B\u4E3A1~128\u5B57\u7B26\u957F\u5EA6\uFF01",LIB_NOT_EXIST:"\u5143\u4EF6\u5E93\u4E0D\u5B58\u5728",CONFIG_API_URLS_ERROR:"\u5B9E\u65F6\u4EF7\u683C\u548C\u5E93\u5B58\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",ONE_CLICK_ORDER_NOT_OPEN:"\u4E00\u4EF6\u4E0B\u5355\u529F\u80FD\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",MATERIAL_NOT_OPEN:"\u7269\u6599\u5E93\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",SNAPSHOT_DEPTH_LIMIT:"\u6700\u65B0\u8282\u70B9\u9644\u8FD1\u5B58\u5728\u5FEB\u7167\u6216\u5FEB\u7167\u5DF2\u88AB\u7533\u8BF7",OCR_SYMBOL_URL_ERROR:"OCR\u8BF7\u6C42\u5730\u5740\u672A\u914D\u7F6E",USER_DATA_NOT_FOUND:"\u7528\u6237\u4E0D\u5B58\u5728",USER_DISABLE_ERROR:"\u8D26\u53F7\u5DF2\u505C\u7528",USER_EXISTS_LOGIN_ERROR:"\u7528\u6237\u5DF2\u5728\u522B\u7684\u5730\u65B9\u767B\u5F55",USER_UNAUTHORIZED_MODULES_ERROR:"\u8BE5\u8D26\u53F7\u672A\u6388\u6743\u6A21\u5757",USER_UNAUTHORIZED_ACCESS_ERROR:"\u8BBF\u95EE\u7C7B\u578B\u9519\u8BEF",ADMIN_NOT_CHANGE_PASSWORD:"\u8D85\u7EA7\u7BA1\u7406\u5458\u65E0\u6CD5\u91CD\u7F6E\u5BC6\u7801",SAME_PASSWORD_NEW_PASSWORD:"\u539F\u5BC6\u7801\u8DDF\u65B0\u5BC6\u7801\u76F8\u540C",USER_ONLINE_REGISTRATION_FAILED:"\u767B\u8BB0\u7528\u6237\u5728\u7EBF\u5931\u8D25",USER_PASSWORD_CAN_NOT_DEFAULT:"\u4E0D\u80FD\u4F7F\u7528\u9ED8\u8BA4\u5BC6\u7801",USER_BEFORE_PASSWORD_ERROR:"\u539F\u5BC6\u7801\u9519\u8BEF",USER_PASSWORD_LENGTH_ERROR:"\u5BC6\u7801\u957F\u5EA6\u4E3A8-255\u4F4D",ORG_ROLE_NOT_CREATE:"\u4E0D\u80FD\u521B\u5EFA\u7CFB\u7EDF\u89D2\u8272, \u8BF7\u4FEE\u6539",ORG_ROLE_NAME_DUPLICATE:"\u89D2\u8272\u540D\u79F0\u5DF2\u5B58\u5728, \u8BF7\u4FEE\u6539",ORG_ROLE_ORIGIN_ERROR:"\u672A\u77E5\u7684\u89D2\u8272\u6765\u6E90{message}",ORG_ROLE_NOT_DEFAULT:"\u8BE5\u89D2\u8272\u4E0D\u662F\u9884\u8BBE\u89D2\u8272, \u4E0D\u80FD\u64CD\u4F5C",ADMIN_ROLE_NOT_CHANGE:"\u7BA1\u7406\u5458\u6743\u9650\u4E0D\u5141\u8BB8\u4FEE\u6539",ADMIN_NOT_CHANGE_STATUS:"admin\u8D26\u53F7\u4E0D\u80FD\u66F4\u6539\u72B6\u6001",PROJECT_ARCHIVED:"\u5DE5\u7A0B\u5DF2\u88AB\u9501\u5B9A",PROJECT_UUID_NULL:"\u5DE5\u7A0Buuid\u4E0D\u80FD\u4E3A\u7A7A",PROJECT_UUID_ERROR:"uuid\u9519\u8BEF\u6216\u8005\u5DE5\u7A0Buuid\u5DF2\u5B58\u5728",PROJECT_OR_TEAM_UUID_ERROR:"\u5DE5\u7A0Buuid\u9519\u8BEF\u6216\u8005\u5DF2\u5B58\u5728\u56E2\u961Fuuid",PROJECT_NOT_PERSON_ERROR:"\u4E0D\u5141\u8BB8\u521B\u5EFA\u4E2A\u4EBA\u5DE5\u7A0B",PROJECT_DUPLICATE_NAME:"\u6807\u9898\u5DF2\u5B58\u5728",ANNOTATION_HAS_BE_FOUND:"\u6279\u6CE8\u5DF2\u521B\u5EFA",ANNOTATION_NOT_FOUND:"\u6279\u6CE8\u5757\u4E0D\u5B58\u5728",ANNOTATION_CREATE_ERROR:"\u6279\u6CE8\u5757\u521B\u5EFA\u5931\u8D25",ANNOTATION_UPDATE_ERROR:"\u66F4\u65B0\u6279\u6CE8\u5757\u5931\u8D25",ANNOTATION_DELETE_ERROR:"\u6279\u6CE8\u6761\u5220\u9664\u5931\u8D25",PROJECT_DUPLICATE_PATH:"\u4E0D\u80FD\u521B\u5EFA\u76F8\u540C\u7684\u8DEF\u5F84",TEAM_NOT_FOUND:"\u56E2\u961F\u4E0D\u5B58\u5728",TEAM_UUID_NULL:"\u56E2\u961Fuuid\u4E0D\u80FD\u4E3A\u7A7A",TEAM_FOLDER_ERROR:"\u7236\u6587\u4EF6\u5939\u4E0D\u5B58\u5728\u6216\u4E0D\u5C5E\u4E8E\u5F53\u524D\u56E2\u961F",TEAM_FOLDER_UUID_ERROR:"\u6587\u4EF6\u5939uuid\u9519\u8BEF\u6216\u8005\u5DE5\u7A0Buuid\u5DF2\u5B58\u5728",TEAM_URL_DUPLICATE:"\u56E2\u961F\u94FE\u63A5\u91CD\u590D",TEAM_CAN_NOT_DELETE:"\u56E2\u961F\u4ECD\u5B58\u5728\u5DE5\u7A0B, \u8BF7\u5148\u8F6C\u79FB\u6216\u8005\u5220\u9664",COMPONENT_UUID_NULL:"\u5143\u4EF6uuid\u4E0D\u80FD\u4E3A\u7A7A",COMPONENT_DATA_NOT_FOUND:"\u5143\u4EF6\u5E93\u6570\u636E\u4E0D\u5B58\u5728",COMPONENT_NAME_DUPLICATE:"\u5143\u4EF6\u5E93\u4E0D\u80FD\u91CD\u540D",COMPONENT_TYPE_ERROR:"\u5E93\u7C7B\u578B\u9519\u8BEF",DELETE_SON_CATEGORY:"\u9700\u8981\u5148\u5220\u9664\u5B50\u7C7B\u522B",LICENSE:"\u672A\u627E\u5230\u8BB8\u53EF\u8BC1",START_TIME:"\u8BB8\u53EF\u8BC1\u5F00\u59CB\u65F6\u95F4\u9519\u8BEF",END_TIME:"\u8BB8\u53EF\u8BC1\u7ED3\u675F\u65F6\u95F4\u9519\u8BEF",PROJECT_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u5DE5\u7A0B\u6570",USER_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u8D26\u53F7\u6570",ONLINE_NUMBER_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u5728\u7EBF\u6570",LIMIT_PCB:"PCB\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",LIMIT_SCH:"\u539F\u7406\u56FE\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",LIMIT_PANEL:"\u9762\u677F\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",TIME_ERROR:"\u7CFB\u7EDF\u65F6\u95F4\u9519\u8BEF\u8BF7\u91CD\u542F\u670D\u52A1\u5668\u6216\u4FEE\u590D\u7CFB\u7EDF\u65F6\u95F4, \u4FEE\u590D\u540E\u9700\u8981\u91CD\u542F\u79C1\u6709\u5316\u670D\u52A1",LICENSE_ERROR:"\u6388\u6743\u9519\u8BEF",LICENSE_TYPE_ERROR:"\u6388\u6743\u5E94\u7528\u7C7B\u578B\u9519\u8BEF",LICENSE_ORIGIN_ERROR:"\u672A\u77E5\u7684\u6388\u6743\u5E94\u7528{type}",BRANCH_DATA_NOT_FOUND:"\u5DE5\u7A0B\u5206\u652F\u4E0D\u5B58\u5728",PARENT_UUID_ERROR:"\u7236\u7EA7uuid\u9519\u8BEF",BRANCH_MUST_AFTER_NODE:"\u5206\u652F\u5FC5\u987B\u5728\u8282\u70B9\u540E",BRANCH_NAME_ERROR:"\u5206\u652F\u540D\u9519\u8BEF",BRANCH_NAME_DUPLICATE:"\u5206\u652F\u540D\u5DF2\u5B58\u5728",BRANCH_UUID_ERROR:"\u5206\u652Fuuid\u9519\u8BEF",BRANCH_NODE_SET_ERROR:"\u8282\u70B9\u4E0D\u80FD\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5206\u652F\u6216\u6807\u8BB0\u4E3Amaster",BRANCH_DELETE_MAIN_ERROR:"\u4E0D\u80FD\u5220\u9664\u4E3B\u5206\u652F\u4E0A\u7684\u8282\u70B9\u6216\u5206\u652F",BRANCH_CHECK_OUT_ERROR:"\u5B58\u5728\u6587\u6863\u5DF2\u7B7E\u51FA",DOCUMENT_UUID_ERROR:"\u6587\u6863uuid\u9519\u8BEF",UPDATE_FAILED:"\u66F4\u65B0\u5931\u8D25",INNER_API_KEY_ERROR:"\u670D\u52A1\u7AEF\u5185\u90E8\u63A5\u53E3 ApiKey \u9519\u8BEF",BRANCH_MORE_THAN_LIMIT:"\u7248\u672C\u8D85\u8FC7\u6700\u5927\u9650\u5236",WORKSPACE_API_ERROR:"\u5DE5\u4F5C\u533A\u8BF7\u6C42\u54CD\u5E94\u5F02\u5E38"},El={codeEN:kd,codeCN:Fd},As,Qa=(As=class{static load(){typeof El=="object"&&(As.cache=El)}static match(e,i,s){if(!this.cache||!this.cache[e])return;let r=this.cache[e][i];if(s&&Object.prototype.toString.call(s)==="[object Object]")for(let n in s){let a=s[n];r=r.replace(`{${n}}`,a)}return r}},As.cache={},As);function Ud(){console.log("common init----------------"),Qa.load()}var jd=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.PERCENT=1]="PERCENT",t[t.LEFT_PAD0=2]="LEFT_PAD0",t))(jd||{});function qe(t,e){throw new Error(`invalid format state on (${e}) of ${t}`)}function Gd(t,...e){let i=[],s=0,r=0,n,a=0,o=0;for(let l=0;l<t.length;l++){let u=t.charAt(l);switch(s){case 0:u==="%"?s=1:i.push(u);break;case 1:switch(u){case"d":n=e[r++],typeof n=="number"?(i.push(n.toFixed(0)),s=0):qe(t,l);break;case"f":n=e[r++],typeof n=="number"?(i.push(n.toString()),s=0):qe(t,l);break;case"x":n=e[r++],typeof n=="number"?(i.push((n|0).toString(16)),s=0):qe(t,l);break;case"X":n=e[r++],typeof n=="number"?(i.push((n|0).toString(16).toUpperCase()),s=0):qe(t,l);break;case"s":case"c":n=e[r++],i.push(n===null?"null":n.toString()),s=0;break;case"0":a=l+1,o=-1,s=2;break;case"%":i.push("%"),s=0;break;default:qe(t,l)}break;case 2:switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":o=l;break;case"d":if(o>=a){let c=parseInt(t.substring(a,o+1));n=e[r++],typeof n=="number"?(i.push((n|0).toString(10).padStart(c,"0")),s=0):qe(t,l)}else qe(t,l);break;case"x":if(o>=a){let c=parseInt(t.substring(a,o+1));n=e[r++],typeof n=="number"?(i.push((n|0).toString(16).padStart(c,"0")),s=0):qe(t,l)}else qe(t,l);break;case"X":if(o>=a){let c=parseInt(t.substring(a,o+1));n=e[r++],typeof n=="number"?(i.push((n|0).toString(16).toUpperCase().padStart(c,"0")),s=0):qe(t,l)}else qe(t,l);break;default:qe(t,l)}break;default:qe(t,l)}}return i.join("")}function bu(t){let e="";try{let i=/.*\\(.*)$/.exec(t);i&&i[1]&&typeof i[1]=="string"&&(e=i[1])}catch(i){console.error("Query Folder Name Error:",i)}return e}function _u(t,e){let i=Math.max(t.length,e.length);for(let s=0;s<i;s++){let r=t[s],n=e[s],a=0;if(typeof r=="string"&&typeof n=="string")a=r.localeCompare(n);else if(typeof r=="number"&&typeof n=="number")a=r-n;else{if(typeof r=="number"&&typeof n=="string")return-1;if(typeof r=="string"&&typeof n=="number")return 1;if(r===void 0&&n!==void 0)return-1;if(r!==void 0&&n===void 0)return 1}if(a!==0)return a}return 0}function to(t){let e=/\d+/g,i=new Array,s=0;for(;;){let r=e.exec(t);if(r)s<r.index&&i.push(t.substring(s,r.index)),s=r.index+r[0].length,i.push(parseInt(r[0]));else break}return i.push(t),i}function Hd(t,e,i,s){var u,c;let r=[],n=[],a=[];for(let h=0,f=t.length;h<f;h++){r[h]=h;let d;if(Array.isArray(e)){let p="";for(let m=0;m<e.length;m++)if(Object.hasOwnProperty.call(t[h],e[m])){p=t[h][e[m]];break}}else d=e?t[h][e]||((c=(u=t[h])==null?void 0:u[s])==null?void 0:c[e])||"":t[h];if(n[h]=String(d).toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),a[h]=[],n[h])for(let p=0;p<n[h].length;p++)a[h][p]=n[h][p].match(/\d/)?1:2}let o=function(h,f){let d=n[h],p=n[f],m=a[h],g=a[f];if(!d||!p)return i?d==p?0:d?-1:1:d==p?0:d?1:-1;let b=Math.max(d.length,p.length);for(let y=0;y<b;y++){if(i)if(d[y])if(p[y]){if(d[y]!=p[y])return m[y]!=g[y]?m[y]==1?1:-1:m[y]==1?p[y]-d[y]:d[y]<p[y]?1:-1}else return-1;else return 1;if(d[y])if(p[y]){if(d[y]!=p[y])return m[y]!=g[y]?m[y]==1?-1:1:m[y]==1?d[y]-p[y]:d[y]<p[y]?-1:1}else return 1;else return-1}return 0};r.sort(o);let l=[];for(let h=0;h<t.length;h++)l[h]=t[r[h]];return l}function Yd(t,e,i){let s=[],r=[],n=[],a=[t,e];for(let o=0,l=a.length;o<l;o++){s[o]=o;let u=a[o];if(r[o]=String(u).toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),n[o]=[],r[o])for(let c=0;c<r[o].length;c++)n[o][c]=r[o][c].match(/\d/)?1:2}return(function(o,l){let u=r[o],c=r[l],h=n[o],f=n[l];if(!u||!c)return i?u==c?0:u?-1:1:u==c?0:u?1:-1;let d=Math.max(u.length,c.length);for(let p=0;p<d;p++){if(i)if(u[p])if(c[p]){if(u[p]!=c[p])return h[p]!=f[p]?h[p]==1?1:-1:h[p]==1?c[p]-u[p]:u[p]<c[p]?1:-1}else return-1;else return 1;if(u[p])if(c[p]){if(u[p]!=c[p])return h[p]!=f[p]?h[p]==1?-1:1:h[p]==1?u[p]-c[p]:u[p]<c[p]?-1:1}else return 1;else return-1}return 0})(s[0],s[1])}function ca(t,e){let i=!1;for(let s in e)if(Object.hasOwnProperty.call(e,s)&&t.indexOf(s)!==-1){i=!0;break}return i}function Vd(t,e=""){return t.sort((s,r)=>_u(to(i(s)),to(i(r)))),t;function i(s){if(!s)return s;let r;if(Array.isArray(e)){let n="";for(let a=0;a<e.length;a++)if(Object.hasOwnProperty.call(s,e[a])){n=s[e[a]];break}}else r=s[e]||s;return r}}function zd(t,e,i=1){var o,l,u,c;let s=(o=t.match(/^\D+/))==null?void 0:o[0],r=(l=t.match(/\d+$/))==null?void 0:l[0],n=(u=e.match(/^\D+/))==null?void 0:u[0],a=(c=e.match(/\d+$/))==null?void 0:c[0];return s&&n?s!==n?i===1?s.localeCompare(n):n.localeCompare(s):r!==a?+r>+a?1*i:-1*i:0:s?-1*i:n?1*i:0}function Xd(t){return new Promise(e=>{setTimeout(e,t)})}var i_=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map(t=>t.charCodeAt(0));function qd(){try{if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis}catch{return null}}function ha(){return self.EDITOR_TOP||self}function Wd(t,e,i){e=e||1,i=i||32;var s="",r=e,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];t&&(r=Math.round(Math.random()*(i-e))+e);for(var a=0;a<r;a++){let o=Math.round(Math.random()*(n.length-1));s+=n[o]}return s}function Jd(t){try{return JSON.parse(t)}catch{return console.error(`ParseJSON failed:
`+t),null}}var Kd=(t=>(t[t.TRACE=0]="TRACE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.DUMMY=5]="DUMMY",t))(Kd||{}),$d=(t,e)=>{switch(t){case 4:console.error(...e);break;case 3:console.warn(...e);break;case 2:console.info(...e);break;default:console.log(...e)}},Zd=(t,e)=>e,Qd=class wr{constructor(e,i=$d,s=Zd){this.level=e,this.writer=i,this.formatter=s}wrap(e){return new wr(this.level,this.writer,(i,s)=>(s=this.formatter(i,s),e(i,s)))}inject(e){return new wr(this.level,this.writer,(i,s)=>(s=e(i,s),this.formatter(i,s)))}shadow(...e){return new wr(this.level,(i,s)=>{this.writer(i,s);for(let r of e)r(i,s)},this.formatter)}mix(...e){return new wr(0,(i,s)=>{this.process(i,s);for(let r of e)r.process(i,s)},(i,s)=>s)}process(e,i){this.level<=e&&this.writer(e,this.formatter(e,i))}process1(e,i,s){this.level<=e&&this.writer(e,this.formatter(e,[Gd(i,...s)]))}trace(...e){this.process(0,e)}trace1(e,...i){this.process1(0,e,i)}debug(...e){this.process(1,e)}debug1(e,...i){this.process1(1,e,i)}info(...e){this.process(2,e)}info1(e,...i){this.process1(2,e,i)}warn(...e){this.process(3,e)}warn1(e,...i){this.process1(3,e,i)}error(...e){this.process(4,e)}error1(e,...i){this.process1(4,e,i)}},s_=new Qd(5),r_=Date.now()-performance.now(),Su=new ArrayBuffer(10),n_=new Float64Array(Su,0,1),a_=new Uint8Array(Su);var Do={};Md(Do,{HAS_PANEL:()=>Tp,HAS_PCB:()=>yp,HAS_SCH:()=>Ep,IS_CLIENT:()=>ui,IS_CLIENT_HALF_OFFLINE:()=>zn,IS_CLIENT_NOT_ONLINE:()=>wo,IS_CLIENT_OFFLINE:()=>dp,IS_CLIENT_ONLINE:()=>Xn,IS_DEV:()=>sp,IS_EASYEDA:()=>Au,IS_EASYEDA_CLIENT:()=>hp,IS_ECAD:()=>rp,IS_HALF_OFFLINE:()=>fa,IS_LCEDA:()=>Iu,IS_LCEDA_CLIENT:()=>cp,IS_OFFLINE:()=>ma,IS_ONLINE:()=>pa,IS_PCBLUXSHARE:()=>np,IS_PRIVATE:()=>da,PRO_EDITOR_MODE:()=>pp,PRO_EDITOR_MODES:()=>Oe,SSO_EXTERNAL_IDENTITY_DOMAIN:()=>op,SSO_EXTERNAL_PERMISSION_DOMAIN:()=>lp,SSO_EXTERNAL_PERMISSION_MANAGED_DOMAIN:()=>up,SSO_IDENTITY_CONNECT:()=>ap});var tp=(t=>(t.ruler="ruler",t.un_ruler="un_ruler",t))(tp||{}),ep=(t=>(t[t.HOME=-1]="HOME",t[t.BLANKTAB=0]="BLANKTAB",t[t.SCH=1]="SCH",t[t.PART=2]="PART",t[t.PCB=3]="PCB",t[t.FOOTPRINT=4]="FOOTPRINT",t[t.PRJ=5]="PRJ",t[t.SUBPART=6]="SUBPART",t[t.NGSPICE_MODEL=7]="NGSPICE_MODEL",t[t.NGSPICE=8]="NGSPICE",t[t.SIMULIDE=9]="SIMULIDE",t[t.WAVEFORM=10]="WAVEFORM",t[t.SCHLIB3D=11]="SCHLIB3D",t[t.PHOTOVIEW=12]="PHOTOVIEW",t[t.SCHMODULE=13]="SCHMODULE",t[t.PCBMODULE=14]="PCBMODULE",t[t.VIEW3D=15]="VIEW3D",t[t.PCBLIB3D=16]="PCBLIB3D",t[t.BLOCK_SYMBOL=17]="BLOCK_SYMBOL",t[t.NETFLAG=18]="NETFLAG",t[t.NETPORT=19]="NETPORT",t[t.SHEET_SYMBOL=20]="SHEET_SYMBOL",t[t.NONEELEC_SYMBOL=21]="NONEELEC_SYMBOL",t[t.SHORT_SYMBOL=22]="SHORT_SYMBOL",t[t.FOOTPRINTVIEW=23]="FOOTPRINTVIEW",t[t.CNCPRINTVIEW=24]="CNCPRINTVIEW",t[t.OFF_PAGE_CONNECTOR=25]="OFF_PAGE_CONNECTOR",t[t.PANEL=26]="PANEL",t[t.PANEL3D=27]="PANEL3D",t[t.DEVICE=28]="DEVICE",t[t.PANEL_LIB=29]="PANEL_LIB",t[t.ASSEMBLY_VARIANT=30]="ASSEMBLY_VARIANT",t[t.DIFF_PAIRS_FLAG=31]="DIFF_PAIRS_FLAG",t[t.SIMULIDE_MODEL=32]="SIMULIDE_MODEL",t))(ep||{}),ip=(t=>(t.SCH="SCH",t.PCB="PCB",t.PANEL="PANEL",t))(ip||{}),Da=qd(),Oe=String((Da==null?void 0:Da.PRO_EDITOR_MODE)||"LCEDA").split("-"),sp=Oe.indexOf("DEVPRO")>=0,ui=Oe.indexOf("CLIENT")>=0,Iu=Oe.indexOf("LCEDA")>=0,Au=Oe.indexOf("EASYEDA")>=0,da=Oe.indexOf("PRIVATE")>=0,pa=Oe.indexOf("ONLINE")>=0,fa=Oe.indexOf("HALF_OFFLINE")>=0,ma=Oe.indexOf("OFFLINE")>=0,rp=Oe.indexOf("ECAD")>=0,np=Oe.indexOf("PCB_LUXSHARE")>=0,ap=Oe.indexOf("SSO_IDENTITY_CONNECT")>=0,op=Oe.indexOf("SSO_EXTERNAL_IDENTITY_DOMAIN")>=0,lp=Oe.indexOf("SSO_EXTERNAL_PERMISSION_DOMAIN")>=0,up=Oe.indexOf("SSO_EXTERNAL_PERMISSION_MANAGED_DOMAIN")>=0,cp=ui&&Iu,hp=ui&&Au,zn=ui&&fa,wo=ui&&!pa,dp=ui&&ma,Xn=ui&&pa,pp=ui?pa?"ONLINE":fa?"HALF_OFFLINE":ma?"OFFLINE":"":"",fp=Oe.indexOf("SCH")>=0,mp=Oe.indexOf("PCB")>=0,gp=Oe.indexOf("PANEL")>=0,Ep=fp,yp=mp,Tp=gp,bp=(t=>(t.PROJECT_BACKUPS_MANUAL="Backup Project Manually",t.PROJECT_BACKUPS_AUTO="Backup Project Automatically",t.DELETE_BACKUPS="Delete Backup",t.SAVE="Save",t.CREATE_SHEET="New Page",t.DELETE_SHEET="Delete Page",t.RENAME_SHEET="Rename Page",t.SIGNED_SHEET="Check Out Page",t.SIGNIN_SHEET="Check In Page",t.CLEAR_SIGNED="Clear Check Out",t.PROJECT_LOCK="Lock Project",t.PROJECT_UNLOCK="Unlock Project",t.PROJECT_OPEN="Open Project",t.PROJECT_CLOSE="Close Project",t.DOCUMENT_PASTE="Paste Document",t.DOCUMENT_PASTE_ACROSS_PROJECT="Paste Document Across Projects",t.SCHEMATIC_PASTE="Paste Schematic",t.SCHEMATIC_PASTE_ACROSS_PROJECT="Paste Schematic Across Projects",t.PRIMITIVE_PASTE_ACROSS_PROJECT="Paste Elements Across Projects",t.PROJECT_SAVEAS_REMOTE="Save Project to Cloud",t.PROJECT_SAVEAS_LOCAL="Save Project to Local",t.LIBRARY_SAVEAS_LOCAL="Save Library to Local",t.DOCUMENT_SAVEAS_REMOTE="Save Document to Cloud",t.DOCUMENT_SAVEAS_LOCAL="Save Document to Local",t.CBB_SAVEAS_REMOTE="Save Reuse Module to Cloud",t.CBB_SAVEAS_LOCAL="Save Reuse Module to Local",t.SVG_EXPORT="Export SVG",t.PNG_EXPORT="Export PNG",t.PDF_EXPORT="Export PDF",t.BOM_EXPORT="Export BOM",t.PRINT="Print",t.GERBER_EXPORT="Export Gerber",t.COORDINATE_EXPORT="Export Pick and Place File",t.D3FILE_EXPORT="Export 3D File",t.D3SHELLFILE_EXPORT="Export 3D Shell File",t.TESTPOINT_REPORT_EXPORT="Export Test Point Report",t.DXF_EXPORT="Export DXF",t.ODBPLUSS_EXPORT="Export ODB++",t.AD_EXPORT="Export Altium Designer",t.DEVICE_REPLACE="Replace Device",t.FOOTPRINT_REPLACE="Replace Footprint",t.D3MODEL_REPLACE="Replace 3D Model",t.PROJECTLIB_UPDATE="Update Project Library",t.REPLACE="Find and Replace",t.TRACK_BATCH_RENAME="Rename Wires in Batch",t.SHEET_BATCH_RENAME="Rename Pages in Batch",t.NET_CREATED_AUTO="Automatic Network Generation",t.DESIGNATOR_ALLOCATION="Annotate Designator",t.UNIQUE_ID_RESET="Reset Unique ID",t.NET_TABLE_EXPORT="Export Netlist",t.REFRESH_PCB_BY_SCH="Update Schematic to PCB",t.REFRESH_SCH_BY_PCB="Update PCB to Schematic",t.CLEAR_DESIGNATOR="Clear Designator",t.UPDATE_PORT_BY_MODULE_SYMBOL="Update Ports from Module Symbol",t.DESIGN_RULE="Set Design Rules",t.NET_CLASS="Set Network Class",t.EQUAL_LENGTH_GROUP="Set Equal Length Group",t.DIFFERENTIAL_PAIR="Set Differential Pair",t))(bp||{}),Se,o_=(Se=class{constructor(e,i=crypto.randomUUID()){this.fileName=e,this.uuid=i,this._params=new URLSearchParams,this._aTarget=document.createElement("a"),this._params.append("uuid",i),this._params.append("fileName",e)}static get URL_VERSION(){var e;try{let i=location.host,s="/";return((e=new RegExp(`${i}(/[\\w|.]+)${s}`).exec(location.href))==null?void 0:e[1])||""}catch{return""}}static getOpenedStream(e){return this._openedInstances.get(e)}get createURL(){return`${Se.CREATE_URL}?${this._params}`}get writeURL(){return`${Se.WRITE_URL}?${this._params}`}get closeURL(){return`${Se.CLOSE_URL}?${this._params}`}get cancelURL(){return`${Se.CANCEL_URL}?${this._params}`}async create(){this._aTarget.href=this.createURL,this._aTarget.click(),this._aTarget.remove(),Se._openedInstances.set(this.uuid,this),await Xd(100)}async write(e){await(await fetch(this.writeURL,{method:"post",body:e})).json()}async close(){await fetch(this.closeURL,{method:"post"}),Se._openedInstances.delete(this.uuid)}async cancel(){await fetch(this.cancelURL,{method:"post"}),Se._openedInstances.delete(this.uuid)}},Se.CREATE_URL=`${Se.URL_VERSION}/sw/download/stream/create`,Se.WRITE_URL="/sw/download/stream/write",Se.CLOSE_URL="/sw/download/stream/close",Se.CANCEL_URL="/sw/download/stream/cancel",Se._openedInstances=new Map,Se);var _p=Object.create,Ou=Object.defineProperty,Sp=Object.getOwnPropertyDescriptor,Ip=Object.getOwnPropertyNames,Ap=Object.getPrototypeOf,Op=Object.prototype.hasOwnProperty,Rp=(t=>typeof ks<"u"?ks:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof ks<"u"?ks:e)[i]}):t)(function(t){if(typeof ks<"u")return ks.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),vt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Dp=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ip(e))!Op.call(t,r)&&r!==i&&Ou(t,r,{get:()=>e[r],enumerable:!(s=Sp(e,r))||s.enumerable});return t},hr=(t,e,i)=>(i=t!=null?_p(Ap(t)):{},Dp(e||!t||!t.__esModule?Ou(i,"default",{value:t,enumerable:!0}):i,t)),Zr=vt((t,e)=>{"use strict";var i=Object.defineProperty,s=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(T,I)=>{for(var D in I)i(T,D,{get:I[D],enumerable:!0})},o=(T,I,D,C)=>{if(I&&typeof I=="object"||typeof I=="function")for(let U of r(I))!n.call(T,U)&&U!==D&&i(T,U,{get:()=>I[U],enumerable:!(C=s(I,U))||C.enumerable});return T},l=T=>o(i({},"__esModule",{value:!0}),T),u={};a(u,{BroadcastChannelMessageBus:()=>cs,MessageBus:()=>ft,MessageBus2:()=>Ct,MessageBusTask:()=>pt,MessageBusTask2:()=>ae,WindowMessageBridge:()=>at,WorkerMessageBridge:()=>nt,createBroadcastP2PStream:()=>zi,createBufferedByteBufferStream:()=>pi,createBufferedStream:()=>he,createBufferedStringStream:()=>je,dropP2PStream:()=>fi,flowRead:()=>Bs,flowWrite:()=>br}),e.exports=l(u);var c=class{constructor(T=1.5){this.growthFactor=T,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(T){if(this.count===this.capacity){let I=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,I);let D=new Array(I);for(let C=0;C<this.count;C++)D[C]=this.buffer[(this.head+C)%this.capacity];this.buffer=D,this.head=0,this.tail=this.count,this.capacity=I}this.buffer[this.tail]=T,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let T=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,T}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},h=new ArrayBuffer(8),f=new Float64Array(h),d=new Uint32Array(h),p=new Uint16Array(h),m=ArrayBuffer;try{m=self.HTMLImageElement||m}catch{}var g=typeof SharedArrayBuffer<"u";function b(T){if(typeof T!="object"||T===null||T instanceof Date||T instanceof ArrayBuffer||g&&T instanceof SharedArrayBuffer||T instanceof Blob||T instanceof FormData||T instanceof Function||T instanceof Uint8ClampedArray||T instanceof m)return T;if(Array.isArray(T))return T.map(b);{let I={};for(let D in T)Object.hasOwnProperty.call(T,D)&&(I[D]=b(T[D]));return I}}function y(T,I){return E(T,I,()=>[])}function E(T,I,D){let C=T[I];return C!==void 0||(C=D(I),T[I]=C),C}function _(T,I){if(Array.isArray(T)){for(let D=0,C=T.length;D<C;D++)if(I(void 0,T[D],D)===!1)return}else{let D=0;for(let C in T)if(T.hasOwnProperty(C)){let U=T[C];if(I(C,U,D)===!1)return;D++}}}var S=Object.prototype.hasOwnProperty;async function A(T,I){if(Array.isArray(T)){for(let D=0,C=T.length;D<C;D++)if(await I(void 0,T[D],D)===!1)return}else{let D=0;for(let C in T)if(S.call(T,C)){let U=T[C];if(await I(C,U,D)===!1)return;D++}}}function w(T,I,D){return typeof T=="string"&&(/https?:/.test(T)||(T=location.origin+T)),Promise.race([fetch(T,I),new Promise((C,U)=>setTimeout(U,D))])}function R(T,I){let D=0,C=0;return(...U)=>{let J=++D;setTimeout(()=>{let $=performance.now();if(J===D||$-C>=T){try{I(...U)}catch(st){console.log(st)}C=$}},Math.max(0,T-(performance.now()-C)))}}function L(T,I){let D=T.length,C=0;for(;C<D;){let U=T.indexOf(`
`,C);U<0&&(U=D);let J=T.substring(C,U);try{if(I(J)===!1)return}catch($){console.error($)}C=U+1}}function M(T){let I=null;return()=>(I===null&&(I=T()),I)}var B=0;function q(){B===0&&(B=Date.now()-performance.now());let T=new Array,I=B+performance.now();f[0]=I,T.push(d[1].toString(16)),f[0]=Math.random(),T.push(p[3].toString(16));let D=p[2].toString(16);T.push("4"+D.substr(0,3)),f[0]=I;let C=d[0].toString(16)+d[1].toString(16);return T.push("0"+C.substr(0,3)),T.push(C.substr(3)),T.join("-")}var H=class{constructor(T){this.maxResources=T,this.idle=new c,this.isClosed=!1,this.resources=T}acquire(T){this.isClosed?Promise.resolve(!1).then(T):this.resources>0?(this.resources--,Promise.resolve(!0).then(T)):this.idle.enqueue(T)}acquireSync(){return new Promise(T=>{this.acquire(T)})}release(){if(!this.isClosed){let T=this.idle.dequeue();T?Promise.resolve(!0).then(T):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let T=this.idle.dequeue();Promise.resolve(!1).then(T)}}};function V(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function W(T,I,D){let C=T.length+I-1;for(let U=0;U<C;U++){let J=new Array;for(let $=U-I+1;$<=U;$++)J.push(T[$]);if(D(J)===!1)break}}function v(){let T=new Date,I=T.getFullYear(),D=T.getMonth()+1,C=T.getDate(),U=T.getHours(),J=T.getMinutes(),$=T.getSeconds(),st=T.getMilliseconds();return"["+I+"-"+(D<10?"0"+D:D)+"-"+(C<10?"0"+C:C)+" "+(U<10?"0"+U:U)+":"+(J<10?"0"+J:J)+":"+($<10?"0"+$:$)+"."+(st<100?st<10?"00"+st:"0"+st:st)+"] "}function j(T){return new Promise(I=>setTimeout(I,T))}function O(T,I){let D=0,C=T.length;for(let U=0;U<C;U++)T[U]===I&&(T.splice(U,1),U--,C--,D++);return D}var x=V(),k=x.WeakRef||(T=>T);function F(T){if(T!=null){if(typeof T=="object")return new k(T);console.error(T,T instanceof Object,typeof T);return}}function P(T){return T==null?void 0:T.deref()}var z="_MSG_BUS_RPC_",Y=300*1e3,tt=(T=>(T.PUBLISH="publish",T.SUBSCRIBE="subscribe",T.PUSH="push",T.PULL="pull",T))(tt||{}),it=class{constructor(T){this.bus=T}processRemoteMessage(T,I){let D=F(I),C=T.topic,U=T.type,J=T.message;switch(U){case"pull":this.bus.pull(C,$=>{this.push(C,$,P(D))});break;case"subscribe":this.bus.subscribe(C,$=>{this.publish(C,$,P(D))});break;case"publish":this.bus.publish(C,J,this,P(D));break;case"push":this.bus.push(C,J,this,P(D));break;default:console.debug("unknown message type "+U)}}rpcCall(T,I,D,C=Y){let U=F(D),J=new Promise($=>{let st=this.bus.uniqueRpcTopic(T);this.publish(T,{message:I,reply:st},P(U)),this.bus.pull(st,(Et,It,qt)=>{$({message:Et,bridge:It,source:F(qt)})})});return C>0?Promise.race([J,new Promise(($,st)=>{setTimeout(st,C)})]):J}},nt=class extends it{constructor(T,I){super(T),this.worker=I,I.onmessage=D=>{this.processRemoteMessage(D.data,void 0)}}publish(T,I){this.postMessage(T,"publish",I)}subscribe(T){this.postMessage(T,"subscribe",null)}push(T,I){this.postMessage(T,"push",I)}pull(T){this.postMessage(T,"pull",null)}rpcCall(T,I,D=Y){return super.rpcCall(T,I,void 0,D)}postMessage(T,I,D){let C={topic:T,type:I,message:D};this.worker.postMessage(C)}discard(){this.worker.terminate()}},at=class extends it{constructor(T){super(T),window.addEventListener("message",I=>{this.processRemoteMessage(I.data,I.source)},!1)}publish(T,I,D){this.postMessage(T,"publish",I,D)}subscribe(T,I){if(I===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(T,"subscribe",null,I)}push(T,I,D){this.postMessage(T,"push",I,D)}pull(T,I){if(I===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(T,"pull",null,I)}postMessage(T,I,D,C){let U={topic:T,type:I,message:D};C&&C.postMessage(U,"*")}},pt=class{constructor(T){this.isRunning=!0,this.callback=T}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(T,I,D,C){try{T=C?T:b(T),this.callback(T,I,D)}catch(U){console.error(U)}}},ft=class{constructor(T=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=T}uniqueRpcTopic(T){return`${z}-${T}-${this.uuid}-${this.rpcTicket++}`}publish(T,I,D,C){let U=this.subscribed[T];if(U){let J;for(let $ of U)$.running()?$.execute(I,D,C,this.unsafe):(J=J||new Array,J.push($));if(J)for(let $ of J)O(U,$)}else console.debug("no sub on topic: "+T)}subscribe(T,I){let D=new pt(I);return y(this.subscribed,T).push(D),D}push(T,I,D,C){let U=!1,J=this.pulled[T];if(J){for(;J.length>0;){let $=J.shift();if($.running()){$.execute(I,D,C,this.unsafe),U=!0;break}}J.length===0&&delete this.pulled[T]}U||y(this.pushed,T).push({message:I,bridge:D,source:F(C)})}pull(T,I){let D=new pt(I),C=this.pushed[T];if(C){let U=C.shift();D.execute(U.message,U.bridge,P(U.source),this.unsafe),C.length===0&&delete this.pushed[T]}else y(this.pulled,T).push(D);return D}pullA(T){return new Promise(I=>{this.pull(T,(D,C,U)=>{I({message:D,bridge:C,source:F(U)})})})}rpcService(T,I){this.subscribe(T,(D,C,U)=>{let{message:J,reply:$}=D;try{let st=I(J);if(st instanceof Promise){let Et=F(U);st.then(It=>{this.rpcReply(It,$,C,P(Et))},It=>{console.error(It),this.rpcReply(void 0,$,C,P(Et))})}else this.rpcReply(st,$,C,U)}catch(st){console.error(st),this.rpcReply(void 0,$,C,U)}})}rpcCall(T,I,D=Y){let C=new Promise(U=>{let J=this.uniqueRpcTopic(T);this.publish(T,{message:I,reply:J}),this.pull(J,($,st,Et)=>{U({message:$,bridge:st,source:F(Et)})})});return D>0?Promise.race([C,new Promise((U,J)=>{setTimeout(J,D)})]):C}rpcReply(T,I,D,C){D?D.push(I,T,C):this.push(I,T)}},xt="_MSG_BUS_RPC_";function gt(T,I){let D=0,C=T.length;for(let U=0;U<C;U++)T[U]===I&&(T.splice(U,1),U--,C--,D++);return D}function bt(T,I){return Wt(T,I,()=>[])}function Wt(T,I,D){let C=T[I];return C!==void 0||(C=D(I),T[I]=C),C}var ae=class{constructor(T,I){this.callback=T,this.unsafe=I,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(T){try{T=this.unsafe?T:b(T),this.callback(T)}catch(I){console.error(I)}}},ce=class{constructor(T=crypto.randomUUID()){this.uuid=T,this.rpcTicket=0}subscribeOnce(T,I){let D=this.subscribe(T,C=>{D.cancel(),I(C)});return D}pullA(T){return new Promise(I=>{this.pull(T,I)})}rpcService(T,I){let D=C=>{try{let{message:U,replyTopic:J}=C;try{let $=I(U);$ instanceof Promise?$.then(st=>{this.publish(J,{success:!0,result:st})}).catch(st=>{console.error(st),this.publish(J,{success:!1,err:String(st)})}):this.publish(J,{success:!0,result:$})}catch($){this.publish(J,{success:!1,err:String($)})}}finally{this.pull(T,D)}};this.pull(T,D)}rpcCall(T,I,D=0){let C=new Promise((U,J)=>{let $=`${xt}-${T}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce($,st=>{st.success?U(st.result):J(new Error(st.err))}),this.push(T,{message:I,replyTopic:$})});return D>0?Promise.race([C,new Promise((U,J)=>{setTimeout(J,D)})]):C}},Ct=class extends ce{constructor(T=!1){super(),this.unsafe=T,this.subscribed={},this.pulled={},this.pushed={}}publish(T,I){let D=this.subscribed[T];if(D){let C;for(let U of D)U.running()?U.execute(I):(C=C||new Array,C.push(U));if(C)for(let U of C)gt(D,U)}}subscribe(T,I){let D=new ae(I,this.unsafe);return bt(this.subscribed,T).push(D),D}push(T,I){let D=!1,C=this.pulled[T];if(C){for(;C.length>0;){let U=C.shift();if(U&&U.running()){U.execute(I),D=!0;break}}C.length===0&&delete this.pulled[T]}D||bt(this.pushed,T).push(I)}pull(T,I){let D=new ae(I,this.unsafe);return this.repull(T,D),D}repull(T,I){let D=this.pushed[T];if(D){let C=D.shift();C&&(I.execute(C),D.length===0&&delete this.pushed[T])}else bt(this.pulled,T).push(I)}},Dt=class extends ce{constructor(T=crypto.randomUUID()){super(T),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(T,I){console.debug("BC",this.uuid,"PUBLISH",T,I),this.broadcastPublish(T,I)}subscribe(T,I){console.debug("BC",this.uuid,"SUBSCRIBE",T);let D=new ae(I,!0);return bt(this.subscribed,T).push(D),D}push(T,I){let D=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",T,`(${D})`,I),bt(this.pushed,T).push({id:D,message:I}),this.broadcastPushedHeadMessage(T)}pull(T,I){console.debug("BC",this.uuid,"PULL",T);let D=new ae(I,!0);return bt(this.pulled,T).push(D),this.broadcastWhoHas(T),D}broadcastPushedHeadMessage(T){let I=this.pushed[T];I&&I[0]&&this.broadcastIHave(T,I[0].id)}onReceivedPublish(T,I,D){console.debug("BCMSG(",this.uuid,")","from",T,"PUBLISH",I,"message",D);let C=this.subscribed[I];if(C){let U;for(let J of C)J.running()?J.execute(D):(U=U||new Array,U.push(J));if(U)for(let J of U)gt(C,J);C.length===0&&delete this.subscribed[I]}}onReceivedWhoHas(T,I){console.debug("BCMSG(",this.uuid,")","from",T,"WHOHAS",I),this.broadcastPushedHeadMessage(I)}onReceivedIHave(T,I,D){console.debug("BCMSG(",this.uuid,")","from",T,"IHAVE",I,"id",D);let C=this.pulled[I];if(C){let U;for(let J of C)if(J.running()){this.broadcastINeed(I,T,D);break}else U=U||new Array,U.push(J);if(U)for(let J of U)gt(C,J);C.length===0&&delete this.pulled[I]}}onReceivedINeed(T,I,D,C){if(console.debug("BCMSG(",this.uuid,")","from",T,"INEED",I,"source",D,"id",C),this.uuid===D){let U=this.pushed[I];if(U&&U[0]&&U[0].id===C){let{message:J}=U.shift();this.broadcastIGive(I,C,T,J),this.broadcastPushedHeadMessage(I),U.length===0&&delete this.pushed[I]}}}onReceivedIGive(T,I,D,C,U){console.debug("BCMSG(",this.uuid,")","from",T,"IGIVE",I,"id",D,"target",C,"message",U);let J=this.pulled[I];if(J&&this.uuid===C){let $=!1;for(;J.length>0;){let st=J.shift();if(st.running()){st.execute(U),$=!0;break}}$||this.push(I,U),J.length===0&&delete this.pulled[I]}}},cs=class extends Dt{constructor(T,I=crypto.randomUUID()){super(I),this.bc=new BroadcastChannel(T),this.bc.onmessage=D=>{this.onMessage(D.data)}}onMessage(T){let{type:I,uuid:D,topic:C}=T;switch(I){case"PUBLISH":{let{message:U}=T;this.onReceivedPublish(D,C,U);break}case"WHOHAS":{this.onReceivedWhoHas(D,C);break}case"IHAVE":{let{id:U}=T;this.onReceivedIHave(D,C,U);break}case"INEED":{let{source:U,id:J}=T;this.onReceivedINeed(D,C,U,J);break}case"IGIVE":{let{target:U,id:J,message:$}=T;this.onReceivedIGive(D,C,J,U,$);break}default:console.warn("unsupported",T)}}broadcastPublish(T,I){this.post({type:"PUBLISH",uuid:this.uuid,topic:T,message:I})}broadcastWhoHas(T){this.post({type:"WHOHAS",uuid:this.uuid,topic:T})}broadcastIHave(T,I){this.post({type:"IHAVE",uuid:this.uuid,topic:T,id:I})}broadcastINeed(T,I,D){this.post({type:"INEED",uuid:this.uuid,topic:T,source:I,id:D})}broadcastIGive(T,I,D,C){this.post({type:"IGIVE",uuid:this.uuid,topic:T,id:I,target:D,message:C})}post(T){this.bc.postMessage(T),Promise.resolve().then(()=>{this.onMessage(T)})}},ge=Symbol("BLOCKING_QUEUE_RESET"),De=class{constructor(T,I=()=>1){if(this.maxSize=T,this.itemSizeOf=I,this.queue=new c,this.waitingConsumers=new c,this.waitingProducers=new c,this.queueSize=0,this.closePromise=null,this.closeResolve=null,T<=0)throw new Error("Max size must be greater than 0")}enqueue(T){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let I=await new Promise(D=>{this.waitingProducers.enqueue(D)});return console.debug("queue is not full",this.size(),I),I?(this.innerEnqueue(T),!0):!1})():(this.innerEnqueue(T),!0)}innerEnqueue(T){if(this.waitingConsumers.isEmpty())this.queue.enqueue(T),this.queueSize+=this.itemSizeOf(T),console.debug("queue pushed",T,"size",this.queueSize);else{let I=this.waitingConsumers.dequeue();Promise.resolve(T).then(I),console.debug("queue direct",T,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let T=this.waitingConsumers.dequeue();Promise.resolve(ge).then(T)}return setTimeout(()=>this.closeResolve(),0),ge}else return new Promise(T=>{this.waitingConsumers.enqueue(T)});else{let T=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(T),!this.waitingProducers.isEmpty()){let I=this.waitingProducers.dequeue();Promise.resolve(!0).then(I)}return T}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(T=>{for(this.closeResolve=T;!this.waitingProducers.isEmpty();){let I=this.waitingProducers.dequeue();Promise.resolve(!1).then(I)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let I=this.waitingConsumers.dequeue();Promise.resolve(ge).then(I)}T()}})),this.closePromise}};function he(T,I,D=Number.MAX_SAFE_INTEGER){let C=new De(D,I),U=new ReadableStream({pull($){let st=!0,Et=(async()=>{let It=new Array;do{let qt=C.dequeue();if(qt instanceof Promise){st=!1;let ue=await qt;ue===ge?$.close():It.push(ue)}else{let ue=qt;ue===ge?$.close():It.push(ue)}}while(C.size()>0);if(It.length>0){let qt=T(It);$.enqueue(qt)}})();if(!st)return console.debug("read stream stucked --------------------------------------"),Et},async cancel(){console.debug("buffered readable cancel"),await C.close()}}),J=new WritableStream({write($,st){let Et=!0,It=(async()=>{let qt=C.enqueue($);typeof qt=="boolean"?qt||st.error(new Error("Write stream closed")):(Et=!1,await qt||st.error(new Error("Write stream closed")))})();if(!Et)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),It},async close(){console.debug("buffered writable closing",C.size()),await C.close(),console.debug("buffered writable closed",C.size())},async abort(){console.debug("buffered writable aborting",C.size()),await C.close(),console.debug("buffered writable aborted",C.size())}});return{readable:U,writable:J}}function je(T=Number.MAX_SAFE_INTEGER){return he(I=>I.join(""),I=>I.length,T)}function pi(T=Number.MAX_SAFE_INTEGER){return he(I=>{let D=new Uint8Array(I.reduce((U,J)=>U+J.byteLength,0)),C=0;return I.forEach(U=>{D.set(U,C),C+=U.byteLength}),D},I=>I.byteLength,T)}function zi(T){return new Promise((I,D)=>{let C=new BroadcastChannel(T),U=new De(1),J=new H(1),$=null,st=!1,Et=!1,It=!1;C.onmessage=qt=>{let ue=qt.data,{type:be}=ue;if(console.debug("p2p",T,"type",be,"data",be==="DATA"&&ue.data),be==="DATA")U.enqueue(ue.data);else if(be==="HI"){if(!$){C.postMessage({type:"HI"});let mi=0;$={rs:new ReadableStream({async pull(si){let ri=await U.dequeue();ri===ge?(await hs(),si.close()):(si.enqueue(ri),C.postMessage({type:"ACK"}))},cancel(){return hs()}}),ws:new WritableStream({async write(si,ri){await J.acquireSync()?C.postMessage({type:"DATA",id:mi++,data:si}):(wi(),ri.error(new Error("Write stream closed")))},close(){wi()},abort(){wi()}})},I($)}}else be==="REND"?$?J.close():ds("REND1"):be==="WEND"?$?U.close():ds("WEND1"):be==="ACK"&&J.release();function wi(){st||(st=!0,console.debug(T,"p2p write stream closed"),J.close(),C.postMessage({type:"WEND"}),Et&&(console.debug(T,"p2p channel closed on ws"),C.close()))}async function hs(){Et||(Et=!0,console.debug(T,"p2p read stream closed"),C.postMessage({type:"REND"}),await U.close(),st&&(console.debug(T,"p2p channel closed on rs"),C.close()))}async function ds(mi){It||(It=!0,console.debug(T,"p2p channel connection released on",mi),J.close(),U.close(),$?($.rs.locked||(console.debug(T,"p2p unlocked read stream direct cancel"),$.rs.cancel()),$.ws.locked||(console.debug(T,"p2p unlocked write stream direct close"),$.ws.close())):(C.postMessage({type:"HI"}),C.close()),D(new Error("p2p channel connection released")))}},C.postMessage({type:"HI"})})}function fi(T){return new Promise(I=>{let D=new BroadcastChannel(T);D.onmessage=C=>{let U=C.data,{type:J}=U;J==="HI"&&(D.postMessage({type:"REND"}),D.close(),I())},D.postMessage({type:"REND"})})}async function ii(T){try{return await zi(T)}catch(I){I.message!=="p2p channel connection released"&&console.error(I)}}async function br(T,I,D=10*1024*1024,C=!0){let U=await ii(T);if(!U)return!1;let J=!1;try{let $,st=Et=>{if(!$)if(!C)$=U.ws.getWriter();else if(typeof Et=="string"){let It=je(D);It.readable.pipeTo(U.ws),$=It.writable.getWriter()}else{let It=pi(D);It.readable.pipeTo(U.ws),$=It.writable.getWriter()}return $.write(Et)};if(Array.isArray(I))for(let Et of I)await st(Et);else await I({write:st,get desiredSize(){return(($==null?void 0:$.desiredSize)||0)+10}});$&&await $.close(),J=!0}catch($){console.error($)}finally{return U.rs.cancel(),J}}async function Bs(T,I){var C,U;let D=await ii(T);if(D)try{let J=D.rs.getReader();for((C=I.start)==null?void 0:C.call(I);;){let{value:$,done:st}=await J.read();if($!==void 0){let Et;if(I.update instanceof Promise?Et=await I.update($):Et=I.update($),Et){await J.cancel();break}}if(st){(U=I.end)==null||U.call(I);break}}}catch(J){console.error(J)}finally{D.ws.close()}}}),wp=vt(()=>{}),kt=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s():typeof define=="function"&&define.amd?define([],s):i.CryptoJS=s()})(t,function(){var i=i||(function(s,r){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto),!n&&typeof Rp=="function")try{n=wp()}catch{}var a=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||(function(){function E(){}return function(_){var S;return E.prototype=_,S=new E,E.prototype=null,S}})(),l={},u=l.lib={},c=u.Base=(function(){return{extend:function(E){var _=o(this);return E&&_.mixIn(E),(!_.hasOwnProperty("init")||this.init===_.init)&&(_.init=function(){_.$super.init.apply(this,arguments)}),_.init.prototype=_,_.$super=this,_},create:function(){var E=this.extend();return E.init.apply(E,arguments),E},init:function(){},mixIn:function(E){for(var _ in E)E.hasOwnProperty(_)&&(this[_]=E[_]);E.hasOwnProperty("toString")&&(this.toString=E.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),h=u.WordArray=c.extend({init:function(E,_){E=this.words=E||[],_!=r?this.sigBytes=_:this.sigBytes=E.length*4},toString:function(E){return(E||d).stringify(this)},concat:function(E){var _=this.words,S=E.words,A=this.sigBytes,w=E.sigBytes;if(this.clamp(),A%4)for(var R=0;R<w;R++){var L=S[R>>>2]>>>24-R%4*8&255;_[A+R>>>2]|=L<<24-(A+R)%4*8}else for(var M=0;M<w;M+=4)_[A+M>>>2]=S[M>>>2];return this.sigBytes+=w,this},clamp:function(){var E=this.words,_=this.sigBytes;E[_>>>2]&=4294967295<<32-_%4*8,E.length=s.ceil(_/4)},clone:function(){var E=c.clone.call(this);return E.words=this.words.slice(0),E},random:function(E){for(var _=[],S=0;S<E;S+=4)_.push(a());return new h.init(_,E)}}),f=l.enc={},d=f.Hex={stringify:function(E){for(var _=E.words,S=E.sigBytes,A=[],w=0;w<S;w++){var R=_[w>>>2]>>>24-w%4*8&255;A.push((R>>>4).toString(16)),A.push((R&15).toString(16))}return A.join("")},parse:function(E){for(var _=E.length,S=[],A=0;A<_;A+=2)S[A>>>3]|=parseInt(E.substr(A,2),16)<<24-A%8*4;return new h.init(S,_/2)}},p=f.Latin1={stringify:function(E){for(var _=E.words,S=E.sigBytes,A=[],w=0;w<S;w++){var R=_[w>>>2]>>>24-w%4*8&255;A.push(String.fromCharCode(R))}return A.join("")},parse:function(E){for(var _=E.length,S=[],A=0;A<_;A++)S[A>>>2]|=(E.charCodeAt(A)&255)<<24-A%4*8;return new h.init(S,_)}},m=f.Utf8={stringify:function(E){try{return decodeURIComponent(escape(p.stringify(E)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(E){return p.parse(unescape(encodeURIComponent(E)))}},g=u.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(E){typeof E=="string"&&(E=m.parse(E)),this._data.concat(E),this._nDataBytes+=E.sigBytes},_process:function(E){var _,S=this._data,A=S.words,w=S.sigBytes,R=this.blockSize,L=R*4,M=w/L;E?M=s.ceil(M):M=s.max((M|0)-this._minBufferSize,0);var B=M*R,q=s.min(B*4,w);if(B){for(var H=0;H<B;H+=R)this._doProcessBlock(A,H);_=A.splice(0,B),S.sigBytes-=q}return new h.init(_,q)},clone:function(){var E=c.clone.call(this);return E._data=this._data.clone(),E},_minBufferSize:0}),b=u.Hasher=g.extend({cfg:c.extend(),init:function(E){this.cfg=this.cfg.extend(E),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(E){return this._append(E),this._process(),this},finalize:function(E){E&&this._append(E);var _=this._doFinalize();return _},blockSize:512/32,_createHelper:function(E){return function(_,S){return new E.init(S).finalize(_)}},_createHmacHelper:function(E){return function(_,S){return new y.HMAC.init(E,S).finalize(_)}}}),y=l.algo={};return l})(Math);return i})}),ga=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(s){var r=i,n=r.lib,a=n.Base,o=n.WordArray,l=r.x64={},u=l.Word=a.extend({init:function(h,f){this.high=h,this.low=f}}),c=l.WordArray=a.extend({init:function(h,f){h=this.words=h||[],f!=s?this.sigBytes=f:this.sigBytes=h.length*8},toX32:function(){for(var h=this.words,f=h.length,d=[],p=0;p<f;p++){var m=h[p];d.push(m.high),d.push(m.low)}return o.create(d,this.sigBytes)},clone:function(){for(var h=a.clone.call(this),f=h.words=this.words.slice(0),d=f.length,p=0;p<d;p++)f[p]=f[p].clone();return h}})})(),i})}),Cp=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(){if(typeof ArrayBuffer=="function"){var s=i,r=s.lib,n=r.WordArray,a=n.init,o=n.init=function(l){if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),l instanceof Uint8Array){for(var u=l.byteLength,c=[],h=0;h<u;h++)c[h>>>2]|=l[h]<<24-h%4*8;a.call(this,c,u)}else a.apply(this,arguments)};o.prototype=n}})(),i.lib.WordArray})}),Np=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.WordArray,a=s.enc,o=a.Utf16=a.Utf16BE={stringify:function(u){for(var c=u.words,h=u.sigBytes,f=[],d=0;d<h;d+=2){var p=c[d>>>2]>>>16-d%4*8&65535;f.push(String.fromCharCode(p))}return f.join("")},parse:function(u){for(var c=u.length,h=[],f=0;f<c;f++)h[f>>>1]|=u.charCodeAt(f)<<16-f%2*16;return n.create(h,c*2)}};a.Utf16LE={stringify:function(u){for(var c=u.words,h=u.sigBytes,f=[],d=0;d<h;d+=2){var p=l(c[d>>>2]>>>16-d%4*8&65535);f.push(String.fromCharCode(p))}return f.join("")},parse:function(u){for(var c=u.length,h=[],f=0;f<c;f++)h[f>>>1]|=l(u.charCodeAt(f)<<16-f%2*16);return n.create(h,c*2)}};function l(u){return u<<8&4278255360|u>>>8&16711935}})(),i.enc.Utf16})}),Cs=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.WordArray,a=s.enc,o=a.Base64={stringify:function(u){var c=u.words,h=u.sigBytes,f=this._map;u.clamp();for(var d=[],p=0;p<h;p+=3)for(var m=c[p>>>2]>>>24-p%4*8&255,g=c[p+1>>>2]>>>24-(p+1)%4*8&255,b=c[p+2>>>2]>>>24-(p+2)%4*8&255,y=m<<16|g<<8|b,E=0;E<4&&p+E*.75<h;E++)d.push(f.charAt(y>>>6*(3-E)&63));var _=f.charAt(64);if(_)for(;d.length%4;)d.push(_);return d.join("")},parse:function(u){var c=u.length,h=this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var d=0;d<h.length;d++)f[h.charCodeAt(d)]=d}var p=h.charAt(64);if(p){var m=u.indexOf(p);m!==-1&&(c=m)}return l(u,c,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(u,c,h){for(var f=[],d=0,p=0;p<c;p++)if(p%4){var m=h[u.charCodeAt(p-1)]<<p%4*2,g=h[u.charCodeAt(p)]>>>6-p%4*2,b=m|g;f[d>>>2]|=b<<24-d%4*8,d++}return n.create(f,d)}})(),i.enc.Base64})}),Pp=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.WordArray,a=s.enc,o=a.Base64url={stringify:function(u,c){c===void 0&&(c=!0);var h=u.words,f=u.sigBytes,d=c?this._safe_map:this._map;u.clamp();for(var p=[],m=0;m<f;m+=3)for(var g=h[m>>>2]>>>24-m%4*8&255,b=h[m+1>>>2]>>>24-(m+1)%4*8&255,y=h[m+2>>>2]>>>24-(m+2)%4*8&255,E=g<<16|b<<8|y,_=0;_<4&&m+_*.75<f;_++)p.push(d.charAt(E>>>6*(3-_)&63));var S=d.charAt(64);if(S)for(;p.length%4;)p.push(S);return p.join("")},parse:function(u,c){c===void 0&&(c=!0);var h=u.length,f=c?this._safe_map:this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var p=0;p<f.length;p++)d[f.charCodeAt(p)]=p}var m=f.charAt(64);if(m){var g=u.indexOf(m);g!==-1&&(h=g)}return l(u,h,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(u,c,h){for(var f=[],d=0,p=0;p<c;p++)if(p%4){var m=h[u.charCodeAt(p-1)]<<p%4*2,g=h[u.charCodeAt(p)]>>>6-p%4*2,b=m|g;f[d>>>2]|=b<<24-d%4*8,d++}return n.create(f,d)}})(),i.enc.Base64url})}),Ns=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(s){var r=i,n=r.lib,a=n.WordArray,o=n.Hasher,l=r.algo,u=[];(function(){for(var m=0;m<64;m++)u[m]=s.abs(s.sin(m+1))*4294967296|0})();var c=l.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,g){for(var b=0;b<16;b++){var y=g+b,E=m[y];m[y]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360}var _=this._hash.words,S=m[g+0],A=m[g+1],w=m[g+2],R=m[g+3],L=m[g+4],M=m[g+5],B=m[g+6],q=m[g+7],H=m[g+8],V=m[g+9],W=m[g+10],v=m[g+11],j=m[g+12],O=m[g+13],x=m[g+14],k=m[g+15],F=_[0],P=_[1],z=_[2],Y=_[3];F=h(F,P,z,Y,S,7,u[0]),Y=h(Y,F,P,z,A,12,u[1]),z=h(z,Y,F,P,w,17,u[2]),P=h(P,z,Y,F,R,22,u[3]),F=h(F,P,z,Y,L,7,u[4]),Y=h(Y,F,P,z,M,12,u[5]),z=h(z,Y,F,P,B,17,u[6]),P=h(P,z,Y,F,q,22,u[7]),F=h(F,P,z,Y,H,7,u[8]),Y=h(Y,F,P,z,V,12,u[9]),z=h(z,Y,F,P,W,17,u[10]),P=h(P,z,Y,F,v,22,u[11]),F=h(F,P,z,Y,j,7,u[12]),Y=h(Y,F,P,z,O,12,u[13]),z=h(z,Y,F,P,x,17,u[14]),P=h(P,z,Y,F,k,22,u[15]),F=f(F,P,z,Y,A,5,u[16]),Y=f(Y,F,P,z,B,9,u[17]),z=f(z,Y,F,P,v,14,u[18]),P=f(P,z,Y,F,S,20,u[19]),F=f(F,P,z,Y,M,5,u[20]),Y=f(Y,F,P,z,W,9,u[21]),z=f(z,Y,F,P,k,14,u[22]),P=f(P,z,Y,F,L,20,u[23]),F=f(F,P,z,Y,V,5,u[24]),Y=f(Y,F,P,z,x,9,u[25]),z=f(z,Y,F,P,R,14,u[26]),P=f(P,z,Y,F,H,20,u[27]),F=f(F,P,z,Y,O,5,u[28]),Y=f(Y,F,P,z,w,9,u[29]),z=f(z,Y,F,P,q,14,u[30]),P=f(P,z,Y,F,j,20,u[31]),F=d(F,P,z,Y,M,4,u[32]),Y=d(Y,F,P,z,H,11,u[33]),z=d(z,Y,F,P,v,16,u[34]),P=d(P,z,Y,F,x,23,u[35]),F=d(F,P,z,Y,A,4,u[36]),Y=d(Y,F,P,z,L,11,u[37]),z=d(z,Y,F,P,q,16,u[38]),P=d(P,z,Y,F,W,23,u[39]),F=d(F,P,z,Y,O,4,u[40]),Y=d(Y,F,P,z,S,11,u[41]),z=d(z,Y,F,P,R,16,u[42]),P=d(P,z,Y,F,B,23,u[43]),F=d(F,P,z,Y,V,4,u[44]),Y=d(Y,F,P,z,j,11,u[45]),z=d(z,Y,F,P,k,16,u[46]),P=d(P,z,Y,F,w,23,u[47]),F=p(F,P,z,Y,S,6,u[48]),Y=p(Y,F,P,z,q,10,u[49]),z=p(z,Y,F,P,x,15,u[50]),P=p(P,z,Y,F,M,21,u[51]),F=p(F,P,z,Y,j,6,u[52]),Y=p(Y,F,P,z,R,10,u[53]),z=p(z,Y,F,P,W,15,u[54]),P=p(P,z,Y,F,A,21,u[55]),F=p(F,P,z,Y,H,6,u[56]),Y=p(Y,F,P,z,k,10,u[57]),z=p(z,Y,F,P,B,15,u[58]),P=p(P,z,Y,F,O,21,u[59]),F=p(F,P,z,Y,L,6,u[60]),Y=p(Y,F,P,z,v,10,u[61]),z=p(z,Y,F,P,w,15,u[62]),P=p(P,z,Y,F,V,21,u[63]),_[0]=_[0]+F|0,_[1]=_[1]+P|0,_[2]=_[2]+z|0,_[3]=_[3]+Y|0},_doFinalize:function(){var m=this._data,g=m.words,b=this._nDataBytes*8,y=m.sigBytes*8;g[y>>>5]|=128<<24-y%32;var E=s.floor(b/4294967296),_=b;g[(y+64>>>9<<4)+15]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,g[(y+64>>>9<<4)+14]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,m.sigBytes=(g.length+1)*4,this._process();for(var S=this._hash,A=S.words,w=0;w<4;w++){var R=A[w];A[w]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return S},clone:function(){var m=o.clone.call(this);return m._hash=this._hash.clone(),m}});function h(m,g,b,y,E,_,S){var A=m+(g&b|~g&y)+E+S;return(A<<_|A>>>32-_)+g}function f(m,g,b,y,E,_,S){var A=m+(g&y|b&~y)+E+S;return(A<<_|A>>>32-_)+g}function d(m,g,b,y,E,_,S){var A=m+(g^b^y)+E+S;return(A<<_|A>>>32-_)+g}function p(m,g,b,y,E,_,S){var A=m+(b^(g|~y))+E+S;return(A<<_|A>>>32-_)+g}r.MD5=o._createHelper(c),r.HmacMD5=o._createHmacHelper(c)})(Math),i.MD5})}),Ru=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.WordArray,a=r.Hasher,o=s.algo,l=[],u=o.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,h){for(var f=this._hash.words,d=f[0],p=f[1],m=f[2],g=f[3],b=f[4],y=0;y<80;y++){if(y<16)l[y]=c[h+y]|0;else{var E=l[y-3]^l[y-8]^l[y-14]^l[y-16];l[y]=E<<1|E>>>31}var _=(d<<5|d>>>27)+b+l[y];y<20?_+=(p&m|~p&g)+1518500249:y<40?_+=(p^m^g)+1859775393:y<60?_+=(p&m|p&g|m&g)-1894007588:_+=(p^m^g)-899497514,b=g,g=m,m=p<<30|p>>>2,p=d,d=_}f[0]=f[0]+d|0,f[1]=f[1]+p|0,f[2]=f[2]+m|0,f[3]=f[3]+g|0,f[4]=f[4]+b|0},_doFinalize:function(){var c=this._data,h=c.words,f=this._nDataBytes*8,d=c.sigBytes*8;return h[d>>>5]|=128<<24-d%32,h[(d+64>>>9<<4)+14]=Math.floor(f/4294967296),h[(d+64>>>9<<4)+15]=f,c.sigBytes=h.length*4,this._process(),this._hash},clone:function(){var c=a.clone.call(this);return c._hash=this._hash.clone(),c}});s.SHA1=a._createHelper(u),s.HmacSHA1=a._createHmacHelper(u)})(),i.SHA1})}),Co=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(s){var r=i,n=r.lib,a=n.WordArray,o=n.Hasher,l=r.algo,u=[],c=[];(function(){function d(b){for(var y=s.sqrt(b),E=2;E<=y;E++)if(!(b%E))return!1;return!0}function p(b){return(b-(b|0))*4294967296|0}for(var m=2,g=0;g<64;)d(m)&&(g<8&&(u[g]=p(s.pow(m,1/2))),c[g]=p(s.pow(m,1/3)),g++),m++})();var h=[],f=l.SHA256=o.extend({_doReset:function(){this._hash=new a.init(u.slice(0))},_doProcessBlock:function(d,p){for(var m=this._hash.words,g=m[0],b=m[1],y=m[2],E=m[3],_=m[4],S=m[5],A=m[6],w=m[7],R=0;R<64;R++){if(R<16)h[R]=d[p+R]|0;else{var L=h[R-15],M=(L<<25|L>>>7)^(L<<14|L>>>18)^L>>>3,B=h[R-2],q=(B<<15|B>>>17)^(B<<13|B>>>19)^B>>>10;h[R]=M+h[R-7]+q+h[R-16]}var H=_&S^~_&A,V=g&b^g&y^b&y,W=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),v=(_<<26|_>>>6)^(_<<21|_>>>11)^(_<<7|_>>>25),j=w+v+H+c[R]+h[R],O=W+V;w=A,A=S,S=_,_=E+j|0,E=y,y=b,b=g,g=j+O|0}m[0]=m[0]+g|0,m[1]=m[1]+b|0,m[2]=m[2]+y|0,m[3]=m[3]+E|0,m[4]=m[4]+_|0,m[5]=m[5]+S|0,m[6]=m[6]+A|0,m[7]=m[7]+w|0},_doFinalize:function(){var d=this._data,p=d.words,m=this._nDataBytes*8,g=d.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=s.floor(m/4294967296),p[(g+64>>>9<<4)+15]=m,d.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var d=o.clone.call(this);return d._hash=this._hash.clone(),d}});r.SHA256=o._createHelper(f),r.HmacSHA256=o._createHmacHelper(f)})(Math),i.SHA256})}),Lp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Co()):typeof define=="function"&&define.amd?define(["./core","./sha256"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.WordArray,a=s.algo,o=a.SHA256,l=a.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var u=o._doFinalize.call(this);return u.sigBytes-=4,u}});s.SHA224=o._createHelper(l),s.HmacSHA224=o._createHmacHelper(l)})(),i.SHA224})}),Du=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),ga()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.Hasher,a=s.x64,o=a.Word,l=a.WordArray,u=s.algo;function c(){return o.create.apply(o,arguments)}var h=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],f=[];(function(){for(var p=0;p<80;p++)f[p]=c()})();var d=u.SHA512=n.extend({_doReset:function(){this._hash=new l.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(p,m){for(var g=this._hash.words,b=g[0],y=g[1],E=g[2],_=g[3],S=g[4],A=g[5],w=g[6],R=g[7],L=b.high,M=b.low,B=y.high,q=y.low,H=E.high,V=E.low,W=_.high,v=_.low,j=S.high,O=S.low,x=A.high,k=A.low,F=w.high,P=w.low,z=R.high,Y=R.low,tt=L,it=M,nt=B,at=q,pt=H,ft=V,xt=W,gt=v,bt=j,Wt=O,ae=x,ce=k,Ct=F,Dt=P,cs=z,ge=Y,De=0;De<80;De++){var he,je,pi=f[De];if(De<16)je=pi.high=p[m+De*2]|0,he=pi.low=p[m+De*2+1]|0;else{var zi=f[De-15],fi=zi.high,ii=zi.low,br=(fi>>>1|ii<<31)^(fi>>>8|ii<<24)^fi>>>7,Bs=(ii>>>1|fi<<31)^(ii>>>8|fi<<24)^(ii>>>7|fi<<25),T=f[De-2],I=T.high,D=T.low,C=(I>>>19|D<<13)^(I<<3|D>>>29)^I>>>6,U=(D>>>19|I<<13)^(D<<3|I>>>29)^(D>>>6|I<<26),J=f[De-7],$=J.high,st=J.low,Et=f[De-16],It=Et.high,qt=Et.low;he=Bs+st,je=br+$+(he>>>0<Bs>>>0?1:0),he=he+U,je=je+C+(he>>>0<U>>>0?1:0),he=he+qt,je=je+It+(he>>>0<qt>>>0?1:0),pi.high=je,pi.low=he}var ue=bt&ae^~bt&Ct,be=Wt&ce^~Wt&Dt,wi=tt&nt^tt&pt^nt&pt,hs=it&at^it&ft^at&ft,ds=(tt>>>28|it<<4)^(tt<<30|it>>>2)^(tt<<25|it>>>7),mi=(it>>>28|tt<<4)^(it<<30|tt>>>2)^(it<<25|tt>>>7),si=(bt>>>14|Wt<<18)^(bt>>>18|Wt<<14)^(bt<<23|Wt>>>9),ri=(Wt>>>14|bt<<18)^(Wt>>>18|bt<<14)^(Wt<<23|bt>>>9),pl=h[De],Td=pl.high,fl=pl.low,Xe=ge+ri,Xi=cs+si+(Xe>>>0<ge>>>0?1:0),Xe=Xe+be,Xi=Xi+ue+(Xe>>>0<be>>>0?1:0),Xe=Xe+fl,Xi=Xi+Td+(Xe>>>0<fl>>>0?1:0),Xe=Xe+he,Xi=Xi+je+(Xe>>>0<he>>>0?1:0),ml=mi+hs,bd=ds+wi+(ml>>>0<mi>>>0?1:0);cs=Ct,ge=Dt,Ct=ae,Dt=ce,ae=bt,ce=Wt,Wt=gt+Xe|0,bt=xt+Xi+(Wt>>>0<gt>>>0?1:0)|0,xt=pt,gt=ft,pt=nt,ft=at,nt=tt,at=it,it=Xe+ml|0,tt=Xi+bd+(it>>>0<Xe>>>0?1:0)|0}M=b.low=M+it,b.high=L+tt+(M>>>0<it>>>0?1:0),q=y.low=q+at,y.high=B+nt+(q>>>0<at>>>0?1:0),V=E.low=V+ft,E.high=H+pt+(V>>>0<ft>>>0?1:0),v=_.low=v+gt,_.high=W+xt+(v>>>0<gt>>>0?1:0),O=S.low=O+Wt,S.high=j+bt+(O>>>0<Wt>>>0?1:0),k=A.low=k+ce,A.high=x+ae+(k>>>0<ce>>>0?1:0),P=w.low=P+Dt,w.high=F+Ct+(P>>>0<Dt>>>0?1:0),Y=R.low=Y+ge,R.high=z+cs+(Y>>>0<ge>>>0?1:0)},_doFinalize:function(){var p=this._data,m=p.words,g=this._nDataBytes*8,b=p.sigBytes*8;m[b>>>5]|=128<<24-b%32,m[(b+128>>>10<<5)+30]=Math.floor(g/4294967296),m[(b+128>>>10<<5)+31]=g,p.sigBytes=m.length*4,this._process();var y=this._hash.toX32();return y},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});s.SHA512=n._createHelper(d),s.HmacSHA512=n._createHmacHelper(d)})(),i.SHA512})}),vp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),ga(),Du()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./sha512"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.x64,n=r.Word,a=r.WordArray,o=s.algo,l=o.SHA512,u=o.SHA384=l.extend({_doReset:function(){this._hash=new a.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var c=l._doFinalize.call(this);return c.sigBytes-=16,c}});s.SHA384=l._createHelper(u),s.HmacSHA384=l._createHmacHelper(u)})(),i.SHA384})}),xp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),ga()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],s):s(i.CryptoJS)})(t,function(i){return(function(s){var r=i,n=r.lib,a=n.WordArray,o=n.Hasher,l=r.x64,u=l.Word,c=r.algo,h=[],f=[],d=[];(function(){for(var g=1,b=0,y=0;y<24;y++){h[g+5*b]=(y+1)*(y+2)/2%64;var E=b%5,_=(2*g+3*b)%5;g=E,b=_}for(var g=0;g<5;g++)for(var b=0;b<5;b++)f[g+5*b]=b+(2*g+3*b)%5*5;for(var S=1,A=0;A<24;A++){for(var w=0,R=0,L=0;L<7;L++){if(S&1){var M=(1<<L)-1;M<32?R^=1<<M:w^=1<<M-32}S&128?S=S<<1^113:S<<=1}d[A]=u.create(w,R)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=u.create()})();var m=c.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],b=0;b<25;b++)g[b]=new u.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,b){for(var y=this._state,E=this.blockSize/2,_=0;_<E;_++){var S=g[b+2*_],A=g[b+2*_+1];S=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,A=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360;var w=y[_];w.high^=A,w.low^=S}for(var R=0;R<24;R++){for(var L=0;L<5;L++){for(var M=0,B=0,q=0;q<5;q++){var w=y[L+5*q];M^=w.high,B^=w.low}var H=p[L];H.high=M,H.low=B}for(var L=0;L<5;L++)for(var V=p[(L+4)%5],W=p[(L+1)%5],v=W.high,j=W.low,M=V.high^(v<<1|j>>>31),B=V.low^(j<<1|v>>>31),q=0;q<5;q++){var w=y[L+5*q];w.high^=M,w.low^=B}for(var O=1;O<25;O++){var M,B,w=y[O],x=w.high,k=w.low,F=h[O];F<32?(M=x<<F|k>>>32-F,B=k<<F|x>>>32-F):(M=k<<F-32|x>>>64-F,B=x<<F-32|k>>>64-F);var P=p[f[O]];P.high=M,P.low=B}var z=p[0],Y=y[0];z.high=Y.high,z.low=Y.low;for(var L=0;L<5;L++)for(var q=0;q<5;q++){var O=L+5*q,w=y[O],tt=p[O],it=p[(L+1)%5+5*q],nt=p[(L+2)%5+5*q];w.high=tt.high^~it.high&nt.high,w.low=tt.low^~it.low&nt.low}var w=y[0],at=d[R];w.high^=at.high,w.low^=at.low}},_doFinalize:function(){var g=this._data,b=g.words,y=this._nDataBytes*8,E=g.sigBytes*8,_=this.blockSize*32;b[E>>>5]|=1<<24-E%32,b[(s.ceil((E+1)/_)*_>>>5)-1]|=128,g.sigBytes=b.length*4,this._process();for(var S=this._state,A=this.cfg.outputLength/8,w=A/8,R=[],L=0;L<w;L++){var M=S[L],B=M.high,q=M.low;B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,q=(q<<8|q>>>24)&16711935|(q<<24|q>>>8)&4278255360,R.push(q),R.push(B)}return new a.init(R,A)},clone:function(){for(var g=o.clone.call(this),b=g._state=this._state.slice(0),y=0;y<25;y++)b[y]=b[y].clone();return g}});r.SHA3=o._createHelper(m),r.HmacSHA3=o._createHmacHelper(m)})(Math),i.SHA3})}),Mp=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){return(function(s){var r=i,n=r.lib,a=n.WordArray,o=n.Hasher,l=r.algo,u=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),h=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=a.create([0,1518500249,1859775393,2400959708,2840853838]),p=a.create([1352829926,1548603684,1836072691,2053994217,0]),m=l.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(A,w){for(var R=0;R<16;R++){var L=w+R,M=A[L];A[L]=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360}var B=this._hash.words,q=d.words,H=p.words,V=u.words,W=c.words,v=h.words,j=f.words,O,x,k,F,P,z,Y,tt,it,nt;z=O=B[0],Y=x=B[1],tt=k=B[2],it=F=B[3],nt=P=B[4];for(var at,R=0;R<80;R+=1)at=O+A[w+V[R]]|0,R<16?at+=g(x,k,F)+q[0]:R<32?at+=b(x,k,F)+q[1]:R<48?at+=y(x,k,F)+q[2]:R<64?at+=E(x,k,F)+q[3]:at+=_(x,k,F)+q[4],at=at|0,at=S(at,v[R]),at=at+P|0,O=P,P=F,F=S(k,10),k=x,x=at,at=z+A[w+W[R]]|0,R<16?at+=_(Y,tt,it)+H[0]:R<32?at+=E(Y,tt,it)+H[1]:R<48?at+=y(Y,tt,it)+H[2]:R<64?at+=b(Y,tt,it)+H[3]:at+=g(Y,tt,it)+H[4],at=at|0,at=S(at,j[R]),at=at+nt|0,z=nt,nt=it,it=S(tt,10),tt=Y,Y=at;at=B[1]+k+it|0,B[1]=B[2]+F+nt|0,B[2]=B[3]+P+z|0,B[3]=B[4]+O+Y|0,B[4]=B[0]+x+tt|0,B[0]=at},_doFinalize:function(){var A=this._data,w=A.words,R=this._nDataBytes*8,L=A.sigBytes*8;w[L>>>5]|=128<<24-L%32,w[(L+64>>>9<<4)+14]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,A.sigBytes=(w.length+1)*4,this._process();for(var M=this._hash,B=M.words,q=0;q<5;q++){var H=B[q];B[q]=(H<<8|H>>>24)&16711935|(H<<24|H>>>8)&4278255360}return M},clone:function(){var A=o.clone.call(this);return A._hash=this._hash.clone(),A}});function g(A,w,R){return A^w^R}function b(A,w,R){return A&w|~A&R}function y(A,w,R){return(A|~w)^R}function E(A,w,R){return A&R|w&~R}function _(A,w,R){return A^(w|~R)}function S(A,w){return A<<w|A>>>32-w}r.RIPEMD160=o._createHelper(m),r.HmacRIPEMD160=o._createHmacHelper(m)})(Math),i.RIPEMD160})}),No=vt((t,e)=>{(function(i,s){typeof t=="object"?e.exports=t=s(kt()):typeof define=="function"&&define.amd?define(["./core"],s):s(i.CryptoJS)})(t,function(i){(function(){var s=i,r=s.lib,n=r.Base,a=s.enc,o=a.Utf8,l=s.algo,u=l.HMAC=n.extend({init:function(c,h){c=this._hasher=new c.init,typeof h=="string"&&(h=o.parse(h));var f=c.blockSize,d=f*4;h.sigBytes>d&&(h=c.finalize(h)),h.clamp();for(var p=this._oKey=h.clone(),m=this._iKey=h.clone(),g=p.words,b=m.words,y=0;y<f;y++)g[y]^=1549556828,b[y]^=909522486;p.sigBytes=m.sigBytes=d,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var h=this._hasher,f=h.finalize(c);h.reset();var d=h.finalize(this._oKey.clone().concat(f));return d}})})()})}),Bp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Co(),No()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.Base,a=r.WordArray,o=s.algo,l=o.SHA256,u=o.HMAC,c=o.PBKDF2=n.extend({cfg:n.extend({keySize:128/32,hasher:l,iterations:25e4}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,f){for(var d=this.cfg,p=u.create(d.hasher,h),m=a.create(),g=a.create([1]),b=m.words,y=g.words,E=d.keySize,_=d.iterations;b.length<E;){var S=p.update(f).finalize(g);p.reset();for(var A=S.words,w=A.length,R=S,L=1;L<_;L++){R=p.finalize(R),p.reset();for(var M=R.words,B=0;B<w;B++)A[B]^=M[B]}m.concat(S),y[0]++}return m.sigBytes=E*4,m}});s.PBKDF2=function(h,f,d){return c.create(d).compute(h,f)}})(),i.PBKDF2})}),os=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Ru(),No()):typeof define=="function"&&define.amd?define(["./core","./sha1","./hmac"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.Base,a=r.WordArray,o=s.algo,l=o.MD5,u=o.EvpKDF=n.extend({cfg:n.extend({keySize:128/32,hasher:l,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,h){for(var f,d=this.cfg,p=d.hasher.create(),m=a.create(),g=m.words,b=d.keySize,y=d.iterations;g.length<b;){f&&p.update(f),f=p.update(c).finalize(h),p.reset();for(var E=1;E<y;E++)f=p.finalize(f),p.reset();m.concat(f)}return m.sigBytes=b*4,m}});s.EvpKDF=function(c,h,f){return u.create(f).compute(c,h)}})(),i.EvpKDF})}),Re=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),os()):typeof define=="function"&&define.amd?define(["./core","./evpkdf"],s):s(i.CryptoJS)})(t,function(i){i.lib.Cipher||(function(s){var r=i,n=r.lib,a=n.Base,o=n.WordArray,l=n.BufferedBlockAlgorithm,u=r.enc,c=u.Utf8,h=u.Base64,f=r.algo,d=f.EvpKDF,p=n.Cipher=l.extend({cfg:a.extend(),createEncryptor:function(H,V){return this.create(this._ENC_XFORM_MODE,H,V)},createDecryptor:function(H,V){return this.create(this._DEC_XFORM_MODE,H,V)},init:function(H,V,W){this.cfg=this.cfg.extend(W),this._xformMode=H,this._key=V,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(H){return this._append(H),this._process()},finalize:function(H){H&&this._append(H);var V=this._doFinalize();return V},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function H(V){return typeof V=="string"?q:L}return function(V){return{encrypt:function(W,v,j){return H(v).encrypt(V,W,v,j)},decrypt:function(W,v,j){return H(v).decrypt(V,W,v,j)}}}})()}),m=n.StreamCipher=p.extend({_doFinalize:function(){var H=this._process(!0);return H},blockSize:1}),g=r.mode={},b=n.BlockCipherMode=a.extend({createEncryptor:function(H,V){return this.Encryptor.create(H,V)},createDecryptor:function(H,V){return this.Decryptor.create(H,V)},init:function(H,V){this._cipher=H,this._iv=V}}),y=g.CBC=(function(){var H=b.extend();H.Encryptor=H.extend({processBlock:function(W,v){var j=this._cipher,O=j.blockSize;V.call(this,W,v,O),j.encryptBlock(W,v),this._prevBlock=W.slice(v,v+O)}}),H.Decryptor=H.extend({processBlock:function(W,v){var j=this._cipher,O=j.blockSize,x=W.slice(v,v+O);j.decryptBlock(W,v),V.call(this,W,v,O),this._prevBlock=x}});function V(W,v,j){var O,x=this._iv;x?(O=x,this._iv=s):O=this._prevBlock;for(var k=0;k<j;k++)W[v+k]^=O[k]}return H})(),E=r.pad={},_=E.Pkcs7={pad:function(H,V){for(var W=V*4,v=W-H.sigBytes%W,j=v<<24|v<<16|v<<8|v,O=[],x=0;x<v;x+=4)O.push(j);var k=o.create(O,v);H.concat(k)},unpad:function(H){var V=H.words[H.sigBytes-1>>>2]&255;H.sigBytes-=V}},S=n.BlockCipher=p.extend({cfg:p.cfg.extend({mode:y,padding:_}),reset:function(){var H;p.reset.call(this);var V=this.cfg,W=V.iv,v=V.mode;this._xformMode==this._ENC_XFORM_MODE?H=v.createEncryptor:(H=v.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==H?this._mode.init(this,W&&W.words):(this._mode=H.call(v,this,W&&W.words),this._mode.__creator=H)},_doProcessBlock:function(H,V){this._mode.processBlock(H,V)},_doFinalize:function(){var H,V=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(V.pad(this._data,this.blockSize),H=this._process(!0)):(H=this._process(!0),V.unpad(H)),H},blockSize:128/32}),A=n.CipherParams=a.extend({init:function(H){this.mixIn(H)},toString:function(H){return(H||this.formatter).stringify(this)}}),w=r.format={},R=w.OpenSSL={stringify:function(H){var V,W=H.ciphertext,v=H.salt;return v?V=o.create([1398893684,1701076831]).concat(v).concat(W):V=W,V.toString(h)},parse:function(H){var V,W=h.parse(H),v=W.words;return v[0]==1398893684&&v[1]==1701076831&&(V=o.create(v.slice(2,4)),v.splice(0,4),W.sigBytes-=16),A.create({ciphertext:W,salt:V})}},L=n.SerializableCipher=a.extend({cfg:a.extend({format:R}),encrypt:function(H,V,W,v){v=this.cfg.extend(v);var j=H.createEncryptor(W,v),O=j.finalize(V),x=j.cfg;return A.create({ciphertext:O,key:W,iv:x.iv,algorithm:H,mode:x.mode,padding:x.padding,blockSize:H.blockSize,formatter:v.format})},decrypt:function(H,V,W,v){v=this.cfg.extend(v),V=this._parse(V,v.format);var j=H.createDecryptor(W,v).finalize(V.ciphertext);return j},_parse:function(H,V){return typeof H=="string"?V.parse(H,this):H}}),M=r.kdf={},B=M.OpenSSL={execute:function(H,V,W,v,j){if(v||(v=o.random(64/8)),j)var O=d.create({keySize:V+W,hasher:j}).compute(H,v);else var O=d.create({keySize:V+W}).compute(H,v);var x=o.create(O.words.slice(V),W*4);return O.sigBytes=V*4,A.create({key:O,iv:x,salt:v})}},q=n.PasswordBasedCipher=L.extend({cfg:L.cfg.extend({kdf:B}),encrypt:function(H,V,W,v){v=this.cfg.extend(v);var j=v.kdf.execute(W,H.keySize,H.ivSize,v.salt,v.hasher);v.iv=j.iv;var O=L.encrypt.call(this,H,V,j.key,v);return O.mixIn(j),O},decrypt:function(H,V,W,v){v=this.cfg.extend(v),V=this._parse(V,v.format);var j=v.kdf.execute(W,H.keySize,H.ivSize,V.salt,v.hasher);v.iv=j.iv;var O=L.decrypt.call(this,H,V,j.key,v);return O}})})()})}),kp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.mode.CFB=(function(){var s=i.lib.BlockCipherMode.extend();s.Encryptor=s.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize;r.call(this,n,a,l,o),this._prevBlock=n.slice(a,a+l)}}),s.Decryptor=s.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,u=n.slice(a,a+l);r.call(this,n,a,l,o),this._prevBlock=u}});function r(n,a,o,l){var u,c=this._iv;c?(u=c.slice(0),this._iv=void 0):u=this._prevBlock,l.encryptBlock(u,0);for(var h=0;h<o;h++)n[a+h]^=u[h]}return s})(),i.mode.CFB})}),Fp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.mode.CTR=(function(){var s=i.lib.BlockCipherMode.extend(),r=s.Encryptor=s.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,u=this._iv,c=this._counter;u&&(c=this._counter=u.slice(0),this._iv=void 0);var h=c.slice(0);o.encryptBlock(h,0),c[l-1]=c[l-1]+1|0;for(var f=0;f<l;f++)n[a+f]^=h[f]}});return s.Decryptor=r,s})(),i.mode.CTR})}),Up=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.mode.CTRGladman=(function(){var s=i.lib.BlockCipherMode.extend();function r(o){if((o>>24&255)===255){var l=o>>16&255,u=o>>8&255,c=o&255;l===255?(l=0,u===255?(u=0,c===255?c=0:++c):++u):++l,o=0,o+=l<<16,o+=u<<8,o+=c}else o+=1<<24;return o}function n(o){return(o[0]=r(o[0]))===0&&(o[1]=r(o[1])),o}var a=s.Encryptor=s.extend({processBlock:function(o,l){var u=this._cipher,c=u.blockSize,h=this._iv,f=this._counter;h&&(f=this._counter=h.slice(0),this._iv=void 0),n(f);var d=f.slice(0);u.encryptBlock(d,0);for(var p=0;p<c;p++)o[l+p]^=d[p]}});return s.Decryptor=a,s})(),i.mode.CTRGladman})}),jp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.mode.OFB=(function(){var s=i.lib.BlockCipherMode.extend(),r=s.Encryptor=s.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,u=this._iv,c=this._keystream;u&&(c=this._keystream=u.slice(0),this._iv=void 0),o.encryptBlock(c,0);for(var h=0;h<l;h++)n[a+h]^=c[h]}});return s.Decryptor=r,s})(),i.mode.OFB})}),Gp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.mode.ECB=(function(){var s=i.lib.BlockCipherMode.extend();return s.Encryptor=s.extend({processBlock:function(r,n){this._cipher.encryptBlock(r,n)}}),s.Decryptor=s.extend({processBlock:function(r,n){this._cipher.decryptBlock(r,n)}}),s})(),i.mode.ECB})}),Hp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.pad.AnsiX923={pad:function(s,r){var n=s.sigBytes,a=r*4,o=a-n%a,l=n+o-1;s.clamp(),s.words[l>>>2]|=o<<24-l%4*8,s.sigBytes+=o},unpad:function(s){var r=s.words[s.sigBytes-1>>>2]&255;s.sigBytes-=r}},i.pad.Ansix923})}),Yp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.pad.Iso10126={pad:function(s,r){var n=r*4,a=n-s.sigBytes%n;s.concat(i.lib.WordArray.random(a-1)).concat(i.lib.WordArray.create([a<<24],1))},unpad:function(s){var r=s.words[s.sigBytes-1>>>2]&255;s.sigBytes-=r}},i.pad.Iso10126})}),Vp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.pad.Iso97971={pad:function(s,r){s.concat(i.lib.WordArray.create([2147483648],1)),i.pad.ZeroPadding.pad(s,r)},unpad:function(s){i.pad.ZeroPadding.unpad(s),s.sigBytes--}},i.pad.Iso97971})}),zp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.pad.ZeroPadding={pad:function(s,r){var n=r*4;s.clamp(),s.sigBytes+=n-(s.sigBytes%n||n)},unpad:function(s){for(var r=s.words,n=s.sigBytes-1,n=s.sigBytes-1;n>=0;n--)if(r[n>>>2]>>>24-n%4*8&255){s.sigBytes=n+1;break}}},i.pad.ZeroPadding})}),Xp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return i.pad.NoPadding={pad:function(){},unpad:function(){}},i.pad.NoPadding})}),qp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Re()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(s){var r=i,n=r.lib,a=n.CipherParams,o=r.enc,l=o.Hex,u=r.format,c=u.Hex={stringify:function(h){return h.ciphertext.toString(l)},parse:function(h){var f=l.parse(h);return a.create({ciphertext:f})}}})(),i.format.Hex})}),Wp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Cs(),Ns(),os(),Re()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.BlockCipher,a=s.algo,o=[],l=[],u=[],c=[],h=[],f=[],d=[],p=[],m=[],g=[];(function(){for(var E=[],_=0;_<256;_++)_<128?E[_]=_<<1:E[_]=_<<1^283;for(var S=0,A=0,_=0;_<256;_++){var w=A^A<<1^A<<2^A<<3^A<<4;w=w>>>8^w&255^99,o[S]=w,l[w]=S;var R=E[S],L=E[R],M=E[L],B=E[w]*257^w*16843008;u[S]=B<<24|B>>>8,c[S]=B<<16|B>>>16,h[S]=B<<8|B>>>24,f[S]=B;var B=M*16843009^L*65537^R*257^S*16843008;d[w]=B<<24|B>>>8,p[w]=B<<16|B>>>16,m[w]=B<<8|B>>>24,g[w]=B,S?(S=R^E[E[E[M^R]]],A^=E[E[A]]):S=A=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],y=a.AES=n.extend({_doReset:function(){var E;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var _=this._keyPriorReset=this._key,S=_.words,A=_.sigBytes/4,w=this._nRounds=A+6,R=(w+1)*4,L=this._keySchedule=[],M=0;M<R;M++)M<A?L[M]=S[M]:(E=L[M-1],M%A?A>6&&M%A==4&&(E=o[E>>>24]<<24|o[E>>>16&255]<<16|o[E>>>8&255]<<8|o[E&255]):(E=E<<8|E>>>24,E=o[E>>>24]<<24|o[E>>>16&255]<<16|o[E>>>8&255]<<8|o[E&255],E^=b[M/A|0]<<24),L[M]=L[M-A]^E);for(var B=this._invKeySchedule=[],q=0;q<R;q++){var M=R-q;if(q%4)var E=L[M];else var E=L[M-4];q<4||M<=4?B[q]=E:B[q]=d[o[E>>>24]]^p[o[E>>>16&255]]^m[o[E>>>8&255]]^g[o[E&255]]}}},encryptBlock:function(E,_){this._doCryptBlock(E,_,this._keySchedule,u,c,h,f,o)},decryptBlock:function(E,_){var S=E[_+1];E[_+1]=E[_+3],E[_+3]=S,this._doCryptBlock(E,_,this._invKeySchedule,d,p,m,g,l);var S=E[_+1];E[_+1]=E[_+3],E[_+3]=S},_doCryptBlock:function(E,_,S,A,w,R,L,M){for(var B=this._nRounds,q=E[_]^S[0],H=E[_+1]^S[1],V=E[_+2]^S[2],W=E[_+3]^S[3],v=4,j=1;j<B;j++){var O=A[q>>>24]^w[H>>>16&255]^R[V>>>8&255]^L[W&255]^S[v++],x=A[H>>>24]^w[V>>>16&255]^R[W>>>8&255]^L[q&255]^S[v++],k=A[V>>>24]^w[W>>>16&255]^R[q>>>8&255]^L[H&255]^S[v++],F=A[W>>>24]^w[q>>>16&255]^R[H>>>8&255]^L[V&255]^S[v++];q=O,H=x,V=k,W=F}var O=(M[q>>>24]<<24|M[H>>>16&255]<<16|M[V>>>8&255]<<8|M[W&255])^S[v++],x=(M[H>>>24]<<24|M[V>>>16&255]<<16|M[W>>>8&255]<<8|M[q&255])^S[v++],k=(M[V>>>24]<<24|M[W>>>16&255]<<16|M[q>>>8&255]<<8|M[H&255])^S[v++],F=(M[W>>>24]<<24|M[q>>>16&255]<<16|M[H>>>8&255]<<8|M[V&255])^S[v++];E[_]=O,E[_+1]=x,E[_+2]=k,E[_+3]=F},keySize:256/32});s.AES=n._createHelper(y)})(),i.AES})}),Jp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Cs(),Ns(),os(),Re()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.WordArray,a=r.BlockCipher,o=s.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],u=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=o.DES=a.extend({_doReset:function(){for(var b=this._key,y=b.words,E=[],_=0;_<56;_++){var S=l[_]-1;E[_]=y[S>>>5]>>>31-S%32&1}for(var A=this._subKeys=[],w=0;w<16;w++){for(var R=A[w]=[],L=c[w],_=0;_<24;_++)R[_/6|0]|=E[(u[_]-1+L)%28]<<31-_%6,R[4+(_/6|0)]|=E[28+(u[_+24]-1+L)%28]<<31-_%6;R[0]=R[0]<<1|R[0]>>>31;for(var _=1;_<7;_++)R[_]=R[_]>>>(_-1)*4+3;R[7]=R[7]<<5|R[7]>>>27}for(var M=this._invSubKeys=[],_=0;_<16;_++)M[_]=A[15-_]},encryptBlock:function(b,y){this._doCryptBlock(b,y,this._subKeys)},decryptBlock:function(b,y){this._doCryptBlock(b,y,this._invSubKeys)},_doCryptBlock:function(b,y,E){this._lBlock=b[y],this._rBlock=b[y+1],p.call(this,4,252645135),p.call(this,16,65535),m.call(this,2,858993459),m.call(this,8,16711935),p.call(this,1,1431655765);for(var _=0;_<16;_++){for(var S=E[_],A=this._lBlock,w=this._rBlock,R=0,L=0;L<8;L++)R|=h[L][((w^S[L])&f[L])>>>0];this._lBlock=w,this._rBlock=A^R}var M=this._lBlock;this._lBlock=this._rBlock,this._rBlock=M,p.call(this,1,1431655765),m.call(this,8,16711935),m.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),b[y]=this._lBlock,b[y+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(b,y){var E=(this._lBlock>>>b^this._rBlock)&y;this._rBlock^=E,this._lBlock^=E<<b}function m(b,y){var E=(this._rBlock>>>b^this._lBlock)&y;this._lBlock^=E,this._rBlock^=E<<b}s.DES=a._createHelper(d);var g=o.TripleDES=a.extend({_doReset:function(){var b=this._key,y=b.words;if(y.length!==2&&y.length!==4&&y.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var E=y.slice(0,2),_=y.length<4?y.slice(0,2):y.slice(2,4),S=y.length<6?y.slice(0,2):y.slice(4,6);this._des1=d.createEncryptor(n.create(E)),this._des2=d.createEncryptor(n.create(_)),this._des3=d.createEncryptor(n.create(S))},encryptBlock:function(b,y){this._des1.encryptBlock(b,y),this._des2.decryptBlock(b,y),this._des3.encryptBlock(b,y)},decryptBlock:function(b,y){this._des3.decryptBlock(b,y),this._des2.encryptBlock(b,y),this._des1.decryptBlock(b,y)},keySize:192/32,ivSize:64/32,blockSize:64/32});s.TripleDES=a._createHelper(g)})(),i.TripleDES})}),Kp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Cs(),Ns(),os(),Re()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.StreamCipher,a=s.algo,o=a.RC4=n.extend({_doReset:function(){for(var c=this._key,h=c.words,f=c.sigBytes,d=this._S=[],p=0;p<256;p++)d[p]=p;for(var p=0,m=0;p<256;p++){var g=p%f,b=h[g>>>2]>>>24-g%4*8&255;m=(m+d[p]+b)%256;var y=d[p];d[p]=d[m],d[m]=y}this._i=this._j=0},_doProcessBlock:function(c,h){c[h]^=l.call(this)},keySize:256/32,ivSize:0});function l(){for(var c=this._S,h=this._i,f=this._j,d=0,p=0;p<4;p++){h=(h+1)%256,f=(f+c[h])%256;var m=c[h];c[h]=c[f],c[f]=m,d|=c[(c[h]+c[f])%256]<<24-p*8}return this._i=h,this._j=f,d}s.RC4=n._createHelper(o);var u=a.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var c=this.cfg.drop;c>0;c--)l.call(this)}});s.RC4Drop=n._createHelper(u)})(),i.RC4})}),$p=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Cs(),Ns(),os(),Re()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.StreamCipher,a=s.algo,o=[],l=[],u=[],c=a.Rabbit=n.extend({_doReset:function(){for(var f=this._key.words,d=this.cfg.iv,p=0;p<4;p++)f[p]=(f[p]<<8|f[p]>>>24)&16711935|(f[p]<<24|f[p]>>>8)&4278255360;var m=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],g=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var p=0;p<4;p++)h.call(this);for(var p=0;p<8;p++)g[p]^=m[p+4&7];if(d){var b=d.words,y=b[0],E=b[1],_=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,A=_>>>16|S&4294901760,w=S<<16|_&65535;g[0]^=_,g[1]^=A,g[2]^=S,g[3]^=w,g[4]^=_,g[5]^=A,g[6]^=S,g[7]^=w;for(var p=0;p<4;p++)h.call(this)}},_doProcessBlock:function(f,d){var p=this._X;h.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var m=0;m<4;m++)o[m]=(o[m]<<8|o[m]>>>24)&16711935|(o[m]<<24|o[m]>>>8)&4278255360,f[d+m]^=o[m]},blockSize:128/32,ivSize:64/32});function h(){for(var f=this._X,d=this._C,p=0;p<8;p++)l[p]=d[p];d[0]=d[0]+1295307597+this._b|0,d[1]=d[1]+3545052371+(d[0]>>>0<l[0]>>>0?1:0)|0,d[2]=d[2]+886263092+(d[1]>>>0<l[1]>>>0?1:0)|0,d[3]=d[3]+1295307597+(d[2]>>>0<l[2]>>>0?1:0)|0,d[4]=d[4]+3545052371+(d[3]>>>0<l[3]>>>0?1:0)|0,d[5]=d[5]+886263092+(d[4]>>>0<l[4]>>>0?1:0)|0,d[6]=d[6]+1295307597+(d[5]>>>0<l[5]>>>0?1:0)|0,d[7]=d[7]+3545052371+(d[6]>>>0<l[6]>>>0?1:0)|0,this._b=d[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var m=f[p]+d[p],g=m&65535,b=m>>>16,y=((g*g>>>17)+g*b>>>15)+b*b,E=((m&4294901760)*m|0)+((m&65535)*m|0);u[p]=y^E}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}s.Rabbit=n._createHelper(c)})(),i.Rabbit})}),Zp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Cs(),Ns(),os(),Re()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.StreamCipher,a=s.algo,o=[],l=[],u=[],c=a.RabbitLegacy=n.extend({_doReset:function(){var f=this._key.words,d=this.cfg.iv,p=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],m=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var g=0;g<4;g++)h.call(this);for(var g=0;g<8;g++)m[g]^=p[g+4&7];if(d){var b=d.words,y=b[0],E=b[1],_=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,S=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,A=_>>>16|S&4294901760,w=S<<16|_&65535;m[0]^=_,m[1]^=A,m[2]^=S,m[3]^=w,m[4]^=_,m[5]^=A,m[6]^=S,m[7]^=w;for(var g=0;g<4;g++)h.call(this)}},_doProcessBlock:function(f,d){var p=this._X;h.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var m=0;m<4;m++)o[m]=(o[m]<<8|o[m]>>>24)&16711935|(o[m]<<24|o[m]>>>8)&4278255360,f[d+m]^=o[m]},blockSize:128/32,ivSize:64/32});function h(){for(var f=this._X,d=this._C,p=0;p<8;p++)l[p]=d[p];d[0]=d[0]+1295307597+this._b|0,d[1]=d[1]+3545052371+(d[0]>>>0<l[0]>>>0?1:0)|0,d[2]=d[2]+886263092+(d[1]>>>0<l[1]>>>0?1:0)|0,d[3]=d[3]+1295307597+(d[2]>>>0<l[2]>>>0?1:0)|0,d[4]=d[4]+3545052371+(d[3]>>>0<l[3]>>>0?1:0)|0,d[5]=d[5]+886263092+(d[4]>>>0<l[4]>>>0?1:0)|0,d[6]=d[6]+1295307597+(d[5]>>>0<l[5]>>>0?1:0)|0,d[7]=d[7]+3545052371+(d[6]>>>0<l[6]>>>0?1:0)|0,this._b=d[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var m=f[p]+d[p],g=m&65535,b=m>>>16,y=((g*g>>>17)+g*b>>>15)+b*b,E=((m&4294901760)*m|0)+((m&65535)*m|0);u[p]=y^E}f[0]=u[0]+(u[7]<<16|u[7]>>>16)+(u[6]<<16|u[6]>>>16)|0,f[1]=u[1]+(u[0]<<8|u[0]>>>24)+u[7]|0,f[2]=u[2]+(u[1]<<16|u[1]>>>16)+(u[0]<<16|u[0]>>>16)|0,f[3]=u[3]+(u[2]<<8|u[2]>>>24)+u[1]|0,f[4]=u[4]+(u[3]<<16|u[3]>>>16)+(u[2]<<16|u[2]>>>16)|0,f[5]=u[5]+(u[4]<<8|u[4]>>>24)+u[3]|0,f[6]=u[6]+(u[5]<<16|u[5]>>>16)+(u[4]<<16|u[4]>>>16)|0,f[7]=u[7]+(u[6]<<8|u[6]>>>24)+u[5]|0}s.RabbitLegacy=n._createHelper(c)})(),i.RabbitLegacy})}),Qp=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),Cs(),Ns(),os(),Re()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],s):s(i.CryptoJS)})(t,function(i){return(function(){var s=i,r=s.lib,n=r.BlockCipher,a=s.algo;let o=16,l=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],u=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var c={pbox:[],sbox:[]};function h(g,b){let y=b>>24&255,E=b>>16&255,_=b>>8&255,S=b&255,A=g.sbox[0][y]+g.sbox[1][E];return A=A^g.sbox[2][_],A=A+g.sbox[3][S],A}function f(g,b,y){let E=b,_=y,S;for(let A=0;A<o;++A)E=E^g.pbox[A],_=h(g,E)^_,S=E,E=_,_=S;return S=E,E=_,_=S,_=_^g.pbox[o],E=E^g.pbox[o+1],{left:E,right:_}}function d(g,b,y){let E=b,_=y,S;for(let A=o+1;A>1;--A)E=E^g.pbox[A],_=h(g,E)^_,S=E,E=_,_=S;return S=E,E=_,_=S,_=_^g.pbox[1],E=E^g.pbox[0],{left:E,right:_}}function p(g,b,y){for(let w=0;w<4;w++){g.sbox[w]=[];for(let R=0;R<256;R++)g.sbox[w][R]=u[w][R]}let E=0;for(let w=0;w<o+2;w++)g.pbox[w]=l[w]^b[E],E++,E>=y&&(E=0);let _=0,S=0,A=0;for(let w=0;w<o+2;w+=2)A=f(g,_,S),_=A.left,S=A.right,g.pbox[w]=_,g.pbox[w+1]=S;for(let w=0;w<4;w++)for(let R=0;R<256;R+=2)A=f(g,_,S),_=A.left,S=A.right,g.sbox[w][R]=_,g.sbox[w][R+1]=S;return!0}var m=a.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,b=g.words,y=g.sigBytes/4;p(c,b,y)}},encryptBlock:function(g,b){var y=f(c,g[b],g[b+1]);g[b]=y.left,g[b+1]=y.right},decryptBlock:function(g,b){var y=d(c,g[b],g[b+1]);g[b]=y.left,g[b+1]=y.right},blockSize:64/32,keySize:128/32,ivSize:64/32});s.Blowfish=n._createHelper(m)})(),i.Blowfish})}),tf=vt((t,e)=>{(function(i,s,r){typeof t=="object"?e.exports=t=s(kt(),ga(),Cp(),Np(),Cs(),Pp(),Ns(),Ru(),Co(),Lp(),Du(),vp(),xp(),Mp(),No(),Bp(),os(),Re(),kp(),Fp(),Up(),jp(),Gp(),Hp(),Yp(),Vp(),zp(),Xp(),qp(),Wp(),Jp(),Kp(),$p(),Zp(),Qp()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./enc-base64url","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy","./blowfish"],s):i.CryptoJS=s(i.CryptoJS)})(t,function(i){return i})}),ef=(t=>(t.Device="Device",t.Symbol="Symbol",t.Footprint="Footprint",t.OBJ="OBJ",t.ModelID="3D Model",t.ModelName="3D Model Title",t.OriginModelName="Origin 3D Model Title",t.ModelTransform="3D Model Transform",t.OriginFootprint="Origin Footprint",t))(ef||{}),Fr=(t=>(t.DOCHEAD="DOCHEAD",t.EDIT_HEAD="EDIT_HEAD",t.SCH="SCH",t.SCH_PAGE="SCH_PAGE",t.PCB="PCB",t.PANEL="PANEL",t.PANEL_LIB="PANEL_LIB",t.SYMBOL="SYMBOL",t.FOOTPRINT="FOOTPRINT",t.DEVICE="DEVICE",t.BLOB="BLOB",t.INSTANCE="INSTANCE",t.CONFIG="CONFIG",t.BOARD="BOARD",t.FONT="FONT",t.VARIANT="VARIANT",t.COMPONENT_GROUP="COMPONENT_GROUP",t.COMPONENT_GROUP_DATA="COMPONENT_GROUP_DATA",t.SIMULATION="SIMULATION",t))(Fr||{}),sf=(t=>(t.META="META",t.META_SORT="META_SORT",t.META_CREATE="META_CREATE",t.META_MODIFY="META_MODIFY",t.FONT="FONT",t.BLOB="BLOB",t.MAX_NUM="MAX_NUM",t.INSTANCE_ATTR="INSTANCE_ATTR",t.DELETE_DOC="DELETE_DOC",t.META_Z_INDEX="META_Z_INDEX",t.VARIANT_GROUPED="VARIANT_GROUPED",t.GROUP_INDEX="GROUP_INDEX",t.GROUP_DATA="GROUP_DATA",t.RULE_TEMPLATE="RULE_TEMPLATE",t.RULE="RULE",t.RULE_SELECTOR="RULE_SELECTOR",t.ELE_PLACEHOLDER="ELE_PLACEHOLDER",t.META_PLACEHOLDER="META_PLACEHOLDER",t))(sf||{}),li="||",ne=`|
`;function Ur(t,e,i){return t.slice(e,i)}function qn(t,e,i){let s=t.length,r=0;for(;r<s;){let n=t.indexOf(ne,r);if(n<0){if(i)return t.substring(r);n=s}let a=Ur(t,r,n);try{if(a){let o=a.indexOf(li),l=o>-1,u=l?Ur(a,0,o):a,c=l?Ur(a,o+li.length):"";if(e(u,c,a,l?r+o+li.length:r)===!1){a=null;break}a=null}}catch(o){console.error(o)}r=n+ne.length}t=null}var rf=["SYMBOL","FOOTPRINT","BLOB","FONT","PANEL_LIB","DEVICE","BOARD","INSTANCE","CONFIG","VARIANT","COMPONENT_GROUP","COMPONENT_GROUP_DATA"];function wa(t,e){return rf.includes(e)?e:t}var nf=class{parseFull(t,e,i){let s=e,r=i,n,a=null;qn(t,(o,l,u)=>{let c=JSON.parse(o);if(c.type==="EDIT_HEAD")a=JSON.parse(l),this.onEditHead&&this.onEditHead(a);else if(c.type==="DOCHEAD"){let h=JSON.parse(l);r=h.docType,s=h.uuid,n=h.client,h.ticket=c.ticket,this.onDocHead(h,a,u)}else this.onLine(c.id,c.ticket,l,c.type,c.client||n,r,s,c.firstTicket,c.pend,a,c.num,u)}),this.onEnd(),t=null}flowParseFull(t={}){let{cache:e,chunkLength:i=100*1024*1024,idsData:s,history:r}=t,n="",a=null,o,l=null,u=!0,c="",h=0,f=!1,d={},p=e?{}:void 0,m=y=>{p[y]===void 0&&(p[y]=-1),e(y,++p[y],d[y].data.join(ne)),d[y].data.length=0,d[y].size=0,d[y].data.push(d[y].head),d[y].size+=d[y].head.length},g=y=>{let E=wa(n,a);e&&(d[E].data.push(y),d[E].size+=(d[E].size?ne.length:0)+y.length,d[E].size+y.length>i&&m(E))},b=(y,E)=>qn(y,(_,S,A,w)=>{var L,M,B,q,H,V,W,v;let R=JSON.parse(_);if(R.type==="EDIT_HEAD")l=JSON.parse(S),(L=this.onEditHead)==null||L.call(this,l),(M=t.onEditHead)==null||M.call(t,l),f=!0;else if(R.type==="DOCHEAD"){let j=JSON.parse(S);a=j.docType,n=j.uuid,o=j.client,j.ticket=R.ticket,f||(l={uuid:j.uuid,username:(B=j==null?void 0:j.user)==null?void 0:B.username,nickname:(q=j==null?void 0:j.user)==null?void 0:q.nickname,updateTime:j==null?void 0:j.updateTime},(H=t.onEditHead)==null||H.call(t,l),f=!0),this.onDocHead(j,l,A);let O=wa(n,a);e&&!d[O]&&(d[O]={size:0,data:[],head:""}),e&&(d[O].head=A),g(A)}else{let j=R.num,O=R.client||o;if(s){let x=(v=(W=(V=s.ids)==null?void 0:V[n])==null?void 0:W[O])==null?void 0:v[R.id];if(!x||x[0]!==R.ticket)return;j=x[1],s.size-=1,delete s.ids[n][O][R.id]}if(r){let x=wa(n,a);e&&(r.dNum=(p==null?void 0:p[x])===void 0?0:(p==null?void 0:p[x])+1),r.start=e?d[x].size+ne.length+_.length+li.length:h+w}this.onLine(R.id,R.ticket,S,R.type,O,a,n,R.firstTicket,R.pend,l||(r==null?void 0:r.editHead),j,A,r),g(A)}},E);return{start:()=>{u=!0},end:()=>{if(c&&b(c,!1),e)for(let y in d)d[y].size&&d[y].data.length>1&&m(y),d[y]=null;u=!1,c="",n="",n=null,o="",l=null,this.onEnd()},update:y=>{if(!u)throw new Error("\u66F4\u65B0\u524D\u672A\u8C03\u7528 start \u65B9\u6CD5");let E=b(c+y,!0);h=h+c.length+y.length-((E==null?void 0:E.length)||0),c="",E&&(c=E)},docMap:p}}parseLine(t,e,i){let s=t.indexOf(li),r=s!==-1,n=r?Ur(t,0,s):t,a=r?Ur(t,s+li.length):"",o=JSON.parse(n);this.onLine(o.id,o.ticket,a,o.type,o.client,i,e,o.firstTicket,o.pend,void 0,o.num,t),t=null}onEditHead(t){}},Ca=new Uint8Array(8);function Be(){crypto.getRandomValues(Ca);let t="";for(let e=0;e<Ca.length;e++)t+=Ca[e].toString(16).padStart(2,"0");return t}function _s(t,e,i,s,r,n,a){let o={docType:t,client:e,uuid:i};return(s||s===0)&&(o.updateTime=s),(r||o.updateTime||o.updateTime===0)&&(o.version=r||String(s)),n&&(o.user=n),`${JSON.stringify({type:"DOCHEAD",ticket:a})}${li}${JSON.stringify(o)}`}function ze(t,e,i,s,r,n,a,o){let l={type:t,ticket:e,id:i};return n!==void 0&&(l.firstTicket=n),a!==void 0&&(l.pend=a),o!==void 0&&(l.num=o),r&&(l.client=r),`${JSON.stringify(l)}${li}${s}`}var wu=class extends nf{constructor(t){super(),this.unique=Be(),this.maxTicket=0,this.isPendChange=!0,this.isLocalChange=!0,this.cbArr=[],this.tempLocalIds={},this.client=t||Be()}onLine(t,e,i,s,r,n,a,o,l,u,c){this.remoteChange(e,r,a,t,i,s,n,void 0,o,l,u,void 0,void 0,c)}getUnique(){return this.unique}setUnique(t){this.unique=t}onDocHead(t,e){}onEnd(){}setIsPendChange(t){this.isPendChange=t}getIsPendChange(){return this.isPendChange}getMaxTicket(){return this.maxTicket}setMaxTicket(t,e){t&&(e||this.maxTicket<t)&&(this.maxTicket=t)}setIsLocalChange(t){this.isLocalChange=t}getIsLocalChange(){return this.isLocalChange}revoke(t,e,i,s,r,n,a,o,l,u,c){var h;if(!((h=this.tempLocalIds[t])!=null&&h[e]))return c?c(e,r,i,a,`${s}-1`,t,n,void 0,void 0,!0,u):this.cbArr.forEach(f=>f(t,e,i,a,`${s}-1`,r,void 0,n,void 0,void 0,void 0,u)),!0}getRandomUuid(){return Be()}getClient(){return this.client}onChange(t){this.cbArr.push(t)}localChange(t,e,i,s,r,n){let a=this.maxTicket+1;return this.tempLocalIds[t]||(this.tempLocalIds[t]={}),this.tempLocalIds[t][e]=[this.getClient(),a],this.remoteChange(a,this.client,t,e,i,s,r,!0,void 0,!0,void 0,this.unique,void 0,n),a}remoteChange(t,e,i,s,r,n,a,o,l,u,c,h,f,d){var y;this.setMaxTicket(t);let p=h===this.unique,m=o||p,g=(!m||m&&this.isLocalChange)&&(!f||f&&this.isPendChange),b=(y=this.tempLocalIds[i])==null?void 0:y[s];!o&&p?b?(g=!1,b[0]===e&&b[1]===t&&delete this.tempLocalIds[i][s]):g=!0:!o&&b&&(b[1]>t||b[1]===t&&b[0]>e?g=!1:delete this.tempLocalIds[i][s]),g&&this.cbArr.forEach(E=>E(i,s,r,n,e,t,l,u,void 0,f,h,d))}};var Po=/^(?:ie|e)(\d+)$/;function Hr(t){let e=t.match(Po);return e?Number(e[1]):null}function Pt(t){if(!t||typeof t!="string")return t;let e=t.match(/(?:ie|e)\d+/g);return e&&e.length===2&&e.join("")===t?e.join("-"):t}function _e(t){return t&&typeof t=="number"&&!isNaN(t)?-t:t}function af(t,e){let i=[];for(let s=0;s<t.length;s+=2){let r={x:t[s],y:e?_e(t[s+1]):t[s+1]};i.push(r)}return i}function Ve(t,e){return JSON.stringify([e,t])}function qi(t){try{let e=JSON.parse(t);return typeof e=="string"?t:e[1]}catch{return t}}var of=(t=>(t.META="META",t.CANVAS="CANVAS",t.GROUP="GROUP",t.POLY="POLY",t.STRING="STRING",t.AUX_LINE="AUXLINE",t.DIMENSION="DIMENSION",t.ELE_PLACEHOLDER="ELE_PLACEHOLDER",t))(of||{}),lf=(t=>(t.META="META",t.CANVAS="CANVAS",t.LAYER="LAYER",t.LAYER_PHYS="LAYER_PHYS",t.ACTIVE_LAYER="ACTIVE_LAYER",t.PARTITION="PARTITION",t.NET="NET",t.PRIMITIVE="PRIMITIVE",t.GROUP="GROUP",t.SILK_OPTS="SILK_OPTS",t.PREFERENCE="PREFERENCE",t.VIA="VIA",t.PAD="PAD",t.LINE="LINE",t.ARC="ARC",t.OBJ="OBJ",t.EQLEN_GRP="EQLEN_GRP",t.POLY="POLY",t.FILL="FILL",t.LAYER_FILL="LAYER_FILL",t.REGION="REGION",t.POUR="POUR",t.POURED="POURED",t.IMAGE="IMAGE",t.TEARDROP="TEARDROP",t.FPC_FILL="FPC_FILL",t.SHELL="SHELL",t.CREASE="CREASE",t.SHELLCUT="SHELLCUT",t.SHELL_ENTITY="SHELL_ENTITY",t.BOSS="BOSS",t.STRING="STRING",t.ATTR="ATTR",t.DIMENSION="DIMENSION",t.COMPONENT="COMPONENT",t.PAD_NET="PAD_NET",t.RULE_TEMPLATE="RULE_TEMPLATE",t.RULE="RULE",t.RULE_SELECTOR="RULE_SELECTOR",t.PANELIZE="PANELIZE",t.BOARD="BOARD",t.ELE_PLACEHOLDER="ELE_PLACEHOLDER",t))(lf||{}),uf=(t=>(t.META="META",t.CANVAS="CANVAS",t.GROUP="GROUP",t.ATTR="ATTR",t.LINE="LINE",t.WIRE="WIRE",t.BUS="BUS",t.TEXT="TEXT",t.POLY="POLY",t.CIRCLE="CIRCLE",t.ARC="ARC",t.BUSENTRY="BUSENTRY",t.RECT="RECT",t.MASK_REGION="MASK_REGION",t.PIN="PIN",t.OBJ="OBJ",t.COMPONENT="COMPONENT",t.PART="PART",t.ELLIPSE="ELLIPSE",t.BEZIER="BEZIER",t.TABLE="TABLE",t.ELE_PLACEHOLDER="ELE_PLACEHOLDER",t.NG_SETTING="NG_SETTING",t))(uf||{});var cf=["PARTITION","VIA","PAD","LINE","ARC","OBJ","POLY","FILL","REGION","POUR","POURED","IMAGE","TEARDROP","FPC_FILL","SHELL","CREASE","SHELLCUT","SHELL_ENTITY","BOSS","STRING","ATTR","DIMENSION","COMPONENT"];var hf=(t=>(t.SOLID="SOLID",t.SHORT_DASH="SHORT_DASH",t.DOT="DOT",t.DOT_DASH="DOT_DASH",t))(hf||{}),df=(t=>(t.PRINT="PRINT",t.COVER="COVER",t.PRINT_AND_COVER="PRINT&COVER",t))(df||{}),pf=(t=>(t.LEFT="LEFT",t.CENTER="CENTER",t.RIGHT="RIGHT",t))(pf||{}),ff=(t=>(t.TOP="TOP",t.MIDDLE="MIDDLE",t.BOTTOM="BOTTOM",t))(ff||{}),mf=(t=>(t.LEFT_BOTTOM="LEFT_BOTTOM",t.CENTER_BOTTOM="CENTER_BOTTOM",t.RIGHT_BOTTOM="RIGHT_BOTTOM",t.LEFT_MIDDLE="LEFT_MIDDLE",t.CENTER_MIDDLE="CENTER_MIDDLE",t.RIGHT_MIDDLE="RIGHT_MIDDLE",t.LEFT_TOP="LEFT_TOP",t.CENTER_TOP="CENTER_TOP",t.RIGHT_TOP="RIGHT_TOP",t))(mf||{}),gf=(t=>(t.NONE="NONE",t.SOLID="SOLID",t.GRID="GRID",t.HORIZONTAL_LINE="HORIZONTAL_LINE",t.VERTICAL_LINE="VERTICAL_LINE",t.RHOMBIC="RHOMBIC",t.LEFT_SLASH_LINE="LEFT_SLASH_LINE",t.RIGHT_SLASH_LINE="RIGHT_SLASH_LINE",t))(gf||{}),Ef=(t=>(t.NONE="NONE",t.CLOCK="CLOCK",t.INVERTED="INVERTED",t.INVERTED_CLOCK="INVERTED_CLOCK",t))(Ef||{}),yf=(t=>(t.NONE="NONE",t.GRID="GRID",t.OUTLETS="OUTLETS",t))(yf||{}),Tf=(t=>(t.NONE="NONE",t.PUSH="PUSH",t.SURROUND="SURROUND",t.OBSTRUCT="OBSTRUCT",t.SURROUND_AND_PUSH="SURROUND&PUSH",t))(Tf||{}),bf=(t=>(t.ELLIPSE="ELLIPSE",t.RECT="RECT",t.OVAL="OVAL",t.POLYGON="POLYGON",t))(bf||{}),_f=(t=>(t.ROUND="ROUND",t.RECT="RECT",t.SLOT="SLOT",t))(_f||{}),Sf=(t=>(t.SOLID="SOLID",t.GRID_LINE="GRID_LINE",t.HORIZONTAL_LINE="HORIZONTAL_LINE",t.VERTICAL_LINE="VERTICAL_LINE",t))(Sf||{}),If=(t=>(t.ALL="ALL",t.PAD="PAD",t.VIA="VIA",t))(If||{}),Af=(t=>(t.NONE="NONE",t.SINGLE="SINGLE",t.ALL="ALL",t))(Af||{}),Of=(t=>(t.OPTIMIZA_OPEN="OPTIMIZA_OPEN",t.OPTIMIZA_NONE="OPTIMIZA_NONE",t))(Of||{}),Rf=(t=>(t.OPTIMIZA_STRONG="OPTIMIZA_STRONG",t.OPTIMIZA_WEAK="OPTIMIZA_WEAK",t.OPTIMIZA_NONE="OPTIMIZA_NONE",t))(Rf||{}),Df=(t=>(t.L45="L45",t.L90="L90",t.L="L",t.R45="R45",t.R90="R90",t.R="R",t))(Df||{}),wf=(t=>(t.NORMAL="NORMAL",t.BLIND="BLIND",t.SUTURE="SUTURE",t))(wf||{}),Cf=(t=>(t.NORMAL="NORMAL",t.TEST="TEST",t.MARKER="MARKER",t))(Cf||{}),Nf=(t=>(t.DIVERGENCE="DIVERGENCE",t.DIRECT="DIRECT",t.NON_CONNECT="NON_CONNECT",t))(Nf||{}),Pf=(t=>(t.DOT="DOT",t.CENTER="CENT",t))(Pf||{}),Lf=(t=>(t.NORMAL="NORMAL",t.BOARD_OUTLINE="BOARD_OUTLINE",t))(Lf||{}),vf=(t=>(t.SOLID="SOLID",t.GRID="GRID",t.PLANE="PLANE",t))(vf||{}),xf=(t=>(t.PROHIBIT="PROHIBIT",t.CONSTRAINT="CONSTRAINT",t))(xf||{}),Mf=(t=>(t.COMPONENT="COMPONENT",t.VIA="VIA",t.TRACK="TRACK",t.FILL="FILL",t.COPPER="COPPER",t.PLANE="PLANE",t))(Mf||{}),Bf=(t=>(t.PI="Polyimide",t.FR4="FR4",t.STEEL_SHEET="Stainless Steel",t.M3_DOUBLE_SIDED_TAPE="3M Tape",t.EMI_SHIELDING_FILM="EMI Shielding Film",t))(Bf||{}),kf=(t=>(t.PUSH_COVER="DRAWER",t.UPPER_LOWER_SHELLS="T&B",t))(kf||{}),Ff=(t=>(t.X_AXIS_POSITIVE="X_AXIS_POSITIVE",t.X_AXIS_NEGATIVE="X_AXIS_NEGATIVE",t.Y_AXIS_POSITIVE="Y_AXIS_POSITIVE",t.Y_AXIS_NEGATIVE="Y_AXIS_NEGATIVE",t))(Ff||{}),Uf=(t=>(t.SLOT="SLOT",t.ENTITY="ENTITY",t))(Uf||{}),jf=(t=>(t.AUTO="AUTO",t.UPPER_SHELLS="UPPER_SHELLS",t.LOWER_SHELLS="LOWER_SHELLS",t))(jf||{}),Gf=(t=>(t.OUTLINE="OUTLINE",t.SCREW_PILLAR="SCREW_PILLAR",t.ENTITY="ENTITY",t))(Gf||{}),Hf=(t=>(t.M2="M2",t.M3="M3",t.M4="M4",t.M5="M5",t.M6="M6",t))(Hf||{}),Yf=(t=>(t.LENGTH="LENGTH",t.RADIUS="RADIUS",t.ANGLE="ANGLE",t))(Yf||{}),Vf=(t=>(t.MIL="mil",t.INCH="inch",t.CM="cm",t.MM="mm",t))(Vf||{}),zf=(t=>(t.SAFE="SAFE",t.OTHER="OTHER",t.TRACK="TRACK",t.BLIND="BLIND",t.RADIUS="RADIUS",t.PLANE="PLANE",t.COPPER="COPPER",t.PASTE="PASTE",t.SOLDER="SOLDER",t.DIFFER_ENTAIL="DIFFER_ENTAIL",t.NET_LENGTH="NET_LENGTH",t.AUTO_ROUTER="AUTO_ROUTER",t.NET_LENGTH_TOLERANCE="NET_LENGTH_TOLERANCE",t))(zf||{}),Xf=(t=>(t.NORMAL="NORMAL",t.DEFAULT="DEFAULT",t))(Xf||{}),qf=(t=>(t.ALL="ALL",t.LAYERED="LAYERED",t))(qf||{}),Wf=(t=>(t.DIRECT="DIRECT",t.NON_CONNECT="NON_CONNECT",t))(Wf||{}),Jf=(t=>(t.FORTY_FIVE="L45",t.NINETY="L90",t.NINETY_ARC="A90",t))(Jf||{}),Kf=(t=>(t.LESS="LESS",t.MID="MID",t.MORE="MORE",t))(Kf||{}),$f=(t=>(t.SPEED_FIRST="SPEED_FIRST",t.COMPLETION_FIRST="COMPLETION_FIRST",t))($f||{}),Zf=(t=>(t.DesignRule="DesignRule",t.Board="Board",t.SlotRegion="SlotRegion",t.ProhibitedRegion="ProhibitedRegion",t.ConstraintRegion="ConstraintRegion",t.Component="Component",t.Track="Track",t.TestPoint="TestPoint",t.Pad="Pad",t.Via="Via",t.SutureHole="SutureHole",t.Text="Text",t.ColorfulImage="ColorfulImage",t.Image="Image",t.FPCStiffener="FPCStiffener",t.Dimension="Dimension",t.CopperRegion="CopperRegion",t.FillRegion="Fill Region",t.Line="Line",t.Teardrop="Teardrop",t.D3Shell="D3Shell",t))(Zf||{}),Qf=hr(tf());function eo(t,e,i,s,r,n,a,o){return JSON.stringify([t||"",e||"",i,s,r?1:0,n?1:0,a?1:0,o])}function t0(t){let e=JSON.parse(t);return{text:e[0],fontFamily:e[1],fontSize:e[2],thickness:e[3],bold:!!e[4],italic:!!e[5],reverse:!!e[6],expansion:e[7]}}function Ea(t){return Qf.default.SHA256(t).toString()}function e0(t,e){let i=[],s=[],r={};qn(t,(u,c)=>{let h=JSON.parse(u);if(h.type==="DOCHEAD"||h.type==="META"||h.type==="META_CREATE"||h.type==="META_MODIFY"||h.type==="ELE_PLACEHOLDER"||h.type==="ELE_PLACEHOLDER"||h.type==="ELE_PLACEHOLDER")return;let{id:f}=h;r[f]=Object.assign(h,{data:c})});let n={};qn(e,(u,c="")=>{let h=JSON.parse(u);if(h.type==="BLOB")i.push(u+li+c);else if(h.type==="FONT")s.push(u+li+c);else{if(h.type==="DOCHEAD"||h.type==="META_MODIFY")return;let{id:f}=h;n[f]=Object.assign(h,{data:c})}});let a={},o={},l={};for(let u in r)if(!n.hasOwnProperty(u))o[u]=r[u];else{let{ticket:c}=r[u],{type:h,data:f,client:d}=n[u];a[u]={type:h,ticket:c,data:f,client:d},delete n[u]}for(let u in n){let{type:c,data:h,ticket:f,client:d}=n[u];l[u]={type:c,data:h,ticket:f,client:d}}return{delete:o,cover:a,add:l,blobs:i,fonts:s}}function Na(t,e,i){let{docType:s,uuid:r,client:n,updateTime:a,version:o,user:l,ticket:u}=i,c=[_s(s,n,r,a,o,l,u)],{delete:h,cover:f,add:d,blobs:p,fonts:m}=e0(t,e);for(let g in h){let{ticket:b,type:y,client:E}=h[g];c.push(ze(y,b+1,g,"",E))}for(let g in f){let{type:b,ticket:y,data:E,client:_}=f[g];c.push(ze(b,y+1,g,E,_))}for(let g in d){let{type:b,ticket:y,data:E,client:_}=d[g];c.push(ze(b,y,g,E,_))}return p.length&&(c.push(_s("BLOB",n,"BLOB",a,o,l,u)),c=c.concat(p)),m.length&&(c.push(_s("FONT",n,"FONT",a,o,l,u)),c=c.concat(m)),c.join(ne)}var l_=hr(Zr());var i0=class{constructor(t,e=1,i=[]){this.consistencyManager=t,this.startNum=e,this.needOrderType=i,this.initIng=!1,this.allOrderNum={},this.maxNum={},this.consistencyManager.onChange((s,r,n,a,o,l,u,c,h,f,d,p)=>{try{this.onParseLine(r,a,n?JSON.parse(n):null,o,l,c,p)}catch(m){console.error(m)}})}setIsInit(t){this.initIng=t}setNeedNum(t){this.needNum=t}setOrderNum(t,e,i){this.needNum&&this.needOrderType&&this.needOrderType.includes(i)&&e!==void 0&&(this.allOrderNum[t]=e,this.setMaxNum(i,e))}deleteOrderNum(t){delete this.allOrderNum[t]}getOrderNum(t){return this.allOrderNum[t]}setMaxNum(t,e,i){(i||this.maxNum[t]===void 0||this.maxNum[t]<e)&&(this.maxNum[t]=e)}getMaxNum(t){return this.maxNum[t]===void 0&&(this.maxNum[t]=this.startNum-1),++this.maxNum[t]}};function Cu(t){switch(t=String(t),t){case"1":return"SAFE";case"2":return"OTHER";case"3":return"TRACK";case"4":return"BLIND";case"5":return"RADIUS";case"6":return"PLANE";case"7":return"COPPER";case"8":return"PASTE";case"9":return"SOLDER";case"10":return"DIFFER_ENTAIL";case"11":return"NET_LENGTH";case"12":return"AUTO_ROUTER";case"13":return"NET_LENGTH_TOLERANCE"}return t}function zs(t){if(!t)return{};let e=["1","2","3","4","5","6","7","8","9","10","11","12","13"];for(let i of e)if(t.hasOwnProperty(i)){let s=t[i];delete t[i],t[Cu(i)]=s}return t}var s0=(t=>(t[t.TRACK=0]="TRACK",t[t.SMDPad=1]="SMDPad",t[t.THPad=2]="THPad",t[t.SMD_Test_Point=3]="SMD_Test_Point",t[t.TH_Test_Point=4]="TH_Test_Point",t[t.VIA=5]="VIA",t[t.REGION=6]="REGION",t[t.PLANE=7]="PLANE",t[t.SLOT=8]="SLOT",t[t.LINE=9]="LINE",t[t.OTHER=10]="OTHER",t[t.SHEETFRAME=11]="SHEETFRAME",t[t.Hole=12]="Hole",t[t.Copper=13]="Copper",t[t.Inner=14]="Inner",t[t.PROHIBITAREA=15]="PROHIBITAREA",t[t.COMPONENT=16]="COMPONENT",t))(s0||{}),yl=class{constructor(){this.init=!1,this.defaultSafeData=null,this.defaultCopperSpace=null,this.defaultInnerSpace=null,this.copperChangeMap=new Map,this.innerChangeMap=new Map}addDefaultSafeSpaceData(t){this.init=!0,this.defaultSafeData=t}addDefaultCopperSpace(t,e){this.defaultCopperSpace={netClearance:t,boardClearance:e}}addDefaultInnerSpace(t,e){this.defaultInnerSpace={netClearance:t,boardClearance:e}}getNewDefaultData(t,e){if(t&&this.defaultSafeData==null||!t&&this.defaultInnerSpace==null)return null;let i=t?this.copperChangeMap.get(e):this.innerChangeMap.get(e);if(i==null)return null;let{netClearance:s,boardClearance:r}=i,n=this.defaultSafeData.safeSpacing[0].content,a=new Array(n.length);for(let o=0;o<n.length;o++)a[o]=Array.from(n[o]);return this.updateSafeData(a,s,r),a}fixSafeData(t){if(this.defaultCopperSpace!=null)for(let e of t.safeSpacing)this.updateSafeData(e.content,this.defaultCopperSpace.netClearance,this.defaultCopperSpace.netClearance)}updateSafeData(t,e,i){for(let s=0;s<t.length;s++){let r=t[s];for(let n=0;n<r.length;n++)s==7?n==11||n==8?r[n]=i:r[n]=e:n==7&&(s==11||s==8?r[n]=i:r[n]=e)}}addCopper2SafeChangeMap(t,e,i,s,r){this.copperChangeMap.set(t,{name:e,isDefault:i,netClearance:s,boardClearance:r})}addInner2SafeChangeMap(t,e,i,s,r){this.innerChangeMap.set(t,{name:e,isDefault:i,netClearance:s,boardClearance:r})}getSafeName4Copper(t){var e;return(e=this.copperChangeMap.get(t))==null?void 0:e.name}getSafeName4Plane(t){var e;return(e=this.innerChangeMap.get(t))==null?void 0:e.name}getDefaultCopper(){for(let[,t]of this.copperChangeMap)if(t.isDefault)return t.name;return null}getDefaultPlane(){for(let[,t]of this.innerChangeMap)if(t.isDefault)return t.name;return null}};function Tl(t,e){let i=t,s={TWO_LAYERS_BOARD:"JLCPCB Capability(Two Layers Board)",SINGLE_LAYER_BOARD:"JLCPCB Capability(Single Layer Board)",MULTIPLE_LAYERS_BOARD:"JLCPCB Capability(Multiple Layers Board)",HIGH_FREQUENCY_BOARD:"JLCPCB Capability(High Frequency Board)",ALUMINUM_SUBSTRATE_BOARD:"JLCPCB Capability(Aluminum Substrate Board)",COPPER_SUBSTRATE_BOARD:"JLCPCB Capability(Copper Substrate Board)"};if(i.length==8){Object.values(s).includes(e)&&(i[4][0]=11.811,i[5][4]=11.811),i.splice(1,0,i[1].slice(0));for(let n=2;n<i.length;n++)i[n].splice(1,0,i[n][1]);i.push([].concat(i[1][0],i.slice(1).map(n=>n[1])))}i[1].push(i[1][i[1].length-1]),i.splice(3,0,[...i[1]]),i.splice(4,0,[...i[2]]),i[1].pop();for(let n=5;n<i.length;n++)i[n].splice(3,0,i[n][1]),i[n].splice(4,0,i[n][2]);i[3][3]=i[1][1],i[4][3]=i[2][1],i[4][4]=i[2][2];let r=6;i.splice(7,0,new Array(7).fill(r));for(let n=7;n<i.length;n++)i[n].splice(7,0,r);return i}function r0(t,e){let i=t[0],s=t[1],r=[],n="ALL";if(s instanceof Array){let a=Tl(s,e);r.push({layerId:1,isOpen:!0,content:a})}else{for(let a in s){let o=s[a],l=Tl(o,e);r.push({layerId:+a,isOpen:!0,content:l})}Object.keys(s).length>1&&(n="LAYERED")}return{unit:i,isForAll:n,safeSpacing:r}}function n0(t){let e=t[0],i=t[1],s=t[2];isNaN(s)&&(s=0);let r=t[3];return isNaN(r)&&(r=11.8),{unit:e,deviceClearance:i,thru2SmdClearance:s,holeClearance:r}}function a0(t){let e=t[0],i=t[1],s=!0,r=[];if(i instanceof Object)for(let n in i){let a=i[n];r.push({layerId:+n,stroMin:a[0],stroDef:a[1],stroMax:a[2]})}else r.push({layerId:1,stroMin:t[1],stroDef:t[2],stroMax:t[3]});return{unit:e,track:{isOpen:s,content:r}}}function o0(t){return{unit:t[0],netLenMin:t[1],netLenMax:t[2]}}function l0(t){return{unit:t[0],netLengthTolerance:t[1]}}function u0(t){let e=t[0],i=t[1],s=!0,r=[],n=[],a=0;if(i instanceof Object)for(let o in i){let l=i[o],{stroke:u,spacing:c,lenTolerMax:h}=l;r.push({layerId:+o,stroMin:u[0],stroDef:u[1],stroMax:u[2]}),n.push({layerId:+o,spacMin:c[0],spacDef:c[1]}),a=h}else r.push({layerId:1,stroMin:t[1],stroDef:t[2],stroMax:t[3]}),n.push({layerId:1,spacMin:t[4],spacDef:t[5]}),a=t[7];return{unit:e,stroWidth:{isOpen:s,content:r},spacing:{isOpen:s,content:n},differPairLenTolerMax:a}}function c0(t){let e=new Array;for(let i of t){let s=+i[1],r=+i[2];isNaN(s)||s<=0||isNaN(r)||r<=0||s===r||s===1&&r===2||s===2&&r===1||e.push({name:i[0],staLayerId:s,endLayerId:r,viaSizeRule:i[3]})}return{blinds:{content:e}}}function h0(t){return{unit:t[0],minRadius:t[1],defRadius:t[2],maxRadius:t[3],minInner:t[4],defInner:t[5],maxInner:t[6]}}function d0(t){let e=[{layerId:1,connType:ir(t[7]!==void 0?t[7]:t[3]),spoWidth:t[8]!==void 0?t[8]:t[4],spoSpac:t[9]!==void 0?t[9]:t[5],spoAng:t[10]?t[10]:t[6]}];return{unit:t[0],mulPad:{isOpen:!0,content:e}}}function p0(t){let e=[{layerId:1,connType:ir(t[3]),spoWidth:t[4],spoSpac:t[5],spoAng:t[6]}],i=[{layerId:1,connType:Number(t[7])?"NON_CONNECT":"DIRECT"}],s=[{layerId:1,connType:ir(t[8]!==void 0?t[8]:t[3]),spoWidth:t[9]!==void 0?t[9]:t[4],spoSpac:t[10]!==void 0?t[10]:t[5],spoAng:t[11]?t[11]:t[6]}];return{unit:t[0],sglPad:{isOpen:!0,content:e},mulPad:{isOpen:!0,content:s},track:{isOpen:!0,content:i}}}function f0(t){return{unit:t[0],padTopExpan:t[1],padBotExpan:t[2],testPointTopExpan:t[3]?t[3]:-1e3,testPointBotExpan:t[4]?t[4]:-1e3}}function m0(t){return{unit:t[0],padTopExpan:t[1],padBotExpan:t[2],viaTopExpan:t[3],viaBotExpan:t[4],testPointTopExpan:t[5]?t[5]:2,testPointBotExpan:t[6]?t[6]:2}}function g0(t){function e(r){switch(r=r&&Number(r),r){case 0:return"L45";case 1:return"L90";case 2:return"A90";default:return"L45"}}function i(r){switch(r=r&&Number(r),r){case 0:return"LESS";case 1:return"MID";case 2:return"MORE";default:return"LESS"}}function s(r){switch(r=r&&Number(r),r){case 0:return"SPEED_FIRST";case 1:return"COMPLETION_FIRST";default:return"COMPLETION_FIRST"}}return{routingCorner:e(t[0]),isKeep:!!t[1],viaQuantity:i(t[2]),routingEffectPriority:s(t[3]),layers:t[5],ignoreNets:t[6]}}function ir(t){switch(t=t&&Number(t),t){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}function E0(t,e){let i=e;switch(t){case"SAFE":{let s=e;if(s.isForAll=s.isForAll?"LAYERED":"ALL",s.safeSpacing)for(let r of s.safeSpacing)r.isOpen=!!r.isOpen;i=s;break}case"OTHER":break;case"TRACK":{let s=e;s!=null&&s.track&&(s.track.isOpen=!!s.track.isOpen),i=s;break}case"NET_LENGTH":break;case"NET_LENGTH_TOLERANCE":break;case"DIFFER_ENTAIL":{let s=e;s!=null&&s.stroWidth&&(s.stroWidth.isOpen=!!s.stroWidth.isOpen),s!=null&&s.spacing&&(s.spacing.isOpen=!!s.spacing.isOpen),i=s;break}case"BLIND":break;case"RADIUS":break;case"PLANE":{let s=e;if(s!=null&&s.mulPad&&(s.mulPad.isOpen=!!s.mulPad.isOpen),s.mulPad&&s.mulPad.content)for(let r of s.mulPad.content)r.connType=ir(r.connType);i=s;break}case"COPPER":{let s=e;if(s!=null&&s.sglPad&&(s.sglPad.isOpen=!!s.sglPad.isOpen),s!=null&&s.mulPad&&(s.mulPad.isOpen=!!s.mulPad.isOpen),s!=null&&s.track&&(s.track.isOpen=!!s.track.isOpen),s.track&&s.track.content&&(s.track.content=s.track.content.map(r=>(r.connType=Number(r.connType)?"NON_CONNECT":"DIRECT",r))),s.sglPad&&s.sglPad.content)for(let r of s.sglPad.content)r.connType=ir(r.connType);if(s.mulPad&&s.mulPad.content)for(let r of s.mulPad.content)r.connType=ir(r.connType);i=s;break}case"PASTE":break;case"SOLDER":break;case"AUTO_ROUTER":break}return i}function y0(t,e,i,s,r,n){if(!(s instanceof Array))return E0(t,s);let a,o=!1;switch(i&&(i==="NORMAL"?o=!1:i==="DEFAULT"&&(o=!0)),t){case"SAFE":{a=r0(s,n),o&&r.addDefaultSafeSpaceData(a);break}case"OTHER":{a=n0(s);break}case"TRACK":{a=a0(s);break}case"NET_LENGTH":{a=o0(s);break}case"NET_LENGTH_TOLERANCE":{a=l0(s);break}case"DIFFER_ENTAIL":{a=u0(s);break}case"BLIND":{a=c0(s);break}case"RADIUS":{a=h0(s);break}case"PLANE":{let l=s[1],u=s[2];o&&r.addDefaultInnerSpace(l,u),r.addInner2SafeChangeMap(e,"Plane_"+e,o,l,u),a=d0(s);break}case"COPPER":{let l=s[1],u=s[2];o&&r.addDefaultCopperSpace(l,u),r.addCopper2SafeChangeMap(e,"Copper_"+e,o,l,u),a=p0(s);break}case"PASTE":{a=f0(s);break}case"SOLDER":{a=m0(s);break}case"AUTO_ROUTER":{a=g0(s);break}}return a}function T0(t,e,i,s){if(!s.init)return null;function r(n,a){let o=n?"Copper_":"Plane_",l=["RULE"];l[1]="SAFE",l[2]=o+e,l[3]=0;let u=a.getNewDefaultData(n,e);return u==null?null:(l[4]={unit:a.defaultSafeData.unit,isForAll:"ALL",safeSpacing:[{layerId:1,isOpen:!0,content:u}]},l)}switch(t){case"SAFE":return s.fixSafeData(i),null;case"PLANE":return r(!1,s);case"COPPER":return r(!0,s);default:return null}}function b0(t,e,i,s){if(!s.init)return{ruleKeyValue:i};let r=t[0],n,a;if(e==4){if(r==="NET_CLASS"||r==="NET"){for(let o in i)String(o)==="COPPER"&&(n={COPPER:s.getSafeName4Copper(i[o])}),String(o)==="PLANE"&&(a={PLANE:s.getSafeName4Plane(i[o])});t[1]==""?(n!=null&&n.COPPER||(n={COPPER:"default"}),a!=null&&a.PLANE||(a={PLANE:"default"})):(n!=null&&n.COPPER||(n={COPPER:s.getDefaultCopper()}),a!=null&&a.PLANE||(a={PLANE:s.getDefaultPlane()}))}}else for(let o in i){if(String(o)==="COPPER"){let l=i[o],u=s.getSafeName4Copper(l);if(u==null&&l=="default"&&(u=s.getDefaultCopper()),u==null)continue;n={COPPER:u}}if(String(o)==="PLANE"){let l=i[o],u=s.getSafeName4Plane(l);if(u==null&&l=="default"&&(u=s.getDefaultPlane()),u==null)continue;a={PLANE:u}}}return{ruleKeyValue:i,copperRuleValue:n,innerPlaneRuleValue:a}}function Nu(t,e){let i=t.length,s=0;for(;s<i;){let r=t.indexOf(`
`,s);r<0&&(r=i);let n=t.substring(s,r);try{if(e(n)===!1)break}catch(a){console.error(a)}s=r+1}}function _0(t){let e={};return Nu(t,i=>{if(i.startsWith('["PAD"')){let s=JSON.parse(i);e[s[5]]||(e[s[5]]=[]),e[s[5]].push(s[1])}}),e}var Lo=class{parseFull(t){Nu(t,e=>this.onParseLine(JSON.parse(e))),this.onParseEnd()}},S0=(t=>(t[t.pro1=1]="pro1",t[t.pro2=1.1]="pro2",t[t.pro3=1.2]="pro3",t[t.pro4=1.3]="pro4",t[t.pro5=1.4]="pro5",t[t.pro6=1.5]="pro6",t[t.pro7=1.6]="pro7",t[t.pro8=1.7]="pro8",t[t.pro9=1.8]="pro9",t[t.pro=1.8]="pro",t))(S0||{}),I0=class extends Lo{constructor(t={},e={},i=[],s=[],r=!1){super(),this.deviceName=t,this.footprintName=e,this.footprints=i,this.devices=s,this.footprintIsConnectDevice=r,this.fontCache=[],this.poured={},this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize={data:[],stamp:{h:null,v:null},size:{h:null,v:null}},this.layerPhys=0,this.fac=new yl,this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet=new Set,this.oldId={},this.cachePadNet={},this.creaseIds=[],this.stringId={},this.padNumId={},this.componentPadNum={}}getOldId(t){var e;return(e=this.oldId[t])!=null?e:t}handConnect(){for(let t of this.creaseIds)if(this.connects[t])for(let e of this.connects[t])this.connects[e]?this.connects[e].push(t):this.connects[e]=[t]}getConnect(t){return this.connects[t]||[]}transRuleType(t){return Cu(t)}transRuleStatus(t){switch(t=t&&Number(t),t){case 0:return"NORMAL";case 1:return"DEFAULT";default:return"NORMAL"}}transGridType(t){switch(t=t&&Number(t),t){case 0:return"NONE";case 1:return"GRID";case 2:return"OUTLETS";default:return"NONE"}}transLayerStatus(t){t=t&&Number(t);let e=!1,i=!1,s=!1;return t!=null&&!isNaN(t)?(t>=4&&(s=!0,t-=4),t>=2&&(i=!0,t-=2),t===1&&(e=!0)):e=!0,{use:e,show:i,locked:s}}transRoutingMode(t){switch(t=t&&Number(t),t){case 0:return"NONE";case 1:return"PUSH";case 2:return"SURROUND";case 3:return"OBSTRUCT";case 4:return"SURROUND&PUSH";default:return"NONE"}}transPadDef(t){switch(t==null?void 0:t[0]){case"ELLIPSE":return{padType:"ELLIPSE",width:t[1],height:t[2]};case"RECT":return{padType:"RECT",width:t[1],height:t[2],radius:t[3]};case"OVAL":return{padType:"OVAL",width:t[1],height:t[2]};case"POLYGON":case"POLY":return{padType:"POLYGON",path:t[1]};default:return null}}transHoleDef(t){return t?{holeType:t[0],width:t[1],height:t[2]}:null}transPourDef(t){function e(i){switch(i=i&&Number(i),i){case 0:return"GRID_LINE";case 1:return"HORIZONTAL_LINE";case 2:return"VERTICAL_LINE";default:return"GRID_LINE"}}switch(t==null?void 0:t[0]){case"SOLID":return{pourType:"SOLID",fineness:t[1]};case"LINE":return{pourType:e(t[1]),angle:t[2],strokeWidth:t[3],strokeSpacing:t[4]};default:return null}}transUnusedPadRange(t){switch(t=t&&Number(t),t){case 1:return"ALL";case 2:return"PAD";case 3:return"VIA";default:return"VIA"}}transPathOptimization(t){switch(t=t&&Number(t),t){case 0:return"SINGLE";case 1:return"ALL";case 2:return"NONE";default:return"SINGLE"}}transViaType(t){switch(t=t&&Number(t),t){case 0:return"NORMAL";case 1:return"SUTURE";default:return"NORMAL"}}transPadFuncType(t){switch(t=t&&Number(t),t){case 0:return"NORMAL";case 1:return"TEST";case 2:return"MARKER";default:return"NORMAL"}}transPadConnect(t){switch(t=t&&Number(t),t){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}transFillStyle(t){switch(t=t&&Number(t),t){case 0:return"SOLID";case 1:return"GRID";case 2:return"PLANE";default:return null}}transProhibitType(t){let e=new Set;if(!t)return[];for(let i of t)switch(i=i&&Number(i),i){case 1:e.add("TRACK"),e.add("FILL");break;case 2:e.add("COMPONENT");break;case 3:e.add("VIA");break;case 4:e.add("COPPER"),e.add("PLANE");break;case 5:e.add("TRACK");break;case 6:e.add("FILL");break;case 7:e.add("COPPER");break;case 8:e.add("PLANE");break}return Array.from(e)}transPushCoverDir(t){switch(t=t&&Number(t),t){case 1:return"X_AXIS_POSITIVE";case 2:return"X_AXIS_NEGATIVE";case 4:return"Y_AXIS_POSITIVE";case 8:return"Y_AXIS_NEGATIVE";default:return"X_AXIS_POSITIVE"}}transEntityBelong(t){switch(t=t&&Number(t),t){case 0:return"AUTO";case 1:return"UPPER_SHELLS";case 2:return"LOWER_SHELLS";default:return"AUTO"}}transSlotOption(t){t=t&&Number(t);let e=t;if(!e||e<4)return["OUTLINE","SCREW_PILLAR","ENTITY"];let i=[];return e>=16&&(i.push("ENTITY"),e-=16),e>=8&&(i.push("SCREW_PILLAR"),e-=8),e>=4&&(i.push("OUTLINE"),e-=4),i}transAlignType(t){switch(t=t&&Number(t),t){case 1:return"LEFT_TOP";case 4:return"CENTER_TOP";case 7:return"RIGHT_TOP";case 2:return"LEFT_MIDDLE";case 5:return"CENTER_MIDDLE";case 8:return"RIGHT_MIDDLE";case 3:return"LEFT_BOTTOM";case 6:return"CENTER_BOTTOM";case 9:return"RIGHT_BOTTOM";default:return"LEFT_BOTTOM"}}onParseLine(t){var i;let e=t[0];switch(e){case"DOCTYPE":this.parseDocType(t);break;case"HEAD":this.parseHead(t);break;case"CANVAS":this.parseCanvas(t);break;case"LAYER":this.parseLayer(t);break;case"LAYER_PHYS":this.parseLayerPhys(t);break;case"ACTIVE_LAYER":this.parseActiveLayer(t);break;case"NET":this.parseNet(t);break;case"PRIMITIVE":this.parsePrimitive(t);break;case"GROUP":this.parseGroup(t);break;case"SILK_OPTS":this.parseSilkOpts(t);break;case"PREFERENCE":this.parsePreference(t);break;case"CONNECT":this.parseConnect(t);break;case"ITEM_ORDER":this.parseItemOrder(t);break;case"PROP":this.parseProp(t);break;case"EQLEN_GRP":this.parseEQLenGrp(t);break;case"EQLEN":this.parseEQLen(t);break;case"FONT":this.parseFont(t);break;case"PAD_NET":{this.cachePadNet[t[1]]||(this.cachePadNet[t[1]]=[]),this.cachePadNet[t[1]].push(t);break}case"REUSE_BLOCK":this.parseReuseBlock(t);break;case"RULE_TEMPLATE":this.parseRuleTemplate(t);break;case"RULE":this.rules.push(t);break;case"RULE_SELECTOR":this.ruleSelectors.push(t);break;case"PANELIZE":this.panelize.data=t;break;case"PANELIZE_STAMP":this.parsePanelizeStamp(t);break;case"PANELIZE_SIDE":this.parsePanelizeSide(t);break;case"POURED":{this.parsePoured(t);break}case"PARTITION":e==="PARTITION"&&(this.curPartition=t[3]?t[1]:"");case"VIA":case"PAD":case"LINE":case"ARC":case"CARC":case"OBJ":case"POLY":case"FILL":if(e==="FILL"&&t[6]===2){this.layerFill[t[4]]||(this.layerFill[t[4]]=[]),this.layerFill[t[4]].push(t);break}case"REGION":case"POUR":case"IMAGE":case"TEARDROP":case"FPC_FILL":case"SHELL":case"CREASE":e==="CREASE"&&this.creaseIds.push(t[1]);case"SHELLCUT":case"SHELL_ENTITY":case"BOSS":case"STRING":if(e==="STRING"&&!/^[a-zA-Z]+\d+$/.test(t[1])){let s=t[1],r=s.split(/([0-9].*)/);if(r.length>=2){let n=r[0],a=r[1];for(let o=0;o<a.length;o++){let l=a.charCodeAt(o);n+=l}s=n}this.stringId[s]=t[1],t[1]=s}case"DIMENSION":case"COMPONENT":{let s=e==="CARC"?"ARC":e,r=Hr(t[1]);this.cache[s]||(this.cache[s]={}),r!==null&&!this.cache[s][r]?this.cache[s][r]={part:this.curPartition,value:t}:(this.errorIds[s]||(this.errorIds[s]=[]),this.errorIds[s].push({part:this.curPartition,value:t})),s==="COMPONENT"&&(this.components[t[1]]||(this.components[t[1]]={attrs:{},footprint:"",device:""}),this.components[t[1]].attrs=t[7]||{}),s==="DIMENSION"&&(this.dimension[t[1]]={attr:[]});break}case"ATTR":{if(this.docType==="PCB"&&!t[3])break;if(t[7]==="Footprint"&&(this.components[t[3]]||(this.components[t[3]]={attrs:{},footprint:"",device:""}),this.components[t[3]].footprint=t[8]),t[7]==="Device"&&(this.components[t[3]]||(this.components[t[3]]={attrs:{},footprint:"",device:""}),this.components[t[3]].device=t[8]),this.dimension[t[1]]){this.dimension[t[1]].attr=t;break}let s=Object.keys(((i=this.cache)==null?void 0:i.COMPONENT)||{}).find(n=>this.cache.COMPONENT[n].value[1]===t[3]);if(s){let n=this.cache.COMPONENT[s];n.attr||(n.attr=[]),n.attr.push({part:this.curPartition,value:t});break}let r=Hr(t[1]);this.cache[e]||(this.cache[e]={}),r!==null&&!this.cache[e][r]?this.cache[e][r]={part:this.curPartition,value:t}:(this.errorIds[e]||(this.errorIds[e]=[]),this.errorIds[e].push({part:this.curPartition,value:t}));break}default:console.warn("can not find hanlder with",t)}}async secondParseLine(t,e,i){let s=t[0];if(this.idsSet.has(t[1])||!t[1]){let r=Be();if(this.oldId[r]=t[1],t[1]=r,i)for(let n of i)n[3]=r}else this.idsSet.add(t[1]);switch(s){case"DOCTYPE":case"HEAD":case"CANVAS":case"LAYER":case"LAYER_PHYS":case"ACTIVE_LAYER":case"NET":case"PRIMITIVE":case"GROUP":case"SILK_OPTS":case"PREFERENCE":case"ITEM_ORDER":case"RULE_TEMPLATE":case"RULE":case"RULE_SELECTOR":case"PANELIZE":case"PANELIZE_STAMP":case"PANELIZE_SIDE":case"CONNECT":case"EQLEN_GRP":case"EQLEN":case"FONT":case"PAD_NET":case"REUSE_BLOCK":case"PROP":break;case"PARTITION":this.parsePartition(t);break;case"VIA":this.parseVia(t);break;case"PAD":this.parsePad(t);break;case"LINE":await this.parseLine(t);break;case"ARC":this.parseArc(t);break;case"CARC":this.parseCArc(t);break;case"OBJ":this.parseObj(t);break;case"POLY":this.parsePoly(t);break;case"FILL":this.parseFill(t);break;case"REGION":this.parseRegion(t);break;case"POUR":this.parsePour(t);break;case"IMAGE":this.parseImage(t);break;case"TEARDROP":this.parseTeardrop(t);break;case"FPC_FILL":this.parseFpcFill(t);break;case"SHELL":this.parseShell(t);break;case"CREASE":this.parseCrease(t);break;case"SHELLCUT":this.parseShellCut(t);break;case"SHELL_ENTITY":this.parseShellEntity(t);break;case"BOSS":this.parseBoss(t);break;case"STRING":this.parseString(t);break;case"ATTR":this.parseAttr(t,e);break;case"DIMENSION":this.parseDimension(t);break;case"COMPONENT":this.parseComponent(t);break;default:console.warn("can not find hanlder with",t)}}onParseEnd(){for(let e of this.rules)e[1]=this.transRuleType(e[1]),e[3]=this.transRuleStatus(e[3]),e[4]=y0(e[1],e[2],e[3],e[4],this.fac,this.ruleTemplateName);if(this.fac.init){let e=Array.from(this.rules);for(let i of e){let s=T0(i[1],i[2],i[4],this.fac);s&&this.rules.push(s)}}for(let e of this.rules)this.parseRule(e);let t={};for(let e of this.ruleSelectors){let i=b0(e[1],e[2],zs(e[3]),this.fac),s=JSON.stringify(e[1]);t[s]?(e[2]&&(t[s].ruleOrder=e[2]),i.ruleKeyValue&&(t[s].ruleKeyValue=Object.assign(t[s].ruleKeyValue,i.ruleKeyValue)),(i.copperRuleValue||e[4])&&(t[s].copperValue=i.copperRuleValue||zs(e[4])),(i.innerPlaneRuleValue||e[5])&&(t[s].innerPlaneValue=i.innerPlaneRuleValue||zs(e[5]))):t[s]={ruleSelect:e[1],ruleOrder:e[2],ruleKeyValue:i.ruleKeyValue,copperValue:i.copperRuleValue||zs(e[4])||{},innerPlaneValue:i.innerPlaneRuleValue||zs(e[5])||{}}}for(let e in t)this.parseRuleSelector(t[e]);this.handConnect(),this.parseEQLenGrpFull(),this.parsePanelize(),this.parseLayerFill();for(let e in this.cache){let i=this.cache[e],s=Object.keys(i).sort((n,a)=>Number(n)-Number(a)),r=-1;for(let n of s){let a=Number(n),o=a-r-1;o>=1&&this.onPHolder(e,o),r=a,this.curPartition=i[a].part,this.secondParseLine(i[a].value,void 0,i[a].attr),i[a].attr&&i[a].attr.forEach(l=>{this.curPartition=l.part,this.secondParseLine(l.value)})}if(this.errorIds[e])for(let n of this.errorIds[e])this.curPartition=n.part,this.secondParseLine(n.value)}this.clearCache()}clearCache(){this.version=void 0,this.docType=void 0,this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize.data.length&&(this.panelize.data.length=0,this.panelize.stamp={h:null,v:null},this.panelize.size={h:null,v:null}),this.layerPhys=0,this.fac.init&&(this.fac=new yl),this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet.clear(),this.oldId={},this.creaseIds.length=0}fixPolygon(t){if(t[0]=="R"){let e=parseFloat(t[3])/10,i=parseFloat(t[4])/10;t[6]=Math.min(e,i)/2*(parseFloat(t[6])||0)*10}}handleSimplePolygon(t){return!t||this.version>=1.5||this.fixPolygon(t),t}handlePolygon(t){if(this.version<1.5&&t&&t.length){if(!Array.isArray(t[0]))return this.handleSimplePolygon(t);for(let e of t)this.fixPolygon(e)}return t}parseEQLen(t){this.eQLenData[t[1]]?this.eQLenData[t[1]].pads?this.eQLenData[t[1]].pads.push(t[2]):this.eQLenData[t[1]].pads=[t[2]]:this.eQLenData[t[1]]={pads:[t[2]]}}parseEQLenGrp(t){this.eQLenData[t[1]]?(this.eQLenData[t[1]].id=t[1],this.eQLenData[t[1]].name=t[2],this.eQLenData[t[1]].sort=++this.eQLenSort):this.eQLenData[t[1]]={id:t[1],name:t[2],sort:++this.eQLenSort}}parseCanvas(t){this.onCanvas(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],this.transGridType(t[10]),this.transGridType(t[11]),t[12])}parseDocType(t){this.docType=t[1];let e=parseFloat(t[2]);this.version=e}parseHead(t){}parseLayer(t){let e=t[8];this.version<1.7&&(e=.5);let i=this.transLayerStatus(t[4]);this.onLayer(t[1],t[2],t[3],i.use,i.show,i.locked,t[5],t[6],t[7],e)}parseLayerPhys(t){this.onLayerPhys(t[1],t[2],t[3],t[4],t[5],!!t[6],++this.layerPhys)}parseActiveLayer(t){this.onActiveLayer(t[1])}parsePartition(t){this.onPartition(t[1],t[2],t[3],this.handlePolygon(t[4]))}parseNet(t){var e,i,s,r;this.onNet(t[1],(e=t[2])!=null?e:null,(i=t[3])!=null?i:null,!!t[4],(s=t[5])!=null?s:null,!!t[6],(r=t[7])!=null?r:null)}parsePrimitive(t){this.onPrimitive(t[1],!!t[2],!!t[3])}parseGroup(t){this.onGroup(t[1],t[2])}parseSilkOpts(t){this.onSilkOpts(t[1],t[2],t[3])}parsePreference(t){this.onPreference(!!t[1],t[2],!!t[3],t[4],t[5],!!t[6],this.transRoutingMode(t[7]),t[8],!!t[9],!!t[10],!!t[11],t[12],t[13],!!t[14],this.transUnusedPadRange(t[15]),t[16],this.transPathOptimization(t[17]),t[18],t[19],t[20])}parseConnect(t){this.connects[t[1]]=t[2]}parseVia(t){var e,i;this.onVia(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],this.transViaType(t[9]),(e=t[10])!=null?e:null,(i=t[11])!=null?i:null,!!t[12],t[13])}parsePad(t){var e,i,s,r,n,a,o,l,u;this.onPad(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],this.transHoleDef(t[9]),this.transPadDef(t[10]),t[11]&&(i=(e=t[11])==null?void 0:e.map(c=>({startLayer:c[0],endLayer:c[1],pad:this.transPadDef(c[2])})))!=null?i:null,t[12],t[13],t[14],!!t[15],this.transPadFuncType(t[16]),(s=t[17])!=null?s:null,(r=t[18])!=null?r:null,(n=t[19])!=null?n:null,(a=t[20])!=null?a:null,!!t[21],this.transPadConnect(t[22]),(o=t[23])!=null?o:null,(l=t[24])!=null?l:null,(u=t[25])!=null?u:null,t[26],this.getConnect(t[1]))}parseLine(t){this.onLine(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],!!t[10])}parseArc(t){this.onArc(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],!!t[11],this.specialColors[this.getOldId(t[1])])}parseCArc(t){this.onCArc(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],!!t[11],this.specialColors[this.getOldId(t[1])])}parseObj(t){this.onObj(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],!!t[10],t[11],!!t[12],this.specialColors[this.getOldId(t[1])])}parseItemOrder(t){this.itemOrder=t[1]}parseProp(t){this.specialColors[t[1]]=t[2]}parseEQLenGrpFull(){for(let t in this.eQLenData){let e=this.eQLenData[t];e.id&&this.onEQLenGrp(e.id,e.name,e.sort,e.pads||[])}this.eQLenData={},this.eQLenSort=1}parsePoly(t){this.onPoly(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],this.handleSimplePolygon(t[6]),!!t[7],this.specialColors[this.getOldId(t[1])])}parseFill(t){this.onFill(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],this.transFillStyle(t[6]),this.handlePolygon(t[7]),!!t[8],this.getConnect(t[1]),this.specialColors[this.getOldId(t[1])])}getZIndex1(t){let e=t.match(Po);return e!=null&&e.length?e[1]:null}parseLayerFill(){for(let t in this.layerFill){let e=this.layerFill[t];this.onLayerFill(Number(t),{fill:e.map(i=>{let s=this.getZIndex1(i[1]);return{id:i[1],partitionId:this.curPartition||"",groupId:i[2],locked:!!i[8],zIndex:s===null?null:Number(s),netName:i[3],width:i[5],path:this.handlePolygon(i[7]),refs:this.getConnect(i[1]),specialColor:this.specialColors[this.getOldId(i[1])]}})})}}parseRegion(t){let e=t[5],i=e&&e.includes(9)?"CONSTRAINT":"PROHIBIT";e=i?e.filter(s=>s!==9):e,this.onRegion(t[1],this.curPartition||"",t[2],t[3],t[4],this.transProhibitType(e),this.handlePolygon(t[6]),!!t[7],t[8],i)}parsePour(t){let e=t[9];this.version<=1.7&&e&&e[0]==="SOLID"&&e[1]&&(e[1]=8),this.onPour(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],this.handlePolygon(t[8]),this.transPourDef(e),!!t[10],!!t[11]),this.poured[t[1]]&&this.onPoured(t[1],this.poured[t[1]])}parsePoured(t){if(this.version<1.1){if(this.curPourId){let e={id:t[1],strokeWidth:t[2],fill:t[3],path:this.handlePolygon(t[4])};this.poured[this.curPourId]||(this.poured[this.curPourId]={pourFill:[]}),this.poured[this.curPourId].pourFill.push(e)}}else{let e={id:t[1],strokeWidth:t[3],fill:t[4],path:this.handlePolygon(t[5])};this.poured[t[2]]||(this.poured[t[2]]={pourFill:[]}),this.poured[t[2]].pourFill.push(e)}}parseImage(t){this.onImage(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],!!t[9],t[10],!!t[11],this.specialColors[this.getOldId(t[1])])}parseTeardrop(t){let e,i,s;this.version<1.2?(e=t[5],s=t[4]):(e=t[4],i=t[5],s=this.getConnect(t[1])),this.onTeardrop(t[1],this.curPartition||"",t[2],t[3],this.handleSimplePolygon(e),i!=null?i:null,s)}parseFpcFill(t){this.onFpcFill(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],this.handlePolygon(t[6]),!!t[7])}parseShell(t){let e=t[8];e&&e.Direction&&(e.Direction=this.transPushCoverDir(e.Direction)),this.onShell(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],this.handlePolygon(t[7]),e,!!t[9])}parseCrease(t){this.onCrease(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],t[7],t[8],!!t[9])}parseShellCut(t){this.onShellCut(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],this.handlePolygon(t[6]),!!t[7],this.getConnect(t[1]))}parseShellEntity(t){this.onShellEntity(t[1],this.curPartition||"",t[2],t[3],t[4],this.transEntityBelong(t[5]),this.transSlotOption(t[5]),t[6],t[7],this.handlePolygon(t[8]),!!t[9],this.getConnect(t[1]))}parseBoss(t){var e,i,s,r,n,a;this.version<1.4?this.onBoss(t[1],this.curPartition||"",t[2],t[3],t[5],t[6],(e=t[4])!=null?e:null,t[7],null,null,(i=t[8])!=null?i:null,(s=t[9])!=null?s:null,!!t[10]):this.onBoss(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],(r=t[6])!=null?r:null,t[7],t[8],t[9],(n=t[10])!=null?n:null,(a=t[11])!=null?a:null,!!t[12])}parseDimension(t){var r;let e=this.getOldId(t[1]),i=((r=this.dimension[e])==null?void 0:r.attr)||[];if(i.length){let n=this.fontCache.find(a=>a.id&&a.id===this.getOldId(i[1]));this.version<1.6&&n&&(n.text=i[8],n.fontFamily=i[11],n.fontSize=i[12]/10,n.thickness=i[13],n.bold=i[15],n.italic=i[16],n.reverse=i[18],n.expansion=i[19])}let s={groupId:i[2],layerId:i[4],x:i[5],y:i[6],text:i[8],fontFamily:i[11],fontSize:i[12],strokeWidth:i[13],bold:i[14],italic:i[15],origin:i[16],angle:i[17],reverse:i[18],expansion:i[19],mirror:i[20],locked:i[21],zIndex:null,specialColor:this.specialColors[this.getOldId(i[1])]};this.onDimension(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],!!t[7],t[8],!!t[9],s,this.specialColors[this.getOldId(t[1])],i[2]||"")}parseRuleTemplate(t){this.ruleTemplateName=t[1],this.onRuleTemplate(t[1])}parseRule(t){this.onRule(t[1],t[2],t[3],t[4])}parseRuleSelector(t){this.onRuleSelector(t.ruleSelect,t.ruleOrder,t.ruleKeyValue,t.copperValue,t.innerPlaneValue)}parsePanelize(){let t=this.panelize.data;t.length&&this.onPanelize(!!t[1],t[2],t[3],t[4],t[5],!!t[6],this.panelize.stamp.h,this.panelize.stamp.v,this.panelize.size.h,this.panelize.size.v)}parsePanelizeStamp(t){let e={on:!!t[2],stampHoleGroupQuantity:t[3],stampHoleDiameter:t[4],stampHoleQuantityPerGroup:t[5],stampHoleSpacing:t[6]};t[1]?this.panelize.stamp.v=e:this.panelize.stamp.h=e}parsePanelizeSide(t){let e={on:!!t[2],sideHeight:t[3],positionHoleDiameter:t[4],markDiameter:t[5],markExpansion:t[6]};t[1]?this.panelize.size.v=e:this.panelize.size.h=e}parseComponent(t){let e=this.getOldId(t[1]),i=t[7]||{},s=this.reuseBlock[e];if(s&&Object.assign(i,{"Group ID":s[2]||"","Channel ID":s[3]||""}),this.onComponent(t[1],this.curPartition||"",t[2],t[3],t[4],t[5],t[6],i,!!t[8],this.specialColors[e]),this.cachePadNet[e])for(let r of this.cachePadNet[e])this.parsePadNet(r)}parsePadNet(t){let e=this.getOldId(t[1]);if(t[4]===void 0&&this.components[e]){let i=this.components[e].footprint;if(!i){let r=this.components[e].device;i=this.devices.find(n=>n.uuid===r).attributes.Footprint}let s=this.padNumId[i];if(!s){let r=this.footprints.find(n=>n.uuid===i);r&&(this.padNumId[i]=_0(r==null?void 0:r.dataStr),s=this.padNumId[i])}if(s&&s[t[2]]){this.componentPadNum[e]||(this.componentPadNum[e]={}),this.componentPadNum[e][t[2]]===void 0&&(this.componentPadNum[e][t[2]]=-1);let r=++this.componentPadNum[e][t[2]];t[4]=s[t[2]][r]}else t[4]=t[2]}this.onPadNet(t[1],this.curPartition||"",t[2],t[3],t[4])}parseReuseBlock(t){this.reuseBlock[t[1]]=t}getFontCache(t,e,i,s,r,n,a,o){let l;return this.version<1.6?l=this.fontCache.find(u=>u.id===t):l=this.fontCache.find(u=>i==u.fontFamily&&e==u.text&&s/10==u.fontSize&&!!a==u.reverse&&o==u.expansion&&!!r==u.bold&&!!n==u.italic&&u.path.length>0),{paths:l==null?void 0:l.path,width:l==null?void 0:l.width,height:l==null?void 0:l.height}}getTextValue(t,e,i,s,r){let n="";return t!=""&&e===""&&this.docType!="PCB"&&!r&&t!="Footprint"&&!this.footprintIsConnectDevice&&(e=`<${t}>`),i?s?n=t+":"+e:n=t:s?n=e:n="",n}getFormulaName(t,e){if(!t||!t.startsWith("="))return t;t=t.slice(1);let i=/\{([^\}]+)\}/g,s=[],r=[];for(;s=i.exec(t);)r.push(s[1]);for(let n=0;n<r.length;n++){let a=r[n],o=`{${a}!}`;e.has(a)&&(o=e.get(a)),t=t.replace(`{${a}}`,o)}return t}parseAttr(t,e){let i=t[11],s=t[12];s&&this.version<1.2&&(i=="default"||i=="")&&(s*=1.5);let r=t[7],n=t[8],a=!!t[9],o=!!t[10],l=this.getOldId(t[3]),u=n;if(r==="Device"){let h=this.deviceName[n]||n;u=this.getTextValue(r,h,a,o,l)}else if(r==="Footprint"){let h=this.footprintName[n]||n;u=this.getTextValue(r,h,a,o,l)}else if(r==="Name"){let h=new Map;if(l){let f=this.components[l];if(h.set("ID",l),Object.entries(f.attrs).forEach(d=>h.set(d[0],d[1])),f.device){let d=this.devices.find(p=>p.uuid===f.device);d&&Object.entries(d.attributes).forEach(p=>h.set(p[0],p[1]))}}u=this.getTextValue(r,this.getFormulaName(n,h),a,o,l)}else u=this.getTextValue(r,n,a,o,l);let c=this.fontCache.find(h=>h.id&&h.id===this.getOldId(t[1]));this.version<1.6&&c&&(c.text=u,c.fontFamily=i,c.fontSize=s/10,c.thickness=t[13],c.bold=t[15],c.italic=t[16],c.reverse=t[18],c.expansion=t[19]),this.onAttr(t[1],this.curPartition||"",t[2],l,t[4],t[5],t[6],r,n,a,o,i,s,t[13],!!t[14],!!t[15],this.transAlignType(t[16]),t[17],!!t[18],t[19],!!t[20],!!t[21],e,this.specialColors[this.getOldId(t[1])])}parseFont(t){let e;switch(this.version){case 1:case 1.1:e={id:t[1],path:t[2]};break;case 1.2:case 1.3:case 1.4:case 1.5:e={id:t[1],width:t[2],height:t[3],path:t[4]};break;default:e={text:t[1],fontFamily:t[2],fontSize:t[3],thickness:t[4],bold:!!t[5],italic:!!t[6],reverse:!!t[7],expansion:t[8],width:t[9],height:t[10],path:t[11]};break}this.fontCache.push(e)}parseString(t){var _;let[,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b]=t,y=(_=this.stringId[e])!=null?_:e;l&&this.version<1.2&&(o=="default"||o=="")&&(l*=1.5);let E=this.fontCache.find(S=>S.id&&S.id===this.getOldId(y));this.version<1.6&&E&&(E.text=a,E.fontFamily=o,E.fontSize=l/10,E.thickness=u,E.bold=c,E.italic=h,E.reverse=p,E.expansion=m),this.onString(e,this.curPartition||"",i,s,r,n,a,o,l,u,!!c,!!h,this.transAlignType(f),d,!!p,m,!!g,!!b,this.specialColors[this.getOldId(y)])}},A0=Object.create,Pu=Object.defineProperty,O0=Object.getOwnPropertyDescriptor,R0=Object.getOwnPropertyNames,D0=Object.getPrototypeOf,w0=Object.prototype.hasOwnProperty,C0=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),N0=(t,e,i,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of R0(e))!w0.call(t,r)&&r!==i&&Pu(t,r,{get:()=>e[r],enumerable:!(s=O0(e,r))||s.enumerable});return t},P0=(t,e,i)=>(i=t!=null?A0(D0(t)):{},N0(e||!t||!t.__esModule?Pu(i,"default",{value:t,enumerable:!0}):i,t)),L0=C0((t,e)=>{"use strict";e.exports=i,e.exports.default=i;function i(O,x,k){k=k||2;var F=x&&x.length,P=F?x[0]*k:O.length,z=s(O,0,P,k,!0),Y=[];if(!z||z.next===z.prev)return Y;var tt,it,nt,at,pt,ft,xt;if(F&&(z=c(O,x,z,k)),O.length>80*k){tt=nt=O[0],it=at=O[1];for(var gt=k;gt<P;gt+=k)pt=O[gt],ft=O[gt+1],pt<tt&&(tt=pt),ft<it&&(it=ft),pt>nt&&(nt=pt),ft>at&&(at=ft);xt=Math.max(nt-tt,at-it),xt=xt!==0?32767/xt:0}return n(z,Y,k,tt,it,xt,0),Y}function s(O,x,k,F,P){var z,Y;if(P===j(O,x,k,F)>0)for(z=x;z<k;z+=F)Y=V(z,O[z],O[z+1],Y);else for(z=k-F;z>=x;z-=F)Y=V(z,O[z],O[z+1],Y);return Y&&A(Y,Y.next)&&(W(Y),Y=Y.next),Y}function r(O,x){if(!O)return O;x||(x=O);var k=O,F;do if(F=!1,!k.steiner&&(A(k,k.next)||S(k.prev,k,k.next)===0)){if(W(k),k=x=k.prev,k===k.next)break;F=!0}else k=k.next;while(F||k!==x);return x}function n(O,x,k,F,P,z,Y){if(O){!Y&&z&&m(O,F,P,z);for(var tt=O,it,nt;O.prev!==O.next;){if(it=O.prev,nt=O.next,z?o(O,F,P,z):a(O)){x.push(it.i/k|0),x.push(O.i/k|0),x.push(nt.i/k|0),W(O),O=nt.next,tt=nt.next;continue}if(O=nt,O===tt){Y?Y===1?(O=l(r(O),x,k),n(O,x,k,F,P,z,2)):Y===2&&u(O,x,k,F,P,z):n(r(O),x,k,F,P,z,1);break}}}}function a(O){var x=O.prev,k=O,F=O.next;if(S(x,k,F)>=0)return!1;for(var P=x.x,z=k.x,Y=F.x,tt=x.y,it=k.y,nt=F.y,at=P<z?P<Y?P:Y:z<Y?z:Y,pt=tt<it?tt<nt?tt:nt:it<nt?it:nt,ft=P>z?P>Y?P:Y:z>Y?z:Y,xt=tt>it?tt>nt?tt:nt:it>nt?it:nt,gt=F.next;gt!==x;){if(gt.x>=at&&gt.x<=ft&&gt.y>=pt&&gt.y<=xt&&E(P,tt,z,it,Y,nt,gt.x,gt.y)&&S(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function o(O,x,k,F){var P=O.prev,z=O,Y=O.next;if(S(P,z,Y)>=0)return!1;for(var tt=P.x,it=z.x,nt=Y.x,at=P.y,pt=z.y,ft=Y.y,xt=tt<it?tt<nt?tt:nt:it<nt?it:nt,gt=at<pt?at<ft?at:ft:pt<ft?pt:ft,bt=tt>it?tt>nt?tt:nt:it>nt?it:nt,Wt=at>pt?at>ft?at:ft:pt>ft?pt:ft,ae=b(xt,gt,x,k,F),ce=b(bt,Wt,x,k,F),Ct=O.prevZ,Dt=O.nextZ;Ct&&Ct.z>=ae&&Dt&&Dt.z<=ce;){if(Ct.x>=xt&&Ct.x<=bt&&Ct.y>=gt&&Ct.y<=Wt&&Ct!==P&&Ct!==Y&&E(tt,at,it,pt,nt,ft,Ct.x,Ct.y)&&S(Ct.prev,Ct,Ct.next)>=0||(Ct=Ct.prevZ,Dt.x>=xt&&Dt.x<=bt&&Dt.y>=gt&&Dt.y<=Wt&&Dt!==P&&Dt!==Y&&E(tt,at,it,pt,nt,ft,Dt.x,Dt.y)&&S(Dt.prev,Dt,Dt.next)>=0))return!1;Dt=Dt.nextZ}for(;Ct&&Ct.z>=ae;){if(Ct.x>=xt&&Ct.x<=bt&&Ct.y>=gt&&Ct.y<=Wt&&Ct!==P&&Ct!==Y&&E(tt,at,it,pt,nt,ft,Ct.x,Ct.y)&&S(Ct.prev,Ct,Ct.next)>=0)return!1;Ct=Ct.prevZ}for(;Dt&&Dt.z<=ce;){if(Dt.x>=xt&&Dt.x<=bt&&Dt.y>=gt&&Dt.y<=Wt&&Dt!==P&&Dt!==Y&&E(tt,at,it,pt,nt,ft,Dt.x,Dt.y)&&S(Dt.prev,Dt,Dt.next)>=0)return!1;Dt=Dt.nextZ}return!0}function l(O,x,k){var F=O;do{var P=F.prev,z=F.next.next;!A(P,z)&&w(P,F,F.next,z)&&B(P,z)&&B(z,P)&&(x.push(P.i/k|0),x.push(F.i/k|0),x.push(z.i/k|0),W(F),W(F.next),F=O=z),F=F.next}while(F!==O);return r(F)}function u(O,x,k,F,P,z){var Y=O;do{for(var tt=Y.next.next;tt!==Y.prev;){if(Y.i!==tt.i&&_(Y,tt)){var it=H(Y,tt);Y=r(Y,Y.next),it=r(it,it.next),n(Y,x,k,F,P,z,0),n(it,x,k,F,P,z,0);return}tt=tt.next}Y=Y.next}while(Y!==O)}function c(O,x,k,F){var P=[],z,Y,tt,it,nt;for(z=0,Y=x.length;z<Y;z++)tt=x[z]*F,it=z<Y-1?x[z+1]*F:O.length,nt=s(O,tt,it,F,!1),nt===nt.next&&(nt.steiner=!0),P.push(y(nt));for(P.sort(h),z=0;z<P.length;z++)k=f(P[z],k);return k}function h(O,x){return O.x-x.x}function f(O,x){var k=d(O,x);if(!k)return x;var F=H(k,O);return r(F,F.next),r(k,k.next)}function d(O,x){var k=x,F=O.x,P=O.y,z=-1/0,Y;do{if(P<=k.y&&P>=k.next.y&&k.next.y!==k.y){var tt=k.x+(P-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(tt<=F&&tt>z&&(z=tt,Y=k.x<k.next.x?k:k.next,tt===F))return Y}k=k.next}while(k!==x);if(!Y)return null;var it=Y,nt=Y.x,at=Y.y,pt=1/0,ft;k=Y;do F>=k.x&&k.x>=nt&&F!==k.x&&E(P<at?F:z,P,nt,at,P<at?z:F,P,k.x,k.y)&&(ft=Math.abs(P-k.y)/(F-k.x),B(k,O)&&(ft<pt||ft===pt&&(k.x>Y.x||k.x===Y.x&&p(Y,k)))&&(Y=k,pt=ft)),k=k.next;while(k!==it);return Y}function p(O,x){return S(O.prev,O,x.prev)<0&&S(x.next,O,O.next)<0}function m(O,x,k,F){var P=O;do P.z===0&&(P.z=b(P.x,P.y,x,k,F)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==O);P.prevZ.nextZ=null,P.prevZ=null,g(P)}function g(O){var x,k,F,P,z,Y,tt,it,nt=1;do{for(k=O,O=null,z=null,Y=0;k;){for(Y++,F=k,tt=0,x=0;x<nt&&(tt++,F=F.nextZ,!!F);x++);for(it=nt;tt>0||it>0&&F;)tt!==0&&(it===0||!F||k.z<=F.z)?(P=k,k=k.nextZ,tt--):(P=F,F=F.nextZ,it--),z?z.nextZ=P:O=P,P.prevZ=z,z=P;k=F}z.nextZ=null,nt*=2}while(Y>1);return O}function b(O,x,k,F,P){return O=(O-k)*P|0,x=(x-F)*P|0,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,x=(x|x<<8)&16711935,x=(x|x<<4)&252645135,x=(x|x<<2)&858993459,x=(x|x<<1)&1431655765,O|x<<1}function y(O){var x=O,k=O;do(x.x<k.x||x.x===k.x&&x.y<k.y)&&(k=x),x=x.next;while(x!==O);return k}function E(O,x,k,F,P,z,Y,tt){return(P-Y)*(x-tt)>=(O-Y)*(z-tt)&&(O-Y)*(F-tt)>=(k-Y)*(x-tt)&&(k-Y)*(z-tt)>=(P-Y)*(F-tt)}function _(O,x){return O.next.i!==x.i&&O.prev.i!==x.i&&!M(O,x)&&(B(O,x)&&B(x,O)&&q(O,x)&&(S(O.prev,O,x.prev)||S(O,x.prev,x))||A(O,x)&&S(O.prev,O,O.next)>0&&S(x.prev,x,x.next)>0)}function S(O,x,k){return(x.y-O.y)*(k.x-x.x)-(x.x-O.x)*(k.y-x.y)}function A(O,x){return O.x===x.x&&O.y===x.y}function w(O,x,k,F){var P=L(S(O,x,k)),z=L(S(O,x,F)),Y=L(S(k,F,O)),tt=L(S(k,F,x));return!!(P!==z&&Y!==tt||P===0&&R(O,k,x)||z===0&&R(O,F,x)||Y===0&&R(k,O,F)||tt===0&&R(k,x,F))}function R(O,x,k){return x.x<=Math.max(O.x,k.x)&&x.x>=Math.min(O.x,k.x)&&x.y<=Math.max(O.y,k.y)&&x.y>=Math.min(O.y,k.y)}function L(O){return O>0?1:O<0?-1:0}function M(O,x){var k=O;do{if(k.i!==O.i&&k.next.i!==O.i&&k.i!==x.i&&k.next.i!==x.i&&w(k,k.next,O,x))return!0;k=k.next}while(k!==O);return!1}function B(O,x){return S(O.prev,O,O.next)<0?S(O,x,O.next)>=0&&S(O,O.prev,x)>=0:S(O,x,O.prev)<0||S(O,O.next,x)<0}function q(O,x){var k=O,F=!1,P=(O.x+x.x)/2,z=(O.y+x.y)/2;do k.y>z!=k.next.y>z&&k.next.y!==k.y&&P<(k.next.x-k.x)*(z-k.y)/(k.next.y-k.y)+k.x&&(F=!F),k=k.next;while(k!==O);return F}function H(O,x){var k=new v(O.i,O.x,O.y),F=new v(x.i,x.x,x.y),P=O.next,z=x.prev;return O.next=x,x.prev=O,k.next=P,P.prev=k,F.next=k,k.prev=F,z.next=F,F.prev=z,F}function V(O,x,k,F){var P=new v(O,x,k);return F?(P.next=F.next,P.prev=F,F.next.prev=P,F.next=P):(P.prev=P,P.next=P),P}function W(O){O.next.prev=O.prev,O.prev.next=O.next,O.prevZ&&(O.prevZ.nextZ=O.nextZ),O.nextZ&&(O.nextZ.prevZ=O.prevZ)}function v(O,x,k){this.i=O,this.x=x,this.y=k,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(O,x,k,F){var P=x&&x.length,z=P?x[0]*k:O.length,Y=Math.abs(j(O,0,z,k));if(P)for(var tt=0,it=x.length;tt<it;tt++){var nt=x[tt]*k,at=tt<it-1?x[tt+1]*k:O.length;Y-=Math.abs(j(O,nt,at,k))}var pt=0;for(tt=0;tt<F.length;tt+=3){var ft=F[tt]*k,xt=F[tt+1]*k,gt=F[tt+2]*k;pt+=Math.abs((O[ft]-O[gt])*(O[xt+1]-O[ft+1])-(O[ft]-O[xt])*(O[gt+1]-O[ft+1]))}return Y===0&&pt===0?0:Math.abs((pt-Y)/Y)};function j(O,x,k,F){for(var P=0,z=x,Y=k-F;z<k;z+=F)P+=(O[Y]-O[z])*(O[z+1]+O[Y+1]),Y=z;return P}i.flatten=function(O){for(var x=O[0][0].length,k={vertices:[],holes:[],dimensions:x},F=0,P=0;P<O.length;P++){for(var z=0;z<O[P].length;z++)for(var Y=0;Y<x;Y++)k.vertices.push(O[P][z][Y]);P>0&&(F+=O[P-1].length,k.holes.push(F))}return k}}),v0=(t=>(t[t.MIL=1]="MIL",t[t.INCH=1e3]="INCH",t[t.FT=12e3]="FT",t[t.YARD=36e3]="YARD",t[t.MILE=6336e4]="MILE",t[t.KM=3937007874e-2]="KM",t[t.M=39370]="M",t[t.DM=3937]="DM",t[t.CM=393.7]="CM",t[t.MM=39.37]="MM",t[t.UM=.039]="UM",t[t.NM=394e-7]="NM",t[t.PT=13.88888888888889]="PT",t[t.PX72=13.88888888888889]="PX72",t[t.PX96=10.416666666666666]="PX96",t[t.PX100=10]="PX100",t[t.LTSPICE=6.25]="LTSPICE",t[t.PX1=.1]="PX1",t[t.PX001=.001]="PX001",t))(v0||{}),x0=(t=>(t.MIL="mil",t.INCH="inch",t.FT="ft",t.YARD="yard",t.MILE="mile",t.KM="km",t.M="m",t.DM="dm",t.CM="cm",t.MM="mm",t.UM="um",t.NM="nm",t.PT="pt",t.PX72="px(72)",t.PX96="px(96)",t.PX100="px(100)",t))(x0||{}),bl={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},u_=(()=>{let t={};for(let e in bl)t[bl[e]]=e;return t})();var Os,c_=(Os=class{constructor(e,i){this.ratio=e/i}wrap(e){return e*this.ratio}static convert(e,i,s){return e*i/s}},Os.ASIS=new Os(1,1),Os),dn=class{conversion(t,e,i){if(t===e)return i;let s=t+2+e;return this[s](i)}conversion1(t,e,i){let s=t+2+e,r=this[s](i);return e=="mil"?Math.round(r*10)/10:Math.round(r*1e3)/1e3}mil2mil(t){return t}mil2mm(t){return t*.0254}mil2cm(t){return t*.00254}mil2inch(t){return t/1e3}mm2mm(t){return t}mm2mil(t){let e=Math.pow(10,5);return Math.round(t*39.37007874015748*e)/e}mm2cm(t){return t/10}mm2inch(t){let e=Math.pow(10,8);return Math.round(t*.03937007874015748*e)/e}cm2mil(t){let e=Math.pow(10,6);return Math.round(t*393.7007874015748*e)/e}cm2mm(t){return t*10}cm2inch(t){let e=Math.pow(10,7);return Math.round(t*.3937007874015748*e)/e}inch2mil(t){return t*1e3}inch2mm(t){return t*25.4}inch2cm(t){return t*2.54}};dn.prototype["px(100)2mil"]=t=>t*10,dn.prototype["px(100)2mm"]=t=>t*.254,dn.prototype["mil2px(100)"]=t=>t/10,dn.prototype["mm2px(100)"]=t=>{let e=Math.pow(10,5);return Math.round(t*3.937007874015748*e)/e};var pn=null,vo=new ArrayBuffer(8),Pa=new Float64Array(vo),La=new Uint32Array(vo),_l=new Uint16Array(vo);var Sl=class{static repeat(t,e){let i=new Array(e);for(;e-- >0;)i[e]=t;return i.join("")}static lpad(t,e,i){let s=i-t.length;return s>0?this.repeat(e,s)+t:t}static rpad(t,e,i){let s=i-t.length;return s>0?t+this.repeat(e,s):t}static strHashcode(t){if(t.length>0){let e=0;for(let i=0;i<t.length;i++)e=31*e+t.charCodeAt(i)|0;return e}else return 0}static arraycopy(t,e,i,s,r){if(t.length>=e+r&&i.length>=s+r)for(;r-- >0;)i[s++]=t[e++];else throw new Error("arraycopy out of range")}static undefAsNull(t){return null}static reverse(t,e){for(let i=0,s=t.length-1;s>=0;i++,s--)e[i]=t[s];return e}static sortAsc(t,e){return t-e}static xmlDecode(t){let e=t.length,i=new Array,s=-1;for(let r=0;r<e;r++){let n=t.charAt(r);if(s>=0){if(n===";"){let a=t.substring(s+1,r);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}s=-1}}else n==="&"?s=r:i.push(n)}return s>=0&&i.push(t.substring(s)),i.join("")}static addAll(t,e){for(let i of e)t.push(i)}static addAllSet(t,e){for(let i of e)t.add(i)}static contains(t,e){for(let i of t)if(i.equals(e))return!0;return!1}static equals(t,e){if(t.length==e.length){for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}else return!1}static remove(t,e){let i=0,s=t.length;for(let r=0;r<s;r++)t[r]===e&&(t.splice(r,1),r--,s--,i++);return i}static getUrlVars(){for(var t={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<e.length;i++){var s=e[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}static prefix(){if(!pn){let t=this.getUrlVars().version;t?pn="/analyzer/v"+t:pn="/analyzer"}return pn}static add2objS(t,e,i){if(e in t)return t[e];{let s=i(e);return t[e]=s,s}}static downloadFile(t,e){let i=document.createElement("a"),s=URL.createObjectURL(e);i.download=t,i.href=s,i.click(),URL.revokeObjectURL(s)}static uuid(){let t=new Array;Pa[0]=new Date().getTime(),t.push(La[1].toString(16)),Pa[0]=Math.random(),t.push(_l[3].toString(16));let e=_l[2].toString(16);t.push("4"+e.substr(0,3)),Pa[0]=performance.now();let i=La[0].toString(16)+La[1].toString(16);return t.push("0"+i.substr(0,3)),t.push(i.substr(3)),t.join("-")}static funcCopy(t){return(0,eval)("("+t.toString()+")")}static NVL(...t){for(let e of t)if(e!==null)return e;return null}static isSingle(t){return Array.from(new Set(t)).length===t.length}};var Lu=class{static rgb(t){if(0<=t&&t<=255)return t;throw new Error($s.format("RGB should not nagative and not over 255(0xFF): %X",t))}static normal(t){if(isFinite(t))return t;throw new Error($s.format("%f is not permitted",t))}static positiveOr0(t){if(t>=0)return t;throw new Error($s.format("%f must >= 0",t))}static positive(t){if(t>0)return t;throw new Error($s.format("%f must > 0",t))}static notnull(t){if(t!=null)return t;throw new Error("invalid null value")}static mustnull(t){if(t===null)return null;throw new Error("value must be null")}static notEmpty(t){if(t==null||t.length===0)throw new Error("invalid empty string");return t}static nullOrEmpty(t){return t==null||t.length===0}static notNullOrUndef(t){if(t!=null)return t;throw new Error("null or undefined is not permitted")}},M0=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.PERCENT=1]="PERCENT",t[t.LEFT_PAD0=2]="LEFT_PAD0",t))(M0||{}),B0=/(\.?0+)$/,$s=class{static format(t,...e){return this.format1(t,e)}static format1(t,e){let i=this._format(t,e);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,t))}static _format(t,e){let i=[],s=0,r=0,n,a=0,o=0;for(let l=0;l<t.length;l++){let u=t.charAt(l),c=u.charCodeAt(0);switch(s){case 0:c===37?s=1:i.push(u);break;case 1:switch(c){case 100:if(n=e[r++],typeof n=="number")i.push(n.toFixed(0)),s=0;else return l;break;case 102:if(n=e[r++],typeof n=="number")i.push(n.toString()),s=0;else return l;break;case 120:if(n=e[r++],typeof n=="number")i.push((n|0).toString(16)),s=0;else return l;break;case 88:if(n=e[r++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),s=0;else return l;break;case 115:case 99:n=e[r++],i.push(n===null?"null":n.toString()),s=0;break;case 48:a=l+1,o=-1,s=2;break;case 37:i.push("%"),s=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Sl.lpad((n|0).toString(16),"0",h)),s=0;else return l}else return l;break;case 88:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Sl.lpad((n|0).toString(16).toUpperCase(),"0",h)),s=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(t,e){return t.length>=e.length?t.substring(0,e.length)===e:!1}static endsWith(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}static split(t,e){let i=new Array,s=0;for(;;){let r=t.exec(e);if(r!==null){let n=t.lastIndex-r[0].length;i.push(e.substring(s,n)),s=t.lastIndex}else{let n=e.substring(s);Lu.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(t){return t.toFixed(5).replace(B0,"")}},k0=(t=>(t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.ERROR=3]="ERROR",t[t.DUMMY=4]="DUMMY",t))(k0||{});function F0(t){switch(t){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var U0=(t,e)=>{t===3?console.error(e):console.log(e)},j0=(t,e)=>$s.format("%s %s: %s",new Date,F0(t),e),ki,ya=(ki=class{constructor(e,i=U0,s=j0){this.debug=!1,this.level=e,this.writer=i,this.fmt=s}static mix(...e){let i=4;for(let s of e)s.level<i&&(i=s.level);return new ki(i,(s,r)=>{for(let n of e)n.write1(s,r)},(s,r)=>r)}wrap(e=null,i=null){let s=e===null?this.fmt:(n,a)=>(a=e(n,a),this.fmt(n,a)),r=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new ki(this.level,r,s)}chain(e){return e.wrap(this.fmt.bind(this),this.writer.bind(this))}include(e){return this.level<=e}write3(e,i,s){this.include(e)&&this.writer(e,this.fmt(e,$s.format(i,...s)))}write2(e,i){this.include(e)&&(i instanceof Error?this.writer(e,this.fmt(e,i.stack)):this.writer(e,this.fmt(e,i.toString())))}write1(e,i){this.include(e)&&this.writer(e,this.fmt(e,i))}debug3(e,...i){this.write3(0,e,i)}debug2(e){this.write2(0,e)}debug1(e){this.write1(0,e)}info3(e,...i){this.write3(1,e,i)}info2(e){this.write2(1,e)}info1(e){this.write1(1,e)}warning3(e,...i){this.write3(2,e,i)}warning2(e){this.write2(2,e)}warning1(e){this.write1(2,e)}error3(e,...i){this.write3(3,e,i)}error2(e){this.write2(3,e)}error1(e){this.write1(3,e)}},ki.DUMMY=new ki(4),ki),xo=new ArrayBuffer(8),va=new Float64Array(xo),xa=new Uint32Array(xo),Il=new Uint16Array(xo),Al=ArrayBuffer;try{Al=self.HTMLImageElement||Al}catch{}var fn=null;function Ds(t,e,i=0,s=t.length){r(t,null,e,i,s);function r(a,o,l,u,c){let h,f,d,p;if(u<c-1){let m=c-u;if(m>50)o===null&&(o=new Array(m+1)),n(a,o,l,u,(u+c)/2|0,c);else{h=a[u],f=u,d=u,p=c;let g=f+1;for(;g<p;){if(d!=p){if(p=p+-1,l(h,a[p])<=0)continue;a[d]=a[p],d=p;continue}if(l(h,a[g])>=0){f=g,g=f+1;continue}a[d]=a[g],f=g,d=g,g=f+1}a[d]=h,r(a,o,l,u,d),r(a,o,l,d+1,c)}}}function n(a,o,l,u,c,h){r(a,o,l,u,c),r(a,o,l,c,h);for(var f=u,d=c,p=0,m=a[f],g=a[d];f<c&&d<h;){var b=l(m,g);isNaN(b)?(o[p++]=g,g=a[++d]):(b<=0&&(o[p++]=m,m=a[++f]),b>=0&&(o[p++]=g,g=a[++d]))}for(;f<c;f++)o[p++]=a[f];for(;d<h;d++)o[p++]=a[d];for(f=u,d=0;d<p;f++,d++)a[f]=o[d]}}var Pe=class{static repeat(t,e){let i=new Array(e);for(;e-- >0;)i[e]=t;return i.join("")}static lpad(t,e,i){let s=i-t.length;return s>0?this.repeat(e,s)+t:t}static rpad(t,e,i){let s=i-t.length;return s>0?t+this.repeat(e,s):t}static strHashcode(t){if(t.length>0){let e=0;for(let i=0;i<t.length;i++)e=31*e+t.charCodeAt(i)|0;return e}else return 0}static arraycopy(t,e,i,s,r){if(t.length>=e+r&&i.length>=s+r)for(;r-- >0;)i[s++]=t[e++];else throw new Error("arraycopy out of range")}static undefAsNull(t){return null}static reverse(t,e){for(let i=0,s=t.length-1;s>=0;i++,s--)e[i]=t[s];return e}static sortAsc(t,e){return t-e}static xmlDecode(t){let e=t.length,i=new Array,s=-1;for(let r=0;r<e;r++){let n=t.charAt(r);if(s>=0){if(n===";"){let a=t.substring(s+1,r);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}s=-1}}else n==="&"?s=r:i.push(n)}return s>=0&&i.push(t.substring(s)),i.join("")}static addAll(t,e){for(let i of e)t.push(i)}static addAllSet(t,e){for(let i of e)t.add(i)}static contains(t,e){for(let i of t)if(i.equals(e))return!0;return!1}static equals(t,e){if(t.length==e.length){for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}else return!1}static remove(t,e){let i=0,s=t.length;for(let r=0;r<s;r++)t[r]===e&&(t.splice(r,1),r--,s--,i++);return i}static getUrlVars(){for(var t={},e=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<e.length;i++){var s=e[i].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}static prefix(){if(!fn){let t=this.getUrlVars().version;t?fn="/analyzer/v"+t:fn="/analyzer"}return fn}static add2objS(t,e,i){if(e in t)return t[e];{let s=i(e);return t[e]=s,s}}static downloadFile(t,e){let i=document.createElement("a"),s=URL.createObjectURL(e);i.download=t,i.href=s,i.click(),URL.revokeObjectURL(s)}static uuid(){let t=new Array;va[0]=new Date().getTime(),t.push(xa[1].toString(16)),va[0]=Math.random(),t.push(Il[3].toString(16));let e=Il[2].toString(16);t.push("4"+e.substr(0,3)),va[0]=performance.now();let i=xa[0].toString(16)+xa[1].toString(16);return t.push("0"+i.substr(0,3)),t.push(i.substr(3)),t.join("-")}static funcCopy(t){return(0,eval)("("+t.toString()+")")}static NVL(...t){for(let e of t)if(e!==null)return e;return null}static isSingle(t){return Array.from(new Set(t)).length===t.length}},G0=[1,10,100,1e3];var mn=0,fs=0;function Ol(t,e,i){return mn=Math.abs(t-e),i>=5&&mn>1e-5||isNaN(i)&&mn>1e-8?!1:mn<1e-13?!0:(fs=Math.min(Rl(t),Rl(e)),fs<10&&(fs=10),isNaN(i)||(fs=Math.min(fs,i)),Dl(t,fs)===Dl(e,fs))}var gn=0,En=0;function Rl(t){return gn=0,En=0,t>0?gn=t-Math.floor(t):gn=t-Math.ceil(t),En=(gn.toString()||"").length,En>2?En-2:0}function Dl(t,e,i){if(typeof t!="number"&&(t=+t),isNaN(t))return NaN;if(e=e|0,e<=0||!t&&!i)return Math.round(t);var s=G0[e]||Math.pow(10,e)||10;if(i){var r=t<0?"-":"";for(t=t<0?-t:t,t=Math.round(t*s)+"";t.length<=e;)t="0"+t;return t=t.slice(0,-e)+"."+t.slice(-e),parseFloat(r+t)}else return Math.round(t*s+1e-10)/s}var H0=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.PERCENT=1]="PERCENT",t[t.LEFT_PAD0=2]="LEFT_PAD0",t))(H0||{}),Y0=/(\.?0+)$/,Zs=class{static format(t,...e){return this.format1(t,e)}static format1(t,e){let i=this._format(t,e);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,t))}static _format(t,e){let i=[],s=0,r=0,n,a=0,o=0;for(let l=0;l<t.length;l++){let u=t.charAt(l),c=u.charCodeAt(0);switch(s){case 0:c===37?s=1:i.push(u);break;case 1:switch(c){case 100:if(n=e[r++],typeof n=="number")i.push(n.toFixed(0)),s=0;else return l;break;case 102:if(n=e[r++],typeof n=="number")i.push(n.toString()),s=0;else return l;break;case 120:if(n=e[r++],typeof n=="number")i.push((n|0).toString(16)),s=0;else return l;break;case 88:if(n=e[r++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),s=0;else return l;break;case 115:case 99:n=e[r++],i.push(n===null?"null":n.toString()),s=0;break;case 48:a=l+1,o=-1,s=2;break;case 37:i.push("%"),s=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Pe.lpad((n|0).toString(16),"0",h)),s=0;else return l}else return l;break;case 88:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Pe.lpad((n|0).toString(16).toUpperCase(),"0",h)),s=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(t,e){return t.length>=e.length?t.substring(0,e.length)===e:!1}static endsWith(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}static split(t,e){let i=new Array,s=0;for(;;){let r=t.exec(e);if(r!==null){let n=t.lastIndex-r[0].length;i.push(e.substring(s,n)),s=t.lastIndex}else{let n=e.substring(s);Jt.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(t){return t.toFixed(5).replace(Y0,"")}},Jt=class{static rgb(t){if(0<=t&&t<=255)return t;throw new Error(Zs.format("RGB should not nagative and not over 255(0xFF): %X",t))}static normal(t){if(isFinite(t))return t;throw new Error(Zs.format("%f is not permitted",t))}static positiveOr0(t){if(t>=0)return t;throw new Error(Zs.format("%f must >= 0",t))}static positive(t){if(t>0)return t;throw new Error(Zs.format("%f must > 0",t))}static notnull(t){if(t!=null)return t;throw new Error("invalid null value")}static mustnull(t){if(t===null)return null;throw new Error("value must be null")}static notEmpty(t){if(t==null||t.length===0)throw new Error("invalid empty string");return t}static nullOrEmpty(t){return t==null||t.length===0}static notNullOrUndef(t){if(t!=null)return t;throw new Error("null or undefined is not permitted")}},Rs,Z=(Rs=class{static regular(e){return Math.round(e*this.precision)/this.precision}static eq(e,i){return Math.abs(e-i)<=this.eps}static neq(e,i){return Math.abs(e-i)>this.eps}static less(e,i){return e-i<-this.eps}static lesseq(e,i){return e-i<=this.eps}static greater(e,i){return e-i>this.eps}static greatereq(e,i){return e-i>=-this.eps}static sqrt(e){return Math.abs(e)<=1e-10?0:Math.sqrt(e)}static sortAsc(e,i){return e-i}static sortDesc(e,i){return i-e}},Rs.eps=1e-8,Rs.precision=1e8,Rs);function sr(t,e){Wn(t.iterator(),e)}function Wn(t,e){let i=0;for(;t.hasNext();){let s=t.next();e(i++,s)}}var V0=class{constructor(t){this.idx=-1,this.lst=t}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function io(t){return new V0(t)}var pe,mt=(pe=class{static toDegrees(e){return e*180/Math.PI}static toRadians(e){return e/180*Math.PI}static regularD(e){return e=e%360,e=e<0?360+e:e,e===360?0:e}static regular(e){return e=e%pe.PIx2,e=e<0?pe.PIx2+e:e,e===pe.PIx2?0:e}static toQuarterBase(e){return pe.regular((e+pe.PI_4)/pe.PI_2*pe.PI_2)}static toQuarterBaseD(e){return pe.regularD(((e+45)/90|0)*90)}static transformD(e,i){return pe.toDegrees(pe.transform(pe.toRadians(e),i))}static transform(e,i){let s=Math.cos(e),r=Math.sin(e),n=new X(i.data[6],i.data[7]),a=new X(s,r).multiply3(i);return pe.regular(a.angle(n))}},pe.PIx2=Math.PI*2,pe.PI_2=Math.PI/2,pe.PI_4=Math.PI/4,pe),Qt=class{static dotProd1(t,e,i,s){return t*i+e*s}static dotProd2(t,e,i,s,r,n){return this.dotProd1(i-t,s-e,r-i,n-s)}static dotProd3(t,e,i){return this.dotProd2(t.x,t.y,e.x,e.y,i.x,i.y)}static crossProd1(t,e,i,s){return t*s-e*i}static crossProd2(t,e,i,s,r,n){return this.crossProd1(i-t,s-e,r-i,n-s)}static crossProd3(t,e,i){return this.crossProd2(t.x,t.y,e.x,e.y,i.x,i.y)}static distance2(t,e,i,s){let r=i-t,n=s-e;return r*r+n*n}static distance1(t,e,i,s){return this.hypot(i-t,s-e)}static distance1p(t,e){return this.distance1(t.x,t.y,e.x,e.y)}static hypot(t,e){if(t=Math.abs(t),e=Math.abs(e),e>t){var i=e;e=t,t=i}if(t===0)return e;var s=e/t;return t*Math.sqrt(1+s*s)}},vu=new ArrayBuffer(16),wl=new Float64Array(vu),yn=new Int32Array(vu),wt,X=(wt=class{static sortByXAsc(e,i){return e.x-i.x}static sortByYAsc(e,i){return e.y-i.y}static sortByXYAsc(e,i){return e.x<i.x?-1:e.x>i.x?1:e.y-i.y}static caculateAngle(e,i){let s=Math.cos(e),r=Math.sin(e),n=s*i.data[0]+r*i.data[4],a=s*i.data[1]+r*i.data[5],o=new wt(n,a).normalize();return Math.atan2(o.y,o.x)}static normal(e,i,s){let r=i.sub(e),n=s.sub(i);return r.cross(n)}static getVector2(e){return new wt(Math.cos(e),Math.sin(e))}static getCrossPoint1(e,i,s,r){if(e.equals1(i)||s.equals1(r)||Z.eq(1,Math.abs(i.sub(e).normalize().dot(r.sub(s).normalize()))))return null;let n=i.y-e.y,a=e.x-i.x,o=i.x*e.y-e.x*i.y,l=r.y-s.y,u=s.x-r.x,c=r.x*s.y-s.x*r.y,h=n*u-l*a;return new wt((c*a-o*u)/h,(o*l-c*n)/h)}static getCrossPoint2(e,i,s,r){return this.getCrossPoint1(e,e.add(i),s,s.add(r))}constructor(e,i){this.x=Jt.normal(e),this.y=Jt.normal(i)}get hashed(){return this._hashed==null&&(wl[0]=this.x,wl[1]=this.y,this._hashed=yn[0]^yn[1]^yn[2]^yn[3]),this._hashed}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(e){var i=this.x-e.x,s=this.y-e.y;return new wt(i,s)}add(e){var i=this.x+e.x,s=this.y+e.y;return new wt(i,s)}div(e){return new wt(this.x/e,this.y/e)}add1(e,i){return new wt(this.x+e,this.y+i)}mul(e){return new wt(this.x*e,this.y*e)}cross(e){return this.x*e.y-this.y*e.x}getSin(){return this.y/this.length()}angle2(e){let i=this.y-e.y,s=this.x-e.x;return i=Math.abs(i-0)<10**-4?0:i,s=Math.abs(s-0)<10**-4?0:s,Math.atan2(i,s)}angleD2(e){return mt.toDegrees(this.angle2(e))}angle(e){return Math.atan2(this.y-e.y,this.x-e.x)}angleX(e=wt.ORIGIN){let i=this.angle(e);return i<0&&(i=Math.PI*2+i),i}angleD(e){return mt.toDegrees(this.angle(e))}distance1(e){let i=e.x-this.x,s=e.y-this.y;return Qt.hypot(i,s)}distance2(e){let i=e.x-this.x,s=e.y-this.y;return i*i+s*s}rotateD(e,i){return this.rotate(e,mt.toRadians(i))}rotate(e,i){let s=Math.cos(i),r=Math.sin(i),n=this.x-e.x,a=this.y-e.y,o=n*s+a*-r,l=n*r+a*s;return e.add1(o,l)}multiply3(e){let i=this.x*e.data[0]+this.y*e.data[3]+e.data[6],s=this.x*e.data[1]+this.y*e.data[4]+e.data[7];return new wt(i,s)}multiply4(e){let i=this.x*e.data[0]+this.y*e.data[4]+e.data[12],s=this.x*e.data[1]+this.y*e.data[5]+e.data[13];return new wt(i,s)}hashCode(){return this.hashed}equals(e,i){return e instanceof wt?Ol(e.x,this.x,i)&&Ol(e.y,this.y,i):!1}equals1(e){return e?Z.eq(this.x,e.x)&&Z.eq(this.y,e.y):!1}equals2(e,i){return e instanceof wt?Math.abs(this.x-e.x)<=i&&Math.abs(this.y-e.y)<=i:!1}similarEquals(e,i=.5){return Math.abs(this.x*.1-e.x*.1)<=i&&Math.abs(this.y*.1-e.y*.1)<=i}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let e=this.x,i=this.y;return new Ne(e,e,i,i)}normalize(){if(this.x===0&&this.y===0)return new wt(0,0);let e=this.x/this.length(),i=this.y/this.length();return new wt(e,i)}regular(e=1e-4){let i=Math.round(1/e);return new wt(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}round(e=4){let i=10**(e|0);return new wt(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}mirrorX(e=wt.ORIGIN){return new wt(this.x,2*e.y-this.y)}mirrorY(e=wt.ORIGIN){return new wt(2*e.x-this.x,this.y)}mirrorCenter(e=wt.ORIGIN){return new wt(2*e.x-this.x,2*e.y-this.y)}clone(){return new wt(this.x,this.y)}mirror(e=wt.ORIGIN){return new wt(2*e.x-this.x,2*e.y-this.y)}pointOnRays(e,i){let s=mt.toRadians(e);return new wt(this.x+Math.cos(s)*i,this.y+Math.sin(s)*i)}pointOnRays2(e,i){let s=e.angle(this);return new wt(this.x+Math.cos(s)*i,this.y+Math.sin(s)*i)}scale(e){return new wt(this.x*e,this.y*e)}},wt.ORIGIN=new wt(0,0),wt.X_UNIT_VECTOR=new wt(1,0),wt.Y_UNIT_VECTOR=new wt(0,1),wt),z0=(t=>(t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT",t))(z0||{}),X0=(t=>(t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM",t))(X0||{}),re,Ci=(re=class{constructor(e,i){this.horizontal=e,this.vertical=i}},re.LT=new re(0,0),re.LC=new re(0,1),re.LB=new re(0,2),re.CT=new re(1,0),re.CC=new re(1,1),re.CB=new re(1,2),re.RT=new re(2,0),re.RC=new re(2,1),re.RB=new re(2,2),re),q0=(t=>(t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER",t[t.SEPARATED=2]="SEPARATED",t[t.INTERSECTED=3]="INTERSECTED",t[t.EQ=4]="EQ",t[t.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",t[t.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",t))(q0||{}),Fe=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(t){return this.minX=Math.min(this.minX,t.minX),this.maxX=Math.max(this.maxX,t.maxX),this.minY=Math.min(this.minY,t.minY),this.maxY=Math.max(this.maxY,t.maxY),this}ext2(t){return this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y),this}ext3(t){for(let e=0;e<t.length;e++){let i=t[e];this.ext2(i)}return this}ext4(t){return sr(t,(e,i)=>(this.ext2(i),!0)),this}ext5(t,e,i,s){return this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,i),this.maxY=Math.max(this.maxY,s),this}ext6(t,e){return this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e),this}ext7(t){if(t<0){let e=t*2;if(e<this.minX-this.maxX||e<this.minY-this.maxY)throw new Error("")}return this.minX-=t,this.maxX+=t,this.minY-=t,this.maxY+=t,this}ext8(t){let e=[];for(let i=0;i<t.length;i+=2)e.push(new X(t[i],t[i+1]));return this.ext3(e)}ext9(t,e,i,s){return this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,t+i),this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e+s),this}ext10({x:t,y:e,width:i,height:s}){return this.ext9(t,e,i,s)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new Ne(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new Ne(this.minX,this.maxX,this.minY,this.maxY):new Ne(0,0,0,0)}},_r=new Float64Array(4),Ne=class $e{static extendRect({x:e,y:i,width:s,height:r}){return new $e(e,e+s,i,i+r)}static extend1(e,i){if(e===null)return new $e(i.x,i.x,i.y,i.y);{let s=Math.min(e.minX,i.x),r=Math.max(e.maxX,i.x),n=Math.min(e.minY,i.y),a=Math.max(e.maxY,i.y);return new $e(s,r,n,a)}}static extend2(e,i){if(e){let s=Math.min(e.minX,i.minX),r=Math.max(e.maxX,i.maxX),n=Math.min(e.minY,i.minY),a=Math.max(e.maxY,i.maxY);return new $e(s,r,n,a)}else return i}static extend3(e,i){let s=Math.min(e.x,i.x),r=Math.max(e.x,i.x),n=Math.min(e.y,i.y),a=Math.max(e.y,i.y);return new $e(s,r,n,a)}static extend4(e,i,s){return new $e(e.x-i/2,e.x+i/2,e.y-s/2,e.y+s/2)}constructor(e,i,s,r){if(this.minX=Jt.normal(e),this.maxX=Jt.normal(i),this.minY=Jt.normal(s),this.maxY=Jt.normal(r),e>i||s>r)throw new Error(`min > max is not permitted: [${e}, ${i}, ${s}, ${r}]`)}get data(){return _r[0]=this.minX,_r[1]=this.maxX,_r[2]=this.minY,_r[3]=this.maxY,_r}isContains(e){return this.isContains1(e.x,e.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(e,i){return this.isContainsX(e)&&this.isContainsY(i)}isContains2(e,i){return this.isContainsX1(e)&&this.isContainsY1(i)}isContainsX(e){return e>=this.minX&&e<=this.maxX}isContainsX1(e){return Z.greatereq(e,this.minX)&&Z.lesseq(e,this.maxX)}isContainsY(e){return e>=this.minY&&e<=this.maxY}isContainsY1(e){return Z.greatereq(e,this.minY)&&Z.lesseq(e,this.maxY)}isIntersect(e){return!(this.maxX<e.minX||this.minX>e.maxX||this.maxY<e.minY||this.minY>e.maxY)}extendOfSize(e){return Jt.positiveOr0(this.maxX-this.minX+e*2),Jt.positiveOr0(this.maxY-this.minY+e*2),new $e(this.minX-e,this.maxX+e,this.minY-e,this.maxY+e)}isInside(e){return this.minX>=e.minX&&this.maxX<=e.maxX&&this.minY>=e.minY&&this.maxY<=e.maxY}isContainsBBox(e){return this.maxX>=e.maxX&&this.minX<=e.minX&&this.maxY>=e.maxY&&this.minY<=e.minY}isContainsBBox1(e){return Z.greatereq(this.maxX,e.maxX)&&Z.lesseq(this.minX,e.minX)&&Z.greatereq(this.maxY,e.maxY)&&Z.lesseq(this.minY,e.minY)}intersect(e){let i=Math.max(this.minX,e.minX),s=Math.min(this.maxX,e.maxX);if(i>s)return null;let r=Math.max(this.minY,e.minY),n=Math.min(this.maxY,e.maxY);return r>n?null:new $e(i,s,r,n)}intersection1(e){let i=Math.max(this.minX,e.minX),s=Math.min(this.maxX,e.maxX);if(Z.greater(i,s))return null;i>s&&(s=i);let r=Math.max(this.minY,e.minY),n=Math.min(this.maxY,e.maxY);return Z.greater(r,n)?null:(r>n&&(n=r),new $e(i,s,r,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new X(this.minX,this.maxY)}UR(){return new X(this.maxX,this.maxY)}LL(){return new X(this.minX,this.minY)}LR(){return new X(this.maxX,this.minY)}center(){return new X(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(e){let i=new Fe;return i.ext2(this.LL().multiply3(e)),i.ext2(this.LR().multiply3(e)),i.ext2(this.UR().multiply3(e)),i.ext2(this.UL().multiply3(e)),i.build()}transform4(e){let i=new Fe;return i.ext2(this.LL().multiply4(e)),i.ext2(this.LR().multiply4(e)),i.ext2(this.UR().multiply4(e)),i.ext2(this.UL().multiply4(e)),i.build()}isSeparated(e){if(e==null||e==null)return!1;let i;this.minX>=e.minX?i=this.minX:i=e.minX;let s;if(this.maxX<=e.maxX?s=this.maxX:s=e.maxX,i>s)return!0;{let r;this.minY>=e.minY?r=this.minY:r=e.minY;let n;return this.maxY<=e.maxY?n=this.maxY:n=e.maxY,r>n}}relation(e){let i=0,s=0,r;this.minX>e.minX?(i++,r=this.minX):this.minX===e.minX?r=this.minX:(s++,r=e.minX);let n;if(this.maxX<e.maxX?(i++,n=this.maxX):this.maxX===e.maxX?n=this.maxX:(s++,n=e.maxX),r>n)return 2;{let a;this.minY>e.minY?(i++,a=this.minY):this.minY===e.minY?a=this.minY:(s++,a=e.minY);let o;return this.maxY<e.maxY?(i++,o=this.maxY):this.maxY===e.maxY?o=this.maxY:(s++,o=e.maxY),a>o?2:i===4?0:s===4?1:i===0&&s===0?4:r===n||a===o?6:i!==s?5:3}}zoom(e){let i=this.width(),s=this.height(),r=this.center();return e!=0&&(i/=e/2,s/=e/2),new $e(r.x-i,r.x+i,r.y-i,r.y+i)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(e){return this.minY==e.minY&&this.minX==e.minX&&this.maxX==e.maxX&&this.maxY==e.maxY}extendSize(e,i){return Object.is(void 0,i)&&(i=e),$e.extend4(this.center(),this.width()+e,this.height()+i)}positionOnBBox(e,i=0){let s=this.center(),r=this.width()*i/2,n=this.height()*i/2,a=e.x-s.x,o=e.y-s.y;return a>r?o>n?Ci.RT:o<-n?Ci.RB:Ci.RC:a<-r?o>n?Ci.LT:o<-n?Ci.LB:Ci.LC:o>n?Ci.CT:o<-n?Ci.CB:Ci.CC}bbox(){return this}},Jn=class Nt{static mul(e,i,s,r,n,a){let o=0,l=0;for(let u=0;u<e;u++){for(let c=0;c<s;c++){let h=c,f=0;for(let d=0;d<i;d++)f+=r[l+d]*n[h],h+=s;a[o++]=f}l+=i}}constructor(e,i,s){this.m=Jt.normal(e),this.n=Jt.normal(i);let r=e*i;if(s.length===r){for(let n=0;n<s.length;n++)Jt.normal(s[n]);this.data=s}else throw new Error("invalid matrix size")}mul(e){if(this.n===e.m){let i=new Array(this.m*e.n);return Nt.mul(this.m,this.n,e.n,this.data,e.data,i),new Nt(this.m,e.n,i)}else throw new Error("m !== p")}toString(){let e=[];e.push("Matrix ("),e.push(this.m.toString()),e.push(" x "),e.push(this.n.toString()),e.push(")");let i=0;for(let s=0;s<this.m;s++)for(let r=0;r<this.n;r++){let n=this.data[i++].toString();r===0?(e.push(`
`),e.push("	"),e.push(n)):(e.push(", "),e.push(n))}return e.join("")}static on(e,i,s){return e*i+s}initExpandMatrix(e){let i=this.m,s=this.n,r=s*2,n=new Array(i*r);for(let a=0;a<i;a++)for(let o=0;o<r;o++)o<s?n[Nt.on(r,a,o)]=e[Nt.on(s,a,o)]:o===i+a?n[Nt.on(r,a,o)]=1:n[Nt.on(r,a,o)]=0;return n}inverseMatrix(e,i,s){for(let r=0;r<i;r++){let n=e[Nt.on(s,r,r)];for(let a=0;a<s;a++)e[Nt.on(s,r,a)]/=n}return e}getMatrixRank(e,i,s){let r=Math.min(i,s);for(let n=0;n<i;n++){if(e[Nt.on(s,n,n)]===0){let a=new Array(s),o;for(o=n;o<i;o++)if(e[Nt.on(s,o,n)]!==0){Pe.arraycopy(e,Nt.on(s,o,0),a,0,s),Pe.arraycopy(e,Nt.on(s,n,0),e,Nt.on(s,o,0),s),Pe.arraycopy(a,0,e,Nt.on(s,n,0),s);break}o>=i&&(r-=1)}if(!(r<i))for(let a=0;a<i;a++){if(a===n)continue;let o=e[Nt.on(s,a,n)]/e[Nt.on(s,n,n)];for(let l=0;l<s;l++)e[Nt.on(s,a,l)]-=e[Nt.on(s,n,l)]*o}}return r}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function e(a){return Z.lesseq(Math.abs(a),0)}let i=this.initExpandMatrix(this.data.slice(0)),s=this.n*2;function r(a,o){for(let l=0;l<s;l++){let u=i[Nt.on(s,a,l)];i[Nt.on(s,a,l)]=i[Nt.on(s,o,l)],i[Nt.on(s,o,l)]=u}}for(let a=0;a<this.m;a++){let o=Math.abs(i[Nt.on(s,a,a)]),l=a;if(e(i[Nt.on(s,a,a)]))for(let c=a+1;c<this.m;c++){if(e(i[Nt.on(s,c,a)])){Math.abs(i[Nt.on(s,c,a)])>o&&(o=Math.abs(i[Nt.on(s,c,a)]),l=c);continue}r(a,c);break}if(e(i[Nt.on(s,a,a)])){if(o===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),l!==a&&r(a,l)}let u=1/i[Nt.on(s,a,a)];for(let c=0;c<s;c++)i[Nt.on(s,a,c)]*=u;for(let c=0;c<this.m;c++){if(a===c)continue;let h=i[Nt.on(s,c,a)];for(let f=a;f<s;f++)i[Nt.on(s,c,f)]-=i[Nt.on(s,a,f)]*h}}let n=[];for(let a=0;a<this.m;a++)for(let o=this.n;o<s;o++)n[Nt.on(this.n,a,o-this.n)]=i[Nt.on(s,a,o)];return new Nt(this.m,this.n,n)}getTransposeMatrix(){let e=new Array(this.data.length);for(let i=0;i<this.m;i++)for(let s=0;s<this.n;s++)e[s*this.n+i]=this.data[i*this.m+s];return new Nt(this.n,this.m,e)}hashCode(){let e=0;for(let i of this.data)e+=i;return e}equals(e){return this===e?!0:e===null?!1:e instanceof Nt?!(this.m!=e.m||this.n!=e.n||!Pe.equals(this.data,e.data)):!1}},W0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ht,xu=(Ht=class extends Jn{static translate(e,i,s){return new Ht([1,0,0,0,0,1,0,0,0,0,1,0,e,i,s,1])}static translate1(e){return new Ht([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1])}static rotateX(e){let i=Math.cos(e),s=Math.sin(e);return new Ht([1,0,0,0,0,i,s,0,0,-s,i,0,0,0,0,1])}static rotateY(e){let i=Math.cos(e),s=Math.sin(e);return new Ht([i,0,-s,0,0,1,0,0,s,0,i,0,0,0,0,1])}static rotateZ(e){let i=Math.cos(e),s=Math.sin(e);return new Ht([i,s,0,0,-s,i,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(e,i){e=e.normalize();let s=e.x,r=e.y,n=e.z,a=Math.sin(i),o=Math.cos(i);return new Ht([s*s*(1-o)+o,s*r*(1-o)+n*a,s*n*(1-o)-r*a,0,s*r*(1-o)-n*a,r*r*(1-o)+o,r*n*(1-o)+s*a,0,s*n*(1-o)+r*a,r*n*(1-o)-s*a,n*n*(1-o)+o,0,0,0,0,1])}static scale(e,i=e,s=e){return new Ht([e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1])}static flipX(){return new Ht([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new Ht([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(e,i){return e.equals1(X.ORIGIN)?Ht.rotateZ(i):Ht.translate(-e.x,-e.y,0).rotateZ(i).translate1(e.x,e.y,0)}static getMatrix4(e,i,s,r){let n=Math.cos(i),a=Math.sin(i),o=s*(e.x*n-e.y*a)+r.x,l=e.x*a+e.y*n+r.y,u=[s*n,a,0,0,-a*s,n,0,0,0,0,1,0,o,l,0,1];return new Ht(u)}constructor(e=W0){super(4,4,e)}translate(e){return this.multiply4(Ht.translate1(e))}translate1(e,i,s){return this.multiply4(Ht.translate(e,i,s))}rotateX(e){return this.multiply4(Ht.rotateX(e))}rotateY(e){return this.multiply4(Ht.rotateY(e))}rotateZ(e){return this.multiply4(Ht.rotateZ(e))}scale(e,i=e,s=e){return this.multiply4(Ht.scale(e,i,s))}scale1(e){return this.multiply4(Ht.scale(e.x,e.y,e.z))}setOrigin(e,i,s){return Ht.translate(-e,-i,-s).multiply4(this).translate1(e,i,s)}setOrigin1(e){return this.setOrigin(e.x,e.y,e.z)}multiply4(e){let i=new Array(16);return Jn.mul(4,4,4,this.data,e.data,i),new Ht(i)}getInverseMatrix(){let e=super.getInverseMatrix();return new Ht(e.data)}getTransposeMatrix(){let e=super.getTransposeMatrix();return new Ht(e.data)}inverse(){let e=this.getInverseMatrix();return new Ht(e.data)}toMatrix3(){let e=this.data;return new Mt([e[0],e[1],0,e[4],e[5],0,e[12],e[13],1])}},Ht.ORIGIN=new Ht,Ht);function Sr(t){return Lu.normal(parseFloat(t))}var J0=[1,0,0,0,1,0,0,0,1],Ut,Mt=(Ut=class extends Jn{static translate(e,i){return new Ut([1,0,0,0,1,0,e,i,1])}static translate1(e){return this.translate(e.x,e.y)}static rotate(e){let i=Math.cos(e),s=Math.sin(e);return new Ut([i,s,0,-s,i,0,0,0,1])}static rotateD(e){return this.rotate(mt.toRadians(e))}static scale(e,i=e){return new Ut([e,0,0,0,i,0,0,0,1])}static scale1(e,i){return new Ut([e,0,0,0,i,0,0,0,1])}static toDOMMatrix(e){let[i,s,,r,n,,a,o]=e.data;return`matrix(${[i,s,r,n,a,o].join(",")})`}static svgTrasform(e){let i=e.split(" "),s=null;return i.forEach(r=>{r=r.trim();let n=r.trim().replace(")","").split("("),a=n[0],o=n[1].split(",");switch(a){case"translate":let l=Sr(o[0]),u=Sr(o[1]);s=s?s.translate(l,u):Ut.translate(l,u);break;case"rotate":let c=Sr(o[0]),h=Sr(o[1]),f=Sr(o[2]);s=s?s.setOrigin(h,f):Ut.translate(h,f),s=s.rotateD(c);break;default:return}}),s}constructor(e=J0){super(3,3,e);let i=e[0],s=e[3],r=e[1],n=e[4];this.iScale=Math.sqrt(i*i+r*r),this.jScale=Math.sqrt(s*s+n*n)}isMirrored(){return this.det()<0}multiply3(e){let i=new Array(9);return Jn.mul(3,3,3,this.data,e.data,i),new Ut(i)}translate(e,i){return this.multiply3(Ut.translate(e,i))}translate1(e){return this.multiply3(Ut.translate1(e))}scale(e,i=e){return this.multiply3(Ut.scale(e,i))}scale1(e,i){return this.multiply3(Ut.scale1(e,i))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let e=this.getInverseMatrix();return new Ut(e.data)}rotateD(e){return this.multiply3(Ut.rotateD(e))}rotate(e){return this.multiply3(Ut.rotate(e))}resetOffset(){let e=this.data;return new Ut([e[0],e[1],0,e[3],e[4],0,0,0,1])}setOrigin(e,i){return Ut.translate(-e,-i).multiply3(this).translate(e,i)}setOrigin1(e){return this.setOrigin(e.x,e.y)}getInverseMatrix(){return new Ut(super.getInverseMatrix().data)}getTransposeMatrix(){let e=super.getTransposeMatrix();return new Ut(e.data)}toMatrix4(){let e=this.data;return new xu([e[0],e[1],0,e[2],e[3],e[4],0,e[5],0,0,1,0,e[6],e[7],0,e[8]])}scaleNum(e){return!e||isNaN(e)?e:e*this.iScale}},Ut.ORIGIN=new Ut,Ut.MIRROR_Y=new Ut([1,0,0,0,-1,0,0,0,1]),Ut.MIRROR_X=new Ut([-1,0,0,0,1,0,0,0,1]),Ut.ROT_90=new Ut([0,1,0,-1,0,0,0,0,1]),Ut.ROT_N90=new Ut([0,-1,0,1,0,0,0,0,1]),Ut),K0=(t=>(t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t))(K0||{}),$i=(t=>(t[t.CW=0]="CW",t[t.CCW=1]="CCW",t))($i||{}),Qr=class{},so=class Cr{constructor(e,i,s){this.p1=e,this.p2=i,this.p3=s}barycentre(){return Cr.barycentre(this.p1,this.p2,this.p3)}incentre(){return Cr.incentre(this.p1,this.p2,this.p3)}static barycentre(e,i,s){let r=e.x+i.x+s.x,n=e.y+i.y+s.y;return new X(r/3,n/3)}static incentre(e,i,s){let r=i.sub(s).length(),n=e.sub(s).length(),a=e.sub(i).length(),o=r+n+a,l=r*e.x+n*i.x+a*s.x,u=r*e.y+n*i.y+a*s.y;return new X(l/o,u/o)}area(){return Cr.area(this.p1,this.p2,this.p3)}static area(e,i,s){return this.area2(e.x,e.y,i.x,i.y,s.x,s.y)/2}static area2(e,i,s,r,n,a){return Math.abs(Qt.crossProd2(e,i,s,r,n,a))}scale(e,i){let s=Mt.translate(-e.x,-e.y).scale(i).translate1(e),r=this.p1.multiply3(s),n=this.p2.multiply3(s),a=this.p3.multiply3(s);return new Cr(r,n,a)}scaleOnBarycentre(e){return this.scale(this.barycentre(),e)}scaleOnIncentre(e){return this.scale(this.incentre(),e)}extend(e){let i=this.incentre(),s=this.p1.add(this.p2).sub(i).scale(1/2),r=s.length(),n=X.ORIGIN.pointOnRays2(s,r+e).length()/r;return this.scaleOnIncentre(n)}container(e){let i=this.p3.sub(this.p1),s=this.p2.sub(this.p1),r=e.sub(this.p1),n=i.dot(i),a=i.dot(s),o=i.dot(r),l=s.dot(s),u=s.dot(r),c=1/(n*l-a*a),h=(l*o-a*u)*c;if(h<0||h>1)return!1;let f=(n*u-a*o)*c;return f<0||f>1?!1:h+f<=1}};function Tn(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var ci=class Ki{static getMinDistanceWithoutCross(e,i){let s=Tn();return Ki.minLine(e,i,s),s.minDistance}static getMinDistance(e,i){return ti(e,i)?0:this.getMinDistanceWithoutCross(e,i)}static getMinLineWithCross(e,i){let s=Tn();return Ki.minLine(e,i,s),new G(s.start,s.end)}static getMinLine(e,i){return Ki.intersection(e,i)||this.getMinLineWithCross(e,i)}static getMinDistanceFromPoint(e,i){let s=Tn();if(i instanceof G)this.point2LineMinLine(s,i,e);else if(i instanceof K)this.point2ArcMinDistance(e,i,s);else throw new Error("not support");return s.minDistance}constructor(e,i){if(this.pt1=e,this.pt2=i,this.minline=Ki.intersection(e,i),this.minline)this.minDistance=0;else{let s=Tn();Ki.minLine(e,i,s),this.minline=new G(s.start,s.end),this.minDistance=s.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(e,i){let s=ti(e,i);if(s===0)return;let r=new Array;for(let n=0;n<s;n+=2){let a=new X(N[n],N[n+1]);r.push(a)}return r.length>1?new G(r[0],r[1]):new G(r[0],r[0])}static minLine(e,i,s){if(e instanceof G&&i instanceof G)return this.minDistanceForLines(e,i,s);if(e instanceof K&&i instanceof G)return this.minDistanceForLineAndArc(e,i,s);if(e instanceof G&&i instanceof K)return this.minDistanceForLineAndArc(i,e,s);if(e instanceof K&&i instanceof K)return this.minDistanceForArcs(e,i,s);throw new Error("not support")}static minDistanceForLines(e,i,s){[e.start(),e.end(),i.start(),i.end()].forEach((r,n)=>{n<2?this.point2LineMinLine(s,i,r):this.point2LineMinLine(s,e,r)})}static minDistanceForLineAndArc(e,i,s){this.point2LineMinLine(s,i,e.start()),this.point2LineMinLine(s,i,e.svgEnd);let r=Ki.foot(i,e.center);i.bbox().extendOfSize(1e-8).isContains(r)&&this.point2ArcMinLine(s,e,r),this.point2ArcMinLine(s,e,i.start()),this.point2ArcMinLine(s,e,i.end())}static minDistanceForArcs(e,i,s){this.concentricArc(e,i,s),this.point2ArcMinDistance(i.start(),e,s),this.point2ArcMinDistance(i.svgEnd,e,s),this.point2ArcMinDistance(e.start(),i,s),this.point2ArcMinDistance(e.svgEnd,i,s),(ni(e,i.center)||ni(i,e.center))&&this.shortestLineForArcs(e,i,s)}static minLineForArcAndLine(e,i,s){let r=e.pointOn(s.angleD(e.center)),n=e.pointOn(e.center.angleD(s));this.arcShortestLine(e,i,s,r),this.arcShortestLine(e,i,s,n)}static arcInnerLineFootSegment(e,i,s){let r=s.distance1(e.center);if(r!==0){let n=e.rx*(s.y-e.center.y)/r+e.center.y,a=e.rx*(s.x-e.center.x)/r+e.center.x;r=e.rx-r,r<i.minDistance&&(i.minDistance=r,i.start=new X(a,n),i.end=s)}else r=e.rx-r,r<i.minDistance&&(i.minDistance=r,i.start=e.start(),i.end=s)}static shortestLineForArcs(e,i,s){let r=e.center.angleD(i.center),n=i.center.angleD(e.center),a=e.pointOn(r),o=e.pointOn(n),l=i.pointOn(r),u=i.pointOn(n);ni(e,a)&&(this.arcShortestLine(i,s,a,l),this.arcShortestLine(i,s,a,u)),ni(e,o)&&(this.arcShortestLine(i,s,o,l),this.arcShortestLine(i,s,o,u)),this.shortestLineForArcs1(e,i,s)}static shortestLineForArcs1(e,i,s){let r=i.start().sub(e.center).normalize(),n=i.end().sub(e.center).normalize(),a=e.start().sub(i.center).normalize(),o=e.end().sub(i.center).normalize(),l=e.center.add(r.mul(e.rx)),u=e.center.add(n.mul(e.rx)),c=i.center.add(a.mul(i.rx)),h=i.center.add(o.mul(i.rx));ni(e,l)&&Z.greater(i.start().distance2(e.center),0)&&this.arcShortestLine(e,s,i.start(),l),ni(e,u)&&Z.greater(i.end().distance2(e.center),0)&&this.arcShortestLine(e,s,i.end(),u),ni(i,c)&&Z.greater(e.start().distance2(i.center),0)&&this.arcShortestLine(i,s,e.start(),c),ni(i,h)&&Z.greater(e.end().distance2(i.center),0)&&this.arcShortestLine(i,s,e.end(),h)}static concentricArc(e,i,s){if(!(e.center.distance1(i.center)<1e-5&&e.rx===i.rx&&e.ry===i.ry))return;let r=e.start().distance1(i.svgEnd);r<s.minDistance&&(s.minDistance=r,s.start=e.start(),s.end=i.svgEnd),r=i.start().distance1(e.svgEnd),r<s.minDistance&&(s.minDistance=r,s.start=i.start(),s.end=e.svgEnd)}static point2ArcMinDistance(e,i,s){if(ni(i,e)){let r=i.pointOn(e.angleD(i.center)),n=i.pointOn(i.center.angleD(e));this.arcShortestLine(i,s,e,r),this.arcShortestLine(i,s,e,n)}else this.minLineSegment(s,i.start(),e),this.minLineSegment(s,i.svgEnd,e)}static point2ArcMinLine(e,i,s){if(ni(i,s)){let r=s.distance1(i.center);r>i.rx||r>i.ry?this.minLineForArcAndLine(i,e,s):this.arcInnerLineFootSegment(i,e,s)}}static point2LineMinLine(e,i,s){let r=Ki.foot(i,s);i.bbox().extendOfSize(1e-8).isContains(r)?this.minLineSegment(e,r,s):(this.minLineSegment(e,i.start(),s),this.minLineSegment(e,i.end(),s))}static minLineSegment(e,i,s){let r=i.distance1(s);r<e.minDistance&&(e.minDistance=r,e.start=i,e.end=s)}static arcShortestLine(e,i,s,r){if(!ni(e,r))return;let n=s.distance1(r);n<i.minDistance&&(i.minDistance=n,i.start=s,i.end=r)}static foot(e,i){if(e.isPoint())return e.start();if(!Z.eq(e.b,0)&&!Z.eq(e.a,0)){let s=e.start(),r=e.direct,n=(i.x-s.x)*r.x+(i.y-s.y)*r.y;return new X(s.x+r.x*n,s.y+r.y*n)}else return Z.eq(e.b,0)&&!Z.eq(e.a,0)?new X(e.start().x,i.y):!Z.eq(e.b,0)&&Z.eq(e.a,0)?new X(i.x,e.start().y):i}};function ni(t,e){if(Z.eq(t.sweepAngle,360))return!0;let i=mt.regularD(e.angleD(t.center));return t.sweepAngle>0?(Z.less(i,t.startAngle)&&(i+=360),Z.greatereq(t.endAngle(),i)):(Z.greater(i,t.startAngle)&&(i-=360),Z.lesseq(t.endAngle(),i))}var $0=[1,10,100,1e3],Cl="http://www.w3.org/2000/svg",Nl="http://www.w3.org/1999/xlink",Pl="http://www.w3.org/XML/1998/namespace",Ll="https://easyeda.com/",h_=(function(){var t={svg:Cl,xlink:Nl,xml:Pl,c:Ll};return t[Cl]="svg",t[Nl]="xlink",t[Pl]="xml",t[Ll]="c",t})();var se=(function(){var t={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},e;for(e=21;e<53;e++)t["INNER"+(e-20)]=e;for(t.BOTTOMSILKLAYER=4,t.BOTTOMLAYER=2,t.BOTTOMPASTERLAYER=6,t.BOTTOMSOLDERLAYER=8,t.BOTTOMASSEMBLY=14,t.BOTTOMCOMPONENT=17,e=53;e<85;e++)t["BOARD"+(e-52)]=e;return t})(),d_=(function(){var t={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};t["3D"]=(function(){for(var r=[16,19,3,7,5,1],n=21;n<52;n++)r.push(n+32,n);return r.push(2,6,8,4,17),r})();var e,i,s;for(e in t)if(t.hasOwnProperty(e)&&(s=t[e],s.indexOf(21)>0&&s.indexOf(25)===-1))for(i=25;i<=52;i++)s.push(i);return t})(),Ee=(function(){var t={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},e;for(e=21;e<53;e++)t[e]="Inner"+(e-20);for(e=53;e<85;e++)t[e]="Substrate"+(e-52);return t})(),p_=(function(){var t=[],e=[];for(var i in se)if(se.hasOwnProperty(i)){if(i.match(/^BOARD\d+/))continue;t.push(se[i])}t.sort(),e.sort();var s={},r,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};t.forEach(function(o){switch(o){case se.TOPLAYER:r={name:Ee[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case se.BOTTOMLAYER:r={name:Ee[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case se.TOPSILKLAYER:r={name:Ee[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case se.BOTTOMSILKLAYER:r={name:Ee[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case se.TOPPASTERLAYER:r={name:Ee[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case se.BOTTOMPASTERLAYER:r={name:Ee[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case se.TOPSOLDERLAYER:r={name:Ee[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case se.BOTTOMSOLDERLAYER:r={name:Ee[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case se.RATLINES:r={name:Ee[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case se.BOARDOUTLINE:r={name:Ee[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case se.ALL:r={name:Ee[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case se.DOCUMENT:r={name:Ee[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case se.TOPASSEMBLY:r={name:Ee[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case se.BOTTOMASSEMBLY:r={name:Ee[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case se.MECHANICAL:r={name:Ee[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case se.MODEL3D:r={name:Ee[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case se.LIBBODY:r={name:Ee[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case se.PADSURFACE:r={name:Ee[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=se.INNER1&&o<=se.INNER32?r={name:Ee[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:r=null;break}r&&(s[o]=r)}),s.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},s.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var l=parseInt(RegExp.$1,16),u=.5,c=Math.min(255,Math.round((l>>16)*u)),h=Math.min(255,Math.round((l>>8&255)*u)),f=Math.min(255,Math.round((l&255)*u)),d=((c<<16)+(h<<8)+f).toString(16);return"#"+("00000"+d).substr(-6).toUpperCase()}return s})(),vl={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},f_=(function(){var t={};for(let e in vl)t[vl[e]]=e;return t})();var Ta=Math.PI*2,Kn=Math.PI/2,m_=Math.sin(Math.PI/180);function Z0(t,e,i){if(typeof t!="number"&&(t=+t),isNaN(t))return NaN;if(e=e|0,e<=0||!t&&!i)return Math.round(t);var s=$0[e]||Math.pow(10,e)||10;if(i){var r=t<0?"-":"";for(t=t<0?-t:t,t=Math.round(t*s)+"";t.length<=e;)t="0"+t;return t=t.slice(0,-e)+"."+t.slice(-e),parseFloat(r+t)}else return Math.round(t*s+1e-10)/s}function Mu(t,e,i){var s=t-e;return i||(i=1e-10),(s>0?s:-s)<i}function Q0(t,e,i){var s=c(t)&&c(e)&&c(i);if(!s)return console.warn("Bad arguments"),null;var r=e.x-i.x>0?e.x:i.x,n=e.y-i.y>0?e.y:i.y,a=e.x-i.x>0?i.x:e.x,o=e.y-i.y>0?i.y:e.y,l=t.x,u=t.y;return l<=r+.001&&l>=a-.001&&u<=n+.001&&u>=o-.001;function c(h){return h?(h.x=Number(h.x),h.y=Number(h.y),isNaN(h.x)||isNaN(h.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function tm(t,e,i,s,r,n){var a=(r-i)*(t-i)+(n-s)*(e-s),o=(r-i)*(r-i)+(n-s)*(n-s),l=a/o,u=i+(r-i)*l,c=s+(n-s)*l;return a<=0?Math.sqrt((t-i)*(t-i)+(e-s)*(e-s)):a>=o?Math.sqrt((t-r)*(t-r)+(e-n)*(e-n)):Math.sqrt((t-u)*(t-u)+(c-e)*(c-e))}function em(t,e,i){return Q0(t,e,i)?Mu((t.x-e.x)*(i.y-e.y),(i.x-e.x)*(t.y-e.y),.001):!1}var Nr=1e-4,N=new Float64Array(100);function ti(t,e){if(t instanceof G&&e instanceof G)return Ii(t,e);if(t instanceof K&&e instanceof G)return ro(t,e);if(t instanceof G&&e instanceof K)return ro(e,t);if(t instanceof K&&e instanceof K)return ku(t,e);if(t instanceof rt&&e instanceof rt)return xn(t,e);if(t instanceof rt&&e instanceof G)return xn(t,new rt([e.start(),e.end()]));if(t instanceof G&&e instanceof rt)return xn(new rt([t.start(),t.end()]),e);if(t instanceof rt&&e instanceof K)return jl(e,t);if(t instanceof K&&e instanceof rt)return jl(t,e);throw new Error("not supported operation")}function im(t,e){let i=t.bbox();if(i.isContainsY1(e)){let s=new G(new X(i.minX-1,e),new X(i.maxX+1,e));return Ii(s,t)>0?1:0}else return 0}function sm(t,e){if(t.rx===t.ry){let i=t.bbox();if(i.isContainsY1(e)){let s=new G(new X(i.minX-1,e),new X(i.maxX+1,e));return $n(t,s)>0?1:0}else return 0}else throw new Error("not supported operation")}function xl(t,e){let i=t.bbox();return i.isContainsY1(e)&&xn(new rt([new X(i.minX-1,e),new X(i.maxX+1,e)]),t)>0?1:0}function Ml(t,e,i){return isFinite(e)&&isFinite(i)?t.isContains2(e,i):!1}function rm(t,e){let i=e.length(),s=Qt.crossProd3(e.start(),e.end(),t.start())/i,r=Qt.crossProd3(e.start(),e.end(),t.end())/i;return Math.abs(s)<1e-8||Math.abs(r)<1e-8||s*r<0}function Ii(t,e){let i=t.bbox().intersection1(e.bbox());if(!i)return 0;if(t.isPoint())if(e.isPoint()){let s=i.center();return N[0]=s.x,N[1]=s.y,2}else return Bl(e,t,i);else{if(e.isPoint())return Bl(t,e,i);{let s=function(E,_){i.isContains2(E,_)&&(N[y++]=E,N[y++]=_)};if(!rm(t,e))return 0;let r=t.start().x,n=t.start().y,a=t.end().x,o=t.end().y,l=e.start().x,u=e.start().y,c=e.end().x,h=e.end().y,f=e.length(),d=Qt.crossProd2(r,n,l,u,c,h)/f,p=Qt.crossProd2(a,o,l,u,c,h)/f;if(d*p>0&&!Z.eq(d,0)&&!Z.eq(p,0))return 0;let m=t.length(),g=Qt.crossProd2(l,u,r,n,a,o)/m,b=Qt.crossProd2(c,h,r,n,a,o)/m;if(g*b>0&&!Z.eq(g,0)&&!Z.eq(b,0))return 0;let y=0;if(Z.eq(d,0)&&Z.eq(p,0)){let E=i.UL(),_=i.UR(),S=i.LL(),A=i.LR();if(Z.eq(i.width(),0))Z.eq(i.height(),0)?(N[y++]=E.x,N[y++]=E.y):(N[y++]=E.x,N[y++]=E.y,N[y++]=S.x,N[y++]=S.y);else if(Z.eq(i.height(),0))N[y++]=E.x,N[y++]=E.y,N[y++]=_.x,N[y++]=_.y;else{let w=so.area2(E.x,E.y,l,u,c,h),R=so.area2(_.x,_.y,l,u,c,h);w<R?(N[y++]=E.x,N[y++]=E.y,N[y++]=A.x,N[y++]=A.y):(N[y++]=_.x,N[y++]=_.y,N[y++]=S.x,N[y++]=S.y)}}else if(Z.eq(d,0))s(r,n);else if(Z.eq(p,0))s(a,o);else{let E=Math.abs(d/(d-p));s(r+(a-r)*E,n+(o-n)*E)}return y}}}function Bl(t,e,i){let s=e.start(),r=e.end(),n=Qt.crossProd3(t.start(),t.end(),e.start()),a=Qt.crossProd3(t.start(),t.end(),e.end());if(n*a<0){let o=i.center();return N[0]=o.x,N[1]=o.y,2}else if(Math.abs(n)<Math.abs(a)){if(Z.eq(n/t.length(),0))return N[0]=s.x,N[1]=s.y,2}else if(Z.eq(a/t.length(),0))return N[0]=r.x,N[1]=r.y,2;return 0}function $n(t,e){let i=t.bbox().intersection1(e.bbox());if(i!=null){i=i.extendOfSize(Nr);let s=t.center.x,r=t.center.y,n=t.rx,a=t.rx2,o=e.start().x,l=e.start().y,u=e.end().x,c=e.end().y,h=t.center.distance1(e.start()),f=t.center.distance1(e.end()),d=Z.eq(h,n)?0:h>n?1:-1,p=Z.eq(f,n)?0:f>n?1:-1,m=0;if(d===-1&&p===-1)return 0;if(d===0&&p===0)N[m++]=o,N[m++]=l,N[m++]=u,N[m++]=c;else if(d===1&&p===1){let g=ci.foot(e,t.center),b=g.distance1(t.center);if(Z.greater(b,n))return 0;if(Z.eq(b,n))Z.eq(e.distance2(t.start()),0)?(N[m++]=t.start().x,N[m++]=t.start().y,N[m++]=t.start().x,N[m++]=t.start().y):Z.eq(e.distance2(t.end()),0)?(N[m++]=t.end().x,N[m++]=t.end().y,N[m++]=t.end().x,N[m++]=t.end().y):(N[m++]=g.x,N[m++]=g.y,N[m++]=g.x,N[m++]=g.y);else{m=Bu(s,r,o,l,u,c,m,g);let y=N[m-2],E=N[m-1];m-=2;let _=Qt.distance1(s,r,y,E);if(Z.eq(_,n))N[m++]=y,N[m++]=E,N[m++]=y,N[m++]=E;else if(_<n)m=Ie(a,s,r,o,l,y,E,m),m=Ie(a,s,r,y,E,u,c,m);else return 0}}else if(d===-1||p===-1)m=Ie(a,s,r,o,l,u,c,m);else{let g=ci.foot(e,t.center),b=g.distance1(t.center);if(Z.eq(b,n)){let y=function(S){return Ml(i,S.x,S.y)&&ie(t,S)},E=t.start(),_=t.end();if(d===0){let S=e.start();if(y(S))return N[m++]=S.x,N[m++]=S.y,N[m++]=S.x,N[m++]=S.y,m;if(y(g))return N[m++]=g.x,N[m++]=g.y,N[m++]=g.x,N[m++]=g.y,m;if(Z.eq(e.distance2(E),0)&&y(E))return N[m++]=E.x,N[m++]=E.y,N[m++]=E.x,N[m++]=E.y,m;if(Z.eq(e.distance2(_),0)&&y(_))return N[m++]=_.x,N[m++]=_.y,N[m++]=_.x,N[m++]=_.y,m;if(h<=n)m=Ie(a,s,r,g.x,g.y,u,c,m),m===2&&(N[m++]=N[0],N[m++]=N[1]);else if(b<n){if(m=Ie(a,s,r,g.x,g.y,u,c,m),m===2&&y(new X(N[0],N[1])))return N[m++]=N[0],N[m++]=N[1],m;m=Ie(a,s,r,g.x,g.y,o,l,0),m===2&&(N[m++]=N[0],N[m++]=N[1])}}else{let S=e.end();if(y(S))return N[m++]=S.x,N[m++]=S.y,N[m++]=S.x,N[m++]=S.y,m;if(y(g))return N[m++]=g.x,N[m++]=g.y,N[m++]=g.x,N[m++]=g.y,m;if(Z.eq(e.distance2(E),0)&&y(E))return N[m++]=E.x,N[m++]=E.y,N[m++]=E.x,N[m++]=E.y,m;if(Z.eq(e.distance2(_),0)&&y(_))return N[m++]=_.x,N[m++]=_.y,N[m++]=_.x,N[m++]=_.y,m;if(f<=n)m=Ie(a,s,r,g.x,g.y,o,l,m),m===2&&(N[m++]=N[0],N[m++]=N[1]);else if(b<n){if(m=Ie(a,s,r,g.x,g.y,o,l,m),m===2&&y(new X(N[0],N[1])))return N[m++]=N[0],N[m++]=N[1],m;m=Ie(a,s,r,g.x,g.y,u,c,0),m===2&&(N[m++]=N[0],N[m++]=N[1])}}}else if(d===0){let y=e.start();N[m++]=y.x,N[m++]=y.y,(o-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(m=Ie(a,s,r,g.x,g.y,u,c,m))}else{let y=e.end();N[m++]=y.x,N[m++]=y.y,(o-g.x)*(u-g.x)+(l-g.y)*(c-g.y)<0&&(m=Ie(a,s,r,g.x,g.y,o,l,m))}}if(m>0){let g=0;for(let b=0;b<m;b+=2){let y=N[b],E=N[b+1];isFinite(y)&&isFinite(E)&&Ml(i,y,E)&&ie(t,new X(y,E))&&(N[g++]=y,N[g++]=E)}return g}else return 0}else return 0}function nm(t,e){if(t.bbox()){let i=t.center.x,s=t.center.y,r=t.rx2,n=e.start().x,a=e.start().y,o=e.end().x,l=e.end().y,u=t.center.distance2(e.start()),c=t.center.distance2(e.end()),h=Z.eq(u,r)?0:u>r?1:-1,f=Z.eq(c,r)?0:c>r?1:-1,d=0;if(h===-1&&f===-1)return 0;if(h===0&&f===0)N[d++]=n,N[d++]=a,N[d++]=o,N[d++]=l;else if(h===1&&f===1){let p=ci.foot(e,t.center),m=p.distance2(t.center);if(Z.greater(m,r))return 0;if(Z.eq(m,r)){let g=p.distance2(t.start()),b=p.distance2(t.end());Z.eq(g,0)?(N[d++]=t.start().x,N[d++]=t.start().y):Z.eq(b,0)?(N[d++]=t.end().x,N[d++]=t.end().y):(N[d++]=p.x,N[d++]=p.y)}else{d=Bu(i,s,n,a,o,l,d,p);let g=N[d-2],b=N[d-1],y=Qt.distance2(i,s,g,b);if(d-=2,Z.eq(y,r))N[d++]=g,N[d++]=b;else if(y<r)d=Ie(r,i,s,n,a,g,b,d),d=Ie(r,i,s,g,b,o,l,d);else return 0}}else if(h===-1||f===-1)d=Ie(r,i,s,n,a,o,l,d);else{let p=ci.foot(e,t.center);h===0?(N[d++]=e.start().x,N[d++]=e.start().y,Z.neq(p.distance2(e.start()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(d=Ie(r,i,s,p.x,p.y,o,l,d))):(N[d++]=e.end().x,N[d++]=e.end().y,Z.neq(p.distance2(e.end()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(d=Ie(r,i,s,p.x,p.y,n,a,d)))}if(d>0){let p=0;for(let m=0;m<d;m+=2){let g=N[m],b=N[m+1];isFinite(g)&&isFinite(b)&&(N[p++]=g,N[p++]=b)}return p}else return 0}else return 0}function Ie(t,e,i,s,r,n,a,o){if(r==a){let E=t-(r-i)*(r-i);if(Z.greater(E,0)){let _=Math.sqrt(E),S=e-_,A=e+_,w=Math.min(s,n),R=Math.max(s,n);return S>=w&&S<=R&&(N[o++]=S,N[o++]=r),A>=w&&A<=R&&(N[o++]=A,N[o++]=r),o}}let l=Qt.distance2(s,r,e,i)-t;if(l===0)return N[o++]=s,N[o++]=r,o;let u=Qt.distance2(n,a,e,i)-t;if(u===0)return N[o++]=n,N[o++]=a,o;let c=s,h=r,f=n,d=a,p=NaN,m=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let E=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(u)),.75),.25);if(p=c+(f-c)*E,m=h+(d-h)*E,c===p&&h===m||f===p&&d===m){Math.abs(l)>Math.abs(u)?(p=f,m=d,g=u):(p=c,m=h,g=l);break}else g=Qt.distance2(p,m,e,i)-t,g<0&&l>u||g>0&&l<u?(f=p,d=m,u=g):(c=p,h=m,l=g)}let y=Math.sqrt(t)-Qt.distance1(p,m,e,i);return(Z.eq(0,g)||Z.eq(0,y))&&(N[o++]=p,N[o++]=m),o}function Bu(t,e,i,s,r,n,a,o){let l=Qt.dotProd2(i,s,r,n,t,e),u=Qt.dotProd2(r,n,i,s,t,e);if(l>=0)return N[a++]=r,N[a++]=n,a;if(u>=0)return N[a++]=i,N[a++]=s,a;if(Qt.crossProd2(i,s,r,n,t,e)==0)return N[a++]=t,N[a++]=e,a;{let c=NaN,h=NaN,f=i,d=s,p=r,m=n,g=Qt.distance2(i,s,t,e),b=Qt.distance2(r,n,t,e),y=Number.POSITIVE_INFINITY,E=0;for(;y>0&&(E++,c=f+(p-f)*.5,h=d+(m-d)*.5,!(g==b||f==c&&d==h||p==c&&m==h));){y=Qt.distance2(c,h,t,e);let _=Qt.dotProd2(f,d,c,h,t,e);if(_==0)break;_<0?(p=c,m=h,b=y):(f=c,d=h,g=y)}return Qt.distance2(c,h,t,e)<Qt.distance2(o.x,o.y,t,e)?(N[a++]=c,N[a++]=h):(N[a++]=o.x,N[a++]=o.y),a}}function ro(t,e){if(t.rx===t.ry)return $n(t,e);throw new Error("not supported")}function am(t,e){if(t.rx===t.ry)return nm(t,e);throw new Error("not supported")}function ku(t,e){if(t.bbox().intersection1(e.bbox())!=null){if(t.rx===t.ry&&e.rx===e.ry)return om(t,e);throw new Error("not supported operation")}return 0}function om(t,e){let i=t.center.x,s=t.center.y,r=e.center.x,n=e.center.y,a=t.rx,o=e.rx,l=t.rx2,u=e.rx2,c=t.center.distance1(e.center),h=Math.abs(a-o),f=a+o;if(Z.greater(c,f)||Z.less(c,h))return 0;if(Z.eq(h+c,0)){let d=0,p;return ie(t,e.start())&&(N[d]=e.start().x,N[d+1]=e.start().y,d+=2,p=e.start()),ie(t,e.end())&&(N[d]=e.end().x,N[d+1]=e.end().y,d+=2,p=e.end()),d===0?(ie(e,t.start())&&(N[d]=t.start().x,N[d+1]=t.start().y,d+=2),ie(e,t.end())&&(N[d]=t.end().x,N[d+1]=t.end().y,d+=2)):d===2&&(!p.equals1(t.start())&&ie(e,t.start())&&(N[d]=t.start().x,N[d+1]=t.start().y,d+=2),!p.equals1(t.end())&&ie(e,t.end())&&(N[d]=t.end().x,N[d+1]=t.end().y,d+=2)),d}else if(Z.eq(c,f)){if(kl(t,e))return 4;let d=new G(t.center,e.center),p=$n(e,d);return p=Fl(t,p),p!==0?p:(p=$n(t,d),Fl(e,p))}else if(Z.eq(c,h)){if(kl(t,e))return 4;if(a>o){let d=(a-o)/a;return N[0]=i+(r-i)/d,N[1]=s+(n-s)/d,Ul(t,e,2)}else{let d=(o-a)/o;return N[0]=r+(i-r)/d,N[1]=n+(s-n)/d,Ul(t,e,2)}}else{let d=(t.center.distance2(e.center)-u+l)/(c*2)/c,p=(r-i)*d+i,m=(n-s)*d+s,g=r-i,b=n-s,y=Math.max(a,o),E,_,S,A;if(Math.abs(g)<Math.abs(b)){let M=g/-b,B=m-M*p;E=p-y,_=M*E+B,S=p+y,A=M*S+B}else{let M=b/-g,B=p-M*m;_=m-y,E=M*_+B,A=m+y,S=M*A+B}let w=Ie(l,i,s,E,_,p,m,0);if(w=Ie(l,i,s,p,m,S,A,w),w!==4)throw new Error("cnt !== 4");let R=new X(N[0],N[1]),L=new X(N[2],N[3]);if(ie(t,R)&&ie(e,R))return ie(t,L)&&ie(e,L)?4:Wi(t.start(),e,L,R)?(N[2]=t.start().x,N[3]=t.start().y,4):Wi(t.end(),e,L,R)?(N[2]=t.end().x,N[3]=t.end().y,4):Wi(e.start(),t,L,R)?(N[2]=e.start().x,N[3]=e.start().y,4):Wi(e.end(),t,L,R)?(N[2]=e.end().x,N[3]=e.end().y,4):2;if(ie(t,L)&&ie(e,L))return Wi(t.start(),e,R,L)?(N[0]=t.start().x,N[1]=t.start().y,4):Wi(t.end(),e,R,L)?(N[0]=t.end().x,N[1]=t.end().y,4):Wi(e.start(),t,R,L)?(N[0]=e.start().x,N[1]=e.start().y,4):Wi(e.end(),t,R,L)?(N[0]=e.end().x,N[1]=e.end().y,4):(N[0]=N[2],N[1]=N[3],2);{let M=function(V,W){if(Z.eq(V.distance1(W.center),W.rx)&&ie(W,V)){if(V.distance2(R)<V.distance2(L)){if(B)return;B=!0}else{if(q)return;q=!0}N[H++]=V.x,N[H++]=V.y}},B=!1,q=!1,H=0;return M(t.start(),e),M(t.end(),e),M(e.start(),t),M(e.end(),t),H}}}function Wi(t,e,i,s){return Z.eq(t.distance1(e.center),e.rx)&&ie(e,t)&&t.distance2(i)<t.distance2(s)}function kl(t,e){return Z.eq(e.start().distance1(t.center),t.rx)&&ie(t,e.start())?(N[0]=e.start().x,N[1]=e.start().y,N[2]=e.start().x,N[3]=e.start().y,!0):Z.eq(e.end().distance1(t.center),t.rx)&&ie(t,e.end())?(N[0]=e.end().x,N[1]=e.end().y,N[2]=e.end().x,N[3]=e.end().y,!0):Z.eq(t.start().distance1(e.center),e.rx)&&ie(e,t.start())?(N[0]=t.start().x,N[1]=t.start().y,N[2]=t.start().x,N[3]=t.start().y,!0):Z.eq(t.end().distance1(e.center),e.rx)&&ie(e,t.end())?(N[0]=t.end().x,N[1]=t.end().y,N[2]=t.end().x,N[3]=t.end().y,!0):!1}function Fl(t,e){if(e===0)return 0;let i=N[0],s=N[1];return ie(t,new X(i,s))?(N[0]=i,N[1]=s,N[2]=i,N[3]=s,4):0}function Ul(t,e,i){if(i===0)return 0;let s=N[0],r=N[1],n=new X(s,r);return ie(t,n)&&ie(e,n)?(N[0]=s,N[1]=r,N[2]=s,N[3]=r,4):0}function Fs(t,e){return Math.abs(t-e)<=1e-6}function ie(t,e){let i=t.bbox();if(e.x-i.minX>-Nr&&e.x-i.maxX<Nr&&e.y-i.minY>-Nr&&e.y-i.maxY<Nr){let s=mt.regularD(e.angleD(t.center));return Fs(s,t.startAngle)||Fs(s,t.startAngle+360)||Fs(s,t.startAngle-360)||Fs(s,t.endAngle())||Fs(s,t.endAngle()+360)||Fs(s,t.endAngle()-360)?!0:t.sweepAngle>0?(Z.less(s,t.startAngle)&&(s+=360),Z.greatereq(t.endAngle(),s)):(Z.greater(s,t.startAngle)&&(s-=360),Z.lesseq(t.endAngle(),s))}else return!1}function lm(t,e){let i=t[1].x-t[0].x,s=t[1].y-t[0].y,r=e[1].x-e[0].x,n=e[1].y-e[0].y;if(i===0&&r!==0||i!==0&&r===0)return!1;if(i===0&&r===0)return!0;let a=s/i,o=n/r;return Mu(a,o,Math.sin(Math.PI/180))}function um(t,e,i){var s,r=+e.x,n=+e.y,a=+i.x,o=+i.y,l=+t.x,u=+t.y,c=a-r,h=o-n,f=l-r,d=u-n,p,m,g,b,y,E;return c===0&&h===0?{d:Math.sqrt(f*f+d*d),point:new X(r,n)}:(s=(f*c+d*h)/(c*c+h*h),s<0?{d:Math.sqrt(f*f+d*d),point:new X(r,n)}:s>1?(p=l-a,m=u-o,{d:Math.sqrt(p*p+m*m),point:new X(a,o)}):(y=r+s*c,E=n+s*h,g=l-y,b=u-E,{d:Math.sqrt(g*g+b*b),point:new X(y,E)}))}function oi(t,e){if(!t||!e||t.length!=e.length)return!1;let i="equals1";return!t.some((s,r)=>{let n=e[r],a=!1;return s&&n&&typeof s=="object"&&typeof n=="object"?typeof s[i]=="function"&&hm(s,n)?a=!s[i].call(s,n):a=!(s===n||s.toString()===n.toString()):typeof s=="number"&&typeof n=="number"?a=!(cm(s,n)||Number.isNaN(s)&&Number.isNaN(n)):a=s!==n,a})}function cm(t,e,i=5){return Math.abs(t-e)*Math.pow(10,i)<1}function hm(t,e){return!t||!e||typeof t!="object"||typeof e!="object"?t===e:t.constructor===e.constructor}var yt=new Float64Array(100);function xn(t,e){if(t.bbox().extendOfSize(Z.eps).isSeparated(e.bbox()))return 0;let i=[[t,e]],s=(t.controls.length-1)*(e.controls.length-1)*8,r=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(v){B=Math.min(B,v),q=Math.max(q,v)},o=function(v,j){let O=Ii(v,j);if(O===0)throw new Error("cnt === 0");for(let x=0;x<O;x+=2)a(N[x])};if(r>s){for(let v=r-2;v>=2;v-=2)for(let j=v-2;j>=0;j-=2)if(Z.eq(yt[v],yt[j])&&Z.eq(yt[v+1],yt[j+1])){yt[j]=(yt[v]+yt[j])/2,yt[j+1]=(yt[v+1]+yt[j+1])/2;for(let O=r-3;O>=v;O--)yt[O]=yt[O+2];r-=2;break}if(r>s){r=0;let v=e.start(),j=new Float64Array(8);t.getPercent(v)!==null&&(j[r++]=v.x,j[r++]=v.y);let O=e.end();t.getPercent(O)!==null&&(j[r++]=O.x,j[r++]=O.y);let x=t.start();e.getPercent(x)!==null&&(j[r++]=x.x,j[r++]=x.y);let k=t.end();return e.getPercent(k)!==null&&(j[r++]=k.x,j[r++]=k.y),N.set(j),r}}let[l,u]=i.pop(),c=l.controls,h=u.controls;if(c.length===2&&h.length===2){let v=Ii(new G(c[0],c[1]),new G(h[0],h[1]));for(let j=0;j<v;j++)yt[r++]=N[j];continue}let f=c[0],d=c[c.length-1];f.equals1(d)&&(d=f.add1(1,0));let p=d.y-f.y,m=f.x-d.x,g=-p*f.x-m*f.y,b=Math.sqrt(1/(p**2+m**2));p*=b,m*=b,g*=b;let y=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY;if(c.forEach(v=>{let j=p*v.x+m*v.y+g;j<y&&(y=j),j>E&&(E=j)}),Z.eq(y,E)){if(u.controls.length===2){let v=Ii(new G(l.start(),l.end()),new G(u.start(),u.end()));for(let j=0;j<v;j++)yt[r++]=N[j];if(v!==0)continue}l=new rt([c[0],c[c.length-1]]),c=l.controls}let _=h.map(v=>{let j=p*v.x+m*v.y+g,O=Math.abs(j);return O<n&&(n=O),j}),S=0;for(let v of _){if(Z.less(v,y))S=S|1;else if(Z.greater(v,E))S=S|2;else{S=3;break}if(S===3)break}if(S!==3)continue;let A=0,w=0,R=d.x-f.x,L=d.y-f.y,M=Math.sqrt(1/(R**2+L**2));R*=M,L*=M;for(let v=1;v<c.length;v++){let j=c[v],O=(j.x-f.x)*R+(j.y-f.y)*L;O<A?A=O:O>w&&(w=O)}S=0;for(let v of h){let j=(v.x-f.x)*R+(v.y-f.y)*L;if(Z.less(j,A))S=S|1;else if(Z.greater(j,w))S=S|2;else{S=3;break}if(S===3)break}if(S!==3)continue;let B=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY;n/=2,n<=Z.eps&&(n=Z.eps),y-=n,E+=n,_.forEach((v,j)=>{v>=y&&v<=E&&a(j/(_.length-1))});let H=new G(new X(0,y),new X(1,y)),V=new G(new X(0,E),new X(1,E));for(let v=0;v<_.length-1;v++){let j=new X(v/(_.length-1),_[v]),O=j.y<y?1:j.y>E?2:3;for(let x=0;x<_.length;x++){let k=new X(x/(_.length-1),_[x]),F=k.y<y?1:k.y>E?2:3;O!==F&&(O===1?F===2?(o(new G(j,k),H),o(new G(j,k),V)):o(new G(j,k),H):O===2?F===1?(o(new G(j,k),H),o(new G(j,k),V)):o(new G(j,k),V):F===1?o(new G(j,k),H):o(new G(j,k),V))}}B!==0&&(u=u.clip(B)[1]),q!==1&&(u=u.clip((q-B)/(1-B))[0]);let W=u.bbox();if(Z.eq(W.minX,W.maxX)&&Z.eq(W.minY,W.maxY)){S=0;for(let v of u.controls){let j=(v.x-f.x)*R+(v.y-f.y)*L;if(Z.less(j,A))S=S|1;else if(Z.greater(j,w))S=S|2;else{S=3;break}if(S===3)break}if(S===3){let v=new X((W.minX+W.maxX)/2,(W.minY+W.maxY)/2);l.getPercent(v)&&(yt[r++]=v.x,yt[r++]=v.y)}continue}if(q-B>.8){let[v,j]=u.clip(.5);i.push([v,l]),i.push([j,l])}else i.push([u,l])}for(let a=0;a<r;a++)N[a]=yt[a];return r}function dm(t,e){if(t.bbox().extendOfSize(Z.eps).isSeparated(e.bbox()))return{cnt:0};let i=[[t,e]],s=(t.controls.length-1)*(e.controls.length-1)*8,r=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(v){B=Math.min(B,v),q=Math.max(q,v)},o=function(v,j){let O=Ii(v,j);if(O===0)throw new Error("cnt === 0");for(let x=0;x<O;x+=2)a(N[x])};if(r>s){for(let v=r-2;v>=2;v-=2)for(let j=v-2;j>=0;j-=2)if(Z.eq(yt[v],yt[j])&&Z.eq(yt[v+1],yt[j+1])){yt[j]=(yt[v]+yt[j])/2,yt[j+1]=(yt[v+1]+yt[j+1])/2;for(let O=r-3;O>=v;O--)yt[O]=yt[O+2];r-=2;break}if(r>s){r=0;let v=new Float64Array(8),j=e.end(),O=0;t.getPercent(j)!==null&&(v[r++]=j.x,v[r++]=j.y,O=2);let x=t.end();return e.getPercent(x)!==null&&(v[r++]=x.x,v[r++]=x.y,O=O===0?1:3),N.set(v),{havOverlap:O,cnt:r}}}let[l,u]=i.pop(),c=l.controls,h=u.controls;if(c.length===2&&h.length===2){let v=Ii(new G(c[0],c[1]),new G(h[0],h[1]));for(let j=0;j<v;j++)yt[r++]=N[j];continue}let f=c[0],d=c[c.length-1];f.equals1(d)&&(d=f.add1(1,0));let p=d.y-f.y,m=f.x-d.x,g=-p*f.x-m*f.y,b=Math.sqrt(1/(p**2+m**2));p*=b,m*=b,g*=b;let y=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY;if(c.forEach(v=>{let j=p*v.x+m*v.y+g;j<y&&(y=j),j>E&&(E=j)}),Z.eq(y,E)){if(u.controls.length===2){let v=Ii(new G(l.start(),l.end()),new G(u.start(),u.end()));for(let j=0;j<v;j++)yt[r++]=N[j];if(v!==0)continue}l=new rt([c[0],c[c.length-1]]),c=l.controls}let _=h.map(v=>{let j=p*v.x+m*v.y+g,O=Math.abs(j);return O<n&&(n=O),j}),S=0;for(let v of _){if(Z.less(v,y))S=S|1;else if(Z.greater(v,E))S=S|2;else{S=3;break}if(S===3)break}if(S!==3)continue;let A=0,w=0,R=d.x-f.x,L=d.y-f.y,M=Math.sqrt(1/(R**2+L**2));R*=M,L*=M;for(let v=1;v<c.length;v++){let j=c[v],O=(j.x-f.x)*R+(j.y-f.y)*L;O<A?A=O:O>w&&(w=O)}S=0;for(let v of h){let j=(v.x-f.x)*R+(v.y-f.y)*L;if(Z.less(j,A))S=S|1;else if(Z.greater(j,w))S=S|2;else{S=3;break}if(S===3)break}if(S!==3)continue;let B=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY;n/=2,n<=Z.eps&&(n=Z.eps),y-=n,E+=n,_.forEach((v,j)=>{v>=y&&v<=E&&a(j/(_.length-1))});let H=new G(new X(0,y),new X(1,y)),V=new G(new X(0,E),new X(1,E));for(let v=0;v<_.length-1;v++){let j=new X(v/(_.length-1),_[v]),O=j.y<y?1:j.y>E?2:3;for(let x=0;x<_.length;x++){let k=new X(x/(_.length-1),_[x]),F=k.y<y?1:k.y>E?2:3;O!==F&&(O===1?F===2?(o(new G(j,k),H),o(new G(j,k),V)):o(new G(j,k),H):O===2?F===1?(o(new G(j,k),H),o(new G(j,k),V)):o(new G(j,k),V):F===1?o(new G(j,k),H):o(new G(j,k),V))}}B!==0&&(u=u.clip(B)[1]),q!==1&&(u=u.clip((q-B)/(1-B))[0]);let W=u.bbox();if(Z.eq(W.minX,W.maxX)&&Z.eq(W.minY,W.maxY)){S=0;for(let v of u.controls){let j=(v.x-f.x)*R+(v.y-f.y)*L;if(Z.less(j,A))S=S|1;else if(Z.greater(j,w))S=S|2;else{S=3;break}if(S===3)break}if(S===3){let v=new X((W.minX+W.maxX)/2,(W.minY+W.maxY)/2);l.getPercent(v)&&(yt[r++]=v.x,yt[r++]=v.y)}continue}if(q-B>.8){let[v,j]=u.clip(.5);i.push([v,l]),i.push([j,l])}else i.push([u,l])}for(let a=0;a<r;a++)N[a]=yt[a];return{cnt:r}}var pm=class{constructor(t=Z.eps){this.eps=t}eq(t,e){return Math.abs(t-e)<=this.eps}setEps(t){this.eps=t}},Ir=new pm;function jl(t,e){if(t.bbox().extendOfSize(Z.eps).isSeparated(e.bbox()))return 0;let i=[[t,e]],s=(e.controls.length-1)*16,r=0;for(;i.length!==0;){if(r>s){let a=function(){for(let u=0;u<r;u+=2)for(let c=u+2;c<r;c+=2)if(!(Ir.eq(yt[u],yt[c])&&Ir.eq(yt[u+1],yt[c+1]))){l(yt[c],yt[c+1],o);break}function l(u,c,h){let f=!1;for(let d=0;d<h.length;d+=2)if(Ir.eq(u,h[d])&&Ir.eq(c,h[d+1])){f=!0;break}f||h.push(u,c)}},o=[yt[0],yt[1]];if(a(),o.length>=100&&(Ir.setEps(.001),o=[yt[0],yt[1]],a(),o.length>=100))throw new Error("clearSamePoint()");r=o.length,o.forEach((l,u)=>yt[u]=l)}let n=i.pop();if(n[0]instanceof K){let a=function(V){L=Math.min(L,V),M=Math.max(M,V)},o=function(V,W){let v=Ii(V,W);if(v===0)throw new Error("cnt === 0");for(let j=0;j<v;j+=2)a(N[j])},[l,u]=n,c=u.controls;if(c.length===2){let V=ro(l,new G(c[0],c[1]));for(let W=0;W<V;W++)yt[r++]=N[W];continue}let h=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d,p,m,g,b;if(Math.abs(l.sweepAngle)>359){let V=l.rx;d=l.center.add1(V,0),p=l.center.add1(-V,0),h=-V,f=V,m=0,g=1,b=-l.center.y}else{d=l.start(),p=l.end(),m=p.y-d.y,g=d.x-p.x,b=-m*d.x-g*d.y;let V=Math.sqrt(1/(m**2+g**2));m*=V,g*=V,b*=V;let W=m*l.center.x+g*l.center.y+b;l.isCCW?(f=l.rx+W,h=0):(h=W-l.rx,f=0)}let y=c.map(V=>m*V.x+g*V.y+b),E=0;for(let V of y){if(Z.less(V,h))E=E|1;else if(Z.greater(V,f))E=E|2;else{E=3;break}if(E===3)break}if(E!==3)continue;let _=0,S=0,A=p.x-d.x,w=p.y-d.y,R=Math.sqrt(1/(A**2+w**2));if(A*=R,w*=R,Math.abs(l.sweepAngle)<=180)_=0,S=(p.x-d.x)*A+(p.y-d.y)*w;else throw new Error("not support");E=0;for(let V of c){let W=(V.x-d.x)*A+(V.y-d.y)*w;if(Z.less(W,_))E=E|1;else if(Z.greater(W,S))E=E|2;else{E=3;break}if(E===3)break}if(E!==3)continue;let L=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY;h-=Z.eps,f+=Z.eps,y.forEach((V,W)=>{V>=h&&V<=f&&a(W/(y.length-1))});let B=new G(new X(0,h),new X(1,h)),q=new G(new X(0,f),new X(1,f));for(let V=0;V<y.length-1;V++){let W=new X(V/(y.length-1),y[V]),v=W.y<h?1:W.y>f?2:3;for(let j=0;j<y.length;j++){let O=new X(j/(y.length-1),y[j]),x=O.y<h?1:O.y>f?2:3;v!==x&&(v===1?x===2?(o(new G(W,O),B),o(new G(W,O),q)):o(new G(W,O),B):v===2?x===1?(o(new G(W,O),B),o(new G(W,O),q)):o(new G(W,O),q):x===1?o(new G(W,O),B):o(new G(W,O),q))}}L!==0&&(u=u.clip(L)[1]),M!==1&&(u=u.clip((M-L)/(1-L))[0]);let H=u.bbox();if(Z.eq(H.minX,H.maxX)&&Z.eq(H.minY,H.maxY)){E=0;for(let V of u.controls){let W=(V.x-d.x)*A+(V.y-d.y)*w;if(Z.less(W,_))E=E|1;else if(Z.greater(W,S))E=E|2;else{E=3;break}if(E===3)break}E===3&&(yt[r++]=(H.minX+H.maxX)/2,yt[r++]=(H.minY+H.maxY)/2);continue}M-L>.8?u.clip(.5).forEach(V=>i.push([V,l])):i.push([u,l])}else{let[a,o]=n;i.push([K.build3(o.center,o.startAngle,o.sweepAngle/2,o.rx,o.ry),a]),i.push([K.build3(o.center,o.startAngle+o.sweepAngle/2,o.sweepAngle/2,o.rx,o.ry),a])}}for(let n=0;n<r;n++)N[n]=yt[n];return r}var fm=class{static getSweep(t){if(t.length>2){let e=0,i=t.length;for(let n=0;n<i-1;n++){let a=t[n],o=t[n+1];e+=(o.x+a.x)*(o.y-a.y)}let s=t[0],r=t[i-1];return e+=(s.x+r.x)*(s.y-r.y),e>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(t){return!!(t.primitives.length>0&&t.primitives[0].start().equals1(t.primitives[t.primitives.length-1].end()))}};function mm(t){let e=t.primitives,i=e[0],s=i instanceof K?i.sweepAngle%360:null;if(e.length===1&&i instanceof K&&(Z.eq(s,0)||Z.eq(Math.abs(s),360)))return!!i.isCCW;let r=new Array;return t.points(.1,n=>{r.push(n)}),fm.getSweep(r)}var gm=class{static zoomCorner(t,e){let i=new Array,s=new Array,r=new Array;return this.getPanPrimitive(t,i,r,e),this.rearrange(i,r),this.processStart(i,r),this.getResult(i,r,s,e),s.length>0?St.build2(s):null}static zoomPolygon(t,e){let i=new Array,s=new Array,r=new Array;return mm(t)&&(t=t.reverse().asClose()),this.getPanPrimitive(t,i,r,e),this.rearrange(i,r),this.processStart(i,r),this.getResult(i,r,s,e),s.length>0?St.build2(s):null}static zoomLines(t,e){return this.zoomPolygon(St.build2(t.primitives.concat(t.reverse().primitives)),e/2)}static getPanPrimitive(t,e,i,s){let r=t.primitives;for(let n of r){let a=this.panDistance(n,s);a!==void 0&&(e.push(a),i.push(n))}}static rearrange(t,e){let i=t.length,s=0;for(let a=0;a<i;a++){let o=e[a],l=t[a],u=a==i-1?t[0]:t[a+1];if(!(l instanceof K&&u instanceof K)&&!this.isCW(l.end(),u.start(),o.end())){if(ti(l,u)!=0){s=a==i-1?0:a+1;break}}else{s=a;break}}let r=this.start4Index(e,s),n=this.start4Index(t,s);e.length=0,t.length=0,r.forEach(a=>{e.push(a)}),n.forEach(a=>{t.push(a)})}static processStart(t,e){let i=t.length;if(i>2){let s=t[i-1],r=t[0],n=e[i-1];if(!(s instanceof K&&r instanceof K)&&!this.isCW(s.end(),r.start(),n.end())){let a=ti(s,r);for(let o=0;o<a;o+=2){let l=new X(N[o],N[o+1]);t[i-1]=this.generatePrimitive(s,s.start(),l),t[0]=this.generatePrimitive(r,l,r.end())}}}}static getResult(t,e,i,s){let r=t.length;for(let n=0;n<r;n++){let a=e[n],o=n===r-1?e[0]:e[n+1],l=n==r-1?0:n+1,u=l==r-1?e[0]:e[l+1],c=t[n],h=n==r-1?t[0]:t[n+1],f=l==r-1?t[0]:t[l+1];if(!(c instanceof K&&h instanceof K)&&!this.isCW(c.end(),h.start(),a.end())){let p=this.add(t,i,n,c,h,0);p=this.update(t,i,n,h,p);let m=this.generateArc(o,u,h,f,s);if(p=this.add(t,i,n,c,m,p),p=this.update(t,i,n,m,p),p>0)continue}i.push(c);let d=this.generateArc(a,o,c,h,s);d!==void 0&&i.push(d)}}static generateArc(t,e,i,s,r){if(r>0){let n=t.end(),a=e.start(),o=i.end(),l=s.start();if(o.distance2(l)>1e-8)if(n.equals(a)){let u=o.angleD(n),c=l.angleD(n);return K.build2(n,u,c,r,r,0)}else{let u=o.angleD(n),c=l.angleD(n),h=o.angleD(a),f=l.angleD(a),d=K.build2(n,u,c,r,r,0),p=K.build2(a,h,f,r,r,0);return d.pointOn(d.endAngle()).equals1(l)?d:p.pointOn(p.endAngle()).equals1(l)?p:d}}}static updateNews(t,e,i,s){let r=t.length,n=e==r-1?0:e+1;t[n]=this.generatePrimitive(i,s,i.end())}static add(t,e,i,s,r,n){if(n>0)return n;if(s!=null&&r!=null){let a=ti(s,r);for(let o=0;o<a;o+=2){let l=new X(N[o],N[o+1]);e.push(this.generatePrimitive(s,s.start(),l)),this.updateNews(t,i,r,l);break}return a}else return 0}static update(t,e,i,s,r){if(r>0)return r;let n=e.length;if(n>0&&s!=null){let a=e[n-1],o=ti(a,s);for(let l=0;l<o;l+=2){let u=new X(N[l],N[l+1]);e[n-1]=this.generatePrimitive(a,a.start(),u),this.updateNews(t,i,s,u)}return o}else return 0}static generatePrimitive(t,e,i){if(t instanceof G)return new G(e,i);if(t instanceof K){let s=t,r=e.angleD(s.center),n=i.angleD(s.center);return K.build2(s.center,r,n,s.rx,s.ry,s.sweep())}else throw new Error("not supported operation")}static start4Index(t,e){let i=t.length,s=new Array;for(let r=e;r<i;r++)s.push(t[r]);for(let r=0;r<e;r++)s.push(t[r]);return s}static isCW(t,e,i){let s=new G(i,t),r=new G(i,e),n=s.end().x-s.start().x,a=s.end().y-s.start().y,o=r.end().x-r.start().x,l=r.end().y-r.start().y;return!(n*l-a*o>0)}static panDistance(t,e){if(t instanceof G){if(t.isPoint())return;{let i=t.panDistance(e);return i.length()>1e-5?i:void 0}}else if(t instanceof K){let i=t;if(i.sweepAngle>0){if(i.rx-e<=0||i.ry-e<=0)return}else if(i.sweepAngle<0&&(i.rx+e<=0||i.ry+e<=0))return;return i=i.panDistance(e),i.start().distance1(i.end())>1e-5||Z.eq(Math.abs(i.sweepAngle),360)?i:void 0}else throw new Error("not supported operation")}},ht=.001,ve=ht**2;function ut(t,e){return t.distance2(e)<ve}function Oi(t,e){return Math.abs(t-e)<=1e-4}function Em(t,e){if(t instanceof G)return new G(t.start(),e);if(t instanceof K){let i=e.angleD(t.center);return Oi(mt.regularD(t.startAngle),mt.regularD(i))?K.build3(t.center,t.startAngle,0,t.rx,t.ry):K.build2(t.center,t.startAngle,i,t.rx,t.ry,t.isCCW?1:0)}else{if(t instanceof rt)return t.clip(t.getPercent(e,ht))[0];throw new Error("not supported operation")}}function hi(t,e=mt.toRadians(t.startAngle)){return t.isCCW?e+=Kn:e-=Kn,new X(Math.cos(e),Math.sin(e))}function Yr(t,e=0){let i=t.controls;if(e===0){let s=i[0],r=i.slice(1).find(n=>!(n.x===s.x&&n.y===s.y));if(!r)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return r.sub(s)}else if(e===1){let s=i[i.length-1],r=i.slice(0,-1).reverse().find(n=>!(n.x===s.x&&n.y===s.y));if(!r)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return s.sub(r)}if(i.length===3){let[s,r,n]=i;return r.sub(s).mul(2*(1-e)).add(n.sub(r).mul(2*e)).normalize()}else{let[s,r,n,a]=i;return r.sub(s).mul(3*(1-e)**2).add(n.sub(r).mul(6*(1-e)*e)).add(a.sub(n).mul(3*e**2)).normalize()}}function Qs(t,e,i){let s=t.slice(1).findIndex(n=>!(n.x===e.x&&n.y===e.y)),r=t[s+1];if(i&&(i.getPercent(r,ht)!==null||new G(i.start(),i.end()).distance(r)<=ht)&&(r=t[s+2]),!r)throw Error("getSecondPoint(controls: readonly Vector2[])");return r}function ct(t,e){if(t instanceof G)return t.end().sub(t.start()).normalize();if(t instanceof K)return(e?hi(t,e.angle(t.center)):hi(t)).normalize();if(t instanceof rt)if(t.controls.length===2){let[i,s]=t.controls;if(ut(i,s))throw Error("equalsPP(p0, p1)");return s.sub(i).normalize()}else return(e?Yr(t,t.getPercent(e,ht)):Yr(t)).normalize();else throw new Error("not support")}function ym(t,e,i){let s=[],r=e**2-4*t*i;if(r>=0){let n=-e/(2*t),a=Math.sqrt(r)/(2*t),o=n+a;if(s.push(o),r>0){let l=n-a;s.push(l)}}return s}function Tm(t,e,i,s,r=0,n=1){let a=[],o=t*Math.pow(r,3)+e*Math.pow(r,2)+i*r+s,l=t*Math.pow(n,3)+e*Math.pow(n,2)+i*n+s,u,c;if(o*l<0)for(;Math.abs(r-n)>ht;)if(u=(r+n)/2,c=t*Math.pow(u,3)+e*Math.pow(u,2)+i*u+s,Math.abs(c)<ht){a.push(u);break}else o*c<0?n=u:l*c<0&&(r=u);else o*l===0&&(o===0&&a.push(r),l===0&&a.push(n));return a}function Ma(t,e,i){if(t instanceof G||e.distance2(i)<=ve)return new G(e,i);if(t instanceof K)return K.build2(t.center,e.angleD(t.center),i.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);if(t instanceof rt){let s=t.getPercent(e,ht),r=t.getPercent(i,ht);return t.clip(s)[1].clip((r-s)/(1-s))[0]}else throw new Error("not supported operation")}function no(t){return Z.greater(t,0)&&Z.less(t,1)}function Zn(t,e,i,s){let r=t[s]-2*e[s]+i[s],n=e[s]-t[s];if(r===0)return[];let a=-n/r,o=[];return no(a)&&o.push(a),o}function Qn(t,e,i,s,r){let n,a,o=-t[r]+3*e[r]-3*i[r]+s[r],l=2*(t[r]-2*e[r]+i[r]),u=e[r]-t[r],c=l**2-4*o*u;if(Z.lesseq(c,0))n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;else{let f=Math.sqrt(c);n=(-l-f)/(2*o),a=(-l+f)/(2*o);let d=o*2;if(Z.lesseq(n,1)&&Z.greatereq(n,0)){let p=Number.NEGATIVE_INFINITY;for(;Z.neq(n,p);){p=n;let m=d*n+l;n=-(o*n**2+l*n+u-m*n)/m}}if(Z.lesseq(a,1)&&Z.greatereq(a,0)){let p=Number.NEGATIVE_INFINITY;for(;Z.neq(a,p);){p=a;let m=d*a+l;a=-(o*a**2+l*a+u-m*a)/m}}}let h=[];return no(a)&&h.push(a),no(n)&&h.push(n),h}function Fu(t,e){if(t.controls.length===2){let[o,l]=t.controls;ut(o,l)||e.push(new G(o,l));return}let i,s;if(t.controls.length===3){let[o,l,u]=t.controls;i=Zn(o,l,u,"x"),s=Zn(o,l,u,"y")}else{let[o,l,u,c]=t.controls;i=Qn(o,l,u,c,"x"),s=Qn(o,l,u,c,"y")}i.sort((o,l)=>l-o),s.sort((o,l)=>l-o);let r=i.pop()||1,n=s.pop()||1,a=0;for(;r!==1||n!==1;)if(Z.eq(r,n))r=i.pop()||1,n=s.pop()||1;else if(r<n){let[o,l]=t.clip((r-a)/(1-a));a=r,e.push(o),t=l,r=i.pop()||1}else{let[o,l]=t.clip((n-a)/(1-a));a=n,e.push(o),t=l,n=s.pop()||1}e.push(t)}var bm=1e-5,Mo=1,rt=class xe extends Qr{constructor(e){if(super(),this._startToEndL=null,e.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=e.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new G(this.start(),this.end())),this._startToEndL}build1(e){let i=[];return sr(e,(s,r)=>(i.push(r),!0)),new xe(i)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(e,i){if(i.length<1)throw new Error("bezier must have at least 1 point");if(i.length===1)return i[0];{let s=new Array(i.length-1);for(let r=1;r<i.length;r++){let n=i[r-1],a=i[r],o=(a.x-n.x)*e,l=(a.y-n.y)*e;s[r-1]=n.add1(o,l)}return xe.pointOn(e,s)}}clip1(e,i,s,r){if(s.push(i[0]),r.push(i[i.length-1]),i.length<2)throw new Error("bezier clip must have at least 2 point");if(i.length===2){let n=i[0],a=i[1],o=(a.x-n.x)*e,l=(a.y-n.y)*e,u=n.add1(o,l);s.push(u),r.push(u)}else{let n=new Array(i.length-1);for(let a=1;a<i.length;a++){let o=i[a-1],l=i[a],u=(l.x-o.x)*e,c=(l.y-o.y)*e;n[a-1]=o.add1(u,c)}this.clip1(e,n,s,r)}}clip(e){let i=[],s=[];return this.clip1(e,this.controls,i,s),[new xe(i),new xe(s.reverse())]}greater(e,i,s){return e-i>s}less(e,i,s){return e-i<-s}eq(e,i,s){return Math.abs(e-i)<=s}eqPP(e,i,s){return!e||!i?!1:this.eq(e.x,i.x,s)&&this.eq(e.y,i.y,s)}isInRange(e,i=Z.eps){let s=this.controls.map(n=>n.y-e.y),r=0;for(let n of s){if(this.less(n,0,i))r=r|1;else if(this.greater(n,0,i))r=r|2;else{r=3;break}if(r===3)break}if(r!==3)return!1;r=0;for(let n of this.controls){let a=n.x-e.x;if(this.less(a,0,i))r=r|1;else if(this.greater(a,0,i))r=r|2;else{r=3;break}if(r===3)break}return r===3}getPercent(e,i=Z.eps){if(!this.isInRange(e,i))return null;let s=Number.POSITIVE_INFINITY,r=[[this,0,1]];for(;r.length!==0;){let n=function(g){c=Math.min(c,g),h=Math.max(h,g)},a=function(g,b){let y=Ii(g,b);if(y===0)throw new Error("cnt === 0");for(let E=0;E<y;E+=2)n(N[E])},[o,l,u]=r.pop();if(this.eqPP(o.start(),e,i))return l;if(this.eqPP(o.end(),e,i))return u;let c=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,f=o.controls.map(g=>g.y-e.y);s=f.reduce((g,b)=>{let y=Math.abs(b);return y<g?y:g},s),s/=2,s<=i&&(s=i),f.forEach((g,b)=>{this.eq(g,0,i)&&n(b/(f.length-1))});let d=new G(new X(0,-s),new X(1,-s)),p=new G(new X(0,s),new X(1,s));for(let g=0;g<f.length-1;g++){let b=new X(g/(f.length-1),f[g]),y=this.less(b.y,0,i)?1:this.greater(b.y,0,i)?2:3;for(let E=0;E<f.length;E++){let _=new X(E/(f.length-1),f[E]),S=this.less(_.y,0,i)?1:this.greater(_.y,0,i)?2:3;y!==S&&(y===1?S===2?(a(new G(b,_),d),a(new G(b,_),p)):a(new G(b,_),d):y===2?S===1?(a(new G(b,_),d),a(new G(b,_),p)):a(new G(b,_),p):S===1?a(new G(b,_),d):a(new G(b,_),p))}}if(!isFinite(c)){if(Math.max(...f.map(g=>Math.abs(g)))<i*4)return(l+u)/2;continue}if(c!==0&&(o=o.clip(c)[1],l=(u-l)*c+l),h!==1){let g=(h-c)/(1-c);o=o.clip(g)[0],u=(u-l)*g+l}if(!o.isInRange(e,i))continue;let m=o.controls.reduce((g,b)=>g.ext2(b),new Fe).build1();if(this.eq(m.minX,m.maxX,i)&&this.eq(m.minY,m.maxY,i))return(l+u)/2;if(h-c>.8){let[g,b]=o.clip(.5);g.isInRange(e,i)?(r.push([g,l,(l+u)/2]),b.isInRange(e,i)&&r.push([b,(l+u)/2,u])):r.push([b,(l+u)/2,u])}else r.push([o,l,u])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new Fe().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new Fe().ext3(this.controls).build()),this._bbox_controls}multiply3(e){let i=new Array(this.controls.length);for(let s=0;s<this.controls.length;s++){let r=this.controls[s];i[s]=r.multiply3(e)}return new xe(i)}stroke(e,i,s,r=Mo){let n=gm.zoomLines(St.build4(this.points(r)),e);return s===0?n:n.reverse()}points(e){let i=[];return this.getBezierPoints(e,s=>i.push(s)),i}getBezierPoints(e,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let s=[this];for(i(this.start());s.length!==0;){let n=s.pop(),a=new G(n.start(),n.end());if(r(n.controls,a)<=e)i(n.end());else{let[o,l]=n.clip(.5);s.push(l,o)}}function r(n,a){let o=a.start(),l=a.end();o.equals1(l)&&(l=o.add1(1,0));let u=l.y-o.y,c=o.x-l.x,h=-u*o.x-c*o.y,f=Math.sqrt(1/(u**2+c**2));u*=f,c*=f,h*=f;let d=n.map(p=>Math.abs(u*p.x+c*p.y+h));return Math.max(...d)}}getBezierPoints3(e,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let s=e*e,r=this.controls[0],n=.5;for(;n>bm&&!(r.distance2(xe.pointOn(n,this.controls))<=s);n*=.5);let a=Math.ceil(1/n);n=1/a,i(r);let o=0;for(let l=1;l<a;l++)o+=n,i(xe.pointOn(o,this.controls));i(this.end())}getPointsBySlope(e){if(this.controls.length===4)return this.getPointsBySlope4(e);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(e){let[i,s,r,n]=this.controls,a=-3*i.x+9*s.x-9*r.x+3*n.x,o=6*i.x-12*s.x+6*r.x,l=-3*i.x+3*s.x,u=[];if(Number.isFinite(e)){let c=-3*i.y+9*s.y-9*r.y+3*n.y,h=6*i.y-12*s.y+6*r.y,f=-3*i.y+3*s.y,d=c-a*e,p=h-o*e,m=f-l*e,g=-p/(2*d),b=Math.sqrt(p**2-4*d*m)/(2*d),y=g+b;y>=0&&y<=1&&u.push(xe.pointOn(y,this.controls));let E=g-b;E>=0&&E<=1&&u.push(xe.pointOn(E,this.controls))}else{let c=-o/(2*a),h=Math.sqrt(o**2-4*a*l)/(2*a),f=c+h;f>=0&&f<=1&&u.push(xe.pointOn(f,this.controls));let d=c-h;d>=0&&d<=1&&u.push(xe.pointOn(d,this.controls))}return u}buildConverxHull(e=Z.eps){let i=[...this.controls],s=[],r=i[0],n=1;do{let a=i[n%i.length];this.eqPP(r,a,e)||s.push(new G(r,a)),r=a,n++}while(r!==i[0]);if(s.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return St.build7(s).asClose()}getExtremePoints(e){if(!e)return a(this.controls);let i=e.start(),s=e.end(),r=s.x-i.x,n=s.y-i.y;if(Math.abs(r)<=Z.eps||Math.abs(n)<=Z.eps)return a(this.controls);{let o=n/r;if(this.controls.length===3){i.equals1(s)&&(s=i.add1(1,0));let l=s.y-i.y,u=i.x-s.x,c=-l*i.x-u*i.y,h=Math.sqrt(1/(l**2+u**2));l*=h,u*=h,c*=h;let f=this.controls.map(m=>l*m.x+u*m.y+c),d=f[0]-2*f[1]+f[2],p=f[1]-f[0]-o/2;if(d!==0){let m=-p/d;if(Z.greater(m,0)&&Z.less(m,1))return[xe.pointOn(m,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(o)}return[];function a(o){let l,u;if(o.length===3){let[d,p,m]=o;l=Zn(d,p,m,"x"),u=Zn(d,p,m,"y")}else if(o.length===4){let[d,p,m,g]=o;l=Qn(d,p,m,g,"x"),u=Qn(d,p,m,g,"y")}l.sort((d,p)=>p-d),u.sort((d,p)=>p-d);let c=l.pop()||1,h=u.pop()||1,f=[];for(;c!==1||h!==1;)Z.eq(c,h)?(c=l.pop()||1,h=u.pop()||1):c<h?(f.push(xe.pointOn(c,o)),c=l.pop()||1):(f.push(xe.pointOn(h,o)),h=u.pop()||1);return f}}getToLineMaxDis2(e){let i=this.getExtremePoints(e),s=e.distance2(this.start()),r=e.distance2(this.end()),n=Math.max(s,r);return i.forEach(o=>a(e.distance2(o))),n;function a(o){n=Math.max(n,o)}}getToLineMinAndMaxDis_Controls(e){let i=e.start(),s=e.end();e.start().equals1(e.end())&&(s=i.add1(1,0));let r=s.y-i.y,n=i.x-s.x,a=-r*i.x-n*i.y,o=Math.sqrt(1/(r**2+n**2));r*=o,n*=o,a*=o;let l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return this.controls.forEach(c=>{let h=r*c.x+n*c.y+a;h<l&&(l=h),h>u&&(u=h)}),{minDis:l,maxDis:u}}getPercentInLine(e){let i=[],s=[],r=this.controls,n=e.start(),a=e.end(),o=a.y-n.y,l=n.x-a.x,u=-o*n.x-l*n.y,c=Math.sqrt(1/(o**2+l**2));if(o*=c,l*=c,u*=c,o**2+l**2<=0)return i;if(r.length===3){let[h,f,d]=r,p=o*(h.x-2*f.x+d.x)+l*(h.y-2*f.y+d.y),m=2*(o*(f.x-h.x)+l*(f.y-h.y)),g=o*h.x+l*h.y+u;s=ym(p,m,g)}else if(r.length===4){let[h,f,d,p]=r,m=p.sub(d.mul(3)).add(f.mul(3)).sub(h),g=h.sub(f.mul(2)).add(d).mul(3),b=f.sub(h).mul(3),y=h,E=o*m.x+l*m.y,_=o*g.x+l*g.y,S=o*b.x+l*b.y,A=o*y.x+l*y.y+u,w=Math.sqrt(1/(E**2+_**2));E*=w,_*=w,S*=w,A*=w,s=Tm(E,_,S,A)}else throw Error("not support getBeizerPointInLine");return s.forEach(h=>{h>=0&&h<=1&&i.push(h)}),i}reverse(){return new xe(this.controls.slice().reverse())}},bi,Uu=(bi=class{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=X.ORIGIN,this.textOffsetCache[1]=new X(0,-.5),this.textOffsetCache[2]=new X(0,-1),this.textOffsetCache[3]=new X(-.5,0),this.textOffsetCache[4]=new X(-.5,-.5),this.textOffsetCache[5]=new X(-.5,-1),this.textOffsetCache[6]=new X(-1,0),this.textOffsetCache[7]=new X(-1,-.5),this.textOffsetCache[8]=new X(-1,-1)}static getCache(){return bi.instance==null&&(bi.instance=new bi),bi.instance}},bi.instance=null,bi),G=class ms extends Qr{constructor(e,i){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=e,this._end=i}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(e){if(Z.eq(this.distance(e),0)){let i=new ms(this._start,e);return i._a=this._a,i._b=this._b,i._c=this._c,i}return new ms(this._start,e)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new rt([this._start,this._end])}_hashCode(){let e=31,i=1;return i=e*i+this._start.hashCode(),i=e*i+this._end.hashCode(),i}start(){return this._start}end(){return this._end}center(){let e=this.start(),i=this.end();return e.add(i).mul(.5)}panDistance(e){let i=this._end.x-this._start.x,s=this._end.y-this._start.y,r=this.length();i=i*e/r,s=-s*e/r;let n=new X(this._start.x+s,this._start.y+i),a=new X(this._end.x+s,this._end.y+i);return new ms(n,a)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let e=Uu.getCache().boxCache;e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.__bbox=new Ne(e[0],e[1],e[2],e[3])}return this.__bbox}multiply3(e){return new ms(this._start.multiply3(e),this._end.multiply3(e))}hashCode(){return this.hashed}equals(e){let i=e;return this.hashed===i.hashed&&this._start.equals(i._start)&&this._end.equals(i._end)}equals1(e){let i=e;return this.hashed===i.hashed&&this._start.equals1(i._start)&&this._end.equals1(i._end)}equals2(e){let i=[this.start(),this.end()],s=[e.start(),e.end()];return oi(i,s)||oi(i,s.reverse())}stroke(e,i,s){let r,n,a;this._end.x<this._start.x?(n=this._start.x-this._end.x,a=this._start.y-this._end.y,r=this._end):(n=this._end.x-this._start.x,a=this._end.y-this._start.y,r=this._start);let o=Math.sqrt(n*n+a*a),l=e/2,u,c,h;i===2?(c=-l,h=o+l):(c=0,h=o),i===0||i===2?s===0?u=St.build5([c,-l,c,l,h,l,h,-l]):u=St.build5([c,l,c,-l,h,-l,h,l]):s===0?u=St.build2([K.build3(new X(c,0),-90,-180,l,l),K.build3(new X(h,0),90,-180,l,l)]):u=St.build2([K.build3(new X(c,0),90,180,l,l),K.build3(new X(h,0),-90,180,l,l)]);let f=Math.atan2(a,n),d=Mt.rotate(f).translate1(r);return u.asClose().multiply3(d)}points(e){return[this._start,this._end]}mirrorY(e){return new ms(this.start().mirrorY(e),this.end().mirrorY(e))}reverse(){return new ms(this._end,this._start)}inArea(e,i,s){let r=e.x,n=e.y,a=this._start,o=this._end,l=s==1,u=r-a.x,c=n-a.y,h=r-o.x,f=n-o.y,d=o.x-a.x,p=o.y-a.y,m=new X(-p,d).normalize(),g=d+m.x*i/2,b=p+m.y*i/2,y=g*g+b*b,E=u*u+c*c,_=h*h+f*f,S=Math.abs(u*p-c*d)/2,A=Math.sqrt(d*d+p*p)*i/4;if(S<=A&&E<=y&&_<=y){if(l)return!0;{let w=new X(r,n).sub(o).normalize(),R=new X(r,n).sub(a).normalize(),L=new X(m.x,m.y).cross(w),M=new X(m.x,m.y).cross(R);return L>=0&&M<=0}}else if(l){let w=i/2;return E<=w*w?!0:_<=w*w}else return!1}isParallel(e,i=!1){let s=Z.eq(Math.abs(this.direct.cross(e.direct)),0),r=!i||Z.greatereq(this.direct.dot(e.direct),0);return s&&r}distance2(e){return(this.a*e.x+this.b*e.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(e){let{x:i,y:s}=e,{x:r,y:n}=this.start(),{x:a,y:o}=this.end();return((i-r)*(o-n)-(s-n)*(a-r))**2/((o-n)**2+(a-r)**2)}distance(e){return Math.abs(this.a*e.x+this.b*e.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function _m(t,e=.05){if(t.length<3)return t.slice();let i=t.slice(0,1),s=(n,a,o)=>tm(n.x,n.y,a.x,a.y,o.x,o.y);for(;;){i=t.slice(0,1);for(let n=1;n<t.length-1;n+=2)s(t[n],t[n-1],t[n+1])>e&&i.push(t[n]),i.push(t[n+1]);if(i.at(-1).equals1(t.at(-1))||i.push(t.at(-1)),t.length==i.length)break;t=i}let r=t[t.length-1];return i.push(r),i}var Sm=P0(L0());var Im=class{constructor(){this.fac=new Fe,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(t){for(this.fac.clear(),this.length=t.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=t[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},Am=new Im,St=class ee{constructor(e,i){this.__bbox=null,this.primitives=e,this.__bbox=i}static calcBBox(e){return Am.calcBBox(e)}static build1(e){let i=[],s=null;return Wn(e,(r,n)=>{let a=n.start();return s!==null&&!a.equals(s)&&i.push(new G(s,a)),i.push(n),s=n.end(),!0}),i.length===0&&s!=null&&i.push(new G(s,s)),new ee(i)}static build2(e){return ee.build1(io(e))}static build3(e){let i=[],s=null;return Wn(e,(r,n)=>(s!==null&&i.push(new G(s,n)),s=n,!0)),new ee(i)}static build4(e){return this.build3(io(e))}static build5(e){let i=[];for(let s=0;s<e.length;s+=2)i.push(new X(e[s],e[s+1]));return this.build4(i)}static build6(e){return ee.build4([e.LL(),e.LR(),e.UR(),e.UL(),e.LL()])}static build7(e){return new ee(e)}static build8(e){let i=new X(e[0],e[1]),s,r=[],n,a=(o,l)=>o.length==l&&o.every(u=>typeof u=="number");for(let o=2;o<e.length;)switch(typeof e[o]=="string"?n=e[o]:o-=1,n){case"ARC":{let l=e.slice(o+1,o+4);if(!a(l,3))throw new Error("invalid rawData");let u=l[0];s=new X(l[1],l[2]),r.push(K.build5(i,s,u)),i=s,o+=4;break}case"L":{let l=e.slice(o+1,o+3);if(!a(l,2))throw new Error("invalid rawData");s=new X(l[0],l[1]),r.push(new G(i,s)),i=s,o+=3;break}case"C":{let l=e.slice(o+1,o+7);if(!a(l,7))throw new Error("invalid rawData");let u=new X(l[0],l[1]),c=new X(l[2],l[3]);s=new X(l[4],l[5]),r.push(new rt([i,u,c,s])),i=s,o+=7;break}default:throw new Error("invalid rawData")}return ee.build2(r)}static buildBBox(e,i=0){return i===1?ee.build5([e.minX,e.minY,e.maxX,e.minY,e.maxX,e.maxY,e.minX,e.maxY,e.minX,e.minY]):ee.build5([e.minX,e.minY,e.minX,e.maxY,e.maxX,e.maxY,e.maxX,e.minY,e.minX,e.minY])}static triangulate(e,i,s=1){if(e.length===1){let l=new Array;e[0].asClose().points2(s,f=>l.push(f));let u,c=l[0],h=[];for(let f=0;f<l.length-2;f+=2){let d=l[f+1],p=l[f+2],m=d.sub(c).normalize().cross(p.sub(c).normalize());if(Z.neq(m,0)){if(u===!0){if(m<0){h.length=0;break}}else if(u===!1){if(m>0){h.length=0;break}}else u=m>0;h.push(c),h.push(d),h.push(p)}l.push(c),c=p}if(h.length!==0){for(let f=0;f<h.length;f+=3)i(h[f],h[f+1],h[f+2]);return}}let r=[],n=[];e.forEach(l=>{r.length!==0&&n.push(r.length/2),l.asClose().points2(s,u=>r.push(u.x,u.y))});let a=Sm.default(r,n),o=[];for(let l=1;l<r.length;l+=2)o.push(new X(r[l-1],r[l]));for(let l=0;l<a.length;l+=3)i(o[a[l]],o[a[l+1]],o[a[l+2]])}lines(e,i){let s=new Array;this.points(e,n=>s.push(n));let r=s[0];for(let n=1;n<s.length;n++){let a=s[n];i(r),i(a),r=a}}triangles(e,i){ee.triangulate([this],(...s)=>{s.forEach(r=>i(r))},e)}mirror(){let e=[];return this.primitives.forEach(i=>{if(i instanceof G)i=new G(i.start().mirror(),i.end().mirror());else if(i instanceof K)i=i.mirror();else if(i instanceof rt){let s=i.controls.map(r=>r.mirror());i=new rt(s)}else throw new Error("bug");e.push(i)}),new ee(e,this.__bbox)}getPoints(e){let i=[];for(let s of this.primitives)for(let r of s.points(e))i.push(r);return i}round(e=4){let i=this.primitives.slice();for(let s=0;s<i.length;s++){let r=i[s];if(r instanceof G){let n=r.start().round(e),a=r.end().round(e);i[s]=new G(n,a)}else if(r instanceof rt){let n=r.controls.map(a=>a.round(e));i[s]=new rt(n)}else if(r instanceof K){let n=r.start().round(e),a=r.end().round(e),o=r.sweepAngle;i[s]=K.build5(n,a,o)}}return new ee(i,this.__bbox)}simplify(e=.05){let i=[],s=!1,r=[],n=this.closed();if(this.primitives.length<=1)return ee.build2(this.primitives);let a=()=>{if(r.length>2){let l=_m(r,e);for(let u=1;u<l.length;u++)i.push(new G(l[u-1],l[u]))}else i.push(new G(r[0],r[1]));r.length=0,s=!1};for(let l=0;l<this.primitives.length;l++){let u=this.primitives[l];u instanceof G?(s?r.push(u.end()):(r.length=0,r.push(u.start(),u.end()),s=!0),l===this.primitives.length-1&&a()):(s&&a(),i.push(u))}let o=new ee(i,this.__bbox);return n&&!o.closed()&&(o=o.asClose()),o}hasBackLine(){let{primitives:e}=this,i;for(let s=0;s<e.length;s++){let r=e[s];if(r instanceof G){if(r.end().equals1(r.start()))continue;if(i&&(r.end().equals1(i.start())||em(r.end(),i.start(),i.end())))return!0;i=r}else i=null}return!1}area(e=.1){let i=0,s=this.end();return this.primitives.forEach(r=>{let n=r.start(),a=r.end();if(i+=(n.x+s.x)*(n.y-s.y),r instanceof G)i+=(a.x+n.x)*(a.y-n.y);else if(r instanceof K)i+=(a.x+n.x)*(a.y-n.y),i+=Math.PI*r.rx2*r.sweepAngle/180-X.normal(r.center,r.start(),r.end());else if(r instanceof rt){let o=n;r.points(e).forEach(l=>{i+=(l.x+o.x)*(l.y-o.y),o=l}),i+=(a.x+o.x)*(a.y-o.y)}s=a}),i/2}closed(e){return this.primitives.length===0?!1:this.start().equals(this.end(),e)}asClose(){let e=this.primitives[0],i=this.primitives[this.primitives.length-1],s=e.start(),r=i.end();if(s.equals(r))return this;{let n=new Array;return Pe.addAll(n,this.primitives),n.push(new G(r,s)),ee.build2(n)}}closeEndpoint(){let e=this.primitives[0],i=this.primitives[this.primitives.length-1],s=e.start(),r=i.end();if(s.equals1(r))return this;{let n=new Array;return Pe.addAll(n,this.primitives),n.push(new G(r,s)),new ee(n)}}reverse(){let e=new Array(this.primitives.length);for(let i=0,s=this.primitives.length-1;s>=0;i++,s--){let r=this.primitives[s];if(r instanceof G)r=new G(r.end(),r.start());else if(r instanceof K)r=r.exchangeSweep();else if(r instanceof rt)r=new rt(r.controls.slice().reverse());else throw new Error("bug");e[i]=r}return new ee(e,this.__bbox)}reverse1(){let e=new Array(this.primitives.length);for(let i=0,s=this.primitives.length-1;s>=0;i++,s--){let r=this.primitives[s];if(r instanceof G)r=new G(r.end(),r.start());else if(r instanceof K)r=r.exchangeSweep1();else if(r instanceof rt)r=new rt(r.controls.slice().reverse());else throw new Error("bug");e[i]=r}return new ee(e,this.__bbox)}mirrorY(e){let i=[];return this.primitives.forEach(s=>{if(s instanceof G)s=s.mirrorY(e);else if(s instanceof K)s=s.mirrorY(e);else if(s instanceof rt){let r=s.controls.map(n=>n.mirrorY(e));s=new rt(r)}else throw new Error("bug");i.push(s)}),new ee(i,this.__bbox)}points(e,i){if(this.primitives.length!==0){for(let s=0;s<this.primitives.length-1;s++){let r=this.primitives[s].points(e);r.pop(),r.forEach(n=>i(n))}this.primitives[this.primitives.length-1].points(e).forEach(s=>i(s))}}points1(e,i){if(this.primitives.length===0)return;for(let r=0;r<this.primitives.length-1;r++){let n=this.primitives[r],a=n instanceof K?n.points1(e):n.points(e);a.pop(),a.forEach(o=>i(o))}let s=this.primitives[this.primitives.length-1];(s instanceof K?s.points1(e):s.points(e)).forEach(r=>i(r))}points2(e,i){if(this.primitives.length===0)return;for(let r=0;r<this.primitives.length-1;r++){let n=this.primitives[r],a=n instanceof K?n.points2():n.points(e);a.pop(),a.forEach(o=>i(o))}let s=this.primitives[this.primitives.length-1];(s instanceof K?s.points2():s.points(e)).forEach(r=>i(r))}multiply3(e){let i=new Array(this.primitives.length);for(let s=0;s<this.primitives.length;s++)i[s]=this.primitives[s].multiply3(e);return ee.build7(i)}bbox(){return this.__bbox==null&&(this.__bbox=ee.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(e){if(this.primitives.length<=1&&!(this.primitives[0]instanceof K))return!1;{let i=this.primitives[0],s=this.primitives[this.primitives.length-1];return i.start().equals(s.end(),e)}}isEqual(e){if(e instanceof ee&&e.primitives.length==this.primitives.length){let i=e.primitives.length;for(let s=0;s<i;s++){let r=e.primitives[s],n=this.primitives[s];if(JSON.stringify(r)!=JSON.stringify(n))return!1}return!0}return!1}equals(e){if(!e)return!1;let i=this.primitives,s=e.primitives;if(i.length!=s.length)return!1;if(e.isClose()){let r=0;for(;r<i.length;){let n=i.slice(r).concat(i.slice(0,r));if(oi(n,s)||oi(n.reverse(),s))return!0;r++}return!1}else return oi(this.primitives,e.primitives)}clone(){return ee.build2(this.primitives)}putItem(e,i){if(!e)return!1;if(e instanceof ee)return this.mergePolyline(e,i);let s=this.start();if(!s){this.primitives.push(e),this.__bbox=e.bbox();return}let r=this.end();if(s.equals(r,i))return!1;let n=e.start(),a=e.end(),o=!1,l=!1;if(s.equals(n,i))o=!0,l=!1;else if(s.equals(a,i))o=!1,l=!1;else if(r.equals(n,i))o=!1,l=!0;else if(r.equals(a,i))o=!0,l=!0;else return!1;return l?this.primitives.push(o?e.reverse():e):this.primitives.unshift(o?e.reverse():e),this.__bbox=Ne.extend2(this.__bbox,e.bbox()),!0}mergePolyline(e,i,s=0){if(!e)return!1;let r=this.start();if(!r){this.primitives.push(...e.primitives),this.__bbox=e.bbox();return}let n=this.end();if(r.equals(n,i))return!1;let a=e.start(),o=e.end(),l=!1,u=!1;if(r.equals(a,i))l=!0,u=!1;else if(r.equals(o,i))l=!1,u=!1;else if(n.equals(a,i))l=!1,u=!0;else if(n.equals(o,i))l=!0,u=!0;else return!1;let c=l?e.reverse():e;return u?this.primitives.push(...c.primitives):this.primitives.unshift(...c.primitives),this.__bbox=Ne.extend2(this.__bbox,e.bbox()),!0}deDuplicationPoint(e){let i=this.primitives[this.primitives.length-1].start(),s=this.primitives[this.primitives.length-1].end(),r=e.primitives[0].start(),n=e.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof G&&e.primitives[0]instanceof G&&lm([i,s],[r,n])){this.primitives.pop(),e.primitives.shift();let a=[];a.push(new G(i,n)),this.primitives.push(...a)}}getMaxBBoxHeightByVec(e){let i=e.normalize(),s=-1/0,r=1/0;if(this.primitives.forEach(a=>{let o=a.start().dot(i),l=a.end().dot(i);if(n(o),n(l),a instanceof K){let u=e.angleD(X.ORIGIN);if(a.angleIsInArc(u)){let c=a.pointOn(u).dot(i);n(c)}if(a.angleIsInArc(u+180)){let c=a.pointOn(u-180).dot(i);n(c)}}}),s-r<=0)throw new Error("getMaxBBoxHeightByVec");return s-r;function n(a){a>s&&(s=a),a<r&&(r=a)}}getWindingNum(e){let i=this.end(),s=0,{x:r,y:n}=e;for(let o of this.primitives){if(i.y>n?o.bbox().minY>n:o.bbox().maxY<=n){i=o.end();continue}if(o instanceof K&&(o.isCCW?Math.floor(o.startAngle/90)+1!==Math.ceil(o.endAngle()/90):Math.ceil(o.startAngle/90)-1!==Math.floor(o.endAngle()/90))){let l=o.startAngle,u=o.endAngle();if(o.sweepAngle>0){let c=90;for(;c<=u;)c>l&&(a(K.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c+=90;l<u&&a(K.build3(o.center,l,u-l,o.rx,o.ry))}else{let c=270;for(;c>=u;)c<l&&(a(K.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c-=90;l>u&&a(K.build3(o.center,l,u-l,o.rx,o.ry))}}else if(o instanceof rt){let l=[];Fu(o,l),l.forEach(u=>a(u))}else a(o)}return s;function a(o){let l=o.start(),u=o.end();if(i.y>n!=l.y>n&&(i.x>r?l.x>r?s+=l.y>i.y?1:-1:i.y>l.y?(i.x-r)*(l.y-n)-(i.y-n)*(l.x-r)<0&&s--:(i.x-r)*(l.y-n)-(i.y-n)*(l.x-r)>0&&s++:l.x>r&&(i.y>l.y?(i.x-r)*(l.y-n)-(i.y-n)*(l.x-r)<0&&s--:(i.x-r)*(l.y-n)-(i.y-n)*(l.x-r)>0&&s++)),l.y>n!=u.y>n){if(l.x>r)if(u.x>r)s+=u.y>l.y?1:-1;else if(o instanceof G)l.y>u.y?(l.x-r)*(u.y-n)-(l.y-n)*(u.x-r)<0&&s--:(l.x-r)*(u.y-n)-(l.y-n)*(u.x-r)>0&&s++;else if(o instanceof K){let{center:c,isCCW:h,rx2:f}=o,d=(c.x-r)**2+(c.y-n)**2;l.y>u.y?(h?d>f:d<f)&&s--:(h?d<f:d>f)&&s++}else if(o instanceof rt){if(xl(o,n)===0)throw new Error("no inters");N[0]>r&&(s+=u.y>l.y?1:-1)}else throw new Error("not support!");else if(u.x>r)if(o instanceof G)l.y>u.y?(l.x-r)*(u.y-n)-(l.y-n)*(u.x-r)<0&&s--:(l.x-r)*(u.y-n)-(l.y-n)*(u.x-r)>0&&s++;else if(o instanceof K){let{center:c,isCCW:h,rx2:f}=o,d=(c.x-r)**2+(c.y-n)**2;l.y>u.y?(h?d>f:d<f)&&s--:(h?d<f:d>f)&&s++}else if(o instanceof rt){if(xl(o,n)===0)throw new Error("no inters");N[0]>r&&(s+=u.y>l.y?1:-1)}else throw new Error("not support!")}i=u}}},bn=Math.PI*2;var g_=Math.PI/2,E_=Math.sin(Math.PI/180);var Om=4,K=class Gt extends Qr{constructor(e,i,s,r,n){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=e,this.ry=i,this.center=s,this.startAngle=r,this.sweepAngle=n,this._start=X.ORIGIN,this._end=X.ORIGIN,this._start=this.pointOn(r),this._end=this.pointOn(r+n)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let e=31,i=1;return i=e*i+new X(this.rx,this.rx).hashCode(),i=e*i+this.center.hashCode(),i=e*i+new X(this.startAngle,this.sweepAngle).hashCode(),i}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(e,i,s,r){let n=i>=0?-.01:.01,a=e+i;for(;(i>=0&&a>e||i<0&&a<e)&&s.distance2(r)<2e-4;)n*=2,a+=n,r=this.pointOn(a);return r}static build1(e,i,s,r,n,a){Jt.positive(s),Jt.positive(r);let o=e.equals(i);if(o)return new Gt(s,r,e,0,n?360:0);{let l=e.x,u=-e.y,c=i.x,h=-i.y,f=a===0,d=(l-c)/2,p=(u-h)/2,m=Math.cos(0),g=Math.sin(0),b=m*d+g*p,y=-g*d+m*p;s=Math.abs(s),r=Math.abs(r);let E=s*s,_=r*r,S=b*b,A=y*y,w=n===f?-1:1,R=(E*_-E*A-_*S)/(E*A+_*S);R=R<0?0:R;let L=w*Math.sqrt(R),M=L*(s*y/r),B=L*-(r*b/s),q=(l+c)/2,H=(u+h)/2,V=q+(m*M-g*B),W=H+(g*M+m*B),v=(b-M)/s,j=(y-B)/r,O=(-b-M)/s,x=(-y-B)/r,k,F;F=Math.sqrt(v*v+j*j),k=v,w=j<0?-1:1;let P=mt.toDegrees(w*Math.acos(k/F));F=Math.sqrt((v*v+j*j)*(O*O+x*x)),k=v*O+j*x,w=v*x-j*O<0?-1:1;let z=k/F,Y;z<-1?Y=Math.acos(-1):z>1?Y=Math.acos(1):Y=Math.acos(z);let tt=mt.toDegrees(w*Y);!f&&tt>0?tt-=360:f&&tt<0&&(tt+=360),Jt.normal(P),Jt.normal(tt);let it=d*d/E+p*p/_,nt=e.distance1(i)/2;s<nt&&r<nt&&(s*=Math.sqrt(it),r*=Math.sqrt(it));let at=o?0:mt.regularD(-P),pt=o?n?360:0:-tt;return new Gt(s,r,new X(V,-W),at,pt)}}static build2(e,i,s,r,n,a){Jt.positive(r),Jt.positive(n),Jt.normal(i),Jt.normal(s);let o;return i===s?(i=mt.regularD(i),s=mt.regularD(s),o=0):(i=mt.regularD(i),s=mt.regularD(s),a===1?s<=i&&(s+=360):s>=i&&(i+=360),o=s-i),new Gt(r,n,e,mt.regularD(i),o)}static build3(e,i,s,r,n){return Jt.positive(r),Jt.positive(n),Jt.normal(s),new Gt(r,n,e,mt.regularD(i),s)}static build4(e,i,s,r,n,a){let o=e.angleD(s),l=i.angleD(s);return Gt.build2(s,o,l,r,n,a)}static build5(e,i,s){s=mt.toRadians(s);let r=i.sub(e),n=new X(-r.y,r.x).normalize(),a=Math.abs(s)/2,o;if(a!=0)o=r.length()/2/Math.sin(a);else throw new Error("Can't represent circle!!!");let l=n.rotate(X.ORIGIN,a),u,c;s>0?(u=1,c=i.add(l.scale(o))):(u=0,c=e.sub(l.scale(o)));let h=mt.toDegrees(e.angle(c)),f=mt.toDegrees(i.angle(c));return Gt.build2(c,h,f,o,o,u)}static buildCircle(e,i,s=0){return Gt.build2(e,0,360,i,i,s)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(e){e=mt.regularD(e);let i=this.rx,s=this.ry;if(e===0)return this.center.add1(i,0);if(e===90)return this.center.add1(0,s);if(e===180)return this.center.add1(-i,0);if(e===270)return this.center.add1(0,-s);{let r=this.rx2,n=this.ry2,a=Math.tan(mt.toRadians(e)),o=a*a,l=Math.sqrt(r*n/(r+n/o)),u=Math.sqrt(r*n/(n+r*o));return e>90&&e<270&&(u=-u),e>180&&e<360&&(l=-l),isNaN(u)&&(u=0),isNaN(l)&&(l=0),this.center.add1(u,l)}}exchangeSweep(){return Gt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return Gt.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return Gt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(e){let i=this.start(),s=this.end();return i.equals(s)?Gt.build3(this.center.mirrorY(),0,360,this.rx,this.ry):Gt.build1(i.mirrorY(e),s.mirrorY(e),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(e=X.ORIGIN){let i=this.start(),s=this.end();return i.equals(s)?Gt.build3(this.center.mirror(e),0,360,this.rx,this.ry):Gt.build1(i.mirror(e),s.mirror(e),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let e=so.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-e}multiply3(e){let i;e.isMirrored()?i=-this.sweepAngle:i=this.sweepAngle;let s;return e.equals(Mt.ROT_90)?s=mt.regularD(this.startAngle+90):e.equals(Mt.ROT_N90)?s=mt.regularD(this.startAngle-90):s=mt.transformD(this.startAngle,e),Gt.build3(this.center.multiply3(e),s,i,e.iScale*this.rx,e.iScale*this.ry)}angleIsInArc(e){return e=mt.regularD(e),this.sweepAngle>0?(e<this.startAngle&&(e+=360),this.endAngle()>e):(e>this.startAngle&&(e-=360),this.endAngle()<e)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let e=this.start(),i=this.end(),s=mt.toRadians(this.sweepAngle)/2,r=4/3*(1-Math.cos(s))/Math.sin(s)*this.rx;return new rt([e,e.add(new X(r,0).multiply3(Mt.rotateD(this.startAngle+90))),i.add(new X(r,0).multiply3(Mt.rotateD(this.endAngle()-90))),i])}toBezier2(){let e=[];s(this,90);let i=[];return e.forEach(r=>i.push(r.toBezier())),i;function s(r,n){if(Math.abs(r.sweepAngle)>n){let a=r.sweepAngle/2;s(Gt.build3(r.center,r.startAngle,a,r.rx,r.ry),n),s(Gt.build3(r.center,r.startAngle+a,a,r.rx,r.ry),n)}else e.push(r)}}buildBBox(){let e=Uu.getCache().boxCache,i=this.startAngle+this.sweepAngle;if(e[0]=Math.min(this._start.x,this._end.x),e[1]=Math.max(this._start.x,this._end.x),e[2]=Math.min(this._start.y,this._end.y),e[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let s=0;for(;s<i;){if(s>this.startAngle){let r=this.pointOn(s);e[0]=Math.min(e[0],r.x),e[1]=Math.max(e[1],r.x),e[2]=Math.min(e[2],r.y),e[3]=Math.max(e[3],r.y)}s+=90}}else if(this.sweepAngle<0){let s=360;for(;s>i;){if(s<this.startAngle){let r=this.pointOn(s);e[0]=Math.min(e[0],r.x),e[1]=Math.max(e[1],r.x),e[2]=Math.min(e[2],r.y),e[3]=Math.max(e[3],r.y)}s-=90}}return new Ne(e[0],e[1],e[2],e[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return Zs.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(e,i,s){let r=e/2,n=this.rx+r,a=this.ry+r,o=this.rx-r,l=this.ry-r,u=new Mt;o<0&&(o=-o,u=u.multiply3(Mt.MIRROR_Y)),l<0&&(l=-l,u=u.multiply3(Mt.MIRROR_X)),o===0&&(o=.001),l===0&&(l=.001),u=u.setOrigin1(this.center);let c,h;switch(s===this.sweep()?(c=Gt.build3(this.center,this.startAngle,this.sweepAngle,n,a),h=Gt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,o,l)):(c=Gt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,n,a),h=Gt.build3(this.center,this.startAngle,this.sweepAngle,o,l)),h=h.multiply3(u),i){case 1:{let f=s===1?180:-180,d=s===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),p=s===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),m=c.pointOn(c.endAngle()).angleD(d),g=h.pointOn(h.endAngle()).angleD(p);return St.build2([c,Gt.build3(d,m,f,r,r),h,Gt.build3(p,g,f,r,r)])}default:return St.build2([c,h])}}points2(){let e=Math.ceil(Math.abs(this.sweepAngle)/Om),i=this.sweepAngle/e,s=[this._start];for(let r=1;r<e;r++)s.push(this.pointOn(this.startAngle+i*r));return s.push(this._end),s}points1(e){let i=Math.max(this.rx,this.ry);if(i<=e)return[this.start(),this.svgEnd];let s=(i-e)/i,r=Math.ceil(Math.abs(this.sweepAngle/mt.toDegrees(Math.acos(s))/2)),n=new Array(r+1),a=this.sweepAngle/r,o=this.startAngle;for(let l=0;l<=r;l++,o+=a)n[l]=this.pointOn(o);return n}points(e){let i=Math.max(this.rx,this.ry);if(e=Math.abs(e),i<=e)return[this.start(),this.svgEnd];e=Math.max(e,i*1e-5),e=Math.min(e,i*(1-Math.SQRT1_2));let s=(i-e)/i,r=Math.ceil(Math.abs(this.sweepAngle/mt.toDegrees(Math.acos(s))/2));r=Math.max(r,2);let n=new Array(r+1),a=this.sweepAngle/r,o=this.startAngle+a;n[0]=this.start();for(let l=1;l<r;l++,o+=a)n[l]=this.pointOn(o);return n[r]=this.end(),n}panDistance(e){return this.sweepAngle>0?new Gt(this.rx-e,this.ry-e,this.center,this.startAngle,this.sweepAngle):new Gt(this.rx+e,this.ry+e,this.center,this.startAngle,this.sweepAngle)}panDistance1(e){if(this.sweepAngle>0){let i=this.rx-e;return i<0?(i=Math.abs(i),Gt.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new Gt(i,i,this.center,this.startAngle,this.sweepAngle)}else{let i=this.rx+e;return i<0?(i=Math.abs(i),Gt.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new Gt(i,i,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let e=Math.abs(Z0(this.sweepAngle,3))/180*Math.PI;return Math.tan(e/4)}get midPoint(){let e=mt.toRadians(this.startAngle),i=mt.toRadians(this.endAngle()),s=this.sweep(),r=this.center,n=this.rx;if(s==1)if(i>e){let a=(i-e)/2+e;return r.add(new X(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==e)return r.add(new X(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(i+bn-e)/2+e;return r.add(new X(Math.cos(a),Math.sin(a)).mul(n))}}else if(i>e){let a=(e+bn-i)/2+i;return r.add(new X(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==e)return r.add(new X(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(e-i)/2+i;return r.add(new X(Math.cos(a),Math.sin(a)).mul(n))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(e){let i=mt.regularD(this.startAngle),s=mt.regularD(this.sweepAngle),r=mt.regularD(e.startAngle),n=mt.regularD(e.sweepAngle);return oi([this.rx,this.ry,this.center,Math.abs(s)],[e.rx,e.ry,e.center,Math.abs(n)])&&(oi([s,i],[n,r])||oi([mt.regularD(i+s)],[r]))}equals1(e){let i=mt.regularD(this.startAngle),s=mt.regularD(this.sweepAngle),r=mt.regularD(e.startAngle),n=mt.regularD(e.sweepAngle);return oi([this.rx,this.ry,this.center,Math.abs(s)],[e.rx,e.ry,e.center,Math.abs(n)])&&(oi([s,i],[n,r])||oi([mt.regularD(i+s)],[r]))}inArea(e,i){let s=e.x,r=e.y,n=this.center,a=this.rx,o=mt.toRadians(this.startAngle);this.sweep()==0&&(o=mt.toRadians(this.endAngle()));let l=mt.toRadians(this.endAngle());this.sweep()==0&&(l=mt.toRadians(this.startAngle));let u=a-i/2,c=a+i/2;var h=s-n.x,f=r-n.y,d=Math.atan2(f,h);if(d<0&&(d+=bn),o<=l&&d>=o&&d<=l||o>l&&(d>=o&&d<=bn||d>=0&&d<=l)||o==l){var p=Math.sqrt(h*h+f*f);return p<=c&&p>=u}else{var p=(c+u)/2,m=new X(n.x+Math.cos(o)*p,n.y+Math.sin(o)*p),g=new X(n.x+Math.cos(l)*p,n.y+Math.sin(l)*p),b=s-m.x,y=r-m.y,E=s-g.x,_=r-g.y;return b*b+y*y<=i*i/4?!0:E*E+_*_<=i*i/4}}isCircle(){return(Z.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return Gt.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let e=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+e)%e:(this.startAngle-this.endAngle()+e)%e}isValid(){return this.rx>0&&this.ry>0}},ju=new ArrayBuffer(24),Ba=new Float64Array(ju),Us=new Int32Array(ju),oe,y_=(oe=class{static normal(e,i,s){let r=i.sub(e),n=s.sub(i);return r.cross(n)}constructor(e,i,s){this.x=Jt.normal(e),this.y=Jt.normal(i),this.z=Jt.normal(s),Ba[0]=e,Ba[1]=i,Ba[2]=s,this.hashed=Us[0]^Us[1]^Us[2]^Us[3]^Us[4]^Us[5]}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(e){return e instanceof oe?e.x===this.x&&e.y===this.y&&e.z===this.z:!1}cross(e){return new oe(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var e=this.length();return new oe(this.x/e,this.y/e,this.z/e)}sub(e){return new oe(this.x-e.x,this.y-e.y,this.z-e.z)}add(e){return new oe(this.x+e.x,this.y+e.y,this.z+e.z)}scale(e){return new oe(this.x*e,this.y*e,this.z*e)}neg(){return new oe(-this.x,-this.y,-this.z)}multiply4(e){var i=this.x*e.data[0]+this.y*e.data[4]+this.z*e.data[8]+e.data[12],s=this.x*e.data[1]+this.y*e.data[5]+this.z*e.data[9]+e.data[13],r=this.x*e.data[2]+this.y*e.data[6]+this.z*e.data[10]+e.data[14],n=this.x*e.data[3]+this.y*e.data[7]+this.z*e.data[11]+e.data[15];return n!=0?new oe(i/n,s/n,r/n):new oe(i,s,r)}rotate(e,i){return this.multiply4(xu.rotateAxis(e,i))}toVector2(){return new X(this.x,this.y)}},oe.ORIGIN=new oe(0,0,0),oe.X_UNIT_VECTOR=new oe(1,0,0),oe.Y_UNIT_VECTOR=new oe(0,1,0),oe.Z_UNIT_VECTOR=new oe(0,0,1),oe);var te=class Xs{static build(e){return e instanceof St?new Xs([new le([e])]):e instanceof le?new Xs([e]):e}static buildByPolygon(e){return e?new Xs([e]):new Xs([])}static buildByStroke(e,i,s=1,r){return this.buildByPolygon(le.buildByStroke(e,i,s,Mo,r))}static buildCircle(e,i){return this.buildByPolygon(le.buildCircle(e,i))}static buildRect(e){return this.buildByPolygon(le.buildRect(e))}static buildBBox(e){return this.buildByPolygon(le.buildBBox(e))}constructor(e){this.items=e.slice()}multiply3(e){return new Xs(this.items.map(i=>i.multiply3(e)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((e,i)=>e.ext1(i.bbox()),new Fe).build1()),this._bbox}toPolylineGroups(){return this.items.map(e=>e.toPolylineGroup())}},Ft,Lt=(Ft=class{static isHexFormate(e){return!e||typeof e!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)}static of1(e){return this.of2(e>>16&255,e>>8&255,e&255)}static of2(e,i,s,r=255){return new Ft(e/255,i/255,s/255,r/255)}static of3(e){e.startsWith("#")&&(e=e.substr(1));let i=e.length;if(i==3)return new Ft(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15);if(i==6)return new Ft(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255);if(i==8)return new Ft(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,parseInt(e.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(e){let i=parseInt(e.r*255+"").toString(16),s=parseInt(e.g*255+"").toString(16),r=parseInt(e.b*255+"").toString(16);return i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),("#"+i+s+r).toUpperCase()}static of5(e,i){if(e.startsWith("#")&&(e=e.substr(1)),e.length==3)return new Ft(parseInt(e[0],16)/15,parseInt(e[1],16)/15,parseInt(e[2],16)/15,i);if(e.length==6)return new Ft(parseInt(e.substr(0,2),16)/255,parseInt(e.substr(2,2),16)/255,parseInt(e.substr(4,2),16)/255,i);throw new Error("invalid color string")}static of6(e,i){return new Ft(e.r,e.g,e.b,i)}static of7(e){return e==null?null:Ft.of3(e)}constructor(e,i,s,r=1){this.r=Jt.positiveOr0(e),this.g=Jt.positiveOr0(i),this.b=Jt.positiveOr0(s),this.alpha=r}hashCode(){return this.r+this.g+this.b+this.alpha}equals(e,i=!1){let s=this.r===e.r&&this.g===e.g&&this.b===e.b;return i?s:s&&this.alpha===e.alpha}add(e,i,s,r){return new Ft(Math.max(0,Math.min(1,this.r+e)),Math.max(0,Math.min(1,this.g+i)),Math.max(0,Math.min(1,this.b+s)),Math.max(0,Math.min(1,this.alpha+r)))}mul(e){return new Ft(Math.max(0,Math.min(1,this.r*e)),Math.max(0,Math.min(1,this.g*e)),Math.max(0,Math.min(1,this.b*e)),this.alpha)}mul1(e){return new Ft(Math.max(0,this.r*e),Math.max(0,this.g*e),Math.max(0,this.b*e),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let e=(this.r*255).toString(16),i=(this.g*255).toString(16),s=(this.b*255).toString(16);return e.length<2&&(e="0"+e),i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),"#"+e.substr(0,2)+i.substr(0,2)+s.substr(0,2)}toString1(){let e=(this.r*255).toString(16),i=(this.g*255).toString(16),s=(this.b*255).toString(16),r=(this.alpha*255).toString(16);return e.length<2&&(e="0"+e),i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),r.length<2&&(r="0"+r),"#"+e.substr(0,2)+i.substr(0,2)+s.substr(0,2)+r.substr(0,2)}toRGBA(){let e=this.r*255,i=this.g*255,s=this.b*255;return[e,i,s,this.alpha]}toRGBAString(){let e=this.r*255,i=this.g*255,s=this.b*255;return`rgba(${e},${i},${s},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},Ft.WHITE=new Ft(1,1,1,1),Ft.BLACK=new Ft(0,0,0,1),Ft.RED=new Ft(1,0,0,1),Ft.GREEN=new Ft(0,1,0,1),Ft.BLUE=new Ft(0,0,1,1),Ft.Gray=Ft.of3("#9966ff"),Ft.Silver=Ft.of3("#D2D2D2"),Ft.Golden=Ft.of3("#DCAA14"),Ft.Pink=Ft.of3("#ffaec9"),Ft),Gl=!1,Gu=class{onRTreeBBox(t){}onResultSide(t){}onOriginSide(t){}onSplitedSide(t){}onDebugSide(t){}onSweep(t,e,i,s,r,n){}onIntersect(t,e,i){}onSegment(t,e,i,s,r,n){}onSegment1(t,e,i){if(Gl){let s=new X(t.getX(i),i),r=new X(e.getX(i),i);this.onSegment(s,t.weight,t,r,e.weight,e)}else this.onSegment(t.start,t.weight,t,e.end,e.weight,e)}onSweep1(t,e,i){if(Gl){let s=new X(t.getX(i),i),r=new X(e.getX(i),i);this.onSweep(s,t.weight,t,r,e.weight,e)}else this.onSweep(t.start,t.weight,t,e.end,e.weight,e)}},jr=class extends Gu{constructor(t){super(),this.plGrps=new Array,this.debug=t}onPolylineGroup(t,e){this.plGrps.push(t)}},tn=class{constructor(t){this.cache={},this.levels=t,this.result=new Array(t),this.weights=new Array(t),this.maxIdx=t-1,this.rule=this.decide.bind(this);let e=1;for(let i=0;i<t;i++)this.weights[i]=e,e*=50}weight(t){return this.weights[t]}decide(t){t=Math.abs(t);let e=this.cache[t];if(e===void 0){let i=t;for(let s=this.maxIdx;s>=0;s--){let r=this.weights[s],n=t/r|0,a=t%r;a>(r/2|0)?(t=r-a,n++):t=a,this.result[s]=n>0}e=this.decide1(this.result),this.cache[i]=e}return e}},Rm=t=>t!==0;var Dm=new class extends tn{decide1(t){return t[0]||t[1]}}(2),Mn=new class extends tn{decide1(t){return t[0]&&!t[1]}}(2),Bn=new class extends tn{decide1(t){return t[0]&&t[1]}}(2),kn=new class extends tn{decide1(t){return t[0]&&!t[1]||!t[0]&&t[1]}}(2),wm=(t=>(t[t.UNMARKED=0]="UNMARKED",t[t.INSIDE=1]="INSIDE",t[t.OUTSIDE=2]="OUTSIDE",t[t.INVALID=3]="INVALID",t))(wm||{}),ur=class qs{constructor(e,i,s,r,n,a,o){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=e,this.shape=i,this.baseWeight=s,r.y>n.y?this.weight=-s:r.y==n.y?this.weight=0:this.weight=s,this.start=r,this.end=n,this.polyGrp=a,this.polyIndex=o,this._bbox=new Fe().ext1(i.bbox()).ext2(r).ext2(n).build1(),this.inters.push(r),this.inters.push(n);let l=31,u=1;u=l*u+this.polyGrp,u=l*u+this.polyIndex,this._hashcode=u}static rebuild(e,i,s){if(e instanceof G||i.distance2(s)<1e-6)return new G(i,s);if(e instanceof K){let r=e,n=e.bbox().center().x,a;i.y>s.y?a=n>r.center.x?0:1:a=n>r.center.x?1:0;let o=i.angleD(r.center),l=s.angleD(r.center);return K.build2(r.center,o,l,r.rx,r.ry,a)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Fe().ext2(this.start).ext2(this.end).build1()}is(e,i){return e===this.polyGrp&&i===this.polyIndex}confidence(e){if(this._confidence_y!=e){let i=this._bbox.height();if(i!==0)if(Math.abs(e-this._bbox.maxY)>5e-4&&Math.abs(e-this._bbox.minY)>5e-4){let s=1-Math.abs(2*e-this._bbox.maxY-this._bbox.minY)/i;this._confidence=s*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=e}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(e){let i=this.confidence(e);return this.outsideWeight-=i,this.invalidWeight+=i,i}revokeInside(e){let i=this.confidence(e);return this.insideWeight-=i,this.invalidWeight+=i,i}setOutside(e){let i=this.confidence(e);return this.outsideWeight+=i,i}setInside(e){let i=this.confidence(e);return this.insideWeight+=i,i}setInvalid(e){let i=this.confidence(e);return this.invalidWeight+=i,i}prevNot0(){let e=this.previous;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.previous}return null}nextNot0(){let e=this.next;for(;e!=null&&e!=this;){if(e.weight!=0)return e;e=e.next}return null}getX(e){if(this.bo!==null)return(this._x_y!=e||isNaN(this._x))&&(Bm(this,e)>0?this._x=N[0]:this._x=NaN,this._x_y=e),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(e){if(e===2)if(this.start.y>this.end.y){let i=qs.rebuild(this.shape,this.end,this.start),s=new qs(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return Pe.addAll(s.connect,this.connect),s}else return this;else if(e===1)if(this.start.y<this.end.y){let i=qs.rebuild(this.shape,this.end,this.start),s=new qs(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return Pe.addAll(s.connect,this.connect),s}else return this;return this}isNeedScan(e){return this.needCountWeight()&&this.confidence(e)>0}hashCode(){return this._hashcode}equals(e){return e instanceof qs?!(this.polyGrp!==e.polyGrp||this.polyIndex!==e.polyIndex):!1}bbox(){return this._bbox}toString(){return Zs.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function Cm(t,e){let i=t.bbox(),s=e.bbox(),r=(i.minY+i.maxY)/2,n=(s.minY+s.maxY)/2;return r-n}function Nm(t,e){let i=t.bbox(),s=e.bbox(),r=(i.minX+i.maxX)/2,n=(s.minX+s.maxX)/2;return r-n}var js=class{constructor(t){if(this.__bbox=null,typeof t<"u")if(t instanceof Array){this.__items=[];for(let e of t)this.add(e)}else this.__items=t,this.__bbox=t.bbox();else this.__items=[]}add(t){if(this.__items instanceof Array)this.__items.push(t),this.__bbox=Ne.extend2(this.__bbox,t.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},Vr=class{constructor(t){this.changed=!1,this.root=new js,this.capacity=t,this.capacity2=t*t,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(t){this.itemList.push(t),this.changed=!0}remove(t){Pe.remove(this.itemList,t),this.changed=!0}clear(){this.changed=!1,this.root=new js,this.itemList.length=0}flushWhenNeed(){if(this.changed){let t=new Array;for(let e of this.itemList)t.push(new js(e));for(;;){let e=this.organize(t);if(e.length>1)t=e;else break}this.root=new js(t),this.changed=!1}}organize(t){Ds(t,Nm,0,t.length);let e=t.length,i=[];for(let s=0;s<e;)if(s+this.capacity2<=e){let r=s+this.capacity2;Ds(t,Cm,s,r);for(let n=s;n<r;n+=this.capacity){let a=new js(t.slice(n,n+this.capacity));i.push(a)}s=s+this.capacity*this.capacity}else{let r=new js(t.slice(s,s+this.capacity));i.push(r),s=s+this.capacity}return i}search(t){this.flushWhenNeed();let e=[],i=[];for(i.push(this.root);;){let s=i.shift();if(typeof s<"u"){let r=s.items();if(r instanceof Array){for(let n of r)if(!t.isSeparated(n.bbox())){let a=n.items();a instanceof Array?i.push(n):e.push(a)}}else t.isSeparated(s.bbox())||e.push(r)}else break}return e}walker(t){this.flushWhenNeed(),this._walker(this.root,0,t)}_walker(t,e,i){this.flushWhenNeed();let s=t.items();if(s instanceof Array)for(let r of s)this._walker(r,e+1,i);else i(s,e)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};function ka(t,e){Pm(t.iterator(),e)}function Pm(t,e){let i=0;for(;t.hasNext();){let s=t.next();e(i++,s)}}var _n=new Error("list is empty"),Sn=class{constructor(t,e){this.prev=null,this.next=null,this.parent=t,this.item=e}insertAfter(t){t.next=this.next,this.next=t,t.prev=this,t.next!==null&&(t.next.prev=t)}insertBefore(t){t.prev=this.prev,this.prev=t,t.next=this,t.prev!==null&&(t.prev.next=t)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(t){this.item=t}},Lm=class{constructor(t){this._next=t}hasNext(){return this._next!==null}next(){let t=this._next;if(t!==null)return this._next=t.next,t.item;throw new Error("iterator is null")}},vm=class{constructor(t){this._next=t}hasNext(){return this._next!==null}next(){let t=this._next;if(t!==null)return this._next=t.next,t;throw new Error("iterator is null")}},Ts=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(t){return this.addLast(t)}push(t){return this.addLast(t)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let t=this.first;if(t===null)throw _n;return this.remove(t),t.item}removeLast(){let t=this.last;if(t===null)throw _n;return this.remove(t),t.item}addLast(t){return this.first===null||this.last===null?(this.first=new Sn(this,t),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,t)}addFirst(t){if(this.first===null||this.last===null){let e=new Sn(this,t);return this.first=e,this.last=e,this.cnt++,e}else return this.insertBefore(this.first,t)}getFirst(){if(this.first===null)throw _n;return this.first.item}getLast(){if(this.last===null)throw _n;return this.last.item}insertAfter(t,e){let i=new Sn(this,e);return t.insertAfter(i),t===this.last&&(this.last=i),this.cnt++,i}insertBefore(t,e){let i=new Sn(this,e);return t.insertBefore(i),t===this.first&&(this.first=i),this.cnt++,i}remove(t){t.remove(),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new Lm(this.first)}listIterator(){return new vm(this.first)}toArray(){let t=new Array(this.cnt),e=this.first,i=0;for(;e!=null;)t[i]=e.item,e=e.next,i++;return t}};function Fa(t){throw new Error("")}var In=class{constructor(t,e){this.node1=null,this.node2=null,this.key=t,this.value=e}},xm=class{constructor(t){this.itors=t}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},Mm=class{constructor(t){this.itors=t}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},ta=class{constructor(){this.innerList=new Ts,this.innerMap={}}replace(t,e){t.node1!==null&&(t.node1.set(e),e.node1=t.node1),t.node2!==null&&(t.node2.set(e),e.node2=t.node2)}clear(){this.innerList.clear();for(let t in this.innerMap)delete this.innerMap[t]}put(t,e){let i=t.hashCode(),s=new In(t,e),r=this.innerMap[i];if(r===void 0)return s.node1=this.innerList.add(s),this.innerMap[i]=s,null;if(r instanceof In){if(r.key.equals(t))return this.innerMap[i]=s,this.replace(r,s),r.value;{s.node1=this.innerList.add(s);let n=new Ts;return r.node2=n.add(r),s.node2=n.add(s),this.innerMap[i]=n,null}}if(r instanceof Ts){let n=null;return ka(r,(a,o)=>o.key.equals(t)?(this.replace(o,s),n=o.value,!1):!0),n===null?(s.node1=this.innerList.add(s),s.node2=r.push(s),null):n}return Fa(r)}get(t){let e=t.hashCode(),i=this.innerMap[e];if(i===void 0)return null;if(i instanceof In)return i.key.equals(t)?i.value:null;if(i instanceof Ts){let s=null;return ka(i,(r,n)=>n.key.equals(t)?(s=n.value,!1):!0),s}return Fa(i)}containsKey(t){return this.get(t)!==null}delete(t){t.node1!==null&&t.node1.parent.remove(t.node1),t.node2===null?delete this.innerMap[t.key.hashCode()]:t.node2.parent.remove(t.node2)}remove(t){let e=t.hashCode(),i=this.innerMap[e];if(i===void 0)return null;if(i instanceof In)return i.key.equals(t)?(this.delete(i),i.value):null;if(i instanceof Ts){let s=null;return ka(i,(r,n)=>n.key.equals(t)?(s=n.value,this.delete(n),!1):!0),s}return Fa(i)}computeIfAbsent(t,e){let i=this.get(t);if(i===null){let s=e(t);return this.put(t,s),s}else return i}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new xm(this.innerList.iterator())}values(){return new Mm(this.innerList.iterator())}entries(){return this.innerList.iterator()}},rr=class{constructor(){this.innerMap=new ta}add(t){return this.innerMap.put(t,!0)!==!0}remove(t){this.innerMap.remove(t)}contains(t){return this.innerMap.get(t)===!0}iterator(){return this.innerMap.keys()}addAll(t){let e=t.iterator();for(;e.hasNext();)this.add(e.next())}size(){return this.innerMap.size()}clear(){let t=this.iterator();for(;t.hasNext();){let e=t.next();this.remove(e)}}},Hl=Pe.funcCopy(Ds);function Bm(t,e){let i=0;if(Math.abs(t.start.y-e)<=1e-4)N[i++]=t.start.x;else if(Math.abs(t.end.y-e)<=1e-4)N[i++]=t.end.x;else if(t.shape instanceof G)i=im(t.shape,e);else if(t.shape instanceof K)i=sm(t.shape,e);else throw new Error("not supported operation");return i}var Fn=class{constructor(t,e,i,s){this.sides=new Array,this.loader=t,this.loader.bo=this,this.logger=i,this.rule=e,this.event=s}static sortByBBoxMinY(t,e){return t.bbox().minY-e.bbox().minY}static sortByBBoxAreaDesc(t,e){return e.bbox().area()-t.bbox().area()}addPolyline(t,e=1,i=.01,s=!0){for(let r of this.loader.buildGroup(t,e,i,s))this.sides.push(r),this.event.onOriginSide(r)}buildRTree(){let t=new Vr(10);for(let e of this.sides)t.add(e);return t}fillValidSides(t,e,i){for(let s of e)isFinite(s.getX(i))&&t.push(s)}getSortedEndpointsLineAsc(t){let e=new Array;for(let r of t)r.needCountWeight()&&(e.push(r.start),e.push(r.end));Hl(e,X.sortByYAsc,0,e.length);let i=new Array,s=Number.NEGATIVE_INFINITY;for(let r of e){let n=r.y;n>s&&(i.push(n),s=n)}return i}splitSides(t,e,i){let s=t.start,r=t.end,n=new X(r.x+(s.x-r.x)*2,r.y+(s.y-r.y)*2);Hl(t.inters,(o,l)=>o.distance2(n)-l.distance2(n),0,t.inters.length);let a=null;for(let o of t.inters)if(a==null)o.equals(s)&&(a=o);else if(!o.equals(a)){let l=ur.rebuild(t.shape,a,o);l instanceof K&&Math.abs(l.sweepAngle)>190&&(l=new G(a,o));let u=new ur(this,l,t.baseWeight,a,o,t.polyGrp,i++);if(e.push(u),u.updateBbox(),o.equals(r))break;a=o}return i}splitSidesByInters(){let t=new Array;for(let e of this.sides)if(e.polyIndex==0){let i=0,s=null,r=null;do{let n=new Array;i=this.splitSides(e,n,i);for(let a of n)s!=null?(s.next=a,a.previous=s):r=a,s=a,this.event.onSplitedSide(a),t.push(a);if(e.next===null)throw new Error("not supported operation");e=e.next}while(e.polyIndex!==0);r!=null&&s!=null&&(r.previous=s,s.next=r)}this.sides.length=0;for(let e of t)this.sides.push(e)}seekIntersection(){if(this.sides.length>0){let t=this.buildRTree(),e=new rr;for(let i of this.sides){e.add(i);let s=i.bbox().extendOfSize(1e-5),r=i.shape instanceof G;for(let n of t.search(s))if(!e.contains(n)){let a=n.shape instanceof G;if(!(r&&a&&i.next!==null&&i.previous!==null&&(i.next.equals(n)||i.previous.equals(n)))){let o=ti(i.shape,n.shape);for(let l=0;l<o;l+=2){let u=new X(N[l],N[l+1]);i.inters.push(u),n.inters.push(u),this.event.onIntersect(u,i,n)}}}}}}},km=class Hu{constructor(e){this.sides=new rr,this.others=new rr,this.id=e}add(e){this.sides.add(e),e.finalGrp=this.id;for(let i of e.connect)this.others.add(i)}polyline(){let e=new Array;return sr(this.sides,(i,s)=>(e.push(s.shape),!0)),St.build2(e).asClose()}hashCode(){return this.id}equals(e){return e!=null&&e instanceof Hu?this.id===e.id:!1}},Yu=class{constructor(t){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=t}completeGroup(t){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new G(this.prevSide.end,this.firstSide.start),t);let e=new Array,i=null,s=null;for(let r of this.sides)(!this.noWeight0||r.weight!==0)&&(i!=null?(i.next=r,r.previous=i):s=r,i=r,e.push(r));return i!=null&&s!=null&&(s.previous=i,i.next=s),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,e}buildGroup(t,e,i,s=!0){for(let r of t.primitives)if(r instanceof G)this.addSide(r,e);else if(s&&r instanceof K&&r.rx===r.ry)this.addArc(r,e);else{let n=null;for(let a of r.points(i))n!=null&&this.addSide(new G(n,a),e),n=a}return this.completeGroup(e)}addArc(t,e){let i=t.sweepAngle,s=mt.regularD(t.startAngle),r=s+i;if(i>0){let n=90;for(;n<=r;)n>s&&(this.addSide(K.build3(t.center,s,n-s,t.rx,t.ry),e),s=n),n+=90;s<r&&this.addSide(K.build3(t.center,s,r-s,t.rx,t.ry),e)}else if(i<0){let n=270;for(;n>=r;)n<s&&(this.addSide(K.build3(t.center,s,n-s,t.rx,t.ry),e),s=n),n-=90;s>r&&this.addSide(K.build3(t.center,s,r-s,t.rx,t.ry),e)}}addSide(t,e){if(t.start().equals(t.end()))return;let i=t.start(),s;this.prevSide!=null?(this.prevSide.end.equals(i)||this.addSide(new G(this.prevSide.end,i),e),s=new ur(this.bo,t,e,t.start(),t.end(),this.polyGrp,this.polyIndex++)):(s=new ur(this.bo,t,e,t.start(),t.end(),this.polyGrp,this.polyIndex++),this.firstSide=s),this.prevSide=s,this.sides.push(s)}},Vu=class{constructor(t,e,i){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=i,this.rule=t,this.bo=e,this.event=e.event}onEp(t){this.tuningWeight(t),this.start===null?this.rule(this.curWeight)?this.in(t):t.setInvalid(this.y):this.rule(this.curWeight)?t.setInvalid(this.y):this.out(t,this.start),this.last!==null&&this.event.onSweep1(this.last,t,this.y),this.last=t}in(t){this.prevEnd!=null&&this.onSameX(t,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=t,this.start.setOutside(this.y))}out(t,e){if(this.onSameX(e,t))e.revokeOutside(this.y);else{if(t.setInside(this.y)>0&&e.confidence(this.y)>0){let i=e.voteStatus(),s=t.voteStatus();this.isValid(i)&&this.isValid(s)?i==2&&s==1&&(t.connect.push(e),e.connect.push(t)):(t.connect.push(e),e.connect.push(t))}this.event.onSegment1(e,t,this.y),this.eps.push(e),this.eps.push(t),this.prevStart=e,this.prevEnd=t}this.start=null}isValid(t){return t==1||t==2}onSameX(t,e){return t.bbox().isIntersect(e.bbox())&&Z.eq(t.getX(this.y),e.getX(this.y))}tuningWeight(t){this.curWeight+=t.weight;let e=t.nextNot0(),i=t.prevNot0();e!=null&&t.weight===e.weight&&e.trans===this.y&&(this.curWeight-=t.weight),i!=null&&t.weight===i.weight&&i.trans===this.y&&(this.curWeight-=t.weight),t.trans=this.y}},ea=new Error,Yl=new class extends tn{decide1(t){return t[0]&&t[1]}}(2),Fm=new class extends Gu{onPolylineGroup(t,e){throw ea}onSegment(t,e,i,s,r,n){throw ea}},Um=class{constructor(t,e){this.rtree=t,this.level=e}},jm=class zu extends Fn{static isIntersect(e,i,s=ya.DUMMY){let r=new zu(s),n=r.createGroup1(e.items),a=r.createGroup2(i.items);return n.rtree.itemList.length==0||a.rtree.itemList.length==0?!1:r.isIntersect(n,a)}constructor(e){super(new Yu(!1),Yl.rule,e,Fm)}createGroup1(e){return this.createGroup(e,0)}createGroup2(e){return this.createGroup(e,1)}createGroup(e,i){let s=Yl.weight(i);for(let n of e)this.addPolyline(n,s);let r=this.buildRTree();return this.sides.length=0,new Um(r,i)}isIntersect(e,i){if(e.level!==i.level){let s=e.rtree.bbox().intersection1(i.rtree.bbox());if(s!==null){try{this.inters(e,i);let r=(s.minY+s.maxY)/2;this.sweep(e,i,r)}catch(r){if(r===ea)return!0;throw r}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(e,i){if(e.rtree.size()>i.rtree.size()){let s=e;e=i,i=s}for(let s of e.rtree.items()){s.trans=NaN;let r=s.bbox().extendOfSize(1e-5);for(let n of i.rtree.search(r))if(n.trans=NaN,ti(s.shape,n.shape)>0)throw ea}}sweep(e,i,s){let r=Ne.extend2(e.rtree.bbox(),i.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,e.rtree.search(r),s),this.fillValidSides(n,i.rtree.search(r),s),Ds(n,(o,l)=>o.getX(s)-l.getX(s),0,n.length);let a=new Vu(this.rule,this,s);for(let o of n)a.onEp(o)}},Bo=class Li{constructor(e){this.items=new Array(e.length),Pe.arraycopy(e,0,this.items,0,e.length),this.__bbox=this.calcBBox()}static build1(e){let i=[];return Wn(e,(s,r)=>(i.push(r),!0)),new Li(i)}static build2(e){let i=e.map(s=>St.build8(s));return new Li(i)}static combinePolylineGroupArr(e){let i=[];for(let s of e)i=i.concat(s.items);return new Li(i)}calcBBox(){let e=new Fe;for(let i=0;i<this.items.length;i++)e.ext1(this.items[i].bbox());return e.build1()}multiply3(e){let i=new Array(this.items.length);for(let s=0;s<i.length;s++)i[s]=this.items[s].multiply3(e);return new Li(i)}bbox(){return this.__bbox}asClose(){return this.items.forEach(e=>e.asClose()),this}mirrorY(e){return this.items.forEach(i=>i.mirrorY(e)),this}closeEndpoint(){return this.items.forEach(e=>e.closeEndpoint()),this}get primitives(){return this.items.map(e=>e.primitives).flat(2)}isEqual(e){return e instanceof Li?this.items.every(i=>e.items.some(s=>s.isEqual(i))):!1}getOutMostPolyline(){return this.items.reduce((e,i)=>i.bbox().area()>e.bbox().area()?i:e,this.items[0])}getOutline(){let e=this.items;if(e.length===1)return{outline:e,hole:new Array};let i=new Set,s=new Set;for(let r=0,n=e.length;r<n;r++){let a=e[r];if(!i.has(a)&&!s.has(a)){r+1>=n&&i.add(a);for(let o=r+1;o<n;o++){let l=e[o];if(!i.has(l)&&!s.has(l)){if(!a.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(a.bbox().extendOfSize(1e-4)))continue;jm.isIntersect(new Li([a]),new Li([l]))&&(a.bbox().area()>l.bbox().area()?(i.add(a),s.add(l)):(i.add(l),s.add(a)))}}!i.has(a)&&!s.has(a)&&i.add(a)}}return{outline:[...i],hole:[...s]}}round(e=4){let i=this.items.map(s=>s.round(e));return new Li(i)}},Gm=Pe.funcCopy(Ds),Hm=Pe.funcCopy(Ds),Ym=Pe.funcCopy(Ds);function Vm(t){return new Array}function zm(t,e){let i=new jr(!1),s=new Gr(t,ya.DUMMY,i);for(let r of e)s.addPolyline(r);return s.simplify(),i.plGrps}var Gr=class extends Fn{constructor(t,e,i){super(new Yu(!1),t,e,i),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(t,e,i){this.scanY=NaN,this.scanLines=0,Gm(e,Fn.sortByBBoxMinY,0,e.length);let s=new Ts;this.curNetIndex=0;let r=Number.POSITIVE_INFINITY;for(let n of t)n>r&&this.scan(s,(r+n)/2,e),r=n;this.getAllMarkPrimitive(i,e),this.logger.debug3("scan %s %d",i,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(t,e=1,i=.01,s=!0){super.addPolyline(t,e,i,s)}scan(t,e,i){if(this.scanY==e)return;this.scanY=e;let s=!1,r=t.listIterator();for(;r.hasNext();){let n=r.next(),a=n.item;Z.less(a.bbox().maxY,e)?t.remove(n):!s&&a.isNeedScan(e)&&(s=!0)}for(;this.curNetIndex<i.length;){let n=i[this.curNetIndex];if(Z.less(n.bbox().minY,e))Z.greatereq(n.bbox().maxY,e)&&(this.add2AET(t,n),!s&&n.isNeedScan(e)&&(s=!0)),this.curNetIndex++;else break}if(s){this.scanLines++;let n=new Vu(this.rule,this,e),a=t.iterator();for(;a.hasNext();){let o=a.next();n.onEp(o)}}}add2AET(t,e){let i=e.bbox().minX,s=e.bbox().maxX,r=e.bbox().minY,n=e.bbox().maxY,a=t.listIterator(),o=null;for(;a.hasNext();){let l,u=a.next(),c=u.item,h=c.bbox().minX,f=c.bbox().maxX;if(s<=h)l=-1;else if(f<=i)l=1;else{let p=c.bbox().minY,m=c.bbox().maxY,g=Math.max(r,p),b=Math.min(n,m);l=this.compareBySweep(e,c,(g+b)/2)}let d=c.shape;if(d instanceof G&&d.length()<.001&&o==null&&l<0){o=u;continue}if(o!=null&&l<0){t.insertBefore(o,e);return}if(l<0){t.insertBefore(u,e);return}else o=null}t.add(e)}getLineAngle(t){let e=t.start().angle(t.end());return e<0&&(e+=Math.PI),e}getArcAngle(t,e){let i=Math.asin((e-t.center.y)/t.rx);return t.startAngle>90&&t.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI}compareArcLine(t,e,i){let s=this.getArcAngle(t,i),r=this.getLineAngle(e);return Z.eq(s,r)?-t.sweepAngle:r-s}compareBySweep(t,e,i){let s=t.getX(i);if(!isFinite(s))return 0;let r=e.getX(i);if(!isFinite(r))return 0;if(!Z.eq(s,r))return s-r;if(t.shape instanceof G)return e.shape instanceof G?this.getLineAngle(e.shape)-this.getLineAngle(t.shape):-this.compareArcLine(e.shape,t.shape,i);if(e.shape instanceof G)return this.compareArcLine(t.shape,e.shape,i);{let n=t.shape,a=e.shape,o=this.getArcAngle(n,i),l=this.getArcAngle(a,i);return Z.eq(o,l)?n.sweepAngle*a.sweepAngle<=0?n.sweepAngle<=0?1:-1:n.sweepAngle>0?n.rx-a.rx:a.rx-n.rx:l-o}}getAllMarkPrimitive(t,e){for(let i of e)if(i.status===0&&i.bbox().height()!=0){let s=i.voteStatus();if(s===2||s===1){i.status=s;let r=i.reverse(s);if(t){this.event.onResultSide(r);let n=r.shape.multiply3(Mt.ROT_N90),a=r.start.multiply3(Mt.ROT_N90),o=r.end.multiply3(Mt.ROT_N90);r=new ur(this,n,r.baseWeight,a,o,r.polyGrp,r.polyIndex)}this.finalSides.push(r),this.event.onResultSide(r)}}}flipSides(){for(let t of this.sides)if(t.polyIndex==0){let e=null,i=null;do{let s=t.shape.multiply3(Mt.ROT_90),r=t.start.multiply3(Mt.ROT_90),n=t.end.multiply3(Mt.ROT_90),a=new ur(this,s,t.baseWeight,r,n,t.polyGrp,t.polyIndex);if(a.outsideWeight=t.outsideWeight,a.insideWeight=t.insideWeight,a.invalidWeight=t.invalidWeight,a.status=t.status,e!=null?(e.next=a,a.previous=e):i=a,this.vecSides.push(a),this.event.onSplitedSide(a),e=a,t.next!==null)t=t.next;else break}while(t.polyIndex!=0);i!=null&&(i.previous=e,e.next=i)}}canBeEnd(t,e){if(t.size()==1){let i=t.getFirst().shape;if(i instanceof K){if(e&&i.rx<=e)return!1}else if(i instanceof G&&e&&i.length()<=e)return!1}return!0}connectSides(){let t=new ta,e=new Vr(10);for(let n of this.finalSides)t.computeIfAbsent(n.start,Vm).push(n),e.add(n.start);let i=0,s=new rr,r=new Array;for(let n of this.finalSides)if(!s.contains(n)){let a=new rr,o=n.start,l=new Ts;l.add(n),s.add(n);let u=n.end;for(;l.size()>0;)if(this.isStart(o,u)&&this.canBeEnd(l,.01)){l.size()>1&&this.fillSideGroups(l,i++);break}else{let c=t.get(u),h=this.findNext(s,c);if(h==null&&(u=this.findNeigber(u,a,e,.01),u!==null&&(c=t.get(u),h=this.findNext(s,c))),h!=null)l.add(h),s.add(h),u=h.end;else if(u!=null?a.add(u):(r.length==0&&l.size()>1&&this.logger.warning3("unable to connect at %s",l.getLast()),r.push(l.removeLast())),l.size()>0)u=l.getLast().end;else break}}}fillSideGroups(t,e){let i=new km(e);sr(t,(s,r)=>(i.add(r),!0)),this.sideGroups[i.id]=i}isStart(t,e){return t.distance2(e)<=1e-4}findNext(t,e){if(e!=null){for(let i of e)if(!t.contains(i))return i}return null}fillResult(){let t=0,e=new ta;for(let s in this.sideGroups){let r=this.sideGroups[s];sr(r.sides,(n,a)=>(a.polyGrp!=-2&&e.put(a,a),!0))}let i=new rr;for(let s in this.sideGroups){let r=this.sideGroups[s];if(i.add(r)){let n=0,a=new Array;for(a.push(r);n<a.length;){let l=a[n],u=new Array;sr(l.others,(h,f)=>{let d=e.get(f);return d!=null&&u.push(d.finalGrp),!0}),Hm(u,Pe.sortAsc,0,u.length);let c=l.id;for(let h of u)if(h!=c&&h!=l.id){let f=this.sideGroups[h];i.add(f)&&a.push(f),c=h}n++}let o=new Array;for(let l of a)o.push(l.polyline());Ym(o,Fn.sortByBBoxAreaDesc,0,o.length),this.event.onPolylineGroup(new Bo(o),t++)}}}findNeigber(t,e,i,s){let r=s*s,n=Number.MAX_VALUE,a=null;for(let o of i.search(t.bbox().extendOfSize(s)))if(!e.contains(o)){let l=t.distance2(o);l<n&&(n=l,a=o)}return n<r?a:null}},Xm=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(t,e=!0){if(t instanceof G)this.lines.push(t);else if(t instanceof K)this.arcs.push(t);else if(t instanceof rt)this.beziers.push(t);else throw new Error("not support");e&&this.points.push(t.start())}addPoint(t){this.points.push(t)}addText(t,e,i=1,s=.1,r=!0){this.listText.push({pos:t,str:e,size:i,width:s}),r&&this.points.push(t)}addPly(t,e=!0){t.primitives.forEach(i=>this.addPt(i,e))}build(){let t=[],e=[],i=[],s=[],r=[],n=[];return this.points.forEach(a=>t.push(a.x,a.y)),this.lines.forEach(a=>e.push(a.start().x,a.start().y,a.end().x,a.end().y)),this.arcs.forEach(a=>i.push(a.center.x,a.center.y,a.rx,mt.toRadians(a.startAngle),mt.toRadians(a.endAngle()),a.sweep())),this.beziers.forEach(a=>{a.controls.forEach(o=>{s.push(o.x,o.y)}),s.push("end")}),this.listText.forEach(a=>r.push(a.pos.x,a.pos.y,a.str,a.width,a.size)),this.fonts.forEach(a=>n.push(a)),{points:t,lines:e,arcs:i,texts:r,beziers:s,fonts:n}}},es,en=(es=class{constructor(e){this.map=new ta,this.bus=e}initColor(e){return this.map.computeIfAbsent(e,()=>new Xm)}draw(){let e={},i=this.map.entries();for(;i.hasNext();){let s=i.next();e[s.key.toString()]=s.value.build()}this.bus.publish("/debug/draw",e)}clear(){this.map.clear()}static init(e){if(!e)throw new Error("bus is undefined!");this.palette=new es(e)}static initPalette(e){this.palette=e}static getDefaultColor(){for(let e of this.colorBuffersMap)if(e[0]!==null&&e[0])return e[0]=!1,e[1];return this.colorBuffersMap.forEach(e=>{if(e[0]===null){console.log(1);return}e[0]=!0}),this.getDefaultColor()}static clear(){this.palette.clear()}static auto(e,i=this.getDefaultColor()){if(Array.isArray(e))e.forEach(s=>{this.auto(s,i)});else if(e instanceof X)this.point(e,i);else if(e instanceof Ne)this.bbox(e,i);else if(e instanceof Qr)this.primitive(e,i);else if(e instanceof St)this.polyline(e,i);else if(e instanceof le)this.polygon(e,i);else if(e instanceof te)this.group(e,i);else if(e instanceof Bo)this.auto(e.items,i);else{debugger;throw new Error("No incoming type!")}}static text(e,i,s=.5,r=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");this.palette.initColor(r).addText(e,i,s,s/10),this.palette.draw()}static point(e,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let s=this.palette.initColor(i);Array.isArray(e)?e.forEach(r=>{this.point(r,i)}):s.addPoint(e),this.palette.draw()}static bbox(e,i=this.getDefaultColor()){Array.isArray(e)?e.forEach(s=>{this.bbox(s,i)}):(this.primitive(new G(new X(e.maxX,e.maxY),new X(e.maxX,e.minY)),i),this.primitive(new G(new X(e.maxX,e.maxY),new X(e.minX,e.maxY)),i),this.primitive(new G(new X(e.minX,e.minY),new X(e.maxX,e.minY)),i),this.primitive(new G(new X(e.minX,e.minY),new X(e.minX,e.maxY)),i))}static primitive(e,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let s=this.palette.initColor(i);Array.isArray(e)?e.forEach(r=>{this.primitive(r,i)}):s.addPt(e),this.palette.draw()}static polyline(e,i=this.getDefaultColor()){Array.isArray(e)?e.forEach(s=>{this.polyline(s,i)}):e.primitives.forEach(s=>{this.primitive(s,i)})}static polygon(e,i=this.getDefaultColor()){Array.isArray(e)?e.forEach(s=>{this.polygon(s,i)}):e.items.forEach(s=>{this.polyline(s,i)})}static group(e,i=this.getDefaultColor()){Array.isArray(e)?e.forEach(s=>{this.group(s,i)}):e.items.forEach(s=>{this.polygon(s,i)})}static async begin(){this.t1=performance.now()}static async end(e){console.log(e||"t1:",performance.now()-this.t1)}static async log(e){console.log(e||"==================")}},es.colorBuffersMap=[[!0,Lt.BLUE],[!0,Lt.GREEN],[!0,Lt.WHITE],[!0,Lt.RED],[!0,Lt.Golden],[!0,Lt.Gray]],es.t1=0,es),qm=0,sn=class ao{constructor(e,i){this.inters=[],this.shape=e,this.start=e.start(),this.end=e.end(),this.judgeOverlapMap=new Map,i&&(this.id=qm++)}reverse(){this.shape=this.shape.reverse();let e=this.start;this.start=this.end,this.end=e}getCenterPoint(e=this.end){let{x:i,y:s}=this.start,{x:r,y:n}=e;if(this.shape instanceof K){let a=this.shape.rx,o=new X((i+r)/2,(s+n)/2),l=this.shape.center,u;return o.x!==l.x||o.y!==l.y?(u=o.angle(l),Math.abs(this.shape.sweepAngle)>180&&(u+=u>=0?-180:180)):u=(this.shape.startAngle+this.shape.endAngle())/2,new X(l.x+Math.cos(u)*a,l.y+Math.sin(u)*a)}else{if(this.shape instanceof G)return new X((i+r)/2,(s+n)/2);if(this.shape instanceof rt){let a=this.shape.getPercent(e,ht);return rt.pointOn(a/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(e,i,s){let r=e.cross(i)>0,n=Math.acos(Math.min(1,Math.max(-1,e.dot(i)/i.length())));return(s?!r:r)&&(n=Ta-n),n}sortInters(){if(this.shape instanceof K){let e=this.shape.center,i=this.shape.start().sub(e).normalize(),s=this.shape.isCCW;this.inters.sort((r,n)=>{let a=r.coord.sub(e),o=n.coord.sub(e);return ao.finalAngle(i,a,s)-ao.finalAngle(i,o,s)<=0?-1:1})}else if(this.shape instanceof G){let e=this.start,i=this.end,s=new X(i.x+(e.x-i.x)*2,i.y+(e.y-i.y)*2);this.inters.sort((r,n)=>r.coord.distance2(s)-n.coord.distance2(s)<=0?-1:1)}else if(this.shape instanceof rt){let e=this.shape;this.inters.sort((i,s)=>e.getPercent(i.coord,ht)-e.getPercent(s.coord,ht)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((e,i)=>e.setIndex(i))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(e){this.nextSide=e,e.prevSide=this}static returnPolygonList(e){let i=[];return e.forEach(s=>{let r=[];s.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),r.push(St.build7(o))}),i.push(new le(r))}),i}addInter(e){this.inters.push(e)}static returnPolygonGroup(e){let i=[];return e.forEach(s=>{let r=[];s.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),r.push(St.build7(o))}),i.push(new le(r))}),new te(i)}static rebuild(e,i,s){let r;if(e instanceof G||i.distance2(s)<1e-6)r=new G(i,s);else if(e instanceof K)r=K.build2(e.center,i.angleD(e.center),s.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);else if(e instanceof rt){let n=e.getPercent(i,ht),a=e.clip(n)[1];r=a.clip(a.getPercent(s,ht))[0]}else throw new Error("not supported operation");return ct(e,i).dot(ct(r,i))<0?null:r}static returnPolyline(e){return St.build7(e.map(i=>i.shape))}bbox(){return this.shape.bbox()}},Wm=(t=>(t[t.END1=0]="END1",t[t.END2=1]="END2",t[t.END12=2]="END12",t[t.LEFT1=3]="LEFT1",t[t.LEFT2=4]="LEFT2",t))(Wm||{});function Le(t,e,i){if(t instanceof K&&e instanceof K)return $m(t,e);if(t instanceof K&&e instanceof G)return Xl(t,e);if(t instanceof G&&e instanceof K)return zl(t,e);if(t instanceof G&&e instanceof G)return Ss(t,e);if(t instanceof rt&&e instanceof G)return t.controls.length===2||Bi(t)?Ss(new G(t.start(),t.end()),e):Xu(t,e);if(t instanceof G&&e instanceof rt)return e.controls.length===2||Bi(e)?Ss(t,new G(e.start(),e.end())):oo(t,e);if(t instanceof K&&e instanceof rt)return e.controls.length===2||Bi(e)?Xl(t,new G(e.start(),e.end())):Jm(t,e);if(t instanceof rt&&e instanceof K)return t.controls.length===2||Bi(t)?zl(new G(t.start(),t.end()),e):Km(t,e);if(t instanceof rt&&e instanceof rt)return ko(t,e);throw new Error("not support")}function Gs(t,e){return ct(t,e.start()).dot(ct(e,e.start()))<=0?!1:Le(t,e).state<=2}function Ua(t,e){let i=e.getPercent(t.end(),ht);if(i===null)return!1;if(i===0)return!0;let s=e.clip(i)[0],r=t.buildConverxHull(ht),n=s.buildConverxHull(ht),a=u(r),o=u(n);return l(a,o);function l(c,h){let f=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),d=c[0],p=h[0];if(!d||!p)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let m=!0;do{let g=d.getShape(),b=p.getShape();if(g instanceof G&&b instanceof G){let y=m?Ss(g,b).state:f.get(Ss(b,g).state);if(y===0)d=d.nextSide,m=!1;else if(y===1)p=p.nextSide,m=!0;else if(y===2)d=d.nextSide,p=p.nextSide,m=!0;else return!1}else throw Error("not support")}while(d!==c[0].prevSide&&p!==h[0].prevSide);return!0}function u(c){let h=c.primitives.map(d=>new sn(d)),f=h[h.length-1];return h.forEach(d=>{f.connect(d),f=d}),h}}function Vl(t,e){let i=t.end().distance2(e.center);if(i>(e.rx+ht)**2||i<(e.rx-ht)**2||!(ut(t.end(),e.end())||Fo(e,t.end())))return!1;if(t.center.equals1(e.center))return!0;let s=t.center.distance1(e.center),r=Math.abs(t.rx-e.rx);if(s>Math.min(t.rx,e.rx)){let n=t.center.angleD(e.center);return t.rx>e.rx?!(s+r>ht&&yi(t,n))&&!(s-r>ht&&t.rx+e.rx-s>ht&&yi(t,n+180)):!(s-r>ht&&yi(t,n))&&!(t.rx+e.rx-s>ht&&yi(t,n+180))}else{if(s+r<=ht)return!0;let n=t.rx>e.rx?t.center.angleD(e.center):e.center.angleD(t.center);return yi(t,n)?!1:s-r<=ht?!0:!yi(t,n+180)}}function Jm(t,e){let i=Uo(t,e.start()).toBezier2(),s,r=0;for(let n=i.length;r<n;r++){let a=i[r];if(s=ko(a,e).state,s!==0)break}return s===2&&r!==i.length-1?{state:1}:{state:s}}function Km(t,e){let i=e.toBezier2(),s,r=0;for(let n=i.length;r<n;r++){let a=i[r];if(s=ko(t,a).state,s!==1)break}return s===2&&r!==i.length-1?{state:0}:{state:s}}function ko(t,e){if(t.controls.length===2||Bi(t))return e.controls.length===2||Bi(e)?Ss(new G(t.start(),e.end()),new G(e.start(),e.end())):oo(new G(e.start(),t.end()),e);if(e.controls.length===2||Bi(e))return Xu(lo(t,e.start()),new G(e.start(),e.end()));let i=lo(t,e.start());if(Bi(i))return oo(new G(e.start(),t.end()),e);let s=Ua(i,e),r=Ua(e,i);if(!s&&!r){let n=dm(i,e);if(n.havOverlap){let a=n.havOverlap!==2,o=n.havOverlap!==1;return Gi(t,e,a,o)}else{let a=function(){for(let h=0;h<u;h+=2)N[h]=c[h],N[h+1]=c[h+1]},o,l,u=n.cnt,c=new Array(u).fill(0).map((h,f)=>N[f]);for(let h=0;h<u;h+=2){let f=new X(N[h],N[h+1]),d=i.getPercent(f,ht),p=e.getPercent(f,ht);if(d===0||p===0)continue;let m=d===1?i:i.clip(d)[0],g=p===1?e:e.clip(p)[0];if(Ua(m,g)){let b=ct(t,f).cross(ct(e,f));if(b===0){o=i.end(),l=e.end();break}return{state:b<0?3:4}}a()}return(!o||!l)&&(o=Qs(i.controls,i.controls[0],e),l=Qs(e.controls,i.controls[0],i)),{state:o.sub(i.controls[0]).cross(l.sub(i.controls[0]))>0?4:3}}}return Gi(t,e,s,r)}function Xu(t,e){let i=lo(t,e.start());if(Bi(i))return Ss(new G(i.start(),i.end()),e);let s=Wu(i,e),{isIn:r,bezierIsInLeft:n}=qu(e,i);if(!s&&!r){if(n!==void 0)return{state:n?3:4};let a=null,o=t.getPercent(e.start(),ht)+.01;for(let l=o>1?1:o;l<=1;){let u=rt.pointOn(l,t.controls);if(zr(e,u)>ve){a=u;break}l+=.01,l>1&&(l=1)}if(!a)throw Error("!end1 && !end2 not result");return{state:e.direct.cross(a.sub(e.start()))<0?4:3}}return Gi(i,e,s,r)}function oo(t,e){let{isIn:i,bezierIsInLeft:s}=qu(t,e),r=Wu(e,t);if(!i&&!r){if(s!==void 0)return{state:s?4:3};let n=null;for(let a=.01;a<=1;){let o=rt.pointOn(a,e.controls);if(zr(t,o)>ve){n=o;break}a+=.01,a>1&&(a=1)}if(!n)throw Error("!end1 && !end2 not result");return{state:t.direct.cross(n.sub(t.start()))<0?3:4}}return Gi(e,t,i,r)}function $m(t,e){let i=Vl(Uo(t,e.start()),e),s=Vl(e,t);if(!i&&!s){let r=hi(e);if(t.center.sub(e.start()).dot(e.center.sub(e.start()))>0){if(t.rx===e.rx)return t.isCCW?{state:r.dot(t.center.sub(e.center))<0?3:4,exitIsInvalid:!1}:{state:r.dot(t.center.sub(e.center))>0?3:4,exitIsInvalid:!1};let n,a;return t.rx>e.rx?(n=t,a=e):(n=e,a=t),r.dot(a.center.sub(n.center))>0&&a.rx+a.center.distance1(n.center)-n.rx>ht?t.isCCW?{state:t.rx>e.rx?3:4,exitIsInvalid:!1}:{state:t.rx<e.rx?3:4,exitIsInvalid:!1}:t.isCCW?{state:t.rx<e.rx?3:4,exitIsInvalid:!0}:{state:t.rx>e.rx?3:4,exitIsInvalid:!0}}else return t.rx+e.rx-t.center.distance1(e.center)>ht&&r.dot(t.center.sub(e.center))>0?{state:e.isCCW?3:4,exitIsInvalid:!1}:{state:t.isCCW?3:4,exitIsInvalid:!0}}return Gi(t,e,i,s)}function zl(t,e){let i=ci.foot(t,e.center),s=t.end().distance2(e.center),r=t.end().sub(t.start()),n=(e.rx-ht)**2,a=s<=(e.rx+ht)**2&&s>=n&&(r.dot(i.sub(e.start()))<=0||t.start().distance2(t.end())<=t.start().distance2(i)||i.distance2(e.center)>=n)&&(ut(t.end(),e.end())||Fo(e,t.end())),o=Ju(e,t);if(!a&&!o){let l=t.distance2(e.center);return l<=ve?{state:r.cross(hi(e))>0?4:3}:r.dot(i.sub(e.start()))>=0&&(s<n||t.start().distance2(e.center)<n||l<n)?{state:r.cross(e.center.sub(t.start()))<0?4:3}:{state:r.cross(e.center.sub(t.start()))>0?4:3}}return Gi(e,t,a,o)}function yi(t,e){return e=mt.regularD(e),t.sweepAngle>0?(e<t.startAngle&&(e+=360),t.endAngle()>e):(e>t.startAngle&&(e-=360),t.endAngle()<e)}function Fo(t,e){return ut(t.end(),e)||ut(t.start(),e)||yi(t,e.angleD(t.center))}function qu(t,e){let i=t.panDistance(ht),s=t.panDistance(-ht),r=ql(e,i),n=ql(e,s);if(!r.length&&!n.length)return{isIn:e.getPercent(t.end(),ht)!==null};let a=[...r,...n].sort((c,h)=>c.t-h.t),o=new G(s.start(),i.start()),l=[];for(let c=0,h=a.length;c<h;c++){let f=a[c];if(l.push(f),o.distance(f.interP)>t.length()+ht)break;if(l.length===2){let d=(l[1].t*10+l.shift().t*10)/20,p=rt.pointOn(d,e.controls);if(t.distance2(p)>ve)return{isIn:!1,bezierIsInLeft:t.direct.cross(p.sub(t.start()))>0}}}let u=l.length?o.distance(l[0].interP)>=t.length()+ht:!0;return{isIn:u,bezierIsInLeft:u?void 0:t.direct.cross(l[0].interP.sub(t.start()))>0}}function Wu(t,e){if(zr(e,t.end())>ve||t.getToLineMaxDis2(e)>ve)return!1;let i=Qm(e,ve);return t.getToLineMaxDis2(i)<=(e.length()+ht)**2}function Ju(t,e){let i=e.end().angleD(e.start()),s=Zm(e,t.end());if(s>ve)return!1;if(yi(t,i+90)){if(ci.foot(e,t.center).distance1(t.pointOn(i+90))>t.rx)return!1;s=Math.max(s,(t.rx-e.distance(t.center))**2)}if(yi(t,i-90)){if(ci.foot(e,t.center).distance1(t.pointOn(i-90))>t.rx)return!1;s=Math.max(s,(t.rx-e.distance(t.center))**2)}return s<=ve&&(ut(t.end(),e.end())||uo(e,t.end()))}var Ku=(ht*2)**2;function Uo(t,e){if(ut(t.end(),e))return K.build3(t.center,t.endAngle(),0,t.rx,t.ry);if(t.start().distance2(e)<Ku)return t;let i=mt.regularD(e.angleD(t.center));if(!yi(t,i))throw new Error("!angleIsInArc(arc, angle)");return K.build2(t.center,i,t.endAngle(),t.rx,t.ry,t.isCCW?1:0)}function lo(t,e){if(ut(t.end(),e))return new rt([e,e]);if(t.start().distance2(e)<Ku)return t;let i=t.getPercent(e,ht);if(i===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return t.clip(i)[1]}function Xl(t,e){let i=Ju(Uo(t,e.start()),e),s=e.end().distance2(t.center),r=e.end().sub(e.start()),n=ci.foot(e,t.center),a=(t.rx-ht)**2,o=s<=(t.rx+ht)**2&&s>=a&&(r.dot(n.sub(e.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(n)||n.distance2(t.center)>=a)&&(ut(t.end(),e.end())||Fo(t,e.end()));if(!i&&!o){let l=e.distance2(t.center);return l<=ve?{state:r.cross(hi(t,e.start().angle(t.center)))>0?3:4}:r.dot(n.sub(e.start()))>=0&&(s<a||e.start().distance2(t.center)<a||l<a)?{state:r.cross(t.center.sub(e.start()))>0?4:3}:{state:r.cross(t.center.sub(e.start()))<0?4:3}}return Gi(e,t,i,o)}function Ss(t,e){if(ut(t.end(),e.end()))return Gi(t,e,!0,!0);let i=zr(e,t.end())<=ve&&uo(e,t.end()),s=zr(t,e.end())<=ve&&uo(t,e.end());if(!i&&!s){let r=t.direct.x===0&&t.direct.y===0,n=e.direct.x===0&&e.direct.y===0;if(r&&n)throw Error("2LineAllIsPoint");return r?{state:e.direct.cross(t.end().sub(e.start()))>0?3:4}:{state:t.end().sub(t.start()).cross(e.end().sub(t.start()))>0?4:3}}return Gi(t,e,i,s)}function uo(t,e){return ci.foot(t,e).distance2(t.start())<t.end().distance2(t.start())}function Gi(t,e,i,s){if(i)return s?ut(t.end(),e.end())?{state:2}:{state:0}:{state:0};if(s)return{state:1};throw new Error("!end1 && !end2")}function zr(t,e){return(t.a*e.x+t.b*e.y+t.c)**2/(t.a**2+t.b**2)}function Zm(t,e){return Math.min(t.distance2(e),ci.foot(t,e).distance2(e))}function Qm(t,e){let i=t.panDistance(e),s=t.panDistance(-e);return new G(s.start(),i.start())}function Bi(t){let e=t.start(),i=t.end();e.equals1(i)&&(i=e.add1(1,0));let s=i.y-e.y,r=e.x-i.x,n=-s*e.x-r*e.y,a=Math.sqrt(1/(s**2+r**2));s*=a,r*=a,n*=a;let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return t.controls.forEach(u=>{let c=s*u.x+r*u.y+n;c<o&&(o=c),c>l&&(l=c)}),Oi(o,l)}function ql(t,e){let i=ti(t,e),s=[],r=new Array(i).fill(0).map((a,o)=>N[o]);for(let a=0;a<i;a+=2){let o=new X(N[a],N[a+1]),l=t.getPercent(o);s.push({interP:o,t:l}),n()}function n(){for(let a=0;a<i;a+=2)N[a]=r[a],N[a+1]=r[a+1]}return s}var gi=.01,tg=270;function rs(t){let e=gi**2,i=t.end(),s=[],r=[];for(let d=0,p=t.primitives.length;d<p;d++){let m=function(M,B){return M instanceof G&&B instanceof G&&Math.abs(M.direct.cross(B.direct))<Z.eps&&M.direct.dot(B.direct)>0||M instanceof K&&B instanceof K&&Math.abs(M.rx-B.rx)<=Z.eps&&M.center.distance2(B.center)<Z.eps&&M.isCCW===B.isCCW},g=function(M){if(We(M,gi))r.push(null);else{if(M instanceof G)r.push(M);else if(M instanceof K&&M.rx===M.ry)h(M,r);else if(M instanceof rt){let B=[];Fu(M,B),B.forEach(q=>{let H=q.start(),V=q.end();c(H,V)||r.push(q)})}else throw new Error("not support!");i=_}},b=function(M){if(M instanceof G)return M.direct.x===0&&M.direct.y===0;if(M instanceof K)return M.sweepAngle===0;if(M instanceof rt){let B=new Set(M.controls.map(H=>H.x)),q=new Set(M.controls.map(H=>H.y));return B.size===1&&q.size===1}else throw new Error("not support")},y=t.primitives[d],E=y.start(),_=y.end();if(b(y))continue;c(i,E)||(r.push(new G(i,E)),i=E);let S=(d+1)%p,A=t.primitives[S];for(;m(y,A)&&(S=(S+1)%p,A=t.primitives[S],A!==y););if(S===(d+1)%p){g(y);continue}if(A===y){if(!(y instanceof K)){if(Math.abs(t.area(.1))<e)return null;throw new Error("simplifyPolyline not support")}let M=y instanceof K?y.isCCW:t.area(.1)>0;r.length=0;let B=M?180:-180;r.push(K.build3(y.center,y.startAngle,B,y.rx,y.ry),K.build3(y.center,y.startAngle+B,B,y.rx,y.ry));break}let w=(()=>{if(y instanceof G)return(M,B)=>{let q=new G(M,B);return We(q,gi)?null:[q]};if(y instanceof K)return(M,B)=>{let q;if(M.equals1(B)?q=K.build3(y.center,y.startAngle,y.sweep()===1?360:-360,y.rx,y.ry):q=K.build4(M,B,y.center,y.rx,y.ry,y.sweep()),We(q,gi))return null;let H=q.pointOn(q.startAngle+q.sweepAngle/2),V=K.build4(q.start(),H,y.center,y.rx,y.ry,y.sweep()),W=K.build4(H,q.end(),y.center,y.rx,y.ry,y.sweep());return We(V,gi)||We(W,gi)?[q]:[V,W]};throw new Error("not support")})(),R=S===0;if(S<d&&!R&&(R=!w(t.primitives[0].start(),t.primitives[S-1].end()),!R)){let M=w(y.start(),t.primitives[p-1].end());if(M)r.push(...M);else{let B=w(y.start(),r[0].end());if(B.length===1)r[0]=B[0];else if(B.length===2)r[0]=B[1],r.push(B[0]);else throw new Error("!!!generatorPt")}break}d=S===0?p-1:S-1,A=t.primitives[d];let L=w(y.start(),A.end());if(L?(L.forEach(M=>r.push(M)),i=A.end()):g(null),R)break}let n=r.length;if(r.forEach((d,p)=>{if(d)s.push(d);else{let m,g;p===n-1&&(m=s[0],g=s[s.length-1]);let b=(p+1)%n;if(m=m!=null?m:r[b],m){let y=p,E=!1;for(;g=g!=null?g:r[(--y+n)%n],g!==m;)if(g){E=!0;break}if(E){if(m.start().equals1(g.end()))return;if(ct(g,g.end()).dot(ct(m,m.start()))<0){if(!c(g.end(),m.start())){let w=new G(g.end(),m.start());s.push(w);return}let{rebuildPrevPt:_,rebuildNextPt:S,rebuildLinkLine:A}=Wl(r[(y-1+n)%n],g,new G(g.end(),m.start()),m,r[(p+2)%n]);_&&S&&(_!==g?(r[(y+n)%n]=_,s[s.length-1]&&(s[s.length-1]=_)):S!==m&&(r[(p+1)%n]=S,s[0]===m&&(s[0]=S)),A&&s.push(A))}}}}}),s.length===0)return null;c(i,s[0].start())||s.push(new G(i,s[0].start()));let a=s[s.length-1];if(s.length===1)return a instanceof K?St.build7([K.build2(a.center,0,180,a.rx,a.ry,a.sweep()),K.build2(a.center,180,360,a.rx,a.ry,a.sweep())]):a instanceof rt?St.build7(a.clip(.5)):null;let o=s.map(d=>new eg(d)),l=o[o.length-1];for(o.forEach(d=>{d.connect(l),l=d});!l.isVisited;){let d=function(){l.next.connect(m),l=l.next,l.isConnected=!1,l.isVisited=!1},p=function(){l.connect(m.prev),l.isConnected=!1},m=l.prev;if(l===m)break;let g=l.pt,b=m.pt,y=b.end();if(!l.isConnected&&!y.equals(g.start())){let E=function(S){l.isConnected=!0,l.pt=g=S,l.next.isVisited=!1},_=function(S){l.isConnected=!0,m.pt=S,m.isVisited=!1,l=m};if(g instanceof G)if(c(y,g.end())){d();continue}else E(new G(y,g.end()));else if(b instanceof G){c(b.start(),g.start())?p():_(new G(b.start(),g.start()));continue}else if(g instanceof rt)if(c(y,g.end())&&!(g.controls.length!==2&&g.getToLineMaxDis2(g.startToEndL)>=e)){d();continue}else E(new rt([y,...g.controls.slice(1)]));else if(b instanceof rt)c(b.start(),g.start())&&!(b.controls.length!==2&&b.getToLineMaxDis2(b.startToEndL)>=e)?p():_(new rt([...b.controls.slice(0,-1),g.start()]));else if(g instanceof K&&b instanceof K)if(Math.abs(Math.abs(g.sweepAngle)-180)<Math.abs(Math.abs(b.sweepAngle)-180)){let S=K.build5(y,g.end(),g.sweepAngle);if(c(S.start(),S.end())&&!(S.rx>=gi&&Math.abs(S.sweepAngle)>180)){d();continue}else E(S)}else{let S=K.build5(b.start(),g.start(),b.sweepAngle);c(S.start(),S.end())&&!(S.rx>=gi&&Math.abs(S.sweepAngle)>180)?p():_(S);continue}else throw new Error("not support")}if(ct(g,g.start()).dot(ct(b,b.end()))<0){let E=function(A,w,R,L,M,B){if(l.next===m){l=null;return}let{rebuildLinkLine:q,rebuildPrevPt:H,rebuildNextPt:V}=Wl(A,w,R,L,M);H&&V&&(H!==w&&(m.prev.pt=H),V!==L&&(l.next.pt=V),q?B.pt=q:d())},_=function(){l.next===m?l=null:(l.next.connect(m.prev),l=l.next,l.isConnected=!1,l.isVisited=!1)},S=Le(b.reverse(),g).state;if(S===0){let A=Jl(g,b.start(),g.end());if(f(A)){let w=m.prev.pt,R=l.next.pt;if(ct(R,R.start()).dot(ct(w,w.end()))>=0){if(_(),!l)break;continue}if(E(m.prev.prev.pt,w,A instanceof G?A:new G(A.start(),A.end()),R,l.next.next.pt,l),!l)break}else l.pt=A;p();continue}else if(S===1){let A=Jl(b,b.start(),g.end());if(f(A)){let w=m.prev.pt,R=l.next.pt;if(ct(R,R.start()).dot(ct(w,w.end()))>=0){if(_(),!l)break;continue}if(E(m.prev.prev.pt,w,A instanceof G?A:new G(A.start(),A.end()),R,l.next.next.pt,m),!l)break}else m.pt=A;d();continue}else if(S===2){if(_(),!l)break;continue}}l.isVisited=!0,l=l.next}if(!l)return null;s.length=0;let u=l;for(s.push(l.pt),l=l.next;l!==u;)s.push(l.pt),l=l.next;if(s.length===1){let d=s[0];return d instanceof K?(c(d.start(),d.end())?s[0]=K.buildCircle(d.center,d.rx,d.sweep()):s.push(new G(d.end(),d.start())),St.build7(s)):d instanceof rt?(c(d.start(),d.end())||s.push(new G(d.end(),d.start())),St.build7(s)):null}if(t=St.build7(s),Math.abs(t.area(.1))<e)return null;return t;function c(d,p){return d.distance2(p)<e}function h(d,p){if(Math.abs(d.sweepAngle)>tg){let m=d.sweepAngle/2;h(K.build3(d.center,d.startAngle,m,d.rx,d.ry),p),h(K.build3(d.center,d.startAngle+m,m,d.rx,d.ry),p)}else p.push(d)}function f(d){return d.start().distance2(d.end())<e&&!(d instanceof K&&d.rx>=gi&&Math.abs(d.sweepAngle)>180||d instanceof rt&&d.controls.length!==2&&d.getToLineMaxDis2(new G(d.start().add1(1,0),d.end()))>=e)}}function We(t,e){if(!t)return!0;let i=t.start(),s=t.end();if(i.distance2(s)<e**2)if(t instanceof K){if(!(t.rx>=e&&Math.abs(t.sweepAngle)>180))return!0}else if(t instanceof rt){if(!(t.controls.length!==2&&t.getToLineMaxDis2(new G(t.start().add1(1,0),t.end()))>=e))return!0}else return!0;return!1}function Hs(t){if(t.direct.x===0&&t.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let e=Math.abs(gi-t.length())+Z.eps,i={x:t.direct.normalize().x*e,y:t.direct.normalize().y*e},s=t.end();return new X(s.x+i.x,s.y+i.y)}function Wl(t,e,i,s,r){if(!t)a();else if(!r)o();else{let l=ct(t,t.end()),u=ct(e,t.end()),c=l.dot(u);if(c>=0)a();else{let h=ct(s,s.end()),f=ct(r,s.end()),d=h.dot(f);if(d>=0)o();else if(Oi(c,-1)&&Oi(d,-1)){let p=i.center();n(p),i=null}else c>d?a():o()}}function n(l){let u;if(e instanceof G)u=new G(e.start(),l);else if(e instanceof rt)u=new rt([...e.controls.slice(0,-1),l]);else if(e instanceof K)u=K.build5(e.start(),l,e.sweepAngle);else throw new Error("not supported");e=We(u,ht)?null:u;let c;if(s instanceof G)c=new G(l,s.end());else if(s instanceof rt)c=new rt([l,...s.controls.slice(1)]);else if(s instanceof K)c=K.build5(l,s.end(),s.sweepAngle);else throw new Error("supported");s=We(c,ht)?null:c}function a(){if(e instanceof G){let l=Hs(i.reverse());i=new G(l,i.end());let u=new G(e.start(),l);e=We(u,ht)?null:u}else if(e instanceof rt){let l=Hs(i.reverse());i=new G(l,i.end());let u=new rt([...e.controls.slice(0,-1),l]);e=We(u,ht)?null:u}else if(e instanceof K){let l=Hs(i.reverse());i=new G(l,i.end());let u=K.build5(e.start(),l,e.sweepAngle);e=We(u,ht)?null:u}else throw new Error("not supported")}function o(){if(s instanceof G){let l=Hs(i);i=new G(i.start(),l);let u=new G(l,s.end());s=We(u,ht)?null:u}else if(s instanceof rt){let l=Hs(i);i=new G(i.start(),l);let u=new rt([l,...s.controls.slice(1)]);s=We(u,ht)?null:u}else if(s instanceof K){let l=Hs(i);i=new G(i.start(),l);let u=K.build5(l,s.end(),s.sweepAngle);s=We(u,ht)?null:u}else throw new Error("not supported")}return{rebuildPrevPt:e,rebuildNextPt:s,rebuildLinkLine:i}}function Jl(t,e,i){if(t instanceof G||e.distance2(i)<=ve)return new G(e,i);if(t instanceof K)return K.build2(t.center,e.angleD(t.center),i.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);if(t instanceof rt){let s=t.getPercent(e,ht),r=t.getPercent(i,ht);return t.clip(s)[1].clip((r-s)/(1-s))[0]}else throw new Error("not supported operation")}var eg=class{constructor(t){this.pt=t}connect(t){this.prev=t,t.next=this}};function ia(t){let e=rn(),i;if(t instanceof St){let s=rs(t);if(s===null)return null;i=s}else if(t instanceof le){let s=t.items.map(r=>ia(r)).filter(r=>r!==null);if(s.length===0)return null;i=new le(s)}else{let s=t.items.map(r=>ia(r)).filter(r=>r!==null);if(s.length===0)return null;i=new te(s)}return Si.preprocessPolyline+=Zi(e),i}var Si={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function rn(){return{timeIndex:Object.assign({},Si),start:performance.now()}}function Kl(t){return Object.values(t).reduce((e,i)=>e+i,0)}function Zi(t){return performance.now()-t.start-(Kl(Si)-Kl(t.timeIndex))}function me(t,e,i,s){let r=Lt.RED,n=Lt.Golden;function a(){if(!s)return;let f=s.initColor(Lt.Golden);f.addPt(o),f.addPoint(o.end()),s.initColor(Lt.RED).addPt(l),s.draw();debugger}let o=t.getShape(),l=i?e.getShape():e.getShape().reverse(),u=ct(o,l.start()),c=ct(l),h=u.cross(c);if(Oi(h,0))if(o instanceof G)if(l instanceof G){if(Z.eq(h,0)&&(u.dot(c)>0?!ut(o.end(),l.start()):!ut(o.start(),l.start())))throw a(),new Error("line and line");return h<0}else{if(l instanceof K)return u.cross(l.center.sub(o.start()))<0;if(l instanceof rt){let f=l.getExtremePoints(o),d=f.length?f[0]:Qs(l.controls,o.start());return u.cross(d.sub(o.start()))<0}else throw new Error("not support")}else if(o instanceof K){if(l instanceof G)return o.isCCW;if(l instanceof K){if(l.center.equals1(o.center)&&(u.dot(c)>0?!ut(o.end(),l.start())&&o.end().sub(l.start()).dot(c)>0:!ut(o.start(),l.start())&&o.start().sub(l.start()).dot(c)>0))throw a(),new Error("arc and arc");return l.rx>=o.rx||l.center.distance2(o.center)>o.rx2?o.isCCW:!o.isCCW}else throw new Error("not support")}else if(o instanceof rt)if(l instanceof G){let f=o.getPercent(l.start(),ht),d=o.clip(f)[1],p=d.getExtremePoints(l);return(p.length?p[0]:Qs(d.controls,l.start())).sub(l.start()).cross(c)<0}else if(l instanceof rt){let f=o.getPercent(l.start(),ht),d=o.clip(f)[1],p=d.getExtremePoints(new G(l.start(),l.end())),m=l.getExtremePoints(new G(d.start(),d.end())),g=p.length?p[0]:Qs(d.controls,l.start()),b=m.length?m[0]:Qs(l.controls,l.start()),y=g.sub(l.start()),E=b.sub(l.start());return y.cross(E)<0}else throw Error("not support");else throw new Error("not support");else return h<0}function ws(t,e,i,s,r){let n=t.getShape(),a=e.getShape(),o=n instanceof K?hi(n,mt.toRadians(n.endAngle())):n instanceof rt?Yr(n,1):n.end().sub(n.start()).normalize(),l=ct(a),u=o.dot(l);if(Oi(u,-1))return me(t,e,!0,r)?me(t,i,s,r)&&me(e,i,s,r):me(t,i,s,r)||me(e,i,s,r);{let c=o.scale(-1).angle(X.ORIGIN),h=l.angle(X.ORIGIN);c>h&&(c-=Ta);let f=(c+h)/2,d=new X(Math.cos(f),Math.sin(f)),p=s?i.getShape():i.getShape().reverse(),m=ct(p);return d.cross(m)<0?me(t,i,s,r):me(e,i,s,r)}}function ja(t,e,i,s,r){let n=t.getShape(),a=e.getShape(),o=n instanceof K?hi(n,mt.toRadians(n.endAngle())):n instanceof rt?Yr(n,1):n.end().sub(n.start()).normalize(),l=ct(a),u=o.dot(l);if(Oi(u,-1))return me(t,e,!0,r)?me(t,i,s,r)&&me(e,i,s,r):me(t,i,s,r)||me(e,i,s,r);{let c=o.scale(-1).angle(X.ORIGIN),h=l.angle(X.ORIGIN);c>h&&(c-=Ta);let f=(c+h)/2,d=new X(Math.cos(f),Math.sin(f)),p=s?i.getShape():i.getShape().reverse(),m=ct(p);if(d.cross(m)<0){let g=o.dot(m)<0,b=Le(g?t.getShape().reverse():t.getShape(),p).state;return b!==3&&b!==4?me(t,i,s,r):b===(g?4:3)}else{let g=l.dot(m)<0,b=Le(g?e.getShape().reverse():e.getShape(),p).state;return b!==3&&b!==4?me(e,i,s,r):b===(g?4:3)}}}var ig=(t=>(t[t.NOT_IN=0]="NOT_IN",t[t.IS_IN=1]="IS_IN",t[t.IS_OVERLAP=2]="IS_OVERLAP",t))(ig||{}),sg=(t=>(t[t.AllClear=0]="AllClear",t[t.MapClear=1]="MapClear",t))(sg||{}),Ti,ts=!1;function Je(t,e,i,s,r,n,a,o=i.side===e,l=!0,u){return Ti=r,ts=n,$u(Zu(t,e,l,u,a,i,o,s),i,o,s,0)}function vi(t,e,i,s,r,n,a,o=s.side===i){Ti=r,ts=n;let l=Qu(t,e,i,new Map,s,o,a),u=l instanceof Array?-1:1;return $u(l,s,o,a,u)}function $u(t,e,i,s,r){for(;t instanceof Array;)r++,t.length===4?t=Qu(...t,e,i,s):t=Zu(...t,e,i,s);return{...t,existOverlap:r>0}}function Zu(t,e,i,s,r,n,a,o){if(sa===-1){o.initColor(Lt.RED).addPt(t.getShape()),o.initColor(Lt.Golden).addPt(e.getShape()),o.draw();debugger}let l=t.getShape(),u=a?e.getShape().reverse():e.getShape(),c=(l instanceof K?hi(l,i?u.start().angle(l.center):s?mt.toRadians(l.endAngle()):void 0):l instanceof rt?ct(l,i?u.start():s?l.end():l.start()):l.end().sub(l.start())).normalize(),h=(u instanceof K?hi(u,i?void 0:(s?l.end():l.start()).angle(u.center)):u instanceof rt?ct(u,i?void 0:s?l.end():l.start()):u.end().sub(u.start())).normalize();if(s===void 0){let p=c.dot(h);if(s=p<0,Oi(p,0))return{state:me(t,e,!a,o)?1:0,inter:xi(t,e,n,a,i,s,r)}}else if(s?c.dot(h)>0:c.dot(h)<0)if(i){let p,m=!0;if(l instanceof G&&ut(ci.foot(l,u.start()),s?l.end():l.start()))m=!1;else if(l instanceof K||l instanceof rt){let g=s?l.reverse():l,b=Le(u,Em(g,u.start()).reverse()).state;(b===1||b===2)&&(m=!1)}if(m){let g=!s;p=Le(g?l.reverse():l,u,o).state===(g?4:3)?1:0}else s?p=ws(t,t.nextSide,e,!a,o)?1:0:p=ws(t.prevSide,t,e,!a,o)?1:0;return{state:p,inter:xi(t,e,n,a,i,s,r)}}else return s?{state:me(t,t.nextSide,!0,o)?0:1,inter:xi(t,e,n,a,i,s,r),isReversed:!0}:{state:me(t.prevSide,t,!0,o)?0:1,inter:xi(t,e,n,a,i,s,r),isReversed:!0};let f,d=new Map([[3,4],[4,3],[0,1],[1,0],[2,2]]);if(i)if(t.judgeOverlapMap.has(e)&&!ts){let p=t.judgeOverlapMap.get(e);f=s?d.get(p.state):p.state}else f=Le(s?l.reverse():l,u).state,(f===3||f===4)&&t.judgeOverlapMap.set(e,{state:s?d.get(f):f});else{if(e.judgeOverlapMap.has(t)&&!ts){let p=e.judgeOverlapMap.get(t);f=a?d.get(p.state):p.state}else f=Le(u,s?l.reverse():l).state,(f===3||f===4)&&e.judgeOverlapMap.set(t,{state:a?d.get(f):f});f=d.get(f)}if(f===1||f===2){let p=a?e.prevSide:e,m=p.inters,g=p.getEnd();for(let b=m.length-1;b>=0;b--){let y=m[b];if(!(p.getShape()instanceof rt)&&!ut(g,y.coord))break;if(y===n)return{state:2,inter:xi(t,e,n,a,i,s,r)}}}if(f===3||f===4)return{state:f===(s?4:3)?1:0,inter:xi(t,e,n,a,i,s,r)};if(r.has(t)?r.get(t).mapSideList.push(e):r.set(t,{sideIsReversed:s,mapSideList:[e]}),r.has(e)?r.get(e).mapSideList.push(t):r.set(e,{sideIsReversed:a,mapSideList:[t]}),f===2)return s?[t.prevSide,t,a?e.prevSide:e.nextSide,r]:[t,t.nextSide,a?e.prevSide:e.nextSide,r];if(f===0)return[s?t.prevSide:t.nextSide,e,!1,s,r];if(f===1)return[t,a?e.prevSide:e.nextSide,!0,s,r];throw Error("not support")}function xi(t,e,i,s,r,n,a){if(ts)return null;let o=t.getShape(),l=s?e.getShape().reverse():e.getShape(),u=s;if(!r){let d=e;e=t,t=d,s=n,i=i.getBindedInter()}let c=d=>!(r?n:u)&&ut(d,t.prevSide.getEnd())?t.prevSide:t;if(s){let d=e.inters;for(let p=0;p<d.length;p++){let m=d[p];if(m.isInvalid&&n===void 0)continue;if(m===i&&ut(l.start(),i.coord))return r?m:m.getBindedInter();let g=m.getBindedInter().side,b=c(m.coord);if(g===b&&h(m))return f(m)}for(;;){e=e.nextSide;let p=e.inters;for(let m=0;m<p.length;m++){let g=p[m];if(g===i)return r?g:g.getBindedInter();if(a.has(e)){let b=g.getBindedInter().side;if(a.get(e).mapSideList.includes(b)||ut(g.coord,b.getEnd())&&a.get(e).mapSideList.includes(b.nextSide))return f(g);if(a.has(b)){let y=e.getShape().reverse(),E=ct(y,g.coord).dot(ct(b.getShape(),g.coord))<0,_=E?b.getShape().reverse():b.getShape(),S=Le(y,E?Ma(_,g.coord,_.end()):Ma(_,_.start(),g.coord)).state;if(S===1||S===2)return f(g)}else a.has(b.nextSide)}else if(g.side===i.side&&h(g))return f(g)}}}else{let d=e.inters;for(let p=d.length-1;p>=0;p--){let m=d[p];if(m.isInvalid&&n===void 0)continue;if(m===i&&ut(l.start(),i.coord))return r?m:m.getBindedInter();let g=m.getBindedInter().side,b=c(m.coord);if(g===b&&h(m))return f(m)}for(;;){e=e.prevSide;let p=e.inters;for(let m=p.length-1;m>=0;m--){let g=p[m];if(g===i)return r?g:g.getBindedInter();if(a.has(e)){let b=g.getBindedInter().side;if(a.get(e).mapSideList.includes(b)||ut(g.coord,g.getBindedInter().side.getEnd())&&a.get(e).mapSideList.includes(b.nextSide))return f(g);if(!a.has(b)&&a.has(b.prevSide)){let y=e.getShape().reverse(),E=ct(y,g.coord).dot(ct(b.getShape(),g.coord))<0;if(a.has(b.prevSide)){let _=E?b.getShape().reverse():b.getShape(),S=Le(e.getShape(),Ma(_,g.coord,_.end())).state;if(S===1||S===2)return f(g)}}}else if(g.side===i.side&&h(g))return f(g)}}}function h(d){if(d.isInvalid||d.getBindedInter().side!==(ut(d.coord,t.prevSide.getEnd())?t.prevSide:t))return!1;let p;if(r){if(ut(d.coord,l.start()))return!0;p=Le(n?o.reverse():o,m(l)).state}else{if(ut(d.coord,n?o.end():o.start()))return!0;p=Le(l,m(n?o.reverse():o)).state}return p===2||p===1;function m(g){if(g instanceof G)return ut(d.coord,g.end())?g:g.cutLine(d.coord);if(g instanceof K)return K.build2(g.center,g.startAngle,d.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof rt)return g.clip(g.getPercent(d.coord,ht))[0];throw new Error("not supported operation")}}function f(d){let p=i.getBindedInter(),m=i.side,g=p.side,b=i===d,y=i;if(s){let E=i.getIndex()-1;for(;m;){let _=m.inters;for(;E>=0;E--)if(i=_[E],i===d){b||(i.setIsInvalid(),i.isDealed(),y=i),m=null;break}else if(Ti===0)!i.isInvalid&&(!ut(i.coord,d.coord)||i.side===d.side&&i.getBindedInter().side===d.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),y=i);else if(Ti===1){if(i.isInvalid)continue;let S=i.getBindedInter().side;a.has(m)&&a.get(m).mapSideList.includes(S)&&(i.setIsInvalid(),i.isDealed(),y=i)}m=m==null?void 0:m.prevSide,E=(m==null?void 0:m.inters.length)-1}}else{let E=i.getIndex()+1;for(;m;){let _=m.inters;for(;E<_.length;E++){i=_[E];let S=i.getBindedInter();if(i===d){b||(i.setIsInvalid(),i.isDealed(),y=i),m=null;break}else if(Ti===0)!i.isInvalid&&(!ut(i.coord,d.coord)||m===d.side&&(ut(S.side.getEnd(),i.coord)?S.side.nextSide:S.side)===d.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),y=i);else if(Ti===1){let A=S.side;a.has(m)&&a.get(m).mapSideList.includes(A)&&(i.setIsInvalid(),i.isDealed(),y=i)}}m=m==null?void 0:m.nextSide,E=0}}if(Ti===0&&!ut(p.coord,d.coord))if(r?a.has(g)?a.get(g).sideIsReversed:n:u){let E=p.getIndex()-1;for(;g;){let _=a.has(g),S=g.inters;for(;E>=0;E--){if(p=S[E],p===d.getBindedInter()){g=null;break}p.isInvalid||!_||(!ut(p.coord,d.getBindedInter().coord)||p.side===d.side&&p.getBindedInter().side===d.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.prevSide,E=(g==null?void 0:g.inters.length)-1}}else{let E=p.getIndex()+1;for(;g;){let _=g.inters,S=a.has(g);for(;E<_.length;E++){if(p=_[E],p===d.getBindedInter()){g=null;break}let A=ut(g.getEnd(),p.coord)?a.has(g.nextSide):!1;p.isInvalid||!(S||A)||(!ut(p.coord,d.getBindedInter().coord)||p.side===d.side&&p.getBindedInter().side===d.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.nextSide,E=0}}return r?y:y.getBindedInter()}}function Qu(t,e,i,s,r,n,a){let o=t.getShape(),l=e.getShape(),u=n?i.getShape().reverse():i.getShape(),c=(o instanceof K?hi(o,u.start().angle(o.center)):o instanceof rt?ct(o,u.start()):o.end().sub(o.start())).normalize(),h=(l instanceof K?hi(l,u.start().angle(l.center)):l instanceof rt?ct(l,u.start()):l.end().sub(l.start())).normalize(),f=c.dot(h);if(Oi(f,-1)){let d=n?i.getShape().reverse():i.getShape(),p=ct(d).normalize(),m=c.add(h.scale(-1)).normalize().dot(p),g=Le(o.reverse(),l,a).state;if(m>-.9&&(g===3||g===4))return{state:g===4?0:1,inter:xi(e,i,r,n,!0,!1,s)};let b=Je(t,i,r,a,Ti,ts,s.size===0?new Map:s,n);return b.state===2?b:g===4?b.state===0||b.inter!==r?b:Je(e,i,r,a,Ti,ts,s.size===0?new Map:s,n):b.state===1||b.inter!==r?b:Je(e,i,r,a,Ti,ts,s.size===0?new Map:s,n)}else{let d=c.scale(-1).angle(X.ORIGIN),p=h.angle(X.ORIGIN);d>p&&(d-=Ta);let m=(d+p)/2,g=new X(Math.cos(m),Math.sin(m)),b=ct(u).normalize(),y=b.angle(X.ORIGIN),E=d<y&&y<p&&o instanceof G&&l instanceof G&&u instanceof G;if(g.cross(b)<=0){if(c.scale(-1).dot(b)<0){let _;return r.coord.equals1(u.start())?_=ct(o,r.coord).dot(ct(u,r.coord))<0:u instanceof G&&(_=ct(o,o.end()).dot(u.direct)<0),{state:ws(t,e,i,!n,a)?1:0,inter:xi(t,i,r,n,!0,_,s)}}return E&&o.distance2(u.start())>ve?[e,i,!0,void 0,s]:[t,i,!0,void 0,s]}else return h.dot(b)<=0?{state:ws(t,e,i,!n,a)?1:0,inter:xi(e,i,r,n,!0,void 0,s)}:E&&l.distance2(u.start())>ve?[t,i,!0,void 0,s]:[e,i,!0,void 0,s]}}var sa=0;function rg(t,e,i,s){let r=e.getBindedInter(),n=e.side,a=r.side,o=n.getShape(),l=a.getShape();if(s&&(sa++,sa===-1)){s.initColor(Lt.RED).addPt(o),s.initColor(Lt.Golden).addPt(l),s.draw();debugger}let u=0,c=!1;if(t===-1){let w=vi(n,n.nextSide,a,r,u,c,s),R=w.state!==0;if(w.state===2){let M=ct(o,e.coord).add(ct(n.nextSide.getShape(),e.coord)).normalize(),B=ct(l,e.coord).add(ct(a.nextSide.getShape(),e.coord)).normalize();return A(R,M.dot(B)>0)}let L=vi(n,n.nextSide,a.nextSide,r,u,c,s);return w.state!==L.state?(S(w,L),1):A(R,w.state!==vi(a,a.nextSide,n,e,u,!0,s).state,w.inter,L.inter)}if(t===1){let w=Je(n,a,r,s,u,c,new Map),R=w.state!==0;if(w.state===2)return A(R,ct(o,e.coord).dot(ct(l,e.coord))>0);let L;if(w.isReversed&&w.existOverlap&&ut(w.inter.coord,a.getEnd())&&w.inter.getBindedInter().side!==n){let q=w.inter.getBindedInter().side;if(q===n.nextSide)L={state:ws(n,q,a.nextSide,!0,s)?1:0,inter:r};else if(q===n.prevSide){if(L={state:ws(q,n,a.nextSide,!0,s)?1:0,inter:w.inter},w.state===L.state&&e!==w.inter){let H=ct(l,e.coord),V=ct(a.nextSide.getShape(),e.coord),W=ct(q.getShape(),e.coord);return A(R,H.add(V).dot(W)>0,w.inter,L.inter)}}else L=Je(n,a.nextSide,r,s,u,c,new Map)}else L=Je(n,a.nextSide,r,s,u,c,new Map);if(w.state!==L.state)return S(w,L),1;let M=ct(l,e.coord),B=ct(a.nextSide.getShape(),e.coord);if(Oi(M.dot(B),-1)){let q=me(a,a.nextSide,!0,s);return A(R,w.state!==Je(a.nextSide,n,e,s,u,!0,new Map,q?!R:R,!1).state,w.inter,L.inter)}else{let q=ct(o,e.coord);return A(R,M.add(B).dot(q)>0,w.inter,L.inter)}}if(!(o instanceof rt||l instanceof rt))return 1;let h=ct(o,e.coord),f=ct(l,e.coord),d,p;if(l instanceof G)d=new G(e.coord,l.start()),p=new G(e.coord,l.end());else if(l instanceof K){let w=e.coord.angleD(l.center);d=K.build2(l.center,w,l.startAngle,l.rx,l.ry,l.isCCW?0:1),p=K.build2(l.center,w,l.endAngle(),l.rx,l.ry,l.isCCW?1:0)}else if(l instanceof rt){let w=l.getPercent(e.coord,ht);[d,p]=l.clip(w),d=d.reverse()}else throw new Error("not support");let m=h.dot(f)>0,g,b;m?(g=Le(o.reverse(),d).state,b=Le(o,p).state):(g=Le(o,d).state,b=Le(o.reverse(),p).state);let y;g===0?y=Je(m?n.prevSide:n.nextSide,a,r,s,u,c,new Map,!0,!1,m):g===1?y=Je(n,a.prevSide,r,s,u,c,new Map,!0,!0,m):g===2?m?y=vi(n.prevSide,n,a.prevSide,r,u,c,s,!0):y=vi(n,n.nextSide,a.prevSide,r,u,c,s,!0):m?g===3?y={inter:r,state:0}:y={inter:r,state:1}:g===3?y={inter:r,state:1}:y={inter:r,state:0};let E=y.state!==0;if(y.state===2)return A(E,m);let _;if(b===0?_=Je(m?n.nextSide:n.prevSide,a,r,s,u,c,new Map,!1,!1,!m):b===1?_=Je(n,a.nextSide,r,s,u,c,new Map,!1,!0,!m):b===2?m?_=vi(n,n.nextSide,a.nextSide,r,u,c,s,!1):_=vi(n.prevSide,n,a.nextSide,r,u,c,s,!1):m?b===3?_={inter:r,state:1}:_={inter:r,state:0}:b===3?_={inter:r,state:0}:_={inter:r,state:1},y.state===_.state)return y.inter===_.inter?(e.setIsInvalid(),0):A(E,m,y.inter,_.inter);return S(y,_),1;function S(w,R){let L=w.state!==0;if(w.inter===R.inter){e.setOutToIn(L);return}else Ys(w.inter,R.inter,!0),Ys(R.inter,w.inter,!1);let M=[];if(t===-1){let q=ct(o,e.coord),H=ct(n.nextSide.getShape(),e.coord),V=ct(l,e.coord),W=ct(a.nextSide.getShape(),e.coord);M.push(q.dot(V)),M.push(q.dot(W)),M.push(H.dot(V)),M.push(H.dot(W))}else{let q=ct(o,e.coord);M.push(ct(l,e.coord).dot(q)),M.push(ct(a.nextSide.getShape(),e.coord).dot(q))}if(M.reduce((q,H)=>Math.abs(q)>Math.abs(H)?q:H,0)>0)if(i===1||i===0||i===2||i===3)e.setOutToIn(L);else throw new Error("not support");else if(i===1)B(!L);else if(i===0||i===2||i===3)B(L);else throw new Error("not support");function B(q){e.setIsInvalid();let H=(q?w:R).inter;delete H.isInvalid,delete H.getBindedInter().isInvalid,H.setOutToIn(!L)}}function A(w,R,L,M){if(L===M){if(e.side.outline.inters.find(H=>!H.isInvalid&&H!==e&&ut(H.coord,e.coord)))return e.setIsInvalid(),0;let B=new Mi(e.coord,n,s),q=new Mi(e.coord,a,s);return B.bind(q),R?n.inters.splice(e.getIndex(),0,B):n.inters.splice(e.getIndex()+1,0,B),a.inters.splice(e.getBindedInter().getIndex(),0,q),B.setOutToIn(w),e.setOutToIn(!w),B.isDealed(),n.inters.forEach((H,V)=>H.setIndex(V)),a.inters.forEach((H,V)=>H.setIndex(V)),2}else{let B=function(){let q=L.getBindedInter(),H=M.getBindedInter();delete L.isInvalid,delete q.isInvalid,delete M.isInvalid,delete H.isInvalid,L.setOutToIn(!w),M.setOutToIn(w),Ys(L,M,!0),Ys(M,L,!1),Ys(q,H,R),Ys(H,q,!R)};if(e.setIsInvalid(),R){if(i===1||i===0||i===2||i===3)return B(),2;throw new Error("not support")}else{if(i===1)return w?0:(B(),2);if(i===0||i===2||i===3)return w?(B(),2):0;throw new Error("not support")}}}}function Ys(t,e,i){let{judge:s,changeNum:r}=a(),n=t.getIndex();for(let o=n+r,l=t.side.inters;s(o);o+=r){if(l[o].isInvalid)continue;if(!ut(l[o].coord,t.coord))break;l[o].setIndex(n),l[n].setIndex(o);let u=l[o];l[o]=l[n],l[n]=u,n=o}function a(){let o=t.side===e.side;if(i){let l=o?e.getIndex():t.side.inters.length;return{judge:u=>u<l,changeNum:1}}else{let l=o?e.getIndex()+1:0;return{judge:u=>u>=l,changeNum:-1}}}}var $l=0,Mi=class{constructor(t,e,i){this.id=$l++,this.coord=t,this.side=e,i&&(this.id=$l++,this.drawDebug=i);let s=new Fe;s.ext2(t),this._bbox=s.build1()}bbox(){return this._bbox}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(t){this.outToIn=t,this.bindedInter.outToIn=!t}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(t){this.bindedInter=t,t.bindedInter=this}setIndex(t){this.index=t}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let t=this.getIndex(),e=this.side.getStart();return t&&(e=this.side.inters[t-1].coord),e}getTangent(){let t=this.side.getShape();if(t instanceof G)return t.end().sub(t.start());if(t instanceof K){let e=this.coord.angle(t.center);return t.isCCW?e+=Kn:e-=Kn,new X(Math.cos(e),Math.sin(e))}else{if(t instanceof rt)return Yr(t,t.getPercent(this.coord,ht));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let t=[],e=this,i;if(this.drawDebug){Ga++;let s=Ga===-1,r=this.drawDebug.initColor(Lt.RED);if(s){this.drawDebug.draw();debugger}i=n=>{if(t.push(n),s){r.addPt(t[t.length-1]),this.drawDebug.draw();debugger}}}else i=s=>t.push(s);for(;!e.visited;){let s=function(o,l){if(Z.eq(o.distance2(l),0))return;let u=sn.rebuild(n.getShape(),o,l);if(!u)return!0;i(u)};e.visit();let r=e.getIndex(),n=e.side,a=n.inters[r+1];for(;a!=null&&a.isInvalid;)a=n.inters[a.getIndex()+1];if(a)s(e.coord,a.coord),e=a.bindedInter;else{let o=s(e.coord,n.getEnd()),l=e.coord;for(n=n.nextSide,e=null;;){for(let u of n.inters)if(!u.isInvalid){e=u.bindedInter;break}if(e)break;o?(s(l,n.getEnd()),o=!1):i(n.getShape()),n=n.nextSide}o?(Z.eq(l.distance2(e.coord),0)?s(l,n.getEnd()):s(l,e.coord),o=!1):Z.eq(n.getEnd().distance2(e.coord),0)?i(n.getShape()):s(n.getStart(),e.coord)}}if(e!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:Ga,handleId:sa,boolId:Lr})),new Error("inter !== this");return rs(St.build7(t))}},Ga=0,Ha=class co{constructor(e,i,s,r,n){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=e,this.isGroup1=s,this.isOutside=r,this.finalIsOutside=r,this.polyline=i,n&&(this.polygon=n),e.forEach(a=>a.outline=this)}static build(e,i,s,r,n){let a=e.primitives.map(l=>new sn(l,r)),o=a[a.length-1];return a.forEach(l=>{o.connect(l),o=l}),n?new co(a,e,i,s,n):new co(a,e,i,s)}setFinalIsOutSide(e){this.finalIsOutside=e}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(e,i){if(!(e.interOutlines&&e.interOutlines===this.interOutlines))if(e.interOutlines)if(this.interOutlines){let s,r;this.interOutlines.length>e.interOutlines.length?(s=this.interOutlines,r=e.interOutlines):(s=e.interOutlines,r=this.interOutlines),r.forEach(n=>{s.push(n),n.interOutlines=s}),i.delete(r)}else e.interOutlines.push(this),this.interOutlines=e.interOutlines;else this.interOutlines?(this.interOutlines.push(e),e.interOutlines=this.interOutlines):(e.interOutlines=this.interOutlines=[this,e],i.add(this.interOutlines))}isContain(e){if(!this.polyline.bbox().extendOfSize(ht).isContainsBBox(e.polyline.bbox()))return!1;let i=e.polyline.primitives[0].start();if(e.hasInter&&e.isAllInterIsInvalid()){let s=e.inters[0];s.getBindedInter().side.outline!==this?i=s.side.getCenterPoint():i=s.side.getCenterPoint(s.coord)}return!!this.polyline.getWindingNum(i)}isInternally(e){return!!this.polyline.getWindingNum(e)}isEqual(e){return this.polyline===e.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let e=this.sides[this.sides.length-1];this.sides.forEach(i=>{i.reverse(),e.connect(i),e=i})}returnPolyline(){let e=this.sides.map(s=>s.getShape()),i=this.polyline.primitives;if(this.sides.length===i.length){let s=new Set(i);if(!e.some(r=>!s.has(r)))return this.polyline}return St.build7(e)}};function Zl(t,e,i){let s=[];return t.forEach(r=>r.forEach(n=>{if(n.hasInter&&!n.isAllInterIsInvalid())return;let a=n.bbox(),o=e.search(a.extendOfSize(ht)).filter(l=>l.bbox().extendOfSize(ht).isContainsBBox(a)).sort((l,u)=>l.bbox().area()-u.bbox().area());for(let l of o)if(l.isContain(n)){let u=i(!n.isOutside,l.isOutside),c=i(n.isOutside,l.isOutside);u!==c&&(s.push(n),n.setFinalIsOutSide(!u));return}i(n.isOutside,!1)!==i(!n.isOutside,!1)&&s.push(n)})),s}function ng(t,e,i){let s;switch(i){case 0:s=(o,l)=>o&&l;break;case 1:s=(o,l)=>o||l;break;case 2:s=(o,l)=>o&&!l;break;case 3:s=(o,l)=>o&&!l||!o&&l;break;default:throw Error("not support the rule")}let r=new Vr(10),n=new Vr(10);t.forEach(o=>o.forEach(l=>r.add(l))),e.forEach(o=>o.forEach(l=>n.add(l)));let a=Zl(t,n,s);return Zl(e,r,(o,l)=>s(l,o)).forEach(o=>a.push(o)),a}var ag=class{constructor(t){this.roots=[],this.nodes=t.sort((e,i)=>e.bbox().minX-i.bbox().minX).map(e=>new og(e)),this.nodes.forEach((e,i)=>{e.visit()&&(this.roots.push(e),this.build(i))})}build(t){let e=this.nodes[t];for(let i=t+1,s=this.nodes.length;i<s;i++){let r=this.nodes[i];if(e.key.bbox().maxX<r.key.bbox().minX)break;r.getIsVisit()||e.isContain(r)&&(r.visit(),e.addChild(r),this.build(i))}}getPolygons(){let t=[];return this.roots.forEach(e=>e.getPolygons().forEach(i=>t.push(i))),t}},og=class{constructor(t){this.children=[],this.isVisit=!1,this.key=t}getIsVisit(){return this.isVisit}isContain(t){return this.key.isContain(t.key)}addChild(t){this.children.push(t)}getPolygons(){let t=[];return this.getPolylineList(t),t.map(e=>{let i=e[0].polygon;if(i&&i.items.length===e.length){let s=e.map(n=>n.returnPolyline()),r=new Set(i.items);return s.some(n=>!r.has(n))?new le(s):i}else return new le(e.map(s=>s.returnPolyline()))})}getPolylineList(t,e){e?(e.push(this.key),e=null):(e=[this.key],t.push(e)),this.children.forEach(i=>i.getPolylineList(t,e))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function Ql(t){let e="";return t.items.forEach((i,s)=>{let r="$";if(i.items.forEach((n,a)=>{let o="[";if(n.primitives.forEach((l,u)=>{let c="";if(l instanceof G)c=`Line,${l.start().x},${l.start().y},${l.end().x},${l.end().y}`;else if(l instanceof K)c=`Arc,${l.center.x},${l.center.y},${l.startAngle},${l.sweepAngle},${l.rx}`;else if(l instanceof rt)c=`Bezier,${l.controls.map(h=>`${h.x},${h.y}`).join(",")}`;else throw new Error("not supported");if(u===n.primitives.length-1){o+=`${c}]`;return}o+=`${c},`}),a===i.items.length-1){r+=`${o}$`;return}r+=`${o}_`}),s===t.items.length-1){e+=`${r}`;return}e+=`${r}^`}),console.log(e),e}function tu(t){let e=t.split("^"),i=[];return e.forEach(r=>{let n=/\$(.*?)\$/,a=r.match(n)[1].split("_"),o=[];a.forEach(u=>{let c=/\[(.*?)\]/,h=u.match(c)[1].split(","),f=[],d=[];for(let m=0;m<h.length;m++){let g=h[m];if(g==="Line"||g==="Arc"||g==="Bezier"){if(f.length){let b=s(f);d.push(b),f.length=0}f.push(g);continue}f.push(Number(g))}f.length&&(d.push(s(f)),f.length=0);let p=St.build7(d);o.push(p)});let l=new le(o);i.push(l)}),new te(i);function s(r){let n=r[0];if(n==="Line")return new G(new X(r[1],r[2]),new X(r[3],r[4]));if(n==="Arc")return K.build3(new X(r[1],r[2]),r[3],r[4],r[5],r[5]);if(n==="Bezier"){let a=[];for(let o=1;o<r.length;o+=2)a.push(new X(r[o],r[o+1]));return new rt(a)}else throw new Error("not support")}}var lg=class{constructor(t=1){this.group1Str="$[Line,20193.777980000017,4122.200439600661,20193.77082,4211.848760073709,Arc,20193.972672902382,4211.8487570980205,179.99915535323618,-89.99540000050294,0.2018529024026465,Line,20193.972659672283,4212.050609999989,20193.972660393258,4212.039610000013,Arc,20193.97217289501,4211.848257065248,89.85403133887164,89.99540000041924,0.19135355574930143,Line,20193.78082,4211.848759926291,20193.78897999998,4122.200440479205,Line,20193.78897999998,4122.200440479205,20193.777980000017,4122.200439600661]$",this.group2Str="$[Arc,20209.72784128151,4122.2007625157785,258.46768032837986,-75.66780748375947,4.138846238512183,Line,20205.593935808283,4121.998590004101,20193.97982992629,4121.998600000001,Arc,20193.97983290198,4122.2004529023825,269.9991553532362,-89.99540000050297,0.20185290240401074,Arc,20193.782979999996,4122.20044,180.00375535340328,-180.0000000000027,0.004999999999025513,Arc,20193.979332869207,4122.200952909754,180.15347936671733,89.99540000008247,0.19135355575111057,Line,20193.97983008845,4122.009599999999,20205.603694309226,4122.003828485546,Arc,20209.733142304296,4122.194577876843,182.64475341258483,75.73379999998886,4.133851239977064,Line,20208.900400396684,4118.145470939558,20208.902599535475,4118.156248870184,Arc,20206.972515961093,4108.700057667588,78.46393309088245,-78.46759999998636,9.65115405866796,Arc,20216.618669999996,4108.69944,359.99996825446135,-180,0.004999999999200412,Arc,20206.973015966745,4108.699445349495,359.99996822365375,78.46759999998409,9.640654033253735]$^$[Line,20193.997796883676,4095.399470032799,20205.596133314026,4095.4013992171836,Arc,20209.72470159858,4095.1923799234505,177.10172964919312,-75.64935037184974,4.133855965730166,Arc,20209.73000213952,4095.198565517174,101.5415133143569,75.7293000000185,4.128850963459707,Line,20205.605834328744,4095.395161923586,20193.997203529463,4095.389485743675,Arc,20193.994588809255,4095.197684525904,89.21896662213764,4.544099999999517,0.19181903946188483,Arc,20193.981499796217,4095.1977402038,89.85034659953621,89.9999999995926,0.19135044893494071,Arc,20193.78515,4095.19824,0,-180,0.005,Arc,20193.98200016982,4095.1982398301675,179.99995179248322,-89.99999999974185,0.20185016982129908,Arc,20193.981986624152,4095.198185381971,89.9961078637802,-4.487285276547311,0.2019046184835962]$",this.rule=t}getGroup1(){return tu(this.group1Str)}getGroup2(){return tu(this.group2Str)}},Ya=new ya(2),Pr=class{getUnion(t,e=!0){return e&&(t=t.map(i=>this.asSameSweep([i])[0])),zm(Rm,t)}asSameSweep(t){let e=0;return t.forEach(i=>e+=i.area(.01)),e>0?t.map(i=>i.reverse()):t}getSubtraction(t,e){let i=new jr(!1),s=new Gr(Mn.rule,Ya,i);for(let r of t){let n=Mn.weight(0);s.addPolyline(r,n)}for(let r of e){let n=Mn.weight(1);s.addPolyline(r,n)}return s.simplify(),i.plGrps}getIntersection(t,e){let i=new jr(!1),s=new Gr(Bn.rule,Ya,i);for(let r of t){let n=Bn.weight(0);s.addPolyline(r,n)}for(let r of e){let n=Bn.weight(1);s.addPolyline(r,n)}return s.simplify(),i.plGrps}getMutuallyExclusive(t,e){let i=new jr(!1),s=new Gr(kn.rule,Ya,i);for(let r of t){let n=kn.weight(0);s.addPolyline(r,n)}for(let r of e){let n=kn.weight(1);s.addPolyline(r,n)}return s.simplify(),i.plGrps}},Lr=0,Va=!1;function vr(t,e,i,s,r){let n=rn(),a=[],o=[],l=[],u=new Set,c;if(r){if(c=new en(r),Lr++,Va){debugger;Va=!1;let _=new lg;vr(_.rule,_.getGroup1(),_.getGroup2(),s,r)}if(Lr===-1||Va){console.table({rule:t,group1:Ql(e),group2:Ql(i)}),c.clear();let _=c.initColor(Lt.GREEN),S=c.initColor(Lt.WHITE),A=c.initColor(Lt.BLUE),w=c.initColor(Lt.Gray);e.items.forEach(R=>R.items.forEach((L,M)=>{M>0?S.addPly(L):_.addPly(L)})),i.items.forEach(R=>R.items.forEach((L,M)=>{M>0?w.addPly(L):A.addPly(L)})),c.draw();debugger}}let h=e.items.length!==0&&i.items.length!==0?e.bbox().extendOfSize(ht).intersection1(i.bbox().extendOfSize(ht)):null;if(h){let _=[],S=[];switch(t){case 0:{for(let A of e.items)A.bbox().isIntersect(h)&&_.push(A);for(let A of i.items)A.bbox().isIntersect(h)&&S.push(A);break}case 1:case 3:{for(let A of e.items)A.bbox().isIntersect(h)?_.push(A):a.push(A);for(let A of i.items)A.bbox().isIntersect(h)?S.push(A):a.push(A);break}case 2:{for(let A of e.items)A.bbox().isIntersect(h)?_.push(A):a.push(A);for(let A of i.items)A.bbox().isIntersect(h)&&S.push(A);break}default:throw new Error("not support")}_.length!==e.items.length&&(e=new te(_)),S.length!==i.items.length&&(i=new te(S))}else{switch(t){case 0:break;case 1:case 3:{e.items.forEach(_=>a.push(_)),i.items.forEach(_=>a.push(_));break}case 2:{e.items.forEach(_=>a.push(_));break}default:throw new Error("not support")}e=new te([]),i=new te([])}y(e,o,!0),y(i,l,!1);let f=t===2||t===3?(_,S)=>ut(_.getEnd(),S)?_.nextSide:_:(_,S)=>ut(_.prevSide.getEnd(),S)?_.prevSide:_,d=(_,S,A)=>{if(ut(_.getEnd(),A)){if(_.inters.findIndex(w=>w.getBindedInter().side===S&&ut(w.coord,_.getEnd()))===-1)return new Mi(A,_,c)}else return new Mi(A,_,c)},p=t===2||t===3?(_,S,A)=>{if(ut(_.getStart(),A)){if(_.inters.findIndex(w=>w.getBindedInter().side===S&&ut(w.coord,_.getStart()))===-1)return new Mi(A,_,c)}else return new Mi(A,_,c)}:d;s.seek(e,i,(_,S,A,w,R,L)=>{let M=o[_][S],B=l[w][R],q=M.sides[A],H=B.sides[L],V=ti(q.getShape(),H.getShape());if((q.getShape()instanceof rt||H.getShape()instanceof rt)&&V>=4){if(q.getShape()instanceof K||H.getShape()instanceof K){let v=function(O,x){let k=!1;for(let F=0;F<x.length;F+=2)ut(new X(x[F],x[F+1]),O)&&(k=!0);k||x.push(O.x,O.y)},j=[N[0],N[1]];for(let O=0;O<V;O+=2){let x=new X(N[O],N[O+1]);for(let k=O+2;k<V;k+=2){let F=new X(N[k],N[k+1]);if(!ut(x,F)){v(F,j);break}}}V=j.length,j.forEach((O,x)=>N[x]=O)}else for(let v=V-2;v>=2;v-=2)for(let j=v-2;j>=0;j-=2)if(ut(new X(N[v],N[v+1]),new X(N[j],N[j+1]))){N[j]=(N[v]+N[j])/2,N[j+1]=(N[v+1]+N[j+1])/2;for(let O=V-3;O>=v;O--)N[O]=N[O+2];V-=2;break}}let W=0;if(V===4){let v=function(x){return ut(q.getEnd(),x)||ut(q.prevSide.getEnd(),x)||ut(H.prevSide.getEnd(),x)||ut(H.getEnd(),x)},j=new X(N[0],N[1]),O=()=>{let x=new Mi(j,q,c),k=new Mi(j,H,c);x.bind(k),x.setIsInvalid(),x.isDealed(),M.inters.push(x),B.inters.push(k)};if(N[0]===N[2]&&N[1]===N[3])if(v(j))W=2;else{O();return}}for(;W<V;W+=2){let v=new X(N[W],N[W+1]),j=q,O=H;if(ut(j.prevSide.getEnd(),v)&&(j=j.prevSide),O=f(O,v),q!==j&&H!==O){let k=t===2||t===3?H.getEnd():O.getEnd();j.getEnd().distance1(v)<k.distance1(v)?(v=j.getEnd(),ut(k,v)||(O=H)):(v=k,ut(j.getEnd(),v)||(j=q))}let x=d(j,O,v);if(x){let k=p(O,j,v);k&&(j.addInter(x),M.inters.push(x),O.addInter(k),B.inters.push(k),x.bind(k),M.intersect(B,u))}}return V},r);let m=E(),g=ng(o,l,t);g.forEach(_=>!_.startAndEndIsSameOutsideFlag()&&_.reverse()),new ag(m.concat(g)).getPolygons().forEach(_=>a.push(_));let b=new te(a);if(c){if(Lr===-1){let _=c.initColor(Lt.RED),S=c.initColor(Lt.Golden);a.forEach(A=>{_.addPly(A.items[0]),A.items.slice(1).forEach(w=>S.addPly(w))}),c.draw();debugger;throw new Error}b.id=Lr}return Si.BooleanTools+=Zi(n),b;function y(_,S,A){_.items.forEach(w=>{let R=[];R.push(Ha.build(w.items[0],A,!0,c,w)),w.items.slice(1).forEach(L=>{R.push(Ha.build(L,A,!1,c))}),S.push(R)})}function E(){let _=[];return u.forEach(A=>{t===2||t===3?A.forEach(R=>{R.isGroup1||R.reverse(),R.sides.forEach(L=>L.sortInters())}):A.forEach(R=>R.sides.forEach(L=>L.sortInters())),A.map(R=>R.sides.filter(L=>L.inters.length)).flat(2).sort((R,L)=>{let M=R.inters,B=L.inters,q=ut(M[M.length-1].coord,R.getEnd()),H=ut(B[B.length-1].coord,L.getEnd());if(q&&H){let V=0,W=0;for(let v=M.length-2;v>=0&&ut(M[v].coord,R.getEnd());v--)V++;for(let v=B.length-2;v>=0&&ut(B[v].coord,L.getEnd());v--)W++;return W-V}else return q?-1:1}).forEach(R=>{R.inters.forEach(L=>{if(L.dealed)return;let M=L.side,B=L.getBindedInter().side,q;ut(M.getEnd(),L.coord)&&ut(B.getEnd(),L.coord)?q=-1:ut(M.getEnd(),L.coord)?(q=1,L=L.getBindedInter()):ut(B.getEnd(),L.coord)&&(q=1);let H=rg(q,L,t,c);L.isDealed(),H&&(M.outline.setAllInterIsInvalidToFalse(),B.outline.setAllInterIsInvalidToFalse())})}),w(A),t===3&&(A.forEach(R=>{R.reverse(),R.sides.forEach(L=>{L.sortInters(),L.inters.forEach(M=>{M.resetVisitStatus()})})}),w(A));function w(R){R.forEach(L=>{L.inters.forEach(M=>{if(M.isInvalid||M.getVisited())return;let B=M.findStartInter(),q=S(t)?B.run():B.getBindedInter().run(),H=L.polyline.primitives;if(q){if(H.length===q.primitives.length){let V=new Set(H);if(!q.primitives.some(W=>!V.has(W))){_.push(L);return}}_.push(Ha.build(q,!0,!0,c))}})})}}),_;function S(A){switch(A){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var An=/\bstablilizetion\b/.test(self.location.href)||!0,Ar={intersect(t,e,i,s){try{return vr(0,t,e,i,s)}catch(r){if(An){let n=new Pr().getIntersection(t.items.map(a=>a.items.map(o=>o)).flat(2),e.items.map(a=>a.items.map(o=>o)).flat(2));return new te(n.map(a=>new le(a.items)))}throw r}},union(t,e,i,s){try{return vr(1,t,e,i,s)}catch(r){if(An){let n=new Pr,a=t.items.map(l=>l.items.map(u=>u)).flat(2);e.items.forEach(l=>l.items.forEach(u=>a.push(u)));let o=n.getUnion(a);return new te(o.map(l=>new le(l.items)))}throw r}},diff(t,e,i,s){try{return vr(2,t,e,i,s)}catch(r){if(An){let n=new Pr().getSubtraction(t.items.map(a=>a.items.map(o=>o)).flat(2),e.items.map(a=>a.items.map(o=>o)).flat(2));return new te(n.map(a=>new le(a.items)))}throw r}},xor(t,e,i,s){try{return vr(3,t,e,i,s)}catch(r){if(An){let n=new Pr().getMutuallyExclusive(t.items.map(a=>a.items.map(o=>o)).flat(2),e.items.map(a=>a.items.map(o=>o)).flat(2));return new te(n.map(a=>new le(a.items)))}throw r}}},ug=class extends Gr{constructor(t,e,i,s,r,n){super(t.rule,ya.DUMMY,e),this.sideGroup1=[],this.sideGroup2=[],this.group1=i,this.group2=s,this.seeker=r,this.addGroup(i,t.weight(0),this.sideGroup1),this.addGroup(s,t.weight(1),this.sideGroup2),this.bus=n}addGroup(t,e,i){if(!t)debugger;t.items.forEach(s=>{let r=[];s.items.forEach(n=>{let a=this.sides.length;this.addPolyline(n,e),r.push(this.sides.slice(a))}),i.push(r)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(t,e,i,s,r,n)=>{let a=this.sideGroup1[t][e][i],o=this.sideGroup2[s][r][n],l=ti(a.shape,o.shape);for(let u=0;u<l;u+=2){let c=new X(N[u],N[u+1]);a.inters.push(c),o.inters.push(c),this.event.onIntersect(c,a,o)}return l},this.bus)}},cg=class extends jr{constructor(t){super(!!t),t&&(this.drawDebug=new en(t),this.blueDrawing=this.drawDebug.initColor(Lt.BLUE),this.greenDrawing=this.drawDebug.initColor(Lt.GREEN),this.redDrawing=this.drawDebug.initColor(Lt.RED))}onOriginSide(t){super.onOriginSide(t),this.debug&&this.blueDrawing.addPt(t.shape)}onPolylineGroup(t,e){super.onPolylineGroup(t,e),this.debug&&t.items.forEach(i=>this.greenDrawing.addPly(i))}draw(){this.drawDebug.draw()}};function On(t,e,i,s,r){let n=rn(),a=new cg(r);new ug(t,a,e,i,s,r).simplify();let o=[];a.plGrps.forEach(u=>{let c=u.items.map(h=>ia(h));c[0]&&o.push(new le(c.filter(h=>h)))});let l=new te(o);return Si.BooleanTools+=Zi(n),l}var Rn=!0,Or={intersect(t,e,i,s){try{return Ar.intersect(t,e,i,s)}catch(r){if(Rn)throw r;return console.error(r),On(Bn,t,e,i,s)}},union(t,e,i,s){try{return Ar.union(t,e,i,s)}catch(r){if(Rn)throw r;return console.error(r),On(Dm,t,e,i,s)}},diff(t,e,i,s){try{return Ar.diff(t,e,i,s)}catch(r){if(Rn)throw r;return console.error(r),On(Mn,t,e,i,s)}},xor(t,e,i,s){return Ar.xor(t,e,i,s)}};var hg=class{init(t){}seek(t,e,i,s){let r=t.bbox().extendOfSize(5e-6).intersection1(e.bbox().extendOfSize(5e-6));if(!r)return;let n=rn(),a=[];for(let f=0,d=t.items.length;f<d;f++){let p=t.items[f];if(r.isIntersect(p.bbox()))for(let m=0,g=p.items.length;m<g;m++){let b=p.items[m];if(r.isIntersect(b.bbox()))for(let y=0,E=b.primitives.length;y<E;y++){let _=b.primitives[y].bbox();r.isIntersect(_)&&a.push({bbox:_,polygonIndex:f,polylineIndex:m,ptIndex:y})}}}let o=a.length;if(o===0){Si.IntersectionSeeker+=Zi(n);return}let l=[];for(let f=0,d=e.items.length;f<d;f++){let p=e.items[f];if(r.isIntersect(p.bbox()))for(let m=0,g=p.items.length;m<g;m++){let b=p.items[m];if(r.isIntersect(b.bbox()))for(let y=0,E=b.primitives.length;y<E;y++){let _=b.primitives[y].bbox();r.isIntersect(_)&&l.push({bbox:_,polygonIndex:f,polylineIndex:m,ptIndex:y})}}}let u=l.length;if(u===0){Si.IntersectionSeeker+=Zi(n);return}if(o<5||u<5){for(let f=0,d=a.length;f<d;f++)for(let p=0,m=l.length;p<m;p++)if(a[f].bbox.isIntersect(l[p].bbox.extendOfSize(1e-5))){let g=a[f],b=l[p];i(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}Si.IntersectionSeeker+=Zi(n);return}a.sort((f,d)=>f.bbox.minX-d.bbox.minX),l.sort((f,d)=>f.bbox.minX-d.bbox.minX);let c=0,h=0;for(;c<o&&h<u;)if(a[c].bbox.minX<l[h].bbox.minX){let f=a[c],d=f.bbox;for(let p=h;p<u;p++){let m=l[p],g=m.bbox;if(g.minX>d.maxX+1e-5)break;(d.minY<g.minY?g.minY:d.minY)<(d.maxY<g.maxY?d.maxY:g.maxY)+1e-5&&i(f.polygonIndex,f.polylineIndex,f.ptIndex,m.polygonIndex,m.polylineIndex,m.ptIndex)}c++}else{let f=l[h],d=f.bbox;for(let p=c;p<o;p++){let m=a[p],g=m.bbox;if(g.minX>d.maxX+1e-5)break;(g.minY<d.minY?d.minY:g.minY)<(g.maxY<d.maxY?g.maxY:d.maxY)+1e-5&&i(m.polygonIndex,m.polylineIndex,m.ptIndex,f.polygonIndex,f.polylineIndex,f.ptIndex)}h++}Si.IntersectionSeeker+=Zi(n)}},Te,Ae=(Te=class{static getDebug(){return Te.drawDebug||(Te.drawDebug=new en(Te.curBus)),Te.drawDebug}static getDrawing(e=Lt.GREEN){return this.getDebug().initColor(e)}static clearDrawing(){Te.getDebug().clear()}static drawText(e,i,s=Lt.GREEN){Te.getDrawing(s).addText(e,i,1.5,.1,!0)}static drawBBox(e,i=Lt.GREEN){if(!e)return;let s=Te.getDrawing(i),r=new G(e.UL(),e.UR()),n=new G(e.UR(),e.LR()),a=new G(e.LR(),e.LL()),o=new G(e.LL(),e.UL());s.addPt(r),s.addPt(n),s.addPt(a),s.addPt(o)}static drawPolyType(e,i){let s=Te.getDrawing(i);if(e instanceof St)s.addPly(e);else if(e instanceof le)for(let r of e.items)r instanceof St?s.addPly(r):this.drawPolyType(r,i);else if(e instanceof te)for(let r of e.items)this.drawPolyType(r,i)}static translate(e){switch(e){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}},Te.UseRunArrange=!0,Te.UseOptimizeSplit=!0,Te.LocalBestThread=4,Te.HandleDiff=!0,Te.OcTreeSplitStep=4,Te.PrintStart=new X(150,-200),Te),Rr=class ho{static getPolyTypeLine(e){let i=[];if(e instanceof St)for(let s of e.primitives)i.push(s);else if(e instanceof le)for(let s of e.items)if(s instanceof St)for(let r of s.primitives)i.push(r);else{let r=this.getPolyTypeLine(s);for(let n of r)i.push(n)}else if(e instanceof te)for(let s of e.items){let r=this.getPolyTypeLine(s);for(let n of r)i.push(n)}return i}static getPolyTypePolyLine(e){let i=[];if(e instanceof St)i.push(e);else if(e instanceof le)for(let s of e.items)if(s instanceof St)i.push(s);else{let r=this.getPolyTypePolyLine(s);for(let n of r)i.push(n)}else if(e instanceof te)for(let s of e.items){let r=this.getPolyTypePolyLine(s);for(let n of r)i.push(n)}return i}static getListBBox(e){if(e.length<=0)return;let i=new Fe;for(let s of e){let r=ho.getSingleBBox(s);i.ext1(r)}return i.build1()}static getSingleBBox(e){if(e instanceof Array){let i=new Fe,s=ho.getListBBox(e.slice(1));return i.ext1(s),i.build1()}else return e.bbox()}static doDrawRule(e,i=Ae.PrintStart){if(e.length<2)return[i,i,i];let s=5,r=10,n=e[0],a=Ae.translate(n),o=[],l=i.y,u=i.x,c=i.x;i=i.add(new X(0,-r));for(let d=1;d<e.length;d++){let p=e[d];if(p instanceof Array){i=i.add(new X(s,0));let m=this.doDrawRule(p,i);o.push(m[0]),m[1].x<=u&&(u=m[1].x),m[2].x>=c&&(c=m[2].x),i=new X(m[2].x+s,i.y)}else o.push(i.clone()),i.x<=u&&(u=i.x),i.x>=c&&(c=i.x),Ae.drawText(i,p.name),i=i.add(new X(s,0))}let h=0;for(let d of o)h+=d.x;let f=new X(h/o.length,i.y+r);Ae.drawText(f,"N:"+a);for(let d of o){let p=new G(d,f),m=new Array;m.push(p);let g=St.build1(io(m));Ae.drawPolyType(g,Lt.GREEN)}return[f,new X(u,l),new X(c,l)]}static drawRule(e,i=Ae.PrintStart,s=!1,r){Ae.clearDrawing(),this.doDrawRule(e,i),s&&this.doDrawRulePolygon(e,r),Ae.getDebug().draw()}static doDrawRulePolygon(e,i){let s=e[0];for(let r=1;r<e.length;r++){let n=e[r];if(n instanceof Array)this.doDrawRulePolygon(n,i);else{let a=i;s===2&&r===1&&(a=Lt.RED),n.name&&Ae.drawText(n.bbox().UL(),n.name,a),Ae.drawPolyType(n,a)}}}static IsCenterBBoxPointInPolygonType(e,i){let s=e.center();for(let r of i.items)if(r.getOutMostPolyline().getWindingNum(s))return!0;return!1}static KeepBBoxPolygonGroup(e,i){let s=i.bbox().intersection1(e);if(!s)return!1;for(let r of i.items)if(r.bbox().isIntersect(s)){for(let n of r.items)if(n.bbox().isIntersect(s)){for(let a of n.primitives)if(s.isIntersect(a.bbox()))return!0}}return!!this.IsCenterBBoxPointInPolygonType(e,i)}},dg=class Ws{static createNode(e,i,s){let r=e.UL(),n=e.width()/i,a=e.height()/i,o=~~(s/i),l=s-o*i,u=r.x+l*n,c=r.y-(o+1)*a,h=u+n,f=c+a;return new Ne(u,h,c,f)}static ocTreeSplitNode(e,i,s,r,n=2){if(e.length<=s)return e;let a=[],o=n**2,l=new Array(o),u=new Array(o);for(let d=0;d<o;d++)l[d]=new Array(e.length),u[d]=0;let c=i.UL(),h=i.width()/n,f=i.height()/n;for(let d of e){let p=r(d).center(),m=~~((p.x-c.x)/h),g=~~((c.y-p.y)/f)*n+m;try{l[g][u[g]]=d,u[g]+=1}catch{a.push(d)}}for(let d=0;d<l.length;d++){let p=u[d];if(p<=0)continue;let m=l[d].slice(0,p);if(m.length===e.length)return e;let g=Ws.createNode(i,n,d),b=Ws.ocTreeSplitNode(m,g,s,r,n);if(b.length===e.length)return e;a.push(b)}return a}static ocTreeSplitNodeMinIntersect(e,i,s,r){let n=[];if(e.length<=s)return e;let a=3,o=i.LL(),l=i.UR(),u=i.width()/(a+1),c=i.height()/(a+1),h=-(2**32),f=[],d=[];for(let p=1;p<=a;p++)for(let m=1;m<=a;m++){let g=o.x+u*p,b=o.y+c*m,y=[[],[],[],[]],E=new Array(4),_=new Array(4);_[0]=new Ne(o.x,g,b,l.y),_[1]=new Ne(g,l.x,b,l.y),_[2]=new Ne(o.x,g,o.y,b),_[3]=new Ne(g,l.x,o.y,b);for(let R of e){let L=r(R).center(),M=-1,B=-1;L.x===g?M=Math.random()>=.5?1:-1:L.x>g?M=1:L.x<g&&(M=-1),L.y===b?B=Math.random()>=.5?1:-1:L.y>b?B=1:L.y<b&&(B=-1),M===1&&B===1?y[1].push(R):M===1&&B===-1?y[3].push(R):M===-1&&B===-1?y[2].push(R):M===-1&&B===1&&y[0].push(R)}for(let R=0;R<4;R++){let L=y[R];if(L.length<=0)continue;let M=new Fe;for(let B of L)M.ext1(r(B));E[R]=M.build1()}let S=0,A=0;for(let R of E)R&&(S+=R.area());A=S;let w=(R,L)=>{if(!E[R]||!E[L])return 0;let M=E[R].intersection1(E[L]);return M?M.area():0};A-=w(0,1),A-=w(0,2),A-=w(0,3),A-=w(1,2),A-=w(1,3),A-=w(2,3),A/S>=h&&(f=y,d=_)}for(let p=0;p<f.length;p++){let m=f[p];if(m.length<=0)continue;let g=d[p],b;if(m.length===e.length?b=Ws.ocTreeSplitNode(m,g,s,r):b=Ws.ocTreeSplitNodeMinIntersect(m,g,s,r),b.length===e.length)return e;n.push(b)}return n}static ocTreeSplit(e,i,s,r){return Ws.ocTreeSplitNode(e,i,s,r,Ae.OcTreeSplitStep)}},pg=class tc{static simplifyRules(e,i){return Ae.UseOptimizeSplit&&(e=this.optimizeSplit(e,i)),e}static OcTreeOptimizeSplit(e){let i=e[0];if(i!==1||e.length<=Ae.LocalBestThread+1)return e;let s=e.slice(1),r=new Array(s.length);for(let u=1;u<e.length;u++)r[u-1]=u;let n=Rr.getListBBox(s),a=dg.ocTreeSplit(r,n,Ae.LocalBestThread,u=>{let c=e[u];return Rr.getSingleBBox(c)}),o=(u,c)=>{if(!(u.length<=0))for(let h of u)if(Array.isArray(h)){let f=[c[0]];o(h,f),c.push(f)}else{let f=e[h];c.push(f)}},l=[i];return o(a,l),l}static optimizeSplit(e,i){let s=e[0];if(s===2){if(Ae.HandleDiff){let n=e[1],a;if(Array.isArray(n)){let o=this.optimizeSplit(n,i);if(o.length<=1)return[2];a=po(o,i)}else a=po([2,n],i);if(e.length>3){let o;o=[1];for(let l=2;l<e.length;l++){let u=e[l];if(Array.isArray(u)){let c=Rr.getListBBox([...u.slice(1)]);Rr.KeepBBoxPolygonGroup(c,a)&&o.push(u)}else Rr.KeepBBoxPolygonGroup(u.bbox(),a)&&o.push(u)}return o.length<=1?[2,a]:(o=this.optimizeSplit(o,i),o.length>1?[2,a,...o.slice(1)]:[2,a])}else{let o=e[2];if(Array.isArray(o)&&o[0]===1&&o.length>2){let l=o.slice(1);return this.optimizeSplit([2,a,...l],i)}}}else if(e.slice(1).length>2){let n=e[1],a=e.slice(2),o=this.optimizeSplit([1,...a],i);return o.length>1?[2,n,...o.slice(1)]:n}}else if(s===1){if(e.length-1>Ae.LocalBestThread){let n=!1;for(let a=1;a<e.length;a++){let o=e[a];if(!Array.isArray(o)){n=!0;break}}n&&(e=tc.OcTreeOptimizeSplit(e))}}else if(s===0&&e.length<=2)return[0];let r=[s];for(let n=1;n<e.length;n++){let a=e[n];if(Array.isArray(a)){let o=this.optimizeSplit(a,i);if(o.length<=1)continue;r.push(o)}else r.push(a)}return r}},fg=(t=>(t[t.INTERSECT=0]="INTERSECT",t[t.UNION=1]="UNION",t[t.DIFF=2]="DIFF",t[t.XOR=3]="XOR",t))(fg||{});function xr(t){let e=t[0],i=[e];switch(e){case 0:for(let r=1;r<t.length;r++){let n=t[r];if(Array.isArray(n)&&(n=xr(n),!n))return null;i.push(n)}break;case 1:case 3:for(let r=1;r<t.length;r++){let n=t[r];Array.isArray(n)&&(n=xr(n),!n)||i.push(n)}break;case 2:let s=t[1];if(Array.isArray(s)&&(s=xr(s)),!s)return null;i.push(s);for(let r=2;r<t.length;r++){let n=t[r];Array.isArray(n)&&(n=xr(n),!n)||i.push(n)}break;default:throw new Error("not support boolean rule!")}return i.length===1?null:i}function za(t,e,i){return Array.isArray(t)?ec(t,e,i):t}function Xa(t,e,i,s,r=!0){if(r)for(;t.length>1;){let n,a=[];for(t.length%2===1?(a.push(t[0]),n=1):n=0;n<t.length;n+=2)a.push(e(t[n],t[n+1],i,s));t=a}else for(;t.length>1;){if(t.length===2)return e(t[0],t[1],i,s);t=[e(t[0],t[1],i,s),...t.slice(2)]}return t[0]}function ec(t,e,i,s=!0){let r=new Array(t.length-1);for(let n=1;n<t.length;n++)r[n-1]=za(t[n],e,i);switch(t[0]){case 0:return Xa(r,Or.intersect,e,i);case 1:return Xa(r,Or.union,e,i);case 2:let n=Xa(r.slice(1),Or.union,e,i);return n?Or.diff(r[0],n,e,i):r[0];case 3:let a=za(t[1],e,i);for(let o=2;o<t.length;o++)a=Or.xor(a,za(t[o],e,i),e,i);return a;default:throw new Error("not support boolean rule! "+t[0])}}function ic(t){let e=[t[0]];for(let i=1;i<t.length;i++){let s=t[i];if(Array.isArray(s)){let r=ic(s);Array.isArray(r)?r.length>1&&e.push(r):e.push(r)}else{let r=ia(s);r!==null&&e.push(te.build(r))}}return e}function mg(t,e){Ae.curBus=e,t=ic(t);let i;return Ae.UseRunArrange?i=pg.simplifyRules(t,e):i=xr(t),i.length<=1?new te([]):po(i,e)}function po(t,e,i=!0){if(!t||t.length===1)return new te([]);let s=t,r=new hg,n=[];function a(o){for(let l=1;l<o.length;l++){let u=o[l];Array.isArray(u)?a(u):n.push(u)}}return a(s),r.init(n),ec(s,r,e,i)}var Dn=new Error("list is empty"),wn=class{constructor(t,e){this.prev=null,this.next=null,this.parent=t,this.item=e}insertAfter(t){t.next=this.next,this.next=t,t.prev=this,t.next!==null&&(t.next.prev=t)}insertBefore(t){t.prev=this.prev,this.prev=t,t.next=this,t.prev!==null&&(t.prev.next=t)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(t){this.item=t}},gg=class{constructor(t){this._next=t}hasNext(){return this._next!==null}next(){let t=this._next;if(t!==null)return this._next=t.next,t.item;throw new Error("iterator is null")}},Eg=class{constructor(t){this._next=t}hasNext(){return this._next!==null}next(){let t=this._next;if(t!==null)return this._next=t.next,t;throw new Error("iterator is null")}},yg=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(t){return this.addLast(t)}push(t){return this.addLast(t)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let t=this.first;if(t===null)throw Dn;return this.remove(t),t.item}removeLast(){let t=this.last;if(t===null)throw Dn;return this.remove(t),t.item}addLast(t){if(this.first===null||this.last===null){let e=new wn(this,t);return this.first=e,this.last=e,this.cnt++,e}else return this.insertAfter(this.last,t)}addFirst(t){if(this.first===null||this.last===null){let e=new wn(this,t);return this.first=e,this.last=e,this.cnt++,e}else return this.insertBefore(this.first,t)}getFirst(){if(this.first===null)throw Dn;return this.first.item}getLast(){if(this.last===null)throw Dn;return this.last.item}insertAfter(t,e){let i=new wn(this,e);return t.insertAfter(i),t===this.last&&(this.last=i),this.cnt++,i}insertBefore(t,e){let i=new wn(this,e);return t.insertBefore(i),t===this.first&&(this.first=i),this.cnt++,i}remove(t){t.remove(),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new gg(this.first)}listIterator(){return new Eg(this.first)}toArray(){let t=new Array,e=this.first;for(;e!=null;)t.push(e.item),e=e.next;return t}},Un=class{constructor(t){this.inters=[],t&&(this.inters=t)}addInter(t){this.inters.push(t),t.group=this}findInter(t){let e=this.inters.find(i=>ut(i.coord,t.coord));return e&&this.inters.find(i=>i.side===t.side)&&t.visitSelf(),e}getOutInter(t){let e=this.inters.filter(i=>!i.getVisited());if(e.length!==0)return e.length===1?e[0]:e.reduce((i,s)=>{if(!i||i.side.getShape()===t)return s;if(s.side.getShape()===t)return i;let r=i.coord,n=ct(t,r),a=ct(i.side.getShape(),r),o=ct(s.side.getShape(),r);return n.dot(a)>n.dot(o)?i:s},void 0)}getEntryInter(){}},qa=0;function sc(t,e){let i=t.primitives[0];if(t.primitives.length===1&&i instanceof K&&Math.abs(i.sweepAngle)===360)return[t];let s=rn();qa++;let r,n=Dg(t);if(n.length===0)return[];let a=_g(n);if(qa===-1){r=new en(e);let c=r.initColor(Lt.BLUE);n.forEach(f=>c.addPt(f.getShape()));let h=r.initColor(Lt.GREEN);a.forEach(f=>h.addPoint(f.coord)),r.draw();debugger;throw new Error}if(a.length===0)return[St.build7(n.map(c=>c.getShape()))];Sg(a);let o=[],l=!1;try{Og(a,r)}catch(c){c.customType==="IS_OVERLAP"?(l=!0,o=new Pr().getUnion([t]).map(h=>h.items).flat(2)):console.error(c)}if(l)return o;let u=Ag(a);if(!u.length)return[St.build7(n.map(c=>c.getShape()))];if(o=Tg(u,r),o.length===0)return console.warn("=====deSelfIntersection=====",qa),[];if(r)throw o.forEach(c=>{r.initColor(Lt.WHITE).addPly(c),r.draw();debugger}),new Error;return Si.deSelfIntersection+=Zi(s),o}function Tg(t,e){let i=[];return t.forEach(s=>{let r=s;s.inters.forEach(n=>{if(n.getVisited())return;let a=[],o=[],l;if(e){debugger;let c=e.initColor(Lt.RED);l=h=>{a.push(h),c.addPt(a[a.length-1]),e.draw();debugger}}else l=c=>a.push(c);do{let c=function(m,g){Z.eq(m.distance2(g),0)||l(rc(d.getShape(),m,g))},h=o.findIndex(m=>m===n.group);if(h!==-1){let m=a.findIndex(y=>y===n.group),g=a.splice(m).filter(y=>!(y instanceof Un));if(g.length){let y=rs(St.build7(g));y&&i.push(y)}let b=a.filter(y=>!(y instanceof Un));if(n=o[h].getOutInter(b[b.length-1]),o.splice(h),!n)throw Error("interGroup not hav inter!!!2");continue}n.visitSelf(),o.push(n.group),a.push(n.group);let f=n.getIndex(),d=n.side,p=d.inters[f+1];for(;p!=null&&p.isInvalid||p&&p.group===n.group;)p=d.inters[p.getIndex()+1];if(p){c(n.coord,p.coord);let m=p.getBindedInter();if(n=m.getVisited()?m.group.getOutInter(m.side.getShape()):m,!n){if(p.group===r)break;throw new Error("interGroup not hav inter!!!3")}}else{for(c(n.coord,d.getEnd()),d=d.nextSide,n=null;;){for(let m of d.inters)if(!m.isInvalid){let g=m.group.getOutInter(d.getShape());if(!g){if(m.group===r){n=m;break}else if(m.getBindedInter().group===r){n=m.getBindedInter();break}continue}n=g;break}if(n)break;l(d.getShape()),d=d.nextSide}Z.eq(d.getEnd().distance2(n.coord),0)?l(d.getShape()):c(d.getStart(),n.coord)}}while(n.group!==r);let u=rs(St.build7(a.filter(c=>!(c instanceof Un))));u&&i.push(u)})}),i}function bg(t){return{next(){return t.hasNext()?{value:t.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function _g(t){let e=[],i=new yg;for(let s of t.slice().sort((r,n)=>r.bbox().minY-n.bbox().minY)){for(let r of bg(i.listIterator())){let n=r.item;if(n.bbox().maxY<s.bbox().minY)i.remove(r);else{let a=function(f,d){let p=new Mi(d,f,null);return f.inters.push(p),e.push(p),p},o=function(f,d){let p=f.getEnd(),m=new X(N[0],N[1]),g=new X(N[2],N[3]),b=p.distance2(m)>p.distance2(g)?m:g,y=f.prevSide;a(ut(y.getEnd(),b)?y:f,b).bind(a(d,b))},l=n.getShape(),u=s.getShape(),c=ti(l,u),h=c===4&&N[0]===N[2]&&N[1]===N[3];if(h&&(c-=2),n.nextSide===s)n.prevSide!==s&&c===4&&o(n,s);else if(n.prevSide===s)c===4&&o(s,n);else if(c!==0){let f=function(p,m){let g=p.prevSide;return a(ut(g.getEnd(),m)?g:p,m)},d=new X(N[0],N[1]);if(h&&!ut(d,n.prevSide.getEnd())&&!ut(d,s.prevSide.getEnd())&&ct(l,d).dot(ct(u,d))>0)continue;for(let p=0;p<c;p+=2){let m=new X(N[p],N[p+1]);f(n,m).bind(f(s,m))}}}}i.add(s)}return e.forEach(s=>{s.getIndex()===void 0&&s.side.sortInters()}),e}function Sg(t){t.forEach(e=>{let i=e.side.getEnd();if(e.isInvalid||!ut(e.coord,i))return;let s=e.side.inters,r=e.getBindedInter().side;for(let n=s.length-1;n>=0;n--){let a=s[n];if(!ut(a.coord,i))break;a!==e&&a.getBindedInter().side===r&&a.setIsInvalid()}})}function Ig(t){let e=new Vr(10);return t.forEach(i=>{i.isInvalid||e.add(i)}),e}function Ag(t){let e=[],i=Ig(t);return t.forEach(s=>{if(s.isInvalid||s.group)return;let r=i.search(s.bbox().extendOfSize(Z.eps)).filter(n=>!n.group);if(r.length){let n=new Set,a=new Un(r);r.forEach(o=>{o.group=a,n.has(o.side)&&o.visitSelf(),n.add(o.side)}),e.push(a)}}),e}function Og(t,e){t.forEach(i=>{if(i.isInvalid||i.dealed)return;let s=i.side,r=i.getBindedInter().side,n;ut(s.getEnd(),i.coord)&&ut(r.getEnd(),i.coord)?n=-1:ut(s.getEnd(),i.coord)?s.nextSide!==r&&(n=1,i=i.getBindedInter()):ut(r.getEnd(),i.coord)&&r.nextSide!==s&&(n=1),Rg(n,i,e),i.isDealed()})}function Rg(t,e,i){let s=e.getBindedInter(),r=e.side,n=s.side,a=r.getShape(),o=n.getShape(),l=1,u=!1;if(t===-1){if(Gs(a.reverse(),o.reverse())||Gs(r.nextSide.getShape(),n.nextSide.getShape())){let h=vi(r,r.nextSide,n,s,l,u,i);if(h.state===2){let d=new Error("info1.state === InState.IS_OVERLAP");throw d.customType="IS_OVERLAP",d}let f=vi(r,r.nextSide,n.nextSide,s,l,u,i);h.state===f.state&&c(h,f)}else if(!(Gs(a.reverse(),n.nextSide.getShape())||Gs(r.nextSide.getShape(),o.reverse()))){let h=ja(r,r.nextSide,n,!1,i);h===ja(r,r.nextSide,n.nextSide,!0,i)&&h!==ja(n,n.nextSide,r.nextSide,!0,i)&&e.setIsInvalid()}}else if(t===1){let h=function(f,d){return ct(f,d.start()).dot(ct(d,d.start()))>0};if(Gs(a.reverse(),o.reverse())||Gs(a,n.nextSide.getShape())){let f=Je(r,n,s,i,l,u,new Map);if(f.state===2){let p=new Error("info1.state === InState.IS_OVERLAP");throw p.customType="IS_OVERLAP",p}let d=Je(r,n.nextSide,s,i,l,u,new Map);f.state===d.state&&c(f,d)}else if(h(a.reverse(),o.reverse())&&h(a,n.nextSide.getShape())){let f=me(r,n,!1,i);f===me(r,n.nextSide,!0,i)&&f!==ws(n,n.nextSide,new sn(rc(a,e.coord,a.end()),i),!0,i)&&e.setIsInvalid()}}function c(h,f){h.inter.setIsInvalid(),f.inter.setIsInvalid(),e.setIsInvalid()}}function rc(t,e,i){if(t instanceof G||e.distance2(i)<1e-6)return new G(e,i);if(t instanceof K)return K.build2(t.center,e.angleD(t.center),i.angleD(t.center),t.rx,t.ry,t.sweep());if(t instanceof rt){let s=t.getPercent(e,ht),r=t.getPercent(i,ht);return t.clip(s)[1].clip((r-s)/(1-s))[0]}else throw new Error("not supported operation")}function Dg(t){let e=rs(t);if(!e)return[];let i=e.primitives.map(r=>new sn(r,null)),s=i[i.length-1];return i.forEach(r=>{s.connect(r),s=r}),i}var Fi,wg=(Fi=class{static clearData(e){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new en(e):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let e=this.drawDebug.initColor(Lt.WHITE);this.originalPrimitive.forEach(i=>e.addPt(i)),this.drawDebug.draw();debugger}for(let e=0;e<this.originalPrimitive.length;e+=1){let i=this.originalPrimitive[e];this.offsetPrimitive.push({index:e,offsetEdge:this.createOffsetEdge(i)})}if(this.drawDebug){let e=this.drawDebug.initColor(Lt.Golden);this.offsetPrimitive.forEach(i=>e.addPt(i.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let e=0;e<this.offsetPrimitive.length;e+=1)if(e===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[e],this.offsetPrimitive[0]);let i=this.rawOffsetPrimitive[0],s;i instanceof K?s=K.build4(this.offsetPrimitive[0].offsetEdge.start(),i.end(),i.center,i.rx,i.ry,i.sweep()):s=new G(this.offsetPrimitive[0].offsetEdge.start(),i.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(s)}else this.connectPrimitive(this.offsetPrimitive[e],this.offsetPrimitive[e+1]);else this.rawOffsetPrimitive=[]}static createCirclePrimitive(e,i){let s=e.width()*.5,r=e.height()*.5,n=Math.sqrt(s**2+r**2)+i;return[K.buildCircle(e.center(),n)]}static getExtendPolyLine(e,i,s=!0,r){var o,l;if(!((o=e==null?void 0:e.primitives)!=null&&o.length))return[];let n=rs(e);if(!((l=n==null?void 0:n.primitives)!=null&&l.length)){if(this.isExpansion){let u=[1],c=i*2;e.primitives.forEach(f=>u.push(f.stroke(c,1,0)));let h=mg(u,r);if(h.items.length!==1)throw new Error("group.items.length !== 1 ");return[h.items[0].items[0]]}return[]}if(e=n,this.clearData(r),this.originalPrimitive=e.primitives,this.isExpansion=i>0,this.offsetDistance=i,this.createRawOffsetEdge(),this.drawDebug){let u=this.drawDebug.initColor(Lt.BLUE);this.rawOffsetPrimitive.forEach(c=>u.addPt(c)),this.drawDebug.draw();debugger}let a=s?this.createClippingEdge(r):[St.build2(this.rawOffsetPrimitive)];if(this.drawDebug){let u=this.drawDebug.initColor(Lt.RED);a.forEach(c=>u.addPly(c)),this.drawDebug.draw();debugger}if(a.length&&(!this.isExpansion||this.isExpansion&&a.length>1)&&(a=this.getValidityPrimitive(a)),this.drawDebug){let u=this.drawDebug.initColor(Lt.GREEN);a.forEach(c=>u.addPly(c)),this.drawDebug.draw();debugger;throw new Error}return a}static getValidityPrimitive(e){let i=[],s=Math.abs(this.offsetDistance);for(let r=0;r<e.length;r+=1){let n=!0,a=e[r].primitives;t:for(let o=0;o<a.length;o+=1){let l=a[o],u;if(l instanceof K)u=l.midPoint;else if(l instanceof G)u=l.start();else throw new Error("not support!");for(let c=0;c<this.originalPrimitive.length;c+=1){let h=this.originalPrimitive[c],f;if(h instanceof K?f=this.pointArcClosest(u,h):f=um(u,h.start(),h.end()).d,s-f>.01){n=!1;break t}}}n&&i.push(e[r])}return i}static getInters(e){let i=[];for(let s=0;s<e;s+=2)i.push(new X(N[s],N[s+1]));return i}static pointArcClosest(e,i){let s=i.center;if(e.equals1(i.center))return i.rx;if(i.inArea(e,0)){let a=e.sub(s);return Math.abs(a.length()-i.rx)}let r=e.distance2(i.start()),n=e.distance2(i.end());return Z.less(r,n)?Math.sqrt(r):Math.sqrt(n)}static createClippingEdge(e){let i=[],s=[],r=sc(St.build2(this.rawOffsetPrimitive),e);r.forEach(a=>{let o=a.area(.01);i.push(o)});let n=Math.min(...i.filter(a=>a<0));for(let a=0;a<i.length;a+=1){let o=i[a];Z.eq(o,0)||(!this.isExpansion&&o<0||this.isExpansion&&(o<0&&i[a]===n||o>0))&&s.push(r[a])}return s}static createOffsetEdge(e){if(e instanceof K)return e.panDistance1(this.offsetDistance);if(e instanceof G)return e.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(e,i){e.offsetEdge instanceof G&&i.offsetEdge instanceof G?this.lineToLineConnect(e,i):e.offsetEdge instanceof K&&i.offsetEdge instanceof K?this.arcToArcConnect(e,i):e.offsetEdge instanceof G&&i.offsetEdge instanceof K?this.lineToArcConnect(e,i):this.arcToLineConnect(e,i)}static isFalseIntersection(e){return e>1||e<0}static lineToLineConnect(e,i){let s=e.offsetEdge,r=i.offsetEdge,n=i.index,a=this.originalPrimitive[n].start();if(s.isParallel(r))s.bbox().intersection1(r.bbox())?this.rawOffsetPrimitive.push(s):this.lineToLineUseArcToConnect(a,s,r);else{let o=this.getLineToLineT(s,r),l=o[0],u=o[1];if(this.isFalseIntersection(l)||this.isFalseIntersection(u))l>1&&this.isFalseIntersection(u)?this.lineToLineUseArcToConnect(a,s,r):this.useLineToConnect(s,r);else if(!this.isFalseIntersection(l)&&!this.isFalseIntersection(u)){let c=s.end().sub(s.start()),h=s.start().add(c.mul(l)),f=new G(s.start(),h);this.rawOffsetPrimitive.push(f);let d=new G(h,r.end());this.updateNextOffsetPrimitive(n,d)}}}static updateNextOffsetPrimitive(e,i){this.offsetPrimitive[e].offsetEdge=i}static useLineToConnect(e,i){this.rawOffsetPrimitive.push(e);let s=new G(e.end(),i.start());this.rawOffsetPrimitive.push(s)}static lineToLineUseArcToConnect(e,i,s){let r=this.getSweep(e,i),n=this.getSweepAngel(i.end(),s.start(),e,r);if(n===0){this.useLineToConnect(i,s);return}this.rawOffsetPrimitive.push(i);let a=K.build5(i.end(),s.start(),n);this.rawOffsetPrimitive.push(a)}static getSweep(e,i,s){let r=null,n=s||s===0?this.originalPrimitive[s]:i;if(n instanceof K){let a=n.center.sub(n.end()).normalize();n.isCCW?r=new X(a.y,-a.x):r=new X(-a.y,a.x)}else r=i.end().sub(i.start()).normalize();return e.sub(i.end()).normalize().cross(r)>0?0:1}static getLineToLineT(e,i){let s=e.end().sub(e.start()),r=i.end().sub(i.start()),n=s.cross(r),a=i.start().sub(e.start()),o=e.start().sub(i.start()),l=a.cross(r)/n,u=o.cross(s)/-n;return[l,u]}static lineToArcConnect(e,i){let s=e.offsetEdge,r=i.offsetEdge,n=e.index,a=i.index,o=this.getLineJoinArcScalarAndIntersectionNum(s,r),l=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(l,s,r,n);else if(o.intersectionNum===1){let u=o.points[0];this.lineAndArcConnectionDetail(s,r,o.t[0],u,l,n,a)}else if(o.intersectionNum===2){let u=o.points[0],c=o.points[1],h=u.distance2(l),f=c.distance2(l);this.lineAndArcConnectionDetail(s,r,h<f?o.t[0]:o.t[1],h<f?u:c,l,n,a)}}static lineAndArcConnectionDetail(e,i,s,r,n,a,o){let l=this.isTrueArcIntersection(i,r);if(!this.isFalseIntersection(s)&&l){let u=new G(e.start(),r);this.rawOffsetPrimitive.push(u);let c;!i.center.equals1(r)||i.sweepAngle>1e-4?(c=K.build4(r,i.end(),i.center,i.rx,i.ry,i.sweep()),c instanceof K&&c.sweepAngle===0&&(c=new G(c.start(),c.end()))):c=new G(i.center,r),this.updateNextOffsetPrimitive(o,c)}else l?this.useLineToConnect(e,i):this.lineAndArcUseArcConnect(n,e,i,a)}static lineAndArcUseArcConnect(e,i,s,r){let n=this.getSweep(e,i,r),a=this.getSweepAngel(i.end(),s.start(),e,n);if(a===0){this.useLineToConnect(i,s);return}let o=K.build5(i.end(),s.start(),a);this.rawOffsetPrimitive.push(i),this.rawOffsetPrimitive.push(o)}static arcToLineConnectionDetail(e,i,s,r,n,a,o){let l=this.isTrueArcIntersection(e,r);if(!this.isFalseIntersection(s)&&l){let u;e.center.equals1(r)?u=new G(e.center,r):Math.abs(e.sweepAngle)<1e-4?u=new G(e.start(),r):(u=K.build4(e.start(),r,e.center,e.rx,e.ry,e.sweep()),u instanceof K&&u.sweepAngle===0&&(u=new G(u.start(),u.end()))),this.rawOffsetPrimitive.push(u);let c=new G(r,i.end());this.updateNextOffsetPrimitive(o,c)}else l?this.useLineToConnect(e,i):this.lineAndArcUseArcConnect(n,e,i,a)}static isTrueArcIntersection(e,i){return ie(e,i)}static getSweepAngel(e,i,s,r){let n=e.angleD(s),a=i.angleD(s),o;return n===a?o=0:(n=mt.regularD(n),a=mt.regularD(a),r===1?a<=n&&(a+=360):a>=n&&(n+=360),o=a-n),o}static getLineJoinArcScalarAndIntersectionNum(e,i){let s={t:[],intersectionNum:0,points:[]},r=am(i,e);if(r){s.intersectionNum=r/2;for(let n=0;n<r-1;n+=2){let a=new X(N[n],N[n+1]);s.points.push(a),a.sub(e.start()).x<1e-4||a.sub(e.start()).y<1e-4?s.t.push(0):s.t.push(a.sub(e.start()).x/e.end().sub(e.start()).x)}}else s.intersectionNum=0;return s}static arcToLineConnect(e,i){let s=e.offsetEdge,r=i.offsetEdge,n=e.index,a=i.index,o=this.getLineJoinArcScalarAndIntersectionNum(r,s),l=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(l,s,r,n);else if(o.intersectionNum===1){let u=o.points[0];this.arcToLineConnectionDetail(s,r,o.t[0],u,l,n,a)}else if(o.intersectionNum===2){let u=o.points[0],c=o.points[1],h=u.distance2(l),f=c.distance2(l);this.arcToLineConnectionDetail(s,r,h<f?o.t[0]:o.t[1],h<f?u:c,l,n,a)}}static rxChangeStatus(e){return e===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(e,i){let s=e.offsetEdge,r=i.offsetEdge,n=ku(s,r);if(n){let a=this.getInters(n),o;if(a.length===2){let c=this.originalPrimitive[i.index].start(),h=a[0],f=a[1],d=h.distance2(c),p=f.distance2(c);d<p?o=h:o=f}else o=a[0];let l,u;o.equals1(s.center)?l=new G(s.center,o):Math.abs(s.sweepAngle)<1e-4?l=new G(s.start(),o):(l=K.build4(s.start(),o,s.center,s.rx,s.ry,s.sweep()),l instanceof K&&l.sweepAngle===0&&(l=new G(l.start(),l.end()))),this.rawOffsetPrimitive.push(l),o.equals1(r.center)?u=new G(o,r.center):Math.abs(r.sweepAngle)<1e-4?u=new G(o,r.end()):(u=K.build4(o,r.end(),r.center,r.rx,r.ry,r.sweep()),u instanceof K&&u.sweepAngle===0&&(u=new G(u.start(),u.end()))),this.updateNextOffsetPrimitive(i.index,u)}else{let a=this.originalPrimitive[e.index],o=this.originalPrimitive[i.index],l=this.rxChangeStatus(a.sweep()),u=this.rxChangeStatus(o.sweep()),c=this.originalPrimitive[i.index].start(),h=this.getSweep(c,s,e.index),f=Math.abs(this.offsetDistance),d=K.build2(c,l?a.endAngle():a.endAngle()+180,u?o.startAngle:o.startAngle+180,f,f,h);this.rawOffsetPrimitive.push(s),this.rawOffsetPrimitive.push(d)}}},Fi.originalPrimitive=[],Fi.offsetPrimitive=[],Fi.rawOffsetPrimitive=[],Fi.testI=0,Fi),Cg=class Mr extends Qr{constructor(e,i,s,r,n,a){if(super(),i<0||s<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=e,this.width=i,this.height=s,this.angle=r,this.isCCW=n,this.radius=Math.min(Math.max(a,0),i/2,s/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new X(this.radius,0).multiply3(Mt.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new X(0,-this.height/2).multiply3(Mt.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new X(this.width,-this.height/2).multiply3(Mt.rotateD(this.angle)))}extend(e){return new Mr(this.leftUpPoint.add(new X(-e,e).rotateD(X.ORIGIN,this.angle)),this.width+e*2,this.height+e*2,this.angle,this.isCCW,this.radius+e)}bbox(){let e=Mt.rotateD(this.angle),{leftUpPoint:i,width:s,height:r,radius:n}=this,a=i.add(new X(n,-n).multiply3(e)),o=i.add(new X(n,n-r).multiply3(e)),l=i.add(new X(s-n,-n).multiply3(e)),u=i.add(new X(s-n,n-r).multiply3(e));return new Ne(Math.min(a.x,o.x,l.x,u.x)-n,Math.max(a.x,o.x,l.x,u.x)+n,Math.min(a.y,o.y,l.y,u.y)-n,Math.max(a.y,o.y,l.y,u.y)+n)}toPolyline(){let e=[],{leftUpPoint:i,width:s,height:r,radius:n}=this;if(n===0){let o=X.ORIGIN,l=new X(s,0),u=new X(s,-r),c=new X(0,-r);e.push(new G(o,l),new G(l,u),new G(u,c),new G(c,o))}else{let o=new X(0,-n),l=new X(n,0),u=new X(s-n,0),c=new X(s,-n),h=new X(s,n-r),f=new X(s-n,-r),d=new X(n,-r),p=new X(0,n-r);e.push(K.build1(o,l,n,n,!1,0),new G(l,u),K.build1(u,c,n,n,!1,0),new G(c,h),K.build1(h,f,n,n,!1,0),new G(f,d),K.build1(d,p,n,n,!1,0),new G(p,o))}e=e.filter(o=>!o.start().equals1(o.end())),this.isCCW&&(e.forEach((o,l)=>e[l]=o.reverse()),e.reverse());let a=Mt.rotateD(this.angle).translate1(i);return St.build2(e.map(o=>o.multiply3(a)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(e){let i=this.leftUpPoint.multiply3(e),s=new X(this.width,0).multiply3(Mt.rotateD(this.angle)).multiply3(e),r=new X(0,-this.height).multiply3(Mt.rotateD(this.angle)).multiply3(e);return e.isMirrored()?new Mr(i,r.length(),s.length(),r.angleD(X.ORIGIN),this.isCCW===1?0:1,this.radius*s.length()/this.width):new Mr(i,s.length(),r.length(),s.angleD(X.ORIGIN),this.isCCW,this.radius*s.length()/this.width)}reverse(){return new Mr(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(e,i,s){let r=this.stroke1(e,i,s);if(r.length===1)return r[0];{let[n,a]=r;return St.build2(n.primitives.concat(new G(n.primitives[0].start(),a.primitives[0].start()),a.primitives,new G(a.primitives[0].start(),n.primitives[0].start())))}}stroke1(e,i,s){let r=s===this.isCCW?this:this.reverse(),n=e/2,a=Math.min(r.width,r.height)/2,o=r.extend(n).toPolyline();return a<=n?[o]:[o,r.extend(-n).toPolyline().reverse()]}points(e){let i=this.toPolyline(),s=[];return i.points(e,r=>s.push(r)),s}toBezier(){throw new Error("Method not implemented.")}},Ng=.01,le=class ai{static simplify(e){return e=rs(e),e?new ai([e]):null}static buildByStroke(e,i,s=1,r=Mo,n){if(e instanceof K&&(e.rx<i/2+Ng||Math.abs(e.sweepAngle)>180&&Z.lesseq(e.start().distance1(e.end()),i))){let o=sc(e.stroke(i,s,0),n);if(o.length===0)return null;if(o.length===1)return new ai(o);let l=[null],u=Number.POSITIVE_INFINITY;return o.forEach(c=>{let h=c.area(.1);h<0?h<u&&(l[0]=c,u=h):l.push(c)}),new ai(l)}else if(e instanceof Cg){let o=e.stroke1(i,s,0).map(l=>rs(l));return o[0]?o[1]?new ai(o):new ai([o[0]]):null}let a=e.stroke(i,s,0,r);return a?this.simplify(a):null}static buildCircle(e,i){return this.simplify(St.build7([K.buildCircle(e,i,0)]))}static buildRect(e){return this.simplify(e.toPolyline())}static buildBBox(e){return this.simplify(St.buildBBox(e,0))}constructor(e){this.items=e.slice()}multiply3(e){return new ai(this.items.map(i=>i.multiply3(e)))}bbox(){return this.items[0].bbox()}isEqual(e){return e instanceof ai?this.items.every(i=>e.items.some(s=>s.isEqual(i))):!1}getOutMostPolyline(){return this.items[0]}extend(e,i){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(e===0)return new te([this]);let s=this.items[0],r=[];for(let c of s.primitives)if(c instanceof G)r.push(c);else if(c instanceof K&&c.rx===c.ry)a(c);else if(c instanceof rt)n(c);else throw new Error("not support!");s=St.build7(r);function n(c){let h=c.points(.1);for(let f=0;f<h.length-1;f++){let d=h[f],p=h[f+1];r.push(new G(d,p))}}function a(c){if(Math.abs(c.sweepAngle)>270){let h=c.sweepAngle/2;a(K.build3(c.center,c.startAngle,h,c.rx,c.ry)),a(K.build3(c.center,c.startAngle+h,h,c.rx,c.ry))}else r.push(c)}let o=[],l=[];wg.getExtendPolyLine(s,e,!0,i).forEach(c=>{(c.area(.1)>0?l:o).push(c)});let u;if(o.length===1)l.forEach(c=>o.push(c)),u=new te([new ai(o)]);else if(o.length===0)console.warn("outlines.length === 0"),u=new te([]);else if(l.length===0)u=new te(o.map(c=>new ai([c])));else{let c=o.map(h=>[h]);l.forEach(h=>{let f=[],d=h.bbox();if(c.forEach(p=>{p[0].bbox().isContainsBBox1(d)&&f.push(p)}),f.length===1)f[0].push(h);else{if(f.length===0)throw new Error("inPlsArr.length === 0");for(let p of f.sort((m,g)=>m[0].bbox().area()-g[0].bbox().area()))if(p[0].getWindingNum(h.start())===-1){p.push(h);break}}}),u=new te(c.map(h=>new ai(h)))}return u}toPolylineGroup(){return new Bo(this.items)}};var Pg=(t=>(t[t.POLYGON=1]="POLYGON",t[t.POLYLINE=2]="POLYLINE",t[t.LINE=3]="LINE",t[t.ARC=4]="ARC",t[t.BEZIER2=5]="BEZIER2",t[t.BEZIER3=6]="BEZIER3",t[t.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",t[t.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",t[t.BOOLEAN_UNION=9]="BOOLEAN_UNION",t[t.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",t[t.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",t[t.LINES=12]="LINES",t[t.ARCS=13]="ARCS",t[t.BEZIER2S=14]="BEZIER2S",t[t.BEZIER3S=15]="BEZIER3S",t[t.CIRCLE_CW=16]="CIRCLE_CW",t[t.CIRCLE_CCW=17]="CIRCLE_CCW",t[t.POLYGON_GROUP=18]="POLYGON_GROUP",t))(Pg||{});var Lg=class{constructor(t){this.idx=-1,this.lst=t}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function vg(t){return new Lg(t)}function xg(t){return t===32||t===9||t===13||t===10}var Mg=class{constructor(){this._line=1,this._col=0}line(){return this._line}col(){return this._col}_feed(t){return t===10?(this._col=0,this._line++):this._col++,this.feed(t)}parse(t){let e=t.length;for(let i=0;i<e;i++){let s=t.charCodeAt(i);if(!this._feed(s))return this}return this.finish(),this}},Wa=class{static repeat(t,e){let i=new Array(e);for(;e-- >0;)i[e]=t;return i.join("")}static lpad(t,e,i){let s=i-t.length;return s>0?this.repeat(e,s)+t:t}},Bg=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.PERCENT=1]="PERCENT",t[t.LEFT_PAD0=2]="LEFT_PAD0",t))(Bg||{}),kg=/(\.?0+)$/,fo=class{static format(t,...e){return this.format1(t,e)}static format1(t,e){let i=this._format(t,e);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,t))}static _format(t,e){let i=[],s=0,r=0,n,a=0,o=0;for(let l=0;l<t.length;l++){let u=t.charAt(l),c=u.charCodeAt(0);switch(s){case 0:c===37?s=1:i.push(u);break;case 1:switch(c){case 100:if(n=e[r++],typeof n=="number")i.push(n.toFixed(0)),s=0;else return l;break;case 102:if(n=e[r++],typeof n=="number")i.push(n.toString()),s=0;else return l;break;case 120:if(n=e[r++],typeof n=="number")i.push((n|0).toString(16)),s=0;else return l;break;case 88:if(n=e[r++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),s=0;else return l;break;case 115:case 99:n=e[r++],i.push(n===null?"null":n.toString()),s=0;break;case 48:a=l+1,o=-1,s=2;break;case 37:i.push("%"),s=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 100:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Wa.lpad((n|0).toString(10),"0",h)),s=0;else return l}else return l;break;case 120:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Wa.lpad((n|0).toString(16),"0",h)),s=0;else return l}else return l;break;case 88:if(o>=a){let h=parseInt(t.substring(a,o+1));if(n=e[r++],typeof n=="number")i.push(Wa.lpad((n|0).toString(16).toUpperCase(),"0",h)),s=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(t,e){return t.length>=e.length?t.substring(0,e.length)===e:!1}static endsWith(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}static fmtNumber(t){return t.toFixed(5).replace(kg,"")}},Fg=(t=>(t[t.DEBUG=0]="DEBUG",t[t.INFO=1]="INFO",t[t.WARNING=2]="WARNING",t[t.ERROR=3]="ERROR",t[t.DUMMY=4]="DUMMY",t))(Fg||{});function Ug(t){switch(t){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var jg=(t,e)=>{t===3?console.error(...e):t===2?console.warn(...e):console.log(...e)},Gg=(t,e)=>[Ug(t)].concat(e),Ui,Hg=(Ui=class{static mix(...e){return new Ui(0,(i,s)=>{for(let r of e)r.write(i,s)},(i,s)=>s)}constructor(e,i=jg,s=Gg){this.level=e,this.writer=i,this.fmt=s}setLevel(e){this.level=e}prepend(e=null,i=null){let s=e===null?this.fmt:(n,a)=>(a=e(n,a),this.fmt(n,a)),r=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new Ui(this.level,r,s)}chain(e){return e.prepend(this.fmt.bind(this),this.writer.bind(this))}include(e){return this.level<=e}formatWrite(e,i,s){this.include(e)&&this.writer(e,this.fmt(e,[fo.format(i,...s)]))}write(e,i){this.include(e)&&this.writer(e,this.fmt(e,i))}write3(e,i,s){this.include(e)&&this.writer(e,this.fmt(e,[fo.format(i,...s)]))}debug3(e,...i){this.write3(0,e,i)}warning3(e,...i){this.write3(2,e,i)}debugFmt(e,...i){this.formatWrite(0,e,i)}debug(...e){this.write(0,e)}infoFmt(e,...i){this.formatWrite(1,e,i)}info(...e){this.write(1,e)}warningFmt(e,...i){this.formatWrite(2,e,i)}warning(...e){this.write(2,e)}errorFmt(e,...i){this.formatWrite(3,e,i)}error(...e){this.write(3,e)}},Ui.DUMMY=new Ui(4),Ui),Ja=500,eu=String.fromCharCode,Yg=class{constructor(){this.buffer=new Array}size(){return this.buffer.length}isEOF(){return!1}write(t){return this.buffer.push(t),1}writen1(t){return this.writen2(t,0,t.length)}writen2(t,e,i){let s=this.buffer;for(let r=0,n=e;r<i;r++,n++)s.push(t[n]);return i}writeAsync(t,e){e(this.write(t))}writenAsync1(t,e){e(this.writen1(t))}writenAsync2(t,e,i,s){s(this.writen2(t,e,i))}writeStr(t){let e=t.length,i=new Array(e);for(let s=0;s<e;s++)i[s]=t.charCodeAt(s);return this.writen1(i)}clear(){this.buffer.length=0}toString(){let t=this.buffer,e=t.length;if(e<=Ja)return eu.apply(null,t);{let i=new Array;for(let s=0;s<t.length;s+=Ja){let r=Math.min(e-s,Ja),n=eu.apply(null,t.slice(s,s+r));i.push(n)}return i.join("")}}},nc=(t=>(t[t.UNKNOW=0]="UNKNOW",t[t.NUMBER_INTEGER=1]="NUMBER_INTEGER",t[t.NUMBER_DECIMAL=2]="NUMBER_DECIMAL",t[t.NUMBER_E=3]="NUMBER_E",t[t.NUMBER_E_SIGNED=4]="NUMBER_E_SIGNED",t))(nc||{}),ac=(t=>(t[t.UNKNOW=0]="UNKNOW",t[t.MOVE_X=1]="MOVE_X",t[t.MOVE_Y=2]="MOVE_Y",t[t.LINE_X=3]="LINE_X",t[t.LINE_Y=4]="LINE_Y",t[t.HORIZONTAL_X=5]="HORIZONTAL_X",t[t.VERTICAL_Y=6]="VERTICAL_Y",t[t.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",t[t.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",t[t.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",t[t.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",t[t.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",t[t.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",t[t.ARC_RX=13]="ARC_RX",t[t.ARC_RY=14]="ARC_RY",t[t.ARC_ROTATION=15]="ARC_ROTATION",t[t.ARC_LARGE=16]="ARC_LARGE",t[t.ARC_SWEEP=17]="ARC_SWEEP",t[t.ARC_X=18]="ARC_X",t[t.ARC_Y=19]="ARC_Y",t[t.SMOOTH_CUBIC_BEZIER_X2=20]="SMOOTH_CUBIC_BEZIER_X2",t[t.SMOOTH_CUBIC_BEZIER_Y2=21]="SMOOTH_CUBIC_BEZIER_Y2",t[t.SMOOTH_CUBIC_BEZIER_X=22]="SMOOTH_CUBIC_BEZIER_X",t[t.SMOOTH_CUBIC_BEZIER_Y=23]="SMOOTH_CUBIC_BEZIER_Y",t[t.QUADRATIC_BEZIER_X1=24]="QUADRATIC_BEZIER_X1",t[t.QUADRATIC_BEZIER_Y1=25]="QUADRATIC_BEZIER_Y1",t[t.QUADRATIC_BEZIER_X=26]="QUADRATIC_BEZIER_X",t[t.QUADRATIC_BEZIER_Y=27]="QUADRATIC_BEZIER_Y",t))(ac||{});function Vg(t){return 97<=t&&t<=122||65<=t&&t<=90}function de(t){let e=parseFloat(t);if(isFinite(e))return e;throw new Error("expect number")}var iu=class extends Mg{constructor(t,e=!0,i=Hg.DUMMY){super(),this.buffer=new Yg,this.group=new Array,this.subPartStart=X.ORIGIN,this.curPoint=X.ORIGIN,this.lexState=0,this.parseState=0,this.isAbsolute=!1,this.isLargeArc=!1,this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=Number.NaN,this.y=Number.NaN,this.rx=Number.NaN,this.ry=Number.NaN,this.rotation=Number.NaN,this.sweep=$i.CCW,this.prevBezierCtrl2=null,this.logger=i,this.cb=t,this.yAxis=e?-1:1}on(t){return this.cb(t)}feed(t){switch(this.logger.include(0)&&this.logger.debug3("L: %c(%s)|%s",t,String.fromCharCode(t),nc[this.lexState]),this.lexState){case 0:return xg(t)?!0:48<=t&&t<=57||t===45||t===43?(this.pushBuffer(t),this.lexState=1,!0):t===46?(this.pushBuffer(t),this.lexState=2,!0):Vg(t)?this.feedS(String.fromCharCode(t)):(this.logger.warning3("unknow letter %c",t),!0);case 1:return 48<=t&&t<=57?(this.pushBuffer(t),!0):t===46?(this.pushBuffer(t),this.lexState=2,!0):t===101||t===69?(this.pushBuffer(t),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 2:return 48<=t&&t<=57?(this.pushBuffer(t),!0):t===101||t===69?(this.pushBuffer(t),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 3:return 48<=t&&t<=57?(this.pushBuffer(t),!0):t===45||t===43?(this.pushBuffer(t),this.lexState=4,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;case 4:return 48<=t&&t<=57?(this.pushBuffer(t),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(t)):!1;default:return!0}}finish(){this.feed(32),this.tryNotify()}feedS(t){switch(this.logger.include(0)&&this.logger.debug3("P: %s|%s|%s|%s",t,ac[this.parseState],this.curPoint,this.subPartStart),this.parseState){case 0:switch(t){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new G(this.curPoint,this.subPartStart));let s=this.tryNotify();return this.curPoint=this.subPartStart,s}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=20;break;case"s":this.isAbsolute=!1,this.parseState=20;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=24;break;case"q":this.isAbsolute=!1,this.parseState=24;break;default:this.logger.warning3("unknow %s",t)}return!0;case 1:let e=this.tryNotify();return this.x=de(t),this.parseState=2,e;case 2:{this.y=this.yAxis*de(t);let s;return this.isAbsolute?s=new X(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.curPoint=s,this.subPartStart=s,this.parseState=3,!0}case 3:return this.x=parseFloat(t),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(t));case 4:{this.y=this.yAxis*de(t);let s;return this.isAbsolute?s=new X(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.group.push(new G(this.curPoint,s)),this.curPoint=s,this.parseState=3,!0}case 5:if(this.x=parseFloat(t),isFinite(this.x)){let s;return this.isAbsolute?s=new X(this.x,this.curPoint.y):s=this.curPoint.add1(this.x,0),this.group.push(new G(this.curPoint,s)),this.curPoint=s,!0}else return this.parseState=0,this.feedS(t);case 6:if(this.y=parseFloat(t),isFinite(this.y)){this.y=this.yAxis*this.y;let s;return this.isAbsolute?s=new X(this.curPoint.x,this.y):s=this.curPoint.add1(0,this.y),this.group.push(new G(this.curPoint,s)),this.curPoint=s,!0}else return this.parseState=0,this.feedS(t);case 7:let i=parseFloat(t);return isFinite(i)?(this.x1=i,this.parseState=8,!0):(t!=="s"&&t!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(t));case 8:return this.y1=this.yAxis*de(t),this.parseState=9,!0;case 9:return this.x2=de(t),this.parseState=10,!0;case 10:return this.y2=this.yAxis*de(t),this.parseState=11,!0;case 11:return this.x=de(t),this.parseState=12,!0;case 12:{this.y=this.yAxis*de(t);let s,r,n;return this.isAbsolute?(s=new X(this.x1,this.y1),r=new X(this.x2,this.y2),n=new X(this.x,this.y)):(s=this.curPoint.add1(this.x1,this.y1),r=this.curPoint.add1(this.x2,this.y2),n=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=r,this.group.push(new rt([this.curPoint,s,r,n])),this.curPoint=n,this.parseState=7,!0}case 13:return this.rx=parseFloat(t),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(t));case 14:return this.ry=de(t),this.parseState=15,!0;case 15:return this.rotation=de(t),this.parseState=16,!0;case 16:return this.isLargeArc=de(t)===1,this.parseState=17,!0;case 17:return this.sweep=de(t)===1?$i.CW:$i.CCW,this.parseState=18,!0;case 18:return this.x=de(t),this.parseState=19,!0;case 19:{this.y=this.yAxis*de(t);let s;return this.isAbsolute?s=new X(this.x,this.y):s=this.curPoint.add1(this.x,this.y),this.rx&&this.ry&&this.group.push(K.build1(this.curPoint,s,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=s,this.parseState=13,!0}case 20:return this.x2=parseFloat(t),isFinite(this.x2)?(this.parseState=21,!0):(t!=="s"&&t!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(t));case 21:return this.y2=this.yAxis*de(t),this.parseState=22,!0;case 22:return this.x=de(t),this.parseState=23,!0;case 23:{this.y=this.yAxis*de(t);let s,r;this.isAbsolute?(s=new X(this.x2,this.y2),r=new X(this.x,this.y)):(s=this.curPoint.add1(this.x2,this.y2),r=this.curPoint.add1(this.x,this.y));let n;return this.prevBezierCtrl2?n=this.curPoint.add(this.curPoint.sub(this.prevBezierCtrl2)):n=this.curPoint,this.prevBezierCtrl2=s,this.group.push(new rt([this.curPoint,n,s,r])),this.curPoint=r,this.parseState=20,!0}case 24:return this.x1=parseFloat(t),isFinite(this.x1)?(this.parseState=25,!0):(t!=="s"&&t!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(t));case 25:return this.y1=this.yAxis*de(t),this.parseState=26,!0;case 26:return this.x=de(t),this.parseState=27,!0;case 27:{this.y=this.yAxis*de(t);let s,r;return this.isAbsolute?(s=new X(this.x1,this.y1),r=new X(this.x,this.y)):(s=this.curPoint.add1(this.x1,this.y1),r=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=s,this.group.push(new rt([this.curPoint,s,r])),this.curPoint=r,this.parseState=24,!0}default:return this.logger.warning3("unsupported parse state %s",this.parseState),!0}}pushBuffer(t){this.buffer.write(t)}getCleanBuffer(){let t=this.buffer.toString();return this.buffer.clear(),t}tryNotify(){if(this.group.length===0)return!0;{let t=St.build1(vg(this.group));return this.group.length=0,this.on(t)}}onException(t){throw t}},zg=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.ENC_LINE=1]="ENC_LINE",t[t.ENC_ARC=2]="ENC_ARC",t[t.ENC_CUBIC_BEZIER=3]="ENC_CUBIC_BEZIER",t[t.ENC_QUADRATIC_BEZIER=4]="ENC_QUADRATIC_BEZIER",t))(zg||{}),T_=fo.fmtNumber,su=class{constructor(t=!0){this.buffer=new Array,this.state=0,this.prev=null,this.yAxis=t?-1:1}encPl(t){for(let e of t.primitives)this.encPt(e);return this}encPt(t){if(t instanceof G)this.encLine1(t);else if(t instanceof K)this.encArc(t);else if(t instanceof rt)this.encBezier(t);else throw new Error("");return this}encBezier(t){if(t.controls.length===3){let e=t.controls[0],i=t.controls[1],s=t.controls[2];this.state===0?this.buffer.push("M",e.x,this.yAxis*e.y,"Q",i.x,this.yAxis*i.y,s.x,this.yAxis*s.y):e.equals1(this.prev)?this.state!==4?this.buffer.push("Q",i.x,this.yAxis*i.y,s.x,this.yAxis*s.y):this.buffer.push(i.x,this.yAxis*i.y,s.x,this.yAxis*s.y):this.buffer.push("L",e.x,this.yAxis*e.y,"Q",i.x,this.yAxis*i.y,s.x,this.yAxis*s.y),this.prev=s,this.state=4}else if(t.controls.length===4){let e=t.controls[0],i=t.controls[1],s=t.controls[2],r=t.controls[3];this.state===0?this.buffer.push("M",e.x,this.yAxis*e.y,"C",i.x,this.yAxis*i.y,s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):e.equals1(this.prev)?this.state!==3?this.buffer.push("C",i.x,this.yAxis*i.y,s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):this.buffer.push(i.x,this.yAxis*i.y,s.x,this.yAxis*s.y,r.x,this.yAxis*r.y):this.buffer.push("L",e.x,this.yAxis*e.y,"C",i.x,this.yAxis*i.y,s.x,this.yAxis*s.y,r.x,this.yAxis*r.y),this.prev=r,this.state=3}else throw new Error("only bezier has 3 or 4 control points supported");return this}encArc(t){let e=t.svgEnd;return this.state===0?this.buffer.push("M",t.start().x,this.yAxis*t.start().y,"A",t.rx,t.ry,0,t.isLarge()?1:0,t.sweep()===$i.CCW?0:1,e.x,this.yAxis*e.y):t.start().equals1(this.prev)?this.state!==2?this.buffer.push("A",t.rx,t.ry,0,t.isLarge()?1:0,t.sweep()===$i.CCW?0:1,e.x,this.yAxis*e.y):this.buffer.push(t.rx,t.ry,0,t.isLarge()?1:0,t.sweep()===$i.CCW?0:1,e.x,this.yAxis*e.y):this.buffer.push("L",t.start().x,this.yAxis*t.start().y,"A",t.rx,t.ry,0,t.isLarge()?1:0,t.sweep()===$i.CCW?0:1,e.x,this.yAxis*e.y),this.prev=e,this.state=2,this}encLine1(t){return this.encLine2(t.start(),t.end()),this}encLine2(t,e){return this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"L",e.x,this.yAxis*e.y):(this.state!==1&&this.buffer.push("L"),t.equals1(this.prev)?this.buffer.push(e.x,this.yAxis*e.y):this.buffer.push(t.x,this.yAxis*t.y,e.x,this.yAxis*e.y)),this.prev=e,this.state=1,this}close(t){return this.state!==0&&(t&&this.buffer.push("Z"),this.state=0,this.prev=null),this}fixNumber(t=4){return this.buffer.forEach((e,i,s)=>{typeof e=="number"&&(e|0)!==e&&(s[i]=+e.toFixed(t))}),this}toString(){return this.buffer.join(" ")}toArray(){return this.buffer}},Xg=class extends Lo{constructor(){super(),this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.zIndex=0,this.zIndexMap=new Map}onParseLine(t){let e=t[0];switch(e){case"DOCTYPE":this.parseDocType(t);break;case"HEAD":this.parseHead(t);break;case"LOCK":this.parseLock(t);break;case"HIDE":this.parseHide(t);break;case"INVISIBLE":this.parseInvisible(t);break;case"COVER":this.parseCover(t);break;case"TRN_CTRL":this.parseTrnCtrl(t);break;case"COMMENT":this.parseComment(t);break;case"FONT_CACHE":this.parseFontCache(t);break;case"TRANSFORM":this.parseTransform(t);break;case"GROUP":{let i=t[1];this.cache[e]||(this.cache[e]={errorIds:[]}),i!==null&&this.cache[e][i]?this.cache[e][i]=t:this.cache[e].errorIds.push(t);break}case"POLY":case"STRING":case"AUXLINE":case"DIMENSION":{this.zIndexMap.set(t[1],++this.zIndex);let i=Hr(t[1]);this.cache[e]||(this.cache[e]={errorIds:[]}),i!==null&&!this.cache[e][i]?this.cache[e][i]=t:this.cache[e].errorIds.push(t);break}default:console.warn("can not find hanlder with",t)}}getZIndex(t){var e;return(e=this.zIndexMap.get(t))!=null?e:null}secondParseLine(t){switch(t[0]){case"GROUP":this.parseGroup(t);break;case"POLY":this.parsePoly(t);break;case"STRING":this.parseString(t);break;case"AUXLINE":this.parseAuxLine(t);break;case"DIMENSION":this.parseDimension(t);break}}onParseEnd(){for(let t in this.cache){let e=this.cache[t],i=Object.keys(e).sort((r,n)=>Number(r)-Number(n)),s=0;for(let r of i){if(r==="errorIds")continue;let n=Number(r),a=n-s-1;a>=1&&this.onPHolder(t,a),s=n,this.secondParseLine(e[n])}e.errorIds.forEach(r=>this.secondParseLine(r))}this.clearCache()}clearCache(){this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.version=void 0}parseDocType(t){this.version=Number(t[2])}parseHead(t){this.version<2&&t[1]&&t[1].print==="AHead Side"&&(t[1].print="Ahead Side"),this.onCanvas(t[1])}parseGroup(t){this.onGroup(t[1],t[2],t[3],!!t[4],!!t[5])}parseLock(t){this.lockConfig.push(...t[1])}parseHide(t){this.hideConfig.push(...t[1])}parseInvisible(t){this.invisibleConfig.push(...t[1])}parseCover(t){this.coverConfig[t[1]]=t[2]}parseTrnCtrl(t){this.trnCtrlConfig[t[1]]={scope:t[2],trans_print:t[3],trans_white:t[4]}}parseComment(t){this.commentConfig[t[1]]=t[2]}matrix2svg(t){let[e,i,s,r,n,a,o,l,u]=t.data;return[e,i,r,n,o,l]}encPath(t){let e=new Array;return new iu(i=>(e.push(new su(!0).encPl(i).toArray().slice(1)),!0),!0).parse(t),e}parseRect(t){var _,S,A,w,R,L,M,B;let[,e,,i,s,r,n,a,o,,,l,u]=t,c=l[0],h=c[1],f=-c[2],d=c[1]+c[3],p=-c[2]+c[4],m=c[5],g=c[6],b=+c[7],y=+c[8],E=Mt.scale(d-h,p-f).rotateD(-b);y&&(E=E.multiply3(Mt.MIRROR_X)),E=E.translate(h,f),E=this.matrix2svg(E),E=this.encMatrix(E),this.onPoly(e,0,i,-b,s,r,n,a,o,!0,[["R",0,0,1,1,m,g,0,0]],!0,!0,this.lockConfig.some(q=>q===t[1]),this.hideConfig.some(q=>q===t[1]),this.invisibleConfig.some(q=>q===t[1]),i===1?1:(_=this.coverConfig[t[1]])!=null?_:null,u||((S=this.commentConfig[t[1]])!=null?S:null),i===2?3:(w=(A=this.trnCtrlConfig[t[1]])==null?void 0:A.scope)!=null?w:null,i===2?o:(L=(R=this.trnCtrlConfig[t[1]])==null?void 0:R.trans_print)!=null?L:null,i===2?1-o:(B=(M=this.trnCtrlConfig[t[1]])==null?void 0:M.trans_white)!=null?B:null,E!=null?E:null)}parseObj(t){var R,L,M,B,q,H,V,W;let[,e,,i,s,r,n,a,o,,,l,u]=t,[c,h,f,d,p,m,g,b,y]=l[0],E=Mt.rotateD(b);y&&(E=E.multiply3(Mt.MIRROR_X));let _;y?_=new G(new X(0,0),new X(0,-p)).multiply3(E):_=new G(new X(0,0),new X(d,0)).multiply3(E);let S=_.end().angleD(_.start()),A=y===1;d=y===1?p:d,p=y===1?d:p;let w=Mt.scale(d,p).rotateD(-S);A&&(w=w.multiply3(Mt.MIRROR_X)),w=w.translate(h,-f),w=this.matrix2svg(w),w=this.encMatrix(w),this.onPoly(e,0,i,-S,s,r,n,a,o,!0,[["R",0,0,1,1,0,0,0,0]],!1,!1,this.lockConfig.some(v=>v===t[1]),this.hideConfig.some(v=>v===t[1]),this.invisibleConfig.some(v=>v===t[1]),i===1?1:(R=this.coverConfig[t[1]])!=null?R:null,u||((L=this.commentConfig[t[1]])!=null?L:null),i===2?3:(B=(M=this.trnCtrlConfig[t[1]])==null?void 0:M.scope)!=null?B:null,i===2?o:(H=(q=this.trnCtrlConfig[t[1]])==null?void 0:q.trans_print)!=null?H:null,i===2?1-o:(W=(V=this.trnCtrlConfig[t[1]])==null?void 0:V.trans_white)!=null?W:null,w!=null?w:null)}parseEllipse(t){var y,E,_,S,A,w,R,L;let[,e,,i,s,r,n,a,o,,,l,u]=t,c=l[0],h=c[1],f=-c[2],d=c[3],p=c[4],m=+c[5],g=+c[6],b=Mt.scale(d,p).rotateD(-m);g&&(b=b.multiply3(Mt.MIRROR_X)),b=b.translate(h,f),b=this.matrix2svg(b),b=this.encMatrix(b),this.onPoly(e,0,i,-m,s,r,n,a,o,!0,[["ELLIPSE",0,0,1,1,0,0]],!0,!0,this.lockConfig.some(M=>M===t[1]),this.hideConfig.some(M=>M===t[1]),this.invisibleConfig.some(M=>M===t[1]),i===1?1:(y=this.coverConfig[t[1]])!=null?y:null,u||((E=this.commentConfig[t[1]])!=null?E:null),i===2?3:(S=(_=this.trnCtrlConfig[t[1]])==null?void 0:_.scope)!=null?S:null,i===2?o:(w=(A=this.trnCtrlConfig[t[1]])==null?void 0:A.trans_print)!=null?w:null,i===2?1-o:(L=(R=this.trnCtrlConfig[t[1]])==null?void 0:R.trans_white)!=null?L:null,b!=null?b:null)}parsePolyGroup(t){var d,p,m,g,b,y,E,_;let[,e,,i,s,r,n,a,o,,,l,u]=t,c=!0,h=!0,f=this.decMultiPoly(l).d;this.onPoly(e,0,i,0,s,r,n,a,o,!0,this.encPath(f),c,h,this.lockConfig.some(S=>S===t[1]),this.hideConfig.some(S=>S===t[1]),this.invisibleConfig.some(S=>S===t[1]),i===1?1:(d=this.coverConfig[t[1]])!=null?d:null,u||((p=this.commentConfig[t[1]])!=null?p:null),i===2?3:(g=(m=this.trnCtrlConfig[t[1]])==null?void 0:m.scope)!=null?g:null,i===2?o:(y=(b=this.trnCtrlConfig[t[1]])==null?void 0:b.trans_print)!=null?y:null,i===2?1-o:(_=(E=this.trnCtrlConfig[t[1]])==null?void 0:E.trans_white)!=null?_:null,null)}parsePoly(t){var e,i,s,r,n,a,o,l,u,c;if(this.version<2)if(t[11].length===1)switch(t[11][0][0]){case"R":{let h=t[7];return h.startsWith("data:")||h.startsWith("blob:")?this.parseObj(t):this.parseRect(t)}case"ELLIPSE":return this.parseEllipse(t);default:return this.parsePolyGroup(t)}else return this.parsePolyGroup(t);else this.onPoly(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],!!(t[12]||t[12]===void 0),!!(t[13]||t[13]===void 0),this.lockConfig.some(h=>h===t[1]),this.hideConfig.some(h=>h===t[1]),this.invisibleConfig.some(h=>h===t[1]),(e=this.coverConfig[t[1]])!=null?e:null,(i=this.commentConfig[t[1]])!=null?i:null,(r=(s=this.trnCtrlConfig[t[1]])==null?void 0:s.scope)!=null?r:null,(a=(n=this.trnCtrlConfig[t[1]])==null?void 0:n.trans_print)!=null?a:null,(l=(o=this.trnCtrlConfig[t[1]])==null?void 0:o.trans_white)!=null?l:null,(c=(u=this.transformConfig[t[1]])==null?void 0:u.matrix)!=null?c:null)}decMultiPoly(t){let e=new Fe,i=t.map(s=>{let r="";return new iu(n=>(e.ext1(n.bbox()),r=new su().encPl(n).toString(),!1),!1).parse("M"+s.join(" ")),r}).join(" ");return{bbox:e.build(),d:i}}encMatrix(t){let[e,i,s,r,n,a]=t,o=new Mt([e,i,0,s,r,0,n,a,1]);o=Mt.MIRROR_Y.multiply3(o).multiply3(Mt.MIRROR_Y);let[l,u,c,h,f,d,p,m,g]=o.data;return[l,h,p,u,f,m]}parseString(t){var e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E;if(this.version<2){let[,_,S,A,w,R,L,M,B,q,H,V,W,v,j,O,x,k,F,P]=t;R=_e(R);let z=B;M=M===1,W=W===1,v=v===1,j=j===1;let Y=-(O[15]/3|0)+2,tt=O%3;F=F||1,P=P||1;let it=this.fontCache[t[1]],{bbox:nt,d:at}=this.decMultiPoly(it),pt=nt.width(),ft=nt.height();ft=ft||0,pt=pt||0;let xt=0;switch(tt){case 1:xt=-pt/2;break;case 2:xt=-pt;break}let gt=0;switch(Y){case 1:gt=ft/2;break;case 0:gt=ft;break}let bt=Mt.translate(xt,gt).scale(F,P).rotateD(-L);M&&(bt=bt.multiply3(Mt.MIRROR_X)),bt=bt.translate(w,R);let Wt=this.matrix2svg(bt),ae=this.encMatrix(Wt);this.onString(_,S,A,L,z,q,H,V,W,v,j,((-Y||0)+2)*3+(tt||0),x,k,this.lockConfig.some(ce=>ce===t[1]),this.hideConfig.some(ce=>ce===t[1]),this.invisibleConfig.some(ce=>ce===t[1]),A===1?1:(e=this.coverConfig[t[1]])!=null?e:null,(i=this.commentConfig[t[1]])!=null?i:null,A===2?3:(r=(s=this.trnCtrlConfig[t[1]])==null?void 0:s.scope)!=null?r:null,A===2?k:(a=(n=this.trnCtrlConfig[t[1]])==null?void 0:n.trans_print)!=null?a:null,A===2?1-k:(l=(o=this.trnCtrlConfig[t[1]])==null?void 0:o.trans_white)!=null?l:null,ae,!!ae,this.encPath(at))}else this.onString(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9]===1,t[10]===1,t[11]===1,t[12],t[13],t[14],this.lockConfig.some(_=>_===t[1]),this.hideConfig.some(_=>_===t[1]),this.invisibleConfig.some(_=>_===t[1]),(u=this.coverConfig[t[1]])!=null?u:null,(c=this.commentConfig[t[1]])!=null?c:null,(f=(h=this.trnCtrlConfig[t[1]])==null?void 0:h.scope)!=null?f:null,(p=(d=this.trnCtrlConfig[t[1]])==null?void 0:d.trans_print)!=null?p:null,(g=(m=this.trnCtrlConfig[t[1]])==null?void 0:m.trans_white)!=null?g:null,(y=(b=this.transformConfig[t[1]])==null?void 0:b.matrix)!=null?y:null,!!((E=this.transformConfig[t[1]])!=null&&E.matrix),this.fontCache[t[1]])}parseFontCache(t){this.fontCache[t[1]]=t[2]}parseDimension(t){var e,i,s,r,n,a,o,l,u,c,h,f;this.onDimension(t[1],t[2],t[3],(e=t[4])!=null?e:null,t[5],t[6],t[7],t[8],this.lockConfig.some(d=>d===t[1]),this.hideConfig.some(d=>d===t[1]),this.invisibleConfig.some(d=>d===t[1]),(i=this.coverConfig[t[1]])!=null?i:null,(s=this.commentConfig[t[1]])!=null?s:null,(n=(r=this.trnCtrlConfig[t[1]])==null?void 0:r.scope)!=null?n:null,(o=(a=this.trnCtrlConfig[t[1]])==null?void 0:a.trans_print)!=null?o:null,(u=(l=this.trnCtrlConfig[t[1]])==null?void 0:l.trans_white)!=null?u:null,(h=(c=this.transformConfig[t[1]])==null?void 0:c.matrix)!=null?h:null,!!((f=this.transformConfig[t[1]])!=null&&f.matrix))}parseTransform(t){this.transformConfig[t[1]]={matrix:t[2],strokes:!!t[3]}}parseAuxLine(t){var e,i,s,r,n,a,o,l,u,c,h;this.onAuxLine(t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],this.lockConfig.some(f=>f===t[1]),this.hideConfig.some(f=>f===t[1]),this.invisibleConfig.some(f=>f===t[1]),(e=this.coverConfig[t[1]])!=null?e:null,(i=this.commentConfig[t[1]])!=null?i:null,(r=(s=this.trnCtrlConfig[t[1]])==null?void 0:s.scope)!=null?r:null,(a=(n=this.trnCtrlConfig[t[1]])==null?void 0:n.trans_print)!=null?a:null,(l=(o=this.trnCtrlConfig[t[1]])==null?void 0:o.trans_white)!=null?l:null,(c=(u=this.transformConfig[t[1]])==null?void 0:u.matrix)!=null?c:null,!!((h=this.transformConfig[t[1]])!=null&&h.matrix))}},qg=class extends Lo{constructor(t={},e=[]){super(),this.symbolPartIds=t,this.device=e,this.defaultPartId="pid8a0e77bacb214e",this.curPart="",this.onlyPart="",this.partIdMap={},this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.zIndex=0,this.zIndexMap=new Map,this.cache={},this.errorIds={},this.tableCell={},this.hasPart=!1,this.components={},this.busEntryMap={},this.defaultLineStyle={strokeColor:null,strokeStyle:null,fillColor:null,strokeWidth:null,fillStyle:null},this.defaultFontStyle={color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:null,underline:null,italic:null,fontWeight:null,hAlign:null,vAlign:null}}getZIndex(t){var e;return(e=this.zIndexMap.get(t))!=null?e:null}transPinAttrKey(t){switch(t){case"NUMBER":{t="Pin Number";break}case"NAME":{t="Pin Name";break}}return t}transFontStyle(t){return{color:t.color,fillColor:t.fillColor,fontFamily:t.fontFamily,fontSize:t.fontSize,strikeout:t.strikeout,underline:t.underline,italic:t.italic,fontWeight:t.fontWeight,align:this.transAlign(t.vAlign,t.hAlign)}}transTableFontStyle(t){return{color:t.color,fillColor:t.fillColor,fontFamily:t.fontFamily,fontSize:t.fontSize,strikeout:t.strikeout,underline:t.underline,italic:t.italic,fontWeight:t.fontWeight,vAlign:this.transVAlign(t.vAlign),hAlign:this.transHAlign(t.hAlign)}}transVAlign(t){switch(t=t&&Number(t),t){case 0:return"TOP";case 1:return"MIDDLE";case 2:return"BOTTOM";default:return null}}transHAlign(t){switch(t=t&&Number(t),t){case 0:return"LEFT";case 1:return"CENTER";case 2:return"RIGHT";default:return null}}transAlign(t,e){if(t=t&&Number(t),e=e&&Number(e),e===0)switch(t){case 0:return"LEFT_TOP";case 1:return"LEFT_MIDDLE";case 2:return"LEFT_BOTTOM";default:return null}if(e===1)switch(t){case 0:return"CENTER_TOP";case 1:return"CENTER_MIDDLE";case 2:return"CENTER_BOTTOM";default:return null}if(e===2)switch(t){case 0:return"RIGHT_TOP";case 1:return"RIGHT_MIDDLE";case 2:return"RIGHT_BOTTOM";default:return null}return null}transStrokeStyle(t){switch(t=t&&Number(t),t){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transFillStyle(t){switch(t=t&&Number(t),t){case 0:return"NONE";case 1:return"SOLID";case 2:return"GRID";case 3:return"HORIZONTAL_LINE";case 4:return"VERTICAL_LINE";case 5:return"RHOMBIC";case 6:return"LEFT_SLASH_LINE";case 7:return"RIGHT_SLASH_LINE";default:return null}}transPinShape(t){switch(t=t&&Number(t),t){case 0:return"NONE";case 1:return"CLOCK";case 2:return"INVERTED";case 3:return"INVERTED_CLOCK";default:return"NONE"}}onParseLine(t){var i,s;let e=t[0];switch(e){case"DOCTYPE":this.parseDocType(t);break;case"HEAD":this.parseHead(t);break;case"GROUP":this.parseGroup(t);break;case"FONTSTYLE":this.parseFontStyle(t);break;case"LINESTYLE":this.parseLineStyle(t);break;case"TERM":break;case"PART":this.hasPart=!0,this.parsePart(t);break;case"TABEL_CELL":this.parseTableCell(t);break;case"BUSENTRY":{this.parseBusEntry(t);break}case"WIRE":case"BUS":case"TEXT":case"POLY":case"CIRCLE":case"ARC":case"RECT":case"PIN":case"OBJ":case"COMPONENT":case"ELLIPSE":case"BEZIER":case"TABLE":{this.zIndexMap.set(t[1],++this.zIndex);let r=Hr(t[1]);this.cache[e]||(this.cache[e]={}),r!==null&&!this.cache[e][r]?this.cache[e][r]={part:this.curPart,value:t}:(this.errorIds[e]||(this.errorIds[e]=[]),this.errorIds[e].push({part:this.curPart,value:t}));break}case"ATTR":{this.zIndexMap.set(t[1],++this.zIndex),t[3]==="Symbol"&&(this.components[t[2]]||(this.components[t[2]]={symbol:"",device:""}),this.components[t[2]].symbol=t[4]),t[3]==="Device"&&(this.components[t[3]]||(this.components[t[3]]={symbol:"",device:""}),this.components[t[3]].device=t[4]);let r=Object.keys(((i=this.cache)==null?void 0:i.COMPONENT)||{}).find(o=>this.cache.COMPONENT[o].value[1]===t[2]);if(r){let o=this.cache.COMPONENT[r];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:t});break}let n=Object.keys(((s=this.cache)==null?void 0:s.PIN)||{}).find(o=>this.cache.PIN[o].value[1]===t[2]);if(n){let o=this.cache.PIN[n];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:t});break}let a=Hr(t[1]);this.cache[e]||(this.cache[e]={}),a!==null?this.cache[e][a]||(this.cache[e][a]={part:this.curPart,value:t}):(this.errorIds[e]||(this.errorIds[e]=[]),this.errorIds[e].push({part:this.curPart,value:t}));break}default:console.warn("can not find hanlder with",t)}}secondParseLine(t){switch(t[0]){case"DOCTYPE":case"HEAD":case"GROUP":case"FONTSTYLE":case"LINESTYLE":break;case"ATTR":this.parseAttr(t);break;case"WIRE":this.parseWire(t);break;case"BUS":this.parseBus(t);break;case"TEXT":this.parseText(t);break;case"POLY":this.parsePoly(t);break;case"CIRCLE":this.parseCircle(t);break;case"ARC":this.parseArc(t);break;case"BUSENTRY":break;case"RECT":this.parseRect(t);break;case"PIN":this.parsePin(t);break;case"OBJ":this.parseObj(t);break;case"COMPONENT":this.parseComponent(t);break;case"ELLIPSE":this.parseEllipse(t);break;case"BEZIER":this.parseBezier(t);break;case"TABLE":this.parseTable(t);break;case"TABEL_CELL":break}}onParseEnd(){this.docType==="SYMBOL"&&!this.hasPart&&(this.curPart=this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[""]=this.curPart,this.onPart(this.curPart,{title:""}));for(let t in this.cache){let e=this.cache[t],i=Object.keys(e).sort((r,n)=>Number(r)-Number(n)),s=0;for(let r of i){let n=Number(r),a=n-s-1;a>=1&&this.onPHolder(t,a),s=n,this.curPart=this.hasPart?e[n].part||this.onlyPart:this.curPart,this.secondParseLine(e[n].value),e[n].attr&&e[n].attr.forEach(o=>{this.curPart=this.hasPart?o.part||this.onlyPart:this.curPart,this.secondParseLine(o.value)})}if(this.errorIds[t])for(let r of this.errorIds[t])this.curPart=this.hasPart?r.part||this.onlyPart:this.curPart,this.secondParseLine(r.value)}this.clearCache()}clearCache(){this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.cache={},this.errorIds={},this.curPart="",this.components={},this.tableCell={},this.hasPart=!1,this.version=void 0,this.docType=void 0}parseDocType(t){this.docType=t[1];let e=parseFloat(t[2]);this.version=e}parseHead(t){this.onCanvas(t[1])}parseFontStyle(t){this.fontStyleIndex[t[1]]={color:t[3]===""?"none":t[3],fillColor:t[2],fontFamily:t[4],fontSize:t[5],strikeout:t[9]===null?null:t[9]===1,underline:t[8]===null?null:t[8]===1,italic:t[6]===null?null:t[6]===1,fontWeight:t[7]===null?null:t[7]===1,vAlign:t[10],hAlign:t[11]}}parseLineStyle(t){this.lineStyleIndex[t[1]]={strokeColor:t[2],strokeStyle:this.transStrokeStyle(t[3]),fillColor:t[4]===""?"none":t[4],strokeWidth:t[5],fillStyle:this.transFillStyle(t[6])}}getGroupId(t){var i;let e=this;for(let s in e.groupIndex)if((i=e.groupIndex[s])!=null&&i.includes(t))return s;return""}parseBezier(t){let e=this.lineStyleIndex[t[3]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=this.getGroupId(t[1]);for(let s=0;s<t[2].length;s+=2)t[2][s+1]=_e(t[2][s+1]);this.onBezier(t[1],this.curPart,i,!!t[4],t[2],e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parseGroup(t){this.groupIndex[t[1]]=t[4]||[],this.onGroup(t[1],t[2]||"",t[3]||"")}parseBus(t){let e=this.lineStyleIndex[t[3]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=t[2]||[],s=this.getGroupId(t[1]);this.onBus(t[1],this.curPart,s,!!t[4],i,e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle,this.busEntryMap[t[1]]||{})}parseWire(t){let e=this.lineStyleIndex[t[3]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=t[2]||[],s=this.getGroupId(t[1]);this.onWire(t[1],this.curPart,s,!!t[4],i,e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parseText(t){let e=this.fontStyleIndex[t[6]];e||(e=this.defaultFontStyle,console.warn("font not found",t));let i=this.transFontStyle(e),s=this.getGroupId(t[1]);this.onText(t[1],this.curPart,s,!!t[7],t[2],t[3],t[4],t[5],i.color,i.fillColor,i.fontFamily,i.fontSize,i.strikeout,i.underline,i.italic,i.fontWeight,i.align)}parsePoly(t){let e=this.lineStyleIndex[t[4]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=this.getGroupId(t[1]);this.onPoly(t[1],this.curPart,i,!!t[5],t[2]||[],!!t[3],e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parseCircle(t){let e=this.lineStyleIndex[t[5]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=this.getGroupId(t[1]);this.onCircle(t[1],this.curPart,i,!!t[6],t[2],t[3],t[4],e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parseArc(t){let e=this.lineStyleIndex[t[8]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=this.getGroupId(t[1]);this.onArc(t[1],this.curPart,i,!!t[9],t[2],t[3],t[4],t[5],t[6],t[7],e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parseBusEntry(t){let e=t[2],i={groupId:this.getGroupId(t[1]),locked:!1,zIndex:++this.zIndex,order:t[3],pointX:t[4],pointY:_e(t[5]),rotation:t[6]};this.busEntryMap[e]||(this.busEntryMap[e]={}),this.busEntryMap[e][t[1]]=i}parseRect(t){let e=this.lineStyleIndex[t[9]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=this.getGroupId(t[1]);this.onRect(t[1],this.curPart,i,!!t[10],t[2],t[3],t[4],t[5],t[6],t[7],t[8],e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parsePin(t){let e=this.getGroupId(t[1]);this.onPin(t[1],this.curPart,e,!!t[10],!!t[2],t[3],t[4],t[5],t[6],t[7],t[8],this.transPinShape(t[9]))}parseObj(t){let e=this.getGroupId(t[1]);this.version>=1.1?this.onObj(t[1],this.curPart,e,!!t[10],t[2],t[3],t[4],t[5],t[6],t[7],!!t[8],t[9]):this.onObj(t[1],this.curPart,e,!!t[10],t[2],t[4],t[5],t[6],t[7],t[8],!1,`data:${t[3]},${t[9]}`)}parseComponent(t){var r,n,a;let e=this.getGroupId(t[1]),i=t[2],s=this.components[t[1]];if(s){if(s.symbol){let o=this.symbolPartIds[s.symbol];o&&(i=o[t[2]]||t[2]||o[(r=Object.keys(o))==null?void 0:r[0]]||"")}else if(s.device){let o=this.device.find(u=>u.uuid===s.device),l=o?this.symbolPartIds[(n=o==null?void 0:o.attributes)==null?void 0:n.Symbol]:null;l&&(i=l[t[2]]||t[2]||l[(a=Object.keys(l))==null?void 0:a[0]]||"")}}this.onComponent(t[1],!!t[8],i,e,t[3],t[4],t[5],t[6]===1,t[7])}parseEllipse(t){let e=this.lineStyleIndex[t[7]];e||(e=this.defaultLineStyle,console.warn("style not found",t));let i=this.getGroupId(t[1]);this.onEllipse(t[1],this.curPart,i,!!t[8],t[2],t[3],t[4],t[5],t[6],e.strokeColor,e.strokeStyle,e.fillColor,e.strokeWidth,e.fillStyle)}parseTable(t){let e=this.getGroupId(t[1]);this.onTable(t[1],this.curPart,e,t[2],t[3],t[4],t[5],t[6],t[7],t[8],this.tableCell[t[1]]||[])}parseTableCell(t){let e=this.lineStyleIndex[t[8]],i=this.lineStyleIndex[t[9]],s=this.lineStyleIndex[t[10]],r=this.lineStyleIndex[t[11]],n=this.fontStyleIndex[t[12]],a=Object.assign({},n);a.color=n.fillColor,a.fillColor=n.color,(!e||!i||!s||!r||!a)&&console.warn("style not found",t);let o={id:t[1],value:t[3],rowIndex:t[4],columnIndex:t[5],rowSpan:t[6],colSpan:t[7],topStyle:e||this.defaultLineStyle,rightStyle:i||this.defaultLineStyle,bottomStyle:s||this.defaultLineStyle,leftStyle:r||this.defaultLineStyle,fontStyle:this.transTableFontStyle(a||this.defaultFontStyle),lineHeight:t[13],zIndex:++this.zIndex};this.tableCell[t[2]]||(this.tableCell[t[2]]=[]),this.tableCell[t[2]].push(o)}parseAttr(t){let e=this.fontStyleIndex[t[10]];e||(e=this.defaultFontStyle,console.warn("fontStyle not found",t));let i=this.transFontStyle(e),s=this.getGroupId(t[1]);this.onAttr(t[1],this.curPart,s,!!t[11],t[2]||"",this.transPinAttrKey(String(t[3])),t[4],t[5]===null?null:!!t[5],t[6]===null?null:!!t[6],t[7]!==null?t[7]:null,t[8]!==null?t[8]:null,t[9],i.color,i.fillColor,i.fontFamily,i.fontSize,i.strikeout,i.underline,i.italic,i.fontWeight,i.align)}parsePart(t){this.curPart=t[1]||this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[t[1]]=this.curPart;let e=Object.assign(t[2]||{},{title:t[1]||""});this.onPart(this.curPart,e)}},Wg=class{constructor(){}encodeCanvas(t){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(t)}}encodeGroup(t,e){return{id:t,dataType:"GROUP",data:JSON.stringify(e)}}encodeAuxLine(t,e){return{id:t,dataType:"AUXLINE",data:JSON.stringify(e)}}encodeDimension(t,e){return{id:t,dataType:"DIMENSION",data:JSON.stringify(e)}}encodeString(t,e){return{id:t,dataType:"STRING",data:JSON.stringify(e)}}encodePoly(t,e){return{id:t,dataType:"POLY",data:JSON.stringify(e)}}},oc=class{constructor(){}editHead(t,e){let i={uuid:t.uuid,nickname:t.nickname,username:t.username,updateTime:e};return`${JSON.stringify({type:"EDIT_HEAD"})}${li}${JSON.stringify(i)}`}head(t){return _s(this.doctype,t.client,t.doc,t.updateTime,t.version||String(t.updateTime),t.user,t.ticket)}creator(t,e){let i=typeof e=="string"?e:JSON.stringify(e);return ze("META_CREATE",t,"META_CREATE",i)}modifier(t,e){let i=typeof e=="string"?e:JSON.stringify(e);return ze("META_MODIFY",t,"META_MODIFY",i)}delete(t,e){let i=e||JSON.stringify({isDelete:!0});return ze("DELETE_DOC",t,"DELETE_DOC",i)}},jo=class extends oc{constructor(){super(...arguments),this.doctype="BLOB"}buildStr(t,e,i){let s=typeof i=="string"?i:JSON.stringify(this.buildData(i));return ze("BLOB",t,e,s)}buildData(t){return{filename:t.filename,content:t.content}}};var lc=class{constructor(){}encodeString(t,e){return{id:t,dataType:"STRING",data:JSON.stringify(e)}}encodeAttr(t,e){return{id:t,dataType:"ATTR",data:JSON.stringify(e)}}encodePanelize(t){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(t)}}encodeRuleSelector(t){let e=JSON.stringify(["RULE_SELECTOR",t.ruleSelect]),i={...t};return delete i.ruleSelect,{id:e,dataType:"RULE_SELECTOR",data:JSON.stringify(i)}}encodeRule(t){let e=JSON.stringify(["RULE",t.ruleType,t.ruleName]),i={...t};return delete i.ruleType,delete i.ruleName,{id:e,dataType:"RULE",data:JSON.stringify(i)}}encodeRuleTemplate(t){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(t)}}encodeDimension(t,e){return{id:t,dataType:"DIMENSION",data:JSON.stringify(e)}}encodeBoss(t,e){return{id:t,dataType:"BOSS",data:JSON.stringify(e)}}encodeShellEntity(t,e){return{id:t,dataType:"SHELL_ENTITY",data:JSON.stringify(e)}}encodeShellCut(t,e){return{id:t,dataType:"SHELLCUT",data:JSON.stringify(e)}}encodeCrease(t,e){return{id:t,dataType:"CREASE",data:JSON.stringify(e)}}encodeShell(t,e){return{id:t,dataType:"SHELL",data:JSON.stringify(e)}}encodeFpcFill(t,e){return{id:t,dataType:"FPC_FILL",data:JSON.stringify(e)}}encodeTeardrop(t,e){return{id:t,dataType:"TEARDROP",data:JSON.stringify(e)}}encodeImage(t,e){return{id:t,dataType:"IMAGE",data:JSON.stringify(e)}}encodePoured(t,e){return{id:Ve(t,"POURED"),dataType:"POURED",data:JSON.stringify(e)}}encodePour(t,e){return{id:t,dataType:"POUR",data:JSON.stringify(e)}}encodeRegion(t,e){return{id:t,dataType:"REGION",data:JSON.stringify(e)}}encodeFill(t,e){return{id:t,dataType:"FILL",data:JSON.stringify(e)}}encodeLayerFill(t,e){return{id:Ve(t,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(e)}}encodePoly(t,e){return{id:t,dataType:"POLY",data:JSON.stringify(e)}}encodeEQLenGrp(t,e){return{id:t,dataType:"EQLEN_GRP",data:JSON.stringify(e)}}encodeObj(t,e){return{id:t,dataType:"OBJ",data:JSON.stringify(e)}}encodeArc(t,e){return{id:t,dataType:"ARC",data:JSON.stringify(e)}}encodeLine(t,e){return{id:t,dataType:"LINE",data:JSON.stringify(e)}}encodePad(t,e){return{id:t,dataType:"PAD",data:JSON.stringify(e)}}encodeVia(t,e){return{id:t,dataType:"VIA",data:JSON.stringify(e)}}encodePreference(t){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(t)}}encodeSilkOpts(t,e){return{id:Ve(t,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(e)}}encodeGroup(t,e){return{id:t,dataType:"GROUP",data:JSON.stringify(e)}}encodePrimitive(t,e){return{id:Ve(t,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(e)}}encodeNet(t,e){return{id:Ve(t,"NET"),dataType:"NET",data:JSON.stringify(e)}}encodeActiveLayer(t){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(t)}}encodeLayerPhys(t,e){return{id:Ve(t,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(e)}}encodeLayer(t,e){return{id:Ve(t,"LAYER"),dataType:"LAYER",data:JSON.stringify(e)}}encodeCanvas(t){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(t)}}},Jg=class extends I0{constructor(t=!1){super(void 0,void 0,void 0,void 0,t),this.encode=new lc,this.maxTicket=0,this.blobEncode=new jo,this.blobData=[],this.encodeData=""}handleData(t){this.encodeData?this.encodeData=this.encodeData+ne+ze(t.dataType,++this.maxTicket,t.id,t.data):this.encodeData=ze(t.dataType,++this.maxTicket,t.id,t.data)}getZIndex(t){let e=t.match(Po);return e!=null&&e.length?e[1]:null}onPHolder(t,e){let i={dataType:t,max:e};this.handleData({id:Be(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(i)})}onLayerFill(t,e){this.handleData(this.encode.encodeLayerFill(t,e))}onString(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y){let E=this.getZIndex(t);this.handleData(this.encode.encodeString(Pt(t),{groupId:i,layerId:s,x:r,y:n,text:a,fontFamily:o,fontSize:l,strokeWidth:u,bold:c,italic:h,origin:f,angle:d,reverse:p,expansion:m,mirror:g,locked:b,zIndex:E===null?null:Number(E),specialColor:y}))}onAttr(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E,_,S,A,w){let R=this.getZIndex(t);R&&A&&(R=R+"."+String(A)),this.handleData(this.encode.encodeAttr(Pt(t),{groupId:i,parentId:s,layerId:r,x:n,y:a,key:o,value:l,keyVisible:u,valueVisible:c,fontFamily:h,fontSize:f,strokeWidth:d,bold:p,italic:m,origin:g,angle:b,reverse:y,expansion:E,mirror:_,locked:S,zIndex:R===null?null:Number(R),specialColor:w}))}onPadNet(t,e,i,s,r){}onComponent(t,e,i,s,r,n,a,o,l){}onPanelize(t,e,i,s,r,n,a,o,l,u){this.handleData(this.encode.encodePanelize({on:t,row:e,column:i,rowSpacing:s,columnSpacing:r,onlyOutline:n,horizontalStamp:a,verticalStamp:o,horizontalSize:l,verticalSize:u}))}onRuleSelector(t,e,i,s,r){this.handleData(this.encode.encodeRuleSelector({ruleSelect:t,ruleOrder:e,ruleKeyValue:i,copperValue:s,innerPlaneValue:r}))}onRule(t,e,i,s){this.handleData(this.encode.encodeRule({ruleType:t,ruleName:e,ruleState:i,ruleContext:s}))}onRuleTemplate(t){this.handleData(this.encode.encodeRuleTemplate({name:t}))}onDimension(t,e,i,s,r,n,a,o,l,u,c,h,f){let d=this.getZIndex(t);this.handleData(this.encode.encodeDimension(Pt(t),{type:i,layerId:s,unit:r,strokeWidth:n,precision:a,textFollow:o,coords:l,locked:u,zIndex:d===null?null:Number(d),text:c,specialColor:h,groupId:f}))}onBoss(t,e,i,s,r,n,a,o,l,u,c,h,f){let d=this.getZIndex(t);this.handleData(this.encode.encodeBoss(Pt(t),{groupId:i,layerId:s,centerX:r,centerY:n,specification:a,depth:o,thickness:l,holeDiameter:u,counterBore:c?{height:c[0],diameter:c[1]}:null,stiffener:h?{topWidth:h[0],bottomWidth:h[1],height:h[2],stiffThickness:h[3]}:null,locked:f,zIndex:d===null?null:Number(d)}))}onShellEntity(t,e,i,s,r,n,a,o,l,u,c,h){let f=this.getZIndex(t),d={groupId:i,layerId:s,type:r?"ENTITY":"SLOT",depth:o,strokeWidth:l,path:u,locked:c,zIndex:f===null?null:Number(f),refs:h};d.type==="ENTITY"&&(d.entityBelong=n),d.type==="SLOT"&&(d.slotOptions=a),this.handleData(this.encode.encodeShellEntity(Pt(t),d))}onShellCut(t,e,i,s,r,n,a,o,l){let u=this.getZIndex(t);this.handleData(this.encode.encodeShellCut(Pt(t),{groupId:i,layerId:s,depth:r,strokeWidth:n,path:a,locked:o,zIndex:u===null?null:Number(u),refs:l}))}onCrease(t,e,i,s,r,n,a,o,l,u){let c=this.getZIndex(t);this.handleData(this.encode.encodeCrease(Pt(t),{groupId:i,layerId:s,startX:r,startY:n,endX:a,endY:o,angle:l,locked:u,zIndex:c===null?null:Number(c)}))}onShell(t,e,i,s,r,n,a,o,l,u){let c=this.getZIndex(t),h={groupId:i,shellType:s,shellHeight:r,pcbHeight:n,strokeWidth:a,path:o,thickness:l.Thickness,locked:u,zIndex:c===null?null:Number(c)};s==="DRAWER"&&(h.direction=l.Direction),s==="T&B"&&(h.bottomHeight=l.BottomHeight,h.topInnerHeight=l.TopInnerHeight,h.bottomInnerHeight=l.BottomInnerHeight),this.handleData(this.encode.encodeShell(Pt(t),h))}onFpcFill(t,e,i,s,r,n,a,o){let l=this.getZIndex(t);this.handleData(this.encode.encodeFpcFill(Pt(t),{groupId:i,layerId:s,material:r,thickness:n,path:a,locked:o,zIndex:l===null?null:Number(l)}))}onTeardrop(t,e,i,s,r,n,a){this.handleData(this.encode.encodeTeardrop(Pt(t),{netName:i,layerId:s,path:r,groupId:n,refs:a,locked:!1}))}onImage(t,e,i,s,r,n,a,o,l,u,c,h,f){let d=this.getZIndex(t);this.handleData(this.encode.encodeImage(Pt(t),{groupId:i,layerId:s,startX:r,startY:n,width:a,height:o,angle:l,mirror:u,path:c,locked:h,zIndex:d===null?null:Number(d),specialColor:f}))}onPoured(t,e){this.handleData(this.encode.encodePoured(Pt(t),e))}onPour(t,e,i,s,r,n,a,o,l,u,c,h){let f=this.getZIndex(t);this.handleData(this.encode.encodePour(Pt(t),{groupId:i,netName:s,layerId:r,width:n,name:a,order:o,path:l,pourType:u,keepIsland:c,locked:h,zIndex:f===null?null:Number(f)}))}onRegion(t,e,i,s,r,n,a,o,l,u){let c=this.getZIndex(t);this.handleData(this.encode.encodeRegion(Pt(t),{groupId:i,layerId:s,width:r,prohibitType:n,path:a,locked:o,zIndex:c===null?null:Number(c),name:l,regionType:u}))}onFill(t,e,i,s,r,n,a,o,l,u,c){let h=this.getZIndex(t);this.handleData(this.encode.encodeFill(Pt(t),{groupId:i,netName:s,layerId:r,width:n,fillStyle:a,path:o,locked:l,zIndex:h===null?null:Number(h),isBridgingCopper:!1,networkList:[],refs:u,specialColor:c}))}onPoly(t,e,i,s,r,n,a,o,l){let u=this.getZIndex(t);this.handleData(this.encode.encodePoly(Pt(t),{groupId:i,netName:s,layerId:r,width:n,path:a,locked:o,zIndex:u===null?null:Number(u),specialColor:l,polyType:r==11?"BOARD_OUTLINE":"NORMAL"}))}onEQLenGrp(t,e,i,s){this.handleData(this.encode.encodeEQLenGrp(Pt(t),{name:e,sort:i,pads:s}))}onObj(t,e,i,s,r,n,a,o,l,u,c,h,f,d){if(h.startsWith("data:")){let m=Ea(h);this.blobData.push(this.blobEncode.buildStr(1,m,{filename:r,content:h})),h=`blob:${m}`}let p=this.getZIndex(t);this.handleData(this.encode.encodeObj(Pt(t),{groupId:i,layerId:s,fileName:r,startX:n,startY:a,width:o,height:l,angle:u,mirror:c,path:h,locked:f,zIndex:p===null?null:Number(p),specialColor:d}))}onArc(t,e,i,s,r,n,a,o,l,u,c,h,f){let d=this.getZIndex(t);this.handleData(this.encode.encodeArc(Pt(t),{groupId:i,netName:s,layerId:r,startX:n,startY:a,endX:o,endY:l,angle:u,width:c,locked:h,zIndex:d===null?null:Number(d),arcType:"DOT",specialColor:f}))}onCArc(t,e,i,s,r,n,a,o,l,u,c,h,f){let d=this.getZIndex(t);this.handleData(this.encode.encodeArc(Pt(t),{groupId:i,netName:s,layerId:r,startX:n,startY:a,endX:o,endY:l,angle:u,width:c,locked:h,zIndex:d===null?null:Number(d),arcType:"CENT",specialColor:f}))}onLine(t,e,i,s,r,n,a,o,l,u,c){let h=this.getZIndex(t);this.handleData(this.encode.encodeLine(Pt(t),{groupId:i,netName:s,layerId:r,startX:n,startY:a,endX:o,endY:l,width:u,locked:c,zIndex:h===null?null:Number(h)}))}onPad(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E,_,S,A,w,R,L,M){let B=this.getZIndex(t);this.handleData(this.encode.encodePad(Pt(t),{groupId:i,netName:s,layerId:r,num:n,centerX:a,centerY:o,padAngle:l,hole:u,defaultPad:c,specialPad:h,padOffsetX:f,padOffsetY:d,relativeAngle:p,plated:m,padType:g,topSolderExpansion:b,bottomSolderExpansion:y,topPasteExpansion:E,bottomPasteExpansion:_,locked:S,zIndex:B===null?null:Number(B),connectMode:A,spokeSpace:w,spokeWidth:R,spokeAngle:L,unusedInnerLayers:M,padLen:0}))}onVia(t,e,i,s,r,n,a,o,l,u,c,h,f,d){let p=this.getZIndex(t);this.handleData(this.encode.encodeVia(Pt(t),{groupId:i,netName:s,ruleName:r,centerX:n,centerY:a,holeDiameter:o,viaDiameter:l,viaType:u,topSolderExpansion:c,bottomSolderExpansion:h,locked:f,zIndex:p===null?null:Number(p),unusedInnerLayers:d}))}onPreference(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E){this.handleData(this.encode.encodePreference({startTrackWidthFollowLast:t,lastTrackWidth:e,startViaSizeFollowLast:i,lastViaInnerDiameter:s,lastViaDiameter:r,snap:n,routingMode:a,routingCorner:o,removeLoop:l,rotatingObject:u,trackFollow:c,stretchTrackMinCorner:h,preferenceConfig:f,realTimeUpdateUnusedLayers:d,unusedPadRange:p,pushVia:m,pathOptimization4BePushed:g,currentPathOptimization4BePushed:b,removeCircuitsContainingVias:y,removeAntenna:E}))}onSilkOpts(t,e,i){this.handleData(this.encode.encodeSilkOpts(t,{defaultColor:e,baseColor:i}))}onGroup(t,e){this.handleData(this.encode.encodeGroup(t,{groupName:e}))}onPrimitive(t,e,i){this.handleData(this.encode.encodePrimitive(t,{display:e,pick:i}))}onNet(t,e,i,s,r,n,a){this.handleData(this.encode.encodeNet(t,{netType:e,specialColor:i,retLine:s,differentialName:r,isPositiveNet:n,equalLengthGroupName:a}))}onPartition(t,e,i,s){}onActiveLayer(t){this.handleData(this.encode.encodeActiveLayer({layerId:t}))}onLayerPhys(t,e,i,s,r,n,a){this.handleData(this.encode.encodeLayerPhys(t,{material:e,thickness:i,permittivity:s,lossTangent:r,isKeepIsland:n,zIndex:a}))}onLayer(t,e,i,s,r,n,a,o,l,u){this.handleData(this.encode.encodeLayer(t,{layerType:e,layerName:i,use:s,show:r,locked:n,activeColor:a,activateTransparency:o,inactiveColor:l,inactiveTransparency:u}))}onCanvas(t,e,i,s,r,n,a,o,l,u,c,h){this.handleData(this.encode.encodeCanvas({originX:t,originY:e,unit:i,gridXSize:s,gridYSize:r,snapXSize:n,snapYSize:a,altSnapXSize:o,altSnapYSize:l,gridType:u,multiGridType:c,multiGridRatio:h,highlightValue:.5}))}};function Kg(t,e,i,s=new Date().getTime(),r=String(s),n){let a=new Jg(i),o="",l=Be();if(o=_s("FOOTPRINT",l,t,s,r,n),a.parseFull(e),a.encodeData&&(o=o+ne+a.encodeData),a.blobData.length&&(o=o+ne+a.blobEncode.head({doc:"BLOB",client:l,updateTime:s,version:r,user:n})+ne+a.blobData.join(ne)),a.fontCache.length){let u=new t1,c=u.head({doc:"FONT",client:l,updateTime:s,version:r,user:n});for(let h of a.fontCache){let f=eo(h.text,h.fontFamily,h.fontSize,h.thickness,h.bold,h.italic,h.reverse,h.expansion),d=u.buildStr(1,f,h);c=c+ne+d}o=c+ne+o}return o}var $g=class{constructor(){}encodePart(t,e){return{id:t,dataType:"PART",data:JSON.stringify(e)}}encodeCanvas(t){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(t)}}encodeAttr(t,e){return{id:t,dataType:"ATTR",data:JSON.stringify(e)}}encodeTable(t,e){return{id:t,dataType:"TABLE",data:JSON.stringify(e)}}encodeEllipse(t,e){return{id:t,dataType:"ELLIPSE",data:JSON.stringify(e)}}encodeObj(t,e){return{id:t,dataType:"OBJ",data:JSON.stringify(e)}}encodePin(t,e){return{id:t,dataType:"PIN",data:JSON.stringify(e)}}encodeRect(t,e){return{id:t,dataType:"RECT",data:JSON.stringify(e)}}encodeArc(t,e){return{id:t,dataType:"ARC",data:JSON.stringify(e)}}encodeCircle(t,e){return{id:t,dataType:"CIRCLE",data:JSON.stringify(e)}}encodePoly(t,e){return{id:t,dataType:"POLY",data:JSON.stringify(e)}}encodeText(t,e){return{id:t,dataType:"TEXT",data:JSON.stringify(e)}}encodeBezier(t,e){return{id:t,dataType:"BEZIER",data:JSON.stringify(e)}}encodeGroup(t,e){return{id:t,dataType:"GROUP",data:JSON.stringify(e)}}},Zg=class extends qg{constructor(){super(),this.encode=new $g,this.maxTicket=0,this.blobEncode=new jo,this.blobData=[],this.encodeData=""}handleData(t){this.encodeData?this.encodeData=this.encodeData+ne+ze(t.dataType,++this.maxTicket,t.id,t.data):this.encodeData=ze(t.dataType,++this.maxTicket,t.id,t.data)}onPHolder(t,e){let i={dataType:t,max:e};this.handleData({id:Be(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(i)})}onPart(t,e){this.handleData(this.encode.encodePart(t,e||{}))}onAttr(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E,_){this.handleData(this.encode.encodeAttr(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),parentId:r,key:n,value:a,keyVisible:o,valueVisible:l,x:u,y:_e(c),rotation:h,color:f,fillColor:d,fontFamily:p,fontSize:m,strikeout:g,underline:b,italic:y,fontWeight:E,align:_,version:"2.0"}))}onTable(t,e,i,s,r,n,a,o,l,u,c){this.handleData(this.encode.encodeTable(Pt(t),{partId:e,groupId:i,startX:s,startY:_e(r),rowSizes:n,colSizes:a,rowLocked:o,colLocked:l,rotation:u,tableCell:c,zIndex:this.getZIndex(t)}))}onEllipse(t,e,i,s,r,n,a,o,l,u,c,h,f,d){this.handleData(this.encode.encodeEllipse(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),centerX:r,centerY:_e(n),radiusX:a,radiusY:_e(o),rotation:l,strokeColor:u,strokeStyle:c,fillColor:h,strokeWidth:f,fillStyle:d}))}onComponent(){}onObj(t,e,i,s,r,n,a,o,l,u,c,h){if(h.startsWith("data:")){let f=Ea(h);this.blobData.push(this.blobEncode.buildStr(1,f,{filename:"",content:h})),h=`blob:${f}`}this.handleData(this.encode.encodeObj(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),fileName:r,startX:n,startY:_e(a),width:o,height:l,rotation:u,isMirror:c,content:h}))}onPin(t,e,i,s,r,n,a,o,l,u,c,h){this.handleData(this.encode.encodePin(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),display:r,x:a,y:_e(o),length:l,rotation:u,color:c,pinShape:h}))}onRect(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m){this.handleData(this.encode.encodeRect(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),dotX1:r,dotY1:_e(n),dotX2:a,dotY2:_e(o),radiusX:l,radiusY:u,rotation:c,strokeColor:h,strokeStyle:f,fillColor:d,strokeWidth:p,fillStyle:m}))}onArc(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p){this.handleData(this.encode.encodeArc(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),startX:r,startY:_e(n),referX:a,referY:_e(o),endX:l,endY:_e(u),strokeColor:c,strokeStyle:h,fillColor:f,strokeWidth:d,fillStyle:p}))}onCircle(t,e,i,s,r,n,a,o,l,u,c,h){this.handleData(this.encode.encodeCircle(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),centerX:r,centerY:_e(n),radius:a,strokeColor:o,strokeStyle:l,fillColor:u,strokeWidth:c,fillStyle:h}))}onPoly(t,e,i,s,r,n,a,o,l,u,c){this.handleData(this.encode.encodePoly(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),points:af(r,!0),closed:n,strokeColor:a,strokeStyle:o,fillColor:l,strokeWidth:u,fillStyle:c}))}onText(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g){this.handleData(this.encode.encodeText(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),x:r,y:_e(n),rotation:a,value:o,color:l,fillColor:u,fontFamily:c,fontSize:h,strikeout:f,underline:d,italic:p,fontWeight:m,align:g,version:"2.0"}))}onCanvas(t){this.handleData(this.encode.encodeCanvas({originX:t.originX,originY:_e(t.originY)}))}onBezier(t,e,i,s,r,n,a,o,l,u){this.handleData(this.encode.encodeBezier(Pt(t),{partId:e,groupId:i,locked:s,zIndex:this.getZIndex(t),controls:r,strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:l,fillStyle:u}))}onGroup(t,e,i){this.handleData(this.encode.encodeGroup(String(t),{parentId:e,title:i}))}onBus(){}onWire(){}};function Qg(t,e,i=new Date().getTime(),s=String(i),r){let n=new Zg,a="";n.parseFull(e);let o=Be();n.encodeData&&(a=_s("SYMBOL",o,t,i,s,r)+ne+n.encodeData),a&&n.blobData.length&&(a=a+ne+n.blobEncode.head({doc:"BLOB",client:o,updateTime:i,version:s,user:r})+ne+n.blobData.join(ne));let l=n.partIdMap;return n.partIdMap={},{dataStr:a,partIdMap:l}}var t1=class extends oc{constructor(){super(...arguments),this.doctype="FONT"}buildStr(t,e,i){let s=typeof i=="string"?i:JSON.stringify(this.buildData(i));return ze("FONT",t,e,s)}buildData(t){return{width:t.width,height:t.height,path:t.path}}};var e1=class extends Xg{constructor(){super(),this.encode=new Wg,this.maxTicket=0,this.blobEncode=new jo,this.blobData=[],this.encodeData=""}handleData(t){this.encodeData?this.encodeData=this.encodeData+ne+ze(t.dataType,++this.maxTicket,t.id,t.data):this.encodeData=ze(t.dataType,++this.maxTicket,t.id,t.data)}onPHolder(t,e){let i={dataType:t,max:e};this.handleData({id:Be(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(i)})}strokeStyleType(t){switch(t=t&&Number(t),t){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transScopeType(t){switch(t=t&&Number(t),t){case 1:return"PRINT";case 2:return"COVER";case 3:return"PRINT&COVER";default:return null}}transAlignType(t){switch(t=t&&Number(t),t){case 0:return"LEFT_BOTTOM";case 1:return"CENTER_BOTTOM";case 2:return"RIGHT_BOTTOM";case 3:return"LEFT_MIDDLE";case 4:return"CENTER_MIDDLE";case 5:return"RIGHT_MIDDLE";case 6:return"LEFT_TOP";case 7:return"CENTER_TOP";case 8:return"RIGHT_TOP";default:return null}}onAuxLine(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E){this.handleData(this.encode.encodeAuxLine(Pt(t),{groupId:e?`e${e}`:"",layer:i,x:s,y:r,rotation:n,strokeWidth:a,strokeStyle:this.strokeStyleType(o),color:l,length:u,locked:c,zIndex:this.getZIndex(t),visible:!f,cover:d,name:p}))}onDimension(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b){this.handleData(this.encode.encodeDimension(Pt(t),{layer:e,dimensionType:i,unit:s,strokeWidth:r,accuracy:n,controlDot:a,relationIds:o,locked:l,zIndex:this.getZIndex(t),valid:!u,visible:!c,cover:h,name:f,rotation:0}))}onString(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E,_,S,A,w,R){this.handleData(this.encode.encodeString(Pt(t),{groupId:e?`e${e}`:"",layer:i,rotation:s,value:r,fontFamily:n,fontSize:a,fontWeight:o,italic:l,underline:u,strikeout:c,align:this.transAlignType(h),strokeColor:f,opacity:d,locked:p,zIndex:this.getZIndex(t),valid:!m,visible:!g,cover:b,transScope:this.transScopeType(E),transPrint:_,transWhite:S,matrix:A,strokes:w,path:R,name:y}))}onPoly(t,e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E,_,S){if(typeof o=="string"&&o.startsWith("data:")){let A=Ea(o);this.blobData.push(this.blobEncode.buildStr(1,A,{filename:"",content:o})),o=`blob:${A}`}this.handleData(this.encode.encodePoly(Pt(t),{groupId:e?`e${e}`:"",layer:i,rotation:s,strokeWidth:r,strokeStyle:this.strokeStyleType(n),strokeColor:a,fillColor:o,opacity:l,autoClose:u,ploys:c,displayFill:h,displayStroke:f,locked:d,zIndex:this.getZIndex(t),valid:!p,visible:!m,cover:g,transScope:this.transScopeType(y),transPrint:E,transWhite:_,matrix:S,name:b}))}onGroup(t,e,i,s,r){this.handleData(this.encode.encodeGroup(`e${t}`,{parentId:e?`e${e}`:"",title:i,visible:s,locked:r}))}onCanvas(t){this.handleData(this.encode.encodeCanvas(t))}};function i1(t,e,i,s=new Date().getTime(),r=String(s),n){let a=new e1,o="";a.parseFull(e);let l=Be();return a.encodeData&&(o=_s(i,l,t,s,r,n)+ne+a.encodeData),o&&a.blobData.length&&(o=o+ne+a.blobEncode.head({doc:"BLOB",client:l,updateTime:s,version:r,user:n})+ne+a.blobData.join(ne)),o}var uc=class extends i0{constructor(t){let e=t||new wu;super(e,0,cf),this.cacheNum=null}onParseLine(t,e,i,s,r,n,a){switch(this.setOrderNum(t,a,e),this.cacheNum=a,e){case"MAX_NUM":if(i)for(let l in i)this.setMaxNum(l,i[l]);break;case"BLOB":i?this.onBlob(t,s,r,i,n):this.onDelBlob(t,s,r,n);break;case"FONT":this.parseFont(t,i,s,r,n);break;case"META":i&&this.parseDetail(i,s,r,n);break;case"ELE_PLACEHOLDER":break;case"CANVAS":i&&this.parseCanvas(i,s,r,n);break;case"BOARD":i?this.parseBoard(i,s,r,n):this.onDelBoard(s,r,n);break;case"LAYER":{let l=qi(t);i?this.parseLayer(l,i,s,r,n):this.onDelLayer(l,s,r,n);break}case"LAYER_PHYS":{let l=qi(t);i?this.parseLayerPhys(l,i,s,r,n):this.onDelLayerPhys(l,s,r,n);break}case"ACTIVE_LAYER":i&&this.parseActiveLayer(t,i,s,r,n);break;case"PARTITION":i?this.parsePartition(t,i,s,r,n):this.onDelPartition(t,s,r,n);break;case"NET":{let l=qi(t);i?this.parseNet(l,i,s,r,n):this.onDelNet(l,s,r,n);break}case"PRIMITIVE":{let l=qi(t);i?this.parsePrimitive(l,i,s,r,n):this.onDelPrimitive(l,s,r,n);break}case"GROUP":i?this.parseGroup(t,i,s,r,n):this.onDelGroup(t,s,r,n);break;case"SILK_OPTS":{let l=qi(t);i?this.parseSilkOpts(l,i,s,r,n):this.onDelSilkOpts(l,s,r,n);break}case"PREFERENCE":i&&this.parsePreference(t,i,s,r,n);break;case"VIA":i?this.parseVia(t,i,s,r,n):this.onDelVia(t,s,r,n);break;case"PAD":i?this.parsePad(t,i,s,r,n):this.onDelPad(t,s,r,n);break;case"LINE":i?this.parseLine(t,i,s,r,n):this.onDelLine(t,s,r,n);break;case"ARC":i?this.parseArc(t,i,s,r,n):this.onDelArc(t,s,r,n);break;case"OBJ":i?this.parseObj(t,i,s,r,n):this.onDelObj(t,s,r,n);break;case"EQLEN_GRP":i?this.parseEQLenGrp(t,i,s,r,n):this.onDelEQLenGrp(t,s,r,n);break;case"POLY":i?this.parsePoly(t,i,s,r,n):this.onDelPoly(t,s,r,n);break;case"FILL":i?this.parseFill(t,i,s,r,n):this.onDelFill(t,s,r,n);break;case"LAYER_FILL":let o=qi(t);i?this.parseLayerFill(o,i,s,r,n):this.onDelLayerFill(o,s,r,n);break;case"REGION":i?this.parseRegion(t,i,s,r,n):this.onDelRegion(t,s,r,n);break;case"POUR":i?this.parsePour(t,i,s,r,n):this.onDelPour(t,s,r,n);break;case"POURED":{t=qi(t),i?this.parsePoured(t,i,s,r,n):this.onDelPoured(t,s,r,n);break}case"IMAGE":i?this.parseImage(t,i,s,r,n):this.onDelImage(t,s,r,n);break;case"TEARDROP":i?this.parseTeardrop(t,i,s,r,n):this.onDelTeardrop(t,s,r,n);break;case"FPC_FILL":i?this.parseFpcFill(t,i,s,r,n):this.onDelFpcFill(t,s,r,n);break;case"SHELL":i?this.parseShell(t,i,s,r,n):this.onDelShell(t,s,r,n);break;case"CREASE":i?this.parseCrease(t,i,s,r,n):this.onDelCrease(t,s,r,n);break;case"SHELLCUT":i?this.parseShellCut(t,i,s,r,n):this.onDelShellCut(t,s,r,n);break;case"SHELL_ENTITY":i?this.parseShellEntity(t,i,s,r,n):this.onDelShellEntity(t,s,r,n);break;case"BOSS":i?this.parseBoss(t,i,s,r,n):this.onDelBoss(t,s,r,n);break;case"STRING":i?this.parseString(t,i,s,r,n):this.onDelString(t,s,r,n);break;case"ATTR":i?this.parseAttr(t,i,s,r,n):this.onDelAttr(t,s,r,n);break;case"DIMENSION":i?this.parseDimension(t,i,s,r,n):this.onDelDimension(t,s,r,n);break;case"COMPONENT":i?this.parseComponent(t,i,s,r,n):this.onDelComponent(t,s,r,n);break;case"PAD_NET":{let l=JSON.parse(t);i?(i.componentId=l[1],i.padNum=l[2],i.padId=l[3],this.parsePadNet(i,s,r,n)):this.onDelPadNet(l[1],l[2],l[3]||"",s,r,n);break}case"RULE_TEMPLATE":i&&this.parseRuleTemplate(t,i,s,r,n);break;case"RULE":{let l=JSON.parse(t);i?(i.ruleType=l[1],i.ruleName=l[2],this.parseRule(i,s,r,n)):this.onDelRule(l[1],l[2],s,r,n);break}case"RULE_SELECTOR":{let l=JSON.parse(t);i?(i.ruleSelect=l[1],this.parseRuleSelector(i,s,r,n)):this.onDelRuleSelector(l[1],s,r,n);break}case"PANELIZE":i?this.parsePanelize(t,i,s,r,n):this.onDelPanelize(s,r,n);break;default:console.warn("can not find hanlder with",i,s,r)}this.cacheNum=null}onOrderNum(t,e,i){switch(this.setOrderNum(t,i,e),e){case"PARTITION":this.onPartitionNum&&this.onPartitionNum(t,i);break;case"VIA":this.onViaNum&&this.onViaNum(t,i);break;case"PAD":this.onPadNum&&this.onPadNum(t,i);break;case"LINE":this.onLineNum&&this.onLineNum(t,i);break;case"ARC":this.onArcNum&&this.onArcNum(t,i);break;case"OBJ":this.onObjNum&&this.onObjNum(t,i);break;case"POLY":this.onPolyNum&&this.onPolyNum(t,i);break;case"FILL":this.onFillNum&&this.onFillNum(t,i);break;case"REGION":this.onRegionNum&&this.onRegionNum(t,i);break;case"POUR":this.onPourNum&&this.onPourNum(t,i);break;case"POURED":let s=qi(t);this.onPouredNum&&this.onPouredNum(s,i);break;case"IMAGE":this.onImageNum&&this.onImageNum(t,i);break;case"TEARDROP":this.onTeardropNum&&this.onTeardropNum(t,i);break;case"FPC_FILL":this.onFpcFillNum&&this.onFpcFillNum(t,i);break;case"SHELL":this.onShellNum&&this.onShellNum(t,i);break;case"CREASE":this.onCreaseNum&&this.onCreaseNum(t,i);break;case"SHELLCUT":this.onShellCutNum&&this.onShellCutNum(t,i);break;case"SHELL_ENTITY":this.onShellEntityNum&&this.onShellEntityNum(t,i);break;case"BOSS":this.onBossNum&&this.onBossNum(t,i);break;case"STRING":this.onStringNum&&this.onStringNum(t,i);break;case"ATTR":this.onAttrNum&&this.onAttrNum(t,i);break;case"DIMENSION":this.onDimensionNum&&this.onDimensionNum(t,i);break;case"COMPONENT":this.onComponentNum&&this.onComponentNum(t,i);break}}onParseEnd(){}parseCanvas(t,e,i,s){this.onCanvas(e,i,t,s)}parseBoard(t,e,i,s){this.onBoard(t,e,i,s)}parseDetail(t,e,i,s){this.onDocDetail(e,i,t,s)}parseFont(t,e,i,s,r){let n=t0(t);e?this.onFont(i,s,Object.assign(e,n),r):this.onDelFont(n,i,s,r)}parseLayer(t,e,i,s,r){this.onLayer(t,i,s,e,r)}parseLayerPhys(t,e,i,s,r){this.onLayerPhys(t,i,s,e,r)}parseActiveLayer(t,e,i,s,r){this.onActiveLayer(i,s,e,r)}parsePartition(t,e,i,s,r){this.onPartition(t,this.cacheNum,i,s,e,r)}parseNet(t,e,i,s,r){this.onNet(t,i,s,e,r)}parsePrimitive(t,e,i,s,r){this.onPrimitive(t,i,s,e,r)}parseGroup(t,e,i,s,r){this.onGroup(t,i,s,e,r)}parseSilkOpts(t,e,i,s,r){this.onSilkOpts(t,i,s,e,r)}parsePreference(t,e,i,s,r){this.onPreference(i,s,e,r)}parseVia(t,e,i,s,r){this.onVia(t,this.cacheNum,i,s,e,r)}parsePad(t,e,i,s,r){this.onPad(t,this.cacheNum,i,s,e,r)}parseLine(t,e,i,s,r){this.onLine(t,this.cacheNum,i,s,e,r)}parseArc(t,e,i,s,r){this.onArc(t,this.cacheNum,i,s,e,r)}parseObj(t,e,i,s,r){this.onObj(t,this.cacheNum,i,s,e,r)}parseEQLenGrp(t,e,i,s,r){this.onEQLenGrp(t,i,s,e,r)}parsePoly(t,e,i,s,r){this.onPoly(t,this.cacheNum,i,s,e,r)}parseFill(t,e,i,s,r){e.fillStyle!=="PLANE"&&this.onFill(t,this.cacheNum,i,s,e,r)}parseLayerFill(t,e,i,s,r){this.onLayerFill(t,i,s,e,r)}parseRegion(t,e,i,s,r){this.onRegion(t,this.cacheNum,i,s,e,r)}parsePour(t,e,i,s,r){this.onPour(t,this.cacheNum,i,s,e,r)}parsePoured(t,e,i,s,r){let n=e;Array.isArray(e)&&(n={pourFill:e}),n.pourFill&&this.onPoured(t,this.cacheNum,i,s,n,r)}parseImage(t,e,i,s,r){this.onImage(t,this.cacheNum,i,s,e,r)}parseTeardrop(t,e,i,s,r){this.onTeardrop(t,this.cacheNum,i,s,e,r)}parseFpcFill(t,e,i,s,r){this.onFpcFill(t,this.cacheNum,i,s,e,r)}parseShell(t,e,i,s,r){this.onShell(t,this.cacheNum,i,s,e,r)}parseCrease(t,e,i,s,r){this.onCrease(t,this.cacheNum,i,s,e,r)}parseShellCut(t,e,i,s,r){this.onShellCut(t,this.cacheNum,i,s,e,r)}parseShellEntity(t,e,i,s,r){this.onShellEntity(t,this.cacheNum,i,s,e,r)}parseBoss(t,e,i,s,r){this.onBoss(t,this.cacheNum,i,s,e,r)}parseDimension(t,e,i,s,r){this.onDimension(t,this.cacheNum,i,s,e,r)}parseRuleTemplate(t,e,i,s,r){this.onRuleTemplate(i,s,e,r)}parseRule(t,e,i,s){this.onRule(e,i,t,s)}parseRuleSelector(t,e,i,s){if(t.ruleKeyValue&&(t.ruleKeyValue=zs(t.ruleKeyValue)),t.copperValue&&t.copperValue.hasOwnProperty("7")){let r=t.copperValue[7];delete t.copperValue[7],t.copperValue.COPPER=r}if(t.innerPlaneValue&&t.innerPlaneValue.hasOwnProperty("6")){let r=t.innerPlaneValue[6];delete t.innerPlaneValue[6],t.innerPlaneValue.PLANE=r}this.onRuleSelector(e,i,t,s)}parsePanelize(t,e,i,s,r){this.onPanelize(i,s,e,r)}parseComponent(t,e,i,s,r){this.onComponent(t,this.cacheNum,i,s,e,r)}parsePadNet(t,e,i,s){this.onPadNet(e,i,t,s)}parseAttr(t,e,i,s,r){this.onAttr(t,this.cacheNum,i,s,e,r)}parseString(t,e,i,s,r){this.onString(t,this.cacheNum,i,s,e,r)}};var s1=(t=>(t.UNIVERSAL="UNIVERSAL",t))(s1||{}),r1=(t=>(t.SINGLE="SINGLE",t.MULTIPLE="MULTIPLE",t))(r1||{}),n1=(t=>(t.NONE="NONE",t.NAME="NAME",t.NUMBER="NUMBER",t))(n1||{}),a1=(t=>(t.NONE="NONE",t.ZONE="ZONE",t))(a1||{});var o1=hr(Zr());function Xr(){return self.EDITOR_TOP||self}function nr(t){return self[t]=self[t]||new o1.BroadcastChannelMessageBus(t)}var gs=(t,e)=>{let i=/{([^}]*)}/gim,s=[...new Set(t.match(i))];for(let r=0;r<s.length;r++){let n=s[r],a=n.substring(1,n.length-1);e[a]&&(t=t.replace(n,e[a]))}return t};var Yt={getTime:"/pro-mgr/serverTime/now",getUserL:"/pro-ui/loginUser/get",subMaxTick:"/pro-mgr/project/ticket",subBlob:"/pro-mgr/canvas/BLOB/update",subFont:"/pro-mgr/canvas/FONT/update",subRevoke:"/pro-mgr/{uuid}/revoke",pushPend:"/pro-mgr/worker/batchPendData",pushSync:"/pro-mgr/dataWorker/sync",pushRevoke:"/pro-mgr/worker/revoke",pullASync:"/pro-mgr/dataWorker/sync/{id}",personDestroy:"/mgr/libWorker/destroy",projectUpdate:"/pro-mgr/canvas/{uuid}/update",personUpdate:"/mgr/libWorker/component/{uuid}/update",personSave:"/mgr/libWorker/save",projectSave:"/mgr/projectWorker/setCanvas",canSavePend:"/mgr/projectWorker/canSavePend",hasSaveData:"/mgr/check/hasSaveData"},l1={projectUpdate:Yt.projectUpdate,personUpdate:Yt.personUpdate,projectCanSave:Yt.canSavePend,getProject:"/mgr/projectWorker/footprint/getCanvas",getPerson:"/mgr/libWorker/getFootprint",unwatch:"/mgr/projectWorker/footprint/unwatchCanvas"},u1={projectUpdate:Yt.projectUpdate,projectCanSave:Yt.canSavePend,getProject:"/mgr/projectWorker/pcb/getCanvas",unwatch:"/mgr/projectWorker/pcb/unwatchCanvas"},b_={projectUpdate:Yt.projectUpdate,projectCanSave:Yt.canSavePend,getProject:"/mgr/projectWorker/sheet/getCanvas",unwatch:"/mgr/projectWorker/sheet/unwatchCanvas"},__={projectUpdate:Yt.projectUpdate,getProject:"/mgr/projectWorker/schematic/getCanvas",unwatch:"/mgr/projectWorker/schematic/unwatchCanvas"},S_={projectUpdate:Yt.projectUpdate,projectCanSave:Yt.canSavePend,getProject:"/mgr/projectWorker/simulation/getCanvas",unwatch:"/mgr/projectWorker/simulation/unwatchCanvas"},I_={projectUpdate:Yt.projectUpdate,personUpdate:Yt.personUpdate,projectCanSave:Yt.canSavePend,getProject:"/mgr/projectWorker/symbol/getCanvasOnCompiler",getPerson:"/mgr/libWorker/getSymbol",unwatch:"/mgr/projectWorker/symbol/unwatchCanvas"},A_={projectUpdate:Yt.projectUpdate,personUpdate:Yt.personUpdate,projectCanSave:Yt.canSavePend,getProject:"/mgr/projectWorker/panel/getCanvas",getPerson:"/mgr/libWorker/getPanelLib",unwatch:"/mgr/projectWorker/panel/unwatchCanvas"};var Ge={send:"/pro-mgr/notify/send",sendMsg:"/document/sendMsg/cooperation",unwatch:"/document/unwatch/cooperation",watch:"/document/watch/cooperation",message:"/pro-mgr/notify/message/{path}/{uuid}/cooperation",established:"/pro-mgr/notify/message/ws/established",getWsId:"/pro-mgr/notify/getWsId",disconnect:"/pro-mgr/notify/message/ws/disconnect"},Go=class{constructor(t=!0){this._lockerTicket=0,this.isPull=!1,this.compiler={},this.order={SYMBOL:1,FOOTPRINT:2,DEVICE:3,SCH_PAGE:4,PCB:5},this._locker=t?++this._lockerTicket:0}getOrder(t){return this.order[t]||6}publish(){if(!this.isPull){this.isPull=!0,this._temporaryUnlock=this._locker;try{let t=Object.keys(this.compiler).sort((i,s)=>this.getOrder(i)-this.getOrder(s)),e=!1;for(let i of t){for(let[,s]of this.compiler[i])if(e=s.publish(),e)break;if(e)break}}finally{this._temporaryUnlock=0,this.isPull=!1}}}canPush(){return!this._locker||this._locker===this._temporaryUnlock}addCompiler(t){this.compiler[t.headType]||(this.compiler[t.headType]=new Map),this.compiler[t.headType].set(t.uniqueId,t)}removeCompiler(t){var e,i,s;(s=(i=(e=this.compiler)==null?void 0:e[t.headType])==null?void 0:i.delete)==null||s.call(i,t.uniqueId)}pull(){if(!this._locker)throw Error("\u4E0D\u5141\u8BB8\u5728\u975E pause \u72B6\u6001\u4E0B\u62C9\u53D6\u6570\u636E");this.publish()}resume(){this._locker=0,this.publish()}pause(){this._locker=++this._lockerTicket}dispose(){for(let t in this.compiler)this.compiler[t].clear();this.compiler=null}},Ji={publish:"publish",destroy:"destroy",init:"init",selected:"selected"},c1=class{constructor(t,e,i,s=(a=>(a=Xr())==null?void 0:a._TAB_ID_)(),r,n){var o;this.uuid=t,this.path=e,this.user=i,this.windowId=s,this.initIds={},this.sub=[],this.wsBus=n||nr(`/${this.windowId}/notify`),this.dataBus=r||this.wsBus,this._client=(o=Xr())==null?void 0:o._WS_ID_}get client(){return this._client}watch(){this.dataBus.publish(Ge.send,{topic:Ge.watch,uuid:this.uuid,path:this.path})}initPublish(){var t;this.dataBus.publish(Ge.send,{topic:Ge.sendMsg,uuid:this.uuid,path:this.path,msg:{type:Ji.publish,user:this.user,client:this.client,data:((t=this.getSelect)==null?void 0:t.call(this))||""}})}async init(){if(!this.isInit){if(this.sub.push(this.wsBus.subscribe(Ge.established,t=>{this._client=t,this.watch(),this.initPublish()})),!this.client){let t=await this.wsBus.rpcCall(Ge.getWsId);if(!t||this.client)return;this._client=t}this.watch(),this.sub.push(this.wsBus.subscribe(Ge.disconnect,t=>{this.initIds[t]&&this.onDestroy(this.initIds[t],t)})),this.sub.push(this.dataBus.subscribe(gs(Ge.message,{uuid:this.uuid,path:this.path}),t=>{if(t.type===1)t.connectId&&this.initIds[t.connectId]&&this.onDestroy(this.initIds[t.connectId],t.connectId);else if(t.msg){let e=t.msg;if(e.client===this.client)return;switch(e.type){case Ji.destroy:this.onDestroy(e.userId,e.client),delete this.initIds[e.client];break;case Ji.init:this.initIds[e.client]||(this.initIds[e.client]=e.user.uuid,this.onSelected(e.user,e.client,e.data||""));break;case Ji.selected:this.onSelected(e.user,e.client,e.data||"");break;case Ji.publish:this.dataBus.publish(Ge.send,{topic:Ge.sendMsg,uuid:this.uuid,path:this.path,msg:{type:Ji.init,user:this.user,client:this.client,data:this.getSelect()||""}}),this.initIds[e.client]=e.user.uuid,this.onSelected(e.user,e.client,e.data||"");break;default:break}}})),this.initPublish(),this.isInit=!0}}publishSelected(t,e){this.dataBus.publish(Ge.send,{topic:Ge.sendMsg,uuid:this.uuid,path:this.path,msg:{type:Ji.selected,user:this.user,client:this.client,data:t}}),e&&this.onSelected(this.user,this.client,t)}destroy(){if(this.isInit){this.isInit=!1,this.dataBus.publish(Ge.send,{topic:Ge.unwatch,uuid:this.uuid,path:this.path,msg:{type:Ji.destroy,userId:this.user.uuid,client:this.client}});for(let t of this.sub)t.cancel();this.sub=[],this.initIds={}}}},ru=class extends c1{constructor(t,e,i,s,r,n,a,o){super(t,e,o,i,r,n),this.channel=s,this.selectedProps=a,this.cache=new Map,this.deleteCache=new Map}rePublish(){var t,e,i,s;if(this.channel.canPush()){for(let[r,n]of this.cache)(e=(t=this.selectedProps)==null?void 0:t.onSelect)==null||e.call(t,n.user,r,n.data);for(let[r,n]of this.deleteCache)(s=(i=this.selectedProps)==null?void 0:i.onQuit)==null||s.call(i,n,r)}}getSelect(){var t,e;return((e=(t=this.selectedProps)==null?void 0:t.getSelect)==null?void 0:e.call(t))||""}onSelected(t,e,i){var s,r;this.channel.canPush()?!this.deleteCache.has(e)&&this.cache.set(e,{user:t,data:i}):(r=(s=this.selectedProps)==null?void 0:s.onSelect)==null||r.call(s,t,e,i)}onDestroy(t,e){var i,s;this.channel.canPush()?(this.deleteCache.set(e,t),this.cache.delete(e)):(s=(i=this.selectedProps)==null?void 0:i.onQuit)==null||s.call(i,t,e)}dispose(){this.destroy(),this.cache.clear(),this.deleteCache.clear()}publishSelected(t,e){super.publishSelected(t,e)}},h1=hr(Zr()),d1=class{constructor(t,e,i,s=(b=>(b=Xr())==null?void 0:b._TAB_ID_)(),r=new Go,n=null,a,o,l,u,c,h,f,d,p,m,g){this.uuid=t,this.path=e,this.isProject=i,this.windowId=s,this.channel=r,this.consistencyManager=n,this.selectedProps=l,this.setInit=u,this.onDocDetail=c,this.onUpdate=h,this.handleInit=f,this.onDelete=d,this.publishCache=p,this.onOrderNm=m,this.setMaxNum=g,this.isInit=!1,this.canSave=!0,this.sub=[],this.isInitIng=!1,this.cache={},this.deleteCache=new Map,this.pendTimer=null,this.pendCache={},this.pendCacheLength=0,this.wsBus=nr(`/${s}/notify`),n||(this._unique=Be()),this._headType=a,this.busTopic=o}get uniqueId(){return this._unique||this.consistencyManager.getUnique()}get headType(){return this._headType}setIsInitIng(t){var e;(e=this.setInit)==null||e.call(this,t),this.isInitIng=t}consoleDebug(...t){console.debug("[lc-protocol]",this._headType,this.uuid,...t)}publishLine(t,e,i,s,r,n=this.uuid,a,o,l,u,c){if(this.channel.canPush())return this.consistencyManager.remoteChange(e,r,n,t,i,s,void 0,void 0,void 0,a,void 0,o,l,c),!1;this.cache[n]||(this.cache[n]=new Map);let h=this.cache[n].get(t);return(u||!h||h.ticket<e||h.ticket===e&&(h.client<r||h.client===r&&!!h.pend!=!!a))&&this.cache[n].set(t,{client:r,ticket:e,dataType:s,data:i,pend:a,unique:o,pChange:h?void 0:l,num:c}),!0}onDocHead(){}onEnd(){}setDocType(t,e){t===this.uuid&&(this._headType=e)}setBusTopic(t){this.busTopic=t}publish(){var e,i,s;if(this.publishCache)return this.publishCache();let t=!1;for(let[r,n]of this.deleteCache){if(this.channel.canPush()){(e=this.onDelete)==null||e.call(this,n),delete this.cache[r];continue}t=!0;break}if(t)return t;for(let r in this.cache){let n=this.cache[r].keys();for(let a of n){let o=this.cache[r].get(a);if(t=this.publishLine(a,o.ticket,o.data,o.dataType,o.client,r,o.pend,o.unique,o.pChange,!1,o.num),t)break;this.cache[r].delete(a)}if(t)break}return(s=(i=this.selectManager)==null?void 0:i.rePublish)==null||s.call(i),t}publishSelected(t,e){this.selectManager.publishSelected(t,e)}clear(){var t,e;for(let i of this.sub)i.cancel();this.sub.length=0,this.cache={},this.deleteCache.clear(),this.setIsInitIng(!1),this.channel.removeCompiler(this),(e=(t=this.selectManager)==null?void 0:t.dispose)==null||e.call(t),this.selectManager=null,this.isInit=!1,this.setIsInitIng(!1)}async init(t=!0,e=!0,i=!0,s,r,n,a){try{if(this.isInit)return{success:!0};if(this.isInitIng)throw new Error("\u6B63\u5728\u521D\u59CB\u5316\u4E2D");return this.isProject?await this.initProject(t,e,i,s,n,a):await this.initLib(i,s,r,n,a)}catch(o){throw this.clear(),new Error(`${this._headType}+'Compiler' ${this.uuid} init false: ${(o==null?void 0:o.message)||o||""}`,{cause:o})}finally{this.isInitIng=!1}}async flowRead(t){let e=this.consistencyManager.flowParseFull(),i=e.update,s=this;e.update=r=>{if(s.isDestroy)return!0;i(r)},await(0,h1.flowRead)(t,e)}pushOnLine(t,e){if(this.consistencyManager)for(let i of t)this.publishLine(i[0],i[1],i[2],i[3],i[4],e,i[5],i[6],i[7],!1,i[8])}async initProject(t,e,i,s,r,n){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=nr(`/${this.windowId}/project/${this.path}`),r&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,l=>{if(this.onOrderNm)for(let u of l)this.onOrderNm(u[0],u[1],u[2])})),i&&this.busTopic.projectUpdate&&this.sub.push(this.dataBus.subscribe(gs(this.busTopic.projectUpdate,{uuid:this.uuid}),l=>{this.onUpdate?this.onUpdate(l):this.pushOnLine(l,this.uuid)})),i&&this.busTopic.projectCanSave&&this.sub.push(this.dataBus.subscribe(this.busTopic.projectCanSave,l=>{this.canSave=l})),i&&this.busTopic.subDelete&&this.sub.push(this.dataBus.subscribe(this.busTopic.subDelete,l=>{var u;this.channel.canPush()?(u=this.onDelete)==null||u.call(this,l):this.deleteCache.set(l[0],l)})),i&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(Yt.subMaxTick,l=>{this.consistencyManager.setMaxTicket(l.ticket,l.force)})),i&&e&&this.sub.push(this.dataBus.subscribe(Yt.subBlob,l=>{this.pushOnLine(l,"BLOB")})),i&&t&&this.sub.push(this.dataBus.subscribe(Yt.subFont,l=>{this.pushOnLine(l,"FONT")})),i&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(gs(Yt.subRevoke,{uuid:this.uuid}),l=>this.revoke(l))),!this.busTopic.getProject)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");this.isDestroy=!1;let a={doc:[this.uuid],watch:i,needNum:r,needDelete:n};e&&a.doc.push("BLOB"),t&&a.doc.push("FONT");let o=await this.dataBus.rpcCall(this.busTopic.getProject,a);if(this.isWatch=i,!this.isDestroy){if(!o.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",o);if(this.canSave=!(o!=null&&o.readOnly),this.consoleDebug("init",o.result),o.maxTicket&&this.consistencyManager&&this.consistencyManager.setMaxTicket(o.maxTicket),o.data&&this.onDocDetail&&this.onDocDetail(o.client||Be(),0,o.data,!1),o.channel&&await this.flowRead(o.channel),!this.isDestroy){if(this.handleInit?this.handleInit(o):o.result&&this.consistencyManager&&this.consistencyManager.parseFull(o.result,this.uuid,this._headType),s){let l=this.user=this.user||o.user||await this.wsBus.rpcCall(Yt.getUserL);this.selectManager=new ru(this.uuid,this.path,this.windowId,this.channel,this.dataBus,this.wsBus,this.selectedProps,l),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}}async initLib(t,e,i,s,r){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=nr(`/${this.windowId}/libWorker`),!this.busTopic.getPerson)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");let n=i?Be():"";this.isDestroy=!1;let a=await this.dataBus.rpcCall(this.busTopic.getPerson,{uuid:this.uuid,path:this.path,watch:t,channel:n,needNum:s,needDelete:r});if(this.isWatch=t,this.isDestroy)return;if(!a.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",a);this.consoleDebug("init",a.dataStr);let o=a.data||a.result;if(o&&this.onDocDetail&&this.onDocDetail(a.client||Be(),0,o,!1),s&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,l=>{if(this.onOrderNm)for(let u of l)this.onOrderNm(u[0],u[1],u[2])})),t&&this.busTopic.personUpdate&&this.sub.push(this.dataBus.subscribe(gs(this.busTopic.personUpdate,{uuid:this.uuid}),l=>{this.pushOnLine(l,this.uuid)})),t&&this.sub.push(this.dataBus.subscribe(gs(gs(Yt.subRevoke,{uuid:this.uuid}),{uuid:this.uuid}),l=>this.revoke(l))),n&&await this.flowRead(n),!this.isDestroy){if(a.dataStr&&this.consistencyManager&&this.consistencyManager.parseFull(a.dataStr),e){let l=this.user=this.user||a.user||await this.wsBus.rpcCall(Yt.getUserL);this.selectManager=new ru(this.uuid,this.path,this.windowId,this.channel,this.wsBus,this.wsBus,this.selectedProps,l),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}revoke(t){for(let e of t)this.consistencyManager&&this.consistencyManager.revoke(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],(...i)=>this.publishLine(...i)),e[10]&&this.setMaxNum&&this.setMaxNum(e[6],e[10],e[1])}cachePendData(t,e,i,s,r,n){this.pendCache[t]||(this.pendCache[t]={type:n,pend:[]}),this.pendCache[t].pend.push([e,i,r,s]),this.pendCacheLength+=s.length+1,this.pendCacheLength>1e7&&this.publishPendData(),this.pendTimer||(this.pendTimer=setTimeout(()=>{this.publishPendData(),this.pendTimer=null},0))}publishPendData(){if(this.pendCacheLength){this.dataBus.publish(Yt.pushPend,[this.pendCache,this.consistencyManager.getClient(),this.uniqueId,this.uuid]);for(let t in this.pendCache)this.pendCache[t].pend.length=0;this.pendCache={},this.pendCacheLength=0}}localChange(t,e,i,s=this.uuid,r,n){if(!this.isInit||!this.canSave||!this.consistencyManager)return 0;if(e&&!e.startsWith("{"))return console.error("\u4E0A\u4F20\u7684\u683C\u5F0F\u4E0D\u6B63\u786E",t,i,e),0;let a=this.consistencyManager.localChange(s,t,e,i,r,n);return this.cachePendData(s,t,a,e,i,r||this.headType),a}async sync(){if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u540C\u6B65");let t=Be();this.dataBus.publish(Yt.pushSync,t),await this.dataBus.pullA(gs(Yt.pullASync,{id:t}))}async destroy(){return this.isDestroy?{success:!1}:(this.consistencyManager&&this.dataBus&&this.dataBus.publish(Yt.pushRevoke,[this.uuid,this.uniqueId,this.consistencyManager.getClient()]),this.clear(),this.isDestroy=!0,this.isWatch&&this.dataBus&&!this.isProject&&this.dataBus.publish(Yt.personDestroy,{uuid:this.uuid,path:this.path}),this.isWatch&&this.dataBus&&this.busTopic.unwatch&&this.dataBus.publish(this.busTopic.unwatch,this.uuid),this.isWatch=!1,{success:!0})}async save(t=[this.uuid,"BLOB","FONT"]){try{if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u4FDD\u5B58");if(!this.consistencyManager)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let e=this.isProject?Yt.projectSave:Yt.personSave;if(!e)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let i=await this.dataBus.rpcCall(e,{uuid:this.uuid,path:this.path,docIds:t,uniqueId:this.uniqueId,client:this.consistencyManager.getClient()});return this.consoleDebug("save",i),i}catch(e){throw new Error(`${this._headType}+'Compiler' ${this.uuid} \u4FDD\u5B58\u5931\u8D25: ${(e==null?void 0:e.message)||e||""}`,{cause:e})}}async getBlob(t){return this.dataBus.rpcCall("/mgr/projectWorker/blob/getBlob",t)}async getFont(t,e,i,s,r,n,a,o){let l={text:t,fontFamily:e,fontSize:i,thickness:s,bold:r,italic:n,reverse:a,expansion:o},u=await this.dataBus.rpcCall("/mgr/projectWorker/font/get",l);return u.success?{success:!0,result:Object.assign(l,JSON.parse(u.result))}:u}async checkSave(){return await this.dataBus.rpcCall(Yt.hasSaveData,{uuid:this.uuid,uniqueId:this.uniqueId})}};var p1=(t=>(t.DIFFERENTIAL_PAIR="DIFFERENTIAL_PAIR",t.NET_CLASS="NET_CLASS",t.EQL_NET_GRP="EQL_NET_GRP",t))(p1||{});var f1=class extends uc{constructor(t){super(t)}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var O_=hr(Zr());var R_=hr(Zr());var m1=class extends uc{constructor(t,e,i,s,r,n,a,o=(l=>(l=Xr())==null?void 0:l._TAB_ID_)()){let u=new wu(o);super(u),this.encode=n,this.base=new d1(t,e,i,o,s,u,r,r==="PCB"?u1:l1,a,(...c)=>this.setIsInit(...c),(...c)=>this.onDocDetail(...c),void 0,void 0,void 0,void 0,(c,h,f)=>this.onOrderNum(c,h,f),(c,h,f)=>{this.setMaxNum(c,h,!!f),f&&this.deleteOrderNum(f)})}get dataBus(){return this.base.dataBus}set dataBus(t){this.base.dataBus=t}async init(t=!0,e=!0,i=!0,s,r=!0,n){return this.setNeedNum(r),this.base.init(t,e,i,s,!0,r,n)}async sync(){return this.base.sync()}async destroy(){return this.base.destroy()}async save(){return this.base.save()}checkSave(){return this.base.checkSave()}publishSelected(t,e){this.base.publishSelected(t,e)}uploadBlob(t,e){let i=Ea(e),s={filename:t,content:e};return{success:!0,ticket:this.localChange({id:i,data:JSON.stringify(s),dataType:"BLOB"},"BLOB","BLOB"),hash:i}}deleteBlob(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"BLOB"},"BLOB","BLOB")}}uploadFont(t){let{text:e,fontFamily:i,fontSize:s,thickness:r,bold:n,italic:a,reverse:o,expansion:l,width:u,height:c,path:h}=t,f={width:u,height:c,path:h},d=eo(e,i,s,r,n,a,o,l);return{success:!0,ticket:this.localChange({id:d,data:JSON.stringify(f),dataType:"FONT"},"FONT","FONT")}}deleteFont(t){let{text:e,fontFamily:i,fontSize:s,thickness:r,bold:n,italic:a,reverse:o,expansion:l}=t,u=eo(e,i,s,r,n,a,o,l);return{success:!0,ticket:this.localChange({id:u,data:"",dataType:"FONT"},"FONT","FONT")}}localChange(t,e=this.base.uuid,i){var r,n;let s=this.getOrderNum(t.id);return(n=(r=this.needOrderType)==null?void 0:r.includes)!=null&&n.call(r,t.dataType)&&s===void 0&&(s=this.getMaxNum(t.dataType),this.setOrderNum(t.id,s,t.dataType),this.onOrderNum(t.id,t.dataType,s)),this.base.localChange(t.id,t.data,t.dataType,e,i,s)}uploadString(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeString(t,e))}}deleteString(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"STRING"})}}uploadAttr(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeAttr(t,e))}}deleteAttr(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"ATTR"})}}uploadPanelize(t){return{success:!0,ticket:this.localChange(this.encode.encodePanelize(t))}}deletePanelize(){return{success:!0,ticket:this.localChange({id:"PANELIZE",data:"",dataType:"PANELIZE"})}}uploadRuleSelector(t){return{success:!0,ticket:this.localChange(this.encode.encodeRuleSelector(t))}}deleteRuleSelector(t){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE_SELECTOR",t]),data:"",dataType:"RULE_SELECTOR"})}}uploadRule(t){return{success:!0,ticket:this.localChange(this.encode.encodeRule(t))}}deleteRule(t,e){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE",t,e]),data:"",dataType:"RULE"})}}uploadRuleTemplate(t){return{success:!0,ticket:this.localChange(this.encode.encodeRuleTemplate(t))}}uploadDimension(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeDimension(t,e))}}deleteDimension(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"DIMENSION"})}}uploadBoss(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeBoss(t,e))}}deleteBoss(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"BOSS"})}}uploadShellEntity(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeShellEntity(t,e))}}deleteShellEntity(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"SHELL_ENTITY"})}}uploadShellCut(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeShellCut(t,e))}}deleteShellCut(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"SHELLCUT"})}}uploadCrease(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeCrease(t,e))}}deleteCrease(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"CREASE"})}}uploadShell(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeShell(t,e))}}deleteShell(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"SHELL"})}}uploadFpcFill(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeFpcFill(t,e))}}deleteFpcFill(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"FPC_FILL"})}}uploadTeardrop(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeTeardrop(t,e))}}deleteTeardrop(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"TEARDROP"})}}uploadImage(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeImage(t,e))}}deleteImage(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"IMAGE"})}}uploadPoured(t,e){return{success:!0,ticket:this.localChange(this.encode.encodePoured(t,e))}}deletePoured(t){return{success:!0,ticket:this.localChange({id:Ve(t,"POURED"),data:"",dataType:"POURED"})}}uploadPour(t,e){return{success:!0,ticket:this.localChange(this.encode.encodePour(t,e))}}deletePour(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"POUR"})}}uploadRegion(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeRegion(t,e))}}deleteRegion(t){let e=this.localChange({id:t,data:"",dataType:"REGION"});return this.onDelRegion(t,this.consistencyManager.getClient(),e,!0),{success:!0,ticket:e}}uploadFill(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeFill(t,e))}}deleteFill(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"FILL"})}}uploadLayerFill(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeLayerFill(t,e))}}deleteLayerFill(t){return{success:!0,ticket:this.localChange({id:Ve(t,"LAYER_FILL"),data:"",dataType:"LAYER_FILL"})}}uploadPoly(t,e){return{success:!0,ticket:this.localChange(this.encode.encodePoly(t,e))}}deletePoly(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"POLY"})}}uploadEQLenGrp(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeEQLenGrp(t,e))}}deleteEQLenGrp(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"EQLEN_GRP"})}}uploadObj(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeObj(t,e))}}deleteObj(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"OBJ"})}}uploadArc(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeArc(t,e))}}deleteArc(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"ARC"})}}uploadLine(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeLine(t,e))}}deleteLine(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"LINE"})}}uploadPad(t,e){return{success:!0,ticket:this.localChange(this.encode.encodePad(t,e))}}deletePad(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"PAD"})}}uploadVia(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeVia(t,e))}}deleteVia(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"VIA"})}}uploadPreference(t){return{success:!0,ticket:this.localChange(this.encode.encodePreference(t))}}uploadSilkOpts(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeSilkOpts(t,e))}}deleteSilkOpts(t){return{success:!0,ticket:this.localChange({id:Ve(t,"SILK_OPTS"),data:"",dataType:"SILK_OPTS"})}}uploadGroup(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeGroup(t,e))}}deleteGroup(t){return{success:!0,ticket:this.localChange({id:t,data:"",dataType:"GROUP"})}}uploadPrimitive(t,e){return{success:!0,ticket:this.localChange(this.encode.encodePrimitive(t,e))}}deletePrimitive(t){return{success:!0,ticket:this.localChange({id:Ve(t,"PRIMITIVE"),data:"",dataType:"PRIMITIVE"})}}uploadNet(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeNet(t,e))}}deleteNet(t){return{success:!0,ticket:this.localChange({id:Ve(t,"NET"),data:"",dataType:"NET"})}}uploadActiveLayer(t){return{success:!0,ticket:this.localChange(this.encode.encodeActiveLayer(t))}}uploadLayerPhys(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeLayerPhys(t,e))}}deleteLayerPhys(t){return{success:!0,ticket:this.localChange({id:Ve(t,"LAYER_PHYS"),data:"",dataType:"LAYER_PHYS"})}}uploadLayer(t,e){return{success:!0,ticket:this.localChange(this.encode.encodeLayer(t,e))}}deleteLayer(t){return{success:!0,ticket:this.localChange({id:Ve(t,"LAYER"),data:"",dataType:"LAYER"})}}uploadCanvas(t){return{success:!0,ticket:this.localChange(this.encode.encodeCanvas(t))}}uploadBoard(t){return{success:!0,ticket:this.localChange({id:"BOARD",data:JSON.stringify(t),dataType:"BOARD"})}}deleteBoard(){return{success:!0,ticket:this.localChange({id:"BOARD",data:"",dataType:"BOARD"})}}};var cc=class extends m1{constructor(t,e,i,s,r=(n=>(n=Xr())==null?void 0:n._TAB_ID_)()){super(t,e,i,s,"FOOTPRINT",new lc,{getSelect:()=>{var a;return(a=this.canvasSelected)==null?void 0:a.call(this)},onSelect:(...a)=>{var o;return(o=this.onSelectChange)==null?void 0:o.call(this,a[0],a[1],a[2])},onQuit:(...a)=>{var o;return(o=this.onSelectQuit)==null?void 0:o.call(this,a[0],a[1])}},r),this.uuid=t,this.path=e,this.isProject=i,this.windowId=r}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var g1=class extends f1{constructor(){super(...arguments),this.data={}}onBoard(t,e,i,s){}onDelBoard(t,e,i){}onLayerFill(t,e,i,s,r){}onDelLayerFill(t,e,i,s){}onBlob(t,e,i,s,r){}onDelBlob(t,e,i,s){}onFont(t,e,i,s){}onDelFont(t,e,i,s){}onString(t,e,i,s,r,n){this.data[t]=r}onDelString(t,e,i,s){delete this.data[t]}onStringNum(t,e){}onAttr(t,e,i,s,r,n){this.data[t]=r}onDelAttr(t,e,i,s){delete this.data[t]}onAttrNum(t,e){}onPanelizeSide(t,e,i,s){}onDelPanelizeSide(t,e,i,s){}onPanelizeStamp(t,e,i,s){}onDelPanelizeStamp(t,e,i,s){}onPanelize(t,e,i,s){}onDelPanelize(t,e,i){}onRuleSelector(t,e,i,s){}onDelRuleSelector(t,e,i,s){}onRule(t,e,i,s){}onDelRule(t,e,i,s,r){}onRuleTemplate(t,e,i,s){}onDimension(t,e,i,s,r,n){this.data[t]=r}onDelDimension(t,e,i,s){delete this.data[t]}onDimensionNum(t,e){}onBoss(t,e,i,s,r,n){this.data[t]=r}onDelBoss(t,e,i,s){delete this.data[t]}onBossNum(t,e){}onShellEntity(t,e,i,s,r,n){this.data[t]=r}onDelShellEntity(t,e,i,s){}onShellEntityNum(t,e){}onShellCut(t,e,i,s,r,n){this.data[t]=r}onDelShellCut(t,e,i,s){delete this.data[t]}onShellCutNum(t,e){}onCrease(t,e,i,s,r,n){this.data[t]=r}onDelCrease(t,e,i,s){delete this.data[t]}onCreaseNum(t,e){}onShell(t,e,i,s,r,n){this.data[t]=r}onDelShell(t,e,i,s){delete this.data[t]}onShellNum(t,e){}onFpcFill(t,e,i,s,r,n){this.data[t]=r}onDelFpcFill(t,e,i,s){delete this.data[t]}onFpcFillNum(t,e){}onTeardrop(t,e,i,s,r,n){this.data[t]=r}onDelTeardrop(t,e,i,s){delete this.data[t]}onTeardropNum(t,e){}onImage(t,e,i,s,r,n){this.data[t]=r}onDelImage(t,e,i,s){delete this.data[t]}onImageNum(t,e){}onPoured(t,e,i,s,r,n){this.data[t]=r}onDelPoured(t,e,i,s){delete this.data[t]}onPouredNum(t,e){}onPour(t,e,i,s,r,n){this.data[t]=r}onDelPour(t,e,i,s){delete this.data[t]}onPourNum(t,e){}onRegion(t,e,i,s,r,n){this.data[t]=r}onDelRegion(t,e,i,s){delete this.data[t]}onRegionNum(t,e){}onFill(t,e,i,s,r,n){this.data[t]=r}onDelFill(t,e,i,s){delete this.data[t]}onFillNum(t,e){}onPoly(t,e,i,s,r,n){this.data[t]=r}onDelPoly(t,e,i,s){delete this.data[t]}onPolyNum(t,e){}onEQLenGrp(t,e,i,s,r){this.data[t]=s}onDelEQLenGrp(t,e,i,s){delete this.data[t]}onDelProp(t,e,i,s){delete this.data[t]}onObj(t,e,i,s,r,n){this.data[t]=r}onDelObj(t,e,i,s){delete this.data[t]}onObjNum(t,e){}onArc(t,e,i,s,r,n){this.data[t]=r}onDelArc(t,e,i,s){delete this.data[t]}onArcNum(t,e){}onCArc(t,e,i,s,r,n){this.data[t]=r}onDelCArc(t,e,i,s){delete this.data[t]}onCArcNum(t,e){}onLine(t,e,i,s,r,n){this.data[t]=r}onDelLine(t,e,i,s){delete this.data[t]}onLineNum(t,e){}onPad(t,e,i,s,r,n){this.data[t]=r}onDelPad(t,e,i,s){delete this.data[t]}onPadNum(t,e){}onVia(t,e,i,s,r,n){this.data[t]=r}onDelVia(t,e,i,s){delete this.data[t]}onViaNum(t,e){}onDelConnect(t,e,i,s){}onPreference(t,e,i,s){}onSilkOpts(t,e,i,s,r){this.data[t]=s}onDelSilkOpts(t,e,i,s){delete this.data[t]}onGroup(t,e,i,s,r){this.data[t]=s}onDelGroup(t,e,i,s){delete this.data[t]}onPrimitive(t,e,i,s,r){}onDelPrimitive(t,e,i,s){}onNet(t,e,i,s,r){}onDelNet(t,e,i,s){}onPartition(t,e,i,s,r,n){this.data[t]=r}onDelPartition(t,e,i,s){delete this.data[t]}onPartitionNum(t,e){}onEditorMeta(t,e,i,s){}onDocDetail(t,e,i,s){}onActiveLayer(t,e,i,s){}onLayerPhys(t,e,i,s,r){this.data[t]=s}onDelLayerPhys(t,e,i,s){delete this.data[t]}onLayer(t,e,i,s,r){this.data[t]=s}onDelLayer(t,e,i,s){}onCanvas(t,e,i,s){}},E1=class extends cc{onBoard(t,e,i,s){}onDelBoard(t,e,i){}onLayerFill(t,e,i,s,r){}onDelLayerFill(t,e,i,s){}constructor(t,e,i,s){super(t,e,i,new Go,s)}canvasSelected(){return""}onSelectChange(t,e,i){}onSelectQuit(t,e){}async getByDataType(t){let e="";if(this.isProject?(this.dataBus=this.dataBus||nr(`/${this.windowId}/project/${this.path}`),e=await this.dataBus.rpcCall("/mgr/projectWorker/getDataByType",{doc:this.uuid,dataType:t})):(this.dataBus=this.dataBus||nr(`/${this.windowId}/libWorker`),e=await this.dataBus.rpcCall("/mgr/libWorker/getDataByType",{uuid:this.uuid,path:this.path,dataType:t,docType:"FOOTPRINT"})),!e)return{};let i=new g1;return i.consistencyManager.parseFull(e,this.uuid,"FOOTPRINT"),i.data}async getPads(){return this.getByDataType("PAD")}onBlob(t,e,i,s,r){}onDelBlob(t,e,i,s){}onFont(t,e,i,s){}onDelFont(t,e,i,s){}onString(t,e,i,s,r,n){}onDelString(t,e,i,s){}onStringNum(t,e){}onAttr(t,e,i,s,r,n){}onDelAttr(t,e,i,s){}onAttrNum(t,e){}onPanelizeSide(t,e,i,s){}onDelPanelizeSide(t,e,i,s){}onPanelizeStamp(t,e,i,s){}onDelPanelizeStamp(t,e,i,s){}onPanelize(t,e,i,s){}onDelPanelize(t,e,i){}onRuleSelector(t,e,i,s){}onDelRuleSelector(t,e,i,s){}onRule(t,e,i,s){}onDelRule(t,e,i,s,r){}onRuleTemplate(t,e,i,s){}onDimension(t,e,i,s,r,n){}onDelDimension(t,e,i,s){}onDimensionNum(t,e){}onBoss(t,e,i,s,r,n){}onDelBoss(t,e,i,s){}onBossNum(t,e){}onShellEntity(t,e,i,s,r,n){}onDelShellEntity(t,e,i,s){}onShellEntityNum(t,e){}onShellCut(t,e,i,s,r,n){}onDelShellCut(t,e,i,s){}onShellCutNum(t,e){}onCrease(t,e,i,s,r,n){}onDelCrease(t,e,i,s){}onCreaseNum(t,e){}onShell(t,e,i,s,r,n){}onDelShell(t,e,i,s){}onShellNum(t,e){}onFpcFill(t,e,i,s,r,n){}onDelFpcFill(t,e,i,s){}onFpcFillNum(t,e){}onTeardrop(t,e,i,s,r,n){}onDelTeardrop(t,e,i,s){}onTeardropNum(t,e){}onImage(t,e,i,s,r,n){}onDelImage(t,e,i,s){}onImageNum(t,e){}onPoured(t,e,i,s,r,n){}onDelPoured(t,e,i,s){}onPouredNum(t,e){}onPour(t,e,i,s,r,n){}onDelPour(t,e,i,s){}onPourNum(t,e){}onRegion(t,e,i,s,r,n){}onDelRegion(t,e,i,s){}onRegionNum(t,e){}onFill(t,e,i,s,r,n){}onDelFill(t,e,i,s){}onFillNum(t,e){}onPoly(t,e,i,s,r,n){}onDelPoly(t,e,i,s){}onPolyNum(t,e){}onEQLenGrp(t,e,i,s,r){}onDelEQLenGrp(t,e,i,s){}onDelProp(t,e,i,s){}onObj(t,e,i,s,r,n){}onDelObj(t,e,i,s){}onObjNum(t,e){}onArc(t,e,i,s,r,n){}onDelArc(t,e,i,s){}onArcNum(t,e){}onCArc(t,e,i,s,r,n){}onDelCArc(t,e,i,s){}onCArcNum(t,e){}onLine(t,e,i,s,r,n){}onDelLine(t,e,i,s){}onLineNum(t,e){}onPad(t,e,i,s,r,n){}onDelPad(t,e,i,s){}onPadNum(t,e){}onVia(t,e,i,s,r,n){}onDelVia(t,e,i,s){}onViaNum(t,e){}onDelConnect(t,e,i,s){}onPreference(t,e,i,s){}onSilkOpts(t,e,i,s,r){}onDelSilkOpts(t,e,i,s){}onGroup(t,e,i,s,r){}onDelGroup(t,e,i,s){}onPrimitive(t,e,i,s,r){}onDelPrimitive(t,e,i,s){}onNet(t,e,i,s,r){}onDelNet(t,e,i,s){}onPartition(t,e,i,s,r,n){}onDelPartition(t,e,i,s){}onPartitionNum(t,e){}onEditorMeta(t,e,i,s){}onDocDetail(t,e,i,s){}onActiveLayer(t,e,i,s){}onLayerPhys(t,e,i,s,r){}onDelLayerPhys(t,e,i,s){}onLayer(t,e,i,s,r){}onDelLayer(t,e,i,s){}onCanvas(t,e,i,s){}},hc=(t=>(t.LIST="/pro-mgr/api/project/list",t.CREATE="/pro-mgr/api/project/create",t.GET="/pro-mgr/api/project/get",t.UPDATE="/pro-mgr/api/project/update",t.DELETE="/pro-mgr/api/project/delete",t.TICKET="/pro-mgr/api/project/ticket",t.TICKET1="/pro-mgr/api/project/ticket1",t.BACKUP_LIST="/pro-mgr/api/project/backupList",t.BACKUP="/pro-mgr/api/project/backup",t.GET_BACKUP="/pro-mgr/api/project/getBackup",t.DELETE_BACKUP="/pro-mgr/api/project/deleteBackup",t.ARCHIVE="/pro-mgr/api/project/archive",t.CREATE_BOARD="/pro-mgr/api/project/createBoards",t.STAR="/pro-mgr/api/project/star",t.UNSTAR="/pro-mgr/api/project/unstar",t.GET_PROFILE="/pro-mgr/api/project/getProfile",t))(hc||{}),dc=(t=>(t.LIST="/pro-mgr/api/schematic/list",t.CREATE="/pro-mgr/api/schematic/create",t.UPLOAD="/pro-mgr/api/schematic/upload",t.DELETE="/pro-mgr/api/schematic/delete",t.UPDATE="/pro-mgr/api/schematic/update",t))(dc||{}),pc=(t=>(t.LIST="/pro-mgr/api/document/list",t.SEARCH_LIST="/pro-mgr/api/document/searchList",t.CREATE="/pro-mgr/api/document/create",t.UPLOAD="/pro-mgr/api/document/upload",t.UPDATE="/pro-mgr/api/document/update",t.BATCH_UPDATE="/pro-mgr/api/document/batchUpdate",t.DELETE="/pro-mgr/api/document/delete",t.GET="/pro-mgr/api/document/get",t.GET_BY_SID="/pro-mgr/api/document/getBySid",t.MOVE="/pro-mgr/api/document/move",t.CHECK_IN="/pro-mgr/api/document/checkIn",t.CHECK_OUT="/pro-mgr/api/document/checkOut",t.GET_CHECK="/pro-mgr/api/document/getCheck",t.DELETE_PCB_RELATED="/pro-mgr/api/document/deletePcbRelated",t))(pc||{}),fc=(t=>(t.LIST="/pro-mgr/api/device/list",t.SEARCH_LIST="/pro-mgr/api/device/searchList",t.CREATE="/pro-mgr/api/device/create",t.UPLOAD="/pro-mgr/api/device/upload",t.UPDATE="/pro-mgr/api/device/update",t.BATCH_UPDATE="/pro-mgr/api/device/batchUpdate",t.GET="/pro-mgr/api/device/get",t.SEARCH_BY_USERS_AND_TITLES="/pro-mgr/api/device/searchByUsersAndTitles",t.GET_ATTR_VALUES="/pro-mgr/api/device/getAttributeValues",t.GET_ATTR_KEYS="/pro-mgr/api/device/getAttrKeys",t.DELETE="/pro-mgr/api/device/delete",t.STAR="/pro-mgr/api/device/star",t.UNSTAR="/pro-mgr/api/device/unstar",t.PLACE="/pro-mgr/api/device/place",t))(fc||{}),mc=(t=>(t.LIST="/pro-mgr/api/component/list",t.SEARCH_LIST="/pro-mgr/api/component/searchList",t.CREATE="/pro-mgr/api/component/create",t.UPLOAD="/pro-mgr/api/component/upload",t.UPDATE="/pro-mgr/api/component/update",t.BATCH_UPDATE="/pro-mgr/api/component/batchUpdate",t.DELETE="/pro-mgr/api/component/delete",t.GET="/pro-mgr/api/component/get",t.SEARCH_BY_USERS_AND_TITLES="/pro-mgr/api/component/searchByUsersAndTitles",t.STAR="/pro-mgr/api/component/star",t.UNSTAR="/pro-mgr/api/component/unstar",t.GET_HISTORY="/pro-mgr/api/component/getHistory",t.SET_HISTORY="/pro-mgr/api/component/setHistory",t.GET_HISTORY_DATA="/pro-mgr/api/component/getHistoryData",t))(mc||{}),gc=(t=>(t.LIST="/pro-mgr/api/tag/list",t.CREATE="/pro-mgr/api/tag/create",t.UPDATE="/pro-mgr/api/tag/update",t.DELETE="/pro-mgr/api/tag/delete",t))(gc||{}),Ec=(t=>(t.SEARCH_LIST="/pro-mgr/api/copper/searchList",t.SET="/pro-mgr/api/copper/set",t.DELETE="/pro-mgr/api/copper/delete",t))(Ec||{}),yc=(t=>(t.SEARCH_LIST="/pro-mgr/api/font/searchList",t.SET="/pro-mgr/api/font/set",t.DELETE="/pro-mgr/api/font/delete",t))(yc||{}),Tc=(t=>(t.SEARCH_LIST="/pro-mgr/api/blob/searchList",t.SET="/pro-mgr/api/blob/set",t))(Tc||{}),bc=(t=>(t.LIST="/pro-mgr/api/attr/list",t.SEARCH_LIST="/pro-mgr/api/attr/searchList",t.CREATE="/pro-mgr/api/attr/create",t.UPLOAD="/pro-mgr/api/attr/upload",t.DELETE="/pro-mgr/api/attr/delete",t.TICKET="/pro-mgr/api/attr/ticket",t))(bc||{}),_c=(t=>(t.GET_BACKUP="/pro-mgr/api/client/getBackup",t.GET_LIBS="/pro-mgr/api/client/getLibs",t.CREATE_LIB="/pro-mgr/api/client/createLib",t.CREATE_PROJECT="/pro-mgr/api/client/createProject",t.OPEN_PROJECT="/pro-mgr/api/client/openProject",t.CLOSE_PROJECT="/pro-mgr/api/client/closeProject",t.GET_PROJECT_PATHS="/pro-mgr/api/client/getProjectPaths",t.SELECT_PATH="/pro-mgr/api/client/selectPath",t.OPEN_DIALOG="/pro-mgr/api/client/openDialog",t.SELECT_DIR="/pro-mgr/api/client/selectDir",t.SELECT_FILE="/pro-mgr/api/client/selectFile",t.EXPORT_FILE="/pro-mgr/api/client/exportFile",t.CACHE_LIST="/pro-mgr/api/client/cacheList",t.GET_CACHE="/pro-mgr/api/client/getCache",t.SET_CACHE="/pro-mgr/api/client/setCache",t.DELETE_CACHE="/pro-mgr/api/client/deleteCache",t.PROJECT_HISTORY="/pro-mgr/api/client/projectHistory",t.DELETE_HISTORY="/pro-mgr/api/client/deletHistory",t.SET_KV_CACHE="/pro-mgr/api/client/setKVCache",t.GET_KV_CACHE="/pro-mgr/api/client/getKVCache",t.IS_EXIST_KV_CACHE="/pro-mgr/api/client/isExistKVCache",t.OPEN_URL="/pro-mgr/api/client/openURL",t))(_c||{}),Sc=(t=>(t.LOG="/pro-mgr/api/other/log",t.COMPONENT_LOG="/pro-mgr/api/other/componentLog",t.TEAMS="/pro-mgr/api/other/teams",t.GET_EDITOR_VERSION="/pro-mgr/api/other/getEditorVersion",t.SET_EDITOR_VERSION="/pro-mgr/api/other/setEditorVersion",t))(Sc||{}),Hi={PROJECT:hc,SCHEMATIC:dc,DOCUMENT:pc,DEVICE:fc,COMPONENT:mc,TAG:gc,COPPER:Ec,FONT:yc,BLOB:Tc,ATTR:bc,CLIENT:_c,OTHER:Sc},y1=(t=>(t.GET_DATA_STR="/pro-mgr/public/getDataStr",t))(y1||{}),Cn=Kr($r()),Br={bus:void 0,get messageBus(){if(Br.bus===void 0)if(typeof window<"u"){let t=ha();t._MSG_BUS_=t._MSG_BUS_||new Cn.MessageBus,Br.bus=t._MSG_BUS_}else self._WORKER_BUS_=self._WORKER_BUS_||new Cn.WorkerMessageBridge(new Cn.MessageBus,self),Br.bus=self._WORKER_BUS_;return Br.bus},get messageBus2(){return self._MSG_BUS2_=self._MSG_BUS2_||new Cn.MessageBus2},loginedUserUuid:void 0},ot=Br,T1=(t=>(t.BOTTOM_COMPONENT_LIB="BOTTOM_COMPONENT_LIB",t.DIALOG="DIALOG",t))(T1||{}),b1=["S","F","P","3D"],_1=["F","3D"],S1=(t=>(t.ZIP=".zip",t.PRJ=".epro",t.PRJ2=".epro2",t.EPRU=".epru",t.SCH=".esch",t.PCB=".epcb",t.PANEL=".epan",t.PANEL_LIB=".epanl",t.SYMBOL=".esym",t.FOOTPRINT=".efoo",t.INSTANCE=".eins",t.COPPER=".ecop",t.BLOB=".eblob",t.FONT=".efon",t.ELIBZ=".elibz",t.ELIBZ2=".elibz2",t.ELIBU=".elibu",t.IMAGE=".webp",t))(S1||{}),dr="|",I1=/^[^|]+(\|[^|]+)?$/,A1=(t=>(t.Board="Board",t.Schematic="Schematic",t.Sheet="Sheet",t.Pcb="Pcb",t.Panel="Panel",t.SchCanvas="SchCanvas",t.PcbCanvas="PcbCanvas",t.PanelCanvas="PanelCanvas",t))(A1||{}),O1=(t=>(t.Device="Device",t.Symbol="Symbol",t.Footprint="Footprint",t))(O1||{}),nu=[{value:"",text:"All"},{value:2,text:"Component"},{value:20,text:{content:"symbolType",value:"Drawing",options:null}},{value:18,text:"Net Flag"},{value:19,text:"Net Port"},{value:25,text:"Off Page Connector"},{value:31,text:"Differential Pairs Flag"},{value:21,text:{content:"symbolType",value:"Non-Electronic Flag",options:null}},{value:22,text:"Short Flag"}],au=[{value:"",text:"All"},{value:2,text:"Component Symbol"},{value:20,text:"Drawing Symbol"},{value:18,text:"Netflag Symbol"},{value:19,text:"Netport Symbol"},{value:25,text:"Off Page Connector Symbol"},{value:31,text:"Differential Pairs Flag Symbol"},{value:21,text:"Non-Electronic Symbol"},{value:22,text:"Short Flag"}],R1=["S"],D1=["S"],w1=["S"],C1=["3D"],N1={footprint:_1,device:b1,symbol:R1,model3D:C1,panelLib:D1,cbb:w1,modelSimLib:[]};async function P1(t){let e=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map(s=>s.toString(16).padStart(2,"0")).join("")}var Ic=[2,20,18,19,21,22,17,25,31];function ra(t){return t&&Ic.indexOf(t)>=0}function Ac(t){return Ic.indexOf(t)>=0&&t!==17}function L1(t){return t===""?!1:!!(t&&I1.test(t))}var v1=async t=>{let{keys:e,values:i}=Oc(t);return await P1([...e,...i].sort().join(""))},Oc=t=>{let e=new Set,i=new Set;for(let s in t){let r=t[s];if(e.add(s),Array.isArray(r))i.add(JSON.stringify(r.sort()));else if(Object.prototype.toString.call(r)==="[object Object]"){let{keys:n,values:a}=Oc(r);e=new Set([...e,...n]),i=new Set([...i,...a])}else i.add(JSON.stringify(r))}return{keys:e,values:i}};function ou(t){let{uuid:e,path:i}=t;return e?e+(i?`${dr}${i}`:""):void 0}function x1(t){let{source:e,path:i}=t;return e+(i?`${dr}${i}`:"")}async function Ka(t,e){if(e)return e;let{updateTime:i}=t;return i?String(i):await v1(t)}async function M1(t){let{data:e,force:i=!0,defalut:s}=t,{source:r,version:n}=e;r?(L1(r)||(e.source=ou(e)),r.includes(dr)||(e.source=x1(e)),n?n==="1"&&(e.version=await Ka(e)):e.version=await Ka(e,s)):i&&(e.source=ou(e),e.version=await Ka(e,s))}function Rc(){let t=navigator.userLanguage||navigator.language;return t&&t.includes("zh")?"zh-cn":"en"}function $a(t){let{tags:e,custom_tags:i="[]"}=t;if((!i||i==="[]")&&e){if(Array.isArray(e)&&e.length)i=JSON.stringify(e);else if(Object.prototype.toString.call(e)==="[object Object]"){let s=Rc()==="en",r=[];if(e.parent_tag){let{name:n,name_cn:a}=e.parent_tag;if(s&&n?r.push(n):!s&&a?r.push(a):n&&r.push(n),e.child_tag){let{name:o,name_cn:l}=e.child_tag;s&&o?r.push(o):!s&&l?r.push(l):o&&r.push(o)}}i=JSON.stringify(r)}}return t.custom_tags=i,t.custom_tags}function lt(t){return String(t).length===13?Number(t):String(t).length===10?Number(t)*1e3:Number(t)}var Dc=(t=>t)(Dc||{}),wc=(t=>(t.GET="/PrjDB/project/getData",t.UPDATE="/PrjDB/project/updateData",t.COUNT_DOC="/PrjDB/project/countDoc",t.GET_HISTORY_NODE="/PrjDB/project/getHistoricalNodes",t.GET_HISTORY_UPDATETIME="/PrjDB/project/getHistoryUpdatetime",t.GET_HISTORY_PROJECT="/PrjDB/project/getHistoricalProject",t.START_BATCH_UPLOAD="/PrjDB/project/startBatchUpload",t.END_BATCH_UPLOAD="/PrjDB/project/endBatchUpload",t.AWAIT_UPLOAD_END="/PrjDB/project/awaitUploadEnd",t.GET_MAX_TICKET="/PrjDB/project/getMaxTicket",t.SAVE_PEND_DATA="/PrjDB/project/savePendData",t.REVOKE_PEND_DATA="/PrjDB/project/revokePendData",t.GET_CLIENT="/PrjDB/project/getClient",t.GET_BRANCH_DATA="/PrjDB/project/getBranchData",t.HISTORIES="/PrjDB/project/histories",t.COMPRESS="/PrjDB/project/compress",t.FLOW_WRITE="/PrjDB/project/flowWrite",t.GET_RELATED="/PrjDB/project/getRelated",t))(wc||{}),Cc=(t=>(t.GET="/PrjDB/config/getData",t.UPDATE="/PrjDB/config/updateData",t))(Cc||{}),Nc=(t=>(t.GET="/PrjDB/board/getData",t.ADD="/PrjDB/board/addData",t.UPDATE="/PrjDB/board/updateData",t.DELETE="/PrjDB/board/deleteData",t.GET_ALL_KV="/PrjDB/board/getAllKVData",t.GET_ALL_ARR="/PrjDB/board/getAllArrData",t.TRY_RENAME="/PrjDB/board/tryRename",t.IS_RENAME="/PrjDB/board/isRename",t.BATCH_DELETE="/PrjDB/board/batchDelete",t.GET_BIND_KEYS="/PrjDB/board/getBindKeys",t))(Nc||{}),Pc=(t=>(t.GET="/PrjDB/schematic/getData",t.GET_BY_NAME="/PrjDB/schematic/getDataByName",t.TRY_RENAME="/PrjDB/schematic/tryRename",t.UPDATE_IN_LOCAL="/PrjDB/schematic/updateDataInLocal",t.ADD="/PrjDB/schematic/addData",t.UPDATE="/PrjDB/schematic/updateData",t.DEL="/PrjDB/schematic/delData",t.GET_ALL_KV="/PrjDB/schematic/getAllKVDatas",t.GET_UUID_BY_NAME="/PrjDB/schematic/getIdByName",t.GET_NAME_BY_UUID="/PrjDB/schematic/getNameById",t.GET_DISPLAY_NAME_BY_UUID="/PrjDB/schematic/getDisplayNameById",t.GET_ALL_ARR="/PrjDB/schematic/getAllArrDatas",t.GET_BY_SOURCE_VERSION="/PrjDB/schematic/getDataBySourceAndVersion",t.GET_LAST="/PrjDB/schematic/getLastData",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/schematic/getAllArrDatasBySource",t.IS_RENAME="/PrjDB/schematic/isRename",t.BATCH_DELETE="/PrjDB/schematic/batchDelete",t))(Pc||{}),Lc=(t=>(t.ADD="/PrjDB/sheet/addData",t.DEL="/PrjDB/sheet/delData",t.UPDATE="/PrjDB/sheet/updateData",t.UPDATE_LOTS="/PrjDB/sheet/updateLotDatas",t.GET_ALL_KV="/PrjDB/sheet/getAllKVDatas",t.GET="/PrjDB/sheet/getData",t.GET_ALL_ARR="/PrjDB/sheet/getAllArrDatas",t.GET_LOTS_ARR="/PrjDB/sheet/getLotsArrDatas",t.GET_CANVAS="/PrjDB/sheet/getCanvas",t.SET_CANVAS="/PrjDB/sheet/setCanvas",t.COVER_CANVAS="/PrjDB/sheet/coverCanvas",t.WATCH_CANVAS_UPDATE="/PrjDB/sheet/watchCanvas",t.UNWATCH_CANVAS_UPDATE="/PrjDB/sheet/unwatchCanvas",t.GET_BY_SOURCE_VERSION="/PrjDB/sheet/getDataBySourceAndVersion",t.GET_LAST="/PrjDB/sheet/getLastData",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/sheet/getAllArrDatasBySource",t.TRY_RENAME="/PrjDB/sheet/tryRename",t.IS_RENAME="/PrjDB/sheet/isRename",t.BATCH_DELETE="/PrjDB/sheet/batchDelete",t.GET_ALL_KEYS="/PrjDB/sheet/getAllPrimaryKeys",t))(Lc||{}),vc=(t=>(t.ADD="/PrjDB/simulation/addData",t.DEL="/PrjDB/simulation/delData",t.UPDATE="/PrjDB/simulation/updateData",t.UPDATE_LOTS="/PrjDB/simulation/updateLotDatas",t.GET_ALL_KV="/PrjDB/simulation/getAllKVDatas",t.GET="/PrjDB/simulation/getData",t.GET_ALL_ARR="/PrjDB/simulation/getAllArrDatas",t.GET_LOTS_ARR="/PrjDB/simulation/getLotsArrDatas",t.GET_CANVAS="/PrjDB/simulation/getCanvas",t.SET_CANVAS="/PrjDB/simulation/setCanvas",t.COVER_CANVAS="/PrjDB/simulation/coverCanvas",t.WATCH_CANVAS_UPDATE="/PrjDB/simulation/watchCanvas",t.UNWATCH_CANVAS_UPDATE="/PrjDB/simulation/unwatchCanvas",t.GET_BY_SOURCE_VERSION="/PrjDB/simulation/getDataBySourceAndVersion",t.GET_LAST="/PrjDB/simulation/getLastData",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/simulation/getAllArrDatasBySource",t.TRY_RENAME="/PrjDB/simulation/tryRename",t.IS_RENAME="/PrjDB/simulation/isRename",t.BATCH_DELETE="/PrjDB/simulation/batchDelete",t.GET_ALL_KEYS="/PrjDB/simulation/getAllPrimaryKeys",t))(vc||{}),xc=(t=>(t.GET="/PrjDB/pcb/getData",t.GET_BY_TITLE="/PrjDB/pcb/getDataByTitle",t.GET_UUID_BY_TITLE="/PrjDB/pcb/getIdByTitle",t.ADD="/PrjDB/pcb/addData",t.DEL="/PrjDB/pcb/delData",t.CREATE_SUB="/PrjDB/pcb/createSub",t.UPDATE_SUB="/PrjDB/pcb/updateSubInherit",t.UPDATE="/PrjDB/pcb/updateData",t.UPDATE_LOTS="/PrjDB/pcb/updateLotDatas",t.GET_ALL_KV="/PrjDB/pcb/getAllKVDatas",t.GET_ALL_ARR="/PrjDB/pcb/getAllArrDatas",t.GET_CANVAS="/PrjDB/pcb/getCanvas",t.SET_CANVAS="/PrjDB/pcb/setCanvas",t.COVER_CANVAS="/PrjDB/pcb/coverCanvas",t.WATCH_CANVAS_UPDATE="/PrjDB/pcb/watchCanvas",t.UNWATCH_CANVAS_UPDATE="/PrjDB/pcb/unwatchCanvas",t.GET_BY_SOURCE_VERSION="/PrjDB/pcb/getDataBySourceAndVersion",t.GET_LAST="/PrjDB/pcb/getLastData",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/pcb/getAllArrDatasBySource",t.TRY_RENAME="/PrjDB/pcb/tryRename",t.IS_RENAME="/PrjDB/pcb/isRename",t.BATCH_DELETE="/PrjDB/pcb/batchDelete",t.GET_ALL_KEYS="/PrjDB/pcb/getAllPrimaryKeys",t))(xc||{}),Mc=(t=>(t.GET="/PrjDB/panel/getData",t.ADD="/PrjDB/panel/addData",t.DEL="/PrjDB/panel/delData",t.UPDATE="/PrjDB/panel/updateData",t.UPDATE_LOTS="/PrjDB/panel/updateLotDatas",t.GET_ALL_KV="/PrjDB/panel/getAllKVDatas",t.GET_ALL_ARR="/PrjDB/panel/getAllArrDatas",t.GET_CANVAS="/PrjDB/panel/getCanvas",t.SET_CANVAS="/PrjDB/panel/setCanvas",t.COVER_CANVAS="/PrjDB/panel/coverCanvas",t.WATCH_CANVAS_UPDATE="/PrjDB/panel/watchCanvas",t.UNWATCH_CANVAS_UPDATE="/PrjDB/panel/unwatchCanvas",t.TRY_RENAME="/PrjDB/panel/tryRename",t.IS_RENAME="/PrjDB/panel/isRename",t.BATCH_DELETE="/PrjDB/panel/batchDelete",t.GET_ALL_KEYS="/PrjDB/panel/getAllPrimaryKeys",t))(Mc||{}),Bc=(t=>(t.GET_BY_TITLE="/PrjDB/symbol/getDataByTitle",t.GET="/PrjDB/symbol/getData",t.ADD="/PrjDB/symbol/addData",t.CLONE="/PrjDB/symbol/cloneData",t.DEL="/PrjDB/symbol/delData",t.UPDATE="/PrjDB/symbol/updateData",t.GET_UUID_BY_TITLE="/PrjDB/symbol/getIdByTitle",t.GET_TITLE_BY_UUID="/PrjDB/symbol/getTitleById",t.GET_ALL_KV="/PrjDB/symbol/getAllKVDatas",t.GET_BY_SOURCE_VERSION="/PrjDB/symbol/getDataBySourceAndVersion",t.GET_COMPARE_TICKET="/PrjDB/symbol/getDataCompareTicket",t.GET_LAST="/PrjDB/symbol/getLastData",t.IS_EXIST="/PrjDB/symbol/isExist",t.GET_ALL_KEYS="/PrjDB/symbol/getAllPrimaryKeys",t.GET_ALL_ARR="/PrjDB/symbol/getAllArrDatas",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/symbol/getAllArrDatasBySource",t.GET_KEYS_BY_SOURCE="/PrjDB/symbol/getKeysBySource",t.GET_ALL_ARR_BY_TYPE="/PrjDB/symbol/getTypeDatas",t.GET_STR="/PrjDB/symbol/getStr",t.GET_CANVAS="/PrjDB/symbol/getCanvas",t.SET_CANVAS="/PrjDB/symbol/setCanvas",t.COVER_CANVAS="/PrjDB/symbol/coverCanvas",t.WATCH_CANVAS_UPDATE="/PrjDB/symbol/watchCanvas",t.UNWATCH_CANVAS_UPDATE="/PrjDB/symbol/unwatchCanvas",t.TRY_RENAME="/PrjDB/symbol/tryRename",t.WITH_ORIGINS="/PrjDB/symbol/withOrigins",t.IS_RENAME="/PrjDB/symbol/isRename",t.IS_CHANGE="/PrjDB/symbol/isChange",t.BATCH_DELETE="/PrjDB/symbol/batchDelete",t.GET_LIST="/PrjDB/symbol/getList",t))(Bc||{}),kc=(t=>(t.GET_BY_TITLE="/PrjDB/footprint/getDataByTitle",t.GET="/PrjDB/footprint/getData",t.IS_EXIST="/PrjDB/footprint/isExist",t.ADD="/PrjDB/footprint/addData",t.CLONE="/PrjDB/footprint/cloneData",t.DEL="/PrjDB/footprint/delData",t.GET_ALL_KV="/PrjDB/footprint/getAllKVDatas",t.UPDATE="/PrjDB/footprint/updateData",t.UPDATE_IN_LOCAL="/PrjDB/footprint/updateDataInLocal",t.GET_TITLE_BY_UUID="/PrjDB/footprint/getTitleById",t.GET_BY_SOURCE_VERSION="/PrjDB/footprint/getDataBySourceAndVersion",t.GET_COMPARE_TICKET="/PrjDB/footprint/getDataCompareTicket",t.GET_LAST="/PrjDB/footprint/getLastData",t.GET_ALL_KEYS="/PrjDB/footprint/getAllPrimaryKeys",t.GET_ALL_ARR="/PrjDB/footprint/getAllArrDatas",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/footprint/getAllArrDatasBySource",t.GET_KEYS_BY_SOURCE="/PrjDB/footprint/getKeysBySource",t.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/footprint/getAllArrDatasByPcbId",t.GET_KEYS_BY_PCB_UUID="/PrjDB/footprint/getKeysByPcbId",t.GET_STR="/PrjDB/footprint/getStr",t.GET_CANVAS="/PrjDB/footprint/getCanvas",t.SET_CANVAS="/PrjDB/footprint/setCanvas",t.COVER_CANVAS="/PrjDB/footprint/coverCanvas",t.WATCH_CANVAS_UPDATE="/PrjDB/footprint/watchCanvas",t.UNWATCH_CANVAS_UPDATE="/PrjDB/footprint/unwatchCanvas",t.TRY_RENAME="/PrjDB/footprint/tryRename",t.WITH_ORIGINS="/PrjDB/footprint/withOrigins",t.IS_CHANGE="/PrjDB/footprint/isChange",t.IS_RENAME="/PrjDB/footprint/isRename",t.BATCH_DELETE="/PrjDB/footprint/batchDelete",t.GET_LIST="/PrjDB/footprint/getList",t))(kc||{}),Fc=(t=>(t.GET="/PrjDB/device/getData",t.GET_BY_TITLE="/PrjDB/device/getDataByTitle",t.ADD="/PrjDB/device/addData",t.DEL="/PrjDB/device/delData",t.GET_ALL_KV="/PrjDB/device/getAllKVDatas",t.UPDATE="/PrjDB/device/updateData",t.GET_TITLE_BY_UUID="/PrjDB/device/getTitleById",t.GET_SYMBOL_UUID="/PrjDB/device/getSymbolIdById",t.GET_BY_SOURCE_VERSION="/PrjDB/device/getDataBySourceAndVersion",t.GET_LAST="/PrjDB/device/getLastData",t.GET_ALL_ARR_BY_SOURCE="/PrjDB/device/getAllArrDatasBySource",t.GET_KEYS_BY_SOURCE="/PrjDB/device/getKeysBySource",t.GET_COMPARE_TICKET="/PrjDB/device/getDataCompareTicket",t.IS_EXIST="/PrjDB/device/isExist",t.GET_ALL_KEYS="/PrjDB/device/getAllPrimaryKeys",t.GET_ALL_ARR="/PrjDB/device/getAllArrDatas",t.GET_ALL_ARR_BY_SYMBOL_UUID="/PrjDB/device/getAllArrDatasBySymbolId",t.GET_ALL_ARR_BY_FOOTPRINT_UUID="/PrjDB/device/getAllArrDatasByfootprintId",t.TRY_RENAME="/PrjDB/device/tryRename",t.BIND_SYMBOL="/PrjDB/device/bindSymbol",t.BIND_fOOTPRINT="/PrjDB/device/bindFootprint",t.WITH_ORIGINS="/PrjDB/device/withOrigins",t.IS_CHANGE="/PrjDB/device/isChange",t.IS_RENAME="/PrjDB/device/isRename",t.PLACE="/PrjDB/device/place",t.BATCH_DELETE="/PrjDB/device/batchDelete",t.GET_LIST="/PrjDB/device/getList",t))(Fc||{}),Uc=(t=>(t.GET="/PrjDB/attr/getData",t.UPDATE="/PrjDB/attr/updateData",t.BATCH_UPDATE="/PrjDB/attr/batchUpdateData",t.ADD="/PrjDB/attr/addData",t.DEL="/PrjDB/attr/delData",t.GET_ALL_KV="/PrjDB/attr/getAllKVDatas",t.GET_ALL_ARR="/PrjDB/attr/getAllArrDatas",t.GET_ALL_ARR_BY_HASH="/PrjDB/attr/getAllArrDatasByHash",t.BATCH_DELETE="/PrjDB/attr/batchDelete",t))(Uc||{}),jc=(t=>(t.GET="/PrjDB/blob/getData",t.ADD="/PrjDB/blob/addData",t.DEL="/PrjDB/blob/delData",t.GET_ALL_ARR="/PrjDB/blob/getAllArrDatas",t.BATCH_DELETE="/PrjDB/blob/batchDelete",t))(jc||{}),Gc=(t=>(t.GET="/PrjDB/copper/getData",t.ADD="/PrjDB/copper/addData",t.DEL_LOTS="/PrjDB/copper/delLotDatas",t.DEL="/PrjDB/copper/delData",t.GET_ALL_KEYS="/PrjDB/copper/getAllPrimaryKeys",t.UPDATE="/PrjDB/copper/updateData",t.GET_ALL_ARR="/PrjDB/copper/getAllArrDatas",t.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/copper/getAllArrDatasByPcbId",t.GET_ALL_KEYS_BY_PCB_UUID="/PrjDB/copper/getAllArrKeysByPcbId",t))(Gc||{}),Hc=(t=>(t.GET="/PrjDB/font/getData",t.ADD="/PrjDB/font/addData",t.DEL_LOTS="/PrjDB/font/delLotDatas",t.DEL="/PrjDB/font/delData",t.GET_ALL_KEYS="/PrjDB/font/getAllPrimaryKeys",t.UPDATE="/PrjDB/font/updateData",t.GET_ALL_ARR="/PrjDB/font/getAllArrDatas",t.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/font/getAllArrDatasByPcbId",t.GET_ALL_KEYS_BY_PCB_UUID="/PrjDB/font/getAllArrKeysByPcbId",t))(Hc||{}),Yc=(t=>(t.BATCH_ADD="/PrjDB/variant/batchAddVariant",t.ADD="/PrjDB/variant/addData",t.DELETE="/PrjDB/variant/deleteData",t.BATCH_DELETE="/PrjDB/variant/batchDeleteData",t.BATCH_RESTORE="/PrjDB/variant/batchRestoreData",t.GET="/PrjDB/variant/getData",t.GET_ALL_ARR_BY_SID="/PrjDB/variant/getAllArrDatasBySid",t.UPDATE_TITLE="/PrjDB/variant/updateTitle",t.UPDATE_NOT_GROUPED="/PrjDB/variant/updateNotGrouped",t.BATCH_UPDATE_SORT="/PrjDB/variant/batchUpdateZIndex",t))(Yc||{}),Vc=(t=>(t.BATCH_ADD="/PrjDB/componentGroup/batchAddData",t.ADD="/PrjDB/componentGroup/addData",t.DELETE="/PrjDB/componentGroup/deleteData",t.BATCH_DELETE="/PrjDB/componentGroup/batchDeleteData",t.BATCH_RESTORE="/PrjDB/componentGroup/batchRestoreData",t.GET="/PrjDB/componentGroup/getData",t.GET_ALL_ARR_BY_SID="/PrjDB/componentGroup/getAllArrDatasBySid",t.GET_ATTR_DATA="/PrjDB/componentGroup/getComponentGroupData",t.UPDATE_TITLE="/PrjDB/componentGroup/updateTitle",t.BATCH_UPDATE_SORT="/PrjDB/componentGroup/batchUpdateZIndex",t.BATCH_UPLOAD_VARIANT_INDEX="/PrjDB/componentGroup/batchUploadGroupSortInVariant",t.BATCH_DELETE_VARIANT_INDEX="/PrjDB/componentGroup/batchDeleteGroupSortInVariant",t.UPLOAD_ATTR_DATA="/PrjDB/componentGroup/uploadComponentGroupData",t.BATCH_DELETE_ATTR_DATA="/PrjDB/componentGroup/batchDeleteComponentGroupData",t))(Vc||{}),Tt={VARIANT:Yc,COMPONENT_GROUP:Vc,COMMON:Dc,PROJECT:wc,CONFIG:Cc,BOARD:Nc,SCHEMATIC:Pc,SHEET:Lc,SIMULATION:vc,PCB:xc,PANEL:Mc,SYMBOL:Bc,FOOTPRINT:kc,DEVICE:Fc,ATTR:Uc,BLOB:jc,COPPER:Gc,FONT:Hc},B1=Kr($r());function pr(t){return!t.data}function k1(t){return!!(t.path&&t.uuid&&t.docType&&t.isProject!==void 0&&Object.keys(t).length===4)}async function Ri(t){let{origin:e,target:i}=t,s=await Tu.getProLibSource(e);if(s.success===!1)return{success:!1,code:s.code,message:s.message};let r=s.result;if(i.isProject)if(i.docType===4){let n=[i.uuid,r,i.version,i.path];return{success:!!(await ot.messageBus.rpcCall(Tt.FOOTPRINT.COVER_CANVAS,n)).message}}else if(ra(i.docType)){let n=[i.uuid,r,i.version,i.path];return{success:!!(await ot.messageBus.rpcCall(Tt.SYMBOL.COVER_CANVAS,n)).message}}else throw new Error("Api call error!");else{let n=await Tu.getProLibSource(i);if(n.success===!1)return{success:!1,code:n.code,message:n.message};let a=n.result,o=Be(),l;if(i.docType===4)l=Na(a,r,{docType:Fr.FOOTPRINT,uuid:i.uuid,client:o});else if(i.docType===29)l=Na(a,r,{docType:Fr.PANEL_LIB,uuid:i.uuid,client:o});else if(ra(i.docType))l=Na(a,r,{docType:Fr.SYMBOL,uuid:i.uuid,client:o});else throw new Error("Api call error!");let u={uuid:i.uuid,dataStr:l},{message:c}=await ot.messageBus.rpcCall(Hi.COMPONENT.SET_HISTORY,u);return c.success===!1?{success:!1,code:c.code,message:c.message}:{success:!0}}}function F1(t){return self[t]=self[t]||new B1.BroadcastChannelMessageBus(t)}var U1=(t=>(t.OPEN="/pro-mgr/project/open",t.CLOSE="/pro-mgr/project/close",t.TEMP_OPEN="/pro-mgr/project/tempOpen",t.TEMP_OPEN_BY_STRING="/pro-mgr/project/tempOpenByString",t.TEMP_CLOSE="/pro-mgr/project/tempClose",t.ON_OPENED="/pro-mgr/project/onOpened",t.ON_TEMP_OPENED="/pro-mgr/project/onTempOpened",t.BEFORE_CLOSE="/pro-mgr/project/beforeClose",t.ON_CLOSED="/pro-mgr/project/onClosed",t.ON_TEMP_CLOSED="/pro-mgr/project/onTempClosed",t.ON_FAILED="/pro-mgr/project/onFailed",t.GET_RECENT_PROJECT_LIST="/pro-mgr/getRecentPrjList",t.UPDATE_PROJECT="/pro-mgr/updateProject",t.DEL_PROJECT="/pro-mgr/deleteProject",t.HAS="/pro-mgr/hasProject",t))(U1||{}),j1=(t=>(t.SYSTEM="system",t.INTERNAL="Internal",t.PERSONAL="personal",t.PROJECT="project",t.STAR="star",t.TEAMS="teams",t.USER="user",t.CLIENT="client",t.PUBLIC="public",t.OSHWHUB="oshwhub",t.EXTEND="extend",t))(j1||{}),G1=(t=>(t.DEVICE="device",t.SYMBOL="symbol",t.FOOTPRINT="footprint",t.CBB="cbb",t.MODEL3D="model3D",t.PANEL_LIB="panelLib",t.MODEL_SIM_LIB="modelSimLib",t))(G1||{}),Ho={D3Model:{client3DModelList:"api/client/steps"}},_t,dt=(_t=class{},_t.CANVAS_UNIT_MM="mm",_t.CANVAS_UNIT_MIL="mil",_t.HEX_BLACK_COLOR="#000000",_t.HEX_WHITE_COLOR="#FFFFFF",_t.HEX_RED_COLOR="#FF0000",_t.HEX_GREEN_COLOR="#00FF00",_t.HEX_BLUE_COLOR="#0000FF",_t.HEX_GRAY_COLOR1="#F1F1F1",_t.HEX_GRAY_COLOR2="#EFEFEF",_t.HEX_GRAY_COLOR3="#999999",_t.HEX_GRAY_COLOR4="#666666",_t.HEX_GRAY_COLOR5="#333333",_t.HEX_GRAY_COLOR6="#CCCCCC",_t.DEFAULT_PAGESIZE=50,_t.SYMBOLTYPE_ITEM_ALL_VALUE="@all",_t.SYMBOLTYPE_ITEM_ALL_TITLE="All",_t.D3MVIEW_DEFAULT_TRANSFORM="0, 0, 0, 0, 0, 0, 0, 0, 0",_t.DEVICE_INDEX_TAG="$_",_t.DEVICE_SPLIT_TAG="@_",_t.LIB_SPLIT_TAG="#_",_t.CATEGORY_ITEM_ALL_VALUE="@all",_t.CATEGORY_ITEM_ALL_TITLE="All",_t.FAVORITELIB_UUID="star",_t.SYSTEMLIB_UUID="0819f05c4eef4c71ace90d822a990e87",_t.SYSTEMLIB_UUID_ALIAS="lcsc",_t.USERLIB_ALIAS="mine",_t.PUBLICLIB_ALIAS="user",_t.STD_PUBLIC_LIB_UUID="stdPublic",_t.INTERNAL_LIB_ALIAS="Internal",_t.PERSIONAL_WORKSPACE="Personal",_t.EDU_WORKSPACE="6d84b27f18f540b6a31c4d657314ab13",_t.EDA_TEST_WORKSPACE="407ec92f2a2f4275bf08cbebf64f5e08",_t.LIB_SYSTEM_KEY="system",_t.LIB_PROJECT_KEY="project",_t.LIB_PERSONAL_KEY="personal",_t.LIB_PUBLIC_KEY="public",_t.LIB_INTERNAL_KEY="Internal",_t.LIB_FAVORITE_KEY="favorite",_t.LIB_TEMAS_KEY="teams",_t.API=Ho,_t.ERR_CODE={NORMAL:-1,DUP_NAME:-9001},_t),lu={},H1=function(t,e,i,s,r){var n=new Worker(lu[e]||(lu[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return n.onmessage=function(a){var o=a.data,l=o.$e$;if(l){var u=new Error(l[0]);u.code=l[1],u.stack=l[2],r(u,null)}else r(null,o)},n.postMessage(i,s),n},Bt=Uint8Array,ke=Uint16Array,nn=Int32Array,fr=new Bt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mr=new Bt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qr=new Bt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zc=function(t,e){for(var i=new ke(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];for(var r=new nn(i[30]),s=1;s<30;++s)for(var n=i[s];n<i[s+1];++n)r[n]=n-i[s]<<5|s;return{b:i,r}},Xc=zc(fr,2),Yo=Xc.b,na=Xc.r;Yo[28]=258,na[258]=28;var qc=zc(mr,0),Wc=qc.b,mo=qc.r,Wr=new ke(32768);for(Zt=0;Zt<32768;++Zt)Ni=(Zt&43690)>>1|(Zt&21845)<<1,Ni=(Ni&52428)>>2|(Ni&13107)<<2,Ni=(Ni&61680)>>4|(Ni&3855)<<4,Wr[Zt]=((Ni&65280)>>8|(Ni&255)<<8)>>1;var ei=function(t,e,i){for(var s=t.length,r=0,n=new ke(e);r<s;++r)t[r]&&++n[t[r]-1];var a=new ke(e);for(r=1;r<e;++r)a[r]=a[r-1]+n[r-1]<<1;var o;if(i){o=new ke(1<<e);var l=15-e;for(r=0;r<s;++r)if(t[r])for(var u=r<<4|t[r],c=e-t[r],h=a[t[r]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)o[Wr[h]>>l]=u}else for(o=new ke(s),r=0;r<s;++r)t[r]&&(o[r]=Wr[a[t[r]-1]++]>>15-t[r]);return o},Yi=new Bt(288);for(Zt=0;Zt<144;++Zt)Yi[Zt]=8;for(Zt=144;Zt<256;++Zt)Yi[Zt]=9;for(Zt=256;Zt<280;++Zt)Yi[Zt]=7;for(Zt=280;Zt<288;++Zt)Yi[Zt]=8;var cr=new Bt(32);for(Zt=0;Zt<32;++Zt)cr[Zt]=5;var Jc=ei(Yi,9,0),Kc=ei(Yi,9,1),$c=ei(cr,5,0),Zc=ei(cr,5,1),jn=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Ze=function(t,e,i){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(e&7)&i},Gn=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(e&7)},gr=function(t){return(t+7)/8|0},Ai=function(t,e,i){return(e==null||e<0)&&(e=0),(i==null||i>t.length)&&(i=t.length),new Bt(t.subarray(e,i))};var Qc=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rt=function(t,e,i){var s=new Error(e||Qc[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,Rt),!i)throw s;return s},ba=function(t,e,i,s){var r=t.length,n=s?s.length:0;if(!r||e.f&&!e.l)return i||new Bt(0);var a=!i,o=a||e.i!=2,l=e.i;a&&(i=new Bt(r*3));var u=function(xt){var gt=i.length;if(xt>gt){var bt=new Bt(Math.max(gt*2,xt));bt.set(i),i=bt}},c=e.f||0,h=e.p||0,f=e.b||0,d=e.l,p=e.d,m=e.m,g=e.n,b=r*8;do{if(!d){c=Ze(t,h,1);var y=Ze(t,h+1,3);if(h+=3,y)if(y==1)d=Kc,p=Zc,m=9,g=5;else if(y==2){var E=Ze(t,h,31)+257,_=Ze(t,h+10,15)+4,S=E+Ze(t,h+5,31)+1;h+=14;for(var A=new Bt(S),w=new Bt(19),R=0;R<_;++R)w[qr[R]]=Ze(t,h+R*3,7);h+=_*3;for(var L=jn(w),M=(1<<L)-1,B=ei(w,L,1),R=0;R<S;){var q=B[Ze(t,h,M)];h+=q&15;var H=q>>4;if(H<16)A[R++]=H;else{var V=0,W=0;for(H==16?(W=3+Ze(t,h,3),h+=2,V=A[R-1]):H==17?(W=3+Ze(t,h,7),h+=3):H==18&&(W=11+Ze(t,h,127),h+=7);W--;)A[R++]=V}}var v=A.subarray(0,E),j=A.subarray(E);m=jn(v),g=jn(j),d=ei(v,m,1),p=ei(j,g,1)}else Rt(1);else{var H=gr(h)+4,O=t[H-4]|t[H-3]<<8,x=H+O;if(x>r){l&&Rt(0);break}o&&u(f+O),i.set(t.subarray(H,x),f),e.b=f+=O,e.p=h=x*8,e.f=c;continue}if(h>b){l&&Rt(0);break}}o&&u(f+131072);for(var k=(1<<m)-1,F=(1<<g)-1,P=h;;P=h){var V=d[Gn(t,h)&k],z=V>>4;if(h+=V&15,h>b){l&&Rt(0);break}if(V||Rt(2),z<256)i[f++]=z;else if(z==256){P=h,d=null;break}else{var Y=z-254;if(z>264){var R=z-257,tt=fr[R];Y=Ze(t,h,(1<<tt)-1)+Yo[R],h+=tt}var it=p[Gn(t,h)&F],nt=it>>4;it||Rt(3),h+=it&15;var j=Wc[nt];if(nt>3){var tt=mr[nt];j+=Gn(t,h)&(1<<tt)-1,h+=tt}if(h>b){l&&Rt(0);break}o&&u(f+131072);var at=f+Y;if(f<j){var pt=n-j,ft=Math.min(j,at);for(pt+f<0&&Rt(3);f<ft;++f)i[f]=s[pt+f]}for(;f<at;++f)i[f]=i[f-j]}}e.l=d,e.p=P,e.b=f,e.f=c,d&&(c=1,e.m=m,e.d=p,e.n=g)}while(!c);return f!=i.length&&a?Ai(i,0,f):i.subarray(0,f)},Ei=function(t,e,i){i<<=e&7;var s=e/8|0;t[s]|=i,t[s+1]|=i>>8},Js=function(t,e,i){i<<=e&7;var s=e/8|0;t[s]|=i,t[s+1]|=i>>8,t[s+2]|=i>>16},Hn=function(t,e){for(var i=[],s=0;s<t.length;++s)t[s]&&i.push({s,f:t[s]});var r=i.length,n=i.slice();if(!r)return{t:Qi,l:0};if(r==1){var a=new Bt(i[0].s+1);return a[i[0].s]=1,{t:a,l:1}}i.sort(function(S,A){return S.f-A.f}),i.push({s:-1,f:25001});var o=i[0],l=i[1],u=0,c=1,h=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=r-1;)o=i[i[u].f<i[h].f?u++:h++],l=i[u!=c&&i[u].f<i[h].f?u++:h++],i[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var f=n[0].s,s=1;s<r;++s)n[s].s>f&&(f=n[s].s);var d=new ke(f+1),p=aa(i[c-1],d,0);if(p>e){var s=0,m=0,g=p-e,b=1<<g;for(n.sort(function(A,w){return d[w.s]-d[A.s]||A.f-w.f});s<r;++s){var y=n[s].s;if(d[y]>e)m+=b-(1<<p-d[y]),d[y]=e;else break}for(m>>=g;m>0;){var E=n[s].s;d[E]<e?m-=1<<e-d[E]++-1:++s}for(;s>=0&&m;--s){var _=n[s].s;d[_]==e&&(--d[_],++m)}p=e}return{t:new Bt(d),l:p}},aa=function(t,e,i){return t.s==-1?Math.max(aa(t.l,e,i+1),aa(t.r,e,i+1)):e[t.s]=i},go=function(t){for(var e=t.length;e&&!t[--e];);for(var i=new ke(++e),s=0,r=t[0],n=1,a=function(l){i[s++]=l},o=1;o<=e;++o)if(t[o]==r&&o!=e)++n;else{if(!r&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(r),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(r);n=1,r=t[o]}return{c:i.subarray(0,s),n:e}},Ks=function(t,e){for(var i=0,s=0;s<e.length;++s)i+=t[s]*e[s];return i},Vo=function(t,e,i){var s=i.length,r=gr(e+2);t[r]=s&255,t[r+1]=s>>8,t[r+2]=t[r]^255,t[r+3]=t[r+1]^255;for(var n=0;n<s;++n)t[r+n+4]=i[n];return(r+4+s)*8},Eo=function(t,e,i,s,r,n,a,o,l,u,c){Ei(e,c++,i),++r[256];for(var h=Hn(r,15),f=h.t,d=h.l,p=Hn(n,15),m=p.t,g=p.l,b=go(f),y=b.c,E=b.n,_=go(m),S=_.c,A=_.n,w=new ke(19),R=0;R<y.length;++R)++w[y[R]&31];for(var R=0;R<S.length;++R)++w[S[R]&31];for(var L=Hn(w,7),M=L.t,B=L.l,q=19;q>4&&!M[qr[q-1]];--q);var H=u+5<<3,V=Ks(r,Yi)+Ks(n,cr)+a,W=Ks(r,f)+Ks(n,m)+a+14+3*q+Ks(w,M)+2*w[16]+3*w[17]+7*w[18];if(l>=0&&H<=V&&H<=W)return Vo(e,c,t.subarray(l,l+u));var v,j,O,x;if(Ei(e,c,1+(W<V)),c+=2,W<V){v=ei(f,d,0),j=f,O=ei(m,g,0),x=m;var k=ei(M,B,0);Ei(e,c,E-257),Ei(e,c+5,A-1),Ei(e,c+10,q-4),c+=14;for(var R=0;R<q;++R)Ei(e,c+3*R,M[qr[R]]);c+=3*q;for(var F=[y,S],P=0;P<2;++P)for(var z=F[P],R=0;R<z.length;++R){var Y=z[R]&31;Ei(e,c,k[Y]),c+=M[Y],Y>15&&(Ei(e,c,z[R]>>5&127),c+=z[R]>>12)}}else v=Jc,j=Yi,O=$c,x=cr;for(var R=0;R<o;++R){var tt=s[R];if(tt>255){var Y=tt>>18&31;Js(e,c,v[Y+257]),c+=j[Y+257],Y>7&&(Ei(e,c,tt>>23&31),c+=fr[Y]);var it=tt&31;Js(e,c,O[it]),c+=x[it],it>3&&(Js(e,c,tt>>5&8191),c+=mr[it])}else Js(e,c,v[tt]),c+=j[tt]}return Js(e,c,v[256]),c+j[256]},th=new nn([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Qi=new Bt(0),eh=function(t,e,i,s,r,n){var a=n.z||t.length,o=new Bt(s+a+5*(1+Math.ceil(a/7e3))+r),l=o.subarray(s,o.length-r),u=n.l,c=(n.r||0)&7;if(e){c&&(l[0]=n.r>>3);for(var h=th[e-1],f=h>>13,d=h&8191,p=(1<<i)-1,m=n.p||new ke(32768),g=n.h||new ke(p+1),b=Math.ceil(i/3),y=2*b,E=function(Wt){return(t[Wt]^t[Wt+1]<<b^t[Wt+2]<<y)&p},_=new nn(25e3),S=new ke(288),A=new ke(32),w=0,R=0,L=n.i||0,M=0,B=n.w||0,q=0;L+2<a;++L){var H=E(L),V=L&32767,W=g[H];if(m[V]=W,g[H]=V,B<=L){var v=a-L;if((w>7e3||M>24576)&&(v>423||!u)){c=Eo(t,l,0,_,S,A,R,M,q,L-q,c),M=w=R=0,q=L;for(var j=0;j<286;++j)S[j]=0;for(var j=0;j<30;++j)A[j]=0}var O=2,x=0,k=d,F=V-W&32767;if(v>2&&H==E(L-F))for(var P=Math.min(f,v)-1,z=Math.min(32767,L),Y=Math.min(258,v);F<=z&&--k&&V!=W;){if(t[L+O]==t[L+O-F]){for(var tt=0;tt<Y&&t[L+tt]==t[L+tt-F];++tt);if(tt>O){if(O=tt,x=F,tt>P)break;for(var it=Math.min(F,tt-2),nt=0,j=0;j<it;++j){var at=L-F+j&32767,pt=m[at],ft=at-pt&32767;ft>nt&&(nt=ft,W=at)}}}V=W,W=m[V],F+=V-W&32767}if(x){_[M++]=268435456|na[O]<<18|mo[x];var xt=na[O]&31,gt=mo[x]&31;R+=fr[xt]+mr[gt],++S[257+xt],++A[gt],B=L+O,++w}else _[M++]=t[L],++S[t[L]]}}for(L=Math.max(L,B);L<a;++L)_[M++]=t[L],++S[t[L]];c=Eo(t,l,u,_,S,A,R,M,q,L-q,c),u||(n.r=c&7|l[c/8|0]<<3,c-=7,n.h=g,n.p=m,n.i=L,n.w=B)}else{for(var L=n.w||0;L<a+u;L+=65535){var bt=L+65535;bt>=a&&(l[c/8|0]=u,bt=a),c=Vo(l,c+1,t.subarray(L,bt))}n.i=a}return Ai(o,0,s+gr(c)+r)},Y1=(function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(i&1&&-306674912)^i>>>1;t[e]=i}return t})(),zo=function(){var t=-1;return{p:function(e){for(var i=t,s=0;s<e.length;++s)i=Y1[i&255^e[s]]^i>>>8;t=i},d:function(){return~t}}},ih=function(){var t=1,e=0;return{p:function(i){for(var s=t,r=e,n=i.length|0,a=0;a!=n;){for(var o=Math.min(a+2655,n);a<o;++a)r+=s+=i[a];s=(s&65535)+15*(s>>16),r=(r&65535)+15*(r>>16)}t=s,e=r},d:function(){return t%=65521,e%=65521,(t&255)<<24|(t&65280)<<8|(e&255)<<8|e>>8}}},Er=function(t,e,i,s,r){if(!r&&(r={l:1},e.dictionary)){var n=e.dictionary.subarray(-32768),a=new Bt(n.length+t.length);a.set(n),a.set(t,n.length),t=a,r.w=n.length}return eh(t,e.level==null?6:e.level,e.mem==null?r.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,i,s,r)},sh=function(t,e){var i={};for(var s in t)i[s]=t[s];for(var s in e)i[s]=e[s];return i},uu=function(t,e,i){for(var s=t(),r=t.toString(),n=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<s.length;++a){var o=s[a],l=n[a];if(typeof o=="function"){e+=";"+l+"=";var u=o.toString();if(o.prototype)if(u.indexOf("[native code]")!=-1){var c=u.indexOf(" ",8)+1;e+=u.slice(c,u.indexOf("(",c))}else{e+=u;for(var h in o.prototype)e+=";"+l+".prototype."+h+"="+o.prototype[h].toString()}else e+=u}else i[l]=o}return e},Nn=[],V1=function(t){var e=[];for(var i in t)t[i].buffer&&e.push((t[i]=new t[i].constructor(t[i])).buffer);return e},z1=function(t,e,i,s){if(!Nn[i]){for(var r="",n={},a=t.length-1,o=0;o<a;++o)r=uu(t[o],r,n);Nn[i]={c:uu(t[a],r,n),e:n}}var l=sh({},Nn[i].e);return H1(Nn[i].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,l,V1(l),s)},Xo=function(){return[Bt,ke,nn,fr,mr,qr,Yo,Wc,Kc,Zc,Wr,Qc,ei,jn,Ze,Gn,gr,Ai,Rt,ba,Q1,rh,J1]},X1=function(){return[Bt,ke,nn,fr,mr,qr,na,mo,Jc,Yi,$c,cr,Wr,th,Qi,ei,Ei,Js,Hn,aa,go,Ks,Vo,Eo,gr,Ai,eh,Er,Z1,rh]};var q1=function(){return[qo,ah]};var W1=function(){return[lh]},rh=function(t){return postMessage(t,[t.buffer])},J1=function(t){return t&&{out:t.size&&new Bt(t.size),dictionary:t.dictionary}};var ns=function(t){return t.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){e.data.length?(t.push(e.data[0],e.data[1]),postMessage([e.data[0].length])):t.flush()}},_a=function(t,e,i,s,r,n,a){var o,l=z1(t,s,r,function(u,c){u?(l.terminate(),e.ondata.call(e,u)):Array.isArray(c)?c.length==1?(e.queuedSize-=c[0],e.ondrain&&e.ondrain(c[0])):(c[1]&&l.terminate(),e.ondata.call(e,u,c[0],c[1])):a(c)});l.postMessage(i),e.queuedSize=0,e.push=function(u,c){e.ondata||Rt(5),o&&e.ondata(Rt(4,0,1),null,!!c),e.queuedSize+=u.length,l.postMessage([u,o=c],[u.buffer])},e.terminate=function(){l.terminate()},n&&(e.flush=function(){l.postMessage([])})},tr=function(t,e){return t[e]|t[e+1]<<8},er=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Za=function(t,e){return er(t,e)+er(t,e+4)*4294967296},Kt=function(t,e,i){for(;i;++e)t[e]=i,i>>>=8},nh=function(t,e){var i=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:e.level==9?2:0,t[9]=3,e.mtime!=0&&Kt(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){t[3]=8;for(var s=0;s<=i.length;++s)t[s+10]=i.charCodeAt(s)}},qo=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&Rt(6,"invalid gzip data");var e=t[3],i=10;e&4&&(i+=(t[10]|t[11]<<8)+2);for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!t[i++]);return i+(e&2)},ah=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},oh=function(t){return 10+(t.filename?t.filename.length+1:0)},K1=function(t,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;if(t[0]=120,t[1]=s<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var r=ih();r.p(e.dictionary),Kt(t,2,r.d())}},lh=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Rt(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&Rt(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function an(t,e){return typeof t=="function"&&(e=t,t={}),this.ondata=e,t}var ji=(function(){function t(e,i){if(typeof e=="function"&&(i=e,e={}),this.ondata=i,this.o=e||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new Bt(98304),this.o.dictionary){var s=this.o.dictionary.subarray(-32768);this.b.set(s,32768-s.length),this.s.i=32768-s.length}}return t.prototype.p=function(e,i){this.ondata(Er(e,this.o,0,0,this.s),i)},t.prototype.push=function(e,i){this.ondata||Rt(5),this.s.l&&Rt(4);var s=e.length+this.s.z;if(s>this.b.length){if(s>2*this.b.length-32768){var r=new Bt(s&-32768);r.set(this.b.subarray(0,this.s.z)),this.b=r}var n=this.b.length-this.s.z;this.b.set(e.subarray(0,n),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(e.subarray(n),32768),this.s.z=e.length-n+32768,this.s.i=32766,this.s.w=32768}else this.b.set(e,this.s.z),this.s.z+=e.length;this.s.l=i&1,(this.s.z>this.s.w+8191||i)&&(this.p(this.b,i||!1),this.s.w=this.s.i,this.s.i-=2)},t.prototype.flush=function(){this.ondata||Rt(5),this.s.l&&Rt(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},t})(),$1=(function(){function t(e,i){_a([X1,function(){return[ns,ji]}],this,an.call(this,e,i),function(s){var r=new ji(s.data);onmessage=ns(r)},6,1)}return t})();function Z1(t,e){return Er(t,e||{},0,0)}var Ke=(function(){function t(e,i){typeof e=="function"&&(i=e,e={}),this.ondata=i;var s=e&&e.dictionary&&e.dictionary.subarray(-32768);this.s={i:0,b:s?s.length:0},this.o=new Bt(32768),this.p=new Bt(0),s&&this.o.set(s)}return t.prototype.e=function(e){if(this.ondata||Rt(5),this.d&&Rt(4),!this.p.length)this.p=e;else if(e.length){var i=new Bt(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length),this.p=i}},t.prototype.c=function(e){this.s.i=+(this.d=e||!1);var i=this.s.b,s=ba(this.p,this.s,this.o);this.ondata(Ai(s,i,this.s.b),this.d),this.o=Ai(s,this.s.b-32768),this.s.b=this.o.length,this.p=Ai(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(e,i){this.e(e),this.c(i)},t})(),uh=(function(){function t(e,i){_a([Xo,function(){return[ns,Ke]}],this,an.call(this,e,i),function(s){var r=new Ke(s.data);onmessage=ns(r)},7,0)}return t})();function Q1(t,e){return ba(t,{i:2},e&&e.out,e&&e.dictionary)}var D_=(function(){function t(e,i){this.c=zo(),this.l=0,this.v=1,ji.call(this,e,i)}return t.prototype.push=function(e,i){this.c.p(e),this.l+=e.length,ji.prototype.push.call(this,e,i)},t.prototype.p=function(e,i){var s=Er(e,this.o,this.v&&oh(this.o),i&&8,this.s);this.v&&(nh(s,this.o),this.v=0),i&&(Kt(s,s.length-8,this.c.d()),Kt(s,s.length-4,this.l)),this.ondata(s,i)},t.prototype.flush=function(){ji.prototype.flush.call(this)},t})();function tE(t,e){e||(e={});var i=zo(),s=t.length;i.p(t);var r=Er(t,e,oh(e),8),n=r.length;return nh(r,e),Kt(r,n-8,i.d()),Kt(r,n-4,s),r}var yo=(function(){function t(e,i){this.v=1,this.r=0,Ke.call(this,e,i)}return t.prototype.push=function(e,i){if(Ke.prototype.e.call(this,e),this.r+=e.length,this.v){var s=this.p.subarray(this.v-1),r=s.length>3?qo(s):4;if(r>s.length){if(!i)return}else this.v>1&&this.onmember&&this.onmember(this.r-s.length);this.p=s.subarray(r),this.v=0}Ke.prototype.c.call(this,i),this.s.f&&!this.s.l&&!i&&(this.v=gr(this.s.p)+9,this.s={i:0},this.o=new Bt(0),this.push(new Bt(0),i))},t})(),eE=(function(){function t(e,i){var s=this;_a([Xo,q1,function(){return[ns,Ke,yo]}],this,an.call(this,e,i),function(r){var n=new yo(r.data);n.onmember=function(a){return postMessage(a)},onmessage=ns(n)},9,0,function(r){return s.onmember&&s.onmember(r)})}return t})();function iE(t,e){var i=qo(t);return i+8>t.length&&Rt(6,"invalid gzip data"),ba(t.subarray(i,-8),{i:2},e&&e.out||new Bt(ah(t)),e&&e.dictionary)}var w_=(function(){function t(e,i){this.c=ih(),this.v=1,ji.call(this,e,i)}return t.prototype.push=function(e,i){this.c.p(e),ji.prototype.push.call(this,e,i)},t.prototype.p=function(e,i){var s=Er(e,this.o,this.v&&(this.o.dictionary?6:2),i&&4,this.s);this.v&&(K1(s,this.o),this.v=0),i&&Kt(s,s.length-4,this.c.d()),this.ondata(s,i)},t.prototype.flush=function(){ji.prototype.flush.call(this)},t})();var To=(function(){function t(e,i){Ke.call(this,e,i),this.v=e&&e.dictionary?2:1}return t.prototype.push=function(e,i){if(Ke.prototype.e.call(this,e),this.v){if(this.p.length<6&&!i)return;this.p=this.p.subarray(lh(this.p,this.v-1)),this.v=0}i&&(this.p.length<4&&Rt(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),Ke.prototype.c.call(this,i)},t})(),sE=(function(){function t(e,i){_a([Xo,W1,function(){return[ns,Ke,To]}],this,an.call(this,e,i),function(s){var r=new To(s.data);onmessage=ns(r)},11,0)}return t})();var cu=(function(){function t(e,i){this.o=an.call(this,e,i)||{},this.G=yo,this.I=Ke,this.Z=To}return t.prototype.i=function(){var e=this;this.s.ondata=function(i,s){e.ondata(i,s)}},t.prototype.push=function(e,i){if(this.ondata||Rt(5),this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new Bt(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,i),this.p=null)}},t})(),C_=(function(){function t(e,i){cu.call(this,e,i),this.queuedSize=0,this.G=eE,this.I=uh,this.Z=sE}return t.prototype.i=function(){var e=this;this.s.ondata=function(i,s,r){e.ondata(i,s,r)},this.s.ondrain=function(i){e.queuedSize-=i,e.ondrain&&e.ondrain(i)}},t.prototype.push=function(e,i){this.queuedSize+=e.length,cu.prototype.push.call(this,e,i)},t})();var hu=typeof TextEncoder<"u"&&new TextEncoder,bo=typeof TextDecoder<"u"&&new TextDecoder,ch=0;try{bo.decode(Qi,{stream:!0}),ch=1}catch{}var hh=function(t){for(var e="",i=0;;){var s=t[i++],r=(s>127)+(s>223)+(s>239);if(i+r>t.length)return{s:e,r:Ai(t,i-1)};r?r==3?(s=((s&15)<<18|(t[i++]&63)<<12|(t[i++]&63)<<6|t[i++]&63)-65536,e+=String.fromCharCode(55296|s>>10,56320|s&1023)):r&1?e+=String.fromCharCode((s&31)<<6|t[i++]&63):e+=String.fromCharCode((s&15)<<12|(t[i++]&63)<<6|t[i++]&63):e+=String.fromCharCode(s)}},N_=(function(){function t(e){this.ondata=e,ch?this.t=new TextDecoder:this.p=Qi}return t.prototype.push=function(e,i){if(this.ondata||Rt(5),i=!!i,this.t){this.ondata(this.t.decode(e,{stream:!0}),i),i&&(this.t.decode().length&&Rt(8),this.t=null);return}this.p||Rt(4);var s=new Bt(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var r=hh(s),n=r.s,a=r.r;i?(a.length&&Rt(8),this.p=null):this.p=a,this.ondata(n,i)},t})(),P_=(function(){function t(e){this.ondata=e}return t.prototype.push=function(e,i){this.ondata||Rt(5),this.d&&Rt(4),this.ondata(_o(e),this.d=i||!1)},t})();function _o(t,e){if(e){for(var i=new Bt(t.length),s=0;s<t.length;++s)i[s]=t.charCodeAt(s);return i}if(hu)return hu.encode(t);for(var r=t.length,n=new Bt(t.length+(t.length>>1)),a=0,o=function(h){n[a++]=h},s=0;s<r;++s){if(a+5>n.length){var l=new Bt(a+8+(r-s<<1));l.set(n),n=l}var u=t.charCodeAt(s);u<128||e?o(u):u<2048?(o(192|u>>6),o(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|t.charCodeAt(++s)&1023,o(240|u>>18),o(128|u>>12&63),o(128|u>>6&63),o(128|u&63)):(o(224|u>>12),o(128|u>>6&63),o(128|u&63))}return Ai(n,0,a)}function rE(t,e){if(e){for(var i="",s=0;s<t.length;s+=16384)i+=String.fromCharCode.apply(null,t.subarray(s,s+16384));return i}else{if(bo)return bo.decode(t);var r=hh(t),n=r.s,i=r.r;return i.length&&Rt(8),n}}var dh=function(t){return t==1?3:t<6?2:t==9?1:0};var nE=function(t,e){for(;tr(t,e)!=1;e+=4+tr(t,e+2));return[Za(t,e+12),Za(t,e+4),Za(t,e+20)]},Yn=function(t){var e=0;if(t)for(var i in t){var s=t[i].length;s>65535&&Rt(9),e+=s+4}return e},du=function(t,e,i,s,r,n,a,o){var l=s.length,u=i.extra,c=o&&o.length,h=Yn(u);Kt(t,e,a!=null?33639248:67324752),e+=4,a!=null&&(t[e++]=20,t[e++]=i.os),t[e]=20,e+=2,t[e++]=i.flag<<1|(n<0&&8),t[e++]=r&&8,t[e++]=i.compression&255,t[e++]=i.compression>>8;var f=new Date(i.mtime==null?Date.now():i.mtime),d=f.getFullYear()-1980;if((d<0||d>119)&&Rt(10),Kt(t,e,d<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>1),e+=4,n!=-1&&(Kt(t,e,i.crc),Kt(t,e+4,n<0?-n-2:n),Kt(t,e+8,i.size)),Kt(t,e+12,l),Kt(t,e+14,h),e+=16,a!=null&&(Kt(t,e,c),Kt(t,e+6,i.attrs),Kt(t,e+10,a),e+=14),t.set(s,e),e+=l,h)for(var p in u){var m=u[p],g=m.length;Kt(t,e,+p),Kt(t,e+2,g),t.set(m,e+4),e+=4+g}return c&&(t.set(o,e),e+=c),e},aE=function(t,e,i,s,r){Kt(t,e,101010256),Kt(t,e+8,i),Kt(t,e+10,i),Kt(t,e+12,s),Kt(t,e+16,r)},oa=(function(){function t(e){this.filename=e,this.c=zo(),this.size=0,this.compression=0}return t.prototype.process=function(e,i){this.ondata(null,e,i)},t.prototype.push=function(e,i){this.ondata||Rt(5),this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},t})(),L_=(function(){function t(e,i){var s=this;i||(i={}),oa.call(this,e),this.d=new ji(i,function(r,n){s.ondata(null,r,n)}),this.compression=8,this.flag=dh(i.level)}return t.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},t.prototype.push=function(e,i){oa.prototype.push.call(this,e,i)},t})(),v_=(function(){function t(e,i){var s=this;i||(i={}),oa.call(this,e),this.d=new $1(i,function(r,n,a){s.ondata(r,n,a)}),this.compression=8,this.flag=dh(i.level),this.terminate=this.d.terminate}return t.prototype.process=function(e,i){this.d.push(e,i)},t.prototype.push=function(e,i){oa.prototype.push.call(this,e,i)},t})(),x_=(function(){function t(e){this.ondata=e,this.u=[],this.d=1}return t.prototype.add=function(e){var i=this;if(this.ondata||Rt(5),this.d&2)this.ondata(Rt(4+(this.d&1)*8,0,1),null,!1);else{var s=_o(e.filename),r=s.length,n=e.comment,a=n&&_o(n),o=r!=e.filename.length||a&&n.length!=a.length,l=r+Yn(e.extra)+30;r>65535&&this.ondata(Rt(11,0,1),null,!1);var u=new Bt(l);du(u,0,e,s,o,-1);var c=[u],h=function(){for(var g=0,b=c;g<b.length;g++){var y=b[g];i.ondata(null,y,!1)}c=[]},f=this.d;this.d=0;var d=this.u.length,p=sh(e,{f:s,u:o,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(h(),f){var g=i.u[d+1];g?g.r():i.d=1}f=1}}),m=0;e.ondata=function(g,b,y){if(g)i.ondata(g,b,y),i.terminate();else if(m+=b.length,c.push(b),y){var E=new Bt(16);Kt(E,0,134695760),Kt(E,4,e.crc),Kt(E,8,m),Kt(E,12,e.size),c.push(E),p.c=m,p.b=l+m+16,p.crc=e.crc,p.size=e.size,f&&p.r(),f=1}else f&&h()},this.u.push(p)}},t.prototype.end=function(){var e=this;if(this.d&2){this.ondata(Rt(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){e.d&1&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var e=0,i=0,s=0,r=0,n=this.u;r<n.length;r++){var a=n[r];s+=46+a.f.length+Yn(a.extra)+(a.o?a.o.length:0)}for(var o=new Bt(s+22),l=0,u=this.u;l<u.length;l++){var a=u[l];du(o,e,a,a.f,a.u,-a.c-2,i,a.o),e+=46+a.f.length+Yn(a.extra)+(a.o?a.o.length:0),i+=a.b}aE(o,e,this.u.length,s,i),this.ondata(null,o,!0),this.d=2},t.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++){var s=i[e];s.t()}this.d=2},t})();var oE=(function(){function t(){}return t.prototype.push=function(e,i){this.ondata(null,e,i)},t.compression=0,t})(),M_=(function(){function t(){var e=this;this.i=new Ke(function(i,s){e.ondata(null,i,s)})}return t.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,null,i)}},t.compression=8,t})(),B_=(function(){function t(e,i){var s=this;i<32e4?this.i=new Ke(function(r,n){s.ondata(null,r,n)}):(this.i=new uh(function(r,n,a){s.ondata(r,n,a)}),this.terminate=this.i.terminate)}return t.prototype.push=function(e,i){this.i.terminate&&(e=Ai(e,0)),this.i.push(e,i)},t.compression=8,t})(),k_=(function(){function t(e){this.onfile=e,this.k=[],this.o={0:oE},this.p=Qi}return t.prototype.push=function(e,i){var s=this;if(this.onfile||Rt(5),this.p||Rt(4),this.c>0){var r=Math.min(this.c,e.length),n=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(n,!this.c):this.k[0].push(n),e=e.subarray(r),e.length)return this.push(e,i)}else{var a=0,o=0,l=void 0,u=void 0;this.p.length?e.length?(u=new Bt(this.p.length+e.length),u.set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var c=u.length,h=this.c,f=h&&this.d,d=function(){var b,y=er(u,o);if(y==67324752){a=1,l=o,p.d=null,p.c=0;var E=tr(u,o+6),_=tr(u,o+8),S=E&2048,A=E&8,w=tr(u,o+26),R=tr(u,o+28);if(c>o+30+w+R){var L=[];p.k.unshift(L),a=2;var M=er(u,o+18),B=er(u,o+22),q=rE(u.subarray(o+30,o+=30+w),!S);M==4294967295?(b=A?[-2]:nE(u,o),M=b[0],B=b[1]):A&&(M=-1),o+=R,p.c=M;var H,V={name:q,compression:_,start:function(){if(V.ondata||Rt(5),!M)V.ondata(null,Qi,!0);else{var W=s.o[_];W||V.ondata(Rt(14,"unknown compression type "+_,1),null,!1),H=M<0?new W(q):new W(q,M,B),H.ondata=function(x,k,F){V.ondata(x,k,F)};for(var v=0,j=L;v<j.length;v++){var O=j[v];H.push(O,!1)}s.k[0]==L&&s.c?s.d=H:H.push(Qi,!0)}},terminate:function(){H&&H.terminate&&H.terminate()}};M>=0&&(V.size=M,V.originalSize=B),p.onfile(V)}return"break"}else if(h){if(y==134695760)return l=o+=12+(h==-2&&8),a=3,p.c=0,"break";if(y==33639248)return l=o-=4,a=3,p.c=0,"break"}},p=this;o<c-4;++o){var m=d();if(m==="break")break}if(this.p=Qi,h<0){var g=a?u.subarray(0,l-12-(h==-2&&8)-(er(u,l-16)==134695760&&4)):u.subarray(0,o);f?f.push(g,!!a):this.k[+(a==2)].push(g)}if(a&2)return this.push(u.subarray(o),i);this.p=u.subarray(o)}i&&(this.c&&Rt(13),this.p=null)},t.prototype.register=function(e){this.o[e.compression]=e},t})();var Ni,Zt,lE=(t=>(t[t.UNAUTHORIZED=401]="UNAUTHORIZED",t[t.LOGIN_FAIL=402]="LOGIN_FAIL",t[t.PERMISSION_DENIED=422]="PERMISSION_DENIED",t[t.PERMISSION_DENIED1=1111111]="PERMISSION_DENIED1",t[t.PERMISSION_DENIED_PARAMS=1111112]="PERMISSION_DENIED_PARAMS",t[t.DATA_NOT_FOUND=1111113]="DATA_NOT_FOUND",t[t.PARAMS_DATA_NOT_FOUND=1111114]="PARAMS_DATA_NOT_FOUND",t[t.REQUEST_PARAM_ILLEGAL=42222]="REQUEST_PARAM_ILLEGAL",t[t.REQUEST_PARAM_ILLEGAL1=1111115]="REQUEST_PARAM_ILLEGAL1",t[t.REQUEST_PARAMS_ILLEGAL2=1111116]="REQUEST_PARAMS_ILLEGAL2",t[t.REQUEST_PARAMS_NOT_NULL=1111117]="REQUEST_PARAMS_NOT_NULL",t[t.REQUEST_PARAMS_NOT_ALL_NULL=1111118]="REQUEST_PARAMS_NOT_ALL_NULL",t[t.REQUEST_PARAMS_MUST_ARRAY=1111119]="REQUEST_PARAMS_MUST_ARRAY",t[t.REQUEST_PARAMS_MUST_STRING=1111120]="REQUEST_PARAMS_MUST_STRING",t[t.REQUEST_PARAMS_MUST_NUMBER=1111121]="REQUEST_PARAMS_MUST_NUMBER",t[t.REQUEST_PARAMS_MUST_NUMBER_ARRAY=1111122]="REQUEST_PARAMS_MUST_NUMBER_ARRAY",t[t.REQUEST_PARAMS_MUST_STRING_ARRAY=1111123]="REQUEST_PARAMS_MUST_STRING_ARRAY",t[t.REQUEST_PARAMS_LENGTH_ERROR=1111124]="REQUEST_PARAMS_LENGTH_ERROR",t[t.REQUEST_PARAMS_TYPE_ERROR=1111125]="REQUEST_PARAMS_TYPE_ERROR",t[t.ILLEGAL_NAME=2001]="ILLEGAL_NAME",t[t.ILLEGAL_NAME1=1111126]="ILLEGAL_NAME1",t[t.ILLEGAL_NAME_ZH=1111128]="ILLEGAL_NAME_ZH",t[t.UUID_ERROR=1111127]="UUID_ERROR",t[t.DUPLICATE_DATA=1000001]="DUPLICATE_DATA",t[t.DUPLICATE_DATA1=11e3]="DUPLICATE_DATA1",t[t.DUPLICATE_DATA_PARAMS=1000017]="DUPLICATE_DATA_PARAMS",t[t.UPLOAD_LIMIT=10034]="UPLOAD_LIMIT",t[t.MORE_THAN_LIMIT=1000003]="MORE_THAN_LIMIT",t[t.FILE_MORE_THAN_LIMIT=1000004]="FILE_MORE_THAN_LIMIT",t[t.PARAMS_MORE_THAN_LIMIT=1000005]="PARAMS_MORE_THAN_LIMIT",t[t.IMAGE_MORE_THAN_LIMIT_PARAMS=1000006]="IMAGE_MORE_THAN_LIMIT_PARAMS",t[t.FILE_MORE_THAN_LIMIT_PARAMS=1000007]="FILE_MORE_THAN_LIMIT_PARAMS",t[t.END_MUST_AFTER_START=1000019]="END_MUST_AFTER_START",t[t.REQUEST_PARAMS_TIME_ERROR=1000009]="REQUEST_PARAMS_TIME_ERROR",t[t.FILES_PATH_NOT_FOUND=1000018]="FILES_PATH_NOT_FOUND",t[t.FILES_DATA_NOT_FOUND=1000011]="FILES_DATA_NOT_FOUND",t[t.FILES_TYPE_ERROR=1000012]="FILES_TYPE_ERROR",t[t.FILES_TYPE_MUST_BE_ONE=1000013]="FILES_TYPE_MUST_BE_ONE",t[t.SET_WATERMARK_FAIL=1000014]="SET_WATERMARK_FAIL",t[t.MYSQL_CRUD_ERROR=1000015]="MYSQL_CRUD_ERROR",t[t.PARAMS_JSON_FAILED=1000016]="PARAMS_JSON_FAILED",t[t.MYSQL_ERROR=3000001]="MYSQL_ERROR",t[t.NOT_FOUND=404]="NOT_FOUND",t[t.PRJ_NAME_EXISTS=2002]="PRJ_NAME_EXISTS",t[t.BACKUP_NAME_EXISTS=3002]="BACKUP_NAME_EXISTS",t[t.PRJ_NOT_EXIST=2000001]="PRJ_NOT_EXIST",t[t.ERROR_PATH=4000002]="ERROR_PATH",t[t.PROJECT_NOT_FOUND=6000001]="PROJECT_NOT_FOUND",t[t.TITLE_ILLEGAL_LEN=2003]="TITLE_ILLEGAL_LEN",t[t.FILE_READ_ONLY=1000002]="FILE_READ_ONLY",t[t.FILE_READ_ONLY1=1000008]="FILE_READ_ONLY1",t[t.DATA_NOT_EXIST=1000010]="DATA_NOT_EXIST",t[t.LIB_NOT_EXIST=2000001]="LIB_NOT_EXIST",t[t.CONFIG_API_URLS_ERROR=3001001]="CONFIG_API_URLS_ERROR",t[t.ONE_CLICK_ORDER_NOT_OPEN=3001002]="ONE_CLICK_ORDER_NOT_OPEN",t[t.MATERIAL_NOT_OPEN=3001003]="MATERIAL_NOT_OPEN",t[t.SNAPSHOT_DEPTH_LIMIT=3001004]="SNAPSHOT_DEPTH_LIMIT",t[t.OCR_SYMBOL_URL_ERROR=3001005]="OCR_SYMBOL_URL_ERROR",t[t.USER_DATA_NOT_FOUND=4000001]="USER_DATA_NOT_FOUND",t[t.USER_DISABLE_ERROR=4000012]="USER_DISABLE_ERROR",t[t.USER_EXISTS_LOGIN_ERROR=4000003]="USER_EXISTS_LOGIN_ERROR",t[t.USER_UNAUTHORIZED_MODULES_ERROR=4000004]="USER_UNAUTHORIZED_MODULES_ERROR",t[t.USER_UNAUTHORIZED_ACCESS_ERROR=4000005]="USER_UNAUTHORIZED_ACCESS_ERROR",t[t.ADMIN_NOT_CHANGE_PASSWORD=4000006]="ADMIN_NOT_CHANGE_PASSWORD",t[t.SAME_PASSWORD_NEW_PASSWORD=4000007]="SAME_PASSWORD_NEW_PASSWORD",t[t.USER_ONLINE_REGISTRATION_FAILED=4000008]="USER_ONLINE_REGISTRATION_FAILED",t[t.USER_PASSWORD_CAN_NOT_DEFAULT=4000009]="USER_PASSWORD_CAN_NOT_DEFAULT",t[t.USER_BEFORE_PASSWORD_ERROR=4000010]="USER_BEFORE_PASSWORD_ERROR",t[t.USER_PASSWORD_LENGTH_ERROR=4000011]="USER_PASSWORD_LENGTH_ERROR",t[t.ORG_ROLE_NOT_CREATE=5000001]="ORG_ROLE_NOT_CREATE",t[t.ORG_ROLE_NAME_DUPLICATE=5000002]="ORG_ROLE_NAME_DUPLICATE",t[t.ORG_ROLE_ORIGIN_ERROR=5000003]="ORG_ROLE_ORIGIN_ERROR",t[t.ORG_ROLE_NOT_DEFAULT=5000004]="ORG_ROLE_NOT_DEFAULT",t[t.ADMIN_ROLE_NOT_CHANGE=5000005]="ADMIN_ROLE_NOT_CHANGE",t[t.ADMIN_NOT_CHANGE_STATUS=5000006]="ADMIN_NOT_CHANGE_STATUS",t[t.PROJECT_ARCHIVED=6000002]="PROJECT_ARCHIVED",t[t.PROJECT_UUID_NULL=6000003]="PROJECT_UUID_NULL",t[t.PROJECT_UUID_ERROR=6000004]="PROJECT_UUID_ERROR",t[t.PROJECT_OR_TEAM_UUID_ERROR=6000005]="PROJECT_OR_TEAM_UUID_ERROR",t[t.PROJECT_NOT_PERSON_ERROR=6000006]="PROJECT_NOT_PERSON_ERROR",t[t.PROJECT_DUPLICATE_NAME=6000007]="PROJECT_DUPLICATE_NAME",t[t.ANNOTATION_HAS_BE_FOUND=6000008]="ANNOTATION_HAS_BE_FOUND",t[t.ANNOTATION_NOT_FOUND=6000009]="ANNOTATION_NOT_FOUND",t[t.ANNOTATION_CREATE_ERROR=6000010]="ANNOTATION_CREATE_ERROR",t[t.ANNOTATION_UPDATE_ERROR=6000011]="ANNOTATION_UPDATE_ERROR",t[t.ANNOTATION_DELETE_ERROR=6000012]="ANNOTATION_DELETE_ERROR",t[t.PROJECT_DUPLICATE_PATH=6000013]="PROJECT_DUPLICATE_PATH",t[t.TEAM_NOT_FOUND=7000001]="TEAM_NOT_FOUND",t[t.TEAM_UUID_NULL=7000002]="TEAM_UUID_NULL",t[t.TEAM_FOLDER_ERROR=7000003]="TEAM_FOLDER_ERROR",t[t.TEAM_FOLDER_DEEP_ERROR=7000004]="TEAM_FOLDER_DEEP_ERROR",t[t.TEAM_FOLDER_UUID_ERROR=7000005]="TEAM_FOLDER_UUID_ERROR",t[t.TEAM_URL_DUPLICATE=7000006]="TEAM_URL_DUPLICATE",t[t.TEAM_CAN_NOT_DELETE=7000007]="TEAM_CAN_NOT_DELETE",t[t.COMPONENT_UUID_NULL=8000001]="COMPONENT_UUID_NULL",t[t.COMPONENT_DATA_NOT_FOUND=8000002]="COMPONENT_DATA_NOT_FOUND",t[t.COMPONENT_NAME_DUPLICATE=8000003]="COMPONENT_NAME_DUPLICATE",t[t.COMPONENT_TYPE_ERROR=8000004]="COMPONENT_TYPE_ERROR",t[t.DELETE_SON_CATEGORY=8001001]="DELETE_SON_CATEGORY",t[t.LICENSE=9000001]="LICENSE",t[t.START_TIME=9000002]="START_TIME",t[t.END_TIME=9000003]="END_TIME",t[t.PROJECT_LIMIT=9000004]="PROJECT_LIMIT",t[t.USER_LIMIT=9000005]="USER_LIMIT",t[t.ONLINE_NUMBER_LIMIT=9000006]="ONLINE_NUMBER_LIMIT",t[t.COMPANY_CODE=9000007]="COMPANY_CODE",t[t.LIMIT_PCB=9000008]="LIMIT_PCB",t[t.LIMIT_SCH=9000009]="LIMIT_SCH",t[t.LIMIT_PANEL=9000011]="LIMIT_PANEL",t[t.TIME_ERROR=9000010]="TIME_ERROR",t[t.LICENSE_ERROR=9000012]="LICENSE_ERROR",t[t.LICENSE_TYPE_ERROR=9000013]="LICENSE_TYPE_ERROR",t[t.LICENSE_ORIGIN_ERROR=9000014]="LICENSE_ORIGIN_ERROR",t[t.BRANCH_DATA_NOT_FOUND=11000001]="BRANCH_DATA_NOT_FOUND",t[t.PARENT_UUID_ERROR=11000002]="PARENT_UUID_ERROR",t[t.BRANCH_MUST_AFTER_NODE=11000003]="BRANCH_MUST_AFTER_NODE",t[t.BRANCH_NAME_ERROR=11000004]="BRANCH_NAME_ERROR",t[t.BRANCH_NAME_DUPLICATE=11000005]="BRANCH_NAME_DUPLICATE",t[t.BRANCH_UUID_ERROR=11000006]="BRANCH_UUID_ERROR",t[t.BRANCH_NODE_SET_ERROR=11000007]="BRANCH_NODE_SET_ERROR",t[t.BRANCH_DELETE_MAIN_ERROR=11000008]="BRANCH_DELETE_MAIN_ERROR",t[t.BRANCH_CHECK_OUT_ERROR=11000009]="BRANCH_CHECK_OUT_ERROR",t[t.DOCUMENT_UUID_ERROR=12000001]="DOCUMENT_UUID_ERROR",t[t.UPDATE_FAILED=12000002]="UPDATE_FAILED",t[t.INNER_API_KEY_ERROR=1000020]="INNER_API_KEY_ERROR",t[t.BRANCH_MORE_THAN_LIMIT=11000010]="BRANCH_MORE_THAN_LIMIT",t[t.WORKSPACE_API_ERROR=1000021]="WORKSPACE_API_ERROR",t))(lE||{}),uE=(t=>(t.UNAUTHORIZED="UNAUTHORIZED",t.LOGIN_FAIL="LOGIN_FAIL",t.PERMISSION_DENIED="PERMISSION_DENIED",t.PERMISSION_DENIED1="PERMISSION_DENIED1",t.PERMISSION_DENIED_PARAMS="PERMISSION_DENIED_PARAMS",t.DATA_NOT_FOUND="DATA_NOT_FOUND",t.PARAMS_DATA_NOT_FOUND="PARAMS_DATA_NOT_FOUND",t.REQUEST_PARAM_ILLEGAL="REQUEST_PARAM_ILLEGAL",t.REQUEST_PARAM_ILLEGAL1="REQUEST_PARAM_ILLEGAL1",t.REQUEST_PARAMS_ILLEGAL2="REQUEST_PARAMS_ILLEGAL2",t.REQUEST_PARAMS_NOT_NULL="REQUEST_PARAMS_NOT_NULL",t.REQUEST_PARAMS_NOT_ALL_NULL="REQUEST_PARAMS_NOT_ALL_NULL",t.REQUEST_PARAMS_MUST_ARRAY="REQUEST_PARAMS_MUST_ARRAY",t.REQUEST_PARAMS_MUST_STRING="REQUEST_PARAMS_MUST_STRING",t.REQUEST_PARAMS_MUST_NUMBER="REQUEST_PARAMS_MUST_NUMBER",t.REQUEST_PARAMS_MUST_NUMBER_ARRAY="REQUEST_PARAMS_MUST_NUMBER_ARRAY",t.REQUEST_PARAMS_MUST_STRING_ARRAY="REQUEST_PARAMS_MUST_STRING_ARRAY",t.REQUEST_PARAMS_LENGTH_ERROR="REQUEST_PARAMS_LENGTH_ERROR",t.REQUEST_PARAMS_TYPE_ERROR="REQUEST_PARAMS_TYPE_ERROR",t.ILLEGAL_NAME="ILLEGAL_NAME",t.ILLEGAL_NAME1="ILLEGAL_NAME1",t.ILLEGAL_NAME_ZH="ILLEGAL_NAME_ZH",t.UUID_ERROR="UUID_ERROR",t.DUPLICATE_DATA="DUPLICATE_DATA",t.DUPLICATE_DATA1="DUPLICATE_DATA1",t.DUPLICATE_DATA_PARAMS="DUPLICATE_DATA_PARAMS",t.UPLOAD_LIMIT="UPLOAD_LIMIT",t.MORE_THAN_LIMIT="MORE_THAN_LIMIT",t.FILE_MORE_THAN_LIMIT="FILE_MORE_THAN_LIMIT",t.PARAMS_MORE_THAN_LIMIT="PARAMS_MORE_THAN_LIMIT",t.IMAGE_MORE_THAN_LIMIT_PARAMS="IMAGE_MORE_THAN_LIMIT_PARAMS",t.FILE_MORE_THAN_LIMIT_PARAMS="FILE_MORE_THAN_LIMIT_PARAMS",t.END_MUST_AFTER_START="END_MUST_AFTER_START",t.REQUEST_PARAMS_TIME_ERROR="REQUEST_PARAMS_TIME_ERROR",t.FILES_PATH_NOT_FOUND="FILES_PATH_NOT_FOUND",t.FILES_DATA_NOT_FOUND="FILES_DATA_NOT_FOUND",t.FILES_TYPE_ERROR="FILES_TYPE_ERROR",t.FILES_TYPE_MUST_BE_ONE="FILES_TYPE_MUST_BE_ONE",t.SET_WATERMARK_FAIL="SET_WATERMARK_FAIL",t.MYSQL_CRUD_ERROR="MYSQL_CRUD_ERROR",t.PARAMS_JSON_FAILED="PARAMS_JSON_FAILED",t.MYSQL_ERROR="MYSQL_ERROR",t.NOT_FOUND="NOT_FOUND",t.PRJ_NAME_EXISTS="PRJ_NAME_EXISTS",t.BACKUP_NAME_EXISTS="BACKUP_NAME_EXISTS",t.PRJ_NOT_EXIST="PRJ_NOT_EXIST",t.ERROR_PATH="ERROR_PATH",t.PROJECT_NOT_FOUND="PROJECT_NOT_FOUND",t.TITLE_ILLEGAL_LEN="TITLE_ILLEGAL_LEN",t.FILE_READ_ONLY="FILE_READ_ONLY",t.FILE_READ_ONLY1="FILE_READ_ONLY1",t.DATA_NOT_EXIST="DATA_NOT_EXIST",t.LIB_NOT_EXIST="LIB_NOT_EXIST",t.CONFIG_API_URLS_ERROR="CONFIG_API_URLS_ERROR",t.ONE_CLICK_ORDER_NOT_OPEN="ONE_CLICK_ORDER_NOT_OPEN",t.MATERIAL_NOT_OPEN="MATERIAL_NOT_OPEN",t.SNAPSHOT_DEPTH_LIMIT="SNAPSHOT_DEPTH_LIMIT",t.OCR_SYMBOL_URL_ERROR="OCR_SYMBOL_URL_ERROR",t.USER_DATA_NOT_FOUND="USER_DATA_NOT_FOUND",t.USER_DISABLE_ERROR="USER_DISABLE_ERROR",t.USER_EXISTS_LOGIN_ERROR="USER_EXISTS_LOGIN_ERROR",t.USER_UNAUTHORIZED_MODULES_ERROR="USER_UNAUTHORIZED_MODULES_ERROR",t.USER_UNAUTHORIZED_ACCESS_ERROR="USER_UNAUTHORIZED_ACCESS_ERROR",t.ADMIN_NOT_CHANGE_PASSWORD="ADMIN_NOT_CHANGE_PASSWORD",t.SAME_PASSWORD_NEW_PASSWORD="SAME_PASSWORD_NEW_PASSWORD",t.USER_ONLINE_REGISTRATION_FAILED="USER_ONLINE_REGISTRATION_FAILED",t.USER_PASSWORD_CAN_NOT_DEFAULT="USER_PASSWORD_CAN_NOT_DEFAULT",t.USER_BEFORE_PASSWORD_ERROR="USER_BEFORE_PASSWORD_ERROR",t.USER_PASSWORD_LENGTH_ERROR="USER_PASSWORD_LENGTH_ERROR",t.ORG_ROLE_NOT_CREATE="ORG_ROLE_NOT_CREATE",t.ORG_ROLE_NAME_DUPLICATE="ORG_ROLE_NAME_DUPLICATE",t.ORG_ROLE_ORIGIN_ERROR="ORG_ROLE_ORIGIN_ERROR",t.ORG_ROLE_NOT_DEFAULT="ORG_ROLE_NOT_DEFAULT",t.ADMIN_ROLE_NOT_CHANGE="ADMIN_ROLE_NOT_CHANGE",t.ADMIN_NOT_CHANGE_STATUS="ADMIN_NOT_CHANGE_STATUS",t.PROJECT_ARCHIVED="PROJECT_ARCHIVED",t.PROJECT_UUID_NULL="PROJECT_UUID_NULL",t.PROJECT_UUID_ERROR="PROJECT_UUID_ERROR",t.PROJECT_OR_TEAM_UUID_ERROR="PROJECT_OR_TEAM_UUID_ERROR",t.PROJECT_NOT_PERSON_ERROR="PROJECT_NOT_PERSON_ERROR",t.PROJECT_DUPLICATE_NAME="PROJECT_DUPLICATE_NAME",t.ANNOTATION_HAS_BE_FOUND="ANNOTATION_HAS_BE_FOUND",t.ANNOTATION_NOT_FOUND="ANNOTATION_NOT_FOUND",t.ANNOTATION_CREATE_ERROR="ANNOTATION_CREATE_ERROR",t.ANNOTATION_UPDATE_ERROR="ANNOTATION_UPDATE_ERROR",t.ANNOTATION_DELETE_ERROR="ANNOTATION_DELETE_ERROR",t.PROJECT_DUPLICATE_PATH="PROJECT_DUPLICATE_PATH",t.TEAM_NOT_FOUND="TEAM_NOT_FOUND",t.TEAM_UUID_NULL="TEAM_UUID_NULL",t.TEAM_FOLDER_ERROR="TEAM_FOLDER_ERROR",t.TEAM_FOLDER_DEEP_ERROR="TEAM_FOLDER_DEEP_ERROR",t.TEAM_FOLDER_UUID_ERROR="TEAM_FOLDER_UUID_ERROR",t.TEAM_URL_DUPLICATE="TEAM_URL_DUPLICATE",t.TEAM_CAN_NOT_DELETE="TEAM_CAN_NOT_DELETE",t.COMPONENT_UUID_NULL="COMPONENT_UUID_NULL",t.COMPONENT_DATA_NOT_FOUND="COMPONENT_DATA_NOT_FOUND",t.COMPONENT_NAME_DUPLICATE="COMPONENT_NAME_DUPLICATE",t.COMPONENT_TYPE_ERROR="COMPONENT_TYPE_ERROR",t.DELETE_SON_CATEGORY="DELETE_SON_CATEGORY",t.LICENSE="LICENSE",t.START_TIME="START_TIME",t.END_TIME="END_TIME",t.PROJECT_LIMIT="PROJECT_LIMIT",t.USER_LIMIT="USER_LIMIT",t.ONLINE_NUMBER_LIMIT="ONLINE_NUMBER_LIMIT",t.COMPANY_CODE="COMPANY_CODE",t.LIMIT_PCB="LIMIT_PCB",t.LIMIT_SCH="LIMIT_SCH",t.LIMIT_PANEL="LIMIT_PANEL",t.TIME_ERROR="TIME_ERROR",t.LICENSE_ERROR="LICENSE_ERROR",t.LICENSE_TYPE_ERROR="LICENSE_TYPE_ERROR",t.LICENSE_ORIGIN_ERROR="LICENSE_ORIGIN_ERROR",t.BRANCH_DATA_NOT_FOUND="BRANCH_DATA_NOT_FOUND",t.PARENT_UUID_ERROR="PARENT_UUID_ERROR",t.BRANCH_MUST_AFTER_NODE="BRANCH_MUST_AFTER_NODE",t.BRANCH_NAME_ERROR="BRANCH_NAME_ERROR",t.BRANCH_NAME_DUPLICATE="BRANCH_NAME_DUPLICATE",t.BRANCH_UUID_ERROR="BRANCH_UUID_ERROR",t.BRANCH_NODE_SET_ERROR="BRANCH_NODE_SET_ERROR",t.BRANCH_DELETE_MAIN_ERROR="BRANCH_DELETE_MAIN_ERROR",t.BRANCH_CHECK_OUT_ERROR="BRANCH_CHECK_OUT_ERROR",t.DOCUMENT_UUID_ERROR="DOCUMENT_UUID_ERROR",t.UPDATE_FAILED="UPDATE_FAILED",t.INNER_API_KEY_ERROR="INNER_API_KEY_ERROR",t.BRANCH_MORE_THAN_LIMIT="BRANCH_MORE_THAN_LIMIT",t.WORKSPACE_API_ERROR="WORKSPACE_API_ERROR",t))(uE||{}),cE=(t=>(t[t.DB_INIT_ERROR=0]="DB_INIT_ERROR",t[t.PRJ_NOT_EXIST=1]="PRJ_NOT_EXIST",t[t.NET_ERROR=2]="NET_ERROR",t[t.IS_OPENING=3]="IS_OPENING",t[t.NOT_LOGGED_IN=4]="NOT_LOGGED_IN",t[t.HAS_UNSAVED=5]="HAS_UNSAVED",t[t.DIFF_TICKET=6]="DIFF_TICKET",t))(cE||{});function Vn(t,e={}){if(!t)return"";let{code:i,message:s}=t;switch(i){case 401:return et("UNAUTHORIZED");case 402:return et("LOGIN_FAIL");case 422:return et("PERMISSION_DENIED");case 1111111:return et("PERMISSION_DENIED1");case 2000001:return et("PRJ_NOT_EXIST");case 4000002:return et("ERROR_PATH");case 6000001:return et("PROJECT_NOT_FOUND");case 1111112:return et("PERMISSION_DENIED_PARAMS",{type:s});case 1111113:return et("DATA_NOT_FOUND");case 1111114:return et("PARAMS_DATA_NOT_FOUND",{type:s});case 42222:return et("REQUEST_PARAM_ILLEGAL");case 1111115:return et("REQUEST_PARAM_ILLEGAL1");case 1111116:return et("REQUEST_PARAMS_ILLEGAL2",{type:s});case 1111117:return et("REQUEST_PARAMS_NOT_NULL",{type:s});case 1111118:return et("REQUEST_PARAMS_NOT_ALL_NULL",{type:s});case 1111119:return et("REQUEST_PARAMS_MUST_ARRAY",{type:s});case 1111120:return et("REQUEST_PARAMS_MUST_STRING",{type:s});case 1111121:return et("REQUEST_PARAMS_MUST_NUMBER",{type:s});case 1111122:return et("REQUEST_PARAMS_MUST_NUMBER_ARRAY",{type:s});case 1111123:return et("REQUEST_PARAMS_MUST_STRING_ARRAY",{type:s});case 1111124:return et("REQUEST_PARAMS_LENGTH_ERROR",{type:s});case 1111125:return et("REQUEST_PARAMS_TYPE_ERROR",{type:s});case 2001:return et("ILLEGAL_NAME");case 1111126:return et("ILLEGAL_NAME1");case 1111128:return et("ILLEGAL_NAME_ZH");case 1111127:return et("UUID_ERROR");case 1000001:return et("DUPLICATE_DATA");case 11e3:return et("DUPLICATE_DATA1");case 1000017:return et("DUPLICATE_DATA_PARAMS",{type:s});case 10034:return et("UPLOAD_LIMIT");case 1000003:return et("MORE_THAN_LIMIT");case 1000004:return et("FILE_MORE_THAN_LIMIT",{type:s});case 1000005:return et("PARAMS_MORE_THAN_LIMIT",{type:s});case 1000006:return et("IMAGE_MORE_THAN_LIMIT_PARAMS");case 1000007:return et("FILE_MORE_THAN_LIMIT_PARAMS");case 1000019:return et("END_MUST_AFTER_START");case 1000002:return et("FILE_READ_ONLY");case 1000008:return et("FILE_READ_ONLY1");case 1000010:return et("DATA_NOT_EXIST",{documentName:e.documentName});case 1000009:return et("REQUEST_PARAMS_TIME_ERROR");case 1000018:return et("FILES_PATH_NOT_FOUND");case 1000011:return et("FILES_DATA_NOT_FOUND");case 1000012:return et("FILES_TYPE_ERROR");case 1000013:return et("FILES_TYPE_MUST_BE_ONE",{type:s});case 1000014:return et("SET_WATERMARK_FAIL");case 1000015:return et("MYSQL_CRUD_ERROR",{type:s});case 1000016:return et("PARAMS_JSON_FAILED",{type:s});case 3000001:return et("MYSQL_ERROR");case 404:return et("NOT_FOUND");case 2002:return et("PRJ_NAME_EXISTS");case 3002:return et("BACKUP_NAME_EXISTS");case 2003:return et("TITLE_ILLEGAL_LEN",{documentName:e.documentName});case 2000001:return et("LIB_NOT_EXIST");case 3001001:return et("CONFIG_API_URLS_ERROR");case 3001002:return et("ONE_CLICK_ORDER_NOT_OPEN");case 3001003:return et("MATERIAL_NOT_OPEN");case 3001004:return et("SNAPSHOT_DEPTH_LIMIT");case 3001005:return et("OCR_SYMBOL_URL_ERROR");case 4000001:return et("USER_DATA_NOT_FOUND");case 4000012:return et("USER_DISABLE_ERROR");case 4000003:return et("USER_EXISTS_LOGIN_ERROR");case 4000004:return et("USER_UNAUTHORIZED_MODULES_ERROR");case 4000005:return et("USER_UNAUTHORIZED_ACCESS_ERROR");case 4000006:return et("ADMIN_NOT_CHANGE_PASSWORD");case 4000007:return et("SAME_PASSWORD_NEW_PASSWORD");case 4000008:return et("USER_ONLINE_REGISTRATION_FAILED");case 4000009:return et("USER_PASSWORD_CAN_NOT_DEFAULT");case 4000010:return et("USER_BEFORE_PASSWORD_ERROR");case 4000011:return et("USER_PASSWORD_LENGTH_ERROR");case 5000001:return et("ORG_ROLE_NOT_CREATE");case 5000002:return et("ORG_ROLE_NAME_DUPLICATE");case 5000003:return et("ORG_ROLE_ORIGIN_ERROR",{message:s});case 5000004:return et("ORG_ROLE_NOT_DEFAULT");case 5000005:return et("ADMIN_ROLE_NOT_CHANGE");case 5000006:return et("ADMIN_NOT_CHANGE_STATUS");case 6000002:return et("PROJECT_ARCHIVED");case 6000003:return et("PROJECT_UUID_NULL");case 6000004:return et("PROJECT_UUID_ERROR");case 6000005:return et("PROJECT_OR_TEAM_UUID_ERROR");case 6000006:return et("PROJECT_NOT_PERSON_ERROR");case 6000007:return et("PROJECT_DUPLICATE_NAME");case 6000008:return et("ANNOTATION_HAS_BE_FOUND");case 6000009:return et("ANNOTATION_NOT_FOUND");case 6000010:return et("ANNOTATION_CREATE_ERROR");case 6000011:return et("ANNOTATION_UPDATE_ERROR");case 6000012:return et("ANNOTATION_DELETE_ERROR");case 6000013:return et("PROJECT_DUPLICATE_PATH");case 7000001:return et("TEAM_NOT_FOUND");case 7000002:return et("TEAM_UUID_NULL");case 7000003:return et("TEAM_FOLDER_ERROR");case 7000004:return et("TEAM_FOLDER_DEEP_ERROR");case 7000005:return et("TEAM_FOLDER_UUID_ERROR");case 7000006:return et("TEAM_URL_DUPLICATE");case 7000007:return et("TEAM_CAN_NOT_DELETE");case 8000001:return et("COMPONENT_UUID_NULL");case 8000002:return et("COMPONENT_DATA_NOT_FOUND");case 8000003:return et("COMPONENT_NAME_DUPLICATE");case 8000004:return et("COMPONENT_TYPE_ERROR");case 8001001:return et("DELETE_SON_CATEGORY");case 9000001:return et("LICENSE");case 9000002:return et("START_TIME");case 9000003:return et("END_TIME");case 9000004:return et("PROJECT_LIMIT");case 9000005:return et("USER_LIMIT");case 9000006:return et("ONLINE_NUMBER_LIMIT");case 9000007:return et("COMPANY_CODE");case 9000008:return et("LIMIT_PCB");case 9000009:return et("LIMIT_SCH");case 9000011:return et("LIMIT_PANEL");case 9000010:return et("TIME_ERROR");case 9000012:return et("LICENSE_ERROR");case 9000013:return et("LICENSE_TYPE_ERROR");case 9000014:return et("LICENSE_ORIGIN_ERROR",{type:s});case 11000001:return et("BRANCH_DATA_NOT_FOUND");case 11000002:return et("PARENT_UUID_ERROR");case 11000003:return et("BRANCH_MUST_AFTER_NODE");case 11000004:return et("BRANCH_NAME_ERROR");case 11000005:return et("BRANCH_NAME_DUPLICATE");case 11000006:return et("BRANCH_UUID_ERROR");case 11000007:return et("BRANCH_NODE_SET_ERROR");case 11000008:return et("BRANCH_DELETE_MAIN_ERROR");case 11000009:return et("BRANCH_CHECK_OUT_ERROR");case 12000001:return et("DOCUMENT_UUID_ERROR");case 12000002:return et("UPDATE_FAILED");case 1000020:return et("INNER_API_KEY_ERROR");case 11000010:return et("BRANCH_MORE_THAN_LIMIT");case 1000021:return et("WORKSPACE_API_ERROR");default:return""}}function et(t,e){return Rc()==="zh-cn"?Qa.match("codeCN",t,e)||"":Qa.match("codeEN",t,e)||""}var hE=(t=>(t.Text="text/plain;charset=UTF-8",t.Json="application/json",t.Form="application/x-www-form-urlencoded;charset=UTF-8",t.FormData="multipart/form-data",t))(hE||{}),dE=(t=>(t.ContentType="Content-type",t.Editorversion="Editor-Version",t))(dE||{}),pE=(t=>(t[t.Success=200]="Success",t[t.NotFound=404]="NotFound",t[t.NetError=500]="NetError",t))(pE||{}),fE=(t=>(t.Json="json",t.Blob="blob",t))(fE||{}),mE=0;function At(t,e,i={},s={},r){return new Promise((n,a)=>{try{let l=mE++;var o;t=t||"GET",gE(t,i,s);let u=EE(e,i,s,r);o=(u==null?void 0:u.params)||i,s=(u==null?void 0:u.options)||s;let c=yE(t,e,o,s);o=c.params,e=c.url;let h=new XMLHttpRequest;if(s.withCredentials!==void 0&&(h.withCredentials=s.withCredentials),s.responseType!==void 0&&(h.responseType=s.responseType),h.open(t,e,!0),TE(h,t,i,s),o=_E(h,t,e,o,s),h.onreadystatechange=function(){if(h.readyState===4&&h.status===200)try{if(s.responseType==="blob")n(h.response);else{let f=JSON.parse(h.responseText);f.success===!1&&(f.message=Vn(f)||f.message),n(f)}}catch(f){console.warn("catch ajax error...",f),n({success:!1,message:"Network Error!"})}else h.status===404?(console.warn("catch ajax error...",h.status),n({success:!1,code:h.status,message:"Network Error!"})):h.status===500&&(console.warn("catch ajax error...",h.status),n({success:!1,code:h.status,message:"Network Error!"}))},h.onerror=function(f){console.warn("catch ajax error...",f),n({success:!1,message:"Network Error!"})},o instanceof Uint8Array){let f=new Blob([o]);h.send(f)}else h.send(o)}catch(l){console.warn("catch ajax error...",l),n({success:!1,message:"Network Error!"})}})}function gE(t,e,i={}){if(t.toLowerCase()!=="get"&&!(e instanceof FormData)&&typeof e!="string"&&(i==null?void 0:i.contentType)!==!1&&(i=i||{},i.headers=Object.assign(i.headers||{},{"Content-type":"application/json"})),i.headers){let s={};for(let r in i.headers){let n=i.headers[r];s[r]=n}i.headers=s}}function EE(t,e,i={},s){var r;if(!(e.path||(r=i==null?void 0:i.headers)!=null&&r.path)){if(t.includes("component")&&s)e.path=s;else if(s){let n=i.headers||{};n=Object.assign(n,{path:s}),i.headers=n}return{params:e,options:i}}}function pu(t,e=50){return typeof t!="string"?!1:t.length*2>e*1024*1024}function yE(t,e,i,s={}){var f;let r,n,a,o=[],l=s.headers,u=!1;if(i instanceof FormData)r=i;else if(typeof i=="string")r=i;else if((f=l==null?void 0:l["Content-type"])!=null&&f.includes("application/json")){if(typeof i=="object"&&i!==null){for(let d in i)if(pu(i[d])){u=!0;break}}if(u){let d=new FormData;for(let p in i){let m=i[p];pu(m)?d.append(p,new Blob([m],{type:"text/plain"})):d.append(p,typeof m=="object"?JSON.stringify(m):m)}r=d,s.headers&&(s.headers["Content-type"]="multipart/form-data")}else r=JSON.stringify(i)}else{for(n in i)if(a=i[n],a instanceof Array)for(let d=0;d<a.length;d++){let p=a[d];o.push(encodeURIComponent(`${n}[]`)+"="+encodeURIComponent(p))}else if(Object.prototype.toString.call(a)==="[object Object]")for(let d in a){let p=a[d];o.push(encodeURIComponent(`${n}[${d}]`)+"="+(p?encodeURIComponent(p):""))}else o.push(encodeURIComponent(n)+"="+encodeURIComponent(a));r=o.join("&"),t==="GET"&&r&&typeof r=="string"&&s.searchParams===!0&&(e=e+"?"+r,r={})}let c=/{[a-zA-Z]+}/gim,h=[...new Set(e.match(c))];for(let d of h){let p=d.substring(1,d.length-1);e=e.replace(d,i[p]||"")}return{params:r,url:e}}function TE(t,e,i,s={}){let r=s.headers;if(r){for(let n in r){let a=r[n];t.setRequestHeader(encodeURI(n),encodeURI(a))}s.contentType!==!1&&!r["Content-type"]&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8")}else s.contentType!==!1&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");if(t.setRequestHeader("Editor-Version",self.PRO_EDITOR_VERSION||""),self.document){let n=e.toUpperCase();if(n!=="GET"&&n!=="HEAD"){let a=/XSRF-TOKEN=(\S+);?/.exec(document.cookie);a&&t.setRequestHeader("X-XSRF-TOKEN",decodeURIComponent(a[1]))}}}var bE=1e4;function _E(t,e,i,s,r={}){return e.match(/post/i)&&i.startsWith("/")&&!i.startsWith("/servicecenter/")&&typeof s=="string"&&s.length>=bE&&(s=tE(new TextEncoder().encode(s),{level:1}),t.setRequestHeader("Content-Encoding","gzip")),s}async function ph(t,e,i,s){if(!s||!i){let a=`invalid parameters ${s}|${i}.`;return{code:dt.ERR_CODE.NORMAL,success:!1,msg:a,message:a,result:null}}let r=await At("POST",e?`/api/v4/devices/${s}/delete`:`/api/v4/components/${s}/delete`,{},{headers:{"Content-type":"application/json","content-type":"application/json",path:i}});if(r.code===0&&r.success)return{code:0,success:!0,msg:"",message:"",result:{componentId:s}};let n=r.message||r.msg||"Request Error.";return{...r,msg:n,message:n,result:{componentId:s}}}async function SE(t,e,i){if(t){let c="operations not currently supported.";return{code:dt.ERR_CODE.NORMAL,success:!1,msg:c,message:c,result:null}}let s={code:0,success:!0,result:{devices:{succeed:[],failed:[]},symbols:{succeed:[],failed:[]},footprints:{succeed:[],failed:[]},d3models:{succeed:[],failed:[]},cbbs:{succeed:[],failed:[]},panels:{succeed:[],failed:[]}},msg:"",message:""},r=await Vs(t,!0,e,i.devices||[]);s.result.devices={...r.result};let n=await Vs(t,!1,e,i.symbols||[]);s.result.symbols={...n.result};let a=await Vs(t,!1,e,i.footprints||[]);s.result.footprints={...a.result};let o=await Vs(t,!1,e,i.d3models||[]);s.result.d3models={...o.result};let l=await Vs(t,!1,e,i.cbbs||[]);s.result.cbbs={...l.result};let u=await Vs(t,!1,e,i.panels||[]);return s.result.panels={...u.result},s}async function Vs(t,e,i,s){let r=[],n=[];for(let a=0;a<s.length;a++){let o=await ph(t,e,i,s[a]);if(o.code===0&&o.success){r.push(s[a]);continue}r.push(s[a])}return{code:0,success:!0,result:{succeed:r,failed:n},msg:"",message:""}}function fh(t){if(!t)return[];if(t instanceof Array)return t;let e=[];return t!=null&&t.parent_tag&&(t!=null&&t.parent_tag.uuid)&&e.push(t==null?void 0:t.parent_tag.uuid),t!=null&&t.child_tag&&(t!=null&&t.child_tag.uuid)&&e.push(t==null?void 0:t.child_tag.uuid),e}function Ps(t){if(!t)return[];if(t instanceof Array)return t;let e=[];return t!=null&&t.parent_tag&&(t!=null&&t.parent_tag.name)&&e.push(t==null?void 0:t.parent_tag.name),t!=null&&t.child_tag&&(t!=null&&t.child_tag.name)&&e.push(t==null?void 0:t.child_tag.name),e}function on(t,e=!1){return t?e?fu(t):t.indexOf("_")>=0?AE(t):t.indexOf("@")>=0?IE(t):fu(t):{componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1}}function fu(t){let e={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/\|/i.test(t))return e.isLocaleFilenameMode=!1,e.componentTitleOrId=t,e;let i=t.split("|");return e.componentTitleOrId=i[0],e.path=i[1],/\./.test(i[0])?(e.isLocaleFilenameMode=!0,e):(e.isLocaleFilenameMode=!1,e)}function IE(t){let e={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/\@/i.test(t))return e.isLocaleFilenameMode=!1,e.componentTitleOrId=t,e;let i=t.split("@");return e.componentTitleOrId=i[0],e.path=i[1],/\./.test(i[0])?(e.isLocaleFilenameMode=!0,e):(e.isLocaleFilenameMode=!1,e)}function AE(t){let e={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/_/i.test(t))return e.isLocaleFilenameMode=!1,e.componentTitleOrId=t,e;let i=t.split("_");return e.componentTitleOrId=i[0],e.path=i[1],/\./.test(i[0])?(e.isLocaleFilenameMode=!0,e):(e.isLocaleFilenameMode=!1,e)}async function Wo(t,e){let i=on(t,!0),s=i.path||e,r={code:dt.ERR_CODE.NORMAL,success:!0,result:null,msg:""};return r.result={createTime:0,created_at:"",creator:null,dataStr:JSON.stringify({model:`${i.componentTitleOrId}|${s}`,unit:"mm"}),display_title:i.componentTitleOrId||"-",uuid:`${i.componentTitleOrId}|${s}`||"",path:s,description:"",docType:16,modifier:null,owner:null,source:"",tags:{child_tag:[],parent_tag:[]},title:i.componentTitleOrId||"",updateTime:0,updated_at:"",version:"",public:void 0},r}var OE=class{constructor(){if(!crypto||!crypto.subtle)throw new Error("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301crypto api");this.tool=crypto.subtle}},RE=class extends OE{constructor(){super(),this.keyBuffer=null,this.key=null,this.iv=null}async init(t){try{return this.keyBuffer=t.key,this.key=await this.setKey(this.keyBuffer),this.iv=await this.setIV(t.iv),this}catch{throw new Error(`invalid key or iv! ${t}`)}}setKey(t){if(t instanceof ArrayBuffer)return this.tool.importKey("raw",t,"AES-GCM",!0,["encrypt","decrypt"]);throw new Error(`invalid key! ${t}`)}setIV(t){if(t instanceof ArrayBuffer)return t;throw new Error(`invalid iv! ${t}`)}encrypt(t){return this.tool.encrypt({name:"AES-GCM",iv:this.iv},this.key,t)}decrypt(t){return this.tool.decrypt({name:"AES-GCM",iv:this.iv},this.key,t)}decrypt2(t){return this.tool.decrypt({name:"AES-GCM",iv:this.iv,tagLength:128},this.key,t)}getKey(){return this.keyBuffer}getIV(){return this.iv}};function mu(t){let e=t.match(/[\da-f]{2}/gi);return e?new Uint8Array(e.map(function(i){return parseInt(i,16)})).buffer:null}function DE(t,e="utf-8"){var i=new TextDecoder(e);return i.decode(t)}async function di(t){try{if(!t.dataStrId)return null;let e=new Headers;e.append("Content-Type","text/plain;charset=UTF-8");let i=await(await fetch(t.dataStrId,{method:"GET",redirect:"error",headers:e})).arrayBuffer();if(i){let s=await wE(t,i);return DE(s)}return null}catch(e){throw new Error("fetch\u5931\u8D25!!!"+e)}}async function wE(t,e){let i=new RE;try{let{key:s,iv:r}=t;if(e&&r&&s){let n=mu(s),a=mu(r);await i.init({key:n,iv:a});let o=await i.decrypt(e);return iE(new Uint8Array(o))}else throw new Error(`\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!\u6570\u636E\u4E0D\u6B63\u786E:data:${e},key:${s},iv:${r}`)}catch(s){throw new Error("\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!"+s)}}async function ln(t,e=dt.SYSTEMLIB_UUID){if(!t)return null;let i=null,s=on(t,!0);if(s.isLocaleFilenameMode)return i=(await Wo(s.componentTitleOrId,s.path||dt.SYSTEMLIB_UUID)).result,i;let r=await At("GET",`/api/v2/components/${s.componentTitleOrId}`,{},{headers:{"Content-type":"application/json","content-type":"application/json",path:s.path||dt.SYSTEMLIB_UUID}});if(r.code===0&&r.success&&typeof r.result=="object"&&(i=r.result),i&&!i.dataStr)try{let n=await di(i);i.dataStr=n}catch(n){console.error(n)}return i}function as(t=new Date,e="yyyy-MM-dd HH:ii:ss"){if(Number.isNaN(t.getTime()))return"-";let i={"M+":t.getMonth()+1,"d+":t.getDate(),"H+":t.getHours(),"h+":t.getHours(),"i+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(let s in i)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?i[s]:("00"+i[s]).substr((""+i[s]).length)));return e}function CE(t,e){function i(c){return c>=10?String(c):"0"+c}t instanceof Date?t.getTime().toString().length>13&&(t=new Date(t.getTime()/1e3)):Number.isNaN(Number(t))||t.toString().length>13&&(t=new Date(Number(t)/1e3));let s=new Date(t);if(Number.isNaN(s.getTime()))return"-";let r=s.getFullYear(),n=i(s.getMonth()+1),a=i(s.getDate()),o=i(s.getHours()),l=i(s.getMinutes()),u=i(s.getSeconds());return e==="downProject"?r+"-"+n+"-"+a:e==="migrateStandardProject"?r+"-"+n+"-"+a+"_"+o+"-"+l+"-"+u:e==="y-m-d"||e==="yyyy-MM-dd"?r+"-"+n+"-"+a:e==="y-m-d_h-m-s"?`${r}-${n}-${a}_${o}-${l}-${u}`:r+"-"+n+"-"+a+" "+o+":"+l+":"+u}function mh(t,e,i){let s=new Date().getTime(),r=as(new Date(s)),n={avatar:"",nickname:"",username:"",uuid:""},a=t+(i?`|${i}`:"");return{createTime:s,created_at:r,creator:{...n},dataStr:JSON.stringify({model:a,unit:"mm"}),description:"",display_title:e,docType:16,modifier:{...n},owner:{...n},path:i,public:!1,source:"",std_uuid:"",tags:{child_tag:[],parent_tag:[]},ticket:0,title:e,type:0,updateTime:s,updated_at:r,uuid:t,version:""}}async function NE(t){return t?new Promise((e,i)=>{window.fetch(`https://modules.lceda.cn/3dmodel/${t}`,{method:"GET"}).then(async s=>{let r=await s.blob();e({code:0,success:!0,result:r,message:""})}).catch(async s=>{e({code:s?s.code:-9,success:!1,result:null,message:"fetch 3D model file failed."})})}):{code:-1,success:!1,result:null,message:"missing uuid or path or detail data."}}var Jo=class{},PE=(t=>(t.PROJECT_DOCUMENT_LOCKED="PROJECT_DOCUMENT_LOCKED",t.PROJECT_DOCUMENT_UPDATE_REJECT="PROJECT_DOCUMENT_UPDATE_REJECT",t.NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND="NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND",t.NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND="NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND",t.DEVICE_ATTRIBUTES_ERROR="DEVICE_ATTRIBUTES_ERROR",t.DEVICE_DESCRIPTION_ERROR="DEVICE_DESCRIPTION_ERROR",t.SYMBOL_DESCRIPTION_ERROR="SYMBOL_DESCRIPTION_ERROR",t.FOOTPRINT_DESCRIPTION_ERROR="FOOTPRINT_DESCRIPTION_ERROR",t.D3MODEL_DESCRIPTION_ERROR="D3MODEL_DESCRIPTION_ERROR",t.DEVICE_NAMA_ERROR="DEVICE_NAMA_ERROR",t.SYMBOL_NAMA_ERROR="SYMBOL_NAMA_ERROR",t.FOOTPRINT_NAMA_ERROR="FOOTPRINT_NAMA_ERROR",t.PANEL_LIB_NAMA_ERROR="PANEL_LIB_NAMA_ERROR",t.D3MODEL_NAMA_ERROR="D3MODEL_NAMA_ERROR",t.SIM_MODEL_NAMA_ERROR="SIM_MODEL_NAMA_ERROR",t.DEVICE_SAME_NAMA_EXISTS="DEVICE_SAME_NAMA_EXISTS",t.SYMBOL_SAME_NAMA_EXISTS="SYMBOL_SAME_NAMA_EXISTS",t.FOOTPRINT_SAME_NAMA_EXISTS="FOOTPRINT_SAME_NAMA_EXISTS",t.D3MODEL_SAME_NAMA_EXISTS="D3MODEL_SAME_NAMA_EXISTS",t.SIM_MODEL_SAME_NAMA_EXISTS="SIM_MODEL_SAME_NAMA_EXISTS",t.PANELLIB_SAME_NAMA_EXISTS="PANELLIB_SAME_NAMA_EXISTS",t.PARAMETER_VERIFICATION="PARAMETER_VERIFICATION",t.RESULT_VERIFICATION="RESULT_VERIFICATION",t.GET_DEVICE="GET_DEVICE",t.GET_DEVICE_NOT_FOUND="GET_DEVICE_NOT_FOUND",t.GET_DEVICE_LIST="GET_DEVICE_LIST",t.GET_DEVICE_SEARCH_LIST="GET_DEVICE_SEARCH_LIST",t.GET_SYMBOL="GET_SYMBOL",t.GET_SYMBOL_NOT_FOUND="GET_SYMBOL_NOT_FOUND",t.GET_SYMBOL_LIST="GET_SYMBOL_LIST",t.GET_SYMBOL_SEARCH_LIST="GET_SYMBOL_SEARCH_LIST",t.GET_FOOTPRINT="GET_FOOTPRINT",t.GET_FOOTPRINT_NOT_FOUND="GET_FOOTPRINT_NOT_FOUND",t.GET_FOOTPRINT_LIST="GET_FOOTPRINT_LIST",t.GET_FOOTPRINT_SEARCH_LIST="GET_FOOTPRINT_SEARCH_LIST",t.GET_PANEL_LIB_SEARCH_LIST="GET_PANEL_LIB_SEARCH_LIST",t.GET_D3MODEL="GET_D3MODEL",t.GET_D3MODEL_NOT_FOUND="GET_D3MODEL_NOT_FOUND",t.GET_D3MODEL_LIST="GET_D3MODEL_LIST",t.GET_D3MODEL_SEARCH_LIST="GET_D3MODEL_SEARCH_LIST",t.GET_SIM_MODEL="GET_SIM_MODEL",t.GET_SIM_NOT_FOUND="GET_SIM_NOT_FOUND",t.GET_SIM_MODEL_LIST="GET_SIM_MODEL_LIST",t.GET_SIM_MODEL_SEARCH_LIST="GET_SIM_MODEL_SEARCH_LIST",t.CROSS_BIND="CROSS_BIND",t.CROSS_BIND_EXIT="CROSS_BIND_EXIT",t.IMPORT_EXIST_PROJECT="IMPORT_EXIST_PROJECT",t.CREATE_PROJECT="CREATE_PROJECT",t.CREATE_DEVICE="CREATE_DEVICE",t.CREATE_DEVICE_DUP_TITLE="CREATE_DEVICE_DUP_TITLE",t.CREATE_DEVICE_PERMISSIONS="CREATE_DEVICE_PERMISSIONS",t.CREATE_SYMBOL="CREATE_SYMBOL",t.CREATE_SYMBOL_DUP_TITLE="CREATE_SYMBOL_DUP_TITLE",t.CREATE_SYMBOL_PERMISSIONS="CREATE_SYMBOL_PERMISSIONS",t.CREATE_SYMBOL_MIGRATE_CANVAS_ERROR="CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",t.CREATE_FOOTPRINT="CREATE_FOOTPRINT",t.CREATE_FOOTPRINT_DUP_TITLE="CREATE_FOOTPRINT_DUP_TITLE",t.CREATE_FOOTPRINT_PERMISSIONS="CREATE_FOOTPRINT_PERMISSIONS",t.CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR="CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",t.CREATE_D3MODEL="CREATE_D3MODEL",t.CREATE_D3MODEL_DUP_TITLE="CREATE_D3MODEL_DUP_TITLE",t.CREATE_D3MODEL_PERMISSIONS="CREATE_D3MODEL_PERMISSIONS",t.CREATE_PANEL_LIB="CREATE_PANEL_LIB",t.CREATE_PANEL_DUP_TITLE="CREATE_PANEL_DUP_TITLE",t.CREATE_PANEL_PERMISSIONS="CREATE_PANEL_PERMISSIONS",t.CREATE_SIM_MODEL="CREATE_SIM_MODEL",t.CREATE_SIM_MODEL_DUP_TITLE="CREATE_SIM_MODEL_DUP_TITLE",t.CREATE_SIM_MODEL_PERMISSIONS="CREATE_SIM_MODEL_PERMISSIONS",t.CREATE_SIM_MODEL_MIGRATE_CANVAS_ERROR="CREATE_SIM_MODEL_MIGRATE_CANVAS_ERROR",t.UPDATE_DEVICE="UPDATE_DEVICE",t.UPDATE_DEVICE_ATTRIBUTES="UPDATE_DEVICE_ATTRIBUTES",t.UPDATE_DEVICE_PERMISSIONS="CREATE_DEVICE_PERMISSIONS",t.UPDATE_SYMBOL="UPDATE_SYMBOL",t.UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR="UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR",t.UPDATE_SYMBOL_PERMISSIONS="UPDATE_SYMBOL_PERMISSIONS",t.UPDATE_FOOTPRINT="UPDATE_FOOTPRINT",t.UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR="UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",t.UPDATE_FOOTPRINT_PERMISSIONS="UPDATE_FOOTPRINT_PERMISSIONS",t.UPDATE_D3MODEL_PERMISSIONS="UPDATE_D3MODEL_PERMISSIONS",t.UPDATE_SIM_MODEL="UPDATE_SIM_MODEL",t.UPDATE_SIM_MODEL_MIGRATE_CANVAS_ERROR="UPDATE_SIM_MODEL_MIGRATE_CANVAS_ERROR",t.UPDATE_SIM_MODEL_PERMISSIONS="UPDATE_SIM_MODEL_PERMISSIONS",t.DELETE_DEVICE="DELETE_DEVICE",t.DELETE_SYMBOL="DELETE_SYMBOL",t.DELETE_FOOTPRINT="DELETE_FOOTPRINT",t.DELETE_SIM_MODEL="DELETE_SIM_MODEL",t.DELETE_3DMODEL="DELETE_3DMODEL",t.GET_SOURCE="GET_SOURCE",t))(PE||{}),Q=class{constructor(t,e=""){this._message=e,this._action=t}get message(){return this._message}set message(t){this._message=t}get action(){return this._action}set action(t){this._action=t}toJSON(){return{message:this.message,action:this.action}}};function Vt(t){if(!t){let e="missing creator data.";throw new Q("RESULT_VERIFICATION",e)}return{uuid:t.uuid,nickname:t.nickname,username:t.username}}function zt(t){if(!t){let e="missing modifier data.";throw new Q("RESULT_VERIFICATION",e)}return{uuid:t.uuid,nickname:t.nickname,username:t.username}}function Xt(t){if(!t){let e="missing owner data.";throw new Q("RESULT_VERIFICATION",e)}return{uuid:t.uuid,nickname:t.nickname,username:t.username}}function Ue(t,e){let i=Object.keys(e);for(let s=0;s<i.length;s++)uT.indexOf(i[s])<=-1||(i[s]==="title"&&"display_title"in t&&e.title&&(t.display_title=String(e.title),t.title=String(e.title).toLocaleLowerCase()),t[i[s]]=e[i[s]])}function Sa(t,e){return t[e]}function gh(t){if(!t||t.length<=0||t.length>128){let e="The title length must be between 1~128 characters!";throw new Q("DEVICE_NAMA_ERROR",e)}}function Eh(t){if(!t||t.length<=0||t.length>128){let e="The title length must be between 1~128 characters!";throw new Q("SYMBOL_NAMA_ERROR",e)}}function yh(t){if(!t||t.length<=0||t.length>128){let e="The title length must be between 1~128 characters!";throw new Q("FOOTPRINT_NAMA_ERROR",e)}}function LE(t){if(!t||t.length<=0||t.length>128){let e="The title length must be between 1~128 characters!";throw new Q("D3MODEL_NAMA_ERROR",e)}}function Th(t){if(!t||t.length<=0||t.length>128){let e="The title length must be between 1~128 characters!";throw new Q("SIM_MODEL_NAMA_ERROR",e)}}async function ar(t,e){let i=[],s=[],r=async o=>{let{message:l}=await ot.messageBus.rpcCall(Hi.TAG.CREATE,o);return l},n=null;try{for(let o=0;o<t.length;o++){let l=await r({...t[o],path:t[o].user_uuid});if(l.code===0&&l.success){let c={...l,message:"",result:{...t[o],path:t[o].user_uuid,...l.result[0]}};i.push(c),e&&e(c,o);continue}let u={...l,result:{...t[o]}};s.push(u)}return{code:0,success:!0,result:{successList:i,failList:s},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Add Categories Batch Error";return{code:n?n.code:dt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}function Me(t=[],e,i){if(!t||!t.length||!e)return{index:-1,data:null};let s={index:-1,data:null};for(let r=0;r<t.length;r++)if(typeof t[r]=="object"&&t[r][e]===i){s.data=t[r],s.index=r;break}return s}function vE(t=[],e,i){if(!t||!t.length||!e)return{indexs:[],datas:[]};let s={indexs:[],datas:[]};for(let r=0;r<t.length;r++)typeof t[r]=="object"&&t[r][e]===i&&(s.datas.push(t[r]),s.indexs.push(r));return s}function Dr(t=0,e=Number.MAX_SAFE_INTEGER){return Math.floor(Math.random()*(e-t+1))+t}function Jr(t=36){let e=[],i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let s=0;s<t;s++)e[s]=i.substr(Math.floor(Math.random()*16),1);return e[14]&&(e[14]=String(Dr(1,9))),e[19]&&(e[19]=i.substr(+e[19]&3|8,1)),e[8]&&(e[8]=String(Dr(1,9))),e[13]&&(e[13]=String(Dr(1,9))),e[18]&&(e[18]=String(Dr(1,9))),e[23]&&(e[23]=String(Dr(1,9))),e.join("")}function gu(t,e=!0){return(i,s)=>{let r=i[t],n=s[t];return typeof r<"u"&&typeof n<"u"?e?r-n:n-r:0}}var xE=class{constructor(t,e){this.extendLib=e,this.getList=t.getList,this.getSupportedPreviewTypes=t.getSupportedPreviewTypes,this.getDetail=t.getDetail,this.getClassificationTree=t.getClassificationTree,this.getFile=t.getDetail}async getTransformedList(t){let e=await this.getList(t),{count:i,page:s,pageSize:r,lists:n,totalPage:a}=e;return{count:i,page:s,pageSize:r,totalPage:a,lists:n.map(o=>this.extendLib.transformer.transformCbbListItem(o))}}async getTransformedDetail(t){return await this.getDetail(t)}async getTransformedClassificationTree(){var t,e;return(e=(t=await this.getClassificationTree())==null?void 0:t.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?e:[]}},ME=class{constructor(t,e){this.extendLib=e,this.getList=t.getList,this.getSupportedPreviewTypes=t.getSupportedPreviewTypes,this.getSupportedSymbolTypes=t.getSupportedSymbolTypes,this.getDetail=t.getDetail,this.getClassificationTree=t.getClassificationTree}async getTransformedList(t){let e=await this.getList(t),{count:i,page:s,pageSize:r,lists:n,totalPage:a}=e;return{count:i,page:s,pageSize:r,totalPage:a,lists:n.map(o=>this.extendLib.transformer.transformDeviceListItem(o))}}async getTransformedDetail(t){let e=await this.getDetail(t);return this.extendLib.transformer.transformDeviceListItem(e)}async getTransformedClassificationTree(){var t,e;return(e=(t=await this.getClassificationTree())==null?void 0:t.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?e:[]}},BE=class{constructor(t,e){this.extendLib=e,this.getList=t.getList,this.getSupportedPreviewTypes=t.getSupportedPreviewTypes,this.getDetail=t.getDetail,this.getClassificationTree=t.getClassificationTree}async getTransformedList(t){let e=await this.getList(t),{count:i,page:s,pageSize:r,lists:n=[],totalPage:a}=e,o=[];for(let l of n)o.push(await this.extendLib.transformer.transformFootprintListItem(l));return{count:i,page:s,pageSize:r,totalPage:a,lists:o}}async getTransformedDetail(t){let e=await this.getDetail(t);return await this.extendLib.transformer.transformFootprintListItem(e)}async getTransformedClassificationTree(){var t,e;return(e=(t=await this.getClassificationTree())==null?void 0:t.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?e:[]}},kE=class{constructor(t,e){this.extendLib=e,this.getList=t.getList,this.getSupportedPreviewTypes=t.getSupportedPreviewTypes,this.getSupportedSymbolTypes=t.getSupportedSymbolTypes,this.getDetail=t.getDetail,this.getClassificationTree=t.getClassificationTree}async getTransformedList(t){let e=await this.getList(t),{count:i,page:s,pageSize:r,lists:n,totalPage:a}=e,o=[];for(let l of n)o.push(await this.extendLib.transformer.transformSymbolListItem(l));return{count:i,page:s,pageSize:r,totalPage:a,lists:o}}async getTransformedDetail(t){let e=await this.getDetail(t);return await this.extendLib.transformer.transformSymbolListItem(e)}async getTransformedClassificationTree(){var t,e;return(e=(t=await this.getClassificationTree())==null?void 0:t.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?e:[]}},FE=class{constructor(t){this.extendLib=t}transformTime(t=Date.now()){return t.toString().length>13?t/1e3:t}transformTimeStr(t=Date.now()){let e=this.transformTime(t);return as(new Date(e*1e3))}transformTags(t){let{primaryClassificationName:e,primaryClassificationUuid:i,secondaryClassificationName:s,secondaryClassificationUuid:r}=t||{};return{parent_tag:e?{uuid:i,name:e}:void 0,child_tag:s?{uuid:r,name:s}:void 0}}transformCategory(t,e){var s,r;let i=(s=t.uuid)!=null?s:crypto.randomUUID();return{id:i,title:t.name,children:(r=t.children)==null?void 0:r.map(n=>this.transformCategory(n,i)),parentId:e}}transformDeviceListItem(t){var e,i,s,r,n,a,o,l;return{title:t.name||"",description:t.description||"",images:[],uuid:t.uuid||this.extendLib.getDefaultItemId(),path:this.extendLib.id,source:"",version:"",ticket:0,updateTime:this.transformTime(t.updateTime),createTime:this.transformTime(t.createTime||t.updateTime),display_title:t.name||"",creator:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},attributes:{...(e=t.attributes)!=null?e:{},Footprint:((i=t.footprint)==null?void 0:i.uuid)||"",Symbol:((s=t.symbol)==null?void 0:s.uuid)||"",value:t.value||((r=t.attributes)==null?void 0:r.value)||"",supplierPart:t.supplierPart||((n=t.attributes)==null?void 0:n.supplierPart)||"",manufacturer:t.manufacturer||((a=t.attributes)==null?void 0:a.manufacturer)||"",description:t.description||((o=t.attributes)==null?void 0:o.description)||""},symbol:t.symbol?{display_title:t.symbol.name||""}:void 0,footprint:t.footprint?{display_title:t.footprint.name||""}:void 0,tags:this.transformTags(t.classification),symbol_type:(l=t.symbol)==null?void 0:l.symbolType}}async transformSymbolListItem(t){var e,i,s,r,n,a,o,l,u,c;return{docType:t.symbolType,uuid:t.uuid||this.extendLib.getDefaultItemId(),title:t.name||"",description:t.description||"",path:this.extendLib.id,source:"",version:(e=t.version)!=null?e:"",ticket:0,updateTime:this.transformTime(t.updateTime),createTime:this.transformTime(t.createTime||t.updateTime),display_title:t.name||"",creator:t.creator?{nickname:(i=t.creator.name)!=null?i:"",username:(s=t.creator.name)!=null?s:"",uuid:(r=t.creator.uuid)!=null?r:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:t.modifier?{nickname:(n=t.modifier.name)!=null?n:"",username:(a=t.modifier.name)!=null?a:"",uuid:(o=t.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:t.owner?{nickname:(l=t.owner.name)!=null?l:"",username:(u=t.owner.name)!=null?u:"",uuid:(c=t.owner.uuid)!=null?c:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},dataStr:t.data instanceof Blob?await t.data.text():t.data,tags:this.transformTags(t.classification)}}async transformFootprintListItem(t){var e,i,s,r,n,a,o,l,u,c;return{docType:4,uuid:t.uuid||this.extendLib.getDefaultItemId(),title:t.name||"",description:t.description||"",path:this.extendLib.id,source:"",version:(e=t.version)!=null?e:"",ticket:0,updateTime:this.transformTime(t.updateTime),createTime:this.transformTime(t.createTime||t.updateTime),display_title:t.name||"",creator:t.creator?{nickname:(i=t.creator.name)!=null?i:"",username:(s=t.creator.name)!=null?s:"",uuid:(r=t.creator.uuid)!=null?r:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:t.modifier?{nickname:(n=t.modifier.name)!=null?n:"",username:(a=t.modifier.name)!=null?a:"",uuid:(o=t.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:t.owner?{nickname:(l=t.owner.name)!=null?l:"",username:(u=t.owner.name)!=null?u:"",uuid:(c=t.owner.uuid)!=null?c:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},dataStr:t.data instanceof Blob?await t.data.text():t.data,tags:this.transformTags(t.classification)}}transformCbbListItem(t){var e,i,s,r,n,a,o,l,u,c,h,f,d,p,m,g,b,y,E,_,S,A,w,R,L,M,B,q,H,V,W,v,j,O,x,k,F;return{cbb_project:!0,content:(e=t.description)!=null?e:"",creator:t.creator?{avatar:"",nickname:(i=t.creator.name)!=null?i:"",username:(s=t.creator.name)!=null?s:"",uuid:(r=t.creator.uuid)!=null?r:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:t.modifier?{nickname:(n=t.modifier.name)!=null?n:"",username:(a=t.modifier.name)!=null?a:"",uuid:(o=t.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:t.owner?{avatar:"",team:!1,nickname:(l=t.owner.name)!=null?l:"",username:(u=t.owner.name)!=null?u:"",uuid:(c=t.owner.uuid)!=null?c:""}:{avatar:"",team:!1,nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},name:t.name,path:this.extendLib.id,block_symbol:(f=(h=t.blockSymbols)==null?void 0:h.map(P=>{var z;return{uuid:P.uuid,display_title:P.name,docType:17,project_uuid:(z=t.uuid)!=null?z:t.name,title:P.name.toLocaleLowerCase()}}))!=null?f:[],schematics:(p=(d=t.schematics)==null?void 0:d.map(P=>{var Y,tt;let z=(tt=(Y=t.sheets)==null?void 0:Y.filter(it=>it.belongSchematicUuid===P.uuid).map(it=>({uuid:it.uuid,ticket:0})))!=null?tt:[];return{create_at:this.transformTimeStr(P.createTime||P.updateTime),createtime:this.transformTime(P.createTime||P.updateTime),display_name:P.name,name:P.name.toLocaleLowerCase(),project_uuid:t.uuid,sheet_count:z.length,sort:z,ticket:0,update_at:this.transformTimeStr(P.updateTime),uuid:P.uuid,updateTime:this.transformTime(P.updateTime)}}))!=null?p:[],pcb:(g=(m=t.pcbs)==null?void 0:m.map(P=>{var z,Y,tt,it,nt,at,pt,ft,xt,gt,bt;return{description:(z=P.description)!=null?z:"",display_title:P.name,docType:3,project_uuid:(Y=t.uuid)!=null?Y:"",thumb:P.thumb,title:P.name.toLocaleLowerCase(),updateTime:this.transformTime(P.updateTime),uuid:P.uuid,creator:P.creator?{avatar:"",nickname:(it=(tt=P.creator)==null?void 0:tt.name)!=null?it:"",username:(at=(nt=P.creator)==null?void 0:nt.name)!=null?at:"",uuid:(ft=(pt=P.creator)==null?void 0:pt.uuid)!=null?ft:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:P.modifier?{nickname:(xt=P==null?void 0:P.modifier.name)!=null?xt:"",username:(gt=P==null?void 0:P.modifier.name)!=null?gt:"",uuid:(bt=P==null?void 0:P.modifier.uuid)!=null?bt:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id}}}))!=null?g:[],schs:(y=(b=t.sheets)==null?void 0:b.map(P=>{var z,Y,tt,it,nt,at,pt,ft;return{description:(z=P.description)!=null?z:"",display_title:P.name,docType:1,project_uuid:(Y=t.uuid)!=null?Y:"",schematic_uuid:P.belongSchematicUuid,thumb:P.thumb,title:P.name.toLocaleLowerCase(),updateTime:this.transformTime(P.updateTime),uuid:P.uuid,creator:P.creator?{avatar:"",nickname:(tt=P==null?void 0:P.creator.name)!=null?tt:"",username:(it=P==null?void 0:P.creator.name)!=null?it:"",uuid:(nt=P==null?void 0:P.creator.uuid)!=null?nt:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:P!=null&&P.modifier?{nickname:(at=P==null?void 0:P.modifier.name)!=null?at:"",username:(pt=P==null?void 0:P.modifier.name)!=null?pt:"",uuid:(ft=P==null?void 0:P.modifier.uuid)!=null?ft:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id}}}))!=null?y:[],tags:{parent_tag:{name:(_=(E=t.classification)==null?void 0:E.primaryClassificationName)!=null?_:"",name_cn:(A=(S=t.classification)==null?void 0:S.primaryClassificationName)!=null?A:"",title:(R=(w=t.classification)==null?void 0:w.primaryClassificationName)!=null?R:"",uuid:(M=(L=t.classification)==null?void 0:L.primaryClassificationUuid)!=null?M:""},child_tag:{name:(q=(B=t.classification)==null?void 0:B.secondaryClassificationName)!=null?q:"",name_cn:(V=(H=t.classification)==null?void 0:H.secondaryClassificationName)!=null?V:"",title:(v=(W=t.classification)==null?void 0:W.secondaryClassificationName)!=null?v:"",uuid:(O=(j=t.classification)==null?void 0:j.secondaryClassificationUuid)!=null?O:""}},updated_at:this.transformTimeStr(t.updateTime),uuid:(x=t.uuid)!=null?x:t.name,boards:(F=(k=t.boards)==null?void 0:k.map(P=>({name:P.name,pcb:P.pcbUuid,sch:P.schUuid})))!=null?F:[]}}},UE=class bh{constructor(e){this.transformer=new FE(this),this.id=e.id,this.isVisible=i=>e.isVisible?e.isVisible(i)&&this.isInTab(i.tabName):this.isInTab(i.tabName),this.title=e.title,this.position=e.position,e.device&&(this.device=new ME(e.device,this)),e.symbol&&(this.symbol=new kE(e.symbol,this)),e.footprint&&(this.footprint=new BE(e.footprint,this)),e.cbb&&(this.cbb=new xE(e.cbb,this))}static async set(e){var s,r,n,a,o,l,u,c;let i=new bh(e);return i._deviceSupportedSymbolTypes=await((r=(s=e.device)==null?void 0:s.getSupportedSymbolTypes)==null?void 0:r.call(s)),i._symbolSupportedSymbolTypes=await((a=(n=e.symbol)==null?void 0:n.getSupportedSymbolTypes)==null?void 0:a.call(n)),i._deviceSupportedPreviewTypes=await((l=(o=e.device)==null?void 0:o.getSupportedPriviewTypes)==null?void 0:l.call(o)),i._footprintSupportedPreviewTypes=await((c=(u=e.footprint)==null?void 0:u.getSupportedPriviewTypes)==null?void 0:c.call(u)),i}getDefaultItemId(){return crypto.randomUUID().replace("-","")}getLibraryFunctionsClassInTab(e){switch(e){case"cbb":return this==null?void 0:this.cbb;case"device":return this==null?void 0:this.device;case"symbol":return this==null?void 0:this.symbol;case"footprint":return this==null?void 0:this.footprint;default:return null}}isInTab(e){return!!this.getLibraryFunctionsClassInTab(e)}isHasCategoryTreeInTab(e){var i;return!!((i=this.getLibraryFunctionsClassInTab(e))!=null&&i.getClassificationTree)}async getAmountByWd(e,i){var s,r,n;return(n=(r=await((s=this.getLibraryFunctionsClassInTab(e))==null?void 0:s.getList({page:1,pageSize:1,query:{wd:i}})))==null?void 0:r.count)!=null?n:0}getTabByCategoryType(e){switch(e){case 1:return"cbb";case 3:return"device";case 2:return"symbol";case 4:return"footprint";default:return null}}async getClassificationTreeInTab(e){var i;return this.isHasCategoryTreeInTab(e)?await((i=this.getLibraryFunctionsClassInTab(e))==null?void 0:i.getClassificationTree()):null}async getCategoryTreeDataItemsInTab(e){var i;return(i=await this.getClassificationTreeInTab(e))==null?void 0:i.map(s=>this.transformer.transformCategory(s))}async getClassificationTreeByCategoryType(e){let i=this.getTabByCategoryType(e);return i&&this.getClassificationTreeInTab(i)}async getCategoryTreeDataItemsByCategoryType(e){let i=this.getTabByCategoryType(e);return i&&this.getCategoryTreeDataItemsInTab(i)}getSelectTypeListInTab(e){let i=[];if(e==="device"){let s=this._deviceSupportedSymbolTypes;i=s?nu.filter(r=>s.includes(Number(r.value))||!r.value):nu}else if(e==="symbol"){let s=this._symbolSupportedSymbolTypes;i=s?au.filter(r=>s.includes(Number(r.value))||!r.value):au}return i.length>2?i:[]}getPreviewTypesInTab(e){let i=N1[e];return e==="device"&&this._deviceSupportedPreviewTypes?i=i.filter(s=>{var r;return(r=this._deviceSupportedPreviewTypes)==null?void 0:r.includes(s)}):e==="footprint"&&this._footprintSupportedPreviewTypes&&(i=i.filter(s=>{var r;return(r=this._footprintSupportedPreviewTypes)==null?void 0:r.includes(s)})),i}async getListInTab(e,i){var s;return await((s=this.getLibraryFunctionsClassInTab(e))==null?void 0:s.getList(i))}async getTransformedListInTab(e,i){var s;return await((s=this.getLibraryFunctionsClassInTab(e))==null?void 0:s.getTransformedList(i))}async getDetailInTab(e,i){var s;return await((s=this.getLibraryFunctionsClassInTab(e))==null?void 0:s.getDetail(i))}async getTransformedDetailInTab(e,i){var s;return await((s=this.getLibraryFunctionsClassInTab(e))==null?void 0:s.getTransformedDetail(i))}},jE=class{constructor(t=10){this._runingCount=0,this._handleCount=0,this._queue=[],this._results=[],this._windowSize=t,this._finishCallback=null,this._taskStartCallback=null,this._taskEndCallback=null}pushTask(t){this._queue.push(t)}setFinishCallback(t){this._finishCallback=t}setTaskStartCallback(t){this._taskStartCallback=t}setTaskEndCallback(t){this._taskEndCallback=t}next(){for(;this._runingCount<this._windowSize&&this._queue.length>0;){this._runingCount+=1,this._handleCount+=1;let t=this._handleCount-1,e=this._queue.shift();this._taskStartCallback&&this._taskStartCallback(t),e(t).then(i=>{this._results.push(i)}).catch(i=>{this._results.push(i)}).finally(()=>{this._runingCount-=1,this._taskEndCallback&&this._taskEndCallback(this._results[this._results.length-1]),this.next()})}this._runingCount<=0&&this._finishCallback&&this._finishCallback(this._results)}},Ko=class{onString(t,e,i){}onAttr(t,e,i){}onGroup(t,e,i,s,r){}onDelGroup(t,e,i,s){}onDelString(t,e,i,s){}onDelAttr(t,e,i,s){}onPanelizeSide(t,e,i,s){}onDelPanelizeSide(t,e,i,s){}onPanelizeStamp(t,e,i,s){}onDelPanelizeStamp(t,e,i,s){}onPanelize(t,e,i,s){}onDelPanelize(t,e,i){}onRuleSelector(t,e,i,s){}onDelRuleSelector(t,e,i,s){}onRule(t,e,i,s){}onDelRule(t,e,i,s,r){}onRuleTemplate(t,e,i,s){}onDimension(t,e,i,s,r,n){}onDelDimension(t,e,i,s){}onBoss(t,e,i,s,r,n){}onDelBoss(t,e,i,s){}onShellEntity(t,e,i,s,r,n){}onDelShellEntity(t,e,i,s){}onShellCut(t,e,i,s,r,n){}onDelShellCut(t,e,i,s){}onCrease(t,e,i,s,r,n){}onDelCrease(t,e,i,s){}onShell(t,e,i,s,r,n){}onDelShell(t,e,i,s){}onFpcFill(t,e,i,s,r,n){}onDelFpcFill(t,e,i,s){}onTeardrop(t,e,i,s,r,n){}onDelTeardrop(t,e,i,s){}onImage(t,e,i,s,r,n){}onDelImage(t,e,i,s){}onPoured(t,e,i,s,r,n){}onDelPoured(t,e,i,s){}onPour(t,e,i,s,r,n){}onDelPour(t,e,i,s){}onRegion(t,e,i,s,r,n){}onDelRegion(t,e,i,s){}onFill(t,e,i,s,r,n){}onDelFill(t,e,i,s){}onPoly(t,e,i,s,r,n){}onDelPoly(t,e,i,s){}onEQLenGrp(t,e,i,s,r){}onDelEQLenGrp(t,e,i,s){}onDelProp(t,e,i,s){}onObj(t,e,i,s,r,n){}onDelObj(t,e,i,s){}onArc(t,e,i,s,r,n){}onDelArc(t,e,i,s){}onCArc(t,e,i,s,r,n){}onDelCArc(t,e,i,s){}onLine(t,e,i,s,r,n){}onDelLine(t,e,i,s){}onPad(t,e,i,s,r,n){}onDelPad(t,e,i,s){}onVia(t,e,i,s,r,n){}onDelVia(t,e,i,s){}onDelConnect(t,e,i,s){}onPreference(t,e,i,s){}onSilkOpts(t,e,i,s,r){}onDelSilkOpts(t,e,i,s){}onPrimitive(t,e,i,s,r){}onDelPrimitive(t,e,i,s){}onNet(t,e,i,s,r){}onDelNet(t,e,i,s){}onPartition(t,e,i,s,r,n){}onDelPartition(t,e,i,s){}onActiveLayer(t,e,i,s){}onLayerPhys(t,e,i,s,r){}onDelLayerPhys(t,e,i,s){}onLayer(t,e,i,s,r){}onDelLayer(t,e,i,s){}onCanvas(t,e,i,s){}onDocDetail(t,e,i,s){}onStringNum(t,e){}onAttrNum(t,e){}onDimensionNum(t,e){}onBossNum(t,e){}onShellEntityNum(t,e){}onShellCutNum(t,e){}onCreaseNum(t,e){}onShellNum(t,e){}onFpcFillNum(t,e){}onTeardropNum(t,e){}onImageNum(t,e){}onPouredNum(t,e){}onPourNum(t,e){}onRegionNum(t,e){}onFillNum(t,e){}onPolyNum(t,e){}onObjNum(t,e){}onArcNum(t,e){}onCArcNum(t,e){}onLineNum(t,e){}onPadNum(t,e){}onViaNum(t,e){}onPartitionNum(t,e){}},GE=class extends Ko{constructor(t){super(),this.source={},this._action=t}get action(){return this._action}getSource(){return this.source}onString(t,e,i){this.source[t]=e}onAttr(t,e,i){i||(this.action&&this.action(t,e),this.source[t]=e)}onDimension(t,e,i,s,r,n){this.source[t]=r}onBoss(t,e,i,s,r,n){this.source[t]=r}onShellEntity(t,e,i,s,r,n){this.source[t]=r}onShellCut(t,e,i,s,r,n){this.source[t]=r}onCrease(t,e,i,s,r,n){this.source[t]=r}onShell(t,e,i,s,r,n){this.source[t]=r}onFpcFill(t,e,i,s,r,n){this.source[t]=r}onTeardrop(t,e,i,s,r,n){this.source[t]=r}onImage(t,e,i,s,r,n){this.source[t]=r}onPoured(t,e,i,s,r,n){this.source[t]=r}onPour(t,e,i,s,r,n){this.source[t]=r}onRegion(t,e,i,s,r,n){this.source[t]=r}onFill(t,e,i,s,r,n){this.source[t]=r}onPoly(t,e,i,s,r,n){this.source[t]=r}onObj(t,e,i,s,r,n){this.source[t]=r}onArc(t,e,i,s,r,n){this.source[t]=r}onCArc(t,e,i,s,r,n){this.source[t]=r}onLine(t,e,i,s,r,n){this.source[t]=r}onPad(t,e,i,s,r,n){this.source[t]=r}onVia(t,e,i,s,r,n){this.source[t]=r}},_h=class extends cc{onBoard(t,e,i,s){}onDelBoard(t,e,i){}constructor(t,e,i){super(t,e,i,new Go(!1)),this._compilerHandler=null}async init(t=!1,e=!1,i=!1,s=!1){return super.init(t,e,i,s)}onBlob(t,e,i,s,r){}onDelBlob(t,e,i,s){}onFont(t,e,i,s){}onDelFont(t,e,i,s){}canvasSelected(){return""}onSelectChange(t,e,i){}onSelectQuit(t,e){}onLayerFill(t,e,i,s,r){}onDelLayerFill(t,e,i,s){}setHandler(t){this._compilerHandler=t}onGroup(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onGroup(t,e,i,s,r)}onDelGroup(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelGroup(t,e,i,s)}onString(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onString(t,r,n)}onDelString(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelString(t,e,i,s)}onAttr(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onAttr(t,r,n)}onDelAttr(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelAttr(t,e,i,s)}onPanelizeSide(t,e,i,s){this._compilerHandler&&this._compilerHandler.onPanelizeSide(t,e,i,s)}onDelPanelizeSide(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPanelizeSide(t,e,i,s)}onPanelizeStamp(t,e,i,s){this._compilerHandler&&this._compilerHandler.onPanelizeStamp(t,e,i,s)}onDelPanelizeStamp(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPanelizeStamp(t,e,i,s)}onPanelize(t,e,i,s){this._compilerHandler&&this._compilerHandler.onPanelize(t,e,i,s)}onDelPanelize(t,e,i){this._compilerHandler&&this._compilerHandler.onDelPanelize(t,e,i)}onRuleSelector(t,e,i,s){this._compilerHandler&&this._compilerHandler.onRuleSelector(t,e,i,s)}onDelRuleSelector(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelRuleSelector(t,e,i,s)}onRule(t,e,i,s){this._compilerHandler&&this._compilerHandler.onRule(t,e,i,s)}onDelRule(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onDelRule(t,e,i,s,r)}onRuleTemplate(t,e,i,s){this._compilerHandler&&this._compilerHandler.onRuleTemplate(t,e,i,s)}onDimension(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onDimension(t,e,i,s,r,n)}onDelDimension(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelDimension(t,e,i,s)}onBoss(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onBoss(t,e,i,s,r,n)}onDelBoss(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelBoss(t,e,i,s)}onShellEntity(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onShellEntity(t,e,i,s,r,n)}onDelShellEntity(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelShellEntity(t,e,i,s)}onShellCut(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onShellCut(t,e,i,s,r,n)}onDelShellCut(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelShellCut(t,e,i,s)}onCrease(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onCrease(t,e,i,s,r,n)}onDelCrease(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelCrease(t,e,i,s)}onShell(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onShell(t,e,i,s,r,n)}onDelShell(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelShell(t,e,i,s)}onFpcFill(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onFpcFill(t,e,i,s,r,n)}onDelFpcFill(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelFpcFill(t,e,i,s)}onTeardrop(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onTeardrop(t,e,i,s,r,n)}onDelTeardrop(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelTeardrop(t,e,i,s)}onImage(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onImage(t,e,i,s,r,n)}onDelImage(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelImage(t,e,i,s)}onPoured(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onPoured(t,e,i,s,r,n)}onDelPoured(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPoured(t,e,i,s)}onPour(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onPour(t,e,i,s,r,n)}onDelPour(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPour(t,e,i,s)}onRegion(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onRegion(t,e,i,s,r,n)}onDelRegion(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelRegion(t,e,i,s)}onFill(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onFill(t,e,i,s,r,n)}onDelFill(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelFill(t,e,i,s)}onPoly(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onPoly(t,e,i,s,r,n)}onDelPoly(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPoly(t,e,i,s)}onEQLenGrp(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onEQLenGrp(t,e,i,s,r)}onDelEQLenGrp(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelEQLenGrp(t,e,i,s)}onDelProp(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelProp(t,e,i,s)}onObj(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onObj(t,e,i,s,r,n)}onDelObj(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelObj(t,e,i,s)}onArc(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onArc(t,e,i,s,r,n)}onDelArc(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelArc(t,e,i,s)}onCArc(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onCArc(t,e,i,s,r,n)}onDelCArc(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelCArc(t,e,i,s)}onLine(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onLine(t,e,i,s,r,n)}onDelLine(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelLine(t,e,i,s)}onPad(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onPad(t,e,i,s,r,n)}onDelPad(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPad(t,e,i,s)}onVia(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onVia(t,e,i,s,r,n)}onDelVia(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelVia(t,e,i,s)}onDelConnect(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelConnect(t,e,i,s)}onPreference(t,e,i,s){this._compilerHandler&&this._compilerHandler.onPreference(t,e,i,s)}onSilkOpts(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onSilkOpts(t,e,i,s,r)}onDelSilkOpts(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelSilkOpts(t,e,i,s)}onPrimitive(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onPrimitive(t,e,i,s,r)}onDelPrimitive(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPrimitive(t,e,i,s)}onNet(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onNet(t,e,i,s,r)}onDelNet(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelNet(t,e,i,s)}onPartition(t,e,i,s,r,n){this._compilerHandler&&this._compilerHandler.onPartition(t,e,i,s,r,n)}onDelPartition(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelPartition(t,e,i,s)}onActiveLayer(t,e,i,s){this._compilerHandler&&this._compilerHandler.onActiveLayer(t,e,i,s)}onLayerPhys(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onLayerPhys(t,e,i,s,r)}onDelLayerPhys(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelLayerPhys(t,e,i,s)}onLayer(t,e,i,s,r){this._compilerHandler&&this._compilerHandler.onLayer(t,e,i,s,r)}onDelLayer(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDelLayer(t,e,i,s)}onCanvas(t,e,i,s){this._compilerHandler&&this._compilerHandler.onCanvas(t,e,i,s)}onDocDetail(t,e,i,s){this._compilerHandler&&this._compilerHandler.onDocDetail(t,e,i,s)}onStringNum(t,e){this._compilerHandler&&this._compilerHandler.onStringNum(t,e)}onAttrNum(t,e){this._compilerHandler&&this._compilerHandler.onAttrNum(t,e)}onDimensionNum(t,e){this._compilerHandler&&this._compilerHandler.onDimensionNum(t,e)}onBossNum(t,e){this._compilerHandler&&this._compilerHandler.onBossNum(t,e)}onShellEntityNum(t,e){this._compilerHandler&&this._compilerHandler.onShellEntityNum(t,e)}onShellCutNum(t,e){this._compilerHandler&&this._compilerHandler.onShellCutNum(t,e)}onCreaseNum(t,e){this._compilerHandler&&this._compilerHandler.onCreaseNum(t,e)}onShellNum(t,e){this._compilerHandler&&this._compilerHandler.onShellNum(t,e)}onFpcFillNum(t,e){this._compilerHandler&&this._compilerHandler.onFpcFillNum(t,e)}onTeardropNum(t,e){this._compilerHandler&&this._compilerHandler.onTeardropNum(t,e)}onImageNum(t,e){this._compilerHandler&&this._compilerHandler.onImageNum(t,e)}onPouredNum(t,e){this._compilerHandler&&this._compilerHandler.onPouredNum(t,e)}onPourNum(t,e){this._compilerHandler&&this._compilerHandler.onPourNum(t,e)}onRegionNum(t,e){this._compilerHandler&&this._compilerHandler.onRegionNum(t,e)}onFillNum(t,e){this._compilerHandler&&this._compilerHandler.onFillNum(t,e)}onPolyNum(t,e){this._compilerHandler&&this._compilerHandler.onPolyNum(t,e)}onObjNum(t,e){this._compilerHandler&&this._compilerHandler.onObjNum(t,e)}onArcNum(t,e){this._compilerHandler&&this._compilerHandler.onArcNum(t,e)}onCArcNum(t,e){this._compilerHandler&&this._compilerHandler.onCArcNum(t,e)}onLineNum(t,e){this._compilerHandler&&this._compilerHandler.onLineNum(t,e)}onPadNum(t,e){this._compilerHandler&&this._compilerHandler.onPadNum(t,e)}onViaNum(t,e){this._compilerHandler&&this._compilerHandler.onViaNum(t,e)}onPartitionNum(t,e){this._compilerHandler&&this._compilerHandler.onPartitionNum(t,e)}},Sh=(t=>(t.CREATE="/pro-mgr/library/lib/create",t.UPDATE="/pro-mgr/library/lib/update",t.CANCEL_ASSOCIATE="/pro-mgr/library/lib/cancelAssociate",t.DELETE="/pro-mgr/library/lib/delete",t.BATCH_GET="/pro-mgr/library/lib/batchGet",t.GET="/pro-mgr/library/lib/get",t.GET1="/pro-mgr/library/lib/get1",t.CREATE1="/pro-mgr/library/lib/create1",t.UPDATE1="/pro-mgr/library/lib/update1",t.UPDATE_DEVICES="/pro-mgr/library/lib/updateDevices",t.STAR="/pro-mgr/library/lib/star",t.UNSTAR="/pro-mgr/library/lib/unstar",t.FORCE="/pro-mgr/library/lib/force",t.UPLOAD="/pro-mgr/library/lib/upload",t.DEVICE_LIST="/pro-mgr/library/lib/device/list",t.DEVICE_SEARCH_LIST="/pro-mgr/library/lib/device/searchList",t.DEVICE_SEARCH_BY_USERS_AND_TITLES="/pro-mgr/library/lib/device/searchByUsersAndTitles",t.DEVICE_GET_ATTR_VALUES="/pro-mgr/library/lib/device/getAttributeValues",t.DEVICE_GET_ATTR_KEYS="/pro-mgr/library/lib/device/getAttrKeys",t.COMPONENT_LIST="/pro-mgr/library/lib/component/list",t.COMPONENT_SEARCH_LIST="/pro-mgr/library/lib/component/searchList",t.COMPONENT_SEARCH_BY_USERS_AND_TITLES="/pro-mgr/library/lib/component/searchByUsersAndTitles",t))(Sh||{}),Ih=(t=>(t.GET_DEVICE="/pro-mgr/library/sheetSymbol/getDevice",t.GET_SYMBOL="/pro-mgr/library/sheetSymbol/getSymbol",t.FORCE="/pro-mgr/library/sheetSymbol/force",t.GET="/pro-mgr/library/sheetSymbol/get",t.CREATE="/pro-mgr/library/sheetSymbol/create",t.UPDATE="/pro-mgr/library/sheetSymbol/update",t.SET_CUSTOM="/pro-mgr/library/sheetSymbol/setCustom",t))(Ih||{}),HE={LIB:Sh,SHEET_SYMBOL:Ih};async function Ah(t,e,i,s){let{message:r}=await ot.messageBus.rpcCall(HE.LIB.COMPONENT_SEARCH_LIST,{titles:JSON.stringify([t]),docType:[+e],type:i,user_uuid:s,path:s});return r&&r.success?r:{...r}}async function YE(t,e,i,s,r=!1){let n=await Ah(t,e,i,s);if(!n.success||n.result===null)return{isExist:!1,component:null};if(wo)return r===!0?{isExist:!1,component:null}:{isExist:n&&n.result?n.result.length>0:!1,component:n.result};let a=[];n&&n.success&&n.result&&(n.result instanceof Array?a=n.result:a=n.result[t]||[]);let o=a.filter(l=>l.owner.uuid==s);return{isExist:o.length>0,component:o||null}}function VE(t,e){let i=0;return function(...s){let r=new Date().getTime();r-i>e&&(t.apply(this,s),i=r)}}function zE(t,e,i){let s,r,n,a,o,l,u=0,c=!1,h=!1,f=!0;if(typeof t!="function")throw new TypeError("Expected a function");e=Number(e)||0,typeof i=="object"&&(c=!!i.leading,h="maxWait"in i,n=h?Math.max(Number(i.maxWait)||0,e):n,f="trailing"in i?!!i.trailing:f);function d(A){let w=s,R=r;return s=r=void 0,u=A,a=t.apply(R,w),a}function p(A){return u=A,o=window.setTimeout(b,e),c?d(A):a}function m(A){let w=A-l,R=A-u,L=e-w;return h?Math.min(L,n-R):L}function g(A){let w=A-l,R=A-u;return l===void 0||w>=e||w<0||h&&R>=n}function b(){let A=Date.now();if(g(A))return y(A);o=window.setTimeout(b,m(A))}function y(A){return o=void 0,f&&s?d(A):(s=r=void 0,a)}function E(){o!==void 0&&clearTimeout(o),u=0,s=l=r=o=void 0}function _(){return o===void 0?a:y(Date.now())}function S(){let A=Date.now(),w=g(A);if(s=arguments,r=this,l=A,w){if(o===void 0)return p(l);if(h)return o=window.setTimeout(b,e),d(l)}return o===void 0&&(o=window.setTimeout(b,e)),a}return S.cancel=E,S.flush=_,S}var bs=new Map;bs.set("<","&lt;"),bs.set(">","&gt;"),bs.set('"',"&quot;"),bs.set("'","&apos;"),bs.set("&","&amp;");function Oh(t){if(typeof t!="string")return t;if(t==null)return"";function e(i){return bs.get(i)}return t==null?"":ca(t,bs)?(t+"").replace(/[<>'"&]/g,e):t}var Es=new Map;Es.set("&lt;","<"),Es.set("&gt;",">"),Es.set("&quot;",'"'),Es.set("&apos;","'"),Es.set("&amp;","&"),Es.set("&#039;","'");function XE(t){if(typeof t!="string")return t;if(t==null)return"";let e={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#039;":"'"};function i(s){return Es.get(s)}return ca(t,e)?(t+"").replace(/&([^;]+);/g,i):t}var kr=new Map;kr.set("~","&#126;"),kr.set("^","&#94;"),kr.set("#@$","&#35;&#64;&#36;"),kr.set("`","&#96;");function qE(t){if(typeof t!="string")return t;if(t==null)return"";let e={"~":"&#126;","^":"&#94;","#@$":"&#35;&#64;&#36;","`":"&#96;"};function i(s){return kr.get(s)}return ca(t,e)?t.replace(/(\~|\^|#@\$|\`)/g,i):t}function So(t){if(typeof t!="object"||t===null||t===void 0)return t;if(Array.isArray(t))return t.map(So);{let e={};for(let i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=So(t[i]));return e}}function Io(t){if(typeof t!="object"||t===null||t instanceof Date)return typeof t=="string"&&t.includes("<")&&(t=Oh(t)),t;if(Array.isArray(t))return t.map(Io);{let e={};for(let i in t)t.hasOwnProperty(i)&&(e[i]=Io(t[i]));return e}}function WE(t,e){let i="",s="";for(let r=0;r<t.length;r++)String(t[r])&&(s+=t[r]+"	");s=s.slice(0,-1),i+=s+`\r
`;for(let r=0;r<e.length;r++){s="";for(let n=0;n<t.length;n++)s+='"'+(typeof e[r][n]<"u"?e[r][n]:"")+'"	';s=s.slice(0,s.length-1),i+=s+`\r
`}return i}function JE(t,e={targetType:"blob"}){let{targetType:i,width:s,height:r}=e,n=new Image(s,r);return new Promise((a,o)=>{n.onload=function(){let l=document.createElement("canvas"),u=l.getContext("2d");switch(l.width=n.width,l.height=n.height,u.drawImage(n,0,0,n.width,n.height),i){case"dataURL":{a(l.toDataURL());break}case"blob":default:{l.toBlob(c=>{a(c)});break}}},n.onerror=l=>{o(l)},n.src=t})}async function KE(t,e={}){return new Promise((i,s)=>{try{let{targetType:r="blob",imageType:n="image/png"}=e,a=document.createElement("canvas"),o=a.getContext("2d");switch(a.width=t.width,a.height=t.height,o.putImageData(t,0,0),r){case"dataURL":{i(a.toDataURL(n));break}case"blob":default:{a.toBlob(l=>{i(l)},n);break}}}catch(r){s(r)}})}var $E=class extends Ko{constructor(t){super(),this._action=t}get action(){return this._action}onAttr(t,e,i){i||this.action(e.key,e.value)}};async function ZE(t,e,i,s=!0){let r={initResponse:null,d3modelItem:null,d3modelItemName:void 0,d3modelItemTransform:void 0,d3modelItemPath:void 0,d3modelItemId:void 0,compiler:null},n=new Map;return new Promise(async a=>{let o=new _h(t,e,i);r.compiler=o,o.setHandler(new $E(async(l,u)=>{if(typeof u<"u"&&n.set(l,u),n.has("3D Model")&&n.has("3D Model Title")&&n.has("3D Model Transform")){r.d3modelItemId=n.get("3D Model"),r.d3modelItemName=n.get("3D Model Title"),r.d3modelItemTransform=n.get("3D Model Transform");let c=on(r.d3modelItemId,!0);r.d3modelItemPath=c.path}})),r.initResponse=await o.init().catch(l=>({message:l.message,success:!1})),r.d3modelItemId&&s&&(r.d3modelItem=await ln(r.d3modelItemId)),r.compiler.destroy(),n.clear(),a(r)})}async function QE(t,e){let i={padList:[]};return new Promise(async s=>{try{let r=new E1(t,e,!0),n=await r.getPads()||{},a=Object.keys(n);for(let o=0;o<a.length;o++)i.padList.push({...n[a[o]]});r.destroy(),s(i)}catch{s(i)}})}function ty(t,e,i){if(typeof t!="number"&&(t=+t),isNaN(t))return NaN;if(e=e|0,e<=0||!t&&!i)return Math.round(t);let s=[1,10,100,1e3][e]||Math.pow(10,e)||10;if(i){let r=t<0?"-":"";for(t=t<0?-t:t,t=Math.round(t*s)+"";t.length<=e;)t="0"+t;return t=t.slice(0,-e)+"."+t.slice(-e),r+t}else return Math.round(t*s+1e-10)/s}function ey(t,e){typeof t=="string"&&(t=parseFloat(t));let i=Math.pow(10,e);return Math.round(t*i)/i}var iy={conversion(t,e,i){let s=t+2+e;return this[s](i)},conversion1(t,e,i){let s=t+2+e,r=this[s](i);return e=="mil"?Math.round(r*10)/10:Math.round(r*1e3)/1e3},mil2mil(t){return t},mil2mm(t){return t*.0254},mil2cm(t){return t*.00254},mil2inch(t){return t/1e3},mm2mm(t){return t},mm2mil(t){let e=Math.pow(10,5);return Math.round(t*39.37007874015748*e)/e},mm2cm(t){return t/10},mm2inch(t){let e=Math.pow(10,8);return Math.round(t*.03937007874015748*e)/e},cm2mil(t){let e=Math.pow(10,6);return Math.round(t*3.937007874015748*e)/e},cm2mm(t){return t*10},cm2inch(t){let e=Math.pow(10,7);return Math.round(t*.3937007874015748*e)/e},inch2mil(t){return t*1e3},inch2mm(t){return t*25.4},inch2cm(t){return t*2.54}};function sy(t,e,i){var s=t-e;return i||(i=1e-10),(s>0?s:-s)<i}function ry(t){return t<0?(360+t%360)%360:t>=360?t%360:t}function Rh(t,e,i,s){var r=t-i,n=e-s;return r*r+n*n}function ny(t,e,i,s){return Math.sqrt(Rh(t,e,i,s))}function ay(t,e,i,s){var r=i-t,n=s-e,a=Math.atan2(n,r);return a=a<0?a+Math.PI+Math.PI:a,a}function oy(t){return Dh(t)&&Object.keys(t).length===0}function Dh(t){return Object.prototype.toString.call(t).slice(8,-1)==="Object"}function ly(t){return wh(t)||Ch(t)}function wh(t){return Object.prototype.toString.call(t).slice(8,-1)==="AsyncFunction"}function Ch(t){return Object.prototype.toString.call(t).slice(8,-1)==="Function"}var Ot,uy=(Ot=class{},Ot.unitConversion=iy,Ot.ConcurrencyTaskQueue=jE,Ot.FootprintCompilerInstance=_h,Ot.FootprintCompilerHandlerProxy=Ko,Ot.FootprintCompilerAttr=GE,Ot.createCSVString=WE,Ot.svg2png=JE,Ot.imageData2NewImage=KE,Ot.htmlEncode=Oh,Ot.htmlDecode=XE,Ot.strEncode=qE,Ot.isEmptyObj=oy,Ot.isPlainObject=Dh,Ot.isFn=ly,Ot.isAsyncFunction=wh,Ot.isNormalFunction=Ch,Ot.formatDate=as,Ot.formatDate2=CE,Ot.deepClone=So,Ot.deepCloneWithHtmlEncode=Io,Ot.naturalSortComparator=_u,Ot.naturalSortSplitor=to,Ot.naturalSort=Hd,Ot.naturalStrSort=Yd,Ot.naturalSort1=Vd,Ot.naturalCompare=zd,Ot.isObjKeyInStr=ca,Ot.throttle=VE,Ot.debounce=zE,Ot.findList=Me,Ot.findListAll=vE,Ot.randomString=Wd,Ot.parseJSON=Jd,Ot.splitComponentId2FolderAndFilenameMixin=on,Ot.queryExistSameNameDocDetail=Ah,Ot.checkComponentNameDuplicate=YE,Ot.getFootprintPadInfo=QE,Ot.getFootprint3DInfo=ZE,Ot),Qe,F_=(Qe=class{},Qe.toFixed=ty,Qe.toFixed1=ey,Qe.floatEqual=sy,Qe.fixAngle=ry,Qe.getDistance=ny,Qe.getDistance2=Rh,Qe.getAngleByDot=ay,Qe),is,fe=(is=class{constructor(){this._changeCbs=new Set,this._map=new Map,this._debounceNotify=uy.debounce(()=>{this._notify()},50)}static get context(){return ha()}static getInstance(){var e;return(e=this.context.extendLibManager)!=null?e:this.context.extendLibManager=new is}_notify(){for(let e of this._changeCbs)e()}onChange(e){this._changeCbs.add(e)}offChange(e){this._changeCbs.delete(e)}_getLibId(e){return`${is.LIB_ID_PREFFIX}${e}`}async addLibWithId(e){this._map.set(e.id,await UE.set(e)),this._debounceNotify()}async addLib(e){let i=this._getLibId(e.title);return await this.addLibWithId({...e,id:i}),i}deleteLib(e){return this._debounceNotify(),this._map.delete(e)}hasLib(e){return this._map.has(e)}getLib(e){return this._map.get(e)}getLibs(){return Array.from(this._map.values())}updateLibTitle(e,i){let s=this._map.get(e);s&&(s.title=i,this._debounceNotify())}updateLibPosition(e,i){let s=this._map.get(e);s&&(s.position=i,this._debounceNotify())}},is.LIB_ID_PREFFIX="extend_lib_",is),cy=0;async function un(t,e,i,s=!0,r,n){let a=null,o="requestid"+ ++cy;r&&r(o);let l={user_uuid:t,path:e,type:i};n&&n(l);try{if(fe.getInstance().hasLib(t))return await hy(t,i,s);let c=await At("GET","/api/categories",l,{headers:{path:e},searchParams:!0});if(c.success)return{...c,result:await $o(c.result,s)}}catch(c){a=c,console.error("Fetch Category List Error",c)}let u=a?a.msg||a.message:void 0;return{code:a?a.code:dt.ERR_CODE.NORMAL,success:!1,result:null,msg:u||"Fetch Category List Error"}}async function hy(t,e,i){var r;let s=[];for(let n of e){let a=await((r=fe.getInstance().getLib(t))==null?void 0:r.getCategoryTreeDataItemsByCategoryType(n));a&&s.push(a)}return{code:0,success:!0,result:await $o(s.flat().map(n=>({uuid:n.id,parent_uuid:n.parentId,user_uuid:t,type:void 0,order_no:void 0,name_cn:void 0,name:n.title,created_at:n.created_at,updated_at:n.updated_at,title:n.title})),i)}}async function dy(t=!0){let e=null;try{let s=await At("POST","/api/open/deviceCate");if(s.success)return{...s,result:await $o(s.result,t)}}catch(s){e=s,console.error("Fetch Category List Error",s)}let i=e?e.msg||e.message:void 0;return{code:e?e.code:dt.ERR_CODE.NORMAL,success:!1,result:null,msg:i||"Fetch Category List Error"}}async function $o(t,e=!0){let i=[],s=[],r=[],n={},a={};t.forEach(h=>{h.name&&(a[h.name]=h.name_cn||h.name)});let o=t.filter(h=>!h.parent_uuid),l=t.filter(h=>!!h.parent_uuid),u=[],c={};if(o.forEach((h,f)=>{u.push(h.uuid),r.push({name:h.name,name_cn:h.name_cn,title:h.name,titleAdditional:h.name_cn||h.name,disableTranslate:h.name_cn===""?!0:h.name_cn===h.name,id:h.uuid,children:[],order_no:+h.order_no||0,parentId:void 0,created_at:h.created_at,updated_at:h.updated_at}),n[h.uuid]=f}),l.forEach(h=>{u.push(h.uuid);let f=n[h.parent_uuid];if(typeof f<"u"&&r[f]){let d=r[f];d.children.push({name:h.name,name_cn:h.name_cn,title:h.name,titleAdditional:h.name_cn||h.name,disableTranslate:h.name_cn===""?!0:h.name_cn===h.name,id:h.uuid,order_no:+h.order_no||0,children:[],parentId:d.id,created_at:h.created_at,updated_at:h.updated_at})}c[h.uuid]=h.parent_uuid}),r.sort(gu("order_no")),r.forEach(h=>{h.children.length>1&&h.children.sort(gu("order_no"))}),r.forEach(h=>{i.push({...h})}),e){let h=(await ot.messageBus.rpcCall("I18nTranslateService",{str:dt.CATEGORY_ITEM_ALL_TITLE})).message;i.unshift({title:dt.CATEGORY_ITEM_ALL_TITLE,titleAdditional:h||dt.CATEGORY_ITEM_ALL_TITLE,id:dt.CATEGORY_ITEM_ALL_VALUE,order_no:Number.MAX_SAFE_INTEGER,disableTranslate:!1,children:[],parentId:void 0}),s.push(dt.CATEGORY_ITEM_ALL_VALUE)}return{languageHashtable:a,treeData:i,selectedIds:s,categoryIds:u,childCategory2ParentCategoryMap:c,sourceCategoryList:t}}async function Is(t){let{categories:e,type:i,uuid:s}=t,r=await un(s,s,i),n=r.result?r.result.treeData:[],a=[],o=[],l=[],u=[];for(let p=0;p<e.length;p++){let{parentName:m,childName:g,parent_order_no:b,child_order_no:y}=e[p];if(m){let E=Me(n,"title",m);if(E.index>=0){if(a.push({name:E.data.title,type:i,user_uuid:s,order_no:E.data.order_no,parent_uuid:void 0,uuid:E.data.id}),g){let A=Me(E.data.children,"title",g);if(A.index>=0){o.push({name:A.data.title,type:i,user_uuid:s,order_no:A.data.order_no,parent_uuid:E.data.id,uuid:A.data.id});continue}u.push({name:g,type:i,user_uuid:s,order_no:p+1,parent_uuid:E.data.id,uuid:void 0});continue}continue}let _=Jr(),S=Jr();l.push({name:m,type:i,user_uuid:s,order_no:typeof b<"u"?b:p+1,parent_uuid:void 0,uuid:_}),g&&u.push({name:g,type:i,user_uuid:s,order_no:typeof y<"u"?y:p+1,parent_uuid:_,uuid:S})}}let c=[];if(l.length){let p=await ar(l,(m,g)=>{l[g].__remoteId=m.result.uuid});c=p.result?p.result.successList.map(m=>m.result):[]}let h=[];if(u.length){for(let m=0;m<u.length;m++){let g=Me(l,"uuid",u[m].parent_uuid);g.index>=0&&g.data.__remoteId&&(u[m].parent_uuid=g.data.__remoteId)}let p=await ar(u);h=p.result?p.result.successList.map(m=>m.result):[]}let f=c.concat(a),d=h.concat(o);return{allParentCreated:f,allChildCreated:d}}async function Nh(t){let{uuid:e,path:i,types:s,names:r}=t;return new Promise(async(n,a)=>{let o=await un(e,i,s,!1);if(o.code!==0){n({...o,code:dt.ERR_CODE.NORMAL,success:!1,result:null});return}let l={detail:[],arguments:t},{treeData:u}=o.result;for(let c=0;c<r.length;c++){let h=r[c].primary,f=r[c].secondary,d={primary:{name:h,name_cn:"",uuid:"",exist:!1,undefine:!1},secondary:{name:f,name_cn:"",uuid:"",exist:!1,undefine:!1}};if(typeof h>"u"){d.primary.exist=!1,d.primary.undefine=!0;continue}let p=Me(u,"title",h);if(p.index<=-1){d.primary.exist=!1,d.secondary.exist=!1,l.detail.push(d);continue}if(d.primary.exist=!0,d.primary.uuid=p.data.id,d.primary.name_cn=p.data.titleAdditional||h,typeof f>"u"){d.secondary.exist=!1,d.secondary.undefine=!0,l.detail.push(d);continue}let m=Me(p.data.children,"title",f);if(m.index<=-1){d.secondary.exist=!1,l.detail.push(d);continue}d.secondary.exist=!0,d.secondary.uuid=m.data.id,d.secondary.name_cn=m.data.titleAdditional||f,l.detail.push(d)}n({code:0,success:!0,result:l})})}function py(t){let e=new Map,i=[];for(let s of t)(!e.has(s.primary)||e.get(s.primary)!==s.secondary)&&(e.set(s.primary,s.secondary),i.push(s));return i}async function fy(t,e,i,s=!1){let r=await Nh(t),n=[],a=[],o=[],l=[],u=[];if(!s&&r.success&&r.result.detail.length){let h=new Map,f=new Map,d=new Map;r.result.detail.forEach((p,m)=>{(p.primary.name||p.primary.name_cn)&&!p.primary.exist&&!h.has(p.primary.name||p.primary.name_cn)&&(h.set(p.primary.name||p.primary.name_cn,!0),n.push({name:p.primary.name||p.primary.name_cn,type:e,user_uuid:i,order_no:0})),(p.primary.name||p.primary.name_cn)&&!p.primary.exist&&(p.secondary.name||p.secondary.name_cn)&&!p.secondary.exist&&f.get(p.secondary.name||p.secondary.name_cn)!==(p.primary.name||p.primary.name_cn)?(f.set(p.secondary.name||p.secondary.name_cn,p.primary.name||p.primary.name_cn),a.push({name:p.secondary.name||p.secondary.name_cn,type:e,user_uuid:i,uuid:p.secondary.uuid,order_no:0,parent_uuid:p.primary.uuid,parent_title:p.primary.name||p.primary.name_cn})):p.primary.exist&&(p.secondary.name||p.secondary.name_cn)&&!p.secondary.exist&&f.get(p.secondary.name||p.secondary.name_cn)!==(p.primary.name||p.primary.name_cn)&&(f.set(p.secondary.name||p.secondary.name_cn,p.primary.name||p.primary.name_cn),a.push({name:p.secondary.name||p.secondary.name_cn,type:e,user_uuid:i,uuid:p.secondary.uuid,order_no:0,parent_uuid:p.primary.uuid,parent_title:p.primary.name||p.primary.name_cn})),p.primary.exist&&!d.has(p.primary.uuid)&&(d.set(p.primary.uuid,p.primary.name||p.primary.name_cn),u.push({title:p.primary.name||p.primary.name_cn,uuid:p.primary.uuid,parent_uuid:""})),p.secondary.exist&&!d.has(p.secondary.uuid)&&(d.set(p.secondary.uuid,p.secondary.name||p.secondary.name_cn),u.push({title:p.secondary.name||p.secondary.name_cn,uuid:p.secondary.uuid,parent_uuid:p.primary.uuid}))})}if(!s&&n.length){let h=await ar(n);if(h.success&&h.result.successList.length&&(o=h.result.successList.map(f=>f.result),a.forEach(f=>{o.forEach(d=>{!f.parent_uuid&&f.parent_title===d.name&&(f.parent_uuid=d.uuid)})})),a.length){let f=await ar(a);f.success&&f.result.successList.length&&(l=f.result.successList.map(d=>d.result))}}else if(!s&&a.length){let h=await ar(a);h.success&&h.result.successList.length&&(l=h.result.successList.map(f=>f.result))}let c=[];return c=o.map(h=>({uuid:h.uuid,title:h.name,name:h.name,parent_uuid:h.parent_uuid})),c=c.concat(l.map(h=>({uuid:h.uuid,parent_uuid:h.parent_uuid,title:h.name,name:h.name}))),c=c.concat(u),c}async function my(t,e){let i=[],s=[],r=async o=>{let{message:l}=await ot.messageBus.rpcCall(Hi.TAG.DELETE,o);return l},n=null;try{for(let o=0;o<t.length;o++){let l=await r({...t[o],path:t[o].user_uuid});if(l.code===0&&l.success){let c={...l,message:"",result:{...t[o],path:t[o].user_uuid,...l.result[0]}};i.push(c),e&&e(c,o);continue}let u={...l,result:{...t[o]}};s.push(u)}return{code:0,success:!0,result:{successList:i,failList:s},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Del Categories Batch Error";return{code:n?n.code:dt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}async function gy(t){let{uuid:e,path:i,types:s,ids:r}=t;return new Promise(async(n,a)=>{let o=await un(e,i,s,!1);if(o.code!==0){n({...o,code:dt.ERR_CODE.NORMAL,success:!1,result:null});return}let l={detail:[],arguments:t},{treeData:u}=o.result;for(let c=0;c<r.length;c++){let h=r[c].primary,f=r[c].secondary,d={primary:{name:"",name_cn:"string",uuid:h,exist:!1,undefine:!1},secondary:{name:"",name_cn:"string",uuid:f,exist:!1,undefine:!1}};if(typeof h>"u"){d.primary.exist=!1,d.primary.undefine=!0;continue}let p=Me(u,"id",h);if(p.index<=-1){d.primary.exist=!1,d.secondary.exist=!1,l.detail.push(d);continue}if(d.primary.exist=!0,d.primary.name=p.data.title,d.primary.name_cn=p.data.titleAdditional||d.primary.name,typeof f>"u"){d.secondary.exist=!1,d.secondary.undefine=!0;continue}let m=Me(p.data.children,"id",f);if(m.index<=-1){d.secondary.exist=!1,l.detail.push(d);continue}d.secondary.exist=!0,d.secondary.name=m.data.title,d.secondary.name_cn=m.data.titleAdditional||d.secondary.name,l.detail.push(d)}n({code:0,success:!0,result:l})})}var Ey=class{constructor(){this._actuatorMap=new Map}clearAll(){this._actuatorMap.clear()}async addActuator(t,e,i,s){let r=t.filter(h=>!!h),n=`${r[0]}_${e[0]||0}_${i}_${s}`,a=`${r[0]}_${r[1]}_${e[1]||e[0]||0}_${i}_${s}`;if(!r[1]){if(this._actuatorMap.has(n))return this._actuatorMap.get(n);let h=new Promise(async(f,d)=>{let p=await Is({categories:[{parentName:r[0],parent_order_no:e[0]||0}],type:[s],uuid:i});f({uuids:p.allParentCreated.map(m=>m.uuid),titles:p.allParentCreated.map(m=>m.name)}),this._actuatorMap.delete(n)});return this._actuatorMap.set(n,h),h}let o=this._actuatorMap.get(n);o||(o=new Promise(async(h,f)=>{let d=await Is({categories:[{parentName:r[0],parent_order_no:e[0]||0}],type:[s],uuid:i});h({uuids:d.allParentCreated.map(p=>p.uuid),titles:d.allParentCreated.map(p=>p.name)}),this._actuatorMap.delete(n)}),this._actuatorMap.set(n,o));let l=await o,u=this._actuatorMap.get(a);u||(u=new Promise(async(h,f)=>{let d=await Is({categories:[{parentName:r[0],childName:r[1],parent_order_no:e[0]||0,child_order_no:e[1]||e[0]||0}],type:[s],uuid:i});h({uuids:d.allChildCreated.map(p=>p.uuid),titles:d.allChildCreated.map(p=>p.name)}),this._actuatorMap.delete(a)}),this._actuatorMap.set(a,u));let c=await u;return{uuids:[l.uuids[0],c.uuids[0]],titles:[l.titles[0],c.titles[0]]}}};async function yy(t,e){let i=[],s=[],r=async o=>{let{message:l}=await ot.messageBus.rpcCall(Hi.TAG.UPDATE,o);return l},n=null;try{for(let o=0;o<t.length;o++){let l=await r({...t[o],path:t[o].user_uuid});if(l.code===0&&l.success){let c={...l,message:"",result:{...t[o],path:t[o].user_uuid,...l.result[0]}};i.push(c),e&&e(c,o);continue}let u={...l,result:{...t[o]}};s.push(u)}return{code:0,success:!0,result:{successList:i,failList:s},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Update Categories Batch Error";return{code:n?n.code:dt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}var we,Ls=(we=class{},we.categoryAddtition=new Ey,we.fetchCategoryList=un,we.fetchInternalCategoryList=dy,we.addCategoriesBatch=ar,we.deleteCategoriesBatch=my,we.updateCategoriesBatch=yy,we.addCategoriesBatchByNameArray=Is,we.queryCategoryBatchByNames=Nh,we.queryCategoryBatchByIds=gy,we.formatRepeatCategoryArr=py,we.bindAndCreateCategory=fy,we.getCategoryNamesByTags=ls,we);async function ls(t,e,i){if(!t)return[];if(t instanceof Array)return t;let s=Ps(t);if(s=s.filter(u=>!!u),!s.length)return[];let r=(await ot.messageBus.rpcCall("LocaleCurrFetch",{})).message||"en",n=await un(e,e,i),a=n.result?n.result.sourceCategoryList:[],o=typeof s[1]<"u",l=[];for(let u=0;u<a.length;u++)if(a[u].name===s[0]||a[u].name_cn===s[0]){l.push(r=="en"?a[u].name:a[u].name_cn||a[u].name);break}if(o){for(let u=0;u<a.length;u++)if(a[u].name===s[1]||a[u].name_cn===s[1]){l.push(r=="en"?a[u].name:a[u].name_cn||a[u].name);break}}return l}async function Ty(t,e,i){let s=null,r=null,n=[],a=[],o=!1,l,u;if(t)if("data"in t)s=t.data,s.tags&&(s.tags instanceof Array?a=s.tags:a=Ps(s.tags));else{if(!t.uuid||!t.path)throw new Q("PARAMETER_VERIFICATION","missing 3d-model uuid or path data.");l=t.uuid,u=t.path,r=await $t.getD3Model({isProject:t.isProject,uuid:t.uuid,path:t.path}),r&&(r.title=r.display_title,a=await ls(r.tags,t.path,[5]))}if(!i){let c=await Ls.categoryAddtition.addActuator(a,[0],e,5);n=c.uuids,a=c.titles}return{d3modelItemOriginUuid:l,d3modelItemOriginPath:u,d3modelItemIn:s,d3modelItemOut:r,d3modelTagIds:n,d3modelTagTitles:a}}async function by(t){let{d3modelItemIn:e,d3modelItemOut:i,d3modelTagIds:s,d3modelTagTitles:r}=await Ty(t.d3model,t.path,t.isProject),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing 3d-model data.");LE(n.title),"path"in t.d3model&&t.d3model.override&&Ue(n,t.d3model.override);let a=await At("POST","/api/v2/components/add",JSON.stringify({...n,tags:s,owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(a.code===0&&a.success){let l=a.result,u=await di(l);return{title:l.title,description:l.description,path:l.path||t.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source,dataStrId:l.dataStrId,dataStr:u}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Q("CREATE_D3MODEL_DUP_TITLE",o):a.code===422?new Q("CREATE_D3MODEL_PERMISSIONS",o):new Q("CREATE_D3MODEL",o)}async function la(t=!1,e,i,s,r,n){let a=e.toLocaleLowerCase(),o=n?!!n.forceAsSymbol:!1,l=[];try{if(o||s&&[2,18,19,20,21,22,25,31,7,32,6].indexOf(s)>=0){let u={isProject:t,path:i,titles:[a],docType:s};l=(await $t.getSymbolSearchList(u))[a]||[]}if(s===28){let u={isProject:t,path:i,titles:[a]};l=(await $t.getDeviceSearchList(u))[a]||[]}if(s===4){let u={isProject:t,path:i,titles:[a]};l=(await $t.getFootprintSearchList(u))[a]||[]}return s===16&&(l=(await $t.getD3ModelSearchList({isProject:t,uid:i,path:i,page:1,pageSize:void 0,wd:a})).lists),{code:0,success:!0,result:l,message:""}}catch(u){return console.error(u),{code:-1,success:!1,result:[],message:u instanceof Q?`${String(u.action)}|${String(u.message)}`:u.message||"QueryComponentsByTitle call error."}}}function Eu(t,e){return t.path==e}function yu(t){try{let e=JSON.parse(t);return{parentName:e[0],childName:e[1]}}catch{return{parentName:"",childName:""}}}function _y(t){let e={};return e["device-owner"]=t.userIdSelected,e["device-lib"]=t.userIdSelected,e["footprint-name"]=t.footprintItem?t.footprintItem.display_title:"",e["symbol-name"]=t.symbolItem?t.symbolItem.display_title:"",e["new-symbol"]=t.isNeedCreateSymbolAndAssocia,e}function Ph(t,e){typeof t.footprintItemId<"u"&&(e.Footprint=t.footprintItemId),typeof t.symbolItemId<"u"&&(e.Symbol=t.symbolItemId)}async function Lh(t,e){let i=_y(t),s=t.footprintItem,r=t.symbolItem,n={},a=async(E,_)=>{let S="",A="",w=!1,R=e==="zh-hans",L=E.parent_tag,M=E.child_tag;if(L&&L.uuid&&(w=!0,S=R&&L.name_cn||L.name),w&&M.uuid){let B=R&&M.name_cn||M.name;S+=`:${B}`}if(S){let B=S.split(":")[0],q=S.split(":")[1],H=await Is({categories:q?[{parentName:B,childName:q}]:[{parentName:B}],type:[+_],uuid:i["device-owner"]}),V=H.allParentCreated[0]?H.allParentCreated[0].uuid:void 0,W=H.allChildCreated[0]?H.allChildCreated[0].uuid:void 0;V&&(A=W?[V,W]:[V])}return A},o={"file-owner":i["device-owner"],"file-name":i["footprint-name"],"file-describe":"","file-category":await a((s==null?void 0:s.tags)||{},4),"file-lib":i["device-lib"],"file-customTags":[]};if(s&&(s!=null&&s.custom_tags)&&!(o!=null&&o["file-category"])){let{parentName:E,childName:_}=yu(s.custom_tags);if(E){let S=await Is({categories:_?[{parentName:E,childName:_}]:[{parentName:E}],type:[4],uuid:i["device-owner"]}),A=S.allParentCreated[0]?S.allParentCreated[0].uuid:void 0,w=S.allChildCreated[0]?S.allChildCreated[0].uuid:void 0;A&&(o["file-customTags"]=w?[A,w]:[A])}}let l={"file-owner":i["device-owner"],"file-name":i["symbol-name"],"file-describe":"","file-category":await a((r==null?void 0:r.tags)||{},2),"file-lib":i["device-lib"],"file-customTags":[]};if(r&&(r!=null&&r.custom_tags)&&!l["file-category"]){let{parentName:E,childName:_}=yu(r.custom_tags);if(E){let S=await Is({categories:_?[{parentName:E,childName:_}]:[{parentName:E}],type:[4],uuid:i["device-owner"]}),A=S.allParentCreated[0]?S.allParentCreated[0].uuid:void 0,w=S.allChildCreated[0]?S.allChildCreated[0].uuid:void 0;A&&(l["file-customTags"]=w?[A,w]:[A])}}let u,c,h,f,d=!1,p=!1,m=!1;async function g(){if(i["footprint-name"])if(Eu(s,i["device-owner"]||i["device-lib"]))h=s,u=null;else{let E=await la(!1,o["file-name"],i["device-lib"],4);E.result.length<=0||(p=!0,h=s,u=E.result)}else h=null,u=null}async function b(){if(!i["new-symbol"]&&i["symbol-name"]&&r)if(Eu(r,i["device-owner"]||i["device-lib"]))f=r,c=null;else{let E=await la(!1,l["file-name"],i["device-lib"],r.docType);E.result.length<=0||(d=!0,c=E.result,f=r)}else f=null,c=null}await g(),await b();let y={isNeedConfirm:!1,updateCache:n,formData:i,newFootPrint:u,oldFootPrint:h,newSymbol:c,oldSymbol:f,confirmRes:t};return!d&&!p&&!m?(y.isNeedConfirm=!1,y):(y.isNeedConfirm=!0,y)}async function Zo(t,e,i,s){let r=null,n=null,a=[],o=[],l=!1,u,c;if(t)if("data"in t)t.data&&(r=t.data,r.tags&&(r.tags instanceof Array?o=r.tags:o=Ps(r.tags)));else{if(!t.uuid||!t.path)throw new Q("PARAMETER_VERIFICATION","missing footprint uuid or path data.");u=t.uuid,c=t.path,n=await $t.getFootprint({isProject:t.isProject,uuid:t.uuid,path:t.path}),n&&(n.title=n.display_title,s&&Array.isArray(s)?o=s:o=await ls(n.tags,t.path,[4]))}if(!i){let h=await Ls.categoryAddtition.addActuator(o,[0],e,4);a=h.uuids,o=h.titles}return{footprintItemOriginUuid:u,footprintItemOriginPath:c,footprintItemIn:r,footprintItemOut:n,footprintTagIds:a,footprintTagTitles:o}}async function Qo(t,e,i,s){let r=null,n=null,a=[],o=[],l=!1,u,c;if(t)if("data"in t)t.data&&(r=t.data,r.tags&&(r.tags instanceof Array?o=r.tags:o=Ps(r.tags)));else{if(!t.uuid||!t.path)throw new Q("PARAMETER_VERIFICATION","missing symbol uuid or path data.");u=t.uuid,c=t.path,n=await $t.getSymbol({isProject:t.isProject,uuid:t.uuid,path:t.path}),n&&(n.title=n.display_title,s&&Array.isArray(s)?o=s:o=await ls(n.tags,t.path,[2])),l=t.isProject}if(!i){let h=await Ls.categoryAddtition.addActuator(o,[0],e,2);a=h.uuids,o=h.titles}return{symbolItemOriginUuid:u,symbolItemOriginPath:c,symbolItemIn:r,symbolItemOut:n,symbolTagIds:a,symbolTagTitles:o}}async function vh(t,e,i,s){let r=null,n=null,a=[],o=[],l=!1;if(t)if("data"in t)t.data&&(r=t.data,r.tags&&(r.tags instanceof Array?o=r.tags:o=Ps(r.tags)));else{if(!t.uuid||!t.path)throw new Q("PARAMETER_VERIFICATION","missing device uuid or path data.");n=await $t.getDevice({isProject:t.isProject,uuid:t.uuid,path:t.path}),n&&(n.title=n.display_title,s&&Array.isArray(s)?o=s:o=await ls(n.tags,t.path,[3])),l=t.isProject}if(!i){let u=await Ls.categoryAddtition.addActuator(o,[0],e,3);a=u.uuids,o=u.titles}return{deviceItemIn:r,deviceItemOut:n,deviceTagIds:a,deviceTagTitles:o,isDeviceFromProject:l}}async function xh(t,e,i,s,r,n){let a=null,o=null,l=[],u=[],c,h;if(t){let{symbolItemIn:f,symbolItemOut:d,symbolTagIds:p,symbolTagTitles:m,symbolItemOriginUuid:g,symbolItemOriginPath:b}=await Qo(t,i,s,"path"in t&&t.override&&Array.isArray(t.override.tags)?t.override.tags:void 0);a=f,o=d,l=p,u=m,c=g,h=b}else if(r)if(n){let f=await $t.getSymbol({isProject:e,uuid:r,path:n});if(c=r,h=n,f){f.title=f.display_title,o=f,u=await ls(f.tags,n,[2]);let d=await Ls.categoryAddtition.addActuator(u,[0],i,2);l=d.uuids,u=d.titles}}else{let f=null;try{f=await $t.getSymbol({isProject:e,uuid:r,path:i}),c=r,h=i}catch(d){f=null,c=r,h=i,console.warn(d)}f||console.warn("[NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND]: the symbol bound to this device does not exist in the target library.")}return{symbolItemOriginUuid:c,symbolItemOriginPath:h,symbolItemIn:a,symbolItemOut:o,symbolTagIds:l,symbolTagTitles:u}}async function Mh(t,e,i,s,r,n){let a=null,o=null,l=[],u=[],c,h;if(t){let{footprintItemIn:f,footprintItemOut:d,footprintTagIds:p,footprintTagTitles:m,footprintItemOriginUuid:g,footprintItemOriginPath:b}=await Zo(t,i,s,"path"in t&&t.override&&Array.isArray(t.override.tags)?t.override.tags:void 0);a=f,o=d,l=p,u=m,c=g,h=b}else if(r)if(n){let f=await $t.getFootprint({isProject:e,uuid:r,path:n});if(c=r,h=n,f){f.title=f.display_title,o=f,u=await ls(f.tags,n,[4]);let d=await Ls.categoryAddtition.addActuator(u,[0],i,4);l=d.uuids,u=d.titles}}else{let f=null;try{f=await $t.getFootprint({isProject:e,uuid:r,path:i}),c=r,h=i}catch(d){f=null,c=r,h=i,console.warn(d)}f||console.warn("[NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND]: the footprint bound to this device does not exist in the target library.")}return{footprintItemOriginUuid:c,footprintItemOriginPath:h,footprintItemIn:a,footprintItemOut:o,footprintTagIds:l,footprintTagTitles:u}}async function vs(t=!1,e,i,s,r=[]){let n={isDuplicate:!1,path:s,uuids:[]},a=i.toLocaleLowerCase(),o=await la(t,a,s,e,ot.loginedUserUuid);if(o.success&&o.result&&o.result.length){let l=[];for(let u=0;u<o.result.length;u++){if(r.indexOf(o.result[u].uuid)>=0)continue;let c=(o.result[u].title||o.result[u].display_title).toLocaleLowerCase();if(a===c&&o.result[u].path===s){if(typeof e>"u"||e===28){l.push(o.result[u]);continue}if(typeof o.result[u].docType>"u"){l.push(o.result[u]);continue}if(o.result[u].docType===e){l.push(o.result[u]);continue}}}for(let u=0;u<l.length;u++)n.uuids.push(l[u].uuid);n.isDuplicate=!!n.uuids.length}return n}async function Bh(t,e,i,s,r,n){if(!s)return;let a=null;if("data"in s)r.title&&(a=await $t.createSymbol({isProject:t,path:e,symbol:{data:{...r,tags:n},ignoreDuplicateNameCheck:s.ignoreDuplicateNameCheck}})),i.attributes&&a&&typeof a=="object"&&(i.attributes.Symbol=a.uuid);else{s.override&&Ue(r,s.override);try{a=await $t.getSymbol({isProject:t,path:e,uuid:s.uuid})}catch{a=null}if(a&&typeof a=="object")i.attributes&&(i.attributes.Symbol=a.uuid);else if(r.title&&(a=await $t.createSymbol({isProject:t,path:e,symbol:{data:{...r,tags:n},ignoreDuplicateNameCheck:s.ignoreDuplicateNameCheck}})),i.attributes&&a&&typeof a=="object"){i.attributes.Symbol=a.uuid;let o=await Ri({origin:{docType:r.docType,isProject:s.isProject,uuid:s.uuid,path:s.path},target:{docType:a.docType,isProject:t,uuid:a.uuid,path:a.path}});if(!o.success)throw new Q("CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",o.message||"migrate canvas error.")}}}async function kh(t,e,i,s,r,n){if(!s)return;let a=null;if("data"in s)r.title&&(a=await $t.createFootprint({isProject:t,path:e,footprint:{data:{...r,tags:n}}})),i.attributes&&a&&typeof a=="object"&&(i.attributes.Footprint=a.uuid);else{s.override&&Ue(r,s.override);try{a=await $t.getFootprint({isProject:t,path:e,uuid:s.uuid})}catch{a=null}if(a&&typeof a=="object")i.attributes&&(i.attributes.Footprint=a.uuid);else if(r.title&&(a=await $t.createFootprint({isProject:t,path:e,footprint:{data:{...r,tags:n}}})),i.attributes&&a&&typeof a=="object"){i.attributes.Footprint=a.uuid;let o=await Ri({origin:{docType:r.docType,isProject:s.isProject,uuid:s.uuid,path:s.path},target:{docType:a.docType,isProject:t,uuid:a.uuid,path:a.path}});if(!o.success)throw new Q("CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",o.message||"migrate canvas error.")}}}async function Sy(t){let{deviceItemIn:e,deviceItemOut:i,deviceTagIds:s,deviceTagTitles:r,isDeviceFromProject:n}=await vh(t.device,t.path,t.isProject,"path"in t.device&&t.device.override&&Array.isArray(t.device.override.tags)?t.device.override.tags:void 0),a=e||i;if(!a)throw new Q("PARAMETER_VERIFICATION","missing device data.");if(a.title=t.device&&"path"in t.device&&t.device.override&&Sa(t.device.override,"title")||a.title,gh(a.title),(await vs(t.isProject,28,a.title,t.path)).isDuplicate)throw new Q("DEVICE_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");let{symbolItemIn:o,symbolItemOut:l,symbolTagIds:u,symbolTagTitles:c,symbolItemOriginUuid:h,symbolItemOriginPath:f}=await xh(t.symbol,n,t.path,t.isProject,a.attributes?a.attributes.Symbol:void 0,"data"in t.device?void 0:t.device.path),d=o||l,p=!!(t.symbol&&"data"in t.symbol);a.attributes&&l&&typeof l=="object"&&(a.attributes.Symbol=l.uuid),t.symbol&&"path"in t.symbol&&t.symbol.override&&Ue(d,t.symbol.override);let{footprintItemIn:m,footprintItemOut:g,footprintTagIds:b,footprintTagTitles:y,footprintItemOriginUuid:E,footprintItemOriginPath:_}=await Mh(t.footprint,n,t.path,t.isProject,a.attributes?a.attributes.Footprint:void 0,"data"in t.device?void 0:t.device.path),S=m||g;t.footprint&&"path"in t.footprint&&t.footprint.override&&Ue(S,t.footprint.override),a.attributes&&g&&typeof g=="object"&&(a.attributes.Footprint=g.uuid);let A=!1,w=!1,R=await Lh({symbolItem:d,footprintItem:S,userIdSelected:t.path,isNeedCreateSymbolAndAssocia:p},void 0);if(R.isNeedConfirm){let B=(await ot.messageBus.rpcCall("OpenSameNameSaveAsDlgService",{...R},31536e8)).message;if(!B){let q="an exception occurred while executing the cross-bind program.";throw new Q("CROSS_BIND",q)}if(B.action==="cancel"||B.action==="close"){let q="quit operate while executing the cross-bind program.";throw new Q("CROSS_BIND_EXIT",q)}R.updateCache=B.data,a.attributes&&Object.keys(R.updateCache).length&&(R.updateCache.symbolItemId&&(A=!0),R.updateCache.footprintItemId&&(w=!0),Ph(R.updateCache,a.attributes))}!A&&d&&await Bh(t.isProject,t.path,a,t.symbol,d,c),!w&&S&&await kh(t.isProject,t.path,a,t.footprint,S,y),"path"in t.device&&t.device.override&&(delete t.device.override.tags,Ue(a,t.device.override));let L=await At("POST","/api/devices",{...a,tags:s,owner:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(L.code===0&&L.success){let B=L.result;return{path:B.path||t.path,title:B.title,description:B.description,attributes:B.attributes,images:B.images,uuid:B.uuid,version:B.version,ticket:B.ticket,updateTime:lt(B.updateTime),createTime:lt(B.createTime),display_title:B.display_title,creator:Vt(B.creator),modifier:zt(B.modifier),owner:Xt(B.owner),tags:B.tags,source:B.source,symbol_type:B.symbol_type}}let M=L.message||L.msg||"Request Error.";throw L.code===1000001?new Q("CREATE_DEVICE_DUP_TITLE",M):L.code===422?new Q("CREATE_DEVICE_PERMISSIONS",M):new Q("CREATE_DEVICE",M)}async function Iy(t){let{footprintItemIn:e,footprintItemOut:i,footprintTagIds:s,footprintTagTitles:r}=await Zo(t.footprint,t.path,t.isProject,"path"in t.footprint&&t.footprint.override&&Array.isArray(t.footprint.override.tags)?t.footprint.override.tags:void 0),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing footprint data.");if(n.title="path"in t.footprint&&t.footprint.override&&Sa(t.footprint.override,"title")||n.title,yh(n.title),(await vs(t.isProject,4,n.title,t.path)).isDuplicate)throw new Q("FOOTPRINT_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in t.footprint&&t.footprint.override&&(delete t.footprint.override.tags,Ue(n,t.footprint.override));let a=await At("POST","/api/v2/components/add",{title:n.title,tags:s,docType:n.docType||4,description:n.description,owner:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(a.code===0&&a.success){let l=a.result;if(!("data"in t.footprint)&&t.footprint.uuid&&t.footprint.path){let u=await Ri({origin:{docType:n.docType,isProject:!!t.footprint.isProject,uuid:t.footprint.uuid,path:t.footprint.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!u.success)throw new Q("CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",u.message||"migrate canvas error.")}return{title:l.title,description:l.description,path:l.path||t.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Q("CREATE_FOOTPRINT_DUP_TITLE",o):a.code===422?new Q("CREATE_FOOTPRINT_PERMISSIONS",o):new Q("CREATE_FOOTPRINT",o)}async function Fh(t,e,i,s){let r=null,n=null,a=[],o=[],l=!1,u,c;if(t)if("data"in t)r=t.data,r.tags&&(r.tags instanceof Array?o=r.tags:o=Ps(r.tags));else{if(!t.uuid||!t.path)throw new Q("PARAMETER_VERIFICATION","missing simModel uuid or path data.");u=t.uuid,c=t.path,n=await $t.getSimModel({isProject:t.isProject,uuid:t.uuid,path:t.path}),n&&(n.title=n.display_title,s&&Array.isArray(s)?o=s:o=await ls(n.tags,t.path,[6]))}if(!i){let h=await Ls.categoryAddtition.addActuator(o,[0],e,6);a=h.uuids,o=h.titles}return{simModelItemOriginUuid:u,simModelItemOriginPath:c,simModelItemIn:r,simModelItemOut:n,simModelTagIds:a,simModelTagTitles:o}}async function Ay(t){let{simModelItemIn:e,simModelItemOut:i,simModelTagIds:s,simModelTagTitles:r}=await Fh(t.simModel,t.path,t.isProject,"path"in t.simModel&&t.simModel.override&&Array.isArray(t.simModel.override.tags)?t.simModel.override.tags:void 0),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing sim-model data.");if(n.title="path"in t.simModel&&t.simModel.override&&Sa(t.simModel.override,"title")||n.title,Th(n.title),(await vs(t.isProject,n.docType,n.title,t.path)).isDuplicate)throw new Q("SIM_MODEL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in t.simModel&&t.simModel.override&&(delete t.simModel.override.tags,Ue(n,t.simModel.override));let a=await At("POST","/api/v2/components/add",{...n,tags:s,owner:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(a.code===0&&a.success){let l=a.result;return{title:l.title,path:l.path||t.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source,dataStr:await di(l),key:l.key,iv:l.iv,dataStrId:l.dataStrId}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Q("CREATE_SIM_MODEL_DUP_TITLE",o):a.code===422?new Q("CREATE_SIM_MODEL_PERMISSIONS",o):new Q("CREATE_SIM_MODEL",o)}async function Oy(t){let{symbolItemIn:e,symbolItemOut:i,symbolTagIds:s,symbolTagTitles:r}=await Qo(t.symbol,t.path,t.isProject,"path"in t.symbol&&t.symbol.override&&Array.isArray(t.symbol.override.tags)?t.symbol.override.tags:void 0),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing symbol data.");if(n.title="path"in t.symbol&&t.symbol.override&&Sa(t.symbol.override,"title")||n.title,Eh(n.title),(await vs(t.isProject,n.docType,n.title,t.path)).isDuplicate)throw new Q("SYMBOL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in t.symbol&&t.symbol.override&&(delete t.symbol.override.tags,Ue(n,t.symbol.override));let a=await At("POST","/api/v2/components/add",{title:n.title,tags:s,docType:n.docType,description:n.description,owner:t.path,ignoreDuplicateNameCheck:t.symbol.ignoreDuplicateNameCheck},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(a.code===0&&a.success){let l=a.result;if(!("data"in t.symbol)&&t.symbol.uuid&&t.symbol.path){let u=await Ri({origin:{docType:n.docType,isProject:!!t.symbol.isProject,uuid:t.symbol.uuid,path:t.symbol.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!u.success)throw new Q("CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",u.message||"migrate canvas error.")}return{title:l.title,description:l.description,docType:l.docType,path:l.path||t.path,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Q("CREATE_SYMBOL_DUP_TITLE",o):a.code===422?new Q("CREATE_SYMBOL_PERMISSIONS",o):new Q("CREATE_SYMBOL",o)}async function Ry(t){let e=await At("GET",`/api/v2/devices/${t.uuid}`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result;if(typeof s.path<"u"&&s.path!==t.path)throw new Q("GET_DEVICE_NOT_FOUND","data not found");return{path:s.path,title:s.title,description:s.description,attributes:s.attributes,images:s.images,uuid:s.uuid,version:s.version,ticket:s.ticket,updateTime:lt(s.updateTime),createTime:lt(s.createTime),display_title:s.display_title,creator:Vt(s.creator),modifier:zt(s.modifier),owner:Xt(s.owner),tags:s.tags,source:s.source,symbol_type:s.symbol_type,isFavorite:s.isFavorite}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_DEVICE",i)}async function Dy(t){let e=await At("GET",`/api/v2/components/${t.uuid}`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result;if(typeof s.path<"u"&&s.path!==t.path)throw new Q("GET_FOOTPRINT_NOT_FOUND","data not found");return{title:s.title,description:s.description,path:s.path,docType:s.docType,uuid:s.uuid,version:s.version,ticket:s.ticket,updateTime:lt(s.updateTime),createTime:lt(s.createTime),display_title:s.display_title,creator:Vt(s.creator),modifier:zt(s.modifier),owner:Xt(s.owner),tags:s.tags,source:s.source,has_device:s.has_device,history_uuid:s.history_uuid,key:s.key,iv:s.iv,dataStr:await di(s),dataStrId:s.dataStrId}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_FOOTPRINT",i)}async function wy(t){let e=await At("GET",`/api/v2/components/${t.uuid}`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result;return{title:s.title,path:s.path,docType:s.docType,uuid:s.uuid,version:s.version,ticket:s.ticket,updateTime:lt(s.updateTime),createTime:lt(s.createTime),display_title:s.display_title,creator:Vt(s.creator),modifier:zt(s.modifier),owner:Xt(s.owner),tags:s.tags,source:s.source,history_uuid:s.history_uuid,key:s.key,iv:s.iv,dataStr:await di(s),dataStrId:s.dataStrId}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_SIM_MODEL",i)}function Di(t={}){let e={},i=Object.keys(t);for(let s=0;s<i.length;s++)i[s]===""||String(i[s])==="undefined"||typeof t[i[s]]>"u"||t[i[s]]==null||(e[i[s]]=t[i[s]]);return e}async function Cy(t){let e=await At("GET","/api/v2/components",{...Di(t.query||{}),path:t.path,uid:t.uid,page:t.page,pageSize:t.pageSize,docType:t.docType,tag:t.tags||[]},{headers:{path:t.path},searchParams:!0});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result,r=[];for(let n of s.lists)r.push({title:n.title,path:n.path||t.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:lt(n.updateTime),createTime:lt(n.createTime),display_title:n.display_title,creator:Vt(n.creator),modifier:zt(n.modifier),owner:Xt(n.owner),tags:n.tags,source:n.source,key:n.key,iv:n.iv,dataStr:await di(s),dataStrId:s.dataStrId});return{count:s.count,page:s.page,pageSize:s.pageSize,totalPage:s.totalPage,lists:r}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_SIM_MODEL_LIST",i)}async function Ny(t){let e=await At("GET",`/api/v2/components/${t.uuid}`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result;if(typeof s.path<"u"&&s.path!==t.path)throw new Q("GET_SYMBOL_NOT_FOUND","data not found");return{title:s.title,description:s.description,docType:s.docType,path:s.path,uuid:s.uuid,version:s.version,ticket:s.ticket,updateTime:lt(s.updateTime),createTime:lt(s.createTime),display_title:s.display_title,creator:Vt(s.creator),modifier:zt(s.modifier),owner:Xt(s.owner),tags:s.tags,source:s.source,has_device:s.has_device,history_uuid:s.history_uuid,key:s.key,iv:s.iv,dataStr:await di(s),dataStrId:s.dataStrId}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_SYMBOL",i)}async function Py(t){let{deviceItemIn:e,deviceItemOut:i,deviceTagIds:s,deviceTagTitles:r,isDeviceFromProject:n}=await vh(t.device,t.path,t.isProject,"path"in t.device&&t.device.override&&Array.isArray(t.device.override.tags)?t.device.override.tags:void 0),a=e||i;if(!a)throw new Q("PARAMETER_VERIFICATION","missing device data.");gh(a.title);let{symbolItemIn:o,symbolItemOut:l,symbolTagIds:u,symbolTagTitles:c,symbolItemOriginUuid:h,symbolItemOriginPath:f}=await xh(t.symbol,n,t.path,t.isProject,a.attributes?a.attributes.Symbol:void 0,"data"in t.device?void 0:t.device.path),d=o||l,p=!!(t.symbol&&"data"in t.symbol);t.symbol&&"path"in t.symbol&&t.symbol.override&&Ue(d,t.symbol.override),a.attributes&&l&&typeof l=="object"&&(a.attributes.Symbol=l.uuid);let{footprintItemIn:m,footprintItemOut:g,footprintTagIds:b,footprintTagTitles:y,footprintItemOriginUuid:E,footprintItemOriginPath:_}=await Mh(t.footprint,n,t.path,t.isProject,a.attributes?a.attributes.Footprint:void 0,"data"in t.device?void 0:t.device.path),S=m||g;t.footprint&&"path"in t.footprint&&t.footprint.override&&Ue(S,t.footprint.override),a.attributes&&g&&typeof g=="object"&&(a.attributes.Footprint=g.uuid);let A=!1,w=!1,R=await Lh({symbolItem:d,footprintItem:S,userIdSelected:t.path,isNeedCreateSymbolAndAssocia:p},void 0);if(R.isNeedConfirm){let B=(await ot.messageBus.rpcCall("OpenSameNameSaveAsDlgService",{...R},31536e8)).message;if(!B){let q="an exception occurred while executing the cross-bind program.";throw new Q("CROSS_BIND",q)}if(B.action==="cancel"||B.action==="close"){let q="quit operate while executing the cross-bind program.";throw new Q("CROSS_BIND_EXIT",q)}R.updateCache=B.data,a.attributes&&Object.keys(R.updateCache).length&&(R.updateCache.symbolItemId&&(A=!0),R.updateCache.footprintItemId&&(w=!0),Ph(R.updateCache,a.attributes))}!A&&d&&await Bh(t.isProject,t.path,a,t.symbol,d,c),!w&&S&&await kh(t.isProject,t.path,a,t.footprint,S,y),"path"in t.device&&t.device.override&&(delete t.device.override.tags,Ue(a,t.device.override));let L=await At("POST",`/api/v2/devices/${t.uuid}`,JSON.stringify({...a,tags:s,owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(L.code===0&&L.success&&L.result){let B=L.result;return{path:B.path||t.path,title:B.title,description:B.description,attributes:B.attributes,images:B.images,uuid:B.uuid,version:B.version,ticket:B.ticket,updateTime:lt(B.updateTime),createTime:lt(B.createTime),display_title:B.display_title,creator:Vt(B.creator),modifier:zt(B.modifier),owner:Xt(B.owner),tags:B.tags,source:B.source,symbol_type:B.symbol_type}}let M=L.message||L.msg||"Request Error.";throw L.code===422?new Q("CREATE_DEVICE_PERMISSIONS",M):new Q("UPDATE_DEVICE",M)}async function Ly(t){let{footprintItemIn:e,footprintItemOut:i,footprintTagIds:s,footprintTagTitles:r}=await Zo(t.footprint,t.path,t.isProject,"path"in t.footprint&&t.footprint.override&&Array.isArray(t.footprint.override.tags)?t.footprint.override.tags:void 0),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing footprint data.");if(yh(n.title),(await vs(t.isProject,4,n.title,t.path,[t.uuid])).isDuplicate)throw new Q("FOOTPRINT_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in t.footprint&&t.footprint.override&&(delete t.footprint.override.tags,Ue(n,t.footprint.override));let a=await At("POST",`/api/v2/components/${t.uuid}/update`,JSON.stringify({title:n.title,tags:s,docType:n.docType||4,description:n.description,owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(a.code===0&&a.success&&typeof a.result=="object"){let l=a.result;if(!("data"in t.footprint)&&t.footprint.uuid&&t.footprint.path){let u=await Ri({origin:{docType:n.docType,isProject:!!t.footprint.isProject,uuid:t.footprint.uuid,path:t.footprint.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!u.success)throw new Q("UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",u.message||"migrate canvas error.")}return{title:l.title,description:l.description,path:l.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Q("UPDATE_FOOTPRINT_PERMISSIONS",o):new Q("UPDATE_FOOTPRINT",o)}async function vy(t){let{simModelItemIn:e,simModelItemOut:i,simModelTagIds:s,simModelTagTitles:r}=await Fh(t.simModel,t.path,t.isProject,"path"in t.simModel&&t.simModel.override&&Array.isArray(t.simModel.override.tags)?t.simModel.override.tags:void 0),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing simModel data.");Th(n.title),"path"in t.simModel&&t.simModel.override&&(delete t.simModel.override.tags,Ue(n,t.simModel.override));let a=await At("POST",`/api/v2/components/${t.uuid}/update`,JSON.stringify({...n,tags:s,owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!a.success){let l=a.message||a.msg||"Request Error.";throw new Q("UPDATE_SIM_MODEL",l)}if(n.dataStr){let l=await At("POST",`/api/v2/components/${t.uuid}/update_canvas`,JSON.stringify({...n,tags:s,owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!l.success){let u=l.message||l.msg||"Request Error.";throw new Q("UPDATE_SIM_MODEL",u)}}if(a.code===0&&a.success&&typeof a.result=="object"){let l=a.result;return{title:l.title,path:l.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source,dataStr:await di(l),key:l.key,iv:l.iv,dataStrId:l.dataStrId}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Q("UPDATE_SIM_MODEL_PERMISSIONS",o):new Q("UPDATE_SYMBOL",o)}async function xy(t){let{symbolItemIn:e,symbolItemOut:i,symbolTagIds:s,symbolTagTitles:r}=await Qo(t.symbol,t.path,t.isProject,"path"in t.symbol&&t.symbol.override&&Array.isArray(t.symbol.override.tags)?t.symbol.override.tags:void 0),n=e||i;if(!n)throw new Q("PARAMETER_VERIFICATION","missing symbol data.");if(Eh(n.title),(await vs(t.isProject,n.docType,n.title,t.path,[t.uuid])).isDuplicate)throw new Q("SYMBOL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in t.symbol&&t.symbol.override&&(delete t.symbol.override.tags,Ue(n,t.symbol.override));let a=await At("POST",`/api/v2/components/${t.uuid}/update`,JSON.stringify({title:n.title,tags:s,docType:n.docType,description:n.description,owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(a.code===0&&a.success&&typeof a.result=="object"){let l=a.result;if(!("data"in t.symbol)&&t.symbol.uuid&&t.symbol.path){let u=await Ri({origin:{docType:n.docType,isProject:!!t.symbol.isProject,uuid:t.symbol.uuid,path:t.symbol.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!u.success)throw new Q("UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR",u.message||"migrate canvas error.")}return{title:l.title,description:l.description,docType:l.docType,path:l.path,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:lt(l.updateTime),createTime:lt(l.createTime),display_title:l.display_title,creator:Vt(l.creator),modifier:zt(l.modifier),owner:Xt(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Q("UPDATE_SYMBOL_PERMISSIONS",o):new Q("UPDATE_SYMBOL",o)}async function My(t){let e=await At("GET","/api/v2/components",{...t.query||{},path:t.path,uid:t.uid,page:t.page,pageSize:t.pageSize,docType:[16],tag:t.tags||[]},{headers:{path:t.path},searchParams:!0});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result,r=[];for(let n of s.lists)r.push({title:n.title,path:n.path||t.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:lt(n.updateTime),createTime:lt(n.createTime),display_title:n.display_title,creator:Vt(n.creator),modifier:zt(n.modifier),owner:Xt(n.owner),tags:n.tags,source:n.source,description:n.description,dataStr:await di(s),dataStrId:s.dataStrId});return{count:s.count,page:s.page,pageSize:s.pageSize,totalPage:s.totalPage,lists:r}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_D3MODEL_LIST",i)}async function By(t){let e=await At("GET","/api/v2/components",{...Di(t.query||{}),path:t.path,uid:t.uid,page:t.page,pageSize:t.pageSize,docType:[4],tag:t.tags||[]},{headers:{path:t.path},searchParams:!0});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result,r=[];for(let n of s.lists)r.push({title:n.title,path:n.path||t.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:lt(n.updateTime),createTime:lt(n.createTime),display_title:n.display_title,creator:Vt(n.creator),modifier:zt(n.modifier),owner:Xt(n.owner),tags:n.tags,source:n.source,description:n.description});return{count:s.count,page:s.page,pageSize:s.pageSize,totalPage:s.totalPage,lists:r}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_FOOTPRINT_LIST",i)}async function ky(t){let e=await At("GET","/api/v2/components",{...Di(t.query||{}),path:t.path,uid:t.uid,page:t.page,pageSize:t.pageSize,docType:t.docType,tag:t.tags||[]},{headers:{path:t.path},searchParams:!0});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result,r=[];for(let n of s.lists)r.push({title:n.title,path:n.path||t.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:lt(n.updateTime),createTime:lt(n.createTime),display_title:n.display_title,creator:Vt(n.creator),modifier:zt(n.modifier),owner:Xt(n.owner),tags:n.tags,source:n.source,description:n.description});return{count:s.count,page:s.page,pageSize:s.pageSize,totalPage:s.totalPage,lists:r}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_SYMBOL_LIST",i)}function Fy(t){return Array.isArray(t)?t:t?[t]:[]}async function Uy(t){let e=await At("GET","/api/v2/devices",{...Di(t.query||{}),path:t.path,uid:t.uid,page:t.page,pageSize:t.pageSize,tag:t.tags||[]},{headers:{path:t.path},searchParams:!0});if(e.code===0&&e.success&&typeof e.result=="object"){let s=e.result,r=[];for(let n of s.lists){let a={title:n.title,path:n.path||t.path,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:lt(n.updateTime),createTime:lt(n.createTime),display_title:n.display_title,creator:Vt(n.creator),modifier:zt(n.modifier),owner:Xt(n.owner),tags:n.tags,source:n.source,description:n.description,images:Fy(n.images),attributes:n.attributes,symbol_type:n.symbol_type,isFavorite:n.isFavorite};t.withPackage&&n.symbol&&(a.symbol=Object.assign(n.symbol,{updateTime:lt(n.symbol.updateTime)}),a.symbol_info=n.symbol_info),t.withPackage&&n.footprint&&(a.footprint=Object.assign(n.footprint,{updateTime:lt(n.footprint.updateTime)}),a.footprint_info=n.footprint_info),r.push(a)}return{count:s.count,page:s.page,pageSize:s.pageSize,totalPage:s.totalPage,lists:r}}let i=e.message||e.msg||"Request Error.";throw new Q("GET_DEVICE_LIST",i)}async function jy(t,e=!1,i=!1){if(t.titles){let{path:f,titles:d}=t,p=await At("POST","/api/v2/devices/searchByUserUuidAndTitle",{type:"device",titles:d,user_uuids:[f],path:f},{headers:{"Content-type":"application/json","content-type":"application/json",path:f}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let y=p.result[b];for(let E of y){let _=Xt(E.owner),S={title:E.title,path:E.path||f,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:lt(E.updateTime),createTime:lt(E.createTime),display_title:E.display_title,creator:e?{}:Vt(E.creator),modifier:i?{}:zt(E.modifier),owner:_,tags:E.tags,source:E.source,description:E.description,images:E.images,attributes:E.attributes,symbol_type:E.symbol_type,isFavorite:E.isFavorite};t.withPackage&&E.symbol&&(S.symbol=Object.assign(E.symbol,{updateTime:lt(E.symbol.updateTime)})),t.withPackage&&E.footprint&&(S.footprint=Object.assign(E.footprint,{updateTime:lt(E.footprint.updateTime)})),g[b].push(S)}}return g}let m=p.message||p.msg||"Request Error.";throw new Q("GET_DEVICE_SEARCH_LIST",m)}let{path:s,query:r={},uid:n,page:a,pageSize:o,tags:l=[],wd:u}=t,c=await At("POST","/api/devices/search",{...Di(r),path:s,uid:n,page:a,pageSize:o,tag:l,wd:u},{headers:{path:s},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let f=c.result,d=[],p=Object.keys(f.lists);for(let m=0;m<p.length;m++){let g=f.lists[p[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let y=g[b],E={title:y.title,path:y.path||s,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:lt(y.updateTime),createTime:lt(y.createTime),display_title:y.display_title,creator:e?{}:Vt(y.creator),modifier:i?{}:zt(y.modifier),owner:Xt(y.owner),tags:y.tags,source:y.source,description:y.description,images:y.images,attributes:y.attributes,symbol_type:y.symbol_type,isFavorite:y.isFavorite};t.withPackage&&y.symbol&&(E.symbol=Object.assign(y.symbol,{updateTime:y.symbol.updateTime}),E.symbol_info=y.symbol_info),t.withPackage&&y.footprint&&(E.footprint=Object.assign(y.footprint,{updateTime:y.footprint.updateTime}),E.footprint_info=y.footprint_info),d.push(E)}}return{count:f.count,page:f.page,pageSize:f.pageSize,totalPage:f.totalPage,lists:d,facets:f.facets}}let h=c.message||c.msg||"Request Error.";throw new Q("GET_DEVICE_SEARCH_LIST",h)}async function Gy(t,e=!1,i=!1){if(t.titles){let{path:d,titles:p,docType:m}=t,g=await At("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:m,titles:p,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(g.code===0&&g.success&&g.result){let y={};for(let E in g.result){y[E]=[];let _=g.result[E];for(let S of _){let A=Xt(S.owner),w={title:S.title,path:S.path||d,docType:S.docType,uuid:S.uuid,version:S.version,ticket:S.ticket,updateTime:lt(S.updateTime),createTime:lt(S.createTime),display_title:S.display_title,creator:e?{}:Vt(S.creator),modifier:i?{}:zt(S.modifier),owner:A,tags:S.tags,source:S.source,description:S.description};y[E].push(w)}}return y}let b=g.message||g.msg||"Request Error.";throw new Q("GET_SYMBOL_SEARCH_LIST",b)}let{path:s,query:r,uid:n,page:a,pageSize:o,tags:l=[],wd:u,docType:c}=t,h=await At("POST","/api/v2/components/search",{...Di(r||{}),path:s,uid:n,page:a,pageSize:o,docType:c,tag:l,wd:u},{headers:{path:s},searchParams:!0});if(h.code===0&&h.success&&typeof h.result=="object"){let d=h.result,p=[],m=Object.keys(d.lists);for(let g=0;g<m.length;g++){let b=d.lists[m[g]];if(Array.isArray(b)&&b.length)for(let y=0;y<b.length;y++){let E=b[y];p.push({title:E.title,path:E.path||s,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:lt(E.updateTime),createTime:lt(E.createTime),display_title:E.display_title,creator:e?{}:Vt(E.creator),modifier:i?{}:zt(E.modifier),owner:Xt(E.owner),tags:E.tags,source:E.source,description:E.description})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:p,facets:d.facets}}let f=h.message||h.msg||"Request Error.";throw new Q("GET_SYMBOL_SEARCH_LIST",f)}async function Hy(t,e=!1,i=!1){if(t.titles){let{path:f,titles:d}=t,p=await At("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:4,titles:d,user_uuids:[f],path:f},{headers:{"Content-type":"application/json","content-type":"application/json",path:f}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let y=p.result[b];for(let E of y){let _=Xt(E.owner),S={title:E.title,path:E.path||f,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:lt(E.updateTime),createTime:lt(E.createTime),display_title:E.display_title,creator:e?{}:Vt(E.creator),modifier:i?{}:zt(E.modifier),owner:_,tags:E.tags,source:E.source,description:E.description};g[b].push(S)}}return g}let m=p.message||p.msg||"Request Error.";throw new Q("GET_FOOTPRINT_SEARCH_LIST",m)}let{path:s,query:r={},uid:n,page:a,pageSize:o,tags:l=[],wd:u}=t,c=await At("POST","/api/v2/components/search",{...Di(r),path:s,uid:n,page:a,pageSize:o,docType:[4],tag:l,wd:u},{headers:{path:s},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let f=c.result,d=[],p=Object.keys(f.lists);for(let m=0;m<p.length;m++){let g=f.lists[p[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let y=g[b];d.push({title:y.title,path:y.path||s,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:lt(y.updateTime),createTime:lt(y.createTime),display_title:y.display_title,creator:e?{}:Vt(y.creator),modifier:i?{}:zt(y.modifier),owner:Xt(y.owner),tags:y.tags,source:y.source,description:y.description})}}return{count:f.count,page:f.page,pageSize:f.pageSize,totalPage:f.totalPage,lists:d,facets:f.facets}}let h=c.message||c.msg||"Request Error.";throw new Q("GET_FOOTPRINT_SEARCH_LIST",h)}async function Yy(t,e=!1,i=!1){if(t.titles){let{path:d,docType:p,titles:m}=t,g=await At("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:p,titles:m,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(g.code===0&&g.success&&g.result){let y={};for(let E in g.result){y[E]=[];let _=g.result[E];for(let S of _){let A=Xt(S.owner),w={title:S.title,path:S.path||d,docType:S.docType,uuid:S.uuid,version:S.version,ticket:S.ticket,updateTime:lt(S.updateTime),createTime:lt(S.createTime),display_title:S.display_title,creator:e?{}:Vt(S.creator),modifier:i?{}:zt(S.modifier),owner:A,tags:S.tags,source:S.source,key:S.key,iv:S.iv,dataStr:void 0,dataStrId:S.dataStrId};_.push(w)}}return y}let b=g.message||g.msg||"Request Error.";throw new Q("GET_SIM_MODEL_SEARCH_LIST",b)}let{path:s,query:r={},uid:n,page:a,pageSize:o,docType:l,tags:u=[],wd:c}=t,h=await At("POST","/api/v2/components/search",{...Di(r),path:s,uid:n,page:a,pageSize:o,docType:l,tag:u,wd:c},{headers:{path:s},searchParams:!0});if(h.code===0&&h.success&&typeof h.result=="object"){let d=h.result,p=[],m=Object.keys(d.lists);for(let g=0;g<m.length;g++){let b=d.lists[m[g]];if(Array.isArray(b)&&b.length)for(let y=0;y<b.length;y++){let E=b[y];p.push({title:E.title,path:E.path||s,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:lt(E.updateTime),createTime:lt(E.createTime),display_title:E.display_title,creator:e?{}:Vt(E.creator),modifier:i?{}:zt(E.modifier),owner:Xt(E.owner),tags:E.tags,source:E.source,key:E.key,iv:E.iv,dataStr:await di(d),dataStrId:d.dataStrId})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:p,facets:d.facets}}let f=h.message||h.msg||"Request Error.";throw new Q("GET_SIM_MODEL_SEARCH_LIST",f)}async function Vy(t){if(t.attributes.Symbol){let n=await $t.getSymbol({isProject:t.isProject,uuid:t.attributes.Symbol,path:t.path})}if(t.attributes.Footprint){let n=await $t.getFootprint({isProject:t.isProject,uuid:t.attributes.Footprint,path:t.path})}let e=await $t.getDevice({isProject:t.isProject,uuid:t.uuid,path:t.path}),i=Object.keys(t.attributes||{});for(let n=0;n<i.length;n++)e.attributes[i[n]]=t.attributes[i[n]];let s=await At("POST",`/api/v2/devices/${t.uuid}`,JSON.stringify({...e,title:e.display_title||e.title,tags:e.tags?fh(e.tags):[],owner:t.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(s.code===0&&s.success&&s.result){let n=s.result;return{path:n.path||t.path,title:n.title,description:n.description,attributes:n.attributes,images:n.images,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:lt(n.updateTime),createTime:lt(n.createTime),display_title:n.display_title,creator:Vt(n.creator),modifier:zt(n.modifier),owner:Xt(n.owner),tags:n.tags,source:n.source,symbol_type:n.symbol_type}}let r=s.message||s.msg||"Request Error.";throw s.code===422?new Q("CREATE_DEVICE_PERMISSIONS",r):new Q("UPDATE_DEVICE_ATTRIBUTES",r)}async function zy(t,e=!1,i=!1){if(t.titles){let{path:f,titles:d}=t;if(wo){let p=await At("POST","/api/client/model/find",{titles:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:f}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let y=p.result[b];for(let E of y){let _={fileName:E.fileName,path:E.path,lib:E.lib};g[b].push(_)}}return g}let m=p.message||p.msg||"Request Error.";throw new Q("GET_D3MODEL_SEARCH_LIST",m)}else{let p=await At("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:16,titles:d,user_uuids:[f],path:f},{headers:{"Content-type":"application/json","content-type":"application/json",path:f}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let y=p.result[b];for(let E of y){let _=Xt(E.owner),S={title:E.title,path:E.path||f,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:lt(E.updateTime),createTime:lt(E.createTime),display_title:E.display_title,creator:e?{}:Vt(E.creator),modifier:i?{}:zt(E.modifier),owner:_,tags:E.tags,source:E.source,description:E.description,dataStr:E.dataStr};g[b].push(S)}}return g}let m=p.message||p.msg||"Request Error.";throw new Q("GET_D3MODEL_SEARCH_LIST",m)}}let{path:s,query:r={},uid:n,page:a,pageSize:o,tags:l=[],wd:u}=t,c=await At("POST","/api/v2/components/search",{...Di(r),path:s,uid:n,page:a,pageSize:o,docType:[16],tag:l,wd:u},{headers:{path:s},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let f=c.result,d=[],p=Object.keys(f.lists);for(let m=0;m<p.length;m++){let g=f.lists[p[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let y=g[b];d.push({title:y.title,path:y.path||s,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:lt(y.updateTime),createTime:lt(y.createTime),display_title:y.display_title,creator:e?{}:Vt(y.creator),modifier:i?{}:zt(y.modifier),owner:Xt(y.owner),tags:y.tags,source:y.source,description:y.description,dataStr:y.dataStr})}}return{count:f.count,page:f.page,pageSize:f.pageSize,totalPage:f.totalPage,lists:d,facets:f.facets}}let h=c.message||c.msg||"Request Error.";throw new Q("GET_D3MODEL_SEARCH_LIST",h)}async function Xy(t,e=!1,i=!1){if(t.titles){let{path:f,titles:d}=t,p=await At("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:29,titles:d,user_uuids:[f],path:f},{headers:{"Content-type":"application/json","content-type":"application/json",path:f}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let y=p.result[b];for(let E of y){let _=Xt(E.owner),S={title:E.title,path:E.path||f,docType:E.docType,uuid:E.uuid,version:E.version,ticket:E.ticket,updateTime:lt(E.updateTime),createTime:lt(E.createTime),display_title:E.display_title,creator:e?{}:Vt(E.creator),modifier:i?{}:zt(E.modifier),owner:_,tags:E.tags,source:E.source,description:E.description};g[b].push(S)}}return g}let m=p.message||p.msg||"Request Error.";throw new Q("GET_PANEL_LIB_SEARCH_LIST",m)}let{path:s,query:r={},uid:n,page:a,pageSize:o,tags:l=[],wd:u}=t,c=await At("POST","/api/v2/components/search",{...Di(r),path:s,uid:n,page:a,pageSize:o,docType:[29],tag:l,wd:u},{headers:{path:s},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let f=c.result,d=[],p=Object.keys(f.lists);for(let m=0;m<p.length;m++){let g=f.lists[p[m]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let y=g[b];d.push({title:y.title,path:y.path||s,docType:y.docType,uuid:y.uuid,version:y.version,ticket:y.ticket,updateTime:lt(y.updateTime),createTime:lt(y.createTime),display_title:y.display_title,creator:e?{}:Vt(y.creator),modifier:i?{}:zt(y.modifier),owner:Xt(y.owner),tags:y.tags,source:y.source,description:y.description})}}return{count:f.count,page:f.page,pageSize:f.pageSize,totalPage:f.totalPage,lists:d,facets:f.facets}}let h=c.message||c.msg||"Request Error.";throw new Q("GET_PANEL_LIB_SEARCH_LIST",h)}var qy=class extends Jo{async getDevice(t){return await Ry(t)}async getSymbol(t){return await Ny(t)}async getFootprint(t){return await Dy(t)}async getD3Model(t){return await ln(t.uuid,t.path)}async getSimModel(t){return await wy(t)}async getDeviceList(t){return await Uy(t)}async getSymbolList(t){return await ky(t)}async getFootprintList(t){return await By(t)}async getD3ModelList(t){return await My(t)}async getSimModelList(t){return Cy(t)}async getDeviceSearchList(t){return await jy(t,!0,!0)}async getSymbolSearchList(t){return await Gy(t,!0,!0)}async getFootprintSearchList(t){return await Hy(t,!0,!0)}async getPanelLibSearchList(t){return await Xy(t,!0,!0)}async getD3ModelSearchList(t){return await zy(t,!0,!0)}async getSimModelSearchList(t){return Yy(t,!0,!0)}async createDevice(t){return await Sy(t)}async createSymbol(t){return await Oy(t)}async createFootprint(t){return await Iy(t)}async createD3Model(t){return await by(t)}async createSimModel(t){return await Ay(t)}async updateDevice(t){return await Py(t)}async updateDeviceAttributes(t){return await Vy(t)}async updateSymbol(t){return await xy(t)}async updateFootprint(t){return await Ly(t)}async updatesimModel(t){return await vy(t)}async deleteDevice(t){let e=await At("POST",`/api/v4/devices/${t.uuid}/delete`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!(e.code===0&&e.success)){let i=e.message||e.msg||"Request Error.";throw new Q("DELETE_DEVICE",i)}}async deleteSymbol(t){let e=await At("POST",`/api/v4/components/${t.uuid}/delete`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!(e.code===0&&e.success)){let i=e.message||e.msg||"Request Error.";throw new Q("DELETE_SYMBOL",i)}}async deleteFootprint(t){let e=await At("POST",`/api/v4/components/${t.uuid}/delete`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!(e.code===0&&e.success)){let i=e.message||e.msg||"Request Error.";throw new Q("DELETE_FOOTPRINT",i)}}async deleteSimModel(t){let e=await At("POST",`/api/v4/components/${t.uuid}/delete`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!(e.code===0&&e.success)){let i=e.message||e.msg||"Request Error.";throw new Q("DELETE_SIM_MODEL",i)}}async delete3DModel(t){let e=await At("POST",`/api/v4/components/${t.uuid}/delete`,{uuid:t.uuid,path:t.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:t.path}});if(!(e.code===0&&e.success)){let i=e.message||e.msg||"Request Error.";throw new Q("DELETE_3DMODEL",i)}}},Vi=class{static diffVersionDevice(t){ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["Devices have not been added to the project library, project library has devices with different versions from the same source :",t.join("\u3001")]})}static diffVersionSymbol(t){ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["Symbols have not been added to the project library, project library has symbols with different versions from the same source :",t.join("\u3001")]})}static diffVersionFootprint(t){ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["Footprints have not been added to the project library, project library has footprints with different versions from the same source :",t.join("\u3001")]})}static sameVersionDevice(t){ot.messageBus.publish("logI18nLogView",{type:"info",msg:["Devices have not been added to the project library, project library has devices with same versions from the same source :",t.join("\u3001")]})}static sameVersionSymbol(t){ot.messageBus.publish("logI18nLogView",{type:"info",msg:["Symbols have not been added to the project library, project library has symbols with same versions from the same source :",t.join("\u3001")]})}static sameVersionFootprint(t){ot.messageBus.publish("logI18nLogView",{type:"info",msg:["Footprints have not been added to the project library, project library has footprints with same versions from the same source :",t.join("\u3001")]})}static renamedDevice(t){ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["Devices are automatically renamed when they are added to the project library :",t.join("\u3001")]})}static renamedSymbol(t){ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["Symbols are automatically renamed when they are added to the project library :",t.join("\u3001")]})}static renamedFootprint(t){ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["Footprints are automatically renamed when they are added to the project library :",t.join("\u3001")]})}},Wy=class{constructor(t){let{renameKey:e=!0}=t;this.renameKey=e}async rename(t,...e){let{message:i}=await ot.messageBus.rpcCall("allowDuplicateNames");return this.renameKey||!i?this.renaming(t,...e):i?{success:!0}:this.isRename(t,...e)}},Jy=class extends Wy{constructor(t){let{matchKey:e=!0,byUUID:i=!1,byVersion:s=!1,bySource:r=!1}=t;super(t),this.matchKey=e,this.byUUID=i,this.byVersion=s,this.bySource=r}async match(t){if(this.matchKey)return this.matching(t)}},tl=class extends Jy{constructor(t){let{path:e,data:i}=t;super(t),this.origin={},this.path=e,this.data=i}async onAdd(t){let e=JSON.parse(JSON.stringify(t));return e.path||(e.path=this.path),await M1({data:e}),$a(e),e.project_uuid=e.path=this.path,e}async onUpdate(t){let e=JSON.parse(JSON.stringify(t));return $a(e),e}async getTemplate(t,e={}){let{uuid:i,path:s,updateTime:r}=t,n=`${i}${dr}${s}`,a=r==null?void 0:r.toString(),o=Object.assign(t,{path:s,source:n,version:a},e);return $a(o),o}},Uh=class extends tl{async getOrigin(){var s,r;let{path:t,uuid:e,isProject:i}=this.data;if(pr(this.data)){let{override:n}=this.data;if(n&&n.attributes)return{success:!1,message:"Api call error!"};if(i){let{message:a}=await ot.messageBus.rpcCall("/pro-mgr/hasProject",[t]);if(a){let o=[e,t],l=(await ot.messageBus.rpcCall(Tt.DEVICE.GET,o)).message;if(l){let u=Object.assign(l,{uuid:e,path:t});this.origin=await this.getTemplate(u,n)}else return{success:!1,message:"Device details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(fe.getInstance().hasLib(t)){let a=await((r=(s=fe.getInstance().getLib(t))==null?void 0:s.device)==null?void 0:r.getTransformedDetail(e));if(a){let o=Object.assign(a,{uuid:e,path:t});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Device details data does not exist"}}else{let a={path:t,uuid:e},{message:o}=await ot.messageBus.rpcCall(Hi.DEVICE.GET,a);if(o.success){let l=o.result,u=Object.assign(l,{uuid:e,path:t});this.origin=await this.getTemplate(u,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(t){let e=t.display_title||t.title,i=[e,this.path],s=(await ot.messageBus.rpcCall(Tt.DEVICE.TRY_RENAME,i)).message;return s&&(t.display_title=t.title=s),e!==s&&Vi.renamedDevice([e]),{success:!0}}},Ky=class extends Uh{onHandle(t){return this.onAdd(t)}async matching(t){if(this.byUUID){let e=[t.uuid,this.path],i=await(await ot.messageBus.rpcCall(Tt.DEVICE.GET,e)).message;if(t.ticket&&(i!=null&&i.ticket)&&(i==null?void 0:i.ticket)===t.ticket)return i}if(t.source){if(this.byVersion){let e=[t.source,t.version,this.path],i=(await ot.messageBus.rpcCall(Tt.DEVICE.GET_BY_SOURCE_VERSION,e)).message;if(i)return Vi.sameVersionDevice([t.display_title||t.title]),i}if(this.bySource){let e=[t.source,this.path],i=(await ot.messageBus.rpcCall(Tt.DEVICE.GET_LAST,e)).message;if(i)return Vi.diffVersionDevice([t.display_title||t.title]),i}}}async isRename(t){let e=[t.display_title||t.title,this.path];return(await ot.messageBus.rpcCall(Tt.DEVICE.IS_RENAME,e)).message?{success:!1,message:"Device duplicate name"}:{success:!0}}async start(){let t=await this.getOrigin();if(!t.success)return{success:!1,code:t.code,message:t.message};let e,i;if(this.origin){let s=await this.match(this.origin);if(s)e={success:!0,result:s};else{let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message};i=this.origin}}return{success:!0,result:{respond:e,addData:i}}}},jh=class extends tl{async getOrigin(){var s,r;let{path:t,uuid:e,isProject:i}=this.data;if(pr(this.data)){let{override:n}=this.data;if(i){let{message:a}=await ot.messageBus.rpcCall("/pro-mgr/hasProject",[t]);if(a){let o=[e,t],l=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET,o)).message;if(l){let u=Object.assign(l,{uuid:e,path:t});this.origin=await this.getTemplate(u,n)}else return{success:!1,message:"Footprint details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(fe.getInstance().hasLib(t)){let a=await((r=(s=fe.getInstance().getLib(t))==null?void 0:s.footprint)==null?void 0:r.getTransformedDetail(e));if(a){let o=Object.assign(a,{uuid:e,path:t});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Footprint details data does not exist"}}else{let a={path:t,uuid:e},{message:o}=await ot.messageBus.rpcCall(Hi.COMPONENT.GET,a);if(o.success){let l=o.result,u=Object.assign(l,{uuid:e,path:t});this.origin=await this.getTemplate(u,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(t){let e=t.display_title||t.title,i=[e,this.path],s=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.TRY_RENAME,i)).message;return s&&(t.display_title=t.title=s),e!==s&&Vi.renamedFootprint([e]),{success:!0}}},el=class extends jh{onHandle(t){return this.onAdd(t)}async matching(t){if(this.byUUID){let e=[t.uuid,this.path],i=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET,e)).message;if(t.ticket&&(i!=null&&i.ticket)&&(i==null?void 0:i.ticket)===t.ticket)return i}if(t.source){if(this.byVersion){let e=[t.source,t.version,this.path],i=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET_BY_SOURCE_VERSION,e)).message;if(i)return Vi.sameVersionFootprint([t.display_title||t.title]),i}if(this.bySource){let e=[t.source,this.path],i=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET_LAST,e)).message;if(i)return Vi.diffVersionFootprint([t.display_title||t.title]),i}}}async isRename(t){let e=[t.display_title||t.title,this.path];return(await ot.messageBus.rpcCall(Tt.FOOTPRINT.IS_RENAME,e)).message?{success:!1,message:"Library duplicate name"}:{success:!0}}async start(){let t=await this.getOrigin();if(!t.success)return{success:!1,code:t.code,message:t.message};let e,i;if(this.origin){let s=await this.match(this.origin);if(s)e={success:!0,result:s};else{let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message};i=this.origin}}return{success:!0,result:{respond:e,addData:i}}}},Gh=class extends tl{async getOrigin(){var s,r;let{path:t,uuid:e,isProject:i}=this.data;if(pr(this.data)){let{override:n}=this.data;if(i){let{message:a}=await ot.messageBus.rpcCall("/pro-mgr/hasProject",[t]);if(a){let o=[e,t],l=(await ot.messageBus.rpcCall(Tt.SYMBOL.GET,o)).message;if(l){let u=Object.assign(l,{uuid:e,path:t});this.origin=await this.getTemplate(u,n)}else return{success:!1,message:"Symbol details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(fe.getInstance().hasLib(t)){let a=await((r=(s=fe.getInstance().getLib(t))==null?void 0:s.symbol)==null?void 0:r.getTransformedDetail(e));if(a){let o=Object.assign(a,{uuid:e,path:t});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Symbol details data does not exist"}}else{let a={path:t,uuid:e},{message:o}=await ot.messageBus.rpcCall(Hi.COMPONENT.GET,a);if(o.success){let l=o.result,u=Object.assign(l,{uuid:e,path:t});this.origin=await this.getTemplate(u,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(t){let e=t.display_title||t.title,i=[e,this.path],s=(await ot.messageBus.rpcCall(Tt.SYMBOL.TRY_RENAME,i)).message;return s&&(t.display_title=t.title=s),e!==s&&Vi.renamedSymbol([e]),{success:!0}}},il=class extends Gh{onHandle(t){return this.onAdd(t)}async matching(t){if(this.byUUID){let e=[t.uuid,this.path],i=(await ot.messageBus.rpcCall(Tt.SYMBOL.GET,e)).message;if(t.ticket&&(i!=null&&i.ticket)&&(i==null?void 0:i.ticket)===t.ticket)return i}if(t.source){if(this.byVersion){let e=[t.source,t.version,this.path],i=(await ot.messageBus.rpcCall(Tt.SYMBOL.GET_BY_SOURCE_VERSION,e)).message;if(i)return Vi.sameVersionSymbol([t.display_title||t.title]),i}if(this.bySource){let e=[t.source,this.path],i=(await ot.messageBus.rpcCall(Tt.SYMBOL.GET_LAST,e)).message;if(i)return Vi.diffVersionSymbol([t.display_title||t.title]),i}}}async isRename(t){let e=[t.display_title||t.title,this.path];return(await ot.messageBus.rpcCall(Tt.SYMBOL.IS_RENAME,e)).message?{success:!1,message:"Library duplicate name"}:{success:!0}}async start(){let t=await this.getOrigin();if(!t.success)return{success:!1,code:t.code,message:t.message};let e,i;if(this.origin){let s=await this.match(this.origin);if(s)e={success:!0,result:s};else{let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message};i=this.origin}}return{success:!0,result:{respond:e,addData:i}}}},sl=class{constructor(t){this.path=t}async check(){let{message:{hasPermission:t,errMsg:e}}=await ot.messageBus.rpcCall("canAddLib",[this.path]);return t?{success:!0}:{success:!1,message:e||"You don't have permission!"}}},Hh=class extends sl{constructor(t){super(t)}async transform(t,e,i){let{device:s,symbol:r,footprint:n}=t,a={device:s,symbol:r,footprint:n};if(r!=null&&r.success&&(r!=null&&r.result)&&e.symbol&&i.symbol){let o=e.symbol,l=r.result,{uuid:u,docType:c,version:h}=l,f=i.symbol.isProject,d=Object.assign(o,{isProject:f}),p={uuid:u,path:this.path,isProject:!0,docType:c,version:h};if((await Ri({origin:d,target:p})).success===!1)throw new Error("Library canvas content upload failed!")}if(n!=null&&n.success&&(n!=null&&n.result)&&e.footprint){let o=e.footprint,l=n.result,{uuid:u,docType:c,version:h}=l,f=i.footprint.isProject,d=!!(s!=null&&s.success&&s.result),p=Object.assign(o,{isConnectDevice:d,isProject:f}),m={uuid:u,path:this.path,isProject:!0,docType:c,version:h};if((await Ri({origin:p,target:m})).success===!1)throw new Error("Library canvas content upload failed!")}return{success:!0,result:a}}async transformSymbol(){}async onsuccess(t){t.symbol&&!t.symbol.success&&(t.symbol.message=Vn(t.symbol)||t.symbol.message),t.footprint&&!t.footprint.success&&(t.footprint.message=Vn(t.footprint)||t.footprint.message),t.device&&!t.device.success&&(t.device.message=Vn(t.device)||t.device.message)}},$y=class extends Hh{constructor(t){let{path:e,data:i,options:s={}}=t,{matchKey:r=!0,byUUID:n=!0,byVersion:a=!0,bySource:o=!0,renameKey:l=!1}=s;super(e),this.addData={},this.result={device:null,symbol:null,footprint:null},this.data=i,this.matchKey=r,this.byUUID=n,this.byVersion=a,this.bySource=o,this.renameKey=l}async start(){var t,e,i,s,r,n,a,o,l,u,c,h;try{let f=await this.check();if(!f.success)return{success:!1,message:f.message};await this.onbefore();let d={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey};if(this.data.device){let g={...d,data:this.data.device},b=await new Ky(g).start();if(b.success===!1)return{success:!1,code:b.code,message:b.message};let{respond:y,addData:E}=b.result;if(this.result.device=y,E&&(this.addData.device=E),this.getBind(),!this.addData.device&&((t=this.result.device)==null?void 0:t.success)&&((e=this.result.device)==null?void 0:e.result)){let{attributes:_}=this.result.device.result,{Symbol:S,Footprint:A}=_,w=S&&(await ot.messageBus.rpcCall(Tt.SYMBOL.GET,[S,this.path])).message,R=A&&(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET,[A,this.path])).message;this.result.symbol={success:!0,result:w},this.result.footprint={success:!0,result:R}}}if(this.data.symbol){let g={...d,data:this.data.symbol},b=await new il(g).start();if(b.success===!1&&b.code===404){if(this.addData.device){this.addData.device.attributes.Symbol="";let{display_title:y,title:E}=this.addData.device,_=y||E;ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["The following devices lose bound symbol data!",_]})}}else{if(b.success===!1)return{success:!1,code:b.code,message:b.message};{let{respond:y,addData:E}=b.result;if(this.result.symbol=y,E&&(this.addData.symbol=E),this.addData.device&&((i=this.result.symbol)==null?void 0:i.success)&&((s=this.result.symbol)==null?void 0:s.result))this.addData.device.attributes.Symbol=this.result.symbol.result.uuid;else if((r=this.addData.device)!=null&&r.attributes.Symbol&&((n=this.result.symbol)!=null&&n.success)&&!((a=this.result.symbol)!=null&&a.result)&&!this.addData.symbol){let _="The symbol associated with the device does not exist!";throw new Q("CREATE_DEVICE",_)}}}}if(this.data.footprint){let g={...d,data:this.data.footprint},b=await new el(g).start();if(b.success===!1&&b.code===404){if(this.addData.device){this.addData.device.attributes.Footprint="";let{display_title:y,title:E}=this.addData.device,_=y||E;ot.messageBus.publish("logI18nLogView",{type:"warn",msg:["The following devices lose bound footprint data!",_]})}}else{if(b.success===!1)return{success:!1,code:b.code,message:b.message};{let{respond:y,addData:E}=b.result;if(this.result.footprint=y,E&&(this.addData.footprint=E),this.addData.device&&((o=this.result.footprint)==null?void 0:o.success)&&((l=this.result.footprint)==null?void 0:l.result))this.addData.device.attributes.Footprint=this.result.footprint.result.uuid;else if((u=this.addData.device)!=null&&u.attributes.Footprint&&((c=this.result.footprint)!=null&&c.success)&&!((h=this.result.footprint)!=null&&h.result)&&!this.addData.footprint){let _="The footprint associated with the device does not exist!";throw new Q("CREATE_DEVICE",_)}}}}let p=await this.create();if(!p.success)return{success:!1,message:p.message};let m=await this.updateBind();if(!m.success)return{success:!1,message:m.message};if(!this.result)throw new Q("CREATE_DEVICE","Project library device added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}catch(f){return{success:!1,message:f.message}}}getBind(){if(this.addData.device){let{attributes:t}=this.addData.device,{Symbol:e,Footprint:i}=t,{isProject:s}=this.data.device;if(s===void 0)!this.data.symbol&&e&&(this.data.symbol={isProject:!0,path:this.path,uuid:e}),!this.data.footprint&&i&&(this.data.footprint={isProject:!0,path:this.path,uuid:i});else{let[r,n]=this.addData.device.source.split(dr);!this.data.symbol&&e&&(this.data.symbol={isProject:s,path:n,uuid:e}),!this.data.footprint&&i&&(this.data.footprint={isProject:s,path:n,uuid:i})}}}onbeforeCreate(){var t,e,i,s;return(t=this.addData.symbol)!=null&&t.docType&&!Ac((e=this.addData.symbol)==null?void 0:e.docType)?{success:!1,message:"invalid symbol docType"}:(i=this.addData.footprint)!=null&&i.docType&&((s=this.addData.footprint)==null?void 0:s.docType)!==4?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){var t;if(Object.keys(this.addData).length>0){let e=this.onbeforeCreate();if(!e.success)return{success:!1,message:e.message};let i=[[this.addData],this.path],{message:s}=await ot.messageBus.rpcCall(Tt.DEVICE.PLACE,i);if(!s.success)return{success:!1,message:s.message};let{device:r,symbol:n,footprint:a}=(t=s.result)==null?void 0:t[0];r&&(this.result.device=r),n&&(this.result.symbol=n),a&&(this.result.footprint=a);let o=await this.transform(this.result,this.addData,this.data);if(!o.success)return{success:!1,message:o.message}}return{success:!0}}async updateBind(){let{device:t,symbol:e,footprint:i}=this.result,s=t!=null&&t.success?t==null?void 0:t.result:null,r=e!=null&&e.success?e==null?void 0:e.result:null,n=i!=null&&i.success?i==null?void 0:i.result:null;if(s){let a=!1;if(r!=null&&r.uuid&&s.attributes.Symbol&&r.uuid!==s.attributes.Symbol&&(s.attributes.Symbol=r.uuid,a=!0),n!=null&&n.uuid&&s.attributes.Footprint&&n.uuid!==s.attributes.Footprint&&(s.attributes.Footprint=n.uuid,a=!0),a){let o=(await ot.messageBus.rpcCall(Tt.DEVICE.UPDATE,[s,this.path])).message;this.result.device={success:!!o,result:o}}}return{success:!0}}async onbefore(){}},Zy=class extends Uh{constructor(t,e){super(e),this.uuid=t}onHandle(t){return this.onUpdate(t)}matching(t){throw new Error("Method not implemented.")}async isRename(t){return{success:!0}}async start(){let t=await this.getOrigin();if(!t.success)return{success:!1,code:t.code,message:t.message};if(!this.origin)return{success:!1,message:"Device details data does not exist"};let e=this.origin.display_title||this.origin.title,i=[{uuid:this.uuid,title:e},this.path];if((await ot.messageBus.rpcCall(Tt.DEVICE.IS_CHANGE,i)).message){let s=await this.rename(this.origin);if(!s.success)return{success:!1,code:s.code,message:s.message}}return{success:!0,result:this.origin}}},Qy=class extends Hh{constructor(t){let{path:e,uuid:i,data:s,options:r={}}=t,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:l=!1,renameKey:u=!1}=r;super(e),this.addData={},this.map={},this.result={device:null,symbol:null,footprint:null,map:{}},this.uuid=i,this.data=s,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=l,this.renameKey=u}async start(){var t,e,i,s,r,n,a,o,l,u;try{let c=await this.check();if(!c.success)return{success:!1,message:c.message};await this.onbefore();let h={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey};if(this.data.device){let p={...h,data:this.data.device},m=await new Zy(this.uuid,p).start();if(m.success){let g=m.result;g&&(this.updateData=g),this.getBind()}else return{success:!1,code:m.code,message:m.message}}if(this.data.symbol){let p={...h,data:this.data.symbol,renameKey:this.renameKey},m=await new il(p).start();if(!m.success)return{success:!1,code:m.code,message:m.message};let{respond:g,addData:b}=m.result;if(this.result.symbol=g,b&&(this.addData.symbol=b),this.updateData&&this.addData.symbol)this.updateData.attributes.Symbol=this.addData.symbol.uuid;else if(this.updateData&&((t=this.result.symbol)!=null&&t.success)&&this.result.symbol.result)this.updateData.attributes.Symbol=this.result.symbol.result.uuid;else if((e=this.updateData)!=null&&e.attributes.Symbol&&((i=this.result.symbol)!=null&&i.success)&&!((s=this.result.symbol)!=null&&s.result)&&!this.addData.symbol){let y="The symbol associated with the device does not exist!";throw new Q("UPDATE_DEVICE",y)}}if(this.data.footprint){let p={...h,data:this.data.footprint,renameKey:this.renameKey},m=await new el(p).start();if(!m.success)return{success:!1,code:m.code,message:m.message};let{respond:g,addData:b}=m.result;if(this.result.footprint=g,b&&(this.addData.footprint=b),this.updateData&&this.addData.footprint)this.updateData.attributes.Footprint=this.addData.footprint.uuid;else if(this.updateData&&((r=this.result.footprint)!=null&&r.success)&&this.result.footprint.result)this.updateData.attributes.Footprint=this.result.footprint.result.uuid;else if((n=this.updateData)!=null&&n.attributes.Footprint&&((a=this.result.footprint)!=null&&a.success)&&!((o=this.result.footprint)!=null&&o.result)&&!this.addData.footprint){let y="The footprint associated with the device does not exist!";throw new Q("UPDATE_DEVICE",y)}}let f=await this.create();if(!f.success)return{success:!1,code:f.code,message:f.message};let d=await this.update();if(!d.success)return{success:!1,message:d.message};if(!this.result){let p={text:"Failed to update project library device {title}!",args:{title:((l=this.updateData)==null?void 0:l.display_title)||((u=this.updateData)==null?void 0:u.title)||""}};throw new Q("UPDATE_DEVICE",p)}return await this.onsuccess(this.result),{success:!0,result:Object.assign(this.result,{map:this.map})}}catch(c){return{success:!1,message:c.message}}}getBind(){if(this.updateData){let{attributes:t}=this.updateData,{Symbol:e,Footprint:i}=t||{},{isProject:s}=this.data.device;if(s===void 0)!this.data.symbol&&e&&(this.data.symbol={isProject:!0,path:this.path,uuid:e}),!this.data.footprint&&i&&(this.data.footprint={isProject:!0,path:this.path,uuid:i});else{let[r,n]=this.updateData.source.split(dr);!this.data.symbol&&e&&(this.data.symbol={isProject:s,path:n,uuid:e}),!this.data.footprint&&i&&(this.data.footprint={isProject:s,path:n,uuid:i})}}}onbeforeCreate(){var t,e,i,s;return(t=this.addData.symbol)!=null&&t.docType&&!Ac((e=this.addData.symbol)==null?void 0:e.docType)?{success:!1,message:"invalid symbol docType"}:(i=this.addData.footprint)!=null&&i.docType&&((s=this.addData.footprint)==null?void 0:s.docType)!==4?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){let{symbol:t,footprint:e}=this.addData,i=this.onbeforeCreate();if(!i.success)return{success:!1,message:i.message};if(t){let r=(await ot.messageBus.rpcCall(Tt.SYMBOL.ADD,[t,this.path])).message;if(!r)return{success:!1,message:"Project library symbol added failed!"};this.result.symbol={success:!0,result:r},this.map[t.uuid]=r.uuid}if(e){let r=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.ADD,[e,this.path])).message;if(!r)return{success:!1,message:"Project library footprint added failed!"};this.result.footprint={success:!0,result:r},this.map[e.uuid]=r.uuid}let s=await this.transform(this.result,this.addData,this.data);return s.success?{success:!0}:{success:!1,message:s.message}}async update(){var e,i,s;let t=this.updateData;if(t){(e=this.result.symbol)!=null&&e.success&&this.result.symbol.result&&(t.attributes.Symbol=(i=this.result.symbol)==null?void 0:i.result.uuid),(s=this.result.footprint)!=null&&s.success&&this.result.footprint.result&&(t.attributes.Footprint=this.result.footprint.result.uuid);let r=[{...t,uuid:this.uuid,keepVersion:this.keepVersion},this.path],n=(await ot.messageBus.rpcCall(Tt.DEVICE.UPDATE,r)).message;if(!n)return{success:!1,message:{text:"Failed to update project library device {title}!",args:{title:t.display_title||t.title||""}}};this.result.device={success:!0,result:n}}return{success:!0}}async onbefore(){pr(this.data.device)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}},Yh=class extends sl{constructor(t){let{path:e,data:i}=t;super(e),this.data=i}async cloneCanvas(t,e){let{uuid:i,version:s,docType:r}=e,n=Object.assign(t,{isProject:this.data.isProject}),a={uuid:i,path:this.path,isProject:!0,docType:r,version:s};if((await Ri({origin:n,target:a})).success===!1)throw new Error("Library canvas content upload failed!");return{success:!0}}},tT=class extends Yh{constructor(t){let{path:e,data:i,options:s={}}=t,{byUUID:r=!0,byVersion:n=!0,bySource:a=!0,renameKey:o=!0,matchKey:l=!0}=s;super({path:e,data:i}),this.byUUID=r,this.byVersion=n,this.bySource=a,this.renameKey=o,this.matchKey=l}async start(){let t=await this.check();if(!t.success)return{success:!1,message:t.message};await this.onbefore();let e={path:this.path,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey,matchKey:this.matchKey},i=await new il({...e,data:this.data}).start();if(!i.success)return{success:!1,code:i.code,message:i.message};let{addData:s,respond:r}=i.result;if(r&&!r.success)return{success:!1,code:r.code,message:r.message};if(r&&r.success)this.result=r.result;else if(s){let n=(await ot.messageBus.rpcCall(Tt.SYMBOL.ADD,[s,this.path])).message;if(!n)return{success:!1,message:"Project library symbol added failed!"};let a=await this.cloneCanvas(s,n);if(!a.success)return{success:!1,code:a.code,message:a.message};this.result=n}if(!this.result)throw new Q("CREATE_SYMBOL","Project library symbol added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){}async onsuccess(t){}},Vh=class extends sl{constructor(t){let{path:e,data:i}=t;super(e),this.data=i}async cloneCanvas(t,e){let{uuid:i,version:s,docType:r}=e,n=Object.assign(t,{isProject:this.data.isProject}),a={uuid:i,path:this.path,isProject:!0,docType:r,version:s};if((await Ri({origin:n,target:a})).success===!1)throw new Error("Library canvas content upload failed!");return{success:!0}}},eT=class extends Vh{constructor(t){let{path:e,data:i,options:s={}}=t,{byUUID:r=!0,byVersion:n=!0,bySource:a=!0,renameKey:o=!0,matchKey:l=!0}=s;super({path:e,data:i}),this.byUUID=r,this.byVersion=n,this.bySource=a,this.renameKey=o,this.matchKey=l}async start(){let t=await this.check();if(!t.success)return{success:!1,message:t.message};await this.onbefore();let e={path:this.path,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey,matchKey:this.matchKey},i=await new el({...e,data:this.data}).start();if(!i.success)return{success:!1,code:i.code,message:i.message};let{addData:s,respond:r}=i.result;if(r&&!r.success)return{success:!1,code:r.code,message:r.message};if(r&&r.success)this.result=r.result;else if(s){let n=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.ADD,[s,this.path])).message;if(!n)return{success:!1,message:"Project library footprint added failed!"};let a=await this.cloneCanvas(s,n);if(!a.success)return{success:!1,code:a.code,message:a.message};this.result=n}if(!this.result)throw new Q("CREATE_FOOTPRINT","Project library footprint added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){}async onsuccess(t){}},iT=class extends Gh{constructor(t,e){super(e),this.uuid=t}onHandle(t){return this.onUpdate(t)}matching(t){throw new Error("Method not implemented.")}async isRename(t){return{success:!0}}async start(){let t=await this.getOrigin();if(!t.success)return{success:!1,code:t.code,message:t.message};if(!this.origin)return{success:!1,message:"Symbol details data does not exist"};let e=this.origin.display_title||this.origin.title,i=[{uuid:this.uuid,title:e},this.path];if((await ot.messageBus.rpcCall(Tt.SYMBOL.IS_CHANGE,i)).message){let s=await this.rename(this.origin);if(!s.success)return{success:!1,code:s.code,message:s.message}}return{success:!0,result:this.origin}}},sT=class extends Yh{constructor(t){let{path:e,uuid:i,data:s,options:r={}}=t,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:l=!1,renameKey:u=!1}=r;super({path:e,data:s}),this.uuid=i,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=l,this.renameKey=u}async start(){var r,n;let t=await this.check();if(!t.success)return{success:!1,message:t.message};await this.onbefore();let e={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey,data:this.data},i=await new iT(this.uuid,e).start();if(!i.success)return{success:!1,code:i.code,message:i.message};this.updateData=i.result;let s=[{...this.updateData,uuid:this.uuid,keepVersion:this.keepVersion},this.path];if(this.result=(await ot.messageBus.rpcCall(Tt.SYMBOL.UPDATE,s)).message,this.result&&this.onlyIdentity){let a=await this.cloneCanvas(this.updateData,this.result);if(!a.success)return{success:!1,code:a.code,message:a.message}}if(!this.result){let a=((r=this.updateData)==null?void 0:r.display_title)||((n=this.updateData)==null?void 0:n.title)||"",o="Failed to update project library symbol {title}!";throw new Q("UPDATE_SYMBOL",{text:o,args:{title:a}})}return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){pr(this.data)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}async onsuccess(t){}},rT=class extends jh{constructor(t,e){super(e),this.uuid=t}onHandle(t){return this.onUpdate(t)}matching(t){throw new Error("Method not implemented.")}async isRename(t){return{success:!0}}async start(){let t=await this.getOrigin();if(!t.success)return{success:!1,code:t.code,message:t.message};if(!this.origin)return{success:!1,message:"Footprint details data does not exist"};let e=this.origin.display_title||this.origin.title,i=[{uuid:this.uuid,title:e},this.path];if((await ot.messageBus.rpcCall(Tt.FOOTPRINT.IS_CHANGE,i)).message){let s=await this.rename(this.origin);if(!s.success)return{success:!1,code:s.code,message:s.message}}return{success:!0,result:this.origin}}},nT=class extends Vh{constructor(t){let{path:e,uuid:i,data:s,options:r={}}=t,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:l=!1,renameKey:u=!1}=r;super({path:e,data:s}),this.uuid=i,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=l,this.renameKey=u}async start(){var r,n;let t=await this.check();if(!t.success)return{success:!1,message:t.message};await this.onbefore();let e={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey,data:this.data},i=await new rT(this.uuid,e).start();if(!i.success)return{success:!1,code:i.code,message:i.message};this.updateData=i.result;let s=[{...this.updateData,uuid:this.uuid,keepVersion:this.keepVersion},this.path];if(this.result=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.UPDATE,s)).message,this.result&&this.onlyIdentity){let a=await this.cloneCanvas(this.updateData,this.result);if(!a.success)return{success:!1,code:a.code,message:a.message}}if(!this.result){let a={text:"Failed to update project library footprint {title}!",args:{title:((r=this.updateData)==null?void 0:r.display_title)||((n=this.updateData)==null?void 0:n.title)||""}};throw new Q("UPDATE_FOOTPRINT",a)}return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){pr(this.data)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}async onsuccess(t){}},aT=class extends Jo{async getDevice(t){let e=[t.uuid,t.path],{message:i}=await ot.messageBus.rpcCall(Tt.DEVICE.GET,e);if(!i)throw new Q("GET_DEVICE","Device details data does not exist");return this.getDeviceOut(Object.assign(i,{path:t.path}))}async getSymbol(t){let e=[t.uuid,t.path],{message:i}=await ot.messageBus.rpcCall(Tt.SYMBOL.GET,e);if(!i)throw new Q("GET_SYMBOL","Symbol details data does not exist");return this.getSymbolOut(Object.assign(i,{path:t.path}))}async getFootprint(t){let e=[t.uuid,t.path],{message:i}=await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET,e);if(!i)throw new Q("GET_FOOTPRINT","Footprint details data does not exist");return this.getFootprintOut(Object.assign(i,{path:t.path}))}async createDevice(t){let{path:e,device:i,symbol:s,footprint:r}=t,n={path:e,data:{device:i,symbol:s,footprint:r}},a=await new $y(n).start();if(!a.success)throw new Q("CREATE_DEVICE",a.message);let o=a.result.device;if(!(o!=null&&o.success))throw new Q("CREATE_DEVICE",o==null?void 0:o.message);let l=o.result;return this.getDeviceOut(Object.assign(l,{path:t.path}))}async createSymbol(t){let{path:e,symbol:i}=t,s={path:e,data:i},r=await new tT(s).start();if(!r.success)throw new Q("CREATE_SYMBOL",r.message);let n=r.result;return this.getSymbolOut(Object.assign(n,{path:t.path}))}async createFootprint(t){let{path:e,footprint:i}=t,s={path:e,data:i},r=await new eT(s).start();if(!r.success)throw new Q("CREATE_FOOTPRINT",r.message);let n=r.result;return this.getFootprintOut(Object.assign(n,{path:t.path}))}async updateDevice(t){let{uuid:e,path:i,device:s,symbol:r,footprint:n}=t,a={path:i,uuid:e,data:{device:s,symbol:r,footprint:n}},o=await new Qy(a).start();if(!o.success)throw new Q("UPDATE_DEVICE",o.message);let l=o.result.device;if(!(l!=null&&l.success))throw new Q("CREATE_DEVICE",l==null?void 0:l.message);let u=l.result;return this.getDeviceOut(Object.assign(u,{path:t.path}))}async updateDeviceAttributes(t){let e=(await ot.messageBus.rpcCall(Tt.DEVICE.UPDATE,[t,t.path])).message;if(!e)throw new Q("UPDATE_DEVICE_ATTRIBUTES",e.message);return this.getDeviceOut(Object.assign(e,{path:t.path}))}async updateSymbol(t){let{uuid:e,path:i,symbol:s}=t,r={path:i,uuid:e,data:s},n=await new sT(r).start();if(!n.success)throw new Q("UPDATE_SYMBOL",n.message);let a=n.result;return this.getSymbolOut(Object.assign(a,{path:t.path}))}async updateFootprint(t){let{uuid:e,path:i,footprint:s}=t,r={path:i,uuid:e,data:s},n=await new nT(r).start();if(!n.success)throw new Q("UPDATE_FOOTPRINT",n.message);let a=n.result;return this.getFootprintOut(Object.assign(a,{path:t.path}))}async deleteDevice(t){if(!(await ot.messageBus.rpcCall(Tt.DEVICE.DEL,t)).message)throw new Q("DELETE_DEVICE","delete failed!")}async deleteSymbol(t){if(!(await ot.messageBus.rpcCall(Tt.SYMBOL.DEL,t)).message)throw new Q("DELETE_SYMBOL","delete failed!")}async deleteFootprint(t){if(!(await ot.messageBus.rpcCall(Tt.FOOTPRINT.DEL,t)).message)throw new Q("DELETE_FOOTPRINT","delete failed!")}async getDeviceList(t){let e=(await ot.messageBus.rpcCall(Tt.DEVICE.GET_LIST,t)).message;if(!e.success)throw new Q("GET_DEVICE_LIST",e.message);let{count:i,totalPage:s,lists:r,page:n,pageSize:a}=e.result,o=r.map(l=>{let u=this.getDeviceOut(l);return l.symbol&&(u.symbol=this.getSymbolOut(l.symbol)),l.footprint&&(u.footprint=this.getFootprintOut(l.footprint)),u});return{count:i,lists:o,page:n,pageSize:a,totalPage:s}}async getDeviceSearchList(t){let e=(await ot.messageBus.rpcCall(Tt.DEVICE.GET_LIST,t)).message;if(!e.success)throw new Q("GET_DEVICE_LIST",e.message);if(t.titles){let i={};for(let s in e.result){let r=e.result[s].map(n=>{let a=this.getDeviceOut(n);return n.symbol&&(a.symbol=this.getSymbolOut(n.symbol)),n.footprint&&(a.footprint=this.getFootprintOut(n.footprint)),a});i[s]=r}return i}else{let{count:i,totalPage:s,lists:r,page:n,pageSize:a}=e.result,o=r.map(l=>{let u=this.getDeviceOut(l);return l.symbol&&(u.symbol=this.getSymbolOut(l.symbol)),l.footprint&&(u.footprint=this.getFootprintOut(l.footprint)),u});return{count:i,lists:o,page:n,pageSize:a,totalPage:s}}}async getSymbolList(t){let e=(await ot.messageBus.rpcCall(Tt.SYMBOL.GET_LIST,t)).message;if(!e.success)throw new Q("GET_SYMBOL_LIST",e.message);let{count:i,totalPage:s,lists:r,page:n,pageSize:a}=e.result,o=r.map(this.getSymbolOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:s}}async getSymbolSearchList(t){let e=(await ot.messageBus.rpcCall(Tt.SYMBOL.GET_LIST,t)).message;if(!e.success)throw new Q("GET_SYMBOL_LIST",e.message);if(t.titles){let i={};for(let s in e.result)i[s]=e.result[s].map(this.getSymbolOut);return i}else{let{count:i,totalPage:s,lists:r,page:n,pageSize:a}=e.result,o=r.map(this.getSymbolOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:s}}}async getFootprintList(t){let e=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET_LIST,t)).message;if(!e.success)throw new Q("GET_FOOTPRINT_LIST",e.message);let{count:i,totalPage:s,lists:r,page:n,pageSize:a}=e.result,o=r.map(this.getFootprintOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:s}}async getFootprintSearchList(t){let e=(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET_LIST,t)).message;if(!e.success)throw new Q("GET_FOOTPRINT_LIST",e.message);if(t.titles){let i={};for(let s in e.result)i[s]=e.result[s].map(this.getFootprintOut);return i}else{let{count:i,totalPage:s,lists:r,page:n,pageSize:a}=e.result,o=r.map(this.getFootprintOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:s}}}getDeviceOut(t){return{uuid:t.uuid,path:t.path,title:t.title,display_title:t.display_title,attributes:t.attributes,description:t.description,images:t.images,source:t.source,version:t.version,ticket:t.ticket,creator:t.creator,modifier:t.modifier,createTime:lt(t.createTime),updateTime:lt(t.updateTime),owner:t.owner,custom_tags:t.custom_tags,symbol_type:t.symbol_type}}getSymbolOut(t){return{title:t.title,display_title:t.display_title,description:t.description,docType:t.docType,uuid:t.uuid,path:t.path,source:t.source,version:t.version,ticket:t.ticket,creator:t.creator,modifier:t.modifier,updateTime:lt(t.updateTime),createTime:lt(t.createTime),owner:t.owner,custom_tags:t.custom_tags}}getFootprintOut(t){return{title:t.title,display_title:t.display_title,description:t.description,docType:t.docType,uuid:t.uuid,path:t.path,source:t.source,version:t.version,ticket:t.ticket,creator:t.creator,modifier:t.modifier,updateTime:lt(t.updateTime),createTime:lt(t.createTime),owner:t.owner,custom_tags:t.custom_tags}}},oT=class extends Jo{constructor(){super(...arguments),this._normalErrorMsg="Request Error.",this._extendLibManager=fe.getInstance()}async getDevice(t){var i;let e=await((i=this._extendLibManager.getLib(t.path))==null?void 0:i.getTransformedDetailInTab("device",t.uuid));if(e)return e;throw new Q("GET_DEVICE",this._normalErrorMsg)}async getSymbol(t){var i;let e=await((i=this._extendLibManager.getLib(t.path))==null?void 0:i.getTransformedDetailInTab("symbol",t.uuid));if(e)return e;throw new Q("GET_SYMBOL",this._normalErrorMsg)}async getFootprint(t){var i;let e=await((i=this._extendLibManager.getLib(t.path))==null?void 0:i.getTransformedDetailInTab("footprint",t.uuid));if(e)return e;throw new Q("GET_FOOTPRINT",this._normalErrorMsg)}async getDeviceList(t){var i,s,r,n,a,o,l,u;let e=await((u=this._extendLibManager.getLib(t.path))==null?void 0:u.getTransformedListInTab("device",{query:{attributes:(s=(i=t.query)==null?void 0:i.attributes)!=null?s:{},symbolType:(r=t.query)==null?void 0:r.symbol_type,classification:{primaryClassificationUuid:(a=(n=t.tags)==null?void 0:n[0])!=null?a:"",secondaryClassificationUuid:(l=(o=t.tags)==null?void 0:o[1])!=null?l:""}},page:t.page,pageSize:t.pageSize}));if(e)return e;throw new Q("GET_DEVICE_LIST",this._normalErrorMsg)}async getSymbolList(t){var i,s,r,n,a,o,l;let e=await((l=this._extendLibManager.getLib(t.path))==null?void 0:l.getTransformedListInTab("symbol",{query:{symbolType:(s=(i=t.query)==null?void 0:i.docType)==null?void 0:s[0],classification:{primaryClassificationUuid:(n=(r=t.tags)==null?void 0:r[0])!=null?n:"",secondaryClassificationUuid:(o=(a=t.tags)==null?void 0:a[1])!=null?o:""}},page:t.page,pageSize:t.pageSize}));if(e)return e;throw new Q("GET_SYMBOL_LIST",this._normalErrorMsg)}async getFootprintList(t){var i,s,r,n,a;let e=await((a=this._extendLibManager.getLib(t.path))==null?void 0:a.getTransformedListInTab("footprint",{query:{classification:{primaryClassificationUuid:(s=(i=t.tags)==null?void 0:i[0])!=null?s:"",secondaryClassificationUuid:(n=(r=t.tags)==null?void 0:r[1])!=null?n:""}},page:t.page,pageSize:t.pageSize}));if(e)return e;throw new Q("GET_FOOTPRINT_LIST",this._normalErrorMsg)}async getDeviceSearchList(t){var l,u,c,h;let{path:e,wd:i,query:s,tags:r,page:n,pageSize:a}=t,o=await((h=this._extendLibManager.getLib(e))==null?void 0:h.getTransformedListInTab("device",{query:{wd:i,attributes:(l=s==null?void 0:s.attributes)!=null?l:{},symbolType:s==null?void 0:s.symbol_type,classification:{primaryClassificationUuid:(u=r==null?void 0:r[0])!=null?u:"",secondaryClassificationUuid:(c=r==null?void 0:r[1])!=null?c:""}},page:n,pageSize:a}));if(o)return o;throw new Q("GET_DEVICE_LIST",this._normalErrorMsg)}async getSymbolSearchList(t){var l,u,c,h;let{path:e,wd:i,query:s,tags:r,page:n,pageSize:a}=t,o=await((h=this._extendLibManager.getLib(e))==null?void 0:h.getTransformedListInTab("symbol",{query:{wd:i,symbolType:(l=s==null?void 0:s.docType)==null?void 0:l[0],classification:{primaryClassificationUuid:(u=r==null?void 0:r[0])!=null?u:"",secondaryClassificationUuid:(c=r==null?void 0:r[1])!=null?c:""}},page:n,pageSize:a}));if(o)return o;throw new Q("GET_SYMBOL_LIST",this._normalErrorMsg)}async getFootprintSearchList(t){var l,u,c;let{path:e,wd:i,query:s,tags:r,page:n,pageSize:a}=t,o=await((c=this._extendLibManager.getLib(e))==null?void 0:c.getTransformedListInTab("footprint",{query:{wd:i,classification:{primaryClassificationUuid:(l=r==null?void 0:r[0])!=null?l:"",secondaryClassificationUuid:(u=r==null?void 0:r[1])!=null?u:""}},page:n,pageSize:a}));if(o)return o;throw new Q("GET_FOOTPRINT_LIST",this._normalErrorMsg)}createDevice(t){throw new Q("CREATE_DEVICE","Not Supported.")}createSymbol(t){throw new Q("GET_SYMBOL","Not Supported.")}createFootprint(t){throw new Q("CREATE_FOOTPRINT","Not Supported.")}updateDevice(t){throw new Q("UPDATE_DEVICE","Not Supported.")}updateSymbol(t){throw new Q("GET_SYMBOL","Not Supported.")}updateFootprint(t){throw new Q("GET_SYMBOL","Not Supported.")}deleteDevice(t){throw new Q("GET_SYMBOL","Not Supported.")}deleteSymbol(t){throw new Q("GET_SYMBOL","Not Supported.")}deleteFootprint(t){throw new Q("GET_SYMBOL","Not Supported.")}},lT=(t=>(t[t.CBB=1]="CBB",t[t.SYMBOL=2]="SYMBOL",t[t.DEVICE=3]="DEVICE",t[t.FOOTPRINT=4]="FOOTPRINT",t[t.MODEL3D=5]="MODEL3D",t[t.MODELSIM=6]="MODELSIM",t[t.PANEL_LIB=29]="PANEL_LIB",t))(lT||{}),uT=["title","description","tags","images"],jt=new qy,ye=new aT,Pi=new oT,$t=class{static getDevice(t){return fe.getInstance().hasLib(t.path)?Pi.getDevice(t):t.isProject?ye.getDevice(t):jt.getDevice(t)}static getSymbol(t){return fe.getInstance().hasLib(t.path)?Pi.getSymbol(t):t.isProject?ye.getSymbol(t):jt.getSymbol(t)}static getFootprint(t){return fe.getInstance().hasLib(t.path)?Pi.getFootprint(t):t.isProject?ye.getFootprint(t):jt.getFootprint(t)}static getD3Model(t){return t.isProject?null:jt.getD3Model(t)}static getSimModel(t){if(t.isProject)throw new Q("GET_SIM_MODEL","Api call error!");return jt.getSimModel(t)}static getDeviceList(t){return fe.getInstance().hasLib(t.path)?Pi.getDeviceList(t):t.isProject?ye.getDeviceList(t):jt.getDeviceList(t)}static getSymbolList(t){return fe.getInstance().hasLib(t.path)?Pi.getSymbolList(t):t.isProject?ye.getSymbolList(t):jt.getSymbolList(t)}static getFootprintList(t){return fe.getInstance().hasLib(t.path)?Pi.getFootprintList(t):t.isProject?ye.getFootprintList(t):jt.getFootprintList(t)}static getD3ModelList(t){if(t.isProject)throw new Q("GET_D3MODEL_LIST","Api call error!");return jt.getD3ModelList(t)}static getSimModelList(t){if(t.isProject)throw new Q("GET_SIM_MODEL_LIST","Api call error!");return jt.getSimModelList(t)}static getDeviceSearchList(t){return fe.getInstance().hasLib(t.path)?Pi.getDeviceSearchList(t):t.isProject?ye.getDeviceSearchList(t):jt.getDeviceSearchList(t)}static getSymbolSearchList(t){return fe.getInstance().hasLib(t.path)?Pi.getSymbolSearchList(t):t.isProject?ye.getSymbolSearchList(t):jt.getSymbolSearchList(t)}static getFootprintSearchList(t){return fe.getInstance().hasLib(t.path)?Pi.getFootprintSearchList(t):t.isProject?ye.getFootprintSearchList(t):jt.getFootprintSearchList(t)}static getPanelLibSearchList(t){if(t.isProject)throw new Q("GET_PANEL_LIB_SEARCH_LIST","Api call error!");return jt.getPanelLibSearchList(t)}static getD3ModelSearchList(t){if(t.isProject)throw new Q("GET_D3MODEL_SEARCH_LIST","Api call error!");return jt.getD3ModelSearchList(t)}static getSimModelSearchList(t){if(t.isProject)throw new Q("GET_SIM_MODEL_SEARCH_LIST","Api call error!");return jt.getSimModelSearchList(t)}static createDevice(t){return t.isProject?ye.createDevice(t):jt.createDevice(t)}static createSymbol(t){return t.isProject?ye.createSymbol(t):jt.createSymbol(t)}static createFootprint(t){return t.isProject?ye.createFootprint(t):jt.createFootprint(t)}static createD3Model(t){return t.isProject?null:jt.createD3Model(t)}static createSimModel(t){if(t.isProject)throw new Q("CREATE_SIM_MODEL","Api call error!");return jt.createSimModel(t)}static updateDevice(t){return t.isProject?ye.updateDevice(t):jt.updateDevice(t)}static updateDeviceAttributes(t){return t.isProject?ye.updateDeviceAttributes(t):jt.updateDeviceAttributes(t)}static updateSymbol(t){return t.isProject?ye.updateSymbol(t):jt.updateSymbol(t)}static updateFootprint(t){return t.isProject?ye.updateFootprint(t):jt.updateFootprint(t)}static updateSimModel(t){if(t.isProject)throw new Q("UPDATE_SIM_MODEL","Api call error!");return jt.updatesimModel(t)}static deleteDevice(t){return t.isProject?ye.deleteDevice(t):jt.deleteDevice(t)}static deleteSymbol(t){return t.isProject?ye.deleteSymbol(t):jt.deleteSymbol(t)}static deleteFootprint(t){return t.isProject?ye.deleteFootprint(t):jt.deleteFootprint(t)}static deleteSimModel(t){if(t.isProject)throw new Q("DELETE_SIM_MODEL","Api call error!");return jt.deleteSimModel(t)}static deleteD3Model(t){if(t.isProject)throw new Q("DELETE_3DMODEL","Api call error!");return jt.delete3DModel(t)}};async function zh(t,e,i,s={}){s.eachProcessHook&&s.eachProcessHook(.01);let r=i||dt.SYSTEMLIB_UUID,n=null;if(e)try{n=await $t.getDevice({isProject:t,path:i,uuid:e})}catch(c){console.warn(c)}s.eachProcessHook&&s.eachProcessHook(.25);let a=null,o={Footprint:!1,symbol:!1,d3DModel:!1};if(n){let c=(n.attributes||{}).Symbol;if(c){try{a=await $t.getSymbol({isProject:t,path:i,uuid:c})}catch(h){console.warn(h)}a||(o.symbol=!0)}}s.eachProcessHook&&s.eachProcessHook(.5);let l=null;if(n){let c=(n.attributes||{}).Footprint;if(c){try{l=await $t.getFootprint({isProject:t,path:i,uuid:c})}catch(h){console.warn(h)}l||(o.Footprint=!0)}}s.eachProcessHook&&s.eachProcessHook(.75);let u=null;if(n){let c=n.attributes||{},h=c["3D Model"],f=c["3D Model Title"],d=on(h,!0),p=d.path||dt.SYSTEMLIB_UUID||r;if(d.componentTitleOrId&&(d.isLocaleFilenameMode?u=(await Wo(d.componentTitleOrId,p)).result:u=await ln(d.componentTitleOrId,p)),!u&&h&&f){if(s.isCheckD3ModelFileExist){let m=await NE(h);m.success&&m.result instanceof Blob?o.d3DModel=!1:o.d3DModel=!0}else o.d3DModel=!0;u=mh(h,f,d.path)}}return s.eachProcessHook&&s.eachProcessHook(1),{setPath:r,deviceItem:n,symbolItem:a,footprintItem:l,d3modelItem:u,hasIdButNotFound:o}}async function cT(t=!1,e,i,s,r){let n=r?!!r.forceAsSymbol:!1,a=r?!!r.ignoreDoctypeCheck:!1,o=r?!!r.isDevice:!1,l=r?!!r.isCheckD3ModelFileExist:!1;if(!a){if(s===28){let h=r?!!r.attachedDeviceBindingExtra:!1,f=r?r.eachProcessHook:null;try{let d=null;return h?d=await zh(t,e,i,{eachProcessHook:f,isCheckD3ModelFileExist:l}):d=await $t.getDevice({isProject:t,path:i,uuid:e}),{code:0,success:!0,result:d,message:""}}catch(d){return{code:-1,success:!1,result:null,message:d.message.toString()}}}if(s===4)try{return{code:0,success:!0,result:await $t.getFootprint({isProject:t,path:i,uuid:e}),message:""}}catch(h){return{code:-1,success:!1,result:null,message:h.message.toString()}}if(n||s&&[2,18,19,20,21,22,25,31,7,32,6].indexOf(s)>=0)try{return{code:0,success:!0,result:await $t.getSymbol({isProject:t,path:i,uuid:e}),message:""}}catch(h){return{code:-1,success:!1,result:null,message:h.message.toString()}}if(s===16)try{return{code:0,success:!0,result:await ln(e,i),message:""}}catch(h){return{code:-1,success:!1,result:null,message:h.message.toString()}}}let u=await At("GET",o?`/api/v2/devices/${e}`:`/api/v2/components/${e}`,{uuid:e,path:i},{headers:{"Content-type":"application/json","content-type":"application/json",path:i}});if(u.code===0&&u.success&&typeof u.result=="object")return{code:0,success:!0,result:u.result,message:""};let c=u.message||u.msg||"Request Error.";return{code:u.code||-1,success:!1,result:null,message:c}}function Ao(t,e){let i=t.owner||{},s=typeof t.updated_at=="string"?t.updated_at:typeof t.updated_at=="number"?as(new Date(t.updated_at)):"",r=typeof t.updateTime=="string"?t.updateTime:typeof t.updateTime=="number"?as(new Date(lt(t.updateTime))):"";return{...t,$id:String(e),numberIndex:e+1,ownerBelong:i.username,updateTimeString:s||r}}function hT(t,e,i){let s=[];for(let r=0;r<t.length;r++){let n=t[r][e]?t[r][e].toLocaleLowerCase():"",a=i?i.toLocaleLowerCase():"";n.indexOf(a)>=0&&s.push(t[r])}return s}async function dT(t,e,i,s){let r=await new Promise(a=>{fetch(Ho.D3Model.client3DModelList,{method:"GET",body:JSON.stringify({step_path:t})}).then(o=>{o.json().then(l=>{if(l){a(l);return}a(null)})})}),n={code:0,success:!0,result:{count:0,page:1,pageSize:s,totalPage:1,lists:[]},msg:""};return r&&r.success?(n.result.lists=(r.result||[]).map((a,o)=>{let l=as(new Date(a.mtime*1e3)),u={uuid:`${a.fileName}|${e}`,rowFileTag:`${a.fileName}|${e}`,path:e,display_title:a.fileName,description:"",docType:16,isFavorite:!1,modifier:null,owner:null,tags:{child_tag:[],parent_tag:[]},title:a.fileName,updateTime:a.mtime/1e3,updated_at:l,createTime:a.mtime/1e3,created_at:l,creator:null,dataStr:"",public:void 0,type:16};return{...Ao(u,o)}}),n.result.count=r.result.length):(n.code=dt.ERR_CODE.NORMAL,n.success=!1,n.msg=r.message||"Fetch local 3D model list error."),n}async function pT(t,e,i,s,r){let n={};for(let u=0;u<e.length;u++){let c=e[u].id,h=await new Promise(f=>{fetch(Ho.D3Model.client3DModelList,{method:"GET",body:JSON.stringify({step_path:t})}).then(d=>{d.json().then(p=>{if(p){f(p);return}f(null)})})});if(h&&h.success){n[c]={list:h.result.map((f,d)=>Ao(f,d))};continue}n[c]=null}let a={},o={},l={count:0};for(let u=0;u<e.length;u++){let c=e[u].id;if(n[c]){let h=hT(n[c].list,"fileName",s);if(!h.length){a[c]=0,o[c]=[];continue}a[c]=h.length,o[c]=h.map((f,d)=>{let p=as(new Date(f.mtime*1e3)),m={uuid:`${f.fileName}|${f.path}`,path:f.path,rowFileTag:`${f.fileName}|${f.path}`,display_title:f.fileName,description:"",docType:16,isFavorite:!1,modifier:null,owner:null,tags:{child_tag:[],parent_tag:[]},title:f.fileName,updateTime:f.mtime/1e3,updated_at:p,createTime:f.mtime/1e3,created_at:p,creator:null,dataStr:"",public:void 0,source:void 0,std_uuid:void 0,ticket:0,type:16};return{...Ao(m,d)}}),l.count++;continue}a[c]=0,o[c]=[]}return{code:0,success:!0,result:{count:l.count,facets:a,lists:o,uid:t,wd:s,page:1,pageSize:r,totalPage:1},msg:""}}var fT=(t=>(t.ERROR_DATA="Document data abnormality",t.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",t.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",t))(fT||{});function Xh(t){let e=null;return e=qh(t.title),!e.success||(e=Wh(t.description),!e.success)?e:{code:0,success:!0,message:"",key:"",result:null}}function qh(t){let e={code:0,success:!0,message:"",key:"",result:null};return(!t||t.length<=0||t.length>128)&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="The title length must be between 1~128 characters!"),e}function Wh(t){let e={code:0,success:!0,message:"",key:"",result:null};return t&&t.length>255&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="Description should be no more than 255 letters"),e}async function mT(t,e,i,s){if(!e||!i||!s)return{code:-1,success:!1,result:null,message:"missing uuid or path or detail data."};let r=Xh({title:s.title,description:s.description});if(!r.success)return{code:r.code,success:!1,result:null,message:r.message};let n=await At("POST",`/api/v2/components/${e}/update`,JSON.stringify({...s,owner:i}),{headers:{"Content-type":"application/json","content-type":"application/json",path:i}});if(n.code===0&&n.success&&typeof n.result=="object")return{code:0,success:!0,result:n.result,message:""};let a=n.message||n.msg||"Request Error.";return{code:n.code||-1,success:!1,result:null,message:a}}var He,gT=(He=class{},He.createDefaultD3modelItem=mh,He.fetchD3ModelItemHandle=ln,He.updateD3ModelItem=mT,He.d3modelInfoVerify=Xh,He.d3modelInfoTitleVerify=qh,He.d3modelInfoDescriptionVerify=Wh,He.fetchD3ModelListOnLocaleFolder=dT,He.fetchD3ModelListBySearchOnLocaleFolder=pT,He.fetchD3ModelItemOnLocaleFolder=Wo,He),ET=(t=>(t.ERROR_DATA="Document data abnormality",t.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",t.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",t.COMPONENT_ATTRIBUTES_OVER_SIZE="{0} should be no more than 255 letters",t))(ET||{});function yT(t,e=void 0){let i=null;if(i=Jh(t.title),!i.success||(i=Kh(t.description),!i.success)||(i=$h(t.attributes),!i.success))return i;let s={code:0,success:!0,message:"",key:"",result:null};return typeof e<"u"&&(e.length<=0||e.length>128)&&(s.code=dt.ERR_CODE.NORMAL,s.success=!1,s.message="The title length must be between 1~128 characters!"),s}function Jh(t){let e={code:0,success:!0,message:"",key:"",result:null};return(!t||t.length<=0||t.length>128)&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="The title length must be between 1~128 characters!"),e}function Kh(t){let e={code:0,success:!0,message:"",key:"",result:null};return t&&t.length>255&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="Description should be no more than 255 letters"),e}function $h(t){let e={code:0,success:!0,message:"",key:"",result:null},i=Object.keys(t);for(let s=0;s<i.length;s++){let r=i[s],n=t[r];if(typeof n=="string"&&n.trim().length>255)return e.code=dt.ERR_CODE.NORMAL,e.message="{0} should be no more than 255 letters",e.key=r,e}return e}var _i,TT=(_i=class{},_i.deviceInfoVerify=yT,_i.deviceInfoTitleVerify=Jh,_i.deviceInfoDescriptionVerify=Kh,_i.deviceInfoAttributesVerify=$h,_i.fetchDeviceItem=zh,_i);function bT(){return[["DOCTYPE","FOOTPRINT",""],["HEAD",{editorVersion:"dev",importFlag:0}],["CANVAS",0,0,"mm",5,5,5,5,5,5,2,2,5]].map(t=>JSON.stringify(t)).join(`
`)}function _T(t="",e="",i=""){let s=e||"[Empty Footprint Component Item]",r=new Date().getTime(),n=as(new Date(r)),a={avatar:"",nickname:"",username:"",uuid:""};return{$emptyItem:!0,createTime:r,created_at:n,creator:{...a},dataStr:t,description:"",display_title:s,docType:4,modifier:{...a},owner:{...a},path:dt.SYSTEMLIB_UUID,public:!1,source:"",std_uuid:"",tags:{child_tag:null,parent_tag:null},ticket:0,title:s,type:0,updateTime:r,updated_at:n,uuid:i||"",version:""}}var ST=(t=>(t.ERROR_DATA="Document data abnormality",t.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",t.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",t))(ST||{});function IT(t){let e=null;return e=AT(t.title),e.success?{code:0,success:!0,message:"",key:void 0,result:null}:e}function AT(t){let e={code:0,success:!0,message:"",key:void 0,result:null};return(!t||t.length<=0||t.length>128)&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="The title length must be between 1~128 characters!"),e}var ss,OT=(ss=class{},ss.footprintInfoVerify=IT,ss.createEmptyFootprintItem=_T,ss.createEmptyFootprintDataStr=bT,ss),RT=(t=>(t.ERROR_DATA="Document data abnormality",t.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",t.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",t))(RT||{});function DT(t){let e=null;return e=wT(t.title),!e.success||(e=CT(t.docType),!e.success)?e:{code:0,success:!0,message:"",key:void 0,result:null}}function wT(t){let e={code:0,success:!0,message:"",key:void 0,result:null};return(!t||t.length<=0||t.length>128)&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="The title length must be between 1~128 characters!"),e}function CT(t){let e={code:0,success:!0,message:"",key:void 0,result:null};return(typeof t>"u"||!t)&&(e.code=dt.ERR_CODE.NORMAL,e.success=!1,e.message="Document data abnormality"),e}var or,NT=(or=class{},or.symbolInfoVerify=DT,or),PT=(t=>(t.UNZIP="/pro-mgr/unzip",t.EXTRACT="/pro-mgr/unzip/extract",t.FLOW="/pro-mgr/unzip/flow",t.PARSE="/pro-mgr/unzip/parse",t.CHECK="/pro-mgr/unzip/check",t.GET_PROJECT_IN_CLOUD="/pro-mgr/getProjectInCloud",t.GET_PROJECT_IN_LOCAL="/pro-mgr/getProjectInLocal",t.GET_PROJECT_BY_IN_LOCAL="/pro-mgr/getProjectByInLocal",t.EXPORT_ZIP="/pro-mgr/export/zip",t.EXPORT_DOCUMENT="/pro-mgr/export/document",t.EXPORT_DEVICE="/pro-mgr/export/lib/device",t.EXPORT_SYMBOL="/pro-mgr/export/lib/symbol",t.EXPORT_FOOTPRIN="/pro-mgr/export/lib/footprint",t.EXPORT_PANEL_LIB="/pro-mgr/export/lib/panelLib",t.DOWNLOAD_PROJECT="/pro-mgr/export/download/project",t.DOWNLOAD_CBB="/pro-mgr/export/download/cbb",t.DOWNLOAD_DOCUMENT="/pro-mgr/export/download/document",t.BACKUP="/pro-mgr/backup",t.ARCHIVE="/pro-mgr/archive",t.LOAD_FILE="/pro-mgr/loadFile",t.CONVERT_PROJECT="/pro-mgr/convertProject/start",t.CONVERT_PROJECT_FLOWWIRTE="/pro-mgr/convertProject/flowWrite",t.CONVERT_PROJECT_FLOWREAD="/pro-mgr/convertProject/flowRead",t.IMPORT_NEW_PROJECT="/pro-mgr/importNewProject",t.PROJECT_AS_CLOUD="/pro-mgr/projectAsCloud",t.CBB_AS_CLOUD="/pro-mgr/cbbAsCloud",t.DOCUMENT_AS_CLOUD="/pro-mgr/documentAsCloud",t.COMPONENT_AS_CLOUD="/pro-mgr/componentAsCloud",t.IMPORT_TARGET_PROJECT="/pro-mgr/importTargetProject",t.UPDATE_BLOCK_SYMBOL_CONNECT="/pro-mgr/updateBlockSymbolConnect",t.IMPORT_SYMBOLS="/pro-mgr/importSymbols",t.IMPORT_FOOTPRINTS="/pro-mgr/importFootprints",t.IMPORT_DEVICES="/pro-mgr/importDevices",t.COPY_BOARD="/pro-mgr/copyBoards",t.COPY_SCHEMATIC="/pro-mgr/copySchematics",t.COPY_PAGE="/pro-mgr/copyPages",t.COPY_SCH_CANVAS="/pro-mgr/copySchCanvas",t.COPY_PCB_CANVAS="/pro-mgr/copyPcbCanvas",t.COPY_PANEL_CANVAS="/pro-mgr/copyPanelCanvas",t.PASTE_BOARD="/pro-mgr/pasteBoards",t.PASTE_SCHEMATIC="/pro-mgr/pasteSchematics",t.PASTE_PAGE="/pro-mgr/pastePages",t.PASTE_SCH_TOP="/pro-mgr/pasteSchTop",t.PASTE_PCB="/pro-mgr/pastePcb",t.PASTE_PANEL="/pro-mgr/pastePanel",t.PASTE_SCH_BOTTOM="/pro-mgr/pasteSchBottom",t.BUILD_EXPORT="/pro-mgr/buildExport",t.BUILD_TARGET="/pro-mgr/buildTarget",t.PARSE_PROJECT="/pro-mgr/parseProject",t.COMPARE_LOCAL="/pro-mgr/compare/local",t.COMPARE_CLOUD="/pro-mgr/compare/cloud",t.COMPARE_DESTORY="/pro-mgr/compare/destory",t.UPDATE_REUSE_BLOCK="/pro-mgr/updateReuseBlock",t))(PT||{});var U_=Kr($r());var j_=Kr($r());var LT=(t=>(t[t.Free=1]="Free",t[t.Strict=3]="Strict",t))(LT||{});var vT=(t=>(t.name="name",t.default_sheet="default_sheet",t.cbb_project="cbb_project",t))(vT||{}),xT=(t=>(t.Export2_0="export2.0",t.Export3_0="export3.0",t.Target3_0="exist3.0",t))(xT||{});var G_=Kr($r()),MT=(t=>(t[t.NONE=1]="NONE",t[t.CLIENT_BUT_UUID=2]="CLIENT_BUT_UUID",t[t.ONLINE_BUT_PATH=3]="ONLINE_BUT_PATH",t))(MT||{});var Ce,BT=(Ce=class{},Ce.D3Model=gT,Ce.Device=TT,Ce.Footprint=OT,Ce.Symbol=NT,Ce.deleteComponentItem=ph,Ce.deleteComponents=SE,Ce.fetchComponentItem=cT,Ce.queryComponentsByTitle=la,Ce.pickUpComponentTags2Ids=fh,Ce.pickUpComponentTags2Names=Ps,Ce.getDataStrById=di,Ce.duplicateNameDetection=vs,Ce),Tu=class ys{static async getOldLibByNet(e){try{let{dataStrId:i,dataStr:s}=e;return i||s?{success:!0,result:(await ot.messageBus.rpcCall("/pro-mgr/public/getDataStr",e)).message||""}:{success:!1,message:"Failed to obtain the source code of the existing component library!"}}catch(i){return{success:!1,message:i.message}}}static transform(e,i){let{uuid:s,docType:r}=i,n="";if(r===4){let a=i.isConnectDevice;n=Kg(s,e,a)}else r===29?n=i1(s,e,Fr.PANEL_LIB):ra(r)&&(n=Qg(s,e).dataStr);return n}static async getOtherLibByNet(e){try{let{isProject:i,uuid:s,path:r,docType:n}=e;if(k1(e)){let u={ignoreDoctypeCheck:!0},c=(await BT.fetchComponentItem(i,s,r,n,u)).result;e=Object.assign(e,c)}let{history_uuid:a,dataStrId:o,dataStr:l}=e;if(a){let u={uuid:s,historyUuid:a},c=(await ot.messageBus.rpcCall(Hi.COMPONENT.GET_HISTORY,u)).message;if(!c.success){let h=["Conversion component format failed!",c.message];return{success:!1,code:c.code,message:h}}return{success:!0,result:(await ot.messageBus.rpcCall(Hi.COMPONENT.GET_HISTORY_DATA,[c.result])).message}}else if(o||l){let u=await ys.getOldLibByNet(e);if(!u.success){let f=["Conversion component format failed!",u.message];return{success:!1,code:u.code,message:f}}let c=u.result,h=ys.transform(c,e);return h?{success:!0,result:h}:{success:!1,message:["Conversion component format failed!","Illegal docType!"]}}else return{success:!0,result:""}}catch(i){return{success:!1,message:i.message}}}static async getOtherLibByWorker(e){try{let i=ha();return{success:!0,result:await F1(`/${i._TAB_ID_}/libWorker`).rpcCall("/mgr/libWorker/getDataByType",e)}}catch(i){return{success:!1,message:i.message}}}static async getProjectLibByWorker(e){try{let{path:i,uuid:s,docType:r}=e,{message:n}=await ot.messageBus.rpcCall("/pro-mgr/hasProject",[i]);return n?r===4?{success:!0,result:(await ot.messageBus.rpcCall(Tt.FOOTPRINT.GET_STR,[s,i])).message||""}:ra(r)?{success:!0,result:(await ot.messageBus.rpcCall(Tt.SYMBOL.GET_STR,[s,i])).message||""}:{success:!1,message:"Api call error! The api does not exist!"}:{success:!1,message:"Get project library data source Project is not open!"}}catch(i){return{success:!1,message:i.message}}}static async getExtendLib(e){var a,o;let{path:i,uuid:s}=e,r=await((o=(a=fe.getInstance().getLib(i))==null?void 0:a.footprint)==null?void 0:o.getTransformedDetail(s));if(!(r!=null&&r.dataStr))return{success:!1,message:["Conversion component format failed!","Failed to obtain the source code of the existing component library!"]};let n;return r.dataStr.trim().startsWith("[")?n=ys.transform(r.dataStr,e):n=r.dataStr,n?{success:!0,result:n}:{success:!1,message:["Conversion component format failed!","Illegal docType!"]}}static async getProLibSource(e){try{let{isProject:i,path:s}=e;return fe.getInstance().hasLib(s)?ys.getExtendLib(e):i?ys.getProjectLibByWorker(e):ys.getOtherLibByWorker(e)}catch(i){return{success:!1,message:i.message}}}},kT=(t=>(t.INIT_DB="/CommonDB/initDB",t))(kT||{}),FT=(t=>(t.GET="/CommonDB/project/getData",t.GET_ALL="/CommonDB/project/getAllArrData",t))(FT||{}),UT=(t=>(t.GET="/CommonDB/copyAndPaste/getData",t.SET="/CommonDB/copyAndPaste/setData",t.IS_EXIST="/CommonDB/copyAndPaste/isExist",t.GET_DATA_FROM_PCB_CANVAS="/CommonDB/copyAndPaste/getDataFromPcbCanvas",t))(UT||{}),jT=(t=>(t.GET="/CommonDB/copyAndPasteTableCell/getData",t.SET="/CommonDB/copyAndPasteTableCell/setData",t.IS_EXIST="/CommonDB/copyAndPasteTableCell/isExist",t))(jT||{}),GT=(t=>(t.SET="/CommonDB/log/setData",t.DEL="/CommonDB/log/delData",t.DEL_LOTS="/CommonDB/log/delLotsData",t.GET_ALL="/CommonDB/log/getAllArrData",t))(GT||{}),HT=(t=>(t.SET="/CommonDB/basicLibraryList/addData",t.GET="/CommonDB/basicLibraryList/getData",t.IS_EXIST="/CommonDB/basicLibraryList/isExist",t))(HT||{}),YT=(t=>(t.SET="/CommonDB/clipBoard/addData",t.GET="/CommonDB/clipBoard/getData",t.IS_EXIST="/CommonDB/clipBoard/isExist",t))(YT||{}),VT=(t=>(t.GET="/CommonDB/lockPrj/getData",t.READ_WRITE="/CommonDB/lockPrj/readwriteData",t))(VT||{}),zT=(t=>(t.GET="/CommonDB/prjCache/getData",t.SET="/CommonDB/prjCache/addData",t.DEL="/CommonDB/prjCache/delData",t.DEL_LOTS="/CommonDB/prjCache/delLotsData",t.GET_INDEXS="/CommonDB/prjCache/getAllIndexs",t.GET_COUNT="/CommonDB/prjCache/getCount",t.GET_EARLIEST="/CommonDB/prjCache/getEarliest",t))(zT||{});var XT=(t=>(t.CREATE="/pro-mgr/library/cbb/create",t.GET_EXPORT="/pro-mgr/library/cbb/getExport",t.GET_TARGET="/pro-mgr/library/cbb/getTarget",t.LIST="/pro-mgr/library/cbb/list",t.PLACE="/pro-mgr/library/cbb/place",t))(XT||{}),qT=(t=>(t.CREATE="/pro-mgr/new/cloud/create",t.PROJECT="/pro-mgr/new/cloud/project",t.BOARD="/pro-mgr/new/cloud/board",t.SCHEMATIC="/pro-mgr/new/cloud/schematic",t.SHEET="/pro-mgr/new/cloud/sheet",t.SIMULATION="/pro-mgr/new/cloud/simulation",t.PCB="/pro-mgr/new/cloud/pcb",t.PANEL="/pro-mgr/new/cloud/panel",t))(qT||{}),WT=(t=>(t.BOARD="/pro-mgr/new/local/board",t.SCHEMATIC="/pro-mgr/new/local/schematic",t.SHEET="/pro-mgr/new/local/sheet",t.SIMULATION="/pro-mgr/new/local/simulation",t.PCB="/pro-mgr/new/local/pcb",t.PANEL="/pro-mgr/new/local/panel",t))(WT||{});var JT=(t=>(t.FORCE="/pro-mgr/project/updateData/force",t.SUSPEND="/pro-mgr/project/updateData/suspend",t.RESUME="/pro-mgr/project/updateData/resume",t.GET="/pro-mgr/project/updateData/getLastest",t.IS_PUBLIC="/pro-mgr/project/updateData/isPublic",t.UPDATE_TEAM="/pro-mgr/project/updateData/updateTeam",t))(JT||{}),KT=(t=>(t.UPDATE="/pro-mgr/project/updateData/schematic/update",t.GET="/pro-mgr/project/updateData/schematic/getData",t.MAP="/pro-mgr/project/updateData/schematic/map",t.NOTIFY="/pro-mgr/project/updateData/schematic/notify",t))(KT||{}),$T=(t=>(t.UPDATE="/pro-mgr/project/updateData/sheet/update",t.GET="/pro-mgr/project/updateData/sheet/getData",t.MAP="/pro-mgr/project/updateData/sheet/map",t.NOTIFY="/pro-mgr/project/updateData/sheet/notify",t))($T||{}),ZT=(t=>(t.UPDATE="/pro-mgr/project/updateData/pcb/update",t.GET="/pro-mgr/project/updateData/pcb/getData",t.MAP="/pro-mgr/project/updateData/pcb/map",t.NOTIFY="/pro-mgr/project/updateData/pcb/notify",t))(ZT||{}),QT=(t=>(t.UPDATE="/pro-mgr/project/updateData/symbol/update",t.GET="/pro-mgr/project/updateData/symbol/getData",t.MAP="/pro-mgr/project/updateData/symbol/map",t.NOTIFY="/pro-mgr/project/updateData/symbol/notify",t))(QT||{}),tb=(t=>(t.UPDATE="/pro-mgr/project/updateData/footprint/update",t.GET="/pro-mgr/project/updateData/footprint/getData",t.MAP="/pro-mgr/project/updateData/footprint/map",t.NOTIFY="/pro-mgr/project/updateData/footprint/notify",t))(tb||{}),eb=(t=>(t.UPDATE="/pro-mgr/project/updateData/device/update",t.GET="/pro-mgr/project/updateData/device/getData",t.MAP="/pro-mgr/project/updateData/device/map",t.NOTIFY="/pro-mgr/project/updateData/device/notify",t))(eb||{});var ib=(t=>(t.PROGRESS="/pro-ui/progressUpdate",t.OPENED_PROJECT="/pro-ui/project/openedProject",t.HAS_UNSAVED="/pro-ui/project/hasUnsaved",t.OPEN="/pro-ui/project/open",t.CLOSE="/pro-ui/project/close",t.ON_OPENED="/pro-ui/project/onOpened",t.ON_FAILED="/pro-mgr/project/onFailed",t.ON_CLOSED="/pro-ui/project/onClosed",t.ADD_HASH="/pro-ui/hash/add/id",t.REMOVE_HASH="/pro-ui/hash/remove/id",t))(ib||{}),sb=(t=>(t.ON_UPDATE="/pro-mgr/project/project/onUpdate",t.UPLOAD_FAILED="/pro-mgr/project/upload/onfailed",t))(sb||{}),rb=(t=>(t.ON_UPDATE="/pro-mgr/project/config/onUpdate",t))(rb||{}),nb=(t=>(t.ON_ADD="/pro-mgr/project/board/onAdd",t.ON_DELETE="/pro-mgr/project/board/onDelete",t.ON_UPDATE="/pro-mgr/project/board/onUpdate",t))(nb||{}),ab=(t=>(t.ON_ADD="/pro-mgr/project/schematic/onAdd",t.ON_DELETE="/pro-mgr/project/schematic/onDelete",t.ON_UPDATE="/pro-mgr/project/schematic/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/schematic/onUpdateTime",t))(ab||{}),ob=(t=>(t.ON_ADD="/pro-mgr/project/sheet/onAdd",t.ON_DELETE="/pro-mgr/project/sheet/onDelete",t.ON_UPDATE="/pro-mgr/project/sheet/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/sheet/onUpdateTime",t))(ob||{}),lb=(t=>(t.ON_ADD="/pro-mgr/project/pcb/onAdd",t.ON_DELETE="/pro-mgr/project/pcb/onDelete",t.ON_UPDATE="/pro-mgr/project/pcb/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/pcb/onUpdateTime",t))(lb||{}),ub=(t=>(t.ON_ADD="/pro-mgr/project/panel/onAdd",t.ON_DELETE="/pro-mgr/project/panel/onDelete",t.ON_UPDATE="/pro-mgr/project/panel/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/panel/onUpdateTime",t))(ub||{}),cb=(t=>(t.ON_ADD="/pro-mgr/project/simulation/onAdd",t.ON_DELETE="/pro-mgr/project/simulation/onDelete",t.ON_UPDATE="/pro-mgr/project/simulation/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/simulation/onUpdateTime",t))(cb||{}),hb=(t=>(t.ON_ADD="/pro-mgr/project/device/onAdd",t.ON_DELETE="/pro-mgr/project/device/onDelete",t.ON_UPDATE="/pro-mgr/project/device/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/device/onUpdateTime",t))(hb||{}),db=(t=>(t.ON_ADD="/pro-mgr/project/symbol/onAdd",t.ON_DELETE="/pro-mgr/project/symbol/onDelete",t.ON_UPDATE="/pro-mgr/project/symbol/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/symbol/onUpdateTime",t))(db||{}),pb=(t=>(t.ON_ADD="/pro-mgr/project/footprint/onAdd",t.ON_DELETE="/pro-mgr/project/footprint/onDelete",t.ON_UPDATE="/pro-mgr/project/footprint/onUpdate",t.ON_UPDATETIME="/pro-mgr/project/footprint/onUpdateTime",t))(pb||{}),fb=(t=>(t.ON_ADD="/pro-mgr/project/attr/onAdd",t.ON_DELETE="/pro-mgr/project/attr/onDelete",t.ON_UPDATE="/pro-mgr/project/attr/onUpdate",t))(fb||{}),mb=(t=>(t.ON_ADD="/pro-mgr/project/blob/onAdd",t.ON_DELETE="/pro-mgr/project/blob/onDelete",t.ON_UPDATE="/pro-mgr/project/blob/onUpdate",t))(mb||{}),gb=(t=>(t.ON_ADD="/pro-mgr/project/variant/onAdd",t.ON_DELETE="/pro-mgr/project/variant/onDelete",t.ON_UPDATE_TITLE="/pro-mgr/project/variant/onUpdatetitle",t.ON_UPDATE_NOT_GROUPED="/pro-mgr/project/variant/onUpdateNotGrouped",t.ON_UPDATE_ZINDEX="/pro-mgr/project/variant/onUpdateZIndex",t.ON_ADD_COMPONENT_GROUP="/pro-mgr/project/variant/onAddComponentGroup",t.ON_DELETE_COMPONENT_GROUP="/pro-mgr/project/variant/onDeleteComponentGroup",t.ON_UPDATE_COMPONENT_GROUP_TITLE="/pro-mgr/project/variant/onUpdateComponentGroupTitle",t.ON_UPDATE_COMPONENT_GROUP_ZINDEX="/pro-mgr/project/variant/onUpdateComponentGroupZIndex",t.ON_UPLOAD_COMPONENT_GROUP_INDEX_IN_VARIANT="/pro-mgr/project/variant/onUploadComponentGroupZIndexInVariant",t.ON_DELETE_COMPONENT_GROUP_INDEX_IN_VARIANT="/pro-mgr/project/variant/onDeleteComponentGroupZIndexInVariant",t.ON_UPLOAD_COMPONENT_GROUP_DATA="/pro-mgr/project/variant/onUploadComponentGroupData",t.ON_DELETE_COMPONENT_GROUP_DATA="/pro-mgr/project/variant/onDeleteComponentGroupData",t))(gb||{});var H_=new Error("list is empty");var Eb=(t=>(t.ALL_VALUE="@all",t.ALL_TITLE="All",t.ComponentSymbol="2",t.NetflagSymbol="18",t.NetportSymbol="19",t.DrawingSymbol="20",t.NonElectronicSymbol="21",t.OffPageConnectorSymbol="25",t.DiffPairsFlagSymbol="31",t))(Eb||{});async function Zh(){let t=await new Promise(e=>{fetch("/api/client/config",{method:"GET"}).then(i=>{i.json().then(s=>{e(s)})})});if(t&&t.success&&t.result){let e=t.result,i=e.projectDir instanceof Array?e.projectDir:[e.projectDir];return{basePath:e.appBaseDir,cbbPath:e.reuseBlock,libPath:e.systemLib,projectPath:i,onlinePrjBackupPath:e.appOnlineBackupDir,appBaseDir:e.appBaseDir,autoCheckVersionUpdate:!!e.checkUpdate,activation:e.activation,appTmpBackupDir:e.appTmpBackupDir,cacheDir:e.cacheDir,proxy:e.proxy,log:e.log}}else return null}function Ia(t,e){let i=[],s=[];da?s=t:e&&e.length?s=e:s=t;let r=null;return s.forEach(n=>{n.uuid===dt.SYSTEMLIB_UUID?r={title:n.nickname,id:n.uuid,key:dt.LIB_SYSTEM_KEY}:i.push({title:n.nickname,id:n.uuid,key:dt.LIB_PERSONAL_KEY})}),r&&i.unshift(r),i}async function Aa(t,e){let i=Ia(t,e)||[],s=[],r=null;return i.forEach((n,a)=>{n.id===dt.SYSTEMLIB_UUID?r=a:s.push({title:n.title,id:n.id,key:n.key})}),(r||r===0)&&s.splice(0,0,{title:i[r].title,id:i[r].id,key:i[r].key}),s.splice(1,0,{title:"Project",id:"",key:dt.LIB_PROJECT_KEY}),[...s]}async function yb(t,e){let i=await Zh();if(!i)return await Aa(t,e);let s=Ia(t,e),r=Me(s,"id",dt.SYSTEMLIB_UUID),n=[];r.index>=0&&n.splice(0,0,{...r.data});let{projectPath:a,cbbPath:o,libPath:l=[],onlinePrjBackupPath:u,autoCheckVersionUpdate:c}=i;return l.forEach(h=>{n.push({title:bu(h),id:h,key:h})}),n.splice(1,0,{title:"Project",id:"",key:dt.LIB_PROJECT_KEY}),[...n]}function Tb(t,e,i,s){let r=[],n=[],a={},o=[];return t.forEach(l=>{switch(l.titleAdditional=l.title,l.title){case"Project":{if(!s||!i||!i.uuid)return;l.id=i.uuid,o.push(i.uuid);break}default:}l.id||(l.id="@"+Jr(new Date().getTime())),typeof a[l.id]<"u"?(a[l.id]+=1,l.id=l.id+dt.LIB_SPLIT_TAG+a[l.id]):a[l.id]=0,e&&e.indexOf(l.id)>=0&&n.push(l.id),r.push(l)}),{treeData:r,projectsIds:o,selectedIds:n}}async function Qh(t,e){let i=Ia(t,e)||[],s=[],r=null;return i.forEach((n,a)=>{n.id===dt.SYSTEMLIB_UUID?r=a:s.push({title:n.title,id:n.id,key:n.key})}),(r||r===0)&&s.splice(0,0,{title:i[r].title,id:i[r].id,key:i[r].key}),s.splice(1,0,{title:"Project",id:"",key:dt.LIB_PROJECT_KEY}),[...s]}async function bb(t,e){let i=await Zh();if(!i)return await Aa(t,e);let s=[],{projectPath:r,cbbPath:n,libPath:a=[],onlinePrjBackupPath:o,autoCheckVersionUpdate:l}=i;return a.forEach(u=>{s.push({title:bu(u),id:u,key:u})}),s.splice(1,0,{title:"Project",id:"",key:dt.LIB_PROJECT_KEY}),[...s]}function _b(t,e,i,s){let r=[],n=[],a={},o=[];return t.forEach(l=>{switch(l.titleAdditional=l.title,l.title){case"Project":{if(!s||!i||!i.uuid)return;l.id=i.uuid,o.push(i.uuid);break}default:}l.id||(l.id="@"+Jr(new Date().getTime())),typeof a[l.id]<"u"?(a[l.id]+=1,l.id=l.id+dt.LIB_SPLIT_TAG+a[l.id]):a[l.id]=0,e&&e.indexOf(l.id)>=0&&n.push(l.id),r.push(l)}),{treeData:r,projectsIds:o,selectedIds:n}}function td(t,e){let i=[],s=[];return da?s=t:e&&e.length?s=e:s=t,s.forEach(r=>{i.push({title:r.nickname,id:r.uuid,key:dt.LIB_TEMAS_KEY})}),i}async function ua(t,e){let i=td(t,e);return[{title:"System",id:dt.SYSTEMLIB_UUID,key:dt.LIB_SYSTEM_KEY},{title:"Project",id:"",key:dt.LIB_PROJECT_KEY},{title:"Personal",id:"",key:dt.LIB_PERSONAL_KEY},{title:"Favorite",id:dt.FAVORITELIB_UUID,key:dt.LIB_FAVORITE_KEY},...i]}function ed(t,e,i,s,r){let n=[],a=[],o={},l=[];return t.forEach(u=>{switch(u.title){case"Project":{if(!r||!s||!s.uuid)return;u.id=s.uuid,l.push(s.uuid);break}case"Personal":{if(!i||!i.uuid)return;u.id=i.uuid;break}case"Public":{u.id=dt.PUBLICLIB_ALIAS;break}default:}u.id||(u.id="@"+Jr(new Date().getTime())),typeof o[u.id]<"u"?(o[u.id]+=1,u.id=u.id+dt.LIB_SPLIT_TAG+o[u.id]):o[u.id]=0,e&&e.indexOf(u.id)>=0&&a.push(u.id),n.push(u)}),{treeData:n,projectsIds:l,selectedIds:a}}async function Oo(t,e){return await ua(t,e)}function Sb(t,e,i,s,r){return ed(t,e,i,s,r)}async function id(t,e,i,s,r,n){let a=[];return t==="Normal"?ui?Xn?(a=await Oo(e,i),n&&Pn(a),a):zn?(a=await Aa(e,i),n&&Pn(a),a):(a=await Qh(e,i),n&&Pn(a),a):(a=await ua(e,i),n&&Pn(a),a):t==="D3Model"?ui?Xn?(a=await Oo(e,i),a):zn?(a=await yb(e,i),a):(a=await bb(e,i),a):(a=await ua(e,i),a):[]}function Pn(t){let e=Me(t,"key",dt.LIB_PROJECT_KEY);e.index>=0&&t.splice(e.index,1)}function sd(t,e,i,s,r,n,a){if(!ui){let l=ed(t,i,s,r,typeof n<"u"?!!n:a);return Ln(l,e),vn(l)}if(Xn){let l=Sb(t,i,s,r,typeof n<"u"?!!n:a);return Ln(l,e),vn(l)}if(zn){let l=Tb(t,i,r,typeof n<"u"?!!n:a);return Ln(l,e),vn(l)}let o=_b(t,i,r,typeof n<"u"?!!n:a);return Ln(o,e),vn(o)}function Ln(t,e){let i=Me(t.treeData,"key",dt.LIB_SYSTEM_KEY);i.index>=0&&t.treeData.splice(i.index,1);let s=Me(t.treeData,"key",dt.LIB_PERSONAL_KEY);s.index>=0&&t.treeData.splice(s.index,1);let r=Me(t.treeData,"key","project");r.index>=0&&t.treeData.splice(r.index,1);let n=Me(t.treeData,"key",dt.LIB_FAVORITE_KEY);n.index>=0&&t.treeData.splice(n.index,1);let a=Me(t.treeData,"key","selected");a.index>=0&&t.treeData.splice(a.index,1);let o=Me(t.treeData,"key","oshwhub");o.index>=0&&t.treeData.splice(o.index,1),t.treeData.sort((l,u)=>(l.title||"").localeCompare(u.title||"")),n.index>=0&&t.treeData.unshift(n.data),r.index>=0&&t.treeData.unshift(r.data),e==="Personal"?da||s.index>=0&&t.treeData.unshift(s.data):t.selectedIds=t.selectedIds.filter(l=>{var u;return l!==((u=s==null?void 0:s.data)==null?void 0:u.id)}),o.index>=0&&t.treeData.unshift(o.data),i.index>=0&&t.treeData.unshift(i.data),a.index>=0&&t.treeData.push(a.data)}function vn(t){return t.selectedIds.length?t.selectedIds:t.selectedIds.push(t.treeData[0].id),t}async function Ib(t,e,i,s,r,n,a,o,l=!0,u=!0,c=!0){let h={username:n.username,uuid:n.uuid},{projectId:f,title:d,isCBB:p}=r,m={uuid:f,title:d,isCBB:p},g=await id(e,a,o,t,i,l),b=sd(g,s,[],h,m,!l),y=[];for(let E=0;E<b.treeData.length;E++){let _=b.treeData[E];_.id===dt.SYSTEMLIB_UUID&&u||_.id===dt.FAVORITELIB_UUID&&c||(fa||ma||_.key===dt.LIB_PERSONAL_KEY&&(_.title=_.titleAdditional=h.username),_.title&&y.push(_))}return y}var Ab=(t=>(t.Normal="Normal",t.D3Model="D3Model",t.AssociateDeviceDialog="associateDeviceDialog",t.Cbb="Cbb",t))(Ab||{}),Ye,Y_=(Ye=class{},Ye.createInitLibList=id,Ye.createFixLibList=Ib,Ye.filterInitLibList=sd,Ye.fetchTeamsLibsFromGVars=td,Ye.fetchClientTeamsLibsFromGVars=Ia,Ye.createSourceLibListByWebMode=ua,Ye.createSourceLibListByOnlineClientMode=Oo,Ye.createSourceLibListByOfflineClientMode=Qh,Ye.createSourceLibListByHalfofflineClientMode=Aa,Ye),lr,V_=(lr=class{},lr.syncLoginedUserInfo=e=>{ot.loginedUserUuid=e.uuid},lr);var Ob=(t=>(t.PROJECT="project.json",t.DEVICE="device.json",t.SYMBOL="symbol.json",t.FOOTPRINT="footprint.json",t.PANEL_LIB="panel-lib.json",t.PROJECT2="project2.json",t.DEVICE2="device2.json",t.SYMBOL2="symbol2.json",t.FOOTPRINT2="footprint2.json",t.PANEL_LIB2="panel-lib2.json",t))(Ob||{}),Rb=(t=>(t.EXPORT_DEVICE="EXPORT_DEVICE",t.EXPORT_SYMBOL="EXPORT_SYMBOL",t.EXPORT_FOOTPRINT="EXPORT_FOOTPRINT",t.EXPORT_PANEL_LIB="EXPORT_PANEL_LIB",t))(Rb||{});Ud();var{IS_EASYEDA:YI,IS_LCEDA:VI,IS_CLIENT:Db,IS_PRIVATE:zI,IS_ONLINE:wb,IS_OFFLINE:XI,IS_HALF_OFFLINE:qI,IS_DEV:WI,IS_ECAD:JI}=Do,rd=Db&&!wb;var md=wd(fd());function gd(t){return self[t]=self[t]||new md.BroadcastChannelMessageBus(t)}var dl=6e4,Ms=gd(`/${window._TAB_ID_}/notify`),Ed=0,hn=new Set;Ms.rpcService("/pro-mgr/serverTime/now",()=>Date.now()+Ed);function yd(){let t=location.protocol==="https:"?"wss:":"ws:",e=new WebSocket(`${t}//${location.host}/api/ws/notify`),i=performance.now(),s=new Array;function r(n){e.send(JSON.stringify(n)),i=performance.now()}e.addEventListener("open",n=>{console.log("opened",n),Ms.publish("/pro-mgr/notify/established"),s.push(Ms.subscribe("/pro-mgr/notify/send",o=>{r(o)}));function a(){if(e.readyState===e.OPEN){let o=performance.now()-i;o>=dl?(r({topic:"ping"}),setTimeout(a,dl)):setTimeout(a,dl-o)}}a()}),e.addEventListener("close",n=>{console.log("closed",n),s.forEach(a=>a.cancel()),Ms.publish("/pro-mgr/notify/closed"),setTimeout(yd,1e4)}),e.addEventListener("error",n=>{console.error("error",n),e.close()}),e.addEventListener("message",n=>{var o,l;console.log("message",n.data),i=performance.now();let a=JSON.parse(n.data);switch(a.fromConnectId&&!hn.has(a.fromConnectId)&&(hn.add(a.fromConnectId),r({topic:"/online/watch/cooperation",uuid:a.fromConnectId})),(l=(o=a.topic)==null?void 0:o.startsWith)!=null&&l.call(o,"/online/")&&a.connectId&&(hn.delete(a.connectId),r({topic:"/online/unwatch/cooperation",uuid:a.connectId}),Ms.publish("/pro-mgr/notify/message/ws/disconnect",a.connectId)),a.topic){case"/ws/established":self._WS_ID_=a.connectId,Ms.publish("/pro-mgr/notify/message/ws/established",a.connectId),hn.size&&Array.from(hn).forEach(u=>{r({topic:"/online/watch/cooperation",uuid:a.fromConnectId})});break;case"pong":a.serverUTCTime&&(Ed=a.serverUTCTime-Date.now());break;default:Ms.publish(`/pro-mgr/notify/message${a.topic}`,a)}})}rd||yd();})();
/*! Bundled license information:

lc-editor-common/dist/index.js:
  (*! Bundled license information:
  
  lc-protocol/dist/index.js:
    (*! Bundled license information:
    
    crypto-js/ripemd160.js:
      (** @preserve
      	(c) 2012 by Cdric Mesnil. All rights reserved.
      
      	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
      
      	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
      	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
      
      	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      	*)
    
    crypto-js/mode-ctr-gladman.js:
      (** @preserve
       * Counter block mode compatible with  Dr Brian Gladman fileenc.c
       * derived from CryptoJS.mode.CTR
       * Jan Hruby jhruby.web@gmail.com
       *)
    *)
  *)
*/
//# sourceMappingURL=https://modules.lceda.cn/pro-mgr/3.1.49.c934ba86/js/ws-service.js.map
