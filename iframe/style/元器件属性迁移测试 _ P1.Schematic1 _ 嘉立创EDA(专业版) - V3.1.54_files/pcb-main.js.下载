(()=>{var hP=Object.create;var Gy=Object.defineProperty;var cP=Object.getOwnPropertyDescriptor;var uP=Object.getOwnPropertyNames;var dP=Object.getPrototypeOf,fP=Object.prototype.hasOwnProperty;var hr=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var pP=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _P=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of uP(t))!fP.call(e,s)&&s!==i&&Gy(e,s,{get:()=>t[s],enumerable:!(r=cP(t,s))||r.enumerable});return e};var lO=(e,t,i)=>(i=e!=null?hP(dP(e)):{},_P(t||!e||!e.__esModule?Gy(i,"default",{value:e,enumerable:!0}):i,e));var zp=pP((bZ,oE)=>{"use strict";var jm=Object.defineProperty,z5=Object.getOwnPropertyDescriptor,H5=Object.getOwnPropertyNames,j5=Object.prototype.hasOwnProperty,Y5=(e,t)=>{for(var i in t)jm(e,i,{get:t[i],enumerable:!0})},V5=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of H5(t))!j5.call(e,s)&&s!==i&&jm(e,s,{get:()=>t[s],enumerable:!(r=z5(t,s))||r.enumerable});return e},q5=e=>V5(jm({},"__esModule",{value:!0}),e),Qv={};Y5(Qv,{BroadcastChannelMessageBus:()=>h6,MessageBus:()=>s6,MessageBus2:()=>o6,MessageBusTask:()=>zm,MessageBusTask2:()=>Xu,WindowMessageBridge:()=>r6,WorkerMessageBridge:()=>i6,createBroadcastP2PStream:()=>nE,createBufferedByteBufferStream:()=>sE,createBufferedStream:()=>qm,createBufferedStringStream:()=>rE,dropP2PStream:()=>c6,flowRead:()=>d6,flowWrite:()=>u6});oE.exports=q5(Qv);var Fp=class{constructor(e=1.5){this.growthFactor=e,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(e){if(this.count===this.capacity){let t=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,t);let i=new Array(t);for(let r=0;r<this.count;r++)i[r]=this.buffer[(this.head+r)%this.capacity];this.buffer=i,this.head=0,this.tail=this.count,this.capacity=t}this.buffer[this.tail]=e,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let e=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,e}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},Ym=new ArrayBuffer(8),OZ=new Float64Array(Ym),mZ=new Uint32Array(Ym),yZ=new Uint16Array(Ym),Gm=ArrayBuffer;try{Gm=self.HTMLImageElement||Gm}catch{}var X5=typeof SharedArrayBuffer<"u";function Gp(e){if(typeof e!="object"||e===null||e instanceof Date||e instanceof ArrayBuffer||X5&&e instanceof SharedArrayBuffer||e instanceof Blob||e instanceof FormData||e instanceof Function||e instanceof Uint8ClampedArray||e instanceof Gm)return e;if(Array.isArray(e))return e.map(Gp);{let t={};for(let i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=Gp(e[i]));return t}}function Fm(e,t){return W5(e,t,()=>[])}function W5(e,t,i){let r=e[t];return r!==void 0||(r=i(t),e[t]=r),r}var J5=class{constructor(e){this.maxResources=e,this.idle=new Fp,this.isClosed=!1,this.resources=e}acquire(e){this.isClosed?Promise.resolve(!1).then(e):this.resources>0?(this.resources--,Promise.resolve(!0).then(e)):this.idle.enqueue(e)}acquireSync(){return new Promise(e=>{this.acquire(e)})}release(){if(!this.isClosed){let e=this.idle.dequeue();e?Promise.resolve(!0).then(e):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let e=this.idle.dequeue();Promise.resolve(!1).then(e)}}};function Z5(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function K5(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}var $5=Z5(),Q5=$5.WeakRef||(e=>e);function Ul(e){if(e!=null){if(typeof e=="object")return new Q5(e);console.error(e,e instanceof Object,typeof e);return}}function Fo(e){return e==null?void 0:e.deref()}var e6="_MSG_BUS_RPC_",Vm=300*1e3,t6=(e=>(e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.PUSH="push",e.PULL="pull",e))(t6||{}),eE=class{constructor(e){this.bus=e}processRemoteMessage(e,t){let i=Ul(t),r=e.topic,s=e.type,n=e.message;switch(s){case"pull":this.bus.pull(r,a=>{this.push(r,a,Fo(i))});break;case"subscribe":this.bus.subscribe(r,a=>{this.publish(r,a,Fo(i))});break;case"publish":this.bus.publish(r,n,this,Fo(i));break;case"push":this.bus.push(r,n,this,Fo(i));break;default:console.debug("unknown message type "+s)}}rpcCall(e,t,i,r=Vm){let s=Ul(i),n=new Promise(a=>{let o=this.bus.uniqueRpcTopic(e);this.publish(e,{message:t,reply:o},Fo(s)),this.bus.pull(o,(l,h,c)=>{a({message:l,bridge:h,source:Ul(c)})})});return r>0?Promise.race([n,new Promise((a,o)=>{setTimeout(o,r)})]):n}},i6=class extends eE{constructor(e,t){super(e),this.worker=t,t.onmessage=i=>{this.processRemoteMessage(i.data,void 0)}}publish(e,t){this.postMessage(e,"publish",t)}subscribe(e){this.postMessage(e,"subscribe",null)}push(e,t){this.postMessage(e,"push",t)}pull(e){this.postMessage(e,"pull",null)}rpcCall(e,t,i=Vm){return super.rpcCall(e,t,void 0,i)}postMessage(e,t,i){let r={topic:e,type:t,message:i};this.worker.postMessage(r)}discard(){this.worker.terminate()}},r6=class extends eE{constructor(e){super(e),window.addEventListener("message",t=>{this.processRemoteMessage(t.data,t.source)},!1)}publish(e,t,i){this.postMessage(e,"publish",t,i)}subscribe(e,t){if(t===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(e,"subscribe",null,t)}push(e,t,i){this.postMessage(e,"push",t,i)}pull(e,t){if(t===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(e,"pull",null,t)}postMessage(e,t,i,r){let s={topic:e,type:t,message:i};r&&r.postMessage(s,"*")}},zm=class{constructor(e){this.isRunning=!0,this.callback=e}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(e,t,i,r){try{e=r?e:Gp(e),this.callback(e,t,i)}catch(s){console.error(s)}}},s6=class{constructor(e=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=e}uniqueRpcTopic(e){return`${e6}-${e}-${this.uuid}-${this.rpcTicket++}`}publish(e,t,i,r){let s=this.subscribed[e];if(s){let n;for(let a of s)a.running()?a.execute(t,i,r,this.unsafe):(n=n||new Array,n.push(a));if(n)for(let a of n)K5(s,a)}else console.debug("no sub on topic: "+e)}subscribe(e,t){let i=new zm(t);return Fm(this.subscribed,e).push(i),i}push(e,t,i,r){let s=!1,n=this.pulled[e];if(n){for(;n.length>0;){let a=n.shift();if(a.running()){a.execute(t,i,r,this.unsafe),s=!0;break}}n.length===0&&delete this.pulled[e]}s||Fm(this.pushed,e).push({message:t,bridge:i,source:Ul(r)})}pull(e,t){let i=new zm(t),r=this.pushed[e];if(r){let s=r.shift();i.execute(s.message,s.bridge,Fo(s.source),this.unsafe),r.length===0&&delete this.pushed[e]}else Fm(this.pulled,e).push(i);return i}pullA(e){return new Promise(t=>{this.pull(e,(i,r,s)=>{t({message:i,bridge:r,source:Ul(s)})})})}rpcService(e,t){this.subscribe(e,(i,r,s)=>{let{message:n,reply:a}=i;try{let o=t(n);if(o instanceof Promise){let l=Ul(s);o.then(h=>{this.rpcReply(h,a,r,Fo(l))},h=>{console.error(h),this.rpcReply(void 0,a,r,Fo(l))})}else this.rpcReply(o,a,r,s)}catch(o){console.error(o),this.rpcReply(void 0,a,r,s)}})}rpcCall(e,t,i=Vm){let r=new Promise(s=>{let n=this.uniqueRpcTopic(e);this.publish(e,{message:t,reply:n}),this.pull(n,(a,o,l)=>{s({message:a,bridge:o,source:Ul(l)})})});return i>0?Promise.race([r,new Promise((s,n)=>{setTimeout(n,i)})]):r}rpcReply(e,t,i,r){i?i.push(t,e,r):this.push(t,e)}},n6="_MSG_BUS_RPC_";function Hm(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}function Xh(e,t){return a6(e,t,()=>[])}function a6(e,t,i){let r=e[t];return r!==void 0||(r=i(t),e[t]=r),r}var Xu=class{constructor(e,t){this.callback=e,this.unsafe=t,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(e){try{e=this.unsafe?e:Gp(e),this.callback(e)}catch(t){console.error(t)}}},tE=class{constructor(e=crypto.randomUUID()){this.uuid=e,this.rpcTicket=0}subscribeOnce(e,t){let i=this.subscribe(e,r=>{i.cancel(),t(r)});return i}pullA(e){return new Promise(t=>{this.pull(e,t)})}rpcService(e,t){let i=r=>{try{let{message:s,replyTopic:n}=r;try{let a=t(s);a instanceof Promise?a.then(o=>{this.publish(n,{success:!0,result:o})}).catch(o=>{console.error(o),this.publish(n,{success:!1,err:String(o)})}):this.publish(n,{success:!0,result:a})}catch(a){this.publish(n,{success:!1,err:String(a)})}}finally{this.pull(e,i)}};this.pull(e,i)}rpcCall(e,t,i=0){let r=new Promise((s,n)=>{let a=`${n6}-${e}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(a,o=>{o.success?s(o.result):n(new Error(o.err))}),this.push(e,{message:t,replyTopic:a})});return i>0?Promise.race([r,new Promise((s,n)=>{setTimeout(n,i)})]):r}},o6=class extends tE{constructor(e=!1){super(),this.unsafe=e,this.subscribed={},this.pulled={},this.pushed={}}publish(e,t){let i=this.subscribed[e];if(i){let r;for(let s of i)s.running()?s.execute(t):(r=r||new Array,r.push(s));if(r)for(let s of r)Hm(i,s)}}subscribe(e,t){let i=new Xu(t,this.unsafe);return Xh(this.subscribed,e).push(i),i}push(e,t){let i=!1,r=this.pulled[e];if(r){for(;r.length>0;){let s=r.shift();if(s&&s.running()){s.execute(t),i=!0;break}}r.length===0&&delete this.pulled[e]}i||Xh(this.pushed,e).push(t)}pull(e,t){let i=new Xu(t,this.unsafe);return this.repull(e,i),i}repull(e,t){let i=this.pushed[e];if(i){let r=i.shift();r&&(t.execute(r),i.length===0&&delete this.pushed[e])}else Xh(this.pulled,e).push(t)}},l6=class extends tE{constructor(e=crypto.randomUUID()){super(e),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(e,t){console.debug("BC",this.uuid,"PUBLISH",e,t),this.broadcastPublish(e,t)}subscribe(e,t){console.debug("BC",this.uuid,"SUBSCRIBE",e);let i=new Xu(t,!0);return Xh(this.subscribed,e).push(i),i}push(e,t){let i=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",e,`(${i})`,t),Xh(this.pushed,e).push({id:i,message:t}),this.broadcastPushedHeadMessage(e)}pull(e,t){console.debug("BC",this.uuid,"PULL",e);let i=new Xu(t,!0);return Xh(this.pulled,e).push(i),this.broadcastWhoHas(e),i}broadcastPushedHeadMessage(e){let t=this.pushed[e];t&&t[0]&&this.broadcastIHave(e,t[0].id)}onReceivedPublish(e,t,i){console.debug("BCMSG(",this.uuid,")","from",e,"PUBLISH",t,"message",i);let r=this.subscribed[t];if(r){let s;for(let n of r)n.running()?n.execute(i):(s=s||new Array,s.push(n));if(s)for(let n of s)Hm(r,n);r.length===0&&delete this.subscribed[t]}}onReceivedWhoHas(e,t){console.debug("BCMSG(",this.uuid,")","from",e,"WHOHAS",t),this.broadcastPushedHeadMessage(t)}onReceivedIHave(e,t,i){console.debug("BCMSG(",this.uuid,")","from",e,"IHAVE",t,"id",i);let r=this.pulled[t];if(r){let s;for(let n of r)if(n.running()){this.broadcastINeed(t,e,i);break}else s=s||new Array,s.push(n);if(s)for(let n of s)Hm(r,n);r.length===0&&delete this.pulled[t]}}onReceivedINeed(e,t,i,r){if(console.debug("BCMSG(",this.uuid,")","from",e,"INEED",t,"source",i,"id",r),this.uuid===i){let s=this.pushed[t];if(s&&s[0]&&s[0].id===r){let{message:n}=s.shift();this.broadcastIGive(t,r,e,n),this.broadcastPushedHeadMessage(t),s.length===0&&delete this.pushed[t]}}}onReceivedIGive(e,t,i,r,s){console.debug("BCMSG(",this.uuid,")","from",e,"IGIVE",t,"id",i,"target",r,"message",s);let n=this.pulled[t];if(n&&this.uuid===r){let a=!1;for(;n.length>0;){let o=n.shift();if(o.running()){o.execute(s),a=!0;break}}a||this.push(t,s),n.length===0&&delete this.pulled[t]}}},h6=class extends l6{constructor(e,t=crypto.randomUUID()){super(t),this.bc=new BroadcastChannel(e),this.bc.onmessage=i=>{this.onMessage(i.data)}}onMessage(e){let{type:t,uuid:i,topic:r}=e;switch(t){case"PUBLISH":{let{message:s}=e;this.onReceivedPublish(i,r,s);break}case"WHOHAS":{this.onReceivedWhoHas(i,r);break}case"IHAVE":{let{id:s}=e;this.onReceivedIHave(i,r,s);break}case"INEED":{let{source:s,id:n}=e;this.onReceivedINeed(i,r,s,n);break}case"IGIVE":{let{target:s,id:n,message:a}=e;this.onReceivedIGive(i,r,n,s,a);break}default:console.warn("unsupported",e)}}broadcastPublish(e,t){this.post({type:"PUBLISH",uuid:this.uuid,topic:e,message:t})}broadcastWhoHas(e){this.post({type:"WHOHAS",uuid:this.uuid,topic:e})}broadcastIHave(e,t){this.post({type:"IHAVE",uuid:this.uuid,topic:e,id:t})}broadcastINeed(e,t,i){this.post({type:"INEED",uuid:this.uuid,topic:e,source:t,id:i})}broadcastIGive(e,t,i,r){this.post({type:"IGIVE",uuid:this.uuid,topic:e,id:t,target:i,message:r})}post(e){this.bc.postMessage(e),Promise.resolve().then(()=>{this.onMessage(e)})}},Wh=Symbol("BLOCKING_QUEUE_RESET"),iE=class{constructor(e,t=()=>1){if(this.maxSize=e,this.itemSizeOf=t,this.queue=new Fp,this.waitingConsumers=new Fp,this.waitingProducers=new Fp,this.queueSize=0,this.closePromise=null,this.closeResolve=null,e<=0)throw new Error("Max size must be greater than 0")}enqueue(e){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let t=await new Promise(i=>{this.waitingProducers.enqueue(i)});return console.debug("queue is not full",this.size(),t),t?(this.innerEnqueue(e),!0):!1})():(this.innerEnqueue(e),!0)}innerEnqueue(e){if(this.waitingConsumers.isEmpty())this.queue.enqueue(e),this.queueSize+=this.itemSizeOf(e),console.debug("queue pushed",e,"size",this.queueSize);else{let t=this.waitingConsumers.dequeue();Promise.resolve(e).then(t),console.debug("queue direct",e,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let e=this.waitingConsumers.dequeue();Promise.resolve(Wh).then(e)}return setTimeout(()=>this.closeResolve(),0),Wh}else return new Promise(e=>{this.waitingConsumers.enqueue(e)});else{let e=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(e),!this.waitingProducers.isEmpty()){let t=this.waitingProducers.dequeue();Promise.resolve(!0).then(t)}return e}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(e=>{for(this.closeResolve=e;!this.waitingProducers.isEmpty();){let t=this.waitingProducers.dequeue();Promise.resolve(!1).then(t)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let t=this.waitingConsumers.dequeue();Promise.resolve(Wh).then(t)}e()}})),this.closePromise}};function qm(e,t,i=Number.MAX_SAFE_INTEGER){let r=new iE(i,t),s=new ReadableStream({pull(a){let o=!0,l=(async()=>{let h=new Array;do{let c=r.dequeue();if(c instanceof Promise){o=!1;let f=await c;f===Wh?a.close():h.push(f)}else{let f=c;f===Wh?a.close():h.push(f)}}while(r.size()>0);if(h.length>0){let c=e(h);a.enqueue(c)}})();if(!o)return console.debug("read stream stucked --------------------------------------"),l},async cancel(){console.debug("buffered readable cancel"),await r.close()}}),n=new WritableStream({write(a,o){let l=!0,h=(async()=>{let c=r.enqueue(a);typeof c=="boolean"?c||o.error(new Error("Write stream closed")):(l=!1,await c||o.error(new Error("Write stream closed")))})();if(!l)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),h},async close(){console.debug("buffered writable closing",r.size()),await r.close(),console.debug("buffered writable closed",r.size())},async abort(){console.debug("buffered writable aborting",r.size()),await r.close(),console.debug("buffered writable aborted",r.size())}});return{readable:s,writable:n}}function rE(e=Number.MAX_SAFE_INTEGER){return qm(t=>t.join(""),t=>t.length,e)}function sE(e=Number.MAX_SAFE_INTEGER){return qm(t=>{let i=new Uint8Array(t.reduce((s,n)=>s+n.byteLength,0)),r=0;return t.forEach(s=>{i.set(s,r),r+=s.byteLength}),i},t=>t.byteLength,e)}function nE(e){return new Promise((t,i)=>{let r=new BroadcastChannel(e),s=new iE(1),n=new J5(1),a=null,o=!1,l=!1,h=!1;r.onmessage=c=>{let f=c.data,{type:d}=f;if(console.debug("p2p",e,"type",d,"data",d==="DATA"&&f.data),d==="DATA")s.enqueue(f.data);else if(d==="HI"){if(!a){r.postMessage({type:"HI"});let g=0;a={rs:new ReadableStream({async pull(b){let m=await s.dequeue();m===Wh?(await p(),b.close()):(b.enqueue(m),r.postMessage({type:"ACK"}))},cancel(){return p()}}),ws:new WritableStream({async write(b,m){await n.acquireSync()?r.postMessage({type:"DATA",id:g++,data:b}):(u(),m.error(new Error("Write stream closed")))},close(){u()},abort(){u()}})},t(a)}}else d==="REND"?a?n.close():_("REND1"):d==="WEND"?a?s.close():_("WEND1"):d==="ACK"&&n.release();function u(){o||(o=!0,console.debug(e,"p2p write stream closed"),n.close(),r.postMessage({type:"WEND"}),l&&(console.debug(e,"p2p channel closed on ws"),r.close()))}async function p(){l||(l=!0,console.debug(e,"p2p read stream closed"),r.postMessage({type:"REND"}),await s.close(),o&&(console.debug(e,"p2p channel closed on rs"),r.close()))}async function _(g){h||(h=!0,console.debug(e,"p2p channel connection released on",g),n.close(),s.close(),a?(a.rs.locked||(console.debug(e,"p2p unlocked read stream direct cancel"),a.rs.cancel()),a.ws.locked||(console.debug(e,"p2p unlocked write stream direct close"),a.ws.close())):(r.postMessage({type:"HI"}),r.close()),i(new Error("p2p channel connection released")))}},r.postMessage({type:"HI"})})}function c6(e){return new Promise(t=>{let i=new BroadcastChannel(e);i.onmessage=r=>{let s=r.data,{type:n}=s;n==="HI"&&(i.postMessage({type:"REND"}),i.close(),t())},i.postMessage({type:"REND"})})}async function aE(e){try{return await nE(e)}catch(t){t.message!=="p2p channel connection released"&&console.error(t)}}async function u6(e,t,i=10*1024*1024,r=!0){let s=await aE(e);if(!s)return!1;let n=!1;try{let a,o=l=>{if(!a)if(!r)a=s.ws.getWriter();else if(typeof l=="string"){let h=rE(i);h.readable.pipeTo(s.ws),a=h.writable.getWriter()}else{let h=sE(i);h.readable.pipeTo(s.ws),a=h.writable.getWriter()}return a.write(l)};if(Array.isArray(t))for(let l of t)await o(l);else await t({write:o,get desiredSize(){return((a==null?void 0:a.desiredSize)||0)+10}});a&&await a.close(),n=!0}catch(a){console.error(a)}finally{return s.rs.cancel(),n}}async function d6(e,t){var r,s;let i=await aE(e);if(i)try{let n=i.rs.getReader();for((r=t.start)==null?void 0:r.call(t);;){let{value:a,done:o}=await n.read();if(a!==void 0){let l;if(t.update instanceof Promise?l=await t.update(a):l=t.update(a),l){await n.cancel();break}}if(o){(s=t.end)==null||s.call(t);break}}}catch(n){console.error(n)}finally{i.ws.close()}}});var gP=Object.create,om=Object.defineProperty,OP=Object.getOwnPropertyDescriptor,mP=Object.getOwnPropertyNames,yP=Object.getPrototypeOf,bP=Object.prototype.hasOwnProperty,dh=(e=>typeof hr<"u"?hr:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof hr<"u"?hr:t)[i]}):e)(function(e){if(typeof hr<"u")return hr.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),xP=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),vP=(e,t)=>{for(var i in t)om(e,i,{get:t[i],enumerable:!0})},EP=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of mP(t))!bP.call(e,s)&&s!==i&&om(e,s,{get:()=>t[s],enumerable:!(r=OP(t,s))||r.enumerable});return e},Ru=(e,t,i)=>(i=e!=null?gP(yP(e)):{},EP(t||!e||!e.__esModule?om(i,"default",{value:e,enumerable:!0}):i,e)),Du=xP((e,t)=>{"use strict";var i=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(T,k)=>{for(var A in k)i(T,A,{get:k[A],enumerable:!0})},o=(T,k,A,F)=>{if(k&&typeof k=="object"||typeof k=="function")for(let V of s(k))!n.call(T,V)&&V!==A&&i(T,V,{get:()=>k[V],enumerable:!(F=r(k,V))||F.enumerable});return T},l=T=>o(i({},"__esModule",{value:!0}),T),h={};a(h,{BroadcastChannelMessageBus:()=>Je,MessageBus:()=>J,MessageBus2:()=>Pe,MessageBusTask:()=>ve,MessageBusTask2:()=>Ce,WindowMessageBridge:()=>_e,WorkerMessageBridge:()=>he,createBroadcastP2PStream:()=>mi,createBufferedByteBufferStream:()=>si,createBufferedStream:()=>ct,createBufferedStringStream:()=>ut,dropP2PStream:()=>It,flowRead:()=>ni,flowWrite:()=>Ai}),t.exports=l(h);var c=class{constructor(T=1.5){this.growthFactor=T,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(T){if(this.count===this.capacity){let k=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,k);let A=new Array(k);for(let F=0;F<this.count;F++)A[F]=this.buffer[(this.head+F)%this.capacity];this.buffer=A,this.head=0,this.tail=this.count,this.capacity=k}this.buffer[this.tail]=T,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let T=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,T}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},f=new ArrayBuffer(8),d=new Float64Array(f),u=new Uint32Array(f),p=new Uint16Array(f),_=ArrayBuffer;try{_=self.HTMLImageElement||_}catch{}var g=typeof SharedArrayBuffer<"u";function b(T){if(typeof T!="object"||T===null||T instanceof Date||T instanceof ArrayBuffer||g&&T instanceof SharedArrayBuffer||T instanceof Blob||T instanceof FormData||T instanceof Function||T instanceof Uint8ClampedArray||T instanceof _)return T;if(Array.isArray(T))return T.map(b);{let k={};for(let A in T)Object.hasOwnProperty.call(T,A)&&(k[A]=b(T[A]));return k}}function m(T,k){return O(T,k,()=>[])}function O(T,k,A){let F=T[k];return F!==void 0||(F=A(k),T[k]=F),F}function y(T,k){if(Array.isArray(T)){for(let A=0,F=T.length;A<F;A++)if(k(void 0,T[A],A)===!1)return}else{let A=0;for(let F in T)if(T.hasOwnProperty(F)){let V=T[F];if(k(F,V,A)===!1)return;A++}}}var x=Object.prototype.hasOwnProperty;async function E(T,k){if(Array.isArray(T)){for(let A=0,F=T.length;A<F;A++)if(await k(void 0,T[A],A)===!1)return}else{let A=0;for(let F in T)if(x.call(T,F)){let V=T[F];if(await k(F,V,A)===!1)return;A++}}}function w(T,k,A){return typeof T=="string"&&(/https?:/.test(T)||(T=location.origin+T)),Promise.race([fetch(T,k),new Promise((F,V)=>setTimeout(V,A))])}function S(T,k){let A=0,F=0;return(...V)=>{let Q=++A;setTimeout(()=>{let W=performance.now();if(Q===A||W-F>=T){try{k(...V)}catch(ne){console.log(ne)}F=W}},Math.max(0,T-(performance.now()-F)))}}function C(T,k){let A=T.length,F=0;for(;F<A;){let V=T.indexOf(`
`,F);V<0&&(V=A);let Q=T.substring(F,V);try{if(k(Q)===!1)return}catch(W){console.error(W)}F=V+1}}function R(T){let k=null;return()=>(k===null&&(k=T()),k)}var B=0;function Y(){B===0&&(B=Date.now()-performance.now());let T=new Array,k=B+performance.now();d[0]=k,T.push(u[1].toString(16)),d[0]=Math.random(),T.push(p[3].toString(16));let A=p[2].toString(16);T.push("4"+A.substr(0,3)),d[0]=k;let F=u[0].toString(16)+u[1].toString(16);return T.push("0"+F.substr(0,3)),T.push(F.substr(3)),T.join("-")}var G=class{constructor(T){this.maxResources=T,this.idle=new c,this.isClosed=!1,this.resources=T}acquire(T){this.isClosed?Promise.resolve(!1).then(T):this.resources>0?(this.resources--,Promise.resolve(!0).then(T)):this.idle.enqueue(T)}acquireSync(){return new Promise(T=>{this.acquire(T)})}release(){if(!this.isClosed){let T=this.idle.dequeue();T?Promise.resolve(!0).then(T):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let T=this.idle.dequeue();Promise.resolve(!1).then(T)}}};function z(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function q(T,k,A){let F=T.length+k-1;for(let V=0;V<F;V++){let Q=new Array;for(let W=V-k+1;W<=V;W++)Q.push(T[W]);if(A(Q)===!1)break}}function L(){let T=new Date,k=T.getFullYear(),A=T.getMonth()+1,F=T.getDate(),V=T.getHours(),Q=T.getMinutes(),W=T.getSeconds(),ne=T.getMilliseconds();return"["+k+"-"+(A<10?"0"+A:A)+"-"+(F<10?"0"+F:F)+" "+(V<10?"0"+V:V)+":"+(Q<10?"0"+Q:Q)+":"+(W<10?"0"+W:W)+"."+(ne<100?ne<10?"00"+ne:"0"+ne:ne)+"] "}function M(T){return new Promise(k=>setTimeout(k,T))}function v(T,k){let A=0,F=T.length;for(let V=0;V<F;V++)T[V]===k&&(T.splice(V,1),V--,F--,A++);return A}var P=z(),I=P.WeakRef||(T=>T);function N(T){if(T!=null){if(typeof T=="object")return new I(T);console.error(T,T instanceof Object,typeof T);return}}function D(T){return T==null?void 0:T.deref()}var j="_MSG_BUS_RPC_",H=300*1e3,K=(T=>(T.PUBLISH="publish",T.SUBSCRIBE="subscribe",T.PUSH="push",T.PULL="pull",T))(K||{}),se=class{constructor(T){this.bus=T}processRemoteMessage(T,k){let A=N(k),F=T.topic,V=T.type,Q=T.message;switch(V){case"pull":this.bus.pull(F,W=>{this.push(F,W,D(A))});break;case"subscribe":this.bus.subscribe(F,W=>{this.publish(F,W,D(A))});break;case"publish":this.bus.publish(F,Q,this,D(A));break;case"push":this.bus.push(F,Q,this,D(A));break;default:console.debug("unknown message type "+V)}}rpcCall(T,k,A,F=H){let V=N(A),Q=new Promise(W=>{let ne=this.bus.uniqueRpcTopic(T);this.publish(T,{message:k,reply:ne},D(V)),this.bus.pull(ne,(X,Ee,Me)=>{W({message:X,bridge:Ee,source:N(Me)})})});return F>0?Promise.race([Q,new Promise((W,ne)=>{setTimeout(ne,F)})]):Q}},he=class extends se{constructor(T,k){super(T),this.worker=k,k.onmessage=A=>{this.processRemoteMessage(A.data,void 0)}}publish(T,k){this.postMessage(T,"publish",k)}subscribe(T){this.postMessage(T,"subscribe",null)}push(T,k){this.postMessage(T,"push",k)}pull(T){this.postMessage(T,"pull",null)}rpcCall(T,k,A=H){return super.rpcCall(T,k,void 0,A)}postMessage(T,k,A){let F={topic:T,type:k,message:A};this.worker.postMessage(F)}discard(){this.worker.terminate()}},_e=class extends se{constructor(T){super(T),window.addEventListener("message",k=>{this.processRemoteMessage(k.data,k.source)},!1)}publish(T,k,A){this.postMessage(T,"publish",k,A)}subscribe(T,k){if(k===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(T,"subscribe",null,k)}push(T,k,A){this.postMessage(T,"push",k,A)}pull(T,k){if(k===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(T,"pull",null,k)}postMessage(T,k,A,F){let V={topic:T,type:k,message:A};F&&F.postMessage(V,"*")}},ve=class{constructor(T){this.isRunning=!0,this.callback=T}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(T,k,A,F){try{T=F?T:b(T),this.callback(T,k,A)}catch(V){console.error(V)}}},J=class{constructor(T=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=T}uniqueRpcTopic(T){return`${j}-${T}-${this.uuid}-${this.rpcTicket++}`}publish(T,k,A,F){let V=this.subscribed[T];if(V){let Q;for(let W of V)W.running()?W.execute(k,A,F,this.unsafe):(Q=Q||new Array,Q.push(W));if(Q)for(let W of Q)v(V,W)}else console.debug("no sub on topic: "+T)}subscribe(T,k){let A=new ve(k);return m(this.subscribed,T).push(A),A}push(T,k,A,F){let V=!1,Q=this.pulled[T];if(Q){for(;Q.length>0;){let W=Q.shift();if(W.running()){W.execute(k,A,F,this.unsafe),V=!0;break}}Q.length===0&&delete this.pulled[T]}V||m(this.pushed,T).push({message:k,bridge:A,source:N(F)})}pull(T,k){let A=new ve(k),F=this.pushed[T];if(F){let V=F.shift();A.execute(V.message,V.bridge,D(V.source),this.unsafe),F.length===0&&delete this.pushed[T]}else m(this.pulled,T).push(A);return A}pullA(T){return new Promise(k=>{this.pull(T,(A,F,V)=>{k({message:A,bridge:F,source:N(V)})})})}rpcService(T,k){this.subscribe(T,(A,F,V)=>{let{message:Q,reply:W}=A;try{let ne=k(Q);if(ne instanceof Promise){let X=N(V);ne.then(Ee=>{this.rpcReply(Ee,W,F,D(X))},Ee=>{console.error(Ee),this.rpcReply(void 0,W,F,D(X))})}else this.rpcReply(ne,W,F,V)}catch(ne){console.error(ne),this.rpcReply(void 0,W,F,V)}})}rpcCall(T,k,A=H){let F=new Promise(V=>{let Q=this.uniqueRpcTopic(T);this.publish(T,{message:k,reply:Q}),this.pull(Q,(W,ne,X)=>{V({message:W,bridge:ne,source:N(X)})})});return A>0?Promise.race([F,new Promise((V,Q)=>{setTimeout(Q,A)})]):F}rpcReply(T,k,A,F){A?A.push(k,T,F):this.push(k,T)}},Z="_MSG_BUS_RPC_";function re(T,k){let A=0,F=T.length;for(let V=0;V<F;V++)T[V]===k&&(T.splice(V,1),V--,F--,A++);return A}function ue(T,k){return Le(T,k,()=>[])}function Le(T,k,A){let F=T[k];return F!==void 0||(F=A(k),T[k]=F),F}var Ce=class{constructor(T,k){this.callback=T,this.unsafe=k,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(T){try{T=this.unsafe?T:b(T),this.callback(T)}catch(k){console.error(k)}}},De=class{constructor(T=crypto.randomUUID()){this.uuid=T,this.rpcTicket=0}subscribeOnce(T,k){let A=this.subscribe(T,F=>{A.cancel(),k(F)});return A}pullA(T){return new Promise(k=>{this.pull(T,k)})}rpcService(T,k){let A=F=>{try{let{message:V,replyTopic:Q}=F;try{let W=k(V);W instanceof Promise?W.then(ne=>{this.publish(Q,{success:!0,result:ne})}).catch(ne=>{console.error(ne),this.publish(Q,{success:!1,err:String(ne)})}):this.publish(Q,{success:!0,result:W})}catch(W){this.publish(Q,{success:!1,err:String(W)})}}finally{this.pull(T,A)}};this.pull(T,A)}rpcCall(T,k,A=0){let F=new Promise((V,Q)=>{let W=`${Z}-${T}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(W,ne=>{ne.success?V(ne.result):Q(new Error(ne.err))}),this.push(T,{message:k,replyTopic:W})});return A>0?Promise.race([F,new Promise((V,Q)=>{setTimeout(Q,A)})]):F}},Pe=class extends De{constructor(T=!1){super(),this.unsafe=T,this.subscribed={},this.pulled={},this.pushed={}}publish(T,k){let A=this.subscribed[T];if(A){let F;for(let V of A)V.running()?V.execute(k):(F=F||new Array,F.push(V));if(F)for(let V of F)re(A,V)}}subscribe(T,k){let A=new Ce(k,this.unsafe);return ue(this.subscribed,T).push(A),A}push(T,k){let A=!1,F=this.pulled[T];if(F){for(;F.length>0;){let V=F.shift();if(V&&V.running()){V.execute(k),A=!0;break}}F.length===0&&delete this.pulled[T]}A||ue(this.pushed,T).push(k)}pull(T,k){let A=new Ce(k,this.unsafe);return this.repull(T,A),A}repull(T,k){let A=this.pushed[T];if(A){let F=A.shift();F&&(k.execute(F),A.length===0&&delete this.pushed[T])}else ue(this.pulled,T).push(k)}},Ie=class extends De{constructor(T=crypto.randomUUID()){super(T),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(T,k){console.debug("BC",this.uuid,"PUBLISH",T,k),this.broadcastPublish(T,k)}subscribe(T,k){console.debug("BC",this.uuid,"SUBSCRIBE",T);let A=new Ce(k,!0);return ue(this.subscribed,T).push(A),A}push(T,k){let A=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",T,`(${A})`,k),ue(this.pushed,T).push({id:A,message:k}),this.broadcastPushedHeadMessage(T)}pull(T,k){console.debug("BC",this.uuid,"PULL",T);let A=new Ce(k,!0);return ue(this.pulled,T).push(A),this.broadcastWhoHas(T),A}broadcastPushedHeadMessage(T){let k=this.pushed[T];k&&k[0]&&this.broadcastIHave(T,k[0].id)}onReceivedPublish(T,k,A){console.debug("BCMSG(",this.uuid,")","from",T,"PUBLISH",k,"message",A);let F=this.subscribed[k];if(F){let V;for(let Q of F)Q.running()?Q.execute(A):(V=V||new Array,V.push(Q));if(V)for(let Q of V)re(F,Q);F.length===0&&delete this.subscribed[k]}}onReceivedWhoHas(T,k){console.debug("BCMSG(",this.uuid,")","from",T,"WHOHAS",k),this.broadcastPushedHeadMessage(k)}onReceivedIHave(T,k,A){console.debug("BCMSG(",this.uuid,")","from",T,"IHAVE",k,"id",A);let F=this.pulled[k];if(F){let V;for(let Q of F)if(Q.running()){this.broadcastINeed(k,T,A);break}else V=V||new Array,V.push(Q);if(V)for(let Q of V)re(F,Q);F.length===0&&delete this.pulled[k]}}onReceivedINeed(T,k,A,F){if(console.debug("BCMSG(",this.uuid,")","from",T,"INEED",k,"source",A,"id",F),this.uuid===A){let V=this.pushed[k];if(V&&V[0]&&V[0].id===F){let{message:Q}=V.shift();this.broadcastIGive(k,F,T,Q),this.broadcastPushedHeadMessage(k),V.length===0&&delete this.pushed[k]}}}onReceivedIGive(T,k,A,F,V){console.debug("BCMSG(",this.uuid,")","from",T,"IGIVE",k,"id",A,"target",F,"message",V);let Q=this.pulled[k];if(Q&&this.uuid===F){let W=!1;for(;Q.length>0;){let ne=Q.shift();if(ne.running()){ne.execute(V),W=!0;break}}W||this.push(k,V),Q.length===0&&delete this.pulled[k]}}},Je=class extends Ie{constructor(T,k=crypto.randomUUID()){super(k),this.bc=new BroadcastChannel(T),this.bc.onmessage=A=>{this.onMessage(A.data)}}onMessage(T){let{type:k,uuid:A,topic:F}=T;switch(k){case"PUBLISH":{let{message:V}=T;this.onReceivedPublish(A,F,V);break}case"WHOHAS":{this.onReceivedWhoHas(A,F);break}case"IHAVE":{let{id:V}=T;this.onReceivedIHave(A,F,V);break}case"INEED":{let{source:V,id:Q}=T;this.onReceivedINeed(A,F,V,Q);break}case"IGIVE":{let{target:V,id:Q,message:W}=T;this.onReceivedIGive(A,F,Q,V,W);break}default:console.warn("unsupported",T)}}broadcastPublish(T,k){this.post({type:"PUBLISH",uuid:this.uuid,topic:T,message:k})}broadcastWhoHas(T){this.post({type:"WHOHAS",uuid:this.uuid,topic:T})}broadcastIHave(T,k){this.post({type:"IHAVE",uuid:this.uuid,topic:T,id:k})}broadcastINeed(T,k,A){this.post({type:"INEED",uuid:this.uuid,topic:T,source:k,id:A})}broadcastIGive(T,k,A,F){this.post({type:"IGIVE",uuid:this.uuid,topic:T,id:k,target:A,message:F})}post(T){this.bc.postMessage(T),Promise.resolve().then(()=>{this.onMessage(T)})}},$e=Symbol("BLOCKING_QUEUE_RESET"),pt=class{constructor(T,k=()=>1){if(this.maxSize=T,this.itemSizeOf=k,this.queue=new c,this.waitingConsumers=new c,this.waitingProducers=new c,this.queueSize=0,this.closePromise=null,this.closeResolve=null,T<=0)throw new Error("Max size must be greater than 0")}enqueue(T){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let k=await new Promise(A=>{this.waitingProducers.enqueue(A)});return console.debug("queue is not full",this.size(),k),k?(this.innerEnqueue(T),!0):!1})():(this.innerEnqueue(T),!0)}innerEnqueue(T){if(this.waitingConsumers.isEmpty())this.queue.enqueue(T),this.queueSize+=this.itemSizeOf(T),console.debug("queue pushed",T,"size",this.queueSize);else{let k=this.waitingConsumers.dequeue();Promise.resolve(T).then(k),console.debug("queue direct",T,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let T=this.waitingConsumers.dequeue();Promise.resolve($e).then(T)}return setTimeout(()=>this.closeResolve(),0),$e}else return new Promise(T=>{this.waitingConsumers.enqueue(T)});else{let T=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(T),!this.waitingProducers.isEmpty()){let k=this.waitingProducers.dequeue();Promise.resolve(!0).then(k)}return T}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(T=>{for(this.closeResolve=T;!this.waitingProducers.isEmpty();){let k=this.waitingProducers.dequeue();Promise.resolve(!1).then(k)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let k=this.waitingConsumers.dequeue();Promise.resolve($e).then(k)}T()}})),this.closePromise}};function ct(T,k,A=Number.MAX_SAFE_INTEGER){let F=new pt(A,k),V=new ReadableStream({pull(W){let ne=!0,X=(async()=>{let Ee=new Array;do{let Me=F.dequeue();if(Me instanceof Promise){ne=!1;let U=await Me;U===$e?W.close():Ee.push(U)}else{let U=Me;U===$e?W.close():Ee.push(U)}}while(F.size()>0);if(Ee.length>0){let Me=T(Ee);W.enqueue(Me)}})();if(!ne)return console.debug("read stream stucked --------------------------------------"),X},async cancel(){console.debug("buffered readable cancel"),await F.close()}}),Q=new WritableStream({write(W,ne){let X=!0,Ee=(async()=>{let Me=F.enqueue(W);typeof Me=="boolean"?Me||ne.error(new Error("Write stream closed")):(X=!1,await Me||ne.error(new Error("Write stream closed")))})();if(!X)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),Ee},async close(){console.debug("buffered writable closing",F.size()),await F.close(),console.debug("buffered writable closed",F.size())},async abort(){console.debug("buffered writable aborting",F.size()),await F.close(),console.debug("buffered writable aborted",F.size())}});return{readable:V,writable:Q}}function ut(T=Number.MAX_SAFE_INTEGER){return ct(k=>k.join(""),k=>k.length,T)}function si(T=Number.MAX_SAFE_INTEGER){return ct(k=>{let A=new Uint8Array(k.reduce((V,Q)=>V+Q.byteLength,0)),F=0;return k.forEach(V=>{A.set(V,F),F+=V.byteLength}),A},k=>k.byteLength,T)}function mi(T){return new Promise((k,A)=>{let F=new BroadcastChannel(T),V=new pt(1),Q=new G(1),W=null,ne=!1,X=!1,Ee=!1;F.onmessage=Me=>{let U=Me.data,{type:be}=U;if(console.debug("p2p",T,"type",be,"data",be==="DATA"&&U.data),be==="DATA")V.enqueue(U.data);else if(be==="HI"){if(!W){F.postMessage({type:"HI"});let Se=0;W={rs:new ReadableStream({async pull(ze){let Ue=await V.dequeue();Ue===$e?(await $(),ze.close()):(ze.enqueue(Ue),F.postMessage({type:"ACK"}))},cancel(){return $()}}),ws:new WritableStream({async write(ze,Ue){await Q.acquireSync()?F.postMessage({type:"DATA",id:Se++,data:ze}):(Ne(),Ue.error(new Error("Write stream closed")))},close(){Ne()},abort(){Ne()}})},k(W)}}else be==="REND"?W?Q.close():fe("REND1"):be==="WEND"?W?V.close():fe("WEND1"):be==="ACK"&&Q.release();function Ne(){ne||(ne=!0,console.debug(T,"p2p write stream closed"),Q.close(),F.postMessage({type:"WEND"}),X&&(console.debug(T,"p2p channel closed on ws"),F.close()))}async function $(){X||(X=!0,console.debug(T,"p2p read stream closed"),F.postMessage({type:"REND"}),await V.close(),ne&&(console.debug(T,"p2p channel closed on rs"),F.close()))}async function fe(Se){Ee||(Ee=!0,console.debug(T,"p2p channel connection released on",Se),Q.close(),V.close(),W?(W.rs.locked||(console.debug(T,"p2p unlocked read stream direct cancel"),W.rs.cancel()),W.ws.locked||(console.debug(T,"p2p unlocked write stream direct close"),W.ws.close())):(F.postMessage({type:"HI"}),F.close()),A(new Error("p2p channel connection released")))}},F.postMessage({type:"HI"})})}function It(T){return new Promise(k=>{let A=new BroadcastChannel(T);A.onmessage=F=>{let V=F.data,{type:Q}=V;Q==="HI"&&(A.postMessage({type:"REND"}),A.close(),k())},A.postMessage({type:"REND"})})}async function jt(T){try{return await mi(T)}catch(k){k.message!=="p2p channel connection released"&&console.error(k)}}async function Ai(T,k,A=10*1024*1024,F=!0){let V=await jt(T);if(!V)return!1;let Q=!1;try{let W,ne=X=>{if(!W)if(!F)W=V.ws.getWriter();else if(typeof X=="string"){let Ee=ut(A);Ee.readable.pipeTo(V.ws),W=Ee.writable.getWriter()}else{let Ee=si(A);Ee.readable.pipeTo(V.ws),W=Ee.writable.getWriter()}return W.write(X)};if(Array.isArray(k))for(let X of k)await ne(X);else await k({write:ne,get desiredSize(){return((W==null?void 0:W.desiredSize)||0)+10}});W&&await W.close(),Q=!0}catch(W){console.error(W)}finally{return V.rs.cancel(),Q}}async function ni(T,k){var F,V;let A=await jt(T);if(A)try{let Q=A.rs.getReader();for((F=k.start)==null?void 0:F.call(k);;){let{value:W,done:ne}=await Q.read();if(W!==void 0){let X;if(k.update instanceof Promise?X=await k.update(W):X=k.update(W),X){await Q.cancel();break}}if(ne){(V=k.end)==null||V.call(k);break}}}catch(Q){console.error(Q)}finally{A.ws.close()}}}),TP={UNAUTHORIZED:"Not logged in yet, please log in and try again",LOGIN_FAIL:"The login status is invalid",PERMISSION_DENIED:"No permission or project does not exist",PERMISSION_DENIED1:"No permission",PRJ_NOT_EXIST:"No permission or project does not exist",ERROR_PATH:"No permission or project does not exist",PROJECT_NOT_FOUND:"The project was not found",PERMISSION_DENIED_PARAMS:"No permission to operate {type}",DATA_NOT_FOUND:"Data not found",PARAMS_DATA_NOT_FOUND:"The {type} data was not found",REQUEST_PARAM_ILLEGAL:"Parameter error",REQUEST_PARAM_ILLEGAL1:"Parameter error",REQUEST_PARAMS_ILLEGAL2:"The {type} parameter request is incorrect",REQUEST_PARAMS_NOT_NULL:"The {type} parameter of the request cannot be empty",REQUEST_PARAMS_NOT_ALL_NULL:"The {type} parameter of the request cannot be empty simultaneously",REQUEST_PARAMS_MUST_ARRAY:"The request parameter {type} must be an array",REQUEST_PARAMS_MUST_STRING:"The request parameter {type} must be a string",REQUEST_PARAMS_MUST_NUMBER:"The request parameter {type} must be a number",REQUEST_PARAMS_MUST_NUMBER_ARRAY:"The request parameter {type} must be a numeric array",REQUEST_PARAMS_MUST_STRING_ARRAY:"The request parameter {type} must be a string array",REQUEST_PARAMS_LENGTH_ERROR:"The length of the request parameter {type} is incorrect",REQUEST_PARAMS_TYPE_ERROR:"The request parameter {type} is of incorrect type",ILLEGAL_NAME:'The name is illegal and contains illegal characters such as /:*?"<>|',ILLEGAL_NAME1:'The name is illegal and contains illegal characters such as /:*?"<>|',ILLEGAL_NAME_ZH:"The name cannot contain Chinese characters",UUID_ERROR:"uuid error",DUPLICATE_DATA:"Duplicate title",DUPLICATE_DATA1:"Library duplicate name",DUPLICATE_DATA_PARAMS:"{type} Duplicate data",UPLOAD_LIMIT:"Document {documentName} size over 15MB, it is too big to save in the server, please modify and then try again.",MORE_THAN_LIMIT:"Exceed the maximum limit",FILE_MORE_THAN_LIMIT:"Exceed the maximum upload limit of {type}",PARAMS_MORE_THAN_LIMIT:"Exceed the maximum upload limit of the parameter {type}",IMAGE_MORE_THAN_LIMIT_PARAMS:"The picture exceeds the maximum upload limit",FILE_MORE_THAN_LIMIT_PARAMS:"The file exceeds the maximum upload limit",END_MUST_AFTER_START:"The start time cannot be later than the end time",FILE_READ_ONLY:"The project file eprj or library file elib property was set as read only, please enable the read only property at File Manager and try again, and contact with support",FILE_READ_ONLY1:"The project file eprj or library file elib property was set as read only, please enable the read only property at File Manager and try again, and contact with support",DATA_NOT_EXIST:"document {documentName} not exists",REQUEST_PARAMS_TIME_ERROR:"The time request parameter is incorrect",FILES_PATH_NOT_FOUND:"The file address cannot be found",FILES_DATA_NOT_FOUND:"The file data cannot be found",FILES_TYPE_ERROR:"File type error",FILES_TYPE_MUST_BE_ONE:"The file type must be {type}",SET_WATERMARK_FAIL:"Watermark setting failed",MYSQL_CRUD_ERROR:"{type} data execution failed. Please contact technical support for resolution",PARAMS_JSON_FAILED:"{type} data parsing failed",MYSQL_ERROR:"Database operation anomaly",NOT_FOUND:"The request does not exist",PRJ_NAME_EXISTS:"The name of the project already exists",BACKUP_NAME_EXISTS:"Backup Name already exists",TITLE_ILLEGAL_LEN:"The {documentName} length must be 1~128 bytes!",LIB_NOT_EXIST:"The component library does not exist",CONFIG_API_URLS_ERROR:"Real-time prices and inventory are not enabled. Please contact the administrator",ONE_CLICK_ORDER_NOT_OPEN:"The order placement function is not enabled. Please contact the administrator",MATERIAL_NOT_OPEN:"The material warehouse is not open. Please contact the administrator",SNAPSHOT_DEPTH_LIMIT:"There is a snapshot near the latest node or the snapshot has been applied for",OCR_SYMBOL_URL_ERROR:"The OCR request address is not configured",USER_DATA_NOT_FOUND:"The user does not exist",USER_DISABLE_ERROR:"The account has been deactivated",USER_EXISTS_LOGIN_ERROR:"The user has logged in elsewhere",USER_UNAUTHORIZED_MODULES_ERROR:"This account has not authorized the module",USER_UNAUTHORIZED_ACCESS_ERROR:"Access type error",ADMIN_NOT_CHANGE_PASSWORD:"The super administrator cannot reset the password",SAME_PASSWORD_NEW_PASSWORD:"The original password is the same as the new one",USER_ONLINE_REGISTRATION_FAILED:"The registration of the user online failed",USER_PASSWORD_CAN_NOT_DEFAULT:"The default password cannot be used",USER_BEFORE_PASSWORD_ERROR:"The original password is incorrect",USER_PASSWORD_LENGTH_ERROR:"The password length is 8 to 255 characters",ORG_ROLE_NOT_CREATE:"System roles cannot be created. Please make the necessary modifications",ORG_ROLE_NAME_DUPLICATE:"The character name already exists. Please modify it",ORG_ROLE_ORIGIN_ERROR:"Unknown character source {message}",ORG_ROLE_NOT_DEFAULT:"This character is not a preset one and cannot be operated",ADMIN_ROLE_NOT_CHANGE:"Administrator privileges do not allow for modification",ADMIN_NOT_CHANGE_STATUS:"The admin account cannot change its status",PROJECT_ARCHIVED:"The project has been locked",PROJECT_UUID_NULL:"The project uuid cannot be empty",PROJECT_UUID_ERROR:"uuid error or the project uuid already exists",PROJECT_OR_TEAM_UUID_ERROR:"The project uuid is incorrect or the team uuid already exists",PROJECT_NOT_PERSON_ERROR:"Personal projects are not allowed to be created",PROJECT_DUPLICATE_NAME:"Duplicate title",ANNOTATION_HAS_BE_FOUND:"The annotation has been created",ANNOTATION_NOT_FOUND:"The annotation block does not exist",ANNOTATION_CREATE_ERROR:"The annotation block creation failed",ANNOTATION_UPDATE_ERROR:"The update of the annotation block failed",ANNOTATION_DELETE_ERROR:"The annotation failed to be deleted",PROJECT_DUPLICATE_PATH:"The same path cannot be created",TEAM_NOT_FOUND:"The team does not exist",TEAM_UUID_NULL:"The team uuid cannot be empty",TEAM_FOLDER_ERROR:"The parent folder does not exist or does not belong to the current team",TEAM_FOLDER_UUID_ERROR:"The folder uuid is incorrect or the project uuid already exists",TEAM_URL_DUPLICATE:"Team link repetition",TEAM_CAN_NOT_DELETE:"There are still projects in the team. Please transfer or delete them first",COMPONENT_UUID_NULL:"The uuid of a component cannot be empty",COMPONENT_DATA_NOT_FOUND:"The component library data does not exist",COMPONENT_NAME_DUPLICATE:"Component libraries cannot have the same name",COMPONENT_TYPE_ERROR:"Library type error",DELETE_SON_CATEGORY:"The subcategories need to be deleted first",LICENSE:"License not found",START_TIME:"The start time of the license is incorrect",END_TIME:"The end time of the license is incorrect",PROJECT_LIMIT:"The maximum number of projects has been reached",USER_LIMIT:"The maximum number of accounts has been reached",ONLINE_NUMBER_LIMIT:"The maximum number of online users has been reached",LIMIT_PCB:"The PCB authorization quota has been reached and the addition failed",LIMIT_SCH:"The schematic authorization number is full, and the addition failed",LIMIT_PANEL:"The panel authorization number is full and the addition failed",TIME_ERROR:"If the system time is incorrect, please restart the server or fix the system time. After fixing, the private service needs to be restarted",LICENSE_ERROR:"Authorization error",LICENSE_TYPE_ERROR:"The type of authorized application is incorrect",LICENSE_ORIGIN_ERROR:"Unknown authorized application {type}",BRANCH_DATA_NOT_FOUND:"There is no engineering branch",PARENT_UUID_ERROR:"parent uuid error",BRANCH_MUST_AFTER_NODE:"The branch must be after the node",BRANCH_NAME_ERROR:"Incorrect branch name",BRANCH_NAME_DUPLICATE:"The branch name already exists",BRANCH_UUID_ERROR:"The branch uuid is incorrect",BRANCH_NODE_SET_ERROR:"Nodes cannot be set as default branches or marked as master",BRANCH_DELETE_MAIN_ERROR:"Nodes or branches on the main branch cannot be deleted",BRANCH_CHECK_OUT_ERROR:"There are documents that have been checked out",DOCUMENT_UUID_ERROR:"The document uuid is incorrect",UPDATE_FAILED:"Update failed",INNER_API_KEY_ERROR:"The ApiKey of the internal interface of the server is incorrect",BRANCH_MORE_THAN_LIMIT:"The version exceeds the maximum limit",WORKSPACE_API_ERROR:"The workspace request response is abnormal"},wP={UNAUTHORIZED:"\u5C1A\u672A\u767B\u5F55\uFF0C\u8BF7\u767B\u5F55\u540E\u518D\u8BD5",LOGIN_FAIL:"\u767B\u5F55\u72B6\u6001\u5F02\u5E38",PERMISSION_DENIED:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",PERMISSION_DENIED1:"\u6CA1\u6709\u6743\u9650",PRJ_NOT_EXIST:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",ERROR_PATH:"\u6CA1\u6709\u6743\u9650\u6216\u5DE5\u7A0B\u4E0D\u5B58\u5728",PROJECT_NOT_FOUND:"\u5DE5\u7A0B\u672A\u627E\u5230",PERMISSION_DENIED_PARAMS:"\u6CA1\u6709\u6743\u9650\u64CD\u4F5C{type}",DATA_NOT_FOUND:"\u6570\u636E\u672A\u627E\u5230",PARAMS_DATA_NOT_FOUND:"{type}\u6570\u636E\u672A\u627E\u5230",REQUEST_PARAM_ILLEGAL:"\u53C2\u6570\u9519\u8BEF",REQUEST_PARAM_ILLEGAL1:"\u53C2\u6570\u9519\u8BEF",REQUEST_PARAMS_ILLEGAL2:"\u8BF7\u6C42{type}\u53C2\u6570\u9519\u8BEF",REQUEST_PARAMS_NOT_NULL:"\u8BF7\u6C42{type}\u53C2\u6570\u4E0D\u80FD\u4E3A\u7A7A",REQUEST_PARAMS_NOT_ALL_NULL:"\u8BF7\u6C42{type}\u53C2\u6570\u4E0D\u80FD\u540C\u65F6\u4E3A\u7A7A",REQUEST_PARAMS_MUST_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u7EC4",REQUEST_PARAMS_MUST_STRING:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u5B57\u7B26\u4E32",REQUEST_PARAMS_MUST_NUMBER:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u5B57",REQUEST_PARAMS_MUST_NUMBER_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u6570\u5B57\u6570\u7EC4",REQUEST_PARAMS_MUST_STRING_ARRAY:"\u8BF7\u6C42\u53C2\u6570{type}\u5FC5\u987B\u662F\u5B57\u7B26\u4E32\u6570\u7EC4",REQUEST_PARAMS_LENGTH_ERROR:"\u8BF7\u6C42\u53C2\u6570{type}\u957F\u5EA6\u9519\u8BEF",REQUEST_PARAMS_TYPE_ERROR:"\u8BF7\u6C42\u53C2\u6570{type}\u7C7B\u578B\u9519\u8BEF",ILLEGAL_NAME:'\u540D\u79F0\u975E\u6CD5, \u5305\u542B /:*?"<>| \u7B49\u975E\u6CD5\u5B57\u7B26',ILLEGAL_NAME1:'\u540D\u79F0\u975E\u6CD5, \u5305\u542B /:*?"<>| \u7B49\u975E\u6CD5\u5B57\u7B26',ILLEGAL_NAME_ZH:"\u540D\u79F0\u4E0D\u80FD\u5305\u542B\u4E2D\u6587",UUID_ERROR:"uuid \u9519\u8BEF",DUPLICATE_DATA:"\u6807\u9898\u5DF2\u5B58\u5728",DUPLICATE_DATA1:"\u5E93\u91CD\u540D",DUPLICATE_DATA_PARAMS:"{type}\u91CD\u590D\u6570\u636E",UPLOAD_LIMIT:"\u6587\u6863 {documentName} \u8D85\u8FC715MB\uFF0C\u5BFC\u81F4\u65E0\u6CD5\u6B63\u5E38\u4FDD\u5B58\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u5BFC\u5165",MORE_THAN_LIMIT:"\u8D85\u8FC7\u6700\u5927\u9650\u5236",FILE_MORE_THAN_LIMIT:"\u8D85\u8FC7{type}\u6700\u5927\u4E0A\u4F20\u9650\u5236",PARAMS_MORE_THAN_LIMIT:"\u8D85\u8FC7\u53C2\u6570{type}\u7684\u6700\u5927\u4E0A\u4F20\u9650\u5236",IMAGE_MORE_THAN_LIMIT_PARAMS:"\u56FE\u7247\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236",FILE_MORE_THAN_LIMIT_PARAMS:"\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u4E0A\u4F20\u9650\u5236",END_MUST_AFTER_START:"\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u665A\u4E8E\u7ED3\u675F\u65F6\u95F4",FILE_READ_ONLY:"\u5DE5\u7A0B\u6587\u4EF6eprj\u6216\u5E93\u6587\u4EF6elib\u5C5E\u6027\u53D8\u4E3A\u53EA\u8BFB\uFF0C\u8BF7\u5728\u8D44\u6E90\u7BA1\u7406\u5668\u53D6\u6D88\u53EA\u8BFB\u540E\u518D\u8BD5\uFF0C\u5E76\u8054\u7CFB\u6280\u672F\u652F\u6301",FILE_READ_ONLY1:"\u5DE5\u7A0B\u6587\u4EF6eprj\u6216\u5E93\u6587\u4EF6elib\u5C5E\u6027\u53D8\u4E3A\u53EA\u8BFB\uFF0C\u8BF7\u5728\u8D44\u6E90\u7BA1\u7406\u5668\u53D6\u6D88\u53EA\u8BFB\u540E\u518D\u8BD5\uFF0C\u5E76\u8054\u7CFB\u6280\u672F\u652F\u6301",DATA_NOT_EXIST:"\u6587\u6863{documentName}\u4E0D\u5B58\u5728",REQUEST_PARAMS_TIME_ERROR:"\u65F6\u95F4\u8BF7\u6C42\u53C2\u6570\u9519\u8BEF",FILES_PATH_NOT_FOUND:"\u627E\u4E0D\u5230\u6587\u4EF6\u5730\u5740",FILES_DATA_NOT_FOUND:"\u627E\u4E0D\u5230\u6587\u4EF6\u6570\u636E",FILES_TYPE_ERROR:"\u6587\u4EF6\u7C7B\u578B\u9519\u8BEF",FILES_TYPE_MUST_BE_ONE:"\u6587\u4EF6\u7C7B\u578B\u5FC5\u987B\u4E3A{type}",SET_WATERMARK_FAIL:"\u6C34\u5370\u8BBE\u7F6E\u5931\u8D25",MYSQL_CRUD_ERROR:"{type}\u6570\u636E\u6267\u884C\u5931\u8D25, \u8BF7\u8054\u7CFB\u6280\u672F\u652F\u6301\u89E3\u51B3",PARAMS_JSON_FAILED:"{type}\u6570\u636E\u89E3\u6790\u5931\u8D25",MYSQL_ERROR:"\u6570\u636E\u5E93\u64CD\u4F5C\u5F02\u5E38",NOT_FOUND:"\u8BF7\u6C42\u4E0D\u5B58\u5728",PRJ_NAME_EXISTS:"\u5DE5\u7A0B\u540D\u79F0\u5DF2\u5B58\u5728",BACKUP_NAME_EXISTS:"\u5907\u4EFD\u540D\u79F0\u5DF2\u5B58\u5728",TITLE_ILLEGAL_LEN:"{documentName}\u957F\u5EA6\u5FC5\u987B\u4E3A1~128\u5B57\u7B26\u957F\u5EA6\uFF01",LIB_NOT_EXIST:"\u5143\u4EF6\u5E93\u4E0D\u5B58\u5728",CONFIG_API_URLS_ERROR:"\u5B9E\u65F6\u4EF7\u683C\u548C\u5E93\u5B58\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",ONE_CLICK_ORDER_NOT_OPEN:"\u4E00\u4EF6\u4E0B\u5355\u529F\u80FD\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",MATERIAL_NOT_OPEN:"\u7269\u6599\u5E93\u672A\u5F00\u542F, \u8BF7\u8054\u7CFB\u7BA1\u7406\u5458",SNAPSHOT_DEPTH_LIMIT:"\u6700\u65B0\u8282\u70B9\u9644\u8FD1\u5B58\u5728\u5FEB\u7167\u6216\u5FEB\u7167\u5DF2\u88AB\u7533\u8BF7",OCR_SYMBOL_URL_ERROR:"OCR\u8BF7\u6C42\u5730\u5740\u672A\u914D\u7F6E",USER_DATA_NOT_FOUND:"\u7528\u6237\u4E0D\u5B58\u5728",USER_DISABLE_ERROR:"\u8D26\u53F7\u5DF2\u505C\u7528",USER_EXISTS_LOGIN_ERROR:"\u7528\u6237\u5DF2\u5728\u522B\u7684\u5730\u65B9\u767B\u5F55",USER_UNAUTHORIZED_MODULES_ERROR:"\u8BE5\u8D26\u53F7\u672A\u6388\u6743\u6A21\u5757",USER_UNAUTHORIZED_ACCESS_ERROR:"\u8BBF\u95EE\u7C7B\u578B\u9519\u8BEF",ADMIN_NOT_CHANGE_PASSWORD:"\u8D85\u7EA7\u7BA1\u7406\u5458\u65E0\u6CD5\u91CD\u7F6E\u5BC6\u7801",SAME_PASSWORD_NEW_PASSWORD:"\u539F\u5BC6\u7801\u8DDF\u65B0\u5BC6\u7801\u76F8\u540C",USER_ONLINE_REGISTRATION_FAILED:"\u767B\u8BB0\u7528\u6237\u5728\u7EBF\u5931\u8D25",USER_PASSWORD_CAN_NOT_DEFAULT:"\u4E0D\u80FD\u4F7F\u7528\u9ED8\u8BA4\u5BC6\u7801",USER_BEFORE_PASSWORD_ERROR:"\u539F\u5BC6\u7801\u9519\u8BEF",USER_PASSWORD_LENGTH_ERROR:"\u5BC6\u7801\u957F\u5EA6\u4E3A8-255\u4F4D",ORG_ROLE_NOT_CREATE:"\u4E0D\u80FD\u521B\u5EFA\u7CFB\u7EDF\u89D2\u8272, \u8BF7\u4FEE\u6539",ORG_ROLE_NAME_DUPLICATE:"\u89D2\u8272\u540D\u79F0\u5DF2\u5B58\u5728, \u8BF7\u4FEE\u6539",ORG_ROLE_ORIGIN_ERROR:"\u672A\u77E5\u7684\u89D2\u8272\u6765\u6E90{message}",ORG_ROLE_NOT_DEFAULT:"\u8BE5\u89D2\u8272\u4E0D\u662F\u9884\u8BBE\u89D2\u8272, \u4E0D\u80FD\u64CD\u4F5C",ADMIN_ROLE_NOT_CHANGE:"\u7BA1\u7406\u5458\u6743\u9650\u4E0D\u5141\u8BB8\u4FEE\u6539",ADMIN_NOT_CHANGE_STATUS:"admin\u8D26\u53F7\u4E0D\u80FD\u66F4\u6539\u72B6\u6001",PROJECT_ARCHIVED:"\u5DE5\u7A0B\u5DF2\u88AB\u9501\u5B9A",PROJECT_UUID_NULL:"\u5DE5\u7A0Buuid\u4E0D\u80FD\u4E3A\u7A7A",PROJECT_UUID_ERROR:"uuid\u9519\u8BEF\u6216\u8005\u5DE5\u7A0Buuid\u5DF2\u5B58\u5728",PROJECT_OR_TEAM_UUID_ERROR:"\u5DE5\u7A0Buuid\u9519\u8BEF\u6216\u8005\u5DF2\u5B58\u5728\u56E2\u961Fuuid",PROJECT_NOT_PERSON_ERROR:"\u4E0D\u5141\u8BB8\u521B\u5EFA\u4E2A\u4EBA\u5DE5\u7A0B",PROJECT_DUPLICATE_NAME:"\u6807\u9898\u5DF2\u5B58\u5728",ANNOTATION_HAS_BE_FOUND:"\u6279\u6CE8\u5DF2\u521B\u5EFA",ANNOTATION_NOT_FOUND:"\u6279\u6CE8\u5757\u4E0D\u5B58\u5728",ANNOTATION_CREATE_ERROR:"\u6279\u6CE8\u5757\u521B\u5EFA\u5931\u8D25",ANNOTATION_UPDATE_ERROR:"\u66F4\u65B0\u6279\u6CE8\u5757\u5931\u8D25",ANNOTATION_DELETE_ERROR:"\u6279\u6CE8\u6761\u5220\u9664\u5931\u8D25",PROJECT_DUPLICATE_PATH:"\u4E0D\u80FD\u521B\u5EFA\u76F8\u540C\u7684\u8DEF\u5F84",TEAM_NOT_FOUND:"\u56E2\u961F\u4E0D\u5B58\u5728",TEAM_UUID_NULL:"\u56E2\u961Fuuid\u4E0D\u80FD\u4E3A\u7A7A",TEAM_FOLDER_ERROR:"\u7236\u6587\u4EF6\u5939\u4E0D\u5B58\u5728\u6216\u4E0D\u5C5E\u4E8E\u5F53\u524D\u56E2\u961F",TEAM_FOLDER_UUID_ERROR:"\u6587\u4EF6\u5939uuid\u9519\u8BEF\u6216\u8005\u5DE5\u7A0Buuid\u5DF2\u5B58\u5728",TEAM_URL_DUPLICATE:"\u56E2\u961F\u94FE\u63A5\u91CD\u590D",TEAM_CAN_NOT_DELETE:"\u56E2\u961F\u4ECD\u5B58\u5728\u5DE5\u7A0B, \u8BF7\u5148\u8F6C\u79FB\u6216\u8005\u5220\u9664",COMPONENT_UUID_NULL:"\u5143\u4EF6uuid\u4E0D\u80FD\u4E3A\u7A7A",COMPONENT_DATA_NOT_FOUND:"\u5143\u4EF6\u5E93\u6570\u636E\u4E0D\u5B58\u5728",COMPONENT_NAME_DUPLICATE:"\u5143\u4EF6\u5E93\u4E0D\u80FD\u91CD\u540D",COMPONENT_TYPE_ERROR:"\u5E93\u7C7B\u578B\u9519\u8BEF",DELETE_SON_CATEGORY:"\u9700\u8981\u5148\u5220\u9664\u5B50\u7C7B\u522B",LICENSE:"\u672A\u627E\u5230\u8BB8\u53EF\u8BC1",START_TIME:"\u8BB8\u53EF\u8BC1\u5F00\u59CB\u65F6\u95F4\u9519\u8BEF",END_TIME:"\u8BB8\u53EF\u8BC1\u7ED3\u675F\u65F6\u95F4\u9519\u8BEF",PROJECT_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u5DE5\u7A0B\u6570",USER_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u8D26\u53F7\u6570",ONLINE_NUMBER_LIMIT:"\u5DF2\u8FBE\u5230\u6700\u5927\u5728\u7EBF\u6570",LIMIT_PCB:"PCB\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",LIMIT_SCH:"\u539F\u7406\u56FE\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",LIMIT_PANEL:"\u9762\u677F\u6388\u6743\u6570\u5DF2\u6EE1, \u6DFB\u52A0\u5931\u8D25",TIME_ERROR:"\u7CFB\u7EDF\u65F6\u95F4\u9519\u8BEF\u8BF7\u91CD\u542F\u670D\u52A1\u5668\u6216\u4FEE\u590D\u7CFB\u7EDF\u65F6\u95F4, \u4FEE\u590D\u540E\u9700\u8981\u91CD\u542F\u79C1\u6709\u5316\u670D\u52A1",LICENSE_ERROR:"\u6388\u6743\u9519\u8BEF",LICENSE_TYPE_ERROR:"\u6388\u6743\u5E94\u7528\u7C7B\u578B\u9519\u8BEF",LICENSE_ORIGIN_ERROR:"\u672A\u77E5\u7684\u6388\u6743\u5E94\u7528{type}",BRANCH_DATA_NOT_FOUND:"\u5DE5\u7A0B\u5206\u652F\u4E0D\u5B58\u5728",PARENT_UUID_ERROR:"\u7236\u7EA7uuid\u9519\u8BEF",BRANCH_MUST_AFTER_NODE:"\u5206\u652F\u5FC5\u987B\u5728\u8282\u70B9\u540E",BRANCH_NAME_ERROR:"\u5206\u652F\u540D\u9519\u8BEF",BRANCH_NAME_DUPLICATE:"\u5206\u652F\u540D\u5DF2\u5B58\u5728",BRANCH_UUID_ERROR:"\u5206\u652Fuuid\u9519\u8BEF",BRANCH_NODE_SET_ERROR:"\u8282\u70B9\u4E0D\u80FD\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u5206\u652F\u6216\u6807\u8BB0\u4E3Amaster",BRANCH_DELETE_MAIN_ERROR:"\u4E0D\u80FD\u5220\u9664\u4E3B\u5206\u652F\u4E0A\u7684\u8282\u70B9\u6216\u5206\u652F",BRANCH_CHECK_OUT_ERROR:"\u5B58\u5728\u6587\u6863\u5DF2\u7B7E\u51FA",DOCUMENT_UUID_ERROR:"\u6587\u6863uuid\u9519\u8BEF",UPDATE_FAILED:"\u66F4\u65B0\u5931\u8D25",INNER_API_KEY_ERROR:"\u670D\u52A1\u7AEF\u5185\u90E8\u63A5\u53E3 ApiKey \u9519\u8BEF",BRANCH_MORE_THAN_LIMIT:"\u7248\u672C\u8D85\u8FC7\u6700\u5927\u9650\u5236",WORKSPACE_API_ERROR:"\u5DE5\u4F5C\u533A\u8BF7\u6C42\u54CD\u5E94\u5F02\u5E38"},zy={codeEN:TP,codeCN:wP},Pl,MO=(Pl=class{static load(){typeof zy=="object"&&(Pl.cache=zy)}static match(t,i,r){if(!this.cache||!this.cache[t])return;let s=this.cache[t][i];if(r&&Object.prototype.toString.call(r)==="[object Object]")for(let n in r){let a=r[n];s=s.replace(`{${n}}`,a)}return s}},Pl.cache={},Pl);function SP(){console.log("common init----------------"),MO.load()}var IP=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(IP||{});function js(e,t){throw new Error(`invalid format state on (${t}) of ${e}`)}function PP(e,...t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l);switch(r){case 0:h==="%"?r=1:i.push(h);break;case 1:switch(h){case"d":n=t[s++],typeof n=="number"?(i.push(n.toFixed(0)),r=0):js(e,l);break;case"f":n=t[s++],typeof n=="number"?(i.push(n.toString()),r=0):js(e,l);break;case"x":n=t[s++],typeof n=="number"?(i.push((n|0).toString(16)),r=0):js(e,l);break;case"X":n=t[s++],typeof n=="number"?(i.push((n|0).toString(16).toUpperCase()),r=0):js(e,l);break;case"s":case"c":n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case"0":a=l+1,o=-1,r=2;break;case"%":i.push("%"),r=0;break;default:js(e,l)}break;case 2:switch(h){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":o=l;break;case"d":if(o>=a){let c=parseInt(e.substring(a,o+1));n=t[s++],typeof n=="number"?(i.push((n|0).toString(10).padStart(c,"0")),r=0):js(e,l)}else js(e,l);break;case"x":if(o>=a){let c=parseInt(e.substring(a,o+1));n=t[s++],typeof n=="number"?(i.push((n|0).toString(16).padStart(c,"0")),r=0):js(e,l)}else js(e,l);break;case"X":if(o>=a){let c=parseInt(e.substring(a,o+1));n=t[s++],typeof n=="number"?(i.push((n|0).toString(16).toUpperCase().padStart(c,"0")),r=0):js(e,l)}else js(e,l);break;default:js(e,l)}break;default:js(e,l)}}return i.join("")}function Y2(e){let t="";try{let i=/.*\\(.*)$/.exec(e);i&&i[1]&&typeof i[1]=="string"&&(t=i[1])}catch(i){console.error("Query Folder Name Error:",i)}return t}function V2(e,t){let i=Math.max(e.length,t.length);for(let r=0;r<i;r++){let s=e[r],n=t[r],a=0;if(typeof s=="string"&&typeof n=="string")a=s.localeCompare(n);else if(typeof s=="number"&&typeof n=="number")a=s-n;else{if(typeof s=="number"&&typeof n=="string")return-1;if(typeof s=="string"&&typeof n=="number")return 1;if(s===void 0&&n!==void 0)return-1;if(s!==void 0&&n===void 0)return 1}if(a!==0)return a}return 0}function BO(e){let t=/\d+/g,i=new Array,r=0;for(;;){let s=t.exec(e);if(s)r<s.index&&i.push(e.substring(r,s.index)),r=s.index+s[0].length,i.push(parseInt(s[0]));else break}return i.push(e),i}function AP(e,t,i,r){var h,c;let s=[],n=[],a=[];for(let f=0,d=e.length;f<d;f++){s[f]=f;let u;if(Array.isArray(t)){let p="";for(let _=0;_<t.length;_++)if(Object.hasOwnProperty.call(e[f],t[_])){p=e[f][t[_]];break}}else u=t?e[f][t]||((c=(h=e[f])==null?void 0:h[r])==null?void 0:c[t])||"":e[f];if(n[f]=String(u).toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),a[f]=[],n[f])for(let p=0;p<n[f].length;p++)a[f][p]=n[f][p].match(/\d/)?1:2}let o=function(f,d){let u=n[f],p=n[d],_=a[f],g=a[d];if(!u||!p)return i?u==p?0:u?-1:1:u==p?0:u?1:-1;let b=Math.max(u.length,p.length);for(let m=0;m<b;m++){if(i)if(u[m])if(p[m]){if(u[m]!=p[m])return _[m]!=g[m]?_[m]==1?1:-1:_[m]==1?p[m]-u[m]:u[m]<p[m]?1:-1}else return-1;else return 1;if(u[m])if(p[m]){if(u[m]!=p[m])return _[m]!=g[m]?_[m]==1?-1:1:_[m]==1?u[m]-p[m]:u[m]<p[m]?-1:1}else return 1;else return-1}return 0};s.sort(o);let l=[];for(let f=0;f<e.length;f++)l[f]=e[s[f]];return l}function CP(e,t,i){let r=[],s=[],n=[],a=[e,t];for(let o=0,l=a.length;o<l;o++){r[o]=o;let h=a[o];if(s[o]=String(h).toUpperCase().match(/\D+|\d+(?:\.\d+)?/g),n[o]=[],s[o])for(let c=0;c<s[o].length;c++)n[o][c]=s[o][c].match(/\d/)?1:2}return(function(o,l){let h=s[o],c=s[l],f=n[o],d=n[l];if(!h||!c)return i?h==c?0:h?-1:1:h==c?0:h?1:-1;let u=Math.max(h.length,c.length);for(let p=0;p<u;p++){if(i)if(h[p])if(c[p]){if(h[p]!=c[p])return f[p]!=d[p]?f[p]==1?1:-1:f[p]==1?c[p]-h[p]:h[p]<c[p]?1:-1}else return-1;else return 1;if(h[p])if(c[p]){if(h[p]!=c[p])return f[p]!=d[p]?f[p]==1?-1:1:f[p]==1?h[p]-c[p]:h[p]<c[p]?-1:1}else return 1;else return-1}return 0})(r[0],r[1])}function xp(e,t){let i=!1;for(let r in t)if(Object.hasOwnProperty.call(t,r)&&e.indexOf(r)!==-1){i=!0;break}return i}function NP(e,t=""){return e.sort((r,s)=>V2(BO(i(r)),BO(i(s)))),e;function i(r){if(!r)return r;let s;if(Array.isArray(t)){let n="";for(let a=0;a<t.length;a++)if(Object.hasOwnProperty.call(r,t[a])){n=r[t[a]];break}}else s=r[t]||r;return s}}function LP(e,t,i=1){var o,l,h,c;let r=(o=e.match(/^\D+/))==null?void 0:o[0],s=(l=e.match(/\d+$/))==null?void 0:l[0],n=(h=t.match(/^\D+/))==null?void 0:h[0],a=(c=t.match(/\d+$/))==null?void 0:c[0];return r&&n?r!==n?i===1?r.localeCompare(n):n.localeCompare(r):s!==a?+s>+a?1*i:-1*i:0:r?-1*i:n?1*i:0}function RP(e){return new Promise(t=>{setTimeout(t,e)})}var Sq=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").map(e=>e.charCodeAt(0));function DP(){try{if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis}catch{return null}}function Ms(){return self.EDITOR_TOP||self}function MP(e,t,i){t=t||1,i=i||32;var r="",s=t,n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(s=Math.round(Math.random()*(i-t))+t);for(var a=0;a<s;a++){let o=Math.round(Math.random()*(n.length-1));r+=n[o]}return r}function BP(e){try{return JSON.parse(e)}catch{return console.error(`ParseJSON failed:
`+e),null}}var kP=(e=>(e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DUMMY=5]="DUMMY",e))(kP||{}),UP=(e,t)=>{switch(e){case 4:console.error(...t);break;case 3:console.warn(...t);break;case 2:console.info(...t);break;default:console.log(...t)}},FP=(e,t)=>t,GP=class uu{constructor(t,i=UP,r=FP){this.level=t,this.writer=i,this.formatter=r}wrap(t){return new uu(this.level,this.writer,(i,r)=>(r=this.formatter(i,r),t(i,r)))}inject(t){return new uu(this.level,this.writer,(i,r)=>(r=t(i,r),this.formatter(i,r)))}shadow(...t){return new uu(this.level,(i,r)=>{this.writer(i,r);for(let s of t)s(i,r)},this.formatter)}mix(...t){return new uu(0,(i,r)=>{this.process(i,r);for(let s of t)s.process(i,r)},(i,r)=>r)}process(t,i){this.level<=t&&this.writer(t,this.formatter(t,i))}process1(t,i,r){this.level<=t&&this.writer(t,this.formatter(t,[PP(i,...r)]))}trace(...t){this.process(0,t)}trace1(t,...i){this.process1(0,t,i)}debug(...t){this.process(1,t)}debug1(t,...i){this.process1(1,t,i)}info(...t){this.process(2,t)}info1(t,...i){this.process1(2,t,i)}warn(...t){this.process(3,t)}warn1(t,...i){this.process1(3,t,i)}error(...t){this.process(4,t)}error1(t,...i){this.process1(4,t,i)}},Iq=new GP(5),Pq=Date.now()-performance.now(),q2=new ArrayBuffer(10),Aq=new Float64Array(q2,0,1),Cq=new Uint8Array(q2);var zP={};vP(zP,{HAS_PANEL:()=>oA,HAS_PCB:()=>aA,HAS_SCH:()=>nA,IS_CLIENT:()=>Sn,IS_CLIENT_HALF_OFFLINE:()=>ip,IS_CLIENT_NOT_ONLINE:()=>lm,IS_CLIENT_OFFLINE:()=>eA,IS_CLIENT_ONLINE:()=>rp,IS_DEV:()=>VP,IS_EASYEDA:()=>W2,IS_EASYEDA_CLIENT:()=>QP,IS_ECAD:()=>qP,IS_HALF_OFFLINE:()=>Tp,IS_LCEDA:()=>X2,IS_LCEDA_CLIENT:()=>$P,IS_OFFLINE:()=>wp,IS_ONLINE:()=>Ep,IS_PCBLUXSHARE:()=>XP,IS_PRIVATE:()=>vp,PRO_EDITOR_MODE:()=>tA,PRO_EDITOR_MODES:()=>Hr,SSO_EXTERNAL_IDENTITY_DOMAIN:()=>JP,SSO_EXTERNAL_PERMISSION_DOMAIN:()=>ZP,SSO_EXTERNAL_PERMISSION_MANAGED_DOMAIN:()=>KP,SSO_IDENTITY_CONNECT:()=>WP});var HP=(e=>(e.ruler="ruler",e.un_ruler="un_ruler",e))(HP||{}),jP=(e=>(e[e.HOME=-1]="HOME",e[e.BLANKTAB=0]="BLANKTAB",e[e.SCH=1]="SCH",e[e.PART=2]="PART",e[e.PCB=3]="PCB",e[e.FOOTPRINT=4]="FOOTPRINT",e[e.PRJ=5]="PRJ",e[e.SUBPART=6]="SUBPART",e[e.NGSPICE_MODEL=7]="NGSPICE_MODEL",e[e.NGSPICE=8]="NGSPICE",e[e.SIMULIDE=9]="SIMULIDE",e[e.WAVEFORM=10]="WAVEFORM",e[e.SCHLIB3D=11]="SCHLIB3D",e[e.PHOTOVIEW=12]="PHOTOVIEW",e[e.SCHMODULE=13]="SCHMODULE",e[e.PCBMODULE=14]="PCBMODULE",e[e.VIEW3D=15]="VIEW3D",e[e.PCBLIB3D=16]="PCBLIB3D",e[e.BLOCK_SYMBOL=17]="BLOCK_SYMBOL",e[e.NETFLAG=18]="NETFLAG",e[e.NETPORT=19]="NETPORT",e[e.SHEET_SYMBOL=20]="SHEET_SYMBOL",e[e.NONEELEC_SYMBOL=21]="NONEELEC_SYMBOL",e[e.SHORT_SYMBOL=22]="SHORT_SYMBOL",e[e.FOOTPRINTVIEW=23]="FOOTPRINTVIEW",e[e.CNCPRINTVIEW=24]="CNCPRINTVIEW",e[e.OFF_PAGE_CONNECTOR=25]="OFF_PAGE_CONNECTOR",e[e.PANEL=26]="PANEL",e[e.PANEL3D=27]="PANEL3D",e[e.DEVICE=28]="DEVICE",e[e.PANEL_LIB=29]="PANEL_LIB",e[e.ASSEMBLY_VARIANT=30]="ASSEMBLY_VARIANT",e[e.DIFF_PAIRS_FLAG=31]="DIFF_PAIRS_FLAG",e[e.SIMULIDE_MODEL=32]="SIMULIDE_MODEL",e))(jP||{}),YP=(e=>(e.SCH="SCH",e.PCB="PCB",e.PANEL="PANEL",e))(YP||{}),hO=DP(),Hr=String((hO==null?void 0:hO.PRO_EDITOR_MODE)||"LCEDA").split("-"),VP=Hr.indexOf("DEVPRO")>=0,Sn=Hr.indexOf("CLIENT")>=0,X2=Hr.indexOf("LCEDA")>=0,W2=Hr.indexOf("EASYEDA")>=0,vp=Hr.indexOf("PRIVATE")>=0,Ep=Hr.indexOf("ONLINE")>=0,Tp=Hr.indexOf("HALF_OFFLINE")>=0,wp=Hr.indexOf("OFFLINE")>=0,qP=Hr.indexOf("ECAD")>=0,XP=Hr.indexOf("PCB_LUXSHARE")>=0,WP=Hr.indexOf("SSO_IDENTITY_CONNECT")>=0,JP=Hr.indexOf("SSO_EXTERNAL_IDENTITY_DOMAIN")>=0,ZP=Hr.indexOf("SSO_EXTERNAL_PERMISSION_DOMAIN")>=0,KP=Hr.indexOf("SSO_EXTERNAL_PERMISSION_MANAGED_DOMAIN")>=0,$P=Sn&&X2,QP=Sn&&W2,ip=Sn&&Tp,lm=Sn&&!Ep,eA=Sn&&wp,rp=Sn&&Ep,tA=Sn?Ep?"ONLINE":Tp?"HALF_OFFLINE":wp?"OFFLINE":"":"",iA=Hr.indexOf("SCH")>=0,rA=Hr.indexOf("PCB")>=0,sA=Hr.indexOf("PANEL")>=0,nA=iA,aA=rA,oA=sA,lA=(e=>(e.PROJECT_BACKUPS_MANUAL="Backup Project Manually",e.PROJECT_BACKUPS_AUTO="Backup Project Automatically",e.DELETE_BACKUPS="Delete Backup",e.SAVE="Save",e.CREATE_SHEET="New Page",e.DELETE_SHEET="Delete Page",e.RENAME_SHEET="Rename Page",e.SIGNED_SHEET="Check Out Page",e.SIGNIN_SHEET="Check In Page",e.CLEAR_SIGNED="Clear Check Out",e.PROJECT_LOCK="Lock Project",e.PROJECT_UNLOCK="Unlock Project",e.PROJECT_OPEN="Open Project",e.PROJECT_CLOSE="Close Project",e.DOCUMENT_PASTE="Paste Document",e.DOCUMENT_PASTE_ACROSS_PROJECT="Paste Document Across Projects",e.SCHEMATIC_PASTE="Paste Schematic",e.SCHEMATIC_PASTE_ACROSS_PROJECT="Paste Schematic Across Projects",e.PRIMITIVE_PASTE_ACROSS_PROJECT="Paste Elements Across Projects",e.PROJECT_SAVEAS_REMOTE="Save Project to Cloud",e.PROJECT_SAVEAS_LOCAL="Save Project to Local",e.LIBRARY_SAVEAS_LOCAL="Save Library to Local",e.DOCUMENT_SAVEAS_REMOTE="Save Document to Cloud",e.DOCUMENT_SAVEAS_LOCAL="Save Document to Local",e.CBB_SAVEAS_REMOTE="Save Reuse Module to Cloud",e.CBB_SAVEAS_LOCAL="Save Reuse Module to Local",e.SVG_EXPORT="Export SVG",e.PNG_EXPORT="Export PNG",e.PDF_EXPORT="Export PDF",e.BOM_EXPORT="Export BOM",e.PRINT="Print",e.GERBER_EXPORT="Export Gerber",e.COORDINATE_EXPORT="Export Pick and Place File",e.D3FILE_EXPORT="Export 3D File",e.D3SHELLFILE_EXPORT="Export 3D Shell File",e.TESTPOINT_REPORT_EXPORT="Export Test Point Report",e.DXF_EXPORT="Export DXF",e.ODBPLUSS_EXPORT="Export ODB++",e.AD_EXPORT="Export Altium Designer",e.DEVICE_REPLACE="Replace Device",e.FOOTPRINT_REPLACE="Replace Footprint",e.D3MODEL_REPLACE="Replace 3D Model",e.PROJECTLIB_UPDATE="Update Project Library",e.REPLACE="Find and Replace",e.TRACK_BATCH_RENAME="Rename Wires in Batch",e.SHEET_BATCH_RENAME="Rename Pages in Batch",e.NET_CREATED_AUTO="Automatic Network Generation",e.DESIGNATOR_ALLOCATION="Annotate Designator",e.UNIQUE_ID_RESET="Reset Unique ID",e.NET_TABLE_EXPORT="Export Netlist",e.REFRESH_PCB_BY_SCH="Update Schematic to PCB",e.REFRESH_SCH_BY_PCB="Update PCB to Schematic",e.CLEAR_DESIGNATOR="Clear Designator",e.UPDATE_PORT_BY_MODULE_SYMBOL="Update Ports from Module Symbol",e.DESIGN_RULE="Set Design Rules",e.NET_CLASS="Set Network Class",e.EQUAL_LENGTH_GROUP="Set Equal Length Group",e.DIFFERENTIAL_PAIR="Set Differential Pair",e))(lA||{}),Fr,Nq=(Fr=class{constructor(t,i=crypto.randomUUID()){this.fileName=t,this.uuid=i,this._params=new URLSearchParams,this._aTarget=document.createElement("a"),this._params.append("uuid",i),this._params.append("fileName",t)}static get URL_VERSION(){var t;try{let i=location.host,r="/";return((t=new RegExp(`${i}(/[\\w|.]+)${r}`).exec(location.href))==null?void 0:t[1])||""}catch{return""}}static getOpenedStream(t){return this._openedInstances.get(t)}get createURL(){return`${Fr.CREATE_URL}?${this._params}`}get writeURL(){return`${Fr.WRITE_URL}?${this._params}`}get closeURL(){return`${Fr.CLOSE_URL}?${this._params}`}get cancelURL(){return`${Fr.CANCEL_URL}?${this._params}`}async create(){this._aTarget.href=this.createURL,this._aTarget.click(),this._aTarget.remove(),Fr._openedInstances.set(this.uuid,this),await RP(100)}async write(t){await(await fetch(this.writeURL,{method:"post",body:t})).json()}async close(){await fetch(this.closeURL,{method:"post"}),Fr._openedInstances.delete(this.uuid)}async cancel(){await fetch(this.cancelURL,{method:"post"}),Fr._openedInstances.delete(this.uuid)}},Fr.CREATE_URL=`${Fr.URL_VERSION}/sw/download/stream/create`,Fr.WRITE_URL="/sw/download/stream/write",Fr.CLOSE_URL="/sw/download/stream/close",Fr.CANCEL_URL="/sw/download/stream/cancel",Fr._openedInstances=new Map,Fr);var hA=Object.create,J2=Object.defineProperty,cA=Object.getOwnPropertyDescriptor,uA=Object.getOwnPropertyNames,dA=Object.getPrototypeOf,fA=Object.prototype.hasOwnProperty,pA=(e=>typeof dh<"u"?dh:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof dh<"u"?dh:t)[i]}):e)(function(e){if(typeof dh<"u")return dh.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),kt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),_A=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of uA(t))!fA.call(e,s)&&s!==i&&J2(e,s,{get:()=>t[s],enumerable:!(r=cA(t,s))||r.enumerable});return e},Gh=(e,t,i)=>(i=e!=null?hA(dA(e)):{},_A(t||!e||!e.__esModule?J2(i,"default",{value:e,enumerable:!0}):i,e)),Mu=kt((e,t)=>{"use strict";var i=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(T,k)=>{for(var A in k)i(T,A,{get:k[A],enumerable:!0})},o=(T,k,A,F)=>{if(k&&typeof k=="object"||typeof k=="function")for(let V of s(k))!n.call(T,V)&&V!==A&&i(T,V,{get:()=>k[V],enumerable:!(F=r(k,V))||F.enumerable});return T},l=T=>o(i({},"__esModule",{value:!0}),T),h={};a(h,{BroadcastChannelMessageBus:()=>Je,MessageBus:()=>J,MessageBus2:()=>Pe,MessageBusTask:()=>ve,MessageBusTask2:()=>Ce,WindowMessageBridge:()=>_e,WorkerMessageBridge:()=>he,createBroadcastP2PStream:()=>mi,createBufferedByteBufferStream:()=>si,createBufferedStream:()=>ct,createBufferedStringStream:()=>ut,dropP2PStream:()=>It,flowRead:()=>ni,flowWrite:()=>Ai}),t.exports=l(h);var c=class{constructor(T=1.5){this.growthFactor=T,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(T){if(this.count===this.capacity){let k=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,k);let A=new Array(k);for(let F=0;F<this.count;F++)A[F]=this.buffer[(this.head+F)%this.capacity];this.buffer=A,this.head=0,this.tail=this.count,this.capacity=k}this.buffer[this.tail]=T,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let T=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,T}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},f=new ArrayBuffer(8),d=new Float64Array(f),u=new Uint32Array(f),p=new Uint16Array(f),_=ArrayBuffer;try{_=self.HTMLImageElement||_}catch{}var g=typeof SharedArrayBuffer<"u";function b(T){if(typeof T!="object"||T===null||T instanceof Date||T instanceof ArrayBuffer||g&&T instanceof SharedArrayBuffer||T instanceof Blob||T instanceof FormData||T instanceof Function||T instanceof Uint8ClampedArray||T instanceof _)return T;if(Array.isArray(T))return T.map(b);{let k={};for(let A in T)Object.hasOwnProperty.call(T,A)&&(k[A]=b(T[A]));return k}}function m(T,k){return O(T,k,()=>[])}function O(T,k,A){let F=T[k];return F!==void 0||(F=A(k),T[k]=F),F}function y(T,k){if(Array.isArray(T)){for(let A=0,F=T.length;A<F;A++)if(k(void 0,T[A],A)===!1)return}else{let A=0;for(let F in T)if(T.hasOwnProperty(F)){let V=T[F];if(k(F,V,A)===!1)return;A++}}}var x=Object.prototype.hasOwnProperty;async function E(T,k){if(Array.isArray(T)){for(let A=0,F=T.length;A<F;A++)if(await k(void 0,T[A],A)===!1)return}else{let A=0;for(let F in T)if(x.call(T,F)){let V=T[F];if(await k(F,V,A)===!1)return;A++}}}function w(T,k,A){return typeof T=="string"&&(/https?:/.test(T)||(T=location.origin+T)),Promise.race([fetch(T,k),new Promise((F,V)=>setTimeout(V,A))])}function S(T,k){let A=0,F=0;return(...V)=>{let Q=++A;setTimeout(()=>{let W=performance.now();if(Q===A||W-F>=T){try{k(...V)}catch(ne){console.log(ne)}F=W}},Math.max(0,T-(performance.now()-F)))}}function C(T,k){let A=T.length,F=0;for(;F<A;){let V=T.indexOf(`
`,F);V<0&&(V=A);let Q=T.substring(F,V);try{if(k(Q)===!1)return}catch(W){console.error(W)}F=V+1}}function R(T){let k=null;return()=>(k===null&&(k=T()),k)}var B=0;function Y(){B===0&&(B=Date.now()-performance.now());let T=new Array,k=B+performance.now();d[0]=k,T.push(u[1].toString(16)),d[0]=Math.random(),T.push(p[3].toString(16));let A=p[2].toString(16);T.push("4"+A.substr(0,3)),d[0]=k;let F=u[0].toString(16)+u[1].toString(16);return T.push("0"+F.substr(0,3)),T.push(F.substr(3)),T.join("-")}var G=class{constructor(T){this.maxResources=T,this.idle=new c,this.isClosed=!1,this.resources=T}acquire(T){this.isClosed?Promise.resolve(!1).then(T):this.resources>0?(this.resources--,Promise.resolve(!0).then(T)):this.idle.enqueue(T)}acquireSync(){return new Promise(T=>{this.acquire(T)})}release(){if(!this.isClosed){let T=this.idle.dequeue();T?Promise.resolve(!0).then(T):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let T=this.idle.dequeue();Promise.resolve(!1).then(T)}}};function z(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function q(T,k,A){let F=T.length+k-1;for(let V=0;V<F;V++){let Q=new Array;for(let W=V-k+1;W<=V;W++)Q.push(T[W]);if(A(Q)===!1)break}}function L(){let T=new Date,k=T.getFullYear(),A=T.getMonth()+1,F=T.getDate(),V=T.getHours(),Q=T.getMinutes(),W=T.getSeconds(),ne=T.getMilliseconds();return"["+k+"-"+(A<10?"0"+A:A)+"-"+(F<10?"0"+F:F)+" "+(V<10?"0"+V:V)+":"+(Q<10?"0"+Q:Q)+":"+(W<10?"0"+W:W)+"."+(ne<100?ne<10?"00"+ne:"0"+ne:ne)+"] "}function M(T){return new Promise(k=>setTimeout(k,T))}function v(T,k){let A=0,F=T.length;for(let V=0;V<F;V++)T[V]===k&&(T.splice(V,1),V--,F--,A++);return A}var P=z(),I=P.WeakRef||(T=>T);function N(T){if(T!=null){if(typeof T=="object")return new I(T);console.error(T,T instanceof Object,typeof T);return}}function D(T){return T==null?void 0:T.deref()}var j="_MSG_BUS_RPC_",H=300*1e3,K=(T=>(T.PUBLISH="publish",T.SUBSCRIBE="subscribe",T.PUSH="push",T.PULL="pull",T))(K||{}),se=class{constructor(T){this.bus=T}processRemoteMessage(T,k){let A=N(k),F=T.topic,V=T.type,Q=T.message;switch(V){case"pull":this.bus.pull(F,W=>{this.push(F,W,D(A))});break;case"subscribe":this.bus.subscribe(F,W=>{this.publish(F,W,D(A))});break;case"publish":this.bus.publish(F,Q,this,D(A));break;case"push":this.bus.push(F,Q,this,D(A));break;default:console.debug("unknown message type "+V)}}rpcCall(T,k,A,F=H){let V=N(A),Q=new Promise(W=>{let ne=this.bus.uniqueRpcTopic(T);this.publish(T,{message:k,reply:ne},D(V)),this.bus.pull(ne,(X,Ee,Me)=>{W({message:X,bridge:Ee,source:N(Me)})})});return F>0?Promise.race([Q,new Promise((W,ne)=>{setTimeout(ne,F)})]):Q}},he=class extends se{constructor(T,k){super(T),this.worker=k,k.onmessage=A=>{this.processRemoteMessage(A.data,void 0)}}publish(T,k){this.postMessage(T,"publish",k)}subscribe(T){this.postMessage(T,"subscribe",null)}push(T,k){this.postMessage(T,"push",k)}pull(T){this.postMessage(T,"pull",null)}rpcCall(T,k,A=H){return super.rpcCall(T,k,void 0,A)}postMessage(T,k,A){let F={topic:T,type:k,message:A};this.worker.postMessage(F)}discard(){this.worker.terminate()}},_e=class extends se{constructor(T){super(T),window.addEventListener("message",k=>{this.processRemoteMessage(k.data,k.source)},!1)}publish(T,k,A){this.postMessage(T,"publish",k,A)}subscribe(T,k){if(k===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(T,"subscribe",null,k)}push(T,k,A){this.postMessage(T,"push",k,A)}pull(T,k){if(k===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(T,"pull",null,k)}postMessage(T,k,A,F){let V={topic:T,type:k,message:A};F&&F.postMessage(V,"*")}},ve=class{constructor(T){this.isRunning=!0,this.callback=T}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(T,k,A,F){try{T=F?T:b(T),this.callback(T,k,A)}catch(V){console.error(V)}}},J=class{constructor(T=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=T}uniqueRpcTopic(T){return`${j}-${T}-${this.uuid}-${this.rpcTicket++}`}publish(T,k,A,F){let V=this.subscribed[T];if(V){let Q;for(let W of V)W.running()?W.execute(k,A,F,this.unsafe):(Q=Q||new Array,Q.push(W));if(Q)for(let W of Q)v(V,W)}else console.debug("no sub on topic: "+T)}subscribe(T,k){let A=new ve(k);return m(this.subscribed,T).push(A),A}push(T,k,A,F){let V=!1,Q=this.pulled[T];if(Q){for(;Q.length>0;){let W=Q.shift();if(W.running()){W.execute(k,A,F,this.unsafe),V=!0;break}}Q.length===0&&delete this.pulled[T]}V||m(this.pushed,T).push({message:k,bridge:A,source:N(F)})}pull(T,k){let A=new ve(k),F=this.pushed[T];if(F){let V=F.shift();A.execute(V.message,V.bridge,D(V.source),this.unsafe),F.length===0&&delete this.pushed[T]}else m(this.pulled,T).push(A);return A}pullA(T){return new Promise(k=>{this.pull(T,(A,F,V)=>{k({message:A,bridge:F,source:N(V)})})})}rpcService(T,k){this.subscribe(T,(A,F,V)=>{let{message:Q,reply:W}=A;try{let ne=k(Q);if(ne instanceof Promise){let X=N(V);ne.then(Ee=>{this.rpcReply(Ee,W,F,D(X))},Ee=>{console.error(Ee),this.rpcReply(void 0,W,F,D(X))})}else this.rpcReply(ne,W,F,V)}catch(ne){console.error(ne),this.rpcReply(void 0,W,F,V)}})}rpcCall(T,k,A=H){let F=new Promise(V=>{let Q=this.uniqueRpcTopic(T);this.publish(T,{message:k,reply:Q}),this.pull(Q,(W,ne,X)=>{V({message:W,bridge:ne,source:N(X)})})});return A>0?Promise.race([F,new Promise((V,Q)=>{setTimeout(Q,A)})]):F}rpcReply(T,k,A,F){A?A.push(k,T,F):this.push(k,T)}},Z="_MSG_BUS_RPC_";function re(T,k){let A=0,F=T.length;for(let V=0;V<F;V++)T[V]===k&&(T.splice(V,1),V--,F--,A++);return A}function ue(T,k){return Le(T,k,()=>[])}function Le(T,k,A){let F=T[k];return F!==void 0||(F=A(k),T[k]=F),F}var Ce=class{constructor(T,k){this.callback=T,this.unsafe=k,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(T){try{T=this.unsafe?T:b(T),this.callback(T)}catch(k){console.error(k)}}},De=class{constructor(T=crypto.randomUUID()){this.uuid=T,this.rpcTicket=0}subscribeOnce(T,k){let A=this.subscribe(T,F=>{A.cancel(),k(F)});return A}pullA(T){return new Promise(k=>{this.pull(T,k)})}rpcService(T,k){let A=F=>{try{let{message:V,replyTopic:Q}=F;try{let W=k(V);W instanceof Promise?W.then(ne=>{this.publish(Q,{success:!0,result:ne})}).catch(ne=>{console.error(ne),this.publish(Q,{success:!1,err:String(ne)})}):this.publish(Q,{success:!0,result:W})}catch(W){this.publish(Q,{success:!1,err:String(W)})}}finally{this.pull(T,A)}};this.pull(T,A)}rpcCall(T,k,A=0){let F=new Promise((V,Q)=>{let W=`${Z}-${T}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(W,ne=>{ne.success?V(ne.result):Q(new Error(ne.err))}),this.push(T,{message:k,replyTopic:W})});return A>0?Promise.race([F,new Promise((V,Q)=>{setTimeout(Q,A)})]):F}},Pe=class extends De{constructor(T=!1){super(),this.unsafe=T,this.subscribed={},this.pulled={},this.pushed={}}publish(T,k){let A=this.subscribed[T];if(A){let F;for(let V of A)V.running()?V.execute(k):(F=F||new Array,F.push(V));if(F)for(let V of F)re(A,V)}}subscribe(T,k){let A=new Ce(k,this.unsafe);return ue(this.subscribed,T).push(A),A}push(T,k){let A=!1,F=this.pulled[T];if(F){for(;F.length>0;){let V=F.shift();if(V&&V.running()){V.execute(k),A=!0;break}}F.length===0&&delete this.pulled[T]}A||ue(this.pushed,T).push(k)}pull(T,k){let A=new Ce(k,this.unsafe);return this.repull(T,A),A}repull(T,k){let A=this.pushed[T];if(A){let F=A.shift();F&&(k.execute(F),A.length===0&&delete this.pushed[T])}else ue(this.pulled,T).push(k)}},Ie=class extends De{constructor(T=crypto.randomUUID()){super(T),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(T,k){console.debug("BC",this.uuid,"PUBLISH",T,k),this.broadcastPublish(T,k)}subscribe(T,k){console.debug("BC",this.uuid,"SUBSCRIBE",T);let A=new Ce(k,!0);return ue(this.subscribed,T).push(A),A}push(T,k){let A=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",T,`(${A})`,k),ue(this.pushed,T).push({id:A,message:k}),this.broadcastPushedHeadMessage(T)}pull(T,k){console.debug("BC",this.uuid,"PULL",T);let A=new Ce(k,!0);return ue(this.pulled,T).push(A),this.broadcastWhoHas(T),A}broadcastPushedHeadMessage(T){let k=this.pushed[T];k&&k[0]&&this.broadcastIHave(T,k[0].id)}onReceivedPublish(T,k,A){console.debug("BCMSG(",this.uuid,")","from",T,"PUBLISH",k,"message",A);let F=this.subscribed[k];if(F){let V;for(let Q of F)Q.running()?Q.execute(A):(V=V||new Array,V.push(Q));if(V)for(let Q of V)re(F,Q);F.length===0&&delete this.subscribed[k]}}onReceivedWhoHas(T,k){console.debug("BCMSG(",this.uuid,")","from",T,"WHOHAS",k),this.broadcastPushedHeadMessage(k)}onReceivedIHave(T,k,A){console.debug("BCMSG(",this.uuid,")","from",T,"IHAVE",k,"id",A);let F=this.pulled[k];if(F){let V;for(let Q of F)if(Q.running()){this.broadcastINeed(k,T,A);break}else V=V||new Array,V.push(Q);if(V)for(let Q of V)re(F,Q);F.length===0&&delete this.pulled[k]}}onReceivedINeed(T,k,A,F){if(console.debug("BCMSG(",this.uuid,")","from",T,"INEED",k,"source",A,"id",F),this.uuid===A){let V=this.pushed[k];if(V&&V[0]&&V[0].id===F){let{message:Q}=V.shift();this.broadcastIGive(k,F,T,Q),this.broadcastPushedHeadMessage(k),V.length===0&&delete this.pushed[k]}}}onReceivedIGive(T,k,A,F,V){console.debug("BCMSG(",this.uuid,")","from",T,"IGIVE",k,"id",A,"target",F,"message",V);let Q=this.pulled[k];if(Q&&this.uuid===F){let W=!1;for(;Q.length>0;){let ne=Q.shift();if(ne.running()){ne.execute(V),W=!0;break}}W||this.push(k,V),Q.length===0&&delete this.pulled[k]}}},Je=class extends Ie{constructor(T,k=crypto.randomUUID()){super(k),this.bc=new BroadcastChannel(T),this.bc.onmessage=A=>{this.onMessage(A.data)}}onMessage(T){let{type:k,uuid:A,topic:F}=T;switch(k){case"PUBLISH":{let{message:V}=T;this.onReceivedPublish(A,F,V);break}case"WHOHAS":{this.onReceivedWhoHas(A,F);break}case"IHAVE":{let{id:V}=T;this.onReceivedIHave(A,F,V);break}case"INEED":{let{source:V,id:Q}=T;this.onReceivedINeed(A,F,V,Q);break}case"IGIVE":{let{target:V,id:Q,message:W}=T;this.onReceivedIGive(A,F,Q,V,W);break}default:console.warn("unsupported",T)}}broadcastPublish(T,k){this.post({type:"PUBLISH",uuid:this.uuid,topic:T,message:k})}broadcastWhoHas(T){this.post({type:"WHOHAS",uuid:this.uuid,topic:T})}broadcastIHave(T,k){this.post({type:"IHAVE",uuid:this.uuid,topic:T,id:k})}broadcastINeed(T,k,A){this.post({type:"INEED",uuid:this.uuid,topic:T,source:k,id:A})}broadcastIGive(T,k,A,F){this.post({type:"IGIVE",uuid:this.uuid,topic:T,id:k,target:A,message:F})}post(T){this.bc.postMessage(T),Promise.resolve().then(()=>{this.onMessage(T)})}},$e=Symbol("BLOCKING_QUEUE_RESET"),pt=class{constructor(T,k=()=>1){if(this.maxSize=T,this.itemSizeOf=k,this.queue=new c,this.waitingConsumers=new c,this.waitingProducers=new c,this.queueSize=0,this.closePromise=null,this.closeResolve=null,T<=0)throw new Error("Max size must be greater than 0")}enqueue(T){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let k=await new Promise(A=>{this.waitingProducers.enqueue(A)});return console.debug("queue is not full",this.size(),k),k?(this.innerEnqueue(T),!0):!1})():(this.innerEnqueue(T),!0)}innerEnqueue(T){if(this.waitingConsumers.isEmpty())this.queue.enqueue(T),this.queueSize+=this.itemSizeOf(T),console.debug("queue pushed",T,"size",this.queueSize);else{let k=this.waitingConsumers.dequeue();Promise.resolve(T).then(k),console.debug("queue direct",T,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let T=this.waitingConsumers.dequeue();Promise.resolve($e).then(T)}return setTimeout(()=>this.closeResolve(),0),$e}else return new Promise(T=>{this.waitingConsumers.enqueue(T)});else{let T=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(T),!this.waitingProducers.isEmpty()){let k=this.waitingProducers.dequeue();Promise.resolve(!0).then(k)}return T}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(T=>{for(this.closeResolve=T;!this.waitingProducers.isEmpty();){let k=this.waitingProducers.dequeue();Promise.resolve(!1).then(k)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let k=this.waitingConsumers.dequeue();Promise.resolve($e).then(k)}T()}})),this.closePromise}};function ct(T,k,A=Number.MAX_SAFE_INTEGER){let F=new pt(A,k),V=new ReadableStream({pull(W){let ne=!0,X=(async()=>{let Ee=new Array;do{let Me=F.dequeue();if(Me instanceof Promise){ne=!1;let U=await Me;U===$e?W.close():Ee.push(U)}else{let U=Me;U===$e?W.close():Ee.push(U)}}while(F.size()>0);if(Ee.length>0){let Me=T(Ee);W.enqueue(Me)}})();if(!ne)return console.debug("read stream stucked --------------------------------------"),X},async cancel(){console.debug("buffered readable cancel"),await F.close()}}),Q=new WritableStream({write(W,ne){let X=!0,Ee=(async()=>{let Me=F.enqueue(W);typeof Me=="boolean"?Me||ne.error(new Error("Write stream closed")):(X=!1,await Me||ne.error(new Error("Write stream closed")))})();if(!X)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),Ee},async close(){console.debug("buffered writable closing",F.size()),await F.close(),console.debug("buffered writable closed",F.size())},async abort(){console.debug("buffered writable aborting",F.size()),await F.close(),console.debug("buffered writable aborted",F.size())}});return{readable:V,writable:Q}}function ut(T=Number.MAX_SAFE_INTEGER){return ct(k=>k.join(""),k=>k.length,T)}function si(T=Number.MAX_SAFE_INTEGER){return ct(k=>{let A=new Uint8Array(k.reduce((V,Q)=>V+Q.byteLength,0)),F=0;return k.forEach(V=>{A.set(V,F),F+=V.byteLength}),A},k=>k.byteLength,T)}function mi(T){return new Promise((k,A)=>{let F=new BroadcastChannel(T),V=new pt(1),Q=new G(1),W=null,ne=!1,X=!1,Ee=!1;F.onmessage=Me=>{let U=Me.data,{type:be}=U;if(console.debug("p2p",T,"type",be,"data",be==="DATA"&&U.data),be==="DATA")V.enqueue(U.data);else if(be==="HI"){if(!W){F.postMessage({type:"HI"});let Se=0;W={rs:new ReadableStream({async pull(ze){let Ue=await V.dequeue();Ue===$e?(await $(),ze.close()):(ze.enqueue(Ue),F.postMessage({type:"ACK"}))},cancel(){return $()}}),ws:new WritableStream({async write(ze,Ue){await Q.acquireSync()?F.postMessage({type:"DATA",id:Se++,data:ze}):(Ne(),Ue.error(new Error("Write stream closed")))},close(){Ne()},abort(){Ne()}})},k(W)}}else be==="REND"?W?Q.close():fe("REND1"):be==="WEND"?W?V.close():fe("WEND1"):be==="ACK"&&Q.release();function Ne(){ne||(ne=!0,console.debug(T,"p2p write stream closed"),Q.close(),F.postMessage({type:"WEND"}),X&&(console.debug(T,"p2p channel closed on ws"),F.close()))}async function $(){X||(X=!0,console.debug(T,"p2p read stream closed"),F.postMessage({type:"REND"}),await V.close(),ne&&(console.debug(T,"p2p channel closed on rs"),F.close()))}async function fe(Se){Ee||(Ee=!0,console.debug(T,"p2p channel connection released on",Se),Q.close(),V.close(),W?(W.rs.locked||(console.debug(T,"p2p unlocked read stream direct cancel"),W.rs.cancel()),W.ws.locked||(console.debug(T,"p2p unlocked write stream direct close"),W.ws.close())):(F.postMessage({type:"HI"}),F.close()),A(new Error("p2p channel connection released")))}},F.postMessage({type:"HI"})})}function It(T){return new Promise(k=>{let A=new BroadcastChannel(T);A.onmessage=F=>{let V=F.data,{type:Q}=V;Q==="HI"&&(A.postMessage({type:"REND"}),A.close(),k())},A.postMessage({type:"REND"})})}async function jt(T){try{return await mi(T)}catch(k){k.message!=="p2p channel connection released"&&console.error(k)}}async function Ai(T,k,A=10*1024*1024,F=!0){let V=await jt(T);if(!V)return!1;let Q=!1;try{let W,ne=X=>{if(!W)if(!F)W=V.ws.getWriter();else if(typeof X=="string"){let Ee=ut(A);Ee.readable.pipeTo(V.ws),W=Ee.writable.getWriter()}else{let Ee=si(A);Ee.readable.pipeTo(V.ws),W=Ee.writable.getWriter()}return W.write(X)};if(Array.isArray(k))for(let X of k)await ne(X);else await k({write:ne,get desiredSize(){return((W==null?void 0:W.desiredSize)||0)+10}});W&&await W.close(),Q=!0}catch(W){console.error(W)}finally{return V.rs.cancel(),Q}}async function ni(T,k){var F,V;let A=await jt(T);if(A)try{let Q=A.rs.getReader();for((F=k.start)==null?void 0:F.call(k);;){let{value:W,done:ne}=await Q.read();if(W!==void 0){let X;if(k.update instanceof Promise?X=await k.update(W):X=k.update(W),X){await Q.cancel();break}}if(ne){(V=k.end)==null||V.call(k);break}}}catch(Q){console.error(Q)}finally{A.ws.close()}}}),gA=kt(()=>{}),Xt=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r():typeof define=="function"&&define.amd?define([],r):i.CryptoJS=r()})(e,function(){var i=i||(function(r,s){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto),!n&&typeof pA=="function")try{n=gA()}catch{}var a=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||(function(){function O(){}return function(y){var x;return O.prototype=y,x=new O,O.prototype=null,x}})(),l={},h=l.lib={},c=h.Base=(function(){return{extend:function(O){var y=o(this);return O&&y.mixIn(O),(!y.hasOwnProperty("init")||this.init===y.init)&&(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var O=this.extend();return O.init.apply(O,arguments),O},init:function(){},mixIn:function(O){for(var y in O)O.hasOwnProperty(y)&&(this[y]=O[y]);O.hasOwnProperty("toString")&&(this.toString=O.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),f=h.WordArray=c.extend({init:function(O,y){O=this.words=O||[],y!=s?this.sigBytes=y:this.sigBytes=O.length*4},toString:function(O){return(O||u).stringify(this)},concat:function(O){var y=this.words,x=O.words,E=this.sigBytes,w=O.sigBytes;if(this.clamp(),E%4)for(var S=0;S<w;S++){var C=x[S>>>2]>>>24-S%4*8&255;y[E+S>>>2]|=C<<24-(E+S)%4*8}else for(var R=0;R<w;R+=4)y[E+R>>>2]=x[R>>>2];return this.sigBytes+=w,this},clamp:function(){var O=this.words,y=this.sigBytes;O[y>>>2]&=4294967295<<32-y%4*8,O.length=r.ceil(y/4)},clone:function(){var O=c.clone.call(this);return O.words=this.words.slice(0),O},random:function(O){for(var y=[],x=0;x<O;x+=4)y.push(a());return new f.init(y,O)}}),d=l.enc={},u=d.Hex={stringify:function(O){for(var y=O.words,x=O.sigBytes,E=[],w=0;w<x;w++){var S=y[w>>>2]>>>24-w%4*8&255;E.push((S>>>4).toString(16)),E.push((S&15).toString(16))}return E.join("")},parse:function(O){for(var y=O.length,x=[],E=0;E<y;E+=2)x[E>>>3]|=parseInt(O.substr(E,2),16)<<24-E%8*4;return new f.init(x,y/2)}},p=d.Latin1={stringify:function(O){for(var y=O.words,x=O.sigBytes,E=[],w=0;w<x;w++){var S=y[w>>>2]>>>24-w%4*8&255;E.push(String.fromCharCode(S))}return E.join("")},parse:function(O){for(var y=O.length,x=[],E=0;E<y;E++)x[E>>>2]|=(O.charCodeAt(E)&255)<<24-E%4*8;return new f.init(x,y)}},_=d.Utf8={stringify:function(O){try{return decodeURIComponent(escape(p.stringify(O)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(O){return p.parse(unescape(encodeURIComponent(O)))}},g=h.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(O){typeof O=="string"&&(O=_.parse(O)),this._data.concat(O),this._nDataBytes+=O.sigBytes},_process:function(O){var y,x=this._data,E=x.words,w=x.sigBytes,S=this.blockSize,C=S*4,R=w/C;O?R=r.ceil(R):R=r.max((R|0)-this._minBufferSize,0);var B=R*S,Y=r.min(B*4,w);if(B){for(var G=0;G<B;G+=S)this._doProcessBlock(E,G);y=E.splice(0,B),x.sigBytes-=Y}return new f.init(y,Y)},clone:function(){var O=c.clone.call(this);return O._data=this._data.clone(),O},_minBufferSize:0}),b=h.Hasher=g.extend({cfg:c.extend(),init:function(O){this.cfg=this.cfg.extend(O),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(O){return this._append(O),this._process(),this},finalize:function(O){O&&this._append(O);var y=this._doFinalize();return y},blockSize:512/32,_createHelper:function(O){return function(y,x){return new O.init(x).finalize(y)}},_createHmacHelper:function(O){return function(y,x){return new m.HMAC.init(O,x).finalize(y)}}}),m=l.algo={};return l})(Math);return i})}),Sp=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.Base,o=n.WordArray,l=s.x64={},h=l.Word=a.extend({init:function(f,d){this.high=f,this.low=d}}),c=l.WordArray=a.extend({init:function(f,d){f=this.words=f||[],d!=r?this.sigBytes=d:this.sigBytes=f.length*8},toX32:function(){for(var f=this.words,d=f.length,u=[],p=0;p<d;p++){var _=f[p];u.push(_.high),u.push(_.low)}return o.create(u,this.sigBytes)},clone:function(){for(var f=a.clone.call(this),d=f.words=this.words.slice(0),u=d.length,p=0;p<u;p++)d[p]=d[p].clone();return f}})})(),i})}),OA=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){if(typeof ArrayBuffer=="function"){var r=i,s=r.lib,n=s.WordArray,a=n.init,o=n.init=function(l){if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),l instanceof Uint8Array){for(var h=l.byteLength,c=[],f=0;f<h;f++)c[f>>>2]|=l[f]<<24-f%4*8;a.call(this,c,h)}else a.apply(this,arguments)};o.prototype=n}})(),i.lib.WordArray})}),mA=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.enc,o=a.Utf16=a.Utf16BE={stringify:function(h){for(var c=h.words,f=h.sigBytes,d=[],u=0;u<f;u+=2){var p=c[u>>>2]>>>16-u%4*8&65535;d.push(String.fromCharCode(p))}return d.join("")},parse:function(h){for(var c=h.length,f=[],d=0;d<c;d++)f[d>>>1]|=h.charCodeAt(d)<<16-d%2*16;return n.create(f,c*2)}};a.Utf16LE={stringify:function(h){for(var c=h.words,f=h.sigBytes,d=[],u=0;u<f;u+=2){var p=l(c[u>>>2]>>>16-u%4*8&65535);d.push(String.fromCharCode(p))}return d.join("")},parse:function(h){for(var c=h.length,f=[],d=0;d<c;d++)f[d>>>1]|=l(h.charCodeAt(d)<<16-d%2*16);return n.create(f,c*2)}};function l(h){return h<<8&4278255360|h>>>8&16711935}})(),i.enc.Utf16})}),Rl=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.enc,o=a.Base64={stringify:function(h){var c=h.words,f=h.sigBytes,d=this._map;h.clamp();for(var u=[],p=0;p<f;p+=3)for(var _=c[p>>>2]>>>24-p%4*8&255,g=c[p+1>>>2]>>>24-(p+1)%4*8&255,b=c[p+2>>>2]>>>24-(p+2)%4*8&255,m=_<<16|g<<8|b,O=0;O<4&&p+O*.75<f;O++)u.push(d.charAt(m>>>6*(3-O)&63));var y=d.charAt(64);if(y)for(;u.length%4;)u.push(y);return u.join("")},parse:function(h){var c=h.length,f=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var u=0;u<f.length;u++)d[f.charCodeAt(u)]=u}var p=f.charAt(64);if(p){var _=h.indexOf(p);_!==-1&&(c=_)}return l(h,c,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(h,c,f){for(var d=[],u=0,p=0;p<c;p++)if(p%4){var _=f[h.charCodeAt(p-1)]<<p%4*2,g=f[h.charCodeAt(p)]>>>6-p%4*2,b=_|g;d[u>>>2]|=b<<24-u%4*8,u++}return n.create(d,u)}})(),i.enc.Base64})}),yA=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.enc,o=a.Base64url={stringify:function(h,c){c===void 0&&(c=!0);var f=h.words,d=h.sigBytes,u=c?this._safe_map:this._map;h.clamp();for(var p=[],_=0;_<d;_+=3)for(var g=f[_>>>2]>>>24-_%4*8&255,b=f[_+1>>>2]>>>24-(_+1)%4*8&255,m=f[_+2>>>2]>>>24-(_+2)%4*8&255,O=g<<16|b<<8|m,y=0;y<4&&_+y*.75<d;y++)p.push(u.charAt(O>>>6*(3-y)&63));var x=u.charAt(64);if(x)for(;p.length%4;)p.push(x);return p.join("")},parse:function(h,c){c===void 0&&(c=!0);var f=h.length,d=c?this._safe_map:this._map,u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var p=0;p<d.length;p++)u[d.charCodeAt(p)]=p}var _=d.charAt(64);if(_){var g=h.indexOf(_);g!==-1&&(f=g)}return l(h,f,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(h,c,f){for(var d=[],u=0,p=0;p<c;p++)if(p%4){var _=f[h.charCodeAt(p-1)]<<p%4*2,g=f[h.charCodeAt(p)]>>>6-p%4*2,b=_|g;d[u>>>2]|=b<<24-u%4*8,u++}return n.create(d,u)}})(),i.enc.Base64url})}),Dl=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.algo,h=[];(function(){for(var _=0;_<64;_++)h[_]=r.abs(r.sin(_+1))*4294967296|0})();var c=l.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(_,g){for(var b=0;b<16;b++){var m=g+b,O=_[m];_[m]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360}var y=this._hash.words,x=_[g+0],E=_[g+1],w=_[g+2],S=_[g+3],C=_[g+4],R=_[g+5],B=_[g+6],Y=_[g+7],G=_[g+8],z=_[g+9],q=_[g+10],L=_[g+11],M=_[g+12],v=_[g+13],P=_[g+14],I=_[g+15],N=y[0],D=y[1],j=y[2],H=y[3];N=f(N,D,j,H,x,7,h[0]),H=f(H,N,D,j,E,12,h[1]),j=f(j,H,N,D,w,17,h[2]),D=f(D,j,H,N,S,22,h[3]),N=f(N,D,j,H,C,7,h[4]),H=f(H,N,D,j,R,12,h[5]),j=f(j,H,N,D,B,17,h[6]),D=f(D,j,H,N,Y,22,h[7]),N=f(N,D,j,H,G,7,h[8]),H=f(H,N,D,j,z,12,h[9]),j=f(j,H,N,D,q,17,h[10]),D=f(D,j,H,N,L,22,h[11]),N=f(N,D,j,H,M,7,h[12]),H=f(H,N,D,j,v,12,h[13]),j=f(j,H,N,D,P,17,h[14]),D=f(D,j,H,N,I,22,h[15]),N=d(N,D,j,H,E,5,h[16]),H=d(H,N,D,j,B,9,h[17]),j=d(j,H,N,D,L,14,h[18]),D=d(D,j,H,N,x,20,h[19]),N=d(N,D,j,H,R,5,h[20]),H=d(H,N,D,j,q,9,h[21]),j=d(j,H,N,D,I,14,h[22]),D=d(D,j,H,N,C,20,h[23]),N=d(N,D,j,H,z,5,h[24]),H=d(H,N,D,j,P,9,h[25]),j=d(j,H,N,D,S,14,h[26]),D=d(D,j,H,N,G,20,h[27]),N=d(N,D,j,H,v,5,h[28]),H=d(H,N,D,j,w,9,h[29]),j=d(j,H,N,D,Y,14,h[30]),D=d(D,j,H,N,M,20,h[31]),N=u(N,D,j,H,R,4,h[32]),H=u(H,N,D,j,G,11,h[33]),j=u(j,H,N,D,L,16,h[34]),D=u(D,j,H,N,P,23,h[35]),N=u(N,D,j,H,E,4,h[36]),H=u(H,N,D,j,C,11,h[37]),j=u(j,H,N,D,Y,16,h[38]),D=u(D,j,H,N,q,23,h[39]),N=u(N,D,j,H,v,4,h[40]),H=u(H,N,D,j,x,11,h[41]),j=u(j,H,N,D,S,16,h[42]),D=u(D,j,H,N,B,23,h[43]),N=u(N,D,j,H,z,4,h[44]),H=u(H,N,D,j,M,11,h[45]),j=u(j,H,N,D,I,16,h[46]),D=u(D,j,H,N,w,23,h[47]),N=p(N,D,j,H,x,6,h[48]),H=p(H,N,D,j,Y,10,h[49]),j=p(j,H,N,D,P,15,h[50]),D=p(D,j,H,N,R,21,h[51]),N=p(N,D,j,H,M,6,h[52]),H=p(H,N,D,j,S,10,h[53]),j=p(j,H,N,D,q,15,h[54]),D=p(D,j,H,N,E,21,h[55]),N=p(N,D,j,H,G,6,h[56]),H=p(H,N,D,j,I,10,h[57]),j=p(j,H,N,D,B,15,h[58]),D=p(D,j,H,N,v,21,h[59]),N=p(N,D,j,H,C,6,h[60]),H=p(H,N,D,j,L,10,h[61]),j=p(j,H,N,D,w,15,h[62]),D=p(D,j,H,N,z,21,h[63]),y[0]=y[0]+N|0,y[1]=y[1]+D|0,y[2]=y[2]+j|0,y[3]=y[3]+H|0},_doFinalize:function(){var _=this._data,g=_.words,b=this._nDataBytes*8,m=_.sigBytes*8;g[m>>>5]|=128<<24-m%32;var O=r.floor(b/4294967296),y=b;g[(m+64>>>9<<4)+15]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,g[(m+64>>>9<<4)+14]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,_.sigBytes=(g.length+1)*4,this._process();for(var x=this._hash,E=x.words,w=0;w<4;w++){var S=E[w];E[w]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}return x},clone:function(){var _=o.clone.call(this);return _._hash=this._hash.clone(),_}});function f(_,g,b,m,O,y,x){var E=_+(g&b|~g&m)+O+x;return(E<<y|E>>>32-y)+g}function d(_,g,b,m,O,y,x){var E=_+(g&m|b&~m)+O+x;return(E<<y|E>>>32-y)+g}function u(_,g,b,m,O,y,x){var E=_+(g^b^m)+O+x;return(E<<y|E>>>32-y)+g}function p(_,g,b,m,O,y,x){var E=_+(b^(g|~m))+O+x;return(E<<y|E>>>32-y)+g}s.MD5=o._createHelper(c),s.HmacMD5=o._createHmacHelper(c)})(Math),i.MD5})}),Z2=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=s.Hasher,o=r.algo,l=[],h=o.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,f){for(var d=this._hash.words,u=d[0],p=d[1],_=d[2],g=d[3],b=d[4],m=0;m<80;m++){if(m<16)l[m]=c[f+m]|0;else{var O=l[m-3]^l[m-8]^l[m-14]^l[m-16];l[m]=O<<1|O>>>31}var y=(u<<5|u>>>27)+b+l[m];m<20?y+=(p&_|~p&g)+1518500249:m<40?y+=(p^_^g)+1859775393:m<60?y+=(p&_|p&g|_&g)-1894007588:y+=(p^_^g)-899497514,b=g,g=_,_=p<<30|p>>>2,p=u,u=y}d[0]=d[0]+u|0,d[1]=d[1]+p|0,d[2]=d[2]+_|0,d[3]=d[3]+g|0,d[4]=d[4]+b|0},_doFinalize:function(){var c=this._data,f=c.words,d=this._nDataBytes*8,u=c.sigBytes*8;return f[u>>>5]|=128<<24-u%32,f[(u+64>>>9<<4)+14]=Math.floor(d/4294967296),f[(u+64>>>9<<4)+15]=d,c.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var c=a.clone.call(this);return c._hash=this._hash.clone(),c}});r.SHA1=a._createHelper(h),r.HmacSHA1=a._createHmacHelper(h)})(),i.SHA1})}),hm=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.algo,h=[],c=[];(function(){function u(b){for(var m=r.sqrt(b),O=2;O<=m;O++)if(!(b%O))return!1;return!0}function p(b){return(b-(b|0))*4294967296|0}for(var _=2,g=0;g<64;)u(_)&&(g<8&&(h[g]=p(r.pow(_,1/2))),c[g]=p(r.pow(_,1/3)),g++),_++})();var f=[],d=l.SHA256=o.extend({_doReset:function(){this._hash=new a.init(h.slice(0))},_doProcessBlock:function(u,p){for(var _=this._hash.words,g=_[0],b=_[1],m=_[2],O=_[3],y=_[4],x=_[5],E=_[6],w=_[7],S=0;S<64;S++){if(S<16)f[S]=u[p+S]|0;else{var C=f[S-15],R=(C<<25|C>>>7)^(C<<14|C>>>18)^C>>>3,B=f[S-2],Y=(B<<15|B>>>17)^(B<<13|B>>>19)^B>>>10;f[S]=R+f[S-7]+Y+f[S-16]}var G=y&x^~y&E,z=g&b^g&m^b&m,q=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),L=(y<<26|y>>>6)^(y<<21|y>>>11)^(y<<7|y>>>25),M=w+L+G+c[S]+f[S],v=q+z;w=E,E=x,x=y,y=O+M|0,O=m,m=b,b=g,g=M+v|0}_[0]=_[0]+g|0,_[1]=_[1]+b|0,_[2]=_[2]+m|0,_[3]=_[3]+O|0,_[4]=_[4]+y|0,_[5]=_[5]+x|0,_[6]=_[6]+E|0,_[7]=_[7]+w|0},_doFinalize:function(){var u=this._data,p=u.words,_=this._nDataBytes*8,g=u.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=r.floor(_/4294967296),p[(g+64>>>9<<4)+15]=_,u.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var u=o.clone.call(this);return u._hash=this._hash.clone(),u}});s.SHA256=o._createHelper(d),s.HmacSHA256=o._createHmacHelper(d)})(Math),i.SHA256})}),bA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),hm()):typeof define=="function"&&define.amd?define(["./core","./sha256"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.algo,o=a.SHA256,l=a.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var h=o._doFinalize.call(this);return h.sigBytes-=4,h}});r.SHA224=o._createHelper(l),r.HmacSHA224=o._createHmacHelper(l)})(),i.SHA224})}),K2=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Sp()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.Hasher,a=r.x64,o=a.Word,l=a.WordArray,h=r.algo;function c(){return o.create.apply(o,arguments)}var f=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],d=[];(function(){for(var p=0;p<80;p++)d[p]=c()})();var u=h.SHA512=n.extend({_doReset:function(){this._hash=new l.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(p,_){for(var g=this._hash.words,b=g[0],m=g[1],O=g[2],y=g[3],x=g[4],E=g[5],w=g[6],S=g[7],C=b.high,R=b.low,B=m.high,Y=m.low,G=O.high,z=O.low,q=y.high,L=y.low,M=x.high,v=x.low,P=E.high,I=E.low,N=w.high,D=w.low,j=S.high,H=S.low,K=C,se=R,he=B,_e=Y,ve=G,J=z,Z=q,re=L,ue=M,Le=v,Ce=P,De=I,Pe=N,Ie=D,Je=j,$e=H,pt=0;pt<80;pt++){var ct,ut,si=d[pt];if(pt<16)ut=si.high=p[_+pt*2]|0,ct=si.low=p[_+pt*2+1]|0;else{var mi=d[pt-15],It=mi.high,jt=mi.low,Ai=(It>>>1|jt<<31)^(It>>>8|jt<<24)^It>>>7,ni=(jt>>>1|It<<31)^(jt>>>8|It<<24)^(jt>>>7|It<<25),T=d[pt-2],k=T.high,A=T.low,F=(k>>>19|A<<13)^(k<<3|A>>>29)^k>>>6,V=(A>>>19|k<<13)^(A<<3|k>>>29)^(A>>>6|k<<26),Q=d[pt-7],W=Q.high,ne=Q.low,X=d[pt-16],Ee=X.high,Me=X.low;ct=ni+ne,ut=Ai+W+(ct>>>0<ni>>>0?1:0),ct=ct+V,ut=ut+F+(ct>>>0<V>>>0?1:0),ct=ct+Me,ut=ut+Ee+(ct>>>0<Me>>>0?1:0),si.high=ut,si.low=ct}var U=ue&Ce^~ue&Pe,be=Le&De^~Le&Ie,Ne=K&he^K&ve^he&ve,$=se&_e^se&J^_e&J,fe=(K>>>28|se<<4)^(K<<30|se>>>2)^(K<<25|se>>>7),Se=(se>>>28|K<<4)^(se<<30|K>>>2)^(se<<25|K>>>7),ze=(ue>>>14|Le<<18)^(ue>>>18|Le<<14)^(ue<<23|Le>>>9),Ue=(Le>>>14|ue<<18)^(Le>>>18|ue<<14)^(Le<<23|ue>>>9),je=f[pt],Dt=je.high,Ts=je.low,ft=$e+Ue,dt=Je+ze+(ft>>>0<$e>>>0?1:0),ft=ft+be,dt=dt+U+(ft>>>0<be>>>0?1:0),ft=ft+Ts,dt=dt+Dt+(ft>>>0<Ts>>>0?1:0),ft=ft+ct,dt=dt+ut+(ft>>>0<ct>>>0?1:0),Li=Se+$,fr=fe+Ne+(Li>>>0<Se>>>0?1:0);Je=Pe,$e=Ie,Pe=Ce,Ie=De,Ce=ue,De=Le,Le=re+ft|0,ue=Z+dt+(Le>>>0<re>>>0?1:0)|0,Z=ve,re=J,ve=he,J=_e,he=K,_e=se,se=ft+Li|0,K=dt+fr+(se>>>0<ft>>>0?1:0)|0}R=b.low=R+se,b.high=C+K+(R>>>0<se>>>0?1:0),Y=m.low=Y+_e,m.high=B+he+(Y>>>0<_e>>>0?1:0),z=O.low=z+J,O.high=G+ve+(z>>>0<J>>>0?1:0),L=y.low=L+re,y.high=q+Z+(L>>>0<re>>>0?1:0),v=x.low=v+Le,x.high=M+ue+(v>>>0<Le>>>0?1:0),I=E.low=I+De,E.high=P+Ce+(I>>>0<De>>>0?1:0),D=w.low=D+Ie,w.high=N+Pe+(D>>>0<Ie>>>0?1:0),H=S.low=H+$e,S.high=j+Je+(H>>>0<$e>>>0?1:0)},_doFinalize:function(){var p=this._data,_=p.words,g=this._nDataBytes*8,b=p.sigBytes*8;_[b>>>5]|=128<<24-b%32,_[(b+128>>>10<<5)+30]=Math.floor(g/4294967296),_[(b+128>>>10<<5)+31]=g,p.sigBytes=_.length*4,this._process();var m=this._hash.toX32();return m},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=n._createHelper(u),r.HmacSHA512=n._createHmacHelper(u)})(),i.SHA512})}),xA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Sp(),K2()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./sha512"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.x64,n=s.Word,a=s.WordArray,o=r.algo,l=o.SHA512,h=o.SHA384=l.extend({_doReset:function(){this._hash=new a.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var c=l._doFinalize.call(this);return c.sigBytes-=16,c}});r.SHA384=l._createHelper(h),r.HmacSHA384=l._createHmacHelper(h)})(),i.SHA384})}),vA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Sp()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.x64,h=l.Word,c=s.algo,f=[],d=[],u=[];(function(){for(var g=1,b=0,m=0;m<24;m++){f[g+5*b]=(m+1)*(m+2)/2%64;var O=b%5,y=(2*g+3*b)%5;g=O,b=y}for(var g=0;g<5;g++)for(var b=0;b<5;b++)d[g+5*b]=b+(2*g+3*b)%5*5;for(var x=1,E=0;E<24;E++){for(var w=0,S=0,C=0;C<7;C++){if(x&1){var R=(1<<C)-1;R<32?S^=1<<R:w^=1<<R-32}x&128?x=x<<1^113:x<<=1}u[E]=h.create(w,S)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=h.create()})();var _=c.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],b=0;b<25;b++)g[b]=new h.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,b){for(var m=this._state,O=this.blockSize/2,y=0;y<O;y++){var x=g[b+2*y],E=g[b+2*y+1];x=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360;var w=m[y];w.high^=E,w.low^=x}for(var S=0;S<24;S++){for(var C=0;C<5;C++){for(var R=0,B=0,Y=0;Y<5;Y++){var w=m[C+5*Y];R^=w.high,B^=w.low}var G=p[C];G.high=R,G.low=B}for(var C=0;C<5;C++)for(var z=p[(C+4)%5],q=p[(C+1)%5],L=q.high,M=q.low,R=z.high^(L<<1|M>>>31),B=z.low^(M<<1|L>>>31),Y=0;Y<5;Y++){var w=m[C+5*Y];w.high^=R,w.low^=B}for(var v=1;v<25;v++){var R,B,w=m[v],P=w.high,I=w.low,N=f[v];N<32?(R=P<<N|I>>>32-N,B=I<<N|P>>>32-N):(R=I<<N-32|P>>>64-N,B=P<<N-32|I>>>64-N);var D=p[d[v]];D.high=R,D.low=B}var j=p[0],H=m[0];j.high=H.high,j.low=H.low;for(var C=0;C<5;C++)for(var Y=0;Y<5;Y++){var v=C+5*Y,w=m[v],K=p[v],se=p[(C+1)%5+5*Y],he=p[(C+2)%5+5*Y];w.high=K.high^~se.high&he.high,w.low=K.low^~se.low&he.low}var w=m[0],_e=u[S];w.high^=_e.high,w.low^=_e.low}},_doFinalize:function(){var g=this._data,b=g.words,m=this._nDataBytes*8,O=g.sigBytes*8,y=this.blockSize*32;b[O>>>5]|=1<<24-O%32,b[(r.ceil((O+1)/y)*y>>>5)-1]|=128,g.sigBytes=b.length*4,this._process();for(var x=this._state,E=this.cfg.outputLength/8,w=E/8,S=[],C=0;C<w;C++){var R=x[C],B=R.high,Y=R.low;B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,Y=(Y<<8|Y>>>24)&16711935|(Y<<24|Y>>>8)&4278255360,S.push(Y),S.push(B)}return new a.init(S,E)},clone:function(){for(var g=o.clone.call(this),b=g._state=this._state.slice(0),m=0;m<25;m++)b[m]=b[m].clone();return g}});s.SHA3=o._createHelper(_),s.HmacSHA3=o._createHmacHelper(_)})(Math),i.SHA3})}),EA=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.algo,h=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),f=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=a.create([0,1518500249,1859775393,2400959708,2840853838]),p=a.create([1352829926,1548603684,1836072691,2053994217,0]),_=l.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(E,w){for(var S=0;S<16;S++){var C=w+S,R=E[C];E[C]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}var B=this._hash.words,Y=u.words,G=p.words,z=h.words,q=c.words,L=f.words,M=d.words,v,P,I,N,D,j,H,K,se,he;j=v=B[0],H=P=B[1],K=I=B[2],se=N=B[3],he=D=B[4];for(var _e,S=0;S<80;S+=1)_e=v+E[w+z[S]]|0,S<16?_e+=g(P,I,N)+Y[0]:S<32?_e+=b(P,I,N)+Y[1]:S<48?_e+=m(P,I,N)+Y[2]:S<64?_e+=O(P,I,N)+Y[3]:_e+=y(P,I,N)+Y[4],_e=_e|0,_e=x(_e,L[S]),_e=_e+D|0,v=D,D=N,N=x(I,10),I=P,P=_e,_e=j+E[w+q[S]]|0,S<16?_e+=y(H,K,se)+G[0]:S<32?_e+=O(H,K,se)+G[1]:S<48?_e+=m(H,K,se)+G[2]:S<64?_e+=b(H,K,se)+G[3]:_e+=g(H,K,se)+G[4],_e=_e|0,_e=x(_e,M[S]),_e=_e+he|0,j=he,he=se,se=x(K,10),K=H,H=_e;_e=B[1]+I+se|0,B[1]=B[2]+N+he|0,B[2]=B[3]+D+j|0,B[3]=B[4]+v+H|0,B[4]=B[0]+P+K|0,B[0]=_e},_doFinalize:function(){var E=this._data,w=E.words,S=this._nDataBytes*8,C=E.sigBytes*8;w[C>>>5]|=128<<24-C%32,w[(C+64>>>9<<4)+14]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,E.sigBytes=(w.length+1)*4,this._process();for(var R=this._hash,B=R.words,Y=0;Y<5;Y++){var G=B[Y];B[Y]=(G<<8|G>>>24)&16711935|(G<<24|G>>>8)&4278255360}return R},clone:function(){var E=o.clone.call(this);return E._hash=this._hash.clone(),E}});function g(E,w,S){return E^w^S}function b(E,w,S){return E&w|~E&S}function m(E,w,S){return(E|~w)^S}function O(E,w,S){return E&S|w&~S}function y(E,w,S){return E^(w|~S)}function x(E,w){return E<<w|E>>>32-w}s.RIPEMD160=o._createHelper(_),s.HmacRIPEMD160=o._createHmacHelper(_)})(Math),i.RIPEMD160})}),cm=kt((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Xt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){(function(){var r=i,s=r.lib,n=s.Base,a=r.enc,o=a.Utf8,l=r.algo,h=l.HMAC=n.extend({init:function(c,f){c=this._hasher=new c.init,typeof f=="string"&&(f=o.parse(f));var d=c.blockSize,u=d*4;f.sigBytes>u&&(f=c.finalize(f)),f.clamp();for(var p=this._oKey=f.clone(),_=this._iKey=f.clone(),g=p.words,b=_.words,m=0;m<d;m++)g[m]^=1549556828,b[m]^=909522486;p.sigBytes=_.sigBytes=u,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var f=this._hasher,d=f.finalize(c);f.reset();var u=f.finalize(this._oKey.clone().concat(d));return u}})})()})}),TA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),hm(),cm()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.Base,a=s.WordArray,o=r.algo,l=o.SHA256,h=o.HMAC,c=o.PBKDF2=n.extend({cfg:n.extend({keySize:128/32,hasher:l,iterations:25e4}),init:function(f){this.cfg=this.cfg.extend(f)},compute:function(f,d){for(var u=this.cfg,p=h.create(u.hasher,f),_=a.create(),g=a.create([1]),b=_.words,m=g.words,O=u.keySize,y=u.iterations;b.length<O;){var x=p.update(d).finalize(g);p.reset();for(var E=x.words,w=E.length,S=x,C=1;C<y;C++){S=p.finalize(S),p.reset();for(var R=S.words,B=0;B<w;B++)E[B]^=R[B]}_.concat(x),m[0]++}return _.sigBytes=O*4,_}});r.PBKDF2=function(f,d,u){return c.create(u).compute(f,d)}})(),i.PBKDF2})}),ko=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Z2(),cm()):typeof define=="function"&&define.amd?define(["./core","./sha1","./hmac"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.Base,a=s.WordArray,o=r.algo,l=o.MD5,h=o.EvpKDF=n.extend({cfg:n.extend({keySize:128/32,hasher:l,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,f){for(var d,u=this.cfg,p=u.hasher.create(),_=a.create(),g=_.words,b=u.keySize,m=u.iterations;g.length<b;){d&&p.update(d),d=p.update(c).finalize(f),p.reset();for(var O=1;O<m;O++)d=p.finalize(d),p.reset();_.concat(d)}return _.sigBytes=b*4,_}});r.EvpKDF=function(c,f,d){return h.create(d).compute(c,f)}})(),i.EvpKDF})}),jr=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),ko()):typeof define=="function"&&define.amd?define(["./core","./evpkdf"],r):r(i.CryptoJS)})(e,function(i){i.lib.Cipher||(function(r){var s=i,n=s.lib,a=n.Base,o=n.WordArray,l=n.BufferedBlockAlgorithm,h=s.enc,c=h.Utf8,f=h.Base64,d=s.algo,u=d.EvpKDF,p=n.Cipher=l.extend({cfg:a.extend(),createEncryptor:function(G,z){return this.create(this._ENC_XFORM_MODE,G,z)},createDecryptor:function(G,z){return this.create(this._DEC_XFORM_MODE,G,z)},init:function(G,z,q){this.cfg=this.cfg.extend(q),this._xformMode=G,this._key=z,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(G){return this._append(G),this._process()},finalize:function(G){G&&this._append(G);var z=this._doFinalize();return z},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function G(z){return typeof z=="string"?Y:C}return function(z){return{encrypt:function(q,L,M){return G(L).encrypt(z,q,L,M)},decrypt:function(q,L,M){return G(L).decrypt(z,q,L,M)}}}})()}),_=n.StreamCipher=p.extend({_doFinalize:function(){var G=this._process(!0);return G},blockSize:1}),g=s.mode={},b=n.BlockCipherMode=a.extend({createEncryptor:function(G,z){return this.Encryptor.create(G,z)},createDecryptor:function(G,z){return this.Decryptor.create(G,z)},init:function(G,z){this._cipher=G,this._iv=z}}),m=g.CBC=(function(){var G=b.extend();G.Encryptor=G.extend({processBlock:function(q,L){var M=this._cipher,v=M.blockSize;z.call(this,q,L,v),M.encryptBlock(q,L),this._prevBlock=q.slice(L,L+v)}}),G.Decryptor=G.extend({processBlock:function(q,L){var M=this._cipher,v=M.blockSize,P=q.slice(L,L+v);M.decryptBlock(q,L),z.call(this,q,L,v),this._prevBlock=P}});function z(q,L,M){var v,P=this._iv;P?(v=P,this._iv=r):v=this._prevBlock;for(var I=0;I<M;I++)q[L+I]^=v[I]}return G})(),O=s.pad={},y=O.Pkcs7={pad:function(G,z){for(var q=z*4,L=q-G.sigBytes%q,M=L<<24|L<<16|L<<8|L,v=[],P=0;P<L;P+=4)v.push(M);var I=o.create(v,L);G.concat(I)},unpad:function(G){var z=G.words[G.sigBytes-1>>>2]&255;G.sigBytes-=z}},x=n.BlockCipher=p.extend({cfg:p.cfg.extend({mode:m,padding:y}),reset:function(){var G;p.reset.call(this);var z=this.cfg,q=z.iv,L=z.mode;this._xformMode==this._ENC_XFORM_MODE?G=L.createEncryptor:(G=L.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==G?this._mode.init(this,q&&q.words):(this._mode=G.call(L,this,q&&q.words),this._mode.__creator=G)},_doProcessBlock:function(G,z){this._mode.processBlock(G,z)},_doFinalize:function(){var G,z=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(z.pad(this._data,this.blockSize),G=this._process(!0)):(G=this._process(!0),z.unpad(G)),G},blockSize:128/32}),E=n.CipherParams=a.extend({init:function(G){this.mixIn(G)},toString:function(G){return(G||this.formatter).stringify(this)}}),w=s.format={},S=w.OpenSSL={stringify:function(G){var z,q=G.ciphertext,L=G.salt;return L?z=o.create([1398893684,1701076831]).concat(L).concat(q):z=q,z.toString(f)},parse:function(G){var z,q=f.parse(G),L=q.words;return L[0]==1398893684&&L[1]==1701076831&&(z=o.create(L.slice(2,4)),L.splice(0,4),q.sigBytes-=16),E.create({ciphertext:q,salt:z})}},C=n.SerializableCipher=a.extend({cfg:a.extend({format:S}),encrypt:function(G,z,q,L){L=this.cfg.extend(L);var M=G.createEncryptor(q,L),v=M.finalize(z),P=M.cfg;return E.create({ciphertext:v,key:q,iv:P.iv,algorithm:G,mode:P.mode,padding:P.padding,blockSize:G.blockSize,formatter:L.format})},decrypt:function(G,z,q,L){L=this.cfg.extend(L),z=this._parse(z,L.format);var M=G.createDecryptor(q,L).finalize(z.ciphertext);return M},_parse:function(G,z){return typeof G=="string"?z.parse(G,this):G}}),R=s.kdf={},B=R.OpenSSL={execute:function(G,z,q,L,M){if(L||(L=o.random(64/8)),M)var v=u.create({keySize:z+q,hasher:M}).compute(G,L);else var v=u.create({keySize:z+q}).compute(G,L);var P=o.create(v.words.slice(z),q*4);return v.sigBytes=z*4,E.create({key:v,iv:P,salt:L})}},Y=n.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:B}),encrypt:function(G,z,q,L){L=this.cfg.extend(L);var M=L.kdf.execute(q,G.keySize,G.ivSize,L.salt,L.hasher);L.iv=M.iv;var v=C.encrypt.call(this,G,z,M.key,L);return v.mixIn(M),v},decrypt:function(G,z,q,L){L=this.cfg.extend(L),z=this._parse(z,L.format);var M=L.kdf.execute(q,G.keySize,G.ivSize,z.salt,L.hasher);L.iv=M.iv;var v=C.decrypt.call(this,G,z,M.key,L);return v}})})()})}),wA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.CFB=(function(){var r=i.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize;s.call(this,n,a,l,o),this._prevBlock=n.slice(a,a+l)}}),r.Decryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,h=n.slice(a,a+l);s.call(this,n,a,l,o),this._prevBlock=h}});function s(n,a,o,l){var h,c=this._iv;c?(h=c.slice(0),this._iv=void 0):h=this._prevBlock,l.encryptBlock(h,0);for(var f=0;f<o;f++)n[a+f]^=h[f]}return r})(),i.mode.CFB})}),SA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.CTR=(function(){var r=i.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,h=this._iv,c=this._counter;h&&(c=this._counter=h.slice(0),this._iv=void 0);var f=c.slice(0);o.encryptBlock(f,0),c[l-1]=c[l-1]+1|0;for(var d=0;d<l;d++)n[a+d]^=f[d]}});return r.Decryptor=s,r})(),i.mode.CTR})}),IA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.CTRGladman=(function(){var r=i.lib.BlockCipherMode.extend();function s(o){if((o>>24&255)===255){var l=o>>16&255,h=o>>8&255,c=o&255;l===255?(l=0,h===255?(h=0,c===255?c=0:++c):++h):++l,o=0,o+=l<<16,o+=h<<8,o+=c}else o+=1<<24;return o}function n(o){return(o[0]=s(o[0]))===0&&(o[1]=s(o[1])),o}var a=r.Encryptor=r.extend({processBlock:function(o,l){var h=this._cipher,c=h.blockSize,f=this._iv,d=this._counter;f&&(d=this._counter=f.slice(0),this._iv=void 0),n(d);var u=d.slice(0);h.encryptBlock(u,0);for(var p=0;p<c;p++)o[l+p]^=u[p]}});return r.Decryptor=a,r})(),i.mode.CTRGladman})}),PA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.OFB=(function(){var r=i.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,h=this._iv,c=this._keystream;h&&(c=this._keystream=h.slice(0),this._iv=void 0),o.encryptBlock(c,0);for(var f=0;f<l;f++)n[a+f]^=c[f]}});return r.Decryptor=s,r})(),i.mode.OFB})}),AA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.ECB=(function(){var r=i.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(s,n){this._cipher.encryptBlock(s,n)}}),r.Decryptor=r.extend({processBlock:function(s,n){this._cipher.decryptBlock(s,n)}}),r})(),i.mode.ECB})}),CA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.AnsiX923={pad:function(r,s){var n=r.sigBytes,a=s*4,o=a-n%a,l=n+o-1;r.clamp(),r.words[l>>>2]|=o<<24-l%4*8,r.sigBytes+=o},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},i.pad.Ansix923})}),NA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.Iso10126={pad:function(r,s){var n=s*4,a=n-r.sigBytes%n;r.concat(i.lib.WordArray.random(a-1)).concat(i.lib.WordArray.create([a<<24],1))},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},i.pad.Iso10126})}),LA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.Iso97971={pad:function(r,s){r.concat(i.lib.WordArray.create([2147483648],1)),i.pad.ZeroPadding.pad(r,s)},unpad:function(r){i.pad.ZeroPadding.unpad(r),r.sigBytes--}},i.pad.Iso97971})}),RA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.ZeroPadding={pad:function(r,s){var n=s*4;r.clamp(),r.sigBytes+=n-(r.sigBytes%n||n)},unpad:function(r){for(var s=r.words,n=r.sigBytes-1,n=r.sigBytes-1;n>=0;n--)if(s[n>>>2]>>>24-n%4*8&255){r.sigBytes=n+1;break}}},i.pad.ZeroPadding})}),DA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.NoPadding={pad:function(){},unpad:function(){}},i.pad.NoPadding})}),MA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.CipherParams,o=s.enc,l=o.Hex,h=s.format,c=h.Hex={stringify:function(f){return f.ciphertext.toString(l)},parse:function(f){var d=l.parse(f);return a.create({ciphertext:d})}}})(),i.format.Hex})}),BA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Rl(),Dl(),ko(),jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.BlockCipher,a=r.algo,o=[],l=[],h=[],c=[],f=[],d=[],u=[],p=[],_=[],g=[];(function(){for(var O=[],y=0;y<256;y++)y<128?O[y]=y<<1:O[y]=y<<1^283;for(var x=0,E=0,y=0;y<256;y++){var w=E^E<<1^E<<2^E<<3^E<<4;w=w>>>8^w&255^99,o[x]=w,l[w]=x;var S=O[x],C=O[S],R=O[C],B=O[w]*257^w*16843008;h[x]=B<<24|B>>>8,c[x]=B<<16|B>>>16,f[x]=B<<8|B>>>24,d[x]=B;var B=R*16843009^C*65537^S*257^x*16843008;u[w]=B<<24|B>>>8,p[w]=B<<16|B>>>16,_[w]=B<<8|B>>>24,g[w]=B,x?(x=S^O[O[O[R^S]]],E^=O[O[E]]):x=E=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],m=a.AES=n.extend({_doReset:function(){var O;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var y=this._keyPriorReset=this._key,x=y.words,E=y.sigBytes/4,w=this._nRounds=E+6,S=(w+1)*4,C=this._keySchedule=[],R=0;R<S;R++)R<E?C[R]=x[R]:(O=C[R-1],R%E?E>6&&R%E==4&&(O=o[O>>>24]<<24|o[O>>>16&255]<<16|o[O>>>8&255]<<8|o[O&255]):(O=O<<8|O>>>24,O=o[O>>>24]<<24|o[O>>>16&255]<<16|o[O>>>8&255]<<8|o[O&255],O^=b[R/E|0]<<24),C[R]=C[R-E]^O);for(var B=this._invKeySchedule=[],Y=0;Y<S;Y++){var R=S-Y;if(Y%4)var O=C[R];else var O=C[R-4];Y<4||R<=4?B[Y]=O:B[Y]=u[o[O>>>24]]^p[o[O>>>16&255]]^_[o[O>>>8&255]]^g[o[O&255]]}}},encryptBlock:function(O,y){this._doCryptBlock(O,y,this._keySchedule,h,c,f,d,o)},decryptBlock:function(O,y){var x=O[y+1];O[y+1]=O[y+3],O[y+3]=x,this._doCryptBlock(O,y,this._invKeySchedule,u,p,_,g,l);var x=O[y+1];O[y+1]=O[y+3],O[y+3]=x},_doCryptBlock:function(O,y,x,E,w,S,C,R){for(var B=this._nRounds,Y=O[y]^x[0],G=O[y+1]^x[1],z=O[y+2]^x[2],q=O[y+3]^x[3],L=4,M=1;M<B;M++){var v=E[Y>>>24]^w[G>>>16&255]^S[z>>>8&255]^C[q&255]^x[L++],P=E[G>>>24]^w[z>>>16&255]^S[q>>>8&255]^C[Y&255]^x[L++],I=E[z>>>24]^w[q>>>16&255]^S[Y>>>8&255]^C[G&255]^x[L++],N=E[q>>>24]^w[Y>>>16&255]^S[G>>>8&255]^C[z&255]^x[L++];Y=v,G=P,z=I,q=N}var v=(R[Y>>>24]<<24|R[G>>>16&255]<<16|R[z>>>8&255]<<8|R[q&255])^x[L++],P=(R[G>>>24]<<24|R[z>>>16&255]<<16|R[q>>>8&255]<<8|R[Y&255])^x[L++],I=(R[z>>>24]<<24|R[q>>>16&255]<<16|R[Y>>>8&255]<<8|R[G&255])^x[L++],N=(R[q>>>24]<<24|R[Y>>>16&255]<<16|R[G>>>8&255]<<8|R[z&255])^x[L++];O[y]=v,O[y+1]=P,O[y+2]=I,O[y+3]=N},keySize:256/32});r.AES=n._createHelper(m)})(),i.AES})}),kA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Rl(),Dl(),ko(),jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=s.BlockCipher,o=r.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],h=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],f=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=o.DES=a.extend({_doReset:function(){for(var b=this._key,m=b.words,O=[],y=0;y<56;y++){var x=l[y]-1;O[y]=m[x>>>5]>>>31-x%32&1}for(var E=this._subKeys=[],w=0;w<16;w++){for(var S=E[w]=[],C=c[w],y=0;y<24;y++)S[y/6|0]|=O[(h[y]-1+C)%28]<<31-y%6,S[4+(y/6|0)]|=O[28+(h[y+24]-1+C)%28]<<31-y%6;S[0]=S[0]<<1|S[0]>>>31;for(var y=1;y<7;y++)S[y]=S[y]>>>(y-1)*4+3;S[7]=S[7]<<5|S[7]>>>27}for(var R=this._invSubKeys=[],y=0;y<16;y++)R[y]=E[15-y]},encryptBlock:function(b,m){this._doCryptBlock(b,m,this._subKeys)},decryptBlock:function(b,m){this._doCryptBlock(b,m,this._invSubKeys)},_doCryptBlock:function(b,m,O){this._lBlock=b[m],this._rBlock=b[m+1],p.call(this,4,252645135),p.call(this,16,65535),_.call(this,2,858993459),_.call(this,8,16711935),p.call(this,1,1431655765);for(var y=0;y<16;y++){for(var x=O[y],E=this._lBlock,w=this._rBlock,S=0,C=0;C<8;C++)S|=f[C][((w^x[C])&d[C])>>>0];this._lBlock=w,this._rBlock=E^S}var R=this._lBlock;this._lBlock=this._rBlock,this._rBlock=R,p.call(this,1,1431655765),_.call(this,8,16711935),_.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),b[m]=this._lBlock,b[m+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(b,m){var O=(this._lBlock>>>b^this._rBlock)&m;this._rBlock^=O,this._lBlock^=O<<b}function _(b,m){var O=(this._rBlock>>>b^this._lBlock)&m;this._lBlock^=O,this._rBlock^=O<<b}r.DES=a._createHelper(u);var g=o.TripleDES=a.extend({_doReset:function(){var b=this._key,m=b.words;if(m.length!==2&&m.length!==4&&m.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var O=m.slice(0,2),y=m.length<4?m.slice(0,2):m.slice(2,4),x=m.length<6?m.slice(0,2):m.slice(4,6);this._des1=u.createEncryptor(n.create(O)),this._des2=u.createEncryptor(n.create(y)),this._des3=u.createEncryptor(n.create(x))},encryptBlock:function(b,m){this._des1.encryptBlock(b,m),this._des2.decryptBlock(b,m),this._des3.encryptBlock(b,m)},decryptBlock:function(b,m){this._des3.decryptBlock(b,m),this._des2.encryptBlock(b,m),this._des1.decryptBlock(b,m)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=a._createHelper(g)})(),i.TripleDES})}),UA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Rl(),Dl(),ko(),jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.StreamCipher,a=r.algo,o=a.RC4=n.extend({_doReset:function(){for(var c=this._key,f=c.words,d=c.sigBytes,u=this._S=[],p=0;p<256;p++)u[p]=p;for(var p=0,_=0;p<256;p++){var g=p%d,b=f[g>>>2]>>>24-g%4*8&255;_=(_+u[p]+b)%256;var m=u[p];u[p]=u[_],u[_]=m}this._i=this._j=0},_doProcessBlock:function(c,f){c[f]^=l.call(this)},keySize:256/32,ivSize:0});function l(){for(var c=this._S,f=this._i,d=this._j,u=0,p=0;p<4;p++){f=(f+1)%256,d=(d+c[f])%256;var _=c[f];c[f]=c[d],c[d]=_,u|=c[(c[f]+c[d])%256]<<24-p*8}return this._i=f,this._j=d,u}r.RC4=n._createHelper(o);var h=a.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var c=this.cfg.drop;c>0;c--)l.call(this)}});r.RC4Drop=n._createHelper(h)})(),i.RC4})}),FA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Rl(),Dl(),ko(),jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.StreamCipher,a=r.algo,o=[],l=[],h=[],c=a.Rabbit=n.extend({_doReset:function(){for(var d=this._key.words,u=this.cfg.iv,p=0;p<4;p++)d[p]=(d[p]<<8|d[p]>>>24)&16711935|(d[p]<<24|d[p]>>>8)&4278255360;var _=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],g=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var p=0;p<4;p++)f.call(this);for(var p=0;p<8;p++)g[p]^=_[p+4&7];if(u){var b=u.words,m=b[0],O=b[1],y=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,x=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,E=y>>>16|x&4294901760,w=x<<16|y&65535;g[0]^=y,g[1]^=E,g[2]^=x,g[3]^=w,g[4]^=y,g[5]^=E,g[6]^=x,g[7]^=w;for(var p=0;p<4;p++)f.call(this)}},_doProcessBlock:function(d,u){var p=this._X;f.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var _=0;_<4;_++)o[_]=(o[_]<<8|o[_]>>>24)&16711935|(o[_]<<24|o[_]>>>8)&4278255360,d[u+_]^=o[_]},blockSize:128/32,ivSize:64/32});function f(){for(var d=this._X,u=this._C,p=0;p<8;p++)l[p]=u[p];u[0]=u[0]+1295307597+this._b|0,u[1]=u[1]+3545052371+(u[0]>>>0<l[0]>>>0?1:0)|0,u[2]=u[2]+886263092+(u[1]>>>0<l[1]>>>0?1:0)|0,u[3]=u[3]+1295307597+(u[2]>>>0<l[2]>>>0?1:0)|0,u[4]=u[4]+3545052371+(u[3]>>>0<l[3]>>>0?1:0)|0,u[5]=u[5]+886263092+(u[4]>>>0<l[4]>>>0?1:0)|0,u[6]=u[6]+1295307597+(u[5]>>>0<l[5]>>>0?1:0)|0,u[7]=u[7]+3545052371+(u[6]>>>0<l[6]>>>0?1:0)|0,this._b=u[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var _=d[p]+u[p],g=_&65535,b=_>>>16,m=((g*g>>>17)+g*b>>>15)+b*b,O=((_&4294901760)*_|0)+((_&65535)*_|0);h[p]=m^O}d[0]=h[0]+(h[7]<<16|h[7]>>>16)+(h[6]<<16|h[6]>>>16)|0,d[1]=h[1]+(h[0]<<8|h[0]>>>24)+h[7]|0,d[2]=h[2]+(h[1]<<16|h[1]>>>16)+(h[0]<<16|h[0]>>>16)|0,d[3]=h[3]+(h[2]<<8|h[2]>>>24)+h[1]|0,d[4]=h[4]+(h[3]<<16|h[3]>>>16)+(h[2]<<16|h[2]>>>16)|0,d[5]=h[5]+(h[4]<<8|h[4]>>>24)+h[3]|0,d[6]=h[6]+(h[5]<<16|h[5]>>>16)+(h[4]<<16|h[4]>>>16)|0,d[7]=h[7]+(h[6]<<8|h[6]>>>24)+h[5]|0}r.Rabbit=n._createHelper(c)})(),i.Rabbit})}),GA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Rl(),Dl(),ko(),jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.StreamCipher,a=r.algo,o=[],l=[],h=[],c=a.RabbitLegacy=n.extend({_doReset:function(){var d=this._key.words,u=this.cfg.iv,p=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],_=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var g=0;g<4;g++)f.call(this);for(var g=0;g<8;g++)_[g]^=p[g+4&7];if(u){var b=u.words,m=b[0],O=b[1],y=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,x=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,E=y>>>16|x&4294901760,w=x<<16|y&65535;_[0]^=y,_[1]^=E,_[2]^=x,_[3]^=w,_[4]^=y,_[5]^=E,_[6]^=x,_[7]^=w;for(var g=0;g<4;g++)f.call(this)}},_doProcessBlock:function(d,u){var p=this._X;f.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var _=0;_<4;_++)o[_]=(o[_]<<8|o[_]>>>24)&16711935|(o[_]<<24|o[_]>>>8)&4278255360,d[u+_]^=o[_]},blockSize:128/32,ivSize:64/32});function f(){for(var d=this._X,u=this._C,p=0;p<8;p++)l[p]=u[p];u[0]=u[0]+1295307597+this._b|0,u[1]=u[1]+3545052371+(u[0]>>>0<l[0]>>>0?1:0)|0,u[2]=u[2]+886263092+(u[1]>>>0<l[1]>>>0?1:0)|0,u[3]=u[3]+1295307597+(u[2]>>>0<l[2]>>>0?1:0)|0,u[4]=u[4]+3545052371+(u[3]>>>0<l[3]>>>0?1:0)|0,u[5]=u[5]+886263092+(u[4]>>>0<l[4]>>>0?1:0)|0,u[6]=u[6]+1295307597+(u[5]>>>0<l[5]>>>0?1:0)|0,u[7]=u[7]+3545052371+(u[6]>>>0<l[6]>>>0?1:0)|0,this._b=u[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var _=d[p]+u[p],g=_&65535,b=_>>>16,m=((g*g>>>17)+g*b>>>15)+b*b,O=((_&4294901760)*_|0)+((_&65535)*_|0);h[p]=m^O}d[0]=h[0]+(h[7]<<16|h[7]>>>16)+(h[6]<<16|h[6]>>>16)|0,d[1]=h[1]+(h[0]<<8|h[0]>>>24)+h[7]|0,d[2]=h[2]+(h[1]<<16|h[1]>>>16)+(h[0]<<16|h[0]>>>16)|0,d[3]=h[3]+(h[2]<<8|h[2]>>>24)+h[1]|0,d[4]=h[4]+(h[3]<<16|h[3]>>>16)+(h[2]<<16|h[2]>>>16)|0,d[5]=h[5]+(h[4]<<8|h[4]>>>24)+h[3]|0,d[6]=h[6]+(h[5]<<16|h[5]>>>16)+(h[4]<<16|h[4]>>>16)|0,d[7]=h[7]+(h[6]<<8|h[6]>>>24)+h[5]|0}r.RabbitLegacy=n._createHelper(c)})(),i.RabbitLegacy})}),zA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Rl(),Dl(),ko(),jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.BlockCipher,a=r.algo;let o=16,l=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],h=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var c={pbox:[],sbox:[]};function f(g,b){let m=b>>24&255,O=b>>16&255,y=b>>8&255,x=b&255,E=g.sbox[0][m]+g.sbox[1][O];return E=E^g.sbox[2][y],E=E+g.sbox[3][x],E}function d(g,b,m){let O=b,y=m,x;for(let E=0;E<o;++E)O=O^g.pbox[E],y=f(g,O)^y,x=O,O=y,y=x;return x=O,O=y,y=x,y=y^g.pbox[o],O=O^g.pbox[o+1],{left:O,right:y}}function u(g,b,m){let O=b,y=m,x;for(let E=o+1;E>1;--E)O=O^g.pbox[E],y=f(g,O)^y,x=O,O=y,y=x;return x=O,O=y,y=x,y=y^g.pbox[1],O=O^g.pbox[0],{left:O,right:y}}function p(g,b,m){for(let w=0;w<4;w++){g.sbox[w]=[];for(let S=0;S<256;S++)g.sbox[w][S]=h[w][S]}let O=0;for(let w=0;w<o+2;w++)g.pbox[w]=l[w]^b[O],O++,O>=m&&(O=0);let y=0,x=0,E=0;for(let w=0;w<o+2;w+=2)E=d(g,y,x),y=E.left,x=E.right,g.pbox[w]=y,g.pbox[w+1]=x;for(let w=0;w<4;w++)for(let S=0;S<256;S+=2)E=d(g,y,x),y=E.left,x=E.right,g.sbox[w][S]=y,g.sbox[w][S+1]=x;return!0}var _=a.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,b=g.words,m=g.sigBytes/4;p(c,b,m)}},encryptBlock:function(g,b){var m=d(c,g[b],g[b+1]);g[b]=m.left,g[b+1]=m.right},decryptBlock:function(g,b){var m=u(c,g[b],g[b+1]);g[b]=m.left,g[b+1]=m.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=n._createHelper(_)})(),i.Blowfish})}),HA=kt((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Xt(),Sp(),OA(),mA(),Rl(),yA(),Dl(),Z2(),hm(),bA(),K2(),xA(),vA(),EA(),cm(),TA(),ko(),jr(),wA(),SA(),IA(),PA(),AA(),CA(),NA(),LA(),RA(),DA(),MA(),BA(),kA(),UA(),FA(),GA(),zA()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./enc-base64url","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy","./blowfish"],r):i.CryptoJS=r(i.CryptoJS)})(e,function(i){return i})}),jA=(e=>(e.Device="Device",e.Symbol="Symbol",e.Footprint="Footprint",e.OBJ="OBJ",e.ModelID="3D Model",e.ModelName="3D Model Title",e.OriginModelName="Origin 3D Model Title",e.ModelTransform="3D Model Transform",e.OriginFootprint="Origin Footprint",e))(jA||{}),xu=(e=>(e.DOCHEAD="DOCHEAD",e.EDIT_HEAD="EDIT_HEAD",e.SCH="SCH",e.SCH_PAGE="SCH_PAGE",e.PCB="PCB",e.PANEL="PANEL",e.PANEL_LIB="PANEL_LIB",e.SYMBOL="SYMBOL",e.FOOTPRINT="FOOTPRINT",e.DEVICE="DEVICE",e.BLOB="BLOB",e.INSTANCE="INSTANCE",e.CONFIG="CONFIG",e.BOARD="BOARD",e.FONT="FONT",e.VARIANT="VARIANT",e.COMPONENT_GROUP="COMPONENT_GROUP",e.COMPONENT_GROUP_DATA="COMPONENT_GROUP_DATA",e.SIMULATION="SIMULATION",e))(xu||{}),YA=(e=>(e.META="META",e.META_SORT="META_SORT",e.META_CREATE="META_CREATE",e.META_MODIFY="META_MODIFY",e.FONT="FONT",e.BLOB="BLOB",e.MAX_NUM="MAX_NUM",e.INSTANCE_ATTR="INSTANCE_ATTR",e.DELETE_DOC="DELETE_DOC",e.META_Z_INDEX="META_Z_INDEX",e.VARIANT_GROUPED="VARIANT_GROUPED",e.GROUP_INDEX="GROUP_INDEX",e.GROUP_DATA="GROUP_DATA",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.META_PLACEHOLDER="META_PLACEHOLDER",e))(YA||{}),wn="||",Wi=`|
`;function vu(e,t,i){return e.slice(t,i)}function sp(e,t,i){let r=e.length,s=0;for(;s<r;){let n=e.indexOf(Wi,s);if(n<0){if(i)return e.substring(s);n=r}let a=vu(e,s,n);try{if(a){let o=a.indexOf(wn),l=o>-1,h=l?vu(a,0,o):a,c=l?vu(a,o+wn.length):"";if(t(h,c,a,l?s+o+wn.length:s)===!1){a=null;break}a=null}}catch(o){console.error(o)}s=n+Wi.length}e=null}var VA=["SYMBOL","FOOTPRINT","BLOB","FONT","PANEL_LIB","DEVICE","BOARD","INSTANCE","CONFIG","VARIANT","COMPONENT_GROUP","COMPONENT_GROUP_DATA"];function cO(e,t){return VA.includes(t)?t:e}var qA=class{parseFull(e,t,i){let r=t,s=i,n,a=null;sp(e,(o,l,h)=>{let c=JSON.parse(o);if(c.type==="EDIT_HEAD")a=JSON.parse(l),this.onEditHead&&this.onEditHead(a);else if(c.type==="DOCHEAD"){let f=JSON.parse(l);s=f.docType,r=f.uuid,n=f.client,f.ticket=c.ticket,this.onDocHead(f,a,h)}else this.onLine(c.id,c.ticket,l,c.type,c.client||n,s,r,c.firstTicket,c.pend,a,c.num,h)}),this.onEnd(),e=null}flowParseFull(e={}){let{cache:t,chunkLength:i=100*1024*1024,idsData:r,history:s}=e,n="",a=null,o,l=null,h=!0,c="",f=0,d=!1,u={},p=t?{}:void 0,_=m=>{p[m]===void 0&&(p[m]=-1),t(m,++p[m],u[m].data.join(Wi)),u[m].data.length=0,u[m].size=0,u[m].data.push(u[m].head),u[m].size+=u[m].head.length},g=m=>{let O=cO(n,a);t&&(u[O].data.push(m),u[O].size+=(u[O].size?Wi.length:0)+m.length,u[O].size+m.length>i&&_(O))},b=(m,O)=>sp(m,(y,x,E,w)=>{var C,R,B,Y,G,z,q,L;let S=JSON.parse(y);if(S.type==="EDIT_HEAD")l=JSON.parse(x),(C=this.onEditHead)==null||C.call(this,l),(R=e.onEditHead)==null||R.call(e,l),d=!0;else if(S.type==="DOCHEAD"){let M=JSON.parse(x);a=M.docType,n=M.uuid,o=M.client,M.ticket=S.ticket,d||(l={uuid:M.uuid,username:(B=M==null?void 0:M.user)==null?void 0:B.username,nickname:(Y=M==null?void 0:M.user)==null?void 0:Y.nickname,updateTime:M==null?void 0:M.updateTime},(G=e.onEditHead)==null||G.call(e,l),d=!0),this.onDocHead(M,l,E);let v=cO(n,a);t&&!u[v]&&(u[v]={size:0,data:[],head:""}),t&&(u[v].head=E),g(E)}else{let M=S.num,v=S.client||o;if(r){let P=(L=(q=(z=r.ids)==null?void 0:z[n])==null?void 0:q[v])==null?void 0:L[S.id];if(!P||P[0]!==S.ticket)return;M=P[1],r.size-=1,delete r.ids[n][v][S.id]}if(s){let P=cO(n,a);t&&(s.dNum=(p==null?void 0:p[P])===void 0?0:(p==null?void 0:p[P])+1),s.start=t?u[P].size+Wi.length+y.length+wn.length:f+w}this.onLine(S.id,S.ticket,x,S.type,v,a,n,S.firstTicket,S.pend,l||(s==null?void 0:s.editHead),M,E,s),g(E)}},O);return{start:()=>{h=!0},end:()=>{if(c&&b(c,!1),t)for(let m in u)u[m].size&&u[m].data.length>1&&_(m),u[m]=null;h=!1,c="",n="",n=null,o="",l=null,this.onEnd()},update:m=>{if(!h)throw new Error("\u66F4\u65B0\u524D\u672A\u8C03\u7528 start \u65B9\u6CD5");let O=b(c+m,!0);f=f+c.length+m.length-((O==null?void 0:O.length)||0),c="",O&&(c=O)},docMap:p}}parseLine(e,t,i){let r=e.indexOf(wn),s=r!==-1,n=s?vu(e,0,r):e,a=s?vu(e,r+wn.length):"",o=JSON.parse(n);this.onLine(o.id,o.ticket,a,o.type,o.client,i,t,o.firstTicket,o.pend,void 0,o.num,e),e=null}onEditHead(e){}},uO=new Uint8Array(8);function ps(){crypto.getRandomValues(uO);let e="";for(let t=0;t<uO.length;t++)e+=uO[t].toString(16).padStart(2,"0");return e}function wl(e,t,i,r,s,n,a){let o={docType:e,client:t,uuid:i};return(r||r===0)&&(o.updateTime=r),(s||o.updateTime||o.updateTime===0)&&(o.version=s||String(r)),n&&(o.user=n),`${JSON.stringify({type:"DOCHEAD",ticket:a})}${wn}${JSON.stringify(o)}`}function Ds(e,t,i,r,s,n,a,o){let l={type:e,ticket:t,id:i};return n!==void 0&&(l.firstTicket=n),a!==void 0&&(l.pend=a),o!==void 0&&(l.num=o),s&&(l.client=s),`${JSON.stringify(l)}${wn}${r}`}var $2=class extends qA{constructor(e){super(),this.unique=ps(),this.maxTicket=0,this.isPendChange=!0,this.isLocalChange=!0,this.cbArr=[],this.tempLocalIds={},this.client=e||ps()}onLine(e,t,i,r,s,n,a,o,l,h,c){this.remoteChange(t,s,a,e,i,r,n,void 0,o,l,h,void 0,void 0,c)}getUnique(){return this.unique}setUnique(e){this.unique=e}onDocHead(e,t){}onEnd(){}setIsPendChange(e){this.isPendChange=e}getIsPendChange(){return this.isPendChange}getMaxTicket(){return this.maxTicket}setMaxTicket(e,t){e&&(t||this.maxTicket<e)&&(this.maxTicket=e)}setIsLocalChange(e){this.isLocalChange=e}getIsLocalChange(){return this.isLocalChange}revoke(e,t,i,r,s,n,a,o,l,h,c){var f;if(!((f=this.tempLocalIds[e])!=null&&f[t]))return c?c(t,s,i,a,`${r}-1`,e,n,void 0,void 0,!0,h):this.cbArr.forEach(d=>d(e,t,i,a,`${r}-1`,s,void 0,n,void 0,void 0,void 0,h)),!0}getRandomUuid(){return ps()}getClient(){return this.client}onChange(e){this.cbArr.push(e)}localChange(e,t,i,r,s,n){let a=this.maxTicket+1;return this.tempLocalIds[e]||(this.tempLocalIds[e]={}),this.tempLocalIds[e][t]=[this.getClient(),a],this.remoteChange(a,this.client,e,t,i,r,s,!0,void 0,!0,void 0,this.unique,void 0,n),a}remoteChange(e,t,i,r,s,n,a,o,l,h,c,f,d,u){var m;this.setMaxTicket(e);let p=f===this.unique,_=o||p,g=(!_||_&&this.isLocalChange)&&(!d||d&&this.isPendChange),b=(m=this.tempLocalIds[i])==null?void 0:m[r];!o&&p?b?(g=!1,b[0]===t&&b[1]===e&&delete this.tempLocalIds[i][r]):g=!0:!o&&b&&(b[1]>e||b[1]===e&&b[0]>t?g=!1:delete this.tempLocalIds[i][r]),g&&this.cbArr.forEach(O=>O(i,r,s,n,t,e,l,h,void 0,d,f,u))}};var um=/^(?:ie|e)(\d+)$/;function wu(e){let t=e.match(um);return t?Number(t[1]):null}function Mt(e){if(!e||typeof e!="string")return e;let t=e.match(/(?:ie|e)\d+/g);return t&&t.length===2&&t.join("")===e?t.join("-"):e}function Ur(e){return e&&typeof e=="number"&&!isNaN(e)?-e:e}function XA(e,t){let i=[];for(let r=0;r<e.length;r+=2){let s={x:e[r],y:t?Ur(e[r+1]):e[r+1]};i.push(s)}return i}function Rs(e,t){return JSON.stringify([t,e])}function Eo(e){try{let t=JSON.parse(e);return typeof t=="string"?e:t[1]}catch{return e}}var WA=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.POLY="POLY",e.STRING="STRING",e.AUX_LINE="AUXLINE",e.DIMENSION="DIMENSION",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(WA||{}),JA=(e=>(e.META="META",e.CANVAS="CANVAS",e.LAYER="LAYER",e.LAYER_PHYS="LAYER_PHYS",e.ACTIVE_LAYER="ACTIVE_LAYER",e.PARTITION="PARTITION",e.NET="NET",e.PRIMITIVE="PRIMITIVE",e.GROUP="GROUP",e.SILK_OPTS="SILK_OPTS",e.PREFERENCE="PREFERENCE",e.VIA="VIA",e.PAD="PAD",e.LINE="LINE",e.ARC="ARC",e.OBJ="OBJ",e.EQLEN_GRP="EQLEN_GRP",e.POLY="POLY",e.FILL="FILL",e.LAYER_FILL="LAYER_FILL",e.REGION="REGION",e.POUR="POUR",e.POURED="POURED",e.IMAGE="IMAGE",e.TEARDROP="TEARDROP",e.FPC_FILL="FPC_FILL",e.SHELL="SHELL",e.CREASE="CREASE",e.SHELLCUT="SHELLCUT",e.SHELL_ENTITY="SHELL_ENTITY",e.BOSS="BOSS",e.STRING="STRING",e.ATTR="ATTR",e.DIMENSION="DIMENSION",e.COMPONENT="COMPONENT",e.PAD_NET="PAD_NET",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.PANELIZE="PANELIZE",e.BOARD="BOARD",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(JA||{}),ZA=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.ATTR="ATTR",e.LINE="LINE",e.WIRE="WIRE",e.BUS="BUS",e.TEXT="TEXT",e.POLY="POLY",e.CIRCLE="CIRCLE",e.ARC="ARC",e.BUSENTRY="BUSENTRY",e.RECT="RECT",e.MASK_REGION="MASK_REGION",e.PIN="PIN",e.OBJ="OBJ",e.COMPONENT="COMPONENT",e.PART="PART",e.ELLIPSE="ELLIPSE",e.BEZIER="BEZIER",e.TABLE="TABLE",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.NG_SETTING="NG_SETTING",e))(ZA||{});var KA=["PARTITION","VIA","PAD","LINE","ARC","OBJ","POLY","FILL","REGION","POUR","POURED","IMAGE","TEARDROP","FPC_FILL","SHELL","CREASE","SHELLCUT","SHELL_ENTITY","BOSS","STRING","ATTR","DIMENSION","COMPONENT"];var $A=(e=>(e.SOLID="SOLID",e.SHORT_DASH="SHORT_DASH",e.DOT="DOT",e.DOT_DASH="DOT_DASH",e))($A||{}),QA=(e=>(e.PRINT="PRINT",e.COVER="COVER",e.PRINT_AND_COVER="PRINT&COVER",e))(QA||{}),eC=(e=>(e.LEFT="LEFT",e.CENTER="CENTER",e.RIGHT="RIGHT",e))(eC||{}),tC=(e=>(e.TOP="TOP",e.MIDDLE="MIDDLE",e.BOTTOM="BOTTOM",e))(tC||{}),iC=(e=>(e.LEFT_BOTTOM="LEFT_BOTTOM",e.CENTER_BOTTOM="CENTER_BOTTOM",e.RIGHT_BOTTOM="RIGHT_BOTTOM",e.LEFT_MIDDLE="LEFT_MIDDLE",e.CENTER_MIDDLE="CENTER_MIDDLE",e.RIGHT_MIDDLE="RIGHT_MIDDLE",e.LEFT_TOP="LEFT_TOP",e.CENTER_TOP="CENTER_TOP",e.RIGHT_TOP="RIGHT_TOP",e))(iC||{}),rC=(e=>(e.NONE="NONE",e.SOLID="SOLID",e.GRID="GRID",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e.RHOMBIC="RHOMBIC",e.LEFT_SLASH_LINE="LEFT_SLASH_LINE",e.RIGHT_SLASH_LINE="RIGHT_SLASH_LINE",e))(rC||{}),sC=(e=>(e.NONE="NONE",e.CLOCK="CLOCK",e.INVERTED="INVERTED",e.INVERTED_CLOCK="INVERTED_CLOCK",e))(sC||{}),nC=(e=>(e.NONE="NONE",e.GRID="GRID",e.OUTLETS="OUTLETS",e))(nC||{}),aC=(e=>(e.NONE="NONE",e.PUSH="PUSH",e.SURROUND="SURROUND",e.OBSTRUCT="OBSTRUCT",e.SURROUND_AND_PUSH="SURROUND&PUSH",e))(aC||{}),oC=(e=>(e.ELLIPSE="ELLIPSE",e.RECT="RECT",e.OVAL="OVAL",e.POLYGON="POLYGON",e))(oC||{}),lC=(e=>(e.ROUND="ROUND",e.RECT="RECT",e.SLOT="SLOT",e))(lC||{}),hC=(e=>(e.SOLID="SOLID",e.GRID_LINE="GRID_LINE",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e))(hC||{}),cC=(e=>(e.ALL="ALL",e.PAD="PAD",e.VIA="VIA",e))(cC||{}),uC=(e=>(e.NONE="NONE",e.SINGLE="SINGLE",e.ALL="ALL",e))(uC||{}),dC=(e=>(e.OPTIMIZA_OPEN="OPTIMIZA_OPEN",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(dC||{}),fC=(e=>(e.OPTIMIZA_STRONG="OPTIMIZA_STRONG",e.OPTIMIZA_WEAK="OPTIMIZA_WEAK",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(fC||{}),pC=(e=>(e.L45="L45",e.L90="L90",e.L="L",e.R45="R45",e.R90="R90",e.R="R",e))(pC||{}),_C=(e=>(e.NORMAL="NORMAL",e.BLIND="BLIND",e.SUTURE="SUTURE",e))(_C||{}),gC=(e=>(e.NORMAL="NORMAL",e.TEST="TEST",e.MARKER="MARKER",e))(gC||{}),OC=(e=>(e.DIVERGENCE="DIVERGENCE",e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(OC||{}),mC=(e=>(e.DOT="DOT",e.CENTER="CENT",e))(mC||{}),yC=(e=>(e.NORMAL="NORMAL",e.BOARD_OUTLINE="BOARD_OUTLINE",e))(yC||{}),bC=(e=>(e.SOLID="SOLID",e.GRID="GRID",e.PLANE="PLANE",e))(bC||{}),xC=(e=>(e.PROHIBIT="PROHIBIT",e.CONSTRAINT="CONSTRAINT",e))(xC||{}),vC=(e=>(e.COMPONENT="COMPONENT",e.VIA="VIA",e.TRACK="TRACK",e.FILL="FILL",e.COPPER="COPPER",e.PLANE="PLANE",e))(vC||{}),EC=(e=>(e.PI="Polyimide",e.FR4="FR4",e.STEEL_SHEET="Stainless Steel",e.M3_DOUBLE_SIDED_TAPE="3M Tape",e.EMI_SHIELDING_FILM="EMI Shielding Film",e))(EC||{}),TC=(e=>(e.PUSH_COVER="DRAWER",e.UPPER_LOWER_SHELLS="T&B",e))(TC||{}),wC=(e=>(e.X_AXIS_POSITIVE="X_AXIS_POSITIVE",e.X_AXIS_NEGATIVE="X_AXIS_NEGATIVE",e.Y_AXIS_POSITIVE="Y_AXIS_POSITIVE",e.Y_AXIS_NEGATIVE="Y_AXIS_NEGATIVE",e))(wC||{}),SC=(e=>(e.SLOT="SLOT",e.ENTITY="ENTITY",e))(SC||{}),IC=(e=>(e.AUTO="AUTO",e.UPPER_SHELLS="UPPER_SHELLS",e.LOWER_SHELLS="LOWER_SHELLS",e))(IC||{}),PC=(e=>(e.OUTLINE="OUTLINE",e.SCREW_PILLAR="SCREW_PILLAR",e.ENTITY="ENTITY",e))(PC||{}),AC=(e=>(e.M2="M2",e.M3="M3",e.M4="M4",e.M5="M5",e.M6="M6",e))(AC||{}),CC=(e=>(e.LENGTH="LENGTH",e.RADIUS="RADIUS",e.ANGLE="ANGLE",e))(CC||{}),NC=(e=>(e.MIL="mil",e.INCH="inch",e.CM="cm",e.MM="mm",e))(NC||{}),LC=(e=>(e.SAFE="SAFE",e.OTHER="OTHER",e.TRACK="TRACK",e.BLIND="BLIND",e.RADIUS="RADIUS",e.PLANE="PLANE",e.COPPER="COPPER",e.PASTE="PASTE",e.SOLDER="SOLDER",e.DIFFER_ENTAIL="DIFFER_ENTAIL",e.NET_LENGTH="NET_LENGTH",e.AUTO_ROUTER="AUTO_ROUTER",e.NET_LENGTH_TOLERANCE="NET_LENGTH_TOLERANCE",e))(LC||{}),RC=(e=>(e.NORMAL="NORMAL",e.DEFAULT="DEFAULT",e))(RC||{}),DC=(e=>(e.ALL="ALL",e.LAYERED="LAYERED",e))(DC||{}),MC=(e=>(e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(MC||{}),BC=(e=>(e.FORTY_FIVE="L45",e.NINETY="L90",e.NINETY_ARC="A90",e))(BC||{}),kC=(e=>(e.LESS="LESS",e.MID="MID",e.MORE="MORE",e))(kC||{}),UC=(e=>(e.SPEED_FIRST="SPEED_FIRST",e.COMPLETION_FIRST="COMPLETION_FIRST",e))(UC||{}),FC=(e=>(e.DesignRule="DesignRule",e.Board="Board",e.SlotRegion="SlotRegion",e.ProhibitedRegion="ProhibitedRegion",e.ConstraintRegion="ConstraintRegion",e.Component="Component",e.Track="Track",e.TestPoint="TestPoint",e.Pad="Pad",e.Via="Via",e.SutureHole="SutureHole",e.Text="Text",e.ColorfulImage="ColorfulImage",e.Image="Image",e.FPCStiffener="FPCStiffener",e.Dimension="Dimension",e.CopperRegion="CopperRegion",e.FillRegion="Fill Region",e.Line="Line",e.Teardrop="Teardrop",e.D3Shell="D3Shell",e))(FC||{}),GC=Gh(HA());function kO(e,t,i,r,s,n,a,o){return JSON.stringify([e||"",t||"",i,r,s?1:0,n?1:0,a?1:0,o])}function zC(e){let t=JSON.parse(e);return{text:t[0],fontFamily:t[1],fontSize:t[2],thickness:t[3],bold:!!t[4],italic:!!t[5],reverse:!!t[6],expansion:t[7]}}function Ip(e){return GC.default.SHA256(e).toString()}function HC(e,t){let i=[],r=[],s={};sp(e,(h,c)=>{let f=JSON.parse(h);if(f.type==="DOCHEAD"||f.type==="META"||f.type==="META_CREATE"||f.type==="META_MODIFY"||f.type==="ELE_PLACEHOLDER"||f.type==="ELE_PLACEHOLDER"||f.type==="ELE_PLACEHOLDER")return;let{id:d}=f;s[d]=Object.assign(f,{data:c})});let n={};sp(t,(h,c="")=>{let f=JSON.parse(h);if(f.type==="BLOB")i.push(h+wn+c);else if(f.type==="FONT")r.push(h+wn+c);else{if(f.type==="DOCHEAD"||f.type==="META_MODIFY")return;let{id:d}=f;n[d]=Object.assign(f,{data:c})}});let a={},o={},l={};for(let h in s)if(!n.hasOwnProperty(h))o[h]=s[h];else{let{ticket:c}=s[h],{type:f,data:d,client:u}=n[h];a[h]={type:f,ticket:c,data:d,client:u},delete n[h]}for(let h in n){let{type:c,data:f,ticket:d,client:u}=n[h];l[h]={type:c,data:f,ticket:d,client:u}}return{delete:o,cover:a,add:l,blobs:i,fonts:r}}function dO(e,t,i){let{docType:r,uuid:s,client:n,updateTime:a,version:o,user:l,ticket:h}=i,c=[wl(r,n,s,a,o,l,h)],{delete:f,cover:d,add:u,blobs:p,fonts:_}=HC(e,t);for(let g in f){let{ticket:b,type:m,client:O}=f[g];c.push(Ds(m,b+1,g,"",O))}for(let g in d){let{type:b,ticket:m,data:O,client:y}=d[g];c.push(Ds(b,m+1,g,O,y))}for(let g in u){let{type:b,ticket:m,data:O,client:y}=u[g];c.push(Ds(b,m,g,O,y))}return p.length&&(c.push(wl("BLOB",n,"BLOB",a,o,l,h)),c=c.concat(p)),_.length&&(c.push(wl("FONT",n,"FONT",a,o,l,h)),c=c.concat(_)),c.join(Wi)}var Lq=Gh(Mu());var jC=class{constructor(e,t=1,i=[]){this.consistencyManager=e,this.startNum=t,this.needOrderType=i,this.initIng=!1,this.allOrderNum={},this.maxNum={},this.consistencyManager.onChange((r,s,n,a,o,l,h,c,f,d,u,p)=>{try{this.onParseLine(s,a,n?JSON.parse(n):null,o,l,c,p)}catch(_){console.error(_)}})}setIsInit(e){this.initIng=e}setNeedNum(e){this.needNum=e}setOrderNum(e,t,i){this.needNum&&this.needOrderType&&this.needOrderType.includes(i)&&t!==void 0&&(this.allOrderNum[e]=t,this.setMaxNum(i,t))}deleteOrderNum(e){delete this.allOrderNum[e]}getOrderNum(e){return this.allOrderNum[e]}setMaxNum(e,t,i){(i||this.maxNum[e]===void 0||this.maxNum[e]<t)&&(this.maxNum[e]=t)}getMaxNum(e){return this.maxNum[e]===void 0&&(this.maxNum[e]=this.startNum-1),++this.maxNum[e]}};function Q2(e){switch(e=String(e),e){case"1":return"SAFE";case"2":return"OTHER";case"3":return"TRACK";case"4":return"BLIND";case"5":return"RADIUS";case"6":return"PLANE";case"7":return"COPPER";case"8":return"PASTE";case"9":return"SOLDER";case"10":return"DIFFER_ENTAIL";case"11":return"NET_LENGTH";case"12":return"AUTO_ROUTER";case"13":return"NET_LENGTH_TOLERANCE"}return e}function bh(e){if(!e)return{};let t=["1","2","3","4","5","6","7","8","9","10","11","12","13"];for(let i of t)if(e.hasOwnProperty(i)){let r=e[i];delete e[i],e[Q2(i)]=r}return e}var YC=(e=>(e[e.TRACK=0]="TRACK",e[e.SMDPad=1]="SMDPad",e[e.THPad=2]="THPad",e[e.SMD_Test_Point=3]="SMD_Test_Point",e[e.TH_Test_Point=4]="TH_Test_Point",e[e.VIA=5]="VIA",e[e.REGION=6]="REGION",e[e.PLANE=7]="PLANE",e[e.SLOT=8]="SLOT",e[e.LINE=9]="LINE",e[e.OTHER=10]="OTHER",e[e.SHEETFRAME=11]="SHEETFRAME",e[e.Hole=12]="Hole",e[e.Copper=13]="Copper",e[e.Inner=14]="Inner",e[e.PROHIBITAREA=15]="PROHIBITAREA",e[e.COMPONENT=16]="COMPONENT",e))(YC||{}),Hy=class{constructor(){this.init=!1,this.defaultSafeData=null,this.defaultCopperSpace=null,this.defaultInnerSpace=null,this.copperChangeMap=new Map,this.innerChangeMap=new Map}addDefaultSafeSpaceData(e){this.init=!0,this.defaultSafeData=e}addDefaultCopperSpace(e,t){this.defaultCopperSpace={netClearance:e,boardClearance:t}}addDefaultInnerSpace(e,t){this.defaultInnerSpace={netClearance:e,boardClearance:t}}getNewDefaultData(e,t){if(e&&this.defaultSafeData==null||!e&&this.defaultInnerSpace==null)return null;let i=e?this.copperChangeMap.get(t):this.innerChangeMap.get(t);if(i==null)return null;let{netClearance:r,boardClearance:s}=i,n=this.defaultSafeData.safeSpacing[0].content,a=new Array(n.length);for(let o=0;o<n.length;o++)a[o]=Array.from(n[o]);return this.updateSafeData(a,r,s),a}fixSafeData(e){if(this.defaultCopperSpace!=null)for(let t of e.safeSpacing)this.updateSafeData(t.content,this.defaultCopperSpace.netClearance,this.defaultCopperSpace.netClearance)}updateSafeData(e,t,i){for(let r=0;r<e.length;r++){let s=e[r];for(let n=0;n<s.length;n++)r==7?n==11||n==8?s[n]=i:s[n]=t:n==7&&(r==11||r==8?s[n]=i:s[n]=t)}}addCopper2SafeChangeMap(e,t,i,r,s){this.copperChangeMap.set(e,{name:t,isDefault:i,netClearance:r,boardClearance:s})}addInner2SafeChangeMap(e,t,i,r,s){this.innerChangeMap.set(e,{name:t,isDefault:i,netClearance:r,boardClearance:s})}getSafeName4Copper(e){var t;return(t=this.copperChangeMap.get(e))==null?void 0:t.name}getSafeName4Plane(e){var t;return(t=this.innerChangeMap.get(e))==null?void 0:t.name}getDefaultCopper(){for(let[,e]of this.copperChangeMap)if(e.isDefault)return e.name;return null}getDefaultPlane(){for(let[,e]of this.innerChangeMap)if(e.isDefault)return e.name;return null}};function jy(e,t){let i=e,r={TWO_LAYERS_BOARD:"JLCPCB Capability(Two Layers Board)",SINGLE_LAYER_BOARD:"JLCPCB Capability(Single Layer Board)",MULTIPLE_LAYERS_BOARD:"JLCPCB Capability(Multiple Layers Board)",HIGH_FREQUENCY_BOARD:"JLCPCB Capability(High Frequency Board)",ALUMINUM_SUBSTRATE_BOARD:"JLCPCB Capability(Aluminum Substrate Board)",COPPER_SUBSTRATE_BOARD:"JLCPCB Capability(Copper Substrate Board)"};if(i.length==8){Object.values(r).includes(t)&&(i[4][0]=11.811,i[5][4]=11.811),i.splice(1,0,i[1].slice(0));for(let n=2;n<i.length;n++)i[n].splice(1,0,i[n][1]);i.push([].concat(i[1][0],i.slice(1).map(n=>n[1])))}i[1].push(i[1][i[1].length-1]),i.splice(3,0,[...i[1]]),i.splice(4,0,[...i[2]]),i[1].pop();for(let n=5;n<i.length;n++)i[n].splice(3,0,i[n][1]),i[n].splice(4,0,i[n][2]);i[3][3]=i[1][1],i[4][3]=i[2][1],i[4][4]=i[2][2];let s=6;i.splice(7,0,new Array(7).fill(s));for(let n=7;n<i.length;n++)i[n].splice(7,0,s);return i}function VC(e,t){let i=e[0],r=e[1],s=[],n="ALL";if(r instanceof Array){let a=jy(r,t);s.push({layerId:1,isOpen:!0,content:a})}else{for(let a in r){let o=r[a],l=jy(o,t);s.push({layerId:+a,isOpen:!0,content:l})}Object.keys(r).length>1&&(n="LAYERED")}return{unit:i,isForAll:n,safeSpacing:s}}function qC(e){let t=e[0],i=e[1],r=e[2];isNaN(r)&&(r=0);let s=e[3];return isNaN(s)&&(s=11.8),{unit:t,deviceClearance:i,thru2SmdClearance:r,holeClearance:s}}function XC(e){let t=e[0],i=e[1],r=!0,s=[];if(i instanceof Object)for(let n in i){let a=i[n];s.push({layerId:+n,stroMin:a[0],stroDef:a[1],stroMax:a[2]})}else s.push({layerId:1,stroMin:e[1],stroDef:e[2],stroMax:e[3]});return{unit:t,track:{isOpen:r,content:s}}}function WC(e){return{unit:e[0],netLenMin:e[1],netLenMax:e[2]}}function JC(e){return{unit:e[0],netLengthTolerance:e[1]}}function ZC(e){let t=e[0],i=e[1],r=!0,s=[],n=[],a=0;if(i instanceof Object)for(let o in i){let l=i[o],{stroke:h,spacing:c,lenTolerMax:f}=l;s.push({layerId:+o,stroMin:h[0],stroDef:h[1],stroMax:h[2]}),n.push({layerId:+o,spacMin:c[0],spacDef:c[1]}),a=f}else s.push({layerId:1,stroMin:e[1],stroDef:e[2],stroMax:e[3]}),n.push({layerId:1,spacMin:e[4],spacDef:e[5]}),a=e[7];return{unit:t,stroWidth:{isOpen:r,content:s},spacing:{isOpen:r,content:n},differPairLenTolerMax:a}}function KC(e){let t=new Array;for(let i of e){let r=+i[1],s=+i[2];isNaN(r)||r<=0||isNaN(s)||s<=0||r===s||r===1&&s===2||r===2&&s===1||t.push({name:i[0],staLayerId:r,endLayerId:s,viaSizeRule:i[3]})}return{blinds:{content:t}}}function $C(e){return{unit:e[0],minRadius:e[1],defRadius:e[2],maxRadius:e[3],minInner:e[4],defInner:e[5],maxInner:e[6]}}function QC(e){let t=[{layerId:1,connType:Nh(e[7]!==void 0?e[7]:e[3]),spoWidth:e[8]!==void 0?e[8]:e[4],spoSpac:e[9]!==void 0?e[9]:e[5],spoAng:e[10]?e[10]:e[6]}];return{unit:e[0],mulPad:{isOpen:!0,content:t}}}function eN(e){let t=[{layerId:1,connType:Nh(e[3]),spoWidth:e[4],spoSpac:e[5],spoAng:e[6]}],i=[{layerId:1,connType:Number(e[7])?"NON_CONNECT":"DIRECT"}],r=[{layerId:1,connType:Nh(e[8]!==void 0?e[8]:e[3]),spoWidth:e[9]!==void 0?e[9]:e[4],spoSpac:e[10]!==void 0?e[10]:e[5],spoAng:e[11]?e[11]:e[6]}];return{unit:e[0],sglPad:{isOpen:!0,content:t},mulPad:{isOpen:!0,content:r},track:{isOpen:!0,content:i}}}function tN(e){return{unit:e[0],padTopExpan:e[1],padBotExpan:e[2],testPointTopExpan:e[3]?e[3]:-1e3,testPointBotExpan:e[4]?e[4]:-1e3}}function iN(e){return{unit:e[0],padTopExpan:e[1],padBotExpan:e[2],viaTopExpan:e[3],viaBotExpan:e[4],testPointTopExpan:e[5]?e[5]:2,testPointBotExpan:e[6]?e[6]:2}}function rN(e){function t(s){switch(s=s&&Number(s),s){case 0:return"L45";case 1:return"L90";case 2:return"A90";default:return"L45"}}function i(s){switch(s=s&&Number(s),s){case 0:return"LESS";case 1:return"MID";case 2:return"MORE";default:return"LESS"}}function r(s){switch(s=s&&Number(s),s){case 0:return"SPEED_FIRST";case 1:return"COMPLETION_FIRST";default:return"COMPLETION_FIRST"}}return{routingCorner:t(e[0]),isKeep:!!e[1],viaQuantity:i(e[2]),routingEffectPriority:r(e[3]),layers:e[5],ignoreNets:e[6]}}function Nh(e){switch(e=e&&Number(e),e){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}function sN(e,t){let i=t;switch(e){case"SAFE":{let r=t;if(r.isForAll=r.isForAll?"LAYERED":"ALL",r.safeSpacing)for(let s of r.safeSpacing)s.isOpen=!!s.isOpen;i=r;break}case"OTHER":break;case"TRACK":{let r=t;r!=null&&r.track&&(r.track.isOpen=!!r.track.isOpen),i=r;break}case"NET_LENGTH":break;case"NET_LENGTH_TOLERANCE":break;case"DIFFER_ENTAIL":{let r=t;r!=null&&r.stroWidth&&(r.stroWidth.isOpen=!!r.stroWidth.isOpen),r!=null&&r.spacing&&(r.spacing.isOpen=!!r.spacing.isOpen),i=r;break}case"BLIND":break;case"RADIUS":break;case"PLANE":{let r=t;if(r!=null&&r.mulPad&&(r.mulPad.isOpen=!!r.mulPad.isOpen),r.mulPad&&r.mulPad.content)for(let s of r.mulPad.content)s.connType=Nh(s.connType);i=r;break}case"COPPER":{let r=t;if(r!=null&&r.sglPad&&(r.sglPad.isOpen=!!r.sglPad.isOpen),r!=null&&r.mulPad&&(r.mulPad.isOpen=!!r.mulPad.isOpen),r!=null&&r.track&&(r.track.isOpen=!!r.track.isOpen),r.track&&r.track.content&&(r.track.content=r.track.content.map(s=>(s.connType=Number(s.connType)?"NON_CONNECT":"DIRECT",s))),r.sglPad&&r.sglPad.content)for(let s of r.sglPad.content)s.connType=Nh(s.connType);if(r.mulPad&&r.mulPad.content)for(let s of r.mulPad.content)s.connType=Nh(s.connType);i=r;break}case"PASTE":break;case"SOLDER":break;case"AUTO_ROUTER":break}return i}function nN(e,t,i,r,s,n){if(!(r instanceof Array))return sN(e,r);let a,o=!1;switch(i&&(i==="NORMAL"?o=!1:i==="DEFAULT"&&(o=!0)),e){case"SAFE":{a=VC(r,n),o&&s.addDefaultSafeSpaceData(a);break}case"OTHER":{a=qC(r);break}case"TRACK":{a=XC(r);break}case"NET_LENGTH":{a=WC(r);break}case"NET_LENGTH_TOLERANCE":{a=JC(r);break}case"DIFFER_ENTAIL":{a=ZC(r);break}case"BLIND":{a=KC(r);break}case"RADIUS":{a=$C(r);break}case"PLANE":{let l=r[1],h=r[2];o&&s.addDefaultInnerSpace(l,h),s.addInner2SafeChangeMap(t,"Plane_"+t,o,l,h),a=QC(r);break}case"COPPER":{let l=r[1],h=r[2];o&&s.addDefaultCopperSpace(l,h),s.addCopper2SafeChangeMap(t,"Copper_"+t,o,l,h),a=eN(r);break}case"PASTE":{a=tN(r);break}case"SOLDER":{a=iN(r);break}case"AUTO_ROUTER":{a=rN(r);break}}return a}function aN(e,t,i,r){if(!r.init)return null;function s(n,a){let o=n?"Copper_":"Plane_",l=["RULE"];l[1]="SAFE",l[2]=o+t,l[3]=0;let h=a.getNewDefaultData(n,t);return h==null?null:(l[4]={unit:a.defaultSafeData.unit,isForAll:"ALL",safeSpacing:[{layerId:1,isOpen:!0,content:h}]},l)}switch(e){case"SAFE":return r.fixSafeData(i),null;case"PLANE":return s(!1,r);case"COPPER":return s(!0,r);default:return null}}function oN(e,t,i,r){if(!r.init)return{ruleKeyValue:i};let s=e[0],n,a;if(t==4){if(s==="NET_CLASS"||s==="NET"){for(let o in i)String(o)==="COPPER"&&(n={COPPER:r.getSafeName4Copper(i[o])}),String(o)==="PLANE"&&(a={PLANE:r.getSafeName4Plane(i[o])});e[1]==""?(n!=null&&n.COPPER||(n={COPPER:"default"}),a!=null&&a.PLANE||(a={PLANE:"default"})):(n!=null&&n.COPPER||(n={COPPER:r.getDefaultCopper()}),a!=null&&a.PLANE||(a={PLANE:r.getDefaultPlane()}))}}else for(let o in i){if(String(o)==="COPPER"){let l=i[o],h=r.getSafeName4Copper(l);if(h==null&&l=="default"&&(h=r.getDefaultCopper()),h==null)continue;n={COPPER:h}}if(String(o)==="PLANE"){let l=i[o],h=r.getSafeName4Plane(l);if(h==null&&l=="default"&&(h=r.getDefaultPlane()),h==null)continue;a={PLANE:h}}}return{ruleKeyValue:i,copperRuleValue:n,innerPlaneRuleValue:a}}function eb(e,t){let i=e.length,r=0;for(;r<i;){let s=e.indexOf(`
`,r);s<0&&(s=i);let n=e.substring(r,s);try{if(t(n)===!1)break}catch(a){console.error(a)}r=s+1}}function lN(e){let t={};return eb(e,i=>{if(i.startsWith('["PAD"')){let r=JSON.parse(i);t[r[5]]||(t[r[5]]=[]),t[r[5]].push(r[1])}}),t}var dm=class{parseFull(e){eb(e,t=>this.onParseLine(JSON.parse(t))),this.onParseEnd()}},hN=(e=>(e[e.pro1=1]="pro1",e[e.pro2=1.1]="pro2",e[e.pro3=1.2]="pro3",e[e.pro4=1.3]="pro4",e[e.pro5=1.4]="pro5",e[e.pro6=1.5]="pro6",e[e.pro7=1.6]="pro7",e[e.pro8=1.7]="pro8",e[e.pro9=1.8]="pro9",e[e.pro=1.8]="pro",e))(hN||{}),cN=class extends dm{constructor(e={},t={},i=[],r=[],s=!1){super(),this.deviceName=e,this.footprintName=t,this.footprints=i,this.devices=r,this.footprintIsConnectDevice=s,this.fontCache=[],this.poured={},this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize={data:[],stamp:{h:null,v:null},size:{h:null,v:null}},this.layerPhys=0,this.fac=new Hy,this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet=new Set,this.oldId={},this.cachePadNet={},this.creaseIds=[],this.stringId={},this.padNumId={},this.componentPadNum={}}getOldId(e){var t;return(t=this.oldId[e])!=null?t:e}handConnect(){for(let e of this.creaseIds)if(this.connects[e])for(let t of this.connects[e])this.connects[t]?this.connects[t].push(e):this.connects[t]=[e]}getConnect(e){return this.connects[e]||[]}transRuleType(e){return Q2(e)}transRuleStatus(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"DEFAULT";default:return"NORMAL"}}transGridType(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"GRID";case 2:return"OUTLETS";default:return"NONE"}}transLayerStatus(e){e=e&&Number(e);let t=!1,i=!1,r=!1;return e!=null&&!isNaN(e)?(e>=4&&(r=!0,e-=4),e>=2&&(i=!0,e-=2),e===1&&(t=!0)):t=!0,{use:t,show:i,locked:r}}transRoutingMode(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"PUSH";case 2:return"SURROUND";case 3:return"OBSTRUCT";case 4:return"SURROUND&PUSH";default:return"NONE"}}transPadDef(e){switch(e==null?void 0:e[0]){case"ELLIPSE":return{padType:"ELLIPSE",width:e[1],height:e[2]};case"RECT":return{padType:"RECT",width:e[1],height:e[2],radius:e[3]};case"OVAL":return{padType:"OVAL",width:e[1],height:e[2]};case"POLYGON":case"POLY":return{padType:"POLYGON",path:e[1]};default:return null}}transHoleDef(e){return e?{holeType:e[0],width:e[1],height:e[2]}:null}transPourDef(e){function t(i){switch(i=i&&Number(i),i){case 0:return"GRID_LINE";case 1:return"HORIZONTAL_LINE";case 2:return"VERTICAL_LINE";default:return"GRID_LINE"}}switch(e==null?void 0:e[0]){case"SOLID":return{pourType:"SOLID",fineness:e[1]};case"LINE":return{pourType:t(e[1]),angle:e[2],strokeWidth:e[3],strokeSpacing:e[4]};default:return null}}transUnusedPadRange(e){switch(e=e&&Number(e),e){case 1:return"ALL";case 2:return"PAD";case 3:return"VIA";default:return"VIA"}}transPathOptimization(e){switch(e=e&&Number(e),e){case 0:return"SINGLE";case 1:return"ALL";case 2:return"NONE";default:return"SINGLE"}}transViaType(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"SUTURE";default:return"NORMAL"}}transPadFuncType(e){switch(e=e&&Number(e),e){case 0:return"NORMAL";case 1:return"TEST";case 2:return"MARKER";default:return"NORMAL"}}transPadConnect(e){switch(e=e&&Number(e),e){case 0:return"DIVERGENCE";case 1:return"DIRECT";case 2:return"NON_CONNECT";default:return null}}transFillStyle(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"GRID";case 2:return"PLANE";default:return null}}transProhibitType(e){let t=new Set;if(!e)return[];for(let i of e)switch(i=i&&Number(i),i){case 1:t.add("TRACK"),t.add("FILL");break;case 2:t.add("COMPONENT");break;case 3:t.add("VIA");break;case 4:t.add("COPPER"),t.add("PLANE");break;case 5:t.add("TRACK");break;case 6:t.add("FILL");break;case 7:t.add("COPPER");break;case 8:t.add("PLANE");break}return Array.from(t)}transPushCoverDir(e){switch(e=e&&Number(e),e){case 1:return"X_AXIS_POSITIVE";case 2:return"X_AXIS_NEGATIVE";case 4:return"Y_AXIS_POSITIVE";case 8:return"Y_AXIS_NEGATIVE";default:return"X_AXIS_POSITIVE"}}transEntityBelong(e){switch(e=e&&Number(e),e){case 0:return"AUTO";case 1:return"UPPER_SHELLS";case 2:return"LOWER_SHELLS";default:return"AUTO"}}transSlotOption(e){e=e&&Number(e);let t=e;if(!t||t<4)return["OUTLINE","SCREW_PILLAR","ENTITY"];let i=[];return t>=16&&(i.push("ENTITY"),t-=16),t>=8&&(i.push("SCREW_PILLAR"),t-=8),t>=4&&(i.push("OUTLINE"),t-=4),i}transAlignType(e){switch(e=e&&Number(e),e){case 1:return"LEFT_TOP";case 4:return"CENTER_TOP";case 7:return"RIGHT_TOP";case 2:return"LEFT_MIDDLE";case 5:return"CENTER_MIDDLE";case 8:return"RIGHT_MIDDLE";case 3:return"LEFT_BOTTOM";case 6:return"CENTER_BOTTOM";case 9:return"RIGHT_BOTTOM";default:return"LEFT_BOTTOM"}}onParseLine(e){var i;let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"CANVAS":this.parseCanvas(e);break;case"LAYER":this.parseLayer(e);break;case"LAYER_PHYS":this.parseLayerPhys(e);break;case"ACTIVE_LAYER":this.parseActiveLayer(e);break;case"NET":this.parseNet(e);break;case"PRIMITIVE":this.parsePrimitive(e);break;case"GROUP":this.parseGroup(e);break;case"SILK_OPTS":this.parseSilkOpts(e);break;case"PREFERENCE":this.parsePreference(e);break;case"CONNECT":this.parseConnect(e);break;case"ITEM_ORDER":this.parseItemOrder(e);break;case"PROP":this.parseProp(e);break;case"EQLEN_GRP":this.parseEQLenGrp(e);break;case"EQLEN":this.parseEQLen(e);break;case"FONT":this.parseFont(e);break;case"PAD_NET":{this.cachePadNet[e[1]]||(this.cachePadNet[e[1]]=[]),this.cachePadNet[e[1]].push(e);break}case"REUSE_BLOCK":this.parseReuseBlock(e);break;case"RULE_TEMPLATE":this.parseRuleTemplate(e);break;case"RULE":this.rules.push(e);break;case"RULE_SELECTOR":this.ruleSelectors.push(e);break;case"PANELIZE":this.panelize.data=e;break;case"PANELIZE_STAMP":this.parsePanelizeStamp(e);break;case"PANELIZE_SIDE":this.parsePanelizeSide(e);break;case"POURED":{this.parsePoured(e);break}case"PARTITION":t==="PARTITION"&&(this.curPartition=e[3]?e[1]:"");case"VIA":case"PAD":case"LINE":case"ARC":case"CARC":case"OBJ":case"POLY":case"FILL":if(t==="FILL"&&e[6]===2){this.layerFill[e[4]]||(this.layerFill[e[4]]=[]),this.layerFill[e[4]].push(e);break}case"REGION":case"POUR":case"IMAGE":case"TEARDROP":case"FPC_FILL":case"SHELL":case"CREASE":t==="CREASE"&&this.creaseIds.push(e[1]);case"SHELLCUT":case"SHELL_ENTITY":case"BOSS":case"STRING":if(t==="STRING"&&!/^[a-zA-Z]+\d+$/.test(e[1])){let r=e[1],s=r.split(/([0-9].*)/);if(s.length>=2){let n=s[0],a=s[1];for(let o=0;o<a.length;o++){let l=a.charCodeAt(o);n+=l}r=n}this.stringId[r]=e[1],e[1]=r}case"DIMENSION":case"COMPONENT":{let r=t==="CARC"?"ARC":t,s=wu(e[1]);this.cache[r]||(this.cache[r]={}),s!==null&&!this.cache[r][s]?this.cache[r][s]={part:this.curPartition,value:e}:(this.errorIds[r]||(this.errorIds[r]=[]),this.errorIds[r].push({part:this.curPartition,value:e})),r==="COMPONENT"&&(this.components[e[1]]||(this.components[e[1]]={attrs:{},footprint:"",device:""}),this.components[e[1]].attrs=e[7]||{}),r==="DIMENSION"&&(this.dimension[e[1]]={attr:[]});break}case"ATTR":{if(this.docType==="PCB"&&!e[3])break;if(e[7]==="Footprint"&&(this.components[e[3]]||(this.components[e[3]]={attrs:{},footprint:"",device:""}),this.components[e[3]].footprint=e[8]),e[7]==="Device"&&(this.components[e[3]]||(this.components[e[3]]={attrs:{},footprint:"",device:""}),this.components[e[3]].device=e[8]),this.dimension[e[1]]){this.dimension[e[1]].attr=e;break}let r=Object.keys(((i=this.cache)==null?void 0:i.COMPONENT)||{}).find(n=>this.cache.COMPONENT[n].value[1]===e[3]);if(r){let n=this.cache.COMPONENT[r];n.attr||(n.attr=[]),n.attr.push({part:this.curPartition,value:e});break}let s=wu(e[1]);this.cache[t]||(this.cache[t]={}),s!==null&&!this.cache[t][s]?this.cache[t][s]={part:this.curPartition,value:e}:(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPartition,value:e}));break}default:console.warn("can not find hanlder with",e)}}async secondParseLine(e,t,i){let r=e[0];if(this.idsSet.has(e[1])||!e[1]){let s=ps();if(this.oldId[s]=e[1],e[1]=s,i)for(let n of i)n[3]=s}else this.idsSet.add(e[1]);switch(r){case"DOCTYPE":case"HEAD":case"CANVAS":case"LAYER":case"LAYER_PHYS":case"ACTIVE_LAYER":case"NET":case"PRIMITIVE":case"GROUP":case"SILK_OPTS":case"PREFERENCE":case"ITEM_ORDER":case"RULE_TEMPLATE":case"RULE":case"RULE_SELECTOR":case"PANELIZE":case"PANELIZE_STAMP":case"PANELIZE_SIDE":case"CONNECT":case"EQLEN_GRP":case"EQLEN":case"FONT":case"PAD_NET":case"REUSE_BLOCK":case"PROP":break;case"PARTITION":this.parsePartition(e);break;case"VIA":this.parseVia(e);break;case"PAD":this.parsePad(e);break;case"LINE":await this.parseLine(e);break;case"ARC":this.parseArc(e);break;case"CARC":this.parseCArc(e);break;case"OBJ":this.parseObj(e);break;case"POLY":this.parsePoly(e);break;case"FILL":this.parseFill(e);break;case"REGION":this.parseRegion(e);break;case"POUR":this.parsePour(e);break;case"IMAGE":this.parseImage(e);break;case"TEARDROP":this.parseTeardrop(e);break;case"FPC_FILL":this.parseFpcFill(e);break;case"SHELL":this.parseShell(e);break;case"CREASE":this.parseCrease(e);break;case"SHELLCUT":this.parseShellCut(e);break;case"SHELL_ENTITY":this.parseShellEntity(e);break;case"BOSS":this.parseBoss(e);break;case"STRING":this.parseString(e);break;case"ATTR":this.parseAttr(e,t);break;case"DIMENSION":this.parseDimension(e);break;case"COMPONENT":this.parseComponent(e);break;default:console.warn("can not find hanlder with",e)}}onParseEnd(){for(let t of this.rules)t[1]=this.transRuleType(t[1]),t[3]=this.transRuleStatus(t[3]),t[4]=nN(t[1],t[2],t[3],t[4],this.fac,this.ruleTemplateName);if(this.fac.init){let t=Array.from(this.rules);for(let i of t){let r=aN(i[1],i[2],i[4],this.fac);r&&this.rules.push(r)}}for(let t of this.rules)this.parseRule(t);let e={};for(let t of this.ruleSelectors){let i=oN(t[1],t[2],bh(t[3]),this.fac),r=JSON.stringify(t[1]);e[r]?(t[2]&&(e[r].ruleOrder=t[2]),i.ruleKeyValue&&(e[r].ruleKeyValue=Object.assign(e[r].ruleKeyValue,i.ruleKeyValue)),(i.copperRuleValue||t[4])&&(e[r].copperValue=i.copperRuleValue||bh(t[4])),(i.innerPlaneRuleValue||t[5])&&(e[r].innerPlaneValue=i.innerPlaneRuleValue||bh(t[5]))):e[r]={ruleSelect:t[1],ruleOrder:t[2],ruleKeyValue:i.ruleKeyValue,copperValue:i.copperRuleValue||bh(t[4])||{},innerPlaneValue:i.innerPlaneRuleValue||bh(t[5])||{}}}for(let t in e)this.parseRuleSelector(e[t]);this.handConnect(),this.parseEQLenGrpFull(),this.parsePanelize(),this.parseLayerFill();for(let t in this.cache){let i=this.cache[t],r=Object.keys(i).sort((n,a)=>Number(n)-Number(a)),s=-1;for(let n of r){let a=Number(n),o=a-s-1;o>=1&&this.onPHolder(t,o),s=a,this.curPartition=i[a].part,this.secondParseLine(i[a].value,void 0,i[a].attr),i[a].attr&&i[a].attr.forEach(l=>{this.curPartition=l.part,this.secondParseLine(l.value)})}if(this.errorIds[t])for(let n of this.errorIds[t])this.curPartition=n.part,this.secondParseLine(n.value)}this.clearCache()}clearCache(){this.version=void 0,this.docType=void 0,this.curPartition="",this.eQLenData={},this.eQLenSort=1,this.cache={},this.components={},this.errorIds={},this.dimension={},this.connects={},this.specialColors={},this.reuseBlock={},this.panelize.data.length&&(this.panelize.data.length=0,this.panelize.stamp={h:null,v:null},this.panelize.size={h:null,v:null}),this.layerPhys=0,this.fac.init&&(this.fac=new Hy),this.rules=[],this.ruleSelectors=[],this.ruleTemplateName="",this.layerFill={},this.idsSet.clear(),this.oldId={},this.creaseIds.length=0}fixPolygon(e){if(e[0]=="R"){let t=parseFloat(e[3])/10,i=parseFloat(e[4])/10;e[6]=Math.min(t,i)/2*(parseFloat(e[6])||0)*10}}handleSimplePolygon(e){return!e||this.version>=1.5||this.fixPolygon(e),e}handlePolygon(e){if(this.version<1.5&&e&&e.length){if(!Array.isArray(e[0]))return this.handleSimplePolygon(e);for(let t of e)this.fixPolygon(t)}return e}parseEQLen(e){this.eQLenData[e[1]]?this.eQLenData[e[1]].pads?this.eQLenData[e[1]].pads.push(e[2]):this.eQLenData[e[1]].pads=[e[2]]:this.eQLenData[e[1]]={pads:[e[2]]}}parseEQLenGrp(e){this.eQLenData[e[1]]?(this.eQLenData[e[1]].id=e[1],this.eQLenData[e[1]].name=e[2],this.eQLenData[e[1]].sort=++this.eQLenSort):this.eQLenData[e[1]]={id:e[1],name:e[2],sort:++this.eQLenSort}}parseCanvas(e){this.onCanvas(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],this.transGridType(e[10]),this.transGridType(e[11]),e[12])}parseDocType(e){this.docType=e[1];let t=parseFloat(e[2]);this.version=t}parseHead(e){}parseLayer(e){let t=e[8];this.version<1.7&&(t=.5);let i=this.transLayerStatus(e[4]);this.onLayer(e[1],e[2],e[3],i.use,i.show,i.locked,e[5],e[6],e[7],t)}parseLayerPhys(e){this.onLayerPhys(e[1],e[2],e[3],e[4],e[5],!!e[6],++this.layerPhys)}parseActiveLayer(e){this.onActiveLayer(e[1])}parsePartition(e){this.onPartition(e[1],e[2],e[3],this.handlePolygon(e[4]))}parseNet(e){var t,i,r,s;this.onNet(e[1],(t=e[2])!=null?t:null,(i=e[3])!=null?i:null,!!e[4],(r=e[5])!=null?r:null,!!e[6],(s=e[7])!=null?s:null)}parsePrimitive(e){this.onPrimitive(e[1],!!e[2],!!e[3])}parseGroup(e){this.onGroup(e[1],e[2])}parseSilkOpts(e){this.onSilkOpts(e[1],e[2],e[3])}parsePreference(e){this.onPreference(!!e[1],e[2],!!e[3],e[4],e[5],!!e[6],this.transRoutingMode(e[7]),e[8],!!e[9],!!e[10],!!e[11],e[12],e[13],!!e[14],this.transUnusedPadRange(e[15]),e[16],this.transPathOptimization(e[17]),e[18],e[19],e[20])}parseConnect(e){this.connects[e[1]]=e[2]}parseVia(e){var t,i;this.onVia(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transViaType(e[9]),(t=e[10])!=null?t:null,(i=e[11])!=null?i:null,!!e[12],e[13])}parsePad(e){var t,i,r,s,n,a,o,l,h;this.onPad(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transHoleDef(e[9]),this.transPadDef(e[10]),e[11]&&(i=(t=e[11])==null?void 0:t.map(c=>({startLayer:c[0],endLayer:c[1],pad:this.transPadDef(c[2])})))!=null?i:null,e[12],e[13],e[14],!!e[15],this.transPadFuncType(e[16]),(r=e[17])!=null?r:null,(s=e[18])!=null?s:null,(n=e[19])!=null?n:null,(a=e[20])!=null?a:null,!!e[21],this.transPadConnect(e[22]),(o=e[23])!=null?o:null,(l=e[24])!=null?l:null,(h=e[25])!=null?h:null,e[26],this.getConnect(e[1]))}parseLine(e){this.onLine(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],!!e[10])}parseArc(e){this.onArc(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseCArc(e){this.onCArc(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseObj(e){this.onObj(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],!!e[10],e[11],!!e[12],this.specialColors[this.getOldId(e[1])])}parseItemOrder(e){this.itemOrder=e[1]}parseProp(e){this.specialColors[e[1]]=e[2]}parseEQLenGrpFull(){for(let e in this.eQLenData){let t=this.eQLenData[e];t.id&&this.onEQLenGrp(t.id,t.name,t.sort,t.pads||[])}this.eQLenData={},this.eQLenSort=1}parsePoly(e){this.onPoly(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handleSimplePolygon(e[6]),!!e[7],this.specialColors[this.getOldId(e[1])])}parseFill(e){this.onFill(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.transFillStyle(e[6]),this.handlePolygon(e[7]),!!e[8],this.getConnect(e[1]),this.specialColors[this.getOldId(e[1])])}getZIndex1(e){let t=e.match(um);return t!=null&&t.length?t[1]:null}parseLayerFill(){for(let e in this.layerFill){let t=this.layerFill[e];this.onLayerFill(Number(e),{fill:t.map(i=>{let r=this.getZIndex1(i[1]);return{id:i[1],partitionId:this.curPartition||"",groupId:i[2],locked:!!i[8],zIndex:r===null?null:Number(r),netName:i[3],width:i[5],path:this.handlePolygon(i[7]),refs:this.getConnect(i[1]),specialColor:this.specialColors[this.getOldId(i[1])]}})})}}parseRegion(e){let t=e[5],i=t&&t.includes(9)?"CONSTRAINT":"PROHIBIT";t=i?t.filter(r=>r!==9):t,this.onRegion(e[1],this.curPartition||"",e[2],e[3],e[4],this.transProhibitType(t),this.handlePolygon(e[6]),!!e[7],e[8],i)}parsePour(e){let t=e[9];this.version<=1.7&&t&&t[0]==="SOLID"&&t[1]&&(t[1]=8),this.onPour(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],this.handlePolygon(e[8]),this.transPourDef(t),!!e[10],!!e[11]),this.poured[e[1]]&&this.onPoured(e[1],this.poured[e[1]])}parsePoured(e){if(this.version<1.1){if(this.curPourId){let t={id:e[1],strokeWidth:e[2],fill:e[3],path:this.handlePolygon(e[4])};this.poured[this.curPourId]||(this.poured[this.curPourId]={pourFill:[]}),this.poured[this.curPourId].pourFill.push(t)}}else{let t={id:e[1],strokeWidth:e[3],fill:e[4],path:this.handlePolygon(e[5])};this.poured[e[2]]||(this.poured[e[2]]={pourFill:[]}),this.poured[e[2]].pourFill.push(t)}}parseImage(e){this.onImage(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],!!e[9],e[10],!!e[11],this.specialColors[this.getOldId(e[1])])}parseTeardrop(e){let t,i,r;this.version<1.2?(t=e[5],r=e[4]):(t=e[4],i=e[5],r=this.getConnect(e[1])),this.onTeardrop(e[1],this.curPartition||"",e[2],e[3],this.handleSimplePolygon(t),i!=null?i:null,r)}parseFpcFill(e){this.onFpcFill(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handlePolygon(e[6]),!!e[7])}parseShell(e){let t=e[8];t&&t.Direction&&(t.Direction=this.transPushCoverDir(t.Direction)),this.onShell(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],this.handlePolygon(e[7]),t,!!e[9])}parseCrease(e){this.onCrease(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],e[7],e[8],!!e[9])}parseShellCut(e){this.onShellCut(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],this.handlePolygon(e[6]),!!e[7],this.getConnect(e[1]))}parseShellEntity(e){this.onShellEntity(e[1],this.curPartition||"",e[2],e[3],e[4],this.transEntityBelong(e[5]),this.transSlotOption(e[5]),e[6],e[7],this.handlePolygon(e[8]),!!e[9],this.getConnect(e[1]))}parseBoss(e){var t,i,r,s,n,a;this.version<1.4?this.onBoss(e[1],this.curPartition||"",e[2],e[3],e[5],e[6],(t=e[4])!=null?t:null,e[7],null,null,(i=e[8])!=null?i:null,(r=e[9])!=null?r:null,!!e[10]):this.onBoss(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],(s=e[6])!=null?s:null,e[7],e[8],e[9],(n=e[10])!=null?n:null,(a=e[11])!=null?a:null,!!e[12])}parseDimension(e){var s;let t=this.getOldId(e[1]),i=((s=this.dimension[t])==null?void 0:s.attr)||[];if(i.length){let n=this.fontCache.find(a=>a.id&&a.id===this.getOldId(i[1]));this.version<1.6&&n&&(n.text=i[8],n.fontFamily=i[11],n.fontSize=i[12]/10,n.thickness=i[13],n.bold=i[15],n.italic=i[16],n.reverse=i[18],n.expansion=i[19])}let r={groupId:i[2],layerId:i[4],x:i[5],y:i[6],text:i[8],fontFamily:i[11],fontSize:i[12],strokeWidth:i[13],bold:i[14],italic:i[15],origin:i[16],angle:i[17],reverse:i[18],expansion:i[19],mirror:i[20],locked:i[21],zIndex:null,specialColor:this.specialColors[this.getOldId(i[1])]};this.onDimension(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],!!e[7],e[8],!!e[9],r,this.specialColors[this.getOldId(e[1])],i[2]||"")}parseRuleTemplate(e){this.ruleTemplateName=e[1],this.onRuleTemplate(e[1])}parseRule(e){this.onRule(e[1],e[2],e[3],e[4])}parseRuleSelector(e){this.onRuleSelector(e.ruleSelect,e.ruleOrder,e.ruleKeyValue,e.copperValue,e.innerPlaneValue)}parsePanelize(){let e=this.panelize.data;e.length&&this.onPanelize(!!e[1],e[2],e[3],e[4],e[5],!!e[6],this.panelize.stamp.h,this.panelize.stamp.v,this.panelize.size.h,this.panelize.size.v)}parsePanelizeStamp(e){let t={on:!!e[2],stampHoleGroupQuantity:e[3],stampHoleDiameter:e[4],stampHoleQuantityPerGroup:e[5],stampHoleSpacing:e[6]};e[1]?this.panelize.stamp.v=t:this.panelize.stamp.h=t}parsePanelizeSide(e){let t={on:!!e[2],sideHeight:e[3],positionHoleDiameter:e[4],markDiameter:e[5],markExpansion:e[6]};e[1]?this.panelize.size.v=t:this.panelize.size.h=t}parseComponent(e){let t=this.getOldId(e[1]),i=e[7]||{},r=this.reuseBlock[t];if(r&&Object.assign(i,{"Group ID":r[2]||"","Channel ID":r[3]||""}),this.onComponent(e[1],this.curPartition||"",e[2],e[3],e[4],e[5],e[6],i,!!e[8],this.specialColors[t]),this.cachePadNet[t])for(let s of this.cachePadNet[t])this.parsePadNet(s)}parsePadNet(e){let t=this.getOldId(e[1]);if(e[4]===void 0&&this.components[t]){let i=this.components[t].footprint;if(!i){let s=this.components[t].device;i=this.devices.find(n=>n.uuid===s).attributes.Footprint}let r=this.padNumId[i];if(!r){let s=this.footprints.find(n=>n.uuid===i);s&&(this.padNumId[i]=lN(s==null?void 0:s.dataStr),r=this.padNumId[i])}if(r&&r[e[2]]){this.componentPadNum[t]||(this.componentPadNum[t]={}),this.componentPadNum[t][e[2]]===void 0&&(this.componentPadNum[t][e[2]]=-1);let s=++this.componentPadNum[t][e[2]];e[4]=r[e[2]][s]}else e[4]=e[2]}this.onPadNet(e[1],this.curPartition||"",e[2],e[3],e[4])}parseReuseBlock(e){this.reuseBlock[e[1]]=e}getFontCache(e,t,i,r,s,n,a,o){let l;return this.version<1.6?l=this.fontCache.find(h=>h.id===e):l=this.fontCache.find(h=>i==h.fontFamily&&t==h.text&&r/10==h.fontSize&&!!a==h.reverse&&o==h.expansion&&!!s==h.bold&&!!n==h.italic&&h.path.length>0),{paths:l==null?void 0:l.path,width:l==null?void 0:l.width,height:l==null?void 0:l.height}}getTextValue(e,t,i,r,s){let n="";return e!=""&&t===""&&this.docType!="PCB"&&!s&&e!="Footprint"&&!this.footprintIsConnectDevice&&(t=`<${e}>`),i?r?n=e+":"+t:n=e:r?n=t:n="",n}getFormulaName(e,t){if(!e||!e.startsWith("="))return e;e=e.slice(1);let i=/\{([^\}]+)\}/g,r=[],s=[];for(;r=i.exec(e);)s.push(r[1]);for(let n=0;n<s.length;n++){let a=s[n],o=`{${a}!}`;t.has(a)&&(o=t.get(a)),e=e.replace(`{${a}}`,o)}return e}parseAttr(e,t){let i=e[11],r=e[12];r&&this.version<1.2&&(i=="default"||i=="")&&(r*=1.5);let s=e[7],n=e[8],a=!!e[9],o=!!e[10],l=this.getOldId(e[3]),h=n;if(s==="Device"){let f=this.deviceName[n]||n;h=this.getTextValue(s,f,a,o,l)}else if(s==="Footprint"){let f=this.footprintName[n]||n;h=this.getTextValue(s,f,a,o,l)}else if(s==="Name"){let f=new Map;if(l){let d=this.components[l];if(f.set("ID",l),Object.entries(d.attrs).forEach(u=>f.set(u[0],u[1])),d.device){let u=this.devices.find(p=>p.uuid===d.device);u&&Object.entries(u.attributes).forEach(p=>f.set(p[0],p[1]))}}h=this.getTextValue(s,this.getFormulaName(n,f),a,o,l)}else h=this.getTextValue(s,n,a,o,l);let c=this.fontCache.find(f=>f.id&&f.id===this.getOldId(e[1]));this.version<1.6&&c&&(c.text=h,c.fontFamily=i,c.fontSize=r/10,c.thickness=e[13],c.bold=e[15],c.italic=e[16],c.reverse=e[18],c.expansion=e[19]),this.onAttr(e[1],this.curPartition||"",e[2],l,e[4],e[5],e[6],s,n,a,o,i,r,e[13],!!e[14],!!e[15],this.transAlignType(e[16]),e[17],!!e[18],e[19],!!e[20],!!e[21],t,this.specialColors[this.getOldId(e[1])])}parseFont(e){let t;switch(this.version){case 1:case 1.1:t={id:e[1],path:e[2]};break;case 1.2:case 1.3:case 1.4:case 1.5:t={id:e[1],width:e[2],height:e[3],path:e[4]};break;default:t={text:e[1],fontFamily:e[2],fontSize:e[3],thickness:e[4],bold:!!e[5],italic:!!e[6],reverse:!!e[7],expansion:e[8],width:e[9],height:e[10],path:e[11]};break}this.fontCache.push(t)}parseString(e){var y;let[,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b]=e,m=(y=this.stringId[t])!=null?y:t;l&&this.version<1.2&&(o=="default"||o=="")&&(l*=1.5);let O=this.fontCache.find(x=>x.id&&x.id===this.getOldId(m));this.version<1.6&&O&&(O.text=a,O.fontFamily=o,O.fontSize=l/10,O.thickness=h,O.bold=c,O.italic=f,O.reverse=p,O.expansion=_),this.onString(t,this.curPartition||"",i,r,s,n,a,o,l,h,!!c,!!f,this.transAlignType(d),u,!!p,_,!!g,!!b,this.specialColors[this.getOldId(m)])}},uN=Object.create,tb=Object.defineProperty,dN=Object.getOwnPropertyDescriptor,fN=Object.getOwnPropertyNames,pN=Object.getPrototypeOf,_N=Object.prototype.hasOwnProperty,gN=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ON=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of fN(t))!_N.call(e,s)&&s!==i&&tb(e,s,{get:()=>t[s],enumerable:!(r=dN(t,s))||r.enumerable});return e},mN=(e,t,i)=>(i=e!=null?uN(pN(e)):{},ON(t||!e||!e.__esModule?tb(i,"default",{value:e,enumerable:!0}):i,e)),yN=gN((e,t)=>{"use strict";t.exports=i,t.exports.default=i;function i(v,P,I){I=I||2;var N=P&&P.length,D=N?P[0]*I:v.length,j=r(v,0,D,I,!0),H=[];if(!j||j.next===j.prev)return H;var K,se,he,_e,ve,J,Z;if(N&&(j=c(v,P,j,I)),v.length>80*I){K=he=v[0],se=_e=v[1];for(var re=I;re<D;re+=I)ve=v[re],J=v[re+1],ve<K&&(K=ve),J<se&&(se=J),ve>he&&(he=ve),J>_e&&(_e=J);Z=Math.max(he-K,_e-se),Z=Z!==0?32767/Z:0}return n(j,H,I,K,se,Z,0),H}function r(v,P,I,N,D){var j,H;if(D===M(v,P,I,N)>0)for(j=P;j<I;j+=N)H=z(j,v[j],v[j+1],H);else for(j=I-N;j>=P;j-=N)H=z(j,v[j],v[j+1],H);return H&&E(H,H.next)&&(q(H),H=H.next),H}function s(v,P){if(!v)return v;P||(P=v);var I=v,N;do if(N=!1,!I.steiner&&(E(I,I.next)||x(I.prev,I,I.next)===0)){if(q(I),I=P=I.prev,I===I.next)break;N=!0}else I=I.next;while(N||I!==P);return P}function n(v,P,I,N,D,j,H){if(v){!H&&j&&_(v,N,D,j);for(var K=v,se,he;v.prev!==v.next;){if(se=v.prev,he=v.next,j?o(v,N,D,j):a(v)){P.push(se.i/I|0),P.push(v.i/I|0),P.push(he.i/I|0),q(v),v=he.next,K=he.next;continue}if(v=he,v===K){H?H===1?(v=l(s(v),P,I),n(v,P,I,N,D,j,2)):H===2&&h(v,P,I,N,D,j):n(s(v),P,I,N,D,j,1);break}}}}function a(v){var P=v.prev,I=v,N=v.next;if(x(P,I,N)>=0)return!1;for(var D=P.x,j=I.x,H=N.x,K=P.y,se=I.y,he=N.y,_e=D<j?D<H?D:H:j<H?j:H,ve=K<se?K<he?K:he:se<he?se:he,J=D>j?D>H?D:H:j>H?j:H,Z=K>se?K>he?K:he:se>he?se:he,re=N.next;re!==P;){if(re.x>=_e&&re.x<=J&&re.y>=ve&&re.y<=Z&&O(D,K,j,se,H,he,re.x,re.y)&&x(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function o(v,P,I,N){var D=v.prev,j=v,H=v.next;if(x(D,j,H)>=0)return!1;for(var K=D.x,se=j.x,he=H.x,_e=D.y,ve=j.y,J=H.y,Z=K<se?K<he?K:he:se<he?se:he,re=_e<ve?_e<J?_e:J:ve<J?ve:J,ue=K>se?K>he?K:he:se>he?se:he,Le=_e>ve?_e>J?_e:J:ve>J?ve:J,Ce=b(Z,re,P,I,N),De=b(ue,Le,P,I,N),Pe=v.prevZ,Ie=v.nextZ;Pe&&Pe.z>=Ce&&Ie&&Ie.z<=De;){if(Pe.x>=Z&&Pe.x<=ue&&Pe.y>=re&&Pe.y<=Le&&Pe!==D&&Pe!==H&&O(K,_e,se,ve,he,J,Pe.x,Pe.y)&&x(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ie.x>=Z&&Ie.x<=ue&&Ie.y>=re&&Ie.y<=Le&&Ie!==D&&Ie!==H&&O(K,_e,se,ve,he,J,Ie.x,Ie.y)&&x(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Pe&&Pe.z>=Ce;){if(Pe.x>=Z&&Pe.x<=ue&&Pe.y>=re&&Pe.y<=Le&&Pe!==D&&Pe!==H&&O(K,_e,se,ve,he,J,Pe.x,Pe.y)&&x(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ie&&Ie.z<=De;){if(Ie.x>=Z&&Ie.x<=ue&&Ie.y>=re&&Ie.y<=Le&&Ie!==D&&Ie!==H&&O(K,_e,se,ve,he,J,Ie.x,Ie.y)&&x(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function l(v,P,I){var N=v;do{var D=N.prev,j=N.next.next;!E(D,j)&&w(D,N,N.next,j)&&B(D,j)&&B(j,D)&&(P.push(D.i/I|0),P.push(N.i/I|0),P.push(j.i/I|0),q(N),q(N.next),N=v=j),N=N.next}while(N!==v);return s(N)}function h(v,P,I,N,D,j){var H=v;do{for(var K=H.next.next;K!==H.prev;){if(H.i!==K.i&&y(H,K)){var se=G(H,K);H=s(H,H.next),se=s(se,se.next),n(H,P,I,N,D,j,0),n(se,P,I,N,D,j,0);return}K=K.next}H=H.next}while(H!==v)}function c(v,P,I,N){var D=[],j,H,K,se,he;for(j=0,H=P.length;j<H;j++)K=P[j]*N,se=j<H-1?P[j+1]*N:v.length,he=r(v,K,se,N,!1),he===he.next&&(he.steiner=!0),D.push(m(he));for(D.sort(f),j=0;j<D.length;j++)I=d(D[j],I);return I}function f(v,P){return v.x-P.x}function d(v,P){var I=u(v,P);if(!I)return P;var N=G(I,v);return s(N,N.next),s(I,I.next)}function u(v,P){var I=P,N=v.x,D=v.y,j=-1/0,H;do{if(D<=I.y&&D>=I.next.y&&I.next.y!==I.y){var K=I.x+(D-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(K<=N&&K>j&&(j=K,H=I.x<I.next.x?I:I.next,K===N))return H}I=I.next}while(I!==P);if(!H)return null;var se=H,he=H.x,_e=H.y,ve=1/0,J;I=H;do N>=I.x&&I.x>=he&&N!==I.x&&O(D<_e?N:j,D,he,_e,D<_e?j:N,D,I.x,I.y)&&(J=Math.abs(D-I.y)/(N-I.x),B(I,v)&&(J<ve||J===ve&&(I.x>H.x||I.x===H.x&&p(H,I)))&&(H=I,ve=J)),I=I.next;while(I!==se);return H}function p(v,P){return x(v.prev,v,P.prev)<0&&x(P.next,v,v.next)<0}function _(v,P,I,N){var D=v;do D.z===0&&(D.z=b(D.x,D.y,P,I,N)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,g(D)}function g(v){var P,I,N,D,j,H,K,se,he=1;do{for(I=v,v=null,j=null,H=0;I;){for(H++,N=I,K=0,P=0;P<he&&(K++,N=N.nextZ,!!N);P++);for(se=he;K>0||se>0&&N;)K!==0&&(se===0||!N||I.z<=N.z)?(D=I,I=I.nextZ,K--):(D=N,N=N.nextZ,se--),j?j.nextZ=D:v=D,D.prevZ=j,j=D;I=N}j.nextZ=null,he*=2}while(H>1);return v}function b(v,P,I,N,D){return v=(v-I)*D|0,P=(P-N)*D|0,v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,P=(P|P<<8)&16711935,P=(P|P<<4)&252645135,P=(P|P<<2)&858993459,P=(P|P<<1)&1431655765,v|P<<1}function m(v){var P=v,I=v;do(P.x<I.x||P.x===I.x&&P.y<I.y)&&(I=P),P=P.next;while(P!==v);return I}function O(v,P,I,N,D,j,H,K){return(D-H)*(P-K)>=(v-H)*(j-K)&&(v-H)*(N-K)>=(I-H)*(P-K)&&(I-H)*(j-K)>=(D-H)*(N-K)}function y(v,P){return v.next.i!==P.i&&v.prev.i!==P.i&&!R(v,P)&&(B(v,P)&&B(P,v)&&Y(v,P)&&(x(v.prev,v,P.prev)||x(v,P.prev,P))||E(v,P)&&x(v.prev,v,v.next)>0&&x(P.prev,P,P.next)>0)}function x(v,P,I){return(P.y-v.y)*(I.x-P.x)-(P.x-v.x)*(I.y-P.y)}function E(v,P){return v.x===P.x&&v.y===P.y}function w(v,P,I,N){var D=C(x(v,P,I)),j=C(x(v,P,N)),H=C(x(I,N,v)),K=C(x(I,N,P));return!!(D!==j&&H!==K||D===0&&S(v,I,P)||j===0&&S(v,N,P)||H===0&&S(I,v,N)||K===0&&S(I,P,N))}function S(v,P,I){return P.x<=Math.max(v.x,I.x)&&P.x>=Math.min(v.x,I.x)&&P.y<=Math.max(v.y,I.y)&&P.y>=Math.min(v.y,I.y)}function C(v){return v>0?1:v<0?-1:0}function R(v,P){var I=v;do{if(I.i!==v.i&&I.next.i!==v.i&&I.i!==P.i&&I.next.i!==P.i&&w(I,I.next,v,P))return!0;I=I.next}while(I!==v);return!1}function B(v,P){return x(v.prev,v,v.next)<0?x(v,P,v.next)>=0&&x(v,v.prev,P)>=0:x(v,P,v.prev)<0||x(v,v.next,P)<0}function Y(v,P){var I=v,N=!1,D=(v.x+P.x)/2,j=(v.y+P.y)/2;do I.y>j!=I.next.y>j&&I.next.y!==I.y&&D<(I.next.x-I.x)*(j-I.y)/(I.next.y-I.y)+I.x&&(N=!N),I=I.next;while(I!==v);return N}function G(v,P){var I=new L(v.i,v.x,v.y),N=new L(P.i,P.x,P.y),D=v.next,j=P.prev;return v.next=P,P.prev=v,I.next=D,D.prev=I,N.next=I,I.prev=N,j.next=N,N.prev=j,N}function z(v,P,I,N){var D=new L(v,P,I);return N?(D.next=N.next,D.prev=N,N.next.prev=D,N.next=D):(D.prev=D,D.next=D),D}function q(v){v.next.prev=v.prev,v.prev.next=v.next,v.prevZ&&(v.prevZ.nextZ=v.nextZ),v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function L(v,P,I){this.i=v,this.x=P,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(v,P,I,N){var D=P&&P.length,j=D?P[0]*I:v.length,H=Math.abs(M(v,0,j,I));if(D)for(var K=0,se=P.length;K<se;K++){var he=P[K]*I,_e=K<se-1?P[K+1]*I:v.length;H-=Math.abs(M(v,he,_e,I))}var ve=0;for(K=0;K<N.length;K+=3){var J=N[K]*I,Z=N[K+1]*I,re=N[K+2]*I;ve+=Math.abs((v[J]-v[re])*(v[Z+1]-v[J+1])-(v[J]-v[Z])*(v[re+1]-v[J+1]))}return H===0&&ve===0?0:Math.abs((ve-H)/H)};function M(v,P,I,N){for(var D=0,j=P,H=I-N;j<I;j+=N)D+=(v[H]-v[j])*(v[j+1]+v[H+1]),H=j;return D}i.flatten=function(v){for(var P=v[0][0].length,I={vertices:[],holes:[],dimensions:P},N=0,D=0;D<v.length;D++){for(var j=0;j<v[D].length;j++)for(var H=0;H<P;H++)I.vertices.push(v[D][j][H]);D>0&&(N+=v[D-1].length,I.holes.push(N))}return I}}),bN=(e=>(e[e.MIL=1]="MIL",e[e.INCH=1e3]="INCH",e[e.FT=12e3]="FT",e[e.YARD=36e3]="YARD",e[e.MILE=6336e4]="MILE",e[e.KM=3937007874e-2]="KM",e[e.M=39370]="M",e[e.DM=3937]="DM",e[e.CM=393.7]="CM",e[e.MM=39.37]="MM",e[e.UM=.039]="UM",e[e.NM=394e-7]="NM",e[e.PT=13.88888888888889]="PT",e[e.PX72=13.88888888888889]="PX72",e[e.PX96=10.416666666666666]="PX96",e[e.PX100=10]="PX100",e[e.LTSPICE=6.25]="LTSPICE",e[e.PX1=.1]="PX1",e[e.PX001=.001]="PX001",e))(bN||{}),xN=(e=>(e.MIL="mil",e.INCH="inch",e.FT="ft",e.YARD="yard",e.MILE="mile",e.KM="km",e.M="m",e.DM="dm",e.CM="cm",e.MM="mm",e.UM="um",e.NM="nm",e.PT="pt",e.PX72="px(72)",e.PX96="px(96)",e.PX100="px(100)",e))(xN||{}),Yy={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},Rq=(()=>{let e={};for(let t in Yy)e[Yy[t]]=t;return e})();var Al,Dq=(Al=class{constructor(t,i){this.ratio=t/i}wrap(t){return t*this.ratio}static convert(t,i,r){return t*i/r}},Al.ASIS=new Al(1,1),Al),Ef=class{conversion(e,t,i){if(e===t)return i;let r=e+2+t;return this[r](i)}conversion1(e,t,i){let r=e+2+t,s=this[r](i);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*393.7007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};Ef.prototype["px(100)2mil"]=e=>e*10,Ef.prototype["px(100)2mm"]=e=>e*.254,Ef.prototype["mil2px(100)"]=e=>e/10,Ef.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var Tf=null,fm=new ArrayBuffer(8),fO=new Float64Array(fm),pO=new Uint32Array(fm),Vy=new Uint16Array(fm);var qy=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!Tf){let e=this.getUrlVars().version;e?Tf="/analyzer/v"+e:Tf="/analyzer"}return Tf}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;fO[0]=new Date().getTime(),e.push(pO[1].toString(16)),fO[0]=Math.random(),e.push(Vy[3].toString(16));let t=Vy[2].toString(16);e.push("4"+t.substr(0,3)),fO[0]=performance.now();let i=pO[0].toString(16)+pO[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}};var ib=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(Sh.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(Sh.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(Sh.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(Sh.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},vN=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(vN||{}),EN=/(\.?0+)$/,Sh=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(qy.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(qy.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);ib.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(EN,"")}},TN=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(TN||{});function wN(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var SN=(e,t)=>{e===3?console.error(t):console.log(t)},IN=(e,t)=>Sh.format("%s %s: %s",new Date,wN(e),t),ka,Pp=(ka=class{constructor(t,i=SN,r=IN){this.debug=!1,this.level=t,this.writer=i,this.fmt=r}static mix(...t){let i=4;for(let r of t)r.level<i&&(i=r.level);return new ka(i,(r,s)=>{for(let n of t)n.write1(r,s)},(r,s)=>s)}wrap(t=null,i=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),s=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new ka(this.level,s,r)}chain(t){return t.wrap(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}write3(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,Sh.format(i,...r)))}write2(t,i){this.include(t)&&(i instanceof Error?this.writer(t,this.fmt(t,i.stack)):this.writer(t,this.fmt(t,i.toString())))}write1(t,i){this.include(t)&&this.writer(t,this.fmt(t,i))}debug3(t,...i){this.write3(0,t,i)}debug2(t){this.write2(0,t)}debug1(t){this.write1(0,t)}info3(t,...i){this.write3(1,t,i)}info2(t){this.write2(1,t)}info1(t){this.write1(1,t)}warning3(t,...i){this.write3(2,t,i)}warning2(t){this.write2(2,t)}warning1(t){this.write1(2,t)}error3(t,...i){this.write3(3,t,i)}error2(t){this.write2(3,t)}error1(t){this.write1(3,t)}},ka.DUMMY=new ka(4),ka),pm=new ArrayBuffer(8),_O=new Float64Array(pm),gO=new Uint32Array(pm),Xy=new Uint16Array(pm),Wy=ArrayBuffer;try{Wy=self.HTMLImageElement||Wy}catch{}var wf=null;function Nl(e,t,i=0,r=e.length){s(e,null,t,i,r);function s(a,o,l,h,c){let f,d,u,p;if(h<c-1){let _=c-h;if(_>50)o===null&&(o=new Array(_+1)),n(a,o,l,h,(h+c)/2|0,c);else{f=a[h],d=h,u=h,p=c;let g=d+1;for(;g<p;){if(u!=p){if(p=p+-1,l(f,a[p])<=0)continue;a[u]=a[p],u=p;continue}if(l(f,a[g])>=0){d=g,g=d+1;continue}a[u]=a[g],d=g,u=g,g=d+1}a[u]=f,s(a,o,l,h,u),s(a,o,l,u+1,c)}}}function n(a,o,l,h,c,f){s(a,o,l,h,c),s(a,o,l,c,f);for(var d=h,u=c,p=0,_=a[d],g=a[u];d<c&&u<f;){var b=l(_,g);isNaN(b)?(o[p++]=g,g=a[++u]):(b<=0&&(o[p++]=_,_=a[++d]),b>=0&&(o[p++]=g,g=a[++u]))}for(;d<c;d++)o[p++]=a[d];for(;u<f;u++)o[p++]=a[u];for(d=h,u=0;u<p;d++,u++)a[d]=o[u]}}var es=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!wf){let e=this.getUrlVars().version;e?wf="/analyzer/v"+e:wf="/analyzer"}return wf}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;_O[0]=new Date().getTime(),e.push(gO[1].toString(16)),_O[0]=Math.random(),e.push(Xy[3].toString(16));let t=Xy[2].toString(16);e.push("4"+t.substr(0,3)),_O[0]=performance.now();let i=gO[0].toString(16)+gO[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},PN=[1,10,100,1e3];var Sf=0,ml=0;function Jy(e,t,i){return Sf=Math.abs(e-t),i>=5&&Sf>1e-5||isNaN(i)&&Sf>1e-8?!1:Sf<1e-13?!0:(ml=Math.min(Zy(e),Zy(t)),ml<10&&(ml=10),isNaN(i)||(ml=Math.min(ml,i)),Ky(e,ml)===Ky(t,ml))}var If=0,Pf=0;function Zy(e){return If=0,Pf=0,e>0?If=e-Math.floor(e):If=e-Math.ceil(e),Pf=(If.toString()||"").length,Pf>2?Pf-2:0}function Ky(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=PN[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}var AN=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(AN||{}),CN=/(\.?0+)$/,Ih=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(es.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(es.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);xi.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(CN,"")}},xi=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(Ih.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(Ih.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(Ih.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(Ih.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},Cl,Te=(Cl=class{static regular(t){return Math.round(t*this.precision)/this.precision}static eq(t,i){return Math.abs(t-i)<=this.eps}static neq(t,i){return Math.abs(t-i)>this.eps}static less(t,i){return t-i<-this.eps}static lesseq(t,i){return t-i<=this.eps}static greater(t,i){return t-i>this.eps}static greatereq(t,i){return t-i>=-this.eps}static sqrt(t){return Math.abs(t)<=1e-10?0:Math.sqrt(t)}static sortAsc(t,i){return t-i}static sortDesc(t,i){return i-t}},Cl.eps=1e-8,Cl.precision=1e8,Cl);function Lh(e,t){np(e.iterator(),t)}function np(e,t){let i=0;for(;e.hasNext();){let r=e.next();t(i++,r)}}var NN=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function UO(e){return new NN(e)}var gr,ot=(gr=class{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%gr.PIx2,t=t<0?gr.PIx2+t:t,t===gr.PIx2?0:t}static toQuarterBase(t){return gr.regular((t+gr.PI_4)/gr.PI_2*gr.PI_2)}static toQuarterBaseD(t){return gr.regularD(((t+45)/90|0)*90)}static transformD(t,i){return gr.toDegrees(gr.transform(gr.toRadians(t),i))}static transform(t,i){let r=Math.cos(t),s=Math.sin(t),n=new pe(i.data[6],i.data[7]),a=new pe(r,s).multiply3(i);return gr.regular(a.angle(n))}},gr.PIx2=Math.PI*2,gr.PI_2=Math.PI/2,gr.PI_4=Math.PI/4,gr),Ri=class{static dotProd1(e,t,i,r){return e*i+t*r}static dotProd2(e,t,i,r,s,n){return this.dotProd1(i-e,r-t,s-i,n-r)}static dotProd3(e,t,i){return this.dotProd2(e.x,e.y,t.x,t.y,i.x,i.y)}static crossProd1(e,t,i,r){return e*r-t*i}static crossProd2(e,t,i,r,s,n){return this.crossProd1(i-e,r-t,s-i,n-r)}static crossProd3(e,t,i){return this.crossProd2(e.x,e.y,t.x,t.y,i.x,i.y)}static distance2(e,t,i,r){let s=i-e,n=r-t;return s*s+n*n}static distance1(e,t,i,r){return this.hypot(i-e,r-t)}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y)}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var i=t;t=e,e=i}if(e===0)return t;var r=t/e;return e*Math.sqrt(1+r*r)}},rb=new ArrayBuffer(16),$y=new Float64Array(rb),Af=new Int32Array(rb),Pt,pe=(Pt=class{static sortByXAsc(t,i){return t.x-i.x}static sortByYAsc(t,i){return t.y-i.y}static sortByXYAsc(t,i){return t.x<i.x?-1:t.x>i.x?1:t.y-i.y}static caculateAngle(t,i){let r=Math.cos(t),s=Math.sin(t),n=r*i.data[0]+s*i.data[4],a=r*i.data[1]+s*i.data[5],o=new Pt(n,a).normalize();return Math.atan2(o.y,o.x)}static normal(t,i,r){let s=i.sub(t),n=r.sub(i);return s.cross(n)}static getVector2(t){return new Pt(Math.cos(t),Math.sin(t))}static getCrossPoint1(t,i,r,s){if(t.equals1(i)||r.equals1(s)||Te.eq(1,Math.abs(i.sub(t).normalize().dot(s.sub(r).normalize()))))return null;let n=i.y-t.y,a=t.x-i.x,o=i.x*t.y-t.x*i.y,l=s.y-r.y,h=r.x-s.x,c=s.x*r.y-r.x*s.y,f=n*h-l*a;return new Pt((c*a-o*h)/f,(o*l-c*n)/f)}static getCrossPoint2(t,i,r,s){return this.getCrossPoint1(t,t.add(i),r,r.add(s))}constructor(t,i){this.x=xi.normal(t),this.y=xi.normal(i)}get hashed(){return this._hashed==null&&($y[0]=this.x,$y[1]=this.y,this._hashed=Af[0]^Af[1]^Af[2]^Af[3]),this._hashed}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(t){var i=this.x-t.x,r=this.y-t.y;return new Pt(i,r)}add(t){var i=this.x+t.x,r=this.y+t.y;return new Pt(i,r)}div(t){return new Pt(this.x/t,this.y/t)}add1(t,i){return new Pt(this.x+t,this.y+i)}mul(t){return new Pt(this.x*t,this.y*t)}cross(t){return this.x*t.y-this.y*t.x}getSin(){return this.y/this.length()}angle2(t){let i=this.y-t.y,r=this.x-t.x;return i=Math.abs(i-0)<10**-4?0:i,r=Math.abs(r-0)<10**-4?0:r,Math.atan2(i,r)}angleD2(t){return ot.toDegrees(this.angle2(t))}angle(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleX(t=Pt.ORIGIN){let i=this.angle(t);return i<0&&(i=Math.PI*2+i),i}angleD(t){return ot.toDegrees(this.angle(t))}distance1(t){let i=t.x-this.x,r=t.y-this.y;return Ri.hypot(i,r)}distance2(t){let i=t.x-this.x,r=t.y-this.y;return i*i+r*r}rotateD(t,i){return this.rotate(t,ot.toRadians(i))}rotate(t,i){let r=Math.cos(i),s=Math.sin(i),n=this.x-t.x,a=this.y-t.y,o=n*r+a*-s,l=n*s+a*r;return t.add1(o,l)}multiply3(t){let i=this.x*t.data[0]+this.y*t.data[3]+t.data[6],r=this.x*t.data[1]+this.y*t.data[4]+t.data[7];return new Pt(i,r)}multiply4(t){let i=this.x*t.data[0]+this.y*t.data[4]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+t.data[13];return new Pt(i,r)}hashCode(){return this.hashed}equals(t,i){return t instanceof Pt?Jy(t.x,this.x,i)&&Jy(t.y,this.y,i):!1}equals1(t){return t?Te.eq(this.x,t.x)&&Te.eq(this.y,t.y):!1}equals2(t,i){return t instanceof Pt?Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i:!1}similarEquals(t,i=.5){return Math.abs(this.x*.1-t.x*.1)<=i&&Math.abs(this.y*.1-t.y*.1)<=i}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let t=this.x,i=this.y;return new Qr(t,t,i,i)}normalize(){if(this.x===0&&this.y===0)return new Pt(0,0);let t=this.x/this.length(),i=this.y/this.length();return new Pt(t,i)}regular(t=1e-4){let i=Math.round(1/t);return new Pt(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}round(t=4){let i=10**(t|0);return new Pt(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}mirrorX(t=Pt.ORIGIN){return new Pt(this.x,2*t.y-this.y)}mirrorY(t=Pt.ORIGIN){return new Pt(2*t.x-this.x,this.y)}mirrorCenter(t=Pt.ORIGIN){return new Pt(2*t.x-this.x,2*t.y-this.y)}clone(){return new Pt(this.x,this.y)}mirror(t=Pt.ORIGIN){return new Pt(2*t.x-this.x,2*t.y-this.y)}pointOnRays(t,i){let r=ot.toRadians(t);return new Pt(this.x+Math.cos(r)*i,this.y+Math.sin(r)*i)}pointOnRays2(t,i){let r=t.angle(this);return new Pt(this.x+Math.cos(r)*i,this.y+Math.sin(r)*i)}scale(t){return new Pt(this.x*t,this.y*t)}},Pt.ORIGIN=new Pt(0,0),Pt.X_UNIT_VECTOR=new Pt(1,0),Pt.Y_UNIT_VECTOR=new Pt(0,1),Pt),LN=(e=>(e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT",e))(LN||{}),RN=(e=>(e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM",e))(RN||{}),Xi,Aa=(Xi=class{constructor(t,i){this.horizontal=t,this.vertical=i}},Xi.LT=new Xi(0,0),Xi.LC=new Xi(0,1),Xi.LB=new Xi(0,2),Xi.CT=new Xi(1,0),Xi.CC=new Xi(1,1),Xi.CB=new Xi(1,2),Xi.RT=new Xi(2,0),Xi.RC=new Xi(2,1),Xi.RB=new Xi(2,2),Xi),DN=(e=>(e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER",e[e.SEPARATED=2]="SEPARATED",e[e.INTERSECTED=3]="INTERSECTED",e[e.EQ=4]="EQ",e[e.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",e[e.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",e))(DN||{}),Ss=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(e){return this.minX=Math.min(this.minX,e.minX),this.maxX=Math.max(this.maxX,e.maxX),this.minY=Math.min(this.minY,e.minY),this.maxY=Math.max(this.maxY,e.maxY),this}ext2(e){return this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y),this}ext3(e){for(let t=0;t<e.length;t++){let i=e[t];this.ext2(i)}return this}ext4(e){return Lh(e,(t,i)=>(this.ext2(i),!0)),this}ext5(e,t,i,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,i),this.maxY=Math.max(this.maxY,r),this}ext6(e,t){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t),this}ext7(e){if(e<0){let t=e*2;if(t<this.minX-this.maxX||t<this.minY-this.maxY)throw new Error("")}return this.minX-=e,this.maxX+=e,this.minY-=e,this.maxY+=e,this}ext8(e){let t=[];for(let i=0;i<e.length;i+=2)t.push(new pe(e[i],e[i+1]));return this.ext3(t)}ext9(e,t,i,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e+i),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t+r),this}ext10({x:e,y:t,width:i,height:r}){return this.ext9(e,t,i,r)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new Qr(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new Qr(this.minX,this.maxX,this.minY,this.maxY):new Qr(0,0,0,0)}},su=new Float64Array(4),Qr=class nn{static extendRect({x:t,y:i,width:r,height:s}){return new nn(t,t+r,i,i+s)}static extend1(t,i){if(t===null)return new nn(i.x,i.x,i.y,i.y);{let r=Math.min(t.minX,i.x),s=Math.max(t.maxX,i.x),n=Math.min(t.minY,i.y),a=Math.max(t.maxY,i.y);return new nn(r,s,n,a)}}static extend2(t,i){if(t){let r=Math.min(t.minX,i.minX),s=Math.max(t.maxX,i.maxX),n=Math.min(t.minY,i.minY),a=Math.max(t.maxY,i.maxY);return new nn(r,s,n,a)}else return i}static extend3(t,i){let r=Math.min(t.x,i.x),s=Math.max(t.x,i.x),n=Math.min(t.y,i.y),a=Math.max(t.y,i.y);return new nn(r,s,n,a)}static extend4(t,i,r){return new nn(t.x-i/2,t.x+i/2,t.y-r/2,t.y+r/2)}constructor(t,i,r,s){if(this.minX=xi.normal(t),this.maxX=xi.normal(i),this.minY=xi.normal(r),this.maxY=xi.normal(s),t>i||r>s)throw new Error(`min > max is not permitted: [${t}, ${i}, ${r}, ${s}]`)}get data(){return su[0]=this.minX,su[1]=this.maxX,su[2]=this.minY,su[3]=this.maxY,su}isContains(t){return this.isContains1(t.x,t.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(t,i){return this.isContainsX(t)&&this.isContainsY(i)}isContains2(t,i){return this.isContainsX1(t)&&this.isContainsY1(i)}isContainsX(t){return t>=this.minX&&t<=this.maxX}isContainsX1(t){return Te.greatereq(t,this.minX)&&Te.lesseq(t,this.maxX)}isContainsY(t){return t>=this.minY&&t<=this.maxY}isContainsY1(t){return Te.greatereq(t,this.minY)&&Te.lesseq(t,this.maxY)}isIntersect(t){return!(this.maxX<t.minX||this.minX>t.maxX||this.maxY<t.minY||this.minY>t.maxY)}extendOfSize(t){return xi.positiveOr0(this.maxX-this.minX+t*2),xi.positiveOr0(this.maxY-this.minY+t*2),new nn(this.minX-t,this.maxX+t,this.minY-t,this.maxY+t)}isInside(t){return this.minX>=t.minX&&this.maxX<=t.maxX&&this.minY>=t.minY&&this.maxY<=t.maxY}isContainsBBox(t){return this.maxX>=t.maxX&&this.minX<=t.minX&&this.maxY>=t.maxY&&this.minY<=t.minY}isContainsBBox1(t){return Te.greatereq(this.maxX,t.maxX)&&Te.lesseq(this.minX,t.minX)&&Te.greatereq(this.maxY,t.maxY)&&Te.lesseq(this.minY,t.minY)}intersect(t){let i=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(i>r)return null;let s=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return s>n?null:new nn(i,r,s,n)}intersection1(t){let i=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(Te.greater(i,r))return null;i>r&&(r=i);let s=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return Te.greater(s,n)?null:(s>n&&(n=s),new nn(i,r,s,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new pe(this.minX,this.maxY)}UR(){return new pe(this.maxX,this.maxY)}LL(){return new pe(this.minX,this.minY)}LR(){return new pe(this.maxX,this.minY)}center(){return new pe(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(t){let i=new Ss;return i.ext2(this.LL().multiply3(t)),i.ext2(this.LR().multiply3(t)),i.ext2(this.UR().multiply3(t)),i.ext2(this.UL().multiply3(t)),i.build()}transform4(t){let i=new Ss;return i.ext2(this.LL().multiply4(t)),i.ext2(this.LR().multiply4(t)),i.ext2(this.UR().multiply4(t)),i.ext2(this.UL().multiply4(t)),i.build()}isSeparated(t){if(t==null||t==null)return!1;let i;this.minX>=t.minX?i=this.minX:i=t.minX;let r;if(this.maxX<=t.maxX?r=this.maxX:r=t.maxX,i>r)return!0;{let s;this.minY>=t.minY?s=this.minY:s=t.minY;let n;return this.maxY<=t.maxY?n=this.maxY:n=t.maxY,s>n}}relation(t){let i=0,r=0,s;this.minX>t.minX?(i++,s=this.minX):this.minX===t.minX?s=this.minX:(r++,s=t.minX);let n;if(this.maxX<t.maxX?(i++,n=this.maxX):this.maxX===t.maxX?n=this.maxX:(r++,n=t.maxX),s>n)return 2;{let a;this.minY>t.minY?(i++,a=this.minY):this.minY===t.minY?a=this.minY:(r++,a=t.minY);let o;return this.maxY<t.maxY?(i++,o=this.maxY):this.maxY===t.maxY?o=this.maxY:(r++,o=t.maxY),a>o?2:i===4?0:r===4?1:i===0&&r===0?4:s===n||a===o?6:i!==r?5:3}}zoom(t){let i=this.width(),r=this.height(),s=this.center();return t!=0&&(i/=t/2,r/=t/2),new nn(s.x-i,s.x+i,s.y-i,s.y+i)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(t){return this.minY==t.minY&&this.minX==t.minX&&this.maxX==t.maxX&&this.maxY==t.maxY}extendSize(t,i){return Object.is(void 0,i)&&(i=t),nn.extend4(this.center(),this.width()+t,this.height()+i)}positionOnBBox(t,i=0){let r=this.center(),s=this.width()*i/2,n=this.height()*i/2,a=t.x-r.x,o=t.y-r.y;return a>s?o>n?Aa.RT:o<-n?Aa.RB:Aa.RC:a<-s?o>n?Aa.LT:o<-n?Aa.LB:Aa.LC:o>n?Aa.CT:o<-n?Aa.CB:Aa.CC}bbox(){return this}},ap=class Nt{static mul(t,i,r,s,n,a){let o=0,l=0;for(let h=0;h<t;h++){for(let c=0;c<r;c++){let f=c,d=0;for(let u=0;u<i;u++)d+=s[l+u]*n[f],f+=r;a[o++]=d}l+=i}}constructor(t,i,r){this.m=xi.normal(t),this.n=xi.normal(i);let s=t*i;if(r.length===s){for(let n=0;n<r.length;n++)xi.normal(r[n]);this.data=r}else throw new Error("invalid matrix size")}mul(t){if(this.n===t.m){let i=new Array(this.m*t.n);return Nt.mul(this.m,this.n,t.n,this.data,t.data,i),new Nt(this.m,t.n,i)}else throw new Error("m !== p")}toString(){let t=[];t.push("Matrix ("),t.push(this.m.toString()),t.push(" x "),t.push(this.n.toString()),t.push(")");let i=0;for(let r=0;r<this.m;r++)for(let s=0;s<this.n;s++){let n=this.data[i++].toString();s===0?(t.push(`
`),t.push("	"),t.push(n)):(t.push(", "),t.push(n))}return t.join("")}static on(t,i,r){return t*i+r}initExpandMatrix(t){let i=this.m,r=this.n,s=r*2,n=new Array(i*s);for(let a=0;a<i;a++)for(let o=0;o<s;o++)o<r?n[Nt.on(s,a,o)]=t[Nt.on(r,a,o)]:o===i+a?n[Nt.on(s,a,o)]=1:n[Nt.on(s,a,o)]=0;return n}inverseMatrix(t,i,r){for(let s=0;s<i;s++){let n=t[Nt.on(r,s,s)];for(let a=0;a<r;a++)t[Nt.on(r,s,a)]/=n}return t}getMatrixRank(t,i,r){let s=Math.min(i,r);for(let n=0;n<i;n++){if(t[Nt.on(r,n,n)]===0){let a=new Array(r),o;for(o=n;o<i;o++)if(t[Nt.on(r,o,n)]!==0){es.arraycopy(t,Nt.on(r,o,0),a,0,r),es.arraycopy(t,Nt.on(r,n,0),t,Nt.on(r,o,0),r),es.arraycopy(a,0,t,Nt.on(r,n,0),r);break}o>=i&&(s-=1)}if(!(s<i))for(let a=0;a<i;a++){if(a===n)continue;let o=t[Nt.on(r,a,n)]/t[Nt.on(r,n,n)];for(let l=0;l<r;l++)t[Nt.on(r,a,l)]-=t[Nt.on(r,n,l)]*o}}return s}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function t(a){return Te.lesseq(Math.abs(a),0)}let i=this.initExpandMatrix(this.data.slice(0)),r=this.n*2;function s(a,o){for(let l=0;l<r;l++){let h=i[Nt.on(r,a,l)];i[Nt.on(r,a,l)]=i[Nt.on(r,o,l)],i[Nt.on(r,o,l)]=h}}for(let a=0;a<this.m;a++){let o=Math.abs(i[Nt.on(r,a,a)]),l=a;if(t(i[Nt.on(r,a,a)]))for(let c=a+1;c<this.m;c++){if(t(i[Nt.on(r,c,a)])){Math.abs(i[Nt.on(r,c,a)])>o&&(o=Math.abs(i[Nt.on(r,c,a)]),l=c);continue}s(a,c);break}if(t(i[Nt.on(r,a,a)])){if(o===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),l!==a&&s(a,l)}let h=1/i[Nt.on(r,a,a)];for(let c=0;c<r;c++)i[Nt.on(r,a,c)]*=h;for(let c=0;c<this.m;c++){if(a===c)continue;let f=i[Nt.on(r,c,a)];for(let d=a;d<r;d++)i[Nt.on(r,c,d)]-=i[Nt.on(r,a,d)]*f}}let n=[];for(let a=0;a<this.m;a++)for(let o=this.n;o<r;o++)n[Nt.on(this.n,a,o-this.n)]=i[Nt.on(r,a,o)];return new Nt(this.m,this.n,n)}getTransposeMatrix(){let t=new Array(this.data.length);for(let i=0;i<this.m;i++)for(let r=0;r<this.n;r++)t[r*this.n+i]=this.data[i*this.m+r];return new Nt(this.n,this.m,t)}hashCode(){let t=0;for(let i of this.data)t+=i;return t}equals(t){return this===t?!0:t===null?!1:t instanceof Nt?!(this.m!=t.m||this.n!=t.n||!es.equals(this.data,t.data)):!1}},MN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],li,sb=(li=class extends ap{static translate(t,i,r){return new li([1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1])}static translate1(t){return new li([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static rotateX(t){let i=Math.cos(t),r=Math.sin(t);return new li([1,0,0,0,0,i,r,0,0,-r,i,0,0,0,0,1])}static rotateY(t){let i=Math.cos(t),r=Math.sin(t);return new li([i,0,-r,0,0,1,0,0,r,0,i,0,0,0,0,1])}static rotateZ(t){let i=Math.cos(t),r=Math.sin(t);return new li([i,r,0,0,-r,i,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(t,i){t=t.normalize();let r=t.x,s=t.y,n=t.z,a=Math.sin(i),o=Math.cos(i);return new li([r*r*(1-o)+o,r*s*(1-o)+n*a,r*n*(1-o)-s*a,0,r*s*(1-o)-n*a,s*s*(1-o)+o,s*n*(1-o)+r*a,0,r*n*(1-o)+s*a,s*n*(1-o)-r*a,n*n*(1-o)+o,0,0,0,0,1])}static scale(t,i=t,r=t){return new li([t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1])}static flipX(){return new li([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new li([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(t,i){return t.equals1(pe.ORIGIN)?li.rotateZ(i):li.translate(-t.x,-t.y,0).rotateZ(i).translate1(t.x,t.y,0)}static getMatrix4(t,i,r,s){let n=Math.cos(i),a=Math.sin(i),o=r*(t.x*n-t.y*a)+s.x,l=t.x*a+t.y*n+s.y,h=[r*n,a,0,0,-a*r,n,0,0,0,0,1,0,o,l,0,1];return new li(h)}constructor(t=MN){super(4,4,t)}translate(t){return this.multiply4(li.translate1(t))}translate1(t,i,r){return this.multiply4(li.translate(t,i,r))}rotateX(t){return this.multiply4(li.rotateX(t))}rotateY(t){return this.multiply4(li.rotateY(t))}rotateZ(t){return this.multiply4(li.rotateZ(t))}scale(t,i=t,r=t){return this.multiply4(li.scale(t,i,r))}scale1(t){return this.multiply4(li.scale(t.x,t.y,t.z))}setOrigin(t,i,r){return li.translate(-t,-i,-r).multiply4(this).translate1(t,i,r)}setOrigin1(t){return this.setOrigin(t.x,t.y,t.z)}multiply4(t){let i=new Array(16);return ap.mul(4,4,4,this.data,t.data,i),new li(i)}getInverseMatrix(){let t=super.getInverseMatrix();return new li(t.data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new li(t.data)}inverse(){let t=this.getInverseMatrix();return new li(t.data)}toMatrix3(){let t=this.data;return new Yt([t[0],t[1],0,t[4],t[5],0,t[12],t[13],1])}},li.ORIGIN=new li,li);function nu(e){return ib.normal(parseFloat(e))}var BN=[1,0,0,0,1,0,0,0,1],ti,Yt=(ti=class extends ap{static translate(t,i){return new ti([1,0,0,0,1,0,t,i,1])}static translate1(t){return this.translate(t.x,t.y)}static rotate(t){let i=Math.cos(t),r=Math.sin(t);return new ti([i,r,0,-r,i,0,0,0,1])}static rotateD(t){return this.rotate(ot.toRadians(t))}static scale(t,i=t){return new ti([t,0,0,0,i,0,0,0,1])}static scale1(t,i){return new ti([t,0,0,0,i,0,0,0,1])}static toDOMMatrix(t){let[i,r,,s,n,,a,o]=t.data;return`matrix(${[i,r,s,n,a,o].join(",")})`}static svgTrasform(t){let i=t.split(" "),r=null;return i.forEach(s=>{s=s.trim();let n=s.trim().replace(")","").split("("),a=n[0],o=n[1].split(",");switch(a){case"translate":let l=nu(o[0]),h=nu(o[1]);r=r?r.translate(l,h):ti.translate(l,h);break;case"rotate":let c=nu(o[0]),f=nu(o[1]),d=nu(o[2]);r=r?r.setOrigin(f,d):ti.translate(f,d),r=r.rotateD(c);break;default:return}}),r}constructor(t=BN){super(3,3,t);let i=t[0],r=t[3],s=t[1],n=t[4];this.iScale=Math.sqrt(i*i+s*s),this.jScale=Math.sqrt(r*r+n*n)}isMirrored(){return this.det()<0}multiply3(t){let i=new Array(9);return ap.mul(3,3,3,this.data,t.data,i),new ti(i)}translate(t,i){return this.multiply3(ti.translate(t,i))}translate1(t){return this.multiply3(ti.translate1(t))}scale(t,i=t){return this.multiply3(ti.scale(t,i))}scale1(t,i){return this.multiply3(ti.scale1(t,i))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let t=this.getInverseMatrix();return new ti(t.data)}rotateD(t){return this.multiply3(ti.rotateD(t))}rotate(t){return this.multiply3(ti.rotate(t))}resetOffset(){let t=this.data;return new ti([t[0],t[1],0,t[3],t[4],0,0,0,1])}setOrigin(t,i){return ti.translate(-t,-i).multiply3(this).translate(t,i)}setOrigin1(t){return this.setOrigin(t.x,t.y)}getInverseMatrix(){return new ti(super.getInverseMatrix().data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new ti(t.data)}toMatrix4(){let t=this.data;return new sb([t[0],t[1],0,t[2],t[3],t[4],0,t[5],0,0,1,0,t[6],t[7],0,t[8]])}scaleNum(t){return!t||isNaN(t)?t:t*this.iScale}},ti.ORIGIN=new ti,ti.MIRROR_Y=new ti([1,0,0,0,-1,0,0,0,1]),ti.MIRROR_X=new ti([-1,0,0,0,1,0,0,0,1]),ti.ROT_90=new ti([0,1,0,-1,0,0,0,0,1]),ti.ROT_N90=new ti([0,-1,0,1,0,0,0,0,1]),ti),kN=(e=>(e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e))(kN||{}),Io=(e=>(e[e.CW=0]="CW",e[e.CCW=1]="CCW",e))(Io||{}),Bu=class{},FO=class du{constructor(t,i,r){this.p1=t,this.p2=i,this.p3=r}barycentre(){return du.barycentre(this.p1,this.p2,this.p3)}incentre(){return du.incentre(this.p1,this.p2,this.p3)}static barycentre(t,i,r){let s=t.x+i.x+r.x,n=t.y+i.y+r.y;return new pe(s/3,n/3)}static incentre(t,i,r){let s=i.sub(r).length(),n=t.sub(r).length(),a=t.sub(i).length(),o=s+n+a,l=s*t.x+n*i.x+a*r.x,h=s*t.y+n*i.y+a*r.y;return new pe(l/o,h/o)}area(){return du.area(this.p1,this.p2,this.p3)}static area(t,i,r){return this.area2(t.x,t.y,i.x,i.y,r.x,r.y)/2}static area2(t,i,r,s,n,a){return Math.abs(Ri.crossProd2(t,i,r,s,n,a))}scale(t,i){let r=Yt.translate(-t.x,-t.y).scale(i).translate1(t),s=this.p1.multiply3(r),n=this.p2.multiply3(r),a=this.p3.multiply3(r);return new du(s,n,a)}scaleOnBarycentre(t){return this.scale(this.barycentre(),t)}scaleOnIncentre(t){return this.scale(this.incentre(),t)}extend(t){let i=this.incentre(),r=this.p1.add(this.p2).sub(i).scale(1/2),s=r.length(),n=pe.ORIGIN.pointOnRays2(r,s+t).length()/s;return this.scaleOnIncentre(n)}container(t){let i=this.p3.sub(this.p1),r=this.p2.sub(this.p1),s=t.sub(this.p1),n=i.dot(i),a=i.dot(r),o=i.dot(s),l=r.dot(r),h=r.dot(s),c=1/(n*l-a*a),f=(l*o-a*h)*c;if(f<0||f>1)return!1;let d=(n*h-a*o)*c;return d<0||d>1?!1:f+d<=1}};function Cf(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var In=class So{static getMinDistanceWithoutCross(t,i){let r=Cf();return So.minLine(t,i,r),r.minDistance}static getMinDistance(t,i){return ln(t,i)?0:this.getMinDistanceWithoutCross(t,i)}static getMinLineWithCross(t,i){let r=Cf();return So.minLine(t,i,r),new oe(r.start,r.end)}static getMinLine(t,i){return So.intersection(t,i)||this.getMinLineWithCross(t,i)}static getMinDistanceFromPoint(t,i){let r=Cf();if(i instanceof oe)this.point2LineMinLine(r,i,t);else if(i instanceof ye)this.point2ArcMinDistance(t,i,r);else throw new Error("not support");return r.minDistance}constructor(t,i){if(this.pt1=t,this.pt2=i,this.minline=So.intersection(t,i),this.minline)this.minDistance=0;else{let r=Cf();So.minLine(t,i,r),this.minline=new oe(r.start,r.end),this.minDistance=r.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(t,i){let r=ln(t,i);if(r===0)return;let s=new Array;for(let n=0;n<r;n+=2){let a=new pe(te[n],te[n+1]);s.push(a)}return s.length>1?new oe(s[0],s[1]):new oe(s[0],s[0])}static minLine(t,i,r){if(t instanceof oe&&i instanceof oe)return this.minDistanceForLines(t,i,r);if(t instanceof ye&&i instanceof oe)return this.minDistanceForLineAndArc(t,i,r);if(t instanceof oe&&i instanceof ye)return this.minDistanceForLineAndArc(i,t,r);if(t instanceof ye&&i instanceof ye)return this.minDistanceForArcs(t,i,r);throw new Error("not support")}static minDistanceForLines(t,i,r){[t.start(),t.end(),i.start(),i.end()].forEach((s,n)=>{n<2?this.point2LineMinLine(r,i,s):this.point2LineMinLine(r,t,s)})}static minDistanceForLineAndArc(t,i,r){this.point2LineMinLine(r,i,t.start()),this.point2LineMinLine(r,i,t.svgEnd);let s=So.foot(i,t.center);i.bbox().extendOfSize(1e-8).isContains(s)&&this.point2ArcMinLine(r,t,s),this.point2ArcMinLine(r,t,i.start()),this.point2ArcMinLine(r,t,i.end())}static minDistanceForArcs(t,i,r){this.concentricArc(t,i,r),this.point2ArcMinDistance(i.start(),t,r),this.point2ArcMinDistance(i.svgEnd,t,r),this.point2ArcMinDistance(t.start(),i,r),this.point2ArcMinDistance(t.svgEnd,i,r),(vn(t,i.center)||vn(i,t.center))&&this.shortestLineForArcs(t,i,r)}static minLineForArcAndLine(t,i,r){let s=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));this.arcShortestLine(t,i,r,s),this.arcShortestLine(t,i,r,n)}static arcInnerLineFootSegment(t,i,r){let s=r.distance1(t.center);if(s!==0){let n=t.rx*(r.y-t.center.y)/s+t.center.y,a=t.rx*(r.x-t.center.x)/s+t.center.x;s=t.rx-s,s<i.minDistance&&(i.minDistance=s,i.start=new pe(a,n),i.end=r)}else s=t.rx-s,s<i.minDistance&&(i.minDistance=s,i.start=t.start(),i.end=r)}static shortestLineForArcs(t,i,r){let s=t.center.angleD(i.center),n=i.center.angleD(t.center),a=t.pointOn(s),o=t.pointOn(n),l=i.pointOn(s),h=i.pointOn(n);vn(t,a)&&(this.arcShortestLine(i,r,a,l),this.arcShortestLine(i,r,a,h)),vn(t,o)&&(this.arcShortestLine(i,r,o,l),this.arcShortestLine(i,r,o,h)),this.shortestLineForArcs1(t,i,r)}static shortestLineForArcs1(t,i,r){let s=i.start().sub(t.center).normalize(),n=i.end().sub(t.center).normalize(),a=t.start().sub(i.center).normalize(),o=t.end().sub(i.center).normalize(),l=t.center.add(s.mul(t.rx)),h=t.center.add(n.mul(t.rx)),c=i.center.add(a.mul(i.rx)),f=i.center.add(o.mul(i.rx));vn(t,l)&&Te.greater(i.start().distance2(t.center),0)&&this.arcShortestLine(t,r,i.start(),l),vn(t,h)&&Te.greater(i.end().distance2(t.center),0)&&this.arcShortestLine(t,r,i.end(),h),vn(i,c)&&Te.greater(t.start().distance2(i.center),0)&&this.arcShortestLine(i,r,t.start(),c),vn(i,f)&&Te.greater(t.end().distance2(i.center),0)&&this.arcShortestLine(i,r,t.end(),f)}static concentricArc(t,i,r){if(!(t.center.distance1(i.center)<1e-5&&t.rx===i.rx&&t.ry===i.ry))return;let s=t.start().distance1(i.svgEnd);s<r.minDistance&&(r.minDistance=s,r.start=t.start(),r.end=i.svgEnd),s=i.start().distance1(t.svgEnd),s<r.minDistance&&(r.minDistance=s,r.start=i.start(),r.end=t.svgEnd)}static point2ArcMinDistance(t,i,r){if(vn(i,t)){let s=i.pointOn(t.angleD(i.center)),n=i.pointOn(i.center.angleD(t));this.arcShortestLine(i,r,t,s),this.arcShortestLine(i,r,t,n)}else this.minLineSegment(r,i.start(),t),this.minLineSegment(r,i.svgEnd,t)}static point2ArcMinLine(t,i,r){if(vn(i,r)){let s=r.distance1(i.center);s>i.rx||s>i.ry?this.minLineForArcAndLine(i,t,r):this.arcInnerLineFootSegment(i,t,r)}}static point2LineMinLine(t,i,r){let s=So.foot(i,r);i.bbox().extendOfSize(1e-8).isContains(s)?this.minLineSegment(t,s,r):(this.minLineSegment(t,i.start(),r),this.minLineSegment(t,i.end(),r))}static minLineSegment(t,i,r){let s=i.distance1(r);s<t.minDistance&&(t.minDistance=s,t.start=i,t.end=r)}static arcShortestLine(t,i,r,s){if(!vn(t,s))return;let n=r.distance1(s);n<i.minDistance&&(i.minDistance=n,i.start=r,i.end=s)}static foot(t,i){if(t.isPoint())return t.start();if(!Te.eq(t.b,0)&&!Te.eq(t.a,0)){let r=t.start(),s=t.direct,n=(i.x-r.x)*s.x+(i.y-r.y)*s.y;return new pe(r.x+s.x*n,r.y+s.y*n)}else return Te.eq(t.b,0)&&!Te.eq(t.a,0)?new pe(t.start().x,i.y):!Te.eq(t.b,0)&&Te.eq(t.a,0)?new pe(i.x,t.start().y):i}};function vn(e,t){if(Te.eq(e.sweepAngle,360))return!0;let i=ot.regularD(t.angleD(e.center));return e.sweepAngle>0?(Te.less(i,e.startAngle)&&(i+=360),Te.greatereq(e.endAngle(),i)):(Te.greater(i,e.startAngle)&&(i-=360),Te.lesseq(e.endAngle(),i))}var UN=[1,10,100,1e3],Qy="http://www.w3.org/2000/svg",e2="http://www.w3.org/1999/xlink",t2="http://www.w3.org/XML/1998/namespace",i2="https://easyeda.com/",Mq=(function(){var e={svg:Qy,xlink:e2,xml:t2,c:i2};return e[Qy]="svg",e[e2]="xlink",e[t2]="xml",e[i2]="c",e})();var qi=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),Bq=(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};e["3D"]=(function(){for(var s=[16,19,3,7,5,1],n=21;n<52;n++)s.push(n+32,n);return s.push(2,6,8,4,17),s})();var t,i,r;for(t in e)if(e.hasOwnProperty(t)&&(r=e[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(i=25;i<=52;i++)r.push(i);return e})(),Ir=(function(){var e={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<53;t++)e[t]="Inner"+(t-20);for(t=53;t<85;t++)e[t]="Substrate"+(t-52);return e})(),kq=(function(){var e=[],t=[];for(var i in qi)if(qi.hasOwnProperty(i)){if(i.match(/^BOARD\d+/))continue;e.push(qi[i])}e.sort(),t.sort();var r={},s,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};e.forEach(function(o){switch(o){case qi.TOPLAYER:s={name:Ir[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case qi.BOTTOMLAYER:s={name:Ir[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case qi.TOPSILKLAYER:s={name:Ir[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case qi.BOTTOMSILKLAYER:s={name:Ir[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case qi.TOPPASTERLAYER:s={name:Ir[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case qi.BOTTOMPASTERLAYER:s={name:Ir[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case qi.TOPSOLDERLAYER:s={name:Ir[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case qi.BOTTOMSOLDERLAYER:s={name:Ir[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case qi.RATLINES:s={name:Ir[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case qi.BOARDOUTLINE:s={name:Ir[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case qi.ALL:s={name:Ir[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case qi.DOCUMENT:s={name:Ir[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case qi.TOPASSEMBLY:s={name:Ir[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case qi.BOTTOMASSEMBLY:s={name:Ir[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case qi.MECHANICAL:s={name:Ir[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case qi.MODEL3D:s={name:Ir[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case qi.LIBBODY:s={name:Ir[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case qi.PADSURFACE:s={name:Ir[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=qi.INNER1&&o<=qi.INNER32?s={name:Ir[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:s=null;break}s&&(r[o]=s)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var l=parseInt(RegExp.$1,16),h=.5,c=Math.min(255,Math.round((l>>16)*h)),f=Math.min(255,Math.round((l>>8&255)*h)),d=Math.min(255,Math.round((l&255)*h)),u=((c<<16)+(f<<8)+d).toString(16);return"#"+("00000"+u).substr(-6).toUpperCase()}return r})(),r2={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},Uq=(function(){var e={};for(let t in r2)e[r2[t]]=t;return e})();var Ap=Math.PI*2,op=Math.PI/2,Fq=Math.sin(Math.PI/180);function FN(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=UN[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}function nb(e,t,i){var r=e-t;return i||(i=1e-10),(r>0?r:-r)<i}function GN(e,t,i){var r=c(e)&&c(t)&&c(i);if(!r)return console.warn("Bad arguments"),null;var s=t.x-i.x>0?t.x:i.x,n=t.y-i.y>0?t.y:i.y,a=t.x-i.x>0?i.x:t.x,o=t.y-i.y>0?i.y:t.y,l=e.x,h=e.y;return l<=s+.001&&l>=a-.001&&h<=n+.001&&h>=o-.001;function c(f){return f?(f.x=Number(f.x),f.y=Number(f.y),isNaN(f.x)||isNaN(f.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function zN(e,t,i,r,s,n){var a=(s-i)*(e-i)+(n-r)*(t-r),o=(s-i)*(s-i)+(n-r)*(n-r),l=a/o,h=i+(s-i)*l,c=r+(n-r)*l;return a<=0?Math.sqrt((e-i)*(e-i)+(t-r)*(t-r)):a>=o?Math.sqrt((e-s)*(e-s)+(t-n)*(t-n)):Math.sqrt((e-h)*(e-h)+(c-t)*(c-t))}function HN(e,t,i){return GN(e,t,i)?nb((e.x-t.x)*(i.y-t.y),(i.x-t.x)*(e.y-t.y),.001):!1}var fu=1e-4,te=new Float64Array(100);function ln(e,t){if(e instanceof oe&&t instanceof oe)return aa(e,t);if(e instanceof ye&&t instanceof oe)return GO(e,t);if(e instanceof oe&&t instanceof ye)return GO(t,e);if(e instanceof ye&&t instanceof ye)return ob(e,t);if(e instanceof Be&&t instanceof Be)return Vf(e,t);if(e instanceof Be&&t instanceof oe)return Vf(e,new Be([t.start(),t.end()]));if(e instanceof oe&&t instanceof Be)return Vf(new Be([e.start(),e.end()]),t);if(e instanceof Be&&t instanceof ye)return c2(t,e);if(e instanceof ye&&t instanceof Be)return c2(e,t);throw new Error("not supported operation")}function jN(e,t){let i=e.bbox();if(i.isContainsY1(t)){let r=new oe(new pe(i.minX-1,t),new pe(i.maxX+1,t));return aa(r,e)>0?1:0}else return 0}function YN(e,t){if(e.rx===e.ry){let i=e.bbox();if(i.isContainsY1(t)){let r=new oe(new pe(i.minX-1,t),new pe(i.maxX+1,t));return lp(e,r)>0?1:0}else return 0}else throw new Error("not supported operation")}function s2(e,t){let i=e.bbox();return i.isContainsY1(t)&&Vf(new Be([new pe(i.minX-1,t),new pe(i.maxX+1,t)]),e)>0?1:0}function n2(e,t,i){return isFinite(t)&&isFinite(i)?e.isContains2(t,i):!1}function VN(e,t){let i=t.length(),r=Ri.crossProd3(t.start(),t.end(),e.start())/i,s=Ri.crossProd3(t.start(),t.end(),e.end())/i;return Math.abs(r)<1e-8||Math.abs(s)<1e-8||r*s<0}function aa(e,t){let i=e.bbox().intersection1(t.bbox());if(!i)return 0;if(e.isPoint())if(t.isPoint()){let r=i.center();return te[0]=r.x,te[1]=r.y,2}else return a2(t,e,i);else{if(t.isPoint())return a2(e,t,i);{let r=function(O,y){i.isContains2(O,y)&&(te[m++]=O,te[m++]=y)};if(!VN(e,t))return 0;let s=e.start().x,n=e.start().y,a=e.end().x,o=e.end().y,l=t.start().x,h=t.start().y,c=t.end().x,f=t.end().y,d=t.length(),u=Ri.crossProd2(s,n,l,h,c,f)/d,p=Ri.crossProd2(a,o,l,h,c,f)/d;if(u*p>0&&!Te.eq(u,0)&&!Te.eq(p,0))return 0;let _=e.length(),g=Ri.crossProd2(l,h,s,n,a,o)/_,b=Ri.crossProd2(c,f,s,n,a,o)/_;if(g*b>0&&!Te.eq(g,0)&&!Te.eq(b,0))return 0;let m=0;if(Te.eq(u,0)&&Te.eq(p,0)){let O=i.UL(),y=i.UR(),x=i.LL(),E=i.LR();if(Te.eq(i.width(),0))Te.eq(i.height(),0)?(te[m++]=O.x,te[m++]=O.y):(te[m++]=O.x,te[m++]=O.y,te[m++]=x.x,te[m++]=x.y);else if(Te.eq(i.height(),0))te[m++]=O.x,te[m++]=O.y,te[m++]=y.x,te[m++]=y.y;else{let w=FO.area2(O.x,O.y,l,h,c,f),S=FO.area2(y.x,y.y,l,h,c,f);w<S?(te[m++]=O.x,te[m++]=O.y,te[m++]=E.x,te[m++]=E.y):(te[m++]=y.x,te[m++]=y.y,te[m++]=x.x,te[m++]=x.y)}}else if(Te.eq(u,0))r(s,n);else if(Te.eq(p,0))r(a,o);else{let O=Math.abs(u/(u-p));r(s+(a-s)*O,n+(o-n)*O)}return m}}}function a2(e,t,i){let r=t.start(),s=t.end(),n=Ri.crossProd3(e.start(),e.end(),t.start()),a=Ri.crossProd3(e.start(),e.end(),t.end());if(n*a<0){let o=i.center();return te[0]=o.x,te[1]=o.y,2}else if(Math.abs(n)<Math.abs(a)){if(Te.eq(n/e.length(),0))return te[0]=r.x,te[1]=r.y,2}else if(Te.eq(a/e.length(),0))return te[0]=s.x,te[1]=s.y,2;return 0}function lp(e,t){let i=e.bbox().intersection1(t.bbox());if(i!=null){i=i.extendOfSize(fu);let r=e.center.x,s=e.center.y,n=e.rx,a=e.rx2,o=t.start().x,l=t.start().y,h=t.end().x,c=t.end().y,f=e.center.distance1(t.start()),d=e.center.distance1(t.end()),u=Te.eq(f,n)?0:f>n?1:-1,p=Te.eq(d,n)?0:d>n?1:-1,_=0;if(u===-1&&p===-1)return 0;if(u===0&&p===0)te[_++]=o,te[_++]=l,te[_++]=h,te[_++]=c;else if(u===1&&p===1){let g=In.foot(t,e.center),b=g.distance1(e.center);if(Te.greater(b,n))return 0;if(Te.eq(b,n))Te.eq(t.distance2(e.start()),0)?(te[_++]=e.start().x,te[_++]=e.start().y,te[_++]=e.start().x,te[_++]=e.start().y):Te.eq(t.distance2(e.end()),0)?(te[_++]=e.end().x,te[_++]=e.end().y,te[_++]=e.end().x,te[_++]=e.end().y):(te[_++]=g.x,te[_++]=g.y,te[_++]=g.x,te[_++]=g.y);else{_=ab(r,s,o,l,h,c,_,g);let m=te[_-2],O=te[_-1];_-=2;let y=Ri.distance1(r,s,m,O);if(Te.eq(y,n))te[_++]=m,te[_++]=O,te[_++]=m,te[_++]=O;else if(y<n)_=Gr(a,r,s,o,l,m,O,_),_=Gr(a,r,s,m,O,h,c,_);else return 0}}else if(u===-1||p===-1)_=Gr(a,r,s,o,l,h,c,_);else{let g=In.foot(t,e.center),b=g.distance1(e.center);if(Te.eq(b,n)){let m=function(x){return n2(i,x.x,x.y)&&Fi(e,x)},O=e.start(),y=e.end();if(u===0){let x=t.start();if(m(x))return te[_++]=x.x,te[_++]=x.y,te[_++]=x.x,te[_++]=x.y,_;if(m(g))return te[_++]=g.x,te[_++]=g.y,te[_++]=g.x,te[_++]=g.y,_;if(Te.eq(t.distance2(O),0)&&m(O))return te[_++]=O.x,te[_++]=O.y,te[_++]=O.x,te[_++]=O.y,_;if(Te.eq(t.distance2(y),0)&&m(y))return te[_++]=y.x,te[_++]=y.y,te[_++]=y.x,te[_++]=y.y,_;if(f<=n)_=Gr(a,r,s,g.x,g.y,h,c,_),_===2&&(te[_++]=te[0],te[_++]=te[1]);else if(b<n){if(_=Gr(a,r,s,g.x,g.y,h,c,_),_===2&&m(new pe(te[0],te[1])))return te[_++]=te[0],te[_++]=te[1],_;_=Gr(a,r,s,g.x,g.y,o,l,0),_===2&&(te[_++]=te[0],te[_++]=te[1])}}else{let x=t.end();if(m(x))return te[_++]=x.x,te[_++]=x.y,te[_++]=x.x,te[_++]=x.y,_;if(m(g))return te[_++]=g.x,te[_++]=g.y,te[_++]=g.x,te[_++]=g.y,_;if(Te.eq(t.distance2(O),0)&&m(O))return te[_++]=O.x,te[_++]=O.y,te[_++]=O.x,te[_++]=O.y,_;if(Te.eq(t.distance2(y),0)&&m(y))return te[_++]=y.x,te[_++]=y.y,te[_++]=y.x,te[_++]=y.y,_;if(d<=n)_=Gr(a,r,s,g.x,g.y,o,l,_),_===2&&(te[_++]=te[0],te[_++]=te[1]);else if(b<n){if(_=Gr(a,r,s,g.x,g.y,o,l,_),_===2&&m(new pe(te[0],te[1])))return te[_++]=te[0],te[_++]=te[1],_;_=Gr(a,r,s,g.x,g.y,h,c,0),_===2&&(te[_++]=te[0],te[_++]=te[1])}}}else if(u===0){let m=t.start();te[_++]=m.x,te[_++]=m.y,(o-g.x)*(h-g.x)+(l-g.y)*(c-g.y)<0&&(_=Gr(a,r,s,g.x,g.y,h,c,_))}else{let m=t.end();te[_++]=m.x,te[_++]=m.y,(o-g.x)*(h-g.x)+(l-g.y)*(c-g.y)<0&&(_=Gr(a,r,s,g.x,g.y,o,l,_))}}if(_>0){let g=0;for(let b=0;b<_;b+=2){let m=te[b],O=te[b+1];isFinite(m)&&isFinite(O)&&n2(i,m,O)&&Fi(e,new pe(m,O))&&(te[g++]=m,te[g++]=O)}return g}else return 0}else return 0}function qN(e,t){if(e.bbox()){let i=e.center.x,r=e.center.y,s=e.rx2,n=t.start().x,a=t.start().y,o=t.end().x,l=t.end().y,h=e.center.distance2(t.start()),c=e.center.distance2(t.end()),f=Te.eq(h,s)?0:h>s?1:-1,d=Te.eq(c,s)?0:c>s?1:-1,u=0;if(f===-1&&d===-1)return 0;if(f===0&&d===0)te[u++]=n,te[u++]=a,te[u++]=o,te[u++]=l;else if(f===1&&d===1){let p=In.foot(t,e.center),_=p.distance2(e.center);if(Te.greater(_,s))return 0;if(Te.eq(_,s)){let g=p.distance2(e.start()),b=p.distance2(e.end());Te.eq(g,0)?(te[u++]=e.start().x,te[u++]=e.start().y):Te.eq(b,0)?(te[u++]=e.end().x,te[u++]=e.end().y):(te[u++]=p.x,te[u++]=p.y)}else{u=ab(i,r,n,a,o,l,u,p);let g=te[u-2],b=te[u-1],m=Ri.distance2(i,r,g,b);if(u-=2,Te.eq(m,s))te[u++]=g,te[u++]=b;else if(m<s)u=Gr(s,i,r,n,a,g,b,u),u=Gr(s,i,r,g,b,o,l,u);else return 0}}else if(f===-1||d===-1)u=Gr(s,i,r,n,a,o,l,u);else{let p=In.foot(t,e.center);f===0?(te[u++]=t.start().x,te[u++]=t.start().y,Te.neq(p.distance2(t.start()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(u=Gr(s,i,r,p.x,p.y,o,l,u))):(te[u++]=t.end().x,te[u++]=t.end().y,Te.neq(p.distance2(t.end()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(u=Gr(s,i,r,p.x,p.y,n,a,u)))}if(u>0){let p=0;for(let _=0;_<u;_+=2){let g=te[_],b=te[_+1];isFinite(g)&&isFinite(b)&&(te[p++]=g,te[p++]=b)}return p}else return 0}else return 0}function Gr(e,t,i,r,s,n,a,o){if(s==a){let O=e-(s-i)*(s-i);if(Te.greater(O,0)){let y=Math.sqrt(O),x=t-y,E=t+y,w=Math.min(r,n),S=Math.max(r,n);return x>=w&&x<=S&&(te[o++]=x,te[o++]=s),E>=w&&E<=S&&(te[o++]=E,te[o++]=s),o}}let l=Ri.distance2(r,s,t,i)-e;if(l===0)return te[o++]=r,te[o++]=s,o;let h=Ri.distance2(n,a,t,i)-e;if(h===0)return te[o++]=n,te[o++]=a,o;let c=r,f=s,d=n,u=a,p=NaN,_=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let O=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(h)),.75),.25);if(p=c+(d-c)*O,_=f+(u-f)*O,c===p&&f===_||d===p&&u===_){Math.abs(l)>Math.abs(h)?(p=d,_=u,g=h):(p=c,_=f,g=l);break}else g=Ri.distance2(p,_,t,i)-e,g<0&&l>h||g>0&&l<h?(d=p,u=_,h=g):(c=p,f=_,l=g)}let m=Math.sqrt(e)-Ri.distance1(p,_,t,i);return(Te.eq(0,g)||Te.eq(0,m))&&(te[o++]=p,te[o++]=_),o}function ab(e,t,i,r,s,n,a,o){let l=Ri.dotProd2(i,r,s,n,e,t),h=Ri.dotProd2(s,n,i,r,e,t);if(l>=0)return te[a++]=s,te[a++]=n,a;if(h>=0)return te[a++]=i,te[a++]=r,a;if(Ri.crossProd2(i,r,s,n,e,t)==0)return te[a++]=e,te[a++]=t,a;{let c=NaN,f=NaN,d=i,u=r,p=s,_=n,g=Ri.distance2(i,r,e,t),b=Ri.distance2(s,n,e,t),m=Number.POSITIVE_INFINITY,O=0;for(;m>0&&(O++,c=d+(p-d)*.5,f=u+(_-u)*.5,!(g==b||d==c&&u==f||p==c&&_==f));){m=Ri.distance2(c,f,e,t);let y=Ri.dotProd2(d,u,c,f,e,t);if(y==0)break;y<0?(p=c,_=f,b=m):(d=c,u=f,g=m)}return Ri.distance2(c,f,e,t)<Ri.distance2(o.x,o.y,e,t)?(te[a++]=c,te[a++]=f):(te[a++]=o.x,te[a++]=o.y),a}}function GO(e,t){if(e.rx===e.ry)return lp(e,t);throw new Error("not supported")}function XN(e,t){if(e.rx===e.ry)return qN(e,t);throw new Error("not supported")}function ob(e,t){if(e.bbox().intersection1(t.bbox())!=null){if(e.rx===e.ry&&t.rx===t.ry)return WN(e,t);throw new Error("not supported operation")}return 0}function WN(e,t){let i=e.center.x,r=e.center.y,s=t.center.x,n=t.center.y,a=e.rx,o=t.rx,l=e.rx2,h=t.rx2,c=e.center.distance1(t.center),f=Math.abs(a-o),d=a+o;if(Te.greater(c,d)||Te.less(c,f))return 0;if(Te.eq(f+c,0)){let u=0,p;return Fi(e,t.start())&&(te[u]=t.start().x,te[u+1]=t.start().y,u+=2,p=t.start()),Fi(e,t.end())&&(te[u]=t.end().x,te[u+1]=t.end().y,u+=2,p=t.end()),u===0?(Fi(t,e.start())&&(te[u]=e.start().x,te[u+1]=e.start().y,u+=2),Fi(t,e.end())&&(te[u]=e.end().x,te[u+1]=e.end().y,u+=2)):u===2&&(!p.equals1(e.start())&&Fi(t,e.start())&&(te[u]=e.start().x,te[u+1]=e.start().y,u+=2),!p.equals1(e.end())&&Fi(t,e.end())&&(te[u]=e.end().x,te[u+1]=e.end().y,u+=2)),u}else if(Te.eq(c,d)){if(o2(e,t))return 4;let u=new oe(e.center,t.center),p=lp(t,u);return p=l2(e,p),p!==0?p:(p=lp(e,u),l2(t,p))}else if(Te.eq(c,f)){if(o2(e,t))return 4;if(a>o){let u=(a-o)/a;return te[0]=i+(s-i)/u,te[1]=r+(n-r)/u,h2(e,t,2)}else{let u=(o-a)/o;return te[0]=s+(i-s)/u,te[1]=n+(r-n)/u,h2(e,t,2)}}else{let u=(e.center.distance2(t.center)-h+l)/(c*2)/c,p=(s-i)*u+i,_=(n-r)*u+r,g=s-i,b=n-r,m=Math.max(a,o),O,y,x,E;if(Math.abs(g)<Math.abs(b)){let R=g/-b,B=_-R*p;O=p-m,y=R*O+B,x=p+m,E=R*x+B}else{let R=b/-g,B=p-R*_;y=_-m,O=R*y+B,E=_+m,x=R*E+B}let w=Gr(l,i,r,O,y,p,_,0);if(w=Gr(l,i,r,p,_,x,E,w),w!==4)throw new Error("cnt !== 4");let S=new pe(te[0],te[1]),C=new pe(te[2],te[3]);if(Fi(e,S)&&Fi(t,S))return Fi(e,C)&&Fi(t,C)?4:To(e.start(),t,C,S)?(te[2]=e.start().x,te[3]=e.start().y,4):To(e.end(),t,C,S)?(te[2]=e.end().x,te[3]=e.end().y,4):To(t.start(),e,C,S)?(te[2]=t.start().x,te[3]=t.start().y,4):To(t.end(),e,C,S)?(te[2]=t.end().x,te[3]=t.end().y,4):2;if(Fi(e,C)&&Fi(t,C))return To(e.start(),t,S,C)?(te[0]=e.start().x,te[1]=e.start().y,4):To(e.end(),t,S,C)?(te[0]=e.end().x,te[1]=e.end().y,4):To(t.start(),e,S,C)?(te[0]=t.start().x,te[1]=t.start().y,4):To(t.end(),e,S,C)?(te[0]=t.end().x,te[1]=t.end().y,4):(te[0]=te[2],te[1]=te[3],2);{let R=function(z,q){if(Te.eq(z.distance1(q.center),q.rx)&&Fi(q,z)){if(z.distance2(S)<z.distance2(C)){if(B)return;B=!0}else{if(Y)return;Y=!0}te[G++]=z.x,te[G++]=z.y}},B=!1,Y=!1,G=0;return R(e.start(),t),R(e.end(),t),R(t.start(),e),R(t.end(),e),G}}}function To(e,t,i,r){return Te.eq(e.distance1(t.center),t.rx)&&Fi(t,e)&&e.distance2(i)<e.distance2(r)}function o2(e,t){return Te.eq(t.start().distance1(e.center),e.rx)&&Fi(e,t.start())?(te[0]=t.start().x,te[1]=t.start().y,te[2]=t.start().x,te[3]=t.start().y,!0):Te.eq(t.end().distance1(e.center),e.rx)&&Fi(e,t.end())?(te[0]=t.end().x,te[1]=t.end().y,te[2]=t.end().x,te[3]=t.end().y,!0):Te.eq(e.start().distance1(t.center),t.rx)&&Fi(t,e.start())?(te[0]=e.start().x,te[1]=e.start().y,te[2]=e.start().x,te[3]=e.start().y,!0):Te.eq(e.end().distance1(t.center),t.rx)&&Fi(t,e.end())?(te[0]=e.end().x,te[1]=e.end().y,te[2]=e.end().x,te[3]=e.end().y,!0):!1}function l2(e,t){if(t===0)return 0;let i=te[0],r=te[1];return Fi(e,new pe(i,r))?(te[0]=i,te[1]=r,te[2]=i,te[3]=r,4):0}function h2(e,t,i){if(i===0)return 0;let r=te[0],s=te[1],n=new pe(r,s);return Fi(e,n)&&Fi(t,n)?(te[0]=r,te[1]=s,te[2]=r,te[3]=s,4):0}function fh(e,t){return Math.abs(e-t)<=1e-6}function Fi(e,t){let i=e.bbox();if(t.x-i.minX>-fu&&t.x-i.maxX<fu&&t.y-i.minY>-fu&&t.y-i.maxY<fu){let r=ot.regularD(t.angleD(e.center));return fh(r,e.startAngle)||fh(r,e.startAngle+360)||fh(r,e.startAngle-360)||fh(r,e.endAngle())||fh(r,e.endAngle()+360)||fh(r,e.endAngle()-360)?!0:e.sweepAngle>0?(Te.less(r,e.startAngle)&&(r+=360),Te.greatereq(e.endAngle(),r)):(Te.greater(r,e.startAngle)&&(r-=360),Te.lesseq(e.endAngle(),r))}else return!1}function JN(e,t){let i=e[1].x-e[0].x,r=e[1].y-e[0].y,s=t[1].x-t[0].x,n=t[1].y-t[0].y;if(i===0&&s!==0||i!==0&&s===0)return!1;if(i===0&&s===0)return!0;let a=r/i,o=n/s;return nb(a,o,Math.sin(Math.PI/180))}function ZN(e,t,i){var r,s=+t.x,n=+t.y,a=+i.x,o=+i.y,l=+e.x,h=+e.y,c=a-s,f=o-n,d=l-s,u=h-n,p,_,g,b,m,O;return c===0&&f===0?{d:Math.sqrt(d*d+u*u),point:new pe(s,n)}:(r=(d*c+u*f)/(c*c+f*f),r<0?{d:Math.sqrt(d*d+u*u),point:new pe(s,n)}:r>1?(p=l-a,_=h-o,{d:Math.sqrt(p*p+_*_),point:new pe(a,o)}):(m=s+r*c,O=n+r*f,g=l-m,b=h-O,{d:Math.sqrt(g*g+b*b),point:new pe(m,O)}))}function Tn(e,t){if(!e||!t||e.length!=t.length)return!1;let i="equals1";return!e.some((r,s)=>{let n=t[s],a=!1;return r&&n&&typeof r=="object"&&typeof n=="object"?typeof r[i]=="function"&&$N(r,n)?a=!r[i].call(r,n):a=!(r===n||r.toString()===n.toString()):typeof r=="number"&&typeof n=="number"?a=!(KN(r,n)||Number.isNaN(r)&&Number.isNaN(n)):a=r!==n,a})}function KN(e,t,i=5){return Math.abs(e-t)*Math.pow(10,i)<1}function $N(e,t){return!e||!t||typeof e!="object"||typeof t!="object"?e===t:e.constructor===t.constructor}var _t=new Float64Array(100);function Vf(e,t){if(e.bbox().extendOfSize(Te.eps).isSeparated(t.bbox()))return 0;let i=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,s=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(L){B=Math.min(B,L),Y=Math.max(Y,L)},o=function(L,M){let v=aa(L,M);if(v===0)throw new Error("cnt === 0");for(let P=0;P<v;P+=2)a(te[P])};if(s>r){for(let L=s-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(Te.eq(_t[L],_t[M])&&Te.eq(_t[L+1],_t[M+1])){_t[M]=(_t[L]+_t[M])/2,_t[M+1]=(_t[L+1]+_t[M+1])/2;for(let v=s-3;v>=L;v--)_t[v]=_t[v+2];s-=2;break}if(s>r){s=0;let L=t.start(),M=new Float64Array(8);e.getPercent(L)!==null&&(M[s++]=L.x,M[s++]=L.y);let v=t.end();e.getPercent(v)!==null&&(M[s++]=v.x,M[s++]=v.y);let P=e.start();t.getPercent(P)!==null&&(M[s++]=P.x,M[s++]=P.y);let I=e.end();return t.getPercent(I)!==null&&(M[s++]=I.x,M[s++]=I.y),te.set(M),s}}let[l,h]=i.pop(),c=l.controls,f=h.controls;if(c.length===2&&f.length===2){let L=aa(new oe(c[0],c[1]),new oe(f[0],f[1]));for(let M=0;M<L;M++)_t[s++]=te[M];continue}let d=c[0],u=c[c.length-1];d.equals1(u)&&(u=d.add1(1,0));let p=u.y-d.y,_=d.x-u.x,g=-p*d.x-_*d.y,b=Math.sqrt(1/(p**2+_**2));p*=b,_*=b,g*=b;let m=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY;if(c.forEach(L=>{let M=p*L.x+_*L.y+g;M<m&&(m=M),M>O&&(O=M)}),Te.eq(m,O)){if(h.controls.length===2){let L=aa(new oe(l.start(),l.end()),new oe(h.start(),h.end()));for(let M=0;M<L;M++)_t[s++]=te[M];if(L!==0)continue}l=new Be([c[0],c[c.length-1]]),c=l.controls}let y=f.map(L=>{let M=p*L.x+_*L.y+g,v=Math.abs(M);return v<n&&(n=v),M}),x=0;for(let L of y){if(Te.less(L,m))x=x|1;else if(Te.greater(L,O))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let E=0,w=0,S=u.x-d.x,C=u.y-d.y,R=Math.sqrt(1/(S**2+C**2));S*=R,C*=R;for(let L=1;L<c.length;L++){let M=c[L],v=(M.x-d.x)*S+(M.y-d.y)*C;v<E?E=v:v>w&&(w=v)}x=0;for(let L of f){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(Te.less(M,E))x=x|1;else if(Te.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let B=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;n/=2,n<=Te.eps&&(n=Te.eps),m-=n,O+=n,y.forEach((L,M)=>{L>=m&&L<=O&&a(M/(y.length-1))});let G=new oe(new pe(0,m),new pe(1,m)),z=new oe(new pe(0,O),new pe(1,O));for(let L=0;L<y.length-1;L++){let M=new pe(L/(y.length-1),y[L]),v=M.y<m?1:M.y>O?2:3;for(let P=0;P<y.length;P++){let I=new pe(P/(y.length-1),y[P]),N=I.y<m?1:I.y>O?2:3;v!==N&&(v===1?N===2?(o(new oe(M,I),G),o(new oe(M,I),z)):o(new oe(M,I),G):v===2?N===1?(o(new oe(M,I),G),o(new oe(M,I),z)):o(new oe(M,I),z):N===1?o(new oe(M,I),G):o(new oe(M,I),z))}}B!==0&&(h=h.clip(B)[1]),Y!==1&&(h=h.clip((Y-B)/(1-B))[0]);let q=h.bbox();if(Te.eq(q.minX,q.maxX)&&Te.eq(q.minY,q.maxY)){x=0;for(let L of h.controls){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(Te.less(M,E))x=x|1;else if(Te.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x===3){let L=new pe((q.minX+q.maxX)/2,(q.minY+q.maxY)/2);l.getPercent(L)&&(_t[s++]=L.x,_t[s++]=L.y)}continue}if(Y-B>.8){let[L,M]=h.clip(.5);i.push([L,l]),i.push([M,l])}else i.push([h,l])}for(let a=0;a<s;a++)te[a]=_t[a];return s}function QN(e,t){if(e.bbox().extendOfSize(Te.eps).isSeparated(t.bbox()))return{cnt:0};let i=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,s=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(L){B=Math.min(B,L),Y=Math.max(Y,L)},o=function(L,M){let v=aa(L,M);if(v===0)throw new Error("cnt === 0");for(let P=0;P<v;P+=2)a(te[P])};if(s>r){for(let L=s-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(Te.eq(_t[L],_t[M])&&Te.eq(_t[L+1],_t[M+1])){_t[M]=(_t[L]+_t[M])/2,_t[M+1]=(_t[L+1]+_t[M+1])/2;for(let v=s-3;v>=L;v--)_t[v]=_t[v+2];s-=2;break}if(s>r){s=0;let L=new Float64Array(8),M=t.end(),v=0;e.getPercent(M)!==null&&(L[s++]=M.x,L[s++]=M.y,v=2);let P=e.end();return t.getPercent(P)!==null&&(L[s++]=P.x,L[s++]=P.y,v=v===0?1:3),te.set(L),{havOverlap:v,cnt:s}}}let[l,h]=i.pop(),c=l.controls,f=h.controls;if(c.length===2&&f.length===2){let L=aa(new oe(c[0],c[1]),new oe(f[0],f[1]));for(let M=0;M<L;M++)_t[s++]=te[M];continue}let d=c[0],u=c[c.length-1];d.equals1(u)&&(u=d.add1(1,0));let p=u.y-d.y,_=d.x-u.x,g=-p*d.x-_*d.y,b=Math.sqrt(1/(p**2+_**2));p*=b,_*=b,g*=b;let m=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY;if(c.forEach(L=>{let M=p*L.x+_*L.y+g;M<m&&(m=M),M>O&&(O=M)}),Te.eq(m,O)){if(h.controls.length===2){let L=aa(new oe(l.start(),l.end()),new oe(h.start(),h.end()));for(let M=0;M<L;M++)_t[s++]=te[M];if(L!==0)continue}l=new Be([c[0],c[c.length-1]]),c=l.controls}let y=f.map(L=>{let M=p*L.x+_*L.y+g,v=Math.abs(M);return v<n&&(n=v),M}),x=0;for(let L of y){if(Te.less(L,m))x=x|1;else if(Te.greater(L,O))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let E=0,w=0,S=u.x-d.x,C=u.y-d.y,R=Math.sqrt(1/(S**2+C**2));S*=R,C*=R;for(let L=1;L<c.length;L++){let M=c[L],v=(M.x-d.x)*S+(M.y-d.y)*C;v<E?E=v:v>w&&(w=v)}x=0;for(let L of f){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(Te.less(M,E))x=x|1;else if(Te.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let B=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;n/=2,n<=Te.eps&&(n=Te.eps),m-=n,O+=n,y.forEach((L,M)=>{L>=m&&L<=O&&a(M/(y.length-1))});let G=new oe(new pe(0,m),new pe(1,m)),z=new oe(new pe(0,O),new pe(1,O));for(let L=0;L<y.length-1;L++){let M=new pe(L/(y.length-1),y[L]),v=M.y<m?1:M.y>O?2:3;for(let P=0;P<y.length;P++){let I=new pe(P/(y.length-1),y[P]),N=I.y<m?1:I.y>O?2:3;v!==N&&(v===1?N===2?(o(new oe(M,I),G),o(new oe(M,I),z)):o(new oe(M,I),G):v===2?N===1?(o(new oe(M,I),G),o(new oe(M,I),z)):o(new oe(M,I),z):N===1?o(new oe(M,I),G):o(new oe(M,I),z))}}B!==0&&(h=h.clip(B)[1]),Y!==1&&(h=h.clip((Y-B)/(1-B))[0]);let q=h.bbox();if(Te.eq(q.minX,q.maxX)&&Te.eq(q.minY,q.maxY)){x=0;for(let L of h.controls){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(Te.less(M,E))x=x|1;else if(Te.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x===3){let L=new pe((q.minX+q.maxX)/2,(q.minY+q.maxY)/2);l.getPercent(L)&&(_t[s++]=L.x,_t[s++]=L.y)}continue}if(Y-B>.8){let[L,M]=h.clip(.5);i.push([L,l]),i.push([M,l])}else i.push([h,l])}for(let a=0;a<s;a++)te[a]=_t[a];return{cnt:s}}var eL=class{constructor(e=Te.eps){this.eps=e}eq(e,t){return Math.abs(e-t)<=this.eps}setEps(e){this.eps=e}},au=new eL;function c2(e,t){if(e.bbox().extendOfSize(Te.eps).isSeparated(t.bbox()))return 0;let i=[[e,t]],r=(t.controls.length-1)*16,s=0;for(;i.length!==0;){if(s>r){let a=function(){for(let h=0;h<s;h+=2)for(let c=h+2;c<s;c+=2)if(!(au.eq(_t[h],_t[c])&&au.eq(_t[h+1],_t[c+1]))){l(_t[c],_t[c+1],o);break}function l(h,c,f){let d=!1;for(let u=0;u<f.length;u+=2)if(au.eq(h,f[u])&&au.eq(c,f[u+1])){d=!0;break}d||f.push(h,c)}},o=[_t[0],_t[1]];if(a(),o.length>=100&&(au.setEps(.001),o=[_t[0],_t[1]],a(),o.length>=100))throw new Error("clearSamePoint()");s=o.length,o.forEach((l,h)=>_t[h]=l)}let n=i.pop();if(n[0]instanceof ye){let a=function(z){C=Math.min(C,z),R=Math.max(R,z)},o=function(z,q){let L=aa(z,q);if(L===0)throw new Error("cnt === 0");for(let M=0;M<L;M+=2)a(te[M])},[l,h]=n,c=h.controls;if(c.length===2){let z=GO(l,new oe(c[0],c[1]));for(let q=0;q<z;q++)_t[s++]=te[q];continue}let f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,u,p,_,g,b;if(Math.abs(l.sweepAngle)>359){let z=l.rx;u=l.center.add1(z,0),p=l.center.add1(-z,0),f=-z,d=z,_=0,g=1,b=-l.center.y}else{u=l.start(),p=l.end(),_=p.y-u.y,g=u.x-p.x,b=-_*u.x-g*u.y;let z=Math.sqrt(1/(_**2+g**2));_*=z,g*=z,b*=z;let q=_*l.center.x+g*l.center.y+b;l.isCCW?(d=l.rx+q,f=0):(f=q-l.rx,d=0)}let m=c.map(z=>_*z.x+g*z.y+b),O=0;for(let z of m){if(Te.less(z,f))O=O|1;else if(Te.greater(z,d))O=O|2;else{O=3;break}if(O===3)break}if(O!==3)continue;let y=0,x=0,E=p.x-u.x,w=p.y-u.y,S=Math.sqrt(1/(E**2+w**2));if(E*=S,w*=S,Math.abs(l.sweepAngle)<=180)y=0,x=(p.x-u.x)*E+(p.y-u.y)*w;else throw new Error("not support");O=0;for(let z of c){let q=(z.x-u.x)*E+(z.y-u.y)*w;if(Te.less(q,y))O=O|1;else if(Te.greater(q,x))O=O|2;else{O=3;break}if(O===3)break}if(O!==3)continue;let C=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY;f-=Te.eps,d+=Te.eps,m.forEach((z,q)=>{z>=f&&z<=d&&a(q/(m.length-1))});let B=new oe(new pe(0,f),new pe(1,f)),Y=new oe(new pe(0,d),new pe(1,d));for(let z=0;z<m.length-1;z++){let q=new pe(z/(m.length-1),m[z]),L=q.y<f?1:q.y>d?2:3;for(let M=0;M<m.length;M++){let v=new pe(M/(m.length-1),m[M]),P=v.y<f?1:v.y>d?2:3;L!==P&&(L===1?P===2?(o(new oe(q,v),B),o(new oe(q,v),Y)):o(new oe(q,v),B):L===2?P===1?(o(new oe(q,v),B),o(new oe(q,v),Y)):o(new oe(q,v),Y):P===1?o(new oe(q,v),B):o(new oe(q,v),Y))}}C!==0&&(h=h.clip(C)[1]),R!==1&&(h=h.clip((R-C)/(1-C))[0]);let G=h.bbox();if(Te.eq(G.minX,G.maxX)&&Te.eq(G.minY,G.maxY)){O=0;for(let z of h.controls){let q=(z.x-u.x)*E+(z.y-u.y)*w;if(Te.less(q,y))O=O|1;else if(Te.greater(q,x))O=O|2;else{O=3;break}if(O===3)break}O===3&&(_t[s++]=(G.minX+G.maxX)/2,_t[s++]=(G.minY+G.maxY)/2);continue}R-C>.8?h.clip(.5).forEach(z=>i.push([z,l])):i.push([h,l])}else{let[a,o]=n;i.push([ye.build3(o.center,o.startAngle,o.sweepAngle/2,o.rx,o.ry),a]),i.push([ye.build3(o.center,o.startAngle+o.sweepAngle/2,o.sweepAngle/2,o.rx,o.ry),a])}}for(let n=0;n<s;n++)te[n]=_t[n];return s}var tL=class{static getSweep(e){if(e.length>2){let t=0,i=e.length;for(let n=0;n<i-1;n++){let a=e[n],o=e[n+1];t+=(o.x+a.x)*(o.y-a.y)}let r=e[0],s=e[i-1];return t+=(r.x+s.x)*(r.y-s.y),t>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(e){return!!(e.primitives.length>0&&e.primitives[0].start().equals1(e.primitives[e.primitives.length-1].end()))}};function iL(e){let t=e.primitives,i=t[0],r=i instanceof ye?i.sweepAngle%360:null;if(t.length===1&&i instanceof ye&&(Te.eq(r,0)||Te.eq(Math.abs(r),360)))return!!i.isCCW;let s=new Array;return e.points(.1,n=>{s.push(n)}),tL.getSweep(s)}var rL=class{static zoomCorner(e,t){let i=new Array,r=new Array,s=new Array;return this.getPanPrimitive(e,i,s,t),this.rearrange(i,s),this.processStart(i,s),this.getResult(i,s,r,t),r.length>0?bt.build2(r):null}static zoomPolygon(e,t){let i=new Array,r=new Array,s=new Array;return iL(e)&&(e=e.reverse().asClose()),this.getPanPrimitive(e,i,s,t),this.rearrange(i,s),this.processStart(i,s),this.getResult(i,s,r,t),r.length>0?bt.build2(r):null}static zoomLines(e,t){return this.zoomPolygon(bt.build2(e.primitives.concat(e.reverse().primitives)),t/2)}static getPanPrimitive(e,t,i,r){let s=e.primitives;for(let n of s){let a=this.panDistance(n,r);a!==void 0&&(t.push(a),i.push(n))}}static rearrange(e,t){let i=e.length,r=0;for(let a=0;a<i;a++){let o=t[a],l=e[a],h=a==i-1?e[0]:e[a+1];if(!(l instanceof ye&&h instanceof ye)&&!this.isCW(l.end(),h.start(),o.end())){if(ln(l,h)!=0){r=a==i-1?0:a+1;break}}else{r=a;break}}let s=this.start4Index(t,r),n=this.start4Index(e,r);t.length=0,e.length=0,s.forEach(a=>{t.push(a)}),n.forEach(a=>{e.push(a)})}static processStart(e,t){let i=e.length;if(i>2){let r=e[i-1],s=e[0],n=t[i-1];if(!(r instanceof ye&&s instanceof ye)&&!this.isCW(r.end(),s.start(),n.end())){let a=ln(r,s);for(let o=0;o<a;o+=2){let l=new pe(te[o],te[o+1]);e[i-1]=this.generatePrimitive(r,r.start(),l),e[0]=this.generatePrimitive(s,l,s.end())}}}}static getResult(e,t,i,r){let s=e.length;for(let n=0;n<s;n++){let a=t[n],o=n===s-1?t[0]:t[n+1],l=n==s-1?0:n+1,h=l==s-1?t[0]:t[l+1],c=e[n],f=n==s-1?e[0]:e[n+1],d=l==s-1?e[0]:e[l+1];if(!(c instanceof ye&&f instanceof ye)&&!this.isCW(c.end(),f.start(),a.end())){let p=this.add(e,i,n,c,f,0);p=this.update(e,i,n,f,p);let _=this.generateArc(o,h,f,d,r);if(p=this.add(e,i,n,c,_,p),p=this.update(e,i,n,_,p),p>0)continue}i.push(c);let u=this.generateArc(a,o,c,f,r);u!==void 0&&i.push(u)}}static generateArc(e,t,i,r,s){if(s>0){let n=e.end(),a=t.start(),o=i.end(),l=r.start();if(o.distance2(l)>1e-8)if(n.equals(a)){let h=o.angleD(n),c=l.angleD(n);return ye.build2(n,h,c,s,s,0)}else{let h=o.angleD(n),c=l.angleD(n),f=o.angleD(a),d=l.angleD(a),u=ye.build2(n,h,c,s,s,0),p=ye.build2(a,f,d,s,s,0);return u.pointOn(u.endAngle()).equals1(l)?u:p.pointOn(p.endAngle()).equals1(l)?p:u}}}static updateNews(e,t,i,r){let s=e.length,n=t==s-1?0:t+1;e[n]=this.generatePrimitive(i,r,i.end())}static add(e,t,i,r,s,n){if(n>0)return n;if(r!=null&&s!=null){let a=ln(r,s);for(let o=0;o<a;o+=2){let l=new pe(te[o],te[o+1]);t.push(this.generatePrimitive(r,r.start(),l)),this.updateNews(e,i,s,l);break}return a}else return 0}static update(e,t,i,r,s){if(s>0)return s;let n=t.length;if(n>0&&r!=null){let a=t[n-1],o=ln(a,r);for(let l=0;l<o;l+=2){let h=new pe(te[l],te[l+1]);t[n-1]=this.generatePrimitive(a,a.start(),h),this.updateNews(e,i,r,h)}return o}else return 0}static generatePrimitive(e,t,i){if(e instanceof oe)return new oe(t,i);if(e instanceof ye){let r=e,s=t.angleD(r.center),n=i.angleD(r.center);return ye.build2(r.center,s,n,r.rx,r.ry,r.sweep())}else throw new Error("not supported operation")}static start4Index(e,t){let i=e.length,r=new Array;for(let s=t;s<i;s++)r.push(e[s]);for(let s=0;s<t;s++)r.push(e[s]);return r}static isCW(e,t,i){let r=new oe(i,e),s=new oe(i,t),n=r.end().x-r.start().x,a=r.end().y-r.start().y,o=s.end().x-s.start().x,l=s.end().y-s.start().y;return!(n*l-a*o>0)}static panDistance(e,t){if(e instanceof oe){if(e.isPoint())return;{let i=e.panDistance(t);return i.length()>1e-5?i:void 0}}else if(e instanceof ye){let i=e;if(i.sweepAngle>0){if(i.rx-t<=0||i.ry-t<=0)return}else if(i.sweepAngle<0&&(i.rx+t<=0||i.ry+t<=0))return;return i=i.panDistance(t),i.start().distance1(i.end())>1e-5||Te.eq(Math.abs(i.sweepAngle),360)?i:void 0}else throw new Error("not supported operation")}},et=.001,is=et**2;function Ve(e,t){return e.distance2(t)<is}function la(e,t){return Math.abs(e-t)<=1e-4}function sL(e,t){if(e instanceof oe)return new oe(e.start(),t);if(e instanceof ye){let i=t.angleD(e.center);return la(ot.regularD(e.startAngle),ot.regularD(i))?ye.build3(e.center,e.startAngle,0,e.rx,e.ry):ye.build2(e.center,e.startAngle,i,e.rx,e.ry,e.isCCW?1:0)}else{if(e instanceof Be)return e.clip(e.getPercent(t,et))[0];throw new Error("not supported operation")}}function Pn(e,t=ot.toRadians(e.startAngle)){return e.isCCW?t+=op:t-=op,new pe(Math.cos(t),Math.sin(t))}function Su(e,t=0){let i=e.controls;if(t===0){let r=i[0],s=i.slice(1).find(n=>!(n.x===r.x&&n.y===r.y));if(!s)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return s.sub(r)}else if(t===1){let r=i[i.length-1],s=i.slice(0,-1).reverse().find(n=>!(n.x===r.x&&n.y===r.y));if(!s)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return r.sub(s)}if(i.length===3){let[r,s,n]=i;return s.sub(r).mul(2*(1-t)).add(n.sub(s).mul(2*t)).normalize()}else{let[r,s,n,a]=i;return s.sub(r).mul(3*(1-t)**2).add(n.sub(s).mul(6*(1-t)*t)).add(a.sub(n).mul(3*t**2)).normalize()}}function Ph(e,t,i){let r=e.slice(1).findIndex(n=>!(n.x===t.x&&n.y===t.y)),s=e[r+1];if(i&&(i.getPercent(s,et)!==null||new oe(i.start(),i.end()).distance(s)<=et)&&(s=e[r+2]),!s)throw Error("getSecondPoint(controls: readonly Vector2[])");return s}function Qe(e,t){if(e instanceof oe)return e.end().sub(e.start()).normalize();if(e instanceof ye)return(t?Pn(e,t.angle(e.center)):Pn(e)).normalize();if(e instanceof Be)if(e.controls.length===2){let[i,r]=e.controls;if(Ve(i,r))throw Error("equalsPP(p0, p1)");return r.sub(i).normalize()}else return(t?Su(e,e.getPercent(t,et)):Su(e)).normalize();else throw new Error("not support")}function nL(e,t,i){let r=[],s=t**2-4*e*i;if(s>=0){let n=-t/(2*e),a=Math.sqrt(s)/(2*e),o=n+a;if(r.push(o),s>0){let l=n-a;r.push(l)}}return r}function aL(e,t,i,r,s=0,n=1){let a=[],o=e*Math.pow(s,3)+t*Math.pow(s,2)+i*s+r,l=e*Math.pow(n,3)+t*Math.pow(n,2)+i*n+r,h,c;if(o*l<0)for(;Math.abs(s-n)>et;)if(h=(s+n)/2,c=e*Math.pow(h,3)+t*Math.pow(h,2)+i*h+r,Math.abs(c)<et){a.push(h);break}else o*c<0?n=h:l*c<0&&(s=h);else o*l===0&&(o===0&&a.push(s),l===0&&a.push(n));return a}function OO(e,t,i){if(e instanceof oe||t.distance2(i)<=is)return new oe(t,i);if(e instanceof ye)return ye.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof Be){let r=e.getPercent(t,et),s=e.getPercent(i,et);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}function zO(e){return Te.greater(e,0)&&Te.less(e,1)}function hp(e,t,i,r){let s=e[r]-2*t[r]+i[r],n=t[r]-e[r];if(s===0)return[];let a=-n/s,o=[];return zO(a)&&o.push(a),o}function cp(e,t,i,r,s){let n,a,o=-e[s]+3*t[s]-3*i[s]+r[s],l=2*(e[s]-2*t[s]+i[s]),h=t[s]-e[s],c=l**2-4*o*h;if(Te.lesseq(c,0))n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;else{let d=Math.sqrt(c);n=(-l-d)/(2*o),a=(-l+d)/(2*o);let u=o*2;if(Te.lesseq(n,1)&&Te.greatereq(n,0)){let p=Number.NEGATIVE_INFINITY;for(;Te.neq(n,p);){p=n;let _=u*n+l;n=-(o*n**2+l*n+h-_*n)/_}}if(Te.lesseq(a,1)&&Te.greatereq(a,0)){let p=Number.NEGATIVE_INFINITY;for(;Te.neq(a,p);){p=a;let _=u*a+l;a=-(o*a**2+l*a+h-_*a)/_}}}let f=[];return zO(a)&&f.push(a),zO(n)&&f.push(n),f}function lb(e,t){if(e.controls.length===2){let[o,l]=e.controls;Ve(o,l)||t.push(new oe(o,l));return}let i,r;if(e.controls.length===3){let[o,l,h]=e.controls;i=hp(o,l,h,"x"),r=hp(o,l,h,"y")}else{let[o,l,h,c]=e.controls;i=cp(o,l,h,c,"x"),r=cp(o,l,h,c,"y")}i.sort((o,l)=>l-o),r.sort((o,l)=>l-o);let s=i.pop()||1,n=r.pop()||1,a=0;for(;s!==1||n!==1;)if(Te.eq(s,n))s=i.pop()||1,n=r.pop()||1;else if(s<n){let[o,l]=e.clip((s-a)/(1-a));a=s,t.push(o),e=l,s=i.pop()||1}else{let[o,l]=e.clip((n-a)/(1-a));a=n,t.push(o),e=l,n=r.pop()||1}t.push(e)}var oL=1e-5,_m=1,Be=class ds extends Bu{constructor(t){if(super(),this._startToEndL=null,t.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=t.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new oe(this.start(),this.end())),this._startToEndL}build1(t){let i=[];return Lh(t,(r,s)=>(i.push(s),!0)),new ds(i)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(t,i){if(i.length<1)throw new Error("bezier must have at least 1 point");if(i.length===1)return i[0];{let r=new Array(i.length-1);for(let s=1;s<i.length;s++){let n=i[s-1],a=i[s],o=(a.x-n.x)*t,l=(a.y-n.y)*t;r[s-1]=n.add1(o,l)}return ds.pointOn(t,r)}}clip1(t,i,r,s){if(r.push(i[0]),s.push(i[i.length-1]),i.length<2)throw new Error("bezier clip must have at least 2 point");if(i.length===2){let n=i[0],a=i[1],o=(a.x-n.x)*t,l=(a.y-n.y)*t,h=n.add1(o,l);r.push(h),s.push(h)}else{let n=new Array(i.length-1);for(let a=1;a<i.length;a++){let o=i[a-1],l=i[a],h=(l.x-o.x)*t,c=(l.y-o.y)*t;n[a-1]=o.add1(h,c)}this.clip1(t,n,r,s)}}clip(t){let i=[],r=[];return this.clip1(t,this.controls,i,r),[new ds(i),new ds(r.reverse())]}greater(t,i,r){return t-i>r}less(t,i,r){return t-i<-r}eq(t,i,r){return Math.abs(t-i)<=r}eqPP(t,i,r){return!t||!i?!1:this.eq(t.x,i.x,r)&&this.eq(t.y,i.y,r)}isInRange(t,i=Te.eps){let r=this.controls.map(n=>n.y-t.y),s=0;for(let n of r){if(this.less(n,0,i))s=s|1;else if(this.greater(n,0,i))s=s|2;else{s=3;break}if(s===3)break}if(s!==3)return!1;s=0;for(let n of this.controls){let a=n.x-t.x;if(this.less(a,0,i))s=s|1;else if(this.greater(a,0,i))s=s|2;else{s=3;break}if(s===3)break}return s===3}getPercent(t,i=Te.eps){if(!this.isInRange(t,i))return null;let r=Number.POSITIVE_INFINITY,s=[[this,0,1]];for(;s.length!==0;){let n=function(g){c=Math.min(c,g),f=Math.max(f,g)},a=function(g,b){let m=aa(g,b);if(m===0)throw new Error("cnt === 0");for(let O=0;O<m;O+=2)n(te[O])},[o,l,h]=s.pop();if(this.eqPP(o.start(),t,i))return l;if(this.eqPP(o.end(),t,i))return h;let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d=o.controls.map(g=>g.y-t.y);r=d.reduce((g,b)=>{let m=Math.abs(b);return m<g?m:g},r),r/=2,r<=i&&(r=i),d.forEach((g,b)=>{this.eq(g,0,i)&&n(b/(d.length-1))});let u=new oe(new pe(0,-r),new pe(1,-r)),p=new oe(new pe(0,r),new pe(1,r));for(let g=0;g<d.length-1;g++){let b=new pe(g/(d.length-1),d[g]),m=this.less(b.y,0,i)?1:this.greater(b.y,0,i)?2:3;for(let O=0;O<d.length;O++){let y=new pe(O/(d.length-1),d[O]),x=this.less(y.y,0,i)?1:this.greater(y.y,0,i)?2:3;m!==x&&(m===1?x===2?(a(new oe(b,y),u),a(new oe(b,y),p)):a(new oe(b,y),u):m===2?x===1?(a(new oe(b,y),u),a(new oe(b,y),p)):a(new oe(b,y),p):x===1?a(new oe(b,y),u):a(new oe(b,y),p))}}if(!isFinite(c)){if(Math.max(...d.map(g=>Math.abs(g)))<i*4)return(l+h)/2;continue}if(c!==0&&(o=o.clip(c)[1],l=(h-l)*c+l),f!==1){let g=(f-c)/(1-c);o=o.clip(g)[0],h=(h-l)*g+l}if(!o.isInRange(t,i))continue;let _=o.controls.reduce((g,b)=>g.ext2(b),new Ss).build1();if(this.eq(_.minX,_.maxX,i)&&this.eq(_.minY,_.maxY,i))return(l+h)/2;if(f-c>.8){let[g,b]=o.clip(.5);g.isInRange(t,i)?(s.push([g,l,(l+h)/2]),b.isInRange(t,i)&&s.push([b,(l+h)/2,h])):s.push([b,(l+h)/2,h])}else s.push([o,l,h])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new Ss().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new Ss().ext3(this.controls).build()),this._bbox_controls}multiply3(t){let i=new Array(this.controls.length);for(let r=0;r<this.controls.length;r++){let s=this.controls[r];i[r]=s.multiply3(t)}return new ds(i)}stroke(t,i,r,s=_m){let n=rL.zoomLines(bt.build4(this.points(s)),t);return r===0?n:n.reverse()}points(t){let i=[];return this.getBezierPoints(t,r=>i.push(r)),i}getBezierPoints(t,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let r=[this];for(i(this.start());r.length!==0;){let n=r.pop(),a=new oe(n.start(),n.end());if(s(n.controls,a)<=t)i(n.end());else{let[o,l]=n.clip(.5);r.push(l,o)}}function s(n,a){let o=a.start(),l=a.end();o.equals1(l)&&(l=o.add1(1,0));let h=l.y-o.y,c=o.x-l.x,f=-h*o.x-c*o.y,d=Math.sqrt(1/(h**2+c**2));h*=d,c*=d,f*=d;let u=n.map(p=>Math.abs(h*p.x+c*p.y+f));return Math.max(...u)}}getBezierPoints3(t,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let r=t*t,s=this.controls[0],n=.5;for(;n>oL&&!(s.distance2(ds.pointOn(n,this.controls))<=r);n*=.5);let a=Math.ceil(1/n);n=1/a,i(s);let o=0;for(let l=1;l<a;l++)o+=n,i(ds.pointOn(o,this.controls));i(this.end())}getPointsBySlope(t){if(this.controls.length===4)return this.getPointsBySlope4(t);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(t){let[i,r,s,n]=this.controls,a=-3*i.x+9*r.x-9*s.x+3*n.x,o=6*i.x-12*r.x+6*s.x,l=-3*i.x+3*r.x,h=[];if(Number.isFinite(t)){let c=-3*i.y+9*r.y-9*s.y+3*n.y,f=6*i.y-12*r.y+6*s.y,d=-3*i.y+3*r.y,u=c-a*t,p=f-o*t,_=d-l*t,g=-p/(2*u),b=Math.sqrt(p**2-4*u*_)/(2*u),m=g+b;m>=0&&m<=1&&h.push(ds.pointOn(m,this.controls));let O=g-b;O>=0&&O<=1&&h.push(ds.pointOn(O,this.controls))}else{let c=-o/(2*a),f=Math.sqrt(o**2-4*a*l)/(2*a),d=c+f;d>=0&&d<=1&&h.push(ds.pointOn(d,this.controls));let u=c-f;u>=0&&u<=1&&h.push(ds.pointOn(u,this.controls))}return h}buildConverxHull(t=Te.eps){let i=[...this.controls],r=[],s=i[0],n=1;do{let a=i[n%i.length];this.eqPP(s,a,t)||r.push(new oe(s,a)),s=a,n++}while(s!==i[0]);if(r.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return bt.build7(r).asClose()}getExtremePoints(t){if(!t)return a(this.controls);let i=t.start(),r=t.end(),s=r.x-i.x,n=r.y-i.y;if(Math.abs(s)<=Te.eps||Math.abs(n)<=Te.eps)return a(this.controls);{let o=n/s;if(this.controls.length===3){i.equals1(r)&&(r=i.add1(1,0));let l=r.y-i.y,h=i.x-r.x,c=-l*i.x-h*i.y,f=Math.sqrt(1/(l**2+h**2));l*=f,h*=f,c*=f;let d=this.controls.map(_=>l*_.x+h*_.y+c),u=d[0]-2*d[1]+d[2],p=d[1]-d[0]-o/2;if(u!==0){let _=-p/u;if(Te.greater(_,0)&&Te.less(_,1))return[ds.pointOn(_,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(o)}return[];function a(o){let l,h;if(o.length===3){let[u,p,_]=o;l=hp(u,p,_,"x"),h=hp(u,p,_,"y")}else if(o.length===4){let[u,p,_,g]=o;l=cp(u,p,_,g,"x"),h=cp(u,p,_,g,"y")}l.sort((u,p)=>p-u),h.sort((u,p)=>p-u);let c=l.pop()||1,f=h.pop()||1,d=[];for(;c!==1||f!==1;)Te.eq(c,f)?(c=l.pop()||1,f=h.pop()||1):c<f?(d.push(ds.pointOn(c,o)),c=l.pop()||1):(d.push(ds.pointOn(f,o)),f=h.pop()||1);return d}}getToLineMaxDis2(t){let i=this.getExtremePoints(t),r=t.distance2(this.start()),s=t.distance2(this.end()),n=Math.max(r,s);return i.forEach(o=>a(t.distance2(o))),n;function a(o){n=Math.max(n,o)}}getToLineMinAndMaxDis_Controls(t){let i=t.start(),r=t.end();t.start().equals1(t.end())&&(r=i.add1(1,0));let s=r.y-i.y,n=i.x-r.x,a=-s*i.x-n*i.y,o=Math.sqrt(1/(s**2+n**2));s*=o,n*=o,a*=o;let l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return this.controls.forEach(c=>{let f=s*c.x+n*c.y+a;f<l&&(l=f),f>h&&(h=f)}),{minDis:l,maxDis:h}}getPercentInLine(t){let i=[],r=[],s=this.controls,n=t.start(),a=t.end(),o=a.y-n.y,l=n.x-a.x,h=-o*n.x-l*n.y,c=Math.sqrt(1/(o**2+l**2));if(o*=c,l*=c,h*=c,o**2+l**2<=0)return i;if(s.length===3){let[f,d,u]=s,p=o*(f.x-2*d.x+u.x)+l*(f.y-2*d.y+u.y),_=2*(o*(d.x-f.x)+l*(d.y-f.y)),g=o*f.x+l*f.y+h;r=nL(p,_,g)}else if(s.length===4){let[f,d,u,p]=s,_=p.sub(u.mul(3)).add(d.mul(3)).sub(f),g=f.sub(d.mul(2)).add(u).mul(3),b=d.sub(f).mul(3),m=f,O=o*_.x+l*_.y,y=o*g.x+l*g.y,x=o*b.x+l*b.y,E=o*m.x+l*m.y+h,w=Math.sqrt(1/(O**2+y**2));O*=w,y*=w,x*=w,E*=w,r=aL(O,y,x,E)}else throw Error("not support getBeizerPointInLine");return r.forEach(f=>{f>=0&&f<=1&&i.push(f)}),i}reverse(){return new ds(this.controls.slice().reverse())}},ra,hb=(ra=class{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=pe.ORIGIN,this.textOffsetCache[1]=new pe(0,-.5),this.textOffsetCache[2]=new pe(0,-1),this.textOffsetCache[3]=new pe(-.5,0),this.textOffsetCache[4]=new pe(-.5,-.5),this.textOffsetCache[5]=new pe(-.5,-1),this.textOffsetCache[6]=new pe(-1,0),this.textOffsetCache[7]=new pe(-1,-.5),this.textOffsetCache[8]=new pe(-1,-1)}static getCache(){return ra.instance==null&&(ra.instance=new ra),ra.instance}},ra.instance=null,ra),oe=class yl extends Bu{constructor(t,i){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=t,this._end=i}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(t){if(Te.eq(this.distance(t),0)){let i=new yl(this._start,t);return i._a=this._a,i._b=this._b,i._c=this._c,i}return new yl(this._start,t)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new Be([this._start,this._end])}_hashCode(){let t=31,i=1;return i=t*i+this._start.hashCode(),i=t*i+this._end.hashCode(),i}start(){return this._start}end(){return this._end}center(){let t=this.start(),i=this.end();return t.add(i).mul(.5)}panDistance(t){let i=this._end.x-this._start.x,r=this._end.y-this._start.y,s=this.length();i=i*t/s,r=-r*t/s;let n=new pe(this._start.x+r,this._start.y+i),a=new pe(this._end.x+r,this._end.y+i);return new yl(n,a)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let t=hb.getCache().boxCache;t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.__bbox=new Qr(t[0],t[1],t[2],t[3])}return this.__bbox}multiply3(t){return new yl(this._start.multiply3(t),this._end.multiply3(t))}hashCode(){return this.hashed}equals(t){let i=t;return this.hashed===i.hashed&&this._start.equals(i._start)&&this._end.equals(i._end)}equals1(t){let i=t;return this.hashed===i.hashed&&this._start.equals1(i._start)&&this._end.equals1(i._end)}equals2(t){let i=[this.start(),this.end()],r=[t.start(),t.end()];return Tn(i,r)||Tn(i,r.reverse())}stroke(t,i,r){let s,n,a;this._end.x<this._start.x?(n=this._start.x-this._end.x,a=this._start.y-this._end.y,s=this._end):(n=this._end.x-this._start.x,a=this._end.y-this._start.y,s=this._start);let o=Math.sqrt(n*n+a*a),l=t/2,h,c,f;i===2?(c=-l,f=o+l):(c=0,f=o),i===0||i===2?r===0?h=bt.build5([c,-l,c,l,f,l,f,-l]):h=bt.build5([c,l,c,-l,f,-l,f,l]):r===0?h=bt.build2([ye.build3(new pe(c,0),-90,-180,l,l),ye.build3(new pe(f,0),90,-180,l,l)]):h=bt.build2([ye.build3(new pe(c,0),90,180,l,l),ye.build3(new pe(f,0),-90,180,l,l)]);let d=Math.atan2(a,n),u=Yt.rotate(d).translate1(s);return h.asClose().multiply3(u)}points(t){return[this._start,this._end]}mirrorY(t){return new yl(this.start().mirrorY(t),this.end().mirrorY(t))}reverse(){return new yl(this._end,this._start)}inArea(t,i,r){let s=t.x,n=t.y,a=this._start,o=this._end,l=r==1,h=s-a.x,c=n-a.y,f=s-o.x,d=n-o.y,u=o.x-a.x,p=o.y-a.y,_=new pe(-p,u).normalize(),g=u+_.x*i/2,b=p+_.y*i/2,m=g*g+b*b,O=h*h+c*c,y=f*f+d*d,x=Math.abs(h*p-c*u)/2,E=Math.sqrt(u*u+p*p)*i/4;if(x<=E&&O<=m&&y<=m){if(l)return!0;{let w=new pe(s,n).sub(o).normalize(),S=new pe(s,n).sub(a).normalize(),C=new pe(_.x,_.y).cross(w),R=new pe(_.x,_.y).cross(S);return C>=0&&R<=0}}else if(l){let w=i/2;return O<=w*w?!0:y<=w*w}else return!1}isParallel(t,i=!1){let r=Te.eq(Math.abs(this.direct.cross(t.direct)),0),s=!i||Te.greatereq(this.direct.dot(t.direct),0);return r&&s}distance2(t){return(this.a*t.x+this.b*t.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(t){let{x:i,y:r}=t,{x:s,y:n}=this.start(),{x:a,y:o}=this.end();return((i-s)*(o-n)-(r-n)*(a-s))**2/((o-n)**2+(a-s)**2)}distance(t){return Math.abs(this.a*t.x+this.b*t.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function lL(e,t=.05){if(e.length<3)return e.slice();let i=e.slice(0,1),r=(n,a,o)=>zN(n.x,n.y,a.x,a.y,o.x,o.y);for(;;){i=e.slice(0,1);for(let n=1;n<e.length-1;n+=2)r(e[n],e[n-1],e[n+1])>t&&i.push(e[n]),i.push(e[n+1]);if(i.at(-1).equals1(e.at(-1))||i.push(e.at(-1)),e.length==i.length)break;e=i}let s=e[e.length-1];return i.push(s),i}var hL=mN(yN());var cL=class{constructor(){this.fac=new Ss,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(e){for(this.fac.clear(),this.length=e.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=e[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},uL=new cL,bt=class Ui{constructor(t,i){this.__bbox=null,this.primitives=t,this.__bbox=i}static calcBBox(t){return uL.calcBBox(t)}static build1(t){let i=[],r=null;return np(t,(s,n)=>{let a=n.start();return r!==null&&!a.equals(r)&&i.push(new oe(r,a)),i.push(n),r=n.end(),!0}),i.length===0&&r!=null&&i.push(new oe(r,r)),new Ui(i)}static build2(t){return Ui.build1(UO(t))}static build3(t){let i=[],r=null;return np(t,(s,n)=>(r!==null&&i.push(new oe(r,n)),r=n,!0)),new Ui(i)}static build4(t){return this.build3(UO(t))}static build5(t){let i=[];for(let r=0;r<t.length;r+=2)i.push(new pe(t[r],t[r+1]));return this.build4(i)}static build6(t){return Ui.build4([t.LL(),t.LR(),t.UR(),t.UL(),t.LL()])}static build7(t){return new Ui(t)}static build8(t){let i=new pe(t[0],t[1]),r,s=[],n,a=(o,l)=>o.length==l&&o.every(h=>typeof h=="number");for(let o=2;o<t.length;)switch(typeof t[o]=="string"?n=t[o]:o-=1,n){case"ARC":{let l=t.slice(o+1,o+4);if(!a(l,3))throw new Error("invalid rawData");let h=l[0];r=new pe(l[1],l[2]),s.push(ye.build5(i,r,h)),i=r,o+=4;break}case"L":{let l=t.slice(o+1,o+3);if(!a(l,2))throw new Error("invalid rawData");r=new pe(l[0],l[1]),s.push(new oe(i,r)),i=r,o+=3;break}case"C":{let l=t.slice(o+1,o+7);if(!a(l,7))throw new Error("invalid rawData");let h=new pe(l[0],l[1]),c=new pe(l[2],l[3]);r=new pe(l[4],l[5]),s.push(new Be([i,h,c,r])),i=r,o+=7;break}default:throw new Error("invalid rawData")}return Ui.build2(s)}static buildBBox(t,i=0){return i===1?Ui.build5([t.minX,t.minY,t.maxX,t.minY,t.maxX,t.maxY,t.minX,t.maxY,t.minX,t.minY]):Ui.build5([t.minX,t.minY,t.minX,t.maxY,t.maxX,t.maxY,t.maxX,t.minY,t.minX,t.minY])}static triangulate(t,i,r=1){if(t.length===1){let l=new Array;t[0].asClose().points2(r,d=>l.push(d));let h,c=l[0],f=[];for(let d=0;d<l.length-2;d+=2){let u=l[d+1],p=l[d+2],_=u.sub(c).normalize().cross(p.sub(c).normalize());if(Te.neq(_,0)){if(h===!0){if(_<0){f.length=0;break}}else if(h===!1){if(_>0){f.length=0;break}}else h=_>0;f.push(c),f.push(u),f.push(p)}l.push(c),c=p}if(f.length!==0){for(let d=0;d<f.length;d+=3)i(f[d],f[d+1],f[d+2]);return}}let s=[],n=[];t.forEach(l=>{s.length!==0&&n.push(s.length/2),l.asClose().points2(r,h=>s.push(h.x,h.y))});let a=hL.default(s,n),o=[];for(let l=1;l<s.length;l+=2)o.push(new pe(s[l-1],s[l]));for(let l=0;l<a.length;l+=3)i(o[a[l]],o[a[l+1]],o[a[l+2]])}lines(t,i){let r=new Array;this.points(t,n=>r.push(n));let s=r[0];for(let n=1;n<r.length;n++){let a=r[n];i(s),i(a),s=a}}triangles(t,i){Ui.triangulate([this],(...r)=>{r.forEach(s=>i(s))},t)}mirror(){let t=[];return this.primitives.forEach(i=>{if(i instanceof oe)i=new oe(i.start().mirror(),i.end().mirror());else if(i instanceof ye)i=i.mirror();else if(i instanceof Be){let r=i.controls.map(s=>s.mirror());i=new Be(r)}else throw new Error("bug");t.push(i)}),new Ui(t,this.__bbox)}getPoints(t){let i=[];for(let r of this.primitives)for(let s of r.points(t))i.push(s);return i}round(t=4){let i=this.primitives.slice();for(let r=0;r<i.length;r++){let s=i[r];if(s instanceof oe){let n=s.start().round(t),a=s.end().round(t);i[r]=new oe(n,a)}else if(s instanceof Be){let n=s.controls.map(a=>a.round(t));i[r]=new Be(n)}else if(s instanceof ye){let n=s.start().round(t),a=s.end().round(t),o=s.sweepAngle;i[r]=ye.build5(n,a,o)}}return new Ui(i,this.__bbox)}simplify(t=.05){let i=[],r=!1,s=[],n=this.closed();if(this.primitives.length<=1)return Ui.build2(this.primitives);let a=()=>{if(s.length>2){let l=lL(s,t);for(let h=1;h<l.length;h++)i.push(new oe(l[h-1],l[h]))}else i.push(new oe(s[0],s[1]));s.length=0,r=!1};for(let l=0;l<this.primitives.length;l++){let h=this.primitives[l];h instanceof oe?(r?s.push(h.end()):(s.length=0,s.push(h.start(),h.end()),r=!0),l===this.primitives.length-1&&a()):(r&&a(),i.push(h))}let o=new Ui(i,this.__bbox);return n&&!o.closed()&&(o=o.asClose()),o}hasBackLine(){let{primitives:t}=this,i;for(let r=0;r<t.length;r++){let s=t[r];if(s instanceof oe){if(s.end().equals1(s.start()))continue;if(i&&(s.end().equals1(i.start())||HN(s.end(),i.start(),i.end())))return!0;i=s}else i=null}return!1}area(t=.1){let i=0,r=this.end();return this.primitives.forEach(s=>{let n=s.start(),a=s.end();if(i+=(n.x+r.x)*(n.y-r.y),s instanceof oe)i+=(a.x+n.x)*(a.y-n.y);else if(s instanceof ye)i+=(a.x+n.x)*(a.y-n.y),i+=Math.PI*s.rx2*s.sweepAngle/180-pe.normal(s.center,s.start(),s.end());else if(s instanceof Be){let o=n;s.points(t).forEach(l=>{i+=(l.x+o.x)*(l.y-o.y),o=l}),i+=(a.x+o.x)*(a.y-o.y)}r=a}),i/2}closed(t){return this.primitives.length===0?!1:this.start().equals(this.end(),t)}asClose(){let t=this.primitives[0],i=this.primitives[this.primitives.length-1],r=t.start(),s=i.end();if(r.equals(s))return this;{let n=new Array;return es.addAll(n,this.primitives),n.push(new oe(s,r)),Ui.build2(n)}}closeEndpoint(){let t=this.primitives[0],i=this.primitives[this.primitives.length-1],r=t.start(),s=i.end();if(r.equals1(s))return this;{let n=new Array;return es.addAll(n,this.primitives),n.push(new oe(s,r)),new Ui(n)}}reverse(){let t=new Array(this.primitives.length);for(let i=0,r=this.primitives.length-1;r>=0;i++,r--){let s=this.primitives[r];if(s instanceof oe)s=new oe(s.end(),s.start());else if(s instanceof ye)s=s.exchangeSweep();else if(s instanceof Be)s=new Be(s.controls.slice().reverse());else throw new Error("bug");t[i]=s}return new Ui(t,this.__bbox)}reverse1(){let t=new Array(this.primitives.length);for(let i=0,r=this.primitives.length-1;r>=0;i++,r--){let s=this.primitives[r];if(s instanceof oe)s=new oe(s.end(),s.start());else if(s instanceof ye)s=s.exchangeSweep1();else if(s instanceof Be)s=new Be(s.controls.slice().reverse());else throw new Error("bug");t[i]=s}return new Ui(t,this.__bbox)}mirrorY(t){let i=[];return this.primitives.forEach(r=>{if(r instanceof oe)r=r.mirrorY(t);else if(r instanceof ye)r=r.mirrorY(t);else if(r instanceof Be){let s=r.controls.map(n=>n.mirrorY(t));r=new Be(s)}else throw new Error("bug");i.push(r)}),new Ui(i,this.__bbox)}points(t,i){if(this.primitives.length!==0){for(let r=0;r<this.primitives.length-1;r++){let s=this.primitives[r].points(t);s.pop(),s.forEach(n=>i(n))}this.primitives[this.primitives.length-1].points(t).forEach(r=>i(r))}}points1(t,i){if(this.primitives.length===0)return;for(let s=0;s<this.primitives.length-1;s++){let n=this.primitives[s],a=n instanceof ye?n.points1(t):n.points(t);a.pop(),a.forEach(o=>i(o))}let r=this.primitives[this.primitives.length-1];(r instanceof ye?r.points1(t):r.points(t)).forEach(s=>i(s))}points2(t,i){if(this.primitives.length===0)return;for(let s=0;s<this.primitives.length-1;s++){let n=this.primitives[s],a=n instanceof ye?n.points2():n.points(t);a.pop(),a.forEach(o=>i(o))}let r=this.primitives[this.primitives.length-1];(r instanceof ye?r.points2():r.points(t)).forEach(s=>i(s))}multiply3(t){let i=new Array(this.primitives.length);for(let r=0;r<this.primitives.length;r++)i[r]=this.primitives[r].multiply3(t);return Ui.build7(i)}bbox(){return this.__bbox==null&&(this.__bbox=Ui.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(t){if(this.primitives.length<=1&&!(this.primitives[0]instanceof ye))return!1;{let i=this.primitives[0],r=this.primitives[this.primitives.length-1];return i.start().equals(r.end(),t)}}isEqual(t){if(t instanceof Ui&&t.primitives.length==this.primitives.length){let i=t.primitives.length;for(let r=0;r<i;r++){let s=t.primitives[r],n=this.primitives[r];if(JSON.stringify(s)!=JSON.stringify(n))return!1}return!0}return!1}equals(t){if(!t)return!1;let i=this.primitives,r=t.primitives;if(i.length!=r.length)return!1;if(t.isClose()){let s=0;for(;s<i.length;){let n=i.slice(s).concat(i.slice(0,s));if(Tn(n,r)||Tn(n.reverse(),r))return!0;s++}return!1}else return Tn(this.primitives,t.primitives)}clone(){return Ui.build2(this.primitives)}putItem(t,i){if(!t)return!1;if(t instanceof Ui)return this.mergePolyline(t,i);let r=this.start();if(!r){this.primitives.push(t),this.__bbox=t.bbox();return}let s=this.end();if(r.equals(s,i))return!1;let n=t.start(),a=t.end(),o=!1,l=!1;if(r.equals(n,i))o=!0,l=!1;else if(r.equals(a,i))o=!1,l=!1;else if(s.equals(n,i))o=!1,l=!0;else if(s.equals(a,i))o=!0,l=!0;else return!1;return l?this.primitives.push(o?t.reverse():t):this.primitives.unshift(o?t.reverse():t),this.__bbox=Qr.extend2(this.__bbox,t.bbox()),!0}mergePolyline(t,i,r=0){if(!t)return!1;let s=this.start();if(!s){this.primitives.push(...t.primitives),this.__bbox=t.bbox();return}let n=this.end();if(s.equals(n,i))return!1;let a=t.start(),o=t.end(),l=!1,h=!1;if(s.equals(a,i))l=!0,h=!1;else if(s.equals(o,i))l=!1,h=!1;else if(n.equals(a,i))l=!1,h=!0;else if(n.equals(o,i))l=!0,h=!0;else return!1;let c=l?t.reverse():t;return h?this.primitives.push(...c.primitives):this.primitives.unshift(...c.primitives),this.__bbox=Qr.extend2(this.__bbox,t.bbox()),!0}deDuplicationPoint(t){let i=this.primitives[this.primitives.length-1].start(),r=this.primitives[this.primitives.length-1].end(),s=t.primitives[0].start(),n=t.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof oe&&t.primitives[0]instanceof oe&&JN([i,r],[s,n])){this.primitives.pop(),t.primitives.shift();let a=[];a.push(new oe(i,n)),this.primitives.push(...a)}}getMaxBBoxHeightByVec(t){let i=t.normalize(),r=-1/0,s=1/0;if(this.primitives.forEach(a=>{let o=a.start().dot(i),l=a.end().dot(i);if(n(o),n(l),a instanceof ye){let h=t.angleD(pe.ORIGIN);if(a.angleIsInArc(h)){let c=a.pointOn(h).dot(i);n(c)}if(a.angleIsInArc(h+180)){let c=a.pointOn(h-180).dot(i);n(c)}}}),r-s<=0)throw new Error("getMaxBBoxHeightByVec");return r-s;function n(a){a>r&&(r=a),a<s&&(s=a)}}getWindingNum(t){let i=this.end(),r=0,{x:s,y:n}=t;for(let o of this.primitives){if(i.y>n?o.bbox().minY>n:o.bbox().maxY<=n){i=o.end();continue}if(o instanceof ye&&(o.isCCW?Math.floor(o.startAngle/90)+1!==Math.ceil(o.endAngle()/90):Math.ceil(o.startAngle/90)-1!==Math.floor(o.endAngle()/90))){let l=o.startAngle,h=o.endAngle();if(o.sweepAngle>0){let c=90;for(;c<=h;)c>l&&(a(ye.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c+=90;l<h&&a(ye.build3(o.center,l,h-l,o.rx,o.ry))}else{let c=270;for(;c>=h;)c<l&&(a(ye.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c-=90;l>h&&a(ye.build3(o.center,l,h-l,o.rx,o.ry))}}else if(o instanceof Be){let l=[];lb(o,l),l.forEach(h=>a(h))}else a(o)}return r;function a(o){let l=o.start(),h=o.end();if(i.y>n!=l.y>n&&(i.x>s?l.x>s?r+=l.y>i.y?1:-1:i.y>l.y?(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)<0&&r--:(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)>0&&r++:l.x>s&&(i.y>l.y?(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)<0&&r--:(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)>0&&r++)),l.y>n!=h.y>n){if(l.x>s)if(h.x>s)r+=h.y>l.y?1:-1;else if(o instanceof oe)l.y>h.y?(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)<0&&r--:(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)>0&&r++;else if(o instanceof ye){let{center:c,isCCW:f,rx2:d}=o,u=(c.x-s)**2+(c.y-n)**2;l.y>h.y?(f?u>d:u<d)&&r--:(f?u<d:u>d)&&r++}else if(o instanceof Be){if(s2(o,n)===0)throw new Error("no inters");te[0]>s&&(r+=h.y>l.y?1:-1)}else throw new Error("not support!");else if(h.x>s)if(o instanceof oe)l.y>h.y?(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)<0&&r--:(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)>0&&r++;else if(o instanceof ye){let{center:c,isCCW:f,rx2:d}=o,u=(c.x-s)**2+(c.y-n)**2;l.y>h.y?(f?u>d:u<d)&&r--:(f?u<d:u>d)&&r++}else if(o instanceof Be){if(s2(o,n)===0)throw new Error("no inters");te[0]>s&&(r+=h.y>l.y?1:-1)}else throw new Error("not support!")}i=h}}},Nf=Math.PI*2;var Gq=Math.PI/2,zq=Math.sin(Math.PI/180);var dL=4,ye=class oi extends Bu{constructor(t,i,r,s,n){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=t,this.ry=i,this.center=r,this.startAngle=s,this.sweepAngle=n,this._start=pe.ORIGIN,this._end=pe.ORIGIN,this._start=this.pointOn(s),this._end=this.pointOn(s+n)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let t=31,i=1;return i=t*i+new pe(this.rx,this.rx).hashCode(),i=t*i+this.center.hashCode(),i=t*i+new pe(this.startAngle,this.sweepAngle).hashCode(),i}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(t,i,r,s){let n=i>=0?-.01:.01,a=t+i;for(;(i>=0&&a>t||i<0&&a<t)&&r.distance2(s)<2e-4;)n*=2,a+=n,s=this.pointOn(a);return s}static build1(t,i,r,s,n,a){xi.positive(r),xi.positive(s);let o=t.equals(i);if(o)return new oi(r,s,t,0,n?360:0);{let l=t.x,h=-t.y,c=i.x,f=-i.y,d=a===0,u=(l-c)/2,p=(h-f)/2,_=Math.cos(0),g=Math.sin(0),b=_*u+g*p,m=-g*u+_*p;r=Math.abs(r),s=Math.abs(s);let O=r*r,y=s*s,x=b*b,E=m*m,w=n===d?-1:1,S=(O*y-O*E-y*x)/(O*E+y*x);S=S<0?0:S;let C=w*Math.sqrt(S),R=C*(r*m/s),B=C*-(s*b/r),Y=(l+c)/2,G=(h+f)/2,z=Y+(_*R-g*B),q=G+(g*R+_*B),L=(b-R)/r,M=(m-B)/s,v=(-b-R)/r,P=(-m-B)/s,I,N;N=Math.sqrt(L*L+M*M),I=L,w=M<0?-1:1;let D=ot.toDegrees(w*Math.acos(I/N));N=Math.sqrt((L*L+M*M)*(v*v+P*P)),I=L*v+M*P,w=L*P-M*v<0?-1:1;let j=I/N,H;j<-1?H=Math.acos(-1):j>1?H=Math.acos(1):H=Math.acos(j);let K=ot.toDegrees(w*H);!d&&K>0?K-=360:d&&K<0&&(K+=360),xi.normal(D),xi.normal(K);let se=u*u/O+p*p/y,he=t.distance1(i)/2;r<he&&s<he&&(r*=Math.sqrt(se),s*=Math.sqrt(se));let _e=o?0:ot.regularD(-D),ve=o?n?360:0:-K;return new oi(r,s,new pe(z,-q),_e,ve)}}static build2(t,i,r,s,n,a){xi.positive(s),xi.positive(n),xi.normal(i),xi.normal(r);let o;return i===r?(i=ot.regularD(i),r=ot.regularD(r),o=0):(i=ot.regularD(i),r=ot.regularD(r),a===1?r<=i&&(r+=360):r>=i&&(i+=360),o=r-i),new oi(s,n,t,ot.regularD(i),o)}static build3(t,i,r,s,n){return xi.positive(s),xi.positive(n),xi.normal(r),new oi(s,n,t,ot.regularD(i),r)}static build4(t,i,r,s,n,a){let o=t.angleD(r),l=i.angleD(r);return oi.build2(r,o,l,s,n,a)}static build5(t,i,r){r=ot.toRadians(r);let s=i.sub(t),n=new pe(-s.y,s.x).normalize(),a=Math.abs(r)/2,o;if(a!=0)o=s.length()/2/Math.sin(a);else throw new Error("Can't represent circle!!!");let l=n.rotate(pe.ORIGIN,a),h,c;r>0?(h=1,c=i.add(l.scale(o))):(h=0,c=t.sub(l.scale(o)));let f=ot.toDegrees(t.angle(c)),d=ot.toDegrees(i.angle(c));return oi.build2(c,f,d,o,o,h)}static buildCircle(t,i,r=0){return oi.build2(t,0,360,i,i,r)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(t){t=ot.regularD(t);let i=this.rx,r=this.ry;if(t===0)return this.center.add1(i,0);if(t===90)return this.center.add1(0,r);if(t===180)return this.center.add1(-i,0);if(t===270)return this.center.add1(0,-r);{let s=this.rx2,n=this.ry2,a=Math.tan(ot.toRadians(t)),o=a*a,l=Math.sqrt(s*n/(s+n/o)),h=Math.sqrt(s*n/(n+s*o));return t>90&&t<270&&(h=-h),t>180&&t<360&&(l=-l),isNaN(h)&&(h=0),isNaN(l)&&(l=0),this.center.add1(h,l)}}exchangeSweep(){return oi.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return oi.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return oi.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(t){let i=this.start(),r=this.end();return i.equals(r)?oi.build3(this.center.mirrorY(),0,360,this.rx,this.ry):oi.build1(i.mirrorY(t),r.mirrorY(t),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(t=pe.ORIGIN){let i=this.start(),r=this.end();return i.equals(r)?oi.build3(this.center.mirror(t),0,360,this.rx,this.ry):oi.build1(i.mirror(t),r.mirror(t),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let t=FO.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-t}multiply3(t){let i;t.isMirrored()?i=-this.sweepAngle:i=this.sweepAngle;let r;return t.equals(Yt.ROT_90)?r=ot.regularD(this.startAngle+90):t.equals(Yt.ROT_N90)?r=ot.regularD(this.startAngle-90):r=ot.transformD(this.startAngle,t),oi.build3(this.center.multiply3(t),r,i,t.iScale*this.rx,t.iScale*this.ry)}angleIsInArc(t){return t=ot.regularD(t),this.sweepAngle>0?(t<this.startAngle&&(t+=360),this.endAngle()>t):(t>this.startAngle&&(t-=360),this.endAngle()<t)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let t=this.start(),i=this.end(),r=ot.toRadians(this.sweepAngle)/2,s=4/3*(1-Math.cos(r))/Math.sin(r)*this.rx;return new Be([t,t.add(new pe(s,0).multiply3(Yt.rotateD(this.startAngle+90))),i.add(new pe(s,0).multiply3(Yt.rotateD(this.endAngle()-90))),i])}toBezier2(){let t=[];r(this,90);let i=[];return t.forEach(s=>i.push(s.toBezier())),i;function r(s,n){if(Math.abs(s.sweepAngle)>n){let a=s.sweepAngle/2;r(oi.build3(s.center,s.startAngle,a,s.rx,s.ry),n),r(oi.build3(s.center,s.startAngle+a,a,s.rx,s.ry),n)}else t.push(s)}}buildBBox(){let t=hb.getCache().boxCache,i=this.startAngle+this.sweepAngle;if(t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let r=0;for(;r<i;){if(r>this.startAngle){let s=this.pointOn(r);t[0]=Math.min(t[0],s.x),t[1]=Math.max(t[1],s.x),t[2]=Math.min(t[2],s.y),t[3]=Math.max(t[3],s.y)}r+=90}}else if(this.sweepAngle<0){let r=360;for(;r>i;){if(r<this.startAngle){let s=this.pointOn(r);t[0]=Math.min(t[0],s.x),t[1]=Math.max(t[1],s.x),t[2]=Math.min(t[2],s.y),t[3]=Math.max(t[3],s.y)}r-=90}}return new Qr(t[0],t[1],t[2],t[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return Ih.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(t,i,r){let s=t/2,n=this.rx+s,a=this.ry+s,o=this.rx-s,l=this.ry-s,h=new Yt;o<0&&(o=-o,h=h.multiply3(Yt.MIRROR_Y)),l<0&&(l=-l,h=h.multiply3(Yt.MIRROR_X)),o===0&&(o=.001),l===0&&(l=.001),h=h.setOrigin1(this.center);let c,f;switch(r===this.sweep()?(c=oi.build3(this.center,this.startAngle,this.sweepAngle,n,a),f=oi.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,o,l)):(c=oi.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,n,a),f=oi.build3(this.center,this.startAngle,this.sweepAngle,o,l)),f=f.multiply3(h),i){case 1:{let d=r===1?180:-180,u=r===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),p=r===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),_=c.pointOn(c.endAngle()).angleD(u),g=f.pointOn(f.endAngle()).angleD(p);return bt.build2([c,oi.build3(u,_,d,s,s),f,oi.build3(p,g,d,s,s)])}default:return bt.build2([c,f])}}points2(){let t=Math.ceil(Math.abs(this.sweepAngle)/dL),i=this.sweepAngle/t,r=[this._start];for(let s=1;s<t;s++)r.push(this.pointOn(this.startAngle+i*s));return r.push(this._end),r}points1(t){let i=Math.max(this.rx,this.ry);if(i<=t)return[this.start(),this.svgEnd];let r=(i-t)/i,s=Math.ceil(Math.abs(this.sweepAngle/ot.toDegrees(Math.acos(r))/2)),n=new Array(s+1),a=this.sweepAngle/s,o=this.startAngle;for(let l=0;l<=s;l++,o+=a)n[l]=this.pointOn(o);return n}points(t){let i=Math.max(this.rx,this.ry);if(t=Math.abs(t),i<=t)return[this.start(),this.svgEnd];t=Math.max(t,i*1e-5),t=Math.min(t,i*(1-Math.SQRT1_2));let r=(i-t)/i,s=Math.ceil(Math.abs(this.sweepAngle/ot.toDegrees(Math.acos(r))/2));s=Math.max(s,2);let n=new Array(s+1),a=this.sweepAngle/s,o=this.startAngle+a;n[0]=this.start();for(let l=1;l<s;l++,o+=a)n[l]=this.pointOn(o);return n[s]=this.end(),n}panDistance(t){return this.sweepAngle>0?new oi(this.rx-t,this.ry-t,this.center,this.startAngle,this.sweepAngle):new oi(this.rx+t,this.ry+t,this.center,this.startAngle,this.sweepAngle)}panDistance1(t){if(this.sweepAngle>0){let i=this.rx-t;return i<0?(i=Math.abs(i),oi.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new oi(i,i,this.center,this.startAngle,this.sweepAngle)}else{let i=this.rx+t;return i<0?(i=Math.abs(i),oi.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new oi(i,i,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let t=Math.abs(FN(this.sweepAngle,3))/180*Math.PI;return Math.tan(t/4)}get midPoint(){let t=ot.toRadians(this.startAngle),i=ot.toRadians(this.endAngle()),r=this.sweep(),s=this.center,n=this.rx;if(r==1)if(i>t){let a=(i-t)/2+t;return s.add(new pe(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==t)return s.add(new pe(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(i+Nf-t)/2+t;return s.add(new pe(Math.cos(a),Math.sin(a)).mul(n))}}else if(i>t){let a=(t+Nf-i)/2+i;return s.add(new pe(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==t)return s.add(new pe(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(t-i)/2+i;return s.add(new pe(Math.cos(a),Math.sin(a)).mul(n))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(t){let i=ot.regularD(this.startAngle),r=ot.regularD(this.sweepAngle),s=ot.regularD(t.startAngle),n=ot.regularD(t.sweepAngle);return Tn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Tn([r,i],[n,s])||Tn([ot.regularD(i+r)],[s]))}equals1(t){let i=ot.regularD(this.startAngle),r=ot.regularD(this.sweepAngle),s=ot.regularD(t.startAngle),n=ot.regularD(t.sweepAngle);return Tn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Tn([r,i],[n,s])||Tn([ot.regularD(i+r)],[s]))}inArea(t,i){let r=t.x,s=t.y,n=this.center,a=this.rx,o=ot.toRadians(this.startAngle);this.sweep()==0&&(o=ot.toRadians(this.endAngle()));let l=ot.toRadians(this.endAngle());this.sweep()==0&&(l=ot.toRadians(this.startAngle));let h=a-i/2,c=a+i/2;var f=r-n.x,d=s-n.y,u=Math.atan2(d,f);if(u<0&&(u+=Nf),o<=l&&u>=o&&u<=l||o>l&&(u>=o&&u<=Nf||u>=0&&u<=l)||o==l){var p=Math.sqrt(f*f+d*d);return p<=c&&p>=h}else{var p=(c+h)/2,_=new pe(n.x+Math.cos(o)*p,n.y+Math.sin(o)*p),g=new pe(n.x+Math.cos(l)*p,n.y+Math.sin(l)*p),b=r-_.x,m=s-_.y,O=r-g.x,y=s-g.y;return b*b+m*m<=i*i/4?!0:O*O+y*y<=i*i/4}}isCircle(){return(Te.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return oi.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let t=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+t)%t:(this.startAngle-this.endAngle()+t)%t}isValid(){return this.rx>0&&this.ry>0}},cb=new ArrayBuffer(24),mO=new Float64Array(cb),ph=new Int32Array(cb),tr,Hq=(tr=class{static normal(t,i,r){let s=i.sub(t),n=r.sub(i);return s.cross(n)}constructor(t,i,r){this.x=xi.normal(t),this.y=xi.normal(i),this.z=xi.normal(r),mO[0]=t,mO[1]=i,mO[2]=r,this.hashed=ph[0]^ph[1]^ph[2]^ph[3]^ph[4]^ph[5]}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(t){return t instanceof tr?t.x===this.x&&t.y===this.y&&t.z===this.z:!1}cross(t){return new tr(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var t=this.length();return new tr(this.x/t,this.y/t,this.z/t)}sub(t){return new tr(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new tr(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new tr(this.x*t,this.y*t,this.z*t)}neg(){return new tr(-this.x,-this.y,-this.z)}multiply4(t){var i=this.x*t.data[0]+this.y*t.data[4]+this.z*t.data[8]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+this.z*t.data[9]+t.data[13],s=this.x*t.data[2]+this.y*t.data[6]+this.z*t.data[10]+t.data[14],n=this.x*t.data[3]+this.y*t.data[7]+this.z*t.data[11]+t.data[15];return n!=0?new tr(i/n,r/n,s/n):new tr(i,r,s)}rotate(t,i){return this.multiply4(sb.rotateAxis(t,i))}toVector2(){return new pe(this.x,this.y)}},tr.ORIGIN=new tr(0,0,0),tr.X_UNIT_VECTOR=new tr(1,0,0),tr.Y_UNIT_VECTOR=new tr(0,1,0),tr.Z_UNIT_VECTOR=new tr(0,0,1),tr);var Di=class xh{static build(t){return t instanceof bt?new xh([new ir([t])]):t instanceof ir?new xh([t]):t}static buildByPolygon(t){return t?new xh([t]):new xh([])}static buildByStroke(t,i,r=1,s){return this.buildByPolygon(ir.buildByStroke(t,i,r,_m,s))}static buildCircle(t,i){return this.buildByPolygon(ir.buildCircle(t,i))}static buildRect(t){return this.buildByPolygon(ir.buildRect(t))}static buildBBox(t){return this.buildByPolygon(ir.buildBBox(t))}constructor(t){this.items=t.slice()}multiply3(t){return new xh(this.items.map(i=>i.multiply3(t)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((t,i)=>t.ext1(i.bbox()),new Ss).build1()),this._bbox}toPolylineGroups(){return this.items.map(t=>t.toPolylineGroup())}},$t,Bt=($t=class{static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,i,r,s=255){return new $t(t/255,i/255,r/255,s/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let i=t.length;if(i==3)return new $t(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(i==6)return new $t(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(i==8)return new $t(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let i=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),s=parseInt(t.b*255+"").toString(16);return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),("#"+i+r+s).toUpperCase()}static of5(t,i){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return new $t(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,i);if(t.length==6)return new $t(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,i);throw new Error("invalid color string")}static of6(t,i){return new $t(t.r,t.g,t.b,i)}static of7(t){return t==null?null:$t.of3(t)}constructor(t,i,r,s=1){this.r=xi.positiveOr0(t),this.g=xi.positiveOr0(i),this.b=xi.positiveOr0(r),this.alpha=s}hashCode(){return this.r+this.g+this.b+this.alpha}equals(t,i=!1){let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return i?r:r&&this.alpha===t.alpha}add(t,i,r,s){return new $t(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+i)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+s)))}mul(t){return new $t(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return new $t(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16),s=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)+s.substr(0,2)}toRGBA(){let t=this.r*255,i=this.g*255,r=this.b*255;return[t,i,r,this.alpha]}toRGBAString(){let t=this.r*255,i=this.g*255,r=this.b*255;return`rgba(${t},${i},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},$t.WHITE=new $t(1,1,1,1),$t.BLACK=new $t(0,0,0,1),$t.RED=new $t(1,0,0,1),$t.GREEN=new $t(0,1,0,1),$t.BLUE=new $t(0,0,1,1),$t.Gray=$t.of3("#9966ff"),$t.Silver=$t.of3("#D2D2D2"),$t.Golden=$t.of3("#DCAA14"),$t.Pink=$t.of3("#ffaec9"),$t),u2=!1,ub=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,i,r,s,n){}onIntersect(e,t,i){}onSegment(e,t,i,r,s,n){}onSegment1(e,t,i){if(u2){let r=new pe(e.getX(i),i),s=new pe(t.getX(i),i);this.onSegment(r,e.weight,e,s,t.weight,t)}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t)}onSweep1(e,t,i){if(u2){let r=new pe(e.getX(i),i),s=new pe(t.getX(i),i);this.onSweep(r,e.weight,e,s,t.weight,t)}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t)}},Eu=class extends ub{constructor(e){super(),this.plGrps=new Array,this.debug=e}onPolylineGroup(e,t){this.plGrps.push(e)}},ku=class{constructor(e){this.cache={},this.levels=e,this.result=new Array(e),this.weights=new Array(e),this.maxIdx=e-1,this.rule=this.decide.bind(this);let t=1;for(let i=0;i<e;i++)this.weights[i]=t,t*=50}weight(e){return this.weights[e]}decide(e){e=Math.abs(e);let t=this.cache[e];if(t===void 0){let i=e;for(let r=this.maxIdx;r>=0;r--){let s=this.weights[r],n=e/s|0,a=e%s;a>(s/2|0)?(e=s-a,n++):e=a,this.result[r]=n>0}t=this.decide1(this.result),this.cache[i]=t}return t}},fL=e=>e!==0;var pL=new class extends ku{decide1(e){return e[0]||e[1]}}(2),qf=new class extends ku{decide1(e){return e[0]&&!e[1]}}(2),Xf=new class extends ku{decide1(e){return e[0]&&e[1]}}(2),Wf=new class extends ku{decide1(e){return e[0]&&!e[1]||!e[0]&&e[1]}}(2),_L=(e=>(e[e.UNMARKED=0]="UNMARKED",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE=2]="OUTSIDE",e[e.INVALID=3]="INVALID",e))(_L||{}),Uh=class vh{constructor(t,i,r,s,n,a,o){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=t,this.shape=i,this.baseWeight=r,s.y>n.y?this.weight=-r:s.y==n.y?this.weight=0:this.weight=r,this.start=s,this.end=n,this.polyGrp=a,this.polyIndex=o,this._bbox=new Ss().ext1(i.bbox()).ext2(s).ext2(n).build1(),this.inters.push(s),this.inters.push(n);let l=31,h=1;h=l*h+this.polyGrp,h=l*h+this.polyIndex,this._hashcode=h}static rebuild(t,i,r){if(t instanceof oe||i.distance2(r)<1e-6)return new oe(i,r);if(t instanceof ye){let s=t,n=t.bbox().center().x,a;i.y>r.y?a=n>s.center.x?0:1:a=n>s.center.x?1:0;let o=i.angleD(s.center),l=r.angleD(s.center);return ye.build2(s.center,o,l,s.rx,s.ry,a)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Ss().ext2(this.start).ext2(this.end).build1()}is(t,i){return t===this.polyGrp&&i===this.polyIndex}confidence(t){if(this._confidence_y!=t){let i=this._bbox.height();if(i!==0)if(Math.abs(t-this._bbox.maxY)>5e-4&&Math.abs(t-this._bbox.minY)>5e-4){let r=1-Math.abs(2*t-this._bbox.maxY-this._bbox.minY)/i;this._confidence=r*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=t}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(t){let i=this.confidence(t);return this.outsideWeight-=i,this.invalidWeight+=i,i}revokeInside(t){let i=this.confidence(t);return this.insideWeight-=i,this.invalidWeight+=i,i}setOutside(t){let i=this.confidence(t);return this.outsideWeight+=i,i}setInside(t){let i=this.confidence(t);return this.insideWeight+=i,i}setInvalid(t){let i=this.confidence(t);return this.invalidWeight+=i,i}prevNot0(){let t=this.previous;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.previous}return null}nextNot0(){let t=this.next;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.next}return null}getX(t){if(this.bo!==null)return(this._x_y!=t||isNaN(this._x))&&(EL(this,t)>0?this._x=te[0]:this._x=NaN,this._x_y=t),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(t){if(t===2)if(this.start.y>this.end.y){let i=vh.rebuild(this.shape,this.end,this.start),r=new vh(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return es.addAll(r.connect,this.connect),r}else return this;else if(t===1)if(this.start.y<this.end.y){let i=vh.rebuild(this.shape,this.end,this.start),r=new vh(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return es.addAll(r.connect,this.connect),r}else return this;return this}isNeedScan(t){return this.needCountWeight()&&this.confidence(t)>0}hashCode(){return this._hashcode}equals(t){return t instanceof vh?!(this.polyGrp!==t.polyGrp||this.polyIndex!==t.polyIndex):!1}bbox(){return this._bbox}toString(){return Ih.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function gL(e,t){let i=e.bbox(),r=t.bbox(),s=(i.minY+i.maxY)/2,n=(r.minY+r.maxY)/2;return s-n}function OL(e,t){let i=e.bbox(),r=t.bbox(),s=(i.minX+i.maxX)/2,n=(r.minX+r.maxX)/2;return s-n}var _h=class{constructor(e){if(this.__bbox=null,typeof e<"u")if(e instanceof Array){this.__items=[];for(let t of e)this.add(t)}else this.__items=e,this.__bbox=e.bbox();else this.__items=[]}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=Qr.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},Iu=class{constructor(e){this.changed=!1,this.root=new _h,this.capacity=e,this.capacity2=e*e,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(e){this.itemList.push(e),this.changed=!0}remove(e){es.remove(this.itemList,e),this.changed=!0}clear(){this.changed=!1,this.root=new _h,this.itemList.length=0}flushWhenNeed(){if(this.changed){let e=new Array;for(let t of this.itemList)e.push(new _h(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break}this.root=new _h(e),this.changed=!1}}organize(e){Nl(e,OL,0,e.length);let t=e.length,i=[];for(let r=0;r<t;)if(r+this.capacity2<=t){let s=r+this.capacity2;Nl(e,gL,r,s);for(let n=r;n<s;n+=this.capacity){let a=new _h(e.slice(n,n+this.capacity));i.push(a)}r=r+this.capacity*this.capacity}else{let s=new _h(e.slice(r,r+this.capacity));i.push(s),r=r+this.capacity}return i}search(e){this.flushWhenNeed();let t=[],i=[];for(i.push(this.root);;){let r=i.shift();if(typeof r<"u"){let s=r.items();if(s instanceof Array){for(let n of s)if(!e.isSeparated(n.bbox())){let a=n.items();a instanceof Array?i.push(n):t.push(a)}}else e.isSeparated(r.bbox())||t.push(s)}else break}return t}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e)}_walker(e,t,i){this.flushWhenNeed();let r=e.items();if(r instanceof Array)for(let s of r)this._walker(s,t+1,i);else i(r,t)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};function yO(e,t){mL(e.iterator(),t)}function mL(e,t){let i=0;for(;e.hasNext();){let r=e.next();t(i++,r)}}var Lf=new Error("list is empty"),Rf=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},yL=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},bL=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},El=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Lf;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Lf;return this.remove(e),e.item}addLast(e){return this.first===null||this.last===null?(this.first=new Rf(this,e),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Rf(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Lf;return this.first.item}getLast(){if(this.last===null)throw Lf;return this.last.item}insertAfter(e,t){let i=new Rf(this,t);return e.insertAfter(i),e===this.last&&(this.last=i),this.cnt++,i}insertBefore(e,t){let i=new Rf(this,t);return e.insertBefore(i),e===this.first&&(this.first=i),this.cnt++,i}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new yL(this.first)}listIterator(){return new bL(this.first)}toArray(){let e=new Array(this.cnt),t=this.first,i=0;for(;t!=null;)e[i]=t.item,t=t.next,i++;return e}};function bO(e){throw new Error("")}var Df=class{constructor(e,t){this.node1=null,this.node2=null,this.key=e,this.value=t}},xL=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},vL=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},up=class{constructor(){this.innerList=new El,this.innerMap={}}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2)}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e]}put(e,t){let i=e.hashCode(),r=new Df(e,t),s=this.innerMap[i];if(s===void 0)return r.node1=this.innerList.add(r),this.innerMap[i]=r,null;if(s instanceof Df){if(s.key.equals(e))return this.innerMap[i]=r,this.replace(s,r),s.value;{r.node1=this.innerList.add(r);let n=new El;return s.node2=n.add(s),r.node2=n.add(r),this.innerMap[i]=n,null}}if(s instanceof El){let n=null;return yO(s,(a,o)=>o.key.equals(e)?(this.replace(o,r),n=o.value,!1):!0),n===null?(r.node1=this.innerList.add(r),r.node2=s.push(r),null):n}return bO(s)}get(e){let t=e.hashCode(),i=this.innerMap[t];if(i===void 0)return null;if(i instanceof Df)return i.key.equals(e)?i.value:null;if(i instanceof El){let r=null;return yO(i,(s,n)=>n.key.equals(e)?(r=n.value,!1):!0),r}return bO(i)}containsKey(e){return this.get(e)!==null}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2)}remove(e){let t=e.hashCode(),i=this.innerMap[t];if(i===void 0)return null;if(i instanceof Df)return i.key.equals(e)?(this.delete(i),i.value):null;if(i instanceof El){let r=null;return yO(i,(s,n)=>n.key.equals(e)?(r=n.value,this.delete(n),!1):!0),r}return bO(i)}computeIfAbsent(e,t){let i=this.get(e);if(i===null){let r=t(e);return this.put(e,r),r}else return i}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new xL(this.innerList.iterator())}values(){return new vL(this.innerList.iterator())}entries(){return this.innerList.iterator()}},Rh=class{constructor(){this.innerMap=new up}add(e){return this.innerMap.put(e,!0)!==!0}remove(e){this.innerMap.remove(e)}contains(e){return this.innerMap.get(e)===!0}iterator(){return this.innerMap.keys()}addAll(e){let t=e.iterator();for(;t.hasNext();)this.add(t.next())}size(){return this.innerMap.size()}clear(){let e=this.iterator();for(;e.hasNext();){let t=e.next();this.remove(t)}}},d2=es.funcCopy(Nl);function EL(e,t){let i=0;if(Math.abs(e.start.y-t)<=1e-4)te[i++]=e.start.x;else if(Math.abs(e.end.y-t)<=1e-4)te[i++]=e.end.x;else if(e.shape instanceof oe)i=jN(e.shape,t);else if(e.shape instanceof ye)i=YN(e.shape,t);else throw new Error("not supported operation");return i}var Jf=class{constructor(e,t,i,r){this.sides=new Array,this.loader=e,this.loader.bo=this,this.logger=i,this.rule=t,this.event=r}static sortByBBoxMinY(e,t){return e.bbox().minY-t.bbox().minY}static sortByBBoxAreaDesc(e,t){return t.bbox().area()-e.bbox().area()}addPolyline(e,t=1,i=.01,r=!0){for(let s of this.loader.buildGroup(e,t,i,r))this.sides.push(s),this.event.onOriginSide(s)}buildRTree(){let e=new Iu(10);for(let t of this.sides)e.add(t);return e}fillValidSides(e,t,i){for(let r of t)isFinite(r.getX(i))&&e.push(r)}getSortedEndpointsLineAsc(e){let t=new Array;for(let s of e)s.needCountWeight()&&(t.push(s.start),t.push(s.end));d2(t,pe.sortByYAsc,0,t.length);let i=new Array,r=Number.NEGATIVE_INFINITY;for(let s of t){let n=s.y;n>r&&(i.push(n),r=n)}return i}splitSides(e,t,i){let r=e.start,s=e.end,n=new pe(s.x+(r.x-s.x)*2,s.y+(r.y-s.y)*2);d2(e.inters,(o,l)=>o.distance2(n)-l.distance2(n),0,e.inters.length);let a=null;for(let o of e.inters)if(a==null)o.equals(r)&&(a=o);else if(!o.equals(a)){let l=Uh.rebuild(e.shape,a,o);l instanceof ye&&Math.abs(l.sweepAngle)>190&&(l=new oe(a,o));let h=new Uh(this,l,e.baseWeight,a,o,e.polyGrp,i++);if(t.push(h),h.updateBbox(),o.equals(s))break;a=o}return i}splitSidesByInters(){let e=new Array;for(let t of this.sides)if(t.polyIndex==0){let i=0,r=null,s=null;do{let n=new Array;i=this.splitSides(t,n,i);for(let a of n)r!=null?(r.next=a,a.previous=r):s=a,r=a,this.event.onSplitedSide(a),e.push(a);if(t.next===null)throw new Error("not supported operation");t=t.next}while(t.polyIndex!==0);s!=null&&r!=null&&(s.previous=r,r.next=s)}this.sides.length=0;for(let t of e)this.sides.push(t)}seekIntersection(){if(this.sides.length>0){let e=this.buildRTree(),t=new Rh;for(let i of this.sides){t.add(i);let r=i.bbox().extendOfSize(1e-5),s=i.shape instanceof oe;for(let n of e.search(r))if(!t.contains(n)){let a=n.shape instanceof oe;if(!(s&&a&&i.next!==null&&i.previous!==null&&(i.next.equals(n)||i.previous.equals(n)))){let o=ln(i.shape,n.shape);for(let l=0;l<o;l+=2){let h=new pe(te[l],te[l+1]);i.inters.push(h),n.inters.push(h),this.event.onIntersect(h,i,n)}}}}}}},TL=class db{constructor(t){this.sides=new Rh,this.others=new Rh,this.id=t}add(t){this.sides.add(t),t.finalGrp=this.id;for(let i of t.connect)this.others.add(i)}polyline(){let t=new Array;return Lh(this.sides,(i,r)=>(t.push(r.shape),!0)),bt.build2(t).asClose()}hashCode(){return this.id}equals(t){return t!=null&&t instanceof db?this.id===t.id:!1}},fb=class{constructor(e){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=e}completeGroup(e){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new oe(this.prevSide.end,this.firstSide.start),e);let t=new Array,i=null,r=null;for(let s of this.sides)(!this.noWeight0||s.weight!==0)&&(i!=null?(i.next=s,s.previous=i):r=s,i=s,t.push(s));return i!=null&&r!=null&&(r.previous=i,i.next=r),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,t}buildGroup(e,t,i,r=!0){for(let s of e.primitives)if(s instanceof oe)this.addSide(s,t);else if(r&&s instanceof ye&&s.rx===s.ry)this.addArc(s,t);else{let n=null;for(let a of s.points(i))n!=null&&this.addSide(new oe(n,a),t),n=a}return this.completeGroup(t)}addArc(e,t){let i=e.sweepAngle,r=ot.regularD(e.startAngle),s=r+i;if(i>0){let n=90;for(;n<=s;)n>r&&(this.addSide(ye.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n+=90;r<s&&this.addSide(ye.build3(e.center,r,s-r,e.rx,e.ry),t)}else if(i<0){let n=270;for(;n>=s;)n<r&&(this.addSide(ye.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n-=90;r>s&&this.addSide(ye.build3(e.center,r,s-r,e.rx,e.ry),t)}}addSide(e,t){if(e.start().equals(e.end()))return;let i=e.start(),r;this.prevSide!=null?(this.prevSide.end.equals(i)||this.addSide(new oe(this.prevSide.end,i),t),r=new Uh(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++)):(r=new Uh(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++),this.firstSide=r),this.prevSide=r,this.sides.push(r)}},pb=class{constructor(e,t,i){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=i,this.rule=e,this.bo=t,this.event=t.event}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e,this.start),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y))}out(e,t){if(this.onSameX(t,e))t.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&t.confidence(this.y)>0){let i=t.voteStatus(),r=e.voteStatus();this.isValid(i)&&this.isValid(r)?i==2&&r==1&&(e.connect.push(t),t.connect.push(e)):(e.connect.push(t),t.connect.push(e))}this.event.onSegment1(t,e,this.y),this.eps.push(t),this.eps.push(e),this.prevStart=t,this.prevEnd=e}this.start=null}isValid(e){return e==1||e==2}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&Te.eq(e.getX(this.y),t.getX(this.y))}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),i=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),i!=null&&e.weight===i.weight&&i.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y}},dp=new Error,f2=new class extends ku{decide1(e){return e[0]&&e[1]}}(2),wL=new class extends ub{onPolylineGroup(e,t){throw dp}onSegment(e,t,i,r,s,n){throw dp}},SL=class{constructor(e,t){this.rtree=e,this.level=t}},IL=class _b extends Jf{static isIntersect(t,i,r=Pp.DUMMY){let s=new _b(r),n=s.createGroup1(t.items),a=s.createGroup2(i.items);return n.rtree.itemList.length==0||a.rtree.itemList.length==0?!1:s.isIntersect(n,a)}constructor(t){super(new fb(!1),f2.rule,t,wL)}createGroup1(t){return this.createGroup(t,0)}createGroup2(t){return this.createGroup(t,1)}createGroup(t,i){let r=f2.weight(i);for(let n of t)this.addPolyline(n,r);let s=this.buildRTree();return this.sides.length=0,new SL(s,i)}isIntersect(t,i){if(t.level!==i.level){let r=t.rtree.bbox().intersection1(i.rtree.bbox());if(r!==null){try{this.inters(t,i);let s=(r.minY+r.maxY)/2;this.sweep(t,i,s)}catch(s){if(s===dp)return!0;throw s}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(t,i){if(t.rtree.size()>i.rtree.size()){let r=t;t=i,i=r}for(let r of t.rtree.items()){r.trans=NaN;let s=r.bbox().extendOfSize(1e-5);for(let n of i.rtree.search(s))if(n.trans=NaN,ln(r.shape,n.shape)>0)throw dp}}sweep(t,i,r){let s=Qr.extend2(t.rtree.bbox(),i.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,t.rtree.search(s),r),this.fillValidSides(n,i.rtree.search(s),r),Nl(n,(o,l)=>o.getX(r)-l.getX(r),0,n.length);let a=new pb(this.rule,this,r);for(let o of n)a.onEp(o)}},gm=class La{constructor(t){this.items=new Array(t.length),es.arraycopy(t,0,this.items,0,t.length),this.__bbox=this.calcBBox()}static build1(t){let i=[];return np(t,(r,s)=>(i.push(s),!0)),new La(i)}static build2(t){let i=t.map(r=>bt.build8(r));return new La(i)}static combinePolylineGroupArr(t){let i=[];for(let r of t)i=i.concat(r.items);return new La(i)}calcBBox(){let t=new Ss;for(let i=0;i<this.items.length;i++)t.ext1(this.items[i].bbox());return t.build1()}multiply3(t){let i=new Array(this.items.length);for(let r=0;r<i.length;r++)i[r]=this.items[r].multiply3(t);return new La(i)}bbox(){return this.__bbox}asClose(){return this.items.forEach(t=>t.asClose()),this}mirrorY(t){return this.items.forEach(i=>i.mirrorY(t)),this}closeEndpoint(){return this.items.forEach(t=>t.closeEndpoint()),this}get primitives(){return this.items.map(t=>t.primitives).flat(2)}isEqual(t){return t instanceof La?this.items.every(i=>t.items.some(r=>r.isEqual(i))):!1}getOutMostPolyline(){return this.items.reduce((t,i)=>i.bbox().area()>t.bbox().area()?i:t,this.items[0])}getOutline(){let t=this.items;if(t.length===1)return{outline:t,hole:new Array};let i=new Set,r=new Set;for(let s=0,n=t.length;s<n;s++){let a=t[s];if(!i.has(a)&&!r.has(a)){s+1>=n&&i.add(a);for(let o=s+1;o<n;o++){let l=t[o];if(!i.has(l)&&!r.has(l)){if(!a.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(a.bbox().extendOfSize(1e-4)))continue;IL.isIntersect(new La([a]),new La([l]))&&(a.bbox().area()>l.bbox().area()?(i.add(a),r.add(l)):(i.add(l),r.add(a)))}}!i.has(a)&&!r.has(a)&&i.add(a)}}return{outline:[...i],hole:[...r]}}round(t=4){let i=this.items.map(r=>r.round(t));return new La(i)}},PL=es.funcCopy(Nl),AL=es.funcCopy(Nl),CL=es.funcCopy(Nl);function NL(e){return new Array}function LL(e,t){let i=new Eu(!1),r=new Tu(e,Pp.DUMMY,i);for(let s of t)r.addPolyline(s);return r.simplify(),i.plGrps}var Tu=class extends Jf{constructor(e,t,i){super(new fb(!1),e,t,i),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(e,t,i){this.scanY=NaN,this.scanLines=0,PL(t,Jf.sortByBBoxMinY,0,t.length);let r=new El;this.curNetIndex=0;let s=Number.POSITIVE_INFINITY;for(let n of e)n>s&&this.scan(r,(s+n)/2,t),s=n;this.getAllMarkPrimitive(i,t),this.logger.debug3("scan %s %d",i,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(e,t=1,i=.01,r=!0){super.addPolyline(e,t,i,r)}scan(e,t,i){if(this.scanY==t)return;this.scanY=t;let r=!1,s=e.listIterator();for(;s.hasNext();){let n=s.next(),a=n.item;Te.less(a.bbox().maxY,t)?e.remove(n):!r&&a.isNeedScan(t)&&(r=!0)}for(;this.curNetIndex<i.length;){let n=i[this.curNetIndex];if(Te.less(n.bbox().minY,t))Te.greatereq(n.bbox().maxY,t)&&(this.add2AET(e,n),!r&&n.isNeedScan(t)&&(r=!0)),this.curNetIndex++;else break}if(r){this.scanLines++;let n=new pb(this.rule,this,t),a=e.iterator();for(;a.hasNext();){let o=a.next();n.onEp(o)}}}add2AET(e,t){let i=t.bbox().minX,r=t.bbox().maxX,s=t.bbox().minY,n=t.bbox().maxY,a=e.listIterator(),o=null;for(;a.hasNext();){let l,h=a.next(),c=h.item,f=c.bbox().minX,d=c.bbox().maxX;if(r<=f)l=-1;else if(d<=i)l=1;else{let p=c.bbox().minY,_=c.bbox().maxY,g=Math.max(s,p),b=Math.min(n,_);l=this.compareBySweep(t,c,(g+b)/2)}let u=c.shape;if(u instanceof oe&&u.length()<.001&&o==null&&l<0){o=h;continue}if(o!=null&&l<0){e.insertBefore(o,t);return}if(l<0){e.insertBefore(h,t);return}else o=null}e.add(t)}getLineAngle(e){let t=e.start().angle(e.end());return t<0&&(t+=Math.PI),t}getArcAngle(e,t){let i=Math.asin((t-e.center.y)/e.rx);return e.startAngle>90&&e.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI}compareArcLine(e,t,i){let r=this.getArcAngle(e,i),s=this.getLineAngle(t);return Te.eq(r,s)?-e.sweepAngle:s-r}compareBySweep(e,t,i){let r=e.getX(i);if(!isFinite(r))return 0;let s=t.getX(i);if(!isFinite(s))return 0;if(!Te.eq(r,s))return r-s;if(e.shape instanceof oe)return t.shape instanceof oe?this.getLineAngle(t.shape)-this.getLineAngle(e.shape):-this.compareArcLine(t.shape,e.shape,i);if(t.shape instanceof oe)return this.compareArcLine(e.shape,t.shape,i);{let n=e.shape,a=t.shape,o=this.getArcAngle(n,i),l=this.getArcAngle(a,i);return Te.eq(o,l)?n.sweepAngle*a.sweepAngle<=0?n.sweepAngle<=0?1:-1:n.sweepAngle>0?n.rx-a.rx:a.rx-n.rx:l-o}}getAllMarkPrimitive(e,t){for(let i of t)if(i.status===0&&i.bbox().height()!=0){let r=i.voteStatus();if(r===2||r===1){i.status=r;let s=i.reverse(r);if(e){this.event.onResultSide(s);let n=s.shape.multiply3(Yt.ROT_N90),a=s.start.multiply3(Yt.ROT_N90),o=s.end.multiply3(Yt.ROT_N90);s=new Uh(this,n,s.baseWeight,a,o,s.polyGrp,s.polyIndex)}this.finalSides.push(s),this.event.onResultSide(s)}}}flipSides(){for(let e of this.sides)if(e.polyIndex==0){let t=null,i=null;do{let r=e.shape.multiply3(Yt.ROT_90),s=e.start.multiply3(Yt.ROT_90),n=e.end.multiply3(Yt.ROT_90),a=new Uh(this,r,e.baseWeight,s,n,e.polyGrp,e.polyIndex);if(a.outsideWeight=e.outsideWeight,a.insideWeight=e.insideWeight,a.invalidWeight=e.invalidWeight,a.status=e.status,t!=null?(t.next=a,a.previous=t):i=a,this.vecSides.push(a),this.event.onSplitedSide(a),t=a,e.next!==null)e=e.next;else break}while(e.polyIndex!=0);i!=null&&(i.previous=t,t.next=i)}}canBeEnd(e,t){if(e.size()==1){let i=e.getFirst().shape;if(i instanceof ye){if(t&&i.rx<=t)return!1}else if(i instanceof oe&&t&&i.length()<=t)return!1}return!0}connectSides(){let e=new up,t=new Iu(10);for(let n of this.finalSides)e.computeIfAbsent(n.start,NL).push(n),t.add(n.start);let i=0,r=new Rh,s=new Array;for(let n of this.finalSides)if(!r.contains(n)){let a=new Rh,o=n.start,l=new El;l.add(n),r.add(n);let h=n.end;for(;l.size()>0;)if(this.isStart(o,h)&&this.canBeEnd(l,.01)){l.size()>1&&this.fillSideGroups(l,i++);break}else{let c=e.get(h),f=this.findNext(r,c);if(f==null&&(h=this.findNeigber(h,a,t,.01),h!==null&&(c=e.get(h),f=this.findNext(r,c))),f!=null)l.add(f),r.add(f),h=f.end;else if(h!=null?a.add(h):(s.length==0&&l.size()>1&&this.logger.warning3("unable to connect at %s",l.getLast()),s.push(l.removeLast())),l.size()>0)h=l.getLast().end;else break}}}fillSideGroups(e,t){let i=new TL(t);Lh(e,(r,s)=>(i.add(s),!0)),this.sideGroups[i.id]=i}isStart(e,t){return e.distance2(t)<=1e-4}findNext(e,t){if(t!=null){for(let i of t)if(!e.contains(i))return i}return null}fillResult(){let e=0,t=new up;for(let r in this.sideGroups){let s=this.sideGroups[r];Lh(s.sides,(n,a)=>(a.polyGrp!=-2&&t.put(a,a),!0))}let i=new Rh;for(let r in this.sideGroups){let s=this.sideGroups[r];if(i.add(s)){let n=0,a=new Array;for(a.push(s);n<a.length;){let l=a[n],h=new Array;Lh(l.others,(f,d)=>{let u=t.get(d);return u!=null&&h.push(u.finalGrp),!0}),AL(h,es.sortAsc,0,h.length);let c=l.id;for(let f of h)if(f!=c&&f!=l.id){let d=this.sideGroups[f];i.add(d)&&a.push(d),c=f}n++}let o=new Array;for(let l of a)o.push(l.polyline());CL(o,Jf.sortByBBoxAreaDesc,0,o.length),this.event.onPolylineGroup(new gm(o),e++)}}}findNeigber(e,t,i,r){let s=r*r,n=Number.MAX_VALUE,a=null;for(let o of i.search(e.bbox().extendOfSize(r)))if(!t.contains(o)){let l=e.distance2(o);l<n&&(n=l,a=o)}return n<s?a:null}},RL=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(e,t=!0){if(e instanceof oe)this.lines.push(e);else if(e instanceof ye)this.arcs.push(e);else if(e instanceof Be)this.beziers.push(e);else throw new Error("not support");t&&this.points.push(e.start())}addPoint(e){this.points.push(e)}addText(e,t,i=1,r=.1,s=!0){this.listText.push({pos:e,str:t,size:i,width:r}),s&&this.points.push(e)}addPly(e,t=!0){e.primitives.forEach(i=>this.addPt(i,t))}build(){let e=[],t=[],i=[],r=[],s=[],n=[];return this.points.forEach(a=>e.push(a.x,a.y)),this.lines.forEach(a=>t.push(a.start().x,a.start().y,a.end().x,a.end().y)),this.arcs.forEach(a=>i.push(a.center.x,a.center.y,a.rx,ot.toRadians(a.startAngle),ot.toRadians(a.endAngle()),a.sweep())),this.beziers.forEach(a=>{a.controls.forEach(o=>{r.push(o.x,o.y)}),r.push("end")}),this.listText.forEach(a=>s.push(a.pos.x,a.pos.y,a.str,a.width,a.size)),this.fonts.forEach(a=>n.push(a)),{points:e,lines:t,arcs:i,texts:s,beziers:r,fonts:n}}},No,Uu=(No=class{constructor(t){this.map=new up,this.bus=t}initColor(t){return this.map.computeIfAbsent(t,()=>new RL)}draw(){let t={},i=this.map.entries();for(;i.hasNext();){let r=i.next();t[r.key.toString()]=r.value.build()}this.bus.publish("/debug/draw",t)}clear(){this.map.clear()}static init(t){if(!t)throw new Error("bus is undefined!");this.palette=new No(t)}static initPalette(t){this.palette=t}static getDefaultColor(){for(let t of this.colorBuffersMap)if(t[0]!==null&&t[0])return t[0]=!1,t[1];return this.colorBuffersMap.forEach(t=>{if(t[0]===null){console.log(1);return}t[0]=!0}),this.getDefaultColor()}static clear(){this.palette.clear()}static auto(t,i=this.getDefaultColor()){if(Array.isArray(t))t.forEach(r=>{this.auto(r,i)});else if(t instanceof pe)this.point(t,i);else if(t instanceof Qr)this.bbox(t,i);else if(t instanceof Bu)this.primitive(t,i);else if(t instanceof bt)this.polyline(t,i);else if(t instanceof ir)this.polygon(t,i);else if(t instanceof Di)this.group(t,i);else if(t instanceof gm)this.auto(t.items,i);else{debugger;throw new Error("No incoming type!")}}static text(t,i,r=.5,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");this.palette.initColor(s).addText(t,i,r,r/10),this.palette.draw()}static point(t,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(i);Array.isArray(t)?t.forEach(s=>{this.point(s,i)}):r.addPoint(t),this.palette.draw()}static bbox(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.bbox(r,i)}):(this.primitive(new oe(new pe(t.maxX,t.maxY),new pe(t.maxX,t.minY)),i),this.primitive(new oe(new pe(t.maxX,t.maxY),new pe(t.minX,t.maxY)),i),this.primitive(new oe(new pe(t.minX,t.minY),new pe(t.maxX,t.minY)),i),this.primitive(new oe(new pe(t.minX,t.minY),new pe(t.minX,t.maxY)),i))}static primitive(t,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(i);Array.isArray(t)?t.forEach(s=>{this.primitive(s,i)}):r.addPt(t),this.palette.draw()}static polyline(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polyline(r,i)}):t.primitives.forEach(r=>{this.primitive(r,i)})}static polygon(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polygon(r,i)}):t.items.forEach(r=>{this.polyline(r,i)})}static group(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.group(r,i)}):t.items.forEach(r=>{this.polygon(r,i)})}static async begin(){this.t1=performance.now()}static async end(t){console.log(t||"t1:",performance.now()-this.t1)}static async log(t){console.log(t||"==================")}},No.colorBuffersMap=[[!0,Bt.BLUE],[!0,Bt.GREEN],[!0,Bt.WHITE],[!0,Bt.RED],[!0,Bt.Golden],[!0,Bt.Gray]],No.t1=0,No),DL=0,Fu=class HO{constructor(t,i){this.inters=[],this.shape=t,this.start=t.start(),this.end=t.end(),this.judgeOverlapMap=new Map,i&&(this.id=DL++)}reverse(){this.shape=this.shape.reverse();let t=this.start;this.start=this.end,this.end=t}getCenterPoint(t=this.end){let{x:i,y:r}=this.start,{x:s,y:n}=t;if(this.shape instanceof ye){let a=this.shape.rx,o=new pe((i+s)/2,(r+n)/2),l=this.shape.center,h;return o.x!==l.x||o.y!==l.y?(h=o.angle(l),Math.abs(this.shape.sweepAngle)>180&&(h+=h>=0?-180:180)):h=(this.shape.startAngle+this.shape.endAngle())/2,new pe(l.x+Math.cos(h)*a,l.y+Math.sin(h)*a)}else{if(this.shape instanceof oe)return new pe((i+s)/2,(r+n)/2);if(this.shape instanceof Be){let a=this.shape.getPercent(t,et);return Be.pointOn(a/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(t,i,r){let s=t.cross(i)>0,n=Math.acos(Math.min(1,Math.max(-1,t.dot(i)/i.length())));return(r?!s:s)&&(n=Ap-n),n}sortInters(){if(this.shape instanceof ye){let t=this.shape.center,i=this.shape.start().sub(t).normalize(),r=this.shape.isCCW;this.inters.sort((s,n)=>{let a=s.coord.sub(t),o=n.coord.sub(t);return HO.finalAngle(i,a,r)-HO.finalAngle(i,o,r)<=0?-1:1})}else if(this.shape instanceof oe){let t=this.start,i=this.end,r=new pe(i.x+(t.x-i.x)*2,i.y+(t.y-i.y)*2);this.inters.sort((s,n)=>s.coord.distance2(r)-n.coord.distance2(r)<=0?-1:1)}else if(this.shape instanceof Be){let t=this.shape;this.inters.sort((i,r)=>t.getPercent(i.coord,et)-t.getPercent(r.coord,et)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((t,i)=>t.setIndex(i))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(t){this.nextSide=t,t.prevSide=this}static returnPolygonList(t){let i=[];return t.forEach(r=>{let s=[];r.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),s.push(bt.build7(o))}),i.push(new ir(s))}),i}addInter(t){this.inters.push(t)}static returnPolygonGroup(t){let i=[];return t.forEach(r=>{let s=[];r.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),s.push(bt.build7(o))}),i.push(new ir(s))}),new Di(i)}static rebuild(t,i,r){let s;if(t instanceof oe||i.distance2(r)<1e-6)s=new oe(i,r);else if(t instanceof ye)s=ye.build2(t.center,i.angleD(t.center),r.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);else if(t instanceof Be){let n=t.getPercent(i,et),a=t.clip(n)[1];s=a.clip(a.getPercent(r,et))[0]}else throw new Error("not supported operation");return Qe(t,i).dot(Qe(s,i))<0?null:s}static returnPolyline(t){return bt.build7(t.map(i=>i.shape))}bbox(){return this.shape.bbox()}},ML=(e=>(e[e.END1=0]="END1",e[e.END2=1]="END2",e[e.END12=2]="END12",e[e.LEFT1=3]="LEFT1",e[e.LEFT2=4]="LEFT2",e))(ML||{});function ts(e,t,i){if(e instanceof ye&&t instanceof ye)return UL(e,t);if(e instanceof ye&&t instanceof oe)return g2(e,t);if(e instanceof oe&&t instanceof ye)return _2(e,t);if(e instanceof oe&&t instanceof oe)return Sl(e,t);if(e instanceof Be&&t instanceof oe)return e.controls.length===2||Ba(e)?Sl(new oe(e.start(),e.end()),t):gb(e,t);if(e instanceof oe&&t instanceof Be)return t.controls.length===2||Ba(t)?Sl(e,new oe(t.start(),t.end())):jO(e,t);if(e instanceof ye&&t instanceof Be)return t.controls.length===2||Ba(t)?g2(e,new oe(t.start(),t.end())):BL(e,t);if(e instanceof Be&&t instanceof ye)return e.controls.length===2||Ba(e)?_2(new oe(e.start(),e.end()),t):kL(e,t);if(e instanceof Be&&t instanceof Be)return Om(e,t);throw new Error("not support")}function gh(e,t){return Qe(e,t.start()).dot(Qe(t,t.start()))<=0?!1:ts(e,t).state<=2}function xO(e,t){let i=t.getPercent(e.end(),et);if(i===null)return!1;if(i===0)return!0;let r=t.clip(i)[0],s=e.buildConverxHull(et),n=r.buildConverxHull(et),a=h(s),o=h(n);return l(a,o);function l(c,f){let d=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),u=c[0],p=f[0];if(!u||!p)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let _=!0;do{let g=u.getShape(),b=p.getShape();if(g instanceof oe&&b instanceof oe){let m=_?Sl(g,b).state:d.get(Sl(b,g).state);if(m===0)u=u.nextSide,_=!1;else if(m===1)p=p.nextSide,_=!0;else if(m===2)u=u.nextSide,p=p.nextSide,_=!0;else return!1}else throw Error("not support")}while(u!==c[0].prevSide&&p!==f[0].prevSide);return!0}function h(c){let f=c.primitives.map(u=>new Fu(u)),d=f[f.length-1];return f.forEach(u=>{d.connect(u),d=u}),f}}function p2(e,t){let i=e.end().distance2(t.center);if(i>(t.rx+et)**2||i<(t.rx-et)**2||!(Ve(e.end(),t.end())||mm(t,e.end())))return!1;if(e.center.equals1(t.center))return!0;let r=e.center.distance1(t.center),s=Math.abs(e.rx-t.rx);if(r>Math.min(e.rx,t.rx)){let n=e.center.angleD(t.center);return e.rx>t.rx?!(r+s>et&&ta(e,n))&&!(r-s>et&&e.rx+t.rx-r>et&&ta(e,n+180)):!(r-s>et&&ta(e,n))&&!(e.rx+t.rx-r>et&&ta(e,n+180))}else{if(r+s<=et)return!0;let n=e.rx>t.rx?e.center.angleD(t.center):t.center.angleD(e.center);return ta(e,n)?!1:r-s<=et?!0:!ta(e,n+180)}}function BL(e,t){let i=ym(e,t.start()).toBezier2(),r,s=0;for(let n=i.length;s<n;s++){let a=i[s];if(r=Om(a,t).state,r!==0)break}return r===2&&s!==i.length-1?{state:1}:{state:r}}function kL(e,t){let i=t.toBezier2(),r,s=0;for(let n=i.length;s<n;s++){let a=i[s];if(r=Om(e,a).state,r!==1)break}return r===2&&s!==i.length-1?{state:0}:{state:r}}function Om(e,t){if(e.controls.length===2||Ba(e))return t.controls.length===2||Ba(t)?Sl(new oe(e.start(),t.end()),new oe(t.start(),t.end())):jO(new oe(t.start(),e.end()),t);if(t.controls.length===2||Ba(t))return gb(YO(e,t.start()),new oe(t.start(),t.end()));let i=YO(e,t.start());if(Ba(i))return jO(new oe(t.start(),e.end()),t);let r=xO(i,t),s=xO(t,i);if(!r&&!s){let n=QN(i,t);if(n.havOverlap){let a=n.havOverlap!==2,o=n.havOverlap!==1;return za(e,t,a,o)}else{let a=function(){for(let f=0;f<h;f+=2)te[f]=c[f],te[f+1]=c[f+1]},o,l,h=n.cnt,c=new Array(h).fill(0).map((f,d)=>te[d]);for(let f=0;f<h;f+=2){let d=new pe(te[f],te[f+1]),u=i.getPercent(d,et),p=t.getPercent(d,et);if(u===0||p===0)continue;let _=u===1?i:i.clip(u)[0],g=p===1?t:t.clip(p)[0];if(xO(_,g)){let b=Qe(e,d).cross(Qe(t,d));if(b===0){o=i.end(),l=t.end();break}return{state:b<0?3:4}}a()}return(!o||!l)&&(o=Ph(i.controls,i.controls[0],t),l=Ph(t.controls,i.controls[0],i)),{state:o.sub(i.controls[0]).cross(l.sub(i.controls[0]))>0?4:3}}}return za(e,t,r,s)}function gb(e,t){let i=YO(e,t.start());if(Ba(i))return Sl(new oe(i.start(),i.end()),t);let r=mb(i,t),{isIn:s,bezierIsInLeft:n}=Ob(t,i);if(!r&&!s){if(n!==void 0)return{state:n?3:4};let a=null,o=e.getPercent(t.start(),et)+.01;for(let l=o>1?1:o;l<=1;){let h=Be.pointOn(l,e.controls);if(Pu(t,h)>is){a=h;break}l+=.01,l>1&&(l=1)}if(!a)throw Error("!end1 && !end2 not result");return{state:t.direct.cross(a.sub(t.start()))<0?4:3}}return za(i,t,r,s)}function jO(e,t){let{isIn:i,bezierIsInLeft:r}=Ob(e,t),s=mb(t,e);if(!i&&!s){if(r!==void 0)return{state:r?4:3};let n=null;for(let a=.01;a<=1;){let o=Be.pointOn(a,t.controls);if(Pu(e,o)>is){n=o;break}a+=.01,a>1&&(a=1)}if(!n)throw Error("!end1 && !end2 not result");return{state:e.direct.cross(n.sub(e.start()))<0?3:4}}return za(t,e,i,s)}function UL(e,t){let i=p2(ym(e,t.start()),t),r=p2(t,e);if(!i&&!r){let s=Pn(t);if(e.center.sub(t.start()).dot(t.center.sub(t.start()))>0){if(e.rx===t.rx)return e.isCCW?{state:s.dot(e.center.sub(t.center))<0?3:4,exitIsInvalid:!1}:{state:s.dot(e.center.sub(t.center))>0?3:4,exitIsInvalid:!1};let n,a;return e.rx>t.rx?(n=e,a=t):(n=t,a=e),s.dot(a.center.sub(n.center))>0&&a.rx+a.center.distance1(n.center)-n.rx>et?e.isCCW?{state:e.rx>t.rx?3:4,exitIsInvalid:!1}:{state:e.rx<t.rx?3:4,exitIsInvalid:!1}:e.isCCW?{state:e.rx<t.rx?3:4,exitIsInvalid:!0}:{state:e.rx>t.rx?3:4,exitIsInvalid:!0}}else return e.rx+t.rx-e.center.distance1(t.center)>et&&s.dot(e.center.sub(t.center))>0?{state:t.isCCW?3:4,exitIsInvalid:!1}:{state:e.isCCW?3:4,exitIsInvalid:!0}}return za(e,t,i,r)}function _2(e,t){let i=In.foot(e,t.center),r=e.end().distance2(t.center),s=e.end().sub(e.start()),n=(t.rx-et)**2,a=r<=(t.rx+et)**2&&r>=n&&(s.dot(i.sub(t.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(i)||i.distance2(t.center)>=n)&&(Ve(e.end(),t.end())||mm(t,e.end())),o=yb(t,e);if(!a&&!o){let l=e.distance2(t.center);return l<=is?{state:s.cross(Pn(t))>0?4:3}:s.dot(i.sub(t.start()))>=0&&(r<n||e.start().distance2(t.center)<n||l<n)?{state:s.cross(t.center.sub(e.start()))<0?4:3}:{state:s.cross(t.center.sub(e.start()))>0?4:3}}return za(t,e,a,o)}function ta(e,t){return t=ot.regularD(t),e.sweepAngle>0?(t<e.startAngle&&(t+=360),e.endAngle()>t):(t>e.startAngle&&(t-=360),e.endAngle()<t)}function mm(e,t){return Ve(e.end(),t)||Ve(e.start(),t)||ta(e,t.angleD(e.center))}function Ob(e,t){let i=e.panDistance(et),r=e.panDistance(-et),s=O2(t,i),n=O2(t,r);if(!s.length&&!n.length)return{isIn:t.getPercent(e.end(),et)!==null};let a=[...s,...n].sort((c,f)=>c.t-f.t),o=new oe(r.start(),i.start()),l=[];for(let c=0,f=a.length;c<f;c++){let d=a[c];if(l.push(d),o.distance(d.interP)>e.length()+et)break;if(l.length===2){let u=(l[1].t*10+l.shift().t*10)/20,p=Be.pointOn(u,t.controls);if(e.distance2(p)>is)return{isIn:!1,bezierIsInLeft:e.direct.cross(p.sub(e.start()))>0}}}let h=l.length?o.distance(l[0].interP)>=e.length()+et:!0;return{isIn:h,bezierIsInLeft:h?void 0:e.direct.cross(l[0].interP.sub(e.start()))>0}}function mb(e,t){if(Pu(t,e.end())>is||e.getToLineMaxDis2(t)>is)return!1;let i=GL(t,is);return e.getToLineMaxDis2(i)<=(t.length()+et)**2}function yb(e,t){let i=t.end().angleD(t.start()),r=FL(t,e.end());if(r>is)return!1;if(ta(e,i+90)){if(In.foot(t,e.center).distance1(e.pointOn(i+90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}if(ta(e,i-90)){if(In.foot(t,e.center).distance1(e.pointOn(i-90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}return r<=is&&(Ve(e.end(),t.end())||VO(t,e.end()))}var bb=(et*2)**2;function ym(e,t){if(Ve(e.end(),t))return ye.build3(e.center,e.endAngle(),0,e.rx,e.ry);if(e.start().distance2(t)<bb)return e;let i=ot.regularD(t.angleD(e.center));if(!ta(e,i))throw new Error("!angleIsInArc(arc, angle)");return ye.build2(e.center,i,e.endAngle(),e.rx,e.ry,e.isCCW?1:0)}function YO(e,t){if(Ve(e.end(),t))return new Be([t,t]);if(e.start().distance2(t)<bb)return e;let i=e.getPercent(t,et);if(i===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return e.clip(i)[1]}function g2(e,t){let i=yb(ym(e,t.start()),t),r=t.end().distance2(e.center),s=t.end().sub(t.start()),n=In.foot(t,e.center),a=(e.rx-et)**2,o=r<=(e.rx+et)**2&&r>=a&&(s.dot(n.sub(t.start()))<=0||t.start().distance2(t.end())<=t.start().distance2(n)||n.distance2(e.center)>=a)&&(Ve(e.end(),t.end())||mm(e,t.end()));if(!i&&!o){let l=t.distance2(e.center);return l<=is?{state:s.cross(Pn(e,t.start().angle(e.center)))>0?3:4}:s.dot(n.sub(t.start()))>=0&&(r<a||t.start().distance2(e.center)<a||l<a)?{state:s.cross(e.center.sub(t.start()))>0?4:3}:{state:s.cross(e.center.sub(t.start()))<0?4:3}}return za(t,e,i,o)}function Sl(e,t){if(Ve(e.end(),t.end()))return za(e,t,!0,!0);let i=Pu(t,e.end())<=is&&VO(t,e.end()),r=Pu(e,t.end())<=is&&VO(e,t.end());if(!i&&!r){let s=e.direct.x===0&&e.direct.y===0,n=t.direct.x===0&&t.direct.y===0;if(s&&n)throw Error("2LineAllIsPoint");return s?{state:t.direct.cross(e.end().sub(t.start()))>0?3:4}:{state:e.end().sub(e.start()).cross(t.end().sub(e.start()))>0?4:3}}return za(e,t,i,r)}function VO(e,t){return In.foot(e,t).distance2(e.start())<e.end().distance2(e.start())}function za(e,t,i,r){if(i)return r?Ve(e.end(),t.end())?{state:2}:{state:0}:{state:0};if(r)return{state:1};throw new Error("!end1 && !end2")}function Pu(e,t){return(e.a*t.x+e.b*t.y+e.c)**2/(e.a**2+e.b**2)}function FL(e,t){return Math.min(e.distance2(t),In.foot(e,t).distance2(t))}function GL(e,t){let i=e.panDistance(t),r=e.panDistance(-t);return new oe(r.start(),i.start())}function Ba(e){let t=e.start(),i=e.end();t.equals1(i)&&(i=t.add1(1,0));let r=i.y-t.y,s=t.x-i.x,n=-r*t.x-s*t.y,a=Math.sqrt(1/(r**2+s**2));r*=a,s*=a,n*=a;let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return e.controls.forEach(h=>{let c=r*h.x+s*h.y+n;c<o&&(o=c),c>l&&(l=c)}),la(o,l)}function O2(e,t){let i=ln(e,t),r=[],s=new Array(i).fill(0).map((a,o)=>te[o]);for(let a=0;a<i;a+=2){let o=new pe(te[a],te[a+1]),l=e.getPercent(o);r.push({interP:o,t:l}),n()}function n(){for(let a=0;a<i;a+=2)te[a]=s[a],te[a+1]=s[a+1]}return r}var Qn=.01,zL=270;function Do(e){let t=Qn**2,i=e.end(),r=[],s=[];for(let u=0,p=e.primitives.length;u<p;u++){let _=function(R,B){return R instanceof oe&&B instanceof oe&&Math.abs(R.direct.cross(B.direct))<Te.eps&&R.direct.dot(B.direct)>0||R instanceof ye&&B instanceof ye&&Math.abs(R.rx-B.rx)<=Te.eps&&R.center.distance2(B.center)<Te.eps&&R.isCCW===B.isCCW},g=function(R){if(Ys(R,Qn))s.push(null);else{if(R instanceof oe)s.push(R);else if(R instanceof ye&&R.rx===R.ry)f(R,s);else if(R instanceof Be){let B=[];lb(R,B),B.forEach(Y=>{let G=Y.start(),z=Y.end();c(G,z)||s.push(Y)})}else throw new Error("not support!");i=y}},b=function(R){if(R instanceof oe)return R.direct.x===0&&R.direct.y===0;if(R instanceof ye)return R.sweepAngle===0;if(R instanceof Be){let B=new Set(R.controls.map(G=>G.x)),Y=new Set(R.controls.map(G=>G.y));return B.size===1&&Y.size===1}else throw new Error("not support")},m=e.primitives[u],O=m.start(),y=m.end();if(b(m))continue;c(i,O)||(s.push(new oe(i,O)),i=O);let x=(u+1)%p,E=e.primitives[x];for(;_(m,E)&&(x=(x+1)%p,E=e.primitives[x],E!==m););if(x===(u+1)%p){g(m);continue}if(E===m){if(!(m instanceof ye)){if(Math.abs(e.area(.1))<t)return null;throw new Error("simplifyPolyline not support")}let R=m instanceof ye?m.isCCW:e.area(.1)>0;s.length=0;let B=R?180:-180;s.push(ye.build3(m.center,m.startAngle,B,m.rx,m.ry),ye.build3(m.center,m.startAngle+B,B,m.rx,m.ry));break}let w=(()=>{if(m instanceof oe)return(R,B)=>{let Y=new oe(R,B);return Ys(Y,Qn)?null:[Y]};if(m instanceof ye)return(R,B)=>{let Y;if(R.equals1(B)?Y=ye.build3(m.center,m.startAngle,m.sweep()===1?360:-360,m.rx,m.ry):Y=ye.build4(R,B,m.center,m.rx,m.ry,m.sweep()),Ys(Y,Qn))return null;let G=Y.pointOn(Y.startAngle+Y.sweepAngle/2),z=ye.build4(Y.start(),G,m.center,m.rx,m.ry,m.sweep()),q=ye.build4(G,Y.end(),m.center,m.rx,m.ry,m.sweep());return Ys(z,Qn)||Ys(q,Qn)?[Y]:[z,q]};throw new Error("not support")})(),S=x===0;if(x<u&&!S&&(S=!w(e.primitives[0].start(),e.primitives[x-1].end()),!S)){let R=w(m.start(),e.primitives[p-1].end());if(R)s.push(...R);else{let B=w(m.start(),s[0].end());if(B.length===1)s[0]=B[0];else if(B.length===2)s[0]=B[1],s.push(B[0]);else throw new Error("!!!generatorPt")}break}u=x===0?p-1:x-1,E=e.primitives[u];let C=w(m.start(),E.end());if(C?(C.forEach(R=>s.push(R)),i=E.end()):g(null),S)break}let n=s.length;if(s.forEach((u,p)=>{if(u)r.push(u);else{let _,g;p===n-1&&(_=r[0],g=r[r.length-1]);let b=(p+1)%n;if(_=_!=null?_:s[b],_){let m=p,O=!1;for(;g=g!=null?g:s[(--m+n)%n],g!==_;)if(g){O=!0;break}if(O){if(_.start().equals1(g.end()))return;if(Qe(g,g.end()).dot(Qe(_,_.start()))<0){if(!c(g.end(),_.start())){let w=new oe(g.end(),_.start());r.push(w);return}let{rebuildPrevPt:y,rebuildNextPt:x,rebuildLinkLine:E}=m2(s[(m-1+n)%n],g,new oe(g.end(),_.start()),_,s[(p+2)%n]);y&&x&&(y!==g?(s[(m+n)%n]=y,r[r.length-1]&&(r[r.length-1]=y)):x!==_&&(s[(p+1)%n]=x,r[0]===_&&(r[0]=x)),E&&r.push(E))}}}}}),r.length===0)return null;c(i,r[0].start())||r.push(new oe(i,r[0].start()));let a=r[r.length-1];if(r.length===1)return a instanceof ye?bt.build7([ye.build2(a.center,0,180,a.rx,a.ry,a.sweep()),ye.build2(a.center,180,360,a.rx,a.ry,a.sweep())]):a instanceof Be?bt.build7(a.clip(.5)):null;let o=r.map(u=>new HL(u)),l=o[o.length-1];for(o.forEach(u=>{u.connect(l),l=u});!l.isVisited;){let u=function(){l.next.connect(_),l=l.next,l.isConnected=!1,l.isVisited=!1},p=function(){l.connect(_.prev),l.isConnected=!1},_=l.prev;if(l===_)break;let g=l.pt,b=_.pt,m=b.end();if(!l.isConnected&&!m.equals(g.start())){let O=function(x){l.isConnected=!0,l.pt=g=x,l.next.isVisited=!1},y=function(x){l.isConnected=!0,_.pt=x,_.isVisited=!1,l=_};if(g instanceof oe)if(c(m,g.end())){u();continue}else O(new oe(m,g.end()));else if(b instanceof oe){c(b.start(),g.start())?p():y(new oe(b.start(),g.start()));continue}else if(g instanceof Be)if(c(m,g.end())&&!(g.controls.length!==2&&g.getToLineMaxDis2(g.startToEndL)>=t)){u();continue}else O(new Be([m,...g.controls.slice(1)]));else if(b instanceof Be)c(b.start(),g.start())&&!(b.controls.length!==2&&b.getToLineMaxDis2(b.startToEndL)>=t)?p():y(new Be([...b.controls.slice(0,-1),g.start()]));else if(g instanceof ye&&b instanceof ye)if(Math.abs(Math.abs(g.sweepAngle)-180)<Math.abs(Math.abs(b.sweepAngle)-180)){let x=ye.build5(m,g.end(),g.sweepAngle);if(c(x.start(),x.end())&&!(x.rx>=Qn&&Math.abs(x.sweepAngle)>180)){u();continue}else O(x)}else{let x=ye.build5(b.start(),g.start(),b.sweepAngle);c(x.start(),x.end())&&!(x.rx>=Qn&&Math.abs(x.sweepAngle)>180)?p():y(x);continue}else throw new Error("not support")}if(Qe(g,g.start()).dot(Qe(b,b.end()))<0){let O=function(E,w,S,C,R,B){if(l.next===_){l=null;return}let{rebuildLinkLine:Y,rebuildPrevPt:G,rebuildNextPt:z}=m2(E,w,S,C,R);G&&z&&(G!==w&&(_.prev.pt=G),z!==C&&(l.next.pt=z),Y?B.pt=Y:u())},y=function(){l.next===_?l=null:(l.next.connect(_.prev),l=l.next,l.isConnected=!1,l.isVisited=!1)},x=ts(b.reverse(),g).state;if(x===0){let E=y2(g,b.start(),g.end());if(d(E)){let w=_.prev.pt,S=l.next.pt;if(Qe(S,S.start()).dot(Qe(w,w.end()))>=0){if(y(),!l)break;continue}if(O(_.prev.prev.pt,w,E instanceof oe?E:new oe(E.start(),E.end()),S,l.next.next.pt,l),!l)break}else l.pt=E;p();continue}else if(x===1){let E=y2(b,b.start(),g.end());if(d(E)){let w=_.prev.pt,S=l.next.pt;if(Qe(S,S.start()).dot(Qe(w,w.end()))>=0){if(y(),!l)break;continue}if(O(_.prev.prev.pt,w,E instanceof oe?E:new oe(E.start(),E.end()),S,l.next.next.pt,_),!l)break}else _.pt=E;u();continue}else if(x===2){if(y(),!l)break;continue}}l.isVisited=!0,l=l.next}if(!l)return null;r.length=0;let h=l;for(r.push(l.pt),l=l.next;l!==h;)r.push(l.pt),l=l.next;if(r.length===1){let u=r[0];return u instanceof ye?(c(u.start(),u.end())?r[0]=ye.buildCircle(u.center,u.rx,u.sweep()):r.push(new oe(u.end(),u.start())),bt.build7(r)):u instanceof Be?(c(u.start(),u.end())||r.push(new oe(u.end(),u.start())),bt.build7(r)):null}if(e=bt.build7(r),Math.abs(e.area(.1))<t)return null;return e;function c(u,p){return u.distance2(p)<t}function f(u,p){if(Math.abs(u.sweepAngle)>zL){let _=u.sweepAngle/2;f(ye.build3(u.center,u.startAngle,_,u.rx,u.ry),p),f(ye.build3(u.center,u.startAngle+_,_,u.rx,u.ry),p)}else p.push(u)}function d(u){return u.start().distance2(u.end())<t&&!(u instanceof ye&&u.rx>=Qn&&Math.abs(u.sweepAngle)>180||u instanceof Be&&u.controls.length!==2&&u.getToLineMaxDis2(new oe(u.start().add1(1,0),u.end()))>=t)}}function Ys(e,t){if(!e)return!0;let i=e.start(),r=e.end();if(i.distance2(r)<t**2)if(e instanceof ye){if(!(e.rx>=t&&Math.abs(e.sweepAngle)>180))return!0}else if(e instanceof Be){if(!(e.controls.length!==2&&e.getToLineMaxDis2(new oe(e.start().add1(1,0),e.end()))>=t))return!0}else return!0;return!1}function Oh(e){if(e.direct.x===0&&e.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let t=Math.abs(Qn-e.length())+Te.eps,i={x:e.direct.normalize().x*t,y:e.direct.normalize().y*t},r=e.end();return new pe(r.x+i.x,r.y+i.y)}function m2(e,t,i,r,s){if(!e)a();else if(!s)o();else{let l=Qe(e,e.end()),h=Qe(t,e.end()),c=l.dot(h);if(c>=0)a();else{let f=Qe(r,r.end()),d=Qe(s,r.end()),u=f.dot(d);if(u>=0)o();else if(la(c,-1)&&la(u,-1)){let p=i.center();n(p),i=null}else c>u?a():o()}}function n(l){let h;if(t instanceof oe)h=new oe(t.start(),l);else if(t instanceof Be)h=new Be([...t.controls.slice(0,-1),l]);else if(t instanceof ye)h=ye.build5(t.start(),l,t.sweepAngle);else throw new Error("not supported");t=Ys(h,et)?null:h;let c;if(r instanceof oe)c=new oe(l,r.end());else if(r instanceof Be)c=new Be([l,...r.controls.slice(1)]);else if(r instanceof ye)c=ye.build5(l,r.end(),r.sweepAngle);else throw new Error("supported");r=Ys(c,et)?null:c}function a(){if(t instanceof oe){let l=Oh(i.reverse());i=new oe(l,i.end());let h=new oe(t.start(),l);t=Ys(h,et)?null:h}else if(t instanceof Be){let l=Oh(i.reverse());i=new oe(l,i.end());let h=new Be([...t.controls.slice(0,-1),l]);t=Ys(h,et)?null:h}else if(t instanceof ye){let l=Oh(i.reverse());i=new oe(l,i.end());let h=ye.build5(t.start(),l,t.sweepAngle);t=Ys(h,et)?null:h}else throw new Error("not supported")}function o(){if(r instanceof oe){let l=Oh(i);i=new oe(i.start(),l);let h=new oe(l,r.end());r=Ys(h,et)?null:h}else if(r instanceof Be){let l=Oh(i);i=new oe(i.start(),l);let h=new Be([l,...r.controls.slice(1)]);r=Ys(h,et)?null:h}else if(r instanceof ye){let l=Oh(i);i=new oe(i.start(),l);let h=ye.build5(l,r.end(),r.sweepAngle);r=Ys(h,et)?null:h}else throw new Error("not supported")}return{rebuildPrevPt:t,rebuildNextPt:r,rebuildLinkLine:i}}function y2(e,t,i){if(e instanceof oe||t.distance2(i)<=is)return new oe(t,i);if(e instanceof ye)return ye.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof Be){let r=e.getPercent(t,et),s=e.getPercent(i,et);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}var HL=class{constructor(e){this.pt=e}connect(e){this.prev=e,e.next=this}};function fp(e){let t=Gu(),i;if(e instanceof bt){let r=Do(e);if(r===null)return null;i=r}else if(e instanceof ir){let r=e.items.map(s=>fp(s)).filter(s=>s!==null);if(r.length===0)return null;i=new ir(r)}else{let r=e.items.map(s=>fp(s)).filter(s=>s!==null);if(r.length===0)return null;i=new Di(r)}return na.preprocessPolyline+=Po(t),i}var na={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function Gu(){return{timeIndex:Object.assign({},na),start:performance.now()}}function b2(e){return Object.values(e).reduce((t,i)=>t+i,0)}function Po(e){return performance.now()-e.start-(b2(na)-b2(e.timeIndex))}function mr(e,t,i,r){let s=Bt.RED,n=Bt.Golden;function a(){if(!r)return;let d=r.initColor(Bt.Golden);d.addPt(o),d.addPoint(o.end()),r.initColor(Bt.RED).addPt(l),r.draw();debugger}let o=e.getShape(),l=i?t.getShape():t.getShape().reverse(),h=Qe(o,l.start()),c=Qe(l),f=h.cross(c);if(la(f,0))if(o instanceof oe)if(l instanceof oe){if(Te.eq(f,0)&&(h.dot(c)>0?!Ve(o.end(),l.start()):!Ve(o.start(),l.start())))throw a(),new Error("line and line");return f<0}else{if(l instanceof ye)return h.cross(l.center.sub(o.start()))<0;if(l instanceof Be){let d=l.getExtremePoints(o),u=d.length?d[0]:Ph(l.controls,o.start());return h.cross(u.sub(o.start()))<0}else throw new Error("not support")}else if(o instanceof ye){if(l instanceof oe)return o.isCCW;if(l instanceof ye){if(l.center.equals1(o.center)&&(h.dot(c)>0?!Ve(o.end(),l.start())&&o.end().sub(l.start()).dot(c)>0:!Ve(o.start(),l.start())&&o.start().sub(l.start()).dot(c)>0))throw a(),new Error("arc and arc");return l.rx>=o.rx||l.center.distance2(o.center)>o.rx2?o.isCCW:!o.isCCW}else throw new Error("not support")}else if(o instanceof Be)if(l instanceof oe){let d=o.getPercent(l.start(),et),u=o.clip(d)[1],p=u.getExtremePoints(l);return(p.length?p[0]:Ph(u.controls,l.start())).sub(l.start()).cross(c)<0}else if(l instanceof Be){let d=o.getPercent(l.start(),et),u=o.clip(d)[1],p=u.getExtremePoints(new oe(l.start(),l.end())),_=l.getExtremePoints(new oe(u.start(),u.end())),g=p.length?p[0]:Ph(u.controls,l.start()),b=_.length?_[0]:Ph(l.controls,l.start()),m=g.sub(l.start()),O=b.sub(l.start());return m.cross(O)<0}else throw Error("not support");else throw new Error("not support");else return f<0}function Ll(e,t,i,r,s){let n=e.getShape(),a=t.getShape(),o=n instanceof ye?Pn(n,ot.toRadians(n.endAngle())):n instanceof Be?Su(n,1):n.end().sub(n.start()).normalize(),l=Qe(a),h=o.dot(l);if(la(h,-1))return mr(e,t,!0,s)?mr(e,i,r,s)&&mr(t,i,r,s):mr(e,i,r,s)||mr(t,i,r,s);{let c=o.scale(-1).angle(pe.ORIGIN),f=l.angle(pe.ORIGIN);c>f&&(c-=Ap);let d=(c+f)/2,u=new pe(Math.cos(d),Math.sin(d)),p=r?i.getShape():i.getShape().reverse(),_=Qe(p);return u.cross(_)<0?mr(e,i,r,s):mr(t,i,r,s)}}function vO(e,t,i,r,s){let n=e.getShape(),a=t.getShape(),o=n instanceof ye?Pn(n,ot.toRadians(n.endAngle())):n instanceof Be?Su(n,1):n.end().sub(n.start()).normalize(),l=Qe(a),h=o.dot(l);if(la(h,-1))return mr(e,t,!0,s)?mr(e,i,r,s)&&mr(t,i,r,s):mr(e,i,r,s)||mr(t,i,r,s);{let c=o.scale(-1).angle(pe.ORIGIN),f=l.angle(pe.ORIGIN);c>f&&(c-=Ap);let d=(c+f)/2,u=new pe(Math.cos(d),Math.sin(d)),p=r?i.getShape():i.getShape().reverse(),_=Qe(p);if(u.cross(_)<0){let g=o.dot(_)<0,b=ts(g?e.getShape().reverse():e.getShape(),p).state;return b!==3&&b!==4?mr(e,i,r,s):b===(g?4:3)}else{let g=l.dot(_)<0,b=ts(g?t.getShape().reverse():t.getShape(),p).state;return b!==3&&b!==4?mr(t,i,r,s):b===(g?4:3)}}}var jL=(e=>(e[e.NOT_IN=0]="NOT_IN",e[e.IS_IN=1]="IS_IN",e[e.IS_OVERLAP=2]="IS_OVERLAP",e))(jL||{}),YL=(e=>(e[e.AllClear=0]="AllClear",e[e.MapClear=1]="MapClear",e))(YL||{}),ia,Co=!1;function Vs(e,t,i,r,s,n,a,o=i.side===t,l=!0,h){return ia=s,Co=n,xb(vb(e,t,l,h,a,i,o,r),i,o,r,0)}function Ra(e,t,i,r,s,n,a,o=r.side===i){ia=s,Co=n;let l=Eb(e,t,i,new Map,r,o,a),h=l instanceof Array?-1:1;return xb(l,r,o,a,h)}function xb(e,t,i,r,s){for(;e instanceof Array;)s++,e.length===4?e=Eb(...e,t,i,r):e=vb(...e,t,i,r);return{...e,existOverlap:s>0}}function vb(e,t,i,r,s,n,a,o){if(pp===-1){o.initColor(Bt.RED).addPt(e.getShape()),o.initColor(Bt.Golden).addPt(t.getShape()),o.draw();debugger}let l=e.getShape(),h=a?t.getShape().reverse():t.getShape(),c=(l instanceof ye?Pn(l,i?h.start().angle(l.center):r?ot.toRadians(l.endAngle()):void 0):l instanceof Be?Qe(l,i?h.start():r?l.end():l.start()):l.end().sub(l.start())).normalize(),f=(h instanceof ye?Pn(h,i?void 0:(r?l.end():l.start()).angle(h.center)):h instanceof Be?Qe(h,i?void 0:r?l.end():l.start()):h.end().sub(h.start())).normalize();if(r===void 0){let p=c.dot(f);if(r=p<0,la(p,0))return{state:mr(e,t,!a,o)?1:0,inter:Da(e,t,n,a,i,r,s)}}else if(r?c.dot(f)>0:c.dot(f)<0)if(i){let p,_=!0;if(l instanceof oe&&Ve(In.foot(l,h.start()),r?l.end():l.start()))_=!1;else if(l instanceof ye||l instanceof Be){let g=r?l.reverse():l,b=ts(h,sL(g,h.start()).reverse()).state;(b===1||b===2)&&(_=!1)}if(_){let g=!r;p=ts(g?l.reverse():l,h,o).state===(g?4:3)?1:0}else r?p=Ll(e,e.nextSide,t,!a,o)?1:0:p=Ll(e.prevSide,e,t,!a,o)?1:0;return{state:p,inter:Da(e,t,n,a,i,r,s)}}else return r?{state:mr(e,e.nextSide,!0,o)?0:1,inter:Da(e,t,n,a,i,r,s),isReversed:!0}:{state:mr(e.prevSide,e,!0,o)?0:1,inter:Da(e,t,n,a,i,r,s),isReversed:!0};let d,u=new Map([[3,4],[4,3],[0,1],[1,0],[2,2]]);if(i)if(e.judgeOverlapMap.has(t)&&!Co){let p=e.judgeOverlapMap.get(t);d=r?u.get(p.state):p.state}else d=ts(r?l.reverse():l,h).state,(d===3||d===4)&&e.judgeOverlapMap.set(t,{state:r?u.get(d):d});else{if(t.judgeOverlapMap.has(e)&&!Co){let p=t.judgeOverlapMap.get(e);d=a?u.get(p.state):p.state}else d=ts(h,r?l.reverse():l).state,(d===3||d===4)&&t.judgeOverlapMap.set(e,{state:a?u.get(d):d});d=u.get(d)}if(d===1||d===2){let p=a?t.prevSide:t,_=p.inters,g=p.getEnd();for(let b=_.length-1;b>=0;b--){let m=_[b];if(!(p.getShape()instanceof Be)&&!Ve(g,m.coord))break;if(m===n)return{state:2,inter:Da(e,t,n,a,i,r,s)}}}if(d===3||d===4)return{state:d===(r?4:3)?1:0,inter:Da(e,t,n,a,i,r,s)};if(s.has(e)?s.get(e).mapSideList.push(t):s.set(e,{sideIsReversed:r,mapSideList:[t]}),s.has(t)?s.get(t).mapSideList.push(e):s.set(t,{sideIsReversed:a,mapSideList:[e]}),d===2)return r?[e.prevSide,e,a?t.prevSide:t.nextSide,s]:[e,e.nextSide,a?t.prevSide:t.nextSide,s];if(d===0)return[r?e.prevSide:e.nextSide,t,!1,r,s];if(d===1)return[e,a?t.prevSide:t.nextSide,!0,r,s];throw Error("not support")}function Da(e,t,i,r,s,n,a){if(Co)return null;let o=e.getShape(),l=r?t.getShape().reverse():t.getShape(),h=r;if(!s){let u=t;t=e,e=u,r=n,i=i.getBindedInter()}let c=u=>!(s?n:h)&&Ve(u,e.prevSide.getEnd())?e.prevSide:e;if(r){let u=t.inters;for(let p=0;p<u.length;p++){let _=u[p];if(_.isInvalid&&n===void 0)continue;if(_===i&&Ve(l.start(),i.coord))return s?_:_.getBindedInter();let g=_.getBindedInter().side,b=c(_.coord);if(g===b&&f(_))return d(_)}for(;;){t=t.nextSide;let p=t.inters;for(let _=0;_<p.length;_++){let g=p[_];if(g===i)return s?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||Ve(g.coord,b.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return d(g);if(a.has(b)){let m=t.getShape().reverse(),O=Qe(m,g.coord).dot(Qe(b.getShape(),g.coord))<0,y=O?b.getShape().reverse():b.getShape(),x=ts(m,O?OO(y,g.coord,y.end()):OO(y,y.start(),g.coord)).state;if(x===1||x===2)return d(g)}else a.has(b.nextSide)}else if(g.side===i.side&&f(g))return d(g)}}}else{let u=t.inters;for(let p=u.length-1;p>=0;p--){let _=u[p];if(_.isInvalid&&n===void 0)continue;if(_===i&&Ve(l.start(),i.coord))return s?_:_.getBindedInter();let g=_.getBindedInter().side,b=c(_.coord);if(g===b&&f(_))return d(_)}for(;;){t=t.prevSide;let p=t.inters;for(let _=p.length-1;_>=0;_--){let g=p[_];if(g===i)return s?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||Ve(g.coord,g.getBindedInter().side.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return d(g);if(!a.has(b)&&a.has(b.prevSide)){let m=t.getShape().reverse(),O=Qe(m,g.coord).dot(Qe(b.getShape(),g.coord))<0;if(a.has(b.prevSide)){let y=O?b.getShape().reverse():b.getShape(),x=ts(t.getShape(),OO(y,g.coord,y.end())).state;if(x===1||x===2)return d(g)}}}else if(g.side===i.side&&f(g))return d(g)}}}function f(u){if(u.isInvalid||u.getBindedInter().side!==(Ve(u.coord,e.prevSide.getEnd())?e.prevSide:e))return!1;let p;if(s){if(Ve(u.coord,l.start()))return!0;p=ts(n?o.reverse():o,_(l)).state}else{if(Ve(u.coord,n?o.end():o.start()))return!0;p=ts(l,_(n?o.reverse():o)).state}return p===2||p===1;function _(g){if(g instanceof oe)return Ve(u.coord,g.end())?g:g.cutLine(u.coord);if(g instanceof ye)return ye.build2(g.center,g.startAngle,u.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof Be)return g.clip(g.getPercent(u.coord,et))[0];throw new Error("not supported operation")}}function d(u){let p=i.getBindedInter(),_=i.side,g=p.side,b=i===u,m=i;if(r){let O=i.getIndex()-1;for(;_;){let y=_.inters;for(;O>=0;O--)if(i=y[O],i===u){b||(i.setIsInvalid(),i.isDealed(),m=i),_=null;break}else if(ia===0)!i.isInvalid&&(!Ve(i.coord,u.coord)||i.side===u.side&&i.getBindedInter().side===u.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),m=i);else if(ia===1){if(i.isInvalid)continue;let x=i.getBindedInter().side;a.has(_)&&a.get(_).mapSideList.includes(x)&&(i.setIsInvalid(),i.isDealed(),m=i)}_=_==null?void 0:_.prevSide,O=(_==null?void 0:_.inters.length)-1}}else{let O=i.getIndex()+1;for(;_;){let y=_.inters;for(;O<y.length;O++){i=y[O];let x=i.getBindedInter();if(i===u){b||(i.setIsInvalid(),i.isDealed(),m=i),_=null;break}else if(ia===0)!i.isInvalid&&(!Ve(i.coord,u.coord)||_===u.side&&(Ve(x.side.getEnd(),i.coord)?x.side.nextSide:x.side)===u.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),m=i);else if(ia===1){let E=x.side;a.has(_)&&a.get(_).mapSideList.includes(E)&&(i.setIsInvalid(),i.isDealed(),m=i)}}_=_==null?void 0:_.nextSide,O=0}}if(ia===0&&!Ve(p.coord,u.coord))if(s?a.has(g)?a.get(g).sideIsReversed:n:h){let O=p.getIndex()-1;for(;g;){let y=a.has(g),x=g.inters;for(;O>=0;O--){if(p=x[O],p===u.getBindedInter()){g=null;break}p.isInvalid||!y||(!Ve(p.coord,u.getBindedInter().coord)||p.side===u.side&&p.getBindedInter().side===u.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.prevSide,O=(g==null?void 0:g.inters.length)-1}}else{let O=p.getIndex()+1;for(;g;){let y=g.inters,x=a.has(g);for(;O<y.length;O++){if(p=y[O],p===u.getBindedInter()){g=null;break}let E=Ve(g.getEnd(),p.coord)?a.has(g.nextSide):!1;p.isInvalid||!(x||E)||(!Ve(p.coord,u.getBindedInter().coord)||p.side===u.side&&p.getBindedInter().side===u.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.nextSide,O=0}}return s?m:m.getBindedInter()}}function Eb(e,t,i,r,s,n,a){let o=e.getShape(),l=t.getShape(),h=n?i.getShape().reverse():i.getShape(),c=(o instanceof ye?Pn(o,h.start().angle(o.center)):o instanceof Be?Qe(o,h.start()):o.end().sub(o.start())).normalize(),f=(l instanceof ye?Pn(l,h.start().angle(l.center)):l instanceof Be?Qe(l,h.start()):l.end().sub(l.start())).normalize(),d=c.dot(f);if(la(d,-1)){let u=n?i.getShape().reverse():i.getShape(),p=Qe(u).normalize(),_=c.add(f.scale(-1)).normalize().dot(p),g=ts(o.reverse(),l,a).state;if(_>-.9&&(g===3||g===4))return{state:g===4?0:1,inter:Da(t,i,s,n,!0,!1,r)};let b=Vs(e,i,s,a,ia,Co,r.size===0?new Map:r,n);return b.state===2?b:g===4?b.state===0||b.inter!==s?b:Vs(t,i,s,a,ia,Co,r.size===0?new Map:r,n):b.state===1||b.inter!==s?b:Vs(t,i,s,a,ia,Co,r.size===0?new Map:r,n)}else{let u=c.scale(-1).angle(pe.ORIGIN),p=f.angle(pe.ORIGIN);u>p&&(u-=Ap);let _=(u+p)/2,g=new pe(Math.cos(_),Math.sin(_)),b=Qe(h).normalize(),m=b.angle(pe.ORIGIN),O=u<m&&m<p&&o instanceof oe&&l instanceof oe&&h instanceof oe;if(g.cross(b)<=0){if(c.scale(-1).dot(b)<0){let y;return s.coord.equals1(h.start())?y=Qe(o,s.coord).dot(Qe(h,s.coord))<0:h instanceof oe&&(y=Qe(o,o.end()).dot(h.direct)<0),{state:Ll(e,t,i,!n,a)?1:0,inter:Da(e,i,s,n,!0,y,r)}}return O&&o.distance2(h.start())>is?[t,i,!0,void 0,r]:[e,i,!0,void 0,r]}else return f.dot(b)<=0?{state:Ll(e,t,i,!n,a)?1:0,inter:Da(t,i,s,n,!0,void 0,r)}:O&&l.distance2(h.start())>is?[e,i,!0,void 0,r]:[t,i,!0,void 0,r]}}var pp=0;function VL(e,t,i,r){let s=t.getBindedInter(),n=t.side,a=s.side,o=n.getShape(),l=a.getShape();if(r&&(pp++,pp===-1)){r.initColor(Bt.RED).addPt(o),r.initColor(Bt.Golden).addPt(l),r.draw();debugger}let h=0,c=!1;if(e===-1){let w=Ra(n,n.nextSide,a,s,h,c,r),S=w.state!==0;if(w.state===2){let R=Qe(o,t.coord).add(Qe(n.nextSide.getShape(),t.coord)).normalize(),B=Qe(l,t.coord).add(Qe(a.nextSide.getShape(),t.coord)).normalize();return E(S,R.dot(B)>0)}let C=Ra(n,n.nextSide,a.nextSide,s,h,c,r);return w.state!==C.state?(x(w,C),1):E(S,w.state!==Ra(a,a.nextSide,n,t,h,!0,r).state,w.inter,C.inter)}if(e===1){let w=Vs(n,a,s,r,h,c,new Map),S=w.state!==0;if(w.state===2)return E(S,Qe(o,t.coord).dot(Qe(l,t.coord))>0);let C;if(w.isReversed&&w.existOverlap&&Ve(w.inter.coord,a.getEnd())&&w.inter.getBindedInter().side!==n){let Y=w.inter.getBindedInter().side;if(Y===n.nextSide)C={state:Ll(n,Y,a.nextSide,!0,r)?1:0,inter:s};else if(Y===n.prevSide){if(C={state:Ll(Y,n,a.nextSide,!0,r)?1:0,inter:w.inter},w.state===C.state&&t!==w.inter){let G=Qe(l,t.coord),z=Qe(a.nextSide.getShape(),t.coord),q=Qe(Y.getShape(),t.coord);return E(S,G.add(z).dot(q)>0,w.inter,C.inter)}}else C=Vs(n,a.nextSide,s,r,h,c,new Map)}else C=Vs(n,a.nextSide,s,r,h,c,new Map);if(w.state!==C.state)return x(w,C),1;let R=Qe(l,t.coord),B=Qe(a.nextSide.getShape(),t.coord);if(la(R.dot(B),-1)){let Y=mr(a,a.nextSide,!0,r);return E(S,w.state!==Vs(a.nextSide,n,t,r,h,!0,new Map,Y?!S:S,!1).state,w.inter,C.inter)}else{let Y=Qe(o,t.coord);return E(S,R.add(B).dot(Y)>0,w.inter,C.inter)}}if(!(o instanceof Be||l instanceof Be))return 1;let f=Qe(o,t.coord),d=Qe(l,t.coord),u,p;if(l instanceof oe)u=new oe(t.coord,l.start()),p=new oe(t.coord,l.end());else if(l instanceof ye){let w=t.coord.angleD(l.center);u=ye.build2(l.center,w,l.startAngle,l.rx,l.ry,l.isCCW?0:1),p=ye.build2(l.center,w,l.endAngle(),l.rx,l.ry,l.isCCW?1:0)}else if(l instanceof Be){let w=l.getPercent(t.coord,et);[u,p]=l.clip(w),u=u.reverse()}else throw new Error("not support");let _=f.dot(d)>0,g,b;_?(g=ts(o.reverse(),u).state,b=ts(o,p).state):(g=ts(o,u).state,b=ts(o.reverse(),p).state);let m;g===0?m=Vs(_?n.prevSide:n.nextSide,a,s,r,h,c,new Map,!0,!1,_):g===1?m=Vs(n,a.prevSide,s,r,h,c,new Map,!0,!0,_):g===2?_?m=Ra(n.prevSide,n,a.prevSide,s,h,c,r,!0):m=Ra(n,n.nextSide,a.prevSide,s,h,c,r,!0):_?g===3?m={inter:s,state:0}:m={inter:s,state:1}:g===3?m={inter:s,state:1}:m={inter:s,state:0};let O=m.state!==0;if(m.state===2)return E(O,_);let y;if(b===0?y=Vs(_?n.nextSide:n.prevSide,a,s,r,h,c,new Map,!1,!1,!_):b===1?y=Vs(n,a.nextSide,s,r,h,c,new Map,!1,!0,!_):b===2?_?y=Ra(n,n.nextSide,a.nextSide,s,h,c,r,!1):y=Ra(n.prevSide,n,a.nextSide,s,h,c,r,!1):_?b===3?y={inter:s,state:1}:y={inter:s,state:0}:b===3?y={inter:s,state:0}:y={inter:s,state:1},m.state===y.state)return m.inter===y.inter?(t.setIsInvalid(),0):E(O,_,m.inter,y.inter);return x(m,y),1;function x(w,S){let C=w.state!==0;if(w.inter===S.inter){t.setOutToIn(C);return}else mh(w.inter,S.inter,!0),mh(S.inter,w.inter,!1);let R=[];if(e===-1){let Y=Qe(o,t.coord),G=Qe(n.nextSide.getShape(),t.coord),z=Qe(l,t.coord),q=Qe(a.nextSide.getShape(),t.coord);R.push(Y.dot(z)),R.push(Y.dot(q)),R.push(G.dot(z)),R.push(G.dot(q))}else{let Y=Qe(o,t.coord);R.push(Qe(l,t.coord).dot(Y)),R.push(Qe(a.nextSide.getShape(),t.coord).dot(Y))}if(R.reduce((Y,G)=>Math.abs(Y)>Math.abs(G)?Y:G,0)>0)if(i===1||i===0||i===2||i===3)t.setOutToIn(C);else throw new Error("not support");else if(i===1)B(!C);else if(i===0||i===2||i===3)B(C);else throw new Error("not support");function B(Y){t.setIsInvalid();let G=(Y?w:S).inter;delete G.isInvalid,delete G.getBindedInter().isInvalid,G.setOutToIn(!C)}}function E(w,S,C,R){if(C===R){if(t.side.outline.inters.find(G=>!G.isInvalid&&G!==t&&Ve(G.coord,t.coord)))return t.setIsInvalid(),0;let B=new Ma(t.coord,n,r),Y=new Ma(t.coord,a,r);return B.bind(Y),S?n.inters.splice(t.getIndex(),0,B):n.inters.splice(t.getIndex()+1,0,B),a.inters.splice(t.getBindedInter().getIndex(),0,Y),B.setOutToIn(w),t.setOutToIn(!w),B.isDealed(),n.inters.forEach((G,z)=>G.setIndex(z)),a.inters.forEach((G,z)=>G.setIndex(z)),2}else{let B=function(){let Y=C.getBindedInter(),G=R.getBindedInter();delete C.isInvalid,delete Y.isInvalid,delete R.isInvalid,delete G.isInvalid,C.setOutToIn(!w),R.setOutToIn(w),mh(C,R,!0),mh(R,C,!1),mh(Y,G,S),mh(G,Y,!S)};if(t.setIsInvalid(),S){if(i===1||i===0||i===2||i===3)return B(),2;throw new Error("not support")}else{if(i===1)return w?0:(B(),2);if(i===0||i===2||i===3)return w?(B(),2):0;throw new Error("not support")}}}}function mh(e,t,i){let{judge:r,changeNum:s}=a(),n=e.getIndex();for(let o=n+s,l=e.side.inters;r(o);o+=s){if(l[o].isInvalid)continue;if(!Ve(l[o].coord,e.coord))break;l[o].setIndex(n),l[n].setIndex(o);let h=l[o];l[o]=l[n],l[n]=h,n=o}function a(){let o=e.side===t.side;if(i){let l=o?t.getIndex():e.side.inters.length;return{judge:h=>h<l,changeNum:1}}else{let l=o?t.getIndex()+1:0;return{judge:h=>h>=l,changeNum:-1}}}}var x2=0,Ma=class{constructor(e,t,i){this.id=x2++,this.coord=e,this.side=t,i&&(this.id=x2++,this.drawDebug=i);let r=new Ss;r.ext2(e),this._bbox=r.build1()}bbox(){return this._bbox}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(e){this.outToIn=e,this.bindedInter.outToIn=!e}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(e){this.bindedInter=e,e.bindedInter=this}setIndex(e){this.index=e}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let e=this.getIndex(),t=this.side.getStart();return e&&(t=this.side.inters[e-1].coord),t}getTangent(){let e=this.side.getShape();if(e instanceof oe)return e.end().sub(e.start());if(e instanceof ye){let t=this.coord.angle(e.center);return e.isCCW?t+=op:t-=op,new pe(Math.cos(t),Math.sin(t))}else{if(e instanceof Be)return Su(e,e.getPercent(this.coord,et));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let e=[],t=this,i;if(this.drawDebug){EO++;let r=EO===-1,s=this.drawDebug.initColor(Bt.RED);if(r){this.drawDebug.draw();debugger}i=n=>{if(e.push(n),r){s.addPt(e[e.length-1]),this.drawDebug.draw();debugger}}}else i=r=>e.push(r);for(;!t.visited;){let r=function(o,l){if(Te.eq(o.distance2(l),0))return;let h=Fu.rebuild(n.getShape(),o,l);if(!h)return!0;i(h)};t.visit();let s=t.getIndex(),n=t.side,a=n.inters[s+1];for(;a!=null&&a.isInvalid;)a=n.inters[a.getIndex()+1];if(a)r(t.coord,a.coord),t=a.bindedInter;else{let o=r(t.coord,n.getEnd()),l=t.coord;for(n=n.nextSide,t=null;;){for(let h of n.inters)if(!h.isInvalid){t=h.bindedInter;break}if(t)break;o?(r(l,n.getEnd()),o=!1):i(n.getShape()),n=n.nextSide}o?(Te.eq(l.distance2(t.coord),0)?r(l,n.getEnd()):r(l,t.coord),o=!1):Te.eq(n.getEnd().distance2(t.coord),0)?i(n.getShape()):r(n.getStart(),t.coord)}}if(t!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:EO,handleId:pp,boolId:_u})),new Error("inter !== this");return Do(bt.build7(e))}},EO=0,TO=class qO{constructor(t,i,r,s,n){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=t,this.isGroup1=r,this.isOutside=s,this.finalIsOutside=s,this.polyline=i,n&&(this.polygon=n),t.forEach(a=>a.outline=this)}static build(t,i,r,s,n){let a=t.primitives.map(l=>new Fu(l,s)),o=a[a.length-1];return a.forEach(l=>{o.connect(l),o=l}),n?new qO(a,t,i,r,n):new qO(a,t,i,r)}setFinalIsOutSide(t){this.finalIsOutside=t}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(t,i){if(!(t.interOutlines&&t.interOutlines===this.interOutlines))if(t.interOutlines)if(this.interOutlines){let r,s;this.interOutlines.length>t.interOutlines.length?(r=this.interOutlines,s=t.interOutlines):(r=t.interOutlines,s=this.interOutlines),s.forEach(n=>{r.push(n),n.interOutlines=r}),i.delete(s)}else t.interOutlines.push(this),this.interOutlines=t.interOutlines;else this.interOutlines?(this.interOutlines.push(t),t.interOutlines=this.interOutlines):(t.interOutlines=this.interOutlines=[this,t],i.add(this.interOutlines))}isContain(t){if(!this.polyline.bbox().extendOfSize(et).isContainsBBox(t.polyline.bbox()))return!1;let i=t.polyline.primitives[0].start();if(t.hasInter&&t.isAllInterIsInvalid()){let r=t.inters[0];r.getBindedInter().side.outline!==this?i=r.side.getCenterPoint():i=r.side.getCenterPoint(r.coord)}return!!this.polyline.getWindingNum(i)}isInternally(t){return!!this.polyline.getWindingNum(t)}isEqual(t){return this.polyline===t.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let t=this.sides[this.sides.length-1];this.sides.forEach(i=>{i.reverse(),t.connect(i),t=i})}returnPolyline(){let t=this.sides.map(r=>r.getShape()),i=this.polyline.primitives;if(this.sides.length===i.length){let r=new Set(i);if(!t.some(s=>!r.has(s)))return this.polyline}return bt.build7(t)}};function v2(e,t,i){let r=[];return e.forEach(s=>s.forEach(n=>{if(n.hasInter&&!n.isAllInterIsInvalid())return;let a=n.bbox(),o=t.search(a.extendOfSize(et)).filter(l=>l.bbox().extendOfSize(et).isContainsBBox(a)).sort((l,h)=>l.bbox().area()-h.bbox().area());for(let l of o)if(l.isContain(n)){let h=i(!n.isOutside,l.isOutside),c=i(n.isOutside,l.isOutside);h!==c&&(r.push(n),n.setFinalIsOutSide(!h));return}i(n.isOutside,!1)!==i(!n.isOutside,!1)&&r.push(n)})),r}function qL(e,t,i){let r;switch(i){case 0:r=(o,l)=>o&&l;break;case 1:r=(o,l)=>o||l;break;case 2:r=(o,l)=>o&&!l;break;case 3:r=(o,l)=>o&&!l||!o&&l;break;default:throw Error("not support the rule")}let s=new Iu(10),n=new Iu(10);e.forEach(o=>o.forEach(l=>s.add(l))),t.forEach(o=>o.forEach(l=>n.add(l)));let a=v2(e,n,r);return v2(t,s,(o,l)=>r(l,o)).forEach(o=>a.push(o)),a}var XL=class{constructor(e){this.roots=[],this.nodes=e.sort((t,i)=>t.bbox().minX-i.bbox().minX).map(t=>new WL(t)),this.nodes.forEach((t,i)=>{t.visit()&&(this.roots.push(t),this.build(i))})}build(e){let t=this.nodes[e];for(let i=e+1,r=this.nodes.length;i<r;i++){let s=this.nodes[i];if(t.key.bbox().maxX<s.key.bbox().minX)break;s.getIsVisit()||t.isContain(s)&&(s.visit(),t.addChild(s),this.build(i))}}getPolygons(){let e=[];return this.roots.forEach(t=>t.getPolygons().forEach(i=>e.push(i))),e}},WL=class{constructor(e){this.children=[],this.isVisit=!1,this.key=e}getIsVisit(){return this.isVisit}isContain(e){return this.key.isContain(e.key)}addChild(e){this.children.push(e)}getPolygons(){let e=[];return this.getPolylineList(e),e.map(t=>{let i=t[0].polygon;if(i&&i.items.length===t.length){let r=t.map(n=>n.returnPolyline()),s=new Set(i.items);return r.some(n=>!s.has(n))?new ir(r):i}else return new ir(t.map(r=>r.returnPolyline()))})}getPolylineList(e,t){t?(t.push(this.key),t=null):(t=[this.key],e.push(t)),this.children.forEach(i=>i.getPolylineList(e,t))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function E2(e){let t="";return e.items.forEach((i,r)=>{let s="$";if(i.items.forEach((n,a)=>{let o="[";if(n.primitives.forEach((l,h)=>{let c="";if(l instanceof oe)c=`Line,${l.start().x},${l.start().y},${l.end().x},${l.end().y}`;else if(l instanceof ye)c=`Arc,${l.center.x},${l.center.y},${l.startAngle},${l.sweepAngle},${l.rx}`;else if(l instanceof Be)c=`Bezier,${l.controls.map(f=>`${f.x},${f.y}`).join(",")}`;else throw new Error("not supported");if(h===n.primitives.length-1){o+=`${c}]`;return}o+=`${c},`}),a===i.items.length-1){s+=`${o}$`;return}s+=`${o}_`}),r===e.items.length-1){t+=`${s}`;return}t+=`${s}^`}),console.log(t),t}function T2(e){let t=e.split("^"),i=[];return t.forEach(s=>{let n=/\$(.*?)\$/,a=s.match(n)[1].split("_"),o=[];a.forEach(h=>{let c=/\[(.*?)\]/,f=h.match(c)[1].split(","),d=[],u=[];for(let _=0;_<f.length;_++){let g=f[_];if(g==="Line"||g==="Arc"||g==="Bezier"){if(d.length){let b=r(d);u.push(b),d.length=0}d.push(g);continue}d.push(Number(g))}d.length&&(u.push(r(d)),d.length=0);let p=bt.build7(u);o.push(p)});let l=new ir(o);i.push(l)}),new Di(i);function r(s){let n=s[0];if(n==="Line")return new oe(new pe(s[1],s[2]),new pe(s[3],s[4]));if(n==="Arc")return ye.build3(new pe(s[1],s[2]),s[3],s[4],s[5],s[5]);if(n==="Bezier"){let a=[];for(let o=1;o<s.length;o+=2)a.push(new pe(s[o],s[o+1]));return new Be(a)}else throw new Error("not support")}}var JL=class{constructor(e=1){this.group1Str="$[Line,20193.777980000017,4122.200439600661,20193.77082,4211.848760073709,Arc,20193.972672902382,4211.8487570980205,179.99915535323618,-89.99540000050294,0.2018529024026465,Line,20193.972659672283,4212.050609999989,20193.972660393258,4212.039610000013,Arc,20193.97217289501,4211.848257065248,89.85403133887164,89.99540000041924,0.19135355574930143,Line,20193.78082,4211.848759926291,20193.78897999998,4122.200440479205,Line,20193.78897999998,4122.200440479205,20193.777980000017,4122.200439600661]$",this.group2Str="$[Arc,20209.72784128151,4122.2007625157785,258.46768032837986,-75.66780748375947,4.138846238512183,Line,20205.593935808283,4121.998590004101,20193.97982992629,4121.998600000001,Arc,20193.97983290198,4122.2004529023825,269.9991553532362,-89.99540000050297,0.20185290240401074,Arc,20193.782979999996,4122.20044,180.00375535340328,-180.0000000000027,0.004999999999025513,Arc,20193.979332869207,4122.200952909754,180.15347936671733,89.99540000008247,0.19135355575111057,Line,20193.97983008845,4122.009599999999,20205.603694309226,4122.003828485546,Arc,20209.733142304296,4122.194577876843,182.64475341258483,75.73379999998886,4.133851239977064,Line,20208.900400396684,4118.145470939558,20208.902599535475,4118.156248870184,Arc,20206.972515961093,4108.700057667588,78.46393309088245,-78.46759999998636,9.65115405866796,Arc,20216.618669999996,4108.69944,359.99996825446135,-180,0.004999999999200412,Arc,20206.973015966745,4108.699445349495,359.99996822365375,78.46759999998409,9.640654033253735]$^$[Line,20193.997796883676,4095.399470032799,20205.596133314026,4095.4013992171836,Arc,20209.72470159858,4095.1923799234505,177.10172964919312,-75.64935037184974,4.133855965730166,Arc,20209.73000213952,4095.198565517174,101.5415133143569,75.7293000000185,4.128850963459707,Line,20205.605834328744,4095.395161923586,20193.997203529463,4095.389485743675,Arc,20193.994588809255,4095.197684525904,89.21896662213764,4.544099999999517,0.19181903946188483,Arc,20193.981499796217,4095.1977402038,89.85034659953621,89.9999999995926,0.19135044893494071,Arc,20193.78515,4095.19824,0,-180,0.005,Arc,20193.98200016982,4095.1982398301675,179.99995179248322,-89.99999999974185,0.20185016982129908,Arc,20193.981986624152,4095.198185381971,89.9961078637802,-4.487285276547311,0.2019046184835962]$",this.rule=e}getGroup1(){return T2(this.group1Str)}getGroup2(){return T2(this.group2Str)}},wO=new Pp(2),pu=class{getUnion(e,t=!0){return t&&(e=e.map(i=>this.asSameSweep([i])[0])),LL(fL,e)}asSameSweep(e){let t=0;return e.forEach(i=>t+=i.area(.01)),t>0?e.map(i=>i.reverse()):e}getSubtraction(e,t){let i=new Eu(!1),r=new Tu(qf.rule,wO,i);for(let s of e){let n=qf.weight(0);r.addPolyline(s,n)}for(let s of t){let n=qf.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}getIntersection(e,t){let i=new Eu(!1),r=new Tu(Xf.rule,wO,i);for(let s of e){let n=Xf.weight(0);r.addPolyline(s,n)}for(let s of t){let n=Xf.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}getMutuallyExclusive(e,t){let i=new Eu(!1),r=new Tu(Wf.rule,wO,i);for(let s of e){let n=Wf.weight(0);r.addPolyline(s,n)}for(let s of t){let n=Wf.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}},_u=0,SO=!1;function gu(e,t,i,r,s){let n=Gu(),a=[],o=[],l=[],h=new Set,c;if(s){if(c=new Uu(s),_u++,SO){debugger;SO=!1;let y=new JL;gu(y.rule,y.getGroup1(),y.getGroup2(),r,s)}if(_u===-1||SO){console.table({rule:e,group1:E2(t),group2:E2(i)}),c.clear();let y=c.initColor(Bt.GREEN),x=c.initColor(Bt.WHITE),E=c.initColor(Bt.BLUE),w=c.initColor(Bt.Gray);t.items.forEach(S=>S.items.forEach((C,R)=>{R>0?x.addPly(C):y.addPly(C)})),i.items.forEach(S=>S.items.forEach((C,R)=>{R>0?w.addPly(C):E.addPly(C)})),c.draw();debugger}}let f=t.items.length!==0&&i.items.length!==0?t.bbox().extendOfSize(et).intersection1(i.bbox().extendOfSize(et)):null;if(f){let y=[],x=[];switch(e){case 0:{for(let E of t.items)E.bbox().isIntersect(f)&&y.push(E);for(let E of i.items)E.bbox().isIntersect(f)&&x.push(E);break}case 1:case 3:{for(let E of t.items)E.bbox().isIntersect(f)?y.push(E):a.push(E);for(let E of i.items)E.bbox().isIntersect(f)?x.push(E):a.push(E);break}case 2:{for(let E of t.items)E.bbox().isIntersect(f)?y.push(E):a.push(E);for(let E of i.items)E.bbox().isIntersect(f)&&x.push(E);break}default:throw new Error("not support")}y.length!==t.items.length&&(t=new Di(y)),x.length!==i.items.length&&(i=new Di(x))}else{switch(e){case 0:break;case 1:case 3:{t.items.forEach(y=>a.push(y)),i.items.forEach(y=>a.push(y));break}case 2:{t.items.forEach(y=>a.push(y));break}default:throw new Error("not support")}t=new Di([]),i=new Di([])}m(t,o,!0),m(i,l,!1);let d=e===2||e===3?(y,x)=>Ve(y.getEnd(),x)?y.nextSide:y:(y,x)=>Ve(y.prevSide.getEnd(),x)?y.prevSide:y,u=(y,x,E)=>{if(Ve(y.getEnd(),E)){if(y.inters.findIndex(w=>w.getBindedInter().side===x&&Ve(w.coord,y.getEnd()))===-1)return new Ma(E,y,c)}else return new Ma(E,y,c)},p=e===2||e===3?(y,x,E)=>{if(Ve(y.getStart(),E)){if(y.inters.findIndex(w=>w.getBindedInter().side===x&&Ve(w.coord,y.getStart()))===-1)return new Ma(E,y,c)}else return new Ma(E,y,c)}:u;r.seek(t,i,(y,x,E,w,S,C)=>{let R=o[y][x],B=l[w][S],Y=R.sides[E],G=B.sides[C],z=ln(Y.getShape(),G.getShape());if((Y.getShape()instanceof Be||G.getShape()instanceof Be)&&z>=4){if(Y.getShape()instanceof ye||G.getShape()instanceof ye){let L=function(v,P){let I=!1;for(let N=0;N<P.length;N+=2)Ve(new pe(P[N],P[N+1]),v)&&(I=!0);I||P.push(v.x,v.y)},M=[te[0],te[1]];for(let v=0;v<z;v+=2){let P=new pe(te[v],te[v+1]);for(let I=v+2;I<z;I+=2){let N=new pe(te[I],te[I+1]);if(!Ve(P,N)){L(N,M);break}}}z=M.length,M.forEach((v,P)=>te[P]=v)}else for(let L=z-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(Ve(new pe(te[L],te[L+1]),new pe(te[M],te[M+1]))){te[M]=(te[L]+te[M])/2,te[M+1]=(te[L+1]+te[M+1])/2;for(let v=z-3;v>=L;v--)te[v]=te[v+2];z-=2;break}}let q=0;if(z===4){let L=function(P){return Ve(Y.getEnd(),P)||Ve(Y.prevSide.getEnd(),P)||Ve(G.prevSide.getEnd(),P)||Ve(G.getEnd(),P)},M=new pe(te[0],te[1]),v=()=>{let P=new Ma(M,Y,c),I=new Ma(M,G,c);P.bind(I),P.setIsInvalid(),P.isDealed(),R.inters.push(P),B.inters.push(I)};if(te[0]===te[2]&&te[1]===te[3])if(L(M))q=2;else{v();return}}for(;q<z;q+=2){let L=new pe(te[q],te[q+1]),M=Y,v=G;if(Ve(M.prevSide.getEnd(),L)&&(M=M.prevSide),v=d(v,L),Y!==M&&G!==v){let I=e===2||e===3?G.getEnd():v.getEnd();M.getEnd().distance1(L)<I.distance1(L)?(L=M.getEnd(),Ve(I,L)||(v=G)):(L=I,Ve(M.getEnd(),L)||(M=Y))}let P=u(M,v,L);if(P){let I=p(v,M,L);I&&(M.addInter(P),R.inters.push(P),v.addInter(I),B.inters.push(I),P.bind(I),R.intersect(B,h))}}return z},s);let _=O(),g=qL(o,l,e);g.forEach(y=>!y.startAndEndIsSameOutsideFlag()&&y.reverse()),new XL(_.concat(g)).getPolygons().forEach(y=>a.push(y));let b=new Di(a);if(c){if(_u===-1){let y=c.initColor(Bt.RED),x=c.initColor(Bt.Golden);a.forEach(E=>{y.addPly(E.items[0]),E.items.slice(1).forEach(w=>x.addPly(w))}),c.draw();debugger;throw new Error}b.id=_u}return na.BooleanTools+=Po(n),b;function m(y,x,E){y.items.forEach(w=>{let S=[];S.push(TO.build(w.items[0],E,!0,c,w)),w.items.slice(1).forEach(C=>{S.push(TO.build(C,E,!1,c))}),x.push(S)})}function O(){let y=[];return h.forEach(E=>{e===2||e===3?E.forEach(S=>{S.isGroup1||S.reverse(),S.sides.forEach(C=>C.sortInters())}):E.forEach(S=>S.sides.forEach(C=>C.sortInters())),E.map(S=>S.sides.filter(C=>C.inters.length)).flat(2).sort((S,C)=>{let R=S.inters,B=C.inters,Y=Ve(R[R.length-1].coord,S.getEnd()),G=Ve(B[B.length-1].coord,C.getEnd());if(Y&&G){let z=0,q=0;for(let L=R.length-2;L>=0&&Ve(R[L].coord,S.getEnd());L--)z++;for(let L=B.length-2;L>=0&&Ve(B[L].coord,C.getEnd());L--)q++;return q-z}else return Y?-1:1}).forEach(S=>{S.inters.forEach(C=>{if(C.dealed)return;let R=C.side,B=C.getBindedInter().side,Y;Ve(R.getEnd(),C.coord)&&Ve(B.getEnd(),C.coord)?Y=-1:Ve(R.getEnd(),C.coord)?(Y=1,C=C.getBindedInter()):Ve(B.getEnd(),C.coord)&&(Y=1);let G=VL(Y,C,e,c);C.isDealed(),G&&(R.outline.setAllInterIsInvalidToFalse(),B.outline.setAllInterIsInvalidToFalse())})}),w(E),e===3&&(E.forEach(S=>{S.reverse(),S.sides.forEach(C=>{C.sortInters(),C.inters.forEach(R=>{R.resetVisitStatus()})})}),w(E));function w(S){S.forEach(C=>{C.inters.forEach(R=>{if(R.isInvalid||R.getVisited())return;let B=R.findStartInter(),Y=x(e)?B.run():B.getBindedInter().run(),G=C.polyline.primitives;if(Y){if(G.length===Y.primitives.length){let z=new Set(G);if(!Y.primitives.some(q=>!z.has(q))){y.push(C);return}}y.push(TO.build(Y,!0,!0,c))}})})}}),y;function x(E){switch(E){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var Mf=/\bstablilizetion\b/.test(self.location.href)||!0,ou={intersect(e,t,i,r){try{return gu(0,e,t,i,r)}catch(s){if(Mf){let n=new pu().getIntersection(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Di(n.map(a=>new ir(a.items)))}throw s}},union(e,t,i,r){try{return gu(1,e,t,i,r)}catch(s){if(Mf){let n=new pu,a=e.items.map(l=>l.items.map(h=>h)).flat(2);t.items.forEach(l=>l.items.forEach(h=>a.push(h)));let o=n.getUnion(a);return new Di(o.map(l=>new ir(l.items)))}throw s}},diff(e,t,i,r){try{return gu(2,e,t,i,r)}catch(s){if(Mf){let n=new pu().getSubtraction(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Di(n.map(a=>new ir(a.items)))}throw s}},xor(e,t,i,r){try{return gu(3,e,t,i,r)}catch(s){if(Mf){let n=new pu().getMutuallyExclusive(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new Di(n.map(a=>new ir(a.items)))}throw s}}},ZL=class extends Tu{constructor(e,t,i,r,s,n){super(e.rule,Pp.DUMMY,t),this.sideGroup1=[],this.sideGroup2=[],this.group1=i,this.group2=r,this.seeker=s,this.addGroup(i,e.weight(0),this.sideGroup1),this.addGroup(r,e.weight(1),this.sideGroup2),this.bus=n}addGroup(e,t,i){if(!e)debugger;e.items.forEach(r=>{let s=[];r.items.forEach(n=>{let a=this.sides.length;this.addPolyline(n,t),s.push(this.sides.slice(a))}),i.push(s)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(e,t,i,r,s,n)=>{let a=this.sideGroup1[e][t][i],o=this.sideGroup2[r][s][n],l=ln(a.shape,o.shape);for(let h=0;h<l;h+=2){let c=new pe(te[h],te[h+1]);a.inters.push(c),o.inters.push(c),this.event.onIntersect(c,a,o)}return l},this.bus)}},KL=class extends Eu{constructor(e){super(!!e),e&&(this.drawDebug=new Uu(e),this.blueDrawing=this.drawDebug.initColor(Bt.BLUE),this.greenDrawing=this.drawDebug.initColor(Bt.GREEN),this.redDrawing=this.drawDebug.initColor(Bt.RED))}onOriginSide(e){super.onOriginSide(e),this.debug&&this.blueDrawing.addPt(e.shape)}onPolylineGroup(e,t){super.onPolylineGroup(e,t),this.debug&&e.items.forEach(i=>this.greenDrawing.addPly(i))}draw(){this.drawDebug.draw()}};function Bf(e,t,i,r,s){let n=Gu(),a=new KL(s);new ZL(e,a,t,i,r,s).simplify();let o=[];a.plGrps.forEach(h=>{let c=h.items.map(f=>fp(f));c[0]&&o.push(new ir(c.filter(f=>f)))});let l=new Di(o);return na.BooleanTools+=Po(n),l}var kf=!0,lu={intersect(e,t,i,r){try{return ou.intersect(e,t,i,r)}catch(s){if(kf)throw s;return console.error(s),Bf(Xf,e,t,i,r)}},union(e,t,i,r){try{return ou.union(e,t,i,r)}catch(s){if(kf)throw s;return console.error(s),Bf(pL,e,t,i,r)}},diff(e,t,i,r){try{return ou.diff(e,t,i,r)}catch(s){if(kf)throw s;return console.error(s),Bf(qf,e,t,i,r)}},xor(e,t,i,r){return ou.xor(e,t,i,r)}};var $L=class{init(e){}seek(e,t,i,r){let s=e.bbox().extendOfSize(5e-6).intersection1(t.bbox().extendOfSize(5e-6));if(!s)return;let n=Gu(),a=[];for(let d=0,u=e.items.length;d<u;d++){let p=e.items[d];if(s.isIntersect(p.bbox()))for(let _=0,g=p.items.length;_<g;_++){let b=p.items[_];if(s.isIntersect(b.bbox()))for(let m=0,O=b.primitives.length;m<O;m++){let y=b.primitives[m].bbox();s.isIntersect(y)&&a.push({bbox:y,polygonIndex:d,polylineIndex:_,ptIndex:m})}}}let o=a.length;if(o===0){na.IntersectionSeeker+=Po(n);return}let l=[];for(let d=0,u=t.items.length;d<u;d++){let p=t.items[d];if(s.isIntersect(p.bbox()))for(let _=0,g=p.items.length;_<g;_++){let b=p.items[_];if(s.isIntersect(b.bbox()))for(let m=0,O=b.primitives.length;m<O;m++){let y=b.primitives[m].bbox();s.isIntersect(y)&&l.push({bbox:y,polygonIndex:d,polylineIndex:_,ptIndex:m})}}}let h=l.length;if(h===0){na.IntersectionSeeker+=Po(n);return}if(o<5||h<5){for(let d=0,u=a.length;d<u;d++)for(let p=0,_=l.length;p<_;p++)if(a[d].bbox.isIntersect(l[p].bbox.extendOfSize(1e-5))){let g=a[d],b=l[p];i(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}na.IntersectionSeeker+=Po(n);return}a.sort((d,u)=>d.bbox.minX-u.bbox.minX),l.sort((d,u)=>d.bbox.minX-u.bbox.minX);let c=0,f=0;for(;c<o&&f<h;)if(a[c].bbox.minX<l[f].bbox.minX){let d=a[c],u=d.bbox;for(let p=f;p<h;p++){let _=l[p],g=_.bbox;if(g.minX>u.maxX+1e-5)break;(u.minY<g.minY?g.minY:u.minY)<(u.maxY<g.maxY?u.maxY:g.maxY)+1e-5&&i(d.polygonIndex,d.polylineIndex,d.ptIndex,_.polygonIndex,_.polylineIndex,_.ptIndex)}c++}else{let d=l[f],u=d.bbox;for(let p=c;p<o;p++){let _=a[p],g=_.bbox;if(g.minX>u.maxX+1e-5)break;(g.minY<u.minY?u.minY:g.minY)<(g.maxY<u.maxY?g.maxY:u.maxY)+1e-5&&i(_.polygonIndex,_.polylineIndex,_.ptIndex,d.polygonIndex,d.polylineIndex,d.ptIndex)}f++}na.IntersectionSeeker+=Po(n)}},Ar,zr=(Ar=class{static getDebug(){return Ar.drawDebug||(Ar.drawDebug=new Uu(Ar.curBus)),Ar.drawDebug}static getDrawing(t=Bt.GREEN){return this.getDebug().initColor(t)}static clearDrawing(){Ar.getDebug().clear()}static drawText(t,i,r=Bt.GREEN){Ar.getDrawing(r).addText(t,i,1.5,.1,!0)}static drawBBox(t,i=Bt.GREEN){if(!t)return;let r=Ar.getDrawing(i),s=new oe(t.UL(),t.UR()),n=new oe(t.UR(),t.LR()),a=new oe(t.LR(),t.LL()),o=new oe(t.LL(),t.UL());r.addPt(s),r.addPt(n),r.addPt(a),r.addPt(o)}static drawPolyType(t,i){let r=Ar.getDrawing(i);if(t instanceof bt)r.addPly(t);else if(t instanceof ir)for(let s of t.items)s instanceof bt?r.addPly(s):this.drawPolyType(s,i);else if(t instanceof Di)for(let s of t.items)this.drawPolyType(s,i)}static translate(t){switch(t){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}},Ar.UseRunArrange=!0,Ar.UseOptimizeSplit=!0,Ar.LocalBestThread=4,Ar.HandleDiff=!0,Ar.OcTreeSplitStep=4,Ar.PrintStart=new pe(150,-200),Ar),hu=class XO{static getPolyTypeLine(t){let i=[];if(t instanceof bt)for(let r of t.primitives)i.push(r);else if(t instanceof ir)for(let r of t.items)if(r instanceof bt)for(let s of r.primitives)i.push(s);else{let s=this.getPolyTypeLine(r);for(let n of s)i.push(n)}else if(t instanceof Di)for(let r of t.items){let s=this.getPolyTypeLine(r);for(let n of s)i.push(n)}return i}static getPolyTypePolyLine(t){let i=[];if(t instanceof bt)i.push(t);else if(t instanceof ir)for(let r of t.items)if(r instanceof bt)i.push(r);else{let s=this.getPolyTypePolyLine(r);for(let n of s)i.push(n)}else if(t instanceof Di)for(let r of t.items){let s=this.getPolyTypePolyLine(r);for(let n of s)i.push(n)}return i}static getListBBox(t){if(t.length<=0)return;let i=new Ss;for(let r of t){let s=XO.getSingleBBox(r);i.ext1(s)}return i.build1()}static getSingleBBox(t){if(t instanceof Array){let i=new Ss,r=XO.getListBBox(t.slice(1));return i.ext1(r),i.build1()}else return t.bbox()}static doDrawRule(t,i=zr.PrintStart){if(t.length<2)return[i,i,i];let r=5,s=10,n=t[0],a=zr.translate(n),o=[],l=i.y,h=i.x,c=i.x;i=i.add(new pe(0,-s));for(let u=1;u<t.length;u++){let p=t[u];if(p instanceof Array){i=i.add(new pe(r,0));let _=this.doDrawRule(p,i);o.push(_[0]),_[1].x<=h&&(h=_[1].x),_[2].x>=c&&(c=_[2].x),i=new pe(_[2].x+r,i.y)}else o.push(i.clone()),i.x<=h&&(h=i.x),i.x>=c&&(c=i.x),zr.drawText(i,p.name),i=i.add(new pe(r,0))}let f=0;for(let u of o)f+=u.x;let d=new pe(f/o.length,i.y+s);zr.drawText(d,"N:"+a);for(let u of o){let p=new oe(u,d),_=new Array;_.push(p);let g=bt.build1(UO(_));zr.drawPolyType(g,Bt.GREEN)}return[d,new pe(h,l),new pe(c,l)]}static drawRule(t,i=zr.PrintStart,r=!1,s){zr.clearDrawing(),this.doDrawRule(t,i),r&&this.doDrawRulePolygon(t,s),zr.getDebug().draw()}static doDrawRulePolygon(t,i){let r=t[0];for(let s=1;s<t.length;s++){let n=t[s];if(n instanceof Array)this.doDrawRulePolygon(n,i);else{let a=i;r===2&&s===1&&(a=Bt.RED),n.name&&zr.drawText(n.bbox().UL(),n.name,a),zr.drawPolyType(n,a)}}}static IsCenterBBoxPointInPolygonType(t,i){let r=t.center();for(let s of i.items)if(s.getOutMostPolyline().getWindingNum(r))return!0;return!1}static KeepBBoxPolygonGroup(t,i){let r=i.bbox().intersection1(t);if(!r)return!1;for(let s of i.items)if(s.bbox().isIntersect(r)){for(let n of s.items)if(n.bbox().isIntersect(r)){for(let a of n.primitives)if(r.isIntersect(a.bbox()))return!0}}return!!this.IsCenterBBoxPointInPolygonType(t,i)}},QL=class Eh{static createNode(t,i,r){let s=t.UL(),n=t.width()/i,a=t.height()/i,o=~~(r/i),l=r-o*i,h=s.x+l*n,c=s.y-(o+1)*a,f=h+n,d=c+a;return new Qr(h,f,c,d)}static ocTreeSplitNode(t,i,r,s,n=2){if(t.length<=r)return t;let a=[],o=n**2,l=new Array(o),h=new Array(o);for(let u=0;u<o;u++)l[u]=new Array(t.length),h[u]=0;let c=i.UL(),f=i.width()/n,d=i.height()/n;for(let u of t){let p=s(u).center(),_=~~((p.x-c.x)/f),g=~~((c.y-p.y)/d)*n+_;try{l[g][h[g]]=u,h[g]+=1}catch{a.push(u)}}for(let u=0;u<l.length;u++){let p=h[u];if(p<=0)continue;let _=l[u].slice(0,p);if(_.length===t.length)return t;let g=Eh.createNode(i,n,u),b=Eh.ocTreeSplitNode(_,g,r,s,n);if(b.length===t.length)return t;a.push(b)}return a}static ocTreeSplitNodeMinIntersect(t,i,r,s){let n=[];if(t.length<=r)return t;let a=3,o=i.LL(),l=i.UR(),h=i.width()/(a+1),c=i.height()/(a+1),f=-(2**32),d=[],u=[];for(let p=1;p<=a;p++)for(let _=1;_<=a;_++){let g=o.x+h*p,b=o.y+c*_,m=[[],[],[],[]],O=new Array(4),y=new Array(4);y[0]=new Qr(o.x,g,b,l.y),y[1]=new Qr(g,l.x,b,l.y),y[2]=new Qr(o.x,g,o.y,b),y[3]=new Qr(g,l.x,o.y,b);for(let S of t){let C=s(S).center(),R=-1,B=-1;C.x===g?R=Math.random()>=.5?1:-1:C.x>g?R=1:C.x<g&&(R=-1),C.y===b?B=Math.random()>=.5?1:-1:C.y>b?B=1:C.y<b&&(B=-1),R===1&&B===1?m[1].push(S):R===1&&B===-1?m[3].push(S):R===-1&&B===-1?m[2].push(S):R===-1&&B===1&&m[0].push(S)}for(let S=0;S<4;S++){let C=m[S];if(C.length<=0)continue;let R=new Ss;for(let B of C)R.ext1(s(B));O[S]=R.build1()}let x=0,E=0;for(let S of O)S&&(x+=S.area());E=x;let w=(S,C)=>{if(!O[S]||!O[C])return 0;let R=O[S].intersection1(O[C]);return R?R.area():0};E-=w(0,1),E-=w(0,2),E-=w(0,3),E-=w(1,2),E-=w(1,3),E-=w(2,3),E/x>=f&&(d=m,u=y)}for(let p=0;p<d.length;p++){let _=d[p];if(_.length<=0)continue;let g=u[p],b;if(_.length===t.length?b=Eh.ocTreeSplitNode(_,g,r,s):b=Eh.ocTreeSplitNodeMinIntersect(_,g,r,s),b.length===t.length)return t;n.push(b)}return n}static ocTreeSplit(t,i,r,s){return Eh.ocTreeSplitNode(t,i,r,s,zr.OcTreeSplitStep)}},eR=class Tb{static simplifyRules(t,i){return zr.UseOptimizeSplit&&(t=this.optimizeSplit(t,i)),t}static OcTreeOptimizeSplit(t){let i=t[0];if(i!==1||t.length<=zr.LocalBestThread+1)return t;let r=t.slice(1),s=new Array(r.length);for(let h=1;h<t.length;h++)s[h-1]=h;let n=hu.getListBBox(r),a=QL.ocTreeSplit(s,n,zr.LocalBestThread,h=>{let c=t[h];return hu.getSingleBBox(c)}),o=(h,c)=>{if(!(h.length<=0))for(let f of h)if(Array.isArray(f)){let d=[c[0]];o(f,d),c.push(d)}else{let d=t[f];c.push(d)}},l=[i];return o(a,l),l}static optimizeSplit(t,i){let r=t[0];if(r===2){if(zr.HandleDiff){let n=t[1],a;if(Array.isArray(n)){let o=this.optimizeSplit(n,i);if(o.length<=1)return[2];a=WO(o,i)}else a=WO([2,n],i);if(t.length>3){let o;o=[1];for(let l=2;l<t.length;l++){let h=t[l];if(Array.isArray(h)){let c=hu.getListBBox([...h.slice(1)]);hu.KeepBBoxPolygonGroup(c,a)&&o.push(h)}else hu.KeepBBoxPolygonGroup(h.bbox(),a)&&o.push(h)}return o.length<=1?[2,a]:(o=this.optimizeSplit(o,i),o.length>1?[2,a,...o.slice(1)]:[2,a])}else{let o=t[2];if(Array.isArray(o)&&o[0]===1&&o.length>2){let l=o.slice(1);return this.optimizeSplit([2,a,...l],i)}}}else if(t.slice(1).length>2){let n=t[1],a=t.slice(2),o=this.optimizeSplit([1,...a],i);return o.length>1?[2,n,...o.slice(1)]:n}}else if(r===1){if(t.length-1>zr.LocalBestThread){let n=!1;for(let a=1;a<t.length;a++){let o=t[a];if(!Array.isArray(o)){n=!0;break}}n&&(t=Tb.OcTreeOptimizeSplit(t))}}else if(r===0&&t.length<=2)return[0];let s=[r];for(let n=1;n<t.length;n++){let a=t[n];if(Array.isArray(a)){let o=this.optimizeSplit(a,i);if(o.length<=1)continue;s.push(o)}else s.push(a)}return s}},tR=(e=>(e[e.INTERSECT=0]="INTERSECT",e[e.UNION=1]="UNION",e[e.DIFF=2]="DIFF",e[e.XOR=3]="XOR",e))(tR||{});function Ou(e){let t=e[0],i=[t];switch(t){case 0:for(let s=1;s<e.length;s++){let n=e[s];if(Array.isArray(n)&&(n=Ou(n),!n))return null;i.push(n)}break;case 1:case 3:for(let s=1;s<e.length;s++){let n=e[s];Array.isArray(n)&&(n=Ou(n),!n)||i.push(n)}break;case 2:let r=e[1];if(Array.isArray(r)&&(r=Ou(r)),!r)return null;i.push(r);for(let s=2;s<e.length;s++){let n=e[s];Array.isArray(n)&&(n=Ou(n),!n)||i.push(n)}break;default:throw new Error("not support boolean rule!")}return i.length===1?null:i}function IO(e,t,i){return Array.isArray(e)?wb(e,t,i):e}function PO(e,t,i,r,s=!0){if(s)for(;e.length>1;){let n,a=[];for(e.length%2===1?(a.push(e[0]),n=1):n=0;n<e.length;n+=2)a.push(t(e[n],e[n+1],i,r));e=a}else for(;e.length>1;){if(e.length===2)return t(e[0],e[1],i,r);e=[t(e[0],e[1],i,r),...e.slice(2)]}return e[0]}function wb(e,t,i,r=!0){let s=new Array(e.length-1);for(let n=1;n<e.length;n++)s[n-1]=IO(e[n],t,i);switch(e[0]){case 0:return PO(s,lu.intersect,t,i);case 1:return PO(s,lu.union,t,i);case 2:let n=PO(s.slice(1),lu.union,t,i);return n?lu.diff(s[0],n,t,i):s[0];case 3:let a=IO(e[1],t,i);for(let o=2;o<e.length;o++)a=lu.xor(a,IO(e[o],t,i),t,i);return a;default:throw new Error("not support boolean rule! "+e[0])}}function Sb(e){let t=[e[0]];for(let i=1;i<e.length;i++){let r=e[i];if(Array.isArray(r)){let s=Sb(r);Array.isArray(s)?s.length>1&&t.push(s):t.push(s)}else{let s=fp(r);s!==null&&t.push(Di.build(s))}}return t}function iR(e,t){zr.curBus=t,e=Sb(e);let i;return zr.UseRunArrange?i=eR.simplifyRules(e,t):i=Ou(e),i.length<=1?new Di([]):WO(i,t)}function WO(e,t,i=!0){if(!e||e.length===1)return new Di([]);let r=e,s=new $L,n=[];function a(o){for(let l=1;l<o.length;l++){let h=o[l];Array.isArray(h)?a(h):n.push(h)}}return a(r),s.init(n),wb(r,s,t,i)}var Uf=new Error("list is empty"),Ff=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},rR=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},sR=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},nR=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Uf;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Uf;return this.remove(e),e.item}addLast(e){if(this.first===null||this.last===null){let t=new Ff(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Ff(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Uf;return this.first.item}getLast(){if(this.last===null)throw Uf;return this.last.item}insertAfter(e,t){let i=new Ff(this,t);return e.insertAfter(i),e===this.last&&(this.last=i),this.cnt++,i}insertBefore(e,t){let i=new Ff(this,t);return e.insertBefore(i),e===this.first&&(this.first=i),this.cnt++,i}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new rR(this.first)}listIterator(){return new sR(this.first)}toArray(){let e=new Array,t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e}},Zf=class{constructor(e){this.inters=[],e&&(this.inters=e)}addInter(e){this.inters.push(e),e.group=this}findInter(e){let t=this.inters.find(i=>Ve(i.coord,e.coord));return t&&this.inters.find(i=>i.side===e.side)&&e.visitSelf(),t}getOutInter(e){let t=this.inters.filter(i=>!i.getVisited());if(t.length!==0)return t.length===1?t[0]:t.reduce((i,r)=>{if(!i||i.side.getShape()===e)return r;if(r.side.getShape()===e)return i;let s=i.coord,n=Qe(e,s),a=Qe(i.side.getShape(),s),o=Qe(r.side.getShape(),s);return n.dot(a)>n.dot(o)?i:r},void 0)}getEntryInter(){}},AO=0;function Ib(e,t){let i=e.primitives[0];if(e.primitives.length===1&&i instanceof ye&&Math.abs(i.sweepAngle)===360)return[e];let r=Gu();AO++;let s,n=pR(e);if(n.length===0)return[];let a=lR(n);if(AO===-1){s=new Uu(t);let c=s.initColor(Bt.BLUE);n.forEach(d=>c.addPt(d.getShape()));let f=s.initColor(Bt.GREEN);a.forEach(d=>f.addPoint(d.coord)),s.draw();debugger;throw new Error}if(a.length===0)return[bt.build7(n.map(c=>c.getShape()))];hR(a);let o=[],l=!1;try{dR(a,s)}catch(c){c.customType==="IS_OVERLAP"?(l=!0,o=new pu().getUnion([e]).map(f=>f.items).flat(2)):console.error(c)}if(l)return o;let h=uR(a);if(!h.length)return[bt.build7(n.map(c=>c.getShape()))];if(o=aR(h,s),o.length===0)return console.warn("=====deSelfIntersection=====",AO),[];if(s)throw o.forEach(c=>{s.initColor(Bt.WHITE).addPly(c),s.draw();debugger}),new Error;return na.deSelfIntersection+=Po(r),o}function aR(e,t){let i=[];return e.forEach(r=>{let s=r;r.inters.forEach(n=>{if(n.getVisited())return;let a=[],o=[],l;if(t){debugger;let c=t.initColor(Bt.RED);l=f=>{a.push(f),c.addPt(a[a.length-1]),t.draw();debugger}}else l=c=>a.push(c);do{let c=function(_,g){Te.eq(_.distance2(g),0)||l(Pb(u.getShape(),_,g))},f=o.findIndex(_=>_===n.group);if(f!==-1){let _=a.findIndex(m=>m===n.group),g=a.splice(_).filter(m=>!(m instanceof Zf));if(g.length){let m=Do(bt.build7(g));m&&i.push(m)}let b=a.filter(m=>!(m instanceof Zf));if(n=o[f].getOutInter(b[b.length-1]),o.splice(f),!n)throw Error("interGroup not hav inter!!!2");continue}n.visitSelf(),o.push(n.group),a.push(n.group);let d=n.getIndex(),u=n.side,p=u.inters[d+1];for(;p!=null&&p.isInvalid||p&&p.group===n.group;)p=u.inters[p.getIndex()+1];if(p){c(n.coord,p.coord);let _=p.getBindedInter();if(n=_.getVisited()?_.group.getOutInter(_.side.getShape()):_,!n){if(p.group===s)break;throw new Error("interGroup not hav inter!!!3")}}else{for(c(n.coord,u.getEnd()),u=u.nextSide,n=null;;){for(let _ of u.inters)if(!_.isInvalid){let g=_.group.getOutInter(u.getShape());if(!g){if(_.group===s){n=_;break}else if(_.getBindedInter().group===s){n=_.getBindedInter();break}continue}n=g;break}if(n)break;l(u.getShape()),u=u.nextSide}Te.eq(u.getEnd().distance2(n.coord),0)?l(u.getShape()):c(u.getStart(),n.coord)}}while(n.group!==s);let h=Do(bt.build7(a.filter(c=>!(c instanceof Zf))));h&&i.push(h)})}),i}function oR(e){return{next(){return e.hasNext()?{value:e.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function lR(e){let t=[],i=new nR;for(let r of e.slice().sort((s,n)=>s.bbox().minY-n.bbox().minY)){for(let s of oR(i.listIterator())){let n=s.item;if(n.bbox().maxY<r.bbox().minY)i.remove(s);else{let a=function(d,u){let p=new Ma(u,d,null);return d.inters.push(p),t.push(p),p},o=function(d,u){let p=d.getEnd(),_=new pe(te[0],te[1]),g=new pe(te[2],te[3]),b=p.distance2(_)>p.distance2(g)?_:g,m=d.prevSide;a(Ve(m.getEnd(),b)?m:d,b).bind(a(u,b))},l=n.getShape(),h=r.getShape(),c=ln(l,h),f=c===4&&te[0]===te[2]&&te[1]===te[3];if(f&&(c-=2),n.nextSide===r)n.prevSide!==r&&c===4&&o(n,r);else if(n.prevSide===r)c===4&&o(r,n);else if(c!==0){let d=function(p,_){let g=p.prevSide;return a(Ve(g.getEnd(),_)?g:p,_)},u=new pe(te[0],te[1]);if(f&&!Ve(u,n.prevSide.getEnd())&&!Ve(u,r.prevSide.getEnd())&&Qe(l,u).dot(Qe(h,u))>0)continue;for(let p=0;p<c;p+=2){let _=new pe(te[p],te[p+1]);d(n,_).bind(d(r,_))}}}}i.add(r)}return t.forEach(r=>{r.getIndex()===void 0&&r.side.sortInters()}),t}function hR(e){e.forEach(t=>{let i=t.side.getEnd();if(t.isInvalid||!Ve(t.coord,i))return;let r=t.side.inters,s=t.getBindedInter().side;for(let n=r.length-1;n>=0;n--){let a=r[n];if(!Ve(a.coord,i))break;a!==t&&a.getBindedInter().side===s&&a.setIsInvalid()}})}function cR(e){let t=new Iu(10);return e.forEach(i=>{i.isInvalid||t.add(i)}),t}function uR(e){let t=[],i=cR(e);return e.forEach(r=>{if(r.isInvalid||r.group)return;let s=i.search(r.bbox().extendOfSize(Te.eps)).filter(n=>!n.group);if(s.length){let n=new Set,a=new Zf(s);s.forEach(o=>{o.group=a,n.has(o.side)&&o.visitSelf(),n.add(o.side)}),t.push(a)}}),t}function dR(e,t){e.forEach(i=>{if(i.isInvalid||i.dealed)return;let r=i.side,s=i.getBindedInter().side,n;Ve(r.getEnd(),i.coord)&&Ve(s.getEnd(),i.coord)?n=-1:Ve(r.getEnd(),i.coord)?r.nextSide!==s&&(n=1,i=i.getBindedInter()):Ve(s.getEnd(),i.coord)&&s.nextSide!==r&&(n=1),fR(n,i,t),i.isDealed()})}function fR(e,t,i){let r=t.getBindedInter(),s=t.side,n=r.side,a=s.getShape(),o=n.getShape(),l=1,h=!1;if(e===-1){if(gh(a.reverse(),o.reverse())||gh(s.nextSide.getShape(),n.nextSide.getShape())){let f=Ra(s,s.nextSide,n,r,l,h,i);if(f.state===2){let u=new Error("info1.state === InState.IS_OVERLAP");throw u.customType="IS_OVERLAP",u}let d=Ra(s,s.nextSide,n.nextSide,r,l,h,i);f.state===d.state&&c(f,d)}else if(!(gh(a.reverse(),n.nextSide.getShape())||gh(s.nextSide.getShape(),o.reverse()))){let f=vO(s,s.nextSide,n,!1,i);f===vO(s,s.nextSide,n.nextSide,!0,i)&&f!==vO(n,n.nextSide,s.nextSide,!0,i)&&t.setIsInvalid()}}else if(e===1){let f=function(d,u){return Qe(d,u.start()).dot(Qe(u,u.start()))>0};if(gh(a.reverse(),o.reverse())||gh(a,n.nextSide.getShape())){let d=Vs(s,n,r,i,l,h,new Map);if(d.state===2){let p=new Error("info1.state === InState.IS_OVERLAP");throw p.customType="IS_OVERLAP",p}let u=Vs(s,n.nextSide,r,i,l,h,new Map);d.state===u.state&&c(d,u)}else if(f(a.reverse(),o.reverse())&&f(a,n.nextSide.getShape())){let d=mr(s,n,!1,i);d===mr(s,n.nextSide,!0,i)&&d!==Ll(n,n.nextSide,new Fu(Pb(a,t.coord,a.end()),i),!0,i)&&t.setIsInvalid()}}function c(f,d){f.inter.setIsInvalid(),d.inter.setIsInvalid(),t.setIsInvalid()}}function Pb(e,t,i){if(e instanceof oe||t.distance2(i)<1e-6)return new oe(t,i);if(e instanceof ye)return ye.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.sweep());if(e instanceof Be){let r=e.getPercent(t,et),s=e.getPercent(i,et);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}function pR(e){let t=Do(e);if(!t)return[];let i=t.primitives.map(s=>new Fu(s,null)),r=i[i.length-1];return i.forEach(s=>{r.connect(s),r=s}),i}var Ua,_R=(Ua=class{static clearData(t){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new Uu(t):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let t=this.drawDebug.initColor(Bt.WHITE);this.originalPrimitive.forEach(i=>t.addPt(i)),this.drawDebug.draw();debugger}for(let t=0;t<this.originalPrimitive.length;t+=1){let i=this.originalPrimitive[t];this.offsetPrimitive.push({index:t,offsetEdge:this.createOffsetEdge(i)})}if(this.drawDebug){let t=this.drawDebug.initColor(Bt.Golden);this.offsetPrimitive.forEach(i=>t.addPt(i.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let t=0;t<this.offsetPrimitive.length;t+=1)if(t===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[0]);let i=this.rawOffsetPrimitive[0],r;i instanceof ye?r=ye.build4(this.offsetPrimitive[0].offsetEdge.start(),i.end(),i.center,i.rx,i.ry,i.sweep()):r=new oe(this.offsetPrimitive[0].offsetEdge.start(),i.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(r)}else this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[t+1]);else this.rawOffsetPrimitive=[]}static createCirclePrimitive(t,i){let r=t.width()*.5,s=t.height()*.5,n=Math.sqrt(r**2+s**2)+i;return[ye.buildCircle(t.center(),n)]}static getExtendPolyLine(t,i,r=!0,s){var o,l;if(!((o=t==null?void 0:t.primitives)!=null&&o.length))return[];let n=Do(t);if(!((l=n==null?void 0:n.primitives)!=null&&l.length)){if(this.isExpansion){let h=[1],c=i*2;t.primitives.forEach(d=>h.push(d.stroke(c,1,0)));let f=iR(h,s);if(f.items.length!==1)throw new Error("group.items.length !== 1 ");return[f.items[0].items[0]]}return[]}if(t=n,this.clearData(s),this.originalPrimitive=t.primitives,this.isExpansion=i>0,this.offsetDistance=i,this.createRawOffsetEdge(),this.drawDebug){let h=this.drawDebug.initColor(Bt.BLUE);this.rawOffsetPrimitive.forEach(c=>h.addPt(c)),this.drawDebug.draw();debugger}let a=r?this.createClippingEdge(s):[bt.build2(this.rawOffsetPrimitive)];if(this.drawDebug){let h=this.drawDebug.initColor(Bt.RED);a.forEach(c=>h.addPly(c)),this.drawDebug.draw();debugger}if(a.length&&(!this.isExpansion||this.isExpansion&&a.length>1)&&(a=this.getValidityPrimitive(a)),this.drawDebug){let h=this.drawDebug.initColor(Bt.GREEN);a.forEach(c=>h.addPly(c)),this.drawDebug.draw();debugger;throw new Error}return a}static getValidityPrimitive(t){let i=[],r=Math.abs(this.offsetDistance);for(let s=0;s<t.length;s+=1){let n=!0,a=t[s].primitives;e:for(let o=0;o<a.length;o+=1){let l=a[o],h;if(l instanceof ye)h=l.midPoint;else if(l instanceof oe)h=l.start();else throw new Error("not support!");for(let c=0;c<this.originalPrimitive.length;c+=1){let f=this.originalPrimitive[c],d;if(f instanceof ye?d=this.pointArcClosest(h,f):d=ZN(h,f.start(),f.end()).d,r-d>.01){n=!1;break e}}}n&&i.push(t[s])}return i}static getInters(t){let i=[];for(let r=0;r<t;r+=2)i.push(new pe(te[r],te[r+1]));return i}static pointArcClosest(t,i){let r=i.center;if(t.equals1(i.center))return i.rx;if(i.inArea(t,0)){let a=t.sub(r);return Math.abs(a.length()-i.rx)}let s=t.distance2(i.start()),n=t.distance2(i.end());return Te.less(s,n)?Math.sqrt(s):Math.sqrt(n)}static createClippingEdge(t){let i=[],r=[],s=Ib(bt.build2(this.rawOffsetPrimitive),t);s.forEach(a=>{let o=a.area(.01);i.push(o)});let n=Math.min(...i.filter(a=>a<0));for(let a=0;a<i.length;a+=1){let o=i[a];Te.eq(o,0)||(!this.isExpansion&&o<0||this.isExpansion&&(o<0&&i[a]===n||o>0))&&r.push(s[a])}return r}static createOffsetEdge(t){if(t instanceof ye)return t.panDistance1(this.offsetDistance);if(t instanceof oe)return t.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(t,i){t.offsetEdge instanceof oe&&i.offsetEdge instanceof oe?this.lineToLineConnect(t,i):t.offsetEdge instanceof ye&&i.offsetEdge instanceof ye?this.arcToArcConnect(t,i):t.offsetEdge instanceof oe&&i.offsetEdge instanceof ye?this.lineToArcConnect(t,i):this.arcToLineConnect(t,i)}static isFalseIntersection(t){return t>1||t<0}static lineToLineConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=i.index,a=this.originalPrimitive[n].start();if(r.isParallel(s))r.bbox().intersection1(s.bbox())?this.rawOffsetPrimitive.push(r):this.lineToLineUseArcToConnect(a,r,s);else{let o=this.getLineToLineT(r,s),l=o[0],h=o[1];if(this.isFalseIntersection(l)||this.isFalseIntersection(h))l>1&&this.isFalseIntersection(h)?this.lineToLineUseArcToConnect(a,r,s):this.useLineToConnect(r,s);else if(!this.isFalseIntersection(l)&&!this.isFalseIntersection(h)){let c=r.end().sub(r.start()),f=r.start().add(c.mul(l)),d=new oe(r.start(),f);this.rawOffsetPrimitive.push(d);let u=new oe(f,s.end());this.updateNextOffsetPrimitive(n,u)}}}static updateNextOffsetPrimitive(t,i){this.offsetPrimitive[t].offsetEdge=i}static useLineToConnect(t,i){this.rawOffsetPrimitive.push(t);let r=new oe(t.end(),i.start());this.rawOffsetPrimitive.push(r)}static lineToLineUseArcToConnect(t,i,r){let s=this.getSweep(t,i),n=this.getSweepAngel(i.end(),r.start(),t,s);if(n===0){this.useLineToConnect(i,r);return}this.rawOffsetPrimitive.push(i);let a=ye.build5(i.end(),r.start(),n);this.rawOffsetPrimitive.push(a)}static getSweep(t,i,r){let s=null,n=r||r===0?this.originalPrimitive[r]:i;if(n instanceof ye){let a=n.center.sub(n.end()).normalize();n.isCCW?s=new pe(a.y,-a.x):s=new pe(-a.y,a.x)}else s=i.end().sub(i.start()).normalize();return t.sub(i.end()).normalize().cross(s)>0?0:1}static getLineToLineT(t,i){let r=t.end().sub(t.start()),s=i.end().sub(i.start()),n=r.cross(s),a=i.start().sub(t.start()),o=t.start().sub(i.start()),l=a.cross(s)/n,h=o.cross(r)/-n;return[l,h]}static lineToArcConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=t.index,a=i.index,o=this.getLineJoinArcScalarAndIntersectionNum(r,s),l=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(l,r,s,n);else if(o.intersectionNum===1){let h=o.points[0];this.lineAndArcConnectionDetail(r,s,o.t[0],h,l,n,a)}else if(o.intersectionNum===2){let h=o.points[0],c=o.points[1],f=h.distance2(l),d=c.distance2(l);this.lineAndArcConnectionDetail(r,s,f<d?o.t[0]:o.t[1],f<d?h:c,l,n,a)}}static lineAndArcConnectionDetail(t,i,r,s,n,a,o){let l=this.isTrueArcIntersection(i,s);if(!this.isFalseIntersection(r)&&l){let h=new oe(t.start(),s);this.rawOffsetPrimitive.push(h);let c;!i.center.equals1(s)||i.sweepAngle>1e-4?(c=ye.build4(s,i.end(),i.center,i.rx,i.ry,i.sweep()),c instanceof ye&&c.sweepAngle===0&&(c=new oe(c.start(),c.end()))):c=new oe(i.center,s),this.updateNextOffsetPrimitive(o,c)}else l?this.useLineToConnect(t,i):this.lineAndArcUseArcConnect(n,t,i,a)}static lineAndArcUseArcConnect(t,i,r,s){let n=this.getSweep(t,i,s),a=this.getSweepAngel(i.end(),r.start(),t,n);if(a===0){this.useLineToConnect(i,r);return}let o=ye.build5(i.end(),r.start(),a);this.rawOffsetPrimitive.push(i),this.rawOffsetPrimitive.push(o)}static arcToLineConnectionDetail(t,i,r,s,n,a,o){let l=this.isTrueArcIntersection(t,s);if(!this.isFalseIntersection(r)&&l){let h;t.center.equals1(s)?h=new oe(t.center,s):Math.abs(t.sweepAngle)<1e-4?h=new oe(t.start(),s):(h=ye.build4(t.start(),s,t.center,t.rx,t.ry,t.sweep()),h instanceof ye&&h.sweepAngle===0&&(h=new oe(h.start(),h.end()))),this.rawOffsetPrimitive.push(h);let c=new oe(s,i.end());this.updateNextOffsetPrimitive(o,c)}else l?this.useLineToConnect(t,i):this.lineAndArcUseArcConnect(n,t,i,a)}static isTrueArcIntersection(t,i){return Fi(t,i)}static getSweepAngel(t,i,r,s){let n=t.angleD(r),a=i.angleD(r),o;return n===a?o=0:(n=ot.regularD(n),a=ot.regularD(a),s===1?a<=n&&(a+=360):a>=n&&(n+=360),o=a-n),o}static getLineJoinArcScalarAndIntersectionNum(t,i){let r={t:[],intersectionNum:0,points:[]},s=XN(i,t);if(s){r.intersectionNum=s/2;for(let n=0;n<s-1;n+=2){let a=new pe(te[n],te[n+1]);r.points.push(a),a.sub(t.start()).x<1e-4||a.sub(t.start()).y<1e-4?r.t.push(0):r.t.push(a.sub(t.start()).x/t.end().sub(t.start()).x)}}else r.intersectionNum=0;return r}static arcToLineConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=t.index,a=i.index,o=this.getLineJoinArcScalarAndIntersectionNum(s,r),l=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(l,r,s,n);else if(o.intersectionNum===1){let h=o.points[0];this.arcToLineConnectionDetail(r,s,o.t[0],h,l,n,a)}else if(o.intersectionNum===2){let h=o.points[0],c=o.points[1],f=h.distance2(l),d=c.distance2(l);this.arcToLineConnectionDetail(r,s,f<d?o.t[0]:o.t[1],f<d?h:c,l,n,a)}}static rxChangeStatus(t){return t===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=ob(r,s);if(n){let a=this.getInters(n),o;if(a.length===2){let c=this.originalPrimitive[i.index].start(),f=a[0],d=a[1],u=f.distance2(c),p=d.distance2(c);u<p?o=f:o=d}else o=a[0];let l,h;o.equals1(r.center)?l=new oe(r.center,o):Math.abs(r.sweepAngle)<1e-4?l=new oe(r.start(),o):(l=ye.build4(r.start(),o,r.center,r.rx,r.ry,r.sweep()),l instanceof ye&&l.sweepAngle===0&&(l=new oe(l.start(),l.end()))),this.rawOffsetPrimitive.push(l),o.equals1(s.center)?h=new oe(o,s.center):Math.abs(s.sweepAngle)<1e-4?h=new oe(o,s.end()):(h=ye.build4(o,s.end(),s.center,s.rx,s.ry,s.sweep()),h instanceof ye&&h.sweepAngle===0&&(h=new oe(h.start(),h.end()))),this.updateNextOffsetPrimitive(i.index,h)}else{let a=this.originalPrimitive[t.index],o=this.originalPrimitive[i.index],l=this.rxChangeStatus(a.sweep()),h=this.rxChangeStatus(o.sweep()),c=this.originalPrimitive[i.index].start(),f=this.getSweep(c,r,t.index),d=Math.abs(this.offsetDistance),u=ye.build2(c,l?a.endAngle():a.endAngle()+180,h?o.startAngle:o.startAngle+180,d,d,f);this.rawOffsetPrimitive.push(r),this.rawOffsetPrimitive.push(u)}}},Ua.originalPrimitive=[],Ua.offsetPrimitive=[],Ua.rawOffsetPrimitive=[],Ua.testI=0,Ua),gR=class mu extends Bu{constructor(t,i,r,s,n,a){if(super(),i<0||r<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=t,this.width=i,this.height=r,this.angle=s,this.isCCW=n,this.radius=Math.min(Math.max(a,0),i/2,r/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new pe(this.radius,0).multiply3(Yt.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new pe(0,-this.height/2).multiply3(Yt.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new pe(this.width,-this.height/2).multiply3(Yt.rotateD(this.angle)))}extend(t){return new mu(this.leftUpPoint.add(new pe(-t,t).rotateD(pe.ORIGIN,this.angle)),this.width+t*2,this.height+t*2,this.angle,this.isCCW,this.radius+t)}bbox(){let t=Yt.rotateD(this.angle),{leftUpPoint:i,width:r,height:s,radius:n}=this,a=i.add(new pe(n,-n).multiply3(t)),o=i.add(new pe(n,n-s).multiply3(t)),l=i.add(new pe(r-n,-n).multiply3(t)),h=i.add(new pe(r-n,n-s).multiply3(t));return new Qr(Math.min(a.x,o.x,l.x,h.x)-n,Math.max(a.x,o.x,l.x,h.x)+n,Math.min(a.y,o.y,l.y,h.y)-n,Math.max(a.y,o.y,l.y,h.y)+n)}toPolyline(){let t=[],{leftUpPoint:i,width:r,height:s,radius:n}=this;if(n===0){let o=pe.ORIGIN,l=new pe(r,0),h=new pe(r,-s),c=new pe(0,-s);t.push(new oe(o,l),new oe(l,h),new oe(h,c),new oe(c,o))}else{let o=new pe(0,-n),l=new pe(n,0),h=new pe(r-n,0),c=new pe(r,-n),f=new pe(r,n-s),d=new pe(r-n,-s),u=new pe(n,-s),p=new pe(0,n-s);t.push(ye.build1(o,l,n,n,!1,0),new oe(l,h),ye.build1(h,c,n,n,!1,0),new oe(c,f),ye.build1(f,d,n,n,!1,0),new oe(d,u),ye.build1(u,p,n,n,!1,0),new oe(p,o))}t=t.filter(o=>!o.start().equals1(o.end())),this.isCCW&&(t.forEach((o,l)=>t[l]=o.reverse()),t.reverse());let a=Yt.rotateD(this.angle).translate1(i);return bt.build2(t.map(o=>o.multiply3(a)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(t){let i=this.leftUpPoint.multiply3(t),r=new pe(this.width,0).multiply3(Yt.rotateD(this.angle)).multiply3(t),s=new pe(0,-this.height).multiply3(Yt.rotateD(this.angle)).multiply3(t);return t.isMirrored()?new mu(i,s.length(),r.length(),s.angleD(pe.ORIGIN),this.isCCW===1?0:1,this.radius*r.length()/this.width):new mu(i,r.length(),s.length(),r.angleD(pe.ORIGIN),this.isCCW,this.radius*r.length()/this.width)}reverse(){return new mu(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(t,i,r){let s=this.stroke1(t,i,r);if(s.length===1)return s[0];{let[n,a]=s;return bt.build2(n.primitives.concat(new oe(n.primitives[0].start(),a.primitives[0].start()),a.primitives,new oe(a.primitives[0].start(),n.primitives[0].start())))}}stroke1(t,i,r){let s=r===this.isCCW?this:this.reverse(),n=t/2,a=Math.min(s.width,s.height)/2,o=s.extend(n).toPolyline();return a<=n?[o]:[o,s.extend(-n).toPolyline().reverse()]}points(t){let i=this.toPolyline(),r=[];return i.points(t,s=>r.push(s)),r}toBezier(){throw new Error("Method not implemented.")}},OR=.01,ir=class En{static simplify(t){return t=Do(t),t?new En([t]):null}static buildByStroke(t,i,r=1,s=_m,n){if(t instanceof ye&&(t.rx<i/2+OR||Math.abs(t.sweepAngle)>180&&Te.lesseq(t.start().distance1(t.end()),i))){let o=Ib(t.stroke(i,r,0),n);if(o.length===0)return null;if(o.length===1)return new En(o);let l=[null],h=Number.POSITIVE_INFINITY;return o.forEach(c=>{let f=c.area(.1);f<0?f<h&&(l[0]=c,h=f):l.push(c)}),new En(l)}else if(t instanceof gR){let o=t.stroke1(i,r,0).map(l=>Do(l));return o[0]?o[1]?new En(o):new En([o[0]]):null}let a=t.stroke(i,r,0,s);return a?this.simplify(a):null}static buildCircle(t,i){return this.simplify(bt.build7([ye.buildCircle(t,i,0)]))}static buildRect(t){return this.simplify(t.toPolyline())}static buildBBox(t){return this.simplify(bt.buildBBox(t,0))}constructor(t){this.items=t.slice()}multiply3(t){return new En(this.items.map(i=>i.multiply3(t)))}bbox(){return this.items[0].bbox()}isEqual(t){return t instanceof En?this.items.every(i=>t.items.some(r=>r.isEqual(i))):!1}getOutMostPolyline(){return this.items[0]}extend(t,i){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(t===0)return new Di([this]);let r=this.items[0],s=[];for(let c of r.primitives)if(c instanceof oe)s.push(c);else if(c instanceof ye&&c.rx===c.ry)a(c);else if(c instanceof Be)n(c);else throw new Error("not support!");r=bt.build7(s);function n(c){let f=c.points(.1);for(let d=0;d<f.length-1;d++){let u=f[d],p=f[d+1];s.push(new oe(u,p))}}function a(c){if(Math.abs(c.sweepAngle)>270){let f=c.sweepAngle/2;a(ye.build3(c.center,c.startAngle,f,c.rx,c.ry)),a(ye.build3(c.center,c.startAngle+f,f,c.rx,c.ry))}else s.push(c)}let o=[],l=[];_R.getExtendPolyLine(r,t,!0,i).forEach(c=>{(c.area(.1)>0?l:o).push(c)});let h;if(o.length===1)l.forEach(c=>o.push(c)),h=new Di([new En(o)]);else if(o.length===0)console.warn("outlines.length === 0"),h=new Di([]);else if(l.length===0)h=new Di(o.map(c=>new En([c])));else{let c=o.map(f=>[f]);l.forEach(f=>{let d=[],u=f.bbox();if(c.forEach(p=>{p[0].bbox().isContainsBBox1(u)&&d.push(p)}),d.length===1)d[0].push(f);else{if(d.length===0)throw new Error("inPlsArr.length === 0");for(let p of d.sort((_,g)=>_[0].bbox().area()-g[0].bbox().area()))if(p[0].getWindingNum(f.start())===-1){p.push(f);break}}}),h=new Di(c.map(f=>new En(f)))}return h}toPolylineGroup(){return new gm(this.items)}};var mR=(e=>(e[e.POLYGON=1]="POLYGON",e[e.POLYLINE=2]="POLYLINE",e[e.LINE=3]="LINE",e[e.ARC=4]="ARC",e[e.BEZIER2=5]="BEZIER2",e[e.BEZIER3=6]="BEZIER3",e[e.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",e[e.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",e[e.BOOLEAN_UNION=9]="BOOLEAN_UNION",e[e.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",e[e.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",e[e.LINES=12]="LINES",e[e.ARCS=13]="ARCS",e[e.BEZIER2S=14]="BEZIER2S",e[e.BEZIER3S=15]="BEZIER3S",e[e.CIRCLE_CW=16]="CIRCLE_CW",e[e.CIRCLE_CCW=17]="CIRCLE_CCW",e[e.POLYGON_GROUP=18]="POLYGON_GROUP",e))(mR||{});var yR=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function bR(e){return new yR(e)}function xR(e){return e===32||e===9||e===13||e===10}var vR=class{constructor(){this._line=1,this._col=0}line(){return this._line}col(){return this._col}_feed(e){return e===10?(this._col=0,this._line++):this._col++,this.feed(e)}parse(e){let t=e.length;for(let i=0;i<t;i++){let r=e.charCodeAt(i);if(!this._feed(r))return this}return this.finish(),this}},CO=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}},ER=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(ER||{}),TR=/(\.?0+)$/,JO=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 100:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(CO.lpad((n|0).toString(10),"0",f)),r=0;else return l}else return l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(CO.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(CO.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static fmtNumber(e){return e.toFixed(5).replace(TR,"")}},wR=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(wR||{});function SR(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var IR=(e,t)=>{e===3?console.error(...t):e===2?console.warn(...t):console.log(...t)},PR=(e,t)=>[SR(e)].concat(t),Fa,AR=(Fa=class{static mix(...t){return new Fa(0,(i,r)=>{for(let s of t)s.write(i,r)},(i,r)=>r)}constructor(t,i=IR,r=PR){this.level=t,this.writer=i,this.fmt=r}setLevel(t){this.level=t}prepend(t=null,i=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),s=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new Fa(this.level,s,r)}chain(t){return t.prepend(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}formatWrite(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,[JO.format(i,...r)]))}write(t,i){this.include(t)&&this.writer(t,this.fmt(t,i))}write3(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,[JO.format(i,...r)]))}debug3(t,...i){this.write3(0,t,i)}warning3(t,...i){this.write3(2,t,i)}debugFmt(t,...i){this.formatWrite(0,t,i)}debug(...t){this.write(0,t)}infoFmt(t,...i){this.formatWrite(1,t,i)}info(...t){this.write(1,t)}warningFmt(t,...i){this.formatWrite(2,t,i)}warning(...t){this.write(2,t)}errorFmt(t,...i){this.formatWrite(3,t,i)}error(...t){this.write(3,t)}},Fa.DUMMY=new Fa(4),Fa),NO=500,w2=String.fromCharCode,CR=class{constructor(){this.buffer=new Array}size(){return this.buffer.length}isEOF(){return!1}write(e){return this.buffer.push(e),1}writen1(e){return this.writen2(e,0,e.length)}writen2(e,t,i){let r=this.buffer;for(let s=0,n=t;s<i;s++,n++)r.push(e[n]);return i}writeAsync(e,t){t(this.write(e))}writenAsync1(e,t){t(this.writen1(e))}writenAsync2(e,t,i,r){r(this.writen2(e,t,i))}writeStr(e){let t=e.length,i=new Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);return this.writen1(i)}clear(){this.buffer.length=0}toString(){let e=this.buffer,t=e.length;if(t<=NO)return w2.apply(null,e);{let i=new Array;for(let r=0;r<e.length;r+=NO){let s=Math.min(t-r,NO),n=w2.apply(null,e.slice(r,r+s));i.push(n)}return i.join("")}}},Ab=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.NUMBER_INTEGER=1]="NUMBER_INTEGER",e[e.NUMBER_DECIMAL=2]="NUMBER_DECIMAL",e[e.NUMBER_E=3]="NUMBER_E",e[e.NUMBER_E_SIGNED=4]="NUMBER_E_SIGNED",e))(Ab||{}),Cb=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.MOVE_X=1]="MOVE_X",e[e.MOVE_Y=2]="MOVE_Y",e[e.LINE_X=3]="LINE_X",e[e.LINE_Y=4]="LINE_Y",e[e.HORIZONTAL_X=5]="HORIZONTAL_X",e[e.VERTICAL_Y=6]="VERTICAL_Y",e[e.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",e[e.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",e[e.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",e[e.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",e[e.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",e[e.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",e[e.ARC_RX=13]="ARC_RX",e[e.ARC_RY=14]="ARC_RY",e[e.ARC_ROTATION=15]="ARC_ROTATION",e[e.ARC_LARGE=16]="ARC_LARGE",e[e.ARC_SWEEP=17]="ARC_SWEEP",e[e.ARC_X=18]="ARC_X",e[e.ARC_Y=19]="ARC_Y",e[e.SMOOTH_CUBIC_BEZIER_X2=20]="SMOOTH_CUBIC_BEZIER_X2",e[e.SMOOTH_CUBIC_BEZIER_Y2=21]="SMOOTH_CUBIC_BEZIER_Y2",e[e.SMOOTH_CUBIC_BEZIER_X=22]="SMOOTH_CUBIC_BEZIER_X",e[e.SMOOTH_CUBIC_BEZIER_Y=23]="SMOOTH_CUBIC_BEZIER_Y",e[e.QUADRATIC_BEZIER_X1=24]="QUADRATIC_BEZIER_X1",e[e.QUADRATIC_BEZIER_Y1=25]="QUADRATIC_BEZIER_Y1",e[e.QUADRATIC_BEZIER_X=26]="QUADRATIC_BEZIER_X",e[e.QUADRATIC_BEZIER_Y=27]="QUADRATIC_BEZIER_Y",e))(Cb||{});function NR(e){return 97<=e&&e<=122||65<=e&&e<=90}function _r(e){let t=parseFloat(e);if(isFinite(t))return t;throw new Error("expect number")}var S2=class extends vR{constructor(e,t=!0,i=AR.DUMMY){super(),this.buffer=new CR,this.group=new Array,this.subPartStart=pe.ORIGIN,this.curPoint=pe.ORIGIN,this.lexState=0,this.parseState=0,this.isAbsolute=!1,this.isLargeArc=!1,this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=Number.NaN,this.y=Number.NaN,this.rx=Number.NaN,this.ry=Number.NaN,this.rotation=Number.NaN,this.sweep=Io.CCW,this.prevBezierCtrl2=null,this.logger=i,this.cb=e,this.yAxis=t?-1:1}on(e){return this.cb(e)}feed(e){switch(this.logger.include(0)&&this.logger.debug3("L: %c(%s)|%s",e,String.fromCharCode(e),Ab[this.lexState]),this.lexState){case 0:return xR(e)?!0:48<=e&&e<=57||e===45||e===43?(this.pushBuffer(e),this.lexState=1,!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):NR(e)?this.feedS(String.fromCharCode(e)):(this.logger.warning3("unknow letter %c",e),!0);case 1:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===46?(this.pushBuffer(e),this.lexState=2,!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 2:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===101||e===69?(this.pushBuffer(e),this.lexState=3,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 3:return 48<=e&&e<=57?(this.pushBuffer(e),!0):e===45||e===43?(this.pushBuffer(e),this.lexState=4,!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;case 4:return 48<=e&&e<=57?(this.pushBuffer(e),!0):this.feedS(this.getCleanBuffer())?(this.lexState=0,this.feed(e)):!1;default:return!0}}finish(){this.feed(32),this.tryNotify()}feedS(e){switch(this.logger.include(0)&&this.logger.debug3("P: %s|%s|%s|%s",e,Cb[this.parseState],this.curPoint,this.subPartStart),this.parseState){case 0:switch(e){case"M":this.isAbsolute=!0,this.parseState=1;break;case"m":this.isAbsolute=!1,this.parseState=1;break;case"L":this.isAbsolute=!0,this.parseState=3;break;case"l":this.isAbsolute=!1,this.parseState=3;break;case"H":this.isAbsolute=!0,this.parseState=5;break;case"h":this.isAbsolute=!1,this.parseState=5;break;case"V":this.isAbsolute=!0,this.parseState=6;break;case"v":this.isAbsolute=!1,this.parseState=6;break;case"z":case"Z":{this.group.push(new oe(this.curPoint,this.subPartStart));let r=this.tryNotify();return this.curPoint=this.subPartStart,r}case"C":this.isAbsolute=!0,this.parseState=7;break;case"c":this.isAbsolute=!1,this.parseState=7;break;case"S":this.isAbsolute=!0,this.parseState=20;break;case"s":this.isAbsolute=!1,this.parseState=20;break;case"A":this.isAbsolute=!0,this.parseState=13;break;case"a":this.isAbsolute=!1,this.parseState=13;break;case"Q":this.isAbsolute=!0,this.parseState=24;break;case"q":this.isAbsolute=!1,this.parseState=24;break;default:this.logger.warning3("unknow %s",e)}return!0;case 1:let t=this.tryNotify();return this.x=_r(e),this.parseState=2,t;case 2:{this.y=this.yAxis*_r(e);let r;return this.isAbsolute?r=new pe(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.curPoint=r,this.subPartStart=r,this.parseState=3,!0}case 3:return this.x=parseFloat(e),isFinite(this.x)?(this.parseState=4,!0):(this.parseState=0,this.feedS(e));case 4:{this.y=this.yAxis*_r(e);let r;return this.isAbsolute?r=new pe(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.group.push(new oe(this.curPoint,r)),this.curPoint=r,this.parseState=3,!0}case 5:if(this.x=parseFloat(e),isFinite(this.x)){let r;return this.isAbsolute?r=new pe(this.x,this.curPoint.y):r=this.curPoint.add1(this.x,0),this.group.push(new oe(this.curPoint,r)),this.curPoint=r,!0}else return this.parseState=0,this.feedS(e);case 6:if(this.y=parseFloat(e),isFinite(this.y)){this.y=this.yAxis*this.y;let r;return this.isAbsolute?r=new pe(this.curPoint.x,this.y):r=this.curPoint.add1(0,this.y),this.group.push(new oe(this.curPoint,r)),this.curPoint=r,!0}else return this.parseState=0,this.feedS(e);case 7:let i=parseFloat(e);return isFinite(i)?(this.x1=i,this.parseState=8,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 8:return this.y1=this.yAxis*_r(e),this.parseState=9,!0;case 9:return this.x2=_r(e),this.parseState=10,!0;case 10:return this.y2=this.yAxis*_r(e),this.parseState=11,!0;case 11:return this.x=_r(e),this.parseState=12,!0;case 12:{this.y=this.yAxis*_r(e);let r,s,n;return this.isAbsolute?(r=new pe(this.x1,this.y1),s=new pe(this.x2,this.y2),n=new pe(this.x,this.y)):(r=this.curPoint.add1(this.x1,this.y1),s=this.curPoint.add1(this.x2,this.y2),n=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=s,this.group.push(new Be([this.curPoint,r,s,n])),this.curPoint=n,this.parseState=7,!0}case 13:return this.rx=parseFloat(e),isFinite(this.rx)?(this.parseState=14,!0):(this.parseState=0,this.feedS(e));case 14:return this.ry=_r(e),this.parseState=15,!0;case 15:return this.rotation=_r(e),this.parseState=16,!0;case 16:return this.isLargeArc=_r(e)===1,this.parseState=17,!0;case 17:return this.sweep=_r(e)===1?Io.CW:Io.CCW,this.parseState=18,!0;case 18:return this.x=_r(e),this.parseState=19,!0;case 19:{this.y=this.yAxis*_r(e);let r;return this.isAbsolute?r=new pe(this.x,this.y):r=this.curPoint.add1(this.x,this.y),this.rx&&this.ry&&this.group.push(ye.build1(this.curPoint,r,this.rx,this.ry,this.isLargeArc,this.sweep)),this.curPoint=r,this.parseState=13,!0}case 20:return this.x2=parseFloat(e),isFinite(this.x2)?(this.parseState=21,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 21:return this.y2=this.yAxis*_r(e),this.parseState=22,!0;case 22:return this.x=_r(e),this.parseState=23,!0;case 23:{this.y=this.yAxis*_r(e);let r,s;this.isAbsolute?(r=new pe(this.x2,this.y2),s=new pe(this.x,this.y)):(r=this.curPoint.add1(this.x2,this.y2),s=this.curPoint.add1(this.x,this.y));let n;return this.prevBezierCtrl2?n=this.curPoint.add(this.curPoint.sub(this.prevBezierCtrl2)):n=this.curPoint,this.prevBezierCtrl2=r,this.group.push(new Be([this.curPoint,n,r,s])),this.curPoint=s,this.parseState=20,!0}case 24:return this.x1=parseFloat(e),isFinite(this.x1)?(this.parseState=25,!0):(e!=="s"&&e!=="S"&&(this.prevBezierCtrl2=null),this.parseState=0,this.feedS(e));case 25:return this.y1=this.yAxis*_r(e),this.parseState=26,!0;case 26:return this.x=_r(e),this.parseState=27,!0;case 27:{this.y=this.yAxis*_r(e);let r,s;return this.isAbsolute?(r=new pe(this.x1,this.y1),s=new pe(this.x,this.y)):(r=this.curPoint.add1(this.x1,this.y1),s=this.curPoint.add1(this.x,this.y)),this.prevBezierCtrl2=r,this.group.push(new Be([this.curPoint,r,s])),this.curPoint=s,this.parseState=24,!0}default:return this.logger.warning3("unsupported parse state %s",this.parseState),!0}}pushBuffer(e){this.buffer.write(e)}getCleanBuffer(){let e=this.buffer.toString();return this.buffer.clear(),e}tryNotify(){if(this.group.length===0)return!0;{let e=bt.build1(bR(this.group));return this.group.length=0,this.on(e)}}onException(e){throw e}},LR=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.ENC_LINE=1]="ENC_LINE",e[e.ENC_ARC=2]="ENC_ARC",e[e.ENC_CUBIC_BEZIER=3]="ENC_CUBIC_BEZIER",e[e.ENC_QUADRATIC_BEZIER=4]="ENC_QUADRATIC_BEZIER",e))(LR||{}),jq=JO.fmtNumber,I2=class{constructor(e=!0){this.buffer=new Array,this.state=0,this.prev=null,this.yAxis=e?-1:1}encPl(e){for(let t of e.primitives)this.encPt(t);return this}encPt(e){if(e instanceof oe)this.encLine1(e);else if(e instanceof ye)this.encArc(e);else if(e instanceof Be)this.encBezier(e);else throw new Error("");return this}encBezier(e){if(e.controls.length===3){let t=e.controls[0],i=e.controls[1],r=e.controls[2];this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"Q",i.x,this.yAxis*i.y,r.x,this.yAxis*r.y):t.equals1(this.prev)?this.state!==4?this.buffer.push("Q",i.x,this.yAxis*i.y,r.x,this.yAxis*r.y):this.buffer.push(i.x,this.yAxis*i.y,r.x,this.yAxis*r.y):this.buffer.push("L",t.x,this.yAxis*t.y,"Q",i.x,this.yAxis*i.y,r.x,this.yAxis*r.y),this.prev=r,this.state=4}else if(e.controls.length===4){let t=e.controls[0],i=e.controls[1],r=e.controls[2],s=e.controls[3];this.state===0?this.buffer.push("M",t.x,this.yAxis*t.y,"C",i.x,this.yAxis*i.y,r.x,this.yAxis*r.y,s.x,this.yAxis*s.y):t.equals1(this.prev)?this.state!==3?this.buffer.push("C",i.x,this.yAxis*i.y,r.x,this.yAxis*r.y,s.x,this.yAxis*s.y):this.buffer.push(i.x,this.yAxis*i.y,r.x,this.yAxis*r.y,s.x,this.yAxis*s.y):this.buffer.push("L",t.x,this.yAxis*t.y,"C",i.x,this.yAxis*i.y,r.x,this.yAxis*r.y,s.x,this.yAxis*s.y),this.prev=s,this.state=3}else throw new Error("only bezier has 3 or 4 control points supported");return this}encArc(e){let t=e.svgEnd;return this.state===0?this.buffer.push("M",e.start().x,this.yAxis*e.start().y,"A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===Io.CCW?0:1,t.x,this.yAxis*t.y):e.start().equals1(this.prev)?this.state!==2?this.buffer.push("A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===Io.CCW?0:1,t.x,this.yAxis*t.y):this.buffer.push(e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===Io.CCW?0:1,t.x,this.yAxis*t.y):this.buffer.push("L",e.start().x,this.yAxis*e.start().y,"A",e.rx,e.ry,0,e.isLarge()?1:0,e.sweep()===Io.CCW?0:1,t.x,this.yAxis*t.y),this.prev=t,this.state=2,this}encLine1(e){return this.encLine2(e.start(),e.end()),this}encLine2(e,t){return this.state===0?this.buffer.push("M",e.x,this.yAxis*e.y,"L",t.x,this.yAxis*t.y):(this.state!==1&&this.buffer.push("L"),e.equals1(this.prev)?this.buffer.push(t.x,this.yAxis*t.y):this.buffer.push(e.x,this.yAxis*e.y,t.x,this.yAxis*t.y)),this.prev=t,this.state=1,this}close(e){return this.state!==0&&(e&&this.buffer.push("Z"),this.state=0,this.prev=null),this}fixNumber(e=4){return this.buffer.forEach((t,i,r)=>{typeof t=="number"&&(t|0)!==t&&(r[i]=+t.toFixed(e))}),this}toString(){return this.buffer.join(" ")}toArray(){return this.buffer}},RR=class extends dm{constructor(){super(),this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.zIndex=0,this.zIndexMap=new Map}onParseLine(e){let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"LOCK":this.parseLock(e);break;case"HIDE":this.parseHide(e);break;case"INVISIBLE":this.parseInvisible(e);break;case"COVER":this.parseCover(e);break;case"TRN_CTRL":this.parseTrnCtrl(e);break;case"COMMENT":this.parseComment(e);break;case"FONT_CACHE":this.parseFontCache(e);break;case"TRANSFORM":this.parseTransform(e);break;case"GROUP":{let i=e[1];this.cache[t]||(this.cache[t]={errorIds:[]}),i!==null&&this.cache[t][i]?this.cache[t][i]=e:this.cache[t].errorIds.push(e);break}case"POLY":case"STRING":case"AUXLINE":case"DIMENSION":{this.zIndexMap.set(e[1],++this.zIndex);let i=wu(e[1]);this.cache[t]||(this.cache[t]={errorIds:[]}),i!==null&&!this.cache[t][i]?this.cache[t][i]=e:this.cache[t].errorIds.push(e);break}default:console.warn("can not find hanlder with",e)}}getZIndex(e){var t;return(t=this.zIndexMap.get(e))!=null?t:null}secondParseLine(e){switch(e[0]){case"GROUP":this.parseGroup(e);break;case"POLY":this.parsePoly(e);break;case"STRING":this.parseString(e);break;case"AUXLINE":this.parseAuxLine(e);break;case"DIMENSION":this.parseDimension(e);break}}onParseEnd(){for(let e in this.cache){let t=this.cache[e],i=Object.keys(t).sort((s,n)=>Number(s)-Number(n)),r=0;for(let s of i){if(s==="errorIds")continue;let n=Number(s),a=n-r-1;a>=1&&this.onPHolder(e,a),r=n,this.secondParseLine(t[n])}t.errorIds.forEach(s=>this.secondParseLine(s))}this.clearCache()}clearCache(){this.lockConfig=[],this.hideConfig=[],this.invisibleConfig=[],this.coverConfig={},this.commentConfig={},this.trnCtrlConfig={},this.transformConfig={},this.fontCache={},this.cache={},this.version=void 0}parseDocType(e){this.version=Number(e[2])}parseHead(e){this.version<2&&e[1]&&e[1].print==="AHead Side"&&(e[1].print="Ahead Side"),this.onCanvas(e[1])}parseGroup(e){this.onGroup(e[1],e[2],e[3],!!e[4],!!e[5])}parseLock(e){this.lockConfig.push(...e[1])}parseHide(e){this.hideConfig.push(...e[1])}parseInvisible(e){this.invisibleConfig.push(...e[1])}parseCover(e){this.coverConfig[e[1]]=e[2]}parseTrnCtrl(e){this.trnCtrlConfig[e[1]]={scope:e[2],trans_print:e[3],trans_white:e[4]}}parseComment(e){this.commentConfig[e[1]]=e[2]}matrix2svg(e){let[t,i,r,s,n,a,o,l,h]=e.data;return[t,i,s,n,o,l]}encPath(e){let t=new Array;return new S2(i=>(t.push(new I2(!0).encPl(i).toArray().slice(1)),!0),!0).parse(e),t}parseRect(e){var y,x,E,w,S,C,R,B;let[,t,,i,r,s,n,a,o,,,l,h]=e,c=l[0],f=c[1],d=-c[2],u=c[1]+c[3],p=-c[2]+c[4],_=c[5],g=c[6],b=+c[7],m=+c[8],O=Yt.scale(u-f,p-d).rotateD(-b);m&&(O=O.multiply3(Yt.MIRROR_X)),O=O.translate(f,d),O=this.matrix2svg(O),O=this.encMatrix(O),this.onPoly(t,0,i,-b,r,s,n,a,o,!0,[["R",0,0,1,1,_,g,0,0]],!0,!0,this.lockConfig.some(Y=>Y===e[1]),this.hideConfig.some(Y=>Y===e[1]),this.invisibleConfig.some(Y=>Y===e[1]),i===1?1:(y=this.coverConfig[e[1]])!=null?y:null,h||((x=this.commentConfig[e[1]])!=null?x:null),i===2?3:(w=(E=this.trnCtrlConfig[e[1]])==null?void 0:E.scope)!=null?w:null,i===2?o:(C=(S=this.trnCtrlConfig[e[1]])==null?void 0:S.trans_print)!=null?C:null,i===2?1-o:(B=(R=this.trnCtrlConfig[e[1]])==null?void 0:R.trans_white)!=null?B:null,O!=null?O:null)}parseObj(e){var S,C,R,B,Y,G,z,q;let[,t,,i,r,s,n,a,o,,,l,h]=e,[c,f,d,u,p,_,g,b,m]=l[0],O=Yt.rotateD(b);m&&(O=O.multiply3(Yt.MIRROR_X));let y;m?y=new oe(new pe(0,0),new pe(0,-p)).multiply3(O):y=new oe(new pe(0,0),new pe(u,0)).multiply3(O);let x=y.end().angleD(y.start()),E=m===1;u=m===1?p:u,p=m===1?u:p;let w=Yt.scale(u,p).rotateD(-x);E&&(w=w.multiply3(Yt.MIRROR_X)),w=w.translate(f,-d),w=this.matrix2svg(w),w=this.encMatrix(w),this.onPoly(t,0,i,-x,r,s,n,a,o,!0,[["R",0,0,1,1,0,0,0,0]],!1,!1,this.lockConfig.some(L=>L===e[1]),this.hideConfig.some(L=>L===e[1]),this.invisibleConfig.some(L=>L===e[1]),i===1?1:(S=this.coverConfig[e[1]])!=null?S:null,h||((C=this.commentConfig[e[1]])!=null?C:null),i===2?3:(B=(R=this.trnCtrlConfig[e[1]])==null?void 0:R.scope)!=null?B:null,i===2?o:(G=(Y=this.trnCtrlConfig[e[1]])==null?void 0:Y.trans_print)!=null?G:null,i===2?1-o:(q=(z=this.trnCtrlConfig[e[1]])==null?void 0:z.trans_white)!=null?q:null,w!=null?w:null)}parseEllipse(e){var m,O,y,x,E,w,S,C;let[,t,,i,r,s,n,a,o,,,l,h]=e,c=l[0],f=c[1],d=-c[2],u=c[3],p=c[4],_=+c[5],g=+c[6],b=Yt.scale(u,p).rotateD(-_);g&&(b=b.multiply3(Yt.MIRROR_X)),b=b.translate(f,d),b=this.matrix2svg(b),b=this.encMatrix(b),this.onPoly(t,0,i,-_,r,s,n,a,o,!0,[["ELLIPSE",0,0,1,1,0,0]],!0,!0,this.lockConfig.some(R=>R===e[1]),this.hideConfig.some(R=>R===e[1]),this.invisibleConfig.some(R=>R===e[1]),i===1?1:(m=this.coverConfig[e[1]])!=null?m:null,h||((O=this.commentConfig[e[1]])!=null?O:null),i===2?3:(x=(y=this.trnCtrlConfig[e[1]])==null?void 0:y.scope)!=null?x:null,i===2?o:(w=(E=this.trnCtrlConfig[e[1]])==null?void 0:E.trans_print)!=null?w:null,i===2?1-o:(C=(S=this.trnCtrlConfig[e[1]])==null?void 0:S.trans_white)!=null?C:null,b!=null?b:null)}parsePolyGroup(e){var u,p,_,g,b,m,O,y;let[,t,,i,r,s,n,a,o,,,l,h]=e,c=!0,f=!0,d=this.decMultiPoly(l).d;this.onPoly(t,0,i,0,r,s,n,a,o,!0,this.encPath(d),c,f,this.lockConfig.some(x=>x===e[1]),this.hideConfig.some(x=>x===e[1]),this.invisibleConfig.some(x=>x===e[1]),i===1?1:(u=this.coverConfig[e[1]])!=null?u:null,h||((p=this.commentConfig[e[1]])!=null?p:null),i===2?3:(g=(_=this.trnCtrlConfig[e[1]])==null?void 0:_.scope)!=null?g:null,i===2?o:(m=(b=this.trnCtrlConfig[e[1]])==null?void 0:b.trans_print)!=null?m:null,i===2?1-o:(y=(O=this.trnCtrlConfig[e[1]])==null?void 0:O.trans_white)!=null?y:null,null)}parsePoly(e){var t,i,r,s,n,a,o,l,h,c;if(this.version<2)if(e[11].length===1)switch(e[11][0][0]){case"R":{let f=e[7];return f.startsWith("data:")||f.startsWith("blob:")?this.parseObj(e):this.parseRect(e)}case"ELLIPSE":return this.parseEllipse(e);default:return this.parsePolyGroup(e)}else return this.parsePolyGroup(e);else this.onPoly(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],!!(e[12]||e[12]===void 0),!!(e[13]||e[13]===void 0),this.lockConfig.some(f=>f===e[1]),this.hideConfig.some(f=>f===e[1]),this.invisibleConfig.some(f=>f===e[1]),(t=this.coverConfig[e[1]])!=null?t:null,(i=this.commentConfig[e[1]])!=null?i:null,(s=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?s:null,(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,(l=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?l:null,(c=(h=this.transformConfig[e[1]])==null?void 0:h.matrix)!=null?c:null)}decMultiPoly(e){let t=new Ss,i=e.map(r=>{let s="";return new S2(n=>(t.ext1(n.bbox()),s=new I2().encPl(n).toString(),!1),!1).parse("M"+r.join(" ")),s}).join(" ");return{bbox:t.build(),d:i}}encMatrix(e){let[t,i,r,s,n,a]=e,o=new Yt([t,i,0,r,s,0,n,a,1]);o=Yt.MIRROR_Y.multiply3(o).multiply3(Yt.MIRROR_Y);let[l,h,c,f,d,u,p,_,g]=o.data;return[l,f,p,h,d,_]}parseString(e){var t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O;if(this.version<2){let[,y,x,E,w,S,C,R,B,Y,G,z,q,L,M,v,P,I,N,D]=e;S=Ur(S);let j=B;R=R===1,q=q===1,L=L===1,M=M===1;let H=-(v[15]/3|0)+2,K=v%3;N=N||1,D=D||1;let se=this.fontCache[e[1]],{bbox:he,d:_e}=this.decMultiPoly(se),ve=he.width(),J=he.height();J=J||0,ve=ve||0;let Z=0;switch(K){case 1:Z=-ve/2;break;case 2:Z=-ve;break}let re=0;switch(H){case 1:re=J/2;break;case 0:re=J;break}let ue=Yt.translate(Z,re).scale(N,D).rotateD(-C);R&&(ue=ue.multiply3(Yt.MIRROR_X)),ue=ue.translate(w,S);let Le=this.matrix2svg(ue),Ce=this.encMatrix(Le);this.onString(y,x,E,C,j,Y,G,z,q,L,M,((-H||0)+2)*3+(K||0),P,I,this.lockConfig.some(De=>De===e[1]),this.hideConfig.some(De=>De===e[1]),this.invisibleConfig.some(De=>De===e[1]),E===1?1:(t=this.coverConfig[e[1]])!=null?t:null,(i=this.commentConfig[e[1]])!=null?i:null,E===2?3:(s=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?s:null,E===2?I:(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,E===2?1-I:(l=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?l:null,Ce,!!Ce,this.encPath(_e))}else this.onString(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9]===1,e[10]===1,e[11]===1,e[12],e[13],e[14],this.lockConfig.some(y=>y===e[1]),this.hideConfig.some(y=>y===e[1]),this.invisibleConfig.some(y=>y===e[1]),(h=this.coverConfig[e[1]])!=null?h:null,(c=this.commentConfig[e[1]])!=null?c:null,(d=(f=this.trnCtrlConfig[e[1]])==null?void 0:f.scope)!=null?d:null,(p=(u=this.trnCtrlConfig[e[1]])==null?void 0:u.trans_print)!=null?p:null,(g=(_=this.trnCtrlConfig[e[1]])==null?void 0:_.trans_white)!=null?g:null,(m=(b=this.transformConfig[e[1]])==null?void 0:b.matrix)!=null?m:null,!!((O=this.transformConfig[e[1]])!=null&&O.matrix),this.fontCache[e[1]])}parseFontCache(e){this.fontCache[e[1]]=e[2]}parseDimension(e){var t,i,r,s,n,a,o,l,h,c,f,d;this.onDimension(e[1],e[2],e[3],(t=e[4])!=null?t:null,e[5],e[6],e[7],e[8],this.lockConfig.some(u=>u===e[1]),this.hideConfig.some(u=>u===e[1]),this.invisibleConfig.some(u=>u===e[1]),(i=this.coverConfig[e[1]])!=null?i:null,(r=this.commentConfig[e[1]])!=null?r:null,(n=(s=this.trnCtrlConfig[e[1]])==null?void 0:s.scope)!=null?n:null,(o=(a=this.trnCtrlConfig[e[1]])==null?void 0:a.trans_print)!=null?o:null,(h=(l=this.trnCtrlConfig[e[1]])==null?void 0:l.trans_white)!=null?h:null,(f=(c=this.transformConfig[e[1]])==null?void 0:c.matrix)!=null?f:null,!!((d=this.transformConfig[e[1]])!=null&&d.matrix))}parseTransform(e){this.transformConfig[e[1]]={matrix:e[2],strokes:!!e[3]}}parseAuxLine(e){var t,i,r,s,n,a,o,l,h,c,f;this.onAuxLine(e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],this.lockConfig.some(d=>d===e[1]),this.hideConfig.some(d=>d===e[1]),this.invisibleConfig.some(d=>d===e[1]),(t=this.coverConfig[e[1]])!=null?t:null,(i=this.commentConfig[e[1]])!=null?i:null,(s=(r=this.trnCtrlConfig[e[1]])==null?void 0:r.scope)!=null?s:null,(a=(n=this.trnCtrlConfig[e[1]])==null?void 0:n.trans_print)!=null?a:null,(l=(o=this.trnCtrlConfig[e[1]])==null?void 0:o.trans_white)!=null?l:null,(c=(h=this.transformConfig[e[1]])==null?void 0:h.matrix)!=null?c:null,!!((f=this.transformConfig[e[1]])!=null&&f.matrix))}},DR=class extends dm{constructor(e={},t=[]){super(),this.symbolPartIds=e,this.device=t,this.defaultPartId="pid8a0e77bacb214e",this.curPart="",this.onlyPart="",this.partIdMap={},this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.zIndex=0,this.zIndexMap=new Map,this.cache={},this.errorIds={},this.tableCell={},this.hasPart=!1,this.components={},this.busEntryMap={},this.defaultLineStyle={strokeColor:null,strokeStyle:null,fillColor:null,strokeWidth:null,fillStyle:null},this.defaultFontStyle={color:null,fillColor:null,fontFamily:null,fontSize:null,strikeout:null,underline:null,italic:null,fontWeight:null,hAlign:null,vAlign:null}}getZIndex(e){var t;return(t=this.zIndexMap.get(e))!=null?t:null}transPinAttrKey(e){switch(e){case"NUMBER":{e="Pin Number";break}case"NAME":{e="Pin Name";break}}return e}transFontStyle(e){return{color:e.color,fillColor:e.fillColor,fontFamily:e.fontFamily,fontSize:e.fontSize,strikeout:e.strikeout,underline:e.underline,italic:e.italic,fontWeight:e.fontWeight,align:this.transAlign(e.vAlign,e.hAlign)}}transTableFontStyle(e){return{color:e.color,fillColor:e.fillColor,fontFamily:e.fontFamily,fontSize:e.fontSize,strikeout:e.strikeout,underline:e.underline,italic:e.italic,fontWeight:e.fontWeight,vAlign:this.transVAlign(e.vAlign),hAlign:this.transHAlign(e.hAlign)}}transVAlign(e){switch(e=e&&Number(e),e){case 0:return"TOP";case 1:return"MIDDLE";case 2:return"BOTTOM";default:return null}}transHAlign(e){switch(e=e&&Number(e),e){case 0:return"LEFT";case 1:return"CENTER";case 2:return"RIGHT";default:return null}}transAlign(e,t){if(e=e&&Number(e),t=t&&Number(t),t===0)switch(e){case 0:return"LEFT_TOP";case 1:return"LEFT_MIDDLE";case 2:return"LEFT_BOTTOM";default:return null}if(t===1)switch(e){case 0:return"CENTER_TOP";case 1:return"CENTER_MIDDLE";case 2:return"CENTER_BOTTOM";default:return null}if(t===2)switch(e){case 0:return"RIGHT_TOP";case 1:return"RIGHT_MIDDLE";case 2:return"RIGHT_BOTTOM";default:return null}return null}transStrokeStyle(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transFillStyle(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"SOLID";case 2:return"GRID";case 3:return"HORIZONTAL_LINE";case 4:return"VERTICAL_LINE";case 5:return"RHOMBIC";case 6:return"LEFT_SLASH_LINE";case 7:return"RIGHT_SLASH_LINE";default:return null}}transPinShape(e){switch(e=e&&Number(e),e){case 0:return"NONE";case 1:return"CLOCK";case 2:return"INVERTED";case 3:return"INVERTED_CLOCK";default:return"NONE"}}onParseLine(e){var i,r;let t=e[0];switch(t){case"DOCTYPE":this.parseDocType(e);break;case"HEAD":this.parseHead(e);break;case"GROUP":this.parseGroup(e);break;case"FONTSTYLE":this.parseFontStyle(e);break;case"LINESTYLE":this.parseLineStyle(e);break;case"TERM":break;case"PART":this.hasPart=!0,this.parsePart(e);break;case"TABEL_CELL":this.parseTableCell(e);break;case"BUSENTRY":{this.parseBusEntry(e);break}case"WIRE":case"BUS":case"TEXT":case"POLY":case"CIRCLE":case"ARC":case"RECT":case"PIN":case"OBJ":case"COMPONENT":case"ELLIPSE":case"BEZIER":case"TABLE":{this.zIndexMap.set(e[1],++this.zIndex);let s=wu(e[1]);this.cache[t]||(this.cache[t]={}),s!==null&&!this.cache[t][s]?this.cache[t][s]={part:this.curPart,value:e}:(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPart,value:e}));break}case"ATTR":{this.zIndexMap.set(e[1],++this.zIndex),e[3]==="Symbol"&&(this.components[e[2]]||(this.components[e[2]]={symbol:"",device:""}),this.components[e[2]].symbol=e[4]),e[3]==="Device"&&(this.components[e[3]]||(this.components[e[3]]={symbol:"",device:""}),this.components[e[3]].device=e[4]);let s=Object.keys(((i=this.cache)==null?void 0:i.COMPONENT)||{}).find(o=>this.cache.COMPONENT[o].value[1]===e[2]);if(s){let o=this.cache.COMPONENT[s];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:e});break}let n=Object.keys(((r=this.cache)==null?void 0:r.PIN)||{}).find(o=>this.cache.PIN[o].value[1]===e[2]);if(n){let o=this.cache.PIN[n];o.attr||(o.attr=[]),o.attr.push({part:this.curPart,value:e});break}let a=wu(e[1]);this.cache[t]||(this.cache[t]={}),a!==null?this.cache[t][a]||(this.cache[t][a]={part:this.curPart,value:e}):(this.errorIds[t]||(this.errorIds[t]=[]),this.errorIds[t].push({part:this.curPart,value:e}));break}default:console.warn("can not find hanlder with",e)}}secondParseLine(e){switch(e[0]){case"DOCTYPE":case"HEAD":case"GROUP":case"FONTSTYLE":case"LINESTYLE":break;case"ATTR":this.parseAttr(e);break;case"WIRE":this.parseWire(e);break;case"BUS":this.parseBus(e);break;case"TEXT":this.parseText(e);break;case"POLY":this.parsePoly(e);break;case"CIRCLE":this.parseCircle(e);break;case"ARC":this.parseArc(e);break;case"BUSENTRY":break;case"RECT":this.parseRect(e);break;case"PIN":this.parsePin(e);break;case"OBJ":this.parseObj(e);break;case"COMPONENT":this.parseComponent(e);break;case"ELLIPSE":this.parseEllipse(e);break;case"BEZIER":this.parseBezier(e);break;case"TABLE":this.parseTable(e);break;case"TABEL_CELL":break}}onParseEnd(){this.docType==="SYMBOL"&&!this.hasPart&&(this.curPart=this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[""]=this.curPart,this.onPart(this.curPart,{title:""}));for(let e in this.cache){let t=this.cache[e],i=Object.keys(t).sort((s,n)=>Number(s)-Number(n)),r=0;for(let s of i){let n=Number(s),a=n-r-1;a>=1&&this.onPHolder(e,a),r=n,this.curPart=this.hasPart?t[n].part||this.onlyPart:this.curPart,this.secondParseLine(t[n].value),t[n].attr&&t[n].attr.forEach(o=>{this.curPart=this.hasPart?o.part||this.onlyPart:this.curPart,this.secondParseLine(o.value)})}if(this.errorIds[e])for(let s of this.errorIds[e])this.curPart=this.hasPart?s.part||this.onlyPart:this.curPart,this.secondParseLine(s.value)}this.clearCache()}clearCache(){this.fontStyleIndex={},this.lineStyleIndex={},this.groupIndex={},this.cache={},this.errorIds={},this.curPart="",this.components={},this.tableCell={},this.hasPart=!1,this.version=void 0,this.docType=void 0}parseDocType(e){this.docType=e[1];let t=parseFloat(e[2]);this.version=t}parseHead(e){this.onCanvas(e[1])}parseFontStyle(e){this.fontStyleIndex[e[1]]={color:e[3]===""?"none":e[3],fillColor:e[2],fontFamily:e[4],fontSize:e[5],strikeout:e[9]===null?null:e[9]===1,underline:e[8]===null?null:e[8]===1,italic:e[6]===null?null:e[6]===1,fontWeight:e[7]===null?null:e[7]===1,vAlign:e[10],hAlign:e[11]}}parseLineStyle(e){this.lineStyleIndex[e[1]]={strokeColor:e[2],strokeStyle:this.transStrokeStyle(e[3]),fillColor:e[4]===""?"none":e[4],strokeWidth:e[5],fillStyle:this.transFillStyle(e[6])}}getGroupId(e){var i;let t=this;for(let r in t.groupIndex)if((i=t.groupIndex[r])!=null&&i.includes(e))return r;return""}parseBezier(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=this.getGroupId(e[1]);for(let r=0;r<e[2].length;r+=2)e[2][r+1]=Ur(e[2][r+1]);this.onBezier(e[1],this.curPart,i,!!e[4],e[2],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseGroup(e){this.groupIndex[e[1]]=e[4]||[],this.onGroup(e[1],e[2]||"",e[3]||"")}parseBus(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=e[2]||[],r=this.getGroupId(e[1]);this.onBus(e[1],this.curPart,r,!!e[4],i,t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle,this.busEntryMap[e[1]]||{})}parseWire(e){let t=this.lineStyleIndex[e[3]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=e[2]||[],r=this.getGroupId(e[1]);this.onWire(e[1],this.curPart,r,!!e[4],i,t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseText(e){let t=this.fontStyleIndex[e[6]];t||(t=this.defaultFontStyle,console.warn("font not found",e));let i=this.transFontStyle(t),r=this.getGroupId(e[1]);this.onText(e[1],this.curPart,r,!!e[7],e[2],e[3],e[4],e[5],i.color,i.fillColor,i.fontFamily,i.fontSize,i.strikeout,i.underline,i.italic,i.fontWeight,i.align)}parsePoly(e){let t=this.lineStyleIndex[e[4]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=this.getGroupId(e[1]);this.onPoly(e[1],this.curPart,i,!!e[5],e[2]||[],!!e[3],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseCircle(e){let t=this.lineStyleIndex[e[5]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=this.getGroupId(e[1]);this.onCircle(e[1],this.curPart,i,!!e[6],e[2],e[3],e[4],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseArc(e){let t=this.lineStyleIndex[e[8]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=this.getGroupId(e[1]);this.onArc(e[1],this.curPart,i,!!e[9],e[2],e[3],e[4],e[5],e[6],e[7],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseBusEntry(e){let t=e[2],i={groupId:this.getGroupId(e[1]),locked:!1,zIndex:++this.zIndex,order:e[3],pointX:e[4],pointY:Ur(e[5]),rotation:e[6]};this.busEntryMap[t]||(this.busEntryMap[t]={}),this.busEntryMap[t][e[1]]=i}parseRect(e){let t=this.lineStyleIndex[e[9]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=this.getGroupId(e[1]);this.onRect(e[1],this.curPart,i,!!e[10],e[2],e[3],e[4],e[5],e[6],e[7],e[8],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parsePin(e){let t=this.getGroupId(e[1]);this.onPin(e[1],this.curPart,t,!!e[10],!!e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.transPinShape(e[9]))}parseObj(e){let t=this.getGroupId(e[1]);this.version>=1.1?this.onObj(e[1],this.curPart,t,!!e[10],e[2],e[3],e[4],e[5],e[6],e[7],!!e[8],e[9]):this.onObj(e[1],this.curPart,t,!!e[10],e[2],e[4],e[5],e[6],e[7],e[8],!1,`data:${e[3]},${e[9]}`)}parseComponent(e){var s,n,a;let t=this.getGroupId(e[1]),i=e[2],r=this.components[e[1]];if(r){if(r.symbol){let o=this.symbolPartIds[r.symbol];o&&(i=o[e[2]]||e[2]||o[(s=Object.keys(o))==null?void 0:s[0]]||"")}else if(r.device){let o=this.device.find(h=>h.uuid===r.device),l=o?this.symbolPartIds[(n=o==null?void 0:o.attributes)==null?void 0:n.Symbol]:null;l&&(i=l[e[2]]||e[2]||l[(a=Object.keys(l))==null?void 0:a[0]]||"")}}this.onComponent(e[1],!!e[8],i,t,e[3],e[4],e[5],e[6]===1,e[7])}parseEllipse(e){let t=this.lineStyleIndex[e[7]];t||(t=this.defaultLineStyle,console.warn("style not found",e));let i=this.getGroupId(e[1]);this.onEllipse(e[1],this.curPart,i,!!e[8],e[2],e[3],e[4],e[5],e[6],t.strokeColor,t.strokeStyle,t.fillColor,t.strokeWidth,t.fillStyle)}parseTable(e){let t=this.getGroupId(e[1]);this.onTable(e[1],this.curPart,t,e[2],e[3],e[4],e[5],e[6],e[7],e[8],this.tableCell[e[1]]||[])}parseTableCell(e){let t=this.lineStyleIndex[e[8]],i=this.lineStyleIndex[e[9]],r=this.lineStyleIndex[e[10]],s=this.lineStyleIndex[e[11]],n=this.fontStyleIndex[e[12]],a=Object.assign({},n);a.color=n.fillColor,a.fillColor=n.color,(!t||!i||!r||!s||!a)&&console.warn("style not found",e);let o={id:e[1],value:e[3],rowIndex:e[4],columnIndex:e[5],rowSpan:e[6],colSpan:e[7],topStyle:t||this.defaultLineStyle,rightStyle:i||this.defaultLineStyle,bottomStyle:r||this.defaultLineStyle,leftStyle:s||this.defaultLineStyle,fontStyle:this.transTableFontStyle(a||this.defaultFontStyle),lineHeight:e[13],zIndex:++this.zIndex};this.tableCell[e[2]]||(this.tableCell[e[2]]=[]),this.tableCell[e[2]].push(o)}parseAttr(e){let t=this.fontStyleIndex[e[10]];t||(t=this.defaultFontStyle,console.warn("fontStyle not found",e));let i=this.transFontStyle(t),r=this.getGroupId(e[1]);this.onAttr(e[1],this.curPart,r,!!e[11],e[2]||"",this.transPinAttrKey(String(e[3])),e[4],e[5]===null?null:!!e[5],e[6]===null?null:!!e[6],e[7]!==null?e[7]:null,e[8]!==null?e[8]:null,e[9],i.color,i.fillColor,i.fontFamily,i.fontSize,i.strikeout,i.underline,i.italic,i.fontWeight,i.align)}parsePart(e){this.curPart=e[1]||this.defaultPartId,this.onlyPart=this.curPart,this.partIdMap[e[1]]=this.curPart;let t=Object.assign(e[2]||{},{title:e[1]||""});this.onPart(this.curPart,t)}},MR=class{constructor(){}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodeAuxLine(e,t){return{id:e,dataType:"AUXLINE",data:JSON.stringify(t)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}},Nb=class{constructor(){}editHead(e,t){let i={uuid:e.uuid,nickname:e.nickname,username:e.username,updateTime:t};return`${JSON.stringify({type:"EDIT_HEAD"})}${wn}${JSON.stringify(i)}`}head(e){return wl(this.doctype,e.client,e.doc,e.updateTime,e.version||String(e.updateTime),e.user,e.ticket)}creator(e,t){let i=typeof t=="string"?t:JSON.stringify(t);return Ds("META_CREATE",e,"META_CREATE",i)}modifier(e,t){let i=typeof t=="string"?t:JSON.stringify(t);return Ds("META_MODIFY",e,"META_MODIFY",i)}delete(e,t){let i=t||JSON.stringify({isDelete:!0});return Ds("DELETE_DOC",e,"DELETE_DOC",i)}},bm=class extends Nb{constructor(){super(...arguments),this.doctype="BLOB"}buildStr(e,t,i){let r=typeof i=="string"?i:JSON.stringify(this.buildData(i));return Ds("BLOB",e,t,r)}buildData(e){return{filename:e.filename,content:e.content}}};var Lb=class{constructor(){}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodePanelize(e){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(e)}}encodeRuleSelector(e){let t=JSON.stringify(["RULE_SELECTOR",e.ruleSelect]),i={...e};return delete i.ruleSelect,{id:t,dataType:"RULE_SELECTOR",data:JSON.stringify(i)}}encodeRule(e){let t=JSON.stringify(["RULE",e.ruleType,e.ruleName]),i={...e};return delete i.ruleType,delete i.ruleName,{id:t,dataType:"RULE",data:JSON.stringify(i)}}encodeRuleTemplate(e){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(e)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeBoss(e,t){return{id:e,dataType:"BOSS",data:JSON.stringify(t)}}encodeShellEntity(e,t){return{id:e,dataType:"SHELL_ENTITY",data:JSON.stringify(t)}}encodeShellCut(e,t){return{id:e,dataType:"SHELLCUT",data:JSON.stringify(t)}}encodeCrease(e,t){return{id:e,dataType:"CREASE",data:JSON.stringify(t)}}encodeShell(e,t){return{id:e,dataType:"SHELL",data:JSON.stringify(t)}}encodeFpcFill(e,t){return{id:e,dataType:"FPC_FILL",data:JSON.stringify(t)}}encodeTeardrop(e,t){return{id:e,dataType:"TEARDROP",data:JSON.stringify(t)}}encodeImage(e,t){return{id:e,dataType:"IMAGE",data:JSON.stringify(t)}}encodePoured(e,t){return{id:Rs(e,"POURED"),dataType:"POURED",data:JSON.stringify(t)}}encodePour(e,t){return{id:e,dataType:"POUR",data:JSON.stringify(t)}}encodeRegion(e,t){return{id:e,dataType:"REGION",data:JSON.stringify(t)}}encodeFill(e,t){return{id:e,dataType:"FILL",data:JSON.stringify(t)}}encodeLayerFill(e,t){return{id:Rs(e,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeEQLenGrp(e,t){return{id:e,dataType:"EQLEN_GRP",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodePad(e,t){return{id:e,dataType:"PAD",data:JSON.stringify(t)}}encodeVia(e,t){return{id:e,dataType:"VIA",data:JSON.stringify(t)}}encodePreference(e){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(e)}}encodeSilkOpts(e,t){return{id:Rs(e,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodePrimitive(e,t){return{id:Rs(e,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(t)}}encodeNet(e,t){return{id:Rs(e,"NET"),dataType:"NET",data:JSON.stringify(t)}}encodeActiveLayer(e){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(e)}}encodeLayerPhys(e,t){return{id:Rs(e,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(t)}}encodeLayer(e,t){return{id:Rs(e,"LAYER"),dataType:"LAYER",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}},BR=class extends cN{constructor(e=!1){super(void 0,void 0,void 0,void 0,e),this.encode=new Lb,this.maxTicket=0,this.blobEncode=new bm,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Wi+Ds(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Ds(e.dataType,++this.maxTicket,e.id,e.data)}getZIndex(e){let t=e.match(um);return t!=null&&t.length?t[1]:null}onPHolder(e,t){let i={dataType:e,max:t};this.handleData({id:ps(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(i)})}onLayerFill(e,t){this.handleData(this.encode.encodeLayerFill(e,t))}onString(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m){let O=this.getZIndex(e);this.handleData(this.encode.encodeString(Mt(e),{groupId:i,layerId:r,x:s,y:n,text:a,fontFamily:o,fontSize:l,strokeWidth:h,bold:c,italic:f,origin:d,angle:u,reverse:p,expansion:_,mirror:g,locked:b,zIndex:O===null?null:Number(O),specialColor:m}))}onAttr(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O,y,x,E,w){let S=this.getZIndex(e);S&&E&&(S=S+"."+String(E)),this.handleData(this.encode.encodeAttr(Mt(e),{groupId:i,parentId:r,layerId:s,x:n,y:a,key:o,value:l,keyVisible:h,valueVisible:c,fontFamily:f,fontSize:d,strokeWidth:u,bold:p,italic:_,origin:g,angle:b,reverse:m,expansion:O,mirror:y,locked:x,zIndex:S===null?null:Number(S),specialColor:w}))}onPadNet(e,t,i,r,s){}onComponent(e,t,i,r,s,n,a,o,l){}onPanelize(e,t,i,r,s,n,a,o,l,h){this.handleData(this.encode.encodePanelize({on:e,row:t,column:i,rowSpacing:r,columnSpacing:s,onlyOutline:n,horizontalStamp:a,verticalStamp:o,horizontalSize:l,verticalSize:h}))}onRuleSelector(e,t,i,r,s){this.handleData(this.encode.encodeRuleSelector({ruleSelect:e,ruleOrder:t,ruleKeyValue:i,copperValue:r,innerPlaneValue:s}))}onRule(e,t,i,r){this.handleData(this.encode.encodeRule({ruleType:e,ruleName:t,ruleState:i,ruleContext:r}))}onRuleTemplate(e){this.handleData(this.encode.encodeRuleTemplate({name:e}))}onDimension(e,t,i,r,s,n,a,o,l,h,c,f,d){let u=this.getZIndex(e);this.handleData(this.encode.encodeDimension(Mt(e),{type:i,layerId:r,unit:s,strokeWidth:n,precision:a,textFollow:o,coords:l,locked:h,zIndex:u===null?null:Number(u),text:c,specialColor:f,groupId:d}))}onBoss(e,t,i,r,s,n,a,o,l,h,c,f,d){let u=this.getZIndex(e);this.handleData(this.encode.encodeBoss(Mt(e),{groupId:i,layerId:r,centerX:s,centerY:n,specification:a,depth:o,thickness:l,holeDiameter:h,counterBore:c?{height:c[0],diameter:c[1]}:null,stiffener:f?{topWidth:f[0],bottomWidth:f[1],height:f[2],stiffThickness:f[3]}:null,locked:d,zIndex:u===null?null:Number(u)}))}onShellEntity(e,t,i,r,s,n,a,o,l,h,c,f){let d=this.getZIndex(e),u={groupId:i,layerId:r,type:s?"ENTITY":"SLOT",depth:o,strokeWidth:l,path:h,locked:c,zIndex:d===null?null:Number(d),refs:f};u.type==="ENTITY"&&(u.entityBelong=n),u.type==="SLOT"&&(u.slotOptions=a),this.handleData(this.encode.encodeShellEntity(Mt(e),u))}onShellCut(e,t,i,r,s,n,a,o,l){let h=this.getZIndex(e);this.handleData(this.encode.encodeShellCut(Mt(e),{groupId:i,layerId:r,depth:s,strokeWidth:n,path:a,locked:o,zIndex:h===null?null:Number(h),refs:l}))}onCrease(e,t,i,r,s,n,a,o,l,h){let c=this.getZIndex(e);this.handleData(this.encode.encodeCrease(Mt(e),{groupId:i,layerId:r,startX:s,startY:n,endX:a,endY:o,angle:l,locked:h,zIndex:c===null?null:Number(c)}))}onShell(e,t,i,r,s,n,a,o,l,h){let c=this.getZIndex(e),f={groupId:i,shellType:r,shellHeight:s,pcbHeight:n,strokeWidth:a,path:o,thickness:l.Thickness,locked:h,zIndex:c===null?null:Number(c)};r==="DRAWER"&&(f.direction=l.Direction),r==="T&B"&&(f.bottomHeight=l.BottomHeight,f.topInnerHeight=l.TopInnerHeight,f.bottomInnerHeight=l.BottomInnerHeight),this.handleData(this.encode.encodeShell(Mt(e),f))}onFpcFill(e,t,i,r,s,n,a,o){let l=this.getZIndex(e);this.handleData(this.encode.encodeFpcFill(Mt(e),{groupId:i,layerId:r,material:s,thickness:n,path:a,locked:o,zIndex:l===null?null:Number(l)}))}onTeardrop(e,t,i,r,s,n,a){this.handleData(this.encode.encodeTeardrop(Mt(e),{netName:i,layerId:r,path:s,groupId:n,refs:a,locked:!1}))}onImage(e,t,i,r,s,n,a,o,l,h,c,f,d){let u=this.getZIndex(e);this.handleData(this.encode.encodeImage(Mt(e),{groupId:i,layerId:r,startX:s,startY:n,width:a,height:o,angle:l,mirror:h,path:c,locked:f,zIndex:u===null?null:Number(u),specialColor:d}))}onPoured(e,t){this.handleData(this.encode.encodePoured(Mt(e),t))}onPour(e,t,i,r,s,n,a,o,l,h,c,f){let d=this.getZIndex(e);this.handleData(this.encode.encodePour(Mt(e),{groupId:i,netName:r,layerId:s,width:n,name:a,order:o,path:l,pourType:h,keepIsland:c,locked:f,zIndex:d===null?null:Number(d)}))}onRegion(e,t,i,r,s,n,a,o,l,h){let c=this.getZIndex(e);this.handleData(this.encode.encodeRegion(Mt(e),{groupId:i,layerId:r,width:s,prohibitType:n,path:a,locked:o,zIndex:c===null?null:Number(c),name:l,regionType:h}))}onFill(e,t,i,r,s,n,a,o,l,h,c){let f=this.getZIndex(e);this.handleData(this.encode.encodeFill(Mt(e),{groupId:i,netName:r,layerId:s,width:n,fillStyle:a,path:o,locked:l,zIndex:f===null?null:Number(f),isBridgingCopper:!1,networkList:[],refs:h,specialColor:c}))}onPoly(e,t,i,r,s,n,a,o,l){let h=this.getZIndex(e);this.handleData(this.encode.encodePoly(Mt(e),{groupId:i,netName:r,layerId:s,width:n,path:a,locked:o,zIndex:h===null?null:Number(h),specialColor:l,polyType:s==11?"BOARD_OUTLINE":"NORMAL"}))}onEQLenGrp(e,t,i,r){this.handleData(this.encode.encodeEQLenGrp(Mt(e),{name:t,sort:i,pads:r}))}onObj(e,t,i,r,s,n,a,o,l,h,c,f,d,u){if(f.startsWith("data:")){let _=Ip(f);this.blobData.push(this.blobEncode.buildStr(1,_,{filename:s,content:f})),f=`blob:${_}`}let p=this.getZIndex(e);this.handleData(this.encode.encodeObj(Mt(e),{groupId:i,layerId:r,fileName:s,startX:n,startY:a,width:o,height:l,angle:h,mirror:c,path:f,locked:d,zIndex:p===null?null:Number(p),specialColor:u}))}onArc(e,t,i,r,s,n,a,o,l,h,c,f,d){let u=this.getZIndex(e);this.handleData(this.encode.encodeArc(Mt(e),{groupId:i,netName:r,layerId:s,startX:n,startY:a,endX:o,endY:l,angle:h,width:c,locked:f,zIndex:u===null?null:Number(u),arcType:"DOT",specialColor:d}))}onCArc(e,t,i,r,s,n,a,o,l,h,c,f,d){let u=this.getZIndex(e);this.handleData(this.encode.encodeArc(Mt(e),{groupId:i,netName:r,layerId:s,startX:n,startY:a,endX:o,endY:l,angle:h,width:c,locked:f,zIndex:u===null?null:Number(u),arcType:"CENT",specialColor:d}))}onLine(e,t,i,r,s,n,a,o,l,h,c){let f=this.getZIndex(e);this.handleData(this.encode.encodeLine(Mt(e),{groupId:i,netName:r,layerId:s,startX:n,startY:a,endX:o,endY:l,width:h,locked:c,zIndex:f===null?null:Number(f)}))}onPad(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O,y,x,E,w,S,C,R){let B=this.getZIndex(e);this.handleData(this.encode.encodePad(Mt(e),{groupId:i,netName:r,layerId:s,num:n,centerX:a,centerY:o,padAngle:l,hole:h,defaultPad:c,specialPad:f,padOffsetX:d,padOffsetY:u,relativeAngle:p,plated:_,padType:g,topSolderExpansion:b,bottomSolderExpansion:m,topPasteExpansion:O,bottomPasteExpansion:y,locked:x,zIndex:B===null?null:Number(B),connectMode:E,spokeSpace:w,spokeWidth:S,spokeAngle:C,unusedInnerLayers:R,padLen:0}))}onVia(e,t,i,r,s,n,a,o,l,h,c,f,d,u){let p=this.getZIndex(e);this.handleData(this.encode.encodeVia(Mt(e),{groupId:i,netName:r,ruleName:s,centerX:n,centerY:a,holeDiameter:o,viaDiameter:l,viaType:h,topSolderExpansion:c,bottomSolderExpansion:f,locked:d,zIndex:p===null?null:Number(p),unusedInnerLayers:u}))}onPreference(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O){this.handleData(this.encode.encodePreference({startTrackWidthFollowLast:e,lastTrackWidth:t,startViaSizeFollowLast:i,lastViaInnerDiameter:r,lastViaDiameter:s,snap:n,routingMode:a,routingCorner:o,removeLoop:l,rotatingObject:h,trackFollow:c,stretchTrackMinCorner:f,preferenceConfig:d,realTimeUpdateUnusedLayers:u,unusedPadRange:p,pushVia:_,pathOptimization4BePushed:g,currentPathOptimization4BePushed:b,removeCircuitsContainingVias:m,removeAntenna:O}))}onSilkOpts(e,t,i){this.handleData(this.encode.encodeSilkOpts(e,{defaultColor:t,baseColor:i}))}onGroup(e,t){this.handleData(this.encode.encodeGroup(e,{groupName:t}))}onPrimitive(e,t,i){this.handleData(this.encode.encodePrimitive(e,{display:t,pick:i}))}onNet(e,t,i,r,s,n,a){this.handleData(this.encode.encodeNet(e,{netType:t,specialColor:i,retLine:r,differentialName:s,isPositiveNet:n,equalLengthGroupName:a}))}onPartition(e,t,i,r){}onActiveLayer(e){this.handleData(this.encode.encodeActiveLayer({layerId:e}))}onLayerPhys(e,t,i,r,s,n,a){this.handleData(this.encode.encodeLayerPhys(e,{material:t,thickness:i,permittivity:r,lossTangent:s,isKeepIsland:n,zIndex:a}))}onLayer(e,t,i,r,s,n,a,o,l,h){this.handleData(this.encode.encodeLayer(e,{layerType:t,layerName:i,use:r,show:s,locked:n,activeColor:a,activateTransparency:o,inactiveColor:l,inactiveTransparency:h}))}onCanvas(e,t,i,r,s,n,a,o,l,h,c,f){this.handleData(this.encode.encodeCanvas({originX:e,originY:t,unit:i,gridXSize:r,gridYSize:s,snapXSize:n,snapYSize:a,altSnapXSize:o,altSnapYSize:l,gridType:h,multiGridType:c,multiGridRatio:f,highlightValue:.5}))}};function kR(e,t,i,r=new Date().getTime(),s=String(r),n){let a=new BR(i),o="",l=ps();if(o=wl("FOOTPRINT",l,e,r,s,n),a.parseFull(t),a.encodeData&&(o=o+Wi+a.encodeData),a.blobData.length&&(o=o+Wi+a.blobEncode.head({doc:"BLOB",client:l,updateTime:r,version:s,user:n})+Wi+a.blobData.join(Wi)),a.fontCache.length){let h=new zR,c=h.head({doc:"FONT",client:l,updateTime:r,version:s,user:n});for(let f of a.fontCache){let d=kO(f.text,f.fontFamily,f.fontSize,f.thickness,f.bold,f.italic,f.reverse,f.expansion),u=h.buildStr(1,d,f);c=c+Wi+u}o=c+Wi+o}return o}var UR=class{constructor(){}encodePart(e,t){return{id:e,dataType:"PART",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodeTable(e,t){return{id:e,dataType:"TABLE",data:JSON.stringify(t)}}encodeEllipse(e,t){return{id:e,dataType:"ELLIPSE",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodePin(e,t){return{id:e,dataType:"PIN",data:JSON.stringify(t)}}encodeRect(e,t){return{id:e,dataType:"RECT",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeCircle(e,t){return{id:e,dataType:"CIRCLE",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeText(e,t){return{id:e,dataType:"TEXT",data:JSON.stringify(t)}}encodeBezier(e,t){return{id:e,dataType:"BEZIER",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}},FR=class extends DR{constructor(){super(),this.encode=new UR,this.maxTicket=0,this.blobEncode=new bm,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Wi+Ds(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Ds(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let i={dataType:e,max:t};this.handleData({id:ps(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(i)})}onPart(e,t){this.handleData(this.encode.encodePart(e,t||{}))}onAttr(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O,y){this.handleData(this.encode.encodeAttr(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),parentId:s,key:n,value:a,keyVisible:o,valueVisible:l,x:h,y:Ur(c),rotation:f,color:d,fillColor:u,fontFamily:p,fontSize:_,strikeout:g,underline:b,italic:m,fontWeight:O,align:y,version:"2.0"}))}onTable(e,t,i,r,s,n,a,o,l,h,c){this.handleData(this.encode.encodeTable(Mt(e),{partId:t,groupId:i,startX:r,startY:Ur(s),rowSizes:n,colSizes:a,rowLocked:o,colLocked:l,rotation:h,tableCell:c,zIndex:this.getZIndex(e)}))}onEllipse(e,t,i,r,s,n,a,o,l,h,c,f,d,u){this.handleData(this.encode.encodeEllipse(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),centerX:s,centerY:Ur(n),radiusX:a,radiusY:Ur(o),rotation:l,strokeColor:h,strokeStyle:c,fillColor:f,strokeWidth:d,fillStyle:u}))}onComponent(){}onObj(e,t,i,r,s,n,a,o,l,h,c,f){if(f.startsWith("data:")){let d=Ip(f);this.blobData.push(this.blobEncode.buildStr(1,d,{filename:"",content:f})),f=`blob:${d}`}this.handleData(this.encode.encodeObj(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),fileName:s,startX:n,startY:Ur(a),width:o,height:l,rotation:h,isMirror:c,content:f}))}onPin(e,t,i,r,s,n,a,o,l,h,c,f){this.handleData(this.encode.encodePin(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),display:s,x:a,y:Ur(o),length:l,rotation:h,color:c,pinShape:f}))}onRect(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_){this.handleData(this.encode.encodeRect(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),dotX1:s,dotY1:Ur(n),dotX2:a,dotY2:Ur(o),radiusX:l,radiusY:h,rotation:c,strokeColor:f,strokeStyle:d,fillColor:u,strokeWidth:p,fillStyle:_}))}onArc(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p){this.handleData(this.encode.encodeArc(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),startX:s,startY:Ur(n),referX:a,referY:Ur(o),endX:l,endY:Ur(h),strokeColor:c,strokeStyle:f,fillColor:d,strokeWidth:u,fillStyle:p}))}onCircle(e,t,i,r,s,n,a,o,l,h,c,f){this.handleData(this.encode.encodeCircle(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),centerX:s,centerY:Ur(n),radius:a,strokeColor:o,strokeStyle:l,fillColor:h,strokeWidth:c,fillStyle:f}))}onPoly(e,t,i,r,s,n,a,o,l,h,c){this.handleData(this.encode.encodePoly(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),points:XA(s,!0),closed:n,strokeColor:a,strokeStyle:o,fillColor:l,strokeWidth:h,fillStyle:c}))}onText(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g){this.handleData(this.encode.encodeText(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),x:s,y:Ur(n),rotation:a,value:o,color:l,fillColor:h,fontFamily:c,fontSize:f,strikeout:d,underline:u,italic:p,fontWeight:_,align:g,version:"2.0"}))}onCanvas(e){this.handleData(this.encode.encodeCanvas({originX:e.originX,originY:Ur(e.originY)}))}onBezier(e,t,i,r,s,n,a,o,l,h){this.handleData(this.encode.encodeBezier(Mt(e),{partId:t,groupId:i,locked:r,zIndex:this.getZIndex(e),controls:s,strokeColor:n,strokeStyle:a,fillColor:o,strokeWidth:l,fillStyle:h}))}onGroup(e,t,i){this.handleData(this.encode.encodeGroup(String(e),{parentId:t,title:i}))}onBus(){}onWire(){}};function GR(e,t,i=new Date().getTime(),r=String(i),s){let n=new FR,a="";n.parseFull(t);let o=ps();n.encodeData&&(a=wl("SYMBOL",o,e,i,r,s)+Wi+n.encodeData),a&&n.blobData.length&&(a=a+Wi+n.blobEncode.head({doc:"BLOB",client:o,updateTime:i,version:r,user:s})+Wi+n.blobData.join(Wi));let l=n.partIdMap;return n.partIdMap={},{dataStr:a,partIdMap:l}}var zR=class extends Nb{constructor(){super(...arguments),this.doctype="FONT"}buildStr(e,t,i){let r=typeof i=="string"?i:JSON.stringify(this.buildData(i));return Ds("FONT",e,t,r)}buildData(e){return{width:e.width,height:e.height,path:e.path}}};var HR=class extends RR{constructor(){super(),this.encode=new MR,this.maxTicket=0,this.blobEncode=new bm,this.blobData=[],this.encodeData=""}handleData(e){this.encodeData?this.encodeData=this.encodeData+Wi+Ds(e.dataType,++this.maxTicket,e.id,e.data):this.encodeData=Ds(e.dataType,++this.maxTicket,e.id,e.data)}onPHolder(e,t){let i={dataType:e,max:t};this.handleData({id:ps(),dataType:"ELE_PLACEHOLDER",data:JSON.stringify(i)})}strokeStyleType(e){switch(e=e&&Number(e),e){case 0:return"SOLID";case 1:return"SHORT_DASH";case 2:return"DOT";case 3:return"DOT_DASH";default:return null}}transScopeType(e){switch(e=e&&Number(e),e){case 1:return"PRINT";case 2:return"COVER";case 3:return"PRINT&COVER";default:return null}}transAlignType(e){switch(e=e&&Number(e),e){case 0:return"LEFT_BOTTOM";case 1:return"CENTER_BOTTOM";case 2:return"RIGHT_BOTTOM";case 3:return"LEFT_MIDDLE";case 4:return"CENTER_MIDDLE";case 5:return"RIGHT_MIDDLE";case 6:return"LEFT_TOP";case 7:return"CENTER_TOP";case 8:return"RIGHT_TOP";default:return null}}onAuxLine(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O){this.handleData(this.encode.encodeAuxLine(Mt(e),{groupId:t?`e${t}`:"",layer:i,x:r,y:s,rotation:n,strokeWidth:a,strokeStyle:this.strokeStyleType(o),color:l,length:h,locked:c,zIndex:this.getZIndex(e),visible:!d,cover:u,name:p}))}onDimension(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b){this.handleData(this.encode.encodeDimension(Mt(e),{layer:t,dimensionType:i,unit:r,strokeWidth:s,accuracy:n,controlDot:a,relationIds:o,locked:l,zIndex:this.getZIndex(e),valid:!h,visible:!c,cover:f,name:d,rotation:0}))}onString(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O,y,x,E,w,S){this.handleData(this.encode.encodeString(Mt(e),{groupId:t?`e${t}`:"",layer:i,rotation:r,value:s,fontFamily:n,fontSize:a,fontWeight:o,italic:l,underline:h,strikeout:c,align:this.transAlignType(f),strokeColor:d,opacity:u,locked:p,zIndex:this.getZIndex(e),valid:!_,visible:!g,cover:b,transScope:this.transScopeType(O),transPrint:y,transWhite:x,matrix:E,strokes:w,path:S,name:m}))}onPoly(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O,y,x){if(typeof o=="string"&&o.startsWith("data:")){let E=Ip(o);this.blobData.push(this.blobEncode.buildStr(1,E,{filename:"",content:o})),o=`blob:${E}`}this.handleData(this.encode.encodePoly(Mt(e),{groupId:t?`e${t}`:"",layer:i,rotation:r,strokeWidth:s,strokeStyle:this.strokeStyleType(n),strokeColor:a,fillColor:o,opacity:l,autoClose:h,ploys:c,displayFill:f,displayStroke:d,locked:u,zIndex:this.getZIndex(e),valid:!p,visible:!_,cover:g,transScope:this.transScopeType(m),transPrint:O,transWhite:y,matrix:x,name:b}))}onGroup(e,t,i,r,s){this.handleData(this.encode.encodeGroup(`e${e}`,{parentId:t?`e${t}`:"",title:i,visible:r,locked:s}))}onCanvas(e){this.handleData(this.encode.encodeCanvas(e))}};function jR(e,t,i,r=new Date().getTime(),s=String(r),n){let a=new HR,o="";a.parseFull(t);let l=ps();return a.encodeData&&(o=wl(i,l,e,r,s,n)+Wi+a.encodeData),o&&a.blobData.length&&(o=o+Wi+a.blobEncode.head({doc:"BLOB",client:l,updateTime:r,version:s,user:n})+Wi+a.blobData.join(Wi)),o}var Rb=class extends jC{constructor(e){let t=e||new $2;super(t,0,KA),this.cacheNum=null}onParseLine(e,t,i,r,s,n,a){switch(this.setOrderNum(e,a,t),this.cacheNum=a,t){case"MAX_NUM":if(i)for(let l in i)this.setMaxNum(l,i[l]);break;case"BLOB":i?this.onBlob(e,r,s,i,n):this.onDelBlob(e,r,s,n);break;case"FONT":this.parseFont(e,i,r,s,n);break;case"META":i&&this.parseDetail(i,r,s,n);break;case"ELE_PLACEHOLDER":break;case"CANVAS":i&&this.parseCanvas(i,r,s,n);break;case"BOARD":i?this.parseBoard(i,r,s,n):this.onDelBoard(r,s,n);break;case"LAYER":{let l=Eo(e);i?this.parseLayer(l,i,r,s,n):this.onDelLayer(l,r,s,n);break}case"LAYER_PHYS":{let l=Eo(e);i?this.parseLayerPhys(l,i,r,s,n):this.onDelLayerPhys(l,r,s,n);break}case"ACTIVE_LAYER":i&&this.parseActiveLayer(e,i,r,s,n);break;case"PARTITION":i?this.parsePartition(e,i,r,s,n):this.onDelPartition(e,r,s,n);break;case"NET":{let l=Eo(e);i?this.parseNet(l,i,r,s,n):this.onDelNet(l,r,s,n);break}case"PRIMITIVE":{let l=Eo(e);i?this.parsePrimitive(l,i,r,s,n):this.onDelPrimitive(l,r,s,n);break}case"GROUP":i?this.parseGroup(e,i,r,s,n):this.onDelGroup(e,r,s,n);break;case"SILK_OPTS":{let l=Eo(e);i?this.parseSilkOpts(l,i,r,s,n):this.onDelSilkOpts(l,r,s,n);break}case"PREFERENCE":i&&this.parsePreference(e,i,r,s,n);break;case"VIA":i?this.parseVia(e,i,r,s,n):this.onDelVia(e,r,s,n);break;case"PAD":i?this.parsePad(e,i,r,s,n):this.onDelPad(e,r,s,n);break;case"LINE":i?this.parseLine(e,i,r,s,n):this.onDelLine(e,r,s,n);break;case"ARC":i?this.parseArc(e,i,r,s,n):this.onDelArc(e,r,s,n);break;case"OBJ":i?this.parseObj(e,i,r,s,n):this.onDelObj(e,r,s,n);break;case"EQLEN_GRP":i?this.parseEQLenGrp(e,i,r,s,n):this.onDelEQLenGrp(e,r,s,n);break;case"POLY":i?this.parsePoly(e,i,r,s,n):this.onDelPoly(e,r,s,n);break;case"FILL":i?this.parseFill(e,i,r,s,n):this.onDelFill(e,r,s,n);break;case"LAYER_FILL":let o=Eo(e);i?this.parseLayerFill(o,i,r,s,n):this.onDelLayerFill(o,r,s,n);break;case"REGION":i?this.parseRegion(e,i,r,s,n):this.onDelRegion(e,r,s,n);break;case"POUR":i?this.parsePour(e,i,r,s,n):this.onDelPour(e,r,s,n);break;case"POURED":{e=Eo(e),i?this.parsePoured(e,i,r,s,n):this.onDelPoured(e,r,s,n);break}case"IMAGE":i?this.parseImage(e,i,r,s,n):this.onDelImage(e,r,s,n);break;case"TEARDROP":i?this.parseTeardrop(e,i,r,s,n):this.onDelTeardrop(e,r,s,n);break;case"FPC_FILL":i?this.parseFpcFill(e,i,r,s,n):this.onDelFpcFill(e,r,s,n);break;case"SHELL":i?this.parseShell(e,i,r,s,n):this.onDelShell(e,r,s,n);break;case"CREASE":i?this.parseCrease(e,i,r,s,n):this.onDelCrease(e,r,s,n);break;case"SHELLCUT":i?this.parseShellCut(e,i,r,s,n):this.onDelShellCut(e,r,s,n);break;case"SHELL_ENTITY":i?this.parseShellEntity(e,i,r,s,n):this.onDelShellEntity(e,r,s,n);break;case"BOSS":i?this.parseBoss(e,i,r,s,n):this.onDelBoss(e,r,s,n);break;case"STRING":i?this.parseString(e,i,r,s,n):this.onDelString(e,r,s,n);break;case"ATTR":i?this.parseAttr(e,i,r,s,n):this.onDelAttr(e,r,s,n);break;case"DIMENSION":i?this.parseDimension(e,i,r,s,n):this.onDelDimension(e,r,s,n);break;case"COMPONENT":i?this.parseComponent(e,i,r,s,n):this.onDelComponent(e,r,s,n);break;case"PAD_NET":{let l=JSON.parse(e);i?(i.componentId=l[1],i.padNum=l[2],i.padId=l[3],this.parsePadNet(i,r,s,n)):this.onDelPadNet(l[1],l[2],l[3]||"",r,s,n);break}case"RULE_TEMPLATE":i&&this.parseRuleTemplate(e,i,r,s,n);break;case"RULE":{let l=JSON.parse(e);i?(i.ruleType=l[1],i.ruleName=l[2],this.parseRule(i,r,s,n)):this.onDelRule(l[1],l[2],r,s,n);break}case"RULE_SELECTOR":{let l=JSON.parse(e);i?(i.ruleSelect=l[1],this.parseRuleSelector(i,r,s,n)):this.onDelRuleSelector(l[1],r,s,n);break}case"PANELIZE":i?this.parsePanelize(e,i,r,s,n):this.onDelPanelize(r,s,n);break;default:console.warn("can not find hanlder with",i,r,s)}this.cacheNum=null}onOrderNum(e,t,i){switch(this.setOrderNum(e,i,t),t){case"PARTITION":this.onPartitionNum&&this.onPartitionNum(e,i);break;case"VIA":this.onViaNum&&this.onViaNum(e,i);break;case"PAD":this.onPadNum&&this.onPadNum(e,i);break;case"LINE":this.onLineNum&&this.onLineNum(e,i);break;case"ARC":this.onArcNum&&this.onArcNum(e,i);break;case"OBJ":this.onObjNum&&this.onObjNum(e,i);break;case"POLY":this.onPolyNum&&this.onPolyNum(e,i);break;case"FILL":this.onFillNum&&this.onFillNum(e,i);break;case"REGION":this.onRegionNum&&this.onRegionNum(e,i);break;case"POUR":this.onPourNum&&this.onPourNum(e,i);break;case"POURED":let r=Eo(e);this.onPouredNum&&this.onPouredNum(r,i);break;case"IMAGE":this.onImageNum&&this.onImageNum(e,i);break;case"TEARDROP":this.onTeardropNum&&this.onTeardropNum(e,i);break;case"FPC_FILL":this.onFpcFillNum&&this.onFpcFillNum(e,i);break;case"SHELL":this.onShellNum&&this.onShellNum(e,i);break;case"CREASE":this.onCreaseNum&&this.onCreaseNum(e,i);break;case"SHELLCUT":this.onShellCutNum&&this.onShellCutNum(e,i);break;case"SHELL_ENTITY":this.onShellEntityNum&&this.onShellEntityNum(e,i);break;case"BOSS":this.onBossNum&&this.onBossNum(e,i);break;case"STRING":this.onStringNum&&this.onStringNum(e,i);break;case"ATTR":this.onAttrNum&&this.onAttrNum(e,i);break;case"DIMENSION":this.onDimensionNum&&this.onDimensionNum(e,i);break;case"COMPONENT":this.onComponentNum&&this.onComponentNum(e,i);break}}onParseEnd(){}parseCanvas(e,t,i,r){this.onCanvas(t,i,e,r)}parseBoard(e,t,i,r){this.onBoard(e,t,i,r)}parseDetail(e,t,i,r){this.onDocDetail(t,i,e,r)}parseFont(e,t,i,r,s){let n=zC(e);t?this.onFont(i,r,Object.assign(t,n),s):this.onDelFont(n,i,r,s)}parseLayer(e,t,i,r,s){this.onLayer(e,i,r,t,s)}parseLayerPhys(e,t,i,r,s){this.onLayerPhys(e,i,r,t,s)}parseActiveLayer(e,t,i,r,s){this.onActiveLayer(i,r,t,s)}parsePartition(e,t,i,r,s){this.onPartition(e,this.cacheNum,i,r,t,s)}parseNet(e,t,i,r,s){this.onNet(e,i,r,t,s)}parsePrimitive(e,t,i,r,s){this.onPrimitive(e,i,r,t,s)}parseGroup(e,t,i,r,s){this.onGroup(e,i,r,t,s)}parseSilkOpts(e,t,i,r,s){this.onSilkOpts(e,i,r,t,s)}parsePreference(e,t,i,r,s){this.onPreference(i,r,t,s)}parseVia(e,t,i,r,s){this.onVia(e,this.cacheNum,i,r,t,s)}parsePad(e,t,i,r,s){this.onPad(e,this.cacheNum,i,r,t,s)}parseLine(e,t,i,r,s){this.onLine(e,this.cacheNum,i,r,t,s)}parseArc(e,t,i,r,s){this.onArc(e,this.cacheNum,i,r,t,s)}parseObj(e,t,i,r,s){this.onObj(e,this.cacheNum,i,r,t,s)}parseEQLenGrp(e,t,i,r,s){this.onEQLenGrp(e,i,r,t,s)}parsePoly(e,t,i,r,s){this.onPoly(e,this.cacheNum,i,r,t,s)}parseFill(e,t,i,r,s){t.fillStyle!=="PLANE"&&this.onFill(e,this.cacheNum,i,r,t,s)}parseLayerFill(e,t,i,r,s){this.onLayerFill(e,i,r,t,s)}parseRegion(e,t,i,r,s){this.onRegion(e,this.cacheNum,i,r,t,s)}parsePour(e,t,i,r,s){this.onPour(e,this.cacheNum,i,r,t,s)}parsePoured(e,t,i,r,s){let n=t;Array.isArray(t)&&(n={pourFill:t}),n.pourFill&&this.onPoured(e,this.cacheNum,i,r,n,s)}parseImage(e,t,i,r,s){this.onImage(e,this.cacheNum,i,r,t,s)}parseTeardrop(e,t,i,r,s){this.onTeardrop(e,this.cacheNum,i,r,t,s)}parseFpcFill(e,t,i,r,s){this.onFpcFill(e,this.cacheNum,i,r,t,s)}parseShell(e,t,i,r,s){this.onShell(e,this.cacheNum,i,r,t,s)}parseCrease(e,t,i,r,s){this.onCrease(e,this.cacheNum,i,r,t,s)}parseShellCut(e,t,i,r,s){this.onShellCut(e,this.cacheNum,i,r,t,s)}parseShellEntity(e,t,i,r,s){this.onShellEntity(e,this.cacheNum,i,r,t,s)}parseBoss(e,t,i,r,s){this.onBoss(e,this.cacheNum,i,r,t,s)}parseDimension(e,t,i,r,s){this.onDimension(e,this.cacheNum,i,r,t,s)}parseRuleTemplate(e,t,i,r,s){this.onRuleTemplate(i,r,t,s)}parseRule(e,t,i,r){this.onRule(t,i,e,r)}parseRuleSelector(e,t,i,r){if(e.ruleKeyValue&&(e.ruleKeyValue=bh(e.ruleKeyValue)),e.copperValue&&e.copperValue.hasOwnProperty("7")){let s=e.copperValue[7];delete e.copperValue[7],e.copperValue.COPPER=s}if(e.innerPlaneValue&&e.innerPlaneValue.hasOwnProperty("6")){let s=e.innerPlaneValue[6];delete e.innerPlaneValue[6],e.innerPlaneValue.PLANE=s}this.onRuleSelector(t,i,e,r)}parsePanelize(e,t,i,r,s){this.onPanelize(i,r,t,s)}parseComponent(e,t,i,r,s){this.onComponent(e,this.cacheNum,i,r,t,s)}parsePadNet(e,t,i,r){this.onPadNet(t,i,e,r)}parseAttr(e,t,i,r,s){this.onAttr(e,this.cacheNum,i,r,t,s)}parseString(e,t,i,r,s){this.onString(e,this.cacheNum,i,r,t,s)}};var YR=(e=>(e.UNIVERSAL="UNIVERSAL",e))(YR||{}),VR=(e=>(e.SINGLE="SINGLE",e.MULTIPLE="MULTIPLE",e))(VR||{}),qR=(e=>(e.NONE="NONE",e.NAME="NAME",e.NUMBER="NUMBER",e))(qR||{}),XR=(e=>(e.NONE="NONE",e.ZONE="ZONE",e))(XR||{});var WR=Gh(Mu());function Au(){return self.EDITOR_TOP||self}function Dh(e){return self[e]=self[e]||new WR.BroadcastChannelMessageBus(e)}var bl=(e,t)=>{let i=/{([^}]*)}/gim,r=[...new Set(e.match(i))];for(let s=0;s<r.length;s++){let n=r[s],a=n.substring(1,n.length-1);t[a]&&(e=e.replace(n,t[a]))}return e};var hi={getTime:"/pro-mgr/serverTime/now",getUserL:"/pro-ui/loginUser/get",subMaxTick:"/pro-mgr/project/ticket",subBlob:"/pro-mgr/canvas/BLOB/update",subFont:"/pro-mgr/canvas/FONT/update",subRevoke:"/pro-mgr/{uuid}/revoke",pushPend:"/pro-mgr/worker/batchPendData",pushSync:"/pro-mgr/dataWorker/sync",pushRevoke:"/pro-mgr/worker/revoke",pullASync:"/pro-mgr/dataWorker/sync/{id}",personDestroy:"/mgr/libWorker/destroy",projectUpdate:"/pro-mgr/canvas/{uuid}/update",personUpdate:"/mgr/libWorker/component/{uuid}/update",personSave:"/mgr/libWorker/save",projectSave:"/mgr/projectWorker/setCanvas",canSavePend:"/mgr/projectWorker/canSavePend",hasSaveData:"/mgr/check/hasSaveData"},JR={projectUpdate:hi.projectUpdate,personUpdate:hi.personUpdate,projectCanSave:hi.canSavePend,getProject:"/mgr/projectWorker/footprint/getCanvas",getPerson:"/mgr/libWorker/getFootprint",unwatch:"/mgr/projectWorker/footprint/unwatchCanvas"},ZR={projectUpdate:hi.projectUpdate,projectCanSave:hi.canSavePend,getProject:"/mgr/projectWorker/pcb/getCanvas",unwatch:"/mgr/projectWorker/pcb/unwatchCanvas"},Yq={projectUpdate:hi.projectUpdate,projectCanSave:hi.canSavePend,getProject:"/mgr/projectWorker/sheet/getCanvas",unwatch:"/mgr/projectWorker/sheet/unwatchCanvas"},Vq={projectUpdate:hi.projectUpdate,getProject:"/mgr/projectWorker/schematic/getCanvas",unwatch:"/mgr/projectWorker/schematic/unwatchCanvas"},qq={projectUpdate:hi.projectUpdate,projectCanSave:hi.canSavePend,getProject:"/mgr/projectWorker/simulation/getCanvas",unwatch:"/mgr/projectWorker/simulation/unwatchCanvas"},Xq={projectUpdate:hi.projectUpdate,personUpdate:hi.personUpdate,projectCanSave:hi.canSavePend,getProject:"/mgr/projectWorker/symbol/getCanvasOnCompiler",getPerson:"/mgr/libWorker/getSymbol",unwatch:"/mgr/projectWorker/symbol/unwatchCanvas"},Wq={projectUpdate:hi.projectUpdate,personUpdate:hi.personUpdate,projectCanSave:hi.canSavePend,getProject:"/mgr/projectWorker/panel/getCanvas",getPerson:"/mgr/libWorker/getPanelLib",unwatch:"/mgr/projectWorker/panel/unwatchCanvas"};var Cs={send:"/pro-mgr/notify/send",sendMsg:"/document/sendMsg/cooperation",unwatch:"/document/unwatch/cooperation",watch:"/document/watch/cooperation",message:"/pro-mgr/notify/message/{path}/{uuid}/cooperation",established:"/pro-mgr/notify/message/ws/established",getWsId:"/pro-mgr/notify/getWsId",disconnect:"/pro-mgr/notify/message/ws/disconnect"},xm=class{constructor(e=!0){this._lockerTicket=0,this.isPull=!1,this.compiler={},this.order={SYMBOL:1,FOOTPRINT:2,DEVICE:3,SCH_PAGE:4,PCB:5},this._locker=e?++this._lockerTicket:0}getOrder(e){return this.order[e]||6}publish(){if(!this.isPull){this.isPull=!0,this._temporaryUnlock=this._locker;try{let e=Object.keys(this.compiler).sort((i,r)=>this.getOrder(i)-this.getOrder(r)),t=!1;for(let i of e){for(let[,r]of this.compiler[i])if(t=r.publish(),t)break;if(t)break}}finally{this._temporaryUnlock=0,this.isPull=!1}}}canPush(){return!this._locker||this._locker===this._temporaryUnlock}addCompiler(e){this.compiler[e.headType]||(this.compiler[e.headType]=new Map),this.compiler[e.headType].set(e.uniqueId,e)}removeCompiler(e){var t,i,r;(r=(i=(t=this.compiler)==null?void 0:t[e.headType])==null?void 0:i.delete)==null||r.call(i,e.uniqueId)}pull(){if(!this._locker)throw Error("\u4E0D\u5141\u8BB8\u5728\u975E pause \u72B6\u6001\u4E0B\u62C9\u53D6\u6570\u636E");this.publish()}resume(){this._locker=0,this.publish()}pause(){this._locker=++this._lockerTicket}dispose(){for(let e in this.compiler)this.compiler[e].clear();this.compiler=null}},wo={publish:"publish",destroy:"destroy",init:"init",selected:"selected"},KR=class{constructor(e,t,i,r=(a=>(a=Au())==null?void 0:a._TAB_ID_)(),s,n){var o;this.uuid=e,this.path=t,this.user=i,this.windowId=r,this.initIds={},this.sub=[],this.wsBus=n||Dh(`/${this.windowId}/notify`),this.dataBus=s||this.wsBus,this._client=(o=Au())==null?void 0:o._WS_ID_}get client(){return this._client}watch(){this.dataBus.publish(Cs.send,{topic:Cs.watch,uuid:this.uuid,path:this.path})}initPublish(){var e;this.dataBus.publish(Cs.send,{topic:Cs.sendMsg,uuid:this.uuid,path:this.path,msg:{type:wo.publish,user:this.user,client:this.client,data:((e=this.getSelect)==null?void 0:e.call(this))||""}})}async init(){if(!this.isInit){if(this.sub.push(this.wsBus.subscribe(Cs.established,e=>{this._client=e,this.watch(),this.initPublish()})),!this.client){let e=await this.wsBus.rpcCall(Cs.getWsId);if(!e||this.client)return;this._client=e}this.watch(),this.sub.push(this.wsBus.subscribe(Cs.disconnect,e=>{this.initIds[e]&&this.onDestroy(this.initIds[e],e)})),this.sub.push(this.dataBus.subscribe(bl(Cs.message,{uuid:this.uuid,path:this.path}),e=>{if(e.type===1)e.connectId&&this.initIds[e.connectId]&&this.onDestroy(this.initIds[e.connectId],e.connectId);else if(e.msg){let t=e.msg;if(t.client===this.client)return;switch(t.type){case wo.destroy:this.onDestroy(t.userId,t.client),delete this.initIds[t.client];break;case wo.init:this.initIds[t.client]||(this.initIds[t.client]=t.user.uuid,this.onSelected(t.user,t.client,t.data||""));break;case wo.selected:this.onSelected(t.user,t.client,t.data||"");break;case wo.publish:this.dataBus.publish(Cs.send,{topic:Cs.sendMsg,uuid:this.uuid,path:this.path,msg:{type:wo.init,user:this.user,client:this.client,data:this.getSelect()||""}}),this.initIds[t.client]=t.user.uuid,this.onSelected(t.user,t.client,t.data||"");break;default:break}}})),this.initPublish(),this.isInit=!0}}publishSelected(e,t){this.dataBus.publish(Cs.send,{topic:Cs.sendMsg,uuid:this.uuid,path:this.path,msg:{type:wo.selected,user:this.user,client:this.client,data:e}}),t&&this.onSelected(this.user,this.client,e)}destroy(){if(this.isInit){this.isInit=!1,this.dataBus.publish(Cs.send,{topic:Cs.unwatch,uuid:this.uuid,path:this.path,msg:{type:wo.destroy,userId:this.user.uuid,client:this.client}});for(let e of this.sub)e.cancel();this.sub=[],this.initIds={}}}},P2=class extends KR{constructor(e,t,i,r,s,n,a,o){super(e,t,o,i,s,n),this.channel=r,this.selectedProps=a,this.cache=new Map,this.deleteCache=new Map}rePublish(){var e,t,i,r;if(this.channel.canPush()){for(let[s,n]of this.cache)(t=(e=this.selectedProps)==null?void 0:e.onSelect)==null||t.call(e,n.user,s,n.data);for(let[s,n]of this.deleteCache)(r=(i=this.selectedProps)==null?void 0:i.onQuit)==null||r.call(i,n,s)}}getSelect(){var e,t;return((t=(e=this.selectedProps)==null?void 0:e.getSelect)==null?void 0:t.call(e))||""}onSelected(e,t,i){var r,s;this.channel.canPush()?!this.deleteCache.has(t)&&this.cache.set(t,{user:e,data:i}):(s=(r=this.selectedProps)==null?void 0:r.onSelect)==null||s.call(r,e,t,i)}onDestroy(e,t){var i,r;this.channel.canPush()?(this.deleteCache.set(t,e),this.cache.delete(t)):(r=(i=this.selectedProps)==null?void 0:i.onQuit)==null||r.call(i,e,t)}dispose(){this.destroy(),this.cache.clear(),this.deleteCache.clear()}publishSelected(e,t){super.publishSelected(e,t)}},$R=Gh(Mu()),QR=class{constructor(e,t,i,r=(b=>(b=Au())==null?void 0:b._TAB_ID_)(),s=new xm,n=null,a,o,l,h,c,f,d,u,p,_,g){this.uuid=e,this.path=t,this.isProject=i,this.windowId=r,this.channel=s,this.consistencyManager=n,this.selectedProps=l,this.setInit=h,this.onDocDetail=c,this.onUpdate=f,this.handleInit=d,this.onDelete=u,this.publishCache=p,this.onOrderNm=_,this.setMaxNum=g,this.isInit=!1,this.canSave=!0,this.sub=[],this.isInitIng=!1,this.cache={},this.deleteCache=new Map,this.pendTimer=null,this.pendCache={},this.pendCacheLength=0,this.wsBus=Dh(`/${r}/notify`),n||(this._unique=ps()),this._headType=a,this.busTopic=o}get uniqueId(){return this._unique||this.consistencyManager.getUnique()}get headType(){return this._headType}setIsInitIng(e){var t;(t=this.setInit)==null||t.call(this,e),this.isInitIng=e}consoleDebug(...e){console.debug("[lc-protocol]",this._headType,this.uuid,...e)}publishLine(e,t,i,r,s,n=this.uuid,a,o,l,h,c){if(this.channel.canPush())return this.consistencyManager.remoteChange(t,s,n,e,i,r,void 0,void 0,void 0,a,void 0,o,l,c),!1;this.cache[n]||(this.cache[n]=new Map);let f=this.cache[n].get(e);return(h||!f||f.ticket<t||f.ticket===t&&(f.client<s||f.client===s&&!!f.pend!=!!a))&&this.cache[n].set(e,{client:s,ticket:t,dataType:r,data:i,pend:a,unique:o,pChange:f?void 0:l,num:c}),!0}onDocHead(){}onEnd(){}setDocType(e,t){e===this.uuid&&(this._headType=t)}setBusTopic(e){this.busTopic=e}publish(){var t,i,r;if(this.publishCache)return this.publishCache();let e=!1;for(let[s,n]of this.deleteCache){if(this.channel.canPush()){(t=this.onDelete)==null||t.call(this,n),delete this.cache[s];continue}e=!0;break}if(e)return e;for(let s in this.cache){let n=this.cache[s].keys();for(let a of n){let o=this.cache[s].get(a);if(e=this.publishLine(a,o.ticket,o.data,o.dataType,o.client,s,o.pend,o.unique,o.pChange,!1,o.num),e)break;this.cache[s].delete(a)}if(e)break}return(r=(i=this.selectManager)==null?void 0:i.rePublish)==null||r.call(i),e}publishSelected(e,t){this.selectManager.publishSelected(e,t)}clear(){var e,t;for(let i of this.sub)i.cancel();this.sub.length=0,this.cache={},this.deleteCache.clear(),this.setIsInitIng(!1),this.channel.removeCompiler(this),(t=(e=this.selectManager)==null?void 0:e.dispose)==null||t.call(e),this.selectManager=null,this.isInit=!1,this.setIsInitIng(!1)}async init(e=!0,t=!0,i=!0,r,s,n,a){try{if(this.isInit)return{success:!0};if(this.isInitIng)throw new Error("\u6B63\u5728\u521D\u59CB\u5316\u4E2D");return this.isProject?await this.initProject(e,t,i,r,n,a):await this.initLib(i,r,s,n,a)}catch(o){throw this.clear(),new Error(`${this._headType}+'Compiler' ${this.uuid} init false: ${(o==null?void 0:o.message)||o||""}`,{cause:o})}finally{this.isInitIng=!1}}async flowRead(e){let t=this.consistencyManager.flowParseFull(),i=t.update,r=this;t.update=s=>{if(r.isDestroy)return!0;i(s)},await(0,$R.flowRead)(e,t)}pushOnLine(e,t){if(this.consistencyManager)for(let i of e)this.publishLine(i[0],i[1],i[2],i[3],i[4],t,i[5],i[6],i[7],!1,i[8])}async initProject(e,t,i,r,s,n){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=Dh(`/${this.windowId}/project/${this.path}`),s&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,l=>{if(this.onOrderNm)for(let h of l)this.onOrderNm(h[0],h[1],h[2])})),i&&this.busTopic.projectUpdate&&this.sub.push(this.dataBus.subscribe(bl(this.busTopic.projectUpdate,{uuid:this.uuid}),l=>{this.onUpdate?this.onUpdate(l):this.pushOnLine(l,this.uuid)})),i&&this.busTopic.projectCanSave&&this.sub.push(this.dataBus.subscribe(this.busTopic.projectCanSave,l=>{this.canSave=l})),i&&this.busTopic.subDelete&&this.sub.push(this.dataBus.subscribe(this.busTopic.subDelete,l=>{var h;this.channel.canPush()?(h=this.onDelete)==null||h.call(this,l):this.deleteCache.set(l[0],l)})),i&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(hi.subMaxTick,l=>{this.consistencyManager.setMaxTicket(l.ticket,l.force)})),i&&t&&this.sub.push(this.dataBus.subscribe(hi.subBlob,l=>{this.pushOnLine(l,"BLOB")})),i&&e&&this.sub.push(this.dataBus.subscribe(hi.subFont,l=>{this.pushOnLine(l,"FONT")})),i&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(bl(hi.subRevoke,{uuid:this.uuid}),l=>this.revoke(l))),!this.busTopic.getProject)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");this.isDestroy=!1;let a={doc:[this.uuid],watch:i,needNum:s,needDelete:n};t&&a.doc.push("BLOB"),e&&a.doc.push("FONT");let o=await this.dataBus.rpcCall(this.busTopic.getProject,a);if(this.isWatch=i,!this.isDestroy){if(!o.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",o);if(this.canSave=!(o!=null&&o.readOnly),this.consoleDebug("init",o.result),o.maxTicket&&this.consistencyManager&&this.consistencyManager.setMaxTicket(o.maxTicket),o.data&&this.onDocDetail&&this.onDocDetail(o.client||ps(),0,o.data,!1),o.channel&&await this.flowRead(o.channel),!this.isDestroy){if(this.handleInit?this.handleInit(o):o.result&&this.consistencyManager&&this.consistencyManager.parseFull(o.result,this.uuid,this._headType),r){let l=this.user=this.user||o.user||await this.wsBus.rpcCall(hi.getUserL);this.selectManager=new P2(this.uuid,this.path,this.windowId,this.channel,this.dataBus,this.wsBus,this.selectedProps,l),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}}async initLib(e,t,i,r,s){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=Dh(`/${this.windowId}/libWorker`),!this.busTopic.getPerson)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");let n=i?ps():"";this.isDestroy=!1;let a=await this.dataBus.rpcCall(this.busTopic.getPerson,{uuid:this.uuid,path:this.path,watch:e,channel:n,needNum:r,needDelete:s});if(this.isWatch=e,this.isDestroy)return;if(!a.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",a);this.consoleDebug("init",a.dataStr);let o=a.data||a.result;if(o&&this.onDocDetail&&this.onDocDetail(a.client||ps(),0,o,!1),r&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,l=>{if(this.onOrderNm)for(let h of l)this.onOrderNm(h[0],h[1],h[2])})),e&&this.busTopic.personUpdate&&this.sub.push(this.dataBus.subscribe(bl(this.busTopic.personUpdate,{uuid:this.uuid}),l=>{this.pushOnLine(l,this.uuid)})),e&&this.sub.push(this.dataBus.subscribe(bl(bl(hi.subRevoke,{uuid:this.uuid}),{uuid:this.uuid}),l=>this.revoke(l))),n&&await this.flowRead(n),!this.isDestroy){if(a.dataStr&&this.consistencyManager&&this.consistencyManager.parseFull(a.dataStr),t){let l=this.user=this.user||a.user||await this.wsBus.rpcCall(hi.getUserL);this.selectManager=new P2(this.uuid,this.path,this.windowId,this.channel,this.wsBus,this.wsBus,this.selectedProps,l),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}revoke(e){for(let t of e)this.consistencyManager&&this.consistencyManager.revoke(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],(...i)=>this.publishLine(...i)),t[10]&&this.setMaxNum&&this.setMaxNum(t[6],t[10],t[1])}cachePendData(e,t,i,r,s,n){this.pendCache[e]||(this.pendCache[e]={type:n,pend:[]}),this.pendCache[e].pend.push([t,i,s,r]),this.pendCacheLength+=r.length+1,this.pendCacheLength>1e7&&this.publishPendData(),this.pendTimer||(this.pendTimer=setTimeout(()=>{this.publishPendData(),this.pendTimer=null},0))}publishPendData(){if(this.pendCacheLength){this.dataBus.publish(hi.pushPend,[this.pendCache,this.consistencyManager.getClient(),this.uniqueId,this.uuid]);for(let e in this.pendCache)this.pendCache[e].pend.length=0;this.pendCache={},this.pendCacheLength=0}}localChange(e,t,i,r=this.uuid,s,n){if(!this.isInit||!this.canSave||!this.consistencyManager)return 0;if(t&&!t.startsWith("{"))return console.error("\u4E0A\u4F20\u7684\u683C\u5F0F\u4E0D\u6B63\u786E",e,i,t),0;let a=this.consistencyManager.localChange(r,e,t,i,s,n);return this.cachePendData(r,e,a,t,i,s||this.headType),a}async sync(){if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u540C\u6B65");let e=ps();this.dataBus.publish(hi.pushSync,e),await this.dataBus.pullA(bl(hi.pullASync,{id:e}))}async destroy(){return this.isDestroy?{success:!1}:(this.consistencyManager&&this.dataBus&&this.dataBus.publish(hi.pushRevoke,[this.uuid,this.uniqueId,this.consistencyManager.getClient()]),this.clear(),this.isDestroy=!0,this.isWatch&&this.dataBus&&!this.isProject&&this.dataBus.publish(hi.personDestroy,{uuid:this.uuid,path:this.path}),this.isWatch&&this.dataBus&&this.busTopic.unwatch&&this.dataBus.publish(this.busTopic.unwatch,this.uuid),this.isWatch=!1,{success:!0})}async save(e=[this.uuid,"BLOB","FONT"]){try{if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u4FDD\u5B58");if(!this.consistencyManager)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let t=this.isProject?hi.projectSave:hi.personSave;if(!t)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let i=await this.dataBus.rpcCall(t,{uuid:this.uuid,path:this.path,docIds:e,uniqueId:this.uniqueId,client:this.consistencyManager.getClient()});return this.consoleDebug("save",i),i}catch(t){throw new Error(`${this._headType}+'Compiler' ${this.uuid} \u4FDD\u5B58\u5931\u8D25: ${(t==null?void 0:t.message)||t||""}`,{cause:t})}}async getBlob(e){return this.dataBus.rpcCall("/mgr/projectWorker/blob/getBlob",e)}async getFont(e,t,i,r,s,n,a,o){let l={text:e,fontFamily:t,fontSize:i,thickness:r,bold:s,italic:n,reverse:a,expansion:o},h=await this.dataBus.rpcCall("/mgr/projectWorker/font/get",l);return h.success?{success:!0,result:Object.assign(l,JSON.parse(h.result))}:h}async checkSave(){return await this.dataBus.rpcCall(hi.hasSaveData,{uuid:this.uuid,uniqueId:this.uniqueId})}};var eD=(e=>(e.DIFFERENTIAL_PAIR="DIFFERENTIAL_PAIR",e.NET_CLASS="NET_CLASS",e.EQL_NET_GRP="EQL_NET_GRP",e))(eD||{});var tD=class extends Rb{constructor(e){super(e)}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var Jq=Gh(Mu());var Zq=Gh(Mu());var iD=class extends Rb{constructor(e,t,i,r,s,n,a,o=(l=>(l=Au())==null?void 0:l._TAB_ID_)()){let h=new $2(o);super(h),this.encode=n,this.base=new QR(e,t,i,o,r,h,s,s==="PCB"?ZR:JR,a,(...c)=>this.setIsInit(...c),(...c)=>this.onDocDetail(...c),void 0,void 0,void 0,void 0,(c,f,d)=>this.onOrderNum(c,f,d),(c,f,d)=>{this.setMaxNum(c,f,!!d),d&&this.deleteOrderNum(d)})}get dataBus(){return this.base.dataBus}set dataBus(e){this.base.dataBus=e}async init(e=!0,t=!0,i=!0,r,s=!0,n){return this.setNeedNum(s),this.base.init(e,t,i,r,!0,s,n)}async sync(){return this.base.sync()}async destroy(){return this.base.destroy()}async save(){return this.base.save()}checkSave(){return this.base.checkSave()}publishSelected(e,t){this.base.publishSelected(e,t)}uploadBlob(e,t){let i=Ip(t),r={filename:e,content:t};return{success:!0,ticket:this.localChange({id:i,data:JSON.stringify(r),dataType:"BLOB"},"BLOB","BLOB"),hash:i}}deleteBlob(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"BLOB"},"BLOB","BLOB")}}uploadFont(e){let{text:t,fontFamily:i,fontSize:r,thickness:s,bold:n,italic:a,reverse:o,expansion:l,width:h,height:c,path:f}=e,d={width:h,height:c,path:f},u=kO(t,i,r,s,n,a,o,l);return{success:!0,ticket:this.localChange({id:u,data:JSON.stringify(d),dataType:"FONT"},"FONT","FONT")}}deleteFont(e){let{text:t,fontFamily:i,fontSize:r,thickness:s,bold:n,italic:a,reverse:o,expansion:l}=e,h=kO(t,i,r,s,n,a,o,l);return{success:!0,ticket:this.localChange({id:h,data:"",dataType:"FONT"},"FONT","FONT")}}localChange(e,t=this.base.uuid,i){var s,n;let r=this.getOrderNum(e.id);return(n=(s=this.needOrderType)==null?void 0:s.includes)!=null&&n.call(s,e.dataType)&&r===void 0&&(r=this.getMaxNum(e.dataType),this.setOrderNum(e.id,r,e.dataType),this.onOrderNum(e.id,e.dataType,r)),this.base.localChange(e.id,e.data,e.dataType,t,i,r)}uploadString(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeString(e,t))}}deleteString(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"STRING"})}}uploadAttr(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeAttr(e,t))}}deleteAttr(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"ATTR"})}}uploadPanelize(e){return{success:!0,ticket:this.localChange(this.encode.encodePanelize(e))}}deletePanelize(){return{success:!0,ticket:this.localChange({id:"PANELIZE",data:"",dataType:"PANELIZE"})}}uploadRuleSelector(e){return{success:!0,ticket:this.localChange(this.encode.encodeRuleSelector(e))}}deleteRuleSelector(e){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE_SELECTOR",e]),data:"",dataType:"RULE_SELECTOR"})}}uploadRule(e){return{success:!0,ticket:this.localChange(this.encode.encodeRule(e))}}deleteRule(e,t){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE",e,t]),data:"",dataType:"RULE"})}}uploadRuleTemplate(e){return{success:!0,ticket:this.localChange(this.encode.encodeRuleTemplate(e))}}uploadDimension(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeDimension(e,t))}}deleteDimension(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"DIMENSION"})}}uploadBoss(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeBoss(e,t))}}deleteBoss(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"BOSS"})}}uploadShellEntity(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShellEntity(e,t))}}deleteShellEntity(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELL_ENTITY"})}}uploadShellCut(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShellCut(e,t))}}deleteShellCut(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELLCUT"})}}uploadCrease(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeCrease(e,t))}}deleteCrease(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"CREASE"})}}uploadShell(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShell(e,t))}}deleteShell(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELL"})}}uploadFpcFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeFpcFill(e,t))}}deleteFpcFill(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"FPC_FILL"})}}uploadTeardrop(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeTeardrop(e,t))}}deleteTeardrop(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"TEARDROP"})}}uploadImage(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeImage(e,t))}}deleteImage(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"IMAGE"})}}uploadPoured(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePoured(e,t))}}deletePoured(e){return{success:!0,ticket:this.localChange({id:Rs(e,"POURED"),data:"",dataType:"POURED"})}}uploadPour(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePour(e,t))}}deletePour(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"POUR"})}}uploadRegion(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeRegion(e,t))}}deleteRegion(e){let t=this.localChange({id:e,data:"",dataType:"REGION"});return this.onDelRegion(e,this.consistencyManager.getClient(),t,!0),{success:!0,ticket:t}}uploadFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeFill(e,t))}}deleteFill(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"FILL"})}}uploadLayerFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayerFill(e,t))}}deleteLayerFill(e){return{success:!0,ticket:this.localChange({id:Rs(e,"LAYER_FILL"),data:"",dataType:"LAYER_FILL"})}}uploadPoly(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePoly(e,t))}}deletePoly(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"POLY"})}}uploadEQLenGrp(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeEQLenGrp(e,t))}}deleteEQLenGrp(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"EQLEN_GRP"})}}uploadObj(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeObj(e,t))}}deleteObj(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"OBJ"})}}uploadArc(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeArc(e,t))}}deleteArc(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"ARC"})}}uploadLine(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLine(e,t))}}deleteLine(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"LINE"})}}uploadPad(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePad(e,t))}}deletePad(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"PAD"})}}uploadVia(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeVia(e,t))}}deleteVia(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"VIA"})}}uploadPreference(e){return{success:!0,ticket:this.localChange(this.encode.encodePreference(e))}}uploadSilkOpts(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeSilkOpts(e,t))}}deleteSilkOpts(e){return{success:!0,ticket:this.localChange({id:Rs(e,"SILK_OPTS"),data:"",dataType:"SILK_OPTS"})}}uploadGroup(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeGroup(e,t))}}deleteGroup(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"GROUP"})}}uploadPrimitive(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePrimitive(e,t))}}deletePrimitive(e){return{success:!0,ticket:this.localChange({id:Rs(e,"PRIMITIVE"),data:"",dataType:"PRIMITIVE"})}}uploadNet(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeNet(e,t))}}deleteNet(e){return{success:!0,ticket:this.localChange({id:Rs(e,"NET"),data:"",dataType:"NET"})}}uploadActiveLayer(e){return{success:!0,ticket:this.localChange(this.encode.encodeActiveLayer(e))}}uploadLayerPhys(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayerPhys(e,t))}}deleteLayerPhys(e){return{success:!0,ticket:this.localChange({id:Rs(e,"LAYER_PHYS"),data:"",dataType:"LAYER_PHYS"})}}uploadLayer(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayer(e,t))}}deleteLayer(e){return{success:!0,ticket:this.localChange({id:Rs(e,"LAYER"),data:"",dataType:"LAYER"})}}uploadCanvas(e){return{success:!0,ticket:this.localChange(this.encode.encodeCanvas(e))}}uploadBoard(e){return{success:!0,ticket:this.localChange({id:"BOARD",data:JSON.stringify(e),dataType:"BOARD"})}}deleteBoard(){return{success:!0,ticket:this.localChange({id:"BOARD",data:"",dataType:"BOARD"})}}};var Db=class extends iD{constructor(e,t,i,r,s=(n=>(n=Au())==null?void 0:n._TAB_ID_)()){super(e,t,i,r,"FOOTPRINT",new Lb,{getSelect:()=>{var a;return(a=this.canvasSelected)==null?void 0:a.call(this)},onSelect:(...a)=>{var o;return(o=this.onSelectChange)==null?void 0:o.call(this,a[0],a[1],a[2])},onQuit:(...a)=>{var o;return(o=this.onSelectQuit)==null?void 0:o.call(this,a[0],a[1])}},s),this.uuid=e,this.path=t,this.isProject=i,this.windowId=s}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var rD=class extends tD{constructor(){super(...arguments),this.data={}}onBoard(e,t,i,r){}onDelBoard(e,t,i){}onLayerFill(e,t,i,r,s){}onDelLayerFill(e,t,i,r){}onBlob(e,t,i,r,s){}onDelBlob(e,t,i,r){}onFont(e,t,i,r){}onDelFont(e,t,i,r){}onString(e,t,i,r,s,n){this.data[e]=s}onDelString(e,t,i,r){delete this.data[e]}onStringNum(e,t){}onAttr(e,t,i,r,s,n){this.data[e]=s}onDelAttr(e,t,i,r){delete this.data[e]}onAttrNum(e,t){}onPanelizeSide(e,t,i,r){}onDelPanelizeSide(e,t,i,r){}onPanelizeStamp(e,t,i,r){}onDelPanelizeStamp(e,t,i,r){}onPanelize(e,t,i,r){}onDelPanelize(e,t,i){}onRuleSelector(e,t,i,r){}onDelRuleSelector(e,t,i,r){}onRule(e,t,i,r){}onDelRule(e,t,i,r,s){}onRuleTemplate(e,t,i,r){}onDimension(e,t,i,r,s,n){this.data[e]=s}onDelDimension(e,t,i,r){delete this.data[e]}onDimensionNum(e,t){}onBoss(e,t,i,r,s,n){this.data[e]=s}onDelBoss(e,t,i,r){delete this.data[e]}onBossNum(e,t){}onShellEntity(e,t,i,r,s,n){this.data[e]=s}onDelShellEntity(e,t,i,r){}onShellEntityNum(e,t){}onShellCut(e,t,i,r,s,n){this.data[e]=s}onDelShellCut(e,t,i,r){delete this.data[e]}onShellCutNum(e,t){}onCrease(e,t,i,r,s,n){this.data[e]=s}onDelCrease(e,t,i,r){delete this.data[e]}onCreaseNum(e,t){}onShell(e,t,i,r,s,n){this.data[e]=s}onDelShell(e,t,i,r){delete this.data[e]}onShellNum(e,t){}onFpcFill(e,t,i,r,s,n){this.data[e]=s}onDelFpcFill(e,t,i,r){delete this.data[e]}onFpcFillNum(e,t){}onTeardrop(e,t,i,r,s,n){this.data[e]=s}onDelTeardrop(e,t,i,r){delete this.data[e]}onTeardropNum(e,t){}onImage(e,t,i,r,s,n){this.data[e]=s}onDelImage(e,t,i,r){delete this.data[e]}onImageNum(e,t){}onPoured(e,t,i,r,s,n){this.data[e]=s}onDelPoured(e,t,i,r){delete this.data[e]}onPouredNum(e,t){}onPour(e,t,i,r,s,n){this.data[e]=s}onDelPour(e,t,i,r){delete this.data[e]}onPourNum(e,t){}onRegion(e,t,i,r,s,n){this.data[e]=s}onDelRegion(e,t,i,r){delete this.data[e]}onRegionNum(e,t){}onFill(e,t,i,r,s,n){this.data[e]=s}onDelFill(e,t,i,r){delete this.data[e]}onFillNum(e,t){}onPoly(e,t,i,r,s,n){this.data[e]=s}onDelPoly(e,t,i,r){delete this.data[e]}onPolyNum(e,t){}onEQLenGrp(e,t,i,r,s){this.data[e]=r}onDelEQLenGrp(e,t,i,r){delete this.data[e]}onDelProp(e,t,i,r){delete this.data[e]}onObj(e,t,i,r,s,n){this.data[e]=s}onDelObj(e,t,i,r){delete this.data[e]}onObjNum(e,t){}onArc(e,t,i,r,s,n){this.data[e]=s}onDelArc(e,t,i,r){delete this.data[e]}onArcNum(e,t){}onCArc(e,t,i,r,s,n){this.data[e]=s}onDelCArc(e,t,i,r){delete this.data[e]}onCArcNum(e,t){}onLine(e,t,i,r,s,n){this.data[e]=s}onDelLine(e,t,i,r){delete this.data[e]}onLineNum(e,t){}onPad(e,t,i,r,s,n){this.data[e]=s}onDelPad(e,t,i,r){delete this.data[e]}onPadNum(e,t){}onVia(e,t,i,r,s,n){this.data[e]=s}onDelVia(e,t,i,r){delete this.data[e]}onViaNum(e,t){}onDelConnect(e,t,i,r){}onPreference(e,t,i,r){}onSilkOpts(e,t,i,r,s){this.data[e]=r}onDelSilkOpts(e,t,i,r){delete this.data[e]}onGroup(e,t,i,r,s){this.data[e]=r}onDelGroup(e,t,i,r){delete this.data[e]}onPrimitive(e,t,i,r,s){}onDelPrimitive(e,t,i,r){}onNet(e,t,i,r,s){}onDelNet(e,t,i,r){}onPartition(e,t,i,r,s,n){this.data[e]=s}onDelPartition(e,t,i,r){delete this.data[e]}onPartitionNum(e,t){}onEditorMeta(e,t,i,r){}onDocDetail(e,t,i,r){}onActiveLayer(e,t,i,r){}onLayerPhys(e,t,i,r,s){this.data[e]=r}onDelLayerPhys(e,t,i,r){delete this.data[e]}onLayer(e,t,i,r,s){this.data[e]=r}onDelLayer(e,t,i,r){}onCanvas(e,t,i,r){}},sD=class extends Db{onBoard(e,t,i,r){}onDelBoard(e,t,i){}onLayerFill(e,t,i,r,s){}onDelLayerFill(e,t,i,r){}constructor(e,t,i,r){super(e,t,i,new xm,r)}canvasSelected(){return""}onSelectChange(e,t,i){}onSelectQuit(e,t){}async getByDataType(e){let t="";if(this.isProject?(this.dataBus=this.dataBus||Dh(`/${this.windowId}/project/${this.path}`),t=await this.dataBus.rpcCall("/mgr/projectWorker/getDataByType",{doc:this.uuid,dataType:e})):(this.dataBus=this.dataBus||Dh(`/${this.windowId}/libWorker`),t=await this.dataBus.rpcCall("/mgr/libWorker/getDataByType",{uuid:this.uuid,path:this.path,dataType:e,docType:"FOOTPRINT"})),!t)return{};let i=new rD;return i.consistencyManager.parseFull(t,this.uuid,"FOOTPRINT"),i.data}async getPads(){return this.getByDataType("PAD")}onBlob(e,t,i,r,s){}onDelBlob(e,t,i,r){}onFont(e,t,i,r){}onDelFont(e,t,i,r){}onString(e,t,i,r,s,n){}onDelString(e,t,i,r){}onStringNum(e,t){}onAttr(e,t,i,r,s,n){}onDelAttr(e,t,i,r){}onAttrNum(e,t){}onPanelizeSide(e,t,i,r){}onDelPanelizeSide(e,t,i,r){}onPanelizeStamp(e,t,i,r){}onDelPanelizeStamp(e,t,i,r){}onPanelize(e,t,i,r){}onDelPanelize(e,t,i){}onRuleSelector(e,t,i,r){}onDelRuleSelector(e,t,i,r){}onRule(e,t,i,r){}onDelRule(e,t,i,r,s){}onRuleTemplate(e,t,i,r){}onDimension(e,t,i,r,s,n){}onDelDimension(e,t,i,r){}onDimensionNum(e,t){}onBoss(e,t,i,r,s,n){}onDelBoss(e,t,i,r){}onBossNum(e,t){}onShellEntity(e,t,i,r,s,n){}onDelShellEntity(e,t,i,r){}onShellEntityNum(e,t){}onShellCut(e,t,i,r,s,n){}onDelShellCut(e,t,i,r){}onShellCutNum(e,t){}onCrease(e,t,i,r,s,n){}onDelCrease(e,t,i,r){}onCreaseNum(e,t){}onShell(e,t,i,r,s,n){}onDelShell(e,t,i,r){}onShellNum(e,t){}onFpcFill(e,t,i,r,s,n){}onDelFpcFill(e,t,i,r){}onFpcFillNum(e,t){}onTeardrop(e,t,i,r,s,n){}onDelTeardrop(e,t,i,r){}onTeardropNum(e,t){}onImage(e,t,i,r,s,n){}onDelImage(e,t,i,r){}onImageNum(e,t){}onPoured(e,t,i,r,s,n){}onDelPoured(e,t,i,r){}onPouredNum(e,t){}onPour(e,t,i,r,s,n){}onDelPour(e,t,i,r){}onPourNum(e,t){}onRegion(e,t,i,r,s,n){}onDelRegion(e,t,i,r){}onRegionNum(e,t){}onFill(e,t,i,r,s,n){}onDelFill(e,t,i,r){}onFillNum(e,t){}onPoly(e,t,i,r,s,n){}onDelPoly(e,t,i,r){}onPolyNum(e,t){}onEQLenGrp(e,t,i,r,s){}onDelEQLenGrp(e,t,i,r){}onDelProp(e,t,i,r){}onObj(e,t,i,r,s,n){}onDelObj(e,t,i,r){}onObjNum(e,t){}onArc(e,t,i,r,s,n){}onDelArc(e,t,i,r){}onArcNum(e,t){}onCArc(e,t,i,r,s,n){}onDelCArc(e,t,i,r){}onCArcNum(e,t){}onLine(e,t,i,r,s,n){}onDelLine(e,t,i,r){}onLineNum(e,t){}onPad(e,t,i,r,s,n){}onDelPad(e,t,i,r){}onPadNum(e,t){}onVia(e,t,i,r,s,n){}onDelVia(e,t,i,r){}onViaNum(e,t){}onDelConnect(e,t,i,r){}onPreference(e,t,i,r){}onSilkOpts(e,t,i,r,s){}onDelSilkOpts(e,t,i,r){}onGroup(e,t,i,r,s){}onDelGroup(e,t,i,r){}onPrimitive(e,t,i,r,s){}onDelPrimitive(e,t,i,r){}onNet(e,t,i,r,s){}onDelNet(e,t,i,r){}onPartition(e,t,i,r,s,n){}onDelPartition(e,t,i,r){}onPartitionNum(e,t){}onEditorMeta(e,t,i,r){}onDocDetail(e,t,i,r){}onActiveLayer(e,t,i,r){}onLayerPhys(e,t,i,r,s){}onDelLayerPhys(e,t,i,r){}onLayer(e,t,i,r,s){}onDelLayer(e,t,i,r){}onCanvas(e,t,i,r){}},Mb=(e=>(e.LIST="/pro-mgr/api/project/list",e.CREATE="/pro-mgr/api/project/create",e.GET="/pro-mgr/api/project/get",e.UPDATE="/pro-mgr/api/project/update",e.DELETE="/pro-mgr/api/project/delete",e.TICKET="/pro-mgr/api/project/ticket",e.TICKET1="/pro-mgr/api/project/ticket1",e.BACKUP_LIST="/pro-mgr/api/project/backupList",e.BACKUP="/pro-mgr/api/project/backup",e.GET_BACKUP="/pro-mgr/api/project/getBackup",e.DELETE_BACKUP="/pro-mgr/api/project/deleteBackup",e.ARCHIVE="/pro-mgr/api/project/archive",e.CREATE_BOARD="/pro-mgr/api/project/createBoards",e.STAR="/pro-mgr/api/project/star",e.UNSTAR="/pro-mgr/api/project/unstar",e.GET_PROFILE="/pro-mgr/api/project/getProfile",e))(Mb||{}),Bb=(e=>(e.LIST="/pro-mgr/api/schematic/list",e.CREATE="/pro-mgr/api/schematic/create",e.UPLOAD="/pro-mgr/api/schematic/upload",e.DELETE="/pro-mgr/api/schematic/delete",e.UPDATE="/pro-mgr/api/schematic/update",e))(Bb||{}),kb=(e=>(e.LIST="/pro-mgr/api/document/list",e.SEARCH_LIST="/pro-mgr/api/document/searchList",e.CREATE="/pro-mgr/api/document/create",e.UPLOAD="/pro-mgr/api/document/upload",e.UPDATE="/pro-mgr/api/document/update",e.BATCH_UPDATE="/pro-mgr/api/document/batchUpdate",e.DELETE="/pro-mgr/api/document/delete",e.GET="/pro-mgr/api/document/get",e.GET_BY_SID="/pro-mgr/api/document/getBySid",e.MOVE="/pro-mgr/api/document/move",e.CHECK_IN="/pro-mgr/api/document/checkIn",e.CHECK_OUT="/pro-mgr/api/document/checkOut",e.GET_CHECK="/pro-mgr/api/document/getCheck",e.DELETE_PCB_RELATED="/pro-mgr/api/document/deletePcbRelated",e))(kb||{}),Ub=(e=>(e.LIST="/pro-mgr/api/device/list",e.SEARCH_LIST="/pro-mgr/api/device/searchList",e.CREATE="/pro-mgr/api/device/create",e.UPLOAD="/pro-mgr/api/device/upload",e.UPDATE="/pro-mgr/api/device/update",e.BATCH_UPDATE="/pro-mgr/api/device/batchUpdate",e.GET="/pro-mgr/api/device/get",e.SEARCH_BY_USERS_AND_TITLES="/pro-mgr/api/device/searchByUsersAndTitles",e.GET_ATTR_VALUES="/pro-mgr/api/device/getAttributeValues",e.GET_ATTR_KEYS="/pro-mgr/api/device/getAttrKeys",e.DELETE="/pro-mgr/api/device/delete",e.STAR="/pro-mgr/api/device/star",e.UNSTAR="/pro-mgr/api/device/unstar",e.PLACE="/pro-mgr/api/device/place",e))(Ub||{}),Fb=(e=>(e.LIST="/pro-mgr/api/component/list",e.SEARCH_LIST="/pro-mgr/api/component/searchList",e.CREATE="/pro-mgr/api/component/create",e.UPLOAD="/pro-mgr/api/component/upload",e.UPDATE="/pro-mgr/api/component/update",e.BATCH_UPDATE="/pro-mgr/api/component/batchUpdate",e.DELETE="/pro-mgr/api/component/delete",e.GET="/pro-mgr/api/component/get",e.SEARCH_BY_USERS_AND_TITLES="/pro-mgr/api/component/searchByUsersAndTitles",e.STAR="/pro-mgr/api/component/star",e.UNSTAR="/pro-mgr/api/component/unstar",e.GET_HISTORY="/pro-mgr/api/component/getHistory",e.SET_HISTORY="/pro-mgr/api/component/setHistory",e.GET_HISTORY_DATA="/pro-mgr/api/component/getHistoryData",e))(Fb||{}),Gb=(e=>(e.LIST="/pro-mgr/api/tag/list",e.CREATE="/pro-mgr/api/tag/create",e.UPDATE="/pro-mgr/api/tag/update",e.DELETE="/pro-mgr/api/tag/delete",e))(Gb||{}),zb=(e=>(e.SEARCH_LIST="/pro-mgr/api/copper/searchList",e.SET="/pro-mgr/api/copper/set",e.DELETE="/pro-mgr/api/copper/delete",e))(zb||{}),Hb=(e=>(e.SEARCH_LIST="/pro-mgr/api/font/searchList",e.SET="/pro-mgr/api/font/set",e.DELETE="/pro-mgr/api/font/delete",e))(Hb||{}),jb=(e=>(e.SEARCH_LIST="/pro-mgr/api/blob/searchList",e.SET="/pro-mgr/api/blob/set",e))(jb||{}),Yb=(e=>(e.LIST="/pro-mgr/api/attr/list",e.SEARCH_LIST="/pro-mgr/api/attr/searchList",e.CREATE="/pro-mgr/api/attr/create",e.UPLOAD="/pro-mgr/api/attr/upload",e.DELETE="/pro-mgr/api/attr/delete",e.TICKET="/pro-mgr/api/attr/ticket",e))(Yb||{}),Vb=(e=>(e.GET_BACKUP="/pro-mgr/api/client/getBackup",e.GET_LIBS="/pro-mgr/api/client/getLibs",e.CREATE_LIB="/pro-mgr/api/client/createLib",e.CREATE_PROJECT="/pro-mgr/api/client/createProject",e.OPEN_PROJECT="/pro-mgr/api/client/openProject",e.CLOSE_PROJECT="/pro-mgr/api/client/closeProject",e.GET_PROJECT_PATHS="/pro-mgr/api/client/getProjectPaths",e.SELECT_PATH="/pro-mgr/api/client/selectPath",e.OPEN_DIALOG="/pro-mgr/api/client/openDialog",e.SELECT_DIR="/pro-mgr/api/client/selectDir",e.SELECT_FILE="/pro-mgr/api/client/selectFile",e.EXPORT_FILE="/pro-mgr/api/client/exportFile",e.CACHE_LIST="/pro-mgr/api/client/cacheList",e.GET_CACHE="/pro-mgr/api/client/getCache",e.SET_CACHE="/pro-mgr/api/client/setCache",e.DELETE_CACHE="/pro-mgr/api/client/deleteCache",e.PROJECT_HISTORY="/pro-mgr/api/client/projectHistory",e.DELETE_HISTORY="/pro-mgr/api/client/deletHistory",e.SET_KV_CACHE="/pro-mgr/api/client/setKVCache",e.GET_KV_CACHE="/pro-mgr/api/client/getKVCache",e.IS_EXIST_KV_CACHE="/pro-mgr/api/client/isExistKVCache",e.OPEN_URL="/pro-mgr/api/client/openURL",e))(Vb||{}),qb=(e=>(e.LOG="/pro-mgr/api/other/log",e.COMPONENT_LOG="/pro-mgr/api/other/componentLog",e.TEAMS="/pro-mgr/api/other/teams",e.GET_EDITOR_VERSION="/pro-mgr/api/other/getEditorVersion",e.SET_EDITOR_VERSION="/pro-mgr/api/other/setEditorVersion",e))(qb||{}),Ha={PROJECT:Mb,SCHEMATIC:Bb,DOCUMENT:kb,DEVICE:Ub,COMPONENT:Fb,TAG:Gb,COPPER:zb,FONT:Hb,BLOB:jb,ATTR:Yb,CLIENT:Vb,OTHER:qb},nD=(e=>(e.GET_DATA_STR="/pro-mgr/public/getDataStr",e))(nD||{}),Gf=Ru(Du()),yu={bus:void 0,get messageBus(){if(yu.bus===void 0)if(typeof window<"u"){let e=Ms();e._MSG_BUS_=e._MSG_BUS_||new Gf.MessageBus,yu.bus=e._MSG_BUS_}else self._WORKER_BUS_=self._WORKER_BUS_||new Gf.WorkerMessageBridge(new Gf.MessageBus,self),yu.bus=self._WORKER_BUS_;return yu.bus},get messageBus2(){return self._MSG_BUS2_=self._MSG_BUS2_||new Gf.MessageBus2},loginedUserUuid:void 0},Ge=yu,aD=(e=>(e.BOTTOM_COMPONENT_LIB="BOTTOM_COMPONENT_LIB",e.DIALOG="DIALOG",e))(aD||{}),oD=["S","F","P","3D"],lD=["F","3D"],hD=(e=>(e.ZIP=".zip",e.PRJ=".epro",e.PRJ2=".epro2",e.EPRU=".epru",e.SCH=".esch",e.PCB=".epcb",e.PANEL=".epan",e.PANEL_LIB=".epanl",e.SYMBOL=".esym",e.FOOTPRINT=".efoo",e.INSTANCE=".eins",e.COPPER=".ecop",e.BLOB=".eblob",e.FONT=".efon",e.ELIBZ=".elibz",e.ELIBZ2=".elibz2",e.ELIBU=".elibu",e.IMAGE=".webp",e))(hD||{}),zh="|",cD=/^[^|]+(\|[^|]+)?$/,uD=(e=>(e.Board="Board",e.Schematic="Schematic",e.Sheet="Sheet",e.Pcb="Pcb",e.Panel="Panel",e.SchCanvas="SchCanvas",e.PcbCanvas="PcbCanvas",e.PanelCanvas="PanelCanvas",e))(uD||{}),dD=(e=>(e.Device="Device",e.Symbol="Symbol",e.Footprint="Footprint",e))(dD||{}),A2=[{value:"",text:"All"},{value:2,text:"Component"},{value:20,text:{content:"symbolType",value:"Drawing",options:null}},{value:18,text:"Net Flag"},{value:19,text:"Net Port"},{value:25,text:"Off Page Connector"},{value:31,text:"Differential Pairs Flag"},{value:21,text:{content:"symbolType",value:"Non-Electronic Flag",options:null}},{value:22,text:"Short Flag"}],C2=[{value:"",text:"All"},{value:2,text:"Component Symbol"},{value:20,text:"Drawing Symbol"},{value:18,text:"Netflag Symbol"},{value:19,text:"Netport Symbol"},{value:25,text:"Off Page Connector Symbol"},{value:31,text:"Differential Pairs Flag Symbol"},{value:21,text:"Non-Electronic Symbol"},{value:22,text:"Short Flag"}],fD=["S"],pD=["S"],_D=["S"],gD=["3D"],OD={footprint:lD,device:oD,symbol:fD,model3D:gD,panelLib:pD,cbb:_D,modelSimLib:[]};async function mD(e){let t=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(i)).map(r=>r.toString(16).padStart(2,"0")).join("")}var Xb=[2,20,18,19,21,22,17,25,31];function _p(e){return e&&Xb.indexOf(e)>=0}function Wb(e){return Xb.indexOf(e)>=0&&e!==17}function yD(e){return e===""?!1:!!(e&&cD.test(e))}var bD=async e=>{let{keys:t,values:i}=Jb(e);return await mD([...t,...i].sort().join(""))},Jb=e=>{let t=new Set,i=new Set;for(let r in e){let s=e[r];if(t.add(r),Array.isArray(s))i.add(JSON.stringify(s.sort()));else if(Object.prototype.toString.call(s)==="[object Object]"){let{keys:n,values:a}=Jb(s);t=new Set([...t,...n]),i=new Set([...i,...a])}else i.add(JSON.stringify(s))}return{keys:t,values:i}};function N2(e){let{uuid:t,path:i}=e;return t?t+(i?`${zh}${i}`:""):void 0}function xD(e){let{source:t,path:i}=e;return t+(i?`${zh}${i}`:"")}async function LO(e,t){if(t)return t;let{updateTime:i}=e;return i?String(i):await bD(e)}async function vD(e){let{data:t,force:i=!0,defalut:r}=e,{source:s,version:n}=t;s?(yD(s)||(t.source=N2(t)),s.includes(zh)||(t.source=xD(t)),n?n==="1"&&(t.version=await LO(t)):t.version=await LO(t,r)):i&&(t.source=N2(t),t.version=await LO(t,r))}function Zb(){let e=navigator.userLanguage||navigator.language;return e&&e.includes("zh")?"zh-cn":"en"}function RO(e){let{tags:t,custom_tags:i="[]"}=e;if((!i||i==="[]")&&t){if(Array.isArray(t)&&t.length)i=JSON.stringify(t);else if(Object.prototype.toString.call(t)==="[object Object]"){let r=Zb()==="en",s=[];if(t.parent_tag){let{name:n,name_cn:a}=t.parent_tag;if(r&&n?s.push(n):!r&&a?s.push(a):n&&s.push(n),t.child_tag){let{name:o,name_cn:l}=t.child_tag;r&&o?s.push(o):!r&&l?s.push(l):o&&s.push(o)}}i=JSON.stringify(s)}}return e.custom_tags=i,e.custom_tags}function Ye(e){return String(e).length===13?Number(e):String(e).length===10?Number(e)*1e3:Number(e)}var Kb=(e=>e)(Kb||{}),$b=(e=>(e.GET="/PrjDB/project/getData",e.UPDATE="/PrjDB/project/updateData",e.COUNT_DOC="/PrjDB/project/countDoc",e.GET_HISTORY_NODE="/PrjDB/project/getHistoricalNodes",e.GET_HISTORY_UPDATETIME="/PrjDB/project/getHistoryUpdatetime",e.GET_HISTORY_PROJECT="/PrjDB/project/getHistoricalProject",e.START_BATCH_UPLOAD="/PrjDB/project/startBatchUpload",e.END_BATCH_UPLOAD="/PrjDB/project/endBatchUpload",e.AWAIT_UPLOAD_END="/PrjDB/project/awaitUploadEnd",e.GET_MAX_TICKET="/PrjDB/project/getMaxTicket",e.SAVE_PEND_DATA="/PrjDB/project/savePendData",e.REVOKE_PEND_DATA="/PrjDB/project/revokePendData",e.GET_CLIENT="/PrjDB/project/getClient",e.HISTORIES="/PrjDB/project/histories",e.COMPRESS="/PrjDB/project/compress",e.FLOW_WRITE="/PrjDB/project/flowWrite",e.GET_RELATED="/PrjDB/project/getRelated",e))($b||{}),Qb=(e=>(e.GET="/PrjDB/config/getData",e.UPDATE="/PrjDB/config/updateData",e))(Qb||{}),ex=(e=>(e.GET="/PrjDB/board/getData",e.ADD="/PrjDB/board/addData",e.UPDATE="/PrjDB/board/updateData",e.DELETE="/PrjDB/board/deleteData",e.GET_ALL_KV="/PrjDB/board/getAllKVData",e.GET_ALL_ARR="/PrjDB/board/getAllArrData",e.TRY_RENAME="/PrjDB/board/tryRename",e.IS_RENAME="/PrjDB/board/isRename",e.BATCH_DELETE="/PrjDB/board/batchDelete",e.GET_BIND_KEYS="/PrjDB/board/getBindKeys",e))(ex||{}),tx=(e=>(e.GET="/PrjDB/schematic/getData",e.GET_BY_NAME="/PrjDB/schematic/getDataByName",e.TRY_RENAME="/PrjDB/schematic/tryRename",e.UPDATE_IN_LOCAL="/PrjDB/schematic/updateDataInLocal",e.ADD="/PrjDB/schematic/addData",e.UPDATE="/PrjDB/schematic/updateData",e.DEL="/PrjDB/schematic/delData",e.GET_ALL_KV="/PrjDB/schematic/getAllKVDatas",e.GET_UUID_BY_NAME="/PrjDB/schematic/getIdByName",e.GET_NAME_BY_UUID="/PrjDB/schematic/getNameById",e.GET_DISPLAY_NAME_BY_UUID="/PrjDB/schematic/getDisplayNameById",e.GET_ALL_ARR="/PrjDB/schematic/getAllArrDatas",e.GET_BY_SOURCE_VERSION="/PrjDB/schematic/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/schematic/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/schematic/getAllArrDatasBySource",e.IS_RENAME="/PrjDB/schematic/isRename",e.BATCH_DELETE="/PrjDB/schematic/batchDelete",e))(tx||{}),ix=(e=>(e.ADD="/PrjDB/sheet/addData",e.DEL="/PrjDB/sheet/delData",e.UPDATE="/PrjDB/sheet/updateData",e.UPDATE_LOTS="/PrjDB/sheet/updateLotDatas",e.GET_ALL_KV="/PrjDB/sheet/getAllKVDatas",e.GET="/PrjDB/sheet/getData",e.GET_ALL_ARR="/PrjDB/sheet/getAllArrDatas",e.GET_LOTS_ARR="/PrjDB/sheet/getLotsArrDatas",e.GET_CANVAS="/PrjDB/sheet/getCanvas",e.SET_CANVAS="/PrjDB/sheet/setCanvas",e.COVER_CANVAS="/PrjDB/sheet/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/sheet/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/sheet/unwatchCanvas",e.GET_BY_SOURCE_VERSION="/PrjDB/sheet/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/sheet/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/sheet/getAllArrDatasBySource",e.TRY_RENAME="/PrjDB/sheet/tryRename",e.IS_RENAME="/PrjDB/sheet/isRename",e.BATCH_DELETE="/PrjDB/sheet/batchDelete",e.GET_ALL_KEYS="/PrjDB/sheet/getAllPrimaryKeys",e))(ix||{}),rx=(e=>(e.ADD="/PrjDB/simulation/addData",e.DEL="/PrjDB/simulation/delData",e.UPDATE="/PrjDB/simulation/updateData",e.UPDATE_LOTS="/PrjDB/simulation/updateLotDatas",e.GET_ALL_KV="/PrjDB/simulation/getAllKVDatas",e.GET="/PrjDB/simulation/getData",e.GET_ALL_ARR="/PrjDB/simulation/getAllArrDatas",e.GET_LOTS_ARR="/PrjDB/simulation/getLotsArrDatas",e.GET_CANVAS="/PrjDB/simulation/getCanvas",e.SET_CANVAS="/PrjDB/simulation/setCanvas",e.COVER_CANVAS="/PrjDB/simulation/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/simulation/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/simulation/unwatchCanvas",e.GET_BY_SOURCE_VERSION="/PrjDB/simulation/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/simulation/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/simulation/getAllArrDatasBySource",e.TRY_RENAME="/PrjDB/simulation/tryRename",e.IS_RENAME="/PrjDB/simulation/isRename",e.BATCH_DELETE="/PrjDB/simulation/batchDelete",e.GET_ALL_KEYS="/PrjDB/simulation/getAllPrimaryKeys",e))(rx||{}),sx=(e=>(e.GET="/PrjDB/pcb/getData",e.GET_BY_TITLE="/PrjDB/pcb/getDataByTitle",e.GET_UUID_BY_TITLE="/PrjDB/pcb/getIdByTitle",e.ADD="/PrjDB/pcb/addData",e.DEL="/PrjDB/pcb/delData",e.CREATE_SUB="/PrjDB/pcb/createSub",e.UPDATE_SUB="/PrjDB/pcb/updateSubInherit",e.UPDATE="/PrjDB/pcb/updateData",e.UPDATE_LOTS="/PrjDB/pcb/updateLotDatas",e.GET_ALL_KV="/PrjDB/pcb/getAllKVDatas",e.GET_ALL_ARR="/PrjDB/pcb/getAllArrDatas",e.GET_CANVAS="/PrjDB/pcb/getCanvas",e.SET_CANVAS="/PrjDB/pcb/setCanvas",e.COVER_CANVAS="/PrjDB/pcb/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/pcb/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/pcb/unwatchCanvas",e.GET_BY_SOURCE_VERSION="/PrjDB/pcb/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/pcb/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/pcb/getAllArrDatasBySource",e.TRY_RENAME="/PrjDB/pcb/tryRename",e.IS_RENAME="/PrjDB/pcb/isRename",e.BATCH_DELETE="/PrjDB/pcb/batchDelete",e.GET_ALL_KEYS="/PrjDB/pcb/getAllPrimaryKeys",e))(sx||{}),nx=(e=>(e.GET="/PrjDB/panel/getData",e.ADD="/PrjDB/panel/addData",e.DEL="/PrjDB/panel/delData",e.UPDATE="/PrjDB/panel/updateData",e.UPDATE_LOTS="/PrjDB/panel/updateLotDatas",e.GET_ALL_KV="/PrjDB/panel/getAllKVDatas",e.GET_ALL_ARR="/PrjDB/panel/getAllArrDatas",e.GET_CANVAS="/PrjDB/panel/getCanvas",e.SET_CANVAS="/PrjDB/panel/setCanvas",e.COVER_CANVAS="/PrjDB/panel/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/panel/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/panel/unwatchCanvas",e.TRY_RENAME="/PrjDB/panel/tryRename",e.IS_RENAME="/PrjDB/panel/isRename",e.BATCH_DELETE="/PrjDB/panel/batchDelete",e.GET_ALL_KEYS="/PrjDB/panel/getAllPrimaryKeys",e))(nx||{}),ax=(e=>(e.GET_BY_TITLE="/PrjDB/symbol/getDataByTitle",e.GET="/PrjDB/symbol/getData",e.ADD="/PrjDB/symbol/addData",e.CLONE="/PrjDB/symbol/cloneData",e.DEL="/PrjDB/symbol/delData",e.UPDATE="/PrjDB/symbol/updateData",e.GET_UUID_BY_TITLE="/PrjDB/symbol/getIdByTitle",e.GET_TITLE_BY_UUID="/PrjDB/symbol/getTitleById",e.GET_ALL_KV="/PrjDB/symbol/getAllKVDatas",e.GET_BY_SOURCE_VERSION="/PrjDB/symbol/getDataBySourceAndVersion",e.GET_COMPARE_TICKET="/PrjDB/symbol/getDataCompareTicket",e.GET_LAST="/PrjDB/symbol/getLastData",e.IS_EXIST="/PrjDB/symbol/isExist",e.GET_ALL_KEYS="/PrjDB/symbol/getAllPrimaryKeys",e.GET_ALL_ARR="/PrjDB/symbol/getAllArrDatas",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/symbol/getAllArrDatasBySource",e.GET_KEYS_BY_SOURCE="/PrjDB/symbol/getKeysBySource",e.GET_ALL_ARR_BY_TYPE="/PrjDB/symbol/getTypeDatas",e.GET_STR="/PrjDB/symbol/getStr",e.GET_CANVAS="/PrjDB/symbol/getCanvas",e.SET_CANVAS="/PrjDB/symbol/setCanvas",e.COVER_CANVAS="/PrjDB/symbol/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/symbol/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/symbol/unwatchCanvas",e.TRY_RENAME="/PrjDB/symbol/tryRename",e.WITH_ORIGINS="/PrjDB/symbol/withOrigins",e.IS_RENAME="/PrjDB/symbol/isRename",e.IS_CHANGE="/PrjDB/symbol/isChange",e.BATCH_DELETE="/PrjDB/symbol/batchDelete",e.GET_LIST="/PrjDB/symbol/getList",e))(ax||{}),ox=(e=>(e.GET_BY_TITLE="/PrjDB/footprint/getDataByTitle",e.GET="/PrjDB/footprint/getData",e.IS_EXIST="/PrjDB/footprint/isExist",e.ADD="/PrjDB/footprint/addData",e.CLONE="/PrjDB/footprint/cloneData",e.DEL="/PrjDB/footprint/delData",e.GET_ALL_KV="/PrjDB/footprint/getAllKVDatas",e.UPDATE="/PrjDB/footprint/updateData",e.UPDATE_IN_LOCAL="/PrjDB/footprint/updateDataInLocal",e.GET_TITLE_BY_UUID="/PrjDB/footprint/getTitleById",e.GET_BY_SOURCE_VERSION="/PrjDB/footprint/getDataBySourceAndVersion",e.GET_COMPARE_TICKET="/PrjDB/footprint/getDataCompareTicket",e.GET_LAST="/PrjDB/footprint/getLastData",e.GET_ALL_KEYS="/PrjDB/footprint/getAllPrimaryKeys",e.GET_ALL_ARR="/PrjDB/footprint/getAllArrDatas",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/footprint/getAllArrDatasBySource",e.GET_KEYS_BY_SOURCE="/PrjDB/footprint/getKeysBySource",e.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/footprint/getAllArrDatasByPcbId",e.GET_KEYS_BY_PCB_UUID="/PrjDB/footprint/getKeysByPcbId",e.GET_STR="/PrjDB/footprint/getStr",e.GET_CANVAS="/PrjDB/footprint/getCanvas",e.SET_CANVAS="/PrjDB/footprint/setCanvas",e.COVER_CANVAS="/PrjDB/footprint/coverCanvas",e.WATCH_CANVAS_UPDATE="/PrjDB/footprint/watchCanvas",e.UNWATCH_CANVAS_UPDATE="/PrjDB/footprint/unwatchCanvas",e.TRY_RENAME="/PrjDB/footprint/tryRename",e.WITH_ORIGINS="/PrjDB/footprint/withOrigins",e.IS_CHANGE="/PrjDB/footprint/isChange",e.IS_RENAME="/PrjDB/footprint/isRename",e.BATCH_DELETE="/PrjDB/footprint/batchDelete",e.GET_LIST="/PrjDB/footprint/getList",e))(ox||{}),lx=(e=>(e.GET="/PrjDB/device/getData",e.GET_BY_TITLE="/PrjDB/device/getDataByTitle",e.ADD="/PrjDB/device/addData",e.DEL="/PrjDB/device/delData",e.GET_ALL_KV="/PrjDB/device/getAllKVDatas",e.UPDATE="/PrjDB/device/updateData",e.GET_TITLE_BY_UUID="/PrjDB/device/getTitleById",e.GET_SYMBOL_UUID="/PrjDB/device/getSymbolIdById",e.GET_BY_SOURCE_VERSION="/PrjDB/device/getDataBySourceAndVersion",e.GET_LAST="/PrjDB/device/getLastData",e.GET_ALL_ARR_BY_SOURCE="/PrjDB/device/getAllArrDatasBySource",e.GET_KEYS_BY_SOURCE="/PrjDB/device/getKeysBySource",e.GET_COMPARE_TICKET="/PrjDB/device/getDataCompareTicket",e.IS_EXIST="/PrjDB/device/isExist",e.GET_ALL_KEYS="/PrjDB/device/getAllPrimaryKeys",e.GET_ALL_ARR="/PrjDB/device/getAllArrDatas",e.GET_ALL_ARR_BY_SYMBOL_UUID="/PrjDB/device/getAllArrDatasBySymbolId",e.GET_ALL_ARR_BY_FOOTPRINT_UUID="/PrjDB/device/getAllArrDatasByfootprintId",e.TRY_RENAME="/PrjDB/device/tryRename",e.BIND_SYMBOL="/PrjDB/device/bindSymbol",e.BIND_fOOTPRINT="/PrjDB/device/bindFootprint",e.WITH_ORIGINS="/PrjDB/device/withOrigins",e.IS_CHANGE="/PrjDB/device/isChange",e.IS_RENAME="/PrjDB/device/isRename",e.PLACE="/PrjDB/device/place",e.BATCH_DELETE="/PrjDB/device/batchDelete",e.GET_LIST="/PrjDB/device/getList",e))(lx||{}),hx=(e=>(e.GET="/PrjDB/attr/getData",e.UPDATE="/PrjDB/attr/updateData",e.BATCH_UPDATE="/PrjDB/attr/batchUpdateData",e.ADD="/PrjDB/attr/addData",e.DEL="/PrjDB/attr/delData",e.GET_ALL_KV="/PrjDB/attr/getAllKVDatas",e.GET_ALL_ARR="/PrjDB/attr/getAllArrDatas",e.GET_ALL_ARR_BY_HASH="/PrjDB/attr/getAllArrDatasByHash",e.BATCH_DELETE="/PrjDB/attr/batchDelete",e))(hx||{}),cx=(e=>(e.GET="/PrjDB/blob/getData",e.ADD="/PrjDB/blob/addData",e.DEL="/PrjDB/blob/delData",e.GET_ALL_ARR="/PrjDB/blob/getAllArrDatas",e.BATCH_DELETE="/PrjDB/blob/batchDelete",e))(cx||{}),ux=(e=>(e.GET="/PrjDB/copper/getData",e.ADD="/PrjDB/copper/addData",e.DEL_LOTS="/PrjDB/copper/delLotDatas",e.DEL="/PrjDB/copper/delData",e.GET_ALL_KEYS="/PrjDB/copper/getAllPrimaryKeys",e.UPDATE="/PrjDB/copper/updateData",e.GET_ALL_ARR="/PrjDB/copper/getAllArrDatas",e.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/copper/getAllArrDatasByPcbId",e.GET_ALL_KEYS_BY_PCB_UUID="/PrjDB/copper/getAllArrKeysByPcbId",e))(ux||{}),dx=(e=>(e.GET="/PrjDB/font/getData",e.ADD="/PrjDB/font/addData",e.DEL_LOTS="/PrjDB/font/delLotDatas",e.DEL="/PrjDB/font/delData",e.GET_ALL_KEYS="/PrjDB/font/getAllPrimaryKeys",e.UPDATE="/PrjDB/font/updateData",e.GET_ALL_ARR="/PrjDB/font/getAllArrDatas",e.GET_ALL_ARR_BY_PCB_UUID="/PrjDB/font/getAllArrDatasByPcbId",e.GET_ALL_KEYS_BY_PCB_UUID="/PrjDB/font/getAllArrKeysByPcbId",e))(dx||{}),fx=(e=>(e.BATCH_ADD="/PrjDB/variant/batchAddVariant",e.ADD="/PrjDB/variant/addData",e.DELETE="/PrjDB/variant/deleteData",e.BATCH_DELETE="/PrjDB/variant/batchDeleteData",e.BATCH_RESTORE="/PrjDB/variant/batchRestoreData",e.GET="/PrjDB/variant/getData",e.GET_ALL_ARR_BY_SID="/PrjDB/variant/getAllArrDatasBySid",e.UPDATE_TITLE="/PrjDB/variant/updateTitle",e.UPDATE_NOT_GROUPED="/PrjDB/variant/updateNotGrouped",e.BATCH_UPDATE_SORT="/PrjDB/variant/batchUpdateZIndex",e))(fx||{}),px=(e=>(e.BATCH_ADD="/PrjDB/componentGroup/batchAddData",e.ADD="/PrjDB/componentGroup/addData",e.DELETE="/PrjDB/componentGroup/deleteData",e.BATCH_DELETE="/PrjDB/componentGroup/batchDeleteData",e.BATCH_RESTORE="/PrjDB/componentGroup/batchRestoreData",e.GET="/PrjDB/componentGroup/getData",e.GET_ALL_ARR_BY_SID="/PrjDB/componentGroup/getAllArrDatasBySid",e.GET_ATTR_DATA="/PrjDB/componentGroup/getComponentGroupData",e.UPDATE_TITLE="/PrjDB/componentGroup/updateTitle",e.BATCH_UPDATE_SORT="/PrjDB/componentGroup/batchUpdateZIndex",e.BATCH_UPLOAD_VARIANT_INDEX="/PrjDB/componentGroup/batchUploadGroupSortInVariant",e.BATCH_DELETE_VARIANT_INDEX="/PrjDB/componentGroup/batchDeleteGroupSortInVariant",e.UPLOAD_ATTR_DATA="/PrjDB/componentGroup/uploadComponentGroupData",e.BATCH_DELETE_ATTR_DATA="/PrjDB/componentGroup/batchDeleteComponentGroupData",e))(px||{}),at={VARIANT:fx,COMPONENT_GROUP:px,COMMON:Kb,PROJECT:$b,CONFIG:Qb,BOARD:ex,SCHEMATIC:tx,SHEET:ix,SIMULATION:rx,PCB:sx,PANEL:nx,SYMBOL:ax,FOOTPRINT:ox,DEVICE:lx,ATTR:hx,BLOB:cx,COPPER:ux,FONT:dx},ED=Ru(Du());function Hh(e){return!e.data}function TD(e){return!!(e.path&&e.uuid&&e.docType&&e.isProject!==void 0&&Object.keys(e).length===4)}async function ha(e){let{origin:t,target:i}=e,r=await j2.getProLibSource(t);if(r.success===!1)return{success:!1,code:r.code,message:r.message};let s=r.result;if(i.isProject)if(i.docType===4){let n=[i.uuid,s,i.version,i.path];return{success:!!(await Ge.messageBus.rpcCall(at.FOOTPRINT.COVER_CANVAS,n)).message}}else if(_p(i.docType)){let n=[i.uuid,s,i.version,i.path];return{success:!!(await Ge.messageBus.rpcCall(at.SYMBOL.COVER_CANVAS,n)).message}}else throw new Error("Api call error!");else{let n=await j2.getProLibSource(i);if(n.success===!1)return{success:!1,code:n.code,message:n.message};let a=n.result,o=ps(),l;if(i.docType===4)l=dO(a,s,{docType:xu.FOOTPRINT,uuid:i.uuid,client:o});else if(i.docType===29)l=dO(a,s,{docType:xu.PANEL_LIB,uuid:i.uuid,client:o});else if(_p(i.docType))l=dO(a,s,{docType:xu.SYMBOL,uuid:i.uuid,client:o});else throw new Error("Api call error!");let h={uuid:i.uuid,dataStr:l},{message:c}=await Ge.messageBus.rpcCall(Ha.COMPONENT.SET_HISTORY,h);return c.success===!1?{success:!1,code:c.code,message:c.message}:{success:!0}}}function wD(e){return self[e]=self[e]||new ED.BroadcastChannelMessageBus(e)}var Cp=(e=>(e.OPEN="/pro-mgr/project/open",e.CLOSE="/pro-mgr/project/close",e.TEMP_OPEN="/pro-mgr/project/tempOpen",e.TEMP_OPEN_BY_STRING="/pro-mgr/project/tempOpenByString",e.TEMP_CLOSE="/pro-mgr/project/tempClose",e.ON_OPENED="/pro-mgr/project/onOpened",e.ON_TEMP_OPENED="/pro-mgr/project/onTempOpened",e.BEFORE_CLOSE="/pro-mgr/project/beforeClose",e.ON_CLOSED="/pro-mgr/project/onClosed",e.ON_TEMP_CLOSED="/pro-mgr/project/onTempClosed",e.ON_FAILED="/pro-mgr/project/onFailed",e.GET_RECENT_PROJECT_LIST="/pro-mgr/getRecentPrjList",e.UPDATE_PROJECT="/pro-mgr/updateProject",e.DEL_PROJECT="/pro-mgr/deleteProject",e.HAS="/pro-mgr/hasProject",e))(Cp||{}),SD=(e=>(e.SYSTEM="system",e.INTERNAL="Internal",e.PERSONAL="personal",e.PROJECT="project",e.STAR="star",e.TEAMS="teams",e.USER="user",e.CLIENT="client",e.PUBLIC="public",e.OSHWHUB="oshwhub",e.EXTEND="extend",e))(SD||{}),ID=(e=>(e.DEVICE="device",e.SYMBOL="symbol",e.FOOTPRINT="footprint",e.CBB="cbb",e.MODEL3D="model3D",e.PANEL_LIB="panelLib",e.MODEL_SIM_LIB="modelSimLib",e))(ID||{}),vm={D3Model:{client3DModelList:"api/client/steps"}},yt,nt=(yt=class{},yt.CANVAS_UNIT_MM="mm",yt.CANVAS_UNIT_MIL="mil",yt.HEX_BLACK_COLOR="#000000",yt.HEX_WHITE_COLOR="#FFFFFF",yt.HEX_RED_COLOR="#FF0000",yt.HEX_GREEN_COLOR="#00FF00",yt.HEX_BLUE_COLOR="#0000FF",yt.HEX_GRAY_COLOR1="#F1F1F1",yt.HEX_GRAY_COLOR2="#EFEFEF",yt.HEX_GRAY_COLOR3="#999999",yt.HEX_GRAY_COLOR4="#666666",yt.HEX_GRAY_COLOR5="#333333",yt.HEX_GRAY_COLOR6="#CCCCCC",yt.DEFAULT_PAGESIZE=50,yt.SYMBOLTYPE_ITEM_ALL_VALUE="@all",yt.SYMBOLTYPE_ITEM_ALL_TITLE="All",yt.D3MVIEW_DEFAULT_TRANSFORM="0, 0, 0, 0, 0, 0, 0, 0, 0",yt.DEVICE_INDEX_TAG="$_",yt.DEVICE_SPLIT_TAG="@_",yt.LIB_SPLIT_TAG="#_",yt.CATEGORY_ITEM_ALL_VALUE="@all",yt.CATEGORY_ITEM_ALL_TITLE="All",yt.FAVORITELIB_UUID="star",yt.SYSTEMLIB_UUID="0819f05c4eef4c71ace90d822a990e87",yt.SYSTEMLIB_UUID_ALIAS="lcsc",yt.USERLIB_ALIAS="mine",yt.PUBLICLIB_ALIAS="user",yt.STD_PUBLIC_LIB_UUID="stdPublic",yt.INTERNAL_LIB_ALIAS="Internal",yt.PERSIONAL_WORKSPACE="Personal",yt.EDU_WORKSPACE="6d84b27f18f540b6a31c4d657314ab13",yt.EDA_TEST_WORKSPACE="407ec92f2a2f4275bf08cbebf64f5e08",yt.LIB_SYSTEM_KEY="system",yt.LIB_PROJECT_KEY="project",yt.LIB_PERSONAL_KEY="personal",yt.LIB_PUBLIC_KEY="public",yt.LIB_INTERNAL_KEY="Internal",yt.LIB_FAVORITE_KEY="favorite",yt.LIB_TEMAS_KEY="teams",yt.API=vm,yt.ERR_CODE={NORMAL:-1,DUP_NAME:-9001},yt),L2={},PD=function(e,t,i,r,s){var n=new Worker(L2[t]||(L2[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return n.onmessage=function(a){var o=a.data,l=o.$e$;if(l){var h=new Error(l[0]);h.code=l[1],h.stack=l[2],s(h,null)}else s(null,o)},n.postMessage(i,r),n},Vt=Uint8Array,ws=Uint16Array,zu=Int32Array,jh=new Vt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yh=new Vt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Cu=new Vt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_x=function(e,t){for(var i=new ws(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];for(var s=new zu(i[30]),r=1;r<30;++r)for(var n=i[r];n<i[r+1];++n)s[n]=n-i[r]<<5|r;return{b:i,r:s}},gx=_x(jh,2),Em=gx.b,gp=gx.r;Em[28]=258,gp[258]=28;var Ox=_x(Yh,0),mx=Ox.b,ZO=Ox.r,Nu=new ws(32768);for(Ci=0;Ci<32768;++Ci)Ca=(Ci&43690)>>1|(Ci&21845)<<1,Ca=(Ca&52428)>>2|(Ca&13107)<<2,Ca=(Ca&61680)>>4|(Ca&3855)<<4,Nu[Ci]=((Ca&65280)>>8|(Ca&255)<<8)>>1;var hn=function(e,t,i){for(var r=e.length,s=0,n=new ws(t);s<r;++s)e[s]&&++n[e[s]-1];var a=new ws(t);for(s=1;s<t;++s)a[s]=a[s-1]+n[s-1]<<1;var o;if(i){o=new ws(1<<t);var l=15-t;for(s=0;s<r;++s)if(e[s])for(var h=s<<4|e[s],c=t-e[s],f=a[e[s]-1]++<<c,d=f|(1<<c)-1;f<=d;++f)o[Nu[f]>>l]=h}else for(o=new ws(r),s=0;s<r;++s)e[s]&&(o[s]=Nu[a[e[s]-1]++]>>15-e[s]);return o},ja=new Vt(288);for(Ci=0;Ci<144;++Ci)ja[Ci]=8;for(Ci=144;Ci<256;++Ci)ja[Ci]=9;for(Ci=256;Ci<280;++Ci)ja[Ci]=7;for(Ci=280;Ci<288;++Ci)ja[Ci]=8;var Fh=new Vt(32);for(Ci=0;Ci<32;++Ci)Fh[Ci]=5;var yx=hn(ja,9,0),bx=hn(ja,9,1),xx=hn(Fh,5,0),vx=hn(Fh,5,1),Kf=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},an=function(e,t,i){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&i},$f=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(t&7)},Vh=function(e){return(e+7)/8|0},oa=function(e,t,i){return(t==null||t<0)&&(t=0),(i==null||i>e.length)&&(i=e.length),new Vt(e.subarray(t,i))};var Ex=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Tt=function(e,t,i){var r=new Error(t||Ex[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Tt),!i)throw r;return r},Np=function(e,t,i,r){var s=e.length,n=r?r.length:0;if(!s||t.f&&!t.l)return i||new Vt(0);var a=!i,o=a||t.i!=2,l=t.i;a&&(i=new Vt(s*3));var h=function(Z){var re=i.length;if(Z>re){var ue=new Vt(Math.max(re*2,Z));ue.set(i),i=ue}},c=t.f||0,f=t.p||0,d=t.b||0,u=t.l,p=t.d,_=t.m,g=t.n,b=s*8;do{if(!u){c=an(e,f,1);var m=an(e,f+1,3);if(f+=3,m)if(m==1)u=bx,p=vx,_=9,g=5;else if(m==2){var O=an(e,f,31)+257,y=an(e,f+10,15)+4,x=O+an(e,f+5,31)+1;f+=14;for(var E=new Vt(x),w=new Vt(19),S=0;S<y;++S)w[Cu[S]]=an(e,f+S*3,7);f+=y*3;for(var C=Kf(w),R=(1<<C)-1,B=hn(w,C,1),S=0;S<x;){var Y=B[an(e,f,R)];f+=Y&15;var G=Y>>4;if(G<16)E[S++]=G;else{var z=0,q=0;for(G==16?(q=3+an(e,f,3),f+=2,z=E[S-1]):G==17?(q=3+an(e,f,7),f+=3):G==18&&(q=11+an(e,f,127),f+=7);q--;)E[S++]=z}}var L=E.subarray(0,O),M=E.subarray(O);_=Kf(L),g=Kf(M),u=hn(L,_,1),p=hn(M,g,1)}else Tt(1);else{var G=Vh(f)+4,v=e[G-4]|e[G-3]<<8,P=G+v;if(P>s){l&&Tt(0);break}o&&h(d+v),i.set(e.subarray(G,P),d),t.b=d+=v,t.p=f=P*8,t.f=c;continue}if(f>b){l&&Tt(0);break}}o&&h(d+131072);for(var I=(1<<_)-1,N=(1<<g)-1,D=f;;D=f){var z=u[$f(e,f)&I],j=z>>4;if(f+=z&15,f>b){l&&Tt(0);break}if(z||Tt(2),j<256)i[d++]=j;else if(j==256){D=f,u=null;break}else{var H=j-254;if(j>264){var S=j-257,K=jh[S];H=an(e,f,(1<<K)-1)+Em[S],f+=K}var se=p[$f(e,f)&N],he=se>>4;se||Tt(3),f+=se&15;var M=mx[he];if(he>3){var K=Yh[he];M+=$f(e,f)&(1<<K)-1,f+=K}if(f>b){l&&Tt(0);break}o&&h(d+131072);var _e=d+H;if(d<M){var ve=n-M,J=Math.min(M,_e);for(ve+d<0&&Tt(3);d<J;++d)i[d]=r[ve+d]}for(;d<_e;++d)i[d]=i[d-M]}}t.l=u,t.p=D,t.b=d,t.f=c,u&&(c=1,t.m=_,t.d=p,t.n=g)}while(!c);return d!=i.length&&a?oa(i,0,d):i.subarray(0,d)},ea=function(e,t,i){i<<=t&7;var r=t/8|0;e[r]|=i,e[r+1]|=i>>8},Th=function(e,t,i){i<<=t&7;var r=t/8|0;e[r]|=i,e[r+1]|=i>>8,e[r+2]|=i>>16},Qf=function(e,t){for(var i=[],r=0;r<e.length;++r)e[r]&&i.push({s:r,f:e[r]});var s=i.length,n=i.slice();if(!s)return{t:Ao,l:0};if(s==1){var a=new Vt(i[0].s+1);return a[i[0].s]=1,{t:a,l:1}}i.sort(function(x,E){return x.f-E.f}),i.push({s:-1,f:25001});var o=i[0],l=i[1],h=0,c=1,f=2;for(i[0]={s:-1,f:o.f+l.f,l:o,r:l};c!=s-1;)o=i[i[h].f<i[f].f?h++:f++],l=i[h!=c&&i[h].f<i[f].f?h++:f++],i[c++]={s:-1,f:o.f+l.f,l:o,r:l};for(var d=n[0].s,r=1;r<s;++r)n[r].s>d&&(d=n[r].s);var u=new ws(d+1),p=Op(i[c-1],u,0);if(p>t){var r=0,_=0,g=p-t,b=1<<g;for(n.sort(function(E,w){return u[w.s]-u[E.s]||E.f-w.f});r<s;++r){var m=n[r].s;if(u[m]>t)_+=b-(1<<p-u[m]),u[m]=t;else break}for(_>>=g;_>0;){var O=n[r].s;u[O]<t?_-=1<<t-u[O]++-1:++r}for(;r>=0&&_;--r){var y=n[r].s;u[y]==t&&(--u[y],++_)}p=t}return{t:new Vt(u),l:p}},Op=function(e,t,i){return e.s==-1?Math.max(Op(e.l,t,i+1),Op(e.r,t,i+1)):t[e.s]=i},KO=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new ws(++t),r=0,s=e[0],n=1,a=function(l){i[r++]=l},o=1;o<=t;++o)if(e[o]==s&&o!=t)++n;else{if(!s&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(s),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(s);n=1,s=e[o]}return{c:i.subarray(0,r),n:t}},wh=function(e,t){for(var i=0,r=0;r<t.length;++r)i+=e[r]*t[r];return i},Tm=function(e,t,i){var r=i.length,s=Vh(t+2);e[s]=r&255,e[s+1]=r>>8,e[s+2]=e[s]^255,e[s+3]=e[s+1]^255;for(var n=0;n<r;++n)e[s+n+4]=i[n];return(s+4+r)*8},$O=function(e,t,i,r,s,n,a,o,l,h,c){ea(t,c++,i),++s[256];for(var f=Qf(s,15),d=f.t,u=f.l,p=Qf(n,15),_=p.t,g=p.l,b=KO(d),m=b.c,O=b.n,y=KO(_),x=y.c,E=y.n,w=new ws(19),S=0;S<m.length;++S)++w[m[S]&31];for(var S=0;S<x.length;++S)++w[x[S]&31];for(var C=Qf(w,7),R=C.t,B=C.l,Y=19;Y>4&&!R[Cu[Y-1]];--Y);var G=h+5<<3,z=wh(s,ja)+wh(n,Fh)+a,q=wh(s,d)+wh(n,_)+a+14+3*Y+wh(w,R)+2*w[16]+3*w[17]+7*w[18];if(l>=0&&G<=z&&G<=q)return Tm(t,c,e.subarray(l,l+h));var L,M,v,P;if(ea(t,c,1+(q<z)),c+=2,q<z){L=hn(d,u,0),M=d,v=hn(_,g,0),P=_;var I=hn(R,B,0);ea(t,c,O-257),ea(t,c+5,E-1),ea(t,c+10,Y-4),c+=14;for(var S=0;S<Y;++S)ea(t,c+3*S,R[Cu[S]]);c+=3*Y;for(var N=[m,x],D=0;D<2;++D)for(var j=N[D],S=0;S<j.length;++S){var H=j[S]&31;ea(t,c,I[H]),c+=R[H],H>15&&(ea(t,c,j[S]>>5&127),c+=j[S]>>12)}}else L=yx,M=ja,v=xx,P=Fh;for(var S=0;S<o;++S){var K=r[S];if(K>255){var H=K>>18&31;Th(t,c,L[H+257]),c+=M[H+257],H>7&&(ea(t,c,K>>23&31),c+=jh[H]);var se=K&31;Th(t,c,v[se]),c+=P[se],se>3&&(Th(t,c,K>>5&8191),c+=Yh[se])}else Th(t,c,L[K]),c+=M[K]}return Th(t,c,L[256]),c+M[256]},Tx=new zu([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ao=new Vt(0),wx=function(e,t,i,r,s,n){var a=n.z||e.length,o=new Vt(r+a+5*(1+Math.ceil(a/7e3))+s),l=o.subarray(r,o.length-s),h=n.l,c=(n.r||0)&7;if(t){c&&(l[0]=n.r>>3);for(var f=Tx[t-1],d=f>>13,u=f&8191,p=(1<<i)-1,_=n.p||new ws(32768),g=n.h||new ws(p+1),b=Math.ceil(i/3),m=2*b,O=function(Le){return(e[Le]^e[Le+1]<<b^e[Le+2]<<m)&p},y=new zu(25e3),x=new ws(288),E=new ws(32),w=0,S=0,C=n.i||0,R=0,B=n.w||0,Y=0;C+2<a;++C){var G=O(C),z=C&32767,q=g[G];if(_[z]=q,g[G]=z,B<=C){var L=a-C;if((w>7e3||R>24576)&&(L>423||!h)){c=$O(e,l,0,y,x,E,S,R,Y,C-Y,c),R=w=S=0,Y=C;for(var M=0;M<286;++M)x[M]=0;for(var M=0;M<30;++M)E[M]=0}var v=2,P=0,I=u,N=z-q&32767;if(L>2&&G==O(C-N))for(var D=Math.min(d,L)-1,j=Math.min(32767,C),H=Math.min(258,L);N<=j&&--I&&z!=q;){if(e[C+v]==e[C+v-N]){for(var K=0;K<H&&e[C+K]==e[C+K-N];++K);if(K>v){if(v=K,P=N,K>D)break;for(var se=Math.min(N,K-2),he=0,M=0;M<se;++M){var _e=C-N+M&32767,ve=_[_e],J=_e-ve&32767;J>he&&(he=J,q=_e)}}}z=q,q=_[z],N+=z-q&32767}if(P){y[R++]=268435456|gp[v]<<18|ZO[P];var Z=gp[v]&31,re=ZO[P]&31;S+=jh[Z]+Yh[re],++x[257+Z],++E[re],B=C+v,++w}else y[R++]=e[C],++x[e[C]]}}for(C=Math.max(C,B);C<a;++C)y[R++]=e[C],++x[e[C]];c=$O(e,l,h,y,x,E,S,R,Y,C-Y,c),h||(n.r=c&7|l[c/8|0]<<3,c-=7,n.h=g,n.p=_,n.i=C,n.w=B)}else{for(var C=n.w||0;C<a+h;C+=65535){var ue=C+65535;ue>=a&&(l[c/8|0]=h,ue=a),c=Tm(l,c+1,e.subarray(C,ue))}n.i=a}return oa(o,0,r+Vh(c)+s)},AD=(function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var i=t,r=9;--r;)i=(i&1&&-306674912)^i>>>1;e[t]=i}return e})(),wm=function(){var e=-1;return{p:function(t){for(var i=e,r=0;r<t.length;++r)i=AD[i&255^t[r]]^i>>>8;e=i},d:function(){return~e}}},Sx=function(){var e=1,t=0;return{p:function(i){for(var r=e,s=t,n=i.length|0,a=0;a!=n;){for(var o=Math.min(a+2655,n);a<o;++a)s+=r+=i[a];r=(r&65535)+15*(r>>16),s=(s&65535)+15*(s>>16)}e=r,t=s},d:function(){return e%=65521,t%=65521,(e&255)<<24|(e&65280)<<8|(t&255)<<8|t>>8}}},qh=function(e,t,i,r,s){if(!s&&(s={l:1},t.dictionary)){var n=t.dictionary.subarray(-32768),a=new Vt(n.length+e.length);a.set(n),a.set(e,n.length),e=a,s.w=n.length}return wx(e,t.level==null?6:t.level,t.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,i,r,s)},Ix=function(e,t){var i={};for(var r in e)i[r]=e[r];for(var r in t)i[r]=t[r];return i},R2=function(e,t,i){for(var r=e(),s=e.toString(),n=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<r.length;++a){var o=r[a],l=n[a];if(typeof o=="function"){t+=";"+l+"=";var h=o.toString();if(o.prototype)if(h.indexOf("[native code]")!=-1){var c=h.indexOf(" ",8)+1;t+=h.slice(c,h.indexOf("(",c))}else{t+=h;for(var f in o.prototype)t+=";"+l+".prototype."+f+"="+o.prototype[f].toString()}else t+=h}else i[l]=o}return t},zf=[],CD=function(e){var t=[];for(var i in e)e[i].buffer&&t.push((e[i]=new e[i].constructor(e[i])).buffer);return t},ND=function(e,t,i,r){if(!zf[i]){for(var s="",n={},a=e.length-1,o=0;o<a;++o)s=R2(e[o],s,n);zf[i]={c:R2(e[a],s,n),e:n}}var l=Ix({},zf[i].e);return PD(zf[i].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",i,l,CD(l),r)},Sm=function(){return[Vt,ws,zu,jh,Yh,Cu,Em,mx,bx,vx,Nu,Ex,hn,Kf,an,$f,Vh,oa,Tt,Np,FD,Px,MD]},LD=function(){return[Vt,ws,zu,jh,Yh,Cu,gp,ZO,yx,ja,xx,Fh,Nu,Tx,Ao,hn,ea,Th,Qf,Op,KO,wh,Tm,$O,Vh,oa,wx,qh,UD,Px]};var RD=function(){return[Im,Cx]};var DD=function(){return[Lx]},Px=function(e){return postMessage(e,[e.buffer])},MD=function(e){return e&&{out:e.size&&new Vt(e.size),dictionary:e.dictionary}};var Mo=function(e){return e.ondata=function(t,i){return postMessage([t,i],[t.buffer])},function(t){t.data.length?(e.push(t.data[0],t.data[1]),postMessage([t.data[0].length])):e.flush()}},Lp=function(e,t,i,r,s,n,a){var o,l=ND(e,r,s,function(h,c){h?(l.terminate(),t.ondata.call(t,h)):Array.isArray(c)?c.length==1?(t.queuedSize-=c[0],t.ondrain&&t.ondrain(c[0])):(c[1]&&l.terminate(),t.ondata.call(t,h,c[0],c[1])):a(c)});l.postMessage(i),t.queuedSize=0,t.push=function(h,c){t.ondata||Tt(5),o&&t.ondata(Tt(4,0,1),null,!!c),t.queuedSize+=h.length,l.postMessage([h,o=c],[h.buffer])},t.terminate=function(){l.terminate()},n&&(t.flush=function(){l.postMessage([])})},Ah=function(e,t){return e[t]|e[t+1]<<8},Ch=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},DO=function(e,t){return Ch(e,t)+Ch(e,t+4)*4294967296},wi=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8},Ax=function(e,t){var i=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:t.level==9?2:0,e[9]=3,t.mtime!=0&&wi(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),i){e[3]=8;for(var r=0;r<=i.length;++r)e[r+10]=i.charCodeAt(r)}},Im=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&Tt(6,"invalid gzip data");var t=e[3],i=10;t&4&&(i+=(e[10]|e[11]<<8)+2);for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[i++]);return i+(t&2)},Cx=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Nx=function(e){return 10+(e.filename?e.filename.length+1:0)},BD=function(e,t){var i=t.level,r=i==0?0:i<6?1:i==9?3:2;if(e[0]=120,e[1]=r<<6|(t.dictionary&&32),e[1]|=31-(e[0]<<8|e[1])%31,t.dictionary){var s=Sx();s.p(t.dictionary),wi(e,2,s.d())}},Lx=function(e,t){return((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)&&Tt(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&Tt(6,"invalid zlib data: "+(e[1]&32?"need":"unexpected")+" dictionary"),(e[1]>>3&4)+2};function Hu(e,t){return typeof e=="function"&&(t=e,e={}),this.ondata=t,e}var Ga=(function(){function e(t,i){if(typeof t=="function"&&(i=t,t={}),this.ondata=i,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new Vt(98304),this.o.dictionary){var r=this.o.dictionary.subarray(-32768);this.b.set(r,32768-r.length),this.s.i=32768-r.length}}return e.prototype.p=function(t,i){this.ondata(qh(t,this.o,0,0,this.s),i)},e.prototype.push=function(t,i){this.ondata||Tt(5),this.s.l&&Tt(4);var r=t.length+this.s.z;if(r>this.b.length){if(r>2*this.b.length-32768){var s=new Vt(r&-32768);s.set(this.b.subarray(0,this.s.z)),this.b=s}var n=this.b.length-this.s.z;this.b.set(t.subarray(0,n),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(n),32768),this.s.z=t.length-n+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=i&1,(this.s.z>this.s.w+8191||i)&&(this.p(this.b,i||!1),this.s.w=this.s.i,this.s.i-=2)},e.prototype.flush=function(){this.ondata||Tt(5),this.s.l&&Tt(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},e})(),kD=(function(){function e(t,i){Lp([LD,function(){return[Mo,Ga]}],this,Hu.call(this,t,i),function(r){var s=new Ga(r.data);onmessage=Mo(s)},6,1)}return e})();function UD(e,t){return qh(e,t||{},0,0)}var qs=(function(){function e(t,i){typeof t=="function"&&(i=t,t={}),this.ondata=i;var r=t&&t.dictionary&&t.dictionary.subarray(-32768);this.s={i:0,b:r?r.length:0},this.o=new Vt(32768),this.p=new Vt(0),r&&this.o.set(r)}return e.prototype.e=function(t){if(this.ondata||Tt(5),this.d&&Tt(4),!this.p.length)this.p=t;else if(t.length){var i=new Vt(this.p.length+t.length);i.set(this.p),i.set(t,this.p.length),this.p=i}},e.prototype.c=function(t){this.s.i=+(this.d=t||!1);var i=this.s.b,r=Np(this.p,this.s,this.o);this.ondata(oa(r,i,this.s.b),this.d),this.o=oa(r,this.s.b-32768),this.s.b=this.o.length,this.p=oa(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(t,i){this.e(t),this.c(i)},e})(),Rx=(function(){function e(t,i){Lp([Sm,function(){return[Mo,qs]}],this,Hu.call(this,t,i),function(r){var s=new qs(r.data);onmessage=Mo(s)},7,0)}return e})();function FD(e,t){return Np(e,{i:2},t&&t.out,t&&t.dictionary)}var Kq=(function(){function e(t,i){this.c=wm(),this.l=0,this.v=1,Ga.call(this,t,i)}return e.prototype.push=function(t,i){this.c.p(t),this.l+=t.length,Ga.prototype.push.call(this,t,i)},e.prototype.p=function(t,i){var r=qh(t,this.o,this.v&&Nx(this.o),i&&8,this.s);this.v&&(Ax(r,this.o),this.v=0),i&&(wi(r,r.length-8,this.c.d()),wi(r,r.length-4,this.l)),this.ondata(r,i)},e.prototype.flush=function(){Ga.prototype.flush.call(this)},e})();function GD(e,t){t||(t={});var i=wm(),r=e.length;i.p(e);var s=qh(e,t,Nx(t),8),n=s.length;return Ax(s,t),wi(s,n-8,i.d()),wi(s,n-4,r),s}var QO=(function(){function e(t,i){this.v=1,this.r=0,qs.call(this,t,i)}return e.prototype.push=function(t,i){if(qs.prototype.e.call(this,t),this.r+=t.length,this.v){var r=this.p.subarray(this.v-1),s=r.length>3?Im(r):4;if(s>r.length){if(!i)return}else this.v>1&&this.onmember&&this.onmember(this.r-r.length);this.p=r.subarray(s),this.v=0}qs.prototype.c.call(this,i),this.s.f&&!this.s.l&&!i&&(this.v=Vh(this.s.p)+9,this.s={i:0},this.o=new Vt(0),this.push(new Vt(0),i))},e})(),zD=(function(){function e(t,i){var r=this;Lp([Sm,RD,function(){return[Mo,qs,QO]}],this,Hu.call(this,t,i),function(s){var n=new QO(s.data);n.onmember=function(a){return postMessage(a)},onmessage=Mo(n)},9,0,function(s){return r.onmember&&r.onmember(s)})}return e})();function HD(e,t){var i=Im(e);return i+8>e.length&&Tt(6,"invalid gzip data"),Np(e.subarray(i,-8),{i:2},t&&t.out||new Vt(Cx(e)),t&&t.dictionary)}var $q=(function(){function e(t,i){this.c=Sx(),this.v=1,Ga.call(this,t,i)}return e.prototype.push=function(t,i){this.c.p(t),Ga.prototype.push.call(this,t,i)},e.prototype.p=function(t,i){var r=qh(t,this.o,this.v&&(this.o.dictionary?6:2),i&&4,this.s);this.v&&(BD(r,this.o),this.v=0),i&&wi(r,r.length-4,this.c.d()),this.ondata(r,i)},e.prototype.flush=function(){Ga.prototype.flush.call(this)},e})();var em=(function(){function e(t,i){qs.call(this,t,i),this.v=t&&t.dictionary?2:1}return e.prototype.push=function(t,i){if(qs.prototype.e.call(this,t),this.v){if(this.p.length<6&&!i)return;this.p=this.p.subarray(Lx(this.p,this.v-1)),this.v=0}i&&(this.p.length<4&&Tt(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),qs.prototype.c.call(this,i)},e})(),jD=(function(){function e(t,i){Lp([Sm,DD,function(){return[Mo,qs,em]}],this,Hu.call(this,t,i),function(r){var s=new em(r.data);onmessage=Mo(s)},11,0)}return e})();var D2=(function(){function e(t,i){this.o=Hu.call(this,t,i)||{},this.G=QO,this.I=qs,this.Z=em}return e.prototype.i=function(){var t=this;this.s.ondata=function(i,r){t.ondata(i,r)}},e.prototype.push=function(t,i){if(this.ondata||Tt(5),this.s)this.s.push(t,i);else{if(this.p&&this.p.length){var r=new Vt(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length)}else this.p=t;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,i),this.p=null)}},e})(),Qq=(function(){function e(t,i){D2.call(this,t,i),this.queuedSize=0,this.G=zD,this.I=Rx,this.Z=jD}return e.prototype.i=function(){var t=this;this.s.ondata=function(i,r,s){t.ondata(i,r,s)},this.s.ondrain=function(i){t.queuedSize-=i,t.ondrain&&t.ondrain(i)}},e.prototype.push=function(t,i){this.queuedSize+=t.length,D2.prototype.push.call(this,t,i)},e})();var M2=typeof TextEncoder<"u"&&new TextEncoder,tm=typeof TextDecoder<"u"&&new TextDecoder,Dx=0;try{tm.decode(Ao,{stream:!0}),Dx=1}catch{}var Mx=function(e){for(var t="",i=0;;){var r=e[i++],s=(r>127)+(r>223)+(r>239);if(i+s>e.length)return{s:t,r:oa(e,i-1)};s?s==3?(r=((r&15)<<18|(e[i++]&63)<<12|(e[i++]&63)<<6|e[i++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):s&1?t+=String.fromCharCode((r&31)<<6|e[i++]&63):t+=String.fromCharCode((r&15)<<12|(e[i++]&63)<<6|e[i++]&63):t+=String.fromCharCode(r)}},eX=(function(){function e(t){this.ondata=t,Dx?this.t=new TextDecoder:this.p=Ao}return e.prototype.push=function(t,i){if(this.ondata||Tt(5),i=!!i,this.t){this.ondata(this.t.decode(t,{stream:!0}),i),i&&(this.t.decode().length&&Tt(8),this.t=null);return}this.p||Tt(4);var r=new Vt(this.p.length+t.length);r.set(this.p),r.set(t,this.p.length);var s=Mx(r),n=s.s,a=s.r;i?(a.length&&Tt(8),this.p=null):this.p=a,this.ondata(n,i)},e})(),tX=(function(){function e(t){this.ondata=t}return e.prototype.push=function(t,i){this.ondata||Tt(5),this.d&&Tt(4),this.ondata(im(t),this.d=i||!1)},e})();function im(e,t){if(t){for(var i=new Vt(e.length),r=0;r<e.length;++r)i[r]=e.charCodeAt(r);return i}if(M2)return M2.encode(e);for(var s=e.length,n=new Vt(e.length+(e.length>>1)),a=0,o=function(f){n[a++]=f},r=0;r<s;++r){if(a+5>n.length){var l=new Vt(a+8+(s-r<<1));l.set(n),n=l}var h=e.charCodeAt(r);h<128||t?o(h):h<2048?(o(192|h>>6),o(128|h&63)):h>55295&&h<57344?(h=65536+(h&1047552)|e.charCodeAt(++r)&1023,o(240|h>>18),o(128|h>>12&63),o(128|h>>6&63),o(128|h&63)):(o(224|h>>12),o(128|h>>6&63),o(128|h&63))}return oa(n,0,a)}function YD(e,t){if(t){for(var i="",r=0;r<e.length;r+=16384)i+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return i}else{if(tm)return tm.decode(e);var s=Mx(e),n=s.s,i=s.r;return i.length&&Tt(8),n}}var Bx=function(e){return e==1?3:e<6?2:e==9?1:0};var VD=function(e,t){for(;Ah(e,t)!=1;t+=4+Ah(e,t+2));return[DO(e,t+12),DO(e,t+4),DO(e,t+20)]},ep=function(e){var t=0;if(e)for(var i in e){var r=e[i].length;r>65535&&Tt(9),t+=r+4}return t},B2=function(e,t,i,r,s,n,a,o){var l=r.length,h=i.extra,c=o&&o.length,f=ep(h);wi(e,t,a!=null?33639248:67324752),t+=4,a!=null&&(e[t++]=20,e[t++]=i.os),e[t]=20,t+=2,e[t++]=i.flag<<1|(n<0&&8),e[t++]=s&&8,e[t++]=i.compression&255,e[t++]=i.compression>>8;var d=new Date(i.mtime==null?Date.now():i.mtime),u=d.getFullYear()-1980;if((u<0||u>119)&&Tt(10),wi(e,t,u<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>1),t+=4,n!=-1&&(wi(e,t,i.crc),wi(e,t+4,n<0?-n-2:n),wi(e,t+8,i.size)),wi(e,t+12,l),wi(e,t+14,f),t+=16,a!=null&&(wi(e,t,c),wi(e,t+6,i.attrs),wi(e,t+10,a),t+=14),e.set(r,t),t+=l,f)for(var p in h){var _=h[p],g=_.length;wi(e,t,+p),wi(e,t+2,g),e.set(_,t+4),t+=4+g}return c&&(e.set(o,t),t+=c),t},qD=function(e,t,i,r,s){wi(e,t,101010256),wi(e,t+8,i),wi(e,t+10,i),wi(e,t+12,r),wi(e,t+16,s)},mp=(function(){function e(t){this.filename=t,this.c=wm(),this.size=0,this.compression=0}return e.prototype.process=function(t,i){this.ondata(null,t,i)},e.prototype.push=function(t,i){this.ondata||Tt(5),this.c.p(t),this.size+=t.length,i&&(this.crc=this.c.d()),this.process(t,i||!1)},e})(),iX=(function(){function e(t,i){var r=this;i||(i={}),mp.call(this,t),this.d=new Ga(i,function(s,n){r.ondata(null,s,n)}),this.compression=8,this.flag=Bx(i.level)}return e.prototype.process=function(t,i){try{this.d.push(t,i)}catch(r){this.ondata(r,null,i)}},e.prototype.push=function(t,i){mp.prototype.push.call(this,t,i)},e})(),rX=(function(){function e(t,i){var r=this;i||(i={}),mp.call(this,t),this.d=new kD(i,function(s,n,a){r.ondata(s,n,a)}),this.compression=8,this.flag=Bx(i.level),this.terminate=this.d.terminate}return e.prototype.process=function(t,i){this.d.push(t,i)},e.prototype.push=function(t,i){mp.prototype.push.call(this,t,i)},e})(),sX=(function(){function e(t){this.ondata=t,this.u=[],this.d=1}return e.prototype.add=function(t){var i=this;if(this.ondata||Tt(5),this.d&2)this.ondata(Tt(4+(this.d&1)*8,0,1),null,!1);else{var r=im(t.filename),s=r.length,n=t.comment,a=n&&im(n),o=s!=t.filename.length||a&&n.length!=a.length,l=s+ep(t.extra)+30;s>65535&&this.ondata(Tt(11,0,1),null,!1);var h=new Vt(l);B2(h,0,t,r,o,-1);var c=[h],f=function(){for(var g=0,b=c;g<b.length;g++){var m=b[g];i.ondata(null,m,!1)}c=[]},d=this.d;this.d=0;var u=this.u.length,p=Ix(t,{f:r,u:o,o:a,t:function(){t.terminate&&t.terminate()},r:function(){if(f(),d){var g=i.u[u+1];g?g.r():i.d=1}d=1}}),_=0;t.ondata=function(g,b,m){if(g)i.ondata(g,b,m),i.terminate();else if(_+=b.length,c.push(b),m){var O=new Vt(16);wi(O,0,134695760),wi(O,4,t.crc),wi(O,8,_),wi(O,12,t.size),c.push(O),p.c=_,p.b=l+_+16,p.crc=t.crc,p.size=t.size,d&&p.r(),d=1}else d&&f()},this.u.push(p)}},e.prototype.end=function(){var t=this;if(this.d&2){this.ondata(Tt(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){t.d&1&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var t=0,i=0,r=0,s=0,n=this.u;s<n.length;s++){var a=n[s];r+=46+a.f.length+ep(a.extra)+(a.o?a.o.length:0)}for(var o=new Vt(r+22),l=0,h=this.u;l<h.length;l++){var a=h[l];B2(o,t,a,a.f,a.u,-a.c-2,i,a.o),t+=46+a.f.length+ep(a.extra)+(a.o?a.o.length:0),i+=a.b}qD(o,t,this.u.length,r,i),this.ondata(null,o,!0),this.d=2},e.prototype.terminate=function(){for(var t=0,i=this.u;t<i.length;t++){var r=i[t];r.t()}this.d=2},e})();var XD=(function(){function e(){}return e.prototype.push=function(t,i){this.ondata(null,t,i)},e.compression=0,e})(),nX=(function(){function e(){var t=this;this.i=new qs(function(i,r){t.ondata(null,i,r)})}return e.prototype.push=function(t,i){try{this.i.push(t,i)}catch(r){this.ondata(r,null,i)}},e.compression=8,e})(),aX=(function(){function e(t,i){var r=this;i<32e4?this.i=new qs(function(s,n){r.ondata(null,s,n)}):(this.i=new Rx(function(s,n,a){r.ondata(s,n,a)}),this.terminate=this.i.terminate)}return e.prototype.push=function(t,i){this.i.terminate&&(t=oa(t,0)),this.i.push(t,i)},e.compression=8,e})(),oX=(function(){function e(t){this.onfile=t,this.k=[],this.o={0:XD},this.p=Ao}return e.prototype.push=function(t,i){var r=this;if(this.onfile||Tt(5),this.p||Tt(4),this.c>0){var s=Math.min(this.c,t.length),n=t.subarray(0,s);if(this.c-=s,this.d?this.d.push(n,!this.c):this.k[0].push(n),t=t.subarray(s),t.length)return this.push(t,i)}else{var a=0,o=0,l=void 0,h=void 0;this.p.length?t.length?(h=new Vt(this.p.length+t.length),h.set(this.p),h.set(t,this.p.length)):h=this.p:h=t;for(var c=h.length,f=this.c,d=f&&this.d,u=function(){var b,m=Ch(h,o);if(m==67324752){a=1,l=o,p.d=null,p.c=0;var O=Ah(h,o+6),y=Ah(h,o+8),x=O&2048,E=O&8,w=Ah(h,o+26),S=Ah(h,o+28);if(c>o+30+w+S){var C=[];p.k.unshift(C),a=2;var R=Ch(h,o+18),B=Ch(h,o+22),Y=YD(h.subarray(o+30,o+=30+w),!x);R==4294967295?(b=E?[-2]:VD(h,o),R=b[0],B=b[1]):E&&(R=-1),o+=S,p.c=R;var G,z={name:Y,compression:y,start:function(){if(z.ondata||Tt(5),!R)z.ondata(null,Ao,!0);else{var q=r.o[y];q||z.ondata(Tt(14,"unknown compression type "+y,1),null,!1),G=R<0?new q(Y):new q(Y,R,B),G.ondata=function(P,I,N){z.ondata(P,I,N)};for(var L=0,M=C;L<M.length;L++){var v=M[L];G.push(v,!1)}r.k[0]==C&&r.c?r.d=G:G.push(Ao,!0)}},terminate:function(){G&&G.terminate&&G.terminate()}};R>=0&&(z.size=R,z.originalSize=B),p.onfile(z)}return"break"}else if(f){if(m==134695760)return l=o+=12+(f==-2&&8),a=3,p.c=0,"break";if(m==33639248)return l=o-=4,a=3,p.c=0,"break"}},p=this;o<c-4;++o){var _=u();if(_==="break")break}if(this.p=Ao,f<0){var g=a?h.subarray(0,l-12-(f==-2&&8)-(Ch(h,l-16)==134695760&&4)):h.subarray(0,o);d?d.push(g,!!a):this.k[+(a==2)].push(g)}if(a&2)return this.push(h.subarray(o),i);this.p=h.subarray(o)}i&&(this.c&&Tt(13),this.p=null)},e.prototype.register=function(t){this.o[t.compression]=t},e})();var Ca,Ci,WD=(e=>(e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.LOGIN_FAIL=402]="LOGIN_FAIL",e[e.PERMISSION_DENIED=422]="PERMISSION_DENIED",e[e.PERMISSION_DENIED1=1111111]="PERMISSION_DENIED1",e[e.PERMISSION_DENIED_PARAMS=1111112]="PERMISSION_DENIED_PARAMS",e[e.DATA_NOT_FOUND=1111113]="DATA_NOT_FOUND",e[e.PARAMS_DATA_NOT_FOUND=1111114]="PARAMS_DATA_NOT_FOUND",e[e.REQUEST_PARAM_ILLEGAL=42222]="REQUEST_PARAM_ILLEGAL",e[e.REQUEST_PARAM_ILLEGAL1=1111115]="REQUEST_PARAM_ILLEGAL1",e[e.REQUEST_PARAMS_ILLEGAL2=1111116]="REQUEST_PARAMS_ILLEGAL2",e[e.REQUEST_PARAMS_NOT_NULL=1111117]="REQUEST_PARAMS_NOT_NULL",e[e.REQUEST_PARAMS_NOT_ALL_NULL=1111118]="REQUEST_PARAMS_NOT_ALL_NULL",e[e.REQUEST_PARAMS_MUST_ARRAY=1111119]="REQUEST_PARAMS_MUST_ARRAY",e[e.REQUEST_PARAMS_MUST_STRING=1111120]="REQUEST_PARAMS_MUST_STRING",e[e.REQUEST_PARAMS_MUST_NUMBER=1111121]="REQUEST_PARAMS_MUST_NUMBER",e[e.REQUEST_PARAMS_MUST_NUMBER_ARRAY=1111122]="REQUEST_PARAMS_MUST_NUMBER_ARRAY",e[e.REQUEST_PARAMS_MUST_STRING_ARRAY=1111123]="REQUEST_PARAMS_MUST_STRING_ARRAY",e[e.REQUEST_PARAMS_LENGTH_ERROR=1111124]="REQUEST_PARAMS_LENGTH_ERROR",e[e.REQUEST_PARAMS_TYPE_ERROR=1111125]="REQUEST_PARAMS_TYPE_ERROR",e[e.ILLEGAL_NAME=2001]="ILLEGAL_NAME",e[e.ILLEGAL_NAME1=1111126]="ILLEGAL_NAME1",e[e.ILLEGAL_NAME_ZH=1111128]="ILLEGAL_NAME_ZH",e[e.UUID_ERROR=1111127]="UUID_ERROR",e[e.DUPLICATE_DATA=1000001]="DUPLICATE_DATA",e[e.DUPLICATE_DATA1=11e3]="DUPLICATE_DATA1",e[e.DUPLICATE_DATA_PARAMS=1000017]="DUPLICATE_DATA_PARAMS",e[e.UPLOAD_LIMIT=10034]="UPLOAD_LIMIT",e[e.MORE_THAN_LIMIT=1000003]="MORE_THAN_LIMIT",e[e.FILE_MORE_THAN_LIMIT=1000004]="FILE_MORE_THAN_LIMIT",e[e.PARAMS_MORE_THAN_LIMIT=1000005]="PARAMS_MORE_THAN_LIMIT",e[e.IMAGE_MORE_THAN_LIMIT_PARAMS=1000006]="IMAGE_MORE_THAN_LIMIT_PARAMS",e[e.FILE_MORE_THAN_LIMIT_PARAMS=1000007]="FILE_MORE_THAN_LIMIT_PARAMS",e[e.END_MUST_AFTER_START=1000019]="END_MUST_AFTER_START",e[e.REQUEST_PARAMS_TIME_ERROR=1000009]="REQUEST_PARAMS_TIME_ERROR",e[e.FILES_PATH_NOT_FOUND=1000018]="FILES_PATH_NOT_FOUND",e[e.FILES_DATA_NOT_FOUND=1000011]="FILES_DATA_NOT_FOUND",e[e.FILES_TYPE_ERROR=1000012]="FILES_TYPE_ERROR",e[e.FILES_TYPE_MUST_BE_ONE=1000013]="FILES_TYPE_MUST_BE_ONE",e[e.SET_WATERMARK_FAIL=1000014]="SET_WATERMARK_FAIL",e[e.MYSQL_CRUD_ERROR=1000015]="MYSQL_CRUD_ERROR",e[e.PARAMS_JSON_FAILED=1000016]="PARAMS_JSON_FAILED",e[e.MYSQL_ERROR=3000001]="MYSQL_ERROR",e[e.NOT_FOUND=404]="NOT_FOUND",e[e.PRJ_NAME_EXISTS=2002]="PRJ_NAME_EXISTS",e[e.BACKUP_NAME_EXISTS=3002]="BACKUP_NAME_EXISTS",e[e.PRJ_NOT_EXIST=2000001]="PRJ_NOT_EXIST",e[e.ERROR_PATH=4000002]="ERROR_PATH",e[e.PROJECT_NOT_FOUND=6000001]="PROJECT_NOT_FOUND",e[e.TITLE_ILLEGAL_LEN=2003]="TITLE_ILLEGAL_LEN",e[e.FILE_READ_ONLY=1000002]="FILE_READ_ONLY",e[e.FILE_READ_ONLY1=1000008]="FILE_READ_ONLY1",e[e.DATA_NOT_EXIST=1000010]="DATA_NOT_EXIST",e[e.LIB_NOT_EXIST=2000001]="LIB_NOT_EXIST",e[e.CONFIG_API_URLS_ERROR=3001001]="CONFIG_API_URLS_ERROR",e[e.ONE_CLICK_ORDER_NOT_OPEN=3001002]="ONE_CLICK_ORDER_NOT_OPEN",e[e.MATERIAL_NOT_OPEN=3001003]="MATERIAL_NOT_OPEN",e[e.SNAPSHOT_DEPTH_LIMIT=3001004]="SNAPSHOT_DEPTH_LIMIT",e[e.OCR_SYMBOL_URL_ERROR=3001005]="OCR_SYMBOL_URL_ERROR",e[e.USER_DATA_NOT_FOUND=4000001]="USER_DATA_NOT_FOUND",e[e.USER_DISABLE_ERROR=4000012]="USER_DISABLE_ERROR",e[e.USER_EXISTS_LOGIN_ERROR=4000003]="USER_EXISTS_LOGIN_ERROR",e[e.USER_UNAUTHORIZED_MODULES_ERROR=4000004]="USER_UNAUTHORIZED_MODULES_ERROR",e[e.USER_UNAUTHORIZED_ACCESS_ERROR=4000005]="USER_UNAUTHORIZED_ACCESS_ERROR",e[e.ADMIN_NOT_CHANGE_PASSWORD=4000006]="ADMIN_NOT_CHANGE_PASSWORD",e[e.SAME_PASSWORD_NEW_PASSWORD=4000007]="SAME_PASSWORD_NEW_PASSWORD",e[e.USER_ONLINE_REGISTRATION_FAILED=4000008]="USER_ONLINE_REGISTRATION_FAILED",e[e.USER_PASSWORD_CAN_NOT_DEFAULT=4000009]="USER_PASSWORD_CAN_NOT_DEFAULT",e[e.USER_BEFORE_PASSWORD_ERROR=4000010]="USER_BEFORE_PASSWORD_ERROR",e[e.USER_PASSWORD_LENGTH_ERROR=4000011]="USER_PASSWORD_LENGTH_ERROR",e[e.ORG_ROLE_NOT_CREATE=5000001]="ORG_ROLE_NOT_CREATE",e[e.ORG_ROLE_NAME_DUPLICATE=5000002]="ORG_ROLE_NAME_DUPLICATE",e[e.ORG_ROLE_ORIGIN_ERROR=5000003]="ORG_ROLE_ORIGIN_ERROR",e[e.ORG_ROLE_NOT_DEFAULT=5000004]="ORG_ROLE_NOT_DEFAULT",e[e.ADMIN_ROLE_NOT_CHANGE=5000005]="ADMIN_ROLE_NOT_CHANGE",e[e.ADMIN_NOT_CHANGE_STATUS=5000006]="ADMIN_NOT_CHANGE_STATUS",e[e.PROJECT_ARCHIVED=6000002]="PROJECT_ARCHIVED",e[e.PROJECT_UUID_NULL=6000003]="PROJECT_UUID_NULL",e[e.PROJECT_UUID_ERROR=6000004]="PROJECT_UUID_ERROR",e[e.PROJECT_OR_TEAM_UUID_ERROR=6000005]="PROJECT_OR_TEAM_UUID_ERROR",e[e.PROJECT_NOT_PERSON_ERROR=6000006]="PROJECT_NOT_PERSON_ERROR",e[e.PROJECT_DUPLICATE_NAME=6000007]="PROJECT_DUPLICATE_NAME",e[e.ANNOTATION_HAS_BE_FOUND=6000008]="ANNOTATION_HAS_BE_FOUND",e[e.ANNOTATION_NOT_FOUND=6000009]="ANNOTATION_NOT_FOUND",e[e.ANNOTATION_CREATE_ERROR=6000010]="ANNOTATION_CREATE_ERROR",e[e.ANNOTATION_UPDATE_ERROR=6000011]="ANNOTATION_UPDATE_ERROR",e[e.ANNOTATION_DELETE_ERROR=6000012]="ANNOTATION_DELETE_ERROR",e[e.PROJECT_DUPLICATE_PATH=6000013]="PROJECT_DUPLICATE_PATH",e[e.TEAM_NOT_FOUND=7000001]="TEAM_NOT_FOUND",e[e.TEAM_UUID_NULL=7000002]="TEAM_UUID_NULL",e[e.TEAM_FOLDER_ERROR=7000003]="TEAM_FOLDER_ERROR",e[e.TEAM_FOLDER_DEEP_ERROR=7000004]="TEAM_FOLDER_DEEP_ERROR",e[e.TEAM_FOLDER_UUID_ERROR=7000005]="TEAM_FOLDER_UUID_ERROR",e[e.TEAM_URL_DUPLICATE=7000006]="TEAM_URL_DUPLICATE",e[e.TEAM_CAN_NOT_DELETE=7000007]="TEAM_CAN_NOT_DELETE",e[e.COMPONENT_UUID_NULL=8000001]="COMPONENT_UUID_NULL",e[e.COMPONENT_DATA_NOT_FOUND=8000002]="COMPONENT_DATA_NOT_FOUND",e[e.COMPONENT_NAME_DUPLICATE=8000003]="COMPONENT_NAME_DUPLICATE",e[e.COMPONENT_TYPE_ERROR=8000004]="COMPONENT_TYPE_ERROR",e[e.DELETE_SON_CATEGORY=8001001]="DELETE_SON_CATEGORY",e[e.LICENSE=9000001]="LICENSE",e[e.START_TIME=9000002]="START_TIME",e[e.END_TIME=9000003]="END_TIME",e[e.PROJECT_LIMIT=9000004]="PROJECT_LIMIT",e[e.USER_LIMIT=9000005]="USER_LIMIT",e[e.ONLINE_NUMBER_LIMIT=9000006]="ONLINE_NUMBER_LIMIT",e[e.COMPANY_CODE=9000007]="COMPANY_CODE",e[e.LIMIT_PCB=9000008]="LIMIT_PCB",e[e.LIMIT_SCH=9000009]="LIMIT_SCH",e[e.LIMIT_PANEL=9000011]="LIMIT_PANEL",e[e.TIME_ERROR=9000010]="TIME_ERROR",e[e.LICENSE_ERROR=9000012]="LICENSE_ERROR",e[e.LICENSE_TYPE_ERROR=9000013]="LICENSE_TYPE_ERROR",e[e.LICENSE_ORIGIN_ERROR=9000014]="LICENSE_ORIGIN_ERROR",e[e.BRANCH_DATA_NOT_FOUND=11000001]="BRANCH_DATA_NOT_FOUND",e[e.PARENT_UUID_ERROR=11000002]="PARENT_UUID_ERROR",e[e.BRANCH_MUST_AFTER_NODE=11000003]="BRANCH_MUST_AFTER_NODE",e[e.BRANCH_NAME_ERROR=11000004]="BRANCH_NAME_ERROR",e[e.BRANCH_NAME_DUPLICATE=11000005]="BRANCH_NAME_DUPLICATE",e[e.BRANCH_UUID_ERROR=11000006]="BRANCH_UUID_ERROR",e[e.BRANCH_NODE_SET_ERROR=11000007]="BRANCH_NODE_SET_ERROR",e[e.BRANCH_DELETE_MAIN_ERROR=11000008]="BRANCH_DELETE_MAIN_ERROR",e[e.BRANCH_CHECK_OUT_ERROR=11000009]="BRANCH_CHECK_OUT_ERROR",e[e.DOCUMENT_UUID_ERROR=12000001]="DOCUMENT_UUID_ERROR",e[e.UPDATE_FAILED=12000002]="UPDATE_FAILED",e[e.INNER_API_KEY_ERROR=1000020]="INNER_API_KEY_ERROR",e[e.BRANCH_MORE_THAN_LIMIT=11000010]="BRANCH_MORE_THAN_LIMIT",e[e.WORKSPACE_API_ERROR=1000021]="WORKSPACE_API_ERROR",e))(WD||{}),JD=(e=>(e.UNAUTHORIZED="UNAUTHORIZED",e.LOGIN_FAIL="LOGIN_FAIL",e.PERMISSION_DENIED="PERMISSION_DENIED",e.PERMISSION_DENIED1="PERMISSION_DENIED1",e.PERMISSION_DENIED_PARAMS="PERMISSION_DENIED_PARAMS",e.DATA_NOT_FOUND="DATA_NOT_FOUND",e.PARAMS_DATA_NOT_FOUND="PARAMS_DATA_NOT_FOUND",e.REQUEST_PARAM_ILLEGAL="REQUEST_PARAM_ILLEGAL",e.REQUEST_PARAM_ILLEGAL1="REQUEST_PARAM_ILLEGAL1",e.REQUEST_PARAMS_ILLEGAL2="REQUEST_PARAMS_ILLEGAL2",e.REQUEST_PARAMS_NOT_NULL="REQUEST_PARAMS_NOT_NULL",e.REQUEST_PARAMS_NOT_ALL_NULL="REQUEST_PARAMS_NOT_ALL_NULL",e.REQUEST_PARAMS_MUST_ARRAY="REQUEST_PARAMS_MUST_ARRAY",e.REQUEST_PARAMS_MUST_STRING="REQUEST_PARAMS_MUST_STRING",e.REQUEST_PARAMS_MUST_NUMBER="REQUEST_PARAMS_MUST_NUMBER",e.REQUEST_PARAMS_MUST_NUMBER_ARRAY="REQUEST_PARAMS_MUST_NUMBER_ARRAY",e.REQUEST_PARAMS_MUST_STRING_ARRAY="REQUEST_PARAMS_MUST_STRING_ARRAY",e.REQUEST_PARAMS_LENGTH_ERROR="REQUEST_PARAMS_LENGTH_ERROR",e.REQUEST_PARAMS_TYPE_ERROR="REQUEST_PARAMS_TYPE_ERROR",e.ILLEGAL_NAME="ILLEGAL_NAME",e.ILLEGAL_NAME1="ILLEGAL_NAME1",e.ILLEGAL_NAME_ZH="ILLEGAL_NAME_ZH",e.UUID_ERROR="UUID_ERROR",e.DUPLICATE_DATA="DUPLICATE_DATA",e.DUPLICATE_DATA1="DUPLICATE_DATA1",e.DUPLICATE_DATA_PARAMS="DUPLICATE_DATA_PARAMS",e.UPLOAD_LIMIT="UPLOAD_LIMIT",e.MORE_THAN_LIMIT="MORE_THAN_LIMIT",e.FILE_MORE_THAN_LIMIT="FILE_MORE_THAN_LIMIT",e.PARAMS_MORE_THAN_LIMIT="PARAMS_MORE_THAN_LIMIT",e.IMAGE_MORE_THAN_LIMIT_PARAMS="IMAGE_MORE_THAN_LIMIT_PARAMS",e.FILE_MORE_THAN_LIMIT_PARAMS="FILE_MORE_THAN_LIMIT_PARAMS",e.END_MUST_AFTER_START="END_MUST_AFTER_START",e.REQUEST_PARAMS_TIME_ERROR="REQUEST_PARAMS_TIME_ERROR",e.FILES_PATH_NOT_FOUND="FILES_PATH_NOT_FOUND",e.FILES_DATA_NOT_FOUND="FILES_DATA_NOT_FOUND",e.FILES_TYPE_ERROR="FILES_TYPE_ERROR",e.FILES_TYPE_MUST_BE_ONE="FILES_TYPE_MUST_BE_ONE",e.SET_WATERMARK_FAIL="SET_WATERMARK_FAIL",e.MYSQL_CRUD_ERROR="MYSQL_CRUD_ERROR",e.PARAMS_JSON_FAILED="PARAMS_JSON_FAILED",e.MYSQL_ERROR="MYSQL_ERROR",e.NOT_FOUND="NOT_FOUND",e.PRJ_NAME_EXISTS="PRJ_NAME_EXISTS",e.BACKUP_NAME_EXISTS="BACKUP_NAME_EXISTS",e.PRJ_NOT_EXIST="PRJ_NOT_EXIST",e.ERROR_PATH="ERROR_PATH",e.PROJECT_NOT_FOUND="PROJECT_NOT_FOUND",e.TITLE_ILLEGAL_LEN="TITLE_ILLEGAL_LEN",e.FILE_READ_ONLY="FILE_READ_ONLY",e.FILE_READ_ONLY1="FILE_READ_ONLY1",e.DATA_NOT_EXIST="DATA_NOT_EXIST",e.LIB_NOT_EXIST="LIB_NOT_EXIST",e.CONFIG_API_URLS_ERROR="CONFIG_API_URLS_ERROR",e.ONE_CLICK_ORDER_NOT_OPEN="ONE_CLICK_ORDER_NOT_OPEN",e.MATERIAL_NOT_OPEN="MATERIAL_NOT_OPEN",e.SNAPSHOT_DEPTH_LIMIT="SNAPSHOT_DEPTH_LIMIT",e.OCR_SYMBOL_URL_ERROR="OCR_SYMBOL_URL_ERROR",e.USER_DATA_NOT_FOUND="USER_DATA_NOT_FOUND",e.USER_DISABLE_ERROR="USER_DISABLE_ERROR",e.USER_EXISTS_LOGIN_ERROR="USER_EXISTS_LOGIN_ERROR",e.USER_UNAUTHORIZED_MODULES_ERROR="USER_UNAUTHORIZED_MODULES_ERROR",e.USER_UNAUTHORIZED_ACCESS_ERROR="USER_UNAUTHORIZED_ACCESS_ERROR",e.ADMIN_NOT_CHANGE_PASSWORD="ADMIN_NOT_CHANGE_PASSWORD",e.SAME_PASSWORD_NEW_PASSWORD="SAME_PASSWORD_NEW_PASSWORD",e.USER_ONLINE_REGISTRATION_FAILED="USER_ONLINE_REGISTRATION_FAILED",e.USER_PASSWORD_CAN_NOT_DEFAULT="USER_PASSWORD_CAN_NOT_DEFAULT",e.USER_BEFORE_PASSWORD_ERROR="USER_BEFORE_PASSWORD_ERROR",e.USER_PASSWORD_LENGTH_ERROR="USER_PASSWORD_LENGTH_ERROR",e.ORG_ROLE_NOT_CREATE="ORG_ROLE_NOT_CREATE",e.ORG_ROLE_NAME_DUPLICATE="ORG_ROLE_NAME_DUPLICATE",e.ORG_ROLE_ORIGIN_ERROR="ORG_ROLE_ORIGIN_ERROR",e.ORG_ROLE_NOT_DEFAULT="ORG_ROLE_NOT_DEFAULT",e.ADMIN_ROLE_NOT_CHANGE="ADMIN_ROLE_NOT_CHANGE",e.ADMIN_NOT_CHANGE_STATUS="ADMIN_NOT_CHANGE_STATUS",e.PROJECT_ARCHIVED="PROJECT_ARCHIVED",e.PROJECT_UUID_NULL="PROJECT_UUID_NULL",e.PROJECT_UUID_ERROR="PROJECT_UUID_ERROR",e.PROJECT_OR_TEAM_UUID_ERROR="PROJECT_OR_TEAM_UUID_ERROR",e.PROJECT_NOT_PERSON_ERROR="PROJECT_NOT_PERSON_ERROR",e.PROJECT_DUPLICATE_NAME="PROJECT_DUPLICATE_NAME",e.ANNOTATION_HAS_BE_FOUND="ANNOTATION_HAS_BE_FOUND",e.ANNOTATION_NOT_FOUND="ANNOTATION_NOT_FOUND",e.ANNOTATION_CREATE_ERROR="ANNOTATION_CREATE_ERROR",e.ANNOTATION_UPDATE_ERROR="ANNOTATION_UPDATE_ERROR",e.ANNOTATION_DELETE_ERROR="ANNOTATION_DELETE_ERROR",e.PROJECT_DUPLICATE_PATH="PROJECT_DUPLICATE_PATH",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.TEAM_UUID_NULL="TEAM_UUID_NULL",e.TEAM_FOLDER_ERROR="TEAM_FOLDER_ERROR",e.TEAM_FOLDER_DEEP_ERROR="TEAM_FOLDER_DEEP_ERROR",e.TEAM_FOLDER_UUID_ERROR="TEAM_FOLDER_UUID_ERROR",e.TEAM_URL_DUPLICATE="TEAM_URL_DUPLICATE",e.TEAM_CAN_NOT_DELETE="TEAM_CAN_NOT_DELETE",e.COMPONENT_UUID_NULL="COMPONENT_UUID_NULL",e.COMPONENT_DATA_NOT_FOUND="COMPONENT_DATA_NOT_FOUND",e.COMPONENT_NAME_DUPLICATE="COMPONENT_NAME_DUPLICATE",e.COMPONENT_TYPE_ERROR="COMPONENT_TYPE_ERROR",e.DELETE_SON_CATEGORY="DELETE_SON_CATEGORY",e.LICENSE="LICENSE",e.START_TIME="START_TIME",e.END_TIME="END_TIME",e.PROJECT_LIMIT="PROJECT_LIMIT",e.USER_LIMIT="USER_LIMIT",e.ONLINE_NUMBER_LIMIT="ONLINE_NUMBER_LIMIT",e.COMPANY_CODE="COMPANY_CODE",e.LIMIT_PCB="LIMIT_PCB",e.LIMIT_SCH="LIMIT_SCH",e.LIMIT_PANEL="LIMIT_PANEL",e.TIME_ERROR="TIME_ERROR",e.LICENSE_ERROR="LICENSE_ERROR",e.LICENSE_TYPE_ERROR="LICENSE_TYPE_ERROR",e.LICENSE_ORIGIN_ERROR="LICENSE_ORIGIN_ERROR",e.BRANCH_DATA_NOT_FOUND="BRANCH_DATA_NOT_FOUND",e.PARENT_UUID_ERROR="PARENT_UUID_ERROR",e.BRANCH_MUST_AFTER_NODE="BRANCH_MUST_AFTER_NODE",e.BRANCH_NAME_ERROR="BRANCH_NAME_ERROR",e.BRANCH_NAME_DUPLICATE="BRANCH_NAME_DUPLICATE",e.BRANCH_UUID_ERROR="BRANCH_UUID_ERROR",e.BRANCH_NODE_SET_ERROR="BRANCH_NODE_SET_ERROR",e.BRANCH_DELETE_MAIN_ERROR="BRANCH_DELETE_MAIN_ERROR",e.BRANCH_CHECK_OUT_ERROR="BRANCH_CHECK_OUT_ERROR",e.DOCUMENT_UUID_ERROR="DOCUMENT_UUID_ERROR",e.UPDATE_FAILED="UPDATE_FAILED",e.INNER_API_KEY_ERROR="INNER_API_KEY_ERROR",e.BRANCH_MORE_THAN_LIMIT="BRANCH_MORE_THAN_LIMIT",e.WORKSPACE_API_ERROR="WORKSPACE_API_ERROR",e))(JD||{}),ZD=(e=>(e[e.DB_INIT_ERROR=0]="DB_INIT_ERROR",e[e.PRJ_NOT_EXIST=1]="PRJ_NOT_EXIST",e[e.NET_ERROR=2]="NET_ERROR",e[e.IS_OPENING=3]="IS_OPENING",e[e.NOT_LOGGED_IN=4]="NOT_LOGGED_IN",e[e.HAS_UNSAVED=5]="HAS_UNSAVED",e[e.DIFF_TICKET=6]="DIFF_TICKET",e))(ZD||{});function tp(e,t={}){if(!e)return"";let{code:i,message:r}=e;switch(i){case 401:return Re("UNAUTHORIZED");case 402:return Re("LOGIN_FAIL");case 422:return Re("PERMISSION_DENIED");case 1111111:return Re("PERMISSION_DENIED1");case 2000001:return Re("PRJ_NOT_EXIST");case 4000002:return Re("ERROR_PATH");case 6000001:return Re("PROJECT_NOT_FOUND");case 1111112:return Re("PERMISSION_DENIED_PARAMS",{type:r});case 1111113:return Re("DATA_NOT_FOUND");case 1111114:return Re("PARAMS_DATA_NOT_FOUND",{type:r});case 42222:return Re("REQUEST_PARAM_ILLEGAL");case 1111115:return Re("REQUEST_PARAM_ILLEGAL1");case 1111116:return Re("REQUEST_PARAMS_ILLEGAL2",{type:r});case 1111117:return Re("REQUEST_PARAMS_NOT_NULL",{type:r});case 1111118:return Re("REQUEST_PARAMS_NOT_ALL_NULL",{type:r});case 1111119:return Re("REQUEST_PARAMS_MUST_ARRAY",{type:r});case 1111120:return Re("REQUEST_PARAMS_MUST_STRING",{type:r});case 1111121:return Re("REQUEST_PARAMS_MUST_NUMBER",{type:r});case 1111122:return Re("REQUEST_PARAMS_MUST_NUMBER_ARRAY",{type:r});case 1111123:return Re("REQUEST_PARAMS_MUST_STRING_ARRAY",{type:r});case 1111124:return Re("REQUEST_PARAMS_LENGTH_ERROR",{type:r});case 1111125:return Re("REQUEST_PARAMS_TYPE_ERROR",{type:r});case 2001:return Re("ILLEGAL_NAME");case 1111126:return Re("ILLEGAL_NAME1");case 1111128:return Re("ILLEGAL_NAME_ZH");case 1111127:return Re("UUID_ERROR");case 1000001:return Re("DUPLICATE_DATA");case 11e3:return Re("DUPLICATE_DATA1");case 1000017:return Re("DUPLICATE_DATA_PARAMS",{type:r});case 10034:return Re("UPLOAD_LIMIT");case 1000003:return Re("MORE_THAN_LIMIT");case 1000004:return Re("FILE_MORE_THAN_LIMIT",{type:r});case 1000005:return Re("PARAMS_MORE_THAN_LIMIT",{type:r});case 1000006:return Re("IMAGE_MORE_THAN_LIMIT_PARAMS");case 1000007:return Re("FILE_MORE_THAN_LIMIT_PARAMS");case 1000019:return Re("END_MUST_AFTER_START");case 1000002:return Re("FILE_READ_ONLY");case 1000008:return Re("FILE_READ_ONLY1");case 1000010:return Re("DATA_NOT_EXIST",{documentName:t.documentName});case 1000009:return Re("REQUEST_PARAMS_TIME_ERROR");case 1000018:return Re("FILES_PATH_NOT_FOUND");case 1000011:return Re("FILES_DATA_NOT_FOUND");case 1000012:return Re("FILES_TYPE_ERROR");case 1000013:return Re("FILES_TYPE_MUST_BE_ONE",{type:r});case 1000014:return Re("SET_WATERMARK_FAIL");case 1000015:return Re("MYSQL_CRUD_ERROR",{type:r});case 1000016:return Re("PARAMS_JSON_FAILED",{type:r});case 3000001:return Re("MYSQL_ERROR");case 404:return Re("NOT_FOUND");case 2002:return Re("PRJ_NAME_EXISTS");case 3002:return Re("BACKUP_NAME_EXISTS");case 2003:return Re("TITLE_ILLEGAL_LEN",{documentName:t.documentName});case 2000001:return Re("LIB_NOT_EXIST");case 3001001:return Re("CONFIG_API_URLS_ERROR");case 3001002:return Re("ONE_CLICK_ORDER_NOT_OPEN");case 3001003:return Re("MATERIAL_NOT_OPEN");case 3001004:return Re("SNAPSHOT_DEPTH_LIMIT");case 3001005:return Re("OCR_SYMBOL_URL_ERROR");case 4000001:return Re("USER_DATA_NOT_FOUND");case 4000012:return Re("USER_DISABLE_ERROR");case 4000003:return Re("USER_EXISTS_LOGIN_ERROR");case 4000004:return Re("USER_UNAUTHORIZED_MODULES_ERROR");case 4000005:return Re("USER_UNAUTHORIZED_ACCESS_ERROR");case 4000006:return Re("ADMIN_NOT_CHANGE_PASSWORD");case 4000007:return Re("SAME_PASSWORD_NEW_PASSWORD");case 4000008:return Re("USER_ONLINE_REGISTRATION_FAILED");case 4000009:return Re("USER_PASSWORD_CAN_NOT_DEFAULT");case 4000010:return Re("USER_BEFORE_PASSWORD_ERROR");case 4000011:return Re("USER_PASSWORD_LENGTH_ERROR");case 5000001:return Re("ORG_ROLE_NOT_CREATE");case 5000002:return Re("ORG_ROLE_NAME_DUPLICATE");case 5000003:return Re("ORG_ROLE_ORIGIN_ERROR",{message:r});case 5000004:return Re("ORG_ROLE_NOT_DEFAULT");case 5000005:return Re("ADMIN_ROLE_NOT_CHANGE");case 5000006:return Re("ADMIN_NOT_CHANGE_STATUS");case 6000002:return Re("PROJECT_ARCHIVED");case 6000003:return Re("PROJECT_UUID_NULL");case 6000004:return Re("PROJECT_UUID_ERROR");case 6000005:return Re("PROJECT_OR_TEAM_UUID_ERROR");case 6000006:return Re("PROJECT_NOT_PERSON_ERROR");case 6000007:return Re("PROJECT_DUPLICATE_NAME");case 6000008:return Re("ANNOTATION_HAS_BE_FOUND");case 6000009:return Re("ANNOTATION_NOT_FOUND");case 6000010:return Re("ANNOTATION_CREATE_ERROR");case 6000011:return Re("ANNOTATION_UPDATE_ERROR");case 6000012:return Re("ANNOTATION_DELETE_ERROR");case 6000013:return Re("PROJECT_DUPLICATE_PATH");case 7000001:return Re("TEAM_NOT_FOUND");case 7000002:return Re("TEAM_UUID_NULL");case 7000003:return Re("TEAM_FOLDER_ERROR");case 7000004:return Re("TEAM_FOLDER_DEEP_ERROR");case 7000005:return Re("TEAM_FOLDER_UUID_ERROR");case 7000006:return Re("TEAM_URL_DUPLICATE");case 7000007:return Re("TEAM_CAN_NOT_DELETE");case 8000001:return Re("COMPONENT_UUID_NULL");case 8000002:return Re("COMPONENT_DATA_NOT_FOUND");case 8000003:return Re("COMPONENT_NAME_DUPLICATE");case 8000004:return Re("COMPONENT_TYPE_ERROR");case 8001001:return Re("DELETE_SON_CATEGORY");case 9000001:return Re("LICENSE");case 9000002:return Re("START_TIME");case 9000003:return Re("END_TIME");case 9000004:return Re("PROJECT_LIMIT");case 9000005:return Re("USER_LIMIT");case 9000006:return Re("ONLINE_NUMBER_LIMIT");case 9000007:return Re("COMPANY_CODE");case 9000008:return Re("LIMIT_PCB");case 9000009:return Re("LIMIT_SCH");case 9000011:return Re("LIMIT_PANEL");case 9000010:return Re("TIME_ERROR");case 9000012:return Re("LICENSE_ERROR");case 9000013:return Re("LICENSE_TYPE_ERROR");case 9000014:return Re("LICENSE_ORIGIN_ERROR",{type:r});case 11000001:return Re("BRANCH_DATA_NOT_FOUND");case 11000002:return Re("PARENT_UUID_ERROR");case 11000003:return Re("BRANCH_MUST_AFTER_NODE");case 11000004:return Re("BRANCH_NAME_ERROR");case 11000005:return Re("BRANCH_NAME_DUPLICATE");case 11000006:return Re("BRANCH_UUID_ERROR");case 11000007:return Re("BRANCH_NODE_SET_ERROR");case 11000008:return Re("BRANCH_DELETE_MAIN_ERROR");case 11000009:return Re("BRANCH_CHECK_OUT_ERROR");case 12000001:return Re("DOCUMENT_UUID_ERROR");case 12000002:return Re("UPDATE_FAILED");case 1000020:return Re("INNER_API_KEY_ERROR");case 11000010:return Re("BRANCH_MORE_THAN_LIMIT");case 1000021:return Re("WORKSPACE_API_ERROR");default:return""}}function Re(e,t){return Zb()==="zh-cn"?MO.match("codeCN",e,t)||"":MO.match("codeEN",e,t)||""}var KD=(e=>(e.Text="text/plain;charset=UTF-8",e.Json="application/json",e.Form="application/x-www-form-urlencoded;charset=UTF-8",e.FormData="multipart/form-data",e))(KD||{}),$D=(e=>(e.ContentType="Content-type",e.Editorversion="Editor-Version",e))($D||{}),QD=(e=>(e[e.Success=200]="Success",e[e.NotFound=404]="NotFound",e[e.NetError=500]="NetError",e))(QD||{}),e4=(e=>(e.Json="json",e.Blob="blob",e))(e4||{}),t4=0;function vt(e,t,i={},r={},s){return new Promise((n,a)=>{try{let l=t4++;var o;e=e||"GET",i4(e,i,r);let h=r4(t,i,r,s);o=(h==null?void 0:h.params)||i,r=(h==null?void 0:h.options)||r;let c=s4(e,t,o,r);o=c.params,t=c.url;let f=new XMLHttpRequest;if(r.withCredentials!==void 0&&(f.withCredentials=r.withCredentials),r.responseType!==void 0&&(f.responseType=r.responseType),f.open(e,t,!0),n4(f,e,i,r),o=o4(f,e,t,o,r),f.onreadystatechange=function(){if(f.readyState===4&&f.status===200)try{if(r.responseType==="blob")n(f.response);else{let d=JSON.parse(f.responseText);d.success===!1&&(d.message=tp(d)||d.message),n(d)}}catch(d){console.warn("catch ajax error...",d),n({success:!1,message:"Network Error!"})}else f.status===404?(console.warn("catch ajax error...",f.status),n({success:!1,code:f.status,message:"Network Error!"})):f.status===500&&(console.warn("catch ajax error...",f.status),n({success:!1,code:f.status,message:"Network Error!"}))},f.onerror=function(d){console.warn("catch ajax error...",d),n({success:!1,message:"Network Error!"})},o instanceof Uint8Array){let d=new Blob([o]);f.send(d)}else f.send(o)}catch(l){console.warn("catch ajax error...",l),n({success:!1,message:"Network Error!"})}})}function i4(e,t,i={}){if(e.toLowerCase()!=="get"&&!(t instanceof FormData)&&typeof t!="string"&&(i==null?void 0:i.contentType)!==!1&&(i=i||{},i.headers=Object.assign(i.headers||{},{"Content-type":"application/json"})),i.headers){let r={};for(let s in i.headers){let n=i.headers[s];r[s]=n}i.headers=r}}function r4(e,t,i={},r){var s;if(!(t.path||(s=i==null?void 0:i.headers)!=null&&s.path)){if(e.includes("component")&&r)t.path=r;else if(r){let n=i.headers||{};n=Object.assign(n,{path:r}),i.headers=n}return{params:t,options:i}}}function k2(e,t=50){return typeof e!="string"?!1:e.length*2>t*1024*1024}function s4(e,t,i,r={}){var d;let s,n,a,o=[],l=r.headers,h=!1;if(i instanceof FormData)s=i;else if(typeof i=="string")s=i;else if((d=l==null?void 0:l["Content-type"])!=null&&d.includes("application/json")){if(typeof i=="object"&&i!==null){for(let u in i)if(k2(i[u])){h=!0;break}}if(h){let u=new FormData;for(let p in i){let _=i[p];k2(_)?u.append(p,new Blob([_],{type:"text/plain"})):u.append(p,typeof _=="object"?JSON.stringify(_):_)}s=u,r.headers&&(r.headers["Content-type"]="multipart/form-data")}else s=JSON.stringify(i)}else{for(n in i)if(a=i[n],a instanceof Array)for(let u=0;u<a.length;u++){let p=a[u];o.push(encodeURIComponent(`${n}[]`)+"="+encodeURIComponent(p))}else if(Object.prototype.toString.call(a)==="[object Object]")for(let u in a){let p=a[u];o.push(encodeURIComponent(`${n}[${u}]`)+"="+(p?encodeURIComponent(p):""))}else o.push(encodeURIComponent(n)+"="+encodeURIComponent(a));s=o.join("&"),e==="GET"&&s&&typeof s=="string"&&r.searchParams===!0&&(t=t+"?"+s,s={})}let c=/{[a-zA-Z]+}/gim,f=[...new Set(t.match(c))];for(let u of f){let p=u.substring(1,u.length-1);t=t.replace(u,i[p]||"")}return{params:s,url:t}}function n4(e,t,i,r={}){let s=r.headers;if(s){for(let n in s){let a=s[n];e.setRequestHeader(encodeURI(n),encodeURI(a))}r.contentType!==!1&&!s["Content-type"]&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8")}else r.contentType!==!1&&e.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");if(e.setRequestHeader("Editor-Version",self.PRO_EDITOR_VERSION||""),self.document){let n=t.toUpperCase();if(n!=="GET"&&n!=="HEAD"){let a=/XSRF-TOKEN=(\S+);?/.exec(document.cookie);a&&e.setRequestHeader("X-XSRF-TOKEN",decodeURIComponent(a[1]))}}}var a4=1e4;function o4(e,t,i,r,s={}){return t.match(/post/i)&&i.startsWith("/")&&!i.startsWith("/servicecenter/")&&typeof r=="string"&&r.length>=a4&&(r=GD(new TextEncoder().encode(r),{level:1}),e.setRequestHeader("Content-Encoding","gzip")),r}async function kx(e,t,i,r){if(!r||!i){let a=`invalid parameters ${r}|${i}.`;return{code:nt.ERR_CODE.NORMAL,success:!1,msg:a,message:a,result:null}}let s=await vt("POST",t?`/api/v4/devices/${r}/delete`:`/api/v4/components/${r}/delete`,{},{headers:{"Content-type":"application/json","content-type":"application/json",path:i}});if(s.code===0&&s.success)return{code:0,success:!0,msg:"",message:"",result:{componentId:r}};let n=s.message||s.msg||"Request Error.";return{...s,msg:n,message:n,result:{componentId:r}}}async function l4(e,t,i){if(e){let c="operations not currently supported.";return{code:nt.ERR_CODE.NORMAL,success:!1,msg:c,message:c,result:null}}let r={code:0,success:!0,result:{devices:{succeed:[],failed:[]},symbols:{succeed:[],failed:[]},footprints:{succeed:[],failed:[]},d3models:{succeed:[],failed:[]},cbbs:{succeed:[],failed:[]},panels:{succeed:[],failed:[]}},msg:"",message:""},s=await yh(e,!0,t,i.devices||[]);r.result.devices={...s.result};let n=await yh(e,!1,t,i.symbols||[]);r.result.symbols={...n.result};let a=await yh(e,!1,t,i.footprints||[]);r.result.footprints={...a.result};let o=await yh(e,!1,t,i.d3models||[]);r.result.d3models={...o.result};let l=await yh(e,!1,t,i.cbbs||[]);r.result.cbbs={...l.result};let h=await yh(e,!1,t,i.panels||[]);return r.result.panels={...h.result},r}async function yh(e,t,i,r){let s=[],n=[];for(let a=0;a<r.length;a++){let o=await kx(e,t,i,r[a]);if(o.code===0&&o.success){s.push(r[a]);continue}s.push(r[a])}return{code:0,success:!0,result:{succeed:s,failed:n},msg:"",message:""}}function Ux(e){if(!e)return[];if(e instanceof Array)return e;let t=[];return e!=null&&e.parent_tag&&(e!=null&&e.parent_tag.uuid)&&t.push(e==null?void 0:e.parent_tag.uuid),e!=null&&e.child_tag&&(e!=null&&e.child_tag.uuid)&&t.push(e==null?void 0:e.child_tag.uuid),t}function Ml(e){if(!e)return[];if(e instanceof Array)return e;let t=[];return e!=null&&e.parent_tag&&(e!=null&&e.parent_tag.name)&&t.push(e==null?void 0:e.parent_tag.name),e!=null&&e.child_tag&&(e!=null&&e.child_tag.name)&&t.push(e==null?void 0:e.child_tag.name),t}function ju(e,t=!1){return e?t?U2(e):e.indexOf("_")>=0?c4(e):e.indexOf("@")>=0?h4(e):U2(e):{componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1}}function U2(e){let t={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/\|/i.test(e))return t.isLocaleFilenameMode=!1,t.componentTitleOrId=e,t;let i=e.split("|");return t.componentTitleOrId=i[0],t.path=i[1],/\./.test(i[0])?(t.isLocaleFilenameMode=!0,t):(t.isLocaleFilenameMode=!1,t)}function h4(e){let t={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/\@/i.test(e))return t.isLocaleFilenameMode=!1,t.componentTitleOrId=e,t;let i=e.split("@");return t.componentTitleOrId=i[0],t.path=i[1],/\./.test(i[0])?(t.isLocaleFilenameMode=!0,t):(t.isLocaleFilenameMode=!1,t)}function c4(e){let t={componentTitleOrId:void 0,path:void 0,isLocaleFilenameMode:!1};if(!/_/i.test(e))return t.isLocaleFilenameMode=!1,t.componentTitleOrId=e,t;let i=e.split("_");return t.componentTitleOrId=i[0],t.path=i[1],/\./.test(i[0])?(t.isLocaleFilenameMode=!0,t):(t.isLocaleFilenameMode=!1,t)}async function Pm(e,t){let i=ju(e,!0),r=i.path||t,s={code:nt.ERR_CODE.NORMAL,success:!0,result:null,msg:""};return s.result={createTime:0,created_at:"",creator:null,dataStr:JSON.stringify({model:`${i.componentTitleOrId}|${r}`,unit:"mm"}),display_title:i.componentTitleOrId||"-",uuid:`${i.componentTitleOrId}|${r}`||"",path:r,description:"",docType:16,modifier:null,owner:null,source:"",tags:{child_tag:[],parent_tag:[]},title:i.componentTitleOrId||"",updateTime:0,updated_at:"",version:"",public:void 0},s}var u4=class{constructor(){if(!crypto||!crypto.subtle)throw new Error("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301crypto api");this.tool=crypto.subtle}},d4=class extends u4{constructor(){super(),this.keyBuffer=null,this.key=null,this.iv=null}async init(e){try{return this.keyBuffer=e.key,this.key=await this.setKey(this.keyBuffer),this.iv=await this.setIV(e.iv),this}catch{throw new Error(`invalid key or iv! ${e}`)}}setKey(e){if(e instanceof ArrayBuffer)return this.tool.importKey("raw",e,"AES-GCM",!0,["encrypt","decrypt"]);throw new Error(`invalid key! ${e}`)}setIV(e){if(e instanceof ArrayBuffer)return e;throw new Error(`invalid iv! ${e}`)}encrypt(e){return this.tool.encrypt({name:"AES-GCM",iv:this.iv},this.key,e)}decrypt(e){return this.tool.decrypt({name:"AES-GCM",iv:this.iv},this.key,e)}decrypt2(e){return this.tool.decrypt({name:"AES-GCM",iv:this.iv,tagLength:128},this.key,e)}getKey(){return this.keyBuffer}getIV(){return this.iv}};function F2(e){let t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map(function(i){return parseInt(i,16)})).buffer:null}function f4(e,t="utf-8"){var i=new TextDecoder(t);return i.decode(e)}async function An(e){try{if(!e.dataStrId)return null;let t=new Headers;t.append("Content-Type","text/plain;charset=UTF-8");let i=await(await fetch(e.dataStrId,{method:"GET",redirect:"error",headers:t})).arrayBuffer();if(i){let r=await p4(e,i);return f4(r)}return null}catch(t){throw new Error("fetch\u5931\u8D25!!!"+t)}}async function p4(e,t){let i=new d4;try{let{key:r,iv:s}=e;if(t&&s&&r){let n=F2(r),a=F2(s);await i.init({key:n,iv:a});let o=await i.decrypt(t);return HD(new Uint8Array(o))}else throw new Error(`\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!\u6570\u636E\u4E0D\u6B63\u786E:data:${t},key:${r},iv:${s}`)}catch(r){throw new Error("\u6570\u636E\u89E3\u5BC6\u5931\u8D25!!!"+r)}}async function Yu(e,t=nt.SYSTEMLIB_UUID){if(!e)return null;let i=null,r=ju(e,!0);if(r.isLocaleFilenameMode)return i=(await Pm(r.componentTitleOrId,r.path||nt.SYSTEMLIB_UUID)).result,i;let s=await vt("GET",`/api/v2/components/${r.componentTitleOrId}`,{},{headers:{"Content-type":"application/json","content-type":"application/json",path:r.path||nt.SYSTEMLIB_UUID}});if(s.code===0&&s.success&&typeof s.result=="object"&&(i=s.result),i&&!i.dataStr)try{let n=await An(i);i.dataStr=n}catch(n){console.error(n)}return i}function Bo(e=new Date,t="yyyy-MM-dd HH:ii:ss"){if(Number.isNaN(e.getTime()))return"-";let i={"M+":e.getMonth()+1,"d+":e.getDate(),"H+":e.getHours(),"h+":e.getHours(),"i+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(let r in i)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length==1?i[r]:("00"+i[r]).substr((""+i[r]).length)));return t}function _4(e,t){function i(c){return c>=10?String(c):"0"+c}e instanceof Date?e.getTime().toString().length>13&&(e=new Date(e.getTime()/1e3)):Number.isNaN(Number(e))||e.toString().length>13&&(e=new Date(Number(e)/1e3));let r=new Date(e);if(Number.isNaN(r.getTime()))return"-";let s=r.getFullYear(),n=i(r.getMonth()+1),a=i(r.getDate()),o=i(r.getHours()),l=i(r.getMinutes()),h=i(r.getSeconds());return t==="downProject"?s+"-"+n+"-"+a:t==="migrateStandardProject"?s+"-"+n+"-"+a+"_"+o+"-"+l+"-"+h:t==="y-m-d"||t==="yyyy-MM-dd"?s+"-"+n+"-"+a:t==="y-m-d_h-m-s"?`${s}-${n}-${a}_${o}-${l}-${h}`:s+"-"+n+"-"+a+" "+o+":"+l+":"+h}function Fx(e,t,i){let r=new Date().getTime(),s=Bo(new Date(r)),n={avatar:"",nickname:"",username:"",uuid:""},a=e+(i?`|${i}`:"");return{createTime:r,created_at:s,creator:{...n},dataStr:JSON.stringify({model:a,unit:"mm"}),description:"",display_title:t,docType:16,modifier:{...n},owner:{...n},path:i,public:!1,source:"",std_uuid:"",tags:{child_tag:[],parent_tag:[]},ticket:0,title:t,type:0,updateTime:r,updated_at:s,uuid:e,version:""}}async function g4(e){return e?new Promise((t,i)=>{window.fetch(`https://modules.lceda.cn/3dmodel/${e}`,{method:"GET"}).then(async r=>{let s=await r.blob();t({code:0,success:!0,result:s,message:""})}).catch(async r=>{t({code:r?r.code:-9,success:!1,result:null,message:"fetch 3D model file failed."})})}):{code:-1,success:!1,result:null,message:"missing uuid or path or detail data."}}var Am=class{},O4=(e=>(e.PROJECT_DOCUMENT_LOCKED="PROJECT_DOCUMENT_LOCKED",e.PROJECT_DOCUMENT_UPDATE_REJECT="PROJECT_DOCUMENT_UPDATE_REJECT",e.NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND="NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND",e.NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND="NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND",e.DEVICE_ATTRIBUTES_ERROR="DEVICE_ATTRIBUTES_ERROR",e.DEVICE_DESCRIPTION_ERROR="DEVICE_DESCRIPTION_ERROR",e.SYMBOL_DESCRIPTION_ERROR="SYMBOL_DESCRIPTION_ERROR",e.FOOTPRINT_DESCRIPTION_ERROR="FOOTPRINT_DESCRIPTION_ERROR",e.D3MODEL_DESCRIPTION_ERROR="D3MODEL_DESCRIPTION_ERROR",e.DEVICE_NAMA_ERROR="DEVICE_NAMA_ERROR",e.SYMBOL_NAMA_ERROR="SYMBOL_NAMA_ERROR",e.FOOTPRINT_NAMA_ERROR="FOOTPRINT_NAMA_ERROR",e.PANEL_LIB_NAMA_ERROR="PANEL_LIB_NAMA_ERROR",e.D3MODEL_NAMA_ERROR="D3MODEL_NAMA_ERROR",e.SIM_MODEL_NAMA_ERROR="SIM_MODEL_NAMA_ERROR",e.DEVICE_SAME_NAMA_EXISTS="DEVICE_SAME_NAMA_EXISTS",e.SYMBOL_SAME_NAMA_EXISTS="SYMBOL_SAME_NAMA_EXISTS",e.FOOTPRINT_SAME_NAMA_EXISTS="FOOTPRINT_SAME_NAMA_EXISTS",e.D3MODEL_SAME_NAMA_EXISTS="D3MODEL_SAME_NAMA_EXISTS",e.SIM_MODEL_SAME_NAMA_EXISTS="SIM_MODEL_SAME_NAMA_EXISTS",e.PANELLIB_SAME_NAMA_EXISTS="PANELLIB_SAME_NAMA_EXISTS",e.PARAMETER_VERIFICATION="PARAMETER_VERIFICATION",e.RESULT_VERIFICATION="RESULT_VERIFICATION",e.GET_DEVICE="GET_DEVICE",e.GET_DEVICE_NOT_FOUND="GET_DEVICE_NOT_FOUND",e.GET_DEVICE_LIST="GET_DEVICE_LIST",e.GET_DEVICE_SEARCH_LIST="GET_DEVICE_SEARCH_LIST",e.GET_SYMBOL="GET_SYMBOL",e.GET_SYMBOL_NOT_FOUND="GET_SYMBOL_NOT_FOUND",e.GET_SYMBOL_LIST="GET_SYMBOL_LIST",e.GET_SYMBOL_SEARCH_LIST="GET_SYMBOL_SEARCH_LIST",e.GET_FOOTPRINT="GET_FOOTPRINT",e.GET_FOOTPRINT_NOT_FOUND="GET_FOOTPRINT_NOT_FOUND",e.GET_FOOTPRINT_LIST="GET_FOOTPRINT_LIST",e.GET_FOOTPRINT_SEARCH_LIST="GET_FOOTPRINT_SEARCH_LIST",e.GET_PANEL_LIB_SEARCH_LIST="GET_PANEL_LIB_SEARCH_LIST",e.GET_D3MODEL="GET_D3MODEL",e.GET_D3MODEL_NOT_FOUND="GET_D3MODEL_NOT_FOUND",e.GET_D3MODEL_LIST="GET_D3MODEL_LIST",e.GET_D3MODEL_SEARCH_LIST="GET_D3MODEL_SEARCH_LIST",e.GET_SIM_MODEL="GET_SIM_MODEL",e.GET_SIM_NOT_FOUND="GET_SIM_NOT_FOUND",e.GET_SIM_MODEL_LIST="GET_SIM_MODEL_LIST",e.GET_SIM_MODEL_SEARCH_LIST="GET_SIM_MODEL_SEARCH_LIST",e.CROSS_BIND="CROSS_BIND",e.CROSS_BIND_EXIT="CROSS_BIND_EXIT",e.IMPORT_EXIST_PROJECT="IMPORT_EXIST_PROJECT",e.CREATE_PROJECT="CREATE_PROJECT",e.CREATE_DEVICE="CREATE_DEVICE",e.CREATE_DEVICE_DUP_TITLE="CREATE_DEVICE_DUP_TITLE",e.CREATE_DEVICE_PERMISSIONS="CREATE_DEVICE_PERMISSIONS",e.CREATE_SYMBOL="CREATE_SYMBOL",e.CREATE_SYMBOL_DUP_TITLE="CREATE_SYMBOL_DUP_TITLE",e.CREATE_SYMBOL_PERMISSIONS="CREATE_SYMBOL_PERMISSIONS",e.CREATE_SYMBOL_MIGRATE_CANVAS_ERROR="CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",e.CREATE_FOOTPRINT="CREATE_FOOTPRINT",e.CREATE_FOOTPRINT_DUP_TITLE="CREATE_FOOTPRINT_DUP_TITLE",e.CREATE_FOOTPRINT_PERMISSIONS="CREATE_FOOTPRINT_PERMISSIONS",e.CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR="CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",e.CREATE_D3MODEL="CREATE_D3MODEL",e.CREATE_D3MODEL_DUP_TITLE="CREATE_D3MODEL_DUP_TITLE",e.CREATE_D3MODEL_PERMISSIONS="CREATE_D3MODEL_PERMISSIONS",e.CREATE_PANEL_LIB="CREATE_PANEL_LIB",e.CREATE_PANEL_DUP_TITLE="CREATE_PANEL_DUP_TITLE",e.CREATE_PANEL_PERMISSIONS="CREATE_PANEL_PERMISSIONS",e.CREATE_SIM_MODEL="CREATE_SIM_MODEL",e.CREATE_SIM_MODEL_DUP_TITLE="CREATE_SIM_MODEL_DUP_TITLE",e.CREATE_SIM_MODEL_PERMISSIONS="CREATE_SIM_MODEL_PERMISSIONS",e.CREATE_SIM_MODEL_MIGRATE_CANVAS_ERROR="CREATE_SIM_MODEL_MIGRATE_CANVAS_ERROR",e.UPDATE_DEVICE="UPDATE_DEVICE",e.UPDATE_DEVICE_ATTRIBUTES="UPDATE_DEVICE_ATTRIBUTES",e.UPDATE_DEVICE_PERMISSIONS="CREATE_DEVICE_PERMISSIONS",e.UPDATE_SYMBOL="UPDATE_SYMBOL",e.UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR="UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR",e.UPDATE_SYMBOL_PERMISSIONS="UPDATE_SYMBOL_PERMISSIONS",e.UPDATE_FOOTPRINT="UPDATE_FOOTPRINT",e.UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR="UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",e.UPDATE_FOOTPRINT_PERMISSIONS="UPDATE_FOOTPRINT_PERMISSIONS",e.UPDATE_D3MODEL_PERMISSIONS="UPDATE_D3MODEL_PERMISSIONS",e.UPDATE_SIM_MODEL="UPDATE_SIM_MODEL",e.UPDATE_SIM_MODEL_MIGRATE_CANVAS_ERROR="UPDATE_SIM_MODEL_MIGRATE_CANVAS_ERROR",e.UPDATE_SIM_MODEL_PERMISSIONS="UPDATE_SIM_MODEL_PERMISSIONS",e.DELETE_DEVICE="DELETE_DEVICE",e.DELETE_SYMBOL="DELETE_SYMBOL",e.DELETE_FOOTPRINT="DELETE_FOOTPRINT",e.DELETE_SIM_MODEL="DELETE_SIM_MODEL",e.DELETE_3DMODEL="DELETE_3DMODEL",e.GET_SOURCE="GET_SOURCE",e))(O4||{}),Ae=class{constructor(e,t=""){this._message=t,this._action=e}get message(){return this._message}set message(e){this._message=e}get action(){return this._action}set action(e){this._action=e}toJSON(){return{message:this.message,action:this.action}}};function ci(e){if(!e){let t="missing creator data.";throw new Ae("RESULT_VERIFICATION",t)}return{uuid:e.uuid,nickname:e.nickname,username:e.username}}function ui(e){if(!e){let t="missing modifier data.";throw new Ae("RESULT_VERIFICATION",t)}return{uuid:e.uuid,nickname:e.nickname,username:e.username}}function di(e){if(!e){let t="missing owner data.";throw new Ae("RESULT_VERIFICATION",t)}return{uuid:e.uuid,nickname:e.nickname,username:e.username}}function Is(e,t){let i=Object.keys(t);for(let r=0;r<i.length;r++)WM.indexOf(i[r])<=-1||(i[r]==="title"&&"display_title"in e&&t.title&&(e.display_title=String(t.title),e.title=String(t.title).toLocaleLowerCase()),e[i[r]]=t[i[r]])}function Rp(e,t){return e[t]}function Gx(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ae("DEVICE_NAMA_ERROR",t)}}function zx(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ae("SYMBOL_NAMA_ERROR",t)}}function Hx(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ae("FOOTPRINT_NAMA_ERROR",t)}}function m4(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ae("D3MODEL_NAMA_ERROR",t)}}function jx(e){if(!e||e.length<=0||e.length>128){let t="The title length must be between 1~128 characters!";throw new Ae("SIM_MODEL_NAMA_ERROR",t)}}async function Mh(e,t){let i=[],r=[],s=async o=>{let{message:l}=await Ge.messageBus.rpcCall(Ha.TAG.CREATE,o);return l},n=null;try{for(let o=0;o<e.length;o++){let l=await s({...e[o],path:e[o].user_uuid});if(l.code===0&&l.success){let c={...l,message:"",result:{...e[o],path:e[o].user_uuid,...l.result[0]}};i.push(c),t&&t(c,o);continue}let h={...l,result:{...e[o]}};r.push(h)}return{code:0,success:!0,result:{successList:i,failList:r},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Add Categories Batch Error";return{code:n?n.code:nt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}function fs(e=[],t,i){if(!e||!e.length||!t)return{index:-1,data:null};let r={index:-1,data:null};for(let s=0;s<e.length;s++)if(typeof e[s]=="object"&&e[s][t]===i){r.data=e[s],r.index=s;break}return r}function y4(e=[],t,i){if(!e||!e.length||!t)return{indexs:[],datas:[]};let r={indexs:[],datas:[]};for(let s=0;s<e.length;s++)typeof e[s]=="object"&&e[s][t]===i&&(r.datas.push(e[s]),r.indexs.push(s));return r}function cu(e=0,t=Number.MAX_SAFE_INTEGER){return Math.floor(Math.random()*(t-e+1))+e}function Lu(e=36){let t=[],i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t[r]=i.substr(Math.floor(Math.random()*16),1);return t[14]&&(t[14]=String(cu(1,9))),t[19]&&(t[19]=i.substr(+t[19]&3|8,1)),t[8]&&(t[8]=String(cu(1,9))),t[13]&&(t[13]=String(cu(1,9))),t[18]&&(t[18]=String(cu(1,9))),t[23]&&(t[23]=String(cu(1,9))),t.join("")}function G2(e,t=!0){return(i,r)=>{let s=i[e],n=r[e];return typeof s<"u"&&typeof n<"u"?t?s-n:n-s:0}}var b4=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree,this.getFile=e.getDetail}async getTransformedList(e){let t=await this.getList(e),{count:i,page:r,pageSize:s,lists:n,totalPage:a}=t;return{count:i,page:r,pageSize:s,totalPage:a,lists:n.map(o=>this.extendLib.transformer.transformCbbListItem(o))}}async getTransformedDetail(e){return await this.getDetail(e)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?t:[]}},x4=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getSupportedSymbolTypes=e.getSupportedSymbolTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree}async getTransformedList(e){let t=await this.getList(e),{count:i,page:r,pageSize:s,lists:n,totalPage:a}=t;return{count:i,page:r,pageSize:s,totalPage:a,lists:n.map(o=>this.extendLib.transformer.transformDeviceListItem(o))}}async getTransformedDetail(e){let t=await this.getDetail(e);return this.extendLib.transformer.transformDeviceListItem(t)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?t:[]}},v4=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree}async getTransformedList(e){let t=await this.getList(e),{count:i,page:r,pageSize:s,lists:n=[],totalPage:a}=t,o=[];for(let l of n)o.push(await this.extendLib.transformer.transformFootprintListItem(l));return{count:i,page:r,pageSize:s,totalPage:a,lists:o}}async getTransformedDetail(e){let t=await this.getDetail(e);return await this.extendLib.transformer.transformFootprintListItem(t)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?t:[]}},E4=class{constructor(e,t){this.extendLib=t,this.getList=e.getList,this.getSupportedPreviewTypes=e.getSupportedPreviewTypes,this.getSupportedSymbolTypes=e.getSupportedSymbolTypes,this.getDetail=e.getDetail,this.getClassificationTree=e.getClassificationTree}async getTransformedList(e){let t=await this.getList(e),{count:i,page:r,pageSize:s,lists:n,totalPage:a}=t,o=[];for(let l of n)o.push(await this.extendLib.transformer.transformSymbolListItem(l));return{count:i,page:r,pageSize:s,totalPage:a,lists:o}}async getTransformedDetail(e){let t=await this.getDetail(e);return await this.extendLib.transformer.transformSymbolListItem(t)}async getTransformedClassificationTree(){var e,t;return(t=(e=await this.getClassificationTree())==null?void 0:e.map(i=>this.extendLib.transformer.transformCategory(i)))!=null?t:[]}},T4=class{constructor(e){this.extendLib=e}transformTime(e=Date.now()){return e.toString().length>13?e/1e3:e}transformTimeStr(e=Date.now()){let t=this.transformTime(e);return Bo(new Date(t*1e3))}transformTags(e){let{primaryClassificationName:t,primaryClassificationUuid:i,secondaryClassificationName:r,secondaryClassificationUuid:s}=e||{};return{parent_tag:t?{uuid:i,name:t}:void 0,child_tag:r?{uuid:s,name:r}:void 0}}transformCategory(e,t){var r,s;let i=(r=e.uuid)!=null?r:crypto.randomUUID();return{id:i,title:e.name,children:(s=e.children)==null?void 0:s.map(n=>this.transformCategory(n,i)),parentId:t}}transformDeviceListItem(e){var t,i,r,s,n,a,o,l;return{title:e.name||"",description:e.description||"",images:[],uuid:e.uuid||this.extendLib.getDefaultItemId(),path:this.extendLib.id,source:"",version:"",ticket:0,updateTime:this.transformTime(e.updateTime),createTime:this.transformTime(e.createTime||e.updateTime),display_title:e.name||"",creator:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},attributes:{...(t=e.attributes)!=null?t:{},Footprint:((i=e.footprint)==null?void 0:i.uuid)||"",Symbol:((r=e.symbol)==null?void 0:r.uuid)||"",value:e.value||((s=e.attributes)==null?void 0:s.value)||"",supplierPart:e.supplierPart||((n=e.attributes)==null?void 0:n.supplierPart)||"",manufacturer:e.manufacturer||((a=e.attributes)==null?void 0:a.manufacturer)||"",description:e.description||((o=e.attributes)==null?void 0:o.description)||""},symbol:e.symbol?{display_title:e.symbol.name||""}:void 0,footprint:e.footprint?{display_title:e.footprint.name||""}:void 0,tags:this.transformTags(e.classification),symbol_type:(l=e.symbol)==null?void 0:l.symbolType}}async transformSymbolListItem(e){var t,i,r,s,n,a,o,l,h,c;return{docType:e.symbolType,uuid:e.uuid||this.extendLib.getDefaultItemId(),title:e.name||"",description:e.description||"",path:this.extendLib.id,source:"",version:(t=e.version)!=null?t:"",ticket:0,updateTime:this.transformTime(e.updateTime),createTime:this.transformTime(e.createTime||e.updateTime),display_title:e.name||"",creator:e.creator?{nickname:(i=e.creator.name)!=null?i:"",username:(r=e.creator.name)!=null?r:"",uuid:(s=e.creator.uuid)!=null?s:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:e.modifier?{nickname:(n=e.modifier.name)!=null?n:"",username:(a=e.modifier.name)!=null?a:"",uuid:(o=e.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:e.owner?{nickname:(l=e.owner.name)!=null?l:"",username:(h=e.owner.name)!=null?h:"",uuid:(c=e.owner.uuid)!=null?c:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},dataStr:e.data instanceof Blob?await e.data.text():e.data,tags:this.transformTags(e.classification)}}async transformFootprintListItem(e){var t,i,r,s,n,a,o,l,h,c;return{docType:4,uuid:e.uuid||this.extendLib.getDefaultItemId(),title:e.name||"",description:e.description||"",path:this.extendLib.id,source:"",version:(t=e.version)!=null?t:"",ticket:0,updateTime:this.transformTime(e.updateTime),createTime:this.transformTime(e.createTime||e.updateTime),display_title:e.name||"",creator:e.creator?{nickname:(i=e.creator.name)!=null?i:"",username:(r=e.creator.name)!=null?r:"",uuid:(s=e.creator.uuid)!=null?s:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:e.modifier?{nickname:(n=e.modifier.name)!=null?n:"",username:(a=e.modifier.name)!=null?a:"",uuid:(o=e.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:e.owner?{nickname:(l=e.owner.name)!=null?l:"",username:(h=e.owner.name)!=null?h:"",uuid:(c=e.owner.uuid)!=null?c:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},dataStr:e.data instanceof Blob?await e.data.text():e.data,tags:this.transformTags(e.classification)}}transformCbbListItem(e){var t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g,b,m,O,y,x,E,w,S,C,R,B,Y,G,z,q,L,M,v,P,I,N;return{cbb_project:!0,content:(t=e.description)!=null?t:"",creator:e.creator?{avatar:"",nickname:(i=e.creator.name)!=null?i:"",username:(r=e.creator.name)!=null?r:"",uuid:(s=e.creator.uuid)!=null?s:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:e.modifier?{nickname:(n=e.modifier.name)!=null?n:"",username:(a=e.modifier.name)!=null?a:"",uuid:(o=e.modifier.uuid)!=null?o:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},owner:e.owner?{avatar:"",team:!1,nickname:(l=e.owner.name)!=null?l:"",username:(h=e.owner.name)!=null?h:"",uuid:(c=e.owner.uuid)!=null?c:""}:{avatar:"",team:!1,nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},name:e.name,path:this.extendLib.id,block_symbol:(d=(f=e.blockSymbols)==null?void 0:f.map(D=>{var j;return{uuid:D.uuid,display_title:D.name,docType:17,project_uuid:(j=e.uuid)!=null?j:e.name,title:D.name.toLocaleLowerCase()}}))!=null?d:[],schematics:(p=(u=e.schematics)==null?void 0:u.map(D=>{var H,K;let j=(K=(H=e.sheets)==null?void 0:H.filter(se=>se.belongSchematicUuid===D.uuid).map(se=>({uuid:se.uuid,ticket:0})))!=null?K:[];return{create_at:this.transformTimeStr(D.createTime||D.updateTime),createtime:this.transformTime(D.createTime||D.updateTime),display_name:D.name,name:D.name.toLocaleLowerCase(),project_uuid:e.uuid,sheet_count:j.length,sort:j,ticket:0,update_at:this.transformTimeStr(D.updateTime),uuid:D.uuid,updateTime:this.transformTime(D.updateTime)}}))!=null?p:[],pcb:(g=(_=e.pcbs)==null?void 0:_.map(D=>{var j,H,K,se,he,_e,ve,J,Z,re,ue;return{description:(j=D.description)!=null?j:"",display_title:D.name,docType:3,project_uuid:(H=e.uuid)!=null?H:"",thumb:D.thumb,title:D.name.toLocaleLowerCase(),updateTime:this.transformTime(D.updateTime),uuid:D.uuid,creator:D.creator?{avatar:"",nickname:(se=(K=D.creator)==null?void 0:K.name)!=null?se:"",username:(_e=(he=D.creator)==null?void 0:he.name)!=null?_e:"",uuid:(J=(ve=D.creator)==null?void 0:ve.uuid)!=null?J:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:D.modifier?{nickname:(Z=D==null?void 0:D.modifier.name)!=null?Z:"",username:(re=D==null?void 0:D.modifier.name)!=null?re:"",uuid:(ue=D==null?void 0:D.modifier.uuid)!=null?ue:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id}}}))!=null?g:[],schs:(m=(b=e.sheets)==null?void 0:b.map(D=>{var j,H,K,se,he,_e,ve,J;return{description:(j=D.description)!=null?j:"",display_title:D.name,docType:1,project_uuid:(H=e.uuid)!=null?H:"",schematic_uuid:D.belongSchematicUuid,thumb:D.thumb,title:D.name.toLocaleLowerCase(),updateTime:this.transformTime(D.updateTime),uuid:D.uuid,creator:D.creator?{avatar:"",nickname:(K=D==null?void 0:D.creator.name)!=null?K:"",username:(se=D==null?void 0:D.creator.name)!=null?se:"",uuid:(he=D==null?void 0:D.creator.uuid)!=null?he:""}:{avatar:"",nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id},modifier:D!=null&&D.modifier?{nickname:(_e=D==null?void 0:D.modifier.name)!=null?_e:"",username:(ve=D==null?void 0:D.modifier.name)!=null?ve:"",uuid:(J=D==null?void 0:D.modifier.uuid)!=null?J:""}:{nickname:this.extendLib.title,username:this.extendLib.title,uuid:this.extendLib.id}}}))!=null?m:[],tags:{parent_tag:{name:(y=(O=e.classification)==null?void 0:O.primaryClassificationName)!=null?y:"",name_cn:(E=(x=e.classification)==null?void 0:x.primaryClassificationName)!=null?E:"",title:(S=(w=e.classification)==null?void 0:w.primaryClassificationName)!=null?S:"",uuid:(R=(C=e.classification)==null?void 0:C.primaryClassificationUuid)!=null?R:""},child_tag:{name:(Y=(B=e.classification)==null?void 0:B.secondaryClassificationName)!=null?Y:"",name_cn:(z=(G=e.classification)==null?void 0:G.secondaryClassificationName)!=null?z:"",title:(L=(q=e.classification)==null?void 0:q.secondaryClassificationName)!=null?L:"",uuid:(v=(M=e.classification)==null?void 0:M.secondaryClassificationUuid)!=null?v:""}},updated_at:this.transformTimeStr(e.updateTime),uuid:(P=e.uuid)!=null?P:e.name,boards:(N=(I=e.boards)==null?void 0:I.map(D=>({name:D.name,pcb:D.pcbUuid,sch:D.schUuid})))!=null?N:[]}}},w4=class Yx{constructor(t){this.transformer=new T4(this),this.id=t.id,this.isVisible=i=>t.isVisible?t.isVisible(i)&&this.isInTab(i.tabName):this.isInTab(i.tabName),this.title=t.title,this.position=t.position,t.device&&(this.device=new x4(t.device,this)),t.symbol&&(this.symbol=new E4(t.symbol,this)),t.footprint&&(this.footprint=new v4(t.footprint,this)),t.cbb&&(this.cbb=new b4(t.cbb,this))}static async set(t){var r,s,n,a,o,l,h,c;let i=new Yx(t);return i._deviceSupportedSymbolTypes=await((s=(r=t.device)==null?void 0:r.getSupportedSymbolTypes)==null?void 0:s.call(r)),i._symbolSupportedSymbolTypes=await((a=(n=t.symbol)==null?void 0:n.getSupportedSymbolTypes)==null?void 0:a.call(n)),i._deviceSupportedPreviewTypes=await((l=(o=t.device)==null?void 0:o.getSupportedPriviewTypes)==null?void 0:l.call(o)),i._footprintSupportedPreviewTypes=await((c=(h=t.footprint)==null?void 0:h.getSupportedPriviewTypes)==null?void 0:c.call(h)),i}getDefaultItemId(){return crypto.randomUUID().replace("-","")}getLibraryFunctionsClassInTab(t){switch(t){case"cbb":return this==null?void 0:this.cbb;case"device":return this==null?void 0:this.device;case"symbol":return this==null?void 0:this.symbol;case"footprint":return this==null?void 0:this.footprint;default:return null}}isInTab(t){return!!this.getLibraryFunctionsClassInTab(t)}isHasCategoryTreeInTab(t){var i;return!!((i=this.getLibraryFunctionsClassInTab(t))!=null&&i.getClassificationTree)}async getAmountByWd(t,i){var r,s,n;return(n=(s=await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getList({page:1,pageSize:1,query:{wd:i}})))==null?void 0:s.count)!=null?n:0}getTabByCategoryType(t){switch(t){case 1:return"cbb";case 3:return"device";case 2:return"symbol";case 4:return"footprint";default:return null}}async getClassificationTreeInTab(t){var i;return this.isHasCategoryTreeInTab(t)?await((i=this.getLibraryFunctionsClassInTab(t))==null?void 0:i.getClassificationTree()):null}async getCategoryTreeDataItemsInTab(t){var i;return(i=await this.getClassificationTreeInTab(t))==null?void 0:i.map(r=>this.transformer.transformCategory(r))}async getClassificationTreeByCategoryType(t){let i=this.getTabByCategoryType(t);return i&&this.getClassificationTreeInTab(i)}async getCategoryTreeDataItemsByCategoryType(t){let i=this.getTabByCategoryType(t);return i&&this.getCategoryTreeDataItemsInTab(i)}getSelectTypeListInTab(t){let i=[];if(t==="device"){let r=this._deviceSupportedSymbolTypes;i=r?A2.filter(s=>r.includes(Number(s.value))||!s.value):A2}else if(t==="symbol"){let r=this._symbolSupportedSymbolTypes;i=r?C2.filter(s=>r.includes(Number(s.value))||!s.value):C2}return i.length>2?i:[]}getPreviewTypesInTab(t){let i=OD[t];return t==="device"&&this._deviceSupportedPreviewTypes?i=i.filter(r=>{var s;return(s=this._deviceSupportedPreviewTypes)==null?void 0:s.includes(r)}):t==="footprint"&&this._footprintSupportedPreviewTypes&&(i=i.filter(r=>{var s;return(s=this._footprintSupportedPreviewTypes)==null?void 0:s.includes(r)})),i}async getListInTab(t,i){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getList(i))}async getTransformedListInTab(t,i){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getTransformedList(i))}async getDetailInTab(t,i){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getDetail(i))}async getTransformedDetailInTab(t,i){var r;return await((r=this.getLibraryFunctionsClassInTab(t))==null?void 0:r.getTransformedDetail(i))}},S4=class{constructor(e=10){this._runingCount=0,this._handleCount=0,this._queue=[],this._results=[],this._windowSize=e,this._finishCallback=null,this._taskStartCallback=null,this._taskEndCallback=null}pushTask(e){this._queue.push(e)}setFinishCallback(e){this._finishCallback=e}setTaskStartCallback(e){this._taskStartCallback=e}setTaskEndCallback(e){this._taskEndCallback=e}next(){for(;this._runingCount<this._windowSize&&this._queue.length>0;){this._runingCount+=1,this._handleCount+=1;let e=this._handleCount-1,t=this._queue.shift();this._taskStartCallback&&this._taskStartCallback(e),t(e).then(i=>{this._results.push(i)}).catch(i=>{this._results.push(i)}).finally(()=>{this._runingCount-=1,this._taskEndCallback&&this._taskEndCallback(this._results[this._results.length-1]),this.next()})}this._runingCount<=0&&this._finishCallback&&this._finishCallback(this._results)}},Cm=class{onString(e,t,i){}onAttr(e,t,i){}onGroup(e,t,i,r,s){}onDelGroup(e,t,i,r){}onDelString(e,t,i,r){}onDelAttr(e,t,i,r){}onPanelizeSide(e,t,i,r){}onDelPanelizeSide(e,t,i,r){}onPanelizeStamp(e,t,i,r){}onDelPanelizeStamp(e,t,i,r){}onPanelize(e,t,i,r){}onDelPanelize(e,t,i){}onRuleSelector(e,t,i,r){}onDelRuleSelector(e,t,i,r){}onRule(e,t,i,r){}onDelRule(e,t,i,r,s){}onRuleTemplate(e,t,i,r){}onDimension(e,t,i,r,s,n){}onDelDimension(e,t,i,r){}onBoss(e,t,i,r,s,n){}onDelBoss(e,t,i,r){}onShellEntity(e,t,i,r,s,n){}onDelShellEntity(e,t,i,r){}onShellCut(e,t,i,r,s,n){}onDelShellCut(e,t,i,r){}onCrease(e,t,i,r,s,n){}onDelCrease(e,t,i,r){}onShell(e,t,i,r,s,n){}onDelShell(e,t,i,r){}onFpcFill(e,t,i,r,s,n){}onDelFpcFill(e,t,i,r){}onTeardrop(e,t,i,r,s,n){}onDelTeardrop(e,t,i,r){}onImage(e,t,i,r,s,n){}onDelImage(e,t,i,r){}onPoured(e,t,i,r,s,n){}onDelPoured(e,t,i,r){}onPour(e,t,i,r,s,n){}onDelPour(e,t,i,r){}onRegion(e,t,i,r,s,n){}onDelRegion(e,t,i,r){}onFill(e,t,i,r,s,n){}onDelFill(e,t,i,r){}onPoly(e,t,i,r,s,n){}onDelPoly(e,t,i,r){}onEQLenGrp(e,t,i,r,s){}onDelEQLenGrp(e,t,i,r){}onDelProp(e,t,i,r){}onObj(e,t,i,r,s,n){}onDelObj(e,t,i,r){}onArc(e,t,i,r,s,n){}onDelArc(e,t,i,r){}onCArc(e,t,i,r,s,n){}onDelCArc(e,t,i,r){}onLine(e,t,i,r,s,n){}onDelLine(e,t,i,r){}onPad(e,t,i,r,s,n){}onDelPad(e,t,i,r){}onVia(e,t,i,r,s,n){}onDelVia(e,t,i,r){}onDelConnect(e,t,i,r){}onPreference(e,t,i,r){}onSilkOpts(e,t,i,r,s){}onDelSilkOpts(e,t,i,r){}onPrimitive(e,t,i,r,s){}onDelPrimitive(e,t,i,r){}onNet(e,t,i,r,s){}onDelNet(e,t,i,r){}onPartition(e,t,i,r,s,n){}onDelPartition(e,t,i,r){}onActiveLayer(e,t,i,r){}onLayerPhys(e,t,i,r,s){}onDelLayerPhys(e,t,i,r){}onLayer(e,t,i,r,s){}onDelLayer(e,t,i,r){}onCanvas(e,t,i,r){}onDocDetail(e,t,i,r){}onStringNum(e,t){}onAttrNum(e,t){}onDimensionNum(e,t){}onBossNum(e,t){}onShellEntityNum(e,t){}onShellCutNum(e,t){}onCreaseNum(e,t){}onShellNum(e,t){}onFpcFillNum(e,t){}onTeardropNum(e,t){}onImageNum(e,t){}onPouredNum(e,t){}onPourNum(e,t){}onRegionNum(e,t){}onFillNum(e,t){}onPolyNum(e,t){}onObjNum(e,t){}onArcNum(e,t){}onCArcNum(e,t){}onLineNum(e,t){}onPadNum(e,t){}onViaNum(e,t){}onPartitionNum(e,t){}},I4=class extends Cm{constructor(e){super(),this.source={},this._action=e}get action(){return this._action}getSource(){return this.source}onString(e,t,i){this.source[e]=t}onAttr(e,t,i){i||(this.action&&this.action(e,t),this.source[e]=t)}onDimension(e,t,i,r,s,n){this.source[e]=s}onBoss(e,t,i,r,s,n){this.source[e]=s}onShellEntity(e,t,i,r,s,n){this.source[e]=s}onShellCut(e,t,i,r,s,n){this.source[e]=s}onCrease(e,t,i,r,s,n){this.source[e]=s}onShell(e,t,i,r,s,n){this.source[e]=s}onFpcFill(e,t,i,r,s,n){this.source[e]=s}onTeardrop(e,t,i,r,s,n){this.source[e]=s}onImage(e,t,i,r,s,n){this.source[e]=s}onPoured(e,t,i,r,s,n){this.source[e]=s}onPour(e,t,i,r,s,n){this.source[e]=s}onRegion(e,t,i,r,s,n){this.source[e]=s}onFill(e,t,i,r,s,n){this.source[e]=s}onPoly(e,t,i,r,s,n){this.source[e]=s}onObj(e,t,i,r,s,n){this.source[e]=s}onArc(e,t,i,r,s,n){this.source[e]=s}onCArc(e,t,i,r,s,n){this.source[e]=s}onLine(e,t,i,r,s,n){this.source[e]=s}onPad(e,t,i,r,s,n){this.source[e]=s}onVia(e,t,i,r,s,n){this.source[e]=s}},Vx=class extends Db{onBoard(e,t,i,r){}onDelBoard(e,t,i){}constructor(e,t,i){super(e,t,i,new xm(!1)),this._compilerHandler=null}async init(e=!1,t=!1,i=!1,r=!1){return super.init(e,t,i,r)}onBlob(e,t,i,r,s){}onDelBlob(e,t,i,r){}onFont(e,t,i,r){}onDelFont(e,t,i,r){}canvasSelected(){return""}onSelectChange(e,t,i){}onSelectQuit(e,t){}onLayerFill(e,t,i,r,s){}onDelLayerFill(e,t,i,r){}setHandler(e){this._compilerHandler=e}onGroup(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onGroup(e,t,i,r,s)}onDelGroup(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelGroup(e,t,i,r)}onString(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onString(e,s,n)}onDelString(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelString(e,t,i,r)}onAttr(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onAttr(e,s,n)}onDelAttr(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelAttr(e,t,i,r)}onPanelizeSide(e,t,i,r){this._compilerHandler&&this._compilerHandler.onPanelizeSide(e,t,i,r)}onDelPanelizeSide(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPanelizeSide(e,t,i,r)}onPanelizeStamp(e,t,i,r){this._compilerHandler&&this._compilerHandler.onPanelizeStamp(e,t,i,r)}onDelPanelizeStamp(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPanelizeStamp(e,t,i,r)}onPanelize(e,t,i,r){this._compilerHandler&&this._compilerHandler.onPanelize(e,t,i,r)}onDelPanelize(e,t,i){this._compilerHandler&&this._compilerHandler.onDelPanelize(e,t,i)}onRuleSelector(e,t,i,r){this._compilerHandler&&this._compilerHandler.onRuleSelector(e,t,i,r)}onDelRuleSelector(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelRuleSelector(e,t,i,r)}onRule(e,t,i,r){this._compilerHandler&&this._compilerHandler.onRule(e,t,i,r)}onDelRule(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onDelRule(e,t,i,r,s)}onRuleTemplate(e,t,i,r){this._compilerHandler&&this._compilerHandler.onRuleTemplate(e,t,i,r)}onDimension(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onDimension(e,t,i,r,s,n)}onDelDimension(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelDimension(e,t,i,r)}onBoss(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onBoss(e,t,i,r,s,n)}onDelBoss(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelBoss(e,t,i,r)}onShellEntity(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onShellEntity(e,t,i,r,s,n)}onDelShellEntity(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelShellEntity(e,t,i,r)}onShellCut(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onShellCut(e,t,i,r,s,n)}onDelShellCut(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelShellCut(e,t,i,r)}onCrease(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onCrease(e,t,i,r,s,n)}onDelCrease(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelCrease(e,t,i,r)}onShell(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onShell(e,t,i,r,s,n)}onDelShell(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelShell(e,t,i,r)}onFpcFill(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onFpcFill(e,t,i,r,s,n)}onDelFpcFill(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelFpcFill(e,t,i,r)}onTeardrop(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onTeardrop(e,t,i,r,s,n)}onDelTeardrop(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelTeardrop(e,t,i,r)}onImage(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onImage(e,t,i,r,s,n)}onDelImage(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelImage(e,t,i,r)}onPoured(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onPoured(e,t,i,r,s,n)}onDelPoured(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPoured(e,t,i,r)}onPour(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onPour(e,t,i,r,s,n)}onDelPour(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPour(e,t,i,r)}onRegion(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onRegion(e,t,i,r,s,n)}onDelRegion(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelRegion(e,t,i,r)}onFill(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onFill(e,t,i,r,s,n)}onDelFill(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelFill(e,t,i,r)}onPoly(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onPoly(e,t,i,r,s,n)}onDelPoly(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPoly(e,t,i,r)}onEQLenGrp(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onEQLenGrp(e,t,i,r,s)}onDelEQLenGrp(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelEQLenGrp(e,t,i,r)}onDelProp(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelProp(e,t,i,r)}onObj(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onObj(e,t,i,r,s,n)}onDelObj(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelObj(e,t,i,r)}onArc(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onArc(e,t,i,r,s,n)}onDelArc(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelArc(e,t,i,r)}onCArc(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onCArc(e,t,i,r,s,n)}onDelCArc(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelCArc(e,t,i,r)}onLine(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onLine(e,t,i,r,s,n)}onDelLine(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelLine(e,t,i,r)}onPad(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onPad(e,t,i,r,s,n)}onDelPad(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPad(e,t,i,r)}onVia(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onVia(e,t,i,r,s,n)}onDelVia(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelVia(e,t,i,r)}onDelConnect(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelConnect(e,t,i,r)}onPreference(e,t,i,r){this._compilerHandler&&this._compilerHandler.onPreference(e,t,i,r)}onSilkOpts(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onSilkOpts(e,t,i,r,s)}onDelSilkOpts(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelSilkOpts(e,t,i,r)}onPrimitive(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onPrimitive(e,t,i,r,s)}onDelPrimitive(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPrimitive(e,t,i,r)}onNet(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onNet(e,t,i,r,s)}onDelNet(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelNet(e,t,i,r)}onPartition(e,t,i,r,s,n){this._compilerHandler&&this._compilerHandler.onPartition(e,t,i,r,s,n)}onDelPartition(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelPartition(e,t,i,r)}onActiveLayer(e,t,i,r){this._compilerHandler&&this._compilerHandler.onActiveLayer(e,t,i,r)}onLayerPhys(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onLayerPhys(e,t,i,r,s)}onDelLayerPhys(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelLayerPhys(e,t,i,r)}onLayer(e,t,i,r,s){this._compilerHandler&&this._compilerHandler.onLayer(e,t,i,r,s)}onDelLayer(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDelLayer(e,t,i,r)}onCanvas(e,t,i,r){this._compilerHandler&&this._compilerHandler.onCanvas(e,t,i,r)}onDocDetail(e,t,i,r){this._compilerHandler&&this._compilerHandler.onDocDetail(e,t,i,r)}onStringNum(e,t){this._compilerHandler&&this._compilerHandler.onStringNum(e,t)}onAttrNum(e,t){this._compilerHandler&&this._compilerHandler.onAttrNum(e,t)}onDimensionNum(e,t){this._compilerHandler&&this._compilerHandler.onDimensionNum(e,t)}onBossNum(e,t){this._compilerHandler&&this._compilerHandler.onBossNum(e,t)}onShellEntityNum(e,t){this._compilerHandler&&this._compilerHandler.onShellEntityNum(e,t)}onShellCutNum(e,t){this._compilerHandler&&this._compilerHandler.onShellCutNum(e,t)}onCreaseNum(e,t){this._compilerHandler&&this._compilerHandler.onCreaseNum(e,t)}onShellNum(e,t){this._compilerHandler&&this._compilerHandler.onShellNum(e,t)}onFpcFillNum(e,t){this._compilerHandler&&this._compilerHandler.onFpcFillNum(e,t)}onTeardropNum(e,t){this._compilerHandler&&this._compilerHandler.onTeardropNum(e,t)}onImageNum(e,t){this._compilerHandler&&this._compilerHandler.onImageNum(e,t)}onPouredNum(e,t){this._compilerHandler&&this._compilerHandler.onPouredNum(e,t)}onPourNum(e,t){this._compilerHandler&&this._compilerHandler.onPourNum(e,t)}onRegionNum(e,t){this._compilerHandler&&this._compilerHandler.onRegionNum(e,t)}onFillNum(e,t){this._compilerHandler&&this._compilerHandler.onFillNum(e,t)}onPolyNum(e,t){this._compilerHandler&&this._compilerHandler.onPolyNum(e,t)}onObjNum(e,t){this._compilerHandler&&this._compilerHandler.onObjNum(e,t)}onArcNum(e,t){this._compilerHandler&&this._compilerHandler.onArcNum(e,t)}onCArcNum(e,t){this._compilerHandler&&this._compilerHandler.onCArcNum(e,t)}onLineNum(e,t){this._compilerHandler&&this._compilerHandler.onLineNum(e,t)}onPadNum(e,t){this._compilerHandler&&this._compilerHandler.onPadNum(e,t)}onViaNum(e,t){this._compilerHandler&&this._compilerHandler.onViaNum(e,t)}onPartitionNum(e,t){this._compilerHandler&&this._compilerHandler.onPartitionNum(e,t)}},qx=(e=>(e.CREATE="/pro-mgr/library/lib/create",e.UPDATE="/pro-mgr/library/lib/update",e.CANCEL_ASSOCIATE="/pro-mgr/library/lib/cancelAssociate",e.DELETE="/pro-mgr/library/lib/delete",e.BATCH_GET="/pro-mgr/library/lib/batchGet",e.GET="/pro-mgr/library/lib/get",e.GET1="/pro-mgr/library/lib/get1",e.CREATE1="/pro-mgr/library/lib/create1",e.UPDATE1="/pro-mgr/library/lib/update1",e.UPDATE_DEVICES="/pro-mgr/library/lib/updateDevices",e.STAR="/pro-mgr/library/lib/star",e.UNSTAR="/pro-mgr/library/lib/unstar",e.FORCE="/pro-mgr/library/lib/force",e.UPLOAD="/pro-mgr/library/lib/upload",e.DEVICE_LIST="/pro-mgr/library/lib/device/list",e.DEVICE_SEARCH_LIST="/pro-mgr/library/lib/device/searchList",e.DEVICE_SEARCH_BY_USERS_AND_TITLES="/pro-mgr/library/lib/device/searchByUsersAndTitles",e.DEVICE_GET_ATTR_VALUES="/pro-mgr/library/lib/device/getAttributeValues",e.DEVICE_GET_ATTR_KEYS="/pro-mgr/library/lib/device/getAttrKeys",e.COMPONENT_LIST="/pro-mgr/library/lib/component/list",e.COMPONENT_SEARCH_LIST="/pro-mgr/library/lib/component/searchList",e.COMPONENT_SEARCH_BY_USERS_AND_TITLES="/pro-mgr/library/lib/component/searchByUsersAndTitles",e))(qx||{}),Xx=(e=>(e.GET_DEVICE="/pro-mgr/library/sheetSymbol/getDevice",e.GET_SYMBOL="/pro-mgr/library/sheetSymbol/getSymbol",e.FORCE="/pro-mgr/library/sheetSymbol/force",e.GET="/pro-mgr/library/sheetSymbol/get",e.CREATE="/pro-mgr/library/sheetSymbol/create",e.UPDATE="/pro-mgr/library/sheetSymbol/update",e.SET_CUSTOM="/pro-mgr/library/sheetSymbol/setCustom",e))(Xx||{}),Nm={LIB:qx,SHEET_SYMBOL:Xx};async function Wx(e,t,i,r){let{message:s}=await Ge.messageBus.rpcCall(Nm.LIB.COMPONENT_SEARCH_LIST,{titles:JSON.stringify([e]),docType:[+t],type:i,user_uuid:r,path:r});return s&&s.success?s:{...s}}async function P4(e,t,i,r,s=!1){let n=await Wx(e,t,i,r);if(!n.success||n.result===null)return{isExist:!1,component:null};if(lm)return s===!0?{isExist:!1,component:null}:{isExist:n&&n.result?n.result.length>0:!1,component:n.result};let a=[];n&&n.success&&n.result&&(n.result instanceof Array?a=n.result:a=n.result[e]||[]);let o=a.filter(l=>l.owner.uuid==r);return{isExist:o.length>0,component:o||null}}function A4(e,t){let i=0;return function(...r){let s=new Date().getTime();s-i>t&&(e.apply(this,r),i=s)}}function C4(e,t,i){let r,s,n,a,o,l,h=0,c=!1,f=!1,d=!0;if(typeof e!="function")throw new TypeError("Expected a function");t=Number(t)||0,typeof i=="object"&&(c=!!i.leading,f="maxWait"in i,n=f?Math.max(Number(i.maxWait)||0,t):n,d="trailing"in i?!!i.trailing:d);function u(E){let w=r,S=s;return r=s=void 0,h=E,a=e.apply(S,w),a}function p(E){return h=E,o=window.setTimeout(b,t),c?u(E):a}function _(E){let w=E-l,S=E-h,C=t-w;return f?Math.min(C,n-S):C}function g(E){let w=E-l,S=E-h;return l===void 0||w>=t||w<0||f&&S>=n}function b(){let E=Date.now();if(g(E))return m(E);o=window.setTimeout(b,_(E))}function m(E){return o=void 0,d&&r?u(E):(r=s=void 0,a)}function O(){o!==void 0&&clearTimeout(o),h=0,r=l=s=o=void 0}function y(){return o===void 0?a:m(Date.now())}function x(){let E=Date.now(),w=g(E);if(r=arguments,s=this,l=E,w){if(o===void 0)return p(l);if(f)return o=window.setTimeout(b,t),u(l)}return o===void 0&&(o=window.setTimeout(b,t)),a}return x.cancel=O,x.flush=y,x}var Tl=new Map;Tl.set("<","&lt;"),Tl.set(">","&gt;"),Tl.set('"',"&quot;"),Tl.set("'","&apos;"),Tl.set("&","&amp;");function Jx(e){if(typeof e!="string")return e;if(e==null)return"";function t(i){return Tl.get(i)}return e==null?"":xp(e,Tl)?(e+"").replace(/[<>'"&]/g,t):e}var xl=new Map;xl.set("&lt;","<"),xl.set("&gt;",">"),xl.set("&quot;",'"'),xl.set("&apos;","'"),xl.set("&amp;","&"),xl.set("&#039;","'");function N4(e){if(typeof e!="string")return e;if(e==null)return"";let t={"&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&","&#039;":"'"};function i(r){return xl.get(r)}return xp(e,t)?(e+"").replace(/&([^;]+);/g,i):e}var bu=new Map;bu.set("~","&#126;"),bu.set("^","&#94;"),bu.set("#@$","&#35;&#64;&#36;"),bu.set("`","&#96;");function L4(e){if(typeof e!="string")return e;if(e==null)return"";let t={"~":"&#126;","^":"&#94;","#@$":"&#35;&#64;&#36;","`":"&#96;"};function i(r){return bu.get(r)}return xp(e,t)?e.replace(/(\~|\^|#@\$|\`)/g,i):e}function rm(e){if(typeof e!="object"||e===null||e===void 0)return e;if(Array.isArray(e))return e.map(rm);{let t={};for(let i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=rm(e[i]));return t}}function sm(e){if(typeof e!="object"||e===null||e instanceof Date)return typeof e=="string"&&e.includes("<")&&(e=Jx(e)),e;if(Array.isArray(e))return e.map(sm);{let t={};for(let i in e)e.hasOwnProperty(i)&&(t[i]=sm(e[i]));return t}}function R4(e,t){let i="",r="";for(let s=0;s<e.length;s++)String(e[s])&&(r+=e[s]+"	");r=r.slice(0,-1),i+=r+`\r
`;for(let s=0;s<t.length;s++){r="";for(let n=0;n<e.length;n++)r+='"'+(typeof t[s][n]<"u"?t[s][n]:"")+'"	';r=r.slice(0,r.length-1),i+=r+`\r
`}return i}function D4(e,t={targetType:"blob"}){let{targetType:i,width:r,height:s}=t,n=new Image(r,s);return new Promise((a,o)=>{n.onload=function(){let l=document.createElement("canvas"),h=l.getContext("2d");switch(l.width=n.width,l.height=n.height,h.drawImage(n,0,0,n.width,n.height),i){case"dataURL":{a(l.toDataURL());break}case"blob":default:{l.toBlob(c=>{a(c)});break}}},n.onerror=l=>{o(l)},n.src=e})}async function M4(e,t={}){return new Promise((i,r)=>{try{let{targetType:s="blob",imageType:n="image/png"}=t,a=document.createElement("canvas"),o=a.getContext("2d");switch(a.width=e.width,a.height=e.height,o.putImageData(e,0,0),s){case"dataURL":{i(a.toDataURL(n));break}case"blob":default:{a.toBlob(l=>{i(l)},n);break}}}catch(s){r(s)}})}var B4=class extends Cm{constructor(e){super(),this._action=e}get action(){return this._action}onAttr(e,t,i){i||this.action(t.key,t.value)}};async function k4(e,t,i,r=!0){let s={initResponse:null,d3modelItem:null,d3modelItemName:void 0,d3modelItemTransform:void 0,d3modelItemPath:void 0,d3modelItemId:void 0,compiler:null},n=new Map;return new Promise(async a=>{let o=new Vx(e,t,i);s.compiler=o,o.setHandler(new B4(async(l,h)=>{if(typeof h<"u"&&n.set(l,h),n.has("3D Model")&&n.has("3D Model Title")&&n.has("3D Model Transform")){s.d3modelItemId=n.get("3D Model"),s.d3modelItemName=n.get("3D Model Title"),s.d3modelItemTransform=n.get("3D Model Transform");let c=ju(s.d3modelItemId,!0);s.d3modelItemPath=c.path}})),s.initResponse=await o.init().catch(l=>({message:l.message,success:!1})),s.d3modelItemId&&r&&(s.d3modelItem=await Yu(s.d3modelItemId)),s.compiler.destroy(),n.clear(),a(s)})}async function U4(e,t){let i={padList:[]};return new Promise(async r=>{try{let s=new sD(e,t,!0),n=await s.getPads()||{},a=Object.keys(n);for(let o=0;o<a.length;o++)i.padList.push({...n[a[o]]});s.destroy(),r(i)}catch{r(i)}})}function F4(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);let r=[1,10,100,1e3][t]||Math.pow(10,t)||10;if(i){let s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),s+e}else return Math.round(e*r+1e-10)/r}function G4(e,t){typeof e=="string"&&(e=parseFloat(e));let i=Math.pow(10,t);return Math.round(e*i)/i}var z4={conversion(e,t,i){let r=e+2+t;return this[r](i)},conversion1(e,t,i){let r=e+2+t,s=this[r](i);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3},mil2mil(e){return e},mil2mm(e){return e*.0254},mil2cm(e){return e*.00254},mil2inch(e){return e/1e3},mm2mm(e){return e},mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t},mm2cm(e){return e/10},mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t},cm2mil(e){let t=Math.pow(10,6);return Math.round(e*3.937007874015748*t)/t},cm2mm(e){return e*10},cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t},inch2mil(e){return e*1e3},inch2mm(e){return e*25.4},inch2cm(e){return e*2.54}};function H4(e,t,i){var r=e-t;return i||(i=1e-10),(r>0?r:-r)<i}function j4(e){return e<0?(360+e%360)%360:e>=360?e%360:e}function Zx(e,t,i,r){var s=e-i,n=t-r;return s*s+n*n}function Y4(e,t,i,r){return Math.sqrt(Zx(e,t,i,r))}function V4(e,t,i,r){var s=i-e,n=r-t,a=Math.atan2(n,s);return a=a<0?a+Math.PI+Math.PI:a,a}function q4(e){return Kx(e)&&Object.keys(e).length===0}function Kx(e){return Object.prototype.toString.call(e).slice(8,-1)==="Object"}function X4(e){return $x(e)||Qx(e)}function $x(e){return Object.prototype.toString.call(e).slice(8,-1)==="AsyncFunction"}function Qx(e){return Object.prototype.toString.call(e).slice(8,-1)==="Function"}var Et,W4=(Et=class{},Et.unitConversion=z4,Et.ConcurrencyTaskQueue=S4,Et.FootprintCompilerInstance=Vx,Et.FootprintCompilerHandlerProxy=Cm,Et.FootprintCompilerAttr=I4,Et.createCSVString=R4,Et.svg2png=D4,Et.imageData2NewImage=M4,Et.htmlEncode=Jx,Et.htmlDecode=N4,Et.strEncode=L4,Et.isEmptyObj=q4,Et.isPlainObject=Kx,Et.isFn=X4,Et.isAsyncFunction=$x,Et.isNormalFunction=Qx,Et.formatDate=Bo,Et.formatDate2=_4,Et.deepClone=rm,Et.deepCloneWithHtmlEncode=sm,Et.naturalSortComparator=V2,Et.naturalSortSplitor=BO,Et.naturalSort=AP,Et.naturalStrSort=CP,Et.naturalSort1=NP,Et.naturalCompare=LP,Et.isObjKeyInStr=xp,Et.throttle=A4,Et.debounce=C4,Et.findList=fs,Et.findListAll=y4,Et.randomString=MP,Et.parseJSON=BP,Et.splitComponentId2FolderAndFilenameMixin=ju,Et.queryExistSameNameDocDetail=Wx,Et.checkComponentNameDuplicate=P4,Et.getFootprintPadInfo=U4,Et.getFootprint3DInfo=k4,Et),on,lX=(on=class{},on.toFixed=F4,on.toFixed1=G4,on.floatEqual=H4,on.fixAngle=j4,on.getDistance=Y4,on.getDistance2=Zx,on.getAngleByDot=V4,on),Lo,Or=(Lo=class{constructor(){this._changeCbs=new Set,this._map=new Map,this._debounceNotify=W4.debounce(()=>{this._notify()},50)}static get context(){return Ms()}static getInstance(){var t;return(t=this.context.extendLibManager)!=null?t:this.context.extendLibManager=new Lo}_notify(){for(let t of this._changeCbs)t()}onChange(t){this._changeCbs.add(t)}offChange(t){this._changeCbs.delete(t)}_getLibId(t){return`${Lo.LIB_ID_PREFFIX}${t}`}async addLibWithId(t){this._map.set(t.id,await w4.set(t)),this._debounceNotify()}async addLib(t){let i=this._getLibId(t.title);return await this.addLibWithId({...t,id:i}),i}deleteLib(t){return this._debounceNotify(),this._map.delete(t)}hasLib(t){return this._map.has(t)}getLib(t){return this._map.get(t)}getLibs(){return Array.from(this._map.values())}updateLibTitle(t,i){let r=this._map.get(t);r&&(r.title=i,this._debounceNotify())}updateLibPosition(t,i){let r=this._map.get(t);r&&(r.position=i,this._debounceNotify())}},Lo.LIB_ID_PREFFIX="extend_lib_",Lo),J4=0;async function Vu(e,t,i,r=!0,s,n){let a=null,o="requestid"+ ++J4;s&&s(o);let l={user_uuid:e,path:t,type:i};n&&n(l);try{if(Or.getInstance().hasLib(e))return await Z4(e,i,r);let c=await vt("GET","/api/categories",l,{headers:{path:t},searchParams:!0});if(c.success)return{...c,result:await Lm(c.result,r)}}catch(c){a=c,console.error("Fetch Category List Error",c)}let h=a?a.msg||a.message:void 0;return{code:a?a.code:nt.ERR_CODE.NORMAL,success:!1,result:null,msg:h||"Fetch Category List Error"}}async function Z4(e,t,i){var s;let r=[];for(let n of t){let a=await((s=Or.getInstance().getLib(e))==null?void 0:s.getCategoryTreeDataItemsByCategoryType(n));a&&r.push(a)}return{code:0,success:!0,result:await Lm(r.flat().map(n=>({uuid:n.id,parent_uuid:n.parentId,user_uuid:e,type:void 0,order_no:void 0,name_cn:void 0,name:n.title,created_at:n.created_at,updated_at:n.updated_at,title:n.title})),i)}}async function K4(e=!0){let t=null;try{let r=await vt("POST","/api/open/deviceCate");if(r.success)return{...r,result:await Lm(r.result,e)}}catch(r){t=r,console.error("Fetch Category List Error",r)}let i=t?t.msg||t.message:void 0;return{code:t?t.code:nt.ERR_CODE.NORMAL,success:!1,result:null,msg:i||"Fetch Category List Error"}}async function Lm(e,t=!0){let i=[],r=[],s=[],n={},a={};e.forEach(f=>{f.name&&(a[f.name]=f.name_cn||f.name)});let o=e.filter(f=>!f.parent_uuid),l=e.filter(f=>!!f.parent_uuid),h=[],c={};if(o.forEach((f,d)=>{h.push(f.uuid),s.push({name:f.name,name_cn:f.name_cn,title:f.name,titleAdditional:f.name_cn||f.name,disableTranslate:f.name_cn===""?!0:f.name_cn===f.name,id:f.uuid,children:[],order_no:+f.order_no||0,parentId:void 0,created_at:f.created_at,updated_at:f.updated_at}),n[f.uuid]=d}),l.forEach(f=>{h.push(f.uuid);let d=n[f.parent_uuid];if(typeof d<"u"&&s[d]){let u=s[d];u.children.push({name:f.name,name_cn:f.name_cn,title:f.name,titleAdditional:f.name_cn||f.name,disableTranslate:f.name_cn===""?!0:f.name_cn===f.name,id:f.uuid,order_no:+f.order_no||0,children:[],parentId:u.id,created_at:f.created_at,updated_at:f.updated_at})}c[f.uuid]=f.parent_uuid}),s.sort(G2("order_no")),s.forEach(f=>{f.children.length>1&&f.children.sort(G2("order_no"))}),s.forEach(f=>{i.push({...f})}),t){let f=(await Ge.messageBus.rpcCall("I18nTranslateService",{str:nt.CATEGORY_ITEM_ALL_TITLE})).message;i.unshift({title:nt.CATEGORY_ITEM_ALL_TITLE,titleAdditional:f||nt.CATEGORY_ITEM_ALL_TITLE,id:nt.CATEGORY_ITEM_ALL_VALUE,order_no:Number.MAX_SAFE_INTEGER,disableTranslate:!1,children:[],parentId:void 0}),r.push(nt.CATEGORY_ITEM_ALL_VALUE)}return{languageHashtable:a,treeData:i,selectedIds:r,categoryIds:h,childCategory2ParentCategoryMap:c,sourceCategoryList:e}}async function Il(e){let{categories:t,type:i,uuid:r}=e,s=await Vu(r,r,i),n=s.result?s.result.treeData:[],a=[],o=[],l=[],h=[];for(let p=0;p<t.length;p++){let{parentName:_,childName:g,parent_order_no:b,child_order_no:m}=t[p];if(_){let O=fs(n,"title",_);if(O.index>=0){if(a.push({name:O.data.title,type:i,user_uuid:r,order_no:O.data.order_no,parent_uuid:void 0,uuid:O.data.id}),g){let E=fs(O.data.children,"title",g);if(E.index>=0){o.push({name:E.data.title,type:i,user_uuid:r,order_no:E.data.order_no,parent_uuid:O.data.id,uuid:E.data.id});continue}h.push({name:g,type:i,user_uuid:r,order_no:p+1,parent_uuid:O.data.id,uuid:void 0});continue}continue}let y=Lu(),x=Lu();l.push({name:_,type:i,user_uuid:r,order_no:typeof b<"u"?b:p+1,parent_uuid:void 0,uuid:y}),g&&h.push({name:g,type:i,user_uuid:r,order_no:typeof m<"u"?m:p+1,parent_uuid:y,uuid:x})}}let c=[];if(l.length){let p=await Mh(l,(_,g)=>{l[g].__remoteId=_.result.uuid});c=p.result?p.result.successList.map(_=>_.result):[]}let f=[];if(h.length){for(let _=0;_<h.length;_++){let g=fs(l,"uuid",h[_].parent_uuid);g.index>=0&&g.data.__remoteId&&(h[_].parent_uuid=g.data.__remoteId)}let p=await Mh(h);f=p.result?p.result.successList.map(_=>_.result):[]}let d=c.concat(a),u=f.concat(o);return{allParentCreated:d,allChildCreated:u}}async function ev(e){let{uuid:t,path:i,types:r,names:s}=e;return new Promise(async(n,a)=>{let o=await Vu(t,i,r,!1);if(o.code!==0){n({...o,code:nt.ERR_CODE.NORMAL,success:!1,result:null});return}let l={detail:[],arguments:e},{treeData:h}=o.result;for(let c=0;c<s.length;c++){let f=s[c].primary,d=s[c].secondary,u={primary:{name:f,name_cn:"",uuid:"",exist:!1,undefine:!1},secondary:{name:d,name_cn:"",uuid:"",exist:!1,undefine:!1}};if(typeof f>"u"){u.primary.exist=!1,u.primary.undefine=!0;continue}let p=fs(h,"title",f);if(p.index<=-1){u.primary.exist=!1,u.secondary.exist=!1,l.detail.push(u);continue}if(u.primary.exist=!0,u.primary.uuid=p.data.id,u.primary.name_cn=p.data.titleAdditional||f,typeof d>"u"){u.secondary.exist=!1,u.secondary.undefine=!0,l.detail.push(u);continue}let _=fs(p.data.children,"title",d);if(_.index<=-1){u.secondary.exist=!1,l.detail.push(u);continue}u.secondary.exist=!0,u.secondary.uuid=_.data.id,u.secondary.name_cn=_.data.titleAdditional||d,l.detail.push(u)}n({code:0,success:!0,result:l})})}function $4(e){let t=new Map,i=[];for(let r of e)(!t.has(r.primary)||t.get(r.primary)!==r.secondary)&&(t.set(r.primary,r.secondary),i.push(r));return i}async function Q4(e,t,i,r=!1){let s=await ev(e),n=[],a=[],o=[],l=[],h=[];if(!r&&s.success&&s.result.detail.length){let f=new Map,d=new Map,u=new Map;s.result.detail.forEach((p,_)=>{(p.primary.name||p.primary.name_cn)&&!p.primary.exist&&!f.has(p.primary.name||p.primary.name_cn)&&(f.set(p.primary.name||p.primary.name_cn,!0),n.push({name:p.primary.name||p.primary.name_cn,type:t,user_uuid:i,order_no:0})),(p.primary.name||p.primary.name_cn)&&!p.primary.exist&&(p.secondary.name||p.secondary.name_cn)&&!p.secondary.exist&&d.get(p.secondary.name||p.secondary.name_cn)!==(p.primary.name||p.primary.name_cn)?(d.set(p.secondary.name||p.secondary.name_cn,p.primary.name||p.primary.name_cn),a.push({name:p.secondary.name||p.secondary.name_cn,type:t,user_uuid:i,uuid:p.secondary.uuid,order_no:0,parent_uuid:p.primary.uuid,parent_title:p.primary.name||p.primary.name_cn})):p.primary.exist&&(p.secondary.name||p.secondary.name_cn)&&!p.secondary.exist&&d.get(p.secondary.name||p.secondary.name_cn)!==(p.primary.name||p.primary.name_cn)&&(d.set(p.secondary.name||p.secondary.name_cn,p.primary.name||p.primary.name_cn),a.push({name:p.secondary.name||p.secondary.name_cn,type:t,user_uuid:i,uuid:p.secondary.uuid,order_no:0,parent_uuid:p.primary.uuid,parent_title:p.primary.name||p.primary.name_cn})),p.primary.exist&&!u.has(p.primary.uuid)&&(u.set(p.primary.uuid,p.primary.name||p.primary.name_cn),h.push({title:p.primary.name||p.primary.name_cn,uuid:p.primary.uuid,parent_uuid:""})),p.secondary.exist&&!u.has(p.secondary.uuid)&&(u.set(p.secondary.uuid,p.secondary.name||p.secondary.name_cn),h.push({title:p.secondary.name||p.secondary.name_cn,uuid:p.secondary.uuid,parent_uuid:p.primary.uuid}))})}if(!r&&n.length){let f=await Mh(n);if(f.success&&f.result.successList.length&&(o=f.result.successList.map(d=>d.result),a.forEach(d=>{o.forEach(u=>{!d.parent_uuid&&d.parent_title===u.name&&(d.parent_uuid=u.uuid)})})),a.length){let d=await Mh(a);d.success&&d.result.successList.length&&(l=d.result.successList.map(u=>u.result))}}else if(!r&&a.length){let f=await Mh(a);f.success&&f.result.successList.length&&(l=f.result.successList.map(d=>d.result))}let c=[];return c=o.map(f=>({uuid:f.uuid,title:f.name,name:f.name,parent_uuid:f.parent_uuid})),c=c.concat(l.map(f=>({uuid:f.uuid,parent_uuid:f.parent_uuid,title:f.name,name:f.name}))),c=c.concat(h),c}async function eM(e,t){let i=[],r=[],s=async o=>{let{message:l}=await Ge.messageBus.rpcCall(Ha.TAG.DELETE,o);return l},n=null;try{for(let o=0;o<e.length;o++){let l=await s({...e[o],path:e[o].user_uuid});if(l.code===0&&l.success){let c={...l,message:"",result:{...e[o],path:e[o].user_uuid,...l.result[0]}};i.push(c),t&&t(c,o);continue}let h={...l,result:{...e[o]}};r.push(h)}return{code:0,success:!0,result:{successList:i,failList:r},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Del Categories Batch Error";return{code:n?n.code:nt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}async function tM(e){let{uuid:t,path:i,types:r,ids:s}=e;return new Promise(async(n,a)=>{let o=await Vu(t,i,r,!1);if(o.code!==0){n({...o,code:nt.ERR_CODE.NORMAL,success:!1,result:null});return}let l={detail:[],arguments:e},{treeData:h}=o.result;for(let c=0;c<s.length;c++){let f=s[c].primary,d=s[c].secondary,u={primary:{name:"",name_cn:"string",uuid:f,exist:!1,undefine:!1},secondary:{name:"",name_cn:"string",uuid:d,exist:!1,undefine:!1}};if(typeof f>"u"){u.primary.exist=!1,u.primary.undefine=!0;continue}let p=fs(h,"id",f);if(p.index<=-1){u.primary.exist=!1,u.secondary.exist=!1,l.detail.push(u);continue}if(u.primary.exist=!0,u.primary.name=p.data.title,u.primary.name_cn=p.data.titleAdditional||u.primary.name,typeof d>"u"){u.secondary.exist=!1,u.secondary.undefine=!0;continue}let _=fs(p.data.children,"id",d);if(_.index<=-1){u.secondary.exist=!1,l.detail.push(u);continue}u.secondary.exist=!0,u.secondary.name=_.data.title,u.secondary.name_cn=_.data.titleAdditional||u.secondary.name,l.detail.push(u)}n({code:0,success:!0,result:l})})}var iM=class{constructor(){this._actuatorMap=new Map}clearAll(){this._actuatorMap.clear()}async addActuator(e,t,i,r){let s=e.filter(f=>!!f),n=`${s[0]}_${t[0]||0}_${i}_${r}`,a=`${s[0]}_${s[1]}_${t[1]||t[0]||0}_${i}_${r}`;if(!s[1]){if(this._actuatorMap.has(n))return this._actuatorMap.get(n);let f=new Promise(async(d,u)=>{let p=await Il({categories:[{parentName:s[0],parent_order_no:t[0]||0}],type:[r],uuid:i});d({uuids:p.allParentCreated.map(_=>_.uuid),titles:p.allParentCreated.map(_=>_.name)}),this._actuatorMap.delete(n)});return this._actuatorMap.set(n,f),f}let o=this._actuatorMap.get(n);o||(o=new Promise(async(f,d)=>{let u=await Il({categories:[{parentName:s[0],parent_order_no:t[0]||0}],type:[r],uuid:i});f({uuids:u.allParentCreated.map(p=>p.uuid),titles:u.allParentCreated.map(p=>p.name)}),this._actuatorMap.delete(n)}),this._actuatorMap.set(n,o));let l=await o,h=this._actuatorMap.get(a);h||(h=new Promise(async(f,d)=>{let u=await Il({categories:[{parentName:s[0],childName:s[1],parent_order_no:t[0]||0,child_order_no:t[1]||t[0]||0}],type:[r],uuid:i});f({uuids:u.allChildCreated.map(p=>p.uuid),titles:u.allChildCreated.map(p=>p.name)}),this._actuatorMap.delete(a)}),this._actuatorMap.set(a,h));let c=await h;return{uuids:[l.uuids[0],c.uuids[0]],titles:[l.titles[0],c.titles[0]]}}};async function rM(e,t){let i=[],r=[],s=async o=>{let{message:l}=await Ge.messageBus.rpcCall(Ha.TAG.UPDATE,o);return l},n=null;try{for(let o=0;o<e.length;o++){let l=await s({...e[o],path:e[o].user_uuid});if(l.code===0&&l.success){let c={...l,message:"",result:{...e[o],path:e[o].user_uuid,...l.result[0]}};i.push(c),t&&t(c,o);continue}let h={...l,result:{...e[o]}};r.push(h)}return{code:0,success:!0,result:{successList:i,failList:r},message:""}}catch(o){n=o}let a=n?n.msg||n.message:"Update Categories Batch Error";return{code:n?n.code:nt.ERR_CODE.NORMAL,success:!1,result:null,message:a}}var Kr,Bl=(Kr=class{},Kr.categoryAddtition=new iM,Kr.fetchCategoryList=Vu,Kr.fetchInternalCategoryList=K4,Kr.addCategoriesBatch=Mh,Kr.deleteCategoriesBatch=eM,Kr.updateCategoriesBatch=rM,Kr.addCategoriesBatchByNameArray=Il,Kr.queryCategoryBatchByNames=ev,Kr.queryCategoryBatchByIds=tM,Kr.formatRepeatCategoryArr=$4,Kr.bindAndCreateCategory=Q4,Kr.getCategoryNamesByTags=Uo,Kr);async function Uo(e,t,i){if(!e)return[];if(e instanceof Array)return e;let r=Ml(e);if(r=r.filter(h=>!!h),!r.length)return[];let s=(await Ge.messageBus.rpcCall("LocaleCurrFetch",{})).message||"en",n=await Vu(t,t,i),a=n.result?n.result.sourceCategoryList:[],o=typeof r[1]<"u",l=[];for(let h=0;h<a.length;h++)if(a[h].name===r[0]||a[h].name_cn===r[0]){l.push(s=="en"?a[h].name:a[h].name_cn||a[h].name);break}if(o){for(let h=0;h<a.length;h++)if(a[h].name===r[1]||a[h].name_cn===r[1]){l.push(s=="en"?a[h].name:a[h].name_cn||a[h].name);break}}return l}async function sM(e,t,i){let r=null,s=null,n=[],a=[],o=!1,l,h;if(e)if("data"in e)r=e.data,r.tags&&(r.tags instanceof Array?a=r.tags:a=Ml(r.tags));else{if(!e.uuid||!e.path)throw new Ae("PARAMETER_VERIFICATION","missing 3d-model uuid or path data.");l=e.uuid,h=e.path,s=await Si.getD3Model({isProject:e.isProject,uuid:e.uuid,path:e.path}),s&&(s.title=s.display_title,a=await Uo(s.tags,e.path,[5]))}if(!i){let c=await Bl.categoryAddtition.addActuator(a,[0],t,5);n=c.uuids,a=c.titles}return{d3modelItemOriginUuid:l,d3modelItemOriginPath:h,d3modelItemIn:r,d3modelItemOut:s,d3modelTagIds:n,d3modelTagTitles:a}}async function nM(e){let{d3modelItemIn:t,d3modelItemOut:i,d3modelTagIds:r,d3modelTagTitles:s}=await sM(e.d3model,e.path,e.isProject),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing 3d-model data.");m4(n.title),"path"in e.d3model&&e.d3model.override&&Is(n,e.d3model.override);let a=await vt("POST","/api/v2/components/add",JSON.stringify({...n,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let l=a.result,h=await An(l);return{title:l.title,description:l.description,path:l.path||e.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source,dataStrId:l.dataStrId,dataStr:h}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ae("CREATE_D3MODEL_DUP_TITLE",o):a.code===422?new Ae("CREATE_D3MODEL_PERMISSIONS",o):new Ae("CREATE_D3MODEL",o)}async function yp(e=!1,t,i,r,s,n){let a=t.toLocaleLowerCase(),o=n?!!n.forceAsSymbol:!1,l=[];try{if(o||r&&[2,18,19,20,21,22,25,31,7,32,6].indexOf(r)>=0){let h={isProject:e,path:i,titles:[a],docType:r};l=(await Si.getSymbolSearchList(h))[a]||[]}if(r===28){let h={isProject:e,path:i,titles:[a]};l=(await Si.getDeviceSearchList(h))[a]||[]}if(r===4){let h={isProject:e,path:i,titles:[a]};l=(await Si.getFootprintSearchList(h))[a]||[]}return r===16&&(l=(await Si.getD3ModelSearchList({isProject:e,uid:i,path:i,page:1,pageSize:void 0,wd:a})).lists),{code:0,success:!0,result:l,message:""}}catch(h){return console.error(h),{code:-1,success:!1,result:[],message:h instanceof Ae?`${String(h.action)}|${String(h.message)}`:h.message||"QueryComponentsByTitle call error."}}}function z2(e,t){return e.path==t}function H2(e){try{let t=JSON.parse(e);return{parentName:t[0],childName:t[1]}}catch{return{parentName:"",childName:""}}}function aM(e){let t={};return t["device-owner"]=e.userIdSelected,t["device-lib"]=e.userIdSelected,t["footprint-name"]=e.footprintItem?e.footprintItem.display_title:"",t["symbol-name"]=e.symbolItem?e.symbolItem.display_title:"",t["new-symbol"]=e.isNeedCreateSymbolAndAssocia,t}function tv(e,t){typeof e.footprintItemId<"u"&&(t.Footprint=e.footprintItemId),typeof e.symbolItemId<"u"&&(t.Symbol=e.symbolItemId)}async function iv(e,t){let i=aM(e),r=e.footprintItem,s=e.symbolItem,n={},a=async(O,y)=>{let x="",E="",w=!1,S=t==="zh-hans",C=O.parent_tag,R=O.child_tag;if(C&&C.uuid&&(w=!0,x=S&&C.name_cn||C.name),w&&R.uuid){let B=S&&R.name_cn||R.name;x+=`:${B}`}if(x){let B=x.split(":")[0],Y=x.split(":")[1],G=await Il({categories:Y?[{parentName:B,childName:Y}]:[{parentName:B}],type:[+y],uuid:i["device-owner"]}),z=G.allParentCreated[0]?G.allParentCreated[0].uuid:void 0,q=G.allChildCreated[0]?G.allChildCreated[0].uuid:void 0;z&&(E=q?[z,q]:[z])}return E},o={"file-owner":i["device-owner"],"file-name":i["footprint-name"],"file-describe":"","file-category":await a((r==null?void 0:r.tags)||{},4),"file-lib":i["device-lib"],"file-customTags":[]};if(r&&(r!=null&&r.custom_tags)&&!(o!=null&&o["file-category"])){let{parentName:O,childName:y}=H2(r.custom_tags);if(O){let x=await Il({categories:y?[{parentName:O,childName:y}]:[{parentName:O}],type:[4],uuid:i["device-owner"]}),E=x.allParentCreated[0]?x.allParentCreated[0].uuid:void 0,w=x.allChildCreated[0]?x.allChildCreated[0].uuid:void 0;E&&(o["file-customTags"]=w?[E,w]:[E])}}let l={"file-owner":i["device-owner"],"file-name":i["symbol-name"],"file-describe":"","file-category":await a((s==null?void 0:s.tags)||{},2),"file-lib":i["device-lib"],"file-customTags":[]};if(s&&(s!=null&&s.custom_tags)&&!l["file-category"]){let{parentName:O,childName:y}=H2(s.custom_tags);if(O){let x=await Il({categories:y?[{parentName:O,childName:y}]:[{parentName:O}],type:[4],uuid:i["device-owner"]}),E=x.allParentCreated[0]?x.allParentCreated[0].uuid:void 0,w=x.allChildCreated[0]?x.allChildCreated[0].uuid:void 0;E&&(l["file-customTags"]=w?[E,w]:[E])}}let h,c,f,d,u=!1,p=!1,_=!1;async function g(){if(i["footprint-name"])if(z2(r,i["device-owner"]||i["device-lib"]))f=r,h=null;else{let O=await yp(!1,o["file-name"],i["device-lib"],4);O.result.length<=0||(p=!0,f=r,h=O.result)}else f=null,h=null}async function b(){if(!i["new-symbol"]&&i["symbol-name"]&&s)if(z2(s,i["device-owner"]||i["device-lib"]))d=s,c=null;else{let O=await yp(!1,l["file-name"],i["device-lib"],s.docType);O.result.length<=0||(u=!0,c=O.result,d=s)}else d=null,c=null}await g(),await b();let m={isNeedConfirm:!1,updateCache:n,formData:i,newFootPrint:h,oldFootPrint:f,newSymbol:c,oldSymbol:d,confirmRes:e};return!u&&!p&&!_?(m.isNeedConfirm=!1,m):(m.isNeedConfirm=!0,m)}async function Rm(e,t,i,r){let s=null,n=null,a=[],o=[],l=!1,h,c;if(e)if("data"in e)e.data&&(s=e.data,s.tags&&(s.tags instanceof Array?o=s.tags:o=Ml(s.tags)));else{if(!e.uuid||!e.path)throw new Ae("PARAMETER_VERIFICATION","missing footprint uuid or path data.");h=e.uuid,c=e.path,n=await Si.getFootprint({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Uo(n.tags,e.path,[4]))}if(!i){let f=await Bl.categoryAddtition.addActuator(o,[0],t,4);a=f.uuids,o=f.titles}return{footprintItemOriginUuid:h,footprintItemOriginPath:c,footprintItemIn:s,footprintItemOut:n,footprintTagIds:a,footprintTagTitles:o}}async function Dm(e,t,i,r){let s=null,n=null,a=[],o=[],l=!1,h,c;if(e)if("data"in e)e.data&&(s=e.data,s.tags&&(s.tags instanceof Array?o=s.tags:o=Ml(s.tags)));else{if(!e.uuid||!e.path)throw new Ae("PARAMETER_VERIFICATION","missing symbol uuid or path data.");h=e.uuid,c=e.path,n=await Si.getSymbol({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Uo(n.tags,e.path,[2])),l=e.isProject}if(!i){let f=await Bl.categoryAddtition.addActuator(o,[0],t,2);a=f.uuids,o=f.titles}return{symbolItemOriginUuid:h,symbolItemOriginPath:c,symbolItemIn:s,symbolItemOut:n,symbolTagIds:a,symbolTagTitles:o}}async function rv(e,t,i,r){let s=null,n=null,a=[],o=[],l=!1;if(e)if("data"in e)e.data&&(s=e.data,s.tags&&(s.tags instanceof Array?o=s.tags:o=Ml(s.tags)));else{if(!e.uuid||!e.path)throw new Ae("PARAMETER_VERIFICATION","missing device uuid or path data.");n=await Si.getDevice({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Uo(n.tags,e.path,[3])),l=e.isProject}if(!i){let h=await Bl.categoryAddtition.addActuator(o,[0],t,3);a=h.uuids,o=h.titles}return{deviceItemIn:s,deviceItemOut:n,deviceTagIds:a,deviceTagTitles:o,isDeviceFromProject:l}}async function sv(e,t,i,r,s,n){let a=null,o=null,l=[],h=[],c,f;if(e){let{symbolItemIn:d,symbolItemOut:u,symbolTagIds:p,symbolTagTitles:_,symbolItemOriginUuid:g,symbolItemOriginPath:b}=await Dm(e,i,r,"path"in e&&e.override&&Array.isArray(e.override.tags)?e.override.tags:void 0);a=d,o=u,l=p,h=_,c=g,f=b}else if(s)if(n){let d=await Si.getSymbol({isProject:t,uuid:s,path:n});if(c=s,f=n,d){d.title=d.display_title,o=d,h=await Uo(d.tags,n,[2]);let u=await Bl.categoryAddtition.addActuator(h,[0],i,2);l=u.uuids,h=u.titles}}else{let d=null;try{d=await Si.getSymbol({isProject:t,uuid:s,path:i}),c=s,f=i}catch(u){d=null,c=s,f=i,console.warn(u)}d||console.warn("[NOSYMBOL_ON_TARGETPATH_BY_DEVICE_BOUND]: the symbol bound to this device does not exist in the target library.")}return{symbolItemOriginUuid:c,symbolItemOriginPath:f,symbolItemIn:a,symbolItemOut:o,symbolTagIds:l,symbolTagTitles:h}}async function nv(e,t,i,r,s,n){let a=null,o=null,l=[],h=[],c,f;if(e){let{footprintItemIn:d,footprintItemOut:u,footprintTagIds:p,footprintTagTitles:_,footprintItemOriginUuid:g,footprintItemOriginPath:b}=await Rm(e,i,r,"path"in e&&e.override&&Array.isArray(e.override.tags)?e.override.tags:void 0);a=d,o=u,l=p,h=_,c=g,f=b}else if(s)if(n){let d=await Si.getFootprint({isProject:t,uuid:s,path:n});if(c=s,f=n,d){d.title=d.display_title,o=d,h=await Uo(d.tags,n,[4]);let u=await Bl.categoryAddtition.addActuator(h,[0],i,4);l=u.uuids,h=u.titles}}else{let d=null;try{d=await Si.getFootprint({isProject:t,uuid:s,path:i}),c=s,f=i}catch(u){d=null,c=s,f=i,console.warn(u)}d||console.warn("[NOFOOTPRINT_ON_TARGETPATH_BY_DEVICE_BOUND]: the footprint bound to this device does not exist in the target library.")}return{footprintItemOriginUuid:c,footprintItemOriginPath:f,footprintItemIn:a,footprintItemOut:o,footprintTagIds:l,footprintTagTitles:h}}async function kl(e=!1,t,i,r,s=[]){let n={isDuplicate:!1,path:r,uuids:[]},a=i.toLocaleLowerCase(),o=await yp(e,a,r,t,Ge.loginedUserUuid);if(o.success&&o.result&&o.result.length){let l=[];for(let h=0;h<o.result.length;h++){if(s.indexOf(o.result[h].uuid)>=0)continue;let c=(o.result[h].title||o.result[h].display_title).toLocaleLowerCase();if(a===c&&o.result[h].path===r){if(typeof t>"u"||t===28){l.push(o.result[h]);continue}if(typeof o.result[h].docType>"u"){l.push(o.result[h]);continue}if(o.result[h].docType===t){l.push(o.result[h]);continue}}}for(let h=0;h<l.length;h++)n.uuids.push(l[h].uuid);n.isDuplicate=!!n.uuids.length}return n}async function av(e,t,i,r,s,n){if(!r)return;let a=null;if("data"in r)s.title&&(a=await Si.createSymbol({isProject:e,path:t,symbol:{data:{...s,tags:n},ignoreDuplicateNameCheck:r.ignoreDuplicateNameCheck}})),i.attributes&&a&&typeof a=="object"&&(i.attributes.Symbol=a.uuid);else{r.override&&Is(s,r.override);try{a=await Si.getSymbol({isProject:e,path:t,uuid:r.uuid})}catch{a=null}if(a&&typeof a=="object")i.attributes&&(i.attributes.Symbol=a.uuid);else if(s.title&&(a=await Si.createSymbol({isProject:e,path:t,symbol:{data:{...s,tags:n},ignoreDuplicateNameCheck:r.ignoreDuplicateNameCheck}})),i.attributes&&a&&typeof a=="object"){i.attributes.Symbol=a.uuid;let o=await ha({origin:{docType:s.docType,isProject:r.isProject,uuid:r.uuid,path:r.path},target:{docType:a.docType,isProject:e,uuid:a.uuid,path:a.path}});if(!o.success)throw new Ae("CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",o.message||"migrate canvas error.")}}}async function ov(e,t,i,r,s,n){if(!r)return;let a=null;if("data"in r)s.title&&(a=await Si.createFootprint({isProject:e,path:t,footprint:{data:{...s,tags:n}}})),i.attributes&&a&&typeof a=="object"&&(i.attributes.Footprint=a.uuid);else{r.override&&Is(s,r.override);try{a=await Si.getFootprint({isProject:e,path:t,uuid:r.uuid})}catch{a=null}if(a&&typeof a=="object")i.attributes&&(i.attributes.Footprint=a.uuid);else if(s.title&&(a=await Si.createFootprint({isProject:e,path:t,footprint:{data:{...s,tags:n}}})),i.attributes&&a&&typeof a=="object"){i.attributes.Footprint=a.uuid;let o=await ha({origin:{docType:s.docType,isProject:r.isProject,uuid:r.uuid,path:r.path},target:{docType:a.docType,isProject:e,uuid:a.uuid,path:a.path}});if(!o.success)throw new Ae("CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",o.message||"migrate canvas error.")}}}async function oM(e){let{deviceItemIn:t,deviceItemOut:i,deviceTagIds:r,deviceTagTitles:s,isDeviceFromProject:n}=await rv(e.device,e.path,e.isProject,"path"in e.device&&e.device.override&&Array.isArray(e.device.override.tags)?e.device.override.tags:void 0),a=t||i;if(!a)throw new Ae("PARAMETER_VERIFICATION","missing device data.");if(a.title=e.device&&"path"in e.device&&e.device.override&&Rp(e.device.override,"title")||a.title,Gx(a.title),(await kl(e.isProject,28,a.title,e.path)).isDuplicate)throw new Ae("DEVICE_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");let{symbolItemIn:o,symbolItemOut:l,symbolTagIds:h,symbolTagTitles:c,symbolItemOriginUuid:f,symbolItemOriginPath:d}=await sv(e.symbol,n,e.path,e.isProject,a.attributes?a.attributes.Symbol:void 0,"data"in e.device?void 0:e.device.path),u=o||l,p=!!(e.symbol&&"data"in e.symbol);a.attributes&&l&&typeof l=="object"&&(a.attributes.Symbol=l.uuid),e.symbol&&"path"in e.symbol&&e.symbol.override&&Is(u,e.symbol.override);let{footprintItemIn:_,footprintItemOut:g,footprintTagIds:b,footprintTagTitles:m,footprintItemOriginUuid:O,footprintItemOriginPath:y}=await nv(e.footprint,n,e.path,e.isProject,a.attributes?a.attributes.Footprint:void 0,"data"in e.device?void 0:e.device.path),x=_||g;e.footprint&&"path"in e.footprint&&e.footprint.override&&Is(x,e.footprint.override),a.attributes&&g&&typeof g=="object"&&(a.attributes.Footprint=g.uuid);let E=!1,w=!1,S=await iv({symbolItem:u,footprintItem:x,userIdSelected:e.path,isNeedCreateSymbolAndAssocia:p},void 0);if(S.isNeedConfirm){let B=(await Ge.messageBus.rpcCall("OpenSameNameSaveAsDlgService",{...S},31536e8)).message;if(!B){let Y="an exception occurred while executing the cross-bind program.";throw new Ae("CROSS_BIND",Y)}if(B.action==="cancel"||B.action==="close"){let Y="quit operate while executing the cross-bind program.";throw new Ae("CROSS_BIND_EXIT",Y)}S.updateCache=B.data,a.attributes&&Object.keys(S.updateCache).length&&(S.updateCache.symbolItemId&&(E=!0),S.updateCache.footprintItemId&&(w=!0),tv(S.updateCache,a.attributes))}!E&&u&&await av(e.isProject,e.path,a,e.symbol,u,c),!w&&x&&await ov(e.isProject,e.path,a,e.footprint,x,m),"path"in e.device&&e.device.override&&(delete e.device.override.tags,Is(a,e.device.override));let C=await vt("POST","/api/devices",{...a,tags:r,owner:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(C.code===0&&C.success){let B=C.result;return{path:B.path||e.path,title:B.title,description:B.description,attributes:B.attributes,images:B.images,uuid:B.uuid,version:B.version,ticket:B.ticket,updateTime:Ye(B.updateTime),createTime:Ye(B.createTime),display_title:B.display_title,creator:ci(B.creator),modifier:ui(B.modifier),owner:di(B.owner),tags:B.tags,source:B.source,symbol_type:B.symbol_type}}let R=C.message||C.msg||"Request Error.";throw C.code===1000001?new Ae("CREATE_DEVICE_DUP_TITLE",R):C.code===422?new Ae("CREATE_DEVICE_PERMISSIONS",R):new Ae("CREATE_DEVICE",R)}async function lM(e){let{footprintItemIn:t,footprintItemOut:i,footprintTagIds:r,footprintTagTitles:s}=await Rm(e.footprint,e.path,e.isProject,"path"in e.footprint&&e.footprint.override&&Array.isArray(e.footprint.override.tags)?e.footprint.override.tags:void 0),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing footprint data.");if(n.title="path"in e.footprint&&e.footprint.override&&Rp(e.footprint.override,"title")||n.title,Hx(n.title),(await kl(e.isProject,4,n.title,e.path)).isDuplicate)throw new Ae("FOOTPRINT_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.footprint&&e.footprint.override&&(delete e.footprint.override.tags,Is(n,e.footprint.override));let a=await vt("POST","/api/v2/components/add",{title:n.title,tags:r,docType:n.docType||4,description:n.description,owner:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let l=a.result;if(!("data"in e.footprint)&&e.footprint.uuid&&e.footprint.path){let h=await ha({origin:{docType:n.docType,isProject:!!e.footprint.isProject,uuid:e.footprint.uuid,path:e.footprint.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!h.success)throw new Ae("CREATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",h.message||"migrate canvas error.")}return{title:l.title,description:l.description,path:l.path||e.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ae("CREATE_FOOTPRINT_DUP_TITLE",o):a.code===422?new Ae("CREATE_FOOTPRINT_PERMISSIONS",o):new Ae("CREATE_FOOTPRINT",o)}async function lv(e,t,i,r){let s=null,n=null,a=[],o=[],l=!1,h,c;if(e)if("data"in e)s=e.data,s.tags&&(s.tags instanceof Array?o=s.tags:o=Ml(s.tags));else{if(!e.uuid||!e.path)throw new Ae("PARAMETER_VERIFICATION","missing simModel uuid or path data.");h=e.uuid,c=e.path,n=await Si.getSimModel({isProject:e.isProject,uuid:e.uuid,path:e.path}),n&&(n.title=n.display_title,r&&Array.isArray(r)?o=r:o=await Uo(n.tags,e.path,[6]))}if(!i){let f=await Bl.categoryAddtition.addActuator(o,[0],t,6);a=f.uuids,o=f.titles}return{simModelItemOriginUuid:h,simModelItemOriginPath:c,simModelItemIn:s,simModelItemOut:n,simModelTagIds:a,simModelTagTitles:o}}async function hM(e){let{simModelItemIn:t,simModelItemOut:i,simModelTagIds:r,simModelTagTitles:s}=await lv(e.simModel,e.path,e.isProject,"path"in e.simModel&&e.simModel.override&&Array.isArray(e.simModel.override.tags)?e.simModel.override.tags:void 0),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing sim-model data.");if(n.title="path"in e.simModel&&e.simModel.override&&Rp(e.simModel.override,"title")||n.title,jx(n.title),(await kl(e.isProject,n.docType,n.title,e.path)).isDuplicate)throw new Ae("SIM_MODEL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.simModel&&e.simModel.override&&(delete e.simModel.override.tags,Is(n,e.simModel.override));let a=await vt("POST","/api/v2/components/add",{...n,tags:r,owner:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let l=a.result;return{title:l.title,path:l.path||e.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source,dataStr:await An(l),key:l.key,iv:l.iv,dataStrId:l.dataStrId}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ae("CREATE_SIM_MODEL_DUP_TITLE",o):a.code===422?new Ae("CREATE_SIM_MODEL_PERMISSIONS",o):new Ae("CREATE_SIM_MODEL",o)}async function cM(e){let{symbolItemIn:t,symbolItemOut:i,symbolTagIds:r,symbolTagTitles:s}=await Dm(e.symbol,e.path,e.isProject,"path"in e.symbol&&e.symbol.override&&Array.isArray(e.symbol.override.tags)?e.symbol.override.tags:void 0),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing symbol data.");if(n.title="path"in e.symbol&&e.symbol.override&&Rp(e.symbol.override,"title")||n.title,zx(n.title),(await kl(e.isProject,n.docType,n.title,e.path)).isDuplicate)throw new Ae("SYMBOL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.symbol&&e.symbol.override&&(delete e.symbol.override.tags,Is(n,e.symbol.override));let a=await vt("POST","/api/v2/components/add",{title:n.title,tags:r,docType:n.docType,description:n.description,owner:e.path,ignoreDuplicateNameCheck:e.symbol.ignoreDuplicateNameCheck},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success){let l=a.result;if(!("data"in e.symbol)&&e.symbol.uuid&&e.symbol.path){let h=await ha({origin:{docType:n.docType,isProject:!!e.symbol.isProject,uuid:e.symbol.uuid,path:e.symbol.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!h.success)throw new Ae("CREATE_SYMBOL_MIGRATE_CANVAS_ERROR",h.message||"migrate canvas error.")}return{title:l.title,description:l.description,docType:l.docType,path:l.path||e.path,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===1000001?new Ae("CREATE_SYMBOL_DUP_TITLE",o):a.code===422?new Ae("CREATE_SYMBOL_PERMISSIONS",o):new Ae("CREATE_SYMBOL",o)}async function uM(e){let t=await vt("GET",`/api/v2/devices/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;if(typeof r.path<"u"&&r.path!==e.path)throw new Ae("GET_DEVICE_NOT_FOUND","data not found");return{path:r.path,title:r.title,description:r.description,attributes:r.attributes,images:r.images,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ye(r.updateTime),createTime:Ye(r.createTime),display_title:r.display_title,creator:ci(r.creator),modifier:ui(r.modifier),owner:di(r.owner),tags:r.tags,source:r.source,symbol_type:r.symbol_type,isFavorite:r.isFavorite}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_DEVICE",i)}async function dM(e){let t=await vt("GET",`/api/v2/components/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;if(typeof r.path<"u"&&r.path!==e.path)throw new Ae("GET_FOOTPRINT_NOT_FOUND","data not found");return{title:r.title,description:r.description,path:r.path,docType:r.docType,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ye(r.updateTime),createTime:Ye(r.createTime),display_title:r.display_title,creator:ci(r.creator),modifier:ui(r.modifier),owner:di(r.owner),tags:r.tags,source:r.source,has_device:r.has_device,history_uuid:r.history_uuid,key:r.key,iv:r.iv,dataStr:await An(r),dataStrId:r.dataStrId}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_FOOTPRINT",i)}async function fM(e){let t=await vt("GET",`/api/v2/components/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;return{title:r.title,path:r.path,docType:r.docType,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ye(r.updateTime),createTime:Ye(r.createTime),display_title:r.display_title,creator:ci(r.creator),modifier:ui(r.modifier),owner:di(r.owner),tags:r.tags,source:r.source,history_uuid:r.history_uuid,key:r.key,iv:r.iv,dataStr:await An(r),dataStrId:r.dataStrId}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_SIM_MODEL",i)}function ca(e={}){let t={},i=Object.keys(e);for(let r=0;r<i.length;r++)i[r]===""||String(i[r])==="undefined"||typeof e[i[r]]>"u"||e[i[r]]==null||(t[i[r]]=e[i[r]]);return t}async function pM(e){let t=await vt("GET","/api/v2/components",{...ca(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:e.docType,tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,s=[];for(let n of r.lists)s.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ye(n.updateTime),createTime:Ye(n.createTime),display_title:n.display_title,creator:ci(n.creator),modifier:ui(n.modifier),owner:di(n.owner),tags:n.tags,source:n.source,key:n.key,iv:n.iv,dataStr:await An(r),dataStrId:r.dataStrId});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:s}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_SIM_MODEL_LIST",i)}async function _M(e){let t=await vt("GET",`/api/v2/components/${e.uuid}`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result;if(typeof r.path<"u"&&r.path!==e.path)throw new Ae("GET_SYMBOL_NOT_FOUND","data not found");return{title:r.title,description:r.description,docType:r.docType,path:r.path,uuid:r.uuid,version:r.version,ticket:r.ticket,updateTime:Ye(r.updateTime),createTime:Ye(r.createTime),display_title:r.display_title,creator:ci(r.creator),modifier:ui(r.modifier),owner:di(r.owner),tags:r.tags,source:r.source,has_device:r.has_device,history_uuid:r.history_uuid,key:r.key,iv:r.iv,dataStr:await An(r),dataStrId:r.dataStrId}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_SYMBOL",i)}async function gM(e){let{deviceItemIn:t,deviceItemOut:i,deviceTagIds:r,deviceTagTitles:s,isDeviceFromProject:n}=await rv(e.device,e.path,e.isProject,"path"in e.device&&e.device.override&&Array.isArray(e.device.override.tags)?e.device.override.tags:void 0),a=t||i;if(!a)throw new Ae("PARAMETER_VERIFICATION","missing device data.");Gx(a.title);let{symbolItemIn:o,symbolItemOut:l,symbolTagIds:h,symbolTagTitles:c,symbolItemOriginUuid:f,symbolItemOriginPath:d}=await sv(e.symbol,n,e.path,e.isProject,a.attributes?a.attributes.Symbol:void 0,"data"in e.device?void 0:e.device.path),u=o||l,p=!!(e.symbol&&"data"in e.symbol);e.symbol&&"path"in e.symbol&&e.symbol.override&&Is(u,e.symbol.override),a.attributes&&l&&typeof l=="object"&&(a.attributes.Symbol=l.uuid);let{footprintItemIn:_,footprintItemOut:g,footprintTagIds:b,footprintTagTitles:m,footprintItemOriginUuid:O,footprintItemOriginPath:y}=await nv(e.footprint,n,e.path,e.isProject,a.attributes?a.attributes.Footprint:void 0,"data"in e.device?void 0:e.device.path),x=_||g;e.footprint&&"path"in e.footprint&&e.footprint.override&&Is(x,e.footprint.override),a.attributes&&g&&typeof g=="object"&&(a.attributes.Footprint=g.uuid);let E=!1,w=!1,S=await iv({symbolItem:u,footprintItem:x,userIdSelected:e.path,isNeedCreateSymbolAndAssocia:p},void 0);if(S.isNeedConfirm){let B=(await Ge.messageBus.rpcCall("OpenSameNameSaveAsDlgService",{...S},31536e8)).message;if(!B){let Y="an exception occurred while executing the cross-bind program.";throw new Ae("CROSS_BIND",Y)}if(B.action==="cancel"||B.action==="close"){let Y="quit operate while executing the cross-bind program.";throw new Ae("CROSS_BIND_EXIT",Y)}S.updateCache=B.data,a.attributes&&Object.keys(S.updateCache).length&&(S.updateCache.symbolItemId&&(E=!0),S.updateCache.footprintItemId&&(w=!0),tv(S.updateCache,a.attributes))}!E&&u&&await av(e.isProject,e.path,a,e.symbol,u,c),!w&&x&&await ov(e.isProject,e.path,a,e.footprint,x,m),"path"in e.device&&e.device.override&&(delete e.device.override.tags,Is(a,e.device.override));let C=await vt("POST",`/api/v2/devices/${e.uuid}`,JSON.stringify({...a,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(C.code===0&&C.success&&C.result){let B=C.result;return{path:B.path||e.path,title:B.title,description:B.description,attributes:B.attributes,images:B.images,uuid:B.uuid,version:B.version,ticket:B.ticket,updateTime:Ye(B.updateTime),createTime:Ye(B.createTime),display_title:B.display_title,creator:ci(B.creator),modifier:ui(B.modifier),owner:di(B.owner),tags:B.tags,source:B.source,symbol_type:B.symbol_type}}let R=C.message||C.msg||"Request Error.";throw C.code===422?new Ae("CREATE_DEVICE_PERMISSIONS",R):new Ae("UPDATE_DEVICE",R)}async function OM(e){let{footprintItemIn:t,footprintItemOut:i,footprintTagIds:r,footprintTagTitles:s}=await Rm(e.footprint,e.path,e.isProject,"path"in e.footprint&&e.footprint.override&&Array.isArray(e.footprint.override.tags)?e.footprint.override.tags:void 0),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing footprint data.");if(Hx(n.title),(await kl(e.isProject,4,n.title,e.path,[e.uuid])).isDuplicate)throw new Ae("FOOTPRINT_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.footprint&&e.footprint.override&&(delete e.footprint.override.tags,Is(n,e.footprint.override));let a=await vt("POST",`/api/v2/components/${e.uuid}/update`,JSON.stringify({title:n.title,tags:r,docType:n.docType||4,description:n.description,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success&&typeof a.result=="object"){let l=a.result;if(!("data"in e.footprint)&&e.footprint.uuid&&e.footprint.path){let h=await ha({origin:{docType:n.docType,isProject:!!e.footprint.isProject,uuid:e.footprint.uuid,path:e.footprint.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!h.success)throw new Ae("UPDATE_FOOTPRINT_MIGRATE_CANVAS_ERROR",h.message||"migrate canvas error.")}return{title:l.title,description:l.description,path:l.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Ae("UPDATE_FOOTPRINT_PERMISSIONS",o):new Ae("UPDATE_FOOTPRINT",o)}async function mM(e){let{simModelItemIn:t,simModelItemOut:i,simModelTagIds:r,simModelTagTitles:s}=await lv(e.simModel,e.path,e.isProject,"path"in e.simModel&&e.simModel.override&&Array.isArray(e.simModel.override.tags)?e.simModel.override.tags:void 0),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing simModel data.");jx(n.title),"path"in e.simModel&&e.simModel.override&&(delete e.simModel.override.tags,Is(n,e.simModel.override));let a=await vt("POST",`/api/v2/components/${e.uuid}/update`,JSON.stringify({...n,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!a.success){let l=a.message||a.msg||"Request Error.";throw new Ae("UPDATE_SIM_MODEL",l)}if(n.dataStr){let l=await vt("POST",`/api/v2/components/${e.uuid}/update_canvas`,JSON.stringify({...n,tags:r,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!l.success){let h=l.message||l.msg||"Request Error.";throw new Ae("UPDATE_SIM_MODEL",h)}}if(a.code===0&&a.success&&typeof a.result=="object"){let l=a.result;return{title:l.title,path:l.path,docType:l.docType,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source,dataStr:await An(l),key:l.key,iv:l.iv,dataStrId:l.dataStrId}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Ae("UPDATE_SIM_MODEL_PERMISSIONS",o):new Ae("UPDATE_SYMBOL",o)}async function yM(e){let{symbolItemIn:t,symbolItemOut:i,symbolTagIds:r,symbolTagTitles:s}=await Dm(e.symbol,e.path,e.isProject,"path"in e.symbol&&e.symbol.override&&Array.isArray(e.symbol.override.tags)?e.symbol.override.tags:void 0),n=t||i;if(!n)throw new Ae("PARAMETER_VERIFICATION","missing symbol data.");if(zx(n.title),(await kl(e.isProject,n.docType,n.title,e.path,[e.uuid])).isDuplicate)throw new Ae("SYMBOL_SAME_NAMA_EXISTS","{libName} duplicate name or illegal name: {componentName}");"path"in e.symbol&&e.symbol.override&&(delete e.symbol.override.tags,Is(n,e.symbol.override));let a=await vt("POST",`/api/v2/components/${e.uuid}/update`,JSON.stringify({title:n.title,tags:r,docType:n.docType,description:n.description,owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(a.code===0&&a.success&&typeof a.result=="object"){let l=a.result;if(!("data"in e.symbol)&&e.symbol.uuid&&e.symbol.path){let h=await ha({origin:{docType:n.docType,isProject:!!e.symbol.isProject,uuid:e.symbol.uuid,path:e.symbol.path},target:{docType:l.docType,isProject:!1,uuid:l.uuid,path:l.path}});if(!h.success)throw new Ae("UPDATE_SYMBOL_MIGRATE_CANVAS_ERROR",h.message||"migrate canvas error.")}return{title:l.title,description:l.description,docType:l.docType,path:l.path,uuid:l.uuid,version:l.version,ticket:l.ticket,updateTime:Ye(l.updateTime),createTime:Ye(l.createTime),display_title:l.display_title,creator:ci(l.creator),modifier:ui(l.modifier),owner:di(l.owner),tags:l.tags,source:l.source}}let o=a.message||a.msg||"Request Error.";throw a.code===422?new Ae("UPDATE_SYMBOL_PERMISSIONS",o):new Ae("UPDATE_SYMBOL",o)}async function bM(e){let t=await vt("GET","/api/v2/components",{...e.query||{},path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:[16],tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,s=[];for(let n of r.lists)s.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ye(n.updateTime),createTime:Ye(n.createTime),display_title:n.display_title,creator:ci(n.creator),modifier:ui(n.modifier),owner:di(n.owner),tags:n.tags,source:n.source,description:n.description,dataStr:await An(r),dataStrId:r.dataStrId});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:s}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_D3MODEL_LIST",i)}async function xM(e){let t=await vt("GET","/api/v2/components",{...ca(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:[4],tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,s=[];for(let n of r.lists)s.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ye(n.updateTime),createTime:Ye(n.createTime),display_title:n.display_title,creator:ci(n.creator),modifier:ui(n.modifier),owner:di(n.owner),tags:n.tags,source:n.source,description:n.description});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:s}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_FOOTPRINT_LIST",i)}async function vM(e){let t=await vt("GET","/api/v2/components",{...ca(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,docType:e.docType,tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,s=[];for(let n of r.lists)s.push({title:n.title,path:n.path||e.path,docType:n.docType,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ye(n.updateTime),createTime:Ye(n.createTime),display_title:n.display_title,creator:ci(n.creator),modifier:ui(n.modifier),owner:di(n.owner),tags:n.tags,source:n.source,description:n.description});return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:s}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_SYMBOL_LIST",i)}function EM(e){return Array.isArray(e)?e:e?[e]:[]}async function TM(e){let t=await vt("GET","/api/v2/devices",{...ca(e.query||{}),path:e.path,uid:e.uid,page:e.page,pageSize:e.pageSize,tag:e.tags||[]},{headers:{path:e.path},searchParams:!0});if(t.code===0&&t.success&&typeof t.result=="object"){let r=t.result,s=[];for(let n of r.lists){let a={title:n.title,path:n.path||e.path,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ye(n.updateTime),createTime:Ye(n.createTime),display_title:n.display_title,creator:ci(n.creator),modifier:ui(n.modifier),owner:di(n.owner),tags:n.tags,source:n.source,description:n.description,images:EM(n.images),attributes:n.attributes,symbol_type:n.symbol_type,isFavorite:n.isFavorite};e.withPackage&&n.symbol&&(a.symbol=Object.assign(n.symbol,{updateTime:Ye(n.symbol.updateTime)}),a.symbol_info=n.symbol_info),e.withPackage&&n.footprint&&(a.footprint=Object.assign(n.footprint,{updateTime:Ye(n.footprint.updateTime)}),a.footprint_info=n.footprint_info),s.push(a)}return{count:r.count,page:r.page,pageSize:r.pageSize,totalPage:r.totalPage,lists:s}}let i=t.message||t.msg||"Request Error.";throw new Ae("GET_DEVICE_LIST",i)}async function wM(e,t=!1,i=!1){if(e.titles){let{path:d,titles:u}=e,p=await vt("POST","/api/v2/devices/searchByUserUuidAndTitle",{type:"device",titles:u,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let m=p.result[b];for(let O of m){let y=di(O.owner),x={title:O.title,path:O.path||d,uuid:O.uuid,version:O.version,ticket:O.ticket,updateTime:Ye(O.updateTime),createTime:Ye(O.createTime),display_title:O.display_title,creator:t?{}:ci(O.creator),modifier:i?{}:ui(O.modifier),owner:y,tags:O.tags,source:O.source,description:O.description,images:O.images,attributes:O.attributes,symbol_type:O.symbol_type,isFavorite:O.isFavorite};e.withPackage&&O.symbol&&(x.symbol=Object.assign(O.symbol,{updateTime:Ye(O.symbol.updateTime)})),e.withPackage&&O.footprint&&(x.footprint=Object.assign(O.footprint,{updateTime:Ye(O.footprint.updateTime)})),g[b].push(x)}}return g}let _=p.message||p.msg||"Request Error.";throw new Ae("GET_DEVICE_SEARCH_LIST",_)}let{path:r,query:s={},uid:n,page:a,pageSize:o,tags:l=[],wd:h}=e,c=await vt("POST","/api/devices/search",{...ca(s),path:r,uid:n,page:a,pageSize:o,tag:l,wd:h},{headers:{path:r},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let d=c.result,u=[],p=Object.keys(d.lists);for(let _=0;_<p.length;_++){let g=d.lists[p[_]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let m=g[b],O={title:m.title,path:m.path||r,uuid:m.uuid,version:m.version,ticket:m.ticket,updateTime:Ye(m.updateTime),createTime:Ye(m.createTime),display_title:m.display_title,creator:t?{}:ci(m.creator),modifier:i?{}:ui(m.modifier),owner:di(m.owner),tags:m.tags,source:m.source,description:m.description,images:m.images,attributes:m.attributes,symbol_type:m.symbol_type,isFavorite:m.isFavorite};e.withPackage&&m.symbol&&(O.symbol=Object.assign(m.symbol,{updateTime:m.symbol.updateTime}),O.symbol_info=m.symbol_info),e.withPackage&&m.footprint&&(O.footprint=Object.assign(m.footprint,{updateTime:m.footprint.updateTime}),O.footprint_info=m.footprint_info),u.push(O)}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:u,facets:d.facets}}let f=c.message||c.msg||"Request Error.";throw new Ae("GET_DEVICE_SEARCH_LIST",f)}async function SM(e,t=!1,i=!1){if(e.titles){let{path:u,titles:p,docType:_}=e,g=await vt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:_,titles:p,user_uuids:[u],path:u},{headers:{"Content-type":"application/json","content-type":"application/json",path:u}});if(g.code===0&&g.success&&g.result){let m={};for(let O in g.result){m[O]=[];let y=g.result[O];for(let x of y){let E=di(x.owner),w={title:x.title,path:x.path||u,docType:x.docType,uuid:x.uuid,version:x.version,ticket:x.ticket,updateTime:Ye(x.updateTime),createTime:Ye(x.createTime),display_title:x.display_title,creator:t?{}:ci(x.creator),modifier:i?{}:ui(x.modifier),owner:E,tags:x.tags,source:x.source,description:x.description};m[O].push(w)}}return m}let b=g.message||g.msg||"Request Error.";throw new Ae("GET_SYMBOL_SEARCH_LIST",b)}let{path:r,query:s,uid:n,page:a,pageSize:o,tags:l=[],wd:h,docType:c}=e,f=await vt("POST","/api/v2/components/search",{...ca(s||{}),path:r,uid:n,page:a,pageSize:o,docType:c,tag:l,wd:h},{headers:{path:r},searchParams:!0});if(f.code===0&&f.success&&typeof f.result=="object"){let u=f.result,p=[],_=Object.keys(u.lists);for(let g=0;g<_.length;g++){let b=u.lists[_[g]];if(Array.isArray(b)&&b.length)for(let m=0;m<b.length;m++){let O=b[m];p.push({title:O.title,path:O.path||r,docType:O.docType,uuid:O.uuid,version:O.version,ticket:O.ticket,updateTime:Ye(O.updateTime),createTime:Ye(O.createTime),display_title:O.display_title,creator:t?{}:ci(O.creator),modifier:i?{}:ui(O.modifier),owner:di(O.owner),tags:O.tags,source:O.source,description:O.description})}}return{count:u.count,page:u.page,pageSize:u.pageSize,totalPage:u.totalPage,lists:p,facets:u.facets}}let d=f.message||f.msg||"Request Error.";throw new Ae("GET_SYMBOL_SEARCH_LIST",d)}async function IM(e,t=!1,i=!1){if(e.titles){let{path:d,titles:u}=e,p=await vt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:4,titles:u,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let m=p.result[b];for(let O of m){let y=di(O.owner),x={title:O.title,path:O.path||d,docType:O.docType,uuid:O.uuid,version:O.version,ticket:O.ticket,updateTime:Ye(O.updateTime),createTime:Ye(O.createTime),display_title:O.display_title,creator:t?{}:ci(O.creator),modifier:i?{}:ui(O.modifier),owner:y,tags:O.tags,source:O.source,description:O.description};g[b].push(x)}}return g}let _=p.message||p.msg||"Request Error.";throw new Ae("GET_FOOTPRINT_SEARCH_LIST",_)}let{path:r,query:s={},uid:n,page:a,pageSize:o,tags:l=[],wd:h}=e,c=await vt("POST","/api/v2/components/search",{...ca(s),path:r,uid:n,page:a,pageSize:o,docType:[4],tag:l,wd:h},{headers:{path:r},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let d=c.result,u=[],p=Object.keys(d.lists);for(let _=0;_<p.length;_++){let g=d.lists[p[_]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let m=g[b];u.push({title:m.title,path:m.path||r,docType:m.docType,uuid:m.uuid,version:m.version,ticket:m.ticket,updateTime:Ye(m.updateTime),createTime:Ye(m.createTime),display_title:m.display_title,creator:t?{}:ci(m.creator),modifier:i?{}:ui(m.modifier),owner:di(m.owner),tags:m.tags,source:m.source,description:m.description})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:u,facets:d.facets}}let f=c.message||c.msg||"Request Error.";throw new Ae("GET_FOOTPRINT_SEARCH_LIST",f)}async function PM(e,t=!1,i=!1){if(e.titles){let{path:u,docType:p,titles:_}=e,g=await vt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:p,titles:_,user_uuids:[u],path:u},{headers:{"Content-type":"application/json","content-type":"application/json",path:u}});if(g.code===0&&g.success&&g.result){let m={};for(let O in g.result){m[O]=[];let y=g.result[O];for(let x of y){let E=di(x.owner),w={title:x.title,path:x.path||u,docType:x.docType,uuid:x.uuid,version:x.version,ticket:x.ticket,updateTime:Ye(x.updateTime),createTime:Ye(x.createTime),display_title:x.display_title,creator:t?{}:ci(x.creator),modifier:i?{}:ui(x.modifier),owner:E,tags:x.tags,source:x.source,key:x.key,iv:x.iv,dataStr:void 0,dataStrId:x.dataStrId};y.push(w)}}return m}let b=g.message||g.msg||"Request Error.";throw new Ae("GET_SIM_MODEL_SEARCH_LIST",b)}let{path:r,query:s={},uid:n,page:a,pageSize:o,docType:l,tags:h=[],wd:c}=e,f=await vt("POST","/api/v2/components/search",{...ca(s),path:r,uid:n,page:a,pageSize:o,docType:l,tag:h,wd:c},{headers:{path:r},searchParams:!0});if(f.code===0&&f.success&&typeof f.result=="object"){let u=f.result,p=[],_=Object.keys(u.lists);for(let g=0;g<_.length;g++){let b=u.lists[_[g]];if(Array.isArray(b)&&b.length)for(let m=0;m<b.length;m++){let O=b[m];p.push({title:O.title,path:O.path||r,docType:O.docType,uuid:O.uuid,version:O.version,ticket:O.ticket,updateTime:Ye(O.updateTime),createTime:Ye(O.createTime),display_title:O.display_title,creator:t?{}:ci(O.creator),modifier:i?{}:ui(O.modifier),owner:di(O.owner),tags:O.tags,source:O.source,key:O.key,iv:O.iv,dataStr:await An(u),dataStrId:u.dataStrId})}}return{count:u.count,page:u.page,pageSize:u.pageSize,totalPage:u.totalPage,lists:p,facets:u.facets}}let d=f.message||f.msg||"Request Error.";throw new Ae("GET_SIM_MODEL_SEARCH_LIST",d)}async function AM(e){if(e.attributes.Symbol){let n=await Si.getSymbol({isProject:e.isProject,uuid:e.attributes.Symbol,path:e.path})}if(e.attributes.Footprint){let n=await Si.getFootprint({isProject:e.isProject,uuid:e.attributes.Footprint,path:e.path})}let t=await Si.getDevice({isProject:e.isProject,uuid:e.uuid,path:e.path}),i=Object.keys(e.attributes||{});for(let n=0;n<i.length;n++)t.attributes[i[n]]=e.attributes[i[n]];let r=await vt("POST",`/api/v2/devices/${e.uuid}`,JSON.stringify({...t,title:t.display_title||t.title,tags:t.tags?Ux(t.tags):[],owner:e.path}),{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(r.code===0&&r.success&&r.result){let n=r.result;return{path:n.path||e.path,title:n.title,description:n.description,attributes:n.attributes,images:n.images,uuid:n.uuid,version:n.version,ticket:n.ticket,updateTime:Ye(n.updateTime),createTime:Ye(n.createTime),display_title:n.display_title,creator:ci(n.creator),modifier:ui(n.modifier),owner:di(n.owner),tags:n.tags,source:n.source,symbol_type:n.symbol_type}}let s=r.message||r.msg||"Request Error.";throw r.code===422?new Ae("CREATE_DEVICE_PERMISSIONS",s):new Ae("UPDATE_DEVICE_ATTRIBUTES",s)}async function CM(e,t=!1,i=!1){if(e.titles){let{path:d,titles:u}=e;if(lm){let p=await vt("POST","/api/client/model/find",{titles:u},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let m=p.result[b];for(let O of m){let y={fileName:O.fileName,path:O.path,lib:O.lib};g[b].push(y)}}return g}let _=p.message||p.msg||"Request Error.";throw new Ae("GET_D3MODEL_SEARCH_LIST",_)}else{let p=await vt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:16,titles:u,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let m=p.result[b];for(let O of m){let y=di(O.owner),x={title:O.title,path:O.path||d,docType:O.docType,uuid:O.uuid,version:O.version,ticket:O.ticket,updateTime:Ye(O.updateTime),createTime:Ye(O.createTime),display_title:O.display_title,creator:t?{}:ci(O.creator),modifier:i?{}:ui(O.modifier),owner:y,tags:O.tags,source:O.source,description:O.description,dataStr:O.dataStr};g[b].push(x)}}return g}let _=p.message||p.msg||"Request Error.";throw new Ae("GET_D3MODEL_SEARCH_LIST",_)}}let{path:r,query:s={},uid:n,page:a,pageSize:o,tags:l=[],wd:h}=e,c=await vt("POST","/api/v2/components/search",{...ca(s),path:r,uid:n,page:a,pageSize:o,docType:[16],tag:l,wd:h},{headers:{path:r},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let d=c.result,u=[],p=Object.keys(d.lists);for(let _=0;_<p.length;_++){let g=d.lists[p[_]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let m=g[b];u.push({title:m.title,path:m.path||r,docType:m.docType,uuid:m.uuid,version:m.version,ticket:m.ticket,updateTime:Ye(m.updateTime),createTime:Ye(m.createTime),display_title:m.display_title,creator:t?{}:ci(m.creator),modifier:i?{}:ui(m.modifier),owner:di(m.owner),tags:m.tags,source:m.source,description:m.description,dataStr:m.dataStr})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:u,facets:d.facets}}let f=c.message||c.msg||"Request Error.";throw new Ae("GET_D3MODEL_SEARCH_LIST",f)}async function NM(e,t=!1,i=!1){if(e.titles){let{path:d,titles:u}=e,p=await vt("POST","/api/v2/components/searchByUserUuidAndTitle",{docType:29,titles:u,user_uuids:[d],path:d},{headers:{"Content-type":"application/json","content-type":"application/json",path:d}});if(p.code===0&&p.success&&p.result){let g={};for(let b in p.result){g[b]=[];let m=p.result[b];for(let O of m){let y=di(O.owner),x={title:O.title,path:O.path||d,docType:O.docType,uuid:O.uuid,version:O.version,ticket:O.ticket,updateTime:Ye(O.updateTime),createTime:Ye(O.createTime),display_title:O.display_title,creator:t?{}:ci(O.creator),modifier:i?{}:ui(O.modifier),owner:y,tags:O.tags,source:O.source,description:O.description};g[b].push(x)}}return g}let _=p.message||p.msg||"Request Error.";throw new Ae("GET_PANEL_LIB_SEARCH_LIST",_)}let{path:r,query:s={},uid:n,page:a,pageSize:o,tags:l=[],wd:h}=e,c=await vt("POST","/api/v2/components/search",{...ca(s),path:r,uid:n,page:a,pageSize:o,docType:[29],tag:l,wd:h},{headers:{path:r},searchParams:!0});if(c.code===0&&c.success&&typeof c.result=="object"){let d=c.result,u=[],p=Object.keys(d.lists);for(let _=0;_<p.length;_++){let g=d.lists[p[_]];if(Array.isArray(g)&&g.length)for(let b=0;b<g.length;b++){let m=g[b];u.push({title:m.title,path:m.path||r,docType:m.docType,uuid:m.uuid,version:m.version,ticket:m.ticket,updateTime:Ye(m.updateTime),createTime:Ye(m.createTime),display_title:m.display_title,creator:t?{}:ci(m.creator),modifier:i?{}:ui(m.modifier),owner:di(m.owner),tags:m.tags,source:m.source,description:m.description})}}return{count:d.count,page:d.page,pageSize:d.pageSize,totalPage:d.totalPage,lists:u,facets:d.facets}}let f=c.message||c.msg||"Request Error.";throw new Ae("GET_PANEL_LIB_SEARCH_LIST",f)}var LM=class extends Am{async getDevice(e){return await uM(e)}async getSymbol(e){return await _M(e)}async getFootprint(e){return await dM(e)}async getD3Model(e){return await Yu(e.uuid,e.path)}async getSimModel(e){return await fM(e)}async getDeviceList(e){return await TM(e)}async getSymbolList(e){return await vM(e)}async getFootprintList(e){return await xM(e)}async getD3ModelList(e){return await bM(e)}async getSimModelList(e){return pM(e)}async getDeviceSearchList(e){return await wM(e,!0,!0)}async getSymbolSearchList(e){return await SM(e,!0,!0)}async getFootprintSearchList(e){return await IM(e,!0,!0)}async getPanelLibSearchList(e){return await NM(e,!0,!0)}async getD3ModelSearchList(e){return await CM(e,!0,!0)}async getSimModelSearchList(e){return PM(e,!0,!0)}async createDevice(e){return await oM(e)}async createSymbol(e){return await cM(e)}async createFootprint(e){return await lM(e)}async createD3Model(e){return await nM(e)}async createSimModel(e){return await hM(e)}async updateDevice(e){return await gM(e)}async updateDeviceAttributes(e){return await AM(e)}async updateSymbol(e){return await yM(e)}async updateFootprint(e){return await OM(e)}async updatesimModel(e){return await mM(e)}async deleteDevice(e){let t=await vt("POST",`/api/v4/devices/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let i=t.message||t.msg||"Request Error.";throw new Ae("DELETE_DEVICE",i)}}async deleteSymbol(e){let t=await vt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let i=t.message||t.msg||"Request Error.";throw new Ae("DELETE_SYMBOL",i)}}async deleteFootprint(e){let t=await vt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let i=t.message||t.msg||"Request Error.";throw new Ae("DELETE_FOOTPRINT",i)}}async deleteSimModel(e){let t=await vt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let i=t.message||t.msg||"Request Error.";throw new Ae("DELETE_SIM_MODEL",i)}}async delete3DModel(e){let t=await vt("POST",`/api/v4/components/${e.uuid}/delete`,{uuid:e.uuid,path:e.path},{headers:{"Content-type":"application/json","content-type":"application/json",path:e.path}});if(!(t.code===0&&t.success)){let i=t.message||t.msg||"Request Error.";throw new Ae("DELETE_3DMODEL",i)}}},Ya=class{static diffVersionDevice(e){Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["Devices have not been added to the project library, project library has devices with different versions from the same source :",e.join("\u3001")]})}static diffVersionSymbol(e){Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["Symbols have not been added to the project library, project library has symbols with different versions from the same source :",e.join("\u3001")]})}static diffVersionFootprint(e){Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["Footprints have not been added to the project library, project library has footprints with different versions from the same source :",e.join("\u3001")]})}static sameVersionDevice(e){Ge.messageBus.publish("logI18nLogView",{type:"info",msg:["Devices have not been added to the project library, project library has devices with same versions from the same source :",e.join("\u3001")]})}static sameVersionSymbol(e){Ge.messageBus.publish("logI18nLogView",{type:"info",msg:["Symbols have not been added to the project library, project library has symbols with same versions from the same source :",e.join("\u3001")]})}static sameVersionFootprint(e){Ge.messageBus.publish("logI18nLogView",{type:"info",msg:["Footprints have not been added to the project library, project library has footprints with same versions from the same source :",e.join("\u3001")]})}static renamedDevice(e){Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["Devices are automatically renamed when they are added to the project library :",e.join("\u3001")]})}static renamedSymbol(e){Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["Symbols are automatically renamed when they are added to the project library :",e.join("\u3001")]})}static renamedFootprint(e){Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["Footprints are automatically renamed when they are added to the project library :",e.join("\u3001")]})}},RM=class{constructor(e){let{renameKey:t=!0}=e;this.renameKey=t}async rename(e,...t){let{message:i}=await Ge.messageBus.rpcCall("allowDuplicateNames");return this.renameKey||!i?this.renaming(e,...t):i?{success:!0}:this.isRename(e,...t)}},DM=class extends RM{constructor(e){let{matchKey:t=!0,byUUID:i=!1,byVersion:r=!1,bySource:s=!1}=e;super(e),this.matchKey=t,this.byUUID=i,this.byVersion=r,this.bySource=s}async match(e){if(this.matchKey)return this.matching(e)}},Mm=class extends DM{constructor(e){let{path:t,data:i}=e;super(e),this.origin={},this.path=t,this.data=i}async onAdd(e){let t=JSON.parse(JSON.stringify(e));return t.path||(t.path=this.path),await vD({data:t}),RO(t),t.project_uuid=t.path=this.path,t}async onUpdate(e){let t=JSON.parse(JSON.stringify(e));return RO(t),t}async getTemplate(e,t={}){let{uuid:i,path:r,updateTime:s}=e,n=`${i}${zh}${r}`,a=s==null?void 0:s.toString(),o=Object.assign(e,{path:r,source:n,version:a},t);return RO(o),o}},hv=class extends Mm{async getOrigin(){var r,s;let{path:e,uuid:t,isProject:i}=this.data;if(Hh(this.data)){let{override:n}=this.data;if(n&&n.attributes)return{success:!1,message:"Api call error!"};if(i){let{message:a}=await Ge.messageBus.rpcCall("/pro-mgr/hasProject",[e]);if(a){let o=[t,e],l=(await Ge.messageBus.rpcCall(at.DEVICE.GET,o)).message;if(l){let h=Object.assign(l,{uuid:t,path:e});this.origin=await this.getTemplate(h,n)}else return{success:!1,message:"Device details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(Or.getInstance().hasLib(e)){let a=await((s=(r=Or.getInstance().getLib(e))==null?void 0:r.device)==null?void 0:s.getTransformedDetail(t));if(a){let o=Object.assign(a,{uuid:t,path:e});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Device details data does not exist"}}else{let a={path:e,uuid:t},{message:o}=await Ge.messageBus.rpcCall(Ha.DEVICE.GET,a);if(o.success){let l=o.result,h=Object.assign(l,{uuid:t,path:e});this.origin=await this.getTemplate(h,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(e){let t=e.display_title||e.title,i=[t,this.path],r=(await Ge.messageBus.rpcCall(at.DEVICE.TRY_RENAME,i)).message;return r&&(e.display_title=e.title=r),t!==r&&Ya.renamedDevice([t]),{success:!0}}},MM=class extends hv{onHandle(e){return this.onAdd(e)}async matching(e){if(this.byUUID){let t=[e.uuid,this.path],i=await(await Ge.messageBus.rpcCall(at.DEVICE.GET,t)).message;if(e.ticket&&(i!=null&&i.ticket)&&(i==null?void 0:i.ticket)===e.ticket)return i}if(e.source){if(this.byVersion){let t=[e.source,e.version,this.path],i=(await Ge.messageBus.rpcCall(at.DEVICE.GET_BY_SOURCE_VERSION,t)).message;if(i)return Ya.sameVersionDevice([e.display_title||e.title]),i}if(this.bySource){let t=[e.source,this.path],i=(await Ge.messageBus.rpcCall(at.DEVICE.GET_LAST,t)).message;if(i)return Ya.diffVersionDevice([e.display_title||e.title]),i}}}async isRename(e){let t=[e.display_title||e.title,this.path];return(await Ge.messageBus.rpcCall(at.DEVICE.IS_RENAME,t)).message?{success:!1,message:"Device duplicate name"}:{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};let t,i;if(this.origin){let r=await this.match(this.origin);if(r)t={success:!0,result:r};else{let s=await this.rename(this.origin);if(!s.success)return{success:!1,code:s.code,message:s.message};i=this.origin}}return{success:!0,result:{respond:t,addData:i}}}},cv=class extends Mm{async getOrigin(){var r,s;let{path:e,uuid:t,isProject:i}=this.data;if(Hh(this.data)){let{override:n}=this.data;if(i){let{message:a}=await Ge.messageBus.rpcCall("/pro-mgr/hasProject",[e]);if(a){let o=[t,e],l=(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET,o)).message;if(l){let h=Object.assign(l,{uuid:t,path:e});this.origin=await this.getTemplate(h,n)}else return{success:!1,message:"Footprint details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(Or.getInstance().hasLib(e)){let a=await((s=(r=Or.getInstance().getLib(e))==null?void 0:r.footprint)==null?void 0:s.getTransformedDetail(t));if(a){let o=Object.assign(a,{uuid:t,path:e});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Footprint details data does not exist"}}else{let a={path:e,uuid:t},{message:o}=await Ge.messageBus.rpcCall(Ha.COMPONENT.GET,a);if(o.success){let l=o.result,h=Object.assign(l,{uuid:t,path:e});this.origin=await this.getTemplate(h,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(e){let t=e.display_title||e.title,i=[t,this.path],r=(await Ge.messageBus.rpcCall(at.FOOTPRINT.TRY_RENAME,i)).message;return r&&(e.display_title=e.title=r),t!==r&&Ya.renamedFootprint([t]),{success:!0}}},Bm=class extends cv{onHandle(e){return this.onAdd(e)}async matching(e){if(this.byUUID){let t=[e.uuid,this.path],i=(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET,t)).message;if(e.ticket&&(i!=null&&i.ticket)&&(i==null?void 0:i.ticket)===e.ticket)return i}if(e.source){if(this.byVersion){let t=[e.source,e.version,this.path],i=(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET_BY_SOURCE_VERSION,t)).message;if(i)return Ya.sameVersionFootprint([e.display_title||e.title]),i}if(this.bySource){let t=[e.source,this.path],i=(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET_LAST,t)).message;if(i)return Ya.diffVersionFootprint([e.display_title||e.title]),i}}}async isRename(e){let t=[e.display_title||e.title,this.path];return(await Ge.messageBus.rpcCall(at.FOOTPRINT.IS_RENAME,t)).message?{success:!1,message:"Library duplicate name"}:{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};let t,i;if(this.origin){let r=await this.match(this.origin);if(r)t={success:!0,result:r};else{let s=await this.rename(this.origin);if(!s.success)return{success:!1,code:s.code,message:s.message};i=this.origin}}return{success:!0,result:{respond:t,addData:i}}}},uv=class extends Mm{async getOrigin(){var r,s;let{path:e,uuid:t,isProject:i}=this.data;if(Hh(this.data)){let{override:n}=this.data;if(i){let{message:a}=await Ge.messageBus.rpcCall("/pro-mgr/hasProject",[e]);if(a){let o=[t,e],l=(await Ge.messageBus.rpcCall(at.SYMBOL.GET,o)).message;if(l){let h=Object.assign(l,{uuid:t,path:e});this.origin=await this.getTemplate(h,n)}else return{success:!1,message:"Symbol details data does not exist"}}else return{success:!1,message:"Get project library data source Project is not open!"}}else if(Or.getInstance().hasLib(e)){let a=await((s=(r=Or.getInstance().getLib(e))==null?void 0:r.symbol)==null?void 0:s.getTransformedDetail(t));if(a){let o=Object.assign(a,{uuid:t,path:e});this.origin=await this.getTemplate(o,n)}else return{success:!1,message:"Symbol details data does not exist"}}else{let a={path:e,uuid:t},{message:o}=await Ge.messageBus.rpcCall(Ha.COMPONENT.GET,a);if(o.success){let l=o.result,h=Object.assign(l,{uuid:t,path:e});this.origin=await this.getTemplate(h,n)}else return{success:!1,code:o.code,message:o.message}}}else{let n=this.data.data;this.origin=await this.onHandle(n)}return{success:!0,result:this.origin}}async renaming(e){let t=e.display_title||e.title,i=[t,this.path],r=(await Ge.messageBus.rpcCall(at.SYMBOL.TRY_RENAME,i)).message;return r&&(e.display_title=e.title=r),t!==r&&Ya.renamedSymbol([t]),{success:!0}}},km=class extends uv{onHandle(e){return this.onAdd(e)}async matching(e){if(this.byUUID){let t=[e.uuid,this.path],i=(await Ge.messageBus.rpcCall(at.SYMBOL.GET,t)).message;if(e.ticket&&(i!=null&&i.ticket)&&(i==null?void 0:i.ticket)===e.ticket)return i}if(e.source){if(this.byVersion){let t=[e.source,e.version,this.path],i=(await Ge.messageBus.rpcCall(at.SYMBOL.GET_BY_SOURCE_VERSION,t)).message;if(i)return Ya.sameVersionSymbol([e.display_title||e.title]),i}if(this.bySource){let t=[e.source,this.path],i=(await Ge.messageBus.rpcCall(at.SYMBOL.GET_LAST,t)).message;if(i)return Ya.diffVersionSymbol([e.display_title||e.title]),i}}}async isRename(e){let t=[e.display_title||e.title,this.path];return(await Ge.messageBus.rpcCall(at.SYMBOL.IS_RENAME,t)).message?{success:!1,message:"Library duplicate name"}:{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};let t,i;if(this.origin){let r=await this.match(this.origin);if(r)t={success:!0,result:r};else{let s=await this.rename(this.origin);if(!s.success)return{success:!1,code:s.code,message:s.message};i=this.origin}}return{success:!0,result:{respond:t,addData:i}}}},Um=class{constructor(e){this.path=e}async check(){let{message:{hasPermission:e,errMsg:t}}=await Ge.messageBus.rpcCall("canAddLib",[this.path]);return e?{success:!0}:{success:!1,message:t||"You don't have permission!"}}},dv=class extends Um{constructor(e){super(e)}async transform(e,t,i){let{device:r,symbol:s,footprint:n}=e,a={device:r,symbol:s,footprint:n};if(s!=null&&s.success&&(s!=null&&s.result)&&t.symbol&&i.symbol){let o=t.symbol,l=s.result,{uuid:h,docType:c,version:f}=l,d=i.symbol.isProject,u=Object.assign(o,{isProject:d}),p={uuid:h,path:this.path,isProject:!0,docType:c,version:f};if((await ha({origin:u,target:p})).success===!1)throw new Error("Library canvas content upload failed!")}if(n!=null&&n.success&&(n!=null&&n.result)&&t.footprint){let o=t.footprint,l=n.result,{uuid:h,docType:c,version:f}=l,d=i.footprint.isProject,u=!!(r!=null&&r.success&&r.result),p=Object.assign(o,{isConnectDevice:u,isProject:d}),_={uuid:h,path:this.path,isProject:!0,docType:c,version:f};if((await ha({origin:p,target:_})).success===!1)throw new Error("Library canvas content upload failed!")}return{success:!0,result:a}}async transformSymbol(){}async onsuccess(e){e.symbol&&!e.symbol.success&&(e.symbol.message=tp(e.symbol)||e.symbol.message),e.footprint&&!e.footprint.success&&(e.footprint.message=tp(e.footprint)||e.footprint.message),e.device&&!e.device.success&&(e.device.message=tp(e.device)||e.device.message)}},BM=class extends dv{constructor(e){let{path:t,data:i,options:r={}}=e,{matchKey:s=!0,byUUID:n=!0,byVersion:a=!0,bySource:o=!0,renameKey:l=!1}=r;super(t),this.addData={},this.result={device:null,symbol:null,footprint:null},this.data=i,this.matchKey=s,this.byUUID=n,this.byVersion=a,this.bySource=o,this.renameKey=l}async start(){var e,t,i,r,s,n,a,o,l,h,c,f;try{let d=await this.check();if(!d.success)return{success:!1,message:d.message};await this.onbefore();let u={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey};if(this.data.device){let g={...u,data:this.data.device},b=await new MM(g).start();if(b.success===!1)return{success:!1,code:b.code,message:b.message};let{respond:m,addData:O}=b.result;if(this.result.device=m,O&&(this.addData.device=O),this.getBind(),!this.addData.device&&((e=this.result.device)==null?void 0:e.success)&&((t=this.result.device)==null?void 0:t.result)){let{attributes:y}=this.result.device.result,{Symbol:x,Footprint:E}=y,w=x&&(await Ge.messageBus.rpcCall(at.SYMBOL.GET,[x,this.path])).message,S=E&&(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET,[E,this.path])).message;this.result.symbol={success:!0,result:w},this.result.footprint={success:!0,result:S}}}if(this.data.symbol){let g={...u,data:this.data.symbol},b=await new km(g).start();if(b.success===!1&&b.code===404){if(this.addData.device){this.addData.device.attributes.Symbol="";let{display_title:m,title:O}=this.addData.device,y=m||O;Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["The following devices lose bound symbol data!",y]})}}else{if(b.success===!1)return{success:!1,code:b.code,message:b.message};{let{respond:m,addData:O}=b.result;if(this.result.symbol=m,O&&(this.addData.symbol=O),this.addData.device&&((i=this.result.symbol)==null?void 0:i.success)&&((r=this.result.symbol)==null?void 0:r.result))this.addData.device.attributes.Symbol=this.result.symbol.result.uuid;else if((s=this.addData.device)!=null&&s.attributes.Symbol&&((n=this.result.symbol)!=null&&n.success)&&!((a=this.result.symbol)!=null&&a.result)&&!this.addData.symbol){let y="The symbol associated with the device does not exist!";throw new Ae("CREATE_DEVICE",y)}}}}if(this.data.footprint){let g={...u,data:this.data.footprint},b=await new Bm(g).start();if(b.success===!1&&b.code===404){if(this.addData.device){this.addData.device.attributes.Footprint="";let{display_title:m,title:O}=this.addData.device,y=m||O;Ge.messageBus.publish("logI18nLogView",{type:"warn",msg:["The following devices lose bound footprint data!",y]})}}else{if(b.success===!1)return{success:!1,code:b.code,message:b.message};{let{respond:m,addData:O}=b.result;if(this.result.footprint=m,O&&(this.addData.footprint=O),this.addData.device&&((o=this.result.footprint)==null?void 0:o.success)&&((l=this.result.footprint)==null?void 0:l.result))this.addData.device.attributes.Footprint=this.result.footprint.result.uuid;else if((h=this.addData.device)!=null&&h.attributes.Footprint&&((c=this.result.footprint)!=null&&c.success)&&!((f=this.result.footprint)!=null&&f.result)&&!this.addData.footprint){let y="The footprint associated with the device does not exist!";throw new Ae("CREATE_DEVICE",y)}}}}let p=await this.create();if(!p.success)return{success:!1,message:p.message};let _=await this.updateBind();if(!_.success)return{success:!1,message:_.message};if(!this.result)throw new Ae("CREATE_DEVICE","Project library device added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}catch(d){return{success:!1,message:d.message}}}getBind(){if(this.addData.device){let{attributes:e}=this.addData.device,{Symbol:t,Footprint:i}=e,{isProject:r}=this.data.device;if(r===void 0)!this.data.symbol&&t&&(this.data.symbol={isProject:!0,path:this.path,uuid:t}),!this.data.footprint&&i&&(this.data.footprint={isProject:!0,path:this.path,uuid:i});else{let[s,n]=this.addData.device.source.split(zh);!this.data.symbol&&t&&(this.data.symbol={isProject:r,path:n,uuid:t}),!this.data.footprint&&i&&(this.data.footprint={isProject:r,path:n,uuid:i})}}}onbeforeCreate(){var e,t,i,r;return(e=this.addData.symbol)!=null&&e.docType&&!Wb((t=this.addData.symbol)==null?void 0:t.docType)?{success:!1,message:"invalid symbol docType"}:(i=this.addData.footprint)!=null&&i.docType&&((r=this.addData.footprint)==null?void 0:r.docType)!==4?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){var e;if(Object.keys(this.addData).length>0){let t=this.onbeforeCreate();if(!t.success)return{success:!1,message:t.message};let i=[[this.addData],this.path],{message:r}=await Ge.messageBus.rpcCall(at.DEVICE.PLACE,i);if(!r.success)return{success:!1,message:r.message};let{device:s,symbol:n,footprint:a}=(e=r.result)==null?void 0:e[0];s&&(this.result.device=s),n&&(this.result.symbol=n),a&&(this.result.footprint=a);let o=await this.transform(this.result,this.addData,this.data);if(!o.success)return{success:!1,message:o.message}}return{success:!0}}async updateBind(){let{device:e,symbol:t,footprint:i}=this.result,r=e!=null&&e.success?e==null?void 0:e.result:null,s=t!=null&&t.success?t==null?void 0:t.result:null,n=i!=null&&i.success?i==null?void 0:i.result:null;if(r){let a=!1;if(s!=null&&s.uuid&&r.attributes.Symbol&&s.uuid!==r.attributes.Symbol&&(r.attributes.Symbol=s.uuid,a=!0),n!=null&&n.uuid&&r.attributes.Footprint&&n.uuid!==r.attributes.Footprint&&(r.attributes.Footprint=n.uuid,a=!0),a){let o=(await Ge.messageBus.rpcCall(at.DEVICE.UPDATE,[r,this.path])).message;this.result.device={success:!!o,result:o}}}return{success:!0}}async onbefore(){}},kM=class extends hv{constructor(e,t){super(t),this.uuid=e}onHandle(e){return this.onUpdate(e)}matching(e){throw new Error("Method not implemented.")}async isRename(e){return{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};if(!this.origin)return{success:!1,message:"Device details data does not exist"};let t=this.origin.display_title||this.origin.title,i=[{uuid:this.uuid,title:t},this.path];if((await Ge.messageBus.rpcCall(at.DEVICE.IS_CHANGE,i)).message){let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message}}return{success:!0,result:this.origin}}},UM=class extends dv{constructor(e){let{path:t,uuid:i,data:r,options:s={}}=e,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:l=!1,renameKey:h=!1}=s;super(t),this.addData={},this.map={},this.result={device:null,symbol:null,footprint:null,map:{}},this.uuid=i,this.data=r,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=l,this.renameKey=h}async start(){var e,t,i,r,s,n,a,o,l,h;try{let c=await this.check();if(!c.success)return{success:!1,message:c.message};await this.onbefore();let f={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey};if(this.data.device){let p={...f,data:this.data.device},_=await new kM(this.uuid,p).start();if(_.success){let g=_.result;g&&(this.updateData=g),this.getBind()}else return{success:!1,code:_.code,message:_.message}}if(this.data.symbol){let p={...f,data:this.data.symbol,renameKey:this.renameKey},_=await new km(p).start();if(!_.success)return{success:!1,code:_.code,message:_.message};let{respond:g,addData:b}=_.result;if(this.result.symbol=g,b&&(this.addData.symbol=b),this.updateData&&this.addData.symbol)this.updateData.attributes.Symbol=this.addData.symbol.uuid;else if(this.updateData&&((e=this.result.symbol)!=null&&e.success)&&this.result.symbol.result)this.updateData.attributes.Symbol=this.result.symbol.result.uuid;else if((t=this.updateData)!=null&&t.attributes.Symbol&&((i=this.result.symbol)!=null&&i.success)&&!((r=this.result.symbol)!=null&&r.result)&&!this.addData.symbol){let m="The symbol associated with the device does not exist!";throw new Ae("UPDATE_DEVICE",m)}}if(this.data.footprint){let p={...f,data:this.data.footprint,renameKey:this.renameKey},_=await new Bm(p).start();if(!_.success)return{success:!1,code:_.code,message:_.message};let{respond:g,addData:b}=_.result;if(this.result.footprint=g,b&&(this.addData.footprint=b),this.updateData&&this.addData.footprint)this.updateData.attributes.Footprint=this.addData.footprint.uuid;else if(this.updateData&&((s=this.result.footprint)!=null&&s.success)&&this.result.footprint.result)this.updateData.attributes.Footprint=this.result.footprint.result.uuid;else if((n=this.updateData)!=null&&n.attributes.Footprint&&((a=this.result.footprint)!=null&&a.success)&&!((o=this.result.footprint)!=null&&o.result)&&!this.addData.footprint){let m="The footprint associated with the device does not exist!";throw new Ae("UPDATE_DEVICE",m)}}let d=await this.create();if(!d.success)return{success:!1,code:d.code,message:d.message};let u=await this.update();if(!u.success)return{success:!1,message:u.message};if(!this.result){let p={text:"Failed to update project library device {title}!",args:{title:((l=this.updateData)==null?void 0:l.display_title)||((h=this.updateData)==null?void 0:h.title)||""}};throw new Ae("UPDATE_DEVICE",p)}return await this.onsuccess(this.result),{success:!0,result:Object.assign(this.result,{map:this.map})}}catch(c){return{success:!1,message:c.message}}}getBind(){if(this.updateData){let{attributes:e}=this.updateData,{Symbol:t,Footprint:i}=e||{},{isProject:r}=this.data.device;if(r===void 0)!this.data.symbol&&t&&(this.data.symbol={isProject:!0,path:this.path,uuid:t}),!this.data.footprint&&i&&(this.data.footprint={isProject:!0,path:this.path,uuid:i});else{let[s,n]=this.updateData.source.split(zh);!this.data.symbol&&t&&(this.data.symbol={isProject:r,path:n,uuid:t}),!this.data.footprint&&i&&(this.data.footprint={isProject:r,path:n,uuid:i})}}}onbeforeCreate(){var e,t,i,r;return(e=this.addData.symbol)!=null&&e.docType&&!Wb((t=this.addData.symbol)==null?void 0:t.docType)?{success:!1,message:"invalid symbol docType"}:(i=this.addData.footprint)!=null&&i.docType&&((r=this.addData.footprint)==null?void 0:r.docType)!==4?{success:!1,message:"invalid footprint docType"}:{success:!0}}async create(){let{symbol:e,footprint:t}=this.addData,i=this.onbeforeCreate();if(!i.success)return{success:!1,message:i.message};if(e){let s=(await Ge.messageBus.rpcCall(at.SYMBOL.ADD,[e,this.path])).message;if(!s)return{success:!1,message:"Project library symbol added failed!"};this.result.symbol={success:!0,result:s},this.map[e.uuid]=s.uuid}if(t){let s=(await Ge.messageBus.rpcCall(at.FOOTPRINT.ADD,[t,this.path])).message;if(!s)return{success:!1,message:"Project library footprint added failed!"};this.result.footprint={success:!0,result:s},this.map[t.uuid]=s.uuid}let r=await this.transform(this.result,this.addData,this.data);return r.success?{success:!0}:{success:!1,message:r.message}}async update(){var t,i,r;let e=this.updateData;if(e){(t=this.result.symbol)!=null&&t.success&&this.result.symbol.result&&(e.attributes.Symbol=(i=this.result.symbol)==null?void 0:i.result.uuid),(r=this.result.footprint)!=null&&r.success&&this.result.footprint.result&&(e.attributes.Footprint=this.result.footprint.result.uuid);let s=[{...e,uuid:this.uuid,keepVersion:this.keepVersion},this.path],n=(await Ge.messageBus.rpcCall(at.DEVICE.UPDATE,s)).message;if(!n)return{success:!1,message:{text:"Failed to update project library device {title}!",args:{title:e.display_title||e.title||""}}};this.result.device={success:!0,result:n}}return{success:!0}}async onbefore(){Hh(this.data.device)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}},fv=class extends Um{constructor(e){let{path:t,data:i}=e;super(t),this.data=i}async cloneCanvas(e,t){let{uuid:i,version:r,docType:s}=t,n=Object.assign(e,{isProject:this.data.isProject}),a={uuid:i,path:this.path,isProject:!0,docType:s,version:r};if((await ha({origin:n,target:a})).success===!1)throw new Error("Library canvas content upload failed!");return{success:!0}}},FM=class extends fv{constructor(e){let{path:t,data:i,options:r={}}=e,{byUUID:s=!0,byVersion:n=!0,bySource:a=!0,renameKey:o=!0,matchKey:l=!0}=r;super({path:t,data:i}),this.byUUID=s,this.byVersion=n,this.bySource=a,this.renameKey=o,this.matchKey=l}async start(){let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey,matchKey:this.matchKey},i=await new km({...t,data:this.data}).start();if(!i.success)return{success:!1,code:i.code,message:i.message};let{addData:r,respond:s}=i.result;if(s&&!s.success)return{success:!1,code:s.code,message:s.message};if(s&&s.success)this.result=s.result;else if(r){let n=(await Ge.messageBus.rpcCall(at.SYMBOL.ADD,[r,this.path])).message;if(!n)return{success:!1,message:"Project library symbol added failed!"};let a=await this.cloneCanvas(r,n);if(!a.success)return{success:!1,code:a.code,message:a.message};this.result=n}if(!this.result)throw new Ae("CREATE_SYMBOL","Project library symbol added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){}async onsuccess(e){}},pv=class extends Um{constructor(e){let{path:t,data:i}=e;super(t),this.data=i}async cloneCanvas(e,t){let{uuid:i,version:r,docType:s}=t,n=Object.assign(e,{isProject:this.data.isProject}),a={uuid:i,path:this.path,isProject:!0,docType:s,version:r};if((await ha({origin:n,target:a})).success===!1)throw new Error("Library canvas content upload failed!");return{success:!0}}},GM=class extends pv{constructor(e){let{path:t,data:i,options:r={}}=e,{byUUID:s=!0,byVersion:n=!0,bySource:a=!0,renameKey:o=!0,matchKey:l=!0}=r;super({path:t,data:i}),this.byUUID=s,this.byVersion=n,this.bySource=a,this.renameKey=o,this.matchKey=l}async start(){let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,byUUID:this.byUUID,byVersion:this.byVersion,bySource:this.bySource,renameKey:this.renameKey,matchKey:this.matchKey},i=await new Bm({...t,data:this.data}).start();if(!i.success)return{success:!1,code:i.code,message:i.message};let{addData:r,respond:s}=i.result;if(s&&!s.success)return{success:!1,code:s.code,message:s.message};if(s&&s.success)this.result=s.result;else if(r){let n=(await Ge.messageBus.rpcCall(at.FOOTPRINT.ADD,[r,this.path])).message;if(!n)return{success:!1,message:"Project library footprint added failed!"};let a=await this.cloneCanvas(r,n);if(!a.success)return{success:!1,code:a.code,message:a.message};this.result=n}if(!this.result)throw new Ae("CREATE_FOOTPRINT","Project library footprint added failed!");return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){}async onsuccess(e){}},zM=class extends uv{constructor(e,t){super(t),this.uuid=e}onHandle(e){return this.onUpdate(e)}matching(e){throw new Error("Method not implemented.")}async isRename(e){return{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};if(!this.origin)return{success:!1,message:"Symbol details data does not exist"};let t=this.origin.display_title||this.origin.title,i=[{uuid:this.uuid,title:t},this.path];if((await Ge.messageBus.rpcCall(at.SYMBOL.IS_CHANGE,i)).message){let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message}}return{success:!0,result:this.origin}}},HM=class extends fv{constructor(e){let{path:t,uuid:i,data:r,options:s={}}=e,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:l=!1,renameKey:h=!1}=s;super({path:t,data:r}),this.uuid=i,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=l,this.renameKey=h}async start(){var s,n;let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey,data:this.data},i=await new zM(this.uuid,t).start();if(!i.success)return{success:!1,code:i.code,message:i.message};this.updateData=i.result;let r=[{...this.updateData,uuid:this.uuid,keepVersion:this.keepVersion},this.path];if(this.result=(await Ge.messageBus.rpcCall(at.SYMBOL.UPDATE,r)).message,this.result&&this.onlyIdentity){let a=await this.cloneCanvas(this.updateData,this.result);if(!a.success)return{success:!1,code:a.code,message:a.message}}if(!this.result){let a=((s=this.updateData)==null?void 0:s.display_title)||((n=this.updateData)==null?void 0:n.title)||"",o="Failed to update project library symbol {title}!";throw new Ae("UPDATE_SYMBOL",{text:o,args:{title:a}})}return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){Hh(this.data)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}async onsuccess(e){}},jM=class extends cv{constructor(e,t){super(t),this.uuid=e}onHandle(e){return this.onUpdate(e)}matching(e){throw new Error("Method not implemented.")}async isRename(e){return{success:!0}}async start(){let e=await this.getOrigin();if(!e.success)return{success:!1,code:e.code,message:e.message};if(!this.origin)return{success:!1,message:"Footprint details data does not exist"};let t=this.origin.display_title||this.origin.title,i=[{uuid:this.uuid,title:t},this.path];if((await Ge.messageBus.rpcCall(at.FOOTPRINT.IS_CHANGE,i)).message){let r=await this.rename(this.origin);if(!r.success)return{success:!1,code:r.code,message:r.message}}return{success:!0,result:this.origin}}},YM=class extends pv{constructor(e){let{path:t,uuid:i,data:r,options:s={}}=e,{matchKey:n=!0,byUUID:a=!0,bySource:o=!0,byVersion:l=!1,renameKey:h=!1}=s;super({path:t,data:r}),this.uuid=i,this.matchKey=n,this.byUUID=a,this.bySource=o,this.byVersion=l,this.renameKey=h}async start(){var s,n;let e=await this.check();if(!e.success)return{success:!1,message:e.message};await this.onbefore();let t={path:this.path,matchKey:this.matchKey,byUUID:this.byUUID,bySource:this.bySource,byVersion:this.byVersion,renameKey:this.renameKey,data:this.data},i=await new jM(this.uuid,t).start();if(!i.success)return{success:!1,code:i.code,message:i.message};this.updateData=i.result;let r=[{...this.updateData,uuid:this.uuid,keepVersion:this.keepVersion},this.path];if(this.result=(await Ge.messageBus.rpcCall(at.FOOTPRINT.UPDATE,r)).message,this.result&&this.onlyIdentity){let a=await this.cloneCanvas(this.updateData,this.result);if(!a.success)return{success:!1,code:a.code,message:a.message}}if(!this.result){let a={text:"Failed to update project library footprint {title}!",args:{title:((s=this.updateData)==null?void 0:s.display_title)||((n=this.updateData)==null?void 0:n.title)||""}};throw new Ae("UPDATE_FOOTPRINT",a)}return await this.onsuccess(this.result),{success:!0,result:this.result}}async onbefore(){Hh(this.data)?(this.onlyIdentity=!0,this.keepVersion=!0):(this.onlyIdentity=!1,this.keepVersion=!1)}async onsuccess(e){}},VM=class extends Am{async getDevice(e){let t=[e.uuid,e.path],{message:i}=await Ge.messageBus.rpcCall(at.DEVICE.GET,t);if(!i)throw new Ae("GET_DEVICE","Device details data does not exist");return this.getDeviceOut(Object.assign(i,{path:e.path}))}async getSymbol(e){let t=[e.uuid,e.path],{message:i}=await Ge.messageBus.rpcCall(at.SYMBOL.GET,t);if(!i)throw new Ae("GET_SYMBOL","Symbol details data does not exist");return this.getSymbolOut(Object.assign(i,{path:e.path}))}async getFootprint(e){let t=[e.uuid,e.path],{message:i}=await Ge.messageBus.rpcCall(at.FOOTPRINT.GET,t);if(!i)throw new Ae("GET_FOOTPRINT","Footprint details data does not exist");return this.getFootprintOut(Object.assign(i,{path:e.path}))}async createDevice(e){let{path:t,device:i,symbol:r,footprint:s}=e,n={path:t,data:{device:i,symbol:r,footprint:s}},a=await new BM(n).start();if(!a.success)throw new Ae("CREATE_DEVICE",a.message);let o=a.result.device;if(!(o!=null&&o.success))throw new Ae("CREATE_DEVICE",o==null?void 0:o.message);let l=o.result;return this.getDeviceOut(Object.assign(l,{path:e.path}))}async createSymbol(e){let{path:t,symbol:i}=e,r={path:t,data:i},s=await new FM(r).start();if(!s.success)throw new Ae("CREATE_SYMBOL",s.message);let n=s.result;return this.getSymbolOut(Object.assign(n,{path:e.path}))}async createFootprint(e){let{path:t,footprint:i}=e,r={path:t,data:i},s=await new GM(r).start();if(!s.success)throw new Ae("CREATE_FOOTPRINT",s.message);let n=s.result;return this.getFootprintOut(Object.assign(n,{path:e.path}))}async updateDevice(e){let{uuid:t,path:i,device:r,symbol:s,footprint:n}=e,a={path:i,uuid:t,data:{device:r,symbol:s,footprint:n}},o=await new UM(a).start();if(!o.success)throw new Ae("UPDATE_DEVICE",o.message);let l=o.result.device;if(!(l!=null&&l.success))throw new Ae("CREATE_DEVICE",l==null?void 0:l.message);let h=l.result;return this.getDeviceOut(Object.assign(h,{path:e.path}))}async updateDeviceAttributes(e){let t=(await Ge.messageBus.rpcCall(at.DEVICE.UPDATE,[e,e.path])).message;if(!t)throw new Ae("UPDATE_DEVICE_ATTRIBUTES",t.message);return this.getDeviceOut(Object.assign(t,{path:e.path}))}async updateSymbol(e){let{uuid:t,path:i,symbol:r}=e,s={path:i,uuid:t,data:r},n=await new HM(s).start();if(!n.success)throw new Ae("UPDATE_SYMBOL",n.message);let a=n.result;return this.getSymbolOut(Object.assign(a,{path:e.path}))}async updateFootprint(e){let{uuid:t,path:i,footprint:r}=e,s={path:i,uuid:t,data:r},n=await new YM(s).start();if(!n.success)throw new Ae("UPDATE_FOOTPRINT",n.message);let a=n.result;return this.getFootprintOut(Object.assign(a,{path:e.path}))}async deleteDevice(e){if(!(await Ge.messageBus.rpcCall(at.DEVICE.DEL,e)).message)throw new Ae("DELETE_DEVICE","delete failed!")}async deleteSymbol(e){if(!(await Ge.messageBus.rpcCall(at.SYMBOL.DEL,e)).message)throw new Ae("DELETE_SYMBOL","delete failed!")}async deleteFootprint(e){if(!(await Ge.messageBus.rpcCall(at.FOOTPRINT.DEL,e)).message)throw new Ae("DELETE_FOOTPRINT","delete failed!")}async getDeviceList(e){let t=(await Ge.messageBus.rpcCall(at.DEVICE.GET_LIST,e)).message;if(!t.success)throw new Ae("GET_DEVICE_LIST",t.message);let{count:i,totalPage:r,lists:s,page:n,pageSize:a}=t.result,o=s.map(l=>{let h=this.getDeviceOut(l);return l.symbol&&(h.symbol=this.getSymbolOut(l.symbol)),l.footprint&&(h.footprint=this.getFootprintOut(l.footprint)),h});return{count:i,lists:o,page:n,pageSize:a,totalPage:r}}async getDeviceSearchList(e){let t=(await Ge.messageBus.rpcCall(at.DEVICE.GET_LIST,e)).message;if(!t.success)throw new Ae("GET_DEVICE_LIST",t.message);if(e.titles){let i={};for(let r in t.result){let s=t.result[r].map(n=>{let a=this.getDeviceOut(n);return n.symbol&&(a.symbol=this.getSymbolOut(n.symbol)),n.footprint&&(a.footprint=this.getFootprintOut(n.footprint)),a});i[r]=s}return i}else{let{count:i,totalPage:r,lists:s,page:n,pageSize:a}=t.result,o=s.map(l=>{let h=this.getDeviceOut(l);return l.symbol&&(h.symbol=this.getSymbolOut(l.symbol)),l.footprint&&(h.footprint=this.getFootprintOut(l.footprint)),h});return{count:i,lists:o,page:n,pageSize:a,totalPage:r}}}async getSymbolList(e){let t=(await Ge.messageBus.rpcCall(at.SYMBOL.GET_LIST,e)).message;if(!t.success)throw new Ae("GET_SYMBOL_LIST",t.message);let{count:i,totalPage:r,lists:s,page:n,pageSize:a}=t.result,o=s.map(this.getSymbolOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:r}}async getSymbolSearchList(e){let t=(await Ge.messageBus.rpcCall(at.SYMBOL.GET_LIST,e)).message;if(!t.success)throw new Ae("GET_SYMBOL_LIST",t.message);if(e.titles){let i={};for(let r in t.result)i[r]=t.result[r].map(this.getSymbolOut);return i}else{let{count:i,totalPage:r,lists:s,page:n,pageSize:a}=t.result,o=s.map(this.getSymbolOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:r}}}async getFootprintList(e){let t=(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET_LIST,e)).message;if(!t.success)throw new Ae("GET_FOOTPRINT_LIST",t.message);let{count:i,totalPage:r,lists:s,page:n,pageSize:a}=t.result,o=s.map(this.getFootprintOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:r}}async getFootprintSearchList(e){let t=(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET_LIST,e)).message;if(!t.success)throw new Ae("GET_FOOTPRINT_LIST",t.message);if(e.titles){let i={};for(let r in t.result)i[r]=t.result[r].map(this.getFootprintOut);return i}else{let{count:i,totalPage:r,lists:s,page:n,pageSize:a}=t.result,o=s.map(this.getFootprintOut);return{count:i,lists:o,page:n,pageSize:a,totalPage:r}}}getDeviceOut(e){return{uuid:e.uuid,path:e.path,title:e.title,display_title:e.display_title,attributes:e.attributes,description:e.description,images:e.images,source:e.source,version:e.version,ticket:e.ticket,creator:e.creator,modifier:e.modifier,createTime:Ye(e.createTime),updateTime:Ye(e.updateTime),owner:e.owner,custom_tags:e.custom_tags,symbol_type:e.symbol_type}}getSymbolOut(e){return{title:e.title,display_title:e.display_title,description:e.description,docType:e.docType,uuid:e.uuid,path:e.path,source:e.source,version:e.version,ticket:e.ticket,creator:e.creator,modifier:e.modifier,updateTime:Ye(e.updateTime),createTime:Ye(e.createTime),owner:e.owner,custom_tags:e.custom_tags}}getFootprintOut(e){return{title:e.title,display_title:e.display_title,description:e.description,docType:e.docType,uuid:e.uuid,path:e.path,source:e.source,version:e.version,ticket:e.ticket,creator:e.creator,modifier:e.modifier,updateTime:Ye(e.updateTime),createTime:Ye(e.createTime),owner:e.owner,custom_tags:e.custom_tags}}},qM=class extends Am{constructor(){super(...arguments),this._normalErrorMsg="Request Error.",this._extendLibManager=Or.getInstance()}async getDevice(e){var i;let t=await((i=this._extendLibManager.getLib(e.path))==null?void 0:i.getTransformedDetailInTab("device",e.uuid));if(t)return t;throw new Ae("GET_DEVICE",this._normalErrorMsg)}async getSymbol(e){var i;let t=await((i=this._extendLibManager.getLib(e.path))==null?void 0:i.getTransformedDetailInTab("symbol",e.uuid));if(t)return t;throw new Ae("GET_SYMBOL",this._normalErrorMsg)}async getFootprint(e){var i;let t=await((i=this._extendLibManager.getLib(e.path))==null?void 0:i.getTransformedDetailInTab("footprint",e.uuid));if(t)return t;throw new Ae("GET_FOOTPRINT",this._normalErrorMsg)}async getDeviceList(e){var i,r,s,n,a,o,l,h;let t=await((h=this._extendLibManager.getLib(e.path))==null?void 0:h.getTransformedListInTab("device",{query:{attributes:(r=(i=e.query)==null?void 0:i.attributes)!=null?r:{},symbolType:(s=e.query)==null?void 0:s.symbol_type,classification:{primaryClassificationUuid:(a=(n=e.tags)==null?void 0:n[0])!=null?a:"",secondaryClassificationUuid:(l=(o=e.tags)==null?void 0:o[1])!=null?l:""}},page:e.page,pageSize:e.pageSize}));if(t)return t;throw new Ae("GET_DEVICE_LIST",this._normalErrorMsg)}async getSymbolList(e){var i,r,s,n,a,o,l;let t=await((l=this._extendLibManager.getLib(e.path))==null?void 0:l.getTransformedListInTab("symbol",{query:{symbolType:(r=(i=e.query)==null?void 0:i.docType)==null?void 0:r[0],classification:{primaryClassificationUuid:(n=(s=e.tags)==null?void 0:s[0])!=null?n:"",secondaryClassificationUuid:(o=(a=e.tags)==null?void 0:a[1])!=null?o:""}},page:e.page,pageSize:e.pageSize}));if(t)return t;throw new Ae("GET_SYMBOL_LIST",this._normalErrorMsg)}async getFootprintList(e){var i,r,s,n,a;let t=await((a=this._extendLibManager.getLib(e.path))==null?void 0:a.getTransformedListInTab("footprint",{query:{classification:{primaryClassificationUuid:(r=(i=e.tags)==null?void 0:i[0])!=null?r:"",secondaryClassificationUuid:(n=(s=e.tags)==null?void 0:s[1])!=null?n:""}},page:e.page,pageSize:e.pageSize}));if(t)return t;throw new Ae("GET_FOOTPRINT_LIST",this._normalErrorMsg)}async getDeviceSearchList(e){var l,h,c,f;let{path:t,wd:i,query:r,tags:s,page:n,pageSize:a}=e,o=await((f=this._extendLibManager.getLib(t))==null?void 0:f.getTransformedListInTab("device",{query:{wd:i,attributes:(l=r==null?void 0:r.attributes)!=null?l:{},symbolType:r==null?void 0:r.symbol_type,classification:{primaryClassificationUuid:(h=s==null?void 0:s[0])!=null?h:"",secondaryClassificationUuid:(c=s==null?void 0:s[1])!=null?c:""}},page:n,pageSize:a}));if(o)return o;throw new Ae("GET_DEVICE_LIST",this._normalErrorMsg)}async getSymbolSearchList(e){var l,h,c,f;let{path:t,wd:i,query:r,tags:s,page:n,pageSize:a}=e,o=await((f=this._extendLibManager.getLib(t))==null?void 0:f.getTransformedListInTab("symbol",{query:{wd:i,symbolType:(l=r==null?void 0:r.docType)==null?void 0:l[0],classification:{primaryClassificationUuid:(h=s==null?void 0:s[0])!=null?h:"",secondaryClassificationUuid:(c=s==null?void 0:s[1])!=null?c:""}},page:n,pageSize:a}));if(o)return o;throw new Ae("GET_SYMBOL_LIST",this._normalErrorMsg)}async getFootprintSearchList(e){var l,h,c;let{path:t,wd:i,query:r,tags:s,page:n,pageSize:a}=e,o=await((c=this._extendLibManager.getLib(t))==null?void 0:c.getTransformedListInTab("footprint",{query:{wd:i,classification:{primaryClassificationUuid:(l=s==null?void 0:s[0])!=null?l:"",secondaryClassificationUuid:(h=s==null?void 0:s[1])!=null?h:""}},page:n,pageSize:a}));if(o)return o;throw new Ae("GET_FOOTPRINT_LIST",this._normalErrorMsg)}createDevice(e){throw new Ae("CREATE_DEVICE","Not Supported.")}createSymbol(e){throw new Ae("GET_SYMBOL","Not Supported.")}createFootprint(e){throw new Ae("CREATE_FOOTPRINT","Not Supported.")}updateDevice(e){throw new Ae("UPDATE_DEVICE","Not Supported.")}updateSymbol(e){throw new Ae("GET_SYMBOL","Not Supported.")}updateFootprint(e){throw new Ae("GET_SYMBOL","Not Supported.")}deleteDevice(e){throw new Ae("GET_SYMBOL","Not Supported.")}deleteSymbol(e){throw new Ae("GET_SYMBOL","Not Supported.")}deleteFootprint(e){throw new Ae("GET_SYMBOL","Not Supported.")}},XM=(e=>(e[e.CBB=1]="CBB",e[e.SYMBOL=2]="SYMBOL",e[e.DEVICE=3]="DEVICE",e[e.FOOTPRINT=4]="FOOTPRINT",e[e.MODEL3D=5]="MODEL3D",e[e.MODELSIM=6]="MODELSIM",e[e.PANEL_LIB=29]="PANEL_LIB",e))(XM||{}),WM=["title","description","tags","images"],ai=new LM,Pr=new VM,Na=new qM,Si=class{static getDevice(e){return Or.getInstance().hasLib(e.path)?Na.getDevice(e):e.isProject?Pr.getDevice(e):ai.getDevice(e)}static getSymbol(e){return Or.getInstance().hasLib(e.path)?Na.getSymbol(e):e.isProject?Pr.getSymbol(e):ai.getSymbol(e)}static getFootprint(e){return Or.getInstance().hasLib(e.path)?Na.getFootprint(e):e.isProject?Pr.getFootprint(e):ai.getFootprint(e)}static getD3Model(e){return e.isProject?null:ai.getD3Model(e)}static getSimModel(e){if(e.isProject)throw new Ae("GET_SIM_MODEL","Api call error!");return ai.getSimModel(e)}static getDeviceList(e){return Or.getInstance().hasLib(e.path)?Na.getDeviceList(e):e.isProject?Pr.getDeviceList(e):ai.getDeviceList(e)}static getSymbolList(e){return Or.getInstance().hasLib(e.path)?Na.getSymbolList(e):e.isProject?Pr.getSymbolList(e):ai.getSymbolList(e)}static getFootprintList(e){return Or.getInstance().hasLib(e.path)?Na.getFootprintList(e):e.isProject?Pr.getFootprintList(e):ai.getFootprintList(e)}static getD3ModelList(e){if(e.isProject)throw new Ae("GET_D3MODEL_LIST","Api call error!");return ai.getD3ModelList(e)}static getSimModelList(e){if(e.isProject)throw new Ae("GET_SIM_MODEL_LIST","Api call error!");return ai.getSimModelList(e)}static getDeviceSearchList(e){return Or.getInstance().hasLib(e.path)?Na.getDeviceSearchList(e):e.isProject?Pr.getDeviceSearchList(e):ai.getDeviceSearchList(e)}static getSymbolSearchList(e){return Or.getInstance().hasLib(e.path)?Na.getSymbolSearchList(e):e.isProject?Pr.getSymbolSearchList(e):ai.getSymbolSearchList(e)}static getFootprintSearchList(e){return Or.getInstance().hasLib(e.path)?Na.getFootprintSearchList(e):e.isProject?Pr.getFootprintSearchList(e):ai.getFootprintSearchList(e)}static getPanelLibSearchList(e){if(e.isProject)throw new Ae("GET_PANEL_LIB_SEARCH_LIST","Api call error!");return ai.getPanelLibSearchList(e)}static getD3ModelSearchList(e){if(e.isProject)throw new Ae("GET_D3MODEL_SEARCH_LIST","Api call error!");return ai.getD3ModelSearchList(e)}static getSimModelSearchList(e){if(e.isProject)throw new Ae("GET_SIM_MODEL_SEARCH_LIST","Api call error!");return ai.getSimModelSearchList(e)}static createDevice(e){return e.isProject?Pr.createDevice(e):ai.createDevice(e)}static createSymbol(e){return e.isProject?Pr.createSymbol(e):ai.createSymbol(e)}static createFootprint(e){return e.isProject?Pr.createFootprint(e):ai.createFootprint(e)}static createD3Model(e){return e.isProject?null:ai.createD3Model(e)}static createSimModel(e){if(e.isProject)throw new Ae("CREATE_SIM_MODEL","Api call error!");return ai.createSimModel(e)}static updateDevice(e){return e.isProject?Pr.updateDevice(e):ai.updateDevice(e)}static updateDeviceAttributes(e){return e.isProject?Pr.updateDeviceAttributes(e):ai.updateDeviceAttributes(e)}static updateSymbol(e){return e.isProject?Pr.updateSymbol(e):ai.updateSymbol(e)}static updateFootprint(e){return e.isProject?Pr.updateFootprint(e):ai.updateFootprint(e)}static updateSimModel(e){if(e.isProject)throw new Ae("UPDATE_SIM_MODEL","Api call error!");return ai.updatesimModel(e)}static deleteDevice(e){return e.isProject?Pr.deleteDevice(e):ai.deleteDevice(e)}static deleteSymbol(e){return e.isProject?Pr.deleteSymbol(e):ai.deleteSymbol(e)}static deleteFootprint(e){return e.isProject?Pr.deleteFootprint(e):ai.deleteFootprint(e)}static deleteSimModel(e){if(e.isProject)throw new Ae("DELETE_SIM_MODEL","Api call error!");return ai.deleteSimModel(e)}static deleteD3Model(e){if(e.isProject)throw new Ae("DELETE_3DMODEL","Api call error!");return ai.delete3DModel(e)}};async function _v(e,t,i,r={}){r.eachProcessHook&&r.eachProcessHook(.01);let s=i||nt.SYSTEMLIB_UUID,n=null;if(t)try{n=await Si.getDevice({isProject:e,path:i,uuid:t})}catch(c){console.warn(c)}r.eachProcessHook&&r.eachProcessHook(.25);let a=null,o={Footprint:!1,symbol:!1,d3DModel:!1};if(n){let c=(n.attributes||{}).Symbol;if(c){try{a=await Si.getSymbol({isProject:e,path:i,uuid:c})}catch(f){console.warn(f)}a||(o.symbol=!0)}}r.eachProcessHook&&r.eachProcessHook(.5);let l=null;if(n){let c=(n.attributes||{}).Footprint;if(c){try{l=await Si.getFootprint({isProject:e,path:i,uuid:c})}catch(f){console.warn(f)}l||(o.Footprint=!0)}}r.eachProcessHook&&r.eachProcessHook(.75);let h=null;if(n){let c=n.attributes||{},f=c["3D Model"],d=c["3D Model Title"],u=ju(f,!0),p=u.path||nt.SYSTEMLIB_UUID||s;if(u.componentTitleOrId&&(u.isLocaleFilenameMode?h=(await Pm(u.componentTitleOrId,p)).result:h=await Yu(u.componentTitleOrId,p)),!h&&f&&d){if(r.isCheckD3ModelFileExist){let _=await g4(f);_.success&&_.result instanceof Blob?o.d3DModel=!1:o.d3DModel=!0}else o.d3DModel=!0;h=Fx(f,d,u.path)}}return r.eachProcessHook&&r.eachProcessHook(1),{setPath:s,deviceItem:n,symbolItem:a,footprintItem:l,d3modelItem:h,hasIdButNotFound:o}}async function JM(e=!1,t,i,r,s){let n=s?!!s.forceAsSymbol:!1,a=s?!!s.ignoreDoctypeCheck:!1,o=s?!!s.isDevice:!1,l=s?!!s.isCheckD3ModelFileExist:!1;if(!a){if(r===28){let f=s?!!s.attachedDeviceBindingExtra:!1,d=s?s.eachProcessHook:null;try{let u=null;return f?u=await _v(e,t,i,{eachProcessHook:d,isCheckD3ModelFileExist:l}):u=await Si.getDevice({isProject:e,path:i,uuid:t}),{code:0,success:!0,result:u,message:""}}catch(u){return{code:-1,success:!1,result:null,message:u.message.toString()}}}if(r===4)try{return{code:0,success:!0,result:await Si.getFootprint({isProject:e,path:i,uuid:t}),message:""}}catch(f){return{code:-1,success:!1,result:null,message:f.message.toString()}}if(n||r&&[2,18,19,20,21,22,25,31,7,32,6].indexOf(r)>=0)try{return{code:0,success:!0,result:await Si.getSymbol({isProject:e,path:i,uuid:t}),message:""}}catch(f){return{code:-1,success:!1,result:null,message:f.message.toString()}}if(r===16)try{return{code:0,success:!0,result:await Yu(t,i),message:""}}catch(f){return{code:-1,success:!1,result:null,message:f.message.toString()}}}let h=await vt("GET",o?`/api/v2/devices/${t}`:`/api/v2/components/${t}`,{uuid:t,path:i},{headers:{"Content-type":"application/json","content-type":"application/json",path:i}});if(h.code===0&&h.success&&typeof h.result=="object")return{code:0,success:!0,result:h.result,message:""};let c=h.message||h.msg||"Request Error.";return{code:h.code||-1,success:!1,result:null,message:c}}function nm(e,t){let i=e.owner||{},r=typeof e.updated_at=="string"?e.updated_at:typeof e.updated_at=="number"?Bo(new Date(e.updated_at)):"",s=typeof e.updateTime=="string"?e.updateTime:typeof e.updateTime=="number"?Bo(new Date(Ye(e.updateTime))):"";return{...e,$id:String(t),numberIndex:t+1,ownerBelong:i.username,updateTimeString:r||s}}function ZM(e,t,i){let r=[];for(let s=0;s<e.length;s++){let n=e[s][t]?e[s][t].toLocaleLowerCase():"",a=i?i.toLocaleLowerCase():"";n.indexOf(a)>=0&&r.push(e[s])}return r}async function KM(e,t,i,r){let s=await new Promise(a=>{fetch(vm.D3Model.client3DModelList,{method:"GET",body:JSON.stringify({step_path:e})}).then(o=>{o.json().then(l=>{if(l){a(l);return}a(null)})})}),n={code:0,success:!0,result:{count:0,page:1,pageSize:r,totalPage:1,lists:[]},msg:""};return s&&s.success?(n.result.lists=(s.result||[]).map((a,o)=>{let l=Bo(new Date(a.mtime*1e3)),h={uuid:`${a.fileName}|${t}`,rowFileTag:`${a.fileName}|${t}`,path:t,display_title:a.fileName,description:"",docType:16,isFavorite:!1,modifier:null,owner:null,tags:{child_tag:[],parent_tag:[]},title:a.fileName,updateTime:a.mtime/1e3,updated_at:l,createTime:a.mtime/1e3,created_at:l,creator:null,dataStr:"",public:void 0,type:16};return{...nm(h,o)}}),n.result.count=s.result.length):(n.code=nt.ERR_CODE.NORMAL,n.success=!1,n.msg=s.message||"Fetch local 3D model list error."),n}async function $M(e,t,i,r,s){let n={};for(let h=0;h<t.length;h++){let c=t[h].id,f=await new Promise(d=>{fetch(vm.D3Model.client3DModelList,{method:"GET",body:JSON.stringify({step_path:e})}).then(u=>{u.json().then(p=>{if(p){d(p);return}d(null)})})});if(f&&f.success){n[c]={list:f.result.map((d,u)=>nm(d,u))};continue}n[c]=null}let a={},o={},l={count:0};for(let h=0;h<t.length;h++){let c=t[h].id;if(n[c]){let f=ZM(n[c].list,"fileName",r);if(!f.length){a[c]=0,o[c]=[];continue}a[c]=f.length,o[c]=f.map((d,u)=>{let p=Bo(new Date(d.mtime*1e3)),_={uuid:`${d.fileName}|${d.path}`,path:d.path,rowFileTag:`${d.fileName}|${d.path}`,display_title:d.fileName,description:"",docType:16,isFavorite:!1,modifier:null,owner:null,tags:{child_tag:[],parent_tag:[]},title:d.fileName,updateTime:d.mtime/1e3,updated_at:p,createTime:d.mtime/1e3,created_at:p,creator:null,dataStr:"",public:void 0,source:void 0,std_uuid:void 0,ticket:0,type:16};return{...nm(_,u)}}),l.count++;continue}a[c]=0,o[c]=[]}return{code:0,success:!0,result:{count:l.count,facets:a,lists:o,uid:e,wd:r,page:1,pageSize:s,totalPage:1},msg:""}}var QM=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e))(QM||{});function gv(e){let t=null;return t=Ov(e.title),!t.success||(t=mv(e.description),!t.success)?t:{code:0,success:!0,message:"",key:"",result:null}}function Ov(e){let t={code:0,success:!0,message:"",key:"",result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}function mv(e){let t={code:0,success:!0,message:"",key:"",result:null};return e&&e.length>255&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="Description should be no more than 255 letters"),t}async function e5(e,t,i,r){if(!t||!i||!r)return{code:-1,success:!1,result:null,message:"missing uuid or path or detail data."};let s=gv({title:r.title,description:r.description});if(!s.success)return{code:s.code,success:!1,result:null,message:s.message};let n=await vt("POST",`/api/v2/components/${t}/update`,JSON.stringify({...r,owner:i}),{headers:{"Content-type":"application/json","content-type":"application/json",path:i}});if(n.code===0&&n.success&&typeof n.result=="object")return{code:0,success:!0,result:n.result,message:""};let a=n.message||n.msg||"Request Error.";return{code:n.code||-1,success:!1,result:null,message:a}}var Ns,t5=(Ns=class{},Ns.createDefaultD3modelItem=Fx,Ns.fetchD3ModelItemHandle=Yu,Ns.updateD3ModelItem=e5,Ns.d3modelInfoVerify=gv,Ns.d3modelInfoTitleVerify=Ov,Ns.d3modelInfoDescriptionVerify=mv,Ns.fetchD3ModelListOnLocaleFolder=KM,Ns.fetchD3ModelListBySearchOnLocaleFolder=$M,Ns.fetchD3ModelItemOnLocaleFolder=Pm,Ns),i5=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e.COMPONENT_ATTRIBUTES_OVER_SIZE="{0} should be no more than 255 letters",e))(i5||{});function r5(e,t=void 0){let i=null;if(i=yv(e.title),!i.success||(i=bv(e.description),!i.success)||(i=xv(e.attributes),!i.success))return i;let r={code:0,success:!0,message:"",key:"",result:null};return typeof t<"u"&&(t.length<=0||t.length>128)&&(r.code=nt.ERR_CODE.NORMAL,r.success=!1,r.message="The title length must be between 1~128 characters!"),r}function yv(e){let t={code:0,success:!0,message:"",key:"",result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}function bv(e){let t={code:0,success:!0,message:"",key:"",result:null};return e&&e.length>255&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="Description should be no more than 255 letters"),t}function xv(e){let t={code:0,success:!0,message:"",key:"",result:null},i=Object.keys(e);for(let r=0;r<i.length;r++){let s=i[r],n=e[s];if(typeof n=="string"&&n.trim().length>255)return t.code=nt.ERR_CODE.NORMAL,t.message="{0} should be no more than 255 letters",t.key=s,t}return t}var sa,s5=(sa=class{},sa.deviceInfoVerify=r5,sa.deviceInfoTitleVerify=yv,sa.deviceInfoDescriptionVerify=bv,sa.deviceInfoAttributesVerify=xv,sa.fetchDeviceItem=_v,sa);function n5(){return[["DOCTYPE","FOOTPRINT",""],["HEAD",{editorVersion:"dev",importFlag:0}],["CANVAS",0,0,"mm",5,5,5,5,5,5,2,2,5]].map(e=>JSON.stringify(e)).join(`
`)}function a5(e="",t="",i=""){let r=t||"[Empty Footprint Component Item]",s=new Date().getTime(),n=Bo(new Date(s)),a={avatar:"",nickname:"",username:"",uuid:""};return{$emptyItem:!0,createTime:s,created_at:n,creator:{...a},dataStr:e,description:"",display_title:r,docType:4,modifier:{...a},owner:{...a},path:nt.SYSTEMLIB_UUID,public:!1,source:"",std_uuid:"",tags:{child_tag:null,parent_tag:null},ticket:0,title:r,type:0,updateTime:s,updated_at:n,uuid:i||"",version:""}}var o5=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e))(o5||{});function l5(e){let t=null;return t=h5(e.title),t.success?{code:0,success:!0,message:"",key:void 0,result:null}:t}function h5(e){let t={code:0,success:!0,message:"",key:void 0,result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}var Ro,c5=(Ro=class{},Ro.footprintInfoVerify=l5,Ro.createEmptyFootprintItem=a5,Ro.createEmptyFootprintDataStr=n5,Ro),u5=(e=>(e.ERROR_DATA="Document data abnormality",e.COMPONENT_TITLE_OVER_SIZE="The title length must be between 1~128 characters!",e.COMPONENT_DESC_OVER_SIZE="Description should be no more than 255 letters",e))(u5||{});function d5(e){let t=null;return t=f5(e.title),!t.success||(t=p5(e.docType),!t.success)?t:{code:0,success:!0,message:"",key:void 0,result:null}}function f5(e){let t={code:0,success:!0,message:"",key:void 0,result:null};return(!e||e.length<=0||e.length>128)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="The title length must be between 1~128 characters!"),t}function p5(e){let t={code:0,success:!0,message:"",key:void 0,result:null};return(typeof e>"u"||!e)&&(t.code=nt.ERR_CODE.NORMAL,t.success=!1,t.message="Document data abnormality"),t}var Bh,_5=(Bh=class{},Bh.symbolInfoVerify=d5,Bh),Dp=(e=>(e.UNZIP="/pro-mgr/unzip",e.EXTRACT="/pro-mgr/unzip/extract",e.FLOW="/pro-mgr/unzip/flow",e.PARSE="/pro-mgr/unzip/parse",e.CHECK="/pro-mgr/unzip/check",e.GET_PROJECT_IN_CLOUD="/pro-mgr/getProjectInCloud",e.GET_PROJECT_IN_LOCAL="/pro-mgr/getProjectInLocal",e.GET_PROJECT_BY_IN_LOCAL="/pro-mgr/getProjectByInLocal",e.EXPORT_ZIP="/pro-mgr/export/zip",e.EXPORT_DOCUMENT="/pro-mgr/export/document",e.EXPORT_DEVICE="/pro-mgr/export/lib/device",e.EXPORT_SYMBOL="/pro-mgr/export/lib/symbol",e.EXPORT_FOOTPRIN="/pro-mgr/export/lib/footprint",e.EXPORT_PANEL_LIB="/pro-mgr/export/lib/panelLib",e.DOWNLOAD_PROJECT="/pro-mgr/export/download/project",e.DOWNLOAD_CBB="/pro-mgr/export/download/cbb",e.DOWNLOAD_DOCUMENT="/pro-mgr/export/download/document",e.BACKUP="/pro-mgr/backup",e.ARCHIVE="/pro-mgr/archive",e.LOAD_FILE="/pro-mgr/loadFile",e.CONVERT_PROJECT="/pro-mgr/convertProject/start",e.CONVERT_PROJECT_FLOWWIRTE="/pro-mgr/convertProject/flowWrite",e.CONVERT_PROJECT_FLOWREAD="/pro-mgr/convertProject/flowRead",e.IMPORT_NEW_PROJECT="/pro-mgr/importNewProject",e.PROJECT_AS_CLOUD="/pro-mgr/projectAsCloud",e.CBB_AS_CLOUD="/pro-mgr/cbbAsCloud",e.DOCUMENT_AS_CLOUD="/pro-mgr/documentAsCloud",e.COMPONENT_AS_CLOUD="/pro-mgr/componentAsCloud",e.IMPORT_TARGET_PROJECT="/pro-mgr/importTargetProject",e.UPDATE_BLOCK_SYMBOL_CONNECT="/pro-mgr/updateBlockSymbolConnect",e.IMPORT_SYMBOLS="/pro-mgr/importSymbols",e.IMPORT_FOOTPRINTS="/pro-mgr/importFootprints",e.IMPORT_DEVICES="/pro-mgr/importDevices",e.COPY_BOARD="/pro-mgr/copyBoards",e.COPY_SCHEMATIC="/pro-mgr/copySchematics",e.COPY_PAGE="/pro-mgr/copyPages",e.COPY_SCH_CANVAS="/pro-mgr/copySchCanvas",e.COPY_PCB_CANVAS="/pro-mgr/copyPcbCanvas",e.COPY_PANEL_CANVAS="/pro-mgr/copyPanelCanvas",e.PASTE_BOARD="/pro-mgr/pasteBoards",e.PASTE_SCHEMATIC="/pro-mgr/pasteSchematics",e.PASTE_PAGE="/pro-mgr/pastePages",e.PASTE_SCH_TOP="/pro-mgr/pasteSchTop",e.PASTE_PCB="/pro-mgr/pastePcb",e.PASTE_PANEL="/pro-mgr/pastePanel",e.PASTE_SCH_BOTTOM="/pro-mgr/pasteSchBottom",e.BUILD_EXPORT="/pro-mgr/buildExport",e.BUILD_TARGET="/pro-mgr/buildTarget",e.PARSE_PROJECT="/pro-mgr/parseProject",e.COMPARE_LOCAL="/pro-mgr/compare/local",e.COMPARE_CLOUD="/pro-mgr/compare/cloud",e.COMPARE_DESTORY="/pro-mgr/compare/destory",e.UPDATE_REUSE_BLOCK="/pro-mgr/updateReuseBlock",e))(Dp||{});var hX=Ru(Du());var cX=Ru(Du());var g5=(e=>(e[e.Free=1]="Free",e[e.Strict=3]="Strict",e))(g5||{});var O5=(e=>(e.name="name",e.default_sheet="default_sheet",e.cbb_project="cbb_project",e))(O5||{}),m5=(e=>(e.Export2_0="export2.0",e.Export3_0="export3.0",e.Target3_0="exist3.0",e))(m5||{});var uX=Ru(Du()),y5=(e=>(e[e.NONE=1]="NONE",e[e.CLIENT_BUT_UUID=2]="CLIENT_BUT_UUID",e[e.ONLINE_BUT_PATH=3]="ONLINE_BUT_PATH",e))(y5||{});var $r,b5=($r=class{},$r.D3Model=t5,$r.Device=s5,$r.Footprint=c5,$r.Symbol=_5,$r.deleteComponentItem=kx,$r.deleteComponents=l4,$r.fetchComponentItem=JM,$r.queryComponentsByTitle=yp,$r.pickUpComponentTags2Ids=Ux,$r.pickUpComponentTags2Names=Ml,$r.getDataStrById=An,$r.duplicateNameDetection=kl,$r),j2=class vl{static async getOldLibByNet(t){try{let{dataStrId:i,dataStr:r}=t;return i||r?{success:!0,result:(await Ge.messageBus.rpcCall("/pro-mgr/public/getDataStr",t)).message||""}:{success:!1,message:"Failed to obtain the source code of the existing component library!"}}catch(i){return{success:!1,message:i.message}}}static transform(t,i){let{uuid:r,docType:s}=i,n="";if(s===4){let a=i.isConnectDevice;n=kR(r,t,a)}else s===29?n=jR(r,t,xu.PANEL_LIB):_p(s)&&(n=GR(r,t).dataStr);return n}static async getOtherLibByNet(t){try{let{isProject:i,uuid:r,path:s,docType:n}=t;if(TD(t)){let h={ignoreDoctypeCheck:!0},c=(await b5.fetchComponentItem(i,r,s,n,h)).result;t=Object.assign(t,c)}let{history_uuid:a,dataStrId:o,dataStr:l}=t;if(a){let h={uuid:r,historyUuid:a},c=(await Ge.messageBus.rpcCall(Ha.COMPONENT.GET_HISTORY,h)).message;if(!c.success){let f=["Conversion component format failed!",c.message];return{success:!1,code:c.code,message:f}}return{success:!0,result:(await Ge.messageBus.rpcCall(Ha.COMPONENT.GET_HISTORY_DATA,[c.result])).message}}else if(o||l){let h=await vl.getOldLibByNet(t);if(!h.success){let d=["Conversion component format failed!",h.message];return{success:!1,code:h.code,message:d}}let c=h.result,f=vl.transform(c,t);return f?{success:!0,result:f}:{success:!1,message:["Conversion component format failed!","Illegal docType!"]}}else return{success:!0,result:""}}catch(i){return{success:!1,message:i.message}}}static async getOtherLibByWorker(t){try{let i=Ms();return{success:!0,result:await wD(`/${i._TAB_ID_}/libWorker`).rpcCall("/mgr/libWorker/getDataByType",t)}}catch(i){return{success:!1,message:i.message}}}static async getProjectLibByWorker(t){try{let{path:i,uuid:r,docType:s}=t,{message:n}=await Ge.messageBus.rpcCall("/pro-mgr/hasProject",[i]);return n?s===4?{success:!0,result:(await Ge.messageBus.rpcCall(at.FOOTPRINT.GET_STR,[r,i])).message||""}:_p(s)?{success:!0,result:(await Ge.messageBus.rpcCall(at.SYMBOL.GET_STR,[r,i])).message||""}:{success:!1,message:"Api call error! The api does not exist!"}:{success:!1,message:"Get project library data source Project is not open!"}}catch(i){return{success:!1,message:i.message}}}static async getExtendLib(t){var a,o;let{path:i,uuid:r}=t,s=await((o=(a=Or.getInstance().getLib(i))==null?void 0:a.footprint)==null?void 0:o.getTransformedDetail(r));if(!(s!=null&&s.dataStr))return{success:!1,message:["Conversion component format failed!","Failed to obtain the source code of the existing component library!"]};let n;return s.dataStr.trim().startsWith("[")?n=vl.transform(s.dataStr,t):n=s.dataStr,n?{success:!0,result:n}:{success:!1,message:["Conversion component format failed!","Illegal docType!"]}}static async getProLibSource(t){try{let{isProject:i,path:r}=t;return Or.getInstance().hasLib(r)?vl.getExtendLib(t):i?vl.getProjectLibByWorker(t):vl.getOtherLibByWorker(t)}catch(i){return{success:!1,message:i.message}}}},vv=(e=>(e.INIT_DB="/CommonDB/initDB",e))(vv||{}),Ev=(e=>(e.GET="/CommonDB/project/getData",e.GET_ALL="/CommonDB/project/getAllArrData",e))(Ev||{}),Tv=(e=>(e.GET="/CommonDB/copyAndPaste/getData",e.SET="/CommonDB/copyAndPaste/setData",e.IS_EXIST="/CommonDB/copyAndPaste/isExist",e.GET_DATA_FROM_PCB_CANVAS="/CommonDB/copyAndPaste/getDataFromPcbCanvas",e))(Tv||{}),wv=(e=>(e.GET="/CommonDB/copyAndPasteTableCell/getData",e.SET="/CommonDB/copyAndPasteTableCell/setData",e.IS_EXIST="/CommonDB/copyAndPasteTableCell/isExist",e))(wv||{}),Sv=(e=>(e.SET="/CommonDB/log/setData",e.DEL="/CommonDB/log/delData",e.DEL_LOTS="/CommonDB/log/delLotsData",e.GET_ALL="/CommonDB/log/getAllArrData",e))(Sv||{}),Iv=(e=>(e.SET="/CommonDB/basicLibraryList/addData",e.GET="/CommonDB/basicLibraryList/getData",e.IS_EXIST="/CommonDB/basicLibraryList/isExist",e))(Iv||{}),Pv=(e=>(e.SET="/CommonDB/clipBoard/addData",e.GET="/CommonDB/clipBoard/getData",e.IS_EXIST="/CommonDB/clipBoard/isExist",e))(Pv||{}),Av=(e=>(e.GET="/CommonDB/lockPrj/getData",e.READ_WRITE="/CommonDB/lockPrj/readwriteData",e))(Av||{}),Cv=(e=>(e.GET="/CommonDB/prjCache/getData",e.SET="/CommonDB/prjCache/addData",e.DEL="/CommonDB/prjCache/delData",e.DEL_LOTS="/CommonDB/prjCache/delLotsData",e.GET_INDEXS="/CommonDB/prjCache/getAllIndexs",e.GET_COUNT="/CommonDB/prjCache/getCount",e.GET_EARLIEST="/CommonDB/prjCache/getEarliest",e))(Cv||{}),Mp={COMMON:vv,PROJECT:Ev,COPYANDPASTE:Tv,COPYANDPASTE_TABLE_CELL:wv,LOG:Sv,LIB:Iv,CLIP_BOARD:Pv,LOCK_PROJECT:Av,PROJECT_CACHE:Cv},x5=(e=>(e.CREATE="/pro-mgr/library/cbb/create",e.GET_EXPORT="/pro-mgr/library/cbb/getExport",e.GET_TARGET="/pro-mgr/library/cbb/getTarget",e.LIST="/pro-mgr/library/cbb/list",e.PLACE="/pro-mgr/library/cbb/place",e))(x5||{}),v5=(e=>(e.CREATE="/pro-mgr/new/cloud/create",e.PROJECT="/pro-mgr/new/cloud/project",e.BOARD="/pro-mgr/new/cloud/board",e.SCHEMATIC="/pro-mgr/new/cloud/schematic",e.SHEET="/pro-mgr/new/cloud/sheet",e.SIMULATION="/pro-mgr/new/cloud/simulation",e.PCB="/pro-mgr/new/cloud/pcb",e.PANEL="/pro-mgr/new/cloud/panel",e))(v5||{}),E5=(e=>(e.BOARD="/pro-mgr/new/local/board",e.SCHEMATIC="/pro-mgr/new/local/schematic",e.SHEET="/pro-mgr/new/local/sheet",e.SIMULATION="/pro-mgr/new/local/simulation",e.PCB="/pro-mgr/new/local/pcb",e.PANEL="/pro-mgr/new/local/panel",e))(E5||{});var T5=(e=>(e.FORCE="/pro-mgr/project/updateData/force",e.SUSPEND="/pro-mgr/project/updateData/suspend",e.RESUME="/pro-mgr/project/updateData/resume",e.GET="/pro-mgr/project/updateData/getLastest",e.IS_PUBLIC="/pro-mgr/project/updateData/isPublic",e.UPDATE_TEAM="/pro-mgr/project/updateData/updateTeam",e))(T5||{}),w5=(e=>(e.UPDATE="/pro-mgr/project/updateData/schematic/update",e.GET="/pro-mgr/project/updateData/schematic/getData",e.MAP="/pro-mgr/project/updateData/schematic/map",e.NOTIFY="/pro-mgr/project/updateData/schematic/notify",e))(w5||{}),S5=(e=>(e.UPDATE="/pro-mgr/project/updateData/sheet/update",e.GET="/pro-mgr/project/updateData/sheet/getData",e.MAP="/pro-mgr/project/updateData/sheet/map",e.NOTIFY="/pro-mgr/project/updateData/sheet/notify",e))(S5||{}),I5=(e=>(e.UPDATE="/pro-mgr/project/updateData/pcb/update",e.GET="/pro-mgr/project/updateData/pcb/getData",e.MAP="/pro-mgr/project/updateData/pcb/map",e.NOTIFY="/pro-mgr/project/updateData/pcb/notify",e))(I5||{}),P5=(e=>(e.UPDATE="/pro-mgr/project/updateData/symbol/update",e.GET="/pro-mgr/project/updateData/symbol/getData",e.MAP="/pro-mgr/project/updateData/symbol/map",e.NOTIFY="/pro-mgr/project/updateData/symbol/notify",e))(P5||{}),A5=(e=>(e.UPDATE="/pro-mgr/project/updateData/footprint/update",e.GET="/pro-mgr/project/updateData/footprint/getData",e.MAP="/pro-mgr/project/updateData/footprint/map",e.NOTIFY="/pro-mgr/project/updateData/footprint/notify",e))(A5||{}),C5=(e=>(e.UPDATE="/pro-mgr/project/updateData/device/update",e.GET="/pro-mgr/project/updateData/device/getData",e.MAP="/pro-mgr/project/updateData/device/map",e.NOTIFY="/pro-mgr/project/updateData/device/notify",e))(C5||{});var Bp=(e=>(e.PROGRESS="/pro-ui/progressUpdate",e.OPENED_PROJECT="/pro-ui/project/openedProject",e.HAS_UNSAVED="/pro-ui/project/hasUnsaved",e.OPEN="/pro-ui/project/open",e.CLOSE="/pro-ui/project/close",e.ON_OPENED="/pro-ui/project/onOpened",e.ON_FAILED="/pro-mgr/project/onFailed",e.ON_CLOSED="/pro-ui/project/onClosed",e.ADD_HASH="/pro-ui/hash/add/id",e.REMOVE_HASH="/pro-ui/hash/remove/id",e))(Bp||{}),Nv=(e=>(e.ON_UPDATE="/pro-mgr/project/project/onUpdate",e.UPLOAD_FAILED="/pro-mgr/project/upload/onfailed",e))(Nv||{}),Lv=(e=>(e.ON_UPDATE="/pro-mgr/project/config/onUpdate",e))(Lv||{}),Rv=(e=>(e.ON_ADD="/pro-mgr/project/board/onAdd",e.ON_DELETE="/pro-mgr/project/board/onDelete",e.ON_UPDATE="/pro-mgr/project/board/onUpdate",e))(Rv||{}),Dv=(e=>(e.ON_ADD="/pro-mgr/project/schematic/onAdd",e.ON_DELETE="/pro-mgr/project/schematic/onDelete",e.ON_UPDATE="/pro-mgr/project/schematic/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/schematic/onUpdateTime",e))(Dv||{}),Mv=(e=>(e.ON_ADD="/pro-mgr/project/sheet/onAdd",e.ON_DELETE="/pro-mgr/project/sheet/onDelete",e.ON_UPDATE="/pro-mgr/project/sheet/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/sheet/onUpdateTime",e))(Mv||{}),Bv=(e=>(e.ON_ADD="/pro-mgr/project/pcb/onAdd",e.ON_DELETE="/pro-mgr/project/pcb/onDelete",e.ON_UPDATE="/pro-mgr/project/pcb/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/pcb/onUpdateTime",e))(Bv||{}),kv=(e=>(e.ON_ADD="/pro-mgr/project/panel/onAdd",e.ON_DELETE="/pro-mgr/project/panel/onDelete",e.ON_UPDATE="/pro-mgr/project/panel/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/panel/onUpdateTime",e))(kv||{}),Uv=(e=>(e.ON_ADD="/pro-mgr/project/simulation/onAdd",e.ON_DELETE="/pro-mgr/project/simulation/onDelete",e.ON_UPDATE="/pro-mgr/project/simulation/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/simulation/onUpdateTime",e))(Uv||{}),Fv=(e=>(e.ON_ADD="/pro-mgr/project/device/onAdd",e.ON_DELETE="/pro-mgr/project/device/onDelete",e.ON_UPDATE="/pro-mgr/project/device/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/device/onUpdateTime",e))(Fv||{}),Gv=(e=>(e.ON_ADD="/pro-mgr/project/symbol/onAdd",e.ON_DELETE="/pro-mgr/project/symbol/onDelete",e.ON_UPDATE="/pro-mgr/project/symbol/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/symbol/onUpdateTime",e))(Gv||{}),zv=(e=>(e.ON_ADD="/pro-mgr/project/footprint/onAdd",e.ON_DELETE="/pro-mgr/project/footprint/onDelete",e.ON_UPDATE="/pro-mgr/project/footprint/onUpdate",e.ON_UPDATETIME="/pro-mgr/project/footprint/onUpdateTime",e))(zv||{}),Hv=(e=>(e.ON_ADD="/pro-mgr/project/attr/onAdd",e.ON_DELETE="/pro-mgr/project/attr/onDelete",e.ON_UPDATE="/pro-mgr/project/attr/onUpdate",e))(Hv||{}),jv=(e=>(e.ON_ADD="/pro-mgr/project/blob/onAdd",e.ON_DELETE="/pro-mgr/project/blob/onDelete",e.ON_UPDATE="/pro-mgr/project/blob/onUpdate",e))(jv||{}),Yv=(e=>(e.ON_ADD="/pro-mgr/project/variant/onAdd",e.ON_DELETE="/pro-mgr/project/variant/onDelete",e.ON_UPDATE_TITLE="/pro-mgr/project/variant/onUpdatetitle",e.ON_UPDATE_NOT_GROUPED="/pro-mgr/project/variant/onUpdateNotGrouped",e.ON_UPDATE_ZINDEX="/pro-mgr/project/variant/onUpdateZIndex",e.ON_ADD_COMPONENT_GROUP="/pro-mgr/project/variant/onAddComponentGroup",e.ON_DELETE_COMPONENT_GROUP="/pro-mgr/project/variant/onDeleteComponentGroup",e.ON_UPDATE_COMPONENT_GROUP_TITLE="/pro-mgr/project/variant/onUpdateComponentGroupTitle",e.ON_UPDATE_COMPONENT_GROUP_ZINDEX="/pro-mgr/project/variant/onUpdateComponentGroupZIndex",e.ON_UPLOAD_COMPONENT_GROUP_INDEX_IN_VARIANT="/pro-mgr/project/variant/onUploadComponentGroupZIndexInVariant",e.ON_DELETE_COMPONENT_GROUP_INDEX_IN_VARIANT="/pro-mgr/project/variant/onDeleteComponentGroupZIndexInVariant",e.ON_UPLOAD_COMPONENT_GROUP_DATA="/pro-mgr/project/variant/onUploadComponentGroupData",e.ON_DELETE_COMPONENT_GROUP_DATA="/pro-mgr/project/variant/onDeleteComponentGroupData",e))(Yv||{}),qu={PROJECT:Nv,CONFIG:Lv,BOARD:Rv,SCHEMATIC:Dv,SHEET:Mv,PCB:Bv,PANEL:kv,SIMULATION:Uv,DEVICE:Fv,SYMBOL:Gv,FOOTPRINT:zv,ATTR:Hv,BLOB:jv,VARIANT:Yv};var dX=new Error("list is empty");var N5=(e=>(e.ALL_VALUE="@all",e.ALL_TITLE="All",e.ComponentSymbol="2",e.NetflagSymbol="18",e.NetportSymbol="19",e.DrawingSymbol="20",e.NonElectronicSymbol="21",e.OffPageConnectorSymbol="25",e.DiffPairsFlagSymbol="31",e))(N5||{});async function Vv(){let e=await new Promise(t=>{fetch("/api/client/config",{method:"GET"}).then(i=>{i.json().then(r=>{t(r)})})});if(e&&e.success&&e.result){let t=e.result,i=t.projectDir instanceof Array?t.projectDir:[t.projectDir];return{basePath:t.appBaseDir,cbbPath:t.reuseBlock,libPath:t.systemLib,projectPath:i,onlinePrjBackupPath:t.appOnlineBackupDir,appBaseDir:t.appBaseDir,autoCheckVersionUpdate:!!t.checkUpdate,activation:t.activation,appTmpBackupDir:t.appTmpBackupDir,cacheDir:t.cacheDir,proxy:t.proxy,log:t.log}}else return null}function kp(e,t){let i=[],r=[];vp?r=e:t&&t.length?r=t:r=e;let s=null;return r.forEach(n=>{n.uuid===nt.SYSTEMLIB_UUID?s={title:n.nickname,id:n.uuid,key:nt.LIB_SYSTEM_KEY}:i.push({title:n.nickname,id:n.uuid,key:nt.LIB_PERSONAL_KEY})}),s&&i.unshift(s),i}async function Up(e,t){let i=kp(e,t)||[],r=[],s=null;return i.forEach((n,a)=>{n.id===nt.SYSTEMLIB_UUID?s=a:r.push({title:n.title,id:n.id,key:n.key})}),(s||s===0)&&r.splice(0,0,{title:i[s].title,id:i[s].id,key:i[s].key}),r.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...r]}async function L5(e,t){let i=await Vv();if(!i)return await Up(e,t);let r=kp(e,t),s=fs(r,"id",nt.SYSTEMLIB_UUID),n=[];s.index>=0&&n.splice(0,0,{...s.data});let{projectPath:a,cbbPath:o,libPath:l=[],onlinePrjBackupPath:h,autoCheckVersionUpdate:c}=i;return l.forEach(f=>{n.push({title:Y2(f),id:f,key:f})}),n.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...n]}function R5(e,t,i,r){let s=[],n=[],a={},o=[];return e.forEach(l=>{switch(l.titleAdditional=l.title,l.title){case"Project":{if(!r||!i||!i.uuid)return;l.id=i.uuid,o.push(i.uuid);break}default:}l.id||(l.id="@"+Lu(new Date().getTime())),typeof a[l.id]<"u"?(a[l.id]+=1,l.id=l.id+nt.LIB_SPLIT_TAG+a[l.id]):a[l.id]=0,t&&t.indexOf(l.id)>=0&&n.push(l.id),s.push(l)}),{treeData:s,projectsIds:o,selectedIds:n}}async function qv(e,t){let i=kp(e,t)||[],r=[],s=null;return i.forEach((n,a)=>{n.id===nt.SYSTEMLIB_UUID?s=a:r.push({title:n.title,id:n.id,key:n.key})}),(s||s===0)&&r.splice(0,0,{title:i[s].title,id:i[s].id,key:i[s].key}),r.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...r]}async function D5(e,t){let i=await Vv();if(!i)return await Up(e,t);let r=[],{projectPath:s,cbbPath:n,libPath:a=[],onlinePrjBackupPath:o,autoCheckVersionUpdate:l}=i;return a.forEach(h=>{r.push({title:Y2(h),id:h,key:h})}),r.splice(1,0,{title:"Project",id:"",key:nt.LIB_PROJECT_KEY}),[...r]}function M5(e,t,i,r){let s=[],n=[],a={},o=[];return e.forEach(l=>{switch(l.titleAdditional=l.title,l.title){case"Project":{if(!r||!i||!i.uuid)return;l.id=i.uuid,o.push(i.uuid);break}default:}l.id||(l.id="@"+Lu(new Date().getTime())),typeof a[l.id]<"u"?(a[l.id]+=1,l.id=l.id+nt.LIB_SPLIT_TAG+a[l.id]):a[l.id]=0,t&&t.indexOf(l.id)>=0&&n.push(l.id),s.push(l)}),{treeData:s,projectsIds:o,selectedIds:n}}function Xv(e,t){let i=[],r=[];return vp?r=e:t&&t.length?r=t:r=e,r.forEach(s=>{i.push({title:s.nickname,id:s.uuid,key:nt.LIB_TEMAS_KEY})}),i}async function bp(e,t){let i=Xv(e,t);return[{title:"System",id:nt.SYSTEMLIB_UUID,key:nt.LIB_SYSTEM_KEY},{title:"Project",id:"",key:nt.LIB_PROJECT_KEY},{title:"Personal",id:"",key:nt.LIB_PERSONAL_KEY},{title:"Favorite",id:nt.FAVORITELIB_UUID,key:nt.LIB_FAVORITE_KEY},...i]}function Wv(e,t,i,r,s){let n=[],a=[],o={},l=[];return e.forEach(h=>{switch(h.title){case"Project":{if(!s||!r||!r.uuid)return;h.id=r.uuid,l.push(r.uuid);break}case"Personal":{if(!i||!i.uuid)return;h.id=i.uuid;break}case"Public":{h.id=nt.PUBLICLIB_ALIAS;break}default:}h.id||(h.id="@"+Lu(new Date().getTime())),typeof o[h.id]<"u"?(o[h.id]+=1,h.id=h.id+nt.LIB_SPLIT_TAG+o[h.id]):o[h.id]=0,t&&t.indexOf(h.id)>=0&&a.push(h.id),n.push(h)}),{treeData:n,projectsIds:l,selectedIds:a}}async function am(e,t){return await bp(e,t)}function B5(e,t,i,r,s){return Wv(e,t,i,r,s)}async function Jv(e,t,i,r,s,n){let a=[];return e==="Normal"?Sn?rp?(a=await am(t,i),n&&Hf(a),a):ip?(a=await Up(t,i),n&&Hf(a),a):(a=await qv(t,i),n&&Hf(a),a):(a=await bp(t,i),n&&Hf(a),a):e==="D3Model"?Sn?rp?(a=await am(t,i),a):ip?(a=await L5(t,i),a):(a=await D5(t,i),a):(a=await bp(t,i),a):[]}function Hf(e){let t=fs(e,"key",nt.LIB_PROJECT_KEY);t.index>=0&&e.splice(t.index,1)}function Zv(e,t,i,r,s,n,a){if(!Sn){let l=Wv(e,i,r,s,typeof n<"u"?!!n:a);return jf(l,t),Yf(l)}if(rp){let l=B5(e,i,r,s,typeof n<"u"?!!n:a);return jf(l,t),Yf(l)}if(ip){let l=R5(e,i,s,typeof n<"u"?!!n:a);return jf(l,t),Yf(l)}let o=M5(e,i,s,typeof n<"u"?!!n:a);return jf(o,t),Yf(o)}function jf(e,t){let i=fs(e.treeData,"key",nt.LIB_SYSTEM_KEY);i.index>=0&&e.treeData.splice(i.index,1);let r=fs(e.treeData,"key",nt.LIB_PERSONAL_KEY);r.index>=0&&e.treeData.splice(r.index,1);let s=fs(e.treeData,"key","project");s.index>=0&&e.treeData.splice(s.index,1);let n=fs(e.treeData,"key",nt.LIB_FAVORITE_KEY);n.index>=0&&e.treeData.splice(n.index,1);let a=fs(e.treeData,"key","selected");a.index>=0&&e.treeData.splice(a.index,1);let o=fs(e.treeData,"key","oshwhub");o.index>=0&&e.treeData.splice(o.index,1),e.treeData.sort((l,h)=>(l.title||"").localeCompare(h.title||"")),n.index>=0&&e.treeData.unshift(n.data),s.index>=0&&e.treeData.unshift(s.data),t==="Personal"?vp||r.index>=0&&e.treeData.unshift(r.data):e.selectedIds=e.selectedIds.filter(l=>{var h;return l!==((h=r==null?void 0:r.data)==null?void 0:h.id)}),o.index>=0&&e.treeData.unshift(o.data),i.index>=0&&e.treeData.unshift(i.data),a.index>=0&&e.treeData.push(a.data)}function Yf(e){return e.selectedIds.length?e.selectedIds:e.selectedIds.push(e.treeData[0].id),e}async function k5(e,t,i,r,s,n,a,o,l=!0,h=!0,c=!0){let f={username:n.username,uuid:n.uuid},{projectId:d,title:u,isCBB:p}=s,_={uuid:d,title:u,isCBB:p},g=await Jv(t,a,o,e,i,l),b=Zv(g,r,[],f,_,!l),m=[];for(let O=0;O<b.treeData.length;O++){let y=b.treeData[O];y.id===nt.SYSTEMLIB_UUID&&h||y.id===nt.FAVORITELIB_UUID&&c||(Tp||wp||y.key===nt.LIB_PERSONAL_KEY&&(y.title=y.titleAdditional=f.username),y.title&&m.push(y))}return m}var U5=(e=>(e.Normal="Normal",e.D3Model="D3Model",e.AssociateDeviceDialog="associateDeviceDialog",e.Cbb="Cbb",e))(U5||{}),Ls,fX=(Ls=class{},Ls.createInitLibList=Jv,Ls.createFixLibList=k5,Ls.filterInitLibList=Zv,Ls.fetchTeamsLibsFromGVars=Xv,Ls.fetchClientTeamsLibsFromGVars=kp,Ls.createSourceLibListByWebMode=bp,Ls.createSourceLibListByOnlineClientMode=am,Ls.createSourceLibListByOfflineClientMode=qv,Ls.createSourceLibListByHalfofflineClientMode=Up,Ls),kh,pX=(kh=class{},kh.syncLoginedUserInfo=t=>{Ge.loginedUserUuid=t.uuid},kh);var F5=(e=>(e.PROJECT="project.json",e.DEVICE="device.json",e.SYMBOL="symbol.json",e.FOOTPRINT="footprint.json",e.PANEL_LIB="panel-lib.json",e.PROJECT2="project2.json",e.DEVICE2="device2.json",e.SYMBOL2="symbol2.json",e.FOOTPRINT2="footprint2.json",e.PANEL_LIB2="panel-lib2.json",e))(F5||{}),G5=(e=>(e.EXPORT_DEVICE="EXPORT_DEVICE",e.EXPORT_SYMBOL="EXPORT_SYMBOL",e.EXPORT_FOOTPRINT="EXPORT_FOOTPRINT",e.EXPORT_PANEL_LIB="EXPORT_PANEL_LIB",e))(G5||{});SP();var Kv="3.1.54",$v="10/29/2025";var Ze={ui_instance:!1,ui_module:!0,messageBus:void 0,windowBridge:void 0,pcbMessageBus:void 0,moveRocord:void 0,moveRocordNext:void 0,selectBox1:void 0,gControlDots:void 0,gRotateHelper:void 0,gControlRects:void 0,gControlLines:void 0,gCopperAreaOutlineCushions:void 0,gPanelizedOutlines:void 0,gPanelizedOutlinesOverG1:void 0,gCanvas:void 0,Canvas:void 0,doctype:void 0,cmdToken:void 0,gZoom:1,currZoom:100,jsonMgr:void 0,svgRoot:void 0,activeElement:void 0,helperCursor:void 0,showControlDots:void 0,_RotateCache:{},moveAction:void 0,localStorageDisabled:void 0,data3D:void 0,defaultImage:{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA1MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSIxIiB5PSIxIiB3aWR0aD0iNDgiIGhlaWdodD0iMzgiIGZpbGw9IiNGRkYiIHN0cm9rZT0iI0NDQyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBvbHlsaW5lIHBvaW50cz0iMS41LDIzLDE2LDEzLDM0LDI2LDQ4LjUsMjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0NDQyIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMzUiIGN5PSIxMiIgcj0iNCIgZmlsbD0iI0NDQyIgc3Ryb2tlPSJub25lIi8+PC9zdmc+",width:50,height:40},worker:void 0,tearDropWorker:null,notCheckPrefix:void 0,drawing:void 0,loading:void 0,userAvatar:void 0,loginHandle:void 0,isMouseOnEditFrame:!1,isOn3dView:void 0,terminalWorker:void 0,hoverCache:void 0,contextmenuDisableOnce:void 0,pcbNetTextVisible:void 0,gRecover:void 0,gNets:void 0,updateNetTextTimer:void 0,netTextCharWidth:void 0,helperCursorConfig:{},rotateParts:void 0,waveFormObj:void 0,setCanvas:void 0,preMgr:void 0,sheetMgr:void 0,findShape:void 0,moveSelectedObjs:void 0,rotateSelectedObjs:void 0,vectorEffectSupported:void 0,modifyText:void 0,prjData:void 0,importChanges:void 0,DragAction:void 0,DragAction2:void 0,DragAction3:void 0,Draw:void 0,toggleTrackWidthPanel:void 0,arrowKeyMove:void 0,importShape:void 0,zoom:void 0,getCanvas:void 0,moveSelectedObjsTo:void 0,bringSelectedObjsToFront:void 0,sendSelectedObjsToBack:void 0,getComponents:void 0,isDragging:void 0,groupSymbol:void 0,cutSelectedObjs:void 0,copySelectedObjs:void 0,pasteFromGlobalClipboard:void 0,pasteFromClipboardAfterCloseRatline:void 0,cloneObjects:void 0,flipSelectedObjects:void 0,attrpanelApply:void 0,attrpanelGetData:void 0,deletePathNode:void 0,dragMoveSwitch:void 0,dragMoveCheck:void 0,dragMoveEndHandlerForPaste:void 0,importJsonCache:void 0,fixedDecimal:!1,decimalPlaces:2,decimalPlacesShow:2,schDecimalPlaces:2,schDecimalPlacesShow:2,pcbDecimalPlaces:4,pcbDecimalPlacesShow:3,pcbServersFonts:["NotoSerifCJKsc-Medium","NotoSansCJKjp-DemiLight"],pcbFontsRegExp:/[^!"\\#\$%&'`\(\)\*\+,\-\.\/a-zA-z0-9:<;\=\?>@\[\]\^_\{\|\}~\s\t\r\n]/,checkNotificationInterval:12e4,checkUpdateInterval:36e5,saveFileTimeout:3e5,autoSaveMaxCount:1e3,autoSaveMaxBackupLevel:10,autoGzipAjaxPostSize:1e4,cooperationSites:["elektroda","amobbs","allaboutcircuits","diyaudio","hifidiy","edaboard"],cushionShape:null,cushionShapeFor:null,fileOperationAPI:"/EditorBridge/fileOperation",svgFileAPI:"/EditorBridge/svgFile",treeDataAPI:"/EditorBridge/treeData",anonymousPid:"441bd07389f646ac82c8d1dbc45a6021",version:"V"+Kv,buildDate:$v,lcscUUID:"0819f05c4eef4c71ace90d822a990e87",easyedaUUID:"4251c6ae97414f38bb1d929da02c4173",ignoreConfirmClose:!1,globalVariableCookieData:{},teams:[],networkWarn:"Network Error! Please check your network and try again!",updatePcbFileInfo:[],multiSelect:!1,copperNetRelation:{},isSaving:!1,pasteCount:0,pasteFrom:null,canvasStrTolerance:10,logTypes:{BOM_EXPORT:1,BOM_LCSC:2,GERBER_DOWNLOAD:3,GERBER_JLC:4},apis:{model:{upload:"/api/3dmodel/upload"}},deleteObjs:void 0,currentProject:{projectId:void 0,title:void 0},blockSymbolAttr:void 0,selectableObjMap:{SCH:{symbol:!0,wire:!0,pin:!1,name:!0,property:!0,text:!0,arc:!0,rect:!0,circle:!0,polyline:!0,table:!0,sheet:!0},SYMBOL:{pin:!0,name:!0,property:!0,text:!0,arc:!0,rect:!0,circle:!0,polyline:!0}},importFileDataStr:void 0,profileSetting:null,defaultFont:null,batchExportInfo:null,extensionApiMessageBus2:void 0},pZ=(function(){try{var e=location.hostname;return e.indexOf("lceda")>-1?"lceda":(e.indexOf("easyeda")>-1,"easyeda")}catch{}})(),_Z=(function(){try{var e=location.hostname,t=e.split(".");return t.length>2?t.length===3&&(t[0]==="www"||t[0]==="alpha")?"online":"dev":"online"}catch{}})();var bf=lO(zp());var Wu=class{constructor(t){this.ticket=0;this.promise=new Promise((i,r)=>{this.resolve=i,this.reject=r,t==null||t(i,r)})}then(t){return this.promise.then(t)}lock(){this.ticket++}release(t){this.ticket--,this.ticket<0&&this.resolve(t)}};var Hp=class{constructor(){this.copyTask=new Wu(t=>t());Ze.messageBus.rpcService("copyData",this.copy.bind(this)),Ze.messageBus.subscribe("pasteData",this.paste.bind(this))}async copy(t){this.copyTask=new Wu;let i={head:t.head,data:t.data,doctype:t.doctype};this.copyProjectId=Ze.currentProject.projectId;let{template:r,blobTemplete:s}=t,n=await p6(r),a=new Set;for(let h of s)a.add(h.hashId);n.blobs=Array.from(a);let o=!0;return o=(await Ze.messageBus.rpcCall(Dp.COPY_PCB_CANVAS,{datas:n})).message.success,o&&(o=await _6("PCB_clipboard",i)),this.copyTask.resolve(null),o}async paste(t){await this.copyTask.promise,Ze.messageBus.rpcCall(Mp.CLIP_BOARD.GET,["PCB_clipboard"]).then(async({message:i})=>{var r,s;if(!i){Ze.messageBus.publish("pcb/paste",null);return}if(i.head.uuid!==t.uuid&&(i=await f6(i)),i.action&&i.action=="close"){Ze.messageBus.publish("pcb/paste",null);return}try{let n=new Date().getTime(),a={},o=i.doctype==3&&t.doctype==4;if(o){let h=(await Ze.messageBus.rpcCall(Mp.COPYANDPASTE.GET)).message;i.componentParts=(r=h==null?void 0:h.canvas.PcbCanvas)==null?void 0:r.canvas}if(Ze.currentProject.projectId&&!o){let h=t.uuid,c=t.title,f=(await Ze.messageBus.rpcCall(Dp.PASTE_PCB,{target:{pcb:{uuid:h,title:c}}})).message;if(f.success){let d=f.result.map;d&&((s=Object.keys(d))==null?void 0:s.length)>0&&(a.deviceMap=d.deviceMap,a.footprintMap=d.footprintMap,a.blobMap=d.blobMap)}}if(Object.keys(a).length>0){let{deviceMap:h={},footprintMap:c={},blobMap:f={}}=a;for(let d in i.data){let u=i.data[d];for(let p=0;p<u.length;p++){let _=JSON.parse(u[p]);if(_.device){let g=h[_.device];g||console.error(`add device error deviceUuid: ${_.device}`),_.device=g,_.deviceUUID=g}if(_.footprint){let g=c[_.footprint];g||console.error(`add footprint error footprintUuid: ${_.footprint}`),_.footprint=g}if(_.custom){let g=c[_.custom];g||console.error(`add footprint error footprintUuid: ${_.custom}`),_.custom=g}if(_.hashId){let g=f[_.hashId];g||console.error(`add blob error blobHashId: ${_.hashId}`),_.hashId=g}u[p]=JSON.stringify(_)}}}new Date().getTime()-n>3e3&&Ze.messageBus.publish("progressUpdate",[1,"importing..."]),Ze.messageBus.publish("pcb/paste",{copyData:i,map:a})}catch(n){throw new Error(n)}})}};async function f6(e){var n;let{message:t}=await Ze.messageBus.rpcCall("ui/getAllEnableLayer"),i=new Set(t),r=[],s=new Set;if((n=e.head)!=null&&n.layerInfos)for(let[a,o]of Object.entries(e.head.layerInfos)){let l=Number(a);i.has(l)||(r.push({layerId:l,layerInfo:o}),s.add(l))}if(r.length){let{message:a}=await Ze.messageBus.rpcCall("hasUnableLayerObj",[r]);if(a.action==="unOpen"){for(let o in e.data)e.data[o]=e.data[o].filter(l=>{let h=/"layerId"\s*:\s*(\d+)/.exec(l),c=h?Number(h[1]):null;return!c||!s.has(c)}),e.data[o].length===0&&delete e.data[o];Object.keys(e.data).length===0&&(e.action="close")}else a.action==="close"&&(e.action="close")}return e}async function p6(e){var n,a;let t=[],i=[],r=[],s={};for(let o=0;o<e.length;o++){let l=e[o].deviceUuid,h=s[l];h==null&&(h=await(await Ze.messageBus.rpcCall(at.DEVICE.GET,[l,Ze.currentProject.projectId])).message,s[l]=h,t.push(l));let c=e[o].footprintUuid,f=s[c];f==null&&(f=await(await Ze.messageBus.rpcCall(at.FOOTPRINT.GET,[c,Ze.currentProject.projectId])).message,s[c]=f,i.push(c));let d=((n=h.symbol)==null?void 0:n.uuid)||h.attributes.Symbol,u=s[d];u==null&&d!=null&&(u=(await Ze.windowBridge.rpcCall(at.SYMBOL.GET,[d,Ze.currentProject.projectId],Ms())).message,u&&(s[d]=u,r.push(d)));let p=((a=h.footprint)==null?void 0:a.uuid)||h.attributes.Footprint;if(p){let g=s[p];g==null&&(g=(await Ze.messageBus.rpcCall(at.FOOTPRINT.GET,[p,Ze.currentProject.projectId])).message,g&&(s[p]=g,i.push(p)))}let _=e[o].customFootprintUuid;_&&i.push(_)}return{devices:t,footprints:i,symbols:r}}async function _6(e,t){return(await Ze.messageBus.rpcCall(Mp.CLIP_BOARD.SET,[e,t])).message}var hE={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},VZ=(()=>{let e={};for(let t in hE)e[hE[t]]=t;return e})();var jp=class jp{constructor(t,i){this.ratio=t/i}wrap(t){return t*this.ratio}static convert(t,i,r){return t*i/r}};jp.ASIS=new jp(1,1);var cE=jp;var uE="http://www.w3.org/2000/svg",dE="http://www.w3.org/1999/xlink",fE="http://www.w3.org/XML/1998/namespace",pE="https://easyeda.com/",XZ=(function(){var e={svg:uE,xlink:dE,xml:fE,c:pE};return e[uE]="svg",e[dE]="xlink",e[fE]="xml",e[pE]="c",e})();var Ji=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),WZ=(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};e["3D"]=(function(){for(var s=[16,19,3,7,5,1],n=21;n<52;n++)s.push(n+32,n);return s.push(2,6,8,4,17),s})();var t,i,r;for(t in e)if(e.hasOwnProperty(t)&&(r=e[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(i=25;i<=52;i++)r.push(i);return e})(),Cr=(function(){var e={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<53;t++)e[t]="Inner"+(t-20);for(t=53;t<85;t++)e[t]="Substrate"+(t-52);return e})(),JZ=(function(){var e=[],t=[];for(var i in Ji)if(Ji.hasOwnProperty(i)){if(i.match(/^BOARD\d+/))continue;e.push(Ji[i])}e.sort(),t.sort();var r={},s,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};e.forEach(function(o){switch(o){case Ji.TOPLAYER:s={name:Cr[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case Ji.BOTTOMLAYER:s={name:Cr[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case Ji.TOPSILKLAYER:s={name:Cr[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case Ji.BOTTOMSILKLAYER:s={name:Cr[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case Ji.TOPPASTERLAYER:s={name:Cr[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case Ji.BOTTOMPASTERLAYER:s={name:Cr[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case Ji.TOPSOLDERLAYER:s={name:Cr[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case Ji.BOTTOMSOLDERLAYER:s={name:Cr[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case Ji.RATLINES:s={name:Cr[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case Ji.BOARDOUTLINE:s={name:Cr[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case Ji.ALL:s={name:Cr[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case Ji.DOCUMENT:s={name:Cr[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case Ji.TOPASSEMBLY:s={name:Cr[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case Ji.BOTTOMASSEMBLY:s={name:Cr[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case Ji.MECHANICAL:s={name:Cr[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case Ji.MODEL3D:s={name:Cr[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case Ji.LIBBODY:s={name:Cr[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case Ji.PADSURFACE:s={name:Cr[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=Ji.INNER1&&o<=Ji.INNER32?s={name:Cr[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:s=null;break}s&&(r[o]=s)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var l=parseInt(RegExp.$1,16),h=.5,c=Math.min(255,Math.round((l>>16)*h)),f=Math.min(255,Math.round((l>>8&255)*h)),d=Math.min(255,Math.round((l&255)*h)),u=((c<<16)+(f<<8)+d).toString(16);return"#"+("00000"+u).substr(-6).toUpperCase()}return r})(),Yp={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,PCB2D:31,PCB3D:32},ZZ=(function(){var e={};for(let t in Yp)e[Yp[t]]=t;return e})();async function gE(e){let{models:t,unit:i,owner:r,tags:s,uuid:n}=e,a=!1,o=[];for(let l of t)try{let h=l.source,c=await O6(h.type==="step"?h:{},l);if(c.success){let f={model:c.result.uuid,type:h.type,src:h?h.name:"",unit:h.type==="step"?"mm":i},d=await g6(r,l,JSON.stringify(f),s,n);o.push({success:d.success,code:d.code,createResult:d.result,message:d.message,...l})}else throw new Error(c.message)}catch(h){throw new Error(h.message)}return o}async function g6(e,t,i,r,s){let n={path:e,uuid:s,owner:e,description:t.name,docType:Yp.PCBLIB3D,dataStr:i,title:t.name,tags:r};return(await Ze.messageBus.rpcCall(Nm.LIB.CREATE1,n)).message}async function O6(e,t){let i=new FormData;return e.content&&i.append("src",new Blob([e.content]),e.name),i.append("mesh",new Blob([t.model]),"model.obj"),await(await fetch(Ze.apis.model.upload,{method:"POST",body:i})).json()}var Xp=lO(zp());var Vp=class{constructor(t,i,r){this.docType=t,this.uuid=i,this.projectId=r,this.tabId=i+"@"+r}async parse(t){if(t||(t={}),t.exportNetList||t.exportBom||t.exportAnnotationInfo)return await this.bacthParse(t)}async bacthParse(t){var l;let i=new Xp.MessageBus(!0),r=new Worker(`editor?entry=pcb-decode-worker.js${Ms().location.search.replace(/\?/,"&")}`),s=new Xp.WorkerMessageBridge(i,r),n={uuid:this.uuid,docType:this.docType,projectId:this.projectId,env:{tabId:this.tabId,windowTabId:(l=Ms())==null?void 0:l._TAB_ID_}},a="";t!=null&&t.exportNetList?(a="exportNetList",n.options||(n.options={}),n.options.data=t.exportNetList):t!=null&&t.exportBom?(a="exportBom",n.options||(n.options={}),n.options.data=t.exportBom):t!=null&&t.exportAnnotationInfo&&(a="exportAnnotationConnectInfo",n.options||(n.options={}),n.options.data=t.exportAnnotationInfo);let o=(await s.rpcCall(a,n)).message;return setTimeout(()=>{r.terminate()},0),o}};async function mE(e){let t=[];if(!e)return t;let i={},r={},s=[];for(let n of e){let a=6,o=n[a]=="Footprint"?n:null,l=n[a]=="Device"?n:null;if(!o&&!l&&(a+=1,o=n[a]=="Footprint"?n:null,l=n[a]=="Device"?n:null),!o&&!l)continue;let h;l!=null&&(r[l[a+1]]!=null?h=r[l[7]]:(h=(await Ze.messageBus.rpcCall(at.DEVICE.GET,[l[a+1],Ze.currentProject.projectId])).message,r[l[a+1]]=h));let c="";h!=null&&(c=h.attributes.Footprint,await OE(c,i)),o!=null&&(c=o[a+1]),!((c==null||c=="")&&o==null)&&await OE(c,i)}for(let n in r)r[n]!=null&&t.push(...b6(r[n]));for(let n in i)i[n]!=null&&t.push(...y6(i[n]));return t}async function OE(e,t){if(e==null||e=="")return;let i;if(t[e]!=null)i=t[e];else if(i=(await Ze.messageBus.rpcCall(at.FOOTPRINT.GET,[e,Ze.currentProject.projectId])).message,t[e]=i,i!=null&&i.uuid.indexOf("_")>-1){let r=i.source;r=r.split("|")[0],i.source=r,i=(await Ze.messageBus.rpcCall(at.FOOTPRINT.GET,[r,Ze.currentProject.projectId])).message,t[r]=i}}function y6(e){let t=[],i=e.display_title||e.title;return e!=null&&e.uuid.indexOf("_")>-1?t.push(["CUSTOMFOOTPRINT",e.source,e.uuid,e.dataStr]):t.push(["FOOTPRINT",i,e.uuid,e.updateTime,e.dataStr]),t}function b6(e){let t=[],i=["DEVICE"],r=e.attributes,s=e.display_title||e.title||"";return r.uuid=e.uuid,r.utime=e.updateTime,i.push(s),i.push(r),t.push(i),t}var oO=lO(zp());var x6=Object.create,tT=Object.defineProperty,v6=Object.getOwnPropertyDescriptor,E6=Object.getOwnPropertyNames,T6=Object.getPrototypeOf,w6=Object.prototype.hasOwnProperty,S6=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),I6=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of E6(t))!w6.call(e,s)&&s!==i&&tT(e,s,{get:()=>t[s],enumerable:!(r=v6(t,s))||r.enumerable});return e},P6=(e,t,i)=>(i=e!=null?x6(T6(e)):{},I6(t||!e||!e.__esModule?tT(i,"default",{value:e,enumerable:!0}):i,e)),A6=S6((e,t)=>{"use strict";t.exports=i,t.exports.default=i;function i(v,P,I){I=I||2;var N=P&&P.length,D=N?P[0]*I:v.length,j=r(v,0,D,I,!0),H=[];if(!j||j.next===j.prev)return H;var K,se,he,_e,ve,J,Z;if(N&&(j=c(v,P,j,I)),v.length>80*I){K=he=v[0],se=_e=v[1];for(var re=I;re<D;re+=I)ve=v[re],J=v[re+1],ve<K&&(K=ve),J<se&&(se=J),ve>he&&(he=ve),J>_e&&(_e=J);Z=Math.max(he-K,_e-se),Z=Z!==0?32767/Z:0}return n(j,H,I,K,se,Z,0),H}function r(v,P,I,N,D){var j,H;if(D===M(v,P,I,N)>0)for(j=P;j<I;j+=N)H=z(j,v[j],v[j+1],H);else for(j=I-N;j>=P;j-=N)H=z(j,v[j],v[j+1],H);return H&&E(H,H.next)&&(q(H),H=H.next),H}function s(v,P){if(!v)return v;P||(P=v);var I=v,N;do if(N=!1,!I.steiner&&(E(I,I.next)||x(I.prev,I,I.next)===0)){if(q(I),I=P=I.prev,I===I.next)break;N=!0}else I=I.next;while(N||I!==P);return P}function n(v,P,I,N,D,j,H){if(v){!H&&j&&_(v,N,D,j);for(var K=v,se,he;v.prev!==v.next;){if(se=v.prev,he=v.next,j?o(v,N,D,j):a(v)){P.push(se.i/I|0),P.push(v.i/I|0),P.push(he.i/I|0),q(v),v=he.next,K=he.next;continue}if(v=he,v===K){H?H===1?(v=l(s(v),P,I),n(v,P,I,N,D,j,2)):H===2&&h(v,P,I,N,D,j):n(s(v),P,I,N,D,j,1);break}}}}function a(v){var P=v.prev,I=v,N=v.next;if(x(P,I,N)>=0)return!1;for(var D=P.x,j=I.x,H=N.x,K=P.y,se=I.y,he=N.y,_e=D<j?D<H?D:H:j<H?j:H,ve=K<se?K<he?K:he:se<he?se:he,J=D>j?D>H?D:H:j>H?j:H,Z=K>se?K>he?K:he:se>he?se:he,re=N.next;re!==P;){if(re.x>=_e&&re.x<=J&&re.y>=ve&&re.y<=Z&&O(D,K,j,se,H,he,re.x,re.y)&&x(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function o(v,P,I,N){var D=v.prev,j=v,H=v.next;if(x(D,j,H)>=0)return!1;for(var K=D.x,se=j.x,he=H.x,_e=D.y,ve=j.y,J=H.y,Z=K<se?K<he?K:he:se<he?se:he,re=_e<ve?_e<J?_e:J:ve<J?ve:J,ue=K>se?K>he?K:he:se>he?se:he,Le=_e>ve?_e>J?_e:J:ve>J?ve:J,Ce=b(Z,re,P,I,N),De=b(ue,Le,P,I,N),Pe=v.prevZ,Ie=v.nextZ;Pe&&Pe.z>=Ce&&Ie&&Ie.z<=De;){if(Pe.x>=Z&&Pe.x<=ue&&Pe.y>=re&&Pe.y<=Le&&Pe!==D&&Pe!==H&&O(K,_e,se,ve,he,J,Pe.x,Pe.y)&&x(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ie.x>=Z&&Ie.x<=ue&&Ie.y>=re&&Ie.y<=Le&&Ie!==D&&Ie!==H&&O(K,_e,se,ve,he,J,Ie.x,Ie.y)&&x(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Pe&&Pe.z>=Ce;){if(Pe.x>=Z&&Pe.x<=ue&&Pe.y>=re&&Pe.y<=Le&&Pe!==D&&Pe!==H&&O(K,_e,se,ve,he,J,Pe.x,Pe.y)&&x(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ie&&Ie.z<=De;){if(Ie.x>=Z&&Ie.x<=ue&&Ie.y>=re&&Ie.y<=Le&&Ie!==D&&Ie!==H&&O(K,_e,se,ve,he,J,Ie.x,Ie.y)&&x(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function l(v,P,I){var N=v;do{var D=N.prev,j=N.next.next;!E(D,j)&&w(D,N,N.next,j)&&B(D,j)&&B(j,D)&&(P.push(D.i/I|0),P.push(N.i/I|0),P.push(j.i/I|0),q(N),q(N.next),N=v=j),N=N.next}while(N!==v);return s(N)}function h(v,P,I,N,D,j){var H=v;do{for(var K=H.next.next;K!==H.prev;){if(H.i!==K.i&&y(H,K)){var se=G(H,K);H=s(H,H.next),se=s(se,se.next),n(H,P,I,N,D,j,0),n(se,P,I,N,D,j,0);return}K=K.next}H=H.next}while(H!==v)}function c(v,P,I,N){var D=[],j,H,K,se,he;for(j=0,H=P.length;j<H;j++)K=P[j]*N,se=j<H-1?P[j+1]*N:v.length,he=r(v,K,se,N,!1),he===he.next&&(he.steiner=!0),D.push(m(he));for(D.sort(f),j=0;j<D.length;j++)I=d(D[j],I);return I}function f(v,P){return v.x-P.x}function d(v,P){var I=u(v,P);if(!I)return P;var N=G(I,v);return s(N,N.next),s(I,I.next)}function u(v,P){var I=P,N=v.x,D=v.y,j=-1/0,H;do{if(D<=I.y&&D>=I.next.y&&I.next.y!==I.y){var K=I.x+(D-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(K<=N&&K>j&&(j=K,H=I.x<I.next.x?I:I.next,K===N))return H}I=I.next}while(I!==P);if(!H)return null;var se=H,he=H.x,_e=H.y,ve=1/0,J;I=H;do N>=I.x&&I.x>=he&&N!==I.x&&O(D<_e?N:j,D,he,_e,D<_e?j:N,D,I.x,I.y)&&(J=Math.abs(D-I.y)/(N-I.x),B(I,v)&&(J<ve||J===ve&&(I.x>H.x||I.x===H.x&&p(H,I)))&&(H=I,ve=J)),I=I.next;while(I!==se);return H}function p(v,P){return x(v.prev,v,P.prev)<0&&x(P.next,v,v.next)<0}function _(v,P,I,N){var D=v;do D.z===0&&(D.z=b(D.x,D.y,P,I,N)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,g(D)}function g(v){var P,I,N,D,j,H,K,se,he=1;do{for(I=v,v=null,j=null,H=0;I;){for(H++,N=I,K=0,P=0;P<he&&(K++,N=N.nextZ,!!N);P++);for(se=he;K>0||se>0&&N;)K!==0&&(se===0||!N||I.z<=N.z)?(D=I,I=I.nextZ,K--):(D=N,N=N.nextZ,se--),j?j.nextZ=D:v=D,D.prevZ=j,j=D;I=N}j.nextZ=null,he*=2}while(H>1);return v}function b(v,P,I,N,D){return v=(v-I)*D|0,P=(P-N)*D|0,v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,P=(P|P<<8)&16711935,P=(P|P<<4)&252645135,P=(P|P<<2)&858993459,P=(P|P<<1)&1431655765,v|P<<1}function m(v){var P=v,I=v;do(P.x<I.x||P.x===I.x&&P.y<I.y)&&(I=P),P=P.next;while(P!==v);return I}function O(v,P,I,N,D,j,H,K){return(D-H)*(P-K)>=(v-H)*(j-K)&&(v-H)*(N-K)>=(I-H)*(P-K)&&(I-H)*(j-K)>=(D-H)*(N-K)}function y(v,P){return v.next.i!==P.i&&v.prev.i!==P.i&&!R(v,P)&&(B(v,P)&&B(P,v)&&Y(v,P)&&(x(v.prev,v,P.prev)||x(v,P.prev,P))||E(v,P)&&x(v.prev,v,v.next)>0&&x(P.prev,P,P.next)>0)}function x(v,P,I){return(P.y-v.y)*(I.x-P.x)-(P.x-v.x)*(I.y-P.y)}function E(v,P){return v.x===P.x&&v.y===P.y}function w(v,P,I,N){var D=C(x(v,P,I)),j=C(x(v,P,N)),H=C(x(I,N,v)),K=C(x(I,N,P));return!!(D!==j&&H!==K||D===0&&S(v,I,P)||j===0&&S(v,N,P)||H===0&&S(I,v,N)||K===0&&S(I,P,N))}function S(v,P,I){return P.x<=Math.max(v.x,I.x)&&P.x>=Math.min(v.x,I.x)&&P.y<=Math.max(v.y,I.y)&&P.y>=Math.min(v.y,I.y)}function C(v){return v>0?1:v<0?-1:0}function R(v,P){var I=v;do{if(I.i!==v.i&&I.next.i!==v.i&&I.i!==P.i&&I.next.i!==P.i&&w(I,I.next,v,P))return!0;I=I.next}while(I!==v);return!1}function B(v,P){return x(v.prev,v,v.next)<0?x(v,P,v.next)>=0&&x(v,v.prev,P)>=0:x(v,P,v.prev)<0||x(v,v.next,P)<0}function Y(v,P){var I=v,N=!1,D=(v.x+P.x)/2,j=(v.y+P.y)/2;do I.y>j!=I.next.y>j&&I.next.y!==I.y&&D<(I.next.x-I.x)*(j-I.y)/(I.next.y-I.y)+I.x&&(N=!N),I=I.next;while(I!==v);return N}function G(v,P){var I=new L(v.i,v.x,v.y),N=new L(P.i,P.x,P.y),D=v.next,j=P.prev;return v.next=P,P.prev=v,I.next=D,D.prev=I,N.next=I,I.prev=N,j.next=N,N.prev=j,N}function z(v,P,I,N){var D=new L(v,P,I);return N?(D.next=N.next,D.prev=N,N.next.prev=D,N.next=D):(D.prev=D,D.next=D),D}function q(v){v.next.prev=v.prev,v.prev.next=v.next,v.prevZ&&(v.prevZ.nextZ=v.nextZ),v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function L(v,P,I){this.i=v,this.x=P,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(v,P,I,N){var D=P&&P.length,j=D?P[0]*I:v.length,H=Math.abs(M(v,0,j,I));if(D)for(var K=0,se=P.length;K<se;K++){var he=P[K]*I,_e=K<se-1?P[K+1]*I:v.length;H-=Math.abs(M(v,he,_e,I))}var ve=0;for(K=0;K<N.length;K+=3){var J=N[K]*I,Z=N[K+1]*I,re=N[K+2]*I;ve+=Math.abs((v[J]-v[re])*(v[Z+1]-v[J+1])-(v[J]-v[Z])*(v[re+1]-v[J+1]))}return H===0&&ve===0?0:Math.abs((ve-H)/H)};function M(v,P,I,N){for(var D=0,j=P,H=I-N;j<I;j+=N)D+=(v[H]-v[j])*(v[j+1]+v[H+1]),H=j;return D}i.flatten=function(v){for(var P=v[0][0].length,I={vertices:[],holes:[],dimensions:P},N=0,D=0;D<v.length;D++){for(var j=0;j<v[D].length;j++)for(var H=0;H<P;H++)I.vertices.push(v[D][j][H]);D>0&&(N+=v[D-1].length,I.holes.push(N))}return I}}),yE={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},gK=(()=>{let e={};for(let t in yE)e[yE[t]]=t;return e})(),bE=class{constructor(t,i){this.ratio=t/i}wrap(t){return t*this.ratio}static convert(t,i,r){return t*i/r}};bE.ASIS=new bE(1,1);var S_=class{conversion(e,t,i){if(e===t)return i;let r=e+2+t;return this[r](i)}conversion1(e,t,i){let r=e+2+t,s=this[r](i);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*393.7007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};S_.prototype["px(100)2mil"]=e=>e*10;S_.prototype["px(100)2mm"]=e=>e*.254;S_.prototype["mil2px(100)"]=e=>e/10;S_.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var Wp=null,P0=new ArrayBuffer(8),Xm=new Float64Array(P0),Wm=new Uint32Array(P0),xE=new Uint16Array(P0),vE=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!Wp){let e=this.getUrlVars().version;e?Wp="/analyzer/v"+e:Wp="/analyzer"}return Wp}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;Xm[0]=new Date().getTime(),e.push(Wm[1].toString(16)),Xm[0]=Math.random(),e.push(xE[3].toString(16));let t=xE[2].toString(16);e.push("4"+t.substr(0,3)),Xm[0]=performance.now();let i=Wm[0].toString(16)+Wm[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},iT=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(nc.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(nc.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(nc.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(nc.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},C6=/(\.?0+)$/,nc=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(vE.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(vE.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);iT.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(C6,"")}};function N6(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var L6=(e,t)=>{e===3?console.error(t):console.log(t)},R6=(e,t)=>nc.format("%s %s: %s",new Date,N6(e),t),f0=class p0{constructor(t,i=L6,r=R6){this.debug=!1,this.level=t,this.writer=i,this.fmt=r}static mix(...t){let i=4;for(let r of t)r.level<i&&(i=r.level);return new p0(i,(r,s)=>{for(let n of t)n.write1(r,s)},(r,s)=>s)}wrap(t=null,i=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),s=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new p0(this.level,s,r)}chain(t){return t.wrap(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}write3(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,nc.format(i,...r)))}write2(t,i){this.include(t)&&(i instanceof Error?this.writer(t,this.fmt(t,i.stack)):this.writer(t,this.fmt(t,i.toString())))}write1(t,i){this.include(t)&&this.writer(t,this.fmt(t,i))}debug3(t,...i){this.write3(0,t,i)}debug2(t){this.write2(0,t)}debug1(t){this.write1(0,t)}info3(t,...i){this.write3(1,t,i)}info2(t){this.write2(1,t)}info1(t){this.write1(1,t)}warning3(t,...i){this.write3(2,t,i)}warning2(t){this.write2(2,t)}warning1(t){this.write1(2,t)}error3(t,...i){this.write3(3,t,i)}error2(t){this.write2(3,t)}error1(t){this.write1(3,t)}};f0.DUMMY=new f0(4);var I_=f0,A0=new ArrayBuffer(8),Jm=new Float64Array(A0),Zm=new Uint32Array(A0),EE=new Uint16Array(A0),TE=ArrayBuffer;try{TE=self.HTMLImageElement||TE}catch{}var Jp=null;function Yl(e,t,i=0,r=e.length){s(e,null,t,i,r);function s(a,o,l,h,c){let f,d,u,p;if(h<c-1){let _=c-h;if(_>50)o===null&&(o=new Array(_+1)),n(a,o,l,h,(h+c)/2|0,c);else{f=a[h],d=h,u=h,p=c;let g=d+1;for(;g<p;){if(u!=p){if(p=p+-1,l(f,a[p])<=0)continue;a[u]=a[p],u=p;continue}if(l(f,a[g])>=0){d=g,g=d+1;continue}a[u]=a[g],d=g,u=g,g=d+1}a[u]=f,s(a,o,l,h,u),s(a,o,l,u+1,c)}}}function n(a,o,l,h,c,f){s(a,o,l,h,c),s(a,o,l,c,f);for(var d=h,u=c,p=0,_=a[d],g=a[u];d<c&&u<f;){var b=l(_,g);isNaN(b)?(o[p++]=g,g=a[++u]):(b<=0&&(o[p++]=_,_=a[++d]),b>=0&&(o[p++]=g,g=a[++u]))}for(;d<c;d++)o[p++]=a[d];for(;u<f;u++)o[p++]=a[u];for(d=h,u=0;u<p;d++,u++)a[d]=o[u]}}var ss=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!Jp){let e=this.getUrlVars().version;e?Jp="/analyzer/v"+e:Jp="/analyzer"}return Jp}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;Jm[0]=new Date().getTime(),e.push(Zm[1].toString(16)),Jm[0]=Math.random(),e.push(EE[3].toString(16));let t=EE[2].toString(16);e.push("4"+t.substr(0,3)),Jm[0]=performance.now();let i=Zm[0].toString(16)+Zm[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},D6=[1,10,100,1e3],Zp=0,Fl=0;function wE(e,t,i){return Zp=Math.abs(e-t),i>=5&&Zp>1e-5||isNaN(i)&&Zp>1e-8?!1:Zp<1e-13?!0:(Fl=Math.min(SE(e),SE(t)),Fl<10&&(Fl=10),isNaN(i)||(Fl=Math.min(Fl,i)),IE(e,Fl)===IE(t,Fl))}var Kp=0,$p=0;function SE(e){return Kp=0,$p=0,e>0?Kp=e-Math.floor(e):Kp=e-Math.ceil(e),$p=(Kp.toString()||"").length,$p>2?$p-2:0}function IE(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=D6[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}var M6=/(\.?0+)$/,ac=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(ss.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(ss.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);Jt.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(M6,"")}},Jt=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(ac.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(ac.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(ac.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(ac.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},me=class{static regular(e){return Math.round(e*this.precision)/this.precision}static eq(e,t){return Math.abs(e-t)<=this.eps}static neq(e,t){return Math.abs(e-t)>this.eps}static less(e,t){return e-t<-this.eps}static lesseq(e,t){return e-t<=this.eps}static greater(e,t){return e-t>this.eps}static greatereq(e,t){return e-t>=-this.eps}static sqrt(e){return Math.abs(e)<=1e-10?0:Math.sqrt(e)}static sortAsc(e,t){return e-t}static sortDesc(e,t){return t-e}};me.eps=1e-8,me.precision=1e8;function lc(e,t){__(e.iterator(),t)}function __(e,t){let i=0;for(;e.hasNext();){let r=e.next();t(i++,r)}}var B6=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function _0(e){return new B6(e)}var h_=class Xs{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%Xs.PIx2,t=t<0?Xs.PIx2+t:t,t===Xs.PIx2?0:t}static toQuarterBase(t){return Xs.regular((t+Xs.PI_4)/Xs.PI_2*Xs.PI_2)}static toQuarterBaseD(t){return Xs.regularD(((t+45)/90|0)*90)}static transformD(t,i){return Xs.toDegrees(Xs.transform(Xs.toRadians(t),i))}static transform(t,i){let r=Math.cos(t),s=Math.sin(t),n=new ae(i.data[6],i.data[7]),a=new ae(r,s).multiply3(i);return Xs.regular(a.angle(n))}};h_.PIx2=Math.PI*2,h_.PI_2=Math.PI/2,h_.PI_4=Math.PI/4;var lt=h_,Hi=class{static dotProd1(e,t,i,r){return e*i+t*r}static dotProd2(e,t,i,r,s,n){return this.dotProd1(i-e,r-t,s-i,n-r)}static dotProd3(e,t,i){return this.dotProd2(e.x,e.y,t.x,t.y,i.x,i.y)}static crossProd1(e,t,i,r){return e*r-t*i}static crossProd2(e,t,i,r,s,n){return this.crossProd1(i-e,r-t,s-i,n-r)}static crossProd3(e,t,i){return this.crossProd2(e.x,e.y,t.x,t.y,i.x,i.y)}static distance2(e,t,i,r){let s=i-e,n=r-t;return s*s+n*n}static distance1(e,t,i,r){return this.hypot(i-e,r-t)}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y)}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var i=t;t=e,e=i}if(e===0)return t;var r=t/e;return e*Math.sqrt(1+r*r)}},rT=new ArrayBuffer(16),PE=new Float64Array(rT),Qp=new Int32Array(rT),Gl=class yi{static sortByXAsc(t,i){return t.x-i.x}static sortByYAsc(t,i){return t.y-i.y}static sortByXYAsc(t,i){return t.x<i.x?-1:t.x>i.x?1:t.y-i.y}static caculateAngle(t,i){let r=Math.cos(t),s=Math.sin(t),n=r*i.data[0]+s*i.data[4],a=r*i.data[1]+s*i.data[5],o=new yi(n,a).normalize();return Math.atan2(o.y,o.x)}static normal(t,i,r){let s=i.sub(t),n=r.sub(i);return s.cross(n)}static getVector2(t){return new yi(Math.cos(t),Math.sin(t))}static getCrossPoint1(t,i,r,s){if(t.equals1(i)||r.equals1(s)||me.eq(1,Math.abs(i.sub(t).normalize().dot(s.sub(r).normalize()))))return null;let n=i.y-t.y,a=t.x-i.x,o=i.x*t.y-t.x*i.y,l=s.y-r.y,h=r.x-s.x,c=s.x*r.y-r.x*s.y,f=n*h-l*a;return new yi((c*a-o*h)/f,(o*l-c*n)/f)}static getCrossPoint2(t,i,r,s){return this.getCrossPoint1(t,t.add(i),r,r.add(s))}constructor(t,i){this.x=Jt.normal(t),this.y=Jt.normal(i)}get hashed(){return this._hashed==null&&(PE[0]=this.x,PE[1]=this.y,this._hashed=Qp[0]^Qp[1]^Qp[2]^Qp[3]),this._hashed}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(t){var i=this.x-t.x,r=this.y-t.y;return new yi(i,r)}add(t){var i=this.x+t.x,r=this.y+t.y;return new yi(i,r)}div(t){return new yi(this.x/t,this.y/t)}add1(t,i){return new yi(this.x+t,this.y+i)}mul(t){return new yi(this.x*t,this.y*t)}cross(t){return this.x*t.y-this.y*t.x}getSin(){return this.y/this.length()}angle2(t){let i=this.y-t.y,r=this.x-t.x;return i=Math.abs(i-0)<10**-4?0:i,r=Math.abs(r-0)<10**-4?0:r,Math.atan2(i,r)}angleD2(t){return lt.toDegrees(this.angle2(t))}angle(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleX(t=yi.ORIGIN){let i=this.angle(t);return i<0&&(i=Math.PI*2+i),i}angleD(t){return lt.toDegrees(this.angle(t))}distance1(t){let i=t.x-this.x,r=t.y-this.y;return Hi.hypot(i,r)}distance2(t){let i=t.x-this.x,r=t.y-this.y;return i*i+r*r}rotateD(t,i){return this.rotate(t,lt.toRadians(i))}rotate(t,i){let r=Math.cos(i),s=Math.sin(i),n=this.x-t.x,a=this.y-t.y,o=n*r+a*-s,l=n*s+a*r;return t.add1(o,l)}multiply3(t){let i=this.x*t.data[0]+this.y*t.data[3]+t.data[6],r=this.x*t.data[1]+this.y*t.data[4]+t.data[7];return new yi(i,r)}multiply4(t){let i=this.x*t.data[0]+this.y*t.data[4]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+t.data[13];return new yi(i,r)}hashCode(){return this.hashed}equals(t,i){return t instanceof yi?wE(t.x,this.x,i)&&wE(t.y,this.y,i):!1}equals1(t){return t?me.eq(this.x,t.x)&&me.eq(this.y,t.y):!1}equals2(t,i){return t instanceof yi?Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i:!1}similarEquals(t,i=.5){return Math.abs(this.x*.1-t.x*.1)<=i&&Math.abs(this.y*.1-t.y*.1)<=i}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let t=this.x,i=this.y;return new Ni(t,t,i,i)}normalize(){if(this.x===0&&this.y===0)return new yi(0,0);let t=this.x/this.length(),i=this.y/this.length();return new yi(t,i)}regular(t=1e-4){let i=Math.round(1/t);return new yi(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}round(t=4){let i=10**(t|0);return new yi(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}mirrorX(t=yi.ORIGIN){return new yi(this.x,2*t.y-this.y)}mirrorY(t=yi.ORIGIN){return new yi(2*t.x-this.x,this.y)}mirrorCenter(t=yi.ORIGIN){return new yi(2*t.x-this.x,2*t.y-this.y)}clone(){return new yi(this.x,this.y)}mirror(t=yi.ORIGIN){return new yi(2*t.x-this.x,2*t.y-this.y)}pointOnRays(t,i){let r=lt.toRadians(t);return new yi(this.x+Math.cos(r)*i,this.y+Math.sin(r)*i)}pointOnRays2(t,i){let r=t.angle(this);return new yi(this.x+Math.cos(r)*i,this.y+Math.sin(r)*i)}scale(t){return new yi(this.x*t,this.y*t)}};Gl.ORIGIN=new Gl(0,0),Gl.X_UNIT_VECTOR=new Gl(1,0),Gl.Y_UNIT_VECTOR=new Gl(0,1);var ae=Gl,k6=(e=>(e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT",e))(k6||{}),U6=(e=>(e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM",e))(U6||{}),Lr=class{constructor(t,i){this.horizontal=t,this.vertical=i}};Lr.LT=new Lr(0,0),Lr.LC=new Lr(0,1),Lr.LB=new Lr(0,2),Lr.CT=new Lr(1,0),Lr.CC=new Lr(1,1),Lr.CB=new Lr(1,2),Lr.RT=new Lr(2,0),Lr.RC=new Lr(2,1),Lr.RB=new Lr(2,2);var Va=Lr,vi=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(e){return this.minX=Math.min(this.minX,e.minX),this.maxX=Math.max(this.maxX,e.maxX),this.minY=Math.min(this.minY,e.minY),this.maxY=Math.max(this.maxY,e.maxY),this}ext2(e){return this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y),this}ext3(e){for(let t=0;t<e.length;t++){let i=e[t];this.ext2(i)}return this}ext4(e){return lc(e,(t,i)=>(this.ext2(i),!0)),this}ext5(e,t,i,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,i),this.maxY=Math.max(this.maxY,r),this}ext6(e,t){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t),this}ext7(e){if(e<0){let t=e*2;if(t<this.minX-this.maxX||t<this.minY-this.maxY)throw new Error("")}return this.minX-=e,this.maxX+=e,this.minY-=e,this.maxY+=e,this}ext8(e){let t=[];for(let i=0;i<e.length;i+=2)t.push(new ae(e[i],e[i+1]));return this.ext3(t)}ext9(e,t,i,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e+i),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t+r),this}ext10({x:e,y:t,width:i,height:r}){return this.ext9(e,t,i,r)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new Ni(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new Ni(this.minX,this.maxX,this.minY,this.maxY):new Ni(0,0,0,0)}},Ju=new Float64Array(4),Ni=class cn{static extendRect({x:t,y:i,width:r,height:s}){return new cn(t,t+r,i,i+s)}static extend1(t,i){if(t===null)return new cn(i.x,i.x,i.y,i.y);{let r=Math.min(t.minX,i.x),s=Math.max(t.maxX,i.x),n=Math.min(t.minY,i.y),a=Math.max(t.maxY,i.y);return new cn(r,s,n,a)}}static extend2(t,i){if(t){let r=Math.min(t.minX,i.minX),s=Math.max(t.maxX,i.maxX),n=Math.min(t.minY,i.minY),a=Math.max(t.maxY,i.maxY);return new cn(r,s,n,a)}else return i}static extend3(t,i){let r=Math.min(t.x,i.x),s=Math.max(t.x,i.x),n=Math.min(t.y,i.y),a=Math.max(t.y,i.y);return new cn(r,s,n,a)}static extend4(t,i,r){return new cn(t.x-i/2,t.x+i/2,t.y-r/2,t.y+r/2)}constructor(t,i,r,s){if(this.minX=Jt.normal(t),this.maxX=Jt.normal(i),this.minY=Jt.normal(r),this.maxY=Jt.normal(s),t>i||r>s)throw new Error(`min > max is not permitted: [${t}, ${i}, ${r}, ${s}]`)}get data(){return Ju[0]=this.minX,Ju[1]=this.maxX,Ju[2]=this.minY,Ju[3]=this.maxY,Ju}isContains(t){return this.isContains1(t.x,t.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(t,i){return this.isContainsX(t)&&this.isContainsY(i)}isContains2(t,i){return this.isContainsX1(t)&&this.isContainsY1(i)}isContainsX(t){return t>=this.minX&&t<=this.maxX}isContainsX1(t){return me.greatereq(t,this.minX)&&me.lesseq(t,this.maxX)}isContainsY(t){return t>=this.minY&&t<=this.maxY}isContainsY1(t){return me.greatereq(t,this.minY)&&me.lesseq(t,this.maxY)}isIntersect(t){return!(this.maxX<t.minX||this.minX>t.maxX||this.maxY<t.minY||this.minY>t.maxY)}extendOfSize(t){return Jt.positiveOr0(this.maxX-this.minX+t*2),Jt.positiveOr0(this.maxY-this.minY+t*2),new cn(this.minX-t,this.maxX+t,this.minY-t,this.maxY+t)}isInside(t){return this.minX>=t.minX&&this.maxX<=t.maxX&&this.minY>=t.minY&&this.maxY<=t.maxY}isContainsBBox(t){return this.maxX>=t.maxX&&this.minX<=t.minX&&this.maxY>=t.maxY&&this.minY<=t.minY}isContainsBBox1(t){return me.greatereq(this.maxX,t.maxX)&&me.lesseq(this.minX,t.minX)&&me.greatereq(this.maxY,t.maxY)&&me.lesseq(this.minY,t.minY)}intersect(t){let i=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(i>r)return null;let s=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return s>n?null:new cn(i,r,s,n)}intersection1(t){let i=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(me.greater(i,r))return null;i>r&&(r=i);let s=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return me.greater(s,n)?null:(s>n&&(n=s),new cn(i,r,s,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new ae(this.minX,this.maxY)}UR(){return new ae(this.maxX,this.maxY)}LL(){return new ae(this.minX,this.minY)}LR(){return new ae(this.maxX,this.minY)}center(){return new ae(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(t){let i=new vi;return i.ext2(this.LL().multiply3(t)),i.ext2(this.LR().multiply3(t)),i.ext2(this.UR().multiply3(t)),i.ext2(this.UL().multiply3(t)),i.build()}transform4(t){let i=new vi;return i.ext2(this.LL().multiply4(t)),i.ext2(this.LR().multiply4(t)),i.ext2(this.UR().multiply4(t)),i.ext2(this.UL().multiply4(t)),i.build()}isSeparated(t){if(t==null||t==null)return!1;let i;this.minX>=t.minX?i=this.minX:i=t.minX;let r;if(this.maxX<=t.maxX?r=this.maxX:r=t.maxX,i>r)return!0;{let s;this.minY>=t.minY?s=this.minY:s=t.minY;let n;return this.maxY<=t.maxY?n=this.maxY:n=t.maxY,s>n}}relation(t){let i=0,r=0,s;this.minX>t.minX?(i++,s=this.minX):this.minX===t.minX?s=this.minX:(r++,s=t.minX);let n;if(this.maxX<t.maxX?(i++,n=this.maxX):this.maxX===t.maxX?n=this.maxX:(r++,n=t.maxX),s>n)return 2;{let a;this.minY>t.minY?(i++,a=this.minY):this.minY===t.minY?a=this.minY:(r++,a=t.minY);let o;return this.maxY<t.maxY?(i++,o=this.maxY):this.maxY===t.maxY?o=this.maxY:(r++,o=t.maxY),a>o?2:i===4?0:r===4?1:i===0&&r===0?4:s===n||a===o?6:i!==r?5:3}}zoom(t){let i=this.width(),r=this.height(),s=this.center();return t!=0&&(i/=t/2,r/=t/2),new cn(s.x-i,s.x+i,s.y-i,s.y+i)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(t){return this.minY==t.minY&&this.minX==t.minX&&this.maxX==t.maxX&&this.maxY==t.maxY}extendSize(t,i){return Object.is(void 0,i)&&(i=t),cn.extend4(this.center(),this.width()+t,this.height()+i)}positionOnBBox(t,i=0){let r=this.center(),s=this.width()*i/2,n=this.height()*i/2,a=t.x-r.x,o=t.y-r.y;return a>s?o>n?Va.RT:o<-n?Va.RB:Va.RC:a<-s?o>n?Va.LT:o<-n?Va.LB:Va.LC:o>n?Va.CT:o<-n?Va.CB:Va.CC}bbox(){return this}},g_=class Lt{static mul(t,i,r,s,n,a){let o=0,l=0;for(let h=0;h<t;h++){for(let c=0;c<r;c++){let f=c,d=0;for(let u=0;u<i;u++)d+=s[l+u]*n[f],f+=r;a[o++]=d}l+=i}}constructor(t,i,r){this.m=Jt.normal(t),this.n=Jt.normal(i);let s=t*i;if(r.length===s){for(let n=0;n<r.length;n++)Jt.normal(r[n]);this.data=r}else throw new Error("invalid matrix size")}mul(t){if(this.n===t.m){let i=new Array(this.m*t.n);return Lt.mul(this.m,this.n,t.n,this.data,t.data,i),new Lt(this.m,t.n,i)}else throw new Error("m !== p")}toString(){let t=[];t.push("Matrix ("),t.push(this.m.toString()),t.push(" x "),t.push(this.n.toString()),t.push(")");let i=0;for(let r=0;r<this.m;r++)for(let s=0;s<this.n;s++){let n=this.data[i++].toString();s===0?(t.push(`
`),t.push("	"),t.push(n)):(t.push(", "),t.push(n))}return t.join("")}static on(t,i,r){return t*i+r}initExpandMatrix(t){let i=this.m,r=this.n,s=r*2,n=new Array(i*s);for(let a=0;a<i;a++)for(let o=0;o<s;o++)o<r?n[Lt.on(s,a,o)]=t[Lt.on(r,a,o)]:o===i+a?n[Lt.on(s,a,o)]=1:n[Lt.on(s,a,o)]=0;return n}inverseMatrix(t,i,r){for(let s=0;s<i;s++){let n=t[Lt.on(r,s,s)];for(let a=0;a<r;a++)t[Lt.on(r,s,a)]/=n}return t}getMatrixRank(t,i,r){let s=Math.min(i,r);for(let n=0;n<i;n++){if(t[Lt.on(r,n,n)]===0){let a=new Array(r),o;for(o=n;o<i;o++)if(t[Lt.on(r,o,n)]!==0){ss.arraycopy(t,Lt.on(r,o,0),a,0,r),ss.arraycopy(t,Lt.on(r,n,0),t,Lt.on(r,o,0),r),ss.arraycopy(a,0,t,Lt.on(r,n,0),r);break}o>=i&&(s-=1)}if(!(s<i))for(let a=0;a<i;a++){if(a===n)continue;let o=t[Lt.on(r,a,n)]/t[Lt.on(r,n,n)];for(let l=0;l<r;l++)t[Lt.on(r,a,l)]-=t[Lt.on(r,n,l)]*o}}return s}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function t(a){return me.lesseq(Math.abs(a),0)}let i=this.initExpandMatrix(this.data.slice(0)),r=this.n*2;function s(a,o){for(let l=0;l<r;l++){let h=i[Lt.on(r,a,l)];i[Lt.on(r,a,l)]=i[Lt.on(r,o,l)],i[Lt.on(r,o,l)]=h}}for(let a=0;a<this.m;a++){let o=Math.abs(i[Lt.on(r,a,a)]),l=a;if(t(i[Lt.on(r,a,a)]))for(let c=a+1;c<this.m;c++){if(t(i[Lt.on(r,c,a)])){Math.abs(i[Lt.on(r,c,a)])>o&&(o=Math.abs(i[Lt.on(r,c,a)]),l=c);continue}s(a,c);break}if(t(i[Lt.on(r,a,a)])){if(o===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),l!==a&&s(a,l)}let h=1/i[Lt.on(r,a,a)];for(let c=0;c<r;c++)i[Lt.on(r,a,c)]*=h;for(let c=0;c<this.m;c++){if(a===c)continue;let f=i[Lt.on(r,c,a)];for(let d=a;d<r;d++)i[Lt.on(r,c,d)]-=i[Lt.on(r,a,d)]*f}}let n=[];for(let a=0;a<this.m;a++)for(let o=this.n;o<r;o++)n[Lt.on(this.n,a,o-this.n)]=i[Lt.on(r,a,o)];return new Lt(this.m,this.n,n)}getTransposeMatrix(){let t=new Array(this.data.length);for(let i=0;i<this.m;i++)for(let r=0;r<this.n;r++)t[r*this.n+i]=this.data[i*this.m+r];return new Lt(this.n,this.m,t)}hashCode(){let t=0;for(let i of this.data)t+=i;return t}equals(t){return this===t?!0:t===null?!1:t instanceof Lt?!(this.m!=t.m||this.n!=t.n||!ss.equals(this.data,t.data)):!1}},F6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],g0=class Mi extends g_{static translate(t,i,r){return new Mi([1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1])}static translate1(t){return new Mi([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static rotateX(t){let i=Math.cos(t),r=Math.sin(t);return new Mi([1,0,0,0,0,i,r,0,0,-r,i,0,0,0,0,1])}static rotateY(t){let i=Math.cos(t),r=Math.sin(t);return new Mi([i,0,-r,0,0,1,0,0,r,0,i,0,0,0,0,1])}static rotateZ(t){let i=Math.cos(t),r=Math.sin(t);return new Mi([i,r,0,0,-r,i,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(t,i){t=t.normalize();let r=t.x,s=t.y,n=t.z,a=Math.sin(i),o=Math.cos(i);return new Mi([r*r*(1-o)+o,r*s*(1-o)+n*a,r*n*(1-o)-s*a,0,r*s*(1-o)-n*a,s*s*(1-o)+o,s*n*(1-o)+r*a,0,r*n*(1-o)+s*a,s*n*(1-o)-r*a,n*n*(1-o)+o,0,0,0,0,1])}static scale(t,i=t,r=t){return new Mi([t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1])}static flipX(){return new Mi([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new Mi([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(t,i){return t.equals1(ae.ORIGIN)?Mi.rotateZ(i):Mi.translate(-t.x,-t.y,0).rotateZ(i).translate1(t.x,t.y,0)}static getMatrix4(t,i,r,s){let n=Math.cos(i),a=Math.sin(i),o=r*(t.x*n-t.y*a)+s.x,l=t.x*a+t.y*n+s.y,h=[r*n,a,0,0,-a*r,n,0,0,0,0,1,0,o,l,0,1];return new Mi(h)}constructor(t=F6){super(4,4,t)}translate(t){return this.multiply4(Mi.translate1(t))}translate1(t,i,r){return this.multiply4(Mi.translate(t,i,r))}rotateX(t){return this.multiply4(Mi.rotateX(t))}rotateY(t){return this.multiply4(Mi.rotateY(t))}rotateZ(t){return this.multiply4(Mi.rotateZ(t))}scale(t,i=t,r=t){return this.multiply4(Mi.scale(t,i,r))}scale1(t){return this.multiply4(Mi.scale(t.x,t.y,t.z))}setOrigin(t,i,r){return Mi.translate(-t,-i,-r).multiply4(this).translate1(t,i,r)}setOrigin1(t){return this.setOrigin(t.x,t.y,t.z)}multiply4(t){let i=new Array(16);return g_.mul(4,4,4,this.data,t.data,i),new Mi(i)}getInverseMatrix(){let t=super.getInverseMatrix();return new Mi(t.data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new Mi(t.data)}inverse(){let t=this.getInverseMatrix();return new Mi(t.data)}toMatrix3(){let t=this.data;return new Ii([t[0],t[1],0,t[4],t[5],0,t[12],t[13],1])}};g0.ORIGIN=new g0;var Yr=g0;function Zu(e){return iT.normal(parseFloat(e))}var G6=[1,0,0,0,1,0,0,0,1],Nn=class Rr extends g_{static translate(t,i){return new Rr([1,0,0,0,1,0,t,i,1])}static translate1(t){return this.translate(t.x,t.y)}static rotate(t){let i=Math.cos(t),r=Math.sin(t);return new Rr([i,r,0,-r,i,0,0,0,1])}static rotateD(t){return this.rotate(lt.toRadians(t))}static scale(t,i=t){return new Rr([t,0,0,0,i,0,0,0,1])}static scale1(t,i){return new Rr([t,0,0,0,i,0,0,0,1])}static toDOMMatrix(t){let[i,r,,s,n,,a,o]=t.data;return`matrix(${[i,r,s,n,a,o].join(",")})`}static svgTrasform(t){let i=t.split(" "),r=null;return i.forEach(s=>{s=s.trim();let n=s.trim().replace(")","").split("("),a=n[0],o=n[1].split(",");switch(a){case"translate":let l=Zu(o[0]),h=Zu(o[1]);r=r?r.translate(l,h):Rr.translate(l,h);break;case"rotate":let c=Zu(o[0]),f=Zu(o[1]),d=Zu(o[2]);r=r?r.setOrigin(f,d):Rr.translate(f,d),r=r.rotateD(c);break;default:return}}),r}constructor(t=G6){super(3,3,t);let i=t[0],r=t[3],s=t[1],n=t[4];this.iScale=Math.sqrt(i*i+s*s),this.jScale=Math.sqrt(r*r+n*n)}isMirrored(){return this.det()<0}multiply3(t){let i=new Array(9);return g_.mul(3,3,3,this.data,t.data,i),new Rr(i)}translate(t,i){return this.multiply3(Rr.translate(t,i))}translate1(t){return this.multiply3(Rr.translate1(t))}scale(t,i=t){return this.multiply3(Rr.scale(t,i))}scale1(t,i){return this.multiply3(Rr.scale1(t,i))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let t=this.getInverseMatrix();return new Rr(t.data)}rotateD(t){return this.multiply3(Rr.rotateD(t))}rotate(t){return this.multiply3(Rr.rotate(t))}resetOffset(){let t=this.data;return new Rr([t[0],t[1],0,t[3],t[4],0,0,0,1])}setOrigin(t,i){return Rr.translate(-t,-i).multiply3(this).translate(t,i)}setOrigin1(t){return this.setOrigin(t.x,t.y)}getInverseMatrix(){return new Rr(super.getInverseMatrix().data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new Rr(t.data)}toMatrix4(){let t=this.data;return new Yr([t[0],t[1],0,t[2],t[3],t[4],0,t[5],0,0,1,0,t[6],t[7],0,t[8]])}scaleNum(t){return!t||isNaN(t)?t:t*this.iScale}};Nn.ORIGIN=new Nn,Nn.MIRROR_Y=new Nn([1,0,0,0,-1,0,0,0,1]),Nn.MIRROR_X=new Nn([-1,0,0,0,1,0,0,0,1]),Nn.ROT_90=new Nn([0,1,0,-1,0,0,0,0,1]),Nn.ROT_N90=new Nn([0,-1,0,1,0,0,0,0,1]);var Ii=Nn,z6=(e=>(e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e))(z6||{}),C0=(e=>(e[e.CW=0]="CW",e[e.CCW=1]="CCW",e))(C0||{}),pd=class{},O0=class ed{constructor(t,i,r){this.p1=t,this.p2=i,this.p3=r}barycentre(){return ed.barycentre(this.p1,this.p2,this.p3)}incentre(){return ed.incentre(this.p1,this.p2,this.p3)}static barycentre(t,i,r){let s=t.x+i.x+r.x,n=t.y+i.y+r.y;return new ae(s/3,n/3)}static incentre(t,i,r){let s=i.sub(r).length(),n=t.sub(r).length(),a=t.sub(i).length(),o=s+n+a,l=s*t.x+n*i.x+a*r.x,h=s*t.y+n*i.y+a*r.y;return new ae(l/o,h/o)}area(){return ed.area(this.p1,this.p2,this.p3)}static area(t,i,r){return this.area2(t.x,t.y,i.x,i.y,r.x,r.y)/2}static area2(t,i,r,s,n,a){return Math.abs(Hi.crossProd2(t,i,r,s,n,a))}scale(t,i){let r=Ii.translate(-t.x,-t.y).scale(i).translate1(t),s=this.p1.multiply3(r),n=this.p2.multiply3(r),a=this.p3.multiply3(r);return new ed(s,n,a)}scaleOnBarycentre(t){return this.scale(this.barycentre(),t)}scaleOnIncentre(t){return this.scale(this.incentre(),t)}extend(t){let i=this.incentre(),r=this.p1.add(this.p2).sub(i).scale(1/2),s=r.length(),n=ae.ORIGIN.pointOnRays2(r,s+t).length()/s;return this.scaleOnIncentre(n)}container(t){let i=this.p3.sub(this.p1),r=this.p2.sub(this.p1),s=t.sub(this.p1),n=i.dot(i),a=i.dot(r),o=i.dot(s),l=r.dot(r),h=r.dot(s),c=1/(n*l-a*a),f=(l*o-a*h)*c;if(f<0||f>1)return!1;let d=(n*h-a*o)*c;return d<0||d>1?!1:f+d<=1}};function e_(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var Mn=class zo{static getMinDistanceWithoutCross(t,i){let r=e_();return zo.minLine(t,i,r),r.minDistance}static getMinDistance(t,i){return dn(t,i)?0:this.getMinDistanceWithoutCross(t,i)}static getMinLineWithCross(t,i){let r=e_();return zo.minLine(t,i,r),new le(r.start,r.end)}static getMinLine(t,i){return zo.intersection(t,i)||this.getMinLineWithCross(t,i)}static getMinDistanceFromPoint(t,i){let r=e_();if(i instanceof le)this.point2LineMinLine(r,i,t);else if(i instanceof Oe)this.point2ArcMinDistance(t,i,r);else throw new Error("not support");return r.minDistance}constructor(t,i){if(this.pt1=t,this.pt2=i,this.minline=zo.intersection(t,i),this.minline)this.minDistance=0;else{let r=e_();zo.minLine(t,i,r),this.minline=new le(r.start,r.end),this.minDistance=r.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(t,i){let r=dn(t,i);if(r===0)return;let s=new Array;for(let n=0;n<r;n+=2){let a=new ae(ee[n],ee[n+1]);s.push(a)}return s.length>1?new le(s[0],s[1]):new le(s[0],s[0])}static minLine(t,i,r){if(t instanceof le&&i instanceof le)return this.minDistanceForLines(t,i,r);if(t instanceof Oe&&i instanceof le)return this.minDistanceForLineAndArc(t,i,r);if(t instanceof le&&i instanceof Oe)return this.minDistanceForLineAndArc(i,t,r);if(t instanceof Oe&&i instanceof Oe)return this.minDistanceForArcs(t,i,r);throw new Error("not support")}static minDistanceForLines(t,i,r){[t.start(),t.end(),i.start(),i.end()].forEach((s,n)=>{n<2?this.point2LineMinLine(r,i,s):this.point2LineMinLine(r,t,s)})}static minDistanceForLineAndArc(t,i,r){this.point2LineMinLine(r,i,t.start()),this.point2LineMinLine(r,i,t.svgEnd);let s=zo.foot(i,t.center);i.bbox().extendOfSize(1e-8).isContains(s)&&this.point2ArcMinLine(r,t,s),this.point2ArcMinLine(r,t,i.start()),this.point2ArcMinLine(r,t,i.end())}static minDistanceForArcs(t,i,r){this.concentricArc(t,i,r),this.point2ArcMinDistance(i.start(),t,r),this.point2ArcMinDistance(i.svgEnd,t,r),this.point2ArcMinDistance(t.start(),i,r),this.point2ArcMinDistance(t.svgEnd,i,r),(Cn(t,i.center)||Cn(i,t.center))&&this.shortestLineForArcs(t,i,r)}static minLineForArcAndLine(t,i,r){let s=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));this.arcShortestLine(t,i,r,s),this.arcShortestLine(t,i,r,n)}static arcInnerLineFootSegment(t,i,r){let s=r.distance1(t.center);if(s!==0){let n=t.rx*(r.y-t.center.y)/s+t.center.y,a=t.rx*(r.x-t.center.x)/s+t.center.x;s=t.rx-s,s<i.minDistance&&(i.minDistance=s,i.start=new ae(a,n),i.end=r)}else s=t.rx-s,s<i.minDistance&&(i.minDistance=s,i.start=t.start(),i.end=r)}static shortestLineForArcs(t,i,r){let s=t.center.angleD(i.center),n=i.center.angleD(t.center),a=t.pointOn(s),o=t.pointOn(n),l=i.pointOn(s),h=i.pointOn(n);Cn(t,a)&&(this.arcShortestLine(i,r,a,l),this.arcShortestLine(i,r,a,h)),Cn(t,o)&&(this.arcShortestLine(i,r,o,l),this.arcShortestLine(i,r,o,h)),this.shortestLineForArcs1(t,i,r)}static shortestLineForArcs1(t,i,r){let s=i.start().sub(t.center).normalize(),n=i.end().sub(t.center).normalize(),a=t.start().sub(i.center).normalize(),o=t.end().sub(i.center).normalize(),l=t.center.add(s.mul(t.rx)),h=t.center.add(n.mul(t.rx)),c=i.center.add(a.mul(i.rx)),f=i.center.add(o.mul(i.rx));Cn(t,l)&&me.greater(i.start().distance2(t.center),0)&&this.arcShortestLine(t,r,i.start(),l),Cn(t,h)&&me.greater(i.end().distance2(t.center),0)&&this.arcShortestLine(t,r,i.end(),h),Cn(i,c)&&me.greater(t.start().distance2(i.center),0)&&this.arcShortestLine(i,r,t.start(),c),Cn(i,f)&&me.greater(t.end().distance2(i.center),0)&&this.arcShortestLine(i,r,t.end(),f)}static concentricArc(t,i,r){if(!(t.center.distance1(i.center)<1e-5&&t.rx===i.rx&&t.ry===i.ry))return;let s=t.start().distance1(i.svgEnd);s<r.minDistance&&(r.minDistance=s,r.start=t.start(),r.end=i.svgEnd),s=i.start().distance1(t.svgEnd),s<r.minDistance&&(r.minDistance=s,r.start=i.start(),r.end=t.svgEnd)}static point2ArcMinDistance(t,i,r){if(Cn(i,t)){let s=i.pointOn(t.angleD(i.center)),n=i.pointOn(i.center.angleD(t));this.arcShortestLine(i,r,t,s),this.arcShortestLine(i,r,t,n)}else this.minLineSegment(r,i.start(),t),this.minLineSegment(r,i.svgEnd,t)}static point2ArcMinLine(t,i,r){if(Cn(i,r)){let s=r.distance1(i.center);s>i.rx||s>i.ry?this.minLineForArcAndLine(i,t,r):this.arcInnerLineFootSegment(i,t,r)}}static point2LineMinLine(t,i,r){let s=zo.foot(i,r);i.bbox().extendOfSize(1e-8).isContains(s)?this.minLineSegment(t,s,r):(this.minLineSegment(t,i.start(),r),this.minLineSegment(t,i.end(),r))}static minLineSegment(t,i,r){let s=i.distance1(r);s<t.minDistance&&(t.minDistance=s,t.start=i,t.end=r)}static arcShortestLine(t,i,r,s){if(!Cn(t,s))return;let n=r.distance1(s);n<i.minDistance&&(i.minDistance=n,i.start=r,i.end=s)}static foot(t,i){if(t.isPoint())return t.start();if(!me.eq(t.b,0)&&!me.eq(t.a,0)){let r=t.start(),s=t.direct,n=(i.x-r.x)*s.x+(i.y-r.y)*s.y;return new ae(r.x+s.x*n,r.y+s.y*n)}else return me.eq(t.b,0)&&!me.eq(t.a,0)?new ae(t.start().x,i.y):!me.eq(t.b,0)&&me.eq(t.a,0)?new ae(i.x,t.start().y):i}};function Cn(e,t){if(me.eq(e.sweepAngle,360))return!0;let i=lt.regularD(t.angleD(e.center));return e.sweepAngle>0?(me.less(i,e.startAngle)&&(i+=360),me.greatereq(e.endAngle(),i)):(me.greater(i,e.startAngle)&&(i-=360),me.lesseq(e.endAngle(),i))}var H6=[1,10,100,1e3],AE="http://www.w3.org/2000/svg",CE="http://www.w3.org/1999/xlink",NE="http://www.w3.org/XML/1998/namespace",LE="https://easyeda.com/",yK=(function(){var e={svg:AE,xlink:CE,xml:NE,c:LE};return e[AE]="svg",e[CE]="xlink",e[NE]="xml",e[LE]="c",e})(),Zi=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),bK=(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};e["3D"]=(function(){for(var s=[16,19,3,7,5,1],n=21;n<52;n++)s.push(n+32,n);return s.push(2,6,8,4,17),s})();var t,i,r;for(t in e)if(e.hasOwnProperty(t)&&(r=e[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(i=25;i<=52;i++)r.push(i);return e})(),Nr=(function(){var e={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<53;t++)e[t]="Inner"+(t-20);for(t=53;t<85;t++)e[t]="Substrate"+(t-52);return e})(),xK=(function(){var e=[],t=[];for(var i in Zi)if(Zi.hasOwnProperty(i)){if(i.match(/^BOARD\d+/))continue;e.push(Zi[i])}e.sort(),t.sort();var r={},s,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};e.forEach(function(o){switch(o){case Zi.TOPLAYER:s={name:Nr[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case Zi.BOTTOMLAYER:s={name:Nr[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case Zi.TOPSILKLAYER:s={name:Nr[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case Zi.BOTTOMSILKLAYER:s={name:Nr[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case Zi.TOPPASTERLAYER:s={name:Nr[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case Zi.BOTTOMPASTERLAYER:s={name:Nr[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case Zi.TOPSOLDERLAYER:s={name:Nr[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case Zi.BOTTOMSOLDERLAYER:s={name:Nr[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case Zi.RATLINES:s={name:Nr[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case Zi.BOARDOUTLINE:s={name:Nr[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case Zi.ALL:s={name:Nr[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case Zi.DOCUMENT:s={name:Nr[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case Zi.TOPASSEMBLY:s={name:Nr[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case Zi.BOTTOMASSEMBLY:s={name:Nr[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case Zi.MECHANICAL:s={name:Nr[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case Zi.MODEL3D:s={name:Nr[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case Zi.LIBBODY:s={name:Nr[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case Zi.PADSURFACE:s={name:Nr[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=Zi.INNER1&&o<=Zi.INNER32?s={name:Nr[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:s=null;break}s&&(r[o]=s)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var l=parseInt(RegExp.$1,16),h=.5,c=Math.min(255,Math.round((l>>16)*h)),f=Math.min(255,Math.round((l>>8&255)*h)),d=Math.min(255,Math.round((l&255)*h)),u=((c<<16)+(f<<8)+d).toString(16);return"#"+("00000"+u).substr(-6).toUpperCase()}return r})(),RE={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},vK=(function(){var e={};for(let t in RE)e[RE[t]]=t;return e})(),P_=Math.PI*2,O_=Math.PI/2,EK=Math.sin(Math.PI/180);function j6(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=H6[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}function sT(e,t,i){var r=e-t;return i||(i=1e-10),(r>0?r:-r)<i}function Y6(e,t,i){var r=c(e)&&c(t)&&c(i);if(!r)return console.warn("Bad arguments"),null;var s=t.x-i.x>0?t.x:i.x,n=t.y-i.y>0?t.y:i.y,a=t.x-i.x>0?i.x:t.x,o=t.y-i.y>0?i.y:t.y,l=e.x,h=e.y;return l<=s+.001&&l>=a-.001&&h<=n+.001&&h>=o-.001;function c(f){return f?(f.x=Number(f.x),f.y=Number(f.y),isNaN(f.x)||isNaN(f.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function V6(e,t,i,r,s,n){var a=(s-i)*(e-i)+(n-r)*(t-r),o=(s-i)*(s-i)+(n-r)*(n-r),l=a/o,h=i+(s-i)*l,c=r+(n-r)*l;return a<=0?Math.sqrt((e-i)*(e-i)+(t-r)*(t-r)):a>=o?Math.sqrt((e-s)*(e-s)+(t-n)*(t-n)):Math.sqrt((e-h)*(e-h)+(c-t)*(c-t))}function q6(e,t,i){return Y6(e,t,i)?sT((e.x-t.x)*(i.y-t.y),(i.x-t.x)*(e.y-t.y),.001):!1}var td=1e-4,ee=new Float64Array(100);function dn(e,t){if(e instanceof le&&t instanceof le)return _a(e,t);if(e instanceof Oe&&t instanceof le)return m0(e,t);if(e instanceof le&&t instanceof Oe)return m0(t,e);if(e instanceof Oe&&t instanceof Oe)return aT(e,t);if(e instanceof ke&&t instanceof ke)return c_(e,t);if(e instanceof ke&&t instanceof le)return c_(e,new ke([t.start(),t.end()]));if(e instanceof le&&t instanceof ke)return c_(new ke([e.start(),e.end()]),t);if(e instanceof ke&&t instanceof Oe)return GE(t,e);if(e instanceof Oe&&t instanceof ke)return GE(e,t);throw new Error("not supported operation")}function X6(e,t){let i=e.bbox();if(i.isContainsY1(t)){let r=new le(new ae(i.minX-1,t),new ae(i.maxX+1,t));return _a(r,e)>0?1:0}else return 0}function W6(e,t){if(e.rx===e.ry){let i=e.bbox();if(i.isContainsY1(t)){let r=new le(new ae(i.minX-1,t),new ae(i.maxX+1,t));return m_(e,r)>0?1:0}else return 0}else throw new Error("not supported operation")}function DE(e,t){let i=e.bbox();return i.isContainsY1(t)&&c_(new ke([new ae(i.minX-1,t),new ae(i.maxX+1,t)]),e)>0?1:0}function ME(e,t,i){return isFinite(t)&&isFinite(i)?e.isContains2(t,i):!1}function J6(e,t){let i=t.length(),r=Hi.crossProd3(t.start(),t.end(),e.start())/i,s=Hi.crossProd3(t.start(),t.end(),e.end())/i;return Math.abs(r)<1e-8||Math.abs(s)<1e-8||r*s<0}function _a(e,t){let i=e.bbox().intersection1(t.bbox());if(!i)return 0;if(e.isPoint())if(t.isPoint()){let r=i.center();return ee[0]=r.x,ee[1]=r.y,2}else return BE(t,e,i);else{if(t.isPoint())return BE(e,t,i);{let r=function(O,y){i.isContains2(O,y)&&(ee[m++]=O,ee[m++]=y)};if(!J6(e,t))return 0;let s=e.start().x,n=e.start().y,a=e.end().x,o=e.end().y,l=t.start().x,h=t.start().y,c=t.end().x,f=t.end().y,d=t.length(),u=Hi.crossProd2(s,n,l,h,c,f)/d,p=Hi.crossProd2(a,o,l,h,c,f)/d;if(u*p>0&&!me.eq(u,0)&&!me.eq(p,0))return 0;let _=e.length(),g=Hi.crossProd2(l,h,s,n,a,o)/_,b=Hi.crossProd2(c,f,s,n,a,o)/_;if(g*b>0&&!me.eq(g,0)&&!me.eq(b,0))return 0;let m=0;if(me.eq(u,0)&&me.eq(p,0)){let O=i.UL(),y=i.UR(),x=i.LL(),E=i.LR();if(me.eq(i.width(),0))me.eq(i.height(),0)?(ee[m++]=O.x,ee[m++]=O.y):(ee[m++]=O.x,ee[m++]=O.y,ee[m++]=x.x,ee[m++]=x.y);else if(me.eq(i.height(),0))ee[m++]=O.x,ee[m++]=O.y,ee[m++]=y.x,ee[m++]=y.y;else{let w=O0.area2(O.x,O.y,l,h,c,f),S=O0.area2(y.x,y.y,l,h,c,f);w<S?(ee[m++]=O.x,ee[m++]=O.y,ee[m++]=E.x,ee[m++]=E.y):(ee[m++]=y.x,ee[m++]=y.y,ee[m++]=x.x,ee[m++]=x.y)}}else if(me.eq(u,0))r(s,n);else if(me.eq(p,0))r(a,o);else{let O=Math.abs(u/(u-p));r(s+(a-s)*O,n+(o-n)*O)}return m}}}function BE(e,t,i){let r=t.start(),s=t.end(),n=Hi.crossProd3(e.start(),e.end(),t.start()),a=Hi.crossProd3(e.start(),e.end(),t.end());if(n*a<0){let o=i.center();return ee[0]=o.x,ee[1]=o.y,2}else if(Math.abs(n)<Math.abs(a)){if(me.eq(n/e.length(),0))return ee[0]=r.x,ee[1]=r.y,2}else if(me.eq(a/e.length(),0))return ee[0]=s.x,ee[1]=s.y,2;return 0}function m_(e,t){let i=e.bbox().intersection1(t.bbox());if(i!=null){i=i.extendOfSize(td);let r=e.center.x,s=e.center.y,n=e.rx,a=e.rx2,o=t.start().x,l=t.start().y,h=t.end().x,c=t.end().y,f=e.center.distance1(t.start()),d=e.center.distance1(t.end()),u=me.eq(f,n)?0:f>n?1:-1,p=me.eq(d,n)?0:d>n?1:-1,_=0;if(u===-1&&p===-1)return 0;if(u===0&&p===0)ee[_++]=o,ee[_++]=l,ee[_++]=h,ee[_++]=c;else if(u===1&&p===1){let g=Mn.foot(t,e.center),b=g.distance1(e.center);if(me.greater(b,n))return 0;if(me.eq(b,n))me.eq(t.distance2(e.start()),0)?(ee[_++]=e.start().x,ee[_++]=e.start().y,ee[_++]=e.start().x,ee[_++]=e.start().y):me.eq(t.distance2(e.end()),0)?(ee[_++]=e.end().x,ee[_++]=e.end().y,ee[_++]=e.end().x,ee[_++]=e.end().y):(ee[_++]=g.x,ee[_++]=g.y,ee[_++]=g.x,ee[_++]=g.y);else{_=nT(r,s,o,l,h,c,_,g);let m=ee[_-2],O=ee[_-1];_-=2;let y=Hi.distance1(r,s,m,O);if(me.eq(y,n))ee[_++]=m,ee[_++]=O,ee[_++]=m,ee[_++]=O;else if(y<n)_=yr(a,r,s,o,l,m,O,_),_=yr(a,r,s,m,O,h,c,_);else return 0}}else if(u===-1||p===-1)_=yr(a,r,s,o,l,h,c,_);else{let g=Mn.foot(t,e.center),b=g.distance1(e.center);if(me.eq(b,n)){let m=function(x){return ME(i,x.x,x.y)&&zi(e,x)},O=e.start(),y=e.end();if(u===0){let x=t.start();if(m(x))return ee[_++]=x.x,ee[_++]=x.y,ee[_++]=x.x,ee[_++]=x.y,_;if(m(g))return ee[_++]=g.x,ee[_++]=g.y,ee[_++]=g.x,ee[_++]=g.y,_;if(me.eq(t.distance2(O),0)&&m(O))return ee[_++]=O.x,ee[_++]=O.y,ee[_++]=O.x,ee[_++]=O.y,_;if(me.eq(t.distance2(y),0)&&m(y))return ee[_++]=y.x,ee[_++]=y.y,ee[_++]=y.x,ee[_++]=y.y,_;if(f<=n)_=yr(a,r,s,g.x,g.y,h,c,_),_===2&&(ee[_++]=ee[0],ee[_++]=ee[1]);else if(b<n){if(_=yr(a,r,s,g.x,g.y,h,c,_),_===2&&m(new ae(ee[0],ee[1])))return ee[_++]=ee[0],ee[_++]=ee[1],_;_=yr(a,r,s,g.x,g.y,o,l,0),_===2&&(ee[_++]=ee[0],ee[_++]=ee[1])}}else{let x=t.end();if(m(x))return ee[_++]=x.x,ee[_++]=x.y,ee[_++]=x.x,ee[_++]=x.y,_;if(m(g))return ee[_++]=g.x,ee[_++]=g.y,ee[_++]=g.x,ee[_++]=g.y,_;if(me.eq(t.distance2(O),0)&&m(O))return ee[_++]=O.x,ee[_++]=O.y,ee[_++]=O.x,ee[_++]=O.y,_;if(me.eq(t.distance2(y),0)&&m(y))return ee[_++]=y.x,ee[_++]=y.y,ee[_++]=y.x,ee[_++]=y.y,_;if(d<=n)_=yr(a,r,s,g.x,g.y,o,l,_),_===2&&(ee[_++]=ee[0],ee[_++]=ee[1]);else if(b<n){if(_=yr(a,r,s,g.x,g.y,o,l,_),_===2&&m(new ae(ee[0],ee[1])))return ee[_++]=ee[0],ee[_++]=ee[1],_;_=yr(a,r,s,g.x,g.y,h,c,0),_===2&&(ee[_++]=ee[0],ee[_++]=ee[1])}}}else if(u===0){let m=t.start();ee[_++]=m.x,ee[_++]=m.y,(o-g.x)*(h-g.x)+(l-g.y)*(c-g.y)<0&&(_=yr(a,r,s,g.x,g.y,h,c,_))}else{let m=t.end();ee[_++]=m.x,ee[_++]=m.y,(o-g.x)*(h-g.x)+(l-g.y)*(c-g.y)<0&&(_=yr(a,r,s,g.x,g.y,o,l,_))}}if(_>0){let g=0;for(let b=0;b<_;b+=2){let m=ee[b],O=ee[b+1];isFinite(m)&&isFinite(O)&&ME(i,m,O)&&zi(e,new ae(m,O))&&(ee[g++]=m,ee[g++]=O)}return g}else return 0}else return 0}function Z6(e,t){if(e.bbox()){let i=e.center.x,r=e.center.y,s=e.rx2,n=t.start().x,a=t.start().y,o=t.end().x,l=t.end().y,h=e.center.distance2(t.start()),c=e.center.distance2(t.end()),f=me.eq(h,s)?0:h>s?1:-1,d=me.eq(c,s)?0:c>s?1:-1,u=0;if(f===-1&&d===-1)return 0;if(f===0&&d===0)ee[u++]=n,ee[u++]=a,ee[u++]=o,ee[u++]=l;else if(f===1&&d===1){let p=Mn.foot(t,e.center),_=p.distance2(e.center);if(me.greater(_,s))return 0;if(me.eq(_,s)){let g=p.distance2(e.start()),b=p.distance2(e.end());me.eq(g,0)?(ee[u++]=e.start().x,ee[u++]=e.start().y):me.eq(b,0)?(ee[u++]=e.end().x,ee[u++]=e.end().y):(ee[u++]=p.x,ee[u++]=p.y)}else{u=nT(i,r,n,a,o,l,u,p);let g=ee[u-2],b=ee[u-1],m=Hi.distance2(i,r,g,b);if(u-=2,me.eq(m,s))ee[u++]=g,ee[u++]=b;else if(m<s)u=yr(s,i,r,n,a,g,b,u),u=yr(s,i,r,g,b,o,l,u);else return 0}}else if(f===-1||d===-1)u=yr(s,i,r,n,a,o,l,u);else{let p=Mn.foot(t,e.center);f===0?(ee[u++]=t.start().x,ee[u++]=t.start().y,me.neq(p.distance2(t.start()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(u=yr(s,i,r,p.x,p.y,o,l,u))):(ee[u++]=t.end().x,ee[u++]=t.end().y,me.neq(p.distance2(t.end()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(u=yr(s,i,r,p.x,p.y,n,a,u)))}if(u>0){let p=0;for(let _=0;_<u;_+=2){let g=ee[_],b=ee[_+1];isFinite(g)&&isFinite(b)&&(ee[p++]=g,ee[p++]=b)}return p}else return 0}else return 0}function yr(e,t,i,r,s,n,a,o){if(s==a){let m=e-(s-i)*(s-i);if(me.greater(m,0)){let O=Math.sqrt(m),y=t-O,x=t+O,E=Math.min(r,n),w=Math.max(r,n);return y>=E&&y<=w&&(ee[o++]=y,ee[o++]=s),x>=E&&x<=w&&(ee[o++]=x,ee[o++]=s),o}}let l=Hi.distance2(r,s,t,i)-e;if(l===0)return ee[o++]=r,ee[o++]=s,o;let h=Hi.distance2(n,a,t,i)-e;if(h===0)return ee[o++]=n,ee[o++]=a,o;if(l<0&&h<0)return l>h?me.eq(l,0)&&(ee[o++]=r,ee[o++]=s):me.eq(h,0)&&(ee[o++]=n,ee[o++]=a),o;if(l>0&&h>0&&(r-t)*(n-t)+(s-i)*(a-i)>0)return l<h?me.eq(l,0)&&(ee[o++]=r,ee[o++]=s):me.eq(h,0)&&(ee[o++]=n,ee[o++]=a),o;let c=r,f=s,d=n,u=a,p=NaN,_=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let m=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(h)),.75),.25);if(p=c+(d-c)*m,_=f+(u-f)*m,c===p&&f===_||d===p&&u===_){Math.abs(l)>Math.abs(h)?(p=d,_=u,g=h):(p=c,_=f,g=l);break}else g=Hi.distance2(p,_,t,i)-e,(g<0?l>h:l<h)?(d=p,u=_,h=g):(c=p,f=_,l=g)}return ee[o++]=p,ee[o++]=_,o}function nT(e,t,i,r,s,n,a,o){let l=Hi.dotProd2(i,r,s,n,e,t),h=Hi.dotProd2(s,n,i,r,e,t);if(l>=0)return ee[a++]=s,ee[a++]=n,a;if(h>=0)return ee[a++]=i,ee[a++]=r,a;if(Hi.crossProd2(i,r,s,n,e,t)==0)return ee[a++]=e,ee[a++]=t,a;{let c=NaN,f=NaN,d=i,u=r,p=s,_=n,g=Hi.distance2(i,r,e,t),b=Hi.distance2(s,n,e,t),m=Number.POSITIVE_INFINITY,O=0;for(;m>0&&(O++,c=d+(p-d)*.5,f=u+(_-u)*.5,!(g==b||d==c&&u==f||p==c&&_==f));){m=Hi.distance2(c,f,e,t);let y=Hi.dotProd2(d,u,c,f,e,t);if(y==0)break;y<0?(p=c,_=f,b=m):(d=c,u=f,g=m)}return Hi.distance2(c,f,e,t)<Hi.distance2(o.x,o.y,e,t)?(ee[a++]=c,ee[a++]=f):(ee[a++]=o.x,ee[a++]=o.y),a}}function m0(e,t){if(e.rx===e.ry)return m_(e,t);throw new Error("not supported")}function K6(e,t){if(e.rx===e.ry)return Z6(e,t);throw new Error("not supported")}function aT(e,t){if(e.bbox().intersection1(t.bbox())!=null){if(e.rx===e.ry&&t.rx===t.ry)return $6(e,t);throw new Error("not supported operation")}return 0}function $6(e,t){let i=e.center.x,r=e.center.y,s=t.center.x,n=t.center.y,a=e.rx,o=t.rx,l=e.rx2,h=t.rx2,c=e.center.distance1(t.center),f=Math.abs(a-o),d=a+o;if(me.greater(c,d)||me.less(c,f))return 0;if(me.eq(f+c,0)){let u=0,p;return zi(e,t.start())&&(ee[u]=t.start().x,ee[u+1]=t.start().y,u+=2,p=t.start()),zi(e,t.end())&&(ee[u]=t.end().x,ee[u+1]=t.end().y,u+=2,p=t.end()),u===0?(zi(t,e.start())&&(ee[u]=e.start().x,ee[u+1]=e.start().y,u+=2),zi(t,e.end())&&(ee[u]=e.end().x,ee[u+1]=e.end().y,u+=2)):u===2&&(!p.equals1(e.start())&&zi(t,e.start())&&(ee[u]=e.start().x,ee[u+1]=e.start().y,u+=2),!p.equals1(e.end())&&zi(t,e.end())&&(ee[u]=e.end().x,ee[u+1]=e.end().y,u+=2)),u}else if(me.eq(c,d)){if(kE(e,t))return 4;let u=new le(e.center,t.center),p=m_(t,u);return p=UE(e,p),p!==0?p:(p=m_(e,u),UE(t,p))}else if(me.eq(c,f)){if(kE(e,t))return 4;if(a>o){let u=(a-o)/a;return ee[0]=i+(s-i)/u,ee[1]=r+(n-r)/u,FE(e,t,2)}else{let u=(o-a)/o;return ee[0]=s+(i-s)/u,ee[1]=n+(r-n)/u,FE(e,t,2)}}else{let u,p;if(e.rx>t.rx){let C=(e.center.distance2(t.center)-l+h)/(c*2)/c;u=(i-s)*C+s,p=(r-n)*C+n}else{let C=(e.center.distance2(t.center)-h+l)/(c*2)/c;u=(s-i)*C+i,p=(n-r)*C+r}let _=s-i,g=n-r,b=Math.max(a,o)*2,m,O,y,x;if(Math.abs(_)<Math.abs(g)){let C=_/-g,R=p-C*u;m=u-b,O=C*m+R,y=u+b,x=C*y+R}else{let C=g/-_,R=u-C*p;O=p-b,m=C*O+R,x=p+b,y=C*x+R}let E;if(e.rx>t.rx?(E=yr(h,s,n,m,O,u,p,0),E=yr(h,s,n,u,p,y,x,E)):(E=yr(l,i,r,m,O,u,p,0),E=yr(l,i,r,u,p,y,x,E)),E!==4)throw new Error("cnt !== 4");let w=new ae(ee[0],ee[1]),S=new ae(ee[2],ee[3]);if(zi(e,w)&&zi(t,w))return zi(e,S)&&zi(t,S)?4:Go(e.start(),t,S,w)?(ee[2]=e.start().x,ee[3]=e.start().y,4):Go(e.end(),t,S,w)?(ee[2]=e.end().x,ee[3]=e.end().y,4):Go(t.start(),e,S,w)?(ee[2]=t.start().x,ee[3]=t.start().y,4):Go(t.end(),e,S,w)?(ee[2]=t.end().x,ee[3]=t.end().y,4):2;if(zi(e,S)&&zi(t,S))return Go(e.start(),t,w,S)?(ee[0]=e.start().x,ee[1]=e.start().y,4):Go(e.end(),t,w,S)?(ee[0]=e.end().x,ee[1]=e.end().y,4):Go(t.start(),e,w,S)?(ee[0]=t.start().x,ee[1]=t.start().y,4):Go(t.end(),e,w,S)?(ee[0]=t.end().x,ee[1]=t.end().y,4):(ee[0]=ee[2],ee[1]=ee[3],2);{let C=function(G,z){if(me.eq(G.distance1(z.center),z.rx)&&zi(z,G)){if(G.distance2(w)<G.distance2(S)){if(R)return;R=!0}else{if(B)return;B=!0}ee[Y++]=G.x,ee[Y++]=G.y}},R=!1,B=!1,Y=0;return C(e.start(),t),C(e.end(),t),C(t.start(),e),C(t.end(),e),Y}}}function Go(e,t,i,r){return me.eq(e.distance1(t.center),t.rx)&&zi(t,e)&&e.distance2(i)<e.distance2(r)}function kE(e,t){return me.eq(t.start().distance1(e.center),e.rx)&&zi(e,t.start())?(ee[0]=t.start().x,ee[1]=t.start().y,ee[2]=t.start().x,ee[3]=t.start().y,!0):me.eq(t.end().distance1(e.center),e.rx)&&zi(e,t.end())?(ee[0]=t.end().x,ee[1]=t.end().y,ee[2]=t.end().x,ee[3]=t.end().y,!0):me.eq(e.start().distance1(t.center),t.rx)&&zi(t,e.start())?(ee[0]=e.start().x,ee[1]=e.start().y,ee[2]=e.start().x,ee[3]=e.start().y,!0):me.eq(e.end().distance1(t.center),t.rx)&&zi(t,e.end())?(ee[0]=e.end().x,ee[1]=e.end().y,ee[2]=e.end().x,ee[3]=e.end().y,!0):!1}function UE(e,t){if(t===0)return 0;let i=ee[0],r=ee[1];return zi(e,new ae(i,r))?(ee[0]=i,ee[1]=r,ee[2]=i,ee[3]=r,4):0}function FE(e,t,i){if(i===0)return 0;let r=ee[0],s=ee[1],n=new ae(r,s);return zi(e,n)&&zi(t,n)?(ee[0]=r,ee[1]=s,ee[2]=r,ee[3]=s,4):0}function Jh(e,t){return Math.abs(e-t)<=1e-6}function zi(e,t){let i=e.bbox();if(t.x-i.minX>-td&&t.x-i.maxX<td&&t.y-i.minY>-td&&t.y-i.maxY<td){let r=lt.regularD(t.angleD(e.center));return Jh(r,e.startAngle)||Jh(r,e.startAngle+360)||Jh(r,e.startAngle-360)||Jh(r,e.endAngle())||Jh(r,e.endAngle()+360)||Jh(r,e.endAngle()-360)?!0:e.sweepAngle>0?(me.less(r,e.startAngle)&&(r+=360),me.greatereq(e.endAngle(),r)):(me.greater(r,e.startAngle)&&(r-=360),me.lesseq(e.endAngle(),r))}else return!1}function Q6(e,t){let i=e[1].x-e[0].x,r=e[1].y-e[0].y,s=t[1].x-t[0].x,n=t[1].y-t[0].y;if(i===0&&s!==0||i!==0&&s===0)return!1;if(i===0&&s===0)return!0;let a=r/i,o=n/s;return sT(a,o,Math.sin(Math.PI/180))}function eB(e,t,i){var r,s=+t.x,n=+t.y,a=+i.x,o=+i.y,l=+e.x,h=+e.y,c=a-s,f=o-n,d=l-s,u=h-n,p,_,g,b,m,O;return c===0&&f===0?{d:Math.sqrt(d*d+u*u),point:new ae(s,n)}:(r=(d*c+u*f)/(c*c+f*f),r<0?{d:Math.sqrt(d*d+u*u),point:new ae(s,n)}:r>1?(p=l-a,_=h-o,{d:Math.sqrt(p*p+_*_),point:new ae(a,o)}):(m=s+r*c,O=n+r*f,g=l-m,b=h-O,{d:Math.sqrt(g*g+b*b),point:new ae(m,O)}))}function Dn(e,t){if(!e||!t||e.length!=t.length)return!1;let i="equals1";return!e.some((r,s)=>{let n=t[s],a=!1;return r&&n&&typeof r=="object"&&typeof n=="object"?typeof r[i]=="function"&&iB(r,n)?a=!r[i].call(r,n):a=!(r===n||r.toString()===n.toString()):typeof r=="number"&&typeof n=="number"?a=!(tB(r,n)||Number.isNaN(r)&&Number.isNaN(n)):a=r!==n,a})}function tB(e,t,i=5){return Math.abs(e-t)*Math.pow(10,i)<1}function iB(e,t){return!e||!t||typeof e!="object"||typeof t!="object"?e===t:e.constructor===t.constructor}var gt=new Float64Array(100);function c_(e,t){if(e.bbox().extendOfSize(me.eps).isSeparated(t.bbox()))return 0;let i=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,s=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(L){B=Math.min(B,L),Y=Math.max(Y,L)},o=function(L,M){let v=_a(L,M);if(v===0)throw new Error("cnt === 0");for(let P=0;P<v;P+=2)a(ee[P])};if(s>r){for(let L=s-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(me.eq(gt[L],gt[M])&&me.eq(gt[L+1],gt[M+1])){gt[M]=(gt[L]+gt[M])/2,gt[M+1]=(gt[L+1]+gt[M+1])/2;for(let v=s-3;v>=L;v--)gt[v]=gt[v+2];s-=2;break}if(s>r){s=0;let L=t.start(),M=new Float64Array(8);e.getPercent(L)!==null&&(M[s++]=L.x,M[s++]=L.y);let v=t.end();e.getPercent(v)!==null&&(M[s++]=v.x,M[s++]=v.y);let P=e.start();t.getPercent(P)!==null&&(M[s++]=P.x,M[s++]=P.y);let I=e.end();return t.getPercent(I)!==null&&(M[s++]=I.x,M[s++]=I.y),ee.set(M),s}}let[l,h]=i.pop(),c=l.controls,f=h.controls;if(c.length===2&&f.length===2){let L=_a(new le(c[0],c[1]),new le(f[0],f[1]));for(let M=0;M<L;M++)gt[s++]=ee[M];continue}let d=c[0],u=c[c.length-1];d.equals1(u)&&(u=d.add1(1,0));let p=u.y-d.y,_=d.x-u.x,g=-p*d.x-_*d.y,b=Math.sqrt(1/(p**2+_**2));p*=b,_*=b,g*=b;let m=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY;if(c.forEach(L=>{let M=p*L.x+_*L.y+g;M<m&&(m=M),M>O&&(O=M)}),me.eq(m,O)){if(h.controls.length===2){let L=_a(new le(l.start(),l.end()),new le(h.start(),h.end()));for(let M=0;M<L;M++)gt[s++]=ee[M];if(L!==0)continue}l=new ke([c[0],c[c.length-1]]),c=l.controls}let y=f.map(L=>{let M=p*L.x+_*L.y+g,v=Math.abs(M);return v<n&&(n=v),M}),x=0;for(let L of y){if(me.less(L,m))x=x|1;else if(me.greater(L,O))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let E=0,w=0,S=u.x-d.x,C=u.y-d.y,R=Math.sqrt(1/(S**2+C**2));S*=R,C*=R;for(let L=1;L<c.length;L++){let M=c[L],v=(M.x-d.x)*S+(M.y-d.y)*C;v<E?E=v:v>w&&(w=v)}x=0;for(let L of f){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(me.less(M,E))x=x|1;else if(me.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let B=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;n/=2,n<=me.eps&&(n=me.eps),m-=n,O+=n,y.forEach((L,M)=>{L>=m&&L<=O&&a(M/(y.length-1))});let G=new le(new ae(0,m),new ae(1,m)),z=new le(new ae(0,O),new ae(1,O));for(let L=0;L<y.length-1;L++){let M=new ae(L/(y.length-1),y[L]),v=M.y<m?1:M.y>O?2:3;for(let P=0;P<y.length;P++){let I=new ae(P/(y.length-1),y[P]),N=I.y<m?1:I.y>O?2:3;v!==N&&(v===1?N===2?(o(new le(M,I),G),o(new le(M,I),z)):o(new le(M,I),G):v===2?N===1?(o(new le(M,I),G),o(new le(M,I),z)):o(new le(M,I),z):N===1?o(new le(M,I),G):o(new le(M,I),z))}}B!==0&&(h=h.clip(B)[1]),Y!==1&&(h=h.clip((Y-B)/(1-B))[0]);let q=h.bbox();if(me.eq(q.minX,q.maxX)&&me.eq(q.minY,q.maxY)){x=0;for(let L of h.controls){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(me.less(M,E))x=x|1;else if(me.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x===3){let L=new ae((q.minX+q.maxX)/2,(q.minY+q.maxY)/2);l.getPercent(L)&&(gt[s++]=L.x,gt[s++]=L.y)}continue}if(Y-B>.8){let[L,M]=h.clip(.5);i.push([L,l]),i.push([M,l])}else i.push([h,l])}for(let a=0;a<s;a++)ee[a]=gt[a];return s}function rB(e,t){if(e.bbox().extendOfSize(me.eps).isSeparated(t.bbox()))return{cnt:0};let i=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,s=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(L){B=Math.min(B,L),Y=Math.max(Y,L)},o=function(L,M){let v=_a(L,M);if(v===0)throw new Error("cnt === 0");for(let P=0;P<v;P+=2)a(ee[P])};if(s>r){for(let L=s-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(me.eq(gt[L],gt[M])&&me.eq(gt[L+1],gt[M+1])){gt[M]=(gt[L]+gt[M])/2,gt[M+1]=(gt[L+1]+gt[M+1])/2;for(let v=s-3;v>=L;v--)gt[v]=gt[v+2];s-=2;break}if(s>r){s=0;let L=new Float64Array(8),M=t.end(),v=0;e.getPercent(M)!==null&&(L[s++]=M.x,L[s++]=M.y,v=2);let P=e.end();return t.getPercent(P)!==null&&(L[s++]=P.x,L[s++]=P.y,v=v===0?1:3),ee.set(L),{havOverlap:v,cnt:s}}}let[l,h]=i.pop(),c=l.controls,f=h.controls;if(c.length===2&&f.length===2){let L=_a(new le(c[0],c[1]),new le(f[0],f[1]));for(let M=0;M<L;M++)gt[s++]=ee[M];continue}let d=c[0],u=c[c.length-1];d.equals1(u)&&(u=d.add1(1,0));let p=u.y-d.y,_=d.x-u.x,g=-p*d.x-_*d.y,b=Math.sqrt(1/(p**2+_**2));p*=b,_*=b,g*=b;let m=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY;if(c.forEach(L=>{let M=p*L.x+_*L.y+g;M<m&&(m=M),M>O&&(O=M)}),me.eq(m,O)){if(h.controls.length===2){let L=_a(new le(l.start(),l.end()),new le(h.start(),h.end()));for(let M=0;M<L;M++)gt[s++]=ee[M];if(L!==0)continue}l=new ke([c[0],c[c.length-1]]),c=l.controls}let y=f.map(L=>{let M=p*L.x+_*L.y+g,v=Math.abs(M);return v<n&&(n=v),M}),x=0;for(let L of y){if(me.less(L,m))x=x|1;else if(me.greater(L,O))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let E=0,w=0,S=u.x-d.x,C=u.y-d.y,R=Math.sqrt(1/(S**2+C**2));S*=R,C*=R;for(let L=1;L<c.length;L++){let M=c[L],v=(M.x-d.x)*S+(M.y-d.y)*C;v<E?E=v:v>w&&(w=v)}x=0;for(let L of f){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(me.less(M,E))x=x|1;else if(me.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let B=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;n/=2,n<=me.eps&&(n=me.eps),m-=n,O+=n,y.forEach((L,M)=>{L>=m&&L<=O&&a(M/(y.length-1))});let G=new le(new ae(0,m),new ae(1,m)),z=new le(new ae(0,O),new ae(1,O));for(let L=0;L<y.length-1;L++){let M=new ae(L/(y.length-1),y[L]),v=M.y<m?1:M.y>O?2:3;for(let P=0;P<y.length;P++){let I=new ae(P/(y.length-1),y[P]),N=I.y<m?1:I.y>O?2:3;v!==N&&(v===1?N===2?(o(new le(M,I),G),o(new le(M,I),z)):o(new le(M,I),G):v===2?N===1?(o(new le(M,I),G),o(new le(M,I),z)):o(new le(M,I),z):N===1?o(new le(M,I),G):o(new le(M,I),z))}}B!==0&&(h=h.clip(B)[1]),Y!==1&&(h=h.clip((Y-B)/(1-B))[0]);let q=h.bbox();if(me.eq(q.minX,q.maxX)&&me.eq(q.minY,q.maxY)){x=0;for(let L of h.controls){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(me.less(M,E))x=x|1;else if(me.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x===3){let L=new ae((q.minX+q.maxX)/2,(q.minY+q.maxY)/2);l.getPercent(L)&&(gt[s++]=L.x,gt[s++]=L.y)}continue}if(Y-B>.8){let[L,M]=h.clip(.5);i.push([L,l]),i.push([M,l])}else i.push([h,l])}for(let a=0;a<s;a++)ee[a]=gt[a];return{cnt:s}}var sB=class{constructor(e=me.eps){this.eps=e}eq(e,t){return Math.abs(e-t)<=this.eps}setEps(e){this.eps=e}},Ku=new sB;function GE(e,t){if(e.bbox().extendOfSize(me.eps).isSeparated(t.bbox()))return 0;let i=[[e,t]],r=(t.controls.length-1)*16,s=0;for(;i.length!==0;){if(s>r){let a=function(){for(let h=0;h<s;h+=2)for(let c=h+2;c<s;c+=2)if(!(Ku.eq(gt[h],gt[c])&&Ku.eq(gt[h+1],gt[c+1]))){l(gt[c],gt[c+1],o);break}function l(h,c,f){let d=!1;for(let u=0;u<f.length;u+=2)if(Ku.eq(h,f[u])&&Ku.eq(c,f[u+1])){d=!0;break}d||f.push(h,c)}},o=[gt[0],gt[1]];if(a(),o.length>=100&&(Ku.setEps(.001),o=[gt[0],gt[1]],a(),o.length>=100))throw new Error("clearSamePoint()");s=o.length,o.forEach((l,h)=>gt[h]=l)}let n=i.pop();if(n[0]instanceof Oe){let a=function(z){C=Math.min(C,z),R=Math.max(R,z)},o=function(z,q){let L=_a(z,q);if(L===0)throw new Error("cnt === 0");for(let M=0;M<L;M+=2)a(ee[M])},[l,h]=n,c=h.controls;if(c.length===2){let z=m0(l,new le(c[0],c[1]));for(let q=0;q<z;q++)gt[s++]=ee[q];continue}let f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,u,p,_,g,b;if(Math.abs(l.sweepAngle)>359){let z=l.rx;u=l.center.add1(z,0),p=l.center.add1(-z,0),f=-z,d=z,_=0,g=1,b=-l.center.y}else{u=l.start(),p=l.end(),_=p.y-u.y,g=u.x-p.x,b=-_*u.x-g*u.y;let z=Math.sqrt(1/(_**2+g**2));_*=z,g*=z,b*=z;let q=_*l.center.x+g*l.center.y+b;l.isCCW?(d=l.rx+q,f=0):(f=q-l.rx,d=0)}let m=c.map(z=>_*z.x+g*z.y+b),O=0;for(let z of m){if(me.less(z,f))O=O|1;else if(me.greater(z,d))O=O|2;else{O=3;break}if(O===3)break}if(O!==3)continue;let y=0,x=0,E=p.x-u.x,w=p.y-u.y,S=Math.sqrt(1/(E**2+w**2));if(E*=S,w*=S,Math.abs(l.sweepAngle)<=180)y=0,x=(p.x-u.x)*E+(p.y-u.y)*w;else throw new Error("not support");O=0;for(let z of c){let q=(z.x-u.x)*E+(z.y-u.y)*w;if(me.less(q,y))O=O|1;else if(me.greater(q,x))O=O|2;else{O=3;break}if(O===3)break}if(O!==3)continue;let C=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY;f-=me.eps,d+=me.eps,m.forEach((z,q)=>{z>=f&&z<=d&&a(q/(m.length-1))});let B=new le(new ae(0,f),new ae(1,f)),Y=new le(new ae(0,d),new ae(1,d));for(let z=0;z<m.length-1;z++){let q=new ae(z/(m.length-1),m[z]),L=q.y<f?1:q.y>d?2:3;for(let M=0;M<m.length;M++){let v=new ae(M/(m.length-1),m[M]),P=v.y<f?1:v.y>d?2:3;L!==P&&(L===1?P===2?(o(new le(q,v),B),o(new le(q,v),Y)):o(new le(q,v),B):L===2?P===1?(o(new le(q,v),B),o(new le(q,v),Y)):o(new le(q,v),Y):P===1?o(new le(q,v),B):o(new le(q,v),Y))}}C!==0&&(h=h.clip(C)[1]),R!==1&&(h=h.clip((R-C)/(1-C))[0]);let G=h.bbox();if(me.eq(G.minX,G.maxX)&&me.eq(G.minY,G.maxY)){O=0;for(let z of h.controls){let q=(z.x-u.x)*E+(z.y-u.y)*w;if(me.less(q,y))O=O|1;else if(me.greater(q,x))O=O|2;else{O=3;break}if(O===3)break}O===3&&(gt[s++]=(G.minX+G.maxX)/2,gt[s++]=(G.minY+G.maxY)/2);continue}R-C>.8?h.clip(.5).forEach(z=>i.push([z,l])):i.push([h,l])}else{let[a,o]=n;i.push([Oe.build3(o.center,o.startAngle,o.sweepAngle/2,o.rx,o.ry),a]),i.push([Oe.build3(o.center,o.startAngle+o.sweepAngle/2,o.sweepAngle/2,o.rx,o.ry),a])}}for(let n=0;n<s;n++)ee[n]=gt[n];return s}var nB=class{static getSweep(e){if(e.length>2){let t=0,i=e.length;for(let n=0;n<i-1;n++){let a=e[n],o=e[n+1];t+=(o.x+a.x)*(o.y-a.y)}let r=e[0],s=e[i-1];return t+=(r.x+s.x)*(r.y-s.y),t>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(e){return!!(e.primitives.length>0&&e.primitives[0].start().equals1(e.primitives[e.primitives.length-1].end()))}};function aB(e){let t=e.primitives,i=t[0],r=i instanceof Oe?i.sweepAngle%360:null;if(t.length===1&&i instanceof Oe&&(me.eq(r,0)||me.eq(Math.abs(r),360)))return!!i.isCCW;let s=new Array;return e.points(.1,n=>{s.push(n)}),nB.getSweep(s)}var oB=class{static zoomCorner(e,t){let i=new Array,r=new Array,s=new Array;return this.getPanPrimitive(e,i,s,t),this.rearrange(i,s),this.processStart(i,s),this.getResult(i,s,r,t),r.length>0?mt.build2(r):null}static zoomPolygon(e,t){let i=new Array,r=new Array,s=new Array;return aB(e)&&(e=e.reverse().asClose()),this.getPanPrimitive(e,i,s,t),this.rearrange(i,s),this.processStart(i,s),this.getResult(i,s,r,t),r.length>0?mt.build2(r):null}static zoomLines(e,t){return this.zoomPolygon(mt.build2(e.primitives.concat(e.reverse().primitives)),t/2)}static getPanPrimitive(e,t,i,r){let s=e.primitives;for(let n of s){let a=this.panDistance(n,r);a!==void 0&&(t.push(a),i.push(n))}}static rearrange(e,t){let i=e.length,r=0;for(let a=0;a<i;a++){let o=t[a],l=e[a],h=a==i-1?e[0]:e[a+1];if(!(l instanceof Oe&&h instanceof Oe)&&!this.isCW(l.end(),h.start(),o.end())){if(dn(l,h)!=0){r=a==i-1?0:a+1;break}}else{r=a;break}}let s=this.start4Index(t,r),n=this.start4Index(e,r);t.length=0,e.length=0,s.forEach(a=>{t.push(a)}),n.forEach(a=>{e.push(a)})}static processStart(e,t){let i=e.length;if(i>2){let r=e[i-1],s=e[0],n=t[i-1];if(!(r instanceof Oe&&s instanceof Oe)&&!this.isCW(r.end(),s.start(),n.end())){let a=dn(r,s);for(let o=0;o<a;o+=2){let l=new ae(ee[o],ee[o+1]);e[i-1]=this.generatePrimitive(r,r.start(),l),e[0]=this.generatePrimitive(s,l,s.end())}}}}static getResult(e,t,i,r){let s=e.length;for(let n=0;n<s;n++){let a=t[n],o=n===s-1?t[0]:t[n+1],l=n==s-1?0:n+1,h=l==s-1?t[0]:t[l+1],c=e[n],f=n==s-1?e[0]:e[n+1],d=l==s-1?e[0]:e[l+1];if(!(c instanceof Oe&&f instanceof Oe)&&!this.isCW(c.end(),f.start(),a.end())){let p=this.add(e,i,n,c,f,0);p=this.update(e,i,n,f,p);let _=this.generateArc(o,h,f,d,r);if(p=this.add(e,i,n,c,_,p),p=this.update(e,i,n,_,p),p>0)continue}i.push(c);let u=this.generateArc(a,o,c,f,r);u!==void 0&&i.push(u)}}static generateArc(e,t,i,r,s){if(s>0){let n=e.end(),a=t.start(),o=i.end(),l=r.start();if(o.distance2(l)>1e-8)if(n.equals(a)){let h=o.angleD(n),c=l.angleD(n);return Oe.build2(n,h,c,s,s,0)}else{let h=o.angleD(n),c=l.angleD(n),f=o.angleD(a),d=l.angleD(a),u=Oe.build2(n,h,c,s,s,0),p=Oe.build2(a,f,d,s,s,0);return u.pointOn(u.endAngle()).equals1(l)?u:p.pointOn(p.endAngle()).equals1(l)?p:u}}}static updateNews(e,t,i,r){let s=e.length,n=t==s-1?0:t+1;e[n]=this.generatePrimitive(i,r,i.end())}static add(e,t,i,r,s,n){if(n>0)return n;if(r!=null&&s!=null){let a=dn(r,s);for(let o=0;o<a;o+=2){let l=new ae(ee[o],ee[o+1]);t.push(this.generatePrimitive(r,r.start(),l)),this.updateNews(e,i,s,l);break}return a}else return 0}static update(e,t,i,r,s){if(s>0)return s;let n=t.length;if(n>0&&r!=null){let a=t[n-1],o=dn(a,r);for(let l=0;l<o;l+=2){let h=new ae(ee[l],ee[l+1]);t[n-1]=this.generatePrimitive(a,a.start(),h),this.updateNews(e,i,r,h)}return o}else return 0}static generatePrimitive(e,t,i){if(e instanceof le)return new le(t,i);if(e instanceof Oe){let r=e,s=t.angleD(r.center),n=i.angleD(r.center);return Oe.build2(r.center,s,n,r.rx,r.ry,r.sweep())}else throw new Error("not supported operation")}static start4Index(e,t){let i=e.length,r=new Array;for(let s=t;s<i;s++)r.push(e[s]);for(let s=0;s<t;s++)r.push(e[s]);return r}static isCW(e,t,i){let r=new le(i,e),s=new le(i,t),n=r.end().x-r.start().x,a=r.end().y-r.start().y,o=s.end().x-s.start().x,l=s.end().y-s.start().y;return!(n*l-a*o>0)}static panDistance(e,t){if(e instanceof le){if(e.isPoint())return;{let i=e.panDistance(t);return i.length()>1e-5?i:void 0}}else if(e instanceof Oe){let i=e;if(i.sweepAngle>0){if(i.rx-t<=0||i.ry-t<=0)return}else if(i.sweepAngle<0&&(i.rx+t<=0||i.ry+t<=0))return;return i=i.panDistance(t),i.start().distance1(i.end())>1e-5||me.eq(Math.abs(i.sweepAngle),360)?i:void 0}else throw new Error("not supported operation")}},it=.001,as=it**2;function qe(e,t){return e.distance2(t)<as}function ga(e,t){return Math.abs(e-t)<=1e-4}function lB(e,t){if(e instanceof le)return new le(e.start(),t);if(e instanceof Oe){let i=t.angleD(e.center);return ga(lt.regularD(e.startAngle),lt.regularD(i))?Oe.build3(e.center,e.startAngle,0,e.rx,e.ry):Oe.build2(e.center,e.startAngle,i,e.rx,e.ry,e.isCCW?1:0)}else{if(e instanceof ke)return e.clip(e.getPercent(t,it))[0];throw new Error("not supported operation")}}function Bn(e,t=lt.toRadians(e.startAngle)){return e.isCCW?t+=O_:t-=O_,new ae(Math.cos(t),Math.sin(t))}function ud(e,t=0){let i=e.controls;if(t===0){let r=i[0],s=i.slice(1).find(n=>!(n.x===r.x&&n.y===r.y));if(!s)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return s.sub(r)}else if(t===1){let r=i[i.length-1],s=i.slice(0,-1).reverse().find(n=>!(n.x===r.x&&n.y===r.y));if(!s)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return r.sub(s)}if(i.length===3){let[r,s,n]=i;return s.sub(r).mul(2*(1-t)).add(n.sub(s).mul(2*t)).normalize()}else{let[r,s,n,a]=i;return s.sub(r).mul(3*(1-t)**2).add(n.sub(s).mul(6*(1-t)*t)).add(a.sub(n).mul(3*t**2)).normalize()}}function oc(e,t,i){let r=e.slice(1).findIndex(n=>!(n.x===t.x&&n.y===t.y)),s=e[r+1];if(i&&(i.getPercent(s,it)!==null||new le(i.start(),i.end()).distance(s)<=it)&&(s=e[r+2]),!s)throw Error("getSecondPoint(controls: readonly Vector2[])");return s}function tt(e,t){if(e instanceof le)return e.end().sub(e.start()).normalize();if(e instanceof Oe)return(t?Bn(e,t.angle(e.center)):Bn(e)).normalize();if(e instanceof ke)if(e.controls.length===2){let[i,r]=e.controls;if(qe(i,r))throw Error("equalsPP(p0, p1)");return r.sub(i).normalize()}else return(t?ud(e,e.getPercent(t,it)):ud(e)).normalize();else throw new Error("not support")}function hB(e,t,i){let r=[],s=t**2-4*e*i;if(s>=0){let n=-t/(2*e),a=Math.sqrt(s)/(2*e),o=n+a;if(r.push(o),s>0){let l=n-a;r.push(l)}}return r}function cB(e,t,i,r,s=0,n=1){let a=[],o=e*Math.pow(s,3)+t*Math.pow(s,2)+i*s+r,l=e*Math.pow(n,3)+t*Math.pow(n,2)+i*n+r,h,c;if(o*l<0)for(;Math.abs(s-n)>it;)if(h=(s+n)/2,c=e*Math.pow(h,3)+t*Math.pow(h,2)+i*h+r,Math.abs(c)<it){a.push(h);break}else o*c<0?n=h:l*c<0&&(s=h);else o*l===0&&(o===0&&a.push(s),l===0&&a.push(n));return a}function Km(e,t,i){if(e instanceof le||t.distance2(i)<=as)return new le(t,i);if(e instanceof Oe)return Oe.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof ke){let r=e.getPercent(t,it),s=e.getPercent(i,it);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}function y0(e){return me.greater(e,0)&&me.less(e,1)}function y_(e,t,i,r){let s=e[r]-2*t[r]+i[r],n=t[r]-e[r];if(s===0)return[];let a=-n/s,o=[];return y0(a)&&o.push(a),o}function b_(e,t,i,r,s){let n,a,o=-e[s]+3*t[s]-3*i[s]+r[s],l=2*(e[s]-2*t[s]+i[s]),h=t[s]-e[s],c=l**2-4*o*h;if(me.lesseq(c,0))n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;else{let d=Math.sqrt(c);n=(-l-d)/(2*o),a=(-l+d)/(2*o);let u=o*2;if(me.lesseq(n,1)&&me.greatereq(n,0)){let p=Number.NEGATIVE_INFINITY;for(;me.neq(n,p);){p=n;let _=u*n+l;n=-(o*n**2+l*n+h-_*n)/_}}if(me.lesseq(a,1)&&me.greatereq(a,0)){let p=Number.NEGATIVE_INFINITY;for(;me.neq(a,p);){p=a;let _=u*a+l;a=-(o*a**2+l*a+h-_*a)/_}}}let f=[];return y0(a)&&f.push(a),y0(n)&&f.push(n),f}function oT(e,t){if(e.controls.length===2){let[o,l]=e.controls;qe(o,l)||t.push(new le(o,l));return}let i,r;if(e.controls.length===3){let[o,l,h]=e.controls;i=y_(o,l,h,"x"),r=y_(o,l,h,"y")}else{let[o,l,h,c]=e.controls;i=b_(o,l,h,c,"x"),r=b_(o,l,h,c,"y")}i.sort((o,l)=>l-o),r.sort((o,l)=>l-o);let s=i.pop()||1,n=r.pop()||1,a=0;for(;s!==1||n!==1;)if(me.eq(s,n))s=i.pop()||1,n=r.pop()||1;else if(s<n){let[o,l]=e.clip((s-a)/(1-a));a=s,t.push(o),e=l,s=i.pop()||1}else{let[o,l]=e.clip((n-a)/(1-a));a=n,t.push(o),e=l,n=r.pop()||1}t.push(e)}var uB=1e-5,N0=1,ke=class _s extends pd{constructor(t){if(super(),this._startToEndL=null,t.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=t.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new le(this.start(),this.end())),this._startToEndL}build1(t){let i=[];return lc(t,(r,s)=>(i.push(s),!0)),new _s(i)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(t,i){if(i.length<1)throw new Error("bezier must have at least 1 point");if(i.length===1)return i[0];{let r=new Array(i.length-1);for(let s=1;s<i.length;s++){let n=i[s-1],a=i[s],o=(a.x-n.x)*t,l=(a.y-n.y)*t;r[s-1]=n.add1(o,l)}return _s.pointOn(t,r)}}clip1(t,i,r,s){if(r.push(i[0]),s.push(i[i.length-1]),i.length<2)throw new Error("bezier clip must have at least 2 point");if(i.length===2){let n=i[0],a=i[1],o=(a.x-n.x)*t,l=(a.y-n.y)*t,h=n.add1(o,l);r.push(h),s.push(h)}else{let n=new Array(i.length-1);for(let a=1;a<i.length;a++){let o=i[a-1],l=i[a],h=(l.x-o.x)*t,c=(l.y-o.y)*t;n[a-1]=o.add1(h,c)}this.clip1(t,n,r,s)}}clip(t){let i=[],r=[];return this.clip1(t,this.controls,i,r),[new _s(i),new _s(r.reverse())]}greater(t,i,r){return t-i>r}less(t,i,r){return t-i<-r}eq(t,i,r){return Math.abs(t-i)<=r}eqPP(t,i,r){return!t||!i?!1:this.eq(t.x,i.x,r)&&this.eq(t.y,i.y,r)}isInRange(t,i=me.eps){let r=this.controls.map(n=>n.y-t.y),s=0;for(let n of r){if(this.less(n,0,i))s=s|1;else if(this.greater(n,0,i))s=s|2;else{s=3;break}if(s===3)break}if(s!==3)return!1;s=0;for(let n of this.controls){let a=n.x-t.x;if(this.less(a,0,i))s=s|1;else if(this.greater(a,0,i))s=s|2;else{s=3;break}if(s===3)break}return s===3}getPercent(t,i=me.eps){if(!this.isInRange(t,i))return null;let r=Number.POSITIVE_INFINITY,s=[[this,0,1]];for(;s.length!==0;){let n=function(g){c=Math.min(c,g),f=Math.max(f,g)},a=function(g,b){let m=_a(g,b);if(m===0)throw new Error("cnt === 0");for(let O=0;O<m;O+=2)n(ee[O])},[o,l,h]=s.pop();if(this.eqPP(o.start(),t,i))return l;if(this.eqPP(o.end(),t,i))return h;let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d=o.controls.map(g=>g.y-t.y);r=d.reduce((g,b)=>{let m=Math.abs(b);return m<g?m:g},r),r/=2,r<=i&&(r=i),d.forEach((g,b)=>{this.eq(g,0,i)&&n(b/(d.length-1))});let u=new le(new ae(0,-r),new ae(1,-r)),p=new le(new ae(0,r),new ae(1,r));for(let g=0;g<d.length-1;g++){let b=new ae(g/(d.length-1),d[g]),m=this.less(b.y,0,i)?1:this.greater(b.y,0,i)?2:3;for(let O=0;O<d.length;O++){let y=new ae(O/(d.length-1),d[O]),x=this.less(y.y,0,i)?1:this.greater(y.y,0,i)?2:3;m!==x&&(m===1?x===2?(a(new le(b,y),u),a(new le(b,y),p)):a(new le(b,y),u):m===2?x===1?(a(new le(b,y),u),a(new le(b,y),p)):a(new le(b,y),p):x===1?a(new le(b,y),u):a(new le(b,y),p))}}if(!isFinite(c)){if(Math.max(...d.map(g=>Math.abs(g)))<i*4)return(l+h)/2;continue}if(c!==0&&(o=o.clip(c)[1],l=(h-l)*c+l),f!==1){let g=(f-c)/(1-c);o=o.clip(g)[0],h=(h-l)*g+l}if(!o.isInRange(t,i))continue;let _=o.controls.reduce((g,b)=>g.ext2(b),new vi).build1();if(this.eq(_.minX,_.maxX,i)&&this.eq(_.minY,_.maxY,i))return(l+h)/2;if(f-c>.8){let[g,b]=o.clip(.5);g.isInRange(t,i)?(s.push([g,l,(l+h)/2]),b.isInRange(t,i)&&s.push([b,(l+h)/2,h])):s.push([b,(l+h)/2,h])}else s.push([o,l,h])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new vi().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new vi().ext3(this.controls).build()),this._bbox_controls}multiply3(t){let i=new Array(this.controls.length);for(let r=0;r<this.controls.length;r++){let s=this.controls[r];i[r]=s.multiply3(t)}return new _s(i)}stroke(t,i,r,s=N0){let n=oB.zoomLines(mt.build4(this.points(s)),t);return r===0?n:n.reverse()}points(t){let i=[];return this.getBezierPoints(t,r=>i.push(r)),i}getBezierPoints(t,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let r=[this];for(i(this.start());r.length!==0;){let n=r.pop(),a=new le(n.start(),n.end());if(s(n.controls,a)<=t)i(n.end());else{let[o,l]=n.clip(.5);r.push(l,o)}}function s(n,a){let o=a.start(),l=a.end();o.equals1(l)&&(l=o.add1(1,0));let h=l.y-o.y,c=o.x-l.x,f=-h*o.x-c*o.y,d=Math.sqrt(1/(h**2+c**2));h*=d,c*=d,f*=d;let u=n.map(p=>Math.abs(h*p.x+c*p.y+f));return Math.max(...u)}}getBezierPoints3(t,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let r=t*t,s=this.controls[0],n=.5;for(;n>uB&&!(s.distance2(_s.pointOn(n,this.controls))<=r);n*=.5);let a=Math.ceil(1/n);n=1/a,i(s);let o=0;for(let l=1;l<a;l++)o+=n,i(_s.pointOn(o,this.controls));i(this.end())}getPointsBySlope(t){if(this.controls.length===4)return this.getPointsBySlope4(t);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(t){let[i,r,s,n]=this.controls,a=-3*i.x+9*r.x-9*s.x+3*n.x,o=6*i.x-12*r.x+6*s.x,l=-3*i.x+3*r.x,h=[];if(Number.isFinite(t)){let c=-3*i.y+9*r.y-9*s.y+3*n.y,f=6*i.y-12*r.y+6*s.y,d=-3*i.y+3*r.y,u=c-a*t,p=f-o*t,_=d-l*t,g=-p/(2*u),b=Math.sqrt(p**2-4*u*_)/(2*u),m=g+b;m>=0&&m<=1&&h.push(_s.pointOn(m,this.controls));let O=g-b;O>=0&&O<=1&&h.push(_s.pointOn(O,this.controls))}else{let c=-o/(2*a),f=Math.sqrt(o**2-4*a*l)/(2*a),d=c+f;d>=0&&d<=1&&h.push(_s.pointOn(d,this.controls));let u=c-f;u>=0&&u<=1&&h.push(_s.pointOn(u,this.controls))}return h}buildConverxHull(t=me.eps){let i=[...this.controls],r=[],s=i[0],n=1;do{let a=i[n%i.length];this.eqPP(s,a,t)||r.push(new le(s,a)),s=a,n++}while(s!==i[0]);if(r.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return mt.build7(r).asClose()}getExtremePoints(t){if(!t)return a(this.controls);let i=t.start(),r=t.end(),s=r.x-i.x,n=r.y-i.y;if(Math.abs(s)<=me.eps||Math.abs(n)<=me.eps)return a(this.controls);{let o=n/s;if(this.controls.length===3){i.equals1(r)&&(r=i.add1(1,0));let l=r.y-i.y,h=i.x-r.x,c=-l*i.x-h*i.y,f=Math.sqrt(1/(l**2+h**2));l*=f,h*=f,c*=f;let d=this.controls.map(_=>l*_.x+h*_.y+c),u=d[0]-2*d[1]+d[2],p=d[1]-d[0]-o/2;if(u!==0){let _=-p/u;if(me.greater(_,0)&&me.less(_,1))return[_s.pointOn(_,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(o)}return[];function a(o){let l,h;if(o.length===3){let[u,p,_]=o;l=y_(u,p,_,"x"),h=y_(u,p,_,"y")}else if(o.length===4){let[u,p,_,g]=o;l=b_(u,p,_,g,"x"),h=b_(u,p,_,g,"y")}l.sort((u,p)=>p-u),h.sort((u,p)=>p-u);let c=l.pop()||1,f=h.pop()||1,d=[];for(;c!==1||f!==1;)me.eq(c,f)?(c=l.pop()||1,f=h.pop()||1):c<f?(d.push(_s.pointOn(c,o)),c=l.pop()||1):(d.push(_s.pointOn(f,o)),f=h.pop()||1);return d}}getToLineMaxDis2(t){let i=this.getExtremePoints(t),r=t.distance2(this.start()),s=t.distance2(this.end()),n=Math.max(r,s);return i.forEach(o=>a(t.distance2(o))),n;function a(o){n=Math.max(n,o)}}getToLineMinAndMaxDis_Controls(t){let i=t.start(),r=t.end();t.start().equals1(t.end())&&(r=i.add1(1,0));let s=r.y-i.y,n=i.x-r.x,a=-s*i.x-n*i.y,o=Math.sqrt(1/(s**2+n**2));s*=o,n*=o,a*=o;let l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return this.controls.forEach(c=>{let f=s*c.x+n*c.y+a;f<l&&(l=f),f>h&&(h=f)}),{minDis:l,maxDis:h}}getPercentInLine(t){let i=[],r=[],s=this.controls,n=t.start(),a=t.end(),o=a.y-n.y,l=n.x-a.x,h=-o*n.x-l*n.y,c=Math.sqrt(1/(o**2+l**2));if(o*=c,l*=c,h*=c,o**2+l**2<=0)return i;if(s.length===3){let[f,d,u]=s,p=o*(f.x-2*d.x+u.x)+l*(f.y-2*d.y+u.y),_=2*(o*(d.x-f.x)+l*(d.y-f.y)),g=o*f.x+l*f.y+h;r=hB(p,_,g)}else if(s.length===4){let[f,d,u,p]=s,_=p.sub(u.mul(3)).add(d.mul(3)).sub(f),g=f.sub(d.mul(2)).add(u).mul(3),b=d.sub(f).mul(3),m=f,O=o*_.x+l*_.y,y=o*g.x+l*g.y,x=o*b.x+l*b.y,E=o*m.x+l*m.y+h,w=Math.sqrt(1/(O**2+y**2));O*=w,y*=w,x*=w,E*=w,r=cB(O,y,x,E)}else throw Error("not support getBeizerPointInLine");return r.forEach(f=>{f>=0&&f<=1&&i.push(f)}),i}reverse(){return new _s(this.controls.slice().reverse())}},lT=class id{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=ae.ORIGIN,this.textOffsetCache[1]=new ae(0,-.5),this.textOffsetCache[2]=new ae(0,-1),this.textOffsetCache[3]=new ae(-.5,0),this.textOffsetCache[4]=new ae(-.5,-.5),this.textOffsetCache[5]=new ae(-.5,-1),this.textOffsetCache[6]=new ae(-1,0),this.textOffsetCache[7]=new ae(-1,-.5),this.textOffsetCache[8]=new ae(-1,-1)}static getCache(){return id.instance==null&&(id.instance=new id),id.instance}};lT.instance=null;var hT=lT,le=class zl extends pd{constructor(t,i){super(),this._start=t,this._end=i}get a(){return this._a==null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b==null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c==null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(t){if(me.eq(this.distance(t),0)){let i=new zl(this._start,t);return i._a=this._a,i._b=this._b,i._c=this._c,i}return new zl(this._start,t)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new ke([this._start,this._end])}_hashCode(){let t=31,i=1;return i=t*i+this._start.hashCode(),i=t*i+this._end.hashCode(),i}start(){return this._start}end(){return this._end}center(){let t=this.start(),i=this.end();return t.add(i).mul(.5)}panDistance(t){let i=this._end.x-this._start.x,r=this._end.y-this._start.y,s=this.length();i=i*t/s,r=-r*t/s;let n=new ae(this._start.x+r,this._start.y+i),a=new ae(this._end.x+r,this._end.y+i);return new zl(n,a)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let t=hT.getCache().boxCache;t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.__bbox=new Ni(t[0],t[1],t[2],t[3])}return this.__bbox}multiply3(t){return new zl(this._start.multiply3(t),this._end.multiply3(t))}hashCode(){return this.hashed}equals(t){let i=t;return this.hashed===i.hashed&&this._start.equals(i._start)&&this._end.equals(i._end)}equals1(t){let i=t;return this.hashed===i.hashed&&this._start.equals1(i._start)&&this._end.equals1(i._end)}equals2(t){let i=[this.start(),this.end()],r=[t.start(),t.end()];return Dn(i,r)||Dn(i,r.reverse())}stroke(t,i,r){let s,n,a;this._end.x<this._start.x?(n=this._start.x-this._end.x,a=this._start.y-this._end.y,s=this._end):(n=this._end.x-this._start.x,a=this._end.y-this._start.y,s=this._start);let o=Math.sqrt(n*n+a*a),l=t/2,h,c,f;i===2?(c=-l,f=o+l):(c=0,f=o),i===0||i===2?r===0?h=mt.build5([c,-l,c,l,f,l,f,-l]):h=mt.build5([c,l,c,-l,f,-l,f,l]):r===0?h=mt.build2([Oe.build3(new ae(c,0),-90,-180,l,l),Oe.build3(new ae(f,0),90,-180,l,l)]):h=mt.build2([Oe.build3(new ae(c,0),90,180,l,l),Oe.build3(new ae(f,0),-90,180,l,l)]);let d=Math.atan2(a,n),u=Ii.rotate(d).translate1(s);return h.asClose().multiply3(u)}points(t){return[this._start,this._end]}mirrorY(t){return new zl(this.start().mirrorY(t),this.end().mirrorY(t))}reverse(){return new zl(this._end,this._start)}inArea(t,i,r){let s=t.x,n=t.y,a=this._start,o=this._end,l=r==1,h=s-a.x,c=n-a.y,f=s-o.x,d=n-o.y,u=o.x-a.x,p=o.y-a.y,_=new ae(-p,u).normalize(),g=u+_.x*i/2,b=p+_.y*i/2,m=g*g+b*b,O=h*h+c*c,y=f*f+d*d,x=Math.abs(h*p-c*u)/2,E=Math.sqrt(u*u+p*p)*i/4;if(x<=E&&O<=m&&y<=m){if(l)return!0;{let w=new ae(s,n).sub(o).normalize(),S=new ae(s,n).sub(a).normalize(),C=new ae(_.x,_.y).cross(w),R=new ae(_.x,_.y).cross(S);return C>=0&&R<=0}}else if(l){let w=i/2;return O<=w*w?!0:y<=w*w}else return!1}isParallel(t,i=!1){let r=me.eq(Math.abs(this.direct.cross(t.direct)),0),s=!i||me.greatereq(this.direct.dot(t.direct),0);return r&&s}distance2(t){return(this.a*t.x+this.b*t.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(t){let{x:i,y:r}=t,{x:s,y:n}=this.start(),{x:a,y:o}=this.end();return((i-s)*(o-n)-(r-n)*(a-s))**2/((o-n)**2+(a-s)**2)}distance(t){return Math.abs(this.a*t.x+this.b*t.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function dB(e,t=.05){if(e.length<3)return e.slice();let i=e.slice(0,1),r=(n,a,o)=>V6(n.x,n.y,a.x,a.y,o.x,o.y);for(;;){i=e.slice(0,1);for(let n=1;n<e.length-1;n+=2)r(e[n],e[n-1],e[n+1])>t&&i.push(e[n]),i.push(e[n+1]);if(i.at(-1).equals1(e.at(-1))||i.push(e.at(-1)),e.length==i.length)break;e=i}let s=e[e.length-1];return i.push(s),i}var fB=P6(A6());var pB=class{constructor(){this.fac=new vi,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(e){for(this.fac.clear(),this.length=e.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=e[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},_B=new pB,mt=class Gi{constructor(t,i){this.primitives=t,this.__bbox=i}static calcBBox(t){return _B.calcBBox(t)}static build1(t){let i=[],r=null;return __(t,(s,n)=>{let a=n.start();return r!==null&&!a.equals(r)&&i.push(new le(r,a)),i.push(n),r=n.end(),!0}),i.length===0&&r!=null&&i.push(new le(r,r)),new Gi(i)}static build2(t){return Gi.build1(_0(t))}static build3(t){let i=[],r=null;return __(t,(s,n)=>(r!==null&&i.push(new le(r,n)),r=n,!0)),new Gi(i)}static build4(t){return this.build3(_0(t))}static build5(t){let i=[];for(let r=0;r<t.length;r+=2)i.push(new ae(t[r],t[r+1]));return this.build4(i)}static build6(t){return Gi.build4([t.LL(),t.LR(),t.UR(),t.UL(),t.LL()])}static build7(t){return new Gi(t)}static build8(t){let i=new ae(t[0],t[1]),r,s=[],n,a=(o,l)=>o.length==l&&o.every(h=>typeof h=="number");for(let o=2;o<t.length;)switch(typeof t[o]=="string"?n=t[o]:o-=1,n){case"ARC":{let l=t.slice(o+1,o+4);if(!a(l,3))throw new Error("invalid rawData");let h=l[0];r=new ae(l[1],l[2]),s.push(Oe.build5(i,r,h)),i=r,o+=4;break}case"L":{let l=t.slice(o+1,o+3);if(!a(l,2))throw new Error("invalid rawData");r=new ae(l[0],l[1]),s.push(new le(i,r)),i=r,o+=3;break}case"C":{let l=t.slice(o+1,o+7);if(!a(l,7))throw new Error("invalid rawData");let h=new ae(l[0],l[1]),c=new ae(l[2],l[3]);r=new ae(l[4],l[5]),s.push(new ke([i,h,c,r])),i=r,o+=7;break}default:throw new Error("invalid rawData")}return Gi.build2(s)}static buildBBox(t,i=0){return i===1?Gi.build5([t.minX,t.minY,t.maxX,t.minY,t.maxX,t.maxY,t.minX,t.maxY,t.minX,t.minY]):Gi.build5([t.minX,t.minY,t.minX,t.maxY,t.maxX,t.maxY,t.maxX,t.minY,t.minX,t.minY])}static triangulate(t,i,r=1,s=!1){let n=s?(c,f)=>{c.points(r,f)}:(c,f)=>{c.points2(r,f)};if(t.length===1){let c=new Array;n(t[0].asClose(),p=>c.push(p));let f,d=c[0],u=[];for(let p=0;p<c.length-2;p+=2){let _=c[p+1],g=c[p+2],b=_.sub(d).normalize().cross(g.sub(d).normalize());if(me.neq(b,0)){if(f===!0){if(b<0){u.length=0;break}}else if(f===!1){if(b>0){u.length=0;break}}else f=b>0;u.push(d),u.push(_),u.push(g)}c.push(d),d=g}if(u.length!==0){for(let p=0;p<u.length;p+=3)i(u[p],u[p+1],u[p+2]);return}}let a=[],o=[];t.forEach(c=>{a.length!==0&&o.push(a.length/2),n(c.asClose(),f=>a.push(f.x,f.y))});let l=fB.default(a,o),h=[];for(let c=1;c<a.length;c+=2)h.push(new ae(a[c-1],a[c]));for(let c=0;c<l.length;c+=3)i(h[l[c]],h[l[c+1]],h[l[c+2]])}lines(t,i){let r=new Array;this.points(t,n=>r.push(n));let s=r[0];for(let n=1;n<r.length;n++){let a=r[n];i(s),i(a),s=a}}triangles(t,i,r=!1){Gi.triangulate([this],(...s)=>{s.forEach(n=>i(n))},t,r)}mirror(){let t=[];return this.primitives.forEach(i=>{if(i instanceof le)i=new le(i.start().mirror(),i.end().mirror());else if(i instanceof Oe)i=i.mirror();else if(i instanceof ke){let r=i.controls.map(s=>s.mirror());i=new ke(r)}else throw new Error("bug");t.push(i)}),new Gi(t,this.__bbox)}getPoints(t){let i=[];for(let r of this.primitives)for(let s of r.points(t))i.push(s);return i}round(t=4){let i=this.primitives.slice();for(let r=0;r<i.length;r++){let s=i[r];if(s instanceof le){let n=s.start().round(t),a=s.end().round(t);i[r]=new le(n,a)}else if(s instanceof ke){let n=s.controls.map(a=>a.round(t));i[r]=new ke(n)}else if(s instanceof Oe){let n=s.start().round(t),a=s.end().round(t),o=s.sweepAngle;i[r]=Oe.build5(n,a,o)}}return new Gi(i,this.__bbox)}simplify(t=.05){let i=[],r=!1,s=[],n=this.closed();if(this.primitives.length<=1)return Gi.build2(this.primitives);let a=()=>{if(s.length>2){let l=dB(s,t);for(let h=1;h<l.length;h++)i.push(new le(l[h-1],l[h]))}else i.push(new le(s[0],s[1]));s.length=0,r=!1};for(let l=0;l<this.primitives.length;l++){let h=this.primitives[l];h instanceof le?(r?s.push(h.end()):(s.length=0,s.push(h.start(),h.end()),r=!0),l===this.primitives.length-1&&a()):(r&&a(),i.push(h))}let o=new Gi(i,this.__bbox);return n&&!o.closed()&&(o=o.asClose()),o}hasBackLine(){let{primitives:t}=this,i;for(let r=0;r<t.length;r++){let s=t[r];if(s instanceof le){if(s.end().equals1(s.start()))continue;if(i&&(s.end().equals1(i.start())||q6(s.end(),i.start(),i.end())))return!0;i=s}else i=null}return!1}area(t=.1){let i=0,r=this.end();return this.primitives.forEach(s=>{let n=s.start(),a=s.end();if(i+=(n.x+r.x)*(n.y-r.y),s instanceof le)i+=(a.x+n.x)*(a.y-n.y);else if(s instanceof Oe)i+=(a.x+n.x)*(a.y-n.y),i+=Math.PI*s.rx2*s.sweepAngle/180-ae.normal(s.center,s.start(),s.end());else if(s instanceof ke){let o=n;s.points(t).forEach(l=>{i+=(l.x+o.x)*(l.y-o.y),o=l}),i+=(a.x+o.x)*(a.y-o.y)}r=a}),i/2}closed(t){return this.primitives.length===0?!1:this.start().equals(this.end(),t)}asClose(){let t=this.primitives[0],i=this.primitives[this.primitives.length-1],r=t.start(),s=i.end();if(r.equals(s))return this;{let n=new Array;return ss.addAll(n,this.primitives),n.push(new le(s,r)),Gi.build2(n)}}closeEndpoint(){let t=this.primitives[0],i=this.primitives[this.primitives.length-1],r=t.start(),s=i.end();if(r.equals1(s))return this;{let n=new Array;return ss.addAll(n,this.primitives),n.push(new le(s,r)),new Gi(n)}}reverse(){let t=new Array(this.primitives.length);for(let i=0,r=this.primitives.length-1;r>=0;i++,r--){let s=this.primitives[r];if(s instanceof le)s=new le(s.end(),s.start());else if(s instanceof Oe)s=s.exchangeSweep();else if(s instanceof ke)s=new ke(s.controls.slice().reverse());else throw new Error("bug");t[i]=s}return new Gi(t,this.__bbox)}reverse1(){let t=new Array(this.primitives.length);for(let i=0,r=this.primitives.length-1;r>=0;i++,r--){let s=this.primitives[r];if(s instanceof le)s=new le(s.end(),s.start());else if(s instanceof Oe)s=s.exchangeSweep1();else if(s instanceof ke)s=new ke(s.controls.slice().reverse());else throw new Error("bug");t[i]=s}return new Gi(t,this.__bbox)}mirrorY(t){let i=[];return this.primitives.forEach(r=>{if(r instanceof le)r=r.mirrorY(t);else if(r instanceof Oe)r=r.mirrorY(t);else if(r instanceof ke){let s=r.controls.map(n=>n.mirrorY(t));r=new ke(s)}else throw new Error("bug");i.push(r)}),new Gi(i,this.__bbox)}points(t,i){if(this.primitives.length!==0){for(let r=0;r<this.primitives.length-1;r++){let s=this.primitives[r].points(t);s.pop(),s.forEach(n=>i(n))}this.primitives[this.primitives.length-1].points(t).forEach(r=>i(r))}}points1(t,i){if(this.primitives.length===0)return;for(let s=0;s<this.primitives.length-1;s++){let n=this.primitives[s],a=n instanceof Oe?n.points1(t):n.points(t);a.pop(),a.forEach(o=>i(o))}let r=this.primitives[this.primitives.length-1];(r instanceof Oe?r.points1(t):r.points(t)).forEach(s=>i(s))}points2(t,i){if(this.primitives.length===0)return;for(let s=0;s<this.primitives.length-1;s++){let n=this.primitives[s],a=n instanceof Oe?n.points2():n.points(t);a.pop(),a.forEach(o=>i(o))}let r=this.primitives[this.primitives.length-1];(r instanceof Oe?r.points2():r.points(t)).forEach(s=>i(s))}multiply3(t){let i=new Array(this.primitives.length);for(let r=0;r<this.primitives.length;r++)i[r]=this.primitives[r].multiply3(t);return Gi.build7(i)}bbox(){return this.__bbox==null&&(this.__bbox=Gi.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(t){if(this.primitives.length<=1&&!(this.primitives[0]instanceof Oe))return!1;{let i=this.primitives[0],r=this.primitives[this.primitives.length-1];return i.start().equals(r.end(),t)}}isEqual(t){if(t instanceof Gi&&t.primitives.length==this.primitives.length){let i=t.primitives.length;for(let r=0;r<i;r++){let s=t.primitives[r],n=this.primitives[r];if(JSON.stringify(s)!=JSON.stringify(n))return!1}return!0}return!1}equals(t){if(!t)return!1;let i=this.primitives,r=t.primitives;if(i.length!=r.length)return!1;if(t.isClose()){let s=0;for(;s<i.length;){let n=i.slice(s).concat(i.slice(0,s));if(Dn(n,r)||Dn(n.reverse(),r))return!0;s++}return!1}else return Dn(this.primitives,t.primitives)}clone(){return Gi.build2(this.primitives)}putItem(t,i){if(!t)return!1;if(t instanceof Gi)return this.mergePolyline(t,i);let r=this.start();if(!r){this.primitives.push(t),this.__bbox=t.bbox();return}let s=this.end();if(r.equals(s,i))return!1;let n=t.start(),a=t.end(),o=!1,l=!1;if(r.equals(n,i))o=!0,l=!1;else if(r.equals(a,i))o=!1,l=!1;else if(s.equals(n,i))o=!1,l=!0;else if(s.equals(a,i))o=!0,l=!0;else return!1;return l?this.primitives.push(o?t.reverse():t):this.primitives.unshift(o?t.reverse():t),this.__bbox=Ni.extend2(this.__bbox,t.bbox()),!0}mergePolyline(t,i,r=0){if(!t)return!1;let s=this.start();if(!s){this.primitives.push(...t.primitives),this.__bbox=t.bbox();return}let n=this.end();if(s.equals(n,i))return!1;let a=t.start(),o=t.end(),l=!1,h=!1;if(s.equals(a,i))l=!0,h=!1;else if(s.equals(o,i))l=!1,h=!1;else if(n.equals(a,i))l=!1,h=!0;else if(n.equals(o,i))l=!0,h=!0;else return!1;let c=l?t.reverse():t;return h?this.primitives.push(...c.primitives):this.primitives.unshift(...c.primitives),this.__bbox=Ni.extend2(this.__bbox,t.bbox()),!0}deDuplicationPoint(t){let i=this.primitives[this.primitives.length-1].start(),r=this.primitives[this.primitives.length-1].end(),s=t.primitives[0].start(),n=t.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof le&&t.primitives[0]instanceof le&&Q6([i,r],[s,n])){this.primitives.pop(),t.primitives.shift();let a=[];a.push(new le(i,n)),this.primitives.push(...a)}}getMaxBBoxHeightByVec(t){let i=t.normalize(),r=-1/0,s=1/0;if(this.primitives.forEach(a=>{let o=a.start().dot(i),l=a.end().dot(i);if(n(o),n(l),a instanceof Oe){let h=t.angleD(ae.ORIGIN);if(a.angleIsInArc(h)){let c=a.pointOn(h).dot(i);n(c)}if(a.angleIsInArc(h+180)){let c=a.pointOn(h-180).dot(i);n(c)}}}),r-s<=0)throw new Error("getMaxBBoxHeightByVec");return r-s;function n(a){a>r&&(r=a),a<s&&(s=a)}}getWindingNum(t){let i=this.end(),r=0,{x:s,y:n}=t;for(let o of this.primitives){if(i.y>n?o.bbox().minY>n:o.bbox().maxY<=n){i=o.end();continue}if(o instanceof Oe&&(o.isCCW?Math.floor(o.startAngle/90)+1!==Math.ceil(o.endAngle()/90):Math.ceil(o.startAngle/90)-1!==Math.floor(o.endAngle()/90))){let l=o.startAngle,h=o.endAngle();if(o.sweepAngle>0){let c=90;for(;c<=h;)c>l&&(a(Oe.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c+=90;l<h&&a(Oe.build3(o.center,l,h-l,o.rx,o.ry))}else{let c=270;for(;c>=h;)c<l&&(a(Oe.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c-=90;l>h&&a(Oe.build3(o.center,l,h-l,o.rx,o.ry))}}else if(o instanceof ke){let l=[];oT(o,l),l.forEach(h=>a(h))}else a(o)}return r;function a(o){let l=o.start(),h=o.end();if(i.y>n!=l.y>n&&(i.x>s?l.x>s?r+=l.y>i.y?1:-1:i.y>l.y?(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)<0&&r--:(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)>0&&r++:l.x>s&&(i.y>l.y?(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)<0&&r--:(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)>0&&r++)),l.y>n!=h.y>n){if(l.x>s)if(h.x>s)r+=h.y>l.y?1:-1;else if(o instanceof le)l.y>h.y?(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)<0&&r--:(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)>0&&r++;else if(o instanceof Oe){let{center:c,isCCW:f,rx2:d}=o,u=(c.x-s)**2+(c.y-n)**2;l.y>h.y?(f?u>d:u<d)&&r--:(f?u<d:u>d)&&r++}else if(o instanceof ke){if(DE(o,n)===0)throw new Error("no inters");ee[0]>s&&(r+=h.y>l.y?1:-1)}else throw new Error("not support!");else if(h.x>s)if(o instanceof le)l.y>h.y?(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)<0&&r--:(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)>0&&r++;else if(o instanceof Oe){let{center:c,isCCW:f,rx2:d}=o,u=(c.x-s)**2+(c.y-n)**2;l.y>h.y?(f?u>d:u<d)&&r--:(f?u<d:u>d)&&r++}else if(o instanceof ke){if(DE(o,n)===0)throw new Error("no inters");ee[0]>s&&(r+=h.y>l.y?1:-1)}else throw new Error("not support!")}i=h}}},t_=Math.PI*2,TK=Math.PI/2,wK=Math.sin(Math.PI/180),gB=4,Oe=class Wt extends pd{constructor(t,i,r,s,n){super(),this.rx=t,this.ry=i,this.center=r,this.startAngle=s,this.sweepAngle=n,this._start=ae.ORIGIN,this._end=ae.ORIGIN,this._start=this.pointOn(s),this._end=this.pointOn(s+n)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let t=31,i=1;return i=t*i+new ae(this.rx,this.rx).hashCode(),i=t*i+this.center.hashCode(),i=t*i+new ae(this.startAngle,this.sweepAngle).hashCode(),i}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(t,i,r,s){let n=i>=0?-.01:.01,a=t+i;for(;(i>=0&&a>t||i<0&&a<t)&&r.distance2(s)<2e-4;)n*=2,a+=n,s=this.pointOn(a);return s}static build1(t,i,r,s,n,a){Jt.positive(r),Jt.positive(s);let o=t.equals(i);if(o)return new Wt(r,s,t,0,n?360:0);{let l=t.x,h=-t.y,c=i.x,f=-i.y,d=a===0,u=(l-c)/2,p=(h-f)/2,_=Math.cos(0),g=Math.sin(0),b=_*u+g*p,m=-g*u+_*p;r=Math.abs(r),s=Math.abs(s);let O=r*r,y=s*s,x=b*b,E=m*m,w=n===d?-1:1,S=(O*y-O*E-y*x)/(O*E+y*x);S=S<0?0:S;let C=w*Math.sqrt(S),R=C*(r*m/s),B=C*-(s*b/r),Y=(l+c)/2,G=(h+f)/2,z=Y+(_*R-g*B),q=G+(g*R+_*B),L=(b-R)/r,M=(m-B)/s,v=(-b-R)/r,P=(-m-B)/s,I,N;N=Math.sqrt(L*L+M*M),I=L,w=M<0?-1:1;let D=lt.toDegrees(w*Math.acos(I/N));N=Math.sqrt((L*L+M*M)*(v*v+P*P)),I=L*v+M*P,w=L*P-M*v<0?-1:1;let j=I/N,H;j<-1?H=Math.acos(-1):j>1?H=Math.acos(1):H=Math.acos(j);let K=lt.toDegrees(w*H);!d&&K>0?K-=360:d&&K<0&&(K+=360),Jt.normal(D),Jt.normal(K);let se=u*u/O+p*p/y,he=t.distance1(i)/2;r<he&&s<he&&(r*=Math.sqrt(se),s*=Math.sqrt(se));let _e=o?0:lt.regularD(-D),ve=o?n?360:0:-K;return new Wt(r,s,new ae(z,-q),_e,ve)}}static build2(t,i,r,s,n,a){Jt.positive(s),Jt.positive(n),Jt.normal(i),Jt.normal(r);let o;return i===r?(i=lt.regularD(i),r=lt.regularD(r),o=0):(i=lt.regularD(i),r=lt.regularD(r),a===1?r<=i&&(r+=360):r>=i&&(i+=360),o=r-i),new Wt(s,n,t,lt.regularD(i),o)}static build3(t,i,r,s,n){return Jt.positive(s),Jt.positive(n),Jt.normal(r),new Wt(s,n,t,lt.regularD(i),r)}static build4(t,i,r,s,n,a){let o=t.angleD(r),l=i.angleD(r);return Wt.build2(r,o,l,s,n,a)}static build5(t,i,r){r=lt.toRadians(r);let s=i.sub(t),n=new ae(-s.y,s.x).normalize(),a=Math.abs(r)/2,o;if(a!=0)o=s.length()/2/Math.sin(a);else throw new Error("Can't represent circle!!!");let l=n.rotate(ae.ORIGIN,a),h,c;r>0?(h=1,c=i.add(l.scale(o))):(h=0,c=t.sub(l.scale(o)));let f=lt.toDegrees(t.angle(c)),d=lt.toDegrees(i.angle(c));return Wt.build2(c,f,d,o,o,h)}static buildCircle(t,i,r=0){return Wt.build2(t,0,360,i,i,r)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(t){t=lt.regularD(t);let i=this.rx,r=this.ry;if(t===0)return this.center.add1(i,0);if(t===90)return this.center.add1(0,r);if(t===180)return this.center.add1(-i,0);if(t===270)return this.center.add1(0,-r);{let s=this.rx2,n=this.ry2,a=Math.tan(lt.toRadians(t)),o=a*a,l=Math.sqrt(s*n/(s+n/o)),h=Math.sqrt(s*n/(n+s*o));return t>90&&t<270&&(h=-h),t>180&&t<360&&(l=-l),isNaN(h)&&(h=0),isNaN(l)&&(l=0),this.center.add1(h,l)}}exchangeSweep(){return Wt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return Wt.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return Wt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(t){let i=this.start(),r=this.end();return i.equals(r)?Wt.build3(this.center.mirrorY(),0,360,this.rx,this.ry):Wt.build1(i.mirrorY(t),r.mirrorY(t),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(t=ae.ORIGIN){let i=this.start(),r=this.end();return i.equals(r)?Wt.build3(this.center.mirror(t),0,360,this.rx,this.ry):Wt.build1(i.mirror(t),r.mirror(t),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let t=O0.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-t}multiply3(t){let i;t.isMirrored()?i=-this.sweepAngle:i=this.sweepAngle;let r;return t.equals(Ii.ROT_90)?r=lt.regularD(this.startAngle+90):t.equals(Ii.ROT_N90)?r=lt.regularD(this.startAngle-90):r=lt.transformD(this.startAngle,t),Wt.build3(this.center.multiply3(t),r,i,t.iScale*this.rx,t.iScale*this.ry)}angleIsInArc(t){return t=lt.regularD(t),this.sweepAngle>0?(t<this.startAngle&&(t+=360),this.endAngle()>t):(t>this.startAngle&&(t-=360),this.endAngle()<t)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let t=this.start(),i=this.end(),r=lt.toRadians(this.sweepAngle)/2,s=4/3*(1-Math.cos(r))/Math.sin(r)*this.rx;return new ke([t,t.add(new ae(s,0).multiply3(Ii.rotateD(this.startAngle+90))),i.add(new ae(s,0).multiply3(Ii.rotateD(this.endAngle()-90))),i])}toBezier2(){let t=[];r(this,90);let i=[];return t.forEach(s=>i.push(s.toBezier())),i;function r(s,n){if(Math.abs(s.sweepAngle)>n){let a=s.sweepAngle/2;r(Wt.build3(s.center,s.startAngle,a,s.rx,s.ry),n),r(Wt.build3(s.center,s.startAngle+a,a,s.rx,s.ry),n)}else t.push(s)}}buildBBox(){let t=hT.getCache().boxCache,i=this.startAngle+this.sweepAngle;if(t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let r=0;for(;r<i;){if(r>this.startAngle){let s=this.pointOn(r);t[0]=Math.min(t[0],s.x),t[1]=Math.max(t[1],s.x),t[2]=Math.min(t[2],s.y),t[3]=Math.max(t[3],s.y)}r+=90}}else if(this.sweepAngle<0){let r=360;for(;r>i;){if(r<this.startAngle){let s=this.pointOn(r);t[0]=Math.min(t[0],s.x),t[1]=Math.max(t[1],s.x),t[2]=Math.min(t[2],s.y),t[3]=Math.max(t[3],s.y)}r-=90}}return new Ni(t[0],t[1],t[2],t[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return ac.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(t,i,r){let s=t/2,n=this.rx+s,a=this.ry+s,o=this.rx-s,l=this.ry-s,h=new Ii;o<0&&(o=-o,h=h.multiply3(Ii.MIRROR_Y)),l<0&&(l=-l,h=h.multiply3(Ii.MIRROR_X)),o===0&&(o=.001),l===0&&(l=.001),h=h.setOrigin1(this.center);let c,f;switch(r===this.sweep()?(c=Wt.build3(this.center,this.startAngle,this.sweepAngle,n,a),f=Wt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,o,l)):(c=Wt.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,n,a),f=Wt.build3(this.center,this.startAngle,this.sweepAngle,o,l)),f=f.multiply3(h),i){case 1:{let d=r===1?180:-180,u=r===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),p=r===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),_=c.pointOn(c.endAngle()).angleD(u),g=f.pointOn(f.endAngle()).angleD(p);return mt.build2([c,Wt.build3(u,_,d,s,s),f,Wt.build3(p,g,d,s,s)])}default:return mt.build2([c,f])}}points2(){let t=Math.ceil(Math.abs(this.sweepAngle)/gB),i=this.sweepAngle/t,r=[this._start];for(let s=1;s<t;s++)r.push(this.pointOn(this.startAngle+i*s));return r.push(this._end),r}points1(t){let i=Math.max(this.rx,this.ry);if(i<=t)return[this.start(),this.svgEnd];let r=(i-t)/i,s=Math.ceil(Math.abs(this.sweepAngle/lt.toDegrees(Math.acos(r))/2)),n=new Array(s+1),a=this.sweepAngle/s,o=this.startAngle;for(let l=0;l<=s;l++,o+=a)n[l]=this.pointOn(o);return n}points(t){let i=Math.max(this.rx,this.ry);if(t=Math.abs(t),i<=t)return[this.start(),this.svgEnd];t=Math.max(t,i*1e-5),t=Math.min(t,i*(1-Math.SQRT1_2));let r=(i-t)/i,s=Math.ceil(Math.abs(this.sweepAngle/lt.toDegrees(Math.acos(r))/2));s=Math.max(s,2);let n=new Array(s+1),a=this.sweepAngle/s,o=this.startAngle+a;n[0]=this.start();for(let l=1;l<s;l++,o+=a)n[l]=this.pointOn(o);return n[s]=this.end(),n}panDistance(t){return this.sweepAngle>0?new Wt(this.rx-t,this.ry-t,this.center,this.startAngle,this.sweepAngle):new Wt(this.rx+t,this.ry+t,this.center,this.startAngle,this.sweepAngle)}panDistance1(t){if(this.sweepAngle>0){let i=this.rx-t;return i<0?(i=Math.abs(i),Wt.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new Wt(i,i,this.center,this.startAngle,this.sweepAngle)}else{let i=this.rx+t;return i<0?(i=Math.abs(i),Wt.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new Wt(i,i,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let t=Math.abs(j6(this.sweepAngle,3))/180*Math.PI;return Math.tan(t/4)}get midPoint(){let t=lt.toRadians(this.startAngle),i=lt.toRadians(this.endAngle()),r=this.sweep(),s=this.center,n=this.rx;if(r==1)if(i>t){let a=(i-t)/2+t;return s.add(new ae(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==t)return s.add(new ae(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(i+t_-t)/2+t;return s.add(new ae(Math.cos(a),Math.sin(a)).mul(n))}}else if(i>t){let a=(t+t_-i)/2+i;return s.add(new ae(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==t)return s.add(new ae(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(t-i)/2+i;return s.add(new ae(Math.cos(a),Math.sin(a)).mul(n))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(t){let i=lt.regularD(this.startAngle),r=lt.regularD(this.sweepAngle),s=lt.regularD(t.startAngle),n=lt.regularD(t.sweepAngle);return Dn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Dn([r,i],[n,s])||Dn([lt.regularD(i+r)],[s]))}equals1(t){let i=lt.regularD(this.startAngle),r=lt.regularD(this.sweepAngle),s=lt.regularD(t.startAngle),n=lt.regularD(t.sweepAngle);return Dn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Dn([r,i],[n,s])||Dn([lt.regularD(i+r)],[s]))}inArea(t,i){let r=t.x,s=t.y,n=this.center,a=this.rx,o=lt.toRadians(this.startAngle);this.sweep()==0&&(o=lt.toRadians(this.endAngle()));let l=lt.toRadians(this.endAngle());this.sweep()==0&&(l=lt.toRadians(this.startAngle));let h=a-i/2,c=a+i/2;var f=r-n.x,d=s-n.y,u=Math.atan2(d,f);if(u<0&&(u+=t_),o<=l&&u>=o&&u<=l||o>l&&(u>=o&&u<=t_||u>=0&&u<=l)||o==l){var p=Math.sqrt(f*f+d*d);return p<=c&&p>=h}else{var p=(c+h)/2,_=new ae(n.x+Math.cos(o)*p,n.y+Math.sin(o)*p),g=new ae(n.x+Math.cos(l)*p,n.y+Math.sin(l)*p),b=r-_.x,m=s-_.y,O=r-g.x,y=s-g.y;return b*b+m*m<=i*i/4?!0:O*O+y*y<=i*i/4}}isCircle(){return(me.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return Wt.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let t=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+t)%t:(this.startAngle-this.endAngle()+t)%t}isValid(){return this.rx>0&&this.ry>0}panDistance2(t){if(this.sweepAngle>0){let i=this.rx-t;if(i===0)return new le(this.center,this.center);if(i<me.eps){i=Math.abs(i);let r=Wt.build3(this.center,this.startAngle-180,this.sweepAngle,i,i);return r.area()<1e-5?new le(r.start(),r.end()):r}return new Wt(i,i,this.center,this.startAngle,this.sweepAngle)}else{let i=this.rx+t;if(i===0)return new le(this.center,this.center);if(i<me.eps){i=Math.abs(i);let r=Wt.build3(this.center,this.startAngle-180,this.sweepAngle,i,i);return r.area()<1e-5?new le(r.start(),r.end()):r}return new Wt(i,i,this.center,this.startAngle,this.sweepAngle)}}},cT=new ArrayBuffer(24),$m=new Float64Array(cT),Zh=new Int32Array(cT),qa=class Ln{static normal(t,i,r){let s=i.sub(t),n=r.sub(i);return s.cross(n)}static random(){return new Ln(t(),t(),t()).normalize();function t(){return Math.sqrt(-2*Math.log(Math.random()))*Math.cos(2*Math.PI*Math.random())}}constructor(t,i,r){this.x=Jt.normal(t),this.y=Jt.normal(i),this.z=Jt.normal(r),$m[0]=t,$m[1]=i,$m[2]=r,this.hashed=Zh[0]^Zh[1]^Zh[2]^Zh[3]^Zh[4]^Zh[5]}isNormalized(){return me.eq(this.length(),1)}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(t){return t instanceof Ln?t.x===this.x&&t.y===this.y&&t.z===this.z:!1}cross(t){return new Ln(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var t=this.length();return new Ln(this.x/t,this.y/t,this.z/t)}sub(t){return new Ln(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new Ln(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new Ln(this.x*t,this.y*t,this.z*t)}neg(){return new Ln(-this.x,-this.y,-this.z)}multiply4(t){var i=this.x*t.data[0]+this.y*t.data[4]+this.z*t.data[8]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+this.z*t.data[9]+t.data[13],s=this.x*t.data[2]+this.y*t.data[6]+this.z*t.data[10]+t.data[14],n=this.x*t.data[3]+this.y*t.data[7]+this.z*t.data[11]+t.data[15];return n!=0?new Ln(i/n,r/n,s/n):new Ln(i,r,s)}rotate(t,i){return this.multiply4(Yr.rotateAxis(t,i))}toVector2(){return new ae(this.x,this.y)}};qa.ORIGIN=new qa(0,0,0),qa.X_UNIT_VECTOR=new qa(1,0,0),qa.Y_UNIT_VECTOR=new qa(0,1,0),qa.Z_UNIT_VECTOR=new qa(0,0,1);var Qt=qa,uc=class{constructor(){this.clear()}clear(){this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.minZ=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY,this.maxZ=Number.NEGATIVE_INFINITY}ext1(e,t,i,r,s,n){if(e<=r&&t<=s&&i<=n)this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,t),this.minZ=Math.min(this.minZ,i),this.maxX=Math.max(this.maxX,r),this.maxY=Math.max(this.maxY,s),this.maxZ=Math.max(this.maxZ,n);else throw new Error("min > max is not permitted");return this}ext2(e,t,i){return this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,t),this.minZ=Math.min(this.minZ,i),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,t),this.maxZ=Math.max(this.maxZ,i),this}ext3(e){return this.ext2(e.x,e.y,e.z)}ext4(e){return this.ext1(e.minX,e.minY,e.minZ,e.maxX,e.maxY,e.maxZ)}ext5(e,t){return this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,t),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,t),this}ext6(e){return this.minZ=Math.min(this.minZ,e),this.maxZ=Math.max(this.maxZ,e),this}ext7(e){return this.minX=Math.min(this.minX,e.minX),this.minY=Math.min(this.minY,e.minY),this.maxX=Math.max(this.maxX,e.maxX),this.maxY=Math.max(this.maxY,e.maxY),this}isValid(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)}build(){return new _d(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}},_d=class{constructor(e,t,i,r,s,n){if(e<=r&&t<=s&&i<=n)this.minX=Jt.normal(e),this.minY=Jt.normal(t),this.minZ=Jt.normal(i),this.maxX=Jt.normal(r),this.maxY=Jt.normal(s),this.maxZ=Jt.normal(n);else throw new Error("min > max is not permitted")}center(){return new Qt((this.minX+this.maxX)/2,(this.minY+this.maxY)/2,(this.minZ+this.maxZ)/2)}transform(e){let t=new uc;for(let i of this.getVertexes())t.ext3(i.multiply4(e));return t.build()}isContains(e){return!(e.x<this.minX||e.y<this.minY||e.z<this.minZ||e.x>this.maxX||e.y>this.maxY||e.z>this.maxZ)}getVertexes(){return[new Qt(this.minX,this.minY,this.minZ),new Qt(this.minX,this.minY,this.maxZ),new Qt(this.minX,this.maxY,this.minZ),new Qt(this.minX,this.maxY,this.maxZ),new Qt(this.maxX,this.minY,this.minZ),new Qt(this.maxX,this.minY,this.maxZ),new Qt(this.maxX,this.maxY,this.minZ),new Qt(this.maxX,this.maxY,this.maxZ)]}diagonalLength(){let e=this.maxX-this.minX,t=this.maxY-this.minY,i=this.maxZ-this.minZ;return Math.sqrt(e*e+t*t+i*i)}toBBox2(){return new Ni(this.minX,this.maxX,this.minY,this.maxY)}},fi=class tc{static build(t){return t instanceof mt?new tc([new rr([t])]):t instanceof rr?new tc([t]):t}static buildByPolygon(t){return t?new tc([t]):new tc([])}static buildByStroke(t,i,r=1,s){return this.buildByPolygon(rr.buildByStroke(t,i,r,N0,s))}static buildCircle(t,i){return this.buildByPolygon(rr.buildCircle(t,i))}static buildRect(t){return this.buildByPolygon(rr.buildRect(t))}static buildBBox(t){return this.buildByPolygon(rr.buildBBox(t))}constructor(t){this.items=t.slice()}multiply3(t){return new tc(this.items.map(i=>i.multiply3(t)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((t,i)=>t.ext1(i.bbox()),new vi).build1()),this._bbox}toPolylineGroups(){return this.items.map(t=>t.toPolylineGroup())}},Dr=class un{static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,i,r,s=255){return new un(t/255,i/255,r/255,s/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let i=t.length;if(i==3)return new un(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(i==6)return new un(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(i==8)return new un(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let i=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),s=parseInt(t.b*255+"").toString(16);return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),("#"+i+r+s).toUpperCase()}static of5(t,i){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return new un(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,i);if(t.length==6)return new un(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,i);throw new Error("invalid color string")}static of6(t,i){return new un(t.r,t.g,t.b,i)}static of7(t){return t==null?null:un.of3(t)}constructor(t,i,r,s=1){this.r=Jt.positiveOr0(t),this.g=Jt.positiveOr0(i),this.b=Jt.positiveOr0(r),this.alpha=s}hashCode(){return this.r+this.g+this.b+this.alpha}equals(t,i=!1){let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return i?r:r&&this.alpha===t.alpha}add(t,i,r,s){return new un(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+i)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+s)))}mul(t){return new un(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return new un(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16),s=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)+s.substr(0,2)}toRGBA(){let t=this.r*255,i=this.g*255,r=this.b*255;return[t,i,r,this.alpha]}toRGBAString(){let t=this.r*255,i=this.g*255,r=this.b*255;return`rgba(${t},${i},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}};Dr.WHITE=new Dr(1,1,1,1),Dr.BLACK=new Dr(0,0,0,1),Dr.RED=new Dr(1,0,0,1),Dr.GREEN=new Dr(0,1,0,1),Dr.BLUE=new Dr(0,0,1,1),Dr.Gray=Dr.of3("#9966ff"),Dr.Silver=Dr.of3("#D2D2D2"),Dr.Golden=Dr.of3("#DCAA14"),Dr.Pink=Dr.of3("#ffaec9");var Ut=Dr,zE=!1,uT=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,i,r,s,n){}onIntersect(e,t,i){}onSegment(e,t,i,r,s,n){}onSegment1(e,t,i){if(zE){let r=new ae(e.getX(i),i),s=new ae(t.getX(i),i);this.onSegment(r,e.weight,e,s,t.weight,t)}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t)}onSweep1(e,t,i){if(zE){let r=new ae(e.getX(i),i),s=new ae(t.getX(i),i);this.onSweep(r,e.weight,e,s,t.weight,t)}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t)}},hd=class extends uT{constructor(e){super(),this.plGrps=new Array,this.debug=e}onPolylineGroup(e,t){this.plGrps.push(e)}},gd=class{constructor(e){this.cache={},this.levels=e,this.result=new Array(e),this.weights=new Array(e),this.maxIdx=e-1,this.rule=this.decide.bind(this);let t=1;for(let i=0;i<e;i++)this.weights[i]=t,t*=50}weight(e){return this.weights[e]}decide(e){e=Math.abs(e);let t=this.cache[e];if(t===void 0){let i=e;for(let r=this.maxIdx;r>=0;r--){let s=this.weights[r],n=e/s|0,a=e%s;a>(s/2|0)?(e=s-a,n++):e=a,this.result[r]=n>0}t=this.decide1(this.result),this.cache[i]=t}return t}},OB=e=>e!==0;var mB=new class extends gd{decide1(e){return e[0]||e[1]}}(2),u_=new class extends gd{decide1(e){return e[0]&&!e[1]}}(2),d_=new class extends gd{decide1(e){return e[0]&&e[1]}}(2),Qm=new class extends gd{decide1(e){return e[0]&&!e[1]||!e[0]&&e[1]}}(2),cc=class ic{constructor(t,i,r,s,n,a,o){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=t,this.shape=i,this.baseWeight=r,s.y>n.y?this.weight=-r:s.y==n.y?this.weight=0:this.weight=r,this.start=s,this.end=n,this.polyGrp=a,this.polyIndex=o,this._bbox=new vi().ext1(i.bbox()).ext2(s).ext2(n).build1(),this.inters.push(s),this.inters.push(n);let l=31,h=1;h=l*h+this.polyGrp,h=l*h+this.polyIndex,this._hashcode=h}static rebuild(t,i,r){if(t instanceof le||i.distance2(r)<1e-6)return new le(i,r);if(t instanceof Oe){let s=t,n=t.bbox().center().x,a;i.y>r.y?a=n>s.center.x?0:1:a=n>s.center.x?1:0;let o=i.angleD(s.center),l=r.angleD(s.center);return Oe.build2(s.center,o,l,s.rx,s.ry,a)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new vi().ext2(this.start).ext2(this.end).build1()}is(t,i){return t===this.polyGrp&&i===this.polyIndex}confidence(t){if(this._confidence_y!=t){let i=this._bbox.height();if(i!==0)if(Math.abs(t-this._bbox.maxY)>5e-4&&Math.abs(t-this._bbox.minY)>5e-4){let r=1-Math.abs(2*t-this._bbox.maxY-this._bbox.minY)/i;this._confidence=r*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=t}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(t){let i=this.confidence(t);return this.outsideWeight-=i,this.invalidWeight+=i,i}revokeInside(t){let i=this.confidence(t);return this.insideWeight-=i,this.invalidWeight+=i,i}setOutside(t){let i=this.confidence(t);return this.outsideWeight+=i,i}setInside(t){let i=this.confidence(t);return this.insideWeight+=i,i}setInvalid(t){let i=this.confidence(t);return this.invalidWeight+=i,i}prevNot0(){let t=this.previous;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.previous}return null}nextNot0(){let t=this.next;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.next}return null}getX(t){if(this.bo!==null)return(this._x_y!=t||isNaN(this._x))&&(SB(this,t)>0?this._x=ee[0]:this._x=NaN,this._x_y=t),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(t){if(t===2)if(this.start.y>this.end.y){let i=ic.rebuild(this.shape,this.end,this.start),r=new ic(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return ss.addAll(r.connect,this.connect),r}else return this;else if(t===1)if(this.start.y<this.end.y){let i=ic.rebuild(this.shape,this.end,this.start),r=new ic(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return ss.addAll(r.connect,this.connect),r}else return this;return this}isNeedScan(t){return this.needCountWeight()&&this.confidence(t)>0}hashCode(){return this._hashcode}equals(t){return t instanceof ic?!(this.polyGrp!==t.polyGrp||this.polyIndex!==t.polyIndex):!1}bbox(){return this._bbox}toString(){return ac.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function yB(e,t){let i=e.bbox(),r=t.bbox(),s=(i.minY+i.maxY)/2,n=(r.minY+r.maxY)/2;return s-n}function bB(e,t){let i=e.bbox(),r=t.bbox(),s=(i.minX+i.maxX)/2,n=(r.minX+r.maxX)/2;return s-n}var Kh=class{constructor(e){if(this.__bbox=null,typeof e<"u")if(e instanceof Array){this.__items=[];for(let t of e)this.add(t)}else this.__items=e,this.__bbox=e.bbox();else this.__items=[]}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=Ni.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},dd=class{constructor(e){this.changed=!1,this.root=new Kh,this.capacity=e,this.capacity2=e*e,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(e){this.itemList.push(e),this.changed=!0}remove(e){ss.remove(this.itemList,e),this.changed=!0}clear(){this.changed=!1,this.root=new Kh,this.itemList.length=0}flushWhenNeed(){if(this.changed){let e=new Array;for(let t of this.itemList)e.push(new Kh(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break}this.root=new Kh(e),this.changed=!1}}organize(e){Yl(e,bB,0,e.length);let t=e.length,i=[];for(let r=0;r<t;)if(r+this.capacity2<=t){let s=r+this.capacity2;Yl(e,yB,r,s);for(let n=r;n<s;n+=this.capacity){let a=new Kh(e.slice(n,n+this.capacity));i.push(a)}r=r+this.capacity*this.capacity}else{let s=new Kh(e.slice(r,r+this.capacity));i.push(s),r=r+this.capacity}return i}search(e){this.flushWhenNeed();let t=[],i=[];for(i.push(this.root);;){let r=i.shift();if(typeof r<"u"){let s=r.items();if(s instanceof Array){for(let n of s)if(!e.isSeparated(n.bbox())){let a=n.items();a instanceof Array?i.push(n):t.push(a)}}else e.isSeparated(r.bbox())||t.push(s)}else break}return t}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e)}_walker(e,t,i){this.flushWhenNeed();let r=e.items();if(r instanceof Array)for(let s of r)this._walker(s,t+1,i);else i(r,t)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};function e0(e,t){xB(e.iterator(),t)}function xB(e,t){let i=0;for(;e.hasNext();){let r=e.next();t(i++,r)}}var i_=new Error("list is empty"),r_=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},vB=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},EB=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},Hl=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw i_;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw i_;return this.remove(e),e.item}addLast(e){return this.first===null||this.last===null?(this.first=new r_(this,e),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new r_(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw i_;return this.first.item}getLast(){if(this.last===null)throw i_;return this.last.item}insertAfter(e,t){let i=new r_(this,t);return e.insertAfter(i),e===this.last&&(this.last=i),this.cnt++,i}insertBefore(e,t){let i=new r_(this,t);return e.insertBefore(i),e===this.first&&(this.first=i),this.cnt++,i}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new vB(this.first)}listIterator(){return new EB(this.first)}toArray(){let e=new Array(this.cnt),t=this.first,i=0;for(;t!=null;)e[i]=t.item,t=t.next,i++;return e}};function t0(e){throw new Error("")}var s_=class{constructor(e,t){this.node1=null,this.node2=null,this.key=e,this.value=t}},TB=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},wB=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},x_=class{constructor(){this.innerList=new Hl,this.innerMap={}}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2)}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e]}put(e,t){let i=e.hashCode(),r=new s_(e,t),s=this.innerMap[i];if(s===void 0)return r.node1=this.innerList.add(r),this.innerMap[i]=r,null;if(s instanceof s_){if(s.key.equals(e))return this.innerMap[i]=r,this.replace(s,r),s.value;{r.node1=this.innerList.add(r);let n=new Hl;return s.node2=n.add(s),r.node2=n.add(r),this.innerMap[i]=n,null}}if(s instanceof Hl){let n=null;return e0(s,(a,o)=>o.key.equals(e)?(this.replace(o,r),n=o.value,!1):!0),n===null?(r.node1=this.innerList.add(r),r.node2=s.push(r),null):n}return t0(s)}get(e){let t=e.hashCode(),i=this.innerMap[t];if(i===void 0)return null;if(i instanceof s_)return i.key.equals(e)?i.value:null;if(i instanceof Hl){let r=null;return e0(i,(s,n)=>n.key.equals(e)?(r=n.value,!1):!0),r}return t0(i)}containsKey(e){return this.get(e)!==null}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2)}remove(e){let t=e.hashCode(),i=this.innerMap[t];if(i===void 0)return null;if(i instanceof s_)return i.key.equals(e)?(this.delete(i),i.value):null;if(i instanceof Hl){let r=null;return e0(i,(s,n)=>n.key.equals(e)?(r=n.value,this.delete(n),!1):!0),r}return t0(i)}computeIfAbsent(e,t){let i=this.get(e);if(i===null){let r=t(e);return this.put(e,r),r}else return i}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new TB(this.innerList.iterator())}values(){return new wB(this.innerList.iterator())}entries(){return this.innerList.iterator()}},hc=class{constructor(){this.innerMap=new x_}add(e){return this.innerMap.put(e,!0)!==!0}remove(e){this.innerMap.remove(e)}contains(e){return this.innerMap.get(e)===!0}iterator(){return this.innerMap.keys()}addAll(e){let t=e.iterator();for(;t.hasNext();)this.add(t.next())}size(){return this.innerMap.size()}clear(){let e=this.iterator();for(;e.hasNext();){let t=e.next();this.remove(t)}}},HE=ss.funcCopy(Yl);function SB(e,t){let i=0;if(Math.abs(e.start.y-t)<=1e-4)ee[i++]=e.start.x;else if(Math.abs(e.end.y-t)<=1e-4)ee[i++]=e.end.x;else if(e.shape instanceof le)i=X6(e.shape,t);else if(e.shape instanceof Oe)i=W6(e.shape,t);else throw new Error("not supported operation");return i}var f_=class{constructor(e,t,i,r){this.sides=new Array,this.loader=e,this.loader.bo=this,this.logger=i,this.rule=t,this.event=r}static sortByBBoxMinY(e,t){return e.bbox().minY-t.bbox().minY}static sortByBBoxAreaDesc(e,t){return t.bbox().area()-e.bbox().area()}addPolyline(e,t=1,i=.01,r=!0){for(let s of this.loader.buildGroup(e,t,i,r))this.sides.push(s),this.event.onOriginSide(s)}buildRTree(){let e=new dd(10);for(let t of this.sides)e.add(t);return e}fillValidSides(e,t,i){for(let r of t)isFinite(r.getX(i))&&e.push(r)}getSortedEndpointsLineAsc(e){let t=new Array;for(let s of e)s.needCountWeight()&&(t.push(s.start),t.push(s.end));HE(t,ae.sortByYAsc,0,t.length);let i=new Array,r=Number.NEGATIVE_INFINITY;for(let s of t){let n=s.y;n>r&&(i.push(n),r=n)}return i}splitSides(e,t,i){let r=e.start,s=e.end,n=new ae(s.x+(r.x-s.x)*2,s.y+(r.y-s.y)*2);HE(e.inters,(o,l)=>o.distance2(n)-l.distance2(n),0,e.inters.length);let a=null;for(let o of e.inters)if(a==null)o.equals(r)&&(a=o);else if(!o.equals(a)){let l=cc.rebuild(e.shape,a,o);l instanceof Oe&&Math.abs(l.sweepAngle)>190&&(l=new le(a,o));let h=new cc(this,l,e.baseWeight,a,o,e.polyGrp,i++);if(t.push(h),h.updateBbox(),o.equals(s))break;a=o}return i}splitSidesByInters(){let e=new Array;for(let t of this.sides)if(t.polyIndex==0){let i=0,r=null,s=null;do{let n=new Array;i=this.splitSides(t,n,i);for(let a of n)r!=null?(r.next=a,a.previous=r):s=a,r=a,this.event.onSplitedSide(a),e.push(a);if(t.next===null)throw new Error("not supported operation");t=t.next}while(t.polyIndex!==0);s!=null&&r!=null&&(s.previous=r,r.next=s)}this.sides.length=0;for(let t of e)this.sides.push(t)}seekIntersection(){if(this.sides.length>0){let e=this.buildRTree(),t=new hc;for(let i of this.sides){t.add(i);let r=i.bbox().extendOfSize(1e-5),s=i.shape instanceof le;for(let n of e.search(r))if(!t.contains(n)){let a=n.shape instanceof le;if(!(s&&a&&i.next!==null&&i.previous!==null&&(i.next.equals(n)||i.previous.equals(n)))){let o=dn(i.shape,n.shape);for(let l=0;l<o;l+=2){let h=new ae(ee[l],ee[l+1]);i.inters.push(h),n.inters.push(h),this.event.onIntersect(h,i,n)}}}}}}},IB=class dT{constructor(t){this.sides=new hc,this.others=new hc,this.id=t}add(t){this.sides.add(t),t.finalGrp=this.id;for(let i of t.connect)this.others.add(i)}polyline(){let t=new Array;return lc(this.sides,(i,r)=>(t.push(r.shape),!0)),mt.build2(t).asClose()}hashCode(){return this.id}equals(t){return t!=null&&t instanceof dT?this.id===t.id:!1}},fT=class{constructor(e){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=e}completeGroup(e){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new le(this.prevSide.end,this.firstSide.start),e);let t=new Array,i=null,r=null;for(let s of this.sides)(!this.noWeight0||s.weight!==0)&&(i!=null?(i.next=s,s.previous=i):r=s,i=s,t.push(s));return i!=null&&r!=null&&(r.previous=i,i.next=r),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,t}buildGroup(e,t,i,r=!0){for(let s of e.primitives)if(s instanceof le)this.addSide(s,t);else if(r&&s instanceof Oe&&s.rx===s.ry)this.addArc(s,t);else{let n=null;for(let a of s.points(i))n!=null&&this.addSide(new le(n,a),t),n=a}return this.completeGroup(t)}addArc(e,t){let i=e.sweepAngle,r=lt.regularD(e.startAngle),s=r+i;if(i>0){let n=90;for(;n<=s;)n>r&&(this.addSide(Oe.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n+=90;r<s&&this.addSide(Oe.build3(e.center,r,s-r,e.rx,e.ry),t)}else if(i<0){let n=270;for(;n>=s;)n<r&&(this.addSide(Oe.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n-=90;r>s&&this.addSide(Oe.build3(e.center,r,s-r,e.rx,e.ry),t)}}addSide(e,t){if(e.start().equals(e.end()))return;let i=e.start(),r;this.prevSide!=null?(this.prevSide.end.equals(i)||this.addSide(new le(this.prevSide.end,i),t),r=new cc(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++)):(r=new cc(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++),this.firstSide=r),this.prevSide=r,this.sides.push(r)}},pT=class{constructor(e,t,i){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=i,this.rule=e,this.bo=t,this.event=t.event}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e,this.start),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y))}out(e,t){if(this.onSameX(t,e))t.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&t.confidence(this.y)>0){let i=t.voteStatus(),r=e.voteStatus();this.isValid(i)&&this.isValid(r)?i==2&&r==1&&(e.connect.push(t),t.connect.push(e)):(e.connect.push(t),t.connect.push(e))}this.event.onSegment1(t,e,this.y),this.eps.push(t),this.eps.push(e),this.prevStart=t,this.prevEnd=e}this.start=null}isValid(e){return e==1||e==2}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&me.eq(e.getX(this.y),t.getX(this.y))}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),i=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),i!=null&&e.weight===i.weight&&i.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y}},v_=new Error,jE=new class extends gd{decide1(e){return e[0]&&e[1]}}(2),PB=new class extends uT{onPolylineGroup(e,t){throw v_}onSegment(e,t,i,r,s,n){throw v_}},AB=class{constructor(e,t){this.rtree=e,this.level=t}},CB=class _T extends f_{static isIntersect(t,i,r=I_.DUMMY){let s=new _T(r),n=s.createGroup1(t.items),a=s.createGroup2(i.items);return n.rtree.itemList.length==0||a.rtree.itemList.length==0?!1:s.isIntersect(n,a)}constructor(t){super(new fT(!1),jE.rule,t,PB)}createGroup1(t){return this.createGroup(t,0)}createGroup2(t){return this.createGroup(t,1)}createGroup(t,i){let r=jE.weight(i);for(let n of t)this.addPolyline(n,r);let s=this.buildRTree();return this.sides.length=0,new AB(s,i)}isIntersect(t,i){if(t.level!==i.level){let r=t.rtree.bbox().intersection1(i.rtree.bbox());if(r!==null){try{this.inters(t,i);let s=(r.minY+r.maxY)/2;this.sweep(t,i,s)}catch(s){if(s===v_)return!0;throw s}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(t,i){if(t.rtree.size()>i.rtree.size()){let r=t;t=i,i=r}for(let r of t.rtree.items()){r.trans=NaN;let s=r.bbox().extendOfSize(1e-5);for(let n of i.rtree.search(s))if(n.trans=NaN,dn(r.shape,n.shape)>0)throw v_}}sweep(t,i,r){let s=Ni.extend2(t.rtree.bbox(),i.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,t.rtree.search(s),r),this.fillValidSides(n,i.rtree.search(s),r),Yl(n,(o,l)=>o.getX(r)-l.getX(r),0,n.length);let a=new pT(this.rule,this,r);for(let o of n)a.onEp(o)}},L0=class Xa{constructor(t){this.items=new Array(t.length),ss.arraycopy(t,0,this.items,0,t.length),this.__bbox=this.calcBBox()}static build1(t){let i=[];return __(t,(r,s)=>(i.push(s),!0)),new Xa(i)}static build2(t){let i=t.map(r=>mt.build8(r));return new Xa(i)}static combinePolylineGroupArr(t){let i=[];for(let r of t)i=i.concat(r.items);return new Xa(i)}calcBBox(){let t=new vi;for(let i=0;i<this.items.length;i++)t.ext1(this.items[i].bbox());return t.build1()}multiply3(t){let i=new Array(this.items.length);for(let r=0;r<i.length;r++)i[r]=this.items[r].multiply3(t);return new Xa(i)}bbox(){return this.__bbox}asClose(){return this.items.forEach(t=>t.asClose()),this}mirrorY(t){return this.items.forEach(i=>i.mirrorY(t)),this}closeEndpoint(){return this.items.forEach(t=>t.closeEndpoint()),this}get primitives(){return this.items.map(t=>t.primitives).flat(2)}isEqual(t){return t instanceof Xa?this.items.every(i=>t.items.some(r=>r.isEqual(i))):!1}getOutMostPolyline(){return this.items.reduce((t,i)=>i.bbox().area()>t.bbox().area()?i:t,this.items[0])}getOutline(){let t=this.items;if(t.length===1)return{outline:t,hole:new Array};let i=new Set,r=new Set;for(let s=0,n=t.length;s<n;s++){let a=t[s];if(!i.has(a)&&!r.has(a)){s+1>=n&&i.add(a);for(let o=s+1;o<n;o++){let l=t[o];if(!i.has(l)&&!r.has(l)){if(!a.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(a.bbox().extendOfSize(1e-4)))continue;CB.isIntersect(new Xa([a]),new Xa([l]))&&(a.bbox().area()>l.bbox().area()?(i.add(a),r.add(l)):(i.add(l),r.add(a)))}}!i.has(a)&&!r.has(a)&&i.add(a)}}return{outline:[...i],hole:[...r]}}round(t=4){let i=this.items.map(r=>r.round(t));return new Xa(i)}},NB=ss.funcCopy(Yl),LB=ss.funcCopy(Yl),RB=ss.funcCopy(Yl);function DB(e){return new Array}function MB(e,t){let i=new hd(!1),r=new cd(e,I_.DUMMY,i);for(let s of t)r.addPolyline(s);return r.simplify(),i.plGrps}var cd=class extends f_{constructor(e,t,i){super(new fT(!1),e,t,i),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(e,t,i){this.scanY=NaN,this.scanLines=0,NB(t,f_.sortByBBoxMinY,0,t.length);let r=new Hl;this.curNetIndex=0;let s=Number.POSITIVE_INFINITY;for(let n of e)n>s&&this.scan(r,(s+n)/2,t),s=n;this.getAllMarkPrimitive(i,t),this.logger.debug3("scan %s %d",i,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(e,t=1,i=.01,r=!0){super.addPolyline(e,t,i,r)}scan(e,t,i){if(this.scanY==t)return;this.scanY=t;let r=!1,s=e.listIterator();for(;s.hasNext();){let n=s.next(),a=n.item;me.less(a.bbox().maxY,t)?e.remove(n):!r&&a.isNeedScan(t)&&(r=!0)}for(;this.curNetIndex<i.length;){let n=i[this.curNetIndex];if(me.less(n.bbox().minY,t))me.greatereq(n.bbox().maxY,t)&&(this.add2AET(e,n),!r&&n.isNeedScan(t)&&(r=!0)),this.curNetIndex++;else break}if(r){this.scanLines++;let n=new pT(this.rule,this,t),a=e.iterator();for(;a.hasNext();){let o=a.next();n.onEp(o)}}}add2AET(e,t){let i=t.bbox().minX,r=t.bbox().maxX,s=t.bbox().minY,n=t.bbox().maxY,a=e.listIterator(),o=null;for(;a.hasNext();){let l,h=a.next(),c=h.item,f=c.bbox().minX,d=c.bbox().maxX;if(r<=f)l=-1;else if(d<=i)l=1;else{let p=c.bbox().minY,_=c.bbox().maxY,g=Math.max(s,p),b=Math.min(n,_);l=this.compareBySweep(t,c,(g+b)/2)}let u=c.shape;if(u instanceof le&&u.length()<.001&&o==null&&l<0){o=h;continue}if(o!=null&&l<0){e.insertBefore(o,t);return}if(l<0){e.insertBefore(h,t);return}else o=null}e.add(t)}getLineAngle(e){let t=e.start().angle(e.end());return t<0&&(t+=Math.PI),t}getArcAngle(e,t){let i=Math.asin((t-e.center.y)/e.rx);return e.startAngle>90&&e.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI}compareArcLine(e,t,i){let r=this.getArcAngle(e,i),s=this.getLineAngle(t);return me.eq(r,s)?-e.sweepAngle:s-r}compareBySweep(e,t,i){let r=e.getX(i);if(!isFinite(r))return 0;let s=t.getX(i);if(!isFinite(s))return 0;if(!me.eq(r,s))return r-s;if(e.shape instanceof le)return t.shape instanceof le?this.getLineAngle(t.shape)-this.getLineAngle(e.shape):-this.compareArcLine(t.shape,e.shape,i);if(t.shape instanceof le)return this.compareArcLine(e.shape,t.shape,i);{let n=e.shape,a=t.shape,o=this.getArcAngle(n,i),l=this.getArcAngle(a,i);return me.eq(o,l)?n.sweepAngle*a.sweepAngle<=0?n.sweepAngle<=0?1:-1:n.sweepAngle>0?n.rx-a.rx:a.rx-n.rx:l-o}}getAllMarkPrimitive(e,t){for(let i of t)if(i.status===0&&i.bbox().height()!=0){let r=i.voteStatus();if(r===2||r===1){i.status=r;let s=i.reverse(r);if(e){this.event.onResultSide(s);let n=s.shape.multiply3(Ii.ROT_N90),a=s.start.multiply3(Ii.ROT_N90),o=s.end.multiply3(Ii.ROT_N90);s=new cc(this,n,s.baseWeight,a,o,s.polyGrp,s.polyIndex)}this.finalSides.push(s),this.event.onResultSide(s)}}}flipSides(){for(let e of this.sides)if(e.polyIndex==0){let t=null,i=null;do{let r=e.shape.multiply3(Ii.ROT_90),s=e.start.multiply3(Ii.ROT_90),n=e.end.multiply3(Ii.ROT_90),a=new cc(this,r,e.baseWeight,s,n,e.polyGrp,e.polyIndex);if(a.outsideWeight=e.outsideWeight,a.insideWeight=e.insideWeight,a.invalidWeight=e.invalidWeight,a.status=e.status,t!=null?(t.next=a,a.previous=t):i=a,this.vecSides.push(a),this.event.onSplitedSide(a),t=a,e.next!==null)e=e.next;else break}while(e.polyIndex!=0);i!=null&&(i.previous=t,t.next=i)}}canBeEnd(e,t){if(e.size()==1){let i=e.getFirst().shape;if(i instanceof Oe){if(t&&i.rx<=t)return!1}else if(i instanceof le&&t&&i.length()<=t)return!1}return!0}connectSides(){let e=new x_,t=new dd(10);for(let n of this.finalSides)e.computeIfAbsent(n.start,DB).push(n),t.add(n.start);let i=0,r=new hc,s=new Array;for(let n of this.finalSides)if(!r.contains(n)){let a=new hc,o=n.start,l=new Hl;l.add(n),r.add(n);let h=n.end;for(;l.size()>0;)if(this.isStart(o,h)&&this.canBeEnd(l,.01)){l.size()>1&&this.fillSideGroups(l,i++);break}else{let c=e.get(h),f=this.findNext(r,c);if(f==null&&(h=this.findNeigber(h,a,t,.01),h!==null&&(c=e.get(h),f=this.findNext(r,c))),f!=null)l.add(f),r.add(f),h=f.end;else if(h!=null?a.add(h):(s.length==0&&l.size()>1&&this.logger.warning3("unable to connect at %s",l.getLast()),s.push(l.removeLast())),l.size()>0)h=l.getLast().end;else break}}}fillSideGroups(e,t){let i=new IB(t);lc(e,(r,s)=>(i.add(s),!0)),this.sideGroups[i.id]=i}isStart(e,t){return e.distance2(t)<=1e-4}findNext(e,t){if(t!=null){for(let i of t)if(!e.contains(i))return i}return null}fillResult(){let e=0,t=new x_;for(let r in this.sideGroups){let s=this.sideGroups[r];lc(s.sides,(n,a)=>(a.polyGrp!=-2&&t.put(a,a),!0))}let i=new hc;for(let r in this.sideGroups){let s=this.sideGroups[r];if(i.add(s)){let n=0,a=new Array;for(a.push(s);n<a.length;){let l=a[n],h=new Array;lc(l.others,(f,d)=>{let u=t.get(d);return u!=null&&h.push(u.finalGrp),!0}),LB(h,ss.sortAsc,0,h.length);let c=l.id;for(let f of h)if(f!=c&&f!=l.id){let d=this.sideGroups[f];i.add(d)&&a.push(d),c=f}n++}let o=new Array;for(let l of a)o.push(l.polyline());RB(o,f_.sortByBBoxAreaDesc,0,o.length),this.event.onPolylineGroup(new L0(o),e++)}}}findNeigber(e,t,i,r){let s=r*r,n=Number.MAX_VALUE,a=null;for(let o of i.search(e.bbox().extendOfSize(r)))if(!t.contains(o)){let l=e.distance2(o);l<n&&(n=l,a=o)}return n<s?a:null}},BB=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(e,t=!0){if(e instanceof le)this.lines.push(e);else if(e instanceof Oe)this.arcs.push(e);else if(e instanceof ke)this.beziers.push(e);else throw new Error("not support");t&&this.points.push(e.start())}addPoint(e){this.points.push(e)}addText(e,t,i=1,r=.1,s=!0){this.listText.push({pos:e,str:t,size:i,width:r}),s&&this.points.push(e)}addPly(e,t=!0){e.primitives.forEach(i=>this.addPt(i,t))}build(){let e=[],t=[],i=[],r=[],s=[],n=[];return this.points.forEach(a=>e.push(a.x,a.y)),this.lines.forEach(a=>t.push(a.start().x,a.start().y,a.end().x,a.end().y)),this.arcs.forEach(a=>i.push(a.center.x,a.center.y,a.rx,lt.toRadians(a.startAngle),lt.toRadians(a.endAngle()),a.sweep())),this.beziers.forEach(a=>{a.controls.forEach(o=>{r.push(o.x,o.y)}),r.push("end")}),this.listText.forEach(a=>s.push(a.pos.x,a.pos.y,a.str,a.width,a.size)),this.fonts.forEach(a=>n.push(a)),{points:e,lines:t,arcs:i,texts:s,beziers:r,fonts:n}}},b0=class gT{constructor(t){this.map=new x_,this.bus=t}initColor(t){return this.map.computeIfAbsent(t,()=>new BB)}draw(){let t={},i=this.map.entries();for(;i.hasNext();){let r=i.next();t[r.key.toString()]=r.value.build()}this.bus.publish("/debug/draw",t)}clear(){this.map.clear()}static init(t){if(!t)throw new Error("bus is undefined!");this.palette=new gT(t)}static initPalette(t){this.palette=t}static getDefaultColor(){for(let t of this.colorBuffersMap)if(t[0]!==null&&t[0])return t[0]=!1,t[1];return this.colorBuffersMap.forEach(t=>{if(t[0]===null){console.log(1);return}t[0]=!0}),this.getDefaultColor()}static clear(){this.palette.clear()}static auto(t,i=this.getDefaultColor()){if(Array.isArray(t))t.forEach(r=>{this.auto(r,i)});else if(t instanceof ae)this.point(t,i);else if(t instanceof Ni)this.bbox(t,i);else if(t instanceof pd)this.primitive(t,i);else if(t instanceof mt)this.polyline(t,i);else if(t instanceof rr)this.polygon(t,i);else if(t instanceof fi)this.group(t,i);else if(t instanceof L0)this.auto(t.items,i);else{debugger;throw new Error("No incoming type!")}}static text(t,i,r=.5,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");this.palette.initColor(s).addText(t,i,r,r/10),this.palette.draw()}static point(t,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(i);Array.isArray(t)?t.forEach(s=>{this.point(s,i)}):r.addPoint(t),this.palette.draw()}static bbox(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.bbox(r,i)}):(this.primitive(new le(new ae(t.maxX,t.maxY),new ae(t.maxX,t.minY)),i),this.primitive(new le(new ae(t.maxX,t.maxY),new ae(t.minX,t.maxY)),i),this.primitive(new le(new ae(t.minX,t.minY),new ae(t.maxX,t.minY)),i),this.primitive(new le(new ae(t.minX,t.minY),new ae(t.minX,t.maxY)),i))}static primitive(t,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(i);Array.isArray(t)?t.forEach(s=>{this.primitive(s,i)}):r.addPt(t),this.palette.draw()}static polyline(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polyline(r,i)}):t.primitives.forEach(r=>{this.primitive(r,i)})}static polygon(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polygon(r,i)}):t.items.forEach(r=>{this.polyline(r,i)})}static group(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.group(r,i)}):t.items.forEach(r=>{this.polygon(r,i)})}static async begin(){this.t1=performance.now()}static async end(t){console.log(t||"t1:",performance.now()-this.t1)}static async log(t){console.log(t||"==================")}};b0.colorBuffersMap=[[!0,Ut.BLUE],[!0,Ut.GREEN],[!0,Ut.WHITE],[!0,Ut.RED],[!0,Ut.Golden],[!0,Ut.Gray]],b0.t1=0;var Od=b0,kB=0,md=class x0{constructor(t,i){this.inters=[],this.shape=t,this.start=t.start(),this.end=t.end(),this.judgeOverlapMap=new Map,i&&(this.id=kB++)}reverse(){this.shape=this.shape.reverse();let t=this.start;this.start=this.end,this.end=t}getCenterPoint(t=this.end){let{x:i,y:r}=this.start,{x:s,y:n}=t;if(this.shape instanceof Oe){let a=this.shape.rx,o=new ae((i+s)/2,(r+n)/2),l=this.shape.center,h;return o.x!==l.x||o.y!==l.y?(h=o.angle(l),Math.abs(this.shape.sweepAngle)>180&&(h+=h>=0?-180:180)):h=(this.shape.startAngle+this.shape.endAngle())/2,new ae(l.x+Math.cos(h)*a,l.y+Math.sin(h)*a)}else{if(this.shape instanceof le)return new ae((i+s)/2,(r+n)/2);if(this.shape instanceof ke){let a=this.shape.getPercent(t,it);return ke.pointOn(a/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(t,i,r){let s=t.cross(i)>0,n=Math.acos(Math.min(1,Math.max(-1,t.dot(i)/i.length())));return(r?!s:s)&&(n=P_-n),n}sortInters(){if(this.shape instanceof Oe){let t=this.shape.center,i=this.shape.start().sub(t).normalize(),r=this.shape.isCCW;this.inters.sort((s,n)=>{let a=s.coord.sub(t),o=n.coord.sub(t);return x0.finalAngle(i,a,r)-x0.finalAngle(i,o,r)<=0?-1:1})}else if(this.shape instanceof le){let t=this.start,i=this.end,r=new ae(i.x+(t.x-i.x)*2,i.y+(t.y-i.y)*2);this.inters.sort((s,n)=>s.coord.distance2(r)-n.coord.distance2(r)<=0?-1:1)}else if(this.shape instanceof ke){let t=this.shape;this.inters.sort((i,r)=>t.getPercent(i.coord,it)-t.getPercent(r.coord,it)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((t,i)=>t.setIndex(i))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(t){this.nextSide=t,t.prevSide=this}static returnPolygonList(t){let i=[];return t.forEach(r=>{let s=[];r.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),s.push(mt.build7(o))}),i.push(new rr(s))}),i}addInter(t){this.inters.push(t)}static returnPolygonGroup(t){let i=[];return t.forEach(r=>{let s=[];r.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),s.push(mt.build7(o))}),i.push(new rr(s))}),new fi(i)}static rebuild(t,i,r){let s;if(t instanceof le||i.distance2(r)<1e-6)s=new le(i,r);else if(t instanceof Oe)s=Oe.build2(t.center,i.angleD(t.center),r.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);else if(t instanceof ke){let n=t.getPercent(i,it),a=t.clip(n)[1];s=a.clip(a.getPercent(r,it))[0]}else throw new Error("not supported operation");return tt(t,i).dot(tt(s,i))<0?null:s}static returnPolyline(t){return mt.build7(t.map(i=>i.shape))}bbox(){return this.shape.bbox()}};function ns(e,t,i){if(e instanceof Oe&&t instanceof Oe)return GB(e,t);if(e instanceof Oe&&t instanceof le)return qE(e,t);if(e instanceof le&&t instanceof Oe)return VE(e,t);if(e instanceof le&&t instanceof le)return jl(e,t);if(e instanceof ke&&t instanceof le)return e.controls.length===2||$a(e)?jl(new le(e.start(),e.end()),t):OT(e,t);if(e instanceof le&&t instanceof ke)return t.controls.length===2||$a(t)?jl(e,new le(t.start(),t.end())):v0(e,t);if(e instanceof Oe&&t instanceof ke)return t.controls.length===2||$a(t)?qE(e,new le(t.start(),t.end())):UB(e,t);if(e instanceof ke&&t instanceof Oe)return e.controls.length===2||$a(e)?VE(new le(e.start(),e.end()),t):FB(e,t);if(e instanceof ke&&t instanceof ke)return R0(e,t);throw new Error("not support")}function $h(e,t){return tt(e,t.start()).dot(tt(t,t.start()))<=0?!1:ns(e,t).state<=2}function i0(e,t){let i=t.getPercent(e.end(),it);if(i===null)return!1;if(i===0)return!0;let r=t.clip(i)[0],s=e.buildConverxHull(it),n=r.buildConverxHull(it),a=h(s),o=h(n);return l(a,o);function l(c,f){let d=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),u=c[0],p=f[0];if(!u||!p)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let _=!0;do{let g=u.getShape(),b=p.getShape();if(g instanceof le&&b instanceof le){let m=_?jl(g,b).state:d.get(jl(b,g).state);if(m===0)u=u.nextSide,_=!1;else if(m===1)p=p.nextSide,_=!0;else if(m===2)u=u.nextSide,p=p.nextSide,_=!0;else return!1}else throw Error("not support")}while(u!==c[0].prevSide&&p!==f[0].prevSide);return!0}function h(c){let f=c.primitives.map(u=>new md(u)),d=f[f.length-1];return f.forEach(u=>{d.connect(u),d=u}),f}}function YE(e,t){let i=e.end().distance2(t.center);if(i>(t.rx+it)**2||i<(t.rx-it)**2||!(qe(e.end(),t.end())||D0(t,e.end())))return!1;if(e.center.equals1(t.center))return!0;let r=e.center.distance1(t.center),s=Math.abs(e.rx-t.rx);if(r>Math.min(e.rx,t.rx)){let n=e.center.angleD(t.center);return e.rx>t.rx?!(r+s>it&&da(e,n))&&!(r-s>it&&e.rx+t.rx-r>it&&da(e,n+180)):!(r-s>it&&da(e,n))&&!(e.rx+t.rx-r>it&&da(e,n+180))}else{if(r+s<=it)return!0;let n=e.rx>t.rx?e.center.angleD(t.center):t.center.angleD(e.center);return da(e,n)?!1:r-s<=it?!0:!da(e,n+180)}}function UB(e,t){let i=M0(e,t.start()).toBezier2(),r,s=0;for(let n=i.length;s<n;s++){let a=i[s];if(r=R0(a,t).state,r!==0)break}return r===2&&s!==i.length-1?{state:1}:{state:r}}function FB(e,t){let i=t.toBezier2(),r,s=0;for(let n=i.length;s<n;s++){let a=i[s];if(r=R0(e,a).state,r!==1)break}return r===2&&s!==i.length-1?{state:0}:{state:r}}function R0(e,t){if(e.controls.length===2||$a(e))return t.controls.length===2||$a(t)?jl(new le(e.start(),t.end()),new le(t.start(),t.end())):v0(new le(t.start(),e.end()),t);if(t.controls.length===2||$a(t))return OT(E0(e,t.start()),new le(t.start(),t.end()));let i=E0(e,t.start());if($a(i))return v0(new le(t.start(),e.end()),t);let r=i0(i,t),s=i0(t,i);if(!r&&!s){let n=rB(i,t);if(n.havOverlap){let a=n.havOverlap!==2,o=n.havOverlap!==1;return Qa(e,t,a,o)}else{let a=function(){for(let f=0;f<h;f+=2)ee[f]=c[f],ee[f+1]=c[f+1]},o,l,h=n.cnt,c=new Array(h).fill(0).map((f,d)=>ee[d]);for(let f=0;f<h;f+=2){let d=new ae(ee[f],ee[f+1]),u=i.getPercent(d,it),p=t.getPercent(d,it);if(u===0||p===0)continue;let _=u===1?i:i.clip(u)[0],g=p===1?t:t.clip(p)[0];if(i0(_,g)){let b=tt(e,d).cross(tt(t,d));if(b===0){o=i.end(),l=t.end();break}return{state:b<0?3:4}}a()}return(!o||!l)&&(o=oc(i.controls,i.controls[0],t),l=oc(t.controls,i.controls[0],i)),{state:o.sub(i.controls[0]).cross(l.sub(i.controls[0]))>0?4:3}}}return Qa(e,t,r,s)}function OT(e,t){let i=E0(e,t.start());if($a(i))return jl(new le(i.start(),i.end()),t);let r=yT(i,t),{isIn:s,bezierIsInLeft:n}=mT(t,i);if(!r&&!s){if(n!==void 0)return{state:n?3:4};let a=null,o=e.getPercent(t.start(),it)+.01;for(let l=o>1?1:o;l<=1;){let h=ke.pointOn(l,e.controls);if(fd(t,h)>as){a=h;break}l+=.01,l>1&&(l=1)}if(!a)throw Error("!end1 && !end2 not result");return{state:t.direct.cross(a.sub(t.start()))<0?4:3}}return Qa(i,t,r,s)}function v0(e,t){let{isIn:i,bezierIsInLeft:r}=mT(e,t),s=yT(t,e);if(!i&&!s){if(r!==void 0)return{state:r?4:3};let n=null;for(let a=.01;a<=1;){let o=ke.pointOn(a,t.controls);if(fd(e,o)>as){n=o;break}a+=.01,a>1&&(a=1)}if(!n)throw Error("!end1 && !end2 not result");return{state:e.direct.cross(n.sub(e.start()))<0?3:4}}return Qa(t,e,i,s)}function GB(e,t){let i=YE(M0(e,t.start()),t),r=YE(t,e);if(!i&&!r){let s=Bn(t);if(e.center.sub(t.start()).dot(t.center.sub(t.start()))>0){if(e.rx===t.rx)return e.isCCW?{state:s.dot(e.center.sub(t.center))<0?3:4,exitIsInvalid:!1}:{state:s.dot(e.center.sub(t.center))>0?3:4,exitIsInvalid:!1};let n,a;return e.rx>t.rx?(n=e,a=t):(n=t,a=e),s.dot(a.center.sub(n.center))>0&&a.rx+a.center.distance1(n.center)-n.rx>it?e.isCCW?{state:e.rx>t.rx?3:4,exitIsInvalid:!1}:{state:e.rx<t.rx?3:4,exitIsInvalid:!1}:e.isCCW?{state:e.rx<t.rx?3:4,exitIsInvalid:!0}:{state:e.rx>t.rx?3:4,exitIsInvalid:!0}}else return e.rx+t.rx-e.center.distance1(t.center)>it&&s.dot(e.center.sub(t.center))>0?{state:t.isCCW?3:4,exitIsInvalid:!1}:{state:e.isCCW?3:4,exitIsInvalid:!0}}return Qa(e,t,i,r)}function VE(e,t){let i=Mn.foot(e,t.center),r=e.end().distance2(t.center),s=e.end().sub(e.start()),n=(t.rx-it)**2,a=r<=(t.rx+it)**2&&r>=n&&(s.dot(i.sub(t.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(i)||i.distance2(t.center)>=n)&&(qe(e.end(),t.end())||D0(t,e.end())),o=bT(t,e);if(!a&&!o){let l=e.distance2(t.center);return l<=as?{state:s.cross(Bn(t))>0?4:3}:s.dot(i.sub(t.start()))>=0&&(r<n||e.start().distance2(t.center)<n||l<n)?{state:s.cross(t.center.sub(e.start()))<0?4:3}:{state:s.cross(t.center.sub(e.start()))>0?4:3}}return Qa(t,e,a,o)}function da(e,t){return t=lt.regularD(t),e.sweepAngle>0?(t<e.startAngle&&(t+=360),e.endAngle()>t):(t>e.startAngle&&(t-=360),e.endAngle()<t)}function D0(e,t){return qe(e.end(),t)||qe(e.start(),t)||da(e,t.angleD(e.center))}function mT(e,t){let i=e.panDistance(it),r=e.panDistance(-it),s=XE(t,i),n=XE(t,r);if(!s.length&&!n.length)return{isIn:t.getPercent(e.end(),it)!==null};let a=[...s,...n].sort((c,f)=>c.t-f.t),o=new le(r.start(),i.start()),l=[];for(let c=0,f=a.length;c<f;c++){let d=a[c];if(l.push(d),o.distance(d.interP)>e.length()+it)break;if(l.length===2){let u=(l[1].t*10+l.shift().t*10)/20,p=ke.pointOn(u,t.controls);if(e.distance2(p)>as)return{isIn:!1,bezierIsInLeft:e.direct.cross(p.sub(e.start()))>0}}}let h=l.length?o.distance(l[0].interP)>=e.length()+it:!0;return{isIn:h,bezierIsInLeft:h?void 0:e.direct.cross(l[0].interP.sub(e.start()))>0}}function yT(e,t){if(fd(t,e.end())>as||e.getToLineMaxDis2(t)>as)return!1;let i=HB(t,as);return e.getToLineMaxDis2(i)<=(t.length()+it)**2}function bT(e,t){let i=t.end().angleD(t.start()),r=zB(t,e.end());if(r>as)return!1;if(da(e,i+90)){if(Mn.foot(t,e.center).distance1(e.pointOn(i+90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}if(da(e,i-90)){if(Mn.foot(t,e.center).distance1(e.pointOn(i-90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}return r<=as&&(qe(e.end(),t.end())||T0(t,e.end()))}var xT=(it*2)**2;function M0(e,t){if(qe(e.end(),t))return Oe.build3(e.center,e.endAngle(),0,e.rx,e.ry);if(e.start().distance2(t)<xT)return e;let i=lt.regularD(t.angleD(e.center));if(!da(e,i))throw new Error("!angleIsInArc(arc, angle)");return Oe.build2(e.center,i,e.endAngle(),e.rx,e.ry,e.isCCW?1:0)}function E0(e,t){if(qe(e.end(),t))return new ke([t,t]);if(e.start().distance2(t)<xT)return e;let i=e.getPercent(t,it);if(i===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return e.clip(i)[1]}function qE(e,t){let i=bT(M0(e,t.start()),t),r=t.end().distance2(e.center),s=t.end().sub(t.start()),n=Mn.foot(t,e.center),a=(e.rx-it)**2,o=r<=(e.rx+it)**2&&r>=a&&(s.dot(n.sub(t.start()))<=0||t.start().distance2(t.end())<=t.start().distance2(n)||n.distance2(e.center)>=a)&&(qe(e.end(),t.end())||D0(e,t.end()));if(!i&&!o){let l=t.distance2(e.center);return l<=as?{state:s.cross(Bn(e,t.start().angle(e.center)))>0?3:4}:s.dot(n.sub(t.start()))>=0&&(r<a||t.start().distance2(e.center)<a||l<a)?{state:s.cross(e.center.sub(t.start()))>0?4:3}:{state:s.cross(e.center.sub(t.start()))<0?4:3}}return Qa(t,e,i,o)}function jl(e,t){if(qe(e.end(),t.end()))return Qa(e,t,!0,!0);let i=fd(t,e.end())<=as&&T0(t,e.end()),r=fd(e,t.end())<=as&&T0(e,t.end());if(!i&&!r){let s=e.direct.x===0&&e.direct.y===0,n=t.direct.x===0&&t.direct.y===0;if(s&&n)throw Error("2LineAllIsPoint");return s?{state:t.direct.cross(e.end().sub(t.start()))>0?3:4}:{state:e.end().sub(e.start()).cross(t.end().sub(e.start()))>0?4:3}}return Qa(e,t,i,r)}function T0(e,t){return Mn.foot(e,t).distance2(e.start())<e.end().distance2(e.start())}function Qa(e,t,i,r){if(i)return r?qe(e.end(),t.end())?{state:2}:{state:0}:{state:0};if(r)return{state:1};throw new Error("!end1 && !end2")}function fd(e,t){return(e.a*t.x+e.b*t.y+e.c)**2/(e.a**2+e.b**2)}function zB(e,t){return Math.min(e.distance2(t),Mn.foot(e,t).distance2(t))}function HB(e,t){let i=e.panDistance(t),r=e.panDistance(-t);return new le(r.start(),i.start())}function $a(e){let t=e.start(),i=e.end();t.equals1(i)&&(i=t.add1(1,0));let r=i.y-t.y,s=t.x-i.x,n=-r*t.x-s*t.y,a=Math.sqrt(1/(r**2+s**2));r*=a,s*=a,n*=a;let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return e.controls.forEach(h=>{let c=r*h.x+s*h.y+n;c<o&&(o=c),c>l&&(l=c)}),ga(o,l)}function XE(e,t){let i=dn(e,t),r=[],s=new Array(i).fill(0).map((a,o)=>ee[o]);for(let a=0;a<i;a+=2){let o=new ae(ee[a],ee[a+1]),l=e.getPercent(o);r.push({interP:o,t:l}),n()}function n(){for(let a=0;a<i;a+=2)ee[a]=s[a],ee[a+1]=s[a+1]}return r}var ua=.01,jB=270;function Vo(e){let t=ua**2,i=e.end(),r=[],s=[];for(let u=0,p=e.primitives.length;u<p;u++){let _=function(R,B){return R instanceof le&&B instanceof le&&Math.abs(R.direct.cross(B.direct))<me.eps&&R.direct.dot(B.direct)>0||R instanceof Oe&&B instanceof Oe&&Math.abs(R.rx-B.rx)<=me.eps&&R.center.distance2(B.center)<me.eps&&R.isCCW===B.isCCW},g=function(R){if(Ws(R,ua))s.push(null);else{if(R instanceof le)s.push(R);else if(R instanceof Oe&&R.rx===R.ry)f(R,s);else if(R instanceof ke){let B=[];oT(R,B),B.forEach(Y=>{let G=Y.start(),z=Y.end();c(G,z)||s.push(Y)})}else throw new Error("not support!");i=y}},b=function(R){if(R instanceof le)return R.direct.x===0&&R.direct.y===0;if(R instanceof Oe)return R.sweepAngle===0;if(R instanceof ke){let B=new Set(R.controls.map(G=>G.x)),Y=new Set(R.controls.map(G=>G.y));return B.size===1&&Y.size===1}else throw new Error("not support")},m=e.primitives[u],O=m.start(),y=m.end();if(b(m))continue;c(i,O)||(s.push(new le(i,O)),i=O);let x=(u+1)%p,E=e.primitives[x];for(;_(m,E)&&(x=(x+1)%p,E=e.primitives[x],E!==m););if(x===(u+1)%p){g(m);continue}if(E===m){if(!(m instanceof Oe)){if(Math.abs(e.area(.1))<t)return null;throw new Error("simplifyPolyline not support")}let R=m instanceof Oe?m.isCCW:e.area(.1)>0;s.length=0;let B=R?180:-180;s.push(Oe.build3(m.center,m.startAngle,B,m.rx,m.ry),Oe.build3(m.center,m.startAngle+B,B,m.rx,m.ry));break}let w=(()=>{if(m instanceof le)return(R,B)=>{let Y=new le(R,B);return Ws(Y,ua)?null:[Y]};if(m instanceof Oe)return(R,B)=>{let Y;if(R.equals1(B)?Y=Oe.build3(m.center,m.startAngle,m.sweep()===1?360:-360,m.rx,m.ry):Y=Oe.build4(R,B,m.center,m.rx,m.ry,m.sweep()),Ws(Y,ua))return null;let G=Y.pointOn(Y.startAngle+Y.sweepAngle/2),z=Oe.build4(Y.start(),G,m.center,m.rx,m.ry,m.sweep()),q=Oe.build4(G,Y.end(),m.center,m.rx,m.ry,m.sweep());return Ws(z,ua)||Ws(q,ua)?[Y]:[z,q]};throw new Error("not support")})(),S=x===0;if(x<u&&!S&&(S=!w(e.primitives[0].start(),e.primitives[x-1].end()),!S)){let R=w(m.start(),s[0].end());if(R.length===1)s[0]=R[0];else if(R.length===2)s[0]=R[1],s.push(R[0]);else throw new Error("!!!generatorPt");break}u=x===0?p-1:x-1,E=e.primitives[u];let C=w(m.start(),E.end());if(C?(C.forEach(R=>s.push(R)),i=E.end()):g(null),S)break}let n=s.length;if(s.forEach((u,p)=>{if(u)r.push(u);else{let _,g;p===n-1&&(_=r[0],g=r[r.length-1]);let b=(p+1)%n;if(_=_!=null?_:s[b],_){let m=p,O=!1;for(;g=g!=null?g:s[(--m+n)%n],g!==_;)if(g){O=!0;break}if(O){if(_.start().equals1(g.end()))return;if(tt(g,g.end()).dot(tt(_,_.start()))<0){if(!c(g.end(),_.start())){let w=new le(g.end(),_.start());r.push(w);return}let{rebuildPrevPt:y,rebuildNextPt:x,rebuildLinkLine:E}=WE(s[(m-1+n)%n],g,new le(g.end(),_.start()),_,s[(p+2)%n]);y&&x&&(y!==g?(s[(m+n)%n]=y,r[r.length-1]&&(r[r.length-1]=y)):x!==_&&(s[(p+1)%n]=x,r[0]===_&&(r[0]=x)),E&&r.push(E))}}}}}),r.length===0)return null;c(i,r[0].start())||r.push(new le(i,r[0].start()));let a=r[r.length-1];if(r.length===1)return a instanceof Oe?mt.build7([Oe.build2(a.center,0,180,a.rx,a.ry,a.sweep()),Oe.build2(a.center,180,360,a.rx,a.ry,a.sweep())]):a instanceof ke?mt.build7(a.clip(.5)):null;let o=r.map(u=>new YB(u)),l=o[o.length-1];for(o.forEach(u=>{u.connect(l),l=u});!l.isVisited;){let u=function(){l.next.connect(_),l=l.next,l.isConnected=!1,l.isVisited=!1},p=function(){l.connect(_.prev),l.isConnected=!1},_=l.prev;if(l===_)break;let g=l.pt,b=_.pt,m=b.end();if(!l.isConnected&&!m.equals(g.start())){let O=function(x){l.isConnected=!0,l.pt=g=x,l.next.isVisited=!1},y=function(x){l.isConnected=!0,_.pt=x,_.isVisited=!1,l=_};if(g instanceof le)if(c(m,g.end())){u();continue}else O(new le(m,g.end()));else if(b instanceof le){c(b.start(),g.start())?p():y(new le(b.start(),g.start()));continue}else if(g instanceof ke)if(c(m,g.end())&&!(g.controls.length!==2&&g.getToLineMaxDis2(g.startToEndL)>=t)){u();continue}else O(new ke([m,...g.controls.slice(1)]));else if(b instanceof ke)c(b.start(),g.start())&&!(b.controls.length!==2&&b.getToLineMaxDis2(b.startToEndL)>=t)?p():y(new ke([...b.controls.slice(0,-1),g.start()]));else if(g instanceof Oe&&b instanceof Oe)if(Math.abs(Math.abs(g.sweepAngle)-180)<Math.abs(Math.abs(b.sweepAngle)-180)){let x=Oe.build5(m,g.end(),g.sweepAngle);if(c(x.start(),x.end())&&!(x.rx>=ua&&Math.abs(x.sweepAngle)>180)){u();continue}else O(x)}else{let x=Oe.build5(b.start(),g.start(),b.sweepAngle);c(x.start(),x.end())&&!(x.rx>=ua&&Math.abs(x.sweepAngle)>180)?p():y(x);continue}else throw new Error("not support")}if(tt(g,g.start()).dot(tt(b,b.end()))<0){let O=function(E,w,S,C,R,B){if(l.next===_){l=null;return}let{rebuildLinkLine:Y,rebuildPrevPt:G,rebuildNextPt:z}=WE(E,w,S,C,R);G&&z&&(G!==w&&(_.prev.pt=G),z!==C&&(l.next.pt=z),Y?B.pt=Y:u())},y=function(){l.next===_?l=null:(l.next.connect(_.prev),l=l.next,l.isConnected=!1,l.isVisited=!1)},x=ns(b.reverse(),g).state;if(x===0){let E=JE(g,b.start(),g.end());if(d(E)){let w=_.prev.pt,S=l.next.pt;if(tt(S,S.start()).dot(tt(w,w.end()))>=0){if(y(),!l)break;continue}if(O(_.prev.prev.pt,w,E instanceof le?E:new le(E.start(),E.end()),S,l.next.next.pt,l),!l)break}else l.pt=E;p();continue}else if(x===1){let E=JE(b,b.start(),g.end());if(d(E)){let w=_.prev.pt,S=l.next.pt;if(tt(S,S.start()).dot(tt(w,w.end()))>=0){if(y(),!l)break;continue}if(O(_.prev.prev.pt,w,E instanceof le?E:new le(E.start(),E.end()),S,l.next.next.pt,_),!l)break}else _.pt=E;u();continue}else if(x===2){if(y(),!l)break;continue}}l.isVisited=!0,l=l.next}if(!l)return null;r.length=0;let h=l;for(r.push(l.pt),l=l.next;l!==h;)r.push(l.pt),l=l.next;if(r.length===1){let u=r[0];return u instanceof Oe?(c(u.start(),u.end())?r[0]=Oe.buildCircle(u.center,u.rx,u.sweep()):r.push(new le(u.end(),u.start())),mt.build7(r)):u instanceof ke?(c(u.start(),u.end())||r.push(new le(u.end(),u.start())),mt.build7(r)):null}if(e=mt.build7(r),Math.abs(e.area(.1))<t)return null;return e;function c(u,p){return u.distance2(p)<t}function f(u,p){if(Math.abs(u.sweepAngle)>jB){let _=u.sweepAngle/2;f(Oe.build3(u.center,u.startAngle,_,u.rx,u.ry),p),f(Oe.build3(u.center,u.startAngle+_,_,u.rx,u.ry),p)}else p.push(u)}function d(u){return u.start().distance2(u.end())<t&&!(u instanceof Oe&&u.rx>=ua&&Math.abs(u.sweepAngle)>180||u instanceof ke&&u.controls.length!==2&&u.getToLineMaxDis2(new le(u.start().add1(1,0),u.end()))>=t)}}function Ws(e,t){if(!e)return!0;let i=e.start(),r=e.end();if(i.distance2(r)<t**2)if(e instanceof Oe){if(!(e.rx>=t&&Math.abs(e.sweepAngle)>180))return!0}else if(e instanceof ke){if(!(e.controls.length!==2&&e.getToLineMaxDis2(new le(e.start().add1(1,0),e.end()))>=t))return!0}else return!0;return!1}function Qh(e){if(e.direct.x===0&&e.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let t=Math.abs(ua-e.length())+me.eps,i={x:e.direct.normalize().x*t,y:e.direct.normalize().y*t},r=e.end();return new ae(r.x+i.x,r.y+i.y)}function WE(e,t,i,r,s){if(!e)a();else if(!s)o();else{let l=tt(e,e.end()),h=tt(t,e.end()),c=l.dot(h);if(c>=0)a();else{let f=tt(r,r.end()),d=tt(s,r.end()),u=f.dot(d);if(u>=0)o();else if(ga(c,-1)&&ga(u,-1)){let p=i.center();n(p),i=null}else c>u?a():o()}}function n(l){let h;if(t instanceof le)h=new le(t.start(),l);else if(t instanceof ke)h=new ke([...t.controls.slice(0,-1),l]);else if(t instanceof Oe)h=Oe.build5(t.start(),l,t.sweepAngle);else throw new Error("not supported");t=Ws(h,it)?null:h;let c;if(r instanceof le)c=new le(l,r.end());else if(r instanceof ke)c=new ke([l,...r.controls.slice(1)]);else if(r instanceof Oe)c=Oe.build5(l,r.end(),r.sweepAngle);else throw new Error("supported");r=Ws(c,it)?null:c}function a(){if(t instanceof le){let l=Qh(i.reverse());i=new le(l,i.end());let h=new le(t.start(),l);t=Ws(h,it)?null:h}else if(t instanceof ke){let l=Qh(i.reverse());i=new le(l,i.end());let h=new ke([...t.controls.slice(0,-1),l]);t=Ws(h,it)?null:h}else if(t instanceof Oe){let l=Qh(i.reverse());i=new le(l,i.end());let h=Oe.build5(t.start(),l,t.sweepAngle);t=Ws(h,it)?null:h}else throw new Error("not supported")}function o(){if(r instanceof le){let l=Qh(i);i=new le(i.start(),l);let h=new le(l,r.end());r=Ws(h,it)?null:h}else if(r instanceof ke){let l=Qh(i);i=new le(i.start(),l);let h=new ke([l,...r.controls.slice(1)]);r=Ws(h,it)?null:h}else if(r instanceof Oe){let l=Qh(i);i=new le(i.start(),l);let h=Oe.build5(l,r.end(),r.sweepAngle);r=Ws(h,it)?null:h}else throw new Error("not supported")}return{rebuildPrevPt:t,rebuildNextPt:r,rebuildLinkLine:i}}function JE(e,t,i){if(e instanceof le||t.distance2(i)<=as)return new le(t,i);if(e instanceof Oe)return Oe.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof ke){let r=e.getPercent(t,it),s=e.getPercent(i,it);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}var YB=class{constructor(e){this.pt=e}connect(e){this.prev=e,e.next=this}};function E_(e){let t=yd(),i;if(e instanceof mt){let r=Vo(e);if(r===null)return null;i=r}else if(e instanceof rr){let r=e.items.map(s=>E_(s)).filter(s=>s!==null);if(r.length===0)return null;i=new rr(r)}else{let r=e.items.map(s=>E_(s)).filter(s=>s!==null);if(r.length===0)return null;i=new fi(r)}return pa.preprocessPolyline+=jo(t),i}var pa={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function yd(){return{timeIndex:Object.assign({},pa),start:performance.now()}}function ZE(e){return Object.values(e).reduce((t,i)=>t+i,0)}function jo(e){return performance.now()-e.start-(ZE(pa)-ZE(e.timeIndex))}function br(e,t,i,r){let s=Ut.RED,n=Ut.Golden;function a(){if(!r)return;let d=r.initColor(Ut.Golden);d.addPt(o),d.addPoint(o.end()),r.initColor(Ut.RED).addPt(l),r.draw();debugger}let o=e.getShape(),l=i?t.getShape():t.getShape().reverse(),h=tt(o,l.start()),c=tt(l),f=h.cross(c);if(ga(f,0))if(o instanceof le)if(l instanceof le){if(me.eq(f,0)&&(h.dot(c)>0?!qe(o.end(),l.start()):!qe(o.start(),l.start())))throw a(),new Error("line and line");return f<0}else{if(l instanceof Oe)return h.cross(l.center.sub(o.start()))<0;if(l instanceof ke){let d=l.getExtremePoints(o),u=d.length?d[0]:oc(l.controls,o.start());return h.cross(u.sub(o.start()))<0}else throw new Error("not support")}else if(o instanceof Oe){if(l instanceof le)return o.isCCW;if(l instanceof Oe){if(l.center.equals1(o.center)&&(h.dot(c)>0?!qe(o.end(),l.start())&&o.end().sub(l.start()).dot(c)>0:!qe(o.start(),l.start())&&o.start().sub(l.start()).dot(c)>0))throw a(),new Error("arc and arc");return l.rx>=o.rx||l.center.distance2(o.center)>o.rx2?o.isCCW:!o.isCCW}else throw new Error("not support")}else if(o instanceof ke)if(l instanceof le){let d=o.getPercent(l.start(),it),u=o.clip(d)[1],p=u.getExtremePoints(l);return(p.length?p[0]:oc(u.controls,l.start())).sub(l.start()).cross(c)<0}else if(l instanceof ke){let d=o.getPercent(l.start(),it),u=o.clip(d)[1],p=u.getExtremePoints(new le(l.start(),l.end())),_=l.getExtremePoints(new le(u.start(),u.end())),g=p.length?p[0]:oc(u.controls,l.start()),b=_.length?_[0]:oc(l.controls,l.start()),m=g.sub(l.start()),O=b.sub(l.start());return m.cross(O)<0}else throw Error("not support");else throw new Error("not support");else return f<0}function Vl(e,t,i,r,s){let n=e.getShape(),a=t.getShape(),o=n instanceof Oe?Bn(n,lt.toRadians(n.endAngle())):n instanceof ke?ud(n,1):n.end().sub(n.start()).normalize(),l=tt(a),h=o.dot(l);if(ga(h,-1))return br(e,t,!0,s)?br(e,i,r,s)&&br(t,i,r,s):br(e,i,r,s)||br(t,i,r,s);{let c=o.scale(-1).angle(ae.ORIGIN),f=l.angle(ae.ORIGIN);c>f&&(c-=P_);let d=(c+f)/2,u=new ae(Math.cos(d),Math.sin(d)),p=r?i.getShape():i.getShape().reverse(),_=tt(p);return u.cross(_)<0?br(e,i,r,s):br(t,i,r,s)}}function r0(e,t,i,r,s){let n=e.getShape(),a=t.getShape(),o=n instanceof Oe?Bn(n,lt.toRadians(n.endAngle())):n instanceof ke?ud(n,1):n.end().sub(n.start()).normalize(),l=tt(a),h=o.dot(l);if(ga(h,-1))return br(e,t,!0,s)?br(e,i,r,s)&&br(t,i,r,s):br(e,i,r,s)||br(t,i,r,s);{let c=o.scale(-1).angle(ae.ORIGIN),f=l.angle(ae.ORIGIN);c>f&&(c-=P_);let d=(c+f)/2,u=new ae(Math.cos(d),Math.sin(d)),p=r?i.getShape():i.getShape().reverse(),_=tt(p);if(u.cross(_)<0){let g=o.dot(_)<0,b=ns(g?e.getShape().reverse():e.getShape(),p).state;return b!==3&&b!==4?br(e,i,r,s):b===(g?4:3)}else{let g=l.dot(_)<0,b=ns(g?t.getShape().reverse():t.getShape(),p).state;return b!==3&&b!==4?br(t,i,r,s):b===(g?4:3)}}}var fa,Yo=!1;function Js(e,t,i,r,s,n,a,o=i.side===t,l=!0,h){return fa=s,Yo=n,vT(ET(e,t,l,h,a,i,o,r),i,o,r,0)}function Ja(e,t,i,r,s,n,a,o=r.side===i){fa=s,Yo=n;let l=TT(e,t,i,new Map,r,o,a),h=l instanceof Array?-1:1;return vT(l,r,o,a,h)}function vT(e,t,i,r,s){for(;e instanceof Array;)s++,e.length===4?e=TT(...e,t,i,r):e=ET(...e,t,i,r);return{...e,existOverlap:s>0}}function ET(e,t,i,r,s,n,a,o){if(T_===-1){o.initColor(Ut.RED).addPt(e.getShape()),o.initColor(Ut.Golden).addPt(t.getShape()),o.draw();debugger}let l=e.getShape(),h=a?t.getShape().reverse():t.getShape(),c=(l instanceof Oe?Bn(l,i?h.start().angle(l.center):r?lt.toRadians(l.endAngle()):void 0):l instanceof ke?tt(l,i?h.start():r?l.end():l.start()):l.end().sub(l.start())).normalize(),f=(h instanceof Oe?Bn(h,i?void 0:(r?l.end():l.start()).angle(h.center)):h instanceof ke?tt(h,i?void 0:r?l.end():l.start()):h.end().sub(h.start())).normalize();if(r===void 0){let p=c.dot(f);if(r=p<0,ga(p,0))return{state:br(e,t,!a,o)?1:0,inter:Za(e,t,n,a,i,r,s)}}else if(r?c.dot(f)>0:c.dot(f)<0)if(i){let p,_=!0;if(l instanceof le&&qe(Mn.foot(l,h.start()),r?l.end():l.start()))_=!1;else if(l instanceof Oe||l instanceof ke){let g=r?l.reverse():l,b=ns(h,lB(g,h.start()).reverse()).state;(b===1||b===2)&&(_=!1)}if(_){let g=!r;p=ns(g?l.reverse():l,h,o).state===(g?4:3)?1:0}else r?p=Vl(e,e.nextSide,t,!a,o)?1:0:p=Vl(e.prevSide,e,t,!a,o)?1:0;return{state:p,inter:Za(e,t,n,a,i,r,s)}}else return r?{state:br(e,e.nextSide,!0,o)?0:1,inter:Za(e,t,n,a,i,r,s),isReversed:!0}:{state:br(e.prevSide,e,!0,o)?0:1,inter:Za(e,t,n,a,i,r,s),isReversed:!0};let d,u=new Map([[3,4],[4,3],[0,1],[1,0],[2,2]]);if(i)if(e.judgeOverlapMap.has(t)&&!Yo){let p=e.judgeOverlapMap.get(t);d=r?u.get(p.state):p.state}else d=ns(r?l.reverse():l,h).state,(d===3||d===4)&&e.judgeOverlapMap.set(t,{state:r?u.get(d):d});else{if(t.judgeOverlapMap.has(e)&&!Yo){let p=t.judgeOverlapMap.get(e);d=a?u.get(p.state):p.state}else d=ns(h,r?l.reverse():l).state,(d===3||d===4)&&t.judgeOverlapMap.set(e,{state:a?u.get(d):d});d=u.get(d)}if(d===1||d===2){let p=a?t.prevSide:t,_=p.inters,g=p.getEnd();for(let b=_.length-1;b>=0;b--){let m=_[b];if(!(p.getShape()instanceof ke)&&!qe(g,m.coord))break;if(m===n)return{state:2,inter:Za(e,t,n,a,i,r,s)}}}if(d===3||d===4)return{state:d===(r?4:3)?1:0,inter:Za(e,t,n,a,i,r,s)};if(s.has(e)?s.get(e).mapSideList.push(t):s.set(e,{sideIsReversed:r,mapSideList:[t]}),s.has(t)?s.get(t).mapSideList.push(e):s.set(t,{sideIsReversed:a,mapSideList:[e]}),d===2)return r?[e.prevSide,e,a?t.prevSide:t.nextSide,s]:[e,e.nextSide,a?t.prevSide:t.nextSide,s];if(d===0)return[r?e.prevSide:e.nextSide,t,!1,r,s];if(d===1)return[e,a?t.prevSide:t.nextSide,!0,r,s];throw Error("not support")}function Za(e,t,i,r,s,n,a){if(Yo)return null;let o=e.getShape(),l=r?t.getShape().reverse():t.getShape(),h=r;if(!s){let u=t;t=e,e=u,r=n,i=i.getBindedInter()}let c=u=>!(s?n:h)&&qe(u,e.prevSide.getEnd())?e.prevSide:e;if(r){let u=t.inters;for(let p=0;p<u.length;p++){let _=u[p];if(_.isInvalid&&n===void 0)continue;if(_===i&&qe(l.start(),i.coord))return s?_:_.getBindedInter();let g=_.getBindedInter().side,b=c(_.coord);if(g===b&&f(_))return d(_)}for(;;){t=t.nextSide;let p=t.inters;for(let _=0;_<p.length;_++){let g=p[_];if(g===i)return s?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||qe(g.coord,b.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return d(g);if(a.has(b)){let m=t.getShape().reverse(),O=tt(m,g.coord).dot(tt(b.getShape(),g.coord))<0,y=O?b.getShape().reverse():b.getShape(),x=ns(m,O?Km(y,g.coord,y.end()):Km(y,y.start(),g.coord)).state;if(x===1||x===2)return d(g)}else a.has(b.nextSide)}else if(g.side===i.side&&f(g))return d(g)}}}else{let u=t.inters;for(let p=u.length-1;p>=0;p--){let _=u[p];if(_.isInvalid&&n===void 0)continue;if(_===i&&qe(l.start(),i.coord))return s?_:_.getBindedInter();let g=_.getBindedInter().side,b=c(_.coord);if(g===b&&f(_))return d(_)}for(;;){t=t.prevSide;let p=t.inters;for(let _=p.length-1;_>=0;_--){let g=p[_];if(g===i)return s?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||qe(g.coord,g.getBindedInter().side.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return d(g);if(!a.has(b)&&a.has(b.prevSide)){let m=t.getShape().reverse(),O=tt(m,g.coord).dot(tt(b.getShape(),g.coord))<0;if(a.has(b.prevSide)){let y=O?b.getShape().reverse():b.getShape(),x=ns(t.getShape(),Km(y,g.coord,y.end())).state;if(x===1||x===2)return d(g)}}}else if(g.side===i.side&&f(g))return d(g)}}}function f(u){if(u.isInvalid||u.getBindedInter().side!==(qe(u.coord,e.prevSide.getEnd())?e.prevSide:e))return!1;let p;if(s){if(qe(u.coord,l.start()))return!0;p=ns(n?o.reverse():o,_(l)).state}else{if(qe(u.coord,n?o.end():o.start()))return!0;p=ns(l,_(n?o.reverse():o)).state}return p===2||p===1;function _(g){if(g instanceof le)return qe(u.coord,g.end())?g:g.cutLine(u.coord);if(g instanceof Oe)return Oe.build2(g.center,g.startAngle,u.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof ke)return g.clip(g.getPercent(u.coord,it))[0];throw new Error("not supported operation")}}function d(u){let p=i.getBindedInter(),_=i.side,g=p.side,b=i===u,m=i;if(r){let O=i.getIndex()-1;for(;_;){let y=_.inters;for(;O>=0;O--)if(i=y[O],i===u){b||(i.setIsInvalid(),i.isDealed(),m=i),_=null;break}else if(fa===0)!i.isInvalid&&(!qe(i.coord,u.coord)||i.side===u.side&&i.getBindedInter().side===u.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),m=i);else if(fa===1){if(i.isInvalid)continue;let x=i.getBindedInter().side;a.has(_)&&a.get(_).mapSideList.includes(x)&&(i.setIsInvalid(),i.isDealed(),m=i)}_=_==null?void 0:_.prevSide,O=(_==null?void 0:_.inters.length)-1}}else{let O=i.getIndex()+1;for(;_;){let y=_.inters;for(;O<y.length;O++){i=y[O];let x=i.getBindedInter();if(i===u){b||(i.setIsInvalid(),i.isDealed(),m=i),_=null;break}else if(fa===0)!i.isInvalid&&(!qe(i.coord,u.coord)||_===u.side&&(qe(x.side.getEnd(),i.coord)?x.side.nextSide:x.side)===u.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),m=i);else if(fa===1){let E=x.side;a.has(_)&&a.get(_).mapSideList.includes(E)&&(i.setIsInvalid(),i.isDealed(),m=i)}}_=_==null?void 0:_.nextSide,O=0}}if(fa===0&&!qe(p.coord,u.coord))if(s?a.has(g)?a.get(g).sideIsReversed:n:h){let O=p.getIndex()-1;for(;g;){let y=a.has(g),x=g.inters;for(;O>=0;O--){if(p=x[O],p===u.getBindedInter()){g=null;break}p.isInvalid||!y||(!qe(p.coord,u.getBindedInter().coord)||p.side===u.side&&p.getBindedInter().side===u.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.prevSide,O=(g==null?void 0:g.inters.length)-1}}else{let O=p.getIndex()+1;for(;g;){let y=g.inters,x=a.has(g);for(;O<y.length;O++){if(p=y[O],p===u.getBindedInter()){g=null;break}let E=qe(g.getEnd(),p.coord)?a.has(g.nextSide):!1;p.isInvalid||!(x||E)||(!qe(p.coord,u.getBindedInter().coord)||p.side===u.side&&p.getBindedInter().side===u.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.nextSide,O=0}}return s?m:m.getBindedInter()}}function TT(e,t,i,r,s,n,a){let o=e.getShape(),l=t.getShape(),h=n?i.getShape().reverse():i.getShape(),c=(o instanceof Oe?Bn(o,h.start().angle(o.center)):o instanceof ke?tt(o,h.start()):o.end().sub(o.start())).normalize(),f=(l instanceof Oe?Bn(l,h.start().angle(l.center)):l instanceof ke?tt(l,h.start()):l.end().sub(l.start())).normalize(),d=c.dot(f);if(ga(d,-1)){let u=n?i.getShape().reverse():i.getShape(),p=tt(u).normalize(),_=c.add(f.scale(-1)).normalize().dot(p),g=ns(o.reverse(),l,a).state;if(_>-.9&&(g===3||g===4))return{state:g===4?0:1,inter:Za(t,i,s,n,!0,!1,r)};let b=Js(e,i,s,a,fa,Yo,r.size===0?new Map:r,n);return b.state===2?b:g===4?b.state===0||b.inter!==s?b:Js(t,i,s,a,fa,Yo,r.size===0?new Map:r,n):b.state===1||b.inter!==s?b:Js(t,i,s,a,fa,Yo,r.size===0?new Map:r,n)}else{let u=c.scale(-1).angle(ae.ORIGIN),p=f.angle(ae.ORIGIN);u>p&&(u-=P_);let _=(u+p)/2,g=new ae(Math.cos(_),Math.sin(_)),b=tt(h).normalize(),m=b.angle(ae.ORIGIN),O=u<m&&m<p&&o instanceof le&&l instanceof le&&h instanceof le;if(g.cross(b)<=0){if(c.scale(-1).dot(b)<0){let y;return s.coord.equals1(h.start())?y=tt(o,s.coord).dot(tt(h,s.coord))<0:h instanceof le&&(y=tt(o,o.end()).dot(h.direct)<0),{state:Vl(e,t,i,!n,a)?1:0,inter:Za(e,i,s,n,!0,y,r)}}return O&&o.distance2(h.start())>as?[t,i,!0,void 0,r]:[e,i,!0,void 0,r]}else return f.dot(b)<=0?{state:Vl(e,t,i,!n,a)?1:0,inter:Za(t,i,s,n,!0,void 0,r)}:O&&l.distance2(h.start())>as?[e,i,!0,void 0,r]:[t,i,!0,void 0,r]}}var T_=0;function VB(e,t,i,r){let s=t.getBindedInter(),n=t.side,a=s.side,o=n.getShape(),l=a.getShape();if(r&&(T_++,T_===-1)){r.initColor(Ut.RED).addPt(o),r.initColor(Ut.Golden).addPt(l),r.draw();debugger}let h=0,c=!1;if(e===-1){let w=Ja(n,n.nextSide,a,s,h,c,r),S=w.state!==0;if(w.state===2){let R=tt(o,t.coord).add(tt(n.nextSide.getShape(),t.coord)).normalize(),B=tt(l,t.coord).add(tt(a.nextSide.getShape(),t.coord)).normalize();return E(S,R.dot(B)>0)}let C=Ja(n,n.nextSide,a.nextSide,s,h,c,r);return w.state!==C.state?(x(w,C),1):E(S,w.state!==Ja(a,a.nextSide,n,t,h,!0,r).state,w.inter,C.inter)}if(e===1){let w=Js(n,a,s,r,h,c,new Map),S=w.state!==0;if(w.state===2)return E(S,tt(o,t.coord).dot(tt(l,t.coord))>0);let C;if(w.isReversed&&w.existOverlap&&qe(w.inter.coord,a.getEnd())&&w.inter.getBindedInter().side!==n){let Y=w.inter.getBindedInter().side;if(Y===n.nextSide)C={state:Vl(n,Y,a.nextSide,!0,r)?1:0,inter:s};else if(Y===n.prevSide){if(C={state:Vl(Y,n,a.nextSide,!0,r)?1:0,inter:w.inter},w.state===C.state&&t!==w.inter){let G=tt(l,t.coord),z=tt(a.nextSide.getShape(),t.coord),q=tt(Y.getShape(),t.coord);return E(S,G.add(z).dot(q)>0,w.inter,C.inter)}}else C=Js(n,a.nextSide,s,r,h,c,new Map)}else C=Js(n,a.nextSide,s,r,h,c,new Map);if(w.state!==C.state)return x(w,C),1;let R=tt(l,t.coord),B=tt(a.nextSide.getShape(),t.coord);if(ga(R.dot(B),-1)){let Y=br(a,a.nextSide,!0,r);return E(S,w.state!==Js(a.nextSide,n,t,r,h,!0,new Map,Y?!S:S,!1).state,w.inter,C.inter)}else{let Y=tt(o,t.coord);return E(S,R.add(B).dot(Y)>0,w.inter,C.inter)}}if(!(o instanceof ke||l instanceof ke))return 1;let f=tt(o,t.coord),d=tt(l,t.coord),u,p;if(l instanceof le)u=new le(t.coord,l.start()),p=new le(t.coord,l.end());else if(l instanceof Oe){let w=t.coord.angleD(l.center);u=Oe.build2(l.center,w,l.startAngle,l.rx,l.ry,l.isCCW?0:1),p=Oe.build2(l.center,w,l.endAngle(),l.rx,l.ry,l.isCCW?1:0)}else if(l instanceof ke){let w=l.getPercent(t.coord,it);[u,p]=l.clip(w),u=u.reverse()}else throw new Error("not support");let _=f.dot(d)>0,g,b;_?(g=ns(o.reverse(),u).state,b=ns(o,p).state):(g=ns(o,u).state,b=ns(o.reverse(),p).state);let m;g===0?m=Js(_?n.prevSide:n.nextSide,a,s,r,h,c,new Map,!0,!1,_):g===1?m=Js(n,a.prevSide,s,r,h,c,new Map,!0,!0,_):g===2?_?m=Ja(n.prevSide,n,a.prevSide,s,h,c,r,!0):m=Ja(n,n.nextSide,a.prevSide,s,h,c,r,!0):_?g===3?m={inter:s,state:0}:m={inter:s,state:1}:g===3?m={inter:s,state:1}:m={inter:s,state:0};let O=m.state!==0;if(m.state===2)return E(O,_);let y;if(b===0?y=Js(_?n.nextSide:n.prevSide,a,s,r,h,c,new Map,!1,!1,!_):b===1?y=Js(n,a.nextSide,s,r,h,c,new Map,!1,!0,!_):b===2?_?y=Ja(n,n.nextSide,a.nextSide,s,h,c,r,!1):y=Ja(n.prevSide,n,a.nextSide,s,h,c,r,!1):_?b===3?y={inter:s,state:1}:y={inter:s,state:0}:b===3?y={inter:s,state:0}:y={inter:s,state:1},m.state===y.state)return m.inter===y.inter?(t.setIsInvalid(),0):E(O,_,m.inter,y.inter);return x(m,y),1;function x(w,S){let C=w.state!==0;if(w.inter===S.inter){t.setOutToIn(C);return}else ec(w.inter,S.inter,!0),ec(S.inter,w.inter,!1);let R=[];if(e===-1){let Y=tt(o,t.coord),G=tt(n.nextSide.getShape(),t.coord),z=tt(l,t.coord),q=tt(a.nextSide.getShape(),t.coord);R.push(Y.dot(z)),R.push(Y.dot(q)),R.push(G.dot(z)),R.push(G.dot(q))}else{let Y=tt(o,t.coord);R.push(tt(l,t.coord).dot(Y)),R.push(tt(a.nextSide.getShape(),t.coord).dot(Y))}if(R.reduce((Y,G)=>Math.abs(Y)>Math.abs(G)?Y:G,0)>0)if(i===1||i===0||i===2||i===3)t.setOutToIn(C);else throw new Error("not support");else if(i===1)B(!C);else if(i===0||i===2||i===3)B(C);else throw new Error("not support");function B(Y){t.setIsInvalid();let G=(Y?w:S).inter;delete G.isInvalid,delete G.getBindedInter().isInvalid,G.setOutToIn(!C)}}function E(w,S,C,R){if(C===R){if(t.side.outline.inters.find(G=>!G.isInvalid&&G!==t&&qe(G.coord,t.coord)))return t.setIsInvalid(),0;let B=new Ka(t.coord,n,r),Y=new Ka(t.coord,a,r);return B.bind(Y),S?n.inters.splice(t.getIndex(),0,B):n.inters.splice(t.getIndex()+1,0,B),a.inters.splice(t.getBindedInter().getIndex(),0,Y),B.setOutToIn(w),t.setOutToIn(!w),B.isDealed(),n.inters.forEach((G,z)=>G.setIndex(z)),a.inters.forEach((G,z)=>G.setIndex(z)),2}else{let B=function(){let Y=C.getBindedInter(),G=R.getBindedInter();delete C.isInvalid,delete Y.isInvalid,delete R.isInvalid,delete G.isInvalid,C.setOutToIn(!w),R.setOutToIn(w),ec(C,R,!0),ec(R,C,!1),ec(Y,G,S),ec(G,Y,!S)};if(t.setIsInvalid(),S){if(i===1||i===0||i===2||i===3)return B(),2;throw new Error("not support")}else{if(i===1)return w?0:(B(),2);if(i===0||i===2||i===3)return w?(B(),2):0;throw new Error("not support")}}}}function ec(e,t,i){let{judge:r,changeNum:s}=a(),n=e.getIndex();for(let o=n+s,l=e.side.inters;r(o);o+=s){if(l[o].isInvalid)continue;if(!qe(l[o].coord,e.coord))break;l[o].setIndex(n),l[n].setIndex(o);let h=l[o];l[o]=l[n],l[n]=h,n=o}function a(){let o=e.side===t.side;if(i){let l=o?t.getIndex():e.side.inters.length;return{judge:h=>h<l,changeNum:1}}else{let l=o?t.getIndex()+1:0;return{judge:h=>h>=l,changeNum:-1}}}}var KE=0,Ka=class{constructor(e,t,i){this.id=KE++,this.coord=e,this.side=t,i&&(this.id=KE++,this.drawDebug=i);let r=new vi;r.ext2(e),this._bbox=r.build1()}bbox(){return this._bbox}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(e){this.outToIn=e,this.bindedInter.outToIn=!e}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(e){this.bindedInter=e,e.bindedInter=this}setIndex(e){this.index=e}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let e=this.getIndex(),t=this.side.getStart();return e&&(t=this.side.inters[e-1].coord),t}getTangent(){let e=this.side.getShape();if(e instanceof le)return e.end().sub(e.start());if(e instanceof Oe){let t=this.coord.angle(e.center);return e.isCCW?t+=O_:t-=O_,new ae(Math.cos(t),Math.sin(t))}else{if(e instanceof ke)return ud(e,e.getPercent(this.coord,it));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let e=[],t=this,i;if(this.drawDebug){s0++;let r=s0===-1,s=this.drawDebug.initColor(Ut.RED);if(r){this.drawDebug.draw();debugger}i=n=>{if(e.push(n),r){s.addPt(e[e.length-1]),this.drawDebug.draw();debugger}}}else i=r=>e.push(r);for(;!t.visited;){let r=function(o,l){if(me.eq(o.distance2(l),0))return;let h=md.rebuild(n.getShape(),o,l);if(!h)return!0;i(h)};t.visit();let s=t.getIndex(),n=t.side,a=n.inters[s+1];for(;a!=null&&a.isInvalid;)a=n.inters[a.getIndex()+1];if(a)r(t.coord,a.coord),t=a.bindedInter;else{let o=r(t.coord,n.getEnd()),l=t.coord;for(n=n.nextSide,t=null;;){for(let h of n.inters)if(!h.isInvalid){t=h.bindedInter;break}if(t)break;o?(r(l,n.getEnd()),o=!1):i(n.getShape()),n=n.nextSide}o?(me.eq(l.distance2(t.coord),0)?r(l,n.getEnd()):r(l,t.coord),o=!1):me.eq(n.getEnd().distance2(t.coord),0)?i(n.getShape()):r(n.getStart(),t.coord)}}if(t!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:s0,handleId:T_,boolId:sd})),new Error("inter !== this");return Vo(mt.build7(e))}},s0=0,n0=class w0{constructor(t,i,r,s,n){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=t,this.isGroup1=r,this.isOutside=s,this.finalIsOutside=s,this.polyline=i,n&&(this.polygon=n),t.forEach(a=>a.outline=this)}static build(t,i,r,s,n){let a=t.primitives.map(l=>new md(l,s)),o=a[a.length-1];return a.forEach(l=>{o.connect(l),o=l}),n?new w0(a,t,i,r,n):new w0(a,t,i,r)}setFinalIsOutSide(t){this.finalIsOutside=t}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(t,i){if(!(t.interOutlines&&t.interOutlines===this.interOutlines))if(t.interOutlines)if(this.interOutlines){let r,s;this.interOutlines.length>t.interOutlines.length?(r=this.interOutlines,s=t.interOutlines):(r=t.interOutlines,s=this.interOutlines),s.forEach(n=>{r.push(n),n.interOutlines=r}),i.delete(s)}else t.interOutlines.push(this),this.interOutlines=t.interOutlines;else this.interOutlines?(this.interOutlines.push(t),t.interOutlines=this.interOutlines):(t.interOutlines=this.interOutlines=[this,t],i.add(this.interOutlines))}isContain(t){if(!this.polyline.bbox().extendOfSize(it).isContainsBBox(t.polyline.bbox()))return!1;let i=t.polyline.primitives[0].start();if(t.hasInter&&t.isAllInterIsInvalid()){let r=t.inters[0];r.getBindedInter().side.outline!==this?i=r.side.getCenterPoint():i=r.side.getCenterPoint(r.coord)}return!!this.polyline.getWindingNum(i)}isInternally(t){return!!this.polyline.getWindingNum(t)}isEqual(t){return this.polyline===t.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let t=this.sides[this.sides.length-1];this.sides.forEach(i=>{i.reverse(),t.connect(i),t=i})}returnPolyline(){let t=this.sides.map(r=>r.getShape()),i=this.polyline.primitives;if(this.sides.length===i.length){let r=new Set(i);if(!t.some(s=>!r.has(s)))return this.polyline}return mt.build7(t)}};function $E(e,t,i){let r=[];return e.forEach(s=>s.forEach(n=>{if(n.hasInter&&!n.isAllInterIsInvalid())return;let a=n.bbox(),o=t.search(a.extendOfSize(it)).filter(l=>l.bbox().extendOfSize(it).isContainsBBox(a)).sort((l,h)=>l.bbox().area()-h.bbox().area());for(let l of o)if(l.isContain(n)){let h=i(!n.isOutside,l.isOutside),c=i(n.isOutside,l.isOutside);h!==c&&(r.push(n),n.setFinalIsOutSide(!h));return}i(n.isOutside,!1)!==i(!n.isOutside,!1)&&r.push(n)})),r}function qB(e,t,i){let r;switch(i){case 0:r=(o,l)=>o&&l;break;case 1:r=(o,l)=>o||l;break;case 2:r=(o,l)=>o&&!l;break;case 3:r=(o,l)=>o&&!l||!o&&l;break;default:throw Error("not support the rule")}let s=new dd(10),n=new dd(10);e.forEach(o=>o.forEach(l=>s.add(l))),t.forEach(o=>o.forEach(l=>n.add(l)));let a=$E(e,n,r);return $E(t,s,(o,l)=>r(l,o)).forEach(o=>a.push(o)),a}var XB=class{constructor(e){this.roots=[],this.nodes=e.sort((t,i)=>t.bbox().minX-i.bbox().minX).map(t=>new WB(t)),this.nodes.forEach((t,i)=>{t.visit()&&(this.roots.push(t),this.build(i))})}build(e){let t=this.nodes[e];for(let i=e+1,r=this.nodes.length;i<r;i++){let s=this.nodes[i];if(t.key.bbox().maxX<s.key.bbox().minX)break;s.getIsVisit()||t.isContain(s)&&(s.visit(),t.addChild(s),this.build(i))}}getPolygons(){let e=[];return this.roots.forEach(t=>t.getPolygons().forEach(i=>e.push(i))),e}},WB=class{constructor(e){this.children=[],this.isVisit=!1,this.key=e}getIsVisit(){return this.isVisit}isContain(e){return this.key.isContain(e.key)}addChild(e){this.children.push(e)}getPolygons(){let e=[];return this.getPolylineList(e),e.map(t=>{let i=t[0].polygon;if(i&&i.items.length===t.length){let r=t.map(n=>n.returnPolyline()),s=new Set(i.items);return r.some(n=>!s.has(n))?new rr(r):i}else return new rr(t.map(r=>r.returnPolyline()))})}getPolylineList(e,t){t?(t.push(this.key),t=null):(t=[this.key],e.push(t)),this.children.forEach(i=>i.getPolylineList(e,t))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function QE(e){let t="";return e.items.forEach((i,r)=>{let s="$";if(i.items.forEach((n,a)=>{let o="[";if(n.primitives.forEach((l,h)=>{let c="";if(l instanceof le)c=`Line,${l.start().x},${l.start().y},${l.end().x},${l.end().y}`;else if(l instanceof Oe)c=`Arc,${l.center.x},${l.center.y},${l.startAngle},${l.sweepAngle},${l.rx}`;else if(l instanceof ke)c=`Bezier,${l.controls.map(f=>`${f.x},${f.y}`).join(",")}`;else throw new Error("not supported");if(h===n.primitives.length-1){o+=`${c}]`;return}o+=`${c},`}),a===i.items.length-1){s+=`${o}$`;return}s+=`${o}_`}),r===e.items.length-1){t+=`${s}`;return}t+=`${s}^`}),console.log(t),t}function eT(e){let t=e.split("^"),i=[];return t.forEach(s=>{let n=/\$(.*?)\$/,a=s.match(n)[1].split("_"),o=[];a.forEach(h=>{let c=/\[(.*?)\]/,f=h.match(c)[1].split(","),d=[],u=[];for(let _=0;_<f.length;_++){let g=f[_];if(g==="Line"||g==="Arc"||g==="Bezier"){if(d.length){let b=r(d);u.push(b),d.length=0}d.push(g);continue}d.push(Number(g))}d.length&&(u.push(r(d)),d.length=0);let p=mt.build7(u);o.push(p)});let l=new rr(o);i.push(l)}),new fi(i);function r(s){let n=s[0];if(n==="Line")return new le(new ae(s[1],s[2]),new ae(s[3],s[4]));if(n==="Arc")return Oe.build3(new ae(s[1],s[2]),s[3],s[4],s[5],s[5]);if(n==="Bezier"){let a=[];for(let o=1;o<s.length;o+=2)a.push(new ae(s[o],s[o+1]));return new ke(a)}else throw new Error("not support")}}var JB=class{constructor(e=1){this.group1Str="$[Line,20193.777980000017,4122.200439600661,20193.77082,4211.848760073709,Arc,20193.972672902382,4211.8487570980205,179.99915535323618,-89.99540000050294,0.2018529024026465,Line,20193.972659672283,4212.050609999989,20193.972660393258,4212.039610000013,Arc,20193.97217289501,4211.848257065248,89.85403133887164,89.99540000041924,0.19135355574930143,Line,20193.78082,4211.848759926291,20193.78897999998,4122.200440479205,Line,20193.78897999998,4122.200440479205,20193.777980000017,4122.200439600661]$",this.group2Str="$[Arc,20209.72784128151,4122.2007625157785,258.46768032837986,-75.66780748375947,4.138846238512183,Line,20205.593935808283,4121.998590004101,20193.97982992629,4121.998600000001,Arc,20193.97983290198,4122.2004529023825,269.9991553532362,-89.99540000050297,0.20185290240401074,Arc,20193.782979999996,4122.20044,180.00375535340328,-180.0000000000027,0.004999999999025513,Arc,20193.979332869207,4122.200952909754,180.15347936671733,89.99540000008247,0.19135355575111057,Line,20193.97983008845,4122.009599999999,20205.603694309226,4122.003828485546,Arc,20209.733142304296,4122.194577876843,182.64475341258483,75.73379999998886,4.133851239977064,Line,20208.900400396684,4118.145470939558,20208.902599535475,4118.156248870184,Arc,20206.972515961093,4108.700057667588,78.46393309088245,-78.46759999998636,9.65115405866796,Arc,20216.618669999996,4108.69944,359.99996825446135,-180,0.004999999999200412,Arc,20206.973015966745,4108.699445349495,359.99996822365375,78.46759999998409,9.640654033253735]$^$[Line,20193.997796883676,4095.399470032799,20205.596133314026,4095.4013992171836,Arc,20209.72470159858,4095.1923799234505,177.10172964919312,-75.64935037184974,4.133855965730166,Arc,20209.73000213952,4095.198565517174,101.5415133143569,75.7293000000185,4.128850963459707,Line,20205.605834328744,4095.395161923586,20193.997203529463,4095.389485743675,Arc,20193.994588809255,4095.197684525904,89.21896662213764,4.544099999999517,0.19181903946188483,Arc,20193.981499796217,4095.1977402038,89.85034659953621,89.9999999995926,0.19135044893494071,Arc,20193.78515,4095.19824,0,-180,0.005,Arc,20193.98200016982,4095.1982398301675,179.99995179248322,-89.99999999974185,0.20185016982129908,Arc,20193.981986624152,4095.198185381971,89.9961078637802,-4.487285276547311,0.2019046184835962]$",this.rule=e}getGroup1(){return eT(this.group1Str)}getGroup2(){return eT(this.group2Str)}},a0=new I_(2),rd=class{getUnion(e,t=!0){return t&&(e=e.map(i=>this.asSameSweep([i])[0])),MB(OB,e)}asSameSweep(e){let t=0;return e.forEach(i=>t+=i.area(.01)),t>0?e.map(i=>i.reverse()):e}getSubtraction(e,t){let i=new hd(!1),r=new cd(u_.rule,a0,i);for(let s of e){let n=u_.weight(0);r.addPolyline(s,n)}for(let s of t){let n=u_.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}getIntersection(e,t){let i=new hd(!1),r=new cd(d_.rule,a0,i);for(let s of e){let n=d_.weight(0);r.addPolyline(s,n)}for(let s of t){let n=d_.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}getMutuallyExclusive(e,t){let i=new hd(!1),r=new cd(Qm.rule,a0,i);for(let s of e){let n=Qm.weight(0);r.addPolyline(s,n)}for(let s of t){let n=Qm.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}},sd=0,o0=!1;function nd(e,t,i,r,s){let n=yd(),a=[],o=[],l=[],h=new Set,c;if(s){if(c=new Od(s),sd++,o0){debugger;o0=!1;let y=new JB;nd(y.rule,y.getGroup1(),y.getGroup2(),r,s)}if(sd===-1||o0){console.table({rule:e,group1:QE(t),group2:QE(i)}),c.clear();let y=c.initColor(Ut.GREEN),x=c.initColor(Ut.WHITE),E=c.initColor(Ut.BLUE),w=c.initColor(Ut.Gray);t.items.forEach(S=>S.items.forEach((C,R)=>{R>0?x.addPly(C):y.addPly(C)})),i.items.forEach(S=>S.items.forEach((C,R)=>{R>0?w.addPly(C):E.addPly(C)})),c.draw();debugger}}let f=t.items.length!==0&&i.items.length!==0?t.bbox().extendOfSize(it).intersection1(i.bbox().extendOfSize(it)):null;if(f){let y=[],x=[];switch(e){case 0:{for(let E of t.items)E.bbox().isIntersect(f)&&y.push(E);for(let E of i.items)E.bbox().isIntersect(f)&&x.push(E);break}case 1:case 3:{for(let E of t.items)E.bbox().isIntersect(f)?y.push(E):a.push(E);for(let E of i.items)E.bbox().isIntersect(f)?x.push(E):a.push(E);break}case 2:{for(let E of t.items)E.bbox().isIntersect(f)?y.push(E):a.push(E);for(let E of i.items)E.bbox().isIntersect(f)&&x.push(E);break}default:throw new Error("not support")}y.length!==t.items.length&&(t=new fi(y)),x.length!==i.items.length&&(i=new fi(x))}else{switch(e){case 0:break;case 1:case 3:{t.items.forEach(y=>a.push(y)),i.items.forEach(y=>a.push(y));break}case 2:{t.items.forEach(y=>a.push(y));break}default:throw new Error("not support")}t=new fi([]),i=new fi([])}m(t,o,!0),m(i,l,!1);let d=e===2||e===3?(y,x)=>qe(y.getEnd(),x)?y.nextSide:y:(y,x)=>qe(y.prevSide.getEnd(),x)?y.prevSide:y,u=(y,x,E)=>{if(qe(y.getEnd(),E)){if(y.inters.findIndex(w=>w.getBindedInter().side===x&&qe(w.coord,y.getEnd()))===-1)return new Ka(E,y,c)}else return new Ka(E,y,c)},p=e===2||e===3?(y,x,E)=>{if(qe(y.getStart(),E)){if(y.inters.findIndex(w=>w.getBindedInter().side===x&&qe(w.coord,y.getStart()))===-1)return new Ka(E,y,c)}else return new Ka(E,y,c)}:u;r.seek(t,i,(y,x,E,w,S,C)=>{let R=o[y][x],B=l[w][S],Y=R.sides[E],G=B.sides[C],z=dn(Y.getShape(),G.getShape());if((Y.getShape()instanceof ke||G.getShape()instanceof ke)&&z>=4){if(Y.getShape()instanceof Oe||G.getShape()instanceof Oe){let L=function(v,P){let I=!1;for(let N=0;N<P.length;N+=2)qe(new ae(P[N],P[N+1]),v)&&(I=!0);I||P.push(v.x,v.y)},M=[ee[0],ee[1]];for(let v=0;v<z;v+=2){let P=new ae(ee[v],ee[v+1]);for(let I=v+2;I<z;I+=2){let N=new ae(ee[I],ee[I+1]);if(!qe(P,N)){L(N,M);break}}}z=M.length,M.forEach((v,P)=>ee[P]=v)}else for(let L=z-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(qe(new ae(ee[L],ee[L+1]),new ae(ee[M],ee[M+1]))){ee[M]=(ee[L]+ee[M])/2,ee[M+1]=(ee[L+1]+ee[M+1])/2;for(let v=z-3;v>=L;v--)ee[v]=ee[v+2];z-=2;break}}let q=0;if(z===4){let L=function(P){return qe(Y.getEnd(),P)||qe(Y.prevSide.getEnd(),P)||qe(G.prevSide.getEnd(),P)||qe(G.getEnd(),P)},M=new ae(ee[0],ee[1]),v=()=>{let P=new Ka(M,Y,c),I=new Ka(M,G,c);P.bind(I),P.setIsInvalid(),P.isDealed(),R.inters.push(P),B.inters.push(I)};if(ee[0]===ee[2]&&ee[1]===ee[3])if(L(M))q=2;else{v();return}}for(;q<z;q+=2){let L=new ae(ee[q],ee[q+1]),M=Y,v=G;if(qe(M.prevSide.getEnd(),L)&&(M=M.prevSide),v=d(v,L),Y!==M&&G!==v){let I=e===2||e===3?G.getEnd():v.getEnd();M.getEnd().distance1(L)<I.distance1(L)?(L=M.getEnd(),qe(I,L)||(v=G)):(L=I,qe(M.getEnd(),L)||(M=Y))}let P=u(M,v,L);if(P){let I=p(v,M,L);I&&(M.addInter(P),R.inters.push(P),v.addInter(I),B.inters.push(I),P.bind(I),R.intersect(B,h))}}return z},s);let _=O(),g=qB(o,l,e);g.forEach(y=>!y.startAndEndIsSameOutsideFlag()&&y.reverse()),new XB(_.concat(g)).getPolygons().forEach(y=>a.push(y));let b=new fi(a);if(c){if(sd===-1){let y=c.initColor(Ut.RED),x=c.initColor(Ut.Golden);a.forEach(E=>{y.addPly(E.items[0]),E.items.slice(1).forEach(w=>x.addPly(w))}),c.draw();debugger;throw new Error}b.id=sd}return pa.BooleanTools+=jo(n),b;function m(y,x,E){y.items.forEach(w=>{let S=[];S.push(n0.build(w.items[0],E,!0,c,w)),w.items.slice(1).forEach(C=>{S.push(n0.build(C,E,!1,c))}),x.push(S)})}function O(){let y=[];return h.forEach(E=>{e===2||e===3?E.forEach(S=>{S.isGroup1||S.reverse(),S.sides.forEach(C=>C.sortInters())}):E.forEach(S=>S.sides.forEach(C=>C.sortInters())),E.map(S=>S.sides.filter(C=>C.inters.length)).flat(2).sort((S,C)=>{let R=S.inters,B=C.inters,Y=qe(R[R.length-1].coord,S.getEnd()),G=qe(B[B.length-1].coord,C.getEnd());if(Y&&G){let z=0,q=0;for(let L=R.length-2;L>=0&&qe(R[L].coord,S.getEnd());L--)z++;for(let L=B.length-2;L>=0&&qe(B[L].coord,C.getEnd());L--)q++;return q-z}else return Y?-1:1}).forEach(S=>{S.inters.forEach(C=>{if(C.dealed)return;let R=C.side,B=C.getBindedInter().side,Y;qe(R.getEnd(),C.coord)&&qe(B.getEnd(),C.coord)?Y=-1:qe(R.getEnd(),C.coord)?(Y=1,C=C.getBindedInter()):qe(B.getEnd(),C.coord)&&(Y=1);let G=VB(Y,C,e,c);C.isDealed(),G&&(R.outline.setAllInterIsInvalidToFalse(),B.outline.setAllInterIsInvalidToFalse())})}),w(E),e===3&&(E.forEach(S=>{S.reverse(),S.sides.forEach(C=>{C.sortInters(),C.inters.forEach(R=>{R.resetVisitStatus()})})}),w(E));function w(S){S.forEach(C=>{C.inters.forEach(R=>{if(R.isInvalid||R.getVisited())return;let B=R.findStartInter(),Y=x(e)?B.run():B.getBindedInter().run(),G=C.polyline.primitives;if(Y){if(G.length===Y.primitives.length){let z=new Set(G);if(!Y.primitives.some(q=>!z.has(q))){y.push(C);return}}y.push(n0.build(Y,!0,!0,c))}})})}}),y;function x(E){switch(E){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var n_=/\bstablilizetion\b/.test(self.location.href)||!0,a_={intersect(e,t,i,r){try{return nd(0,e,t,i,r)}catch(s){if(n_){let n=new rd().getIntersection(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new fi(n.map(a=>new rr(a.items)))}throw s}},union(e,t,i,r){try{return nd(1,e,t,i,r)}catch(s){if(n_){let n=new rd,a=e.items.map(l=>l.items.map(h=>h)).flat(2);t.items.forEach(l=>l.items.forEach(h=>a.push(h)));let o=n.getUnion(a);return new fi(o.map(l=>new rr(l.items)))}throw s}},diff(e,t,i,r){try{return nd(2,e,t,i,r)}catch(s){if(n_){let n=new rd().getSubtraction(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new fi(n.map(a=>new rr(a.items)))}throw s}},xor(e,t,i,r){try{return nd(3,e,t,i,r)}catch(s){if(n_){let n=new rd().getMutuallyExclusive(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new fi(n.map(a=>new rr(a.items)))}throw s}}},ZB=class extends cd{constructor(e,t,i,r,s,n){super(e.rule,I_.DUMMY,t),this.sideGroup1=[],this.sideGroup2=[],this.group1=i,this.group2=r,this.seeker=s,this.addGroup(i,e.weight(0),this.sideGroup1),this.addGroup(r,e.weight(1),this.sideGroup2),this.bus=n}addGroup(e,t,i){if(!e)debugger;e.items.forEach(r=>{let s=[];r.items.forEach(n=>{let a=this.sides.length;this.addPolyline(n,t),s.push(this.sides.slice(a))}),i.push(s)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(e,t,i,r,s,n)=>{let a=this.sideGroup1[e][t][i],o=this.sideGroup2[r][s][n],l=dn(a.shape,o.shape);for(let h=0;h<l;h+=2){let c=new ae(ee[h],ee[h+1]);a.inters.push(c),o.inters.push(c),this.event.onIntersect(c,a,o)}return l},this.bus)}},KB=class extends hd{constructor(e){super(!!e),e&&(this.drawDebug=new Od(e),this.blueDrawing=this.drawDebug.initColor(Ut.BLUE),this.greenDrawing=this.drawDebug.initColor(Ut.GREEN),this.redDrawing=this.drawDebug.initColor(Ut.RED))}onOriginSide(e){super.onOriginSide(e),this.debug&&this.blueDrawing.addPt(e.shape)}onPolylineGroup(e,t){super.onPolylineGroup(e,t),this.debug&&e.items.forEach(i=>this.greenDrawing.addPly(i))}draw(){this.drawDebug.draw()}};function l0(e,t,i,r,s){let n=yd(),a=new KB(s);new ZB(e,a,t,i,r,s).simplify();let o=[];a.plGrps.forEach(h=>{let c=h.items.map(f=>E_(f));c[0]&&o.push(new rr(c.filter(f=>f)))});let l=new fi(o);return pa.BooleanTools+=jo(n),l}var h0=!0,$u={intersect(e,t,i,r){try{return a_.intersect(e,t,i,r)}catch(s){if(h0)throw s;return console.error(s),l0(d_,e,t,i,r)}},union(e,t,i,r){try{return a_.union(e,t,i,r)}catch(s){if(h0)throw s;return console.error(s),l0(mB,e,t,i,r)}},diff(e,t,i,r){try{return a_.diff(e,t,i,r)}catch(s){if(h0)throw s;return console.error(s),l0(u_,e,t,i,r)}},xor(e,t,i,r){return a_.xor(e,t,i,r)}},$B=class{init(e){}seek(e,t,i,r){let s=e.bbox().extendOfSize(5e-6).intersection1(t.bbox().extendOfSize(5e-6));if(!s)return;let n=yd(),a=[];for(let d=0,u=e.items.length;d<u;d++){let p=e.items[d];if(s.isIntersect(p.bbox()))for(let _=0,g=p.items.length;_<g;_++){let b=p.items[_];if(s.isIntersect(b.bbox()))for(let m=0,O=b.primitives.length;m<O;m++){let y=b.primitives[m].bbox();s.isIntersect(y)&&a.push({bbox:y,polygonIndex:d,polylineIndex:_,ptIndex:m})}}}let o=a.length;if(o===0){pa.IntersectionSeeker+=jo(n);return}let l=[];for(let d=0,u=t.items.length;d<u;d++){let p=t.items[d];if(s.isIntersect(p.bbox()))for(let _=0,g=p.items.length;_<g;_++){let b=p.items[_];if(s.isIntersect(b.bbox()))for(let m=0,O=b.primitives.length;m<O;m++){let y=b.primitives[m].bbox();s.isIntersect(y)&&l.push({bbox:y,polygonIndex:d,polylineIndex:_,ptIndex:m})}}}let h=l.length;if(h===0){pa.IntersectionSeeker+=jo(n);return}if(o<5||h<5){for(let d=0,u=a.length;d<u;d++)for(let p=0,_=l.length;p<_;p++)if(a[d].bbox.isIntersect(l[p].bbox.extendOfSize(1e-5))){let g=a[d],b=l[p];i(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}pa.IntersectionSeeker+=jo(n);return}a.sort((d,u)=>d.bbox.minX-u.bbox.minX),l.sort((d,u)=>d.bbox.minX-u.bbox.minX);let c=0,f=0;for(;c<o&&f<h;)if(a[c].bbox.minX<l[f].bbox.minX){let d=a[c],u=d.bbox;for(let p=f;p<h;p++){let _=l[p],g=_.bbox;if(g.minX>u.maxX+1e-5)break;(u.minY<g.minY?g.minY:u.minY)<(u.maxY<g.maxY?u.maxY:g.maxY)+1e-5&&i(d.polygonIndex,d.polylineIndex,d.ptIndex,_.polygonIndex,_.polylineIndex,_.ptIndex)}c++}else{let d=l[f],u=d.bbox;for(let p=c;p<o;p++){let _=a[p],g=_.bbox;if(g.minX>u.maxX+1e-5)break;(g.minY<u.minY?u.minY:g.minY)<(g.maxY<u.maxY?g.maxY:u.maxY)+1e-5&&i(_.polygonIndex,_.polylineIndex,_.ptIndex,d.polygonIndex,d.polylineIndex,d.ptIndex)}f++}pa.IntersectionSeeker+=jo(n)}},rc=class Wa{static getDebug(){return Wa.drawDebug||(Wa.drawDebug=new Od(Wa.curBus)),Wa.drawDebug}static getDrawing(t=Ut.GREEN){return this.getDebug().initColor(t)}static clearDrawing(){Wa.getDebug().clear()}static drawText(t,i,r=Ut.GREEN){Wa.getDrawing(r).addText(t,i,1.5,.1,!0)}static drawBBox(t,i=Ut.GREEN){if(!t)return;let r=Wa.getDrawing(i),s=new le(t.UL(),t.UR()),n=new le(t.UR(),t.LR()),a=new le(t.LR(),t.LL()),o=new le(t.LL(),t.UL());r.addPt(s),r.addPt(n),r.addPt(a),r.addPt(o)}static drawPolyType(t,i){let r=Wa.getDrawing(i);if(t instanceof mt)r.addPly(t);else if(t instanceof rr)for(let s of t.items)s instanceof mt?r.addPly(s):this.drawPolyType(s,i);else if(t instanceof fi)for(let s of t.items)this.drawPolyType(s,i)}static translate(t){switch(t){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}};rc.UseOptimizeSplit=!0,rc.LocalBestThread=4,rc.HandleDiff=!0,rc.OcTreeSplitStep=4,rc.PrintStart=new ae(150,-200);var rs=rc,Qu=class S0{static getPolyTypeLine(t){let i=[];if(t instanceof mt)for(let r of t.primitives)i.push(r);else if(t instanceof rr)for(let r of t.items)if(r instanceof mt)for(let s of r.primitives)i.push(s);else{let s=this.getPolyTypeLine(r);for(let n of s)i.push(n)}else if(t instanceof fi)for(let r of t.items){let s=this.getPolyTypeLine(r);for(let n of s)i.push(n)}return i}static getPolyTypePolyLine(t){let i=[];if(t instanceof mt)i.push(t);else if(t instanceof rr)for(let r of t.items)if(r instanceof mt)i.push(r);else{let s=this.getPolyTypePolyLine(r);for(let n of s)i.push(n)}else if(t instanceof fi)for(let r of t.items){let s=this.getPolyTypePolyLine(r);for(let n of s)i.push(n)}return i}static getListBBox(t){if(t.length<=0)return;let i=new vi;for(let r of t){let s=S0.getSingleBBox(r);i.ext1(s)}return i.build1()}static getSingleBBox(t){if(t instanceof Array){let i=new vi,r=S0.getListBBox(t.slice(1));return i.ext1(r),i.build1()}else return t.bbox()}static doDrawRule(t,i=rs.PrintStart){if(t.length<2)return[i,i,i];let r=5,s=10,n=t[0],a=rs.translate(n),o=[],l=i.y,h=i.x,c=i.x;i=i.add(new ae(0,-s));for(let u=1;u<t.length;u++){let p=t[u];if(p instanceof Array){i=i.add(new ae(r,0));let _=this.doDrawRule(p,i);o.push(_[0]),_[1].x<=h&&(h=_[1].x),_[2].x>=c&&(c=_[2].x),i=new ae(_[2].x+r,i.y)}else o.push(i.clone()),i.x<=h&&(h=i.x),i.x>=c&&(c=i.x),rs.drawText(i,p.name),i=i.add(new ae(r,0))}let f=0;for(let u of o)f+=u.x;let d=new ae(f/o.length,i.y+s);rs.drawText(d,"N:"+a);for(let u of o){let p=new le(u,d),_=new Array;_.push(p);let g=mt.build1(_0(_));rs.drawPolyType(g,Ut.GREEN)}return[d,new ae(h,l),new ae(c,l)]}static drawRule(t,i=rs.PrintStart,r=!1,s){rs.clearDrawing(),this.doDrawRule(t,i),r&&this.doDrawRulePolygon(t,s),rs.getDebug().draw()}static doDrawRulePolygon(t,i){let r=t[0];for(let s=1;s<t.length;s++){let n=t[s];if(n instanceof Array)this.doDrawRulePolygon(n,i);else{let a=i;r===2&&s===1&&(a=Ut.RED),n.name&&rs.drawText(n.bbox().UL(),n.name,a),rs.drawPolyType(n,a)}}}static IsCenterBBoxPointInPolygonType(t,i){let r=t.center();for(let s of i.items)if(s.getOutMostPolyline().getWindingNum(r))return!0;return!1}static KeepBBoxPolygonGroup(t,i){let r=i.bbox().intersection1(t);if(!r)return!1;for(let s of i.items)if(s.bbox().isIntersect(r)){for(let n of s.items)if(n.bbox().isIntersect(r)){for(let a of n.primitives)if(r.isIntersect(a.bbox()))return!0}}return!!this.IsCenterBBoxPointInPolygonType(t,i)}},QB=class sc{static createNode(t,i,r){let s=t.UL(),n=t.width()/i,a=t.height()/i,o=~~(r/i),l=r-o*i,h=s.x+l*n,c=s.y-(o+1)*a,f=h+n,d=c+a;return new Ni(h,f,c,d)}static ocTreeSplitNode(t,i,r,s,n=2){if(t.length<=r)return t;let a=[],o=n**2,l=new Array(o),h=new Array(o);for(let u=0;u<o;u++)l[u]=new Array(t.length),h[u]=0;let c=i.UL(),f=i.width()/n,d=i.height()/n;for(let u of t){let p=s(u).center(),_=~~((p.x-c.x)/f),g=~~((c.y-p.y)/d)*n+_;try{l[g][h[g]]=u,h[g]+=1}catch{a.push(u)}}for(let u=0;u<l.length;u++){let p=h[u];if(p<=0)continue;let _=l[u].slice(0,p);if(_.length===t.length)return t;let g=sc.createNode(i,n,u),b=sc.ocTreeSplitNode(_,g,r,s,n);if(b.length===t.length)return t;a.push(b)}return a}static ocTreeSplitNodeMinIntersect(t,i,r,s){let n=[];if(t.length<=r)return t;let a=3,o=i.LL(),l=i.UR(),h=i.width()/(a+1),c=i.height()/(a+1),f=-(2**32),d=[],u=[];for(let p=1;p<=a;p++)for(let _=1;_<=a;_++){let g=o.x+h*p,b=o.y+c*_,m=[[],[],[],[]],O=new Array(4),y=new Array(4);y[0]=new Ni(o.x,g,b,l.y),y[1]=new Ni(g,l.x,b,l.y),y[2]=new Ni(o.x,g,o.y,b),y[3]=new Ni(g,l.x,o.y,b);for(let S of t){let C=s(S).center(),R=-1,B=-1;C.x===g?R=Math.random()>=.5?1:-1:C.x>g?R=1:C.x<g&&(R=-1),C.y===b?B=Math.random()>=.5?1:-1:C.y>b?B=1:C.y<b&&(B=-1),R===1&&B===1?m[1].push(S):R===1&&B===-1?m[3].push(S):R===-1&&B===-1?m[2].push(S):R===-1&&B===1&&m[0].push(S)}for(let S=0;S<4;S++){let C=m[S];if(C.length<=0)continue;let R=new vi;for(let B of C)R.ext1(s(B));O[S]=R.build1()}let x=0,E=0;for(let S of O)S&&(x+=S.area());E=x;let w=(S,C)=>{if(!O[S]||!O[C])return 0;let R=O[S].intersection1(O[C]);return R?R.area():0};E-=w(0,1),E-=w(0,2),E-=w(0,3),E-=w(1,2),E-=w(1,3),E-=w(2,3),E/x>=f&&(d=m,u=y)}for(let p=0;p<d.length;p++){let _=d[p];if(_.length<=0)continue;let g=u[p],b;if(_.length===t.length?b=sc.ocTreeSplitNode(_,g,r,s):b=sc.ocTreeSplitNodeMinIntersect(_,g,r,s),b.length===t.length)return t;n.push(b)}return n}static ocTreeSplit(t,i,r,s){return sc.ocTreeSplitNode(t,i,r,s,rs.OcTreeSplitStep)}},ek=class wT{static OcTreeOptimizeSplit(t){let i=t[0];if(i!==1||t.length<=rs.LocalBestThread+1)return t;let r=t.slice(1),s=new Array(r.length);for(let h=1;h<t.length;h++)s[h-1]=h;let n=Qu.getListBBox(r),a=QB.ocTreeSplit(s,n,rs.LocalBestThread,h=>{let c=t[h];return Qu.getSingleBBox(c)}),o=(h,c)=>{if(!(h.length<=0))for(let f of h)if(Array.isArray(f)){let d=[c[0]];o(f,d),c.push(d)}else{let d=t[f];c.push(d)}},l=[i];return o(a,l),l}static optimizeSplit(t,i){let r=t[0];if(r===2){if(rs.HandleDiff){let n=t[1],a;if(Array.isArray(n)){let o=this.optimizeSplit(n,i);if(o.length<=1)return[2];a=w_(o,i)}else a=w_([2,n],i);if(t.length>3){let o;o=[1];for(let l=2;l<t.length;l++){let h=t[l];if(Array.isArray(h)){let c=Qu.getListBBox([...h.slice(1)]);Qu.KeepBBoxPolygonGroup(c,a)&&o.push(h)}else Qu.KeepBBoxPolygonGroup(h.bbox(),a)&&o.push(h)}return o.length<=1?[2,a]:(o=this.optimizeSplit(o,i),o.length>1?[2,a,...o.slice(1)]:[2,a])}else{let o=t[2];if(Array.isArray(o)&&o[0]===1&&o.length>2){let l=o.slice(1);return this.optimizeSplit([2,a,...l],i)}}}else if(t.slice(1).length>2){let n=t[1],a=t.slice(2),o=this.optimizeSplit([1,...a],i);return o.length>1?[2,n,...o.slice(1)]:n}}else if(r===1){if(t.length-1>rs.LocalBestThread){let n=!1;for(let a=1;a<t.length;a++){let o=t[a];if(!Array.isArray(o)){n=!0;break}}n&&(t=wT.OcTreeOptimizeSplit(t))}}else if(r===0&&t.length<=2)return[0];let s=[r];for(let n=1;n<t.length;n++){let a=t[n];if(Array.isArray(a)){let o=this.optimizeSplit(a,i);if(o.length<=1)continue;s.push(o)}else s.push(a)}return s}},tk=(e=>(e[e.INTERSECT=0]="INTERSECT",e[e.UNION=1]="UNION",e[e.DIFF=2]="DIFF",e[e.XOR=3]="XOR",e))(tk||{});function ad(e){let t=e[0],i=[t];switch(t){case 0:for(let s=1;s<e.length;s++){let n=e[s];if(Array.isArray(n)&&(n=ad(n),!n))return null;i.push(n)}break;case 1:case 3:for(let s=1;s<e.length;s++){let n=e[s];Array.isArray(n)&&(n=ad(n),!n)||i.push(n)}break;case 2:let r=e[1];if(Array.isArray(r)&&(r=ad(r)),!r)return null;i.push(r);for(let s=2;s<e.length;s++){let n=e[s];Array.isArray(n)&&(n=ad(n),!n)||i.push(n)}break;default:throw new Error("not support boolean rule!")}return i.length===1?null:i.length===2?i[1]:i}function c0(e,t,i){return Array.isArray(e)?ST(e,t,i):e}function u0(e,t,i,r,s=!0){if(s)for(;e.length>1;){let n,a=[];for(e.length%2===1?(a.push(e[0]),n=1):n=0;n<e.length;n+=2)a.push(t(e[n],e[n+1],i,r));e=a}else for(;e.length>1;){if(e.length===2)return t(e[0],e[1],i,r);e=[t(e[0],e[1],i,r),...e.slice(2)]}return e[0]}function ST(e,t,i,r=!0){let s=new Array(e.length-1);for(let n=1;n<e.length;n++)s[n-1]=c0(e[n],t,i);switch(e[0]){case 0:return u0(s,$u.intersect,t,i);case 1:return u0(s,$u.union,t,i);case 2:let n=u0(s.slice(1),$u.union,t,i);return n?$u.diff(s[0],n,t,i):s[0];case 3:let a=c0(e[1],t,i);for(let o=2;o<e.length;o++)a=$u.xor(a,c0(e[o],t,i),t,i);return a;default:throw new Error("not support boolean rule! "+e[0])}}function IT(e){let t=[e[0]];for(let i=1;i<e.length;i++){let r=e[i];if(Array.isArray(r)){let s=IT(r);Array.isArray(s)?s.length>1&&t.push(s):t.push(s)}else{let s=E_(r);s!==null&&t.push(fi.build(s))}}return t}function ik(e){let t=[];for(let i=0;i<e.length;i+=2){let r=e[i],s=e[i+1];s?t.push({xor:Ho([3,r,s]),union:Ho([1,r,s])}):t.push({xor:r,union:r})}for(;t.length!==1;){for(let i=0;i<t.length;i+=2){let r=t[i],s=t[i+1],n=i/2;if(!s){t[n]=r;break}let a=Ho([2,r.xor,s.union]),o=Ho([2,s.xor,r.union]),l=[];a.items.forEach(h=>l.push(h)),o.items.forEach(h=>l.push(h)),t[n]={xor:new fi(l),union:Ho([1,r.union,s.union])}}t.length=Math.ceil(t.length/2)}return t[0].xor}function I0(e){let t=e[0];if(t===3&&e.length>3){let r=[];for(let s=1;s<e.length;s++){let n=e[s];if(n instanceof fi)r.push(n);else{let a=I0(n);a instanceof fi?r.push(a):r.push(Ho(a))}}return ik(r)}let i=[t];for(let r=1;r<e.length;r++){let s=e[r];s instanceof fi?i.push(s):i.push(I0(s))}return Ho(i)}function Ho(e,t){if(!rs.UseOptimizeSplit)return w_(e,t);let i=ek.optimizeSplit(e,t);return i.length<=1?new fi([]):w_(i,t)}function rk(e,t){rs.curBus=t;let i=IT(e),r=ad(i);if(!(r instanceof Array))return r||new fi([]);let s=I0(r);return s instanceof fi?s:Ho(s)}function w_(e,t,i=!0){if(!e||e.length===1)return new fi([]);let r=e,s=new $B,n=[];function a(o){for(let l=1;l<o.length;l++){let h=o[l];Array.isArray(h)?a(h):n.push(h)}}return a(r),s.init(n),ST(r,s,t,i)}var o_=new Error("list is empty"),l_=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},sk=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},nk=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},ak=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw o_;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw o_;return this.remove(e),e.item}addLast(e){if(this.first===null||this.last===null){let t=new l_(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new l_(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw o_;return this.first.item}getLast(){if(this.last===null)throw o_;return this.last.item}insertAfter(e,t){let i=new l_(this,t);return e.insertAfter(i),e===this.last&&(this.last=i),this.cnt++,i}insertBefore(e,t){let i=new l_(this,t);return e.insertBefore(i),e===this.first&&(this.first=i),this.cnt++,i}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new sk(this.first)}listIterator(){return new nk(this.first)}toArray(){let e=new Array,t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e}},p_=class{constructor(e){this.inters=[],e&&(this.inters=e)}addInter(e){this.inters.push(e),e.group=this}findInter(e){let t=this.inters.find(i=>qe(i.coord,e.coord));return t&&this.inters.find(i=>i.side===e.side)&&e.visitSelf(),t}getOutInter(e){let t=this.inters.filter(i=>!i.getVisited());if(t.length!==0)return t.length===1?t[0]:t.reduce((i,r)=>{if(!i||i.side.getShape()===e)return r;if(r.side.getShape()===e)return i;let s=i.coord,n=tt(e,s),a=tt(i.side.getShape(),s),o=tt(r.side.getShape(),s);return n.dot(a)>n.dot(o)?i:r},void 0)}getEntryInter(){}},d0=0;function PT(e,t){let i=e.primitives[0];if(e.primitives.length===1&&i instanceof Oe&&Math.abs(i.sweepAngle)===360)return[e];let r=yd();d0++;let s,n=_k(e);if(n.length===0)return[];let a=hk(n);if(d0===-1){s=new Od(t);let c=s.initColor(Ut.BLUE);n.forEach(d=>c.addPt(d.getShape()));let f=s.initColor(Ut.GREEN);a.forEach(d=>f.addPoint(d.coord)),s.draw();debugger;throw new Error}if(a.length===0)return[mt.build7(n.map(c=>c.getShape()))];ck(a);let o=[],l=!1;try{fk(a,s)}catch(c){c.customType==="IS_OVERLAP"?(l=!0,o=new rd().getUnion([e]).map(f=>f.items).flat(2)):console.error(c)}if(l)return o;let h=dk(a);if(!h.length)return[mt.build7(n.map(c=>c.getShape()))];if(o=ok(h,s),o.length===0)return console.warn("=====deSelfIntersection=====",d0),[];if(s)throw o.forEach(c=>{s.initColor(Ut.WHITE).addPly(c),s.draw();debugger}),new Error;return pa.deSelfIntersection+=jo(r),o}function ok(e,t){let i=[];return e.forEach(r=>{let s=r;r.inters.forEach(n=>{if(n.getVisited())return;let a=[],o=[],l;if(t){debugger;let c=t.initColor(Ut.RED);l=f=>{a.push(f),c.addPt(a[a.length-1]),t.draw();debugger}}else l=c=>a.push(c);do{let c=function(_,g){me.eq(_.distance2(g),0)||l(AT(u.getShape(),_,g))},f=o.findIndex(_=>_===n.group);if(f!==-1){let _=a.findIndex(m=>m===n.group),g=a.splice(_).filter(m=>!(m instanceof p_));if(g.length){let m=Vo(mt.build7(g));m&&i.push(m)}let b=a.filter(m=>!(m instanceof p_));if(n=o[f].getOutInter(b[b.length-1]),o.splice(f),!n)throw Error("interGroup not hav inter!!!2");continue}n.visitSelf(),o.push(n.group),a.push(n.group);let d=n.getIndex(),u=n.side,p=u.inters[d+1];for(;p!=null&&p.isInvalid||p&&p.group===n.group;)p=u.inters[p.getIndex()+1];if(p){c(n.coord,p.coord);let _=p.getBindedInter();if(n=_.getVisited()?_.group.getOutInter(_.side.getShape()):_,!n){if(p.group===s)break;throw new Error("interGroup not hav inter!!!3")}}else{for(c(n.coord,u.getEnd()),u=u.nextSide,n=null;;){for(let _ of u.inters)if(!_.isInvalid){let g=_.group.getOutInter(u.getShape());if(!g){if(_.group===s){n=_;break}else if(_.getBindedInter().group===s){n=_.getBindedInter();break}continue}n=g;break}if(n)break;l(u.getShape()),u=u.nextSide}me.eq(u.getEnd().distance2(n.coord),0)?l(u.getShape()):c(u.getStart(),n.coord)}}while(n.group!==s);let h=Vo(mt.build7(a.filter(c=>!(c instanceof p_))));h&&i.push(h)})}),i}function lk(e){return{next(){return e.hasNext()?{value:e.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function hk(e){let t=[],i=new ak;for(let r of e.slice().sort((s,n)=>s.bbox().minY-n.bbox().minY)){for(let s of lk(i.listIterator())){let n=s.item;if(n.bbox().maxY<r.bbox().minY)i.remove(s);else{let a=function(d,u){let p=new Ka(u,d,null);return d.inters.push(p),t.push(p),p},o=function(d,u){let p=d.getEnd(),_=new ae(ee[0],ee[1]),g=new ae(ee[2],ee[3]),b=p.distance2(_)>p.distance2(g)?_:g,m=d.prevSide;a(qe(m.getEnd(),b)?m:d,b).bind(a(u,b))},l=n.getShape(),h=r.getShape(),c=dn(l,h),f=c===4&&ee[0]===ee[2]&&ee[1]===ee[3];if(f&&(c-=2),n.nextSide===r)n.prevSide!==r&&c===4&&o(n,r);else if(n.prevSide===r)c===4&&o(r,n);else if(c!==0){let d=function(p,_){let g=p.prevSide;return a(qe(g.getEnd(),_)?g:p,_)},u=new ae(ee[0],ee[1]);if(f&&!qe(u,n.prevSide.getEnd())&&!qe(u,r.prevSide.getEnd())&&tt(l,u).dot(tt(h,u))>0)continue;for(let p=0;p<c;p+=2){let _=new ae(ee[p],ee[p+1]);d(n,_).bind(d(r,_))}}}}i.add(r)}return t.forEach(r=>{r.getIndex()===void 0&&r.side.sortInters()}),t}function ck(e){e.forEach(t=>{let i=t.side.getEnd();if(t.isInvalid||!qe(t.coord,i))return;let r=t.side.inters,s=t.getBindedInter().side;for(let n=r.length-1;n>=0;n--){let a=r[n];if(!qe(a.coord,i))break;a!==t&&a.getBindedInter().side===s&&a.setIsInvalid()}})}function uk(e){let t=new dd(10);return e.forEach(i=>{i.isInvalid||t.add(i)}),t}function dk(e){let t=[],i=uk(e);return e.forEach(r=>{if(r.isInvalid||r.group)return;let s=i.search(r.bbox().extendOfSize(me.eps)).filter(n=>!n.group);if(s.length){let n=new Set,a=new p_(s);s.forEach(o=>{o.group=a,n.has(o.side)&&o.visitSelf(),n.add(o.side)}),t.push(a)}}),t}function fk(e,t){e.forEach(i=>{if(i.isInvalid||i.dealed)return;let r=i.side,s=i.getBindedInter().side,n;qe(r.getEnd(),i.coord)&&qe(s.getEnd(),i.coord)?n=-1:qe(r.getEnd(),i.coord)?r.nextSide!==s&&(n=1,i=i.getBindedInter()):qe(s.getEnd(),i.coord)&&s.nextSide!==r&&(n=1),pk(n,i,t),i.isDealed()})}function pk(e,t,i){let r=t.getBindedInter(),s=t.side,n=r.side,a=s.getShape(),o=n.getShape(),l=1,h=!1;if(e===-1){if($h(a.reverse(),o.reverse())||$h(s.nextSide.getShape(),n.nextSide.getShape())){let f=Ja(s,s.nextSide,n,r,l,h,i);if(f.state===2){let u=new Error("info1.state === InState.IS_OVERLAP");throw u.customType="IS_OVERLAP",u}let d=Ja(s,s.nextSide,n.nextSide,r,l,h,i);f.state===d.state&&c(f,d)}else if(!($h(a.reverse(),n.nextSide.getShape())||$h(s.nextSide.getShape(),o.reverse()))){let f=r0(s,s.nextSide,n,!1,i);f===r0(s,s.nextSide,n.nextSide,!0,i)&&f!==r0(n,n.nextSide,s.nextSide,!0,i)&&t.setIsInvalid()}}else if(e===1){let f=function(d,u){return tt(d,u.start()).dot(tt(u,u.start()))>0};if($h(a.reverse(),o.reverse())||$h(a,n.nextSide.getShape())){let d=Js(s,n,r,i,l,h,new Map);if(d.state===2){let p=new Error("info1.state === InState.IS_OVERLAP");throw p.customType="IS_OVERLAP",p}let u=Js(s,n.nextSide,r,i,l,h,new Map);d.state===u.state&&c(d,u)}else if(f(a.reverse(),o.reverse())&&f(a,n.nextSide.getShape())){let d=br(s,n,!1,i);d===br(s,n.nextSide,!0,i)&&d!==Vl(n,n.nextSide,new md(AT(a,t.coord,a.end()),i),!0,i)&&t.setIsInvalid()}}function c(f,d){f.inter.setIsInvalid(),d.inter.setIsInvalid(),t.setIsInvalid()}}function AT(e,t,i){if(e instanceof le||t.distance2(i)<1e-6)return new le(t,i);if(e instanceof Oe)return Oe.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.sweep());if(e instanceof ke){let r=e.getPercent(t,it),s=e.getPercent(i,it);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}function _k(e){let t=Vo(e);if(!t)return[];let i=t.primitives.map(s=>new md(s,null)),r=i[i.length-1];return i.forEach(s=>{r.connect(s),r=s}),i}var od=class{static clearData(e){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new Od(e):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let e=this.drawDebug.initColor(Ut.WHITE);this.originalPrimitive.forEach(t=>e.addPt(t)),this.drawDebug.draw();debugger}for(let e=0;e<this.originalPrimitive.length;e+=1){let t=this.originalPrimitive[e];this.offsetPrimitive.push({index:e,offsetEdge:this.createOffsetEdge(t)})}if(this.drawDebug){let e=this.drawDebug.initColor(Ut.Golden);this.offsetPrimitive.forEach(t=>e.addPt(t.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let e=0;e<this.offsetPrimitive.length;e+=1)if(e===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[e],this.offsetPrimitive[0]);let t=this.rawOffsetPrimitive[0],i;t instanceof Oe?i=Oe.build4(this.offsetPrimitive[0].offsetEdge.start(),t.end(),t.center,t.rx,t.ry,t.sweep()):i=new le(this.offsetPrimitive[0].offsetEdge.start(),t.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(i)}else this.connectPrimitive(this.offsetPrimitive[e],this.offsetPrimitive[e+1]);else this.rawOffsetPrimitive=[]}static createCirclePrimitive(e,t){let i=e.width()*.5,r=e.height()*.5,s=Math.sqrt(i**2+r**2)+t;return[Oe.buildCircle(e.center(),s)]}static getExtendPolyLine(e,t,i=!0,r){var s,n;if(!((s=e==null?void 0:e.primitives)!=null&&s.length))return[];this.isExpansion=t>0;let a=Vo(e);if(!((n=a==null?void 0:a.primitives)!=null&&n.length)){if(this.isExpansion){let l=[1],h=t*2;e.primitives.forEach(f=>l.push(f.stroke(h,1,0)));let c=rk(l,r);if(c.items.length!==1)throw new Error("group.items.length !== 1 ");return[c.items[0].items[0]]}return[]}if(e=a,this.clearData(r),this.originalPrimitive=e.primitives,this.offsetDistance=t,this.createRawOffsetEdge(),this.drawDebug){let l=this.drawDebug.initColor(Ut.BLUE);this.rawOffsetPrimitive.forEach(h=>l.addPt(h)),this.drawDebug.draw();debugger}let o=i?this.createClippingEdge(r):[mt.build2(this.rawOffsetPrimitive)];if(this.drawDebug){let l=this.drawDebug.initColor(Ut.RED);o.forEach(h=>l.addPly(h)),this.drawDebug.draw();debugger}if(o.length&&(!this.isExpansion||this.isExpansion&&o.length>1)&&(o=this.getValidityPrimitive(o)),this.drawDebug){let l=this.drawDebug.initColor(Ut.GREEN);o.forEach(h=>l.addPly(h)),this.drawDebug.draw();debugger;throw new Error}return o}static getValidityPrimitive(e){let t=[],i=Math.abs(this.offsetDistance);for(let r=0;r<e.length;r+=1){let s=!0,n=e[r].primitives;e:for(let a=0;a<n.length;a+=1){let o=n[a],l;if(o instanceof Oe)l=o.midPoint;else if(o instanceof le)l=o.start();else throw new Error("not support!");for(let h=0;h<this.originalPrimitive.length;h+=1){let c=this.originalPrimitive[h],f;if(c instanceof Oe?f=this.pointArcClosest(l,c):f=eB(l,c.start(),c.end()).d,i-f>.01){s=!1;break e}}}s&&t.push(e[r])}return t}static getInters(e){let t=[];for(let i=0;i<e;i+=2)t.push(new ae(ee[i],ee[i+1]));return t}static pointArcClosest(e,t){let i=t.center;if(e.equals1(t.center))return t.rx;if(t.inArea(e,0)){let n=e.sub(i);return Math.abs(n.length()-t.rx)}let r=e.distance2(t.start()),s=e.distance2(t.end());return me.less(r,s)?Math.sqrt(r):Math.sqrt(s)}static createClippingEdge(e){let t=[],i=[],r=PT(mt.build2(this.rawOffsetPrimitive),e);r.forEach(n=>{let a=n.area(.01);t.push(a)});let s=Math.min(...t.filter(n=>n<0));for(let n=0;n<t.length;n+=1){let a=t[n];me.eq(a,0)||(!this.isExpansion&&a<0||this.isExpansion&&(a<0&&t[n]===s||a>0))&&i.push(r[n])}return i}static createOffsetEdge(e){if(e instanceof Oe)return e.panDistance2(this.offsetDistance);if(e instanceof le)return e.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(e,t){e.offsetEdge instanceof le&&t.offsetEdge instanceof le?this.lineToLineConnect(e,t):e.offsetEdge instanceof Oe&&t.offsetEdge instanceof Oe?this.arcToArcConnect(e,t):e.offsetEdge instanceof le&&t.offsetEdge instanceof Oe?this.lineToArcConnect(e,t):this.arcToLineConnect(e,t)}static isFalseIntersection(e){return e>1||e<0}static lineToLineConnect(e,t){let i=e.offsetEdge,r=t.offsetEdge,s=e.index,n=t.index,a=this.originalPrimitive[n].start();if(i.isParallel(r))i.bbox().intersection1(r.bbox())?this.rawOffsetPrimitive.push(i):this.lineToLineUseArcToConnect(a,i,r,s);else{let o=this.getLineToLineT(i,r),l=o[0],h=o[1];if(this.isFalseIntersection(l)||this.isFalseIntersection(h))l>1&&this.isFalseIntersection(h)?this.lineToLineUseArcToConnect(a,i,r,s):this.useLineToConnect(i,r);else if(!this.isFalseIntersection(l)&&!this.isFalseIntersection(h)){let c=i.end().sub(i.start()),f=i.start().add(c.mul(l)),d=new le(i.start(),f);this.rawOffsetPrimitive.push(d);let u=new le(f,r.end());this.updateNextOffsetPrimitive(n,u)}}}static updateNextOffsetPrimitive(e,t){this.offsetPrimitive[e].offsetEdge=t}static useLineToConnect(e,t){this.rawOffsetPrimitive.push(e);let i=new le(e.end(),t.start());this.rawOffsetPrimitive.push(i)}static lineToLineUseArcToConnect(e,t,i,r){let s=this.getSweep(e,t,r),n=this.getSweepAngel(t.end(),i.start(),e,s);if(n===0){this.useLineToConnect(t,i);return}this.rawOffsetPrimitive.push(t);let a=Oe.build5(t.end(),i.start(),n);this.rawOffsetPrimitive.push(a)}static getSweep(e,t,i){let r=null,s=i||i===0?this.originalPrimitive[i]:t;if(s instanceof Oe){let n=s.center.sub(s.end()).normalize();s.isCCW?r=new ae(n.y,-n.x):r=new ae(-n.y,n.x)}else r=t.end().sub(t.start()).normalize();return e.sub(t.end()).normalize().cross(r)>0?0:1}static getLineToLineT(e,t){let i=e.end().sub(e.start()),r=t.end().sub(t.start()),s=i.cross(r),n=t.start().sub(e.start()),a=e.start().sub(t.start()),o=n.cross(r)/s,l=a.cross(i)/-s;return[o,l]}static lineToArcConnect(e,t){let i=e.offsetEdge,r=t.offsetEdge,s=e.index,n=t.index,a=this.getLineJoinArcScalarAndIntersectionNum(i,r),o=this.originalPrimitive[n].start();if(a.intersectionNum===0)this.lineAndArcUseArcConnect(o,i,r,s);else if(a.intersectionNum===1){let l=a.points[0];this.lineAndArcConnectionDetail(i,r,a.t[0],l,o,s,n)}else if(a.intersectionNum===2){let l=a.points[0],h=a.points[1],c=l.distance2(o),f=h.distance2(o);this.lineAndArcConnectionDetail(i,r,c<f?a.t[0]:a.t[1],c<f?l:h,o,s,n)}}static lineAndArcConnectionDetail(e,t,i,r,s,n,a){let o=this.isTrueArcIntersection(t,r);if(!this.isFalseIntersection(i)&&o){let l=new le(e.start(),r);this.rawOffsetPrimitive.push(l);let h;!t.center.equals1(r)||t.sweepAngle>1e-4?(h=Oe.build4(r,t.end(),t.center,t.rx,t.ry,t.sweep()),h instanceof Oe&&h.sweepAngle===0&&(h=new le(h.start(),h.end()))):h=new le(t.center,r),this.updateNextOffsetPrimitive(a,h)}else o?this.useLineToConnect(e,t):this.lineAndArcUseArcConnect(s,e,t,n)}static lineAndArcUseArcConnect(e,t,i,r){let s=this.getSweep(e,t,r),n=this.getSweepAngel(t.end(),i.start(),e,s);if(n===0){this.useLineToConnect(t,i);return}let a=Oe.build5(t.end(),i.start(),n);this.rawOffsetPrimitive.push(t),this.rawOffsetPrimitive.push(a)}static arcToLineConnectionDetail(e,t,i,r,s,n,a){let o=this.isTrueArcIntersection(e,r);if(!this.isFalseIntersection(i)&&o){let l;e.center.equals1(r)?l=new le(e.center,r):Math.abs(e.sweepAngle)<1e-4?l=new le(e.start(),r):(l=Oe.build4(e.start(),r,e.center,e.rx,e.ry,e.sweep()),l instanceof Oe&&l.sweepAngle===0&&(l=new le(l.start(),l.end()))),this.rawOffsetPrimitive.push(l);let h=new le(r,t.end());this.updateNextOffsetPrimitive(a,h)}else o?this.useLineToConnect(e,t):this.lineAndArcUseArcConnect(s,e,t,n)}static isTrueArcIntersection(e,t){return zi(e,t)}static getSweepAngel(e,t,i,r){let s=e.angleD(i),n=t.angleD(i),a;return s===n?a=0:(s=lt.regularD(s),n=lt.regularD(n),r===1?n<=s&&(n+=360):n>=s&&(s+=360),a=n-s),a}static getLineJoinArcScalarAndIntersectionNum(e,t){let i={t:[],intersectionNum:0,points:[]},r=K6(t,e);if(r){i.intersectionNum=r/2;for(let s=0;s<r-1;s+=2){let n=new ae(ee[s],ee[s+1]);i.points.push(n),n.sub(e.start()).x<1e-4||n.sub(e.start()).y<1e-4?i.t.push(0):i.t.push(n.sub(e.start()).x/e.end().sub(e.start()).x)}}else i.intersectionNum=0;return i}static arcToLineConnect(e,t){let i=e.offsetEdge,r=t.offsetEdge,s=e.index,n=t.index,a=this.getLineJoinArcScalarAndIntersectionNum(r,i),o=this.originalPrimitive[n].start();if(a.intersectionNum===0)this.lineAndArcUseArcConnect(o,i,r,s);else if(a.intersectionNum===1){let l=a.points[0];this.arcToLineConnectionDetail(i,r,a.t[0],l,o,s,n)}else if(a.intersectionNum===2){let l=a.points[0],h=a.points[1],c=l.distance2(o),f=h.distance2(o);this.arcToLineConnectionDetail(i,r,c<f?a.t[0]:a.t[1],c<f?l:h,o,s,n)}}static rxChangeStatus(e){return e===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(e,t){let i=e.offsetEdge,r=t.offsetEdge,s=aT(i,r);if(s){let n=this.getInters(s),a;if(n.length===2){let h=this.originalPrimitive[t.index].start(),c=n[0],f=n[1],d=c.distance2(h),u=f.distance2(h);d<u?a=c:a=f}else a=n[0];let o,l;a.equals1(i.center)?o=new le(i.center,a):Math.abs(i.sweepAngle)<1e-4?o=new le(i.start(),a):(o=Oe.build4(i.start(),a,i.center,i.rx,i.ry,i.sweep()),o instanceof Oe&&o.sweepAngle===0&&(o=new le(o.start(),o.end()))),this.rawOffsetPrimitive.push(o),a.equals1(r.center)?l=new le(a,r.center):Math.abs(r.sweepAngle)<1e-4?l=new le(a,r.end()):(l=Oe.build4(a,r.end(),r.center,r.rx,r.ry,r.sweep()),l instanceof Oe&&l.sweepAngle===0&&(l=new le(l.start(),l.end()))),this.updateNextOffsetPrimitive(t.index,l)}else{let n=this.originalPrimitive[e.index],a=this.originalPrimitive[t.index],o=this.rxChangeStatus(n.sweep()),l=this.rxChangeStatus(a.sweep()),h=this.originalPrimitive[t.index].start(),c=this.getSweep(h,i,e.index),f=Math.abs(this.offsetDistance),d=Oe.build2(h,o?n.endAngle():n.endAngle()+180,l?a.startAngle:a.startAngle+180,f,f,c);this.rawOffsetPrimitive.push(i),this.rawOffsetPrimitive.push(d)}}};od.originalPrimitive=[],od.offsetPrimitive=[],od.rawOffsetPrimitive=[],od.testI=0;var gk=class ld extends pd{constructor(t,i,r,s,n,a){if(super(),i<0||r<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=t,this.width=i,this.height=r,this.angle=s,this.isCCW=n,this.radius=Math.min(Math.max(a,0),i/2,r/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new ae(this.radius,0).multiply3(Ii.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new ae(0,-this.height/2).multiply3(Ii.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new ae(this.width,-this.height/2).multiply3(Ii.rotateD(this.angle)))}extend(t){return new ld(this.leftUpPoint.add(new ae(-t,t).rotateD(ae.ORIGIN,this.angle)),this.width+t*2,this.height+t*2,this.angle,this.isCCW,this.radius+t)}bbox(){let t=Ii.rotateD(this.angle),{leftUpPoint:i,width:r,height:s,radius:n}=this,a=i.add(new ae(n,-n).multiply3(t)),o=i.add(new ae(n,n-s).multiply3(t)),l=i.add(new ae(r-n,-n).multiply3(t)),h=i.add(new ae(r-n,n-s).multiply3(t));return new Ni(Math.min(a.x,o.x,l.x,h.x)-n,Math.max(a.x,o.x,l.x,h.x)+n,Math.min(a.y,o.y,l.y,h.y)-n,Math.max(a.y,o.y,l.y,h.y)+n)}toPolyline(){let t=[],{leftUpPoint:i,width:r,height:s,radius:n}=this;if(n===0){let o=ae.ORIGIN,l=new ae(r,0),h=new ae(r,-s),c=new ae(0,-s);t.push(new le(o,l),new le(l,h),new le(h,c),new le(c,o))}else{let o=new ae(0,-n),l=new ae(n,0),h=new ae(r-n,0),c=new ae(r,-n),f=new ae(r,n-s),d=new ae(r-n,-s),u=new ae(n,-s),p=new ae(0,n-s);t.push(Oe.build1(o,l,n,n,!1,0),new le(l,h),Oe.build1(h,c,n,n,!1,0),new le(c,f),Oe.build1(f,d,n,n,!1,0),new le(d,u),Oe.build1(u,p,n,n,!1,0),new le(p,o))}t=t.filter(o=>!o.start().equals1(o.end())),this.isCCW&&(t.forEach((o,l)=>t[l]=o.reverse()),t.reverse());let a=Ii.rotateD(this.angle).translate1(i);return mt.build2(t.map(o=>o.multiply3(a)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(t){let i=this.leftUpPoint.multiply3(t),r=new ae(this.width,0).multiply3(Ii.rotateD(this.angle)).multiply3(t),s=new ae(0,-this.height).multiply3(Ii.rotateD(this.angle)).multiply3(t);return t.isMirrored()?new ld(i,s.length(),r.length(),s.angleD(ae.ORIGIN),this.isCCW===1?0:1,this.radius*r.length()/this.width):new ld(i,r.length(),s.length(),r.angleD(ae.ORIGIN),this.isCCW,this.radius*r.length()/this.width)}reverse(){return new ld(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(t,i,r){let s=this.stroke1(t,i,r);if(s.length===1)return s[0];{let[n,a]=s;return mt.build2(n.primitives.concat(new le(n.primitives[0].start(),a.primitives[0].start()),a.primitives,new le(a.primitives[0].start(),n.primitives[0].start())))}}stroke1(t,i,r){let s=r===this.isCCW?this:this.reverse(),n=t/2,a=Math.min(s.width,s.height)/2,o=s.extend(n).toPolyline();return a<=n?[o]:[o,s.extend(-n).toPolyline().reverse()]}points(t){let i=this.toPolyline(),r=[];return i.points(t,s=>r.push(s)),r}toBezier(){throw new Error("Method not implemented.")}},Ok=.01,rr=class Rn{static simplify(t){return t=Vo(t),t?new Rn([t]):null}static buildByStroke(t,i,r=1,s=N0,n){if(t instanceof Oe&&(t.rx<i/2+Ok||Math.abs(t.sweepAngle)>180&&me.lesseq(t.start().distance1(t.end()),i))){let o=PT(t.stroke(i,r,0),n);if(o.length===0)return null;if(o.length===1)return new Rn(o);let l=[null],h=Number.POSITIVE_INFINITY;return o.forEach(c=>{let f=c.area(.1);f<0?f<h&&(l[0]=c,h=f):l.push(c)}),new Rn(l)}else if(t instanceof gk){let o=t.stroke1(i,r,0).map(l=>Vo(l));return o[0]?o[1]?new Rn(o):new Rn([o[0]]):null}let a=t.stroke(i,r,0,s);return a?this.simplify(a):null}static buildCircle(t,i){return this.simplify(mt.build7([Oe.buildCircle(t,i,0)]))}static buildRect(t){return this.simplify(t.toPolyline())}static buildBBox(t){return this.simplify(mt.buildBBox(t,0))}constructor(t){this.items=t.slice()}multiply3(t){return new Rn(this.items.map(i=>i.multiply3(t)))}bbox(){return this.items[0].bbox()}isEqual(t){return t instanceof Rn?this.items.every(i=>t.items.some(r=>r.isEqual(i))):!1}getOutMostPolyline(){return this.items[0]}extend(t,i){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(t===0)return new fi([this]);let r=this.items[0],s=[];for(let c of r.primitives)if(c instanceof le)s.push(c);else if(c instanceof Oe&&c.rx===c.ry)a(c);else if(c instanceof ke)n(c);else throw new Error("not support!");r=mt.build7(s);function n(c){let f=c.points(.1);for(let d=0;d<f.length-1;d++){let u=f[d],p=f[d+1];s.push(new le(u,p))}}function a(c){if(Math.abs(c.sweepAngle)>270){let f=c.sweepAngle/2;a(Oe.build3(c.center,c.startAngle,f,c.rx,c.ry)),a(Oe.build3(c.center,c.startAngle+f,f,c.rx,c.ry))}else s.push(c)}let o=[],l=[];od.getExtendPolyLine(r,t,!0,i).forEach(c=>{(c.area(.1)>0?l:o).push(c)});let h;if(o.length===1)l.forEach(c=>o.push(c)),h=new fi([new Rn(o)]);else if(o.length===0)console.warn("outlines.length === 0"),h=new fi([]);else if(l.length===0)h=new fi(o.map(c=>new Rn([c])));else{let c=o.map(f=>[f]);l.forEach(f=>{let d=[],u=f.bbox();if(c.forEach(p=>{p[0].bbox().isContainsBBox1(u)&&d.push(p)}),d.length===1)d[0].push(f);else{if(d.length===0)throw new Error("inPlsArr.length === 0");for(let p of d.sort((_,g)=>_[0].bbox().area()-g[0].bbox().area()))if(p[0].getWindingNum(f.start())===-1){p.push(f);break}}}),h=new fi(c.map(f=>new Rn(f)))}return h}toPolylineGroup(){return new L0(this.items)}};var mk=Object.create,V3=Object.defineProperty,yk=Object.getOwnPropertyDescriptor,bk=Object.getOwnPropertyNames,xk=Object.getPrototypeOf,vk=Object.prototype.hasOwnProperty,co=(e=>typeof hr<"u"?hr:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof hr<"u"?hr:t)[i]}):e)(function(e){if(typeof hr<"u")return hr.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Ke=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ek=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of bk(t))!vk.call(e,s)&&s!==i&&V3(e,s,{get:()=>t[s],enumerable:!(r=yk(t,s))||r.enumerable});return e},q3=(e,t,i)=>(i=e!=null?mk(xk(e)):{},Ek(t||!e||!e.__esModule?V3(i,"default",{value:e,enumerable:!0}):i,e)),_g=Ke((e,t)=>{"use strict";typeof process>"u"||!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?t.exports={nextTick:i}:t.exports=process;function i(r,s,n,a){if(typeof r!="function")throw new TypeError('"callback" argument must be a function');var o=arguments.length,l,h;switch(o){case 0:case 1:return process.nextTick(r);case 2:return process.nextTick(function(){r.call(null,s)});case 3:return process.nextTick(function(){r.call(null,s,n)});case 4:return process.nextTick(function(){r.call(null,s,n,a)});default:for(l=new Array(o-1),h=0;h<l.length;)l[h++]=arguments[h];return process.nextTick(function(){r.apply(null,l)})}}}),Tk=Ke((e,t)=>{var i={}.toString;t.exports=Array.isArray||function(r){return i.call(r)=="[object Array]"}}),X3=Ke((e,t)=>{t.exports=co("stream")}),gg=Ke((e,t)=>{var i=co("buffer"),r=i.Buffer;function s(a,o){for(var l in a)o[l]=a[l]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(s(i,e),e.Buffer=n);function n(a,o,l){return r(a,o,l)}s(r,n),n.from=function(a,o,l){if(typeof a=="number")throw new TypeError("Argument must not be a number");return r(a,o,l)},n.alloc=function(a,o,l){if(typeof a!="number")throw new TypeError("Argument must be a number");var h=r(a);return o!==void 0?typeof l=="string"?h.fill(o,l):h.fill(o):h.fill(0),h},n.allocUnsafe=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return r(a)},n.allocUnsafeSlow=function(a){if(typeof a!="number")throw new TypeError("Argument must be a number");return i.SlowBuffer(a)}}),Ld=Ke(e=>{function t(g){return Array.isArray?Array.isArray(g):_(g)==="[object Array]"}e.isArray=t;function i(g){return typeof g=="boolean"}e.isBoolean=i;function r(g){return g===null}e.isNull=r;function s(g){return g==null}e.isNullOrUndefined=s;function n(g){return typeof g=="number"}e.isNumber=n;function a(g){return typeof g=="string"}e.isString=a;function o(g){return typeof g=="symbol"}e.isSymbol=o;function l(g){return g===void 0}e.isUndefined=l;function h(g){return _(g)==="[object RegExp]"}e.isRegExp=h;function c(g){return typeof g=="object"&&g!==null}e.isObject=c;function f(g){return _(g)==="[object Date]"}e.isDate=f;function d(g){return _(g)==="[object Error]"||g instanceof Error}e.isError=d;function u(g){return typeof g=="function"}e.isFunction=u;function p(g){return g===null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||typeof g=="symbol"||typeof g>"u"}e.isPrimitive=p,e.isBuffer=co("buffer").Buffer.isBuffer;function _(g){return Object.prototype.toString.call(g)}}),wk=Ke((e,t)=>{typeof Object.create=="function"?t.exports=function(i,r){r&&(i.super_=r,i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(i,r){if(r){i.super_=r;var s=function(){};s.prototype=r.prototype,i.prototype=new s,i.prototype.constructor=i}}}),Rd=Ke((e,t)=>{try{if(i=co("util"),typeof i.inherits!="function")throw"";t.exports=i.inherits}catch{t.exports=wk()}var i}),Sk=Ke((e,t)=>{"use strict";function i(a,o){if(!(a instanceof o))throw new TypeError("Cannot call a class as a function")}var r=gg().Buffer,s=co("util");function n(a,o,l){a.copy(o,l)}t.exports=(function(){function a(){i(this,a),this.head=null,this.tail=null,this.length=0}return a.prototype.push=function(o){var l={data:o,next:null};this.length>0?this.tail.next=l:this.head=l,this.tail=l,++this.length},a.prototype.unshift=function(o){var l={data:o,next:this.head};this.length===0&&(this.tail=l),this.head=l,++this.length},a.prototype.shift=function(){if(this.length!==0){var o=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,o}},a.prototype.clear=function(){this.head=this.tail=null,this.length=0},a.prototype.join=function(o){if(this.length===0)return"";for(var l=this.head,h=""+l.data;l=l.next;)h+=o+l.data;return h},a.prototype.concat=function(o){if(this.length===0)return r.alloc(0);for(var l=r.allocUnsafe(o>>>0),h=this.head,c=0;h;)n(h.data,l,c),c+=h.data.length,h=h.next;return l},a})(),s&&s.inspect&&s.inspect.custom&&(t.exports.prototype[s.inspect.custom]=function(){var a=s.inspect({length:this.length});return this.constructor.name+" "+a})}),W3=Ke((e,t)=>{"use strict";var i=_g();function r(a,o){var l=this,h=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return h||c?(o?o(a):a&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(n,this,a)):i.nextTick(n,this,a)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(a||null,function(f){!o&&f?l._writableState?l._writableState.errorEmitted||(l._writableState.errorEmitted=!0,i.nextTick(n,l,f)):i.nextTick(n,l,f):o&&o(f)}),this)}function s(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function n(a,o){a.emit("error",o)}t.exports={destroy:r,undestroy:s}}),Ik=Ke((e,t)=>{t.exports=co("util").deprecate}),J3=Ke((e,t)=>{"use strict";var i=_g();t.exports=b;function r(P){var I=this;this.next=null,this.entry=null,this.finish=function(){v(I,P)}}var s=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:i.nextTick,n;b.WritableState=_;var a=Object.create(Ld());a.inherits=Rd();var o={deprecate:Ik()},l=X3(),h=gg().Buffer,c=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function f(P){return h.from(P)}function d(P){return h.isBuffer(P)||P instanceof c}var u=W3();a.inherits(b,l);function p(){}function _(P,I){n=n||Dc(),P=P||{};var N=I instanceof n;this.objectMode=!!P.objectMode,N&&(this.objectMode=this.objectMode||!!P.writableObjectMode);var D=P.highWaterMark,j=P.writableHighWaterMark,H=this.objectMode?16:16*1024;D||D===0?this.highWaterMark=D:N&&(j||j===0)?this.highWaterMark=j:this.highWaterMark=H,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var K=P.decodeStrings===!1;this.decodeStrings=!K,this.defaultEncoding=P.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(se){C(I,se)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}_.prototype.getBuffer=function(){for(var P=this.bufferedRequest,I=[];P;)I.push(P),P=P.next;return I},(function(){try{Object.defineProperty(_.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var g;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(g=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(P){return g.call(this,P)?!0:this!==b?!1:P&&P._writableState instanceof _}})):g=function(P){return P instanceof this};function b(P){if(n=n||Dc(),!g.call(b,this)&&!(this instanceof n))return new b(P);this._writableState=new _(P,this),this.writable=!0,P&&(typeof P.write=="function"&&(this._write=P.write),typeof P.writev=="function"&&(this._writev=P.writev),typeof P.destroy=="function"&&(this._destroy=P.destroy),typeof P.final=="function"&&(this._final=P.final)),l.call(this)}b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function m(P,I){var N=new Error("write after end");P.emit("error",N),i.nextTick(I,N)}function O(P,I,N,D){var j=!0,H=!1;return N===null?H=new TypeError("May not write null values to stream"):typeof N!="string"&&N!==void 0&&!I.objectMode&&(H=new TypeError("Invalid non-string/buffer chunk")),H&&(P.emit("error",H),i.nextTick(D,H),j=!1),j}b.prototype.write=function(P,I,N){var D=this._writableState,j=!1,H=!D.objectMode&&d(P);return H&&!h.isBuffer(P)&&(P=f(P)),typeof I=="function"&&(N=I,I=null),H?I="buffer":I||(I=D.defaultEncoding),typeof N!="function"&&(N=p),D.ended?m(this,N):(H||O(this,D,P,N))&&(D.pendingcb++,j=x(this,D,H,P,I,N)),j},b.prototype.cork=function(){var P=this._writableState;P.corked++},b.prototype.uncork=function(){var P=this._writableState;P.corked&&(P.corked--,!P.writing&&!P.corked&&!P.bufferProcessing&&P.bufferedRequest&&Y(this,P))},b.prototype.setDefaultEncoding=function(P){if(typeof P=="string"&&(P=P.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((P+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+P);return this._writableState.defaultEncoding=P,this};function y(P,I,N){return!P.objectMode&&P.decodeStrings!==!1&&typeof I=="string"&&(I=h.from(I,N)),I}Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function x(P,I,N,D,j,H){if(!N){var K=y(I,D,j);D!==K&&(N=!0,j="buffer",D=K)}var se=I.objectMode?1:D.length;I.length+=se;var he=I.length<I.highWaterMark;if(he||(I.needDrain=!0),I.writing||I.corked){var _e=I.lastBufferedRequest;I.lastBufferedRequest={chunk:D,encoding:j,isBuf:N,callback:H,next:null},_e?_e.next=I.lastBufferedRequest:I.bufferedRequest=I.lastBufferedRequest,I.bufferedRequestCount+=1}else E(P,I,!1,se,D,j,H);return he}function E(P,I,N,D,j,H,K){I.writelen=D,I.writecb=K,I.writing=!0,I.sync=!0,N?P._writev(j,I.onwrite):P._write(j,H,I.onwrite),I.sync=!1}function w(P,I,N,D,j){--I.pendingcb,N?(i.nextTick(j,D),i.nextTick(L,P,I),P._writableState.errorEmitted=!0,P.emit("error",D)):(j(D),P._writableState.errorEmitted=!0,P.emit("error",D),L(P,I))}function S(P){P.writing=!1,P.writecb=null,P.length-=P.writelen,P.writelen=0}function C(P,I){var N=P._writableState,D=N.sync,j=N.writecb;if(S(N),I)w(P,N,D,I,j);else{var H=G(N);!H&&!N.corked&&!N.bufferProcessing&&N.bufferedRequest&&Y(P,N),D?s(R,P,N,H,j):R(P,N,H,j)}}function R(P,I,N,D){N||B(P,I),I.pendingcb--,D(),L(P,I)}function B(P,I){I.length===0&&I.needDrain&&(I.needDrain=!1,P.emit("drain"))}function Y(P,I){I.bufferProcessing=!0;var N=I.bufferedRequest;if(P._writev&&N&&N.next){var D=I.bufferedRequestCount,j=new Array(D),H=I.corkedRequestsFree;H.entry=N;for(var K=0,se=!0;N;)j[K]=N,N.isBuf||(se=!1),N=N.next,K+=1;j.allBuffers=se,E(P,I,!0,I.length,j,"",H.finish),I.pendingcb++,I.lastBufferedRequest=null,H.next?(I.corkedRequestsFree=H.next,H.next=null):I.corkedRequestsFree=new r(I),I.bufferedRequestCount=0}else{for(;N;){var he=N.chunk,_e=N.encoding,ve=N.callback,J=I.objectMode?1:he.length;if(E(P,I,!1,J,he,_e,ve),N=N.next,I.bufferedRequestCount--,I.writing)break}N===null&&(I.lastBufferedRequest=null)}I.bufferedRequest=N,I.bufferProcessing=!1}b.prototype._write=function(P,I,N){N(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(P,I,N){var D=this._writableState;typeof P=="function"?(N=P,P=null,I=null):typeof I=="function"&&(N=I,I=null),P!=null&&this.write(P,I),D.corked&&(D.corked=1,this.uncork()),D.ending||M(this,D,N)};function G(P){return P.ending&&P.length===0&&P.bufferedRequest===null&&!P.finished&&!P.writing}function z(P,I){P._final(function(N){I.pendingcb--,N&&P.emit("error",N),I.prefinished=!0,P.emit("prefinish"),L(P,I)})}function q(P,I){!I.prefinished&&!I.finalCalled&&(typeof P._final=="function"?(I.pendingcb++,I.finalCalled=!0,i.nextTick(z,P,I)):(I.prefinished=!0,P.emit("prefinish")))}function L(P,I){var N=G(I);return N&&(q(P,I),I.pendingcb===0&&(I.finished=!0,P.emit("finish"))),N}function M(P,I,N){I.ending=!0,L(P,I),N&&(I.finished?i.nextTick(N):P.once("finish",N)),I.ended=!0,P.writable=!1}function v(P,I,N){var D=P.entry;for(P.entry=null;D;){var j=D.callback;I.pendingcb--,j(N),D=D.next}I.corkedRequestsFree.next=P}Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(P){this._writableState&&(this._writableState.destroyed=P)}}),b.prototype.destroy=u.destroy,b.prototype._undestroy=u.undestroy,b.prototype._destroy=function(P,I){this.end(),I(P)}}),Dc=Ke((e,t)=>{"use strict";var i=_g(),r=Object.keys||function(u){var p=[];for(var _ in u)p.push(_);return p};t.exports=c;var s=Object.create(Ld());s.inherits=Rd();var n=Z3(),a=J3();for(s.inherits(c,n),o=r(a.prototype),h=0;h<o.length;h++)l=o[h],c.prototype[l]||(c.prototype[l]=a.prototype[l]);var o,l,h;function c(u){if(!(this instanceof c))return new c(u);n.call(this,u),a.call(this,u),u&&u.readable===!1&&(this.readable=!1),u&&u.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,u&&u.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",f)}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function f(){this.allowHalfOpen||this._writableState.ended||i.nextTick(d,this)}function d(u){u.end()}Object.defineProperty(c.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(u){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=u,this._writableState.destroyed=u)}}),c.prototype._destroy=function(u,p){this.push(null),this.end(),i.nextTick(p,u)}}),CT=Ke(e=>{"use strict";var t=gg().Buffer,i=t.isEncoding||function(m){switch(m=""+m,m&&m.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(m){if(!m)return"utf8";for(var O;;)switch(m){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return m;default:if(O)return;m=(""+m).toLowerCase(),O=!0}}function s(m){var O=r(m);if(typeof O!="string"&&(t.isEncoding===i||!i(m)))throw new Error("Unknown encoding: "+m);return O||m}e.StringDecoder=n;function n(m){this.encoding=s(m);var O;switch(this.encoding){case"utf16le":this.text=d,this.end=u,O=4;break;case"utf8":this.fillLast=h,O=4;break;case"base64":this.text=p,this.end=_,O=3;break;default:this.write=g,this.end=b;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=t.allocUnsafe(O)}n.prototype.write=function(m){if(m.length===0)return"";var O,y;if(this.lastNeed){if(O=this.fillLast(m),O===void 0)return"";y=this.lastNeed,this.lastNeed=0}else y=0;return y<m.length?O?O+this.text(m,y):this.text(m,y):O||""},n.prototype.end=f,n.prototype.text=c,n.prototype.fillLast=function(m){if(this.lastNeed<=m.length)return m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,this.lastTotal-this.lastNeed,0,m.length),this.lastNeed-=m.length};function a(m){return m<=127?0:m>>5===6?2:m>>4===14?3:m>>3===30?4:m>>6===2?-1:-2}function o(m,O,y){var x=O.length-1;if(x<y)return 0;var E=a(O[x]);return E>=0?(E>0&&(m.lastNeed=E-1),E):--x<y||E===-2?0:(E=a(O[x]),E>=0?(E>0&&(m.lastNeed=E-2),E):--x<y||E===-2?0:(E=a(O[x]),E>=0?(E>0&&(E===2?E=0:m.lastNeed=E-3),E):0))}function l(m,O,y){if((O[0]&192)!==128)return m.lastNeed=0,"\uFFFD";if(m.lastNeed>1&&O.length>1){if((O[1]&192)!==128)return m.lastNeed=1,"\uFFFD";if(m.lastNeed>2&&O.length>2&&(O[2]&192)!==128)return m.lastNeed=2,"\uFFFD"}}function h(m){var O=this.lastTotal-this.lastNeed,y=l(this,m,O);if(y!==void 0)return y;if(this.lastNeed<=m.length)return m.copy(this.lastChar,O,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);m.copy(this.lastChar,O,0,m.length),this.lastNeed-=m.length}function c(m,O){var y=o(this,m,O);if(!this.lastNeed)return m.toString("utf8",O);this.lastTotal=y;var x=m.length-(y-this.lastNeed);return m.copy(this.lastChar,0,x),m.toString("utf8",O,x)}function f(m){var O=m&&m.length?this.write(m):"";return this.lastNeed?O+"\uFFFD":O}function d(m,O){if((m.length-O)%2===0){var y=m.toString("utf16le",O);if(y){var x=y.charCodeAt(y.length-1);if(x>=55296&&x<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1],y.slice(0,-1)}return y}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=m[m.length-1],m.toString("utf16le",O,m.length-1)}function u(m){var O=m&&m.length?this.write(m):"";if(this.lastNeed){var y=this.lastTotal-this.lastNeed;return O+this.lastChar.toString("utf16le",0,y)}return O}function p(m,O){var y=(m.length-O)%3;return y===0?m.toString("base64",O):(this.lastNeed=3-y,this.lastTotal=3,y===1?this.lastChar[0]=m[m.length-1]:(this.lastChar[0]=m[m.length-2],this.lastChar[1]=m[m.length-1]),m.toString("base64",O,m.length-y))}function _(m){var O=m&&m.length?this.write(m):"";return this.lastNeed?O+this.lastChar.toString("base64",0,3-this.lastNeed):O}function g(m){return m.toString(this.encoding)}function b(m){return m&&m.length?this.write(m):""}}),Z3=Ke((e,t)=>{"use strict";var i=_g();t.exports=x;var r=Tk(),s;x.ReadableState=y;var n=co("events").EventEmitter,a=function(J,Z){return J.listeners(Z).length},o=X3(),l=gg().Buffer,h=(typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function c(J){return l.from(J)}function f(J){return l.isBuffer(J)||J instanceof h}var d=Object.create(Ld());d.inherits=Rd();var u=co("util"),p=void 0;u&&u.debuglog?p=u.debuglog("stream"):p=function(){};var _=Sk(),g=W3(),b;d.inherits(x,o);var m=["error","close","destroy","pause","resume"];function O(J,Z,re){if(typeof J.prependListener=="function")return J.prependListener(Z,re);!J._events||!J._events[Z]?J.on(Z,re):r(J._events[Z])?J._events[Z].unshift(re):J._events[Z]=[re,J._events[Z]]}function y(J,Z){s=s||Dc(),J=J||{};var re=Z instanceof s;this.objectMode=!!J.objectMode,re&&(this.objectMode=this.objectMode||!!J.readableObjectMode);var ue=J.highWaterMark,Le=J.readableHighWaterMark,Ce=this.objectMode?16:16*1024;ue||ue===0?this.highWaterMark=ue:re&&(Le||Le===0)?this.highWaterMark=Le:this.highWaterMark=Ce,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new _,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=J.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,J.encoding&&(b||(b=CT().StringDecoder),this.decoder=new b(J.encoding),this.encoding=J.encoding)}function x(J){if(s=s||Dc(),!(this instanceof x))return new x(J);this._readableState=new y(J,this),this.readable=!0,J&&(typeof J.read=="function"&&(this._read=J.read),typeof J.destroy=="function"&&(this._destroy=J.destroy)),o.call(this)}Object.defineProperty(x.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(J){this._readableState&&(this._readableState.destroyed=J)}}),x.prototype.destroy=g.destroy,x.prototype._undestroy=g.undestroy,x.prototype._destroy=function(J,Z){this.push(null),Z(J)},x.prototype.push=function(J,Z){var re=this._readableState,ue;return re.objectMode?ue=!0:typeof J=="string"&&(Z=Z||re.defaultEncoding,Z!==re.encoding&&(J=l.from(J,Z),Z=""),ue=!0),E(this,J,Z,!1,ue)},x.prototype.unshift=function(J){return E(this,J,null,!0,!1)};function E(J,Z,re,ue,Le){var Ce=J._readableState;if(Z===null)Ce.reading=!1,G(J,Ce);else{var De;Le||(De=S(Ce,Z)),De?J.emit("error",De):Ce.objectMode||Z&&Z.length>0?(typeof Z!="string"&&!Ce.objectMode&&Object.getPrototypeOf(Z)!==l.prototype&&(Z=c(Z)),ue?Ce.endEmitted?J.emit("error",new Error("stream.unshift() after end event")):w(J,Ce,Z,!0):Ce.ended?J.emit("error",new Error("stream.push() after EOF")):(Ce.reading=!1,Ce.decoder&&!re?(Z=Ce.decoder.write(Z),Ce.objectMode||Z.length!==0?w(J,Ce,Z,!1):L(J,Ce)):w(J,Ce,Z,!1))):ue||(Ce.reading=!1)}return C(Ce)}function w(J,Z,re,ue){Z.flowing&&Z.length===0&&!Z.sync?(J.emit("data",re),J.read(0)):(Z.length+=Z.objectMode?1:re.length,ue?Z.buffer.unshift(re):Z.buffer.push(re),Z.needReadable&&z(J)),L(J,Z)}function S(J,Z){var re;return!f(Z)&&typeof Z!="string"&&Z!==void 0&&!J.objectMode&&(re=new TypeError("Invalid non-string/buffer chunk")),re}function C(J){return!J.ended&&(J.needReadable||J.length<J.highWaterMark||J.length===0)}x.prototype.isPaused=function(){return this._readableState.flowing===!1},x.prototype.setEncoding=function(J){return b||(b=CT().StringDecoder),this._readableState.decoder=new b(J),this._readableState.encoding=J,this};var R=8388608;function B(J){return J>=R?J=R:(J--,J|=J>>>1,J|=J>>>2,J|=J>>>4,J|=J>>>8,J|=J>>>16,J++),J}function Y(J,Z){return J<=0||Z.length===0&&Z.ended?0:Z.objectMode?1:J!==J?Z.flowing&&Z.length?Z.buffer.head.data.length:Z.length:(J>Z.highWaterMark&&(Z.highWaterMark=B(J)),J<=Z.length?J:Z.ended?Z.length:(Z.needReadable=!0,0))}x.prototype.read=function(J){p("read",J),J=parseInt(J,10);var Z=this._readableState,re=J;if(J!==0&&(Z.emittedReadable=!1),J===0&&Z.needReadable&&(Z.length>=Z.highWaterMark||Z.ended))return p("read: emitReadable",Z.length,Z.ended),Z.length===0&&Z.ended?he(this):z(this),null;if(J=Y(J,Z),J===0&&Z.ended)return Z.length===0&&he(this),null;var ue=Z.needReadable;p("need readable",ue),(Z.length===0||Z.length-J<Z.highWaterMark)&&(ue=!0,p("length less than watermark",ue)),Z.ended||Z.reading?(ue=!1,p("reading or ended",ue)):ue&&(p("do read"),Z.reading=!0,Z.sync=!0,Z.length===0&&(Z.needReadable=!0),this._read(Z.highWaterMark),Z.sync=!1,Z.reading||(J=Y(re,Z)));var Le;return J>0?Le=j(J,Z):Le=null,Le===null?(Z.needReadable=!0,J=0):Z.length-=J,Z.length===0&&(Z.ended||(Z.needReadable=!0),re!==J&&Z.ended&&he(this)),Le!==null&&this.emit("data",Le),Le};function G(J,Z){if(!Z.ended){if(Z.decoder){var re=Z.decoder.end();re&&re.length&&(Z.buffer.push(re),Z.length+=Z.objectMode?1:re.length)}Z.ended=!0,z(J)}}function z(J){var Z=J._readableState;Z.needReadable=!1,Z.emittedReadable||(p("emitReadable",Z.flowing),Z.emittedReadable=!0,Z.sync?i.nextTick(q,J):q(J))}function q(J){p("emit readable"),J.emit("readable"),D(J)}function L(J,Z){Z.readingMore||(Z.readingMore=!0,i.nextTick(M,J,Z))}function M(J,Z){for(var re=Z.length;!Z.reading&&!Z.flowing&&!Z.ended&&Z.length<Z.highWaterMark&&(p("maybeReadMore read 0"),J.read(0),re!==Z.length);)re=Z.length;Z.readingMore=!1}x.prototype._read=function(J){this.emit("error",new Error("_read() is not implemented"))},x.prototype.pipe=function(J,Z){var re=this,ue=this._readableState;switch(ue.pipesCount){case 0:ue.pipes=J;break;case 1:ue.pipes=[ue.pipes,J];break;default:ue.pipes.push(J);break}ue.pipesCount+=1,p("pipe count=%d opts=%j",ue.pipesCount,Z);var Le=(!Z||Z.end!==!1)&&J!==process.stdout&&J!==process.stderr,Ce=Le?Pe:It;ue.endEmitted?i.nextTick(Ce):re.once("end",Ce),J.on("unpipe",De);function De(jt,Ai){p("onunpipe"),jt===re&&Ai&&Ai.hasUnpiped===!1&&(Ai.hasUnpiped=!0,$e())}function Pe(){p("onend"),J.end()}var Ie=v(re);J.on("drain",Ie);var Je=!1;function $e(){p("cleanup"),J.removeListener("close",si),J.removeListener("finish",mi),J.removeListener("drain",Ie),J.removeListener("error",ut),J.removeListener("unpipe",De),re.removeListener("end",Pe),re.removeListener("end",It),re.removeListener("data",ct),Je=!0,ue.awaitDrain&&(!J._writableState||J._writableState.needDrain)&&Ie()}var pt=!1;re.on("data",ct);function ct(jt){p("ondata"),pt=!1;var Ai=J.write(jt);Ai===!1&&!pt&&((ue.pipesCount===1&&ue.pipes===J||ue.pipesCount>1&&ve(ue.pipes,J)!==-1)&&!Je&&(p("false write response, pause",ue.awaitDrain),ue.awaitDrain++,pt=!0),re.pause())}function ut(jt){p("onerror",jt),It(),J.removeListener("error",ut),a(J,"error")===0&&J.emit("error",jt)}O(J,"error",ut);function si(){J.removeListener("finish",mi),It()}J.once("close",si);function mi(){p("onfinish"),J.removeListener("close",si),It()}J.once("finish",mi);function It(){p("unpipe"),re.unpipe(J)}return J.emit("pipe",re),ue.flowing||(p("pipe resume"),re.resume()),J};function v(J){return function(){var Z=J._readableState;p("pipeOnDrain",Z.awaitDrain),Z.awaitDrain&&Z.awaitDrain--,Z.awaitDrain===0&&a(J,"data")&&(Z.flowing=!0,D(J))}}x.prototype.unpipe=function(J){var Z=this._readableState,re={hasUnpiped:!1};if(Z.pipesCount===0)return this;if(Z.pipesCount===1)return J&&J!==Z.pipes?this:(J||(J=Z.pipes),Z.pipes=null,Z.pipesCount=0,Z.flowing=!1,J&&J.emit("unpipe",this,re),this);if(!J){var ue=Z.pipes,Le=Z.pipesCount;Z.pipes=null,Z.pipesCount=0,Z.flowing=!1;for(var Ce=0;Ce<Le;Ce++)ue[Ce].emit("unpipe",this,{hasUnpiped:!1});return this}var De=ve(Z.pipes,J);return De===-1?this:(Z.pipes.splice(De,1),Z.pipesCount-=1,Z.pipesCount===1&&(Z.pipes=Z.pipes[0]),J.emit("unpipe",this,re),this)},x.prototype.on=function(J,Z){var re=o.prototype.on.call(this,J,Z);if(J==="data")this._readableState.flowing!==!1&&this.resume();else if(J==="readable"){var ue=this._readableState;!ue.endEmitted&&!ue.readableListening&&(ue.readableListening=ue.needReadable=!0,ue.emittedReadable=!1,ue.reading?ue.length&&z(this):i.nextTick(P,this))}return re},x.prototype.addListener=x.prototype.on;function P(J){p("readable nexttick read 0"),J.read(0)}x.prototype.resume=function(){var J=this._readableState;return J.flowing||(p("resume"),J.flowing=!0,I(this,J)),this};function I(J,Z){Z.resumeScheduled||(Z.resumeScheduled=!0,i.nextTick(N,J,Z))}function N(J,Z){Z.reading||(p("resume read 0"),J.read(0)),Z.resumeScheduled=!1,Z.awaitDrain=0,J.emit("resume"),D(J),Z.flowing&&!Z.reading&&J.read(0)}x.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function D(J){var Z=J._readableState;for(p("flow",Z.flowing);Z.flowing&&J.read()!==null;);}x.prototype.wrap=function(J){var Z=this,re=this._readableState,ue=!1;J.on("end",function(){if(p("wrapped end"),re.decoder&&!re.ended){var De=re.decoder.end();De&&De.length&&Z.push(De)}Z.push(null)}),J.on("data",function(De){if(p("wrapped data"),re.decoder&&(De=re.decoder.write(De)),!(re.objectMode&&De==null)&&!(!re.objectMode&&(!De||!De.length))){var Pe=Z.push(De);Pe||(ue=!0,J.pause())}});for(var Le in J)this[Le]===void 0&&typeof J[Le]=="function"&&(this[Le]=(function(De){return function(){return J[De].apply(J,arguments)}})(Le));for(var Ce=0;Ce<m.length;Ce++)J.on(m[Ce],this.emit.bind(this,m[Ce]));return this._read=function(De){p("wrapped _read",De),ue&&(ue=!1,J.resume())},this},Object.defineProperty(x.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),x._fromList=j;function j(J,Z){if(Z.length===0)return null;var re;return Z.objectMode?re=Z.buffer.shift():!J||J>=Z.length?(Z.decoder?re=Z.buffer.join(""):Z.buffer.length===1?re=Z.buffer.head.data:re=Z.buffer.concat(Z.length),Z.buffer.clear()):re=H(J,Z.buffer,Z.decoder),re}function H(J,Z,re){var ue;return J<Z.head.data.length?(ue=Z.head.data.slice(0,J),Z.head.data=Z.head.data.slice(J)):J===Z.head.data.length?ue=Z.shift():ue=re?K(J,Z):se(J,Z),ue}function K(J,Z){var re=Z.head,ue=1,Le=re.data;for(J-=Le.length;re=re.next;){var Ce=re.data,De=J>Ce.length?Ce.length:J;if(De===Ce.length?Le+=Ce:Le+=Ce.slice(0,J),J-=De,J===0){De===Ce.length?(++ue,re.next?Z.head=re.next:Z.head=Z.tail=null):(Z.head=re,re.data=Ce.slice(De));break}++ue}return Z.length-=ue,Le}function se(J,Z){var re=l.allocUnsafe(J),ue=Z.head,Le=1;for(ue.data.copy(re),J-=ue.data.length;ue=ue.next;){var Ce=ue.data,De=J>Ce.length?Ce.length:J;if(Ce.copy(re,re.length-J,0,De),J-=De,J===0){De===Ce.length?(++Le,ue.next?Z.head=ue.next:Z.head=Z.tail=null):(Z.head=ue,ue.data=Ce.slice(De));break}++Le}return Z.length-=Le,re}function he(J){var Z=J._readableState;if(Z.length>0)throw new Error('"endReadable()" called on non-empty stream');Z.endEmitted||(Z.ended=!0,i.nextTick(_e,Z,J))}function _e(J,Z){!J.endEmitted&&J.length===0&&(J.endEmitted=!0,Z.readable=!1,Z.emit("end"))}function ve(J,Z){for(var re=0,ue=J.length;re<ue;re++)if(J[re]===Z)return re;return-1}}),K3=Ke((e,t)=>{"use strict";t.exports=n;var i=Dc(),r=Object.create(Ld());r.inherits=Rd(),r.inherits(n,i);function s(l,h){var c=this._transformState;c.transforming=!1;var f=c.writecb;if(!f)return this.emit("error",new Error("write callback called multiple times"));c.writechunk=null,c.writecb=null,h!=null&&this.push(h),f(l);var d=this._readableState;d.reading=!1,(d.needReadable||d.length<d.highWaterMark)&&this._read(d.highWaterMark)}function n(l){if(!(this instanceof n))return new n(l);i.call(this,l),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,l&&(typeof l.transform=="function"&&(this._transform=l.transform),typeof l.flush=="function"&&(this._flush=l.flush)),this.on("prefinish",a)}function a(){var l=this;typeof this._flush=="function"?this._flush(function(h,c){o(l,h,c)}):o(this,null,null)}n.prototype.push=function(l,h){return this._transformState.needTransform=!1,i.prototype.push.call(this,l,h)},n.prototype._transform=function(l,h,c){throw new Error("_transform() is not implemented")},n.prototype._write=function(l,h,c){var f=this._transformState;if(f.writecb=c,f.writechunk=l,f.writeencoding=h,!f.transforming){var d=this._readableState;(f.needTransform||d.needReadable||d.length<d.highWaterMark)&&this._read(d.highWaterMark)}},n.prototype._read=function(l){var h=this._transformState;h.writechunk!==null&&h.writecb&&!h.transforming?(h.transforming=!0,this._transform(h.writechunk,h.writeencoding,h.afterTransform)):h.needTransform=!0},n.prototype._destroy=function(l,h){var c=this;i.prototype._destroy.call(this,l,function(f){h(f),c.emit("close")})};function o(l,h,c){if(h)return l.emit("error",h);if(c!=null&&l.push(c),l._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(l._transformState.transforming)throw new Error("Calling transform done when still transforming");return l.push(null)}}),Pk=Ke((e,t)=>{"use strict";t.exports=s;var i=K3(),r=Object.create(Ld());r.inherits=Rd(),r.inherits(s,i);function s(n){if(!(this instanceof s))return new s(n);i.call(this,n)}s.prototype._transform=function(n,a,o){o(null,n)}}),$3=Ke((e,t)=>{var i=co("stream");process.env.READABLE_STREAM==="disable"&&i?(t.exports=i,e=t.exports=i.Readable,e.Readable=i.Readable,e.Writable=i.Writable,e.Duplex=i.Duplex,e.Transform=i.Transform,e.PassThrough=i.PassThrough,e.Stream=i):(e=t.exports=Z3(),e.Stream=i||e,e.Readable=e,e.Writable=J3(),e.Duplex=Dc(),e.Transform=K3(),e.PassThrough=Pk())}),$o=Ke(e=>{"use strict";if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",e.nodebuffer=typeof Buffer<"u",e.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")e.blob=!1;else{t=new ArrayBuffer(0);try{e.blob=new Blob([t],{type:"application/zip"}).size===0}catch{try{i=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,r=new i,r.append(t),e.blob=r.getBlob("application/zip").size===0}catch{e.blob=!1}}}var t,i,r;try{e.nodestream=!!$3().Readable}catch{e.nodestream=!1}}),Q3=Ke(e=>{"use strict";var t=nr(),i=$o(),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(s){for(var n=[],a,o,l,h,c,f,d,u=0,p=s.length,_=p,g=t.getTypeOf(s)!=="string";u<s.length;)_=p-u,g?(a=s[u++],o=u<p?s[u++]:0,l=u<p?s[u++]:0):(a=s.charCodeAt(u++),o=u<p?s.charCodeAt(u++):0,l=u<p?s.charCodeAt(u++):0),h=a>>2,c=(a&3)<<4|o>>4,f=_>1?(o&15)<<2|l>>6:64,d=_>2?l&63:64,n.push(r.charAt(h)+r.charAt(c)+r.charAt(f)+r.charAt(d));return n.join("")},e.decode=function(s){var n,a,o,l,h,c,f,d=0,u=0,p="data:";if(s.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");s=s.replace(/[^A-Za-z0-9+/=]/g,"");var _=s.length*3/4;if(s.charAt(s.length-1)===r.charAt(64)&&_--,s.charAt(s.length-2)===r.charAt(64)&&_--,_%1!==0)throw new Error("Invalid base64 input, bad content length.");var g;for(i.uint8array?g=new Uint8Array(_|0):g=new Array(_|0);d<s.length;)l=r.indexOf(s.charAt(d++)),h=r.indexOf(s.charAt(d++)),c=r.indexOf(s.charAt(d++)),f=r.indexOf(s.charAt(d++)),n=l<<2|h>>4,a=(h&15)<<4|c>>2,o=(c&3)<<6|f,g[u++]=n,c!==64&&(g[u++]=a),f!==64&&(g[u++]=o);return g}}),Og=Ke((e,t)=>{"use strict";t.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,r);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,r)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var r=new Buffer(i);return r.fill(0),r},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}}),Ak=Ke((e,t)=>{"use strict";var i=global.MutationObserver||global.WebKitMutationObserver,r;process.browser?i?(s=0,n=new i(c),a=global.document.createTextNode(""),n.observe(a,{characterData:!0}),r=function(){a.data=s=++s%2}):!global.setImmediate&&typeof global.MessageChannel<"u"?(o=new global.MessageChannel,o.port1.onmessage=c,r=function(){o.port2.postMessage(0)}):"document"in global&&"onreadystatechange"in global.document.createElement("script")?r=function(){var d=global.document.createElement("script");d.onreadystatechange=function(){c(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},global.document.documentElement.appendChild(d)}:r=function(){setTimeout(c,0)}:r=function(){process.nextTick(c)};var s,n,a,o,l,h=[];function c(){l=!0;for(var d,u,p=h.length;p;){for(u=h,h=[],d=-1;++d<p;)u[d]();p=h.length}l=!1}t.exports=f;function f(d){h.push(d)===1&&!l&&r()}}),Ck=Ke((e,t)=>{"use strict";var i=Ak();function r(){}var s={},n=["REJECTED"],a=["FULFILLED"],o=["PENDING"];process.browser||(l=["UNHANDLED"]);var l;t.exports=h;function h(O){if(typeof O!="function")throw new TypeError("resolver must be a function");this.state=o,this.queue=[],this.outcome=void 0,process.browser||(this.handled=l),O!==r&&u(this,O)}h.prototype.finally=function(O){if(typeof O!="function")return this;var y=this.constructor;return this.then(x,E);function x(w){function S(){return w}return y.resolve(O()).then(S)}function E(w){function S(){throw w}return y.resolve(O()).then(S)}},h.prototype.catch=function(O){return this.then(null,O)},h.prototype.then=function(O,y){if(typeof O!="function"&&this.state===a||typeof y!="function"&&this.state===n)return this;var x=new this.constructor(r);if(process.browser||this.handled===l&&(this.handled=null),this.state!==o){var E=this.state===a?O:y;f(x,E,this.outcome)}else this.queue.push(new c(x,O,y));return x};function c(O,y,x){this.promise=O,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}c.prototype.callFulfilled=function(O){s.resolve(this.promise,O)},c.prototype.otherCallFulfilled=function(O){f(this.promise,this.onFulfilled,O)},c.prototype.callRejected=function(O){s.reject(this.promise,O)},c.prototype.otherCallRejected=function(O){f(this.promise,this.onRejected,O)};function f(O,y,x){i(function(){var E;try{E=y(x)}catch(w){return s.reject(O,w)}E===O?s.reject(O,new TypeError("Cannot resolve promise with itself")):s.resolve(O,E)})}s.resolve=function(O,y){var x=p(d,y);if(x.status==="error")return s.reject(O,x.value);var E=x.value;if(E)u(O,E);else{O.state=a,O.outcome=y;for(var w=-1,S=O.queue.length;++w<S;)O.queue[w].callFulfilled(y)}return O},s.reject=function(O,y){O.state=n,O.outcome=y,process.browser||O.handled===l&&i(function(){O.handled===l&&process.emit("unhandledRejection",y,O)});for(var x=-1,E=O.queue.length;++x<E;)O.queue[x].callRejected(y);return O};function d(O){var y=O&&O.then;if(O&&(typeof O=="object"||typeof O=="function")&&typeof y=="function")return function(){y.apply(O,arguments)}}function u(O,y){var x=!1;function E(R){x||(x=!0,s.reject(O,R))}function w(R){x||(x=!0,s.resolve(O,R))}function S(){y(w,E)}var C=p(S);C.status==="error"&&E(C.value)}function p(O,y){var x={};try{x.value=O(y),x.status="success"}catch(E){x.status="error",x.value=E}return x}h.resolve=_;function _(O){return O instanceof this?O:s.resolve(new this(r),O)}h.reject=g;function g(O){var y=new this(r);return s.reject(y,O)}h.all=b;function b(O){var y=this;if(Object.prototype.toString.call(O)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=O.length,E=!1;if(!x)return this.resolve([]);for(var w=new Array(x),S=0,C=-1,R=new this(r);++C<x;)B(O[C],C);return R;function B(Y,G){y.resolve(Y).then(z,function(q){E||(E=!0,s.reject(R,q))});function z(q){w[G]=q,++S===x&&!E&&(E=!0,s.resolve(R,w))}}}h.race=m;function m(O){var y=this;if(Object.prototype.toString.call(O)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=O.length,E=!1;if(!x)return this.resolve([]);for(var w=-1,S=new this(r);++w<x;)C(O[w]);return S;function C(R){y.resolve(R).then(function(B){E||(E=!0,s.resolve(S,B))},function(B){E||(E=!0,s.reject(S,B))})}}}),Dd=Ke((e,t)=>{"use strict";var i=null;typeof Promise<"u"?i=Promise:i=Ck(),t.exports={Promise:i}}),Nk=Ke(e=>{(function(t,i){"use strict";if(t.setImmediate)return;var r=1,s={},n=!1,a=t.document,o;function l(O){typeof O!="function"&&(O=new Function(""+O));for(var y=new Array(arguments.length-1),x=0;x<y.length;x++)y[x]=arguments[x+1];var E={callback:O,args:y};return s[r]=E,o(r),r++}function h(O){delete s[O]}function c(O){var y=O.callback,x=O.args;switch(x.length){case 0:y();break;case 1:y(x[0]);break;case 2:y(x[0],x[1]);break;case 3:y(x[0],x[1],x[2]);break;default:y.apply(i,x);break}}function f(O){if(n)setTimeout(f,0,O);else{var y=s[O];if(y){n=!0;try{c(y)}finally{h(O),n=!1}}}}function d(){o=function(O){process.nextTick(function(){f(O)})}}function u(){if(t.postMessage&&!t.importScripts){var O=!0,y=t.onmessage;return t.onmessage=function(){O=!1},t.postMessage("","*"),t.onmessage=y,O}}function p(){var O="setImmediate$"+Math.random()+"$",y=function(x){x.source===t&&typeof x.data=="string"&&x.data.indexOf(O)===0&&f(+x.data.slice(O.length))};t.addEventListener?t.addEventListener("message",y,!1):t.attachEvent("onmessage",y),o=function(x){t.postMessage(O+x,"*")}}function _(){var O=new MessageChannel;O.port1.onmessage=function(y){var x=y.data;f(x)},o=function(y){O.port2.postMessage(y)}}function g(){var O=a.documentElement;o=function(y){var x=a.createElement("script");x.onreadystatechange=function(){f(y),x.onreadystatechange=null,O.removeChild(x),x=null},O.appendChild(x)}}function b(){o=function(O){setTimeout(f,0,O)}}var m=Object.getPrototypeOf&&Object.getPrototypeOf(t);m=m&&m.setTimeout?m:t,{}.toString.call(t.process)==="[object process]"?d():u()?p():t.MessageChannel?_():a&&"onreadystatechange"in a.createElement("script")?g():b(),m.setImmediate=l,m.clearImmediate=h})(typeof self>"u"?typeof global>"u"?e:global:self)}),nr=Ke(e=>{"use strict";var t=$o(),i=Q3(),r=Og(),s=Dd();Nk();function n(d){var u=null;return t.uint8array?u=new Uint8Array(d.length):u=new Array(d.length),o(d,u)}e.newBlob=function(d,u){e.checkSupport("blob");try{return new Blob([d],{type:u})}catch{try{var p=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder,_=new p;return _.append(d),_.getBlob(u)}catch{throw new Error("Bug : can't construct the Blob.")}}};function a(d){return d}function o(d,u){for(var p=0;p<d.length;++p)u[p]=d.charCodeAt(p)&255;return u}var l={stringifyByChunk:function(d,u,p){var _=[],g=0,b=d.length;if(b<=p)return String.fromCharCode.apply(null,d);for(;g<b;)u==="array"||u==="nodebuffer"?_.push(String.fromCharCode.apply(null,d.slice(g,Math.min(g+p,b)))):_.push(String.fromCharCode.apply(null,d.subarray(g,Math.min(g+p,b)))),g+=p;return _.join("")},stringifyByChar:function(d){for(var u="",p=0;p<d.length;p++)u+=String.fromCharCode(d[p]);return u},applyCanBeUsed:{uint8array:(function(){try{return t.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return t.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function h(d){var u=65536,p=e.getTypeOf(d),_=!0;if(p==="uint8array"?_=l.applyCanBeUsed.uint8array:p==="nodebuffer"&&(_=l.applyCanBeUsed.nodebuffer),_)for(;u>1;)try{return l.stringifyByChunk(d,p,u)}catch{u=Math.floor(u/2)}return l.stringifyByChar(d)}e.applyFromCharCode=h;function c(d,u){for(var p=0;p<d.length;p++)u[p]=d[p];return u}var f={};f.string={string:a,array:function(d){return o(d,new Array(d.length))},arraybuffer:function(d){return f.string.uint8array(d).buffer},uint8array:function(d){return o(d,new Uint8Array(d.length))},nodebuffer:function(d){return o(d,r.allocBuffer(d.length))}},f.array={string:h,array:a,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return r.newBufferFrom(d)}},f.arraybuffer={string:function(d){return h(new Uint8Array(d))},array:function(d){return c(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:a,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return r.newBufferFrom(new Uint8Array(d))}},f.uint8array={string:h,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:a,nodebuffer:function(d){return r.newBufferFrom(d)}},f.nodebuffer={string:h,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return f.nodebuffer.uint8array(d).buffer},uint8array:function(d){return c(d,new Uint8Array(d.length))},nodebuffer:a},e.transformTo=function(d,u){if(u||(u=""),!d)return u;e.checkSupport(d);var p=e.getTypeOf(u),_=f[p][d](u);return _},e.resolve=function(d){for(var u=d.split("/"),p=[],_=0;_<u.length;_++){var g=u[_];g==="."||g===""&&_!==0&&_!==u.length-1||(g===".."?p.pop():p.push(g))}return p.join("/")},e.getTypeOf=function(d){if(typeof d=="string")return"string";if(Object.prototype.toString.call(d)==="[object Array]")return"array";if(t.nodebuffer&&r.isBuffer(d))return"nodebuffer";if(t.uint8array&&d instanceof Uint8Array)return"uint8array";if(t.arraybuffer&&d instanceof ArrayBuffer)return"arraybuffer"},e.checkSupport=function(d){var u=t[d.toLowerCase()];if(!u)throw new Error(d+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(d){var u="",p,_;for(_=0;_<(d||"").length;_++)p=d.charCodeAt(_),u+="\\x"+(p<16?"0":"")+p.toString(16).toUpperCase();return u},e.delay=function(d,u,p){setImmediate(function(){d.apply(p||null,u||[])})},e.inherits=function(d,u){var p=function(){};p.prototype=u.prototype,d.prototype=new p},e.extend=function(){var d={},u,p;for(u=0;u<arguments.length;u++)for(p in arguments[u])Object.prototype.hasOwnProperty.call(arguments[u],p)&&typeof d[p]>"u"&&(d[p]=arguments[u][p]);return d},e.prepareContent=function(d,u,p,_,g){var b=s.Promise.resolve(u).then(function(m){var O=t.blob&&(m instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(m))!==-1);return O&&typeof FileReader<"u"?new s.Promise(function(y,x){var E=new FileReader;E.onload=function(w){y(w.target.result)},E.onerror=function(w){x(w.target.error)},E.readAsArrayBuffer(m)}):m});return b.then(function(m){var O=e.getTypeOf(m);return O?(O==="arraybuffer"?m=e.transformTo("uint8array",m):O==="string"&&(g?m=i.decode(m):p&&_!==!0&&(m=n(m))),m):s.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}}),mn=Ke((e,t)=>{"use strict";function i(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return this.isFinished?!1:(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,s){return this._listeners[r].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,s){if(this._listeners[r])for(var n=0;n<this._listeners[r].length;n++)this._listeners[r][n].call(this,s)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var s=this;return r.on("data",function(n){s.processChunk(n)}),r.on("end",function(){s.end()}),r.on("error",function(n){s.error(n)}),this},pause:function(){return this.isPaused||this.isFinished?!1:(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var r=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,s){return this.extraStreamInfo[r]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},t.exports=i}),Md=Ke(e=>{"use strict";var t=nr(),i=$o(),r=Og(),s=mn(),n=new Array(256);for(a=0;a<256;a++)n[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;var a;n[254]=n[254]=1;var o=function(d){var u,p,_,g,b,m=d.length,O=0;for(g=0;g<m;g++)p=d.charCodeAt(g),(p&64512)===55296&&g+1<m&&(_=d.charCodeAt(g+1),(_&64512)===56320&&(p=65536+(p-55296<<10)+(_-56320),g++)),O+=p<128?1:p<2048?2:p<65536?3:4;for(i.uint8array?u=new Uint8Array(O):u=new Array(O),b=0,g=0;b<O;g++)p=d.charCodeAt(g),(p&64512)===55296&&g+1<m&&(_=d.charCodeAt(g+1),(_&64512)===56320&&(p=65536+(p-55296<<10)+(_-56320),g++)),p<128?u[b++]=p:p<2048?(u[b++]=192|p>>>6,u[b++]=128|p&63):p<65536?(u[b++]=224|p>>>12,u[b++]=128|p>>>6&63,u[b++]=128|p&63):(u[b++]=240|p>>>18,u[b++]=128|p>>>12&63,u[b++]=128|p>>>6&63,u[b++]=128|p&63);return u},l=function(d,u){var p;for(u=u||d.length,u>d.length&&(u=d.length),p=u-1;p>=0&&(d[p]&192)===128;)p--;return p<0||p===0?u:p+n[d[p]]>u?p:u},h=function(d){var u,p,_,g,b=d.length,m=new Array(b*2);for(p=0,u=0;u<b;){if(_=d[u++],_<128){m[p++]=_;continue}if(g=n[_],g>4){m[p++]=65533,u+=g-1;continue}for(_&=g===2?31:g===3?15:7;g>1&&u<b;)_=_<<6|d[u++]&63,g--;if(g>1){m[p++]=65533;continue}_<65536?m[p++]=_:(_-=65536,m[p++]=55296|_>>10&1023,m[p++]=56320|_&1023)}return m.length!==p&&(m.subarray?m=m.subarray(0,p):m.length=p),t.applyFromCharCode(m)};e.utf8encode=function(d){return i.nodebuffer?r.newBufferFrom(d,"utf-8"):o(d)},e.utf8decode=function(d){return i.nodebuffer?t.transformTo("nodebuffer",d).toString("utf-8"):(d=t.transformTo(i.uint8array?"uint8array":"array",d),h(d))};function c(){s.call(this,"utf-8 decode"),this.leftOver=null}t.inherits(c,s),c.prototype.processChunk=function(d){var u=t.transformTo(i.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var p=u;u=new Uint8Array(p.length+this.leftOver.length),u.set(this.leftOver,0),u.set(p,this.leftOver.length)}else u=this.leftOver.concat(u);this.leftOver=null}var _=l(u),g=u;_!==u.length&&(i.uint8array?(g=u.subarray(0,_),this.leftOver=u.subarray(_,u.length)):(g=u.slice(0,_),this.leftOver=u.slice(_,u.length))),this.push({data:e.utf8decode(g),meta:d.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=c;function f(){s.call(this,"utf-8 encode")}t.inherits(f,s),f.prototype.processChunk=function(d){this.push({data:e.utf8encode(d.data),meta:d.meta})},e.Utf8EncodeWorker=f}),Lk=Ke((e,t)=>{"use strict";var i=mn(),r=nr();function s(n){i.call(this,"ConvertWorker to "+n),this.destType=n}r.inherits(s,i),s.prototype.processChunk=function(n){this.push({data:r.transformTo(this.destType,n.data),meta:n.meta})},t.exports=s}),Rk=Ke((e,t)=>{"use strict";var i=$3().Readable,r=nr();r.inherits(s,i);function s(n,a,o){i.call(this,a),this._helper=n;var l=this;n.on("data",function(h,c){l.push(h)||l._helper.pause(),o&&o(c)}).on("error",function(h){l.emit("error",h)}).on("end",function(){l.push(null)})}s.prototype._read=function(){this._helper.resume()},t.exports=s}),ew=Ke((e,t)=>{"use strict";var i=nr(),r=Lk(),s=mn(),n=Q3(),a=$o(),o=Dd(),l=null;if(a.nodestream)try{l=Rk()}catch{}function h(u,p,_){switch(u){case"blob":return i.newBlob(i.transformTo("arraybuffer",p),_);case"base64":return n.encode(p);default:return i.transformTo(u,p)}}function c(u,p){var _,g=0,b=null,m=0;for(_=0;_<p.length;_++)m+=p[_].length;switch(u){case"string":return p.join("");case"array":return Array.prototype.concat.apply([],p);case"uint8array":for(b=new Uint8Array(m),_=0;_<p.length;_++)b.set(p[_],g),g+=p[_].length;return b;case"nodebuffer":return Buffer.concat(p);default:throw new Error("concat : unsupported type '"+u+"'")}}function f(u,p){return new o.Promise(function(_,g){var b=[],m=u._internalType,O=u._outputType,y=u._mimeType;u.on("data",function(x,E){b.push(x),p&&p(E)}).on("error",function(x){b=[],g(x)}).on("end",function(){try{var x=h(O,c(m,b),y);_(x)}catch(E){g(E)}b=[]}).resume()})}function d(u,p,_){var g=p;switch(p){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string";break}try{this._internalType=g,this._outputType=p,this._mimeType=_,i.checkSupport(g),this._worker=u.pipe(new r(g)),u.lock()}catch(b){this._worker=new s("error"),this._worker.error(b)}}d.prototype={accumulate:function(u){return f(this,u)},on:function(u,p){var _=this;return u==="data"?this._worker.on(u,function(g){p.call(_,g.data,g.meta)}):this._worker.on(u,function(){i.delay(p,arguments,_)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(u){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:this._outputType!=="nodebuffer"},u)}},t.exports=d}),tw=Ke(e=>{"use strict";e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null}),iw=Ke((e,t)=>{"use strict";var i=nr(),r=mn(),s=16*1024;function n(a){r.call(this,"DataWorker");var o=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(l){o.dataIsReady=!0,o.data=l,o.max=l&&l.length||0,o.type=i.getTypeOf(l),o.isPaused||o._tickAndRepeat()},function(l){o.error(l)})}i.inherits(n,r),n.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return r.prototype.resume.call(this)?(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0):!1},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,!(this.isPaused||this.isFinished)&&(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=s,o=null,l=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();switch(this.type){case"string":o=this.data.substring(this.index,l);break;case"uint8array":o=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":o=this.data.slice(this.index,l);break}return this.index=l,this.push({data:o,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=n}),S1=Ke((e,t)=>{"use strict";var i=nr();function r(){for(var o,l=[],h=0;h<256;h++){o=h;for(var c=0;c<8;c++)o=o&1?3988292384^o>>>1:o>>>1;l[h]=o}return l}var s=r();function n(o,l,h,c){var f=s,d=c+h;o=o^-1;for(var u=c;u<d;u++)o=o>>>8^f[(o^l[u])&255];return o^-1}function a(o,l,h,c){var f=s,d=c+h;o=o^-1;for(var u=c;u<d;u++)o=o>>>8^f[(o^l.charCodeAt(u))&255];return o^-1}t.exports=function(o,l){if(typeof o>"u"||!o.length)return 0;var h=i.getTypeOf(o)!=="string";return h?n(l|0,o,o.length,0):a(l|0,o,o.length,0)}}),rw=Ke((e,t)=>{"use strict";var i=mn(),r=S1(),s=nr();function n(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}s.inherits(n,i),n.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},t.exports=n}),Dk=Ke((e,t)=>{"use strict";var i=nr(),r=mn();function s(n){r.call(this,"DataLengthProbe for "+n),this.propName=n,this.withStreamInfo(n,0)}i.inherits(s,r),s.prototype.processChunk=function(n){if(n){var a=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=a+n.data.length}r.prototype.processChunk.call(this,n)},t.exports=s}),I1=Ke((e,t)=>{"use strict";var i=Dd(),r=iw(),s=rw(),n=Dk();function a(o,l,h,c,f){this.compressedSize=o,this.uncompressedSize=l,this.crc32=h,this.compression=c,this.compressedContent=f}a.prototype={getContentWorker:function(){var o=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new n("data_length")),l=this;return o.on("end",function(){if(this.streamInfo.data_length!==l.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),o},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(o,l,h){return o.pipe(new s).pipe(new n("uncompressedSize")).pipe(l.compressWorker(h)).pipe(new n("compressedSize")).withStreamInfo("compression",l)},t.exports=a}),Mk=Ke((e,t)=>{"use strict";var i=ew(),r=iw(),s=Md(),n=I1(),a=mn(),o=function(f,d,u){this.name=f,this.dir=u.dir,this.date=u.date,this.comment=u.comment,this.unixPermissions=u.unixPermissions,this.dosPermissions=u.dosPermissions,this._data=d,this._dataBinary=u.binary,this.options={compression:u.compression,compressionOptions:u.compressionOptions}};o.prototype={internalStream:function(f){var d=null,u="string";try{if(!f)throw new Error("No output type specified.");u=f.toLowerCase();var p=u==="string"||u==="text";(u==="binarystring"||u==="text")&&(u="string"),d=this._decompressWorker();var _=!this._dataBinary;_&&!p&&(d=d.pipe(new s.Utf8EncodeWorker)),!_&&p&&(d=d.pipe(new s.Utf8DecodeWorker))}catch(g){d=new a("error"),d.error(g)}return new i(d,u,"")},async:function(f,d){return this.internalStream(f).accumulate(d)},nodeStream:function(f,d){return this.internalStream(f||"nodebuffer").toNodejsStream(d)},_compressWorker:function(f,d){if(this._data instanceof n&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var u=this._decompressWorker();return this._dataBinary||(u=u.pipe(new s.Utf8EncodeWorker)),n.createWorkerFrom(u,f,d)},_decompressWorker:function(){return this._data instanceof n?this._data.getContentWorker():this._data instanceof a?this._data:new r(this._data)}};var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(c=0;c<l.length;c++)o.prototype[l[c]]=h;var c;t.exports=o}),Qo=Ke(e=>{"use strict";var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function i(n,a){return Object.prototype.hasOwnProperty.call(n,a)}e.assign=function(n){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var o=a.shift();if(o){if(typeof o!="object")throw new TypeError(o+"must be non-object");for(var l in o)i(o,l)&&(n[l]=o[l])}}return n},e.shrinkBuf=function(n,a){return n.length===a?n:n.subarray?n.subarray(0,a):(n.length=a,n)};var r={arraySet:function(n,a,o,l,h){if(a.subarray&&n.subarray){n.set(a.subarray(o,o+l),h);return}for(var c=0;c<l;c++)n[h+c]=a[o+c]},flattenChunks:function(n){var a,o,l,h,c,f;for(l=0,a=0,o=n.length;a<o;a++)l+=n[a].length;for(f=new Uint8Array(l),h=0,a=0,o=n.length;a<o;a++)c=n[a],f.set(c,h),h+=c.length;return f}},s={arraySet:function(n,a,o,l,h){for(var c=0;c<l;c++)n[h+c]=a[o+c]},flattenChunks:function(n){return[].concat.apply([],n)}};e.setTyped=function(n){n?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(t)}),Bk=Ke(e=>{"use strict";var t=Qo(),i=4,r=0,s=1,n=2;function a(A){for(var F=A.length;--F>=0;)A[F]=0}var o=0,l=1,h=2,c=3,f=258,d=29,u=256,p=u+1+d,_=30,g=19,b=2*p+1,m=15,O=16,y=7,x=256,E=16,w=17,S=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],G=512,z=new Array((p+2)*2);a(z);var q=new Array(_*2);a(q);var L=new Array(G);a(L);var M=new Array(f-c+1);a(M);var v=new Array(d);a(v);var P=new Array(_);a(P);function I(A,F,V,Q,W){this.static_tree=A,this.extra_bits=F,this.extra_base=V,this.elems=Q,this.max_length=W,this.has_stree=A&&A.length}var N,D,j;function H(A,F){this.dyn_tree=A,this.max_code=0,this.stat_desc=F}function K(A){return A<256?L[A]:L[256+(A>>>7)]}function se(A,F){A.pending_buf[A.pending++]=F&255,A.pending_buf[A.pending++]=F>>>8&255}function he(A,F,V){A.bi_valid>O-V?(A.bi_buf|=F<<A.bi_valid&65535,se(A,A.bi_buf),A.bi_buf=F>>O-A.bi_valid,A.bi_valid+=V-O):(A.bi_buf|=F<<A.bi_valid&65535,A.bi_valid+=V)}function _e(A,F,V){he(A,V[F*2],V[F*2+1])}function ve(A,F){var V=0;do V|=A&1,A>>>=1,V<<=1;while(--F>0);return V>>>1}function J(A){A.bi_valid===16?(se(A,A.bi_buf),A.bi_buf=0,A.bi_valid=0):A.bi_valid>=8&&(A.pending_buf[A.pending++]=A.bi_buf&255,A.bi_buf>>=8,A.bi_valid-=8)}function Z(A,F){var V=F.dyn_tree,Q=F.max_code,W=F.stat_desc.static_tree,ne=F.stat_desc.has_stree,X=F.stat_desc.extra_bits,Ee=F.stat_desc.extra_base,Me=F.stat_desc.max_length,U,be,Ne,$,fe,Se,ze=0;for($=0;$<=m;$++)A.bl_count[$]=0;for(V[A.heap[A.heap_max]*2+1]=0,U=A.heap_max+1;U<b;U++)be=A.heap[U],$=V[V[be*2+1]*2+1]+1,$>Me&&($=Me,ze++),V[be*2+1]=$,!(be>Q)&&(A.bl_count[$]++,fe=0,be>=Ee&&(fe=X[be-Ee]),Se=V[be*2],A.opt_len+=Se*($+fe),ne&&(A.static_len+=Se*(W[be*2+1]+fe)));if(ze!==0){do{for($=Me-1;A.bl_count[$]===0;)$--;A.bl_count[$]--,A.bl_count[$+1]+=2,A.bl_count[Me]--,ze-=2}while(ze>0);for($=Me;$!==0;$--)for(be=A.bl_count[$];be!==0;)Ne=A.heap[--U],!(Ne>Q)&&(V[Ne*2+1]!==$&&(A.opt_len+=($-V[Ne*2+1])*V[Ne*2],V[Ne*2+1]=$),be--)}}function re(A,F,V){var Q=new Array(m+1),W=0,ne,X;for(ne=1;ne<=m;ne++)Q[ne]=W=W+V[ne-1]<<1;for(X=0;X<=F;X++){var Ee=A[X*2+1];Ee!==0&&(A[X*2]=ve(Q[Ee]++,Ee))}}function ue(){var A,F,V,Q,W,ne=new Array(m+1);for(V=0,Q=0;Q<d-1;Q++)for(v[Q]=V,A=0;A<1<<C[Q];A++)M[V++]=Q;for(M[V-1]=Q,W=0,Q=0;Q<16;Q++)for(P[Q]=W,A=0;A<1<<R[Q];A++)L[W++]=Q;for(W>>=7;Q<_;Q++)for(P[Q]=W<<7,A=0;A<1<<R[Q]-7;A++)L[256+W++]=Q;for(F=0;F<=m;F++)ne[F]=0;for(A=0;A<=143;)z[A*2+1]=8,A++,ne[8]++;for(;A<=255;)z[A*2+1]=9,A++,ne[9]++;for(;A<=279;)z[A*2+1]=7,A++,ne[7]++;for(;A<=287;)z[A*2+1]=8,A++,ne[8]++;for(re(z,p+1,ne),A=0;A<_;A++)q[A*2+1]=5,q[A*2]=ve(A,5);N=new I(z,C,u+1,p,m),D=new I(q,R,0,_,m),j=new I(new Array(0),B,0,g,y)}function Le(A){var F;for(F=0;F<p;F++)A.dyn_ltree[F*2]=0;for(F=0;F<_;F++)A.dyn_dtree[F*2]=0;for(F=0;F<g;F++)A.bl_tree[F*2]=0;A.dyn_ltree[x*2]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function Ce(A){A.bi_valid>8?se(A,A.bi_buf):A.bi_valid>0&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function De(A,F,V,Q){Ce(A),Q&&(se(A,V),se(A,~V)),t.arraySet(A.pending_buf,A.window,F,V,A.pending),A.pending+=V}function Pe(A,F,V,Q){var W=F*2,ne=V*2;return A[W]<A[ne]||A[W]===A[ne]&&Q[F]<=Q[V]}function Ie(A,F,V){for(var Q=A.heap[V],W=V<<1;W<=A.heap_len&&(W<A.heap_len&&Pe(F,A.heap[W+1],A.heap[W],A.depth)&&W++,!Pe(F,Q,A.heap[W],A.depth));)A.heap[V]=A.heap[W],V=W,W<<=1;A.heap[V]=Q}function Je(A,F,V){var Q,W,ne=0,X,Ee;if(A.last_lit!==0)do Q=A.pending_buf[A.d_buf+ne*2]<<8|A.pending_buf[A.d_buf+ne*2+1],W=A.pending_buf[A.l_buf+ne],ne++,Q===0?_e(A,W,F):(X=M[W],_e(A,X+u+1,F),Ee=C[X],Ee!==0&&(W-=v[X],he(A,W,Ee)),Q--,X=K(Q),_e(A,X,V),Ee=R[X],Ee!==0&&(Q-=P[X],he(A,Q,Ee)));while(ne<A.last_lit);_e(A,x,F)}function $e(A,F){var V=F.dyn_tree,Q=F.stat_desc.static_tree,W=F.stat_desc.has_stree,ne=F.stat_desc.elems,X,Ee,Me=-1,U;for(A.heap_len=0,A.heap_max=b,X=0;X<ne;X++)V[X*2]!==0?(A.heap[++A.heap_len]=Me=X,A.depth[X]=0):V[X*2+1]=0;for(;A.heap_len<2;)U=A.heap[++A.heap_len]=Me<2?++Me:0,V[U*2]=1,A.depth[U]=0,A.opt_len--,W&&(A.static_len-=Q[U*2+1]);for(F.max_code=Me,X=A.heap_len>>1;X>=1;X--)Ie(A,V,X);U=ne;do X=A.heap[1],A.heap[1]=A.heap[A.heap_len--],Ie(A,V,1),Ee=A.heap[1],A.heap[--A.heap_max]=X,A.heap[--A.heap_max]=Ee,V[U*2]=V[X*2]+V[Ee*2],A.depth[U]=(A.depth[X]>=A.depth[Ee]?A.depth[X]:A.depth[Ee])+1,V[X*2+1]=V[Ee*2+1]=U,A.heap[1]=U++,Ie(A,V,1);while(A.heap_len>=2);A.heap[--A.heap_max]=A.heap[1],Z(A,F),re(V,Me,A.bl_count)}function pt(A,F,V){var Q,W=-1,ne,X=F[1],Ee=0,Me=7,U=4;for(X===0&&(Me=138,U=3),F[(V+1)*2+1]=65535,Q=0;Q<=V;Q++)ne=X,X=F[(Q+1)*2+1],!(++Ee<Me&&ne===X)&&(Ee<U?A.bl_tree[ne*2]+=Ee:ne!==0?(ne!==W&&A.bl_tree[ne*2]++,A.bl_tree[E*2]++):Ee<=10?A.bl_tree[w*2]++:A.bl_tree[S*2]++,Ee=0,W=ne,X===0?(Me=138,U=3):ne===X?(Me=6,U=3):(Me=7,U=4))}function ct(A,F,V){var Q,W=-1,ne,X=F[1],Ee=0,Me=7,U=4;for(X===0&&(Me=138,U=3),Q=0;Q<=V;Q++)if(ne=X,X=F[(Q+1)*2+1],!(++Ee<Me&&ne===X)){if(Ee<U)do _e(A,ne,A.bl_tree);while(--Ee!==0);else ne!==0?(ne!==W&&(_e(A,ne,A.bl_tree),Ee--),_e(A,E,A.bl_tree),he(A,Ee-3,2)):Ee<=10?(_e(A,w,A.bl_tree),he(A,Ee-3,3)):(_e(A,S,A.bl_tree),he(A,Ee-11,7));Ee=0,W=ne,X===0?(Me=138,U=3):ne===X?(Me=6,U=3):(Me=7,U=4)}}function ut(A){var F;for(pt(A,A.dyn_ltree,A.l_desc.max_code),pt(A,A.dyn_dtree,A.d_desc.max_code),$e(A,A.bl_desc),F=g-1;F>=3&&A.bl_tree[Y[F]*2+1]===0;F--);return A.opt_len+=3*(F+1)+5+5+4,F}function si(A,F,V,Q){var W;for(he(A,F-257,5),he(A,V-1,5),he(A,Q-4,4),W=0;W<Q;W++)he(A,A.bl_tree[Y[W]*2+1],3);ct(A,A.dyn_ltree,F-1),ct(A,A.dyn_dtree,V-1)}function mi(A){var F=4093624447,V;for(V=0;V<=31;V++,F>>>=1)if(F&1&&A.dyn_ltree[V*2]!==0)return r;if(A.dyn_ltree[18]!==0||A.dyn_ltree[20]!==0||A.dyn_ltree[26]!==0)return s;for(V=32;V<u;V++)if(A.dyn_ltree[V*2]!==0)return s;return r}var It=!1;function jt(A){It||(ue(),It=!0),A.l_desc=new H(A.dyn_ltree,N),A.d_desc=new H(A.dyn_dtree,D),A.bl_desc=new H(A.bl_tree,j),A.bi_buf=0,A.bi_valid=0,Le(A)}function Ai(A,F,V,Q){he(A,(o<<1)+(Q?1:0),3),De(A,F,V,!0)}function ni(A){he(A,l<<1,3),_e(A,x,z),J(A)}function T(A,F,V,Q){var W,ne,X=0;A.level>0?(A.strm.data_type===n&&(A.strm.data_type=mi(A)),$e(A,A.l_desc),$e(A,A.d_desc),X=ut(A),W=A.opt_len+3+7>>>3,ne=A.static_len+3+7>>>3,ne<=W&&(W=ne)):W=ne=V+5,V+4<=W&&F!==-1?Ai(A,F,V,Q):A.strategy===i||ne===W?(he(A,(l<<1)+(Q?1:0),3),Je(A,z,q)):(he(A,(h<<1)+(Q?1:0),3),si(A,A.l_desc.max_code+1,A.d_desc.max_code+1,X+1),Je(A,A.dyn_ltree,A.dyn_dtree)),Le(A),Q&&Ce(A)}function k(A,F,V){return A.pending_buf[A.d_buf+A.last_lit*2]=F>>>8&255,A.pending_buf[A.d_buf+A.last_lit*2+1]=F&255,A.pending_buf[A.l_buf+A.last_lit]=V&255,A.last_lit++,F===0?A.dyn_ltree[V*2]++:(A.matches++,F--,A.dyn_ltree[(M[V]+u+1)*2]++,A.dyn_dtree[K(F)*2]++),A.last_lit===A.lit_bufsize-1}e._tr_init=jt,e._tr_stored_block=Ai,e._tr_flush_block=T,e._tr_tally=k,e._tr_align=ni}),sw=Ke((e,t)=>{"use strict";function i(r,s,n,a){for(var o=r&65535|0,l=r>>>16&65535|0,h=0;n!==0;){h=n>2e3?2e3:n,n-=h;do o=o+s[a++]|0,l=l+o|0;while(--h);o%=65521,l%=65521}return o|l<<16|0}t.exports=i}),nw=Ke((e,t)=>{"use strict";function i(){for(var n,a=[],o=0;o<256;o++){n=o;for(var l=0;l<8;l++)n=n&1?3988292384^n>>>1:n>>>1;a[o]=n}return a}var r=i();function s(n,a,o,l){var h=r,c=l+o;n^=-1;for(var f=l;f<c;f++)n=n>>>8^h[(n^a[f])&255];return n^-1}t.exports=s}),P1=Ke((e,t)=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}),kk=Ke(e=>{"use strict";var t=Qo(),i=Bk(),r=sw(),s=nw(),n=P1(),a=0,o=1,l=3,h=4,c=5,f=0,d=1,u=-2,p=-3,_=-5,g=-1,b=1,m=2,O=3,y=4,x=0,E=2,w=8,S=9,C=15,R=8,B=29,Y=256,G=Y+1+B,z=30,q=19,L=2*G+1,M=15,v=3,P=258,I=P+v+1,N=32,D=42,j=69,H=73,K=91,se=103,he=113,_e=666,ve=1,J=2,Z=3,re=4,ue=3;function Le(U,be){return U.msg=n[be],be}function Ce(U){return(U<<1)-(U>4?9:0)}function De(U){for(var be=U.length;--be>=0;)U[be]=0}function Pe(U){var be=U.state,Ne=be.pending;Ne>U.avail_out&&(Ne=U.avail_out),Ne!==0&&(t.arraySet(U.output,be.pending_buf,be.pending_out,Ne,U.next_out),U.next_out+=Ne,be.pending_out+=Ne,U.total_out+=Ne,U.avail_out-=Ne,be.pending-=Ne,be.pending===0&&(be.pending_out=0))}function Ie(U,be){i._tr_flush_block(U,U.block_start>=0?U.block_start:-1,U.strstart-U.block_start,be),U.block_start=U.strstart,Pe(U.strm)}function Je(U,be){U.pending_buf[U.pending++]=be}function $e(U,be){U.pending_buf[U.pending++]=be>>>8&255,U.pending_buf[U.pending++]=be&255}function pt(U,be,Ne,$){var fe=U.avail_in;return fe>$&&(fe=$),fe===0?0:(U.avail_in-=fe,t.arraySet(be,U.input,U.next_in,fe,Ne),U.state.wrap===1?U.adler=r(U.adler,be,fe,Ne):U.state.wrap===2&&(U.adler=s(U.adler,be,fe,Ne)),U.next_in+=fe,U.total_in+=fe,fe)}function ct(U,be){var Ne=U.max_chain_length,$=U.strstart,fe,Se,ze=U.prev_length,Ue=U.nice_match,je=U.strstart>U.w_size-I?U.strstart-(U.w_size-I):0,Dt=U.window,Ts=U.w_mask,ft=U.prev,dt=U.strstart+P,Li=Dt[$+ze-1],fr=Dt[$+ze];U.prev_length>=U.good_match&&(Ne>>=2),Ue>U.lookahead&&(Ue=U.lookahead);do if(fe=be,!(Dt[fe+ze]!==fr||Dt[fe+ze-1]!==Li||Dt[fe]!==Dt[$]||Dt[++fe]!==Dt[$+1])){$+=2,fe++;do;while(Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&Dt[++$]===Dt[++fe]&&$<dt);if(Se=P-(dt-$),$=dt-P,Se>ze){if(U.match_start=be,ze=Se,Se>=Ue)break;Li=Dt[$+ze-1],fr=Dt[$+ze]}}while((be=ft[be&Ts])>je&&--Ne!==0);return ze<=U.lookahead?ze:U.lookahead}function ut(U){var be=U.w_size,Ne,$,fe,Se,ze;do{if(Se=U.window_size-U.lookahead-U.strstart,U.strstart>=be+(be-I)){t.arraySet(U.window,U.window,be,be,0),U.match_start-=be,U.strstart-=be,U.block_start-=be,$=U.hash_size,Ne=$;do fe=U.head[--Ne],U.head[Ne]=fe>=be?fe-be:0;while(--$);$=be,Ne=$;do fe=U.prev[--Ne],U.prev[Ne]=fe>=be?fe-be:0;while(--$);Se+=be}if(U.strm.avail_in===0)break;if($=pt(U.strm,U.window,U.strstart+U.lookahead,Se),U.lookahead+=$,U.lookahead+U.insert>=v)for(ze=U.strstart-U.insert,U.ins_h=U.window[ze],U.ins_h=(U.ins_h<<U.hash_shift^U.window[ze+1])&U.hash_mask;U.insert&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[ze+v-1])&U.hash_mask,U.prev[ze&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=ze,ze++,U.insert--,!(U.lookahead+U.insert<v)););}while(U.lookahead<I&&U.strm.avail_in!==0)}function si(U,be){var Ne=65535;for(Ne>U.pending_buf_size-5&&(Ne=U.pending_buf_size-5);;){if(U.lookahead<=1){if(ut(U),U.lookahead===0&&be===a)return ve;if(U.lookahead===0)break}U.strstart+=U.lookahead,U.lookahead=0;var $=U.block_start+Ne;if((U.strstart===0||U.strstart>=$)&&(U.lookahead=U.strstart-$,U.strstart=$,Ie(U,!1),U.strm.avail_out===0)||U.strstart-U.block_start>=U.w_size-I&&(Ie(U,!1),U.strm.avail_out===0))return ve}return U.insert=0,be===h?(Ie(U,!0),U.strm.avail_out===0?Z:re):(U.strstart>U.block_start&&(Ie(U,!1),U.strm.avail_out),ve)}function mi(U,be){for(var Ne,$;;){if(U.lookahead<I){if(ut(U),U.lookahead<I&&be===a)return ve;if(U.lookahead===0)break}if(Ne=0,U.lookahead>=v&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+v-1])&U.hash_mask,Ne=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),Ne!==0&&U.strstart-Ne<=U.w_size-I&&(U.match_length=ct(U,Ne)),U.match_length>=v)if($=i._tr_tally(U,U.strstart-U.match_start,U.match_length-v),U.lookahead-=U.match_length,U.match_length<=U.max_lazy_match&&U.lookahead>=v){U.match_length--;do U.strstart++,U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+v-1])&U.hash_mask,Ne=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart;while(--U.match_length!==0);U.strstart++}else U.strstart+=U.match_length,U.match_length=0,U.ins_h=U.window[U.strstart],U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+1])&U.hash_mask;else $=i._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++;if($&&(Ie(U,!1),U.strm.avail_out===0))return ve}return U.insert=U.strstart<v-1?U.strstart:v-1,be===h?(Ie(U,!0),U.strm.avail_out===0?Z:re):U.last_lit&&(Ie(U,!1),U.strm.avail_out===0)?ve:J}function It(U,be){for(var Ne,$,fe;;){if(U.lookahead<I){if(ut(U),U.lookahead<I&&be===a)return ve;if(U.lookahead===0)break}if(Ne=0,U.lookahead>=v&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+v-1])&U.hash_mask,Ne=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart),U.prev_length=U.match_length,U.prev_match=U.match_start,U.match_length=v-1,Ne!==0&&U.prev_length<U.max_lazy_match&&U.strstart-Ne<=U.w_size-I&&(U.match_length=ct(U,Ne),U.match_length<=5&&(U.strategy===b||U.match_length===v&&U.strstart-U.match_start>4096)&&(U.match_length=v-1)),U.prev_length>=v&&U.match_length<=U.prev_length){fe=U.strstart+U.lookahead-v,$=i._tr_tally(U,U.strstart-1-U.prev_match,U.prev_length-v),U.lookahead-=U.prev_length-1,U.prev_length-=2;do++U.strstart<=fe&&(U.ins_h=(U.ins_h<<U.hash_shift^U.window[U.strstart+v-1])&U.hash_mask,Ne=U.prev[U.strstart&U.w_mask]=U.head[U.ins_h],U.head[U.ins_h]=U.strstart);while(--U.prev_length!==0);if(U.match_available=0,U.match_length=v-1,U.strstart++,$&&(Ie(U,!1),U.strm.avail_out===0))return ve}else if(U.match_available){if($=i._tr_tally(U,0,U.window[U.strstart-1]),$&&Ie(U,!1),U.strstart++,U.lookahead--,U.strm.avail_out===0)return ve}else U.match_available=1,U.strstart++,U.lookahead--}return U.match_available&&($=i._tr_tally(U,0,U.window[U.strstart-1]),U.match_available=0),U.insert=U.strstart<v-1?U.strstart:v-1,be===h?(Ie(U,!0),U.strm.avail_out===0?Z:re):U.last_lit&&(Ie(U,!1),U.strm.avail_out===0)?ve:J}function jt(U,be){for(var Ne,$,fe,Se,ze=U.window;;){if(U.lookahead<=P){if(ut(U),U.lookahead<=P&&be===a)return ve;if(U.lookahead===0)break}if(U.match_length=0,U.lookahead>=v&&U.strstart>0&&(fe=U.strstart-1,$=ze[fe],$===ze[++fe]&&$===ze[++fe]&&$===ze[++fe])){Se=U.strstart+P;do;while($===ze[++fe]&&$===ze[++fe]&&$===ze[++fe]&&$===ze[++fe]&&$===ze[++fe]&&$===ze[++fe]&&$===ze[++fe]&&$===ze[++fe]&&fe<Se);U.match_length=P-(Se-fe),U.match_length>U.lookahead&&(U.match_length=U.lookahead)}if(U.match_length>=v?(Ne=i._tr_tally(U,1,U.match_length-v),U.lookahead-=U.match_length,U.strstart+=U.match_length,U.match_length=0):(Ne=i._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++),Ne&&(Ie(U,!1),U.strm.avail_out===0))return ve}return U.insert=0,be===h?(Ie(U,!0),U.strm.avail_out===0?Z:re):U.last_lit&&(Ie(U,!1),U.strm.avail_out===0)?ve:J}function Ai(U,be){for(var Ne;;){if(U.lookahead===0&&(ut(U),U.lookahead===0)){if(be===a)return ve;break}if(U.match_length=0,Ne=i._tr_tally(U,0,U.window[U.strstart]),U.lookahead--,U.strstart++,Ne&&(Ie(U,!1),U.strm.avail_out===0))return ve}return U.insert=0,be===h?(Ie(U,!0),U.strm.avail_out===0?Z:re):U.last_lit&&(Ie(U,!1),U.strm.avail_out===0)?ve:J}function ni(U,be,Ne,$,fe){this.good_length=U,this.max_lazy=be,this.nice_length=Ne,this.max_chain=$,this.func=fe}var T;T=[new ni(0,0,0,0,si),new ni(4,4,8,4,mi),new ni(4,5,16,8,mi),new ni(4,6,32,32,mi),new ni(4,4,16,16,It),new ni(8,16,32,32,It),new ni(8,16,128,128,It),new ni(8,32,128,256,It),new ni(32,128,258,1024,It),new ni(32,258,258,4096,It)];function k(U){U.window_size=2*U.w_size,De(U.head),U.max_lazy_match=T[U.level].max_lazy,U.good_match=T[U.level].good_length,U.nice_match=T[U.level].nice_length,U.max_chain_length=T[U.level].max_chain,U.strstart=0,U.block_start=0,U.lookahead=0,U.insert=0,U.match_length=U.prev_length=v-1,U.match_available=0,U.ins_h=0}function A(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new t.Buf16(L*2),this.dyn_dtree=new t.Buf16((2*z+1)*2),this.bl_tree=new t.Buf16((2*q+1)*2),De(this.dyn_ltree),De(this.dyn_dtree),De(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new t.Buf16(M+1),this.heap=new t.Buf16(2*G+1),De(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new t.Buf16(2*G+1),De(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function F(U){var be;return!U||!U.state?Le(U,u):(U.total_in=U.total_out=0,U.data_type=E,be=U.state,be.pending=0,be.pending_out=0,be.wrap<0&&(be.wrap=-be.wrap),be.status=be.wrap?D:he,U.adler=be.wrap===2?0:1,be.last_flush=a,i._tr_init(be),f)}function V(U){var be=F(U);return be===f&&k(U.state),be}function Q(U,be){return!U||!U.state||U.state.wrap!==2?u:(U.state.gzhead=be,f)}function W(U,be,Ne,$,fe,Se){if(!U)return u;var ze=1;if(be===g&&(be=6),$<0?(ze=0,$=-$):$>15&&(ze=2,$-=16),fe<1||fe>S||Ne!==w||$<8||$>15||be<0||be>9||Se<0||Se>y)return Le(U,u);$===8&&($=9);var Ue=new A;return U.state=Ue,Ue.strm=U,Ue.wrap=ze,Ue.gzhead=null,Ue.w_bits=$,Ue.w_size=1<<Ue.w_bits,Ue.w_mask=Ue.w_size-1,Ue.hash_bits=fe+7,Ue.hash_size=1<<Ue.hash_bits,Ue.hash_mask=Ue.hash_size-1,Ue.hash_shift=~~((Ue.hash_bits+v-1)/v),Ue.window=new t.Buf8(Ue.w_size*2),Ue.head=new t.Buf16(Ue.hash_size),Ue.prev=new t.Buf16(Ue.w_size),Ue.lit_bufsize=1<<fe+6,Ue.pending_buf_size=Ue.lit_bufsize*4,Ue.pending_buf=new t.Buf8(Ue.pending_buf_size),Ue.d_buf=1*Ue.lit_bufsize,Ue.l_buf=3*Ue.lit_bufsize,Ue.level=be,Ue.strategy=Se,Ue.method=Ne,V(U)}function ne(U,be){return W(U,be,w,C,R,x)}function X(U,be){var Ne,$,fe,Se;if(!U||!U.state||be>c||be<0)return U?Le(U,u):u;if($=U.state,!U.output||!U.input&&U.avail_in!==0||$.status===_e&&be!==h)return Le(U,U.avail_out===0?_:u);if($.strm=U,Ne=$.last_flush,$.last_flush=be,$.status===D)if($.wrap===2)U.adler=0,Je($,31),Je($,139),Je($,8),$.gzhead?(Je($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),Je($,$.gzhead.time&255),Je($,$.gzhead.time>>8&255),Je($,$.gzhead.time>>16&255),Je($,$.gzhead.time>>24&255),Je($,$.level===9?2:$.strategy>=m||$.level<2?4:0),Je($,$.gzhead.os&255),$.gzhead.extra&&$.gzhead.extra.length&&(Je($,$.gzhead.extra.length&255),Je($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(U.adler=s(U.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=j):(Je($,0),Je($,0),Je($,0),Je($,0),Je($,0),Je($,$.level===9?2:$.strategy>=m||$.level<2?4:0),Je($,ue),$.status=he);else{var ze=w+($.w_bits-8<<4)<<8,Ue=-1;$.strategy>=m||$.level<2?Ue=0:$.level<6?Ue=1:$.level===6?Ue=2:Ue=3,ze|=Ue<<6,$.strstart!==0&&(ze|=N),ze+=31-ze%31,$.status=he,$e($,ze),$.strstart!==0&&($e($,U.adler>>>16),$e($,U.adler&65535)),U.adler=1}if($.status===j)if($.gzhead.extra){for(fe=$.pending;$.gzindex<($.gzhead.extra.length&65535)&&!($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>fe&&(U.adler=s(U.adler,$.pending_buf,$.pending-fe,fe)),Pe(U),fe=$.pending,$.pending===$.pending_buf_size));)Je($,$.gzhead.extra[$.gzindex]&255),$.gzindex++;$.gzhead.hcrc&&$.pending>fe&&(U.adler=s(U.adler,$.pending_buf,$.pending-fe,fe)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=H)}else $.status=H;if($.status===H)if($.gzhead.name){fe=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>fe&&(U.adler=s(U.adler,$.pending_buf,$.pending-fe,fe)),Pe(U),fe=$.pending,$.pending===$.pending_buf_size)){Se=1;break}$.gzindex<$.gzhead.name.length?Se=$.gzhead.name.charCodeAt($.gzindex++)&255:Se=0,Je($,Se)}while(Se!==0);$.gzhead.hcrc&&$.pending>fe&&(U.adler=s(U.adler,$.pending_buf,$.pending-fe,fe)),Se===0&&($.gzindex=0,$.status=K)}else $.status=K;if($.status===K)if($.gzhead.comment){fe=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>fe&&(U.adler=s(U.adler,$.pending_buf,$.pending-fe,fe)),Pe(U),fe=$.pending,$.pending===$.pending_buf_size)){Se=1;break}$.gzindex<$.gzhead.comment.length?Se=$.gzhead.comment.charCodeAt($.gzindex++)&255:Se=0,Je($,Se)}while(Se!==0);$.gzhead.hcrc&&$.pending>fe&&(U.adler=s(U.adler,$.pending_buf,$.pending-fe,fe)),Se===0&&($.status=se)}else $.status=se;if($.status===se&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&Pe(U),$.pending+2<=$.pending_buf_size&&(Je($,U.adler&255),Je($,U.adler>>8&255),U.adler=0,$.status=he)):$.status=he),$.pending!==0){if(Pe(U),U.avail_out===0)return $.last_flush=-1,f}else if(U.avail_in===0&&Ce(be)<=Ce(Ne)&&be!==h)return Le(U,_);if($.status===_e&&U.avail_in!==0)return Le(U,_);if(U.avail_in!==0||$.lookahead!==0||be!==a&&$.status!==_e){var je=$.strategy===m?Ai($,be):$.strategy===O?jt($,be):T[$.level].func($,be);if((je===Z||je===re)&&($.status=_e),je===ve||je===Z)return U.avail_out===0&&($.last_flush=-1),f;if(je===J&&(be===o?i._tr_align($):be!==c&&(i._tr_stored_block($,0,0,!1),be===l&&(De($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),Pe(U),U.avail_out===0))return $.last_flush=-1,f}return be!==h?f:$.wrap<=0?d:($.wrap===2?(Je($,U.adler&255),Je($,U.adler>>8&255),Je($,U.adler>>16&255),Je($,U.adler>>24&255),Je($,U.total_in&255),Je($,U.total_in>>8&255),Je($,U.total_in>>16&255),Je($,U.total_in>>24&255)):($e($,U.adler>>>16),$e($,U.adler&65535)),Pe(U),$.wrap>0&&($.wrap=-$.wrap),$.pending!==0?f:d)}function Ee(U){var be;return!U||!U.state?u:(be=U.state.status,be!==D&&be!==j&&be!==H&&be!==K&&be!==se&&be!==he&&be!==_e?Le(U,u):(U.state=null,be===he?Le(U,p):f))}function Me(U,be){var Ne=be.length,$,fe,Se,ze,Ue,je,Dt,Ts;if(!U||!U.state||($=U.state,ze=$.wrap,ze===2||ze===1&&$.status!==D||$.lookahead))return u;for(ze===1&&(U.adler=r(U.adler,be,Ne,0)),$.wrap=0,Ne>=$.w_size&&(ze===0&&(De($.head),$.strstart=0,$.block_start=0,$.insert=0),Ts=new t.Buf8($.w_size),t.arraySet(Ts,be,Ne-$.w_size,$.w_size,0),be=Ts,Ne=$.w_size),Ue=U.avail_in,je=U.next_in,Dt=U.input,U.avail_in=Ne,U.next_in=0,U.input=be,ut($);$.lookahead>=v;){fe=$.strstart,Se=$.lookahead-(v-1);do $.ins_h=($.ins_h<<$.hash_shift^$.window[fe+v-1])&$.hash_mask,$.prev[fe&$.w_mask]=$.head[$.ins_h],$.head[$.ins_h]=fe,fe++;while(--Se);$.strstart=fe,$.lookahead=v-1,ut($)}return $.strstart+=$.lookahead,$.block_start=$.strstart,$.insert=$.lookahead,$.lookahead=0,$.match_length=$.prev_length=v-1,$.match_available=0,U.next_in=je,U.input=Dt,U.avail_in=Ue,$.wrap=ze,f}e.deflateInit=ne,e.deflateInit2=W,e.deflateReset=V,e.deflateResetKeep=F,e.deflateSetHeader=Q,e.deflate=X,e.deflateEnd=Ee,e.deflateSetDictionary=Me,e.deflateInfo="pako deflate (from Nodeca project)"}),aw=Ke(e=>{"use strict";var t=Qo(),i=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}var s=new t.Buf8(256);for(n=0;n<256;n++)s[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;var n;s[254]=s[254]=1,e.string2buf=function(o){var l,h,c,f,d,u=o.length,p=0;for(f=0;f<u;f++)h=o.charCodeAt(f),(h&64512)===55296&&f+1<u&&(c=o.charCodeAt(f+1),(c&64512)===56320&&(h=65536+(h-55296<<10)+(c-56320),f++)),p+=h<128?1:h<2048?2:h<65536?3:4;for(l=new t.Buf8(p),d=0,f=0;d<p;f++)h=o.charCodeAt(f),(h&64512)===55296&&f+1<u&&(c=o.charCodeAt(f+1),(c&64512)===56320&&(h=65536+(h-55296<<10)+(c-56320),f++)),h<128?l[d++]=h:h<2048?(l[d++]=192|h>>>6,l[d++]=128|h&63):h<65536?(l[d++]=224|h>>>12,l[d++]=128|h>>>6&63,l[d++]=128|h&63):(l[d++]=240|h>>>18,l[d++]=128|h>>>12&63,l[d++]=128|h>>>6&63,l[d++]=128|h&63);return l};function a(o,l){if(l<65534&&(o.subarray&&r||!o.subarray&&i))return String.fromCharCode.apply(null,t.shrinkBuf(o,l));for(var h="",c=0;c<l;c++)h+=String.fromCharCode(o[c]);return h}e.buf2binstring=function(o){return a(o,o.length)},e.binstring2buf=function(o){for(var l=new t.Buf8(o.length),h=0,c=l.length;h<c;h++)l[h]=o.charCodeAt(h);return l},e.buf2string=function(o,l){var h,c,f,d,u=l||o.length,p=new Array(u*2);for(c=0,h=0;h<u;){if(f=o[h++],f<128){p[c++]=f;continue}if(d=s[f],d>4){p[c++]=65533,h+=d-1;continue}for(f&=d===2?31:d===3?15:7;d>1&&h<u;)f=f<<6|o[h++]&63,d--;if(d>1){p[c++]=65533;continue}f<65536?p[c++]=f:(f-=65536,p[c++]=55296|f>>10&1023,p[c++]=56320|f&1023)}return a(p,c)},e.utf8border=function(o,l){var h;for(l=l||o.length,l>o.length&&(l=o.length),h=l-1;h>=0&&(o[h]&192)===128;)h--;return h<0||h===0?l:h+s[o[h]]>l?h:l}}),ow=Ke((e,t)=>{"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i}),Uk=Ke(e=>{"use strict";var t=kk(),i=Qo(),r=aw(),s=P1(),n=ow(),a=Object.prototype.toString,o=0,l=4,h=0,c=1,f=2,d=-1,u=0,p=8;function _(O){if(!(this instanceof _))return new _(O);this.options=i.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},O||{});var y=this.options;y.raw&&y.windowBits>0?y.windowBits=-y.windowBits:y.gzip&&y.windowBits>0&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0;var x=t.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(x!==h)throw new Error(s[x]);if(y.header&&t.deflateSetHeader(this.strm,y.header),y.dictionary){var E;if(typeof y.dictionary=="string"?E=r.string2buf(y.dictionary):a.call(y.dictionary)==="[object ArrayBuffer]"?E=new Uint8Array(y.dictionary):E=y.dictionary,x=t.deflateSetDictionary(this.strm,E),x!==h)throw new Error(s[x]);this._dict_set=!0}}_.prototype.push=function(O,y){var x=this.strm,E=this.options.chunkSize,w,S;if(this.ended)return!1;S=y===~~y?y:y===!0?l:o,typeof O=="string"?x.input=r.string2buf(O):a.call(O)==="[object ArrayBuffer]"?x.input=new Uint8Array(O):x.input=O,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new i.Buf8(E),x.next_out=0,x.avail_out=E),w=t.deflate(x,S),w!==c&&w!==h)return this.onEnd(w),this.ended=!0,!1;(x.avail_out===0||x.avail_in===0&&(S===l||S===f))&&(this.options.to==="string"?this.onData(r.buf2binstring(i.shrinkBuf(x.output,x.next_out))):this.onData(i.shrinkBuf(x.output,x.next_out)))}while((x.avail_in>0||x.avail_out===0)&&w!==c);return S===l?(w=t.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===h):(S===f&&(this.onEnd(h),x.avail_out=0),!0)},_.prototype.onData=function(O){this.chunks.push(O)},_.prototype.onEnd=function(O){O===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=O,this.msg=this.strm.msg};function g(O,y){var x=new _(y);if(x.push(O,!0),x.err)throw x.msg||s[x.err];return x.result}function b(O,y){return y=y||{},y.raw=!0,g(O,y)}function m(O,y){return y=y||{},y.gzip=!0,g(O,y)}e.Deflate=_,e.deflate=g,e.deflateRaw=b,e.gzip=m}),Fk=Ke((e,t)=>{"use strict";var i=30,r=12;t.exports=function(s,n){var a,o,l,h,c,f,d,u,p,_,g,b,m,O,y,x,E,w,S,C,R,B,Y,G,z;a=s.state,o=s.next_in,G=s.input,l=o+(s.avail_in-5),h=s.next_out,z=s.output,c=h-(n-s.avail_out),f=h+(s.avail_out-257),d=a.dmax,u=a.wsize,p=a.whave,_=a.wnext,g=a.window,b=a.hold,m=a.bits,O=a.lencode,y=a.distcode,x=(1<<a.lenbits)-1,E=(1<<a.distbits)-1;e:do{m<15&&(b+=G[o++]<<m,m+=8,b+=G[o++]<<m,m+=8),w=O[b&x];t:for(;;){if(S=w>>>24,b>>>=S,m-=S,S=w>>>16&255,S===0)z[h++]=w&65535;else if(S&16){C=w&65535,S&=15,S&&(m<S&&(b+=G[o++]<<m,m+=8),C+=b&(1<<S)-1,b>>>=S,m-=S),m<15&&(b+=G[o++]<<m,m+=8,b+=G[o++]<<m,m+=8),w=y[b&E];i:for(;;){if(S=w>>>24,b>>>=S,m-=S,S=w>>>16&255,S&16){if(R=w&65535,S&=15,m<S&&(b+=G[o++]<<m,m+=8,m<S&&(b+=G[o++]<<m,m+=8)),R+=b&(1<<S)-1,R>d){s.msg="invalid distance too far back",a.mode=i;break e}if(b>>>=S,m-=S,S=h-c,R>S){if(S=R-S,S>p&&a.sane){s.msg="invalid distance too far back",a.mode=i;break e}if(B=0,Y=g,_===0){if(B+=u-S,S<C){C-=S;do z[h++]=g[B++];while(--S);B=h-R,Y=z}}else if(_<S){if(B+=u+_-S,S-=_,S<C){C-=S;do z[h++]=g[B++];while(--S);if(B=0,_<C){S=_,C-=S;do z[h++]=g[B++];while(--S);B=h-R,Y=z}}}else if(B+=_-S,S<C){C-=S;do z[h++]=g[B++];while(--S);B=h-R,Y=z}for(;C>2;)z[h++]=Y[B++],z[h++]=Y[B++],z[h++]=Y[B++],C-=3;C&&(z[h++]=Y[B++],C>1&&(z[h++]=Y[B++]))}else{B=h-R;do z[h++]=z[B++],z[h++]=z[B++],z[h++]=z[B++],C-=3;while(C>2);C&&(z[h++]=z[B++],C>1&&(z[h++]=z[B++]))}}else if((S&64)===0){w=y[(w&65535)+(b&(1<<S)-1)];continue i}else{s.msg="invalid distance code",a.mode=i;break e}break}}else if((S&64)===0){w=O[(w&65535)+(b&(1<<S)-1)];continue t}else if(S&32){a.mode=r;break e}else{s.msg="invalid literal/length code",a.mode=i;break e}break}}while(o<l&&h<f);C=m>>3,o-=C,m-=C<<3,b&=(1<<m)-1,s.next_in=o,s.next_out=h,s.avail_in=o<l?5+(l-o):5-(o-l),s.avail_out=h<f?257+(f-h):257-(h-f),a.hold=b,a.bits=m}}),Gk=Ke((e,t)=>{"use strict";var i=Qo(),r=15,s=852,n=592,a=0,o=1,l=2,h=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(u,p,_,g,b,m,O,y){var x=y.bits,E=0,w=0,S=0,C=0,R=0,B=0,Y=0,G=0,z=0,q=0,L,M,v,P,I,N=null,D=0,j,H=new i.Buf16(r+1),K=new i.Buf16(r+1),se=null,he=0,_e,ve,J;for(E=0;E<=r;E++)H[E]=0;for(w=0;w<g;w++)H[p[_+w]]++;for(R=x,C=r;C>=1&&H[C]===0;C--);if(R>C&&(R=C),C===0)return b[m++]=1<<24|64<<16|0,b[m++]=1<<24|64<<16|0,y.bits=1,0;for(S=1;S<C&&H[S]===0;S++);for(R<S&&(R=S),G=1,E=1;E<=r;E++)if(G<<=1,G-=H[E],G<0)return-1;if(G>0&&(u===a||C!==1))return-1;for(K[1]=0,E=1;E<r;E++)K[E+1]=K[E]+H[E];for(w=0;w<g;w++)p[_+w]!==0&&(O[K[p[_+w]]++]=w);if(u===a?(N=se=O,j=19):u===o?(N=h,D-=257,se=c,he-=257,j=256):(N=f,se=d,j=-1),q=0,w=0,E=S,I=m,B=R,Y=0,v=-1,z=1<<R,P=z-1,u===o&&z>s||u===l&&z>n)return 1;for(;;){_e=E-Y,O[w]<j?(ve=0,J=O[w]):O[w]>j?(ve=se[he+O[w]],J=N[D+O[w]]):(ve=96,J=0),L=1<<E-Y,M=1<<B,S=M;do M-=L,b[I+(q>>Y)+M]=_e<<24|ve<<16|J|0;while(M!==0);for(L=1<<E-1;q&L;)L>>=1;if(L!==0?(q&=L-1,q+=L):q=0,w++,--H[E]===0){if(E===C)break;E=p[_+O[w]]}if(E>R&&(q&P)!==v){for(Y===0&&(Y=R),I+=S,B=E-Y,G=1<<B;B+Y<C&&(G-=H[B+Y],!(G<=0));)B++,G<<=1;if(z+=1<<B,u===o&&z>s||u===l&&z>n)return 1;v=q&P,b[v]=R<<24|B<<16|I-m|0}}return q!==0&&(b[I+q]=E-Y<<24|64<<16|0),y.bits=R,0}}),zk=Ke(e=>{"use strict";var t=Qo(),i=sw(),r=nw(),s=Fk(),n=Gk(),a=0,o=1,l=2,h=4,c=5,f=6,d=0,u=1,p=2,_=-2,g=-3,b=-4,m=-5,O=8,y=1,x=2,E=3,w=4,S=5,C=6,R=7,B=8,Y=9,G=10,z=11,q=12,L=13,M=14,v=15,P=16,I=17,N=18,D=19,j=20,H=21,K=22,se=23,he=24,_e=25,ve=26,J=27,Z=28,re=29,ue=30,Le=31,Ce=32,De=852,Pe=592,Ie=15,Je=Ie;function $e(W){return(W>>>24&255)+(W>>>8&65280)+((W&65280)<<8)+((W&255)<<24)}function pt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ct(W){var ne;return!W||!W.state?_:(ne=W.state,W.total_in=W.total_out=ne.total=0,W.msg="",ne.wrap&&(W.adler=ne.wrap&1),ne.mode=y,ne.last=0,ne.havedict=0,ne.dmax=32768,ne.head=null,ne.hold=0,ne.bits=0,ne.lencode=ne.lendyn=new t.Buf32(De),ne.distcode=ne.distdyn=new t.Buf32(Pe),ne.sane=1,ne.back=-1,d)}function ut(W){var ne;return!W||!W.state?_:(ne=W.state,ne.wsize=0,ne.whave=0,ne.wnext=0,ct(W))}function si(W,ne){var X,Ee;return!W||!W.state||(Ee=W.state,ne<0?(X=0,ne=-ne):(X=(ne>>4)+1,ne<48&&(ne&=15)),ne&&(ne<8||ne>15))?_:(Ee.window!==null&&Ee.wbits!==ne&&(Ee.window=null),Ee.wrap=X,Ee.wbits=ne,ut(W))}function mi(W,ne){var X,Ee;return W?(Ee=new pt,W.state=Ee,Ee.window=null,X=si(W,ne),X!==d&&(W.state=null),X):_}function It(W){return mi(W,Je)}var jt=!0,Ai,ni;function T(W){if(jt){var ne;for(Ai=new t.Buf32(512),ni=new t.Buf32(32),ne=0;ne<144;)W.lens[ne++]=8;for(;ne<256;)W.lens[ne++]=9;for(;ne<280;)W.lens[ne++]=7;for(;ne<288;)W.lens[ne++]=8;for(n(o,W.lens,0,288,Ai,0,W.work,{bits:9}),ne=0;ne<32;)W.lens[ne++]=5;n(l,W.lens,0,32,ni,0,W.work,{bits:5}),jt=!1}W.lencode=Ai,W.lenbits=9,W.distcode=ni,W.distbits=5}function k(W,ne,X,Ee){var Me,U=W.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new t.Buf8(U.wsize)),Ee>=U.wsize?(t.arraySet(U.window,ne,X-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(Me=U.wsize-U.wnext,Me>Ee&&(Me=Ee),t.arraySet(U.window,ne,X-Ee,Me,U.wnext),Ee-=Me,Ee?(t.arraySet(U.window,ne,X-Ee,Ee,0),U.wnext=Ee,U.whave=U.wsize):(U.wnext+=Me,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=Me))),0}function A(W,ne){var X,Ee,Me,U,be,Ne,$,fe,Se,ze,Ue,je,Dt,Ts,ft=0,dt,Li,fr,As,xf,vf,pr,sn,Zr=new t.Buf8(4),Pa,$n,Fy=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!W||!W.state||!W.output||!W.input&&W.avail_in!==0)return _;X=W.state,X.mode===q&&(X.mode=L),be=W.next_out,Me=W.output,$=W.avail_out,U=W.next_in,Ee=W.input,Ne=W.avail_in,fe=X.hold,Se=X.bits,ze=Ne,Ue=$,sn=d;e:for(;;)switch(X.mode){case y:if(X.wrap===0){X.mode=L;break}for(;Se<16;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(X.wrap&2&&fe===35615){X.check=0,Zr[0]=fe&255,Zr[1]=fe>>>8&255,X.check=r(X.check,Zr,2,0),fe=0,Se=0,X.mode=x;break}if(X.flags=0,X.head&&(X.head.done=!1),!(X.wrap&1)||(((fe&255)<<8)+(fe>>8))%31){W.msg="incorrect header check",X.mode=ue;break}if((fe&15)!==O){W.msg="unknown compression method",X.mode=ue;break}if(fe>>>=4,Se-=4,pr=(fe&15)+8,X.wbits===0)X.wbits=pr;else if(pr>X.wbits){W.msg="invalid window size",X.mode=ue;break}X.dmax=1<<pr,W.adler=X.check=1,X.mode=fe&512?G:q,fe=0,Se=0;break;case x:for(;Se<16;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(X.flags=fe,(X.flags&255)!==O){W.msg="unknown compression method",X.mode=ue;break}if(X.flags&57344){W.msg="unknown header flags set",X.mode=ue;break}X.head&&(X.head.text=fe>>8&1),X.flags&512&&(Zr[0]=fe&255,Zr[1]=fe>>>8&255,X.check=r(X.check,Zr,2,0)),fe=0,Se=0,X.mode=E;case E:for(;Se<32;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}X.head&&(X.head.time=fe),X.flags&512&&(Zr[0]=fe&255,Zr[1]=fe>>>8&255,Zr[2]=fe>>>16&255,Zr[3]=fe>>>24&255,X.check=r(X.check,Zr,4,0)),fe=0,Se=0,X.mode=w;case w:for(;Se<16;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}X.head&&(X.head.xflags=fe&255,X.head.os=fe>>8),X.flags&512&&(Zr[0]=fe&255,Zr[1]=fe>>>8&255,X.check=r(X.check,Zr,2,0)),fe=0,Se=0,X.mode=S;case S:if(X.flags&1024){for(;Se<16;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}X.length=fe,X.head&&(X.head.extra_len=fe),X.flags&512&&(Zr[0]=fe&255,Zr[1]=fe>>>8&255,X.check=r(X.check,Zr,2,0)),fe=0,Se=0}else X.head&&(X.head.extra=null);X.mode=C;case C:if(X.flags&1024&&(je=X.length,je>Ne&&(je=Ne),je&&(X.head&&(pr=X.head.extra_len-X.length,X.head.extra||(X.head.extra=new Array(X.head.extra_len)),t.arraySet(X.head.extra,Ee,U,je,pr)),X.flags&512&&(X.check=r(X.check,Ee,je,U)),Ne-=je,U+=je,X.length-=je),X.length))break e;X.length=0,X.mode=R;case R:if(X.flags&2048){if(Ne===0)break e;je=0;do pr=Ee[U+je++],X.head&&pr&&X.length<65536&&(X.head.name+=String.fromCharCode(pr));while(pr&&je<Ne);if(X.flags&512&&(X.check=r(X.check,Ee,je,U)),Ne-=je,U+=je,pr)break e}else X.head&&(X.head.name=null);X.length=0,X.mode=B;case B:if(X.flags&4096){if(Ne===0)break e;je=0;do pr=Ee[U+je++],X.head&&pr&&X.length<65536&&(X.head.comment+=String.fromCharCode(pr));while(pr&&je<Ne);if(X.flags&512&&(X.check=r(X.check,Ee,je,U)),Ne-=je,U+=je,pr)break e}else X.head&&(X.head.comment=null);X.mode=Y;case Y:if(X.flags&512){for(;Se<16;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(fe!==(X.check&65535)){W.msg="header crc mismatch",X.mode=ue;break}fe=0,Se=0}X.head&&(X.head.hcrc=X.flags>>9&1,X.head.done=!0),W.adler=X.check=0,X.mode=q;break;case G:for(;Se<32;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}W.adler=X.check=$e(fe),fe=0,Se=0,X.mode=z;case z:if(X.havedict===0)return W.next_out=be,W.avail_out=$,W.next_in=U,W.avail_in=Ne,X.hold=fe,X.bits=Se,p;W.adler=X.check=1,X.mode=q;case q:if(ne===c||ne===f)break e;case L:if(X.last){fe>>>=Se&7,Se-=Se&7,X.mode=J;break}for(;Se<3;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}switch(X.last=fe&1,fe>>>=1,Se-=1,fe&3){case 0:X.mode=M;break;case 1:if(T(X),X.mode=j,ne===f){fe>>>=2,Se-=2;break e}break;case 2:X.mode=I;break;case 3:W.msg="invalid block type",X.mode=ue}fe>>>=2,Se-=2;break;case M:for(fe>>>=Se&7,Se-=Se&7;Se<32;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if((fe&65535)!==(fe>>>16^65535)){W.msg="invalid stored block lengths",X.mode=ue;break}if(X.length=fe&65535,fe=0,Se=0,X.mode=v,ne===f)break e;case v:X.mode=P;case P:if(je=X.length,je){if(je>Ne&&(je=Ne),je>$&&(je=$),je===0)break e;t.arraySet(Me,Ee,U,je,be),Ne-=je,U+=je,$-=je,be+=je,X.length-=je;break}X.mode=q;break;case I:for(;Se<14;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(X.nlen=(fe&31)+257,fe>>>=5,Se-=5,X.ndist=(fe&31)+1,fe>>>=5,Se-=5,X.ncode=(fe&15)+4,fe>>>=4,Se-=4,X.nlen>286||X.ndist>30){W.msg="too many length or distance symbols",X.mode=ue;break}X.have=0,X.mode=N;case N:for(;X.have<X.ncode;){for(;Se<3;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}X.lens[Fy[X.have++]]=fe&7,fe>>>=3,Se-=3}for(;X.have<19;)X.lens[Fy[X.have++]]=0;if(X.lencode=X.lendyn,X.lenbits=7,Pa={bits:X.lenbits},sn=n(a,X.lens,0,19,X.lencode,0,X.work,Pa),X.lenbits=Pa.bits,sn){W.msg="invalid code lengths set",X.mode=ue;break}X.have=0,X.mode=D;case D:for(;X.have<X.nlen+X.ndist;){for(;ft=X.lencode[fe&(1<<X.lenbits)-1],dt=ft>>>24,Li=ft>>>16&255,fr=ft&65535,!(dt<=Se);){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(fr<16)fe>>>=dt,Se-=dt,X.lens[X.have++]=fr;else{if(fr===16){for($n=dt+2;Se<$n;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(fe>>>=dt,Se-=dt,X.have===0){W.msg="invalid bit length repeat",X.mode=ue;break}pr=X.lens[X.have-1],je=3+(fe&3),fe>>>=2,Se-=2}else if(fr===17){for($n=dt+3;Se<$n;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}fe>>>=dt,Se-=dt,pr=0,je=3+(fe&7),fe>>>=3,Se-=3}else{for($n=dt+7;Se<$n;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}fe>>>=dt,Se-=dt,pr=0,je=11+(fe&127),fe>>>=7,Se-=7}if(X.have+je>X.nlen+X.ndist){W.msg="invalid bit length repeat",X.mode=ue;break}for(;je--;)X.lens[X.have++]=pr}}if(X.mode===ue)break;if(X.lens[256]===0){W.msg="invalid code -- missing end-of-block",X.mode=ue;break}if(X.lenbits=9,Pa={bits:X.lenbits},sn=n(o,X.lens,0,X.nlen,X.lencode,0,X.work,Pa),X.lenbits=Pa.bits,sn){W.msg="invalid literal/lengths set",X.mode=ue;break}if(X.distbits=6,X.distcode=X.distdyn,Pa={bits:X.distbits},sn=n(l,X.lens,X.nlen,X.ndist,X.distcode,0,X.work,Pa),X.distbits=Pa.bits,sn){W.msg="invalid distances set",X.mode=ue;break}if(X.mode=j,ne===f)break e;case j:X.mode=H;case H:if(Ne>=6&&$>=258){W.next_out=be,W.avail_out=$,W.next_in=U,W.avail_in=Ne,X.hold=fe,X.bits=Se,s(W,Ue),be=W.next_out,Me=W.output,$=W.avail_out,U=W.next_in,Ee=W.input,Ne=W.avail_in,fe=X.hold,Se=X.bits,X.mode===q&&(X.back=-1);break}for(X.back=0;ft=X.lencode[fe&(1<<X.lenbits)-1],dt=ft>>>24,Li=ft>>>16&255,fr=ft&65535,!(dt<=Se);){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(Li&&(Li&240)===0){for(As=dt,xf=Li,vf=fr;ft=X.lencode[vf+((fe&(1<<As+xf)-1)>>As)],dt=ft>>>24,Li=ft>>>16&255,fr=ft&65535,!(As+dt<=Se);){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}fe>>>=As,Se-=As,X.back+=As}if(fe>>>=dt,Se-=dt,X.back+=dt,X.length=fr,Li===0){X.mode=ve;break}if(Li&32){X.back=-1,X.mode=q;break}if(Li&64){W.msg="invalid literal/length code",X.mode=ue;break}X.extra=Li&15,X.mode=K;case K:if(X.extra){for($n=X.extra;Se<$n;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}X.length+=fe&(1<<X.extra)-1,fe>>>=X.extra,Se-=X.extra,X.back+=X.extra}X.was=X.length,X.mode=se;case se:for(;ft=X.distcode[fe&(1<<X.distbits)-1],dt=ft>>>24,Li=ft>>>16&255,fr=ft&65535,!(dt<=Se);){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if((Li&240)===0){for(As=dt,xf=Li,vf=fr;ft=X.distcode[vf+((fe&(1<<As+xf)-1)>>As)],dt=ft>>>24,Li=ft>>>16&255,fr=ft&65535,!(As+dt<=Se);){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}fe>>>=As,Se-=As,X.back+=As}if(fe>>>=dt,Se-=dt,X.back+=dt,Li&64){W.msg="invalid distance code",X.mode=ue;break}X.offset=fr,X.extra=Li&15,X.mode=he;case he:if(X.extra){for($n=X.extra;Se<$n;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}X.offset+=fe&(1<<X.extra)-1,fe>>>=X.extra,Se-=X.extra,X.back+=X.extra}if(X.offset>X.dmax){W.msg="invalid distance too far back",X.mode=ue;break}X.mode=_e;case _e:if($===0)break e;if(je=Ue-$,X.offset>je){if(je=X.offset-je,je>X.whave&&X.sane){W.msg="invalid distance too far back",X.mode=ue;break}je>X.wnext?(je-=X.wnext,Dt=X.wsize-je):Dt=X.wnext-je,je>X.length&&(je=X.length),Ts=X.window}else Ts=Me,Dt=be-X.offset,je=X.length;je>$&&(je=$),$-=je,X.length-=je;do Me[be++]=Ts[Dt++];while(--je);X.length===0&&(X.mode=H);break;case ve:if($===0)break e;Me[be++]=X.length,$--,X.mode=H;break;case J:if(X.wrap){for(;Se<32;){if(Ne===0)break e;Ne--,fe|=Ee[U++]<<Se,Se+=8}if(Ue-=$,W.total_out+=Ue,X.total+=Ue,Ue&&(W.adler=X.check=X.flags?r(X.check,Me,Ue,be-Ue):i(X.check,Me,Ue,be-Ue)),Ue=$,(X.flags?fe:$e(fe))!==X.check){W.msg="incorrect data check",X.mode=ue;break}fe=0,Se=0}X.mode=Z;case Z:if(X.wrap&&X.flags){for(;Se<32;){if(Ne===0)break e;Ne--,fe+=Ee[U++]<<Se,Se+=8}if(fe!==(X.total&4294967295)){W.msg="incorrect length check",X.mode=ue;break}fe=0,Se=0}X.mode=re;case re:sn=u;break e;case ue:sn=g;break e;case Le:return b;case Ce:default:return _}return W.next_out=be,W.avail_out=$,W.next_in=U,W.avail_in=Ne,X.hold=fe,X.bits=Se,(X.wsize||Ue!==W.avail_out&&X.mode<ue&&(X.mode<J||ne!==h))&&k(W,W.output,W.next_out,Ue-W.avail_out)?(X.mode=Le,b):(ze-=W.avail_in,Ue-=W.avail_out,W.total_in+=ze,W.total_out+=Ue,X.total+=Ue,X.wrap&&Ue&&(W.adler=X.check=X.flags?r(X.check,Me,Ue,W.next_out-Ue):i(X.check,Me,Ue,W.next_out-Ue)),W.data_type=X.bits+(X.last?64:0)+(X.mode===q?128:0)+(X.mode===j||X.mode===v?256:0),(ze===0&&Ue===0||ne===h)&&sn===d&&(sn=m),sn)}function F(W){if(!W||!W.state)return _;var ne=W.state;return ne.window&&(ne.window=null),W.state=null,d}function V(W,ne){var X;return!W||!W.state||(X=W.state,(X.wrap&2)===0)?_:(X.head=ne,ne.done=!1,d)}function Q(W,ne){var X=ne.length,Ee,Me,U;return!W||!W.state||(Ee=W.state,Ee.wrap!==0&&Ee.mode!==z)?_:Ee.mode===z&&(Me=1,Me=i(Me,ne,X,0),Me!==Ee.check)?g:(U=k(W,ne,X,X),U?(Ee.mode=Le,b):(Ee.havedict=1,d))}e.inflateReset=ut,e.inflateReset2=si,e.inflateResetKeep=ct,e.inflateInit=It,e.inflateInit2=mi,e.inflate=A,e.inflateEnd=F,e.inflateGetHeader=V,e.inflateSetDictionary=Q,e.inflateInfo="pako inflate (from Nodeca project)"}),lw=Ke((e,t)=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}),Hk=Ke((e,t)=>{"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i}),jk=Ke(e=>{"use strict";var t=zk(),i=Qo(),r=aw(),s=lw(),n=P1(),a=ow(),o=Hk(),l=Object.prototype.toString;function h(d){if(!(this instanceof h))return new h(d);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},d||{});var u=this.options;u.raw&&u.windowBits>=0&&u.windowBits<16&&(u.windowBits=-u.windowBits,u.windowBits===0&&(u.windowBits=-15)),u.windowBits>=0&&u.windowBits<16&&!(d&&d.windowBits)&&(u.windowBits+=32),u.windowBits>15&&u.windowBits<48&&(u.windowBits&15)===0&&(u.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var p=t.inflateInit2(this.strm,u.windowBits);if(p!==s.Z_OK)throw new Error(n[p]);if(this.header=new o,t.inflateGetHeader(this.strm,this.header),u.dictionary&&(typeof u.dictionary=="string"?u.dictionary=r.string2buf(u.dictionary):l.call(u.dictionary)==="[object ArrayBuffer]"&&(u.dictionary=new Uint8Array(u.dictionary)),u.raw&&(p=t.inflateSetDictionary(this.strm,u.dictionary),p!==s.Z_OK)))throw new Error(n[p])}h.prototype.push=function(d,u){var p=this.strm,_=this.options.chunkSize,g=this.options.dictionary,b,m,O,y,x,E=!1;if(this.ended)return!1;m=u===~~u?u:u===!0?s.Z_FINISH:s.Z_NO_FLUSH,typeof d=="string"?p.input=r.binstring2buf(d):l.call(d)==="[object ArrayBuffer]"?p.input=new Uint8Array(d):p.input=d,p.next_in=0,p.avail_in=p.input.length;do{if(p.avail_out===0&&(p.output=new i.Buf8(_),p.next_out=0,p.avail_out=_),b=t.inflate(p,s.Z_NO_FLUSH),b===s.Z_NEED_DICT&&g&&(b=t.inflateSetDictionary(this.strm,g)),b===s.Z_BUF_ERROR&&E===!0&&(b=s.Z_OK,E=!1),b!==s.Z_STREAM_END&&b!==s.Z_OK)return this.onEnd(b),this.ended=!0,!1;p.next_out&&(p.avail_out===0||b===s.Z_STREAM_END||p.avail_in===0&&(m===s.Z_FINISH||m===s.Z_SYNC_FLUSH))&&(this.options.to==="string"?(O=r.utf8border(p.output,p.next_out),y=p.next_out-O,x=r.buf2string(p.output,O),p.next_out=y,p.avail_out=_-y,y&&i.arraySet(p.output,p.output,O,y,0),this.onData(x)):this.onData(i.shrinkBuf(p.output,p.next_out))),p.avail_in===0&&p.avail_out===0&&(E=!0)}while((p.avail_in>0||p.avail_out===0)&&b!==s.Z_STREAM_END);return b===s.Z_STREAM_END&&(m=s.Z_FINISH),m===s.Z_FINISH?(b=t.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===s.Z_OK):(m===s.Z_SYNC_FLUSH&&(this.onEnd(s.Z_OK),p.avail_out=0),!0)},h.prototype.onData=function(d){this.chunks.push(d)},h.prototype.onEnd=function(d){d===s.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg};function c(d,u){var p=new h(u);if(p.push(d,!0),p.err)throw p.msg||n[p.err];return p.result}function f(d,u){return u=u||{},u.raw=!0,c(d,u)}e.Inflate=h,e.inflate=c,e.inflateRaw=f,e.ungzip=c}),Yk=Ke((e,t)=>{"use strict";var i=Qo().assign,r=Uk(),s=jk(),n=lw(),a={};i(a,r,s,n),t.exports=a}),Vk=Ke(e=>{"use strict";var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=Yk(),r=nr(),s=mn(),n=t?"uint8array":"array";e.magic="\b\0";function a(o,l){s.call(this,"FlateWorker/"+o),this._pako=null,this._pakoAction=o,this._pakoOptions=l,this.meta={}}r.inherits(a,s),a.prototype.processChunk=function(o){this.meta=o.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(n,o.data),!1)},a.prototype.flush=function(){s.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},a.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var o=this;this._pako.onData=function(l){o.push({data:l,meta:o.meta})}},e.compressWorker=function(o){return new a("Deflate",o)},e.uncompressWorker=function(){return new a("Inflate",{})}}),hw=Ke(e=>{"use strict";var t=mn();e.STORE={magic:"\0\0",compressWorker:function(){return new t("STORE compression")},uncompressWorker:function(){return new t("STORE decompression")}},e.DEFLATE=Vk()}),cw=Ke(e=>{"use strict";e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\x07\b"}),qk=Ke((e,t)=>{"use strict";var i=nr(),r=mn(),s=Md(),n=S1(),a=cw(),o=function(p,_){var g="",b;for(b=0;b<_;b++)g+=String.fromCharCode(p&255),p=p>>>8;return g},l=function(p,_){var g=p;return p||(g=_?16893:33204),(g&65535)<<16},h=function(p){return(p||0)&63},c=function(p,_,g,b,m,O){var y=p.file,x=p.compression,E=O!==s.utf8encode,w=i.transformTo("string",O(y.name)),S=i.transformTo("string",s.utf8encode(y.name)),C=y.comment,R=i.transformTo("string",O(C)),B=i.transformTo("string",s.utf8encode(C)),Y=S.length!==y.name.length,G=B.length!==C.length,z,q,L="",M="",v="",P=y.dir,I=y.date,N={crc32:0,compressedSize:0,uncompressedSize:0};(!_||g)&&(N.crc32=p.crc32,N.compressedSize=p.compressedSize,N.uncompressedSize=p.uncompressedSize);var D=0;_&&(D|=8),!E&&(Y||G)&&(D|=2048);var j=0,H=0;P&&(j|=16),m==="UNIX"?(H=798,j|=l(y.unixPermissions,P)):(H=20,j|=h(y.dosPermissions,P)),z=I.getUTCHours(),z=z<<6,z=z|I.getUTCMinutes(),z=z<<5,z=z|I.getUTCSeconds()/2,q=I.getUTCFullYear()-1980,q=q<<4,q=q|I.getUTCMonth()+1,q=q<<5,q=q|I.getUTCDate(),Y&&(M=o(1,1)+o(n(w),4)+S,L+="up"+o(M.length,2)+M),G&&(v=o(1,1)+o(n(R),4)+B,L+="uc"+o(v.length,2)+v);var K="";K+=`
\0`,K+=o(D,2),K+=x.magic,K+=o(z,2),K+=o(q,2),K+=o(N.crc32,4),K+=o(N.compressedSize,4),K+=o(N.uncompressedSize,4),K+=o(w.length,2),K+=o(L.length,2);var se=a.LOCAL_FILE_HEADER+K+w+L,he=a.CENTRAL_FILE_HEADER+o(H,2)+K+o(R.length,2)+"\0\0\0\0"+o(j,4)+o(b,4)+w+L+R;return{fileRecord:se,dirRecord:he}},f=function(p,_,g,b,m){var O="",y=i.transformTo("string",m(b));return O=a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(p,2)+o(p,2)+o(_,4)+o(g,4)+o(y.length,2)+y,O},d=function(p){var _="";return _=a.DATA_DESCRIPTOR+o(p.crc32,4)+o(p.compressedSize,4)+o(p.uncompressedSize,4),_};function u(p,_,g,b){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=g,this.encodeFileName=b,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}i.inherits(u,r),u.prototype.push=function(p){var _=p.meta.percent||0,g=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,r.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:g?(_+100*(g-b-1))/g:100}}))},u.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var _=this.streamFiles&&!p.file.dir;if(_){var g=c(p,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(p){this.accumulate=!1;var _=this.streamFiles&&!p.file.dir,g=c(p,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),_)this.push({data:d(p),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var p=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var g=this.bytesWritten-p,b=f(this.dirRecords.length,g,p,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(p){this._sources.push(p);var _=this;return p.on("data",function(g){_.processChunk(g)}),p.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),p.on("error",function(g){_.error(g)}),this},u.prototype.resume=function(){if(!r.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&!this._sources.length&&!this.generatedError)return this.end(),!0},u.prototype.error=function(p){var _=this._sources;if(!r.prototype.error.call(this,p))return!1;for(var g=0;g<_.length;g++)try{_[g].error(p)}catch{}return!0},u.prototype.lock=function(){r.prototype.lock.call(this);for(var p=this._sources,_=0;_<p.length;_++)p[_].lock()},t.exports=u}),Xk=Ke(e=>{"use strict";var t=hw(),i=qk(),r=function(s,n){var a=s||n,o=t[a];if(!o)throw new Error(a+" is not a valid compression method !");return o};e.generateWorker=function(s,n,a){var o=new i(n.streamFiles,a,n.platform,n.encodeFileName),l=0;try{s.forEach(function(h,c){l++;var f=r(c.options.compression,n.compression),d=c.options.compressionOptions||n.compressionOptions||{},u=c.dir,p=c.date;c._compressWorker(f,d).withStreamInfo("file",{name:h,dir:u,date:p,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(o)}),o.entriesCount=l}catch(h){o.error(h)}return o}}),Wk=Ke((e,t)=>{"use strict";var i=nr(),r=mn();function s(n,a){r.call(this,"Nodejs stream input adapter for "+n),this._upstreamEnded=!1,this._bindStream(a)}i.inherits(s,r),s.prototype._bindStream=function(n){var a=this;this._stream=n,n.pause(),n.on("data",function(o){a.push({data:o,meta:{percent:0}})}).on("error",function(o){a.isPaused?this.generatedError=o:a.error(o)}).on("end",function(){a.isPaused?a._upstreamEnded=!0:a.end()})},s.prototype.pause=function(){return r.prototype.pause.call(this)?(this._stream.pause(),!0):!1},s.prototype.resume=function(){return r.prototype.resume.call(this)?(this._upstreamEnded?this.end():this._stream.resume(),!0):!1},t.exports=s}),Jk=Ke((e,t)=>{"use strict";var i=Md(),r=nr(),s=mn(),n=ew(),a=tw(),o=I1(),l=Mk(),h=Xk(),c=Og(),f=Wk(),d=function(m,O,y){var x=r.getTypeOf(O),E,w=r.extend(y||{},a);w.date=w.date||new Date,w.compression!==null&&(w.compression=w.compression.toUpperCase()),typeof w.unixPermissions=="string"&&(w.unixPermissions=parseInt(w.unixPermissions,8)),w.unixPermissions&&w.unixPermissions&16384&&(w.dir=!0),w.dosPermissions&&w.dosPermissions&16&&(w.dir=!0),w.dir&&(m=p(m)),w.createFolders&&(E=u(m))&&_.call(this,E,!0);var S=x==="string"&&w.binary===!1&&w.base64===!1;(!y||typeof y.binary>"u")&&(w.binary=!S);var C=O instanceof o&&O.uncompressedSize===0;(C||w.dir||!O||O.length===0)&&(w.base64=!1,w.binary=!0,O="",w.compression="STORE",x="string");var R=null;O instanceof o||O instanceof s?R=O:c.isNode&&c.isStream(O)?R=new f(m,O):R=r.prepareContent(m,O,w.binary,w.optimizedBinaryString,w.base64);var B=new l(m,R,w);this.files[m]=B},u=function(m){m.slice(-1)==="/"&&(m=m.substring(0,m.length-1));var O=m.lastIndexOf("/");return O>0?m.substring(0,O):""},p=function(m){return m.slice(-1)!=="/"&&(m+="/"),m},_=function(m,O){return O=typeof O<"u"?O:a.createFolders,m=p(m),this.files[m]||d.call(this,m,null,{dir:!0,createFolders:O}),this.files[m]};function g(m){return Object.prototype.toString.call(m)==="[object RegExp]"}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(m){var O,y,x;for(O in this.files)x=this.files[O],y=O.slice(this.root.length,O.length),y&&O.slice(0,this.root.length)===this.root&&m(y,x)},filter:function(m){var O=[];return this.forEach(function(y,x){m(y,x)&&O.push(x)}),O},file:function(m,O,y){if(arguments.length===1)if(g(m)){var x=m;return this.filter(function(w,S){return!S.dir&&x.test(w)})}else{var E=this.files[this.root+m];return E&&!E.dir?E:null}else m=this.root+m,d.call(this,m,O,y);return this},folder:function(m){if(!m)return this;if(g(m))return this.filter(function(E,w){return w.dir&&m.test(E)});var O=this.root+m,y=_.call(this,O),x=this.clone();return x.root=y.name,x},remove:function(m){m=this.root+m;var O=this.files[m];if(O||(m.slice(-1)!=="/"&&(m+="/"),O=this.files[m]),O&&!O.dir)delete this.files[m];else for(var y=this.filter(function(E,w){return w.name.slice(0,m.length)===m}),x=0;x<y.length;x++)delete this.files[y[x].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(m){var O,y={};try{if(y=r.extend(m||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode}),y.type=y.type.toLowerCase(),y.compression=y.compression.toUpperCase(),y.type==="binarystring"&&(y.type="string"),!y.type)throw new Error("No output type specified.");r.checkSupport(y.type),(y.platform==="darwin"||y.platform==="freebsd"||y.platform==="linux"||y.platform==="sunos")&&(y.platform="UNIX"),y.platform==="win32"&&(y.platform="DOS");var x=y.comment||this.comment||"";O=h.generateWorker(this,y,x)}catch(E){O=new s("error"),O.error(E)}return new n(O,y.type||"string",y.mimeType)},generateAsync:function(m,O){return this.generateInternalStream(m).accumulate(O)},generateNodeStream:function(m,O){return m=m||{},m.type||(m.type="nodebuffer"),this.generateInternalStream(m).toNodejsStream(O)}};t.exports=b}),uw=Ke((e,t)=>{"use strict";var i=nr();function r(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var n=0,a;for(this.checkOffset(s),a=this.index+s-1;a>=this.index;a--)n=(n<<8)+this.byteAt(a);return this.index+=s,n},readString:function(s){return i.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC((s>>25&127)+1980,(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(s&31)<<1))}},t.exports=r}),dw=Ke((e,t)=>{"use strict";var i=uw(),r=nr();function s(n){i.call(this,n);for(var a=0;a<this.data.length;a++)n[a]=n[a]&255}r.inherits(s,i),s.prototype.byteAt=function(n){return this.data[this.zero+n]},s.prototype.lastIndexOfSignature=function(n){for(var a=n.charCodeAt(0),o=n.charCodeAt(1),l=n.charCodeAt(2),h=n.charCodeAt(3),c=this.length-4;c>=0;--c)if(this.data[c]===a&&this.data[c+1]===o&&this.data[c+2]===l&&this.data[c+3]===h)return c-this.zero;return-1},s.prototype.readAndCheckSignature=function(n){var a=n.charCodeAt(0),o=n.charCodeAt(1),l=n.charCodeAt(2),h=n.charCodeAt(3),c=this.readData(4);return a===c[0]&&o===c[1]&&l===c[2]&&h===c[3]},s.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=s}),Zk=Ke((e,t)=>{"use strict";var i=uw(),r=nr();function s(n){i.call(this,n)}r.inherits(s,i),s.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},s.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},s.prototype.readAndCheckSignature=function(n){var a=this.readData(4);return n===a},s.prototype.readData=function(n){this.checkOffset(n);var a=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=s}),fw=Ke((e,t)=>{"use strict";var i=dw(),r=nr();function s(n){i.call(this,n)}r.inherits(s,i),s.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=s}),Kk=Ke((e,t)=>{"use strict";var i=fw(),r=nr();function s(n){i.call(this,n)}r.inherits(s,i),s.prototype.readData=function(n){this.checkOffset(n);var a=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,a},t.exports=s}),pw=Ke((e,t)=>{"use strict";var i=nr(),r=$o(),s=dw(),n=Zk(),a=Kk(),o=fw();t.exports=function(l){var h=i.getTypeOf(l);return i.checkSupport(h),h==="string"&&!r.uint8array?new n(l):h==="nodebuffer"?new a(l):r.uint8array?new o(i.transformTo("uint8array",l)):new s(i.transformTo("array",l))}}),$k=Ke((e,t)=>{"use strict";var i=pw(),r=nr(),s=I1(),n=S1(),a=Md(),o=hw(),l=$o(),h=0,c=3,f=function(u){for(var p in o)if(Object.prototype.hasOwnProperty.call(o,p)&&o[p].magic===u)return o[p];return null};function d(u,p){this.options=u,this.loadOptions=p}d.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(u){var p,_;if(u.skip(22),this.fileNameLength=u.readInt(2),_=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(p=f(this.compressionMethod),p===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,p,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var p=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(p),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(this.externalFileAttributes&16),u===h&&(this.dosPermissions=this.externalFileAttributes&63),u===c&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var p=u.index+this.extraFieldsLength,_,g,b;for(this.extraFields||(this.extraFields={});u.index+4<p;)_=u.readInt(2),g=u.readInt(2),b=u.readData(g),this.extraFields[_]={id:_,length:g,value:b};u.setIndex(p)},handleUTF8:function(){var u=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var _=r.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var b=r.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var p=i(u.value);return p.readInt(1)!==1||n(this.fileName)!==p.readInt(4)?null:a.utf8decode(p.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var p=i(u.value);return p.readInt(1)!==1||n(this.fileComment)!==p.readInt(4)?null:a.utf8decode(p.readData(u.length-5))}return null}},t.exports=d}),Qk=Ke((e,t)=>{"use strict";var i=pw(),r=nr(),s=cw(),n=$k(),a=$o();function o(l){this.files=[],this.loadOptions=l}o.prototype={checkSignature:function(l){if(!this.reader.readAndCheckSignature(l)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(h)+", expected "+r.pretty(l)+")")}},isSignature:function(l,h){var c=this.reader.index;this.reader.setIndex(l);var f=this.reader.readString(4),d=f===h;return this.reader.setIndex(c),d},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var l=this.reader.readData(this.zipCommentLength),h=a.uint8array?"uint8array":"array",c=r.transformTo(h,l);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var l=this.zip64EndOfCentralSize-44,h=0,c,f,d;h<l;)c=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[c]={id:c,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var l,h;for(l=0;l<this.files.length;l++)h=this.files[l],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var l;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)l=new n({zip64:this.zip64},this.loadOptions),l.readCentralPart(this.reader),this.files.push(l);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var l=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(l<0){var h=!this.isSignature(0,s.LOCAL_FILE_HEADER);throw h?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(l);var c=l;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,l=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),l<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(l),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var d=c-f;if(d>0)this.isSignature(c,s.CENTRAL_FILE_HEADER)||(this.reader.zero=d);else if(d<0)throw new Error("Corrupted zip: missing "+Math.abs(d)+" bytes.")},prepareReader:function(l){this.reader=i(l)},load:function(l){this.prepareReader(l),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=o}),e8=Ke((e,t)=>{"use strict";var i=nr(),r=Dd(),s=Md(),n=Qk(),a=rw(),o=Og();function l(h){return new r.Promise(function(c,f){var d=h.decompressed.getContentWorker().pipe(new a);d.on("error",function(u){f(u)}).on("end",function(){d.streamInfo.crc32!==h.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}t.exports=function(h,c){var f=this;return c=i.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),o.isNode&&o.isStream(h)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",h,!0,c.optimizedBinaryString,c.base64).then(function(d){var u=new n(c);return u.load(d),u}).then(function(d){var u=[r.Promise.resolve(d)],p=d.files;if(c.checkCRC32)for(var _=0;_<p.length;_++)u.push(l(p[_]));return r.Promise.all(u)}).then(function(d){for(var u=d.shift(),p=u.files,_=0;_<p.length;_++){var g=p[_],b=g.fileNameStr,m=i.resolve(g.fileNameStr);f.file(m,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:c.createFolders}),g.dir||(f.file(m).unsafeOriginalName=b)}return u.zipComment.length&&(f.comment=u.zipComment),f})}}),_w=Ke((e,t)=>{"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new i;for(var s in this)typeof this[s]!="function"&&(r[s]=this[s]);return r}}i.prototype=Jk(),i.prototype.loadAsync=e8(),i.support=$o(),i.defaults=tw(),i.version="3.10.1",i.loadAsync=function(r,s){return new i().loadAsync(r,s)},i.external=Dd(),t.exports=i});var NT={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},U$=(()=>{let e={};for(let t in NT)e[NT[t]]=t;return e})(),LT=class{constructor(t,i){this.ratio=t/i}wrap(t){return t*this.ratio}static convert(t,i,r){return t*i/r}};LT.ASIS=new LT(1,1);var Bd=class{conversion(e,t,i){if(e===t)return i;let r=e+2+t;return this[r](i)}conversion1(e,t,i){let r=e+2+t,s=this[r](i);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*393.7007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};Bd.prototype["px(100)2mil"]=e=>e*10;Bd.prototype["px(100)2mm"]=e=>e*.254;Bd.prototype["mil2px(100)"]=e=>e/10;Bd.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var A_=null,A1=new ArrayBuffer(8),B0=new Float64Array(A1),k0=new Uint32Array(A1),RT=new Uint16Array(A1),On=Math.PI*2,el=Math.PI/2;var DT=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!A_){let e=this.getUrlVars().version;e?A_="/analyzer/v"+e:A_="/analyzer"}return A_}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;B0[0]=new Date().getTime(),e.push(k0[1].toString(16)),B0[0]=Math.random(),e.push(RT[3].toString(16));let t=RT[2].toString(16);e.push("4"+t.substr(0,3)),B0[0]=performance.now();let i=k0[0].toString(16)+k0[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},t8=[1,10,100,1e3];function MT(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=t8[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}function i8(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}var r8=/(\.?0+)$/,C_=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(DT.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(DT.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);sg.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(r8,"")}},sg=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(C_.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(C_.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(C_.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(C_.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},vr=class ys{static build(t,i,r,s=1){let n=this.getHash(t,i,r,s),a=this._colorCache[n];return a||(a=new ys(t,i,r,s),this._colorCache[n]=a),a}static getHash(t,i,r,s=1){return 31*(31*(31*t+i)+r)+s}static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,i,r,s=255){return ys.build(t/255,i/255,r/255,s/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let i=t.length;if(i==3)return ys.build(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(i==6)return ys.build(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(i==8)return ys.build(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let i=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),s=parseInt(t.b*255+"").toString(16);return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),("#"+i+r+s).toUpperCase()}static of5(t,i){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return ys.build(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,i);if(t.length==6)return ys.build(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,i);throw new Error("invalid color string")}static of6(t,i){return ys.build(t.r,t.g,t.b,i)}static of7(t){return t==null?null:ys.of3(t)}static ofNew(t){return ys.build(t.r,t.g,t.b,t.alpha)}constructor(t,i,r,s=1){this.r=sg.positiveOr0(t),this.g=sg.positiveOr0(i),this.b=sg.positiveOr0(r),this.alpha=s}mulAlpha(t){return new ys(this.r,this.g,this.b,this.alpha*t)}hashCode(){return ys.getHash(this.r,this.g,this.b,this.alpha)}equals(t,i=!1){if(!t)return!1;let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return i?r:r&&this.alpha===t.alpha}add(t,i,r,s){return ys.build(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+i)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+s)))}mul(t){return ys.build(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return ys.build(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16),s=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)+s.substr(0,2)}toRGBA(){let t=this.r*255,i=this.g*255,r=this.b*255;return[t,i,r,this.alpha]}toRGBAString(){let t=this.r*255,i=this.g*255,r=this.b*255;return`rgba(${t},${i},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}toCSS(){return`rgba(${this.r*255}, ${this.g*255}, ${this.b*255}, ${this.alpha})`}};vr._colorCache={},vr.WHITE=vr.build(1,1,1,1),vr.BLACK=vr.build(0,0,0,1),vr.RED=vr.build(1,0,0,1),vr.GREEN=vr.build(0,1,0,1),vr.BLUE=vr.build(0,0,1,1),vr.Gray=vr.of3("#9966ff"),vr.Silver=vr.of3("#D2D2D2"),vr.Golden=vr.of3("#DCAA14"),vr.DefaultHighLightColor=vr.build(1,1,1,.5);var ya=vr;var Yn=(e=>(e[e.NOTSHOW=0]="NOTSHOW",e[e.ONLYAXIS=1]="ONLYAXIS",e[e.SHOW=2]="SHOW",e))(Yn||{}),eh=(e=>(e[e.Line=0]="Line",e[e.Point=1]="Point",e[e.None=2]="None",e))(eh||{});var s8=(e=>(e[e.FIXED=0]="FIXED",e[e.ZOOM=1]="ZOOM",e))(s8||{}),n8=(e=>(e[e.CROSS=0]="CROSS",e[e.TRIANGLE=1]="TRIANGLE",e))(n8||{}),Bc=(e=>(e[e.MASK=0]="MASK",e[e.PT=1]="PT",e))(Bc||{}),a8=(e=>(e[e.FOLLOW_SCALE=0]="FOLLOW_SCALE",e[e.ALWAYS_ONE_PX=1]="ALWAYS_ONE_PX",e))(a8||{});var o8=(e=>(e.BUTT="butt",e.ROUND="round",e.SQUARE="square",e))(o8||{}),gw={butt:0,round:1,square:2};var l8=(e=>(e[e.None=0]="None",e[e.Solid=1]="Solid",e[e.Grid=2]="Grid",e[e.HorizontalLine=3]="HorizontalLine",e[e.VerticalLine=4]="VerticalLine",e[e.RhombicGrid=5]="RhombicGrid",e[e.LeftSlashLine=6]="LeftSlashLine",e[e.RightSlashLine=7]="RightSlashLine",e))(l8||{}),h8=(e=>(e[e.NoWrap=0]="NoWrap",e[e.Wrap=1]="Wrap",e))(h8||{}),c8=(e=>(e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e))(c8||{}),u8=(e=>(e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.Middle=2]="Middle",e))(u8||{}),d8=(e=>(e[e.HIDE=0]="HIDE",e[e.VISIBLE=1]="VISIBLE",e))(d8||{}),wt=10,C1=7,V$=2**C1-1<<wt,q$=2**wt-1,At=1<<wt+C1,BT=2**32-1-At,ur=class{constructor(e,t,i){this.DataIndex=i,this.length=t,kT[e]=t,f8[e]=(r,s,n)=>this.getBBox(r,s,n),m8[e]=(r,s)=>this.compare(r,s),p8[e]=(r,s,n)=>this.getOrder(r,s,n),_8[e]=(r,s,n)=>this.getGroupId(r,s,n),g8[e]=(r,s,n)=>this.getTemplateId(r,s,n),O8[e]=(r,s,n)=>this.getColorIndex(r,s,n),y8[e]=this,this.type=e}updateLength(e,t){this.length=e,kT[t]=e}compare(e,t){if((e[0]&BT)!==(t[0]&BT))return!1;for(let i=1;i<this.length;i++)if(e[i]!==t[i])return!1;return!0}createBBox(e,t,i){let r=this.getBBox(e,t,i);return new Ni(r.minX,r.maxX,r.minY,r.maxY)}getOrder(e,t,i){if(!this.DataIndex.ORDER)throw new Error("GetOrder error ");return e[t+this.DataIndex.ORDER]}getGroupId(e,t,i){if(!this.DataIndex.GROUP_ID)throw new Error("GetGroupId error ");return e.get(t+this.DataIndex.GROUP_ID)}getTemplateId(e,t,i){if(!this.DataIndex.TEMPLATE)throw new Error("GetTemplateId error ");return e[t+this.DataIndex.TEMPLATE]}getColorIndex(e,t,i){if(!this.DataIndex.COLOR_INDEX)throw new Error("GetColorIndex error ");return e[t+this.DataIndex.COLOR_INDEX]}},kT=new Float64Array(68),f8=[],p8=[],_8=[],g8=[],O8=[],m8=[],y8=[];var b8=[];function kc(e,t){b8.push(e,t)}var Ko=12,x8=class{constructor(){this._minX=0,this._maxX=0,this._minY=0,this._maxY=0}modify(e,t,i,r){return this._minX=e,this._maxX=t,this._minY=i,this._maxY=r,this}get minX(){return this._minX}get maxX(){return this._maxX}get minY(){return this._minY}get maxY(){return this._maxY}modify1(e){return this._minX=e.minX,this._maxX=e.maxX,this._minY=e.minY,this._maxY=e.maxY,this}center(){return new ae(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new ae(this.minX,this.maxY)}UR(){return new ae(this.maxX,this.maxY)}LL(){return new ae(this.minX,this.minY)}LR(){return new ae(this.maxX,this.minY)}transform4(e){let t=new vi;return t.ext2(this.LL().multiply4(e)),t.ext2(this.LR().multiply4(e)),t.ext2(this.UR().multiply4(e)),t.ext2(this.UL().multiply4(e)),t.build()}build(){return new Ni(this.minX,this.maxX,this.minY,this.maxY)}},Zt=new x8;var UT=512,FT="#000000",GT="#000000",zT=[1,0,0,1,0,0],HT="10px sans-serif",v8=class{constructor(e){this.stateStack=[],this.operateStack=[],this.transformMatrix=zT,this.fillStyle=FT,this.strokeStyle=GT,this.font=HT,this.context=e}getContext(){return this.context}originSave(){this.context.save()}originRestore(){this.context.restore(),this.reset()}reset(){delete this.lastState,delete this.lastOperate,this.transformMatrix=zT,this.fillStyle=FT,this.strokeStyle=GT,this.font=HT}save(){this.lastState={},this.stateStack.push(this.lastState),this.lastOperate=[],this.operateStack.push(this.lastOperate)}restore(){let e=Object.keys(this.lastState).filter(i=>i==="transform");for(let i in this.lastState){let r=this.lastState[i];switch(i){case"transform":{this.context.setTransform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transformMatrix=r;break}case"lineDash":{this.context.setLineDash(r);break}default:{switch(i){case"fillStyle":{this.fillStyle=r;break}case"strokeStyle":{this.strokeStyle=r;break}case"font":{this.font=r;break}}this.context[i]=r}}}let t=[];if(!e.length)for(let i of this.lastOperate.reverse())if(typeof i=="string")switch(i){case"translate":{this.context.translate(t[1],t[0]),t=[];break}case"rotate":{this.context.rotate(t[0]),t=[];break}case"scale":{this.context.scale(t[1],t[0]),t=[];break}}else t.push(i);this.stateStack.pop(),this.lastState=this.stateStack[this.stateStack.length-1],this.operateStack.pop(),this.lastOperate=this.operateStack[this.operateStack.length-1]}setFillStyle(e){e!==this.fillStyle&&(this.lastState&&this.lastState.fillStyle===void 0&&(this.lastState.fillStyle=this.fillStyle),this.fillStyle=e,this.context.fillStyle=e)}setStrokeStyle(e){e!==this.strokeStyle&&(this.lastState&&this.lastState.strokeStyle===void 0&&(this.lastState.strokeStyle=this.strokeStyle),this.strokeStyle=e,this.context.strokeStyle=e)}setLineCap(e){e!==this.context.lineCap&&(this.lastState&&this.lastState.lineCap===void 0&&(this.lastState.lineCap=this.context.lineCap),this.context.lineCap=e)}setTranslate(e,t){var i;(i=this.lastOperate)==null||i.push("translate",-e,-t),this.context.translate(e,t)}setRotate(e){var t;(t=this.lastOperate)==null||t.push("rotate",-e),this.context.rotate(e)}setScale(e,t){var i;(i=this.lastOperate)==null||i.push("scale",1/e,1/t),this.context.scale(e,t)}setTransform(e){this.lastState&&this.lastState.transform===void 0&&(this.lastState.transform=this.transformMatrix),this.transformMatrix=[e[0],e[1],e[2],e[3],e[4],e[5]],this.context.setTransform(e[0],e[1],e[2],e[3],e[4],e[5])}setLineDash(e){let t=this.context.getLineDash();JSON.stringify(e)!==JSON.stringify(t)&&(this.lastState&&this.lastState.lineDash===void 0&&(this.lastState.lineDash=t),this.context.setLineDash(e))}setLineWidth(e){e!==this.context.lineWidth&&(this.lastState&&this.lastState.lineWidth===void 0&&(this.lastState.lineWidth=this.context.lineWidth),this.context.lineWidth=e)}setTextAlign(e){e!==this.context.textAlign&&(this.lastState&&this.lastState.textAlign===void 0&&(this.lastState.textAlign=this.context.textAlign),this.context.textAlign=e)}setTextBaseLine(e){e!==this.context.textBaseline&&(this.lastState&&this.lastState.textBaseline===void 0&&(this.lastState.textBaseline=this.context.textBaseline),this.context.textBaseline=e)}setFont(e){e!==this.font&&(this.lastState&&this.lastState.font===void 0&&(this.lastState.font=this.font),this.font=e,this.context.font=e)}setGlobalAlpha(e){e!==this.context.globalAlpha&&(this.lastState&&this.lastState.globalAlpha===void 0&&(this.lastState.globalAlpha=this.context.globalAlpha),this.context.globalAlpha=e)}setShadowBlur(e){e!==this.context.shadowBlur&&(this.lastState&&this.lastState.shadowBlur===void 0&&(this.lastState.shadowBlur=this.context.shadowBlur),this.context.shadowBlur=e)}setShadowColor(e){e!==this.context.shadowColor&&(this.lastState&&this.lastState.shadowColor===void 0&&(this.lastState.shadowColor=this.context.shadowColor),this.context.shadowColor=e)}setShadowOffsetX(e){e!==this.context.shadowOffsetX&&(this.lastState&&this.lastState.shadowOffsetX===void 0&&(this.lastState.shadowOffsetX=this.context.shadowOffsetX),this.context.shadowOffsetX=e)}setShadowOffsetY(e){e!==this.context.shadowOffsetY&&(this.lastState&&this.lastState.shadowOffsetY===void 0&&(this.lastState.shadowOffsetY=this.context.shadowOffsetY),this.context.shadowOffsetY=e)}},E8=el*3,N1=(e=>(e[e.ID=0]="ID",e[e.POSITION_X=1]="POSITION_X",e[e.POSITION_Y=2]="POSITION_Y",e[e.WIDTH=3]="WIDTH",e[e.HEIGHT=4]="HEIGHT",e[e.ANGLE=5]="ANGLE",e[e.STRING_LENGTH=6]="STRING_LENGTH",e[e.STRING_INDEX=7]="STRING_INDEX",e[e.MAX_PX_HEIGHT=8]="MAX_PX_HEIGHT",e[e.LIMIT_MAX=9]="LIMIT_MAX",e[e.GROUP_ID=10]="GROUP_ID",e[e.COLOR_INDEX=11]="COLOR_INDEX",e[e.ORDER=12]="ORDER",e[e.WIDTH_OFFSET_RATIO=13]="WIDTH_OFFSET_RATIO",e[e.HEIGHT_OFFSET_RATIO=14]="HEIGHT_OFFSET_RATIO",e[e.TEMPLATE_ID=15]="TEMPLATE_ID",e))(N1||{}),Ow=15,Mr=[],mw=class extends ur{create(e,t,i,r,s,n,a,o,l,h=-1,c,f,d,u){return Mr[0]=e+(10<<wt)+At,Mr[1]=t.x,Mr[2]=t.y,Mr[3]=i,Mr[4]=r,Mr[5]=(s%On+On)%On,Mr[6]=n,Mr[7]=a,Mr[8]=r/o,Mr[9]=l,Mr[10]=h,Mr[11]=c||0,Mr[12]=f||0,Mr[13]=d||0,Mr[14]=u||0,Mr}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+5],n=e[t+3]/2,a=e[t+4]/2,o=e[t+13],l=e[t+14];if(i+=o*n*2,r+=l*a*2,s===0||s===Math.PI)return Zt.modify(i-n,i+n,r-a,r+a);if(s===el||s===E8)return Zt.modify(i-a,i+a,r-n,r+n);let h=Pi(n,a,s),c=Pi(-n,-a,s);return Zt.modify(Math.min(h.x,c.x)+i,Math.max(h.x,c.x)+i,Math.min(h.y,c.y)+r,Math.max(h.y,c.y)+r)}},T8=class extends mw{create(e,t,i,r,s,n,a,o,l,h,c,f,d,u,p){return super.create(e,t,i,r,s,n,a,o,l,h,c,f,d,u),Mr[0]=e+(60<<wt)+At,Mr[14]=p,Mr}},J$=new mw(10,Ow,N1),Z$=new T8(60,Ow+1,N1);var w8="Consolas";var yw=64,S8=yw*2;var I8=["L","P","V","S","H","K","O","C","W","N","D","I"],K$=I8.length*yw*S8;var P8=el*3,bw=(e=>(e[e.ID=0]="ID",e[e.POSITION_X=1]="POSITION_X",e[e.POSITION_Y=2]="POSITION_Y",e[e.WIDTH=3]="WIDTH",e[e.HEIGHT=4]="HEIGHT",e[e.ANGLE=5]="ANGLE",e[e.MAX_PX_LENGTH=6]="MAX_PX_LENGTH",e[e.LIMIT_MAX=7]="LIMIT_MAX",e[e.LEFT_STRING_INDEX=8]="LEFT_STRING_INDEX",e[e.RIGHT_STRING_INDEX=9]="RIGHT_STRING_INDEX",e[e.ORDER=10]="ORDER",e[e.GROUP_ID=11]="GROUP_ID",e[e.COLOR_INDEX=12]="COLOR_INDEX",e[e.TEMPLATE_ID=13]="TEMPLATE_ID",e))(bw||{}),A8=13,Bs=[],C8=class extends ur{create(e,t,i,r,s,n,a,o,l,h=-1,c,f){return Bs[0]=e+(19<<wt)+At,Bs[1]=t.x,Bs[2]=t.y,Bs[3]=i,Bs[4]=r,Bs[5]=(s%On+On)%On,Bs[6]=r/n,Bs[7]=a,Bs[8]=o,Bs[9]=l,Bs[10]=f||0,Bs[11]=h,Bs[12]=c||0,Bs}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+5],n=e[t+3]/2,a=e[t+4]/2;if(s===0||s===Math.PI)return Zt.modify(i-n,i+n,r-a,r+a);if(s===el||s===P8)return Zt.modify(i-a,i+a,r-n,r+n);let o=Pi(n,a,s),l=Pi(-n,-a,s);return Zt.modify(Math.min(o.x,l.x)+i,Math.max(o.x,l.x)+i,Math.min(o.y,l.y)+r,Math.max(o.y,l.y)+r)}},$$=new C8(19,A8,bw),kd=class extends ur{getOrder(e,t,i){let r=e[t+this.DataIndex.GROUP_ID]*Ko+6;return i.get(r)}getGroupId(e,t,i){if(!this.DataIndex.GROUP_ID)throw new Error("GetGroupId error ");let r=e.get(t+this.DataIndex.GROUP_ID)*Ko+8;return i.get(r)}getTemplateId(e,t,i){let r=e[t+this.DataIndex.GROUP_ID]*Ko+9;return i.get(r)}getColorIndex(e,t,i){let r=e[t+this.DataIndex.GROUP_ID]*Ko+7;return i.get(r)}},pi=(e=>(e[e.ID=0]="ID",e[e.INDEX=1]="INDEX",e[e.TEMPLATE_INSTANCE_INDEX=2]="TEMPLATE_INSTANCE_INDEX",e[e.COLOR_INDEX=3]="COLOR_INDEX",e[e.GROUP_ID=4]="GROUP_ID",e))(pi||{}),bi=5,dc=[];function xw(e,t,i,r,s=-1){return dc[0]=e+(this.type<<wt)+At,dc[1]=t,dc[2]=i,dc[3]=r||0,dc[4]=s,dc}var ar=class extends ur{create(e,t,i,r,s=-1){return xw(e,t,i,r,s)}getBBox(e,t){return Zt}},tl=class extends kd{create(e,t,i,r,s=-1){return xw(e,t,i,r,s)}getBBox(e,t){return Zt}},Q$=new ar(21,bi,pi),eQ=new ar(22,bi,pi),tQ=new ar(23,bi,pi),iQ=new ar(24,bi,pi),rQ=new ar(25,bi,pi),sQ=new ar(26,bi,pi),nQ=new ar(27,bi,pi),aQ=new tl(28,bi,pi),oQ=new tl(29,bi,pi),lQ=new ar(30,bi,pi),hQ=new ar(31,bi,pi),cQ=new ar(32,bi,pi),uQ=new tl(33,bi,pi),dQ=new tl(34,bi,pi),fQ=new ar(35,bi,pi),pQ=new ar(36,bi,pi),_Q=new ar(37,bi,pi),gQ=new ar(38,bi,pi),OQ=new ar(39,bi,pi),mQ=new ar(40,bi,pi),yQ=new ar(41,bi,pi),bQ=new ar(42,bi,pi),xQ=new tl(43,bi,pi),vQ=new tl(44,bi,pi),EQ=new ar(45,bi,pi),TQ=new ar(46,bi,pi),wQ=new ar(47,bi,pi),SQ=new tl(48,bi,pi),IQ=new tl(49,bi,pi),PQ=new ar(50,bi,pi),N8=4,AQ=2**N8-1;var CQ=2**16;var N_=.5,ql=Math.sqrt(.5),NQ=1-(Math.acos(N_/ql)*ql*ql-N_*Math.sqrt(ql*ql-N_*N_))/Math.PI/(ql*ql);var L8=4,R8=2**30/L8,LQ=R8/2,RQ=2**(2**7-1),DQ=2**31-1;function jT(e,t){return`${e["font-style"]||"normal"} ${e["font-weight"]||"normal"} ${`${t||parseFloat(e["font-size"])||10}px`} ${e["font-family"]}, sans-serif`}var D8=class wd{constructor(){this.lastFontStyleString="",this.lastRatio=0,this.ctx=new v8(document.createElement("canvas").getContext("2d")),this.divDom=document.createElement("div"),this.recordFontFamily=new Map}static getInstance(){return wd.instance==null&&(wd.instance=new wd),wd.instance}getCorrectFontFamily(t){let i=this.recordFontFamily.get(t);if(i)return i;this.divDom.style.fontFamily=t,document.body.appendChild(this.divDom);let r=window.getComputedStyle(this.divDom).fontFamily;return this.recordFontFamily.set(t,r),this.divDom.style.fontFamily="",document.body.removeChild(this.divDom),r}getTextInfo(t,i){i["font-family"]=this.getCorrectFontFamily(i["font-family"]);let r=parseFloat(i["font-size"]),s=JSON.stringify(i);if(!this.lastFontStyleString||!this.lastRatio||s!==this.lastFontStyleString){let o=jT(i,UT);this.ctx.setFont(o);let l=this.ctx.getContext().measureText(t),h=l.fontBoundingBoxAscent+l.fontBoundingBoxDescent;this.lastRatio=UT/h,this.lastFontStyleString=s}let n=r*this.lastRatio,a=jT(i,n);return this.ctx.setFont(a),{width:this.ctx.getContext().measureText(t).width,height:r,fontFamily:i["font-family"],renderFontSize:n}}};D8.instance=null;var vw=class{};vw.value=null;function YT(e,t,i){return{x:t*e[0]+i*e[3]+e[6],y:t*e[1]+i*e[4]+e[7]}}function Pi(e,t,i){return{x:e*Math.cos(i)-t*Math.sin(i),y:e*Math.sin(i)+t*Math.cos(i)}}function VT(e,t,i,r){return{x:e*i,y:t*r}}var ng=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.WIDTH=4]="WIDTH",e[e.START_ANGLE=5]="START_ANGLE",e[e.SWEEP_ANGLE=6]="SWEEP_ANGLE",e[e.ORDER=7]="ORDER",e[e.COLOR_INDEX=8]="COLOR_INDEX",e[e.GROUP_ID=9]="GROUP_ID",e[e.DASH_ARR_INDEX=10]="DASH_ARR_INDEX",e[e.LINE_CAP=11]="LINE_CAP",e))(ng||{}),qT=10,M8=12,qr=[],L1=class extends ur{create(e,t,i,r,s,n,a,o,l=-1){return qr[0]=e+(1<<wt)+At,qr[1]=t.x,qr[2]=t.y,qr[3]=i,qr[4]=r,qr[5]=s,qr[6]=n,qr[7]=a||0,qr[8]=o||0,qr[9]=l,qr}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=e[t+5],o=a+e[t+6],{x:l,y:h}=Pi(1,0,a),{x:c,y:f}=Pi(1,0,o),d=Math.min(l,c),u=Math.max(l,c),p=Math.min(h,f),_=Math.max(h,f),g=n/2;for(let b=Math.ceil(a/(Math.PI/2))*(Math.PI/2);b<o;b+=Math.PI/2){let{x:m,y:O}=Pi(1,0,b);d=Math.min(m,d),u=Math.max(m,u),p=Math.min(O,p),_=Math.max(O,_)}return Zt.modify(d*s+i-g,u*s+i+g,p*s+r-g,_*s+r+g)}},B8=class extends L1{create(e,t,i,r,s,n,a,o,l=-1,h=-1,c="round"){return super.create(e,t,i,r,s,n,a,o,l),qr[10]=h,qr[11]=gw[c],qr}},k8=class extends L1{create(e,t,i,r,s,n,a,o,l=-1){return super.create(e,t,i,r,s,n,a,o,l),qr}},U8=class extends L1{create(e,t,i,r,s,n,a,o,l=-1,h=-1){return super.create(e,t,i,r,s,n,a,o,l),qr[0]=e+(52<<wt)+At,qr[10]=h,qr}},F8,G8,z8;kc(()=>F8=new B8(1,M8,ng),()=>{G8=new k8(1,qT,ng),z8=new U8(52,qT+1,ng)});var Ew=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.START_ANGLE=4]="START_ANGLE",e[e.SWEEP_ANGLE=5]="SWEEP_ANGLE",e[e.START_X=6]="START_X",e[e.START_Y=7]="START_Y",e[e.END_X=8]="END_X",e[e.END_Y=9]="END_Y",e[e.ORDER=10]="ORDER",e[e.COLOR_INDEX=11]="COLOR_INDEX",e[e.GROUP_ID=12]="GROUP_ID",e[e.FillStyle=13]="FillStyle",e))(Ew||{}),p1=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.START_ANGLE=4]="START_ANGLE",e[e.SWEEP_ANGLE=5]="SWEEP_ANGLE",e[e.START_X=6]="START_X",e[e.START_Y=7]="START_Y",e[e.END_X=8]="END_X",e[e.END_Y=9]="END_Y",e[e.ORDER=10]="ORDER",e[e.COLOR_INDEX=11]="COLOR_INDEX",e[e.GROUP_ID=12]="GROUP_ID",e[e.TEMPLATE_ID=13]="TEMPLATE_ID",e))(p1||{}),XT=13,H8=14,Er=[],R1=class extends ur{create(e,t,i,r,s,n,a,o,l,h=-1){return Er[0]=e+(7<<wt)+At,Er[1]=t.x,Er[2]=t.y,Er[3]=i,Er[4]=r,Er[5]=s,Er[6]=n.x,Er[7]=n.y,Er[8]=a.x,Er[9]=a.y,Er[10]=o||0,Er[11]=l||0,Er[12]=h,Er}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=n+e[t+5],{x:o,y:l}=Pi(1,0,n),{x:h,y:c}=Pi(1,0,a),f=Math.min(o,h),d=Math.max(o,h),u=Math.min(l,c),p=Math.max(l,c);if(n<a)for(let _=Math.ceil(n/(Math.PI/2))*(Math.PI/2);_<a;_+=Math.PI/2){let{x:g,y:b}=Pi(1,0,_);f=Math.min(g,f),d=Math.max(g,d),u=Math.min(b,u),p=Math.max(b,p)}else for(let _=Math.floor(n/(Math.PI/2))*(Math.PI/2);_>a;_-=Math.PI/2){let g=Math.cos(_),b=Math.sin(_);f=Math.min(g,f),d=Math.max(g,d),u=Math.min(b,u),p=Math.max(b,p)}return Zt.modify(f*s+i,d*s+i,u*s+r,p*s+r)}},j8=class extends R1{create(e,t,i,r,s,n,a,o,l,h=-1,c=1){return super.create(e,t,i,r,s,n,a,o,l,h),Er[13]=c,Er}},Y8=class extends R1{create(e,t,i,r,s,n,a,o,l,h=-1){return super.create(e,t,i,r,s,n,a,o,l,h),Er}},V8=class extends R1{create(e,t,i,r,s,n,a,o,l,h=-1,c=-1){return super.create(e,t,i,r,s,n,a,o,l,h),Er[0]=e+(57<<wt)+At,Er[13]=c,Er}},q8,X8,W8;kc(()=>q8=new j8(7,H8,Ew),()=>{X8=new Y8(7,XT,p1),W8=new V8(57,XT+1,p1)});var D1=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.START_ANGLE=4]="START_ANGLE",e[e.SWEEP_ANGLE=5]="SWEEP_ANGLE",e[e.START_X=6]="START_X",e[e.START_Y=7]="START_Y",e[e.END_X=8]="END_X",e[e.END_Y=9]="END_Y",e[e.GROUP_ID=10]="GROUP_ID",e[e.FillStyle=11]="FillStyle",e))(D1||{}),Tw=12,Ps=[],ww=class extends kd{create(e,t,i,r,s,n,a,o,l=1){return Ps[0]=e+(9<<wt)+At,Ps[1]=t.x,Ps[2]=t.y,Ps[3]=i,Ps[4]=r,Ps[5]=s,Ps[6]=n.x,Ps[7]=n.y,Ps[8]=a.x,Ps[9]=a.y,Ps[10]=o,Ps[11]=l,Ps}getBBox(e,t,i){let r=e[t+1],s=e[t+2],n=e[t+3],a=e[t+4],o=a+e[t+5],l=e[t+10]*Ko,h=new vi;function c(d){let{x:u,y:p}=Pi(n,0,d);u+=r,p+=s,h.ext6(u*i.get(l)+p*i.get(l+2)+i.get(l+4),u*i.get(l+1)+p*i.get(l+3)+i.get(l+5))}if(c(a),c(o),a<o)for(let d=Math.ceil(a/(Math.PI/2))*(Math.PI/2);d<o;d+=Math.PI/2)c(d);else for(let d=Math.floor(a/(Math.PI/2))*(Math.PI/2);d>o;d-=Math.PI/2)c(d);let f=h.build1();return Zt.modify(f.minX,f.maxX,f.minY,f.maxY)}},J8=class extends ww{create(e,t,i,r,s,n,a,o,l){return super.create(e,t,i,r,s,n,a,o,l),Ps[0]=e+(59<<wt)+At,Ps}},kQ=new ww(9,Tw,D1),UQ=new J8(59,Tw,D1),M1=(e=>(e[e.ID=0]="ID",e[e.POINT1_X=1]="POINT1_X",e[e.POINT1_Y=2]="POINT1_Y",e[e.POINT2_X=3]="POINT2_X",e[e.POINT2_Y=4]="POINT2_Y",e[e.POINT3_X=5]="POINT3_X",e[e.POINT3_Y=6]="POINT3_Y",e[e.GROUP_ID=7]="GROUP_ID",e[e.FillStyle=8]="FillStyle",e))(M1||{}),Sw=9,pn=[],Iw=class extends kd{create(e,t,i,r,s,n=1){return pn[0]=e+(8<<wt)+At,pn[1]=t.x,pn[2]=t.y,pn[3]=i.x,pn[4]=i.y,pn[5]=r.x,pn[6]=r.y,pn[7]=s,pn[8]=n,pn}getBBox(e,t,i){let r=e[t+1],s=e[t+2],n=e[t+3],a=e[t+4],o=e[t+5],l=e[t+6],h=e[t+7]*Ko,c=i.get(h),f=i.get(h+1),d=i.get(h+2),u=i.get(h+3),p=i.get(h+4),_=i.get(h+5),g=r*c+s*d+p,b=r*f+s*u+_,m=n*c+a*d+p,O=n*f+a*u+_,y=o*c+l*d+p,x=o*f+l*u+_;return Zt.modify(Math.min(g,m,y),Math.max(g,m,y),Math.min(b,O,x),Math.max(b,O,x))}},Z8=class extends Iw{create(e,t,i,r,s,n){return super.create(e,t,i,r,s,n),pn[0]=e+(58<<wt)+At,pn}},FQ=new Iw(8,Sw,M1),GQ=new Z8(58,Sw,M1),Pw=(e=>(e[e.ID=0]="ID",e[e.POINT1_X=1]="POINT1_X",e[e.POINT1_Y=2]="POINT1_Y",e[e.POINT2_X=3]="POINT2_X",e[e.POINT2_Y=4]="POINT2_Y",e[e.POINT3_X=5]="POINT3_X",e[e.POINT3_Y=6]="POINT3_Y",e[e.ORDER=7]="ORDER",e[e.COLOR_INDEX=8]="COLOR_INDEX",e[e.GROUP_ID=9]="GROUP_ID",e[e.FILL_STYLE=10]="FILL_STYLE",e))(Pw||{}),WT=10,K8=11,bs=[],ag=(e=>(e[e.ID=0]="ID",e[e.POINT1_X=1]="POINT1_X",e[e.POINT1_Y=2]="POINT1_Y",e[e.POINT2_X=3]="POINT2_X",e[e.POINT2_Y=4]="POINT2_Y",e[e.POINT3_X=5]="POINT3_X",e[e.POINT3_Y=6]="POINT3_Y",e[e.ORDER=7]="ORDER",e[e.COLOR_INDEX=8]="COLOR_INDEX",e[e.GROUP_ID=9]="GROUP_ID",e[e.TEMPLATE_ID=10]="TEMPLATE_ID",e))(ag||{}),B1=class extends ur{create(e,t,i,r,s,n,a=-1){return bs[0]=e+(6<<wt)+At,bs[1]=t.x,bs[2]=t.y,bs[3]=i.x,bs[4]=i.y,bs[5]=r.x,bs[6]=r.y,bs[7]=s||0,bs[8]=n||0,bs[9]=a,bs}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=e[t+5],o=e[t+6];return Zt.modify(Math.min(i,s,a),Math.max(i,s,a),Math.min(r,n,o),Math.max(r,n,o))}},$8=class extends B1{create(e,t,i,r,s,n,a=-1,o=1){return super.create(e,t,i,r,s,n,a),bs[10]=o,bs}},Q8=class extends B1{create(e,t,i,r,s,n,a=-1){return super.create(e,t,i,r,s,n,a)}},e7=class extends B1{create(e,t,i,r,s,n,a=-1,o=-1){return super.create(e,t,i,r,s,n,a),bs[0]=e+(56<<wt)+At,bs[10]=o,bs}},t7,i7,r7;kc(()=>(t7=new $8(6,K8,Pw),ag),()=>{i7=new Q8(6,WT,ag),r7=new e7(56,WT+1,ag)});var s7=el*3,n7=10,Aw=(e=>(e[e.ID=0]="ID",e[e.STRING_INDEX=1]="STRING_INDEX",e[e.POSITION_X=2]="POSITION_X",e[e.POSITION_Y=3]="POSITION_Y",e[e.ANGLE=4]="ANGLE",e[e.WIDTH=5]="WIDTH",e[e.HEIGHT=6]="HEIGHT",e[e.COLOR_INDEX=7]="COLOR_INDEX",e[e.ORDER=8]="ORDER",e[e.GROUP_ID=9]="GROUP_ID",e))(Aw||{}),kn=[],a7=class extends ur{create(e,t,i,r,s,n,a,o,l=-1){return kn[0]=e+(18<<wt)+At,kn[1]=t,kn[2]=i.x,kn[3]=i.y,kn[4]=(r%On+On)%On,kn[5]=s,kn[6]=n,kn[7]=a||0,kn[8]=o||0,kn[9]=l,kn}getBBox(e,t){let i=e[t+5],r=e[t+6],s=e[t+2]+i/2,n=e[t+3]+r/2,a=e[t+4],o=i/2,l=r/2;if(a===0||a===Math.PI){let u=Math.min(s-o,s+o),p=Math.max(s-o,s+o),_=Math.min(n-l,n+l),g=Math.max(n-l,n+l);return Zt.modify(u,p,_,g)}if(a===el||a===s7){let u=Math.min(s-l,s+l),p=Math.max(s-l,s+l),_=Math.min(n-o,n+o),g=Math.max(n-o,n+o);return Zt.modify(u,p,_,g)}let h=Pi(o,l,a),c=Pi(-o,-l,a),f=i>0?1:-1,d=r>0?1:-1;return h=VT(h.x,h.y,f,d),c=VT(c.x,c.y,f,d),Zt.modify(Math.min(h.x,c.x)+s,Math.max(h.x,c.x)+s,Math.min(h.y,c.y)+n,Math.max(h.y,c.y)+n)}},zQ=new a7(18,n7,Aw);var HQ=2**C1-1;var o7=6,jQ=o7-1,YQ=2**16;var og=class $s{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%$s.PIx2,t=t<0?$s.PIx2+t:t,t===$s.PIx2?0:t}static toQuarterBase(t){return $s.regular((t+$s.PI_4)/$s.PI_2*$s.PI_2)}static toQuarterBaseD(t){return $s.regularD(((t+45)/90|0)*90)}static transformD(t,i){return $s.toDegrees($s.transform($s.toRadians(t),i))}static transform(t,i){let r=Math.cos(t),s=Math.sin(t),n=new ae(i.data[6],i.data[7]),a=new ae(r,s).multiply3(i);return $s.regular(a.angle(n))}};og.PIx2=Math.PI*2,og.PI_2=Math.PI/2,og.PI_4=Math.PI/4;var U0=og,JT=class{static regular(e){return Math.round(e*this.precision)/this.precision}static eq(e,t){return Math.abs(e-t)<=this.eps}static neq(e,t){return Math.abs(e-t)>this.eps}static less(e,t){return e-t<-this.eps}static lesseq(e,t){return e-t<this.eps}static greater(e,t){return e-t>this.eps}static greatereq(e,t){return e-t>-this.eps}static sqrt(e){return Math.abs(e)<=1e-10?0:Math.sqrt(e)}static sortAsc(e,t){return e-t}static sortDesc(e,t){return t-e}};JT.eps=1e-8,JT.precision=1e8;var k1=(e=>(e[e.ID=0]="ID",e[e.START_X=1]="START_X",e[e.START_Y=2]="START_Y",e[e.END_X=3]="END_X",e[e.END_Y=4]="END_Y",e[e.LEN_ADD_GAP=5]="LEN_ADD_GAP",e[e.LEN=6]="LEN",e[e.ORDER=7]="ORDER",e[e.COLOR_INDEX=8]="COLOR_INDEX",e[e.GROUP_ID=9]="GROUP_ID",e[e.TEMPLATE_ID=10]="TEMPLATE_ID",e))(k1||{}),Cw=10,Gs=[],Nw=class extends ur{create(e,t,i,r,s,n,a,o,l=-1){return Gs[0]=e+(3<<wt)+At,Gs[1]=t.x,Gs[2]=t.y,Gs[3]=i.x,Gs[4]=i.y,Gs[5]=r?1:s+n,Gs[6]=r?1:s,Gs[7]=a||0,Gs[8]=o||0,Gs[9]=l,Gs}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=Math.max(i,s),o=Math.min(i,s),l=Math.max(r,n),h=Math.min(r,n);return Zt.modify(o,a,h,l)}},l7=class extends Nw{create(e,t,i,r,s,n,a,o,l=-1,h=-1){return super.create(e,t,i,r,s,n,a,o,l),Gs[0]=e+(54<<wt)+At,Gs[10]=h,Gs}},ZQ=new Nw(3,Cw,k1),KQ=new l7(54,Cw+1,k1),U1=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.COLOR_INDEX1=4]="COLOR_INDEX1",e[e.COLOR_INDEX2=5]="COLOR_INDEX2",e[e.ORDER=6]="ORDER",e[e.GROUP_ID=7]="GROUP_ID",e[e.TEMPLATE_ID=8]="TEMPLATE_ID",e))(U1||{}),Lw=8,_n=[],Rw=class extends ur{create(e,t,i,r,s,n,a=-1){return _n[0]=e+(4<<wt)+At,_n[1]=t.x,_n[2]=t.y,_n[3]=i,_n[4]=r,_n[5]=s,_n[6]=n||0,_n[7]=a,_n}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3];return Zt.modify(i-s,i+s,r-s,r+s)}},h7=class extends Rw{create(e,t,i,r,s,n,a,o){return super.create(e,t,i,r,s,n,a),_n[0]=e+(55<<wt)+At,_n[8]=o,_n}},$Q=new Rw(4,Lw,U1),QQ=new h7(55,Lw+1,U1),Dw=(e=>(e[e.ID=0]="ID",e[e.POSITION_X=1]="POSITION_X",e[e.POSITION_Y=2]="POSITION_Y",e[e.IS_TRIANGLE=3]="IS_TRIANGLE",e[e.SIZE=4]="SIZE",e[e.ORDER=5]="ORDER",e[e.COLOR_INDEX=6]="COLOR_INDEX",e[e.GROUP_ID=7]="GROUP_ID",e[e.TEMPLATE_ID=8]="TEMPLATE_ID",e))(Dw||{}),c7=8,eo=[],u7=class extends ur{create(e,t,i,r,s,n,a=-1){return eo[0]=e+(5<<wt)+At,eo[1]=t.x,eo[2]=t.y,eo[3]=r?1.5:1,eo[4]=i,eo[5]=n||0,eo[6]=s||0,eo[7]=a,eo}getBBox(e,t){let i=e[t+1],r=e[t+2];return Zt.modify(i,i,r,r)}},eee=new u7(5,c7,Dw);var d7=(e=>(e[e.ID=0]="ID",e[e.LD_POINT_X=1]="LD_POINT_X",e[e.LD_POINT_y=2]="LD_POINT_y",e[e.LU_POINT_X=3]="LU_POINT_X",e[e.LU_POINT_Y=4]="LU_POINT_Y",e[e.RD_POINT_X=5]="RD_POINT_X",e[e.RD_POINT_Y=6]="RD_POINT_Y",e[e.RU_POINT_X=7]="RU_POINT_X",e[e.RU_POINT_Y=8]="RU_POINT_Y",e[e.ORDER=9]="ORDER",e))(d7||{});var F1=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.START_ANGLE=4]="START_ANGLE",e[e.SWEEP_ANGLE=5]="SWEEP_ANGLE",e[e.ORDER=6]="ORDER",e[e.COLOR_INDEX=7]="COLOR_INDEX",e[e.GROUP_ID=8]="GROUP_ID",e[e.TEMPLATE_ID=9]="TEMPLATE_ID",e))(F1||{}),Mw=9,Qs=[],Bw=class extends ur{create(e,t,i,r,s,n,a,o=-1){return Qs[0]=e+(12<<wt)+At,Qs[1]=t.x,Qs[2]=t.y,Qs[3]=i,Qs[4]=r,Qs[5]=s,Qs[6]=n||0,Qs[7]=a||0,Qs[8]=o,Qs}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=n+e[t+5],{x:o,y:l}=Pi(1,0,n),{x:h,y:c}=Pi(1,0,a),f=Math.min(o,h),d=Math.max(o,h),u=Math.min(l,c),p=Math.max(l,c);for(let _=Math.ceil(n/(Math.PI/2))*(Math.PI/2);_<a;_+=Math.PI/2){let{x:g,y:b}=Pi(1,0,_);f=Math.min(g,f),d=Math.max(g,d),u=Math.min(b,u),p=Math.max(b,p)}return Zt.modify(f*s+i,d*s+i,u*s+r,p*s+r)}},f7=class extends Bw{create(e,t,i,r,s,n,a,o=-1,l=-1){return super.create(e,t,i,r,s,n,a,o),Qs[0]=e+(62<<wt)+At,Qs[9]=l,Qs}},iee=new Bw(12,Mw,F1),ree=new f7(62,Mw+1,F1),G1=(e=>(e[e.ID=0]="ID",e[e.START_X=1]="START_X",e[e.START_Y=2]="START_Y",e[e.END_X=3]="END_X",e[e.END_Y=4]="END_Y",e[e.ORDER=5]="ORDER",e[e.COLOR_INDEX=6]="COLOR_INDEX",e[e.GROUP_ID=7]="GROUP_ID",e[e.TEMPLATE_ID=8]="TEMPLATE_ID",e))(G1||{}),kw=8,gn=[],Uw=class extends ur{create(e,t,i,r,s,n=-1){return gn[0]=e+(11<<wt)+At,gn[1]=t.x,gn[2]=t.y,gn[3]=i.x,gn[4]=i.y,gn[5]=r||0,gn[6]=s||0,gn[7]=n,gn}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=Math.max(i,s),o=Math.min(i,s),l=Math.max(r,n),h=Math.min(r,n);return Zt.modify(o,a,h,l)}},p7=class extends Uw{create(e,t,i,r,s,n,a){return super.create(e,t,i,r,s,n),gn[0]=e+(61<<wt)+At,gn[8]=a,gn}},see=new Uw(11,kw,G1),nee=new p7(61,kw+1,G1),z1=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.START_ANGLE=4]="START_ANGLE",e[e.SWEEP_ANGLE=5]="SWEEP_ANGLE",e[e.GROUP_ID=6]="GROUP_ID",e))(z1||{}),Oa=[],Fw=7,Gw=class extends kd{create(e,t,i,r,s,n){return Oa[0]=e+(14<<wt)+At,Oa[1]=t.x,Oa[2]=t.y,Oa[3]=i,Oa[4]=r,Oa[5]=s,Oa[6]=n,Oa}getBBox(e,t,i){let r=e[t+1],s=e[t+2],n=e[t+3],a=e[t+4],o=a+e[t+5],l=e[t+6]*Ko,h=new vi;function c(d){let{x:u,y:p}=Pi(n,0,d);u+=r,p+=s,h.ext6(u*i.get(l)+p*i.get(l+2)+i.get(l+4),u*i.get(l+1)+p*i.get(l+3)+i.get(l+5))}if(c(a),c(o),a<o)for(let d=Math.ceil(a/(Math.PI/2))*(Math.PI/2);d<o;d+=Math.PI/2)c(d);else for(let d=Math.floor(a/(Math.PI/2))*(Math.PI/2);d>o;d-=Math.PI/2)c(d);let f=h.build1();return Zt.modify(f.minX,f.maxX,f.minY,f.maxY)}},_7=class extends Gw{create(e,t,i,r,s,n){return super.create(e,t,i,r,s,n),Oa[0]=e+(64<<wt)+At,Oa}},oee=new Gw(14,Fw,z1),lee=new _7(64,Fw,z1),H1=(e=>(e[e.ID=0]="ID",e[e.START_X=1]="START_X",e[e.START_Y=2]="START_Y",e[e.END_X=3]="END_X",e[e.END_Y=4]="END_Y",e[e.GROUP_ID=5]="GROUP_ID",e))(H1||{}),zw=6,oo=[],Hw=class extends kd{create(e,t,i,r){return oo[0]=e+(13<<wt)+At,oo[1]=t.x,oo[2]=t.y,oo[3]=i.x,oo[4]=i.y,oo[5]=r,oo}getBBox(e,t,i){let r=e[t+1],s=e[t+2],n=e[t+3],a=e[t+4],o=e[t+5]*Ko,l=i.get(o),h=i.get(o+1),c=i.get(o+2),f=i.get(o+3),d=i.get(o+4),u=i.get(o+5),p=r*l+s*c+d,_=r*h+s*f+u,g=n*l+a*c+d,b=n*h+a*f+u;return Zt.modify(Math.min(p,g),Math.max(p,g),Math.min(_,b),Math.max(_,b))}},g7=class extends Hw{create(e,t,i,r){return super.create(e,t,i,r),oo[0]=e+(63<<wt)+At,oo}},hee=new Hw(13,zw,H1),cee=new g7(63,zw,H1),jw=(e=>(e[e.ID=0]="ID",e[e.CenterX=1]="CenterX",e[e.CenterY=2]="CenterY",e[e.A=3]="A",e[e.B=4]="B",e[e.StartAngle=5]="StartAngle",e[e.EndAngle=6]="EndAngle",e[e.Rotation=7]="Rotation",e[e.Stroke=8]="Stroke",e[e.StrokeColorIndex=9]="StrokeColorIndex",e[e.DashArrayIndex=10]="DashArrayIndex",e[e.LineCapIndex=11]="LineCapIndex",e[e.FillColorIndex=12]="FillColorIndex",e[e.FillStyleIndex=13]="FillStyleIndex",e[e.ORDER=14]="ORDER",e[e.GROUP_ID=15]="GROUP_ID",e))(jw||{}),os=[],O7=class extends ur{create(e,t,i,r,s,n,a,o,l=0,h=-1,c=1,f=0,d=1,u=0,p=-1){return os[0]=e+(16<<wt)+At,os[1]=t.x,os[2]=t.y,os[3]=i,os[4]=r,os[5]=s,os[6]=n,os[7]=a,os[8]=o,os[9]=l,os[10]=h,os[11]=c,os[12]=f,os[13]=d,os[14]=u,os[15]=p,os}getBBox(e,t){let i=new ae(e[t+1],e[t+2]),r=e[t+3],s=e[t+4],n=e[t+5],a=e[t+6],o=e[t+7],l=e[t+8]/2,h=r+l,c=s+l,f=new ae(h,0),d=new ae(-h,0),u=new ae(0,c),p=new ae(0,-c),_=S(r,s,-n),g=S(r,s,-a),b=MT(U0.regular(n),3),m=MT(b,3);b==m&&b==0&&(a<n?b=U0.PIx2:m=U0.PIx2);let O=Math.PI,y=O/2,x=O*3/2,E=new vi;b==0?m==0?E.ext5(-l,l,-l,l):m<y?(E.ext2(f),E.ext2(g)):m<O?(E.ext2(f),E.ext2(p),E.ext2(g)):m<x?(E.ext2(f),E.ext2(p),E.ext2(d),E.ext2(g)):(E.ext2(f),E.ext2(p),E.ext2(d),E.ext2(u),E.ext2(g)):m==0?(E.ext2(_),E.ext2(p),E.ext2(d),E.ext2(u),E.ext2(f)):m<y?(E.ext2(_),E.ext2(g)):m<O?(E.ext2(_),E.ext2(p),E.ext2(g)):m<x?(E.ext2(_),E.ext2(p),E.ext2(d),E.ext2(g)):(E.ext2(_),E.ext2(p),E.ext2(d),E.ext2(u),E.ext2(g));let w=E.build().transform(Ii.rotate(-o).translate1(i));return Zt.modify(w.minX,w.maxX,w.minY,w.maxY);function S(C,R,B){let Y=C*Math.cos(B),G=R*Math.sin(B);return new ae(Y,G)}}},fee=new O7(16,16,jw),gs=[],Yw=(e=>(e[e.ID=0]="ID",e[e.EndPointX1=1]="EndPointX1",e[e.EndPointY1=2]="EndPointY1",e[e.EndPointX2=3]="EndPointX2",e[e.EndPointY2=4]="EndPointY2",e[e.ControlX1=5]="ControlX1",e[e.ControlY1=6]="ControlY1",e[e.ControlX2=7]="ControlX2",e[e.ControlY2=8]="ControlY2",e[e.Stroke=9]="Stroke",e[e.StrokeColorIndex=10]="StrokeColorIndex",e[e.DashArrayIndex=11]="DashArrayIndex",e[e.LineCapIndex=12]="LineCapIndex",e[e.ORDER=13]="ORDER",e[e.GROUP_ID=14]="GROUP_ID",e))(Yw||{}),m7=class extends ur{create(e,t,i,r,s,n,a=0,o=-1,l=1,h=0,c=-1){return gs[0]=e+(17<<wt)+At,gs[1]=t.x,gs[2]=t.y,gs[3]=i.x,gs[4]=i.y,gs[5]=r.x,gs[6]=r.y,gs[7]=s.x,gs[8]=s.y,gs[9]=n,gs[10]=a,gs[11]=o,gs[12]=l,gs[13]=h,gs[14]=c,gs}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=e[t+5],o=e[t+6],l=e[t+7],h=e[t+8],c=e[t+9]/2,f=new ke([new ae(i,r),new ae(a,o),new ae(l,h),new ae(s,n)]).bbox().extendOfSize(c);return Zt.modify1(f)}},gee=new m7(17,15,Yw),Vw=(e=>(e[e.ID=0]="ID",e[e.START_X=1]="START_X",e[e.START_Y=2]="START_Y",e[e.END_X=3]="END_X",e[e.END_Y=4]="END_Y",e[e.WIDTH=5]="WIDTH",e[e.ORDER=6]="ORDER",e[e.COLOR_INDEX=7]="COLOR_INDEX",e[e.GROUP_ID=8]="GROUP_ID",e[e.LINE_CAP=9]="LINE_CAP",e[e.DASH_ARR_INDEX=10]="DASH_ARR_INDEX",e[e.SHADOW_COLOR_INDEX=11]="SHADOW_COLOR_INDEX",e[e.SHADOW_BLUR=12]="SHADOW_BLUR",e[e.SHADOW_OFFSET_X=13]="SHADOW_OFFSET_X",e[e.SHADOW_OFFSET_Y=14]="SHADOW_OFFSET_Y",e[e.TEMPLATE_ID=15]="TEMPLATE_ID",e))(Vw||{}),_1=(e=>(e[e.ID=0]="ID",e[e.START_X=1]="START_X",e[e.START_Y=2]="START_Y",e[e.END_X=3]="END_X",e[e.END_Y=4]="END_Y",e[e.WIDTH=5]="WIDTH",e[e.ORDER=6]="ORDER",e[e.COLOR_INDEX=7]="COLOR_INDEX",e[e.GROUP_ID=8]="GROUP_ID",e[e.LINE_CAP=9]="LINE_CAP",e[e.TEMPLATE_ID=10]="TEMPLATE_ID",e))(_1||{}),y7=15,ZT=10,Tr=[],j1=class extends ur{create(e,t,i,r,s="round",n,a,o=-1){return Tr[0]=e+(15<<wt)+At,Tr[1]=t.x,Tr[2]=t.y,Tr[3]=i.x,Tr[4]=i.y,Tr[5]=r,Tr[6]=n||0,Tr[7]=a||0,Tr[8]=o,Tr[9]=gw[s],Tr}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3],n=e[t+4],a=e[t+5],o=Math.max(i,s),l=Math.min(i,s),h=Math.max(r,n),c=Math.min(r,n),f=a/2;return Zt.modify(l-f,o+f,c-f,h+f)}},b7=class extends j1{create(e,t,i,r,s="round",n,a,o=-1,l=-1,h,c,f,d){return super.create(e,t,i,r,s,n,a,o),Tr[10]=l,Tr[11]=h||0,Tr[12]=c||0,Tr[13]=f||0,Tr[14]=d||0,Tr}},x7=class extends j1{create(e,t,i,r,s="round",n,a,o=-1){return super.create(e,t,i,r,s,n,a,o)}},v7=class extends j1{create(e,t,i,r,s="round",n,a,o=-1,l=-1){return super.create(e,t,i,r,s,n,a,o),Tr[0]=e+(65<<wt)+At,Tr[10]=l,Tr}},E7,T7,w7;kc(()=>E7=new b7(15,y7,Vw),()=>{T7=new x7(15,ZT,_1),w7=new v7(65,ZT+1,_1)});var qw=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.ORDER=4]="ORDER",e[e.COLOR_INDEX=5]="COLOR_INDEX",e[e.GROUP_ID=6]="GROUP_ID",e[e.FILL_STYLE=7]="FILL_STYLE",e))(qw||{}),g1=(e=>(e[e.ID=0]="ID",e[e.CENTER_X=1]="CENTER_X",e[e.CENTER_Y=2]="CENTER_Y",e[e.RADIUS=3]="RADIUS",e[e.ORDER=4]="ORDER",e[e.COLOR_INDEX=5]="COLOR_INDEX",e[e.GROUP_ID=6]="GROUP_ID",e[e.TEMPLATE_ID=7]="TEMPLATE_ID",e))(g1||{}),KT=7,S7=8,en=[],Y1=class extends ur{create(e,t,i,r,s,n=-1){return en[0]=e+(0<<wt)+At,en[1]=t.x,en[2]=t.y,en[3]=i,en[4]=r||0,en[5]=s||0,en[6]=n,en}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+3];return Zt.modify(i-s,i+s,r-s,r+s)}},I7=class extends Y1{create(e,t,i,r,s,n=-1,a=1){return super.create(e,t,i,r,s,n),en[7]=a,en}},P7=class extends Y1{create(e,t,i,r,s,n){return super.create(e,t,i,r,s,n)}},A7=class extends Y1{create(e,t,i,r,s,n,a=-1){return super.create(e,t,i,r,s,n),en[0]=e+(51<<wt)+At,en[7]=a,en}},C7,N7,L7;kc(()=>C7=new I7(0,S7,qw),()=>{N7=new P7(0,KT,g1),L7=new A7(51,KT+1,g1)});var $T=10,R7=11,lg=(e=>(e[e.ID=0]="ID",e[e.LEFT_POINT_X=1]="LEFT_POINT_X",e[e.LEFT_POINT_Y=2]="LEFT_POINT_Y",e[e.WIDTH=3]="WIDTH",e[e.HEIGHT=4]="HEIGHT",e[e.ANGLE=5]="ANGLE",e[e.RADIUS=6]="RADIUS",e[e.ORDER=7]="ORDER",e[e.COLOR_INDEX=8]="COLOR_INDEX",e[e.GROUP_ID=9]="GROUP_ID",e[e.TEMPLATE_ID=10]="TEMPLATE_ID",e))(lg||{}),xs=[],V1=class extends ur{create(e,t,i,r,s,n,a,o,l=-1){return xs[0]=e+(2<<wt)+At,xs[1]=t.x,xs[2]=t.y,xs[3]=i,xs[4]=r,xs[5]=s,xs[6]=n,xs[7]=a||0,xs[8]=o||0,xs[9]=l,xs}getBBox(e,t){let i=new ae(e[t+1],e[t+2]),r=e[t+3],s=e[t+4],n=e[t+5];if(n===0)return Zt.modify(i.x,i.x+r,i.y-s,i.y);let a=e[t+6],o=Pi(a,-a,n),l=Pi(a,a-s,n),h=Pi(r-a,-a,n),c=Pi(r-a,a-s,n),f=i.add1(o.x,o.y),d=i.add1(l.x,l.y),u=i.add1(h.x,h.y),p=i.add1(c.x,c.y);return Zt.modify(Math.min(f.x,d.x,u.x,p.x)-a,Math.max(f.x,d.x,u.x,p.x)+a,Math.min(f.y,d.y,u.y,p.y)-a,Math.max(f.y,d.y,u.y,p.y)+a)}},D7=class extends V1{create(e,t,i,r,s,n,a,o,l=-1,h=1){return super.create(e,t,i,r,s,n,a,o,l),xs[10]=h,xs}},M7=class extends V1{create(e,t,i,r,s,n,a,o,l=-1){return super.create(e,t,i,r,s,n,a,o,l)}},B7=class extends V1{create(e,t,i,r,s,n,a,o,l=-1,h=-1){return super.create(e,t,i,r,s,n,a,o,l),xs[0]=e+(53<<wt)+At,xs[10]=h,xs}},k7,U7,F7;kc(()=>k7=new D7(2,R7,lg),()=>{U7=new M7(2,$T,lg),F7=new B7(53,$T+1,lg)});var G7=el*3,Xw=(e=>(e[e.ID=0]="ID",e[e.POSITION_X=1]="POSITION_X",e[e.POSITION_Y=2]="POSITION_Y",e[e.WIDTH=3]="WIDTH",e[e.HEIGHT=4]="HEIGHT",e[e.ANGLE=5]="ANGLE",e[e.STRING_LENGTH=6]="STRING_LENGTH",e[e.STRING_INDEX=7]="STRING_INDEX",e[e.GROUP_ID=8]="GROUP_ID",e[e.COLOR_INDEX=9]="COLOR_INDEX",e[e.ORDER=10]="ORDER",e[e.WIDTH_OFFSET_RATIO=11]="WIDTH_OFFSET_RATIO",e[e.HEIGHT_OFFSET_RATIO=12]="HEIGHT_OFFSET_RATIO",e))(Xw||{}),z7=13,ks=[],H7=class extends ur{create(e,t,i,r,s,n,a,o=-1,l,h,c,f){return ks[0]=e+(66<<wt)+At,ks[1]=t.x,ks[2]=t.y,ks[3]=i,ks[4]=r,ks[5]=(s%On+On)%On,ks[6]=n,ks[7]=a,ks[8]=o,ks[9]=l||0,ks[10]=h||0,ks[11]=c||0,ks[12]=f||0,ks}getBBox(e,t){let i=e[t+1],r=e[t+2],s=e[t+5],n=e[t+3]/2,a=e[t+4]/2,o=e[t+11],l=e[t+12];if(i+=o*n*2,r+=l*a*2,s===0||s===Math.PI)return Zt.modify(i-n,i+n,r-a,r+a);if(s===el||s===G7)return Zt.modify(i-a,i+a,r-n,r+n);let h=Pi(n,a,s),c=Pi(-n,-a,s);return Zt.modify(Math.min(h.x,c.x)+i,Math.max(h.x,c.x)+i,Math.min(h.y,c.y)+r,Math.max(h.y,c.y)+r)}},mee=new H7(66,z7,Xw);var lo=class{static init(e){let t=!1;try{vw.value.location.search}catch{t=!0}t||(this.url=new URLSearchParams(e.location.search),this._useProxy=this.url.has("useProxy"),this._useCpuEngine=this.url.has("cpuEngine"),this._useGpuEngine=this.url.has("gpuEngine"),this._minRenderGridWH=Number(this.url.get("minRenderGridWH"))||0,this._enableLog=this.url.has("enableLog"),this._infiniteScaling=this.url.has("infiniteScaling"))}static useProxy(){return this._useProxy}static useCpuEngine(){return this._useCpuEngine}static useGpuEngine(){return this._useGpuEngine}static getMinRenderGridWH(){return this._minRenderGridWH}static isEnableLog(){return this._enableLog}static getInfiniteScaling(){return this._infiniteScaling}};lo.url=null,lo._useProxy=!1,lo._useCpuEngine=!1,lo._useGpuEngine=!1,lo._minRenderGridWH=0,lo._enableLog=!1,lo._infiniteScaling=!1;var to=class extends lo{static init(e){super.init(e),this.url&&(this._useTexture=this.url.has("useTexture"),this._logFps=this.url.has("logFps"),this._forceRender=this.url.has("render"),this._textureSize=Number(this.url.get("textureSize"))||0,this._minPtNum=Number(this.url.get("minPtNum"))||0,this._buildNumPerFrame=Number(this.url.get("buildNumPerFrame"))||0,this._macNoOnSubmittedWorkDone=this.url.has("macNoOnSubmittedWorkDone"),this._closeGridMulAcc=this.url.has("closeGridMulAcc"),this._closeGirdRender=this.url.has("closeGridRender"))}static macNoOnSubmittedWorkDone(){return this._macNoOnSubmittedWorkDone}static useTexture(){return this._useTexture}static useLogFps(){return this._logFps}static useForceRender(){return this._forceRender}static getTextureSize(){return this._textureSize}static getMinPtNum(){return this._minPtNum}static getBuildNumPerFrame(){return this._buildNumPerFrame}static isCloseGridMulAcc(){return this._closeGridMulAcc}static isCloseGridRender(){return this._closeGirdRender}};to._useTexture=!1,to._logFps=!1,to._forceRender=!1,to._textureSize=0,to._minPtNum=0,to._buildNumPerFrame=0,to._macNoOnSubmittedWorkDone=!1,to._closeGridMulAcc=!1,to._closeGirdRender=!1;var j7=class extends lo{static init(e){super.init(e),this.url&&this.url.get("alpha")&&(this._alpha=Number(this.url.get("alpha")))}static getAlpha(){return this._alpha}};j7._alpha=void 0;var yee=2**31;var bee=new Error("list is empty");var Y7=64*2**10,V7=256;if(!Number.isInteger(Y7/V7))throw new Error("!Number.isInteger(MIN_BUFFER_SIZE / CHUNK_SIZE)");var O1=i8(),hg=O1.top||O1;try{hg.location&&hg.location.search}catch{hg=null}var See=hg&&q7();function q7(){let e=O1.PRO_LOG_LEVEL;return e=="trace"||e=="debug"}var Ww=Symbol("release"),QT=2**32;function F0(e,t,i,r){return`${e}-${t}-${i}-${r}`}var Aee=class{constructor(e,...t){this.gpu=e,this.size=0,this.texturesIndex={};for(let i of t){let[r,s,n,a,o]=i,l=this.getOrInitTextures(r,s,n,a);for(let h=0;h<o;h++)l.push(this.createTexture(r,s,n,a))}}getOrInitTextures(e,t,i,r){let s=F0(e,t,i,r);return this.texturesIndex[s]||(this.texturesIndex[s]=[])}createTexture(e,t,i,r){return this.size+=e*t*4,new X7(this,this.gpu.createDynamicTexture(e,t,i,r,"texturePool-"+F0(e,t,i,r)))}getTexture(e,t,i,r){let s=this.getOrInitTextures(e,t,i,r);return s.length===0?this.createTexture(e,t,i,r):s.pop()}[Ww](e){let{width:t,height:i,format:r,usage:s}=e.texture;this.texturesIndex[F0(t,i,r,s)].push(e)}recall(){if(this.size<=QT)return;let e=Object.values(this.texturesIndex),t=e.pop();for(;this.size>QT&&t;){let i=t.pop();if(i){let r=i.texture;this.size-=r.width*r.height*4,r.destroy()}else t=e.pop()}}},X7=class{constructor(e,t){this.pool=e,this.texture=t}release(){this.pool[Ww](this)}};var Jw=(e=>(e[e.ID=0]="ID",e[e.STRING_INDEX=1]="STRING_INDEX",e[e.CONTENT_WIDTH=2]="CONTENT_WIDTH",e[e.CONTENT_HEIGHT=3]="CONTENT_HEIGHT",e[e.Matrix3Start=4]="Matrix3Start",e[e.Matrix3End=12]="Matrix3End",e[e.COLOR_INDEX=13]="COLOR_INDEX",e[e.ORDER=14]="ORDER",e[e.GROUP_ID=15]="GROUP_ID",e[e.TEXT_WRAP=16]="TEXT_WRAP",e[e.TEXT_ALIGN=17]="TEXT_ALIGN",e[e.TEXT_VERTICAL_ALIGN=18]="TEXT_VERTICAL_ALIGN",e[e.OVERFLOW=19]="OVERFLOW",e[e.LINE_HEIGHT=20]="LINE_HEIGHT",e[e.SHADOW_COLOR_INDEX=21]="SHADOW_COLOR_INDEX",e[e.SHADOW_BLUR=22]="SHADOW_BLUR",e))(Jw||{}),W7=23,ji=[],J7=class extends ur{create(e,t,i,r,s,n,a,o=-1,l=0,h=0,c=0,f=1,d,u,p){return ji[0]=e+(18<<wt)+At,ji[1]=t,ji[2]=r,ji[3]=s,ji[4]=i.data[0],ji[5]=i.data[1],ji[6]=i.data[2],ji[7]=i.data[3],ji[8]=i.data[4],ji[9]=i.data[5],ji[10]=i.data[6],ji[11]=i.data[7],ji[12]=i.data[8],ji[13]=n||0,ji[14]=a||0,ji[15]=o,ji[16]=l,ji[17]=h,ji[18]=c,ji[19]=f,ji[20]=d||1,ji[21]=u,ji[22]=p||0,ji}getBBox(e,t){let i=e[t+2],r=e[t+3],s=e.slice(t+4,t+12+1),{x:n,y:a}=YT(s,0,0),{x:o,y:l}=YT(s,i,r);return Zt.modify(Math.min(n,o),Math.max(n,o),Math.min(a,l),Math.max(a,l))}},Qee=new J7(18,W7,Jw);var Zw=(e=>(e[e.ID=0]="ID",e[e.LEFT_POINT_X=1]="LEFT_POINT_X",e[e.LEFT_POINT_Y=2]="LEFT_POINT_Y",e[e.WIDTH=3]="WIDTH",e[e.HEIGHT=4]="HEIGHT",e[e.ANGLE=5]="ANGLE",e[e.ORDER=6]="ORDER",e[e.SHADOW_COLOR_INDEX=7]="SHADOW_COLOR_INDEX",e[e.SHADOW_BLUR=8]="SHADOW_BLUR",e[e.GROUP_ID=9]="GROUP_ID",e))(Zw||{}),Z7=10,Un=[],K7=class extends ur{create(e,t,i,r,s,n,a,o,l=-1){return Un[0]=e+(20<<wt)+At,Un[1]=t.x,Un[2]=t.y,Un[3]=i,Un[4]=r,Un[5]=s,Un[6]=o||0,Un[7]=n||0,Un[8]=a||0,Un[9]=l,Un}getBBox(e,t){let i=new ae(e[t+1],e[t+2]),r=e[t+3],s=e[t+4],n=e[t+5];if(n===0)return Zt.modify(i.x,i.x+r,i.y-s,i.y);let a=Pi(0,0,n),o=Pi(0,-s,n),l=Pi(r,0,n),h=Pi(r,-s,n),c=i.add1(a.x,a.y),f=i.add1(o.x,o.y),d=i.add1(l.x,l.y),u=i.add1(h.x,h.y);return Zt.modify(Math.min(c.x,f.x,d.x,u.x),Math.max(c.x,f.x,d.x,u.x),Math.min(c.y,f.y,d.y,u.y),Math.max(c.y,f.y,d.y,u.y))}},ite=new K7(20,Z7,Zw);var nte=2*Math.PI;var $7=[1,3,4];function Kw(e){return ya.build(e.r,e.g,e.b,e.alpha+.1)}var Sd=class{constructor(t){this.bgRuler=new Q7(t),this.scaleRuler=new e9}render(t,i,r,s,n){n=Kw(n),this.bgRuler.render(t,s,n),this.scaleRuler.render(t,i,r,n)}};Sd.DELTA=18,Sd.canvasOrigin=new ae(Sd.DELTA,Sd.DELTA);var Ei=Sd,Q7=class{constructor(e){this.sceneType=e}render(e,t,i){let r=e.getContext();e.setFillStyle(t.toRGBAString()),r.fillRect(0,0,r.canvas.width,Ei.DELTA),r.fillRect(0,0,Ei.DELTA,r.canvas.height),$7.includes(this.sceneType)&&(e.setLineWidth(1),e.setStrokeStyle(i.toRGBAString()),r.beginPath(),r.moveTo(Ei.DELTA,Ei.DELTA),r.lineTo(Ei.DELTA,r.canvas.height),r.stroke(),r.beginPath(),r.moveTo(Ei.DELTA,Ei.DELTA),r.lineTo(r.canvas.width,Ei.DELTA),r.stroke())}},e9=class{constructor(){this.primitives=[],this.spacing=2,this.scale=1,this.ratio=5,this.delta=1,this.unit="mil",this.magnification=10,this.unitConversion=new Bd,this.fontSize=0,this.offNum=5}get spacing10(){return this.spacing*this.ratio*this.scale*10}modifyUnit(e){e!=this.unit&&(e!="mil"?this.scale=this.unitConversion.conversion(e,"mil",1)/100:this.scale=1,this.unit=e)}clearPrimitives(){this.primitives.length=0}updateMagnification(e){this.magnification=ma(e)}updateDelta(e){this.delta=ma(e)}createRuler(e,t,i,r){let s,n,a;t===0?(s=-1,n=0,a=2):(s=1,n=1,a=3);let o=ma(s*Math.floor(i/r)*this.delta),l=i%r;if(t===0)if(i>=0){let h=10-Math.abs(ma(o/this.delta)%10),c=ma(o+s*this.delta*h),f=c.toString(),d=this.ctx.getContext().measureText(f).width;if((h-1)*r<d){let u=Ei.DELTA-h*r+Math.abs(l),p=new R_(f,c,t,new Qt(u+d+3,Ei.DELTA/2,0),!0);this.primitives.push(p)}}else{let h=Math.abs(o/this.delta)%10;if(h!==0){let c=ma(o+s*this.delta*h),f=c.toString(),d=this.ctx.getContext().measureText(f).width;if((h-1)*r<d){let u=Ei.DELTA-h*r+(l+r),p=new R_(f,c,t,new Qt(u+d+3,Ei.DELTA/2,0),!0);this.primitives.push(p)}}}for(let h=l<0?l+r:l;h<=e;h+=r){let c=h+Ei.DELTA,f=[Ei.DELTA,Ei.DELTA,Ei.DELTA-this.offNum,Ei.DELTA-this.offNum];f[n]=c,f[a]=c,this.createScale(f,o,t),o=ma(o-s*this.delta)}}createScale(e,t,i){let r=e3(t,this.magnification)===0,s=e3(t,this.magnification/2)===0;r?i===0?e[3]=0:e[2]=0:s&&(i===0?e[3]=Ei.DELTA/2:e[2]=Ei.DELTA/2);let n=new L_(i,e);if(this.primitives.push(n),r){let a=t.toString(),o=new R_(a,t,i,new Qt(i===0?e[0]+3:Ei.DELTA/2,i===0?Ei.DELTA/2:e[1]-3,0));this.primitives.push(o)}}createScaleIdentification(e){let t=e.getScreenPosition().multiply4(e.get2dCameraMatrix().getInverseMatrix()),{x:i,y:r}=t.multiply4(e.getRenderMatrix()).scale(1/e.getSampling());if(i>=Ei.canvasOrigin.x){let s=[i,Ei.DELTA,i,0];this.primitives.push(new L_(0,s))}if(r>=Ei.canvasOrigin.y){let s=[Ei.DELTA,r,0,r];this.primitives.push(new L_(1,s))}}autoScale(e){let t=e.getScale();this.fontSize=14,this.offNum=5;let i=0,r=t;for(;;)if(r>=1){if(r=r/10,r<1)break;i++}else if(r=r*10,i--,r>=1)break;let s=t/Math.pow(10,i);s>=1&&s<2?t=Math.pow(10,i):s>=2&&s<5?t=2*Math.pow(10,i):t=5*Math.pow(10,i),t=t>500?500:t;let n=this.unitConversion.conversion1("mil",this.unit,this.spacing10)/t,a=10,o=1;this.unit=="inch"&&(a=1,o=.1),this.updateMagnification(n*a),this.updateDelta(n*o)}render(e,t,i,r){this.autoScale(t);let s=e.getContext();this.ctx=e,e.save();let n=Kw(r).toRGBAString();e.setStrokeStyle(n),e.setLineWidth(1),e.setFillStyle(n),e.setTextBaseLine("middle"),e.setFont(`normal ${this.fontSize}px ${w8}`);let a=s.canvas.width,o=s.canvas.height,l=i,h=l.multiply4(t.getRenderMatrix()).scale(1/t.getSampling()),c=h.sub(Ei.canvasOrigin),f=this.unitConversion.conversion1(this.unit,"mil",this.magnification)/10,d=new ae(f,0).add(l).multiply4(t.getRenderMatrix()).scale(1/t.getSampling()),u=Math.abs(d.x-h.x)/10,p=ma(-1*Math.floor(Math.max(Math.abs(c.x),Math.abs(c.y))/u)*this.delta);this.ctx.getContext().measureText(p.toString()).width>u*10&&(this.magnification*=2),this.createRuler(a,0,c.x,u),this.createRuler(o,1,c.y,u),this.createScaleIdentification(t);let _=7;this.primitives.forEach(g=>{if(s.beginPath(),g instanceof L_){let{startPoint:{x:b,y:m},width:O,height:y}=g.getRectInfo();s.fillRect(b,m,O,y)}else if(g instanceof R_){if(g.text==="")return;let{x:b,y:m}=g.getPosition();if(g.direction===1){let O=0,y=0;if(g.text[0]==="-"){if(m-s.measureText("-").width<=Ei.DELTA)return;e.save(),e.setTranslate(b,m),e.setRotate(-Math.PI/2),s.fillText("-",0,0),e.restore(),y=_/2,O=1}for(;O<g.text.length;O++){let x=m-O*_+y;if(x-s.measureText(g.text[O]).width<=Ei.DELTA)return;e.save(),e.setTranslate(b,x),e.setRotate(-Math.PI/2),s.fillText(g.text[O],0,0),e.restore()}}else if(g.isSpecial){e.save();let O=s.measureText(g.text).width,y=b-O;e.setTranslate(y,m);let x=0;for(let E=0;E<g.text.length;E++){let w=g.text[E],S=s.measureText(w).width;y+x>=Ei.DELTA&&s.fillText(w,x,0),x=x+S}e.restore()}else s.fillText(g.text,b,m)}else throw Error("not support")}),e.restore(),this.clearPrimitives()}},L_=class{constructor(e,t){if(this.lineWidth=1,this.direction=e,e===0)this.rectInfo={startPoint:new Qt(t[2],t[3],0),width:this.lineWidth,height:ma(t[1]-t[3])};else if(e===1)this.rectInfo={startPoint:new Qt(t[2],t[3],0),width:ma(t[0]-t[2]),height:this.lineWidth};else throw new Error("not support the DIRECTION")}getRectInfo(){return this.rectInfo}},R_=class{constructor(e,t,i,r,s){this.text=e,this.scale=t,this.direction=i,this.position=r,this.isSpecial=s}getPosition(){return this.position}};function ma(e){return Math.round(e*1e3)/1e3}function e3(e,t){let{integerPart:i,divisor:r}=a(e),{integerPart:s,divisor:n}=a(t);if(r>n)return i%Math.round(t*r)/r;return r<n?Math.round(e*n)%s/n:i%s/r;function a(o){let l=o.toString(),h=l.indexOf(".");if(h===-1)return{integerPart:o,divisor:1};let c=l.length-h-1,f=Math.pow(10,c);return{integerPart:Math.round(o*f),divisor:f}}}var fte=2**16,t3=class{};t3.LogState=!0,t3.LogTextureChange=!0;var t9=(e=>(e.Auto="auto",e.WebGPU="webgpu",e.Canvas2D="canvas2d",e))(t9||{}),i9=(e=>(e[e.PCB=0]="PCB",e[e.SCH=1]="SCH",e[e.FOOTPRINT=2]="FOOTPRINT",e[e.ECAD=3]="ECAD",e[e.SYMBOL=4]="SYMBOL",e[e.DEFAULT=5]="DEFAULT",e))(i9||{});var gte=Symbol("ruler");function r9(e){return new Promise(t=>setTimeout(t,e))}var s9=class{constructor(){this.shaderCodes=[],this.isCompiling=!1}addShaderCode(e){if(this.isCompiling)throw new Error("Cannot add shader code while compiling");this.shaderCodes.push(e)}async compileAll(e){if(!(this.isCompiling||!this.shaderCodes)){this.isCompiling=!0,await r9(10);for(let t of this.shaderCodes)if((await e.createShaderModule({code:t}).getCompilationInfo()).messages.length!==0){console.log(this.shaderCodes),await e.createShaderModule({code:t}).getCompilationInfo();debugger}}}},Vn=new s9;var i3=new Qt(-1,1,4).normalize(),xte=i3.cross(new Qt(0,1,0)).cross(i3).normalize();var vte=q3(_w());var m1=0,n9=1,r3=1,s3=100,n3=204,a3=205,o3=0,l3=1,h3=2,dg=3,c3=4,u3=5,d3=6,f3=7,a9=0,$w=300,o9=301,p3=1e3,Ac=1001,_3=1002,Mc=1003,l9=1006,h9=1008,c9=1009,u9=1014,d9=1015;var f9=1020,p9=1023,G0=1026,g3=1027,fg=2300,y1=2301,z0=2302,O3=2400,m3=2401,y3=2402,Qw="",jn="srgb",b3="srgb-linear",x3="linear",H0="srgb",fc=7680,v3=519,E3=35044,$l=2e3,b1=2001,mg=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,s=i.length;r<s;r++)i[r].call(this,e);e.target=null}}},Os=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],_9=Math.PI/180,Tte=180/Math.PI;function Uc(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Os[e&255]+Os[e>>8&255]+Os[e>>16&255]+Os[e>>24&255]+"-"+Os[t&255]+Os[t>>8&255]+"-"+Os[t>>16&15|64]+Os[t>>24&255]+"-"+Os[i&63|128]+Os[i>>8&255]+"-"+Os[i>>16&255]+Os[i>>24&255]+Os[r&255]+Os[r>>8&255]+Os[r>>16&255]+Os[r>>24&255]).toLowerCase()}function Gt(e,t,i){return Math.max(t,Math.min(i,e))}function g9(e,t){return(e%t+t)%t}function j0(e,t,i){return(1-i)*e+i*t}function bd(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Us(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var He=class eS{constructor(t=0,i=0){eS.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let i=this.x,r=this.y,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6],this.y=s[1]*i+s[4]*r+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Gt(this.x,t.x,i.x),this.y=Gt(this.y,t.y,i.y),this}clampScalar(t,i){return this.x=Gt(this.x,t,i),this.y=Gt(this.y,t,i),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Gt(r,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){let i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(t)/i;return Math.acos(Gt(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){let r=Math.cos(i),s=Math.sin(i),n=this.x-t.x,a=this.y-t.y;return this.x=n*r-a*s+t.x,this.y=n*s+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ft=class tS{constructor(t,i,r,s,n,a,o,l,h){tS.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,r,s,n,a,o,l,h)}set(t,i,r,s,n,a,o,l,h){let c=this.elements;return c[0]=t,c[1]=s,c[2]=o,c[3]=i,c[4]=n,c[5]=l,c[6]=r,c[7]=a,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){let r=t.elements,s=i.elements,n=this.elements,a=r[0],o=r[3],l=r[6],h=r[1],c=r[4],f=r[7],d=r[2],u=r[5],p=r[8],_=s[0],g=s[3],b=s[6],m=s[1],O=s[4],y=s[7],x=s[2],E=s[5],w=s[8];return n[0]=a*_+o*m+l*x,n[3]=a*g+o*O+l*E,n[6]=a*b+o*y+l*w,n[1]=h*_+c*m+f*x,n[4]=h*g+c*O+f*E,n[7]=h*b+c*y+f*w,n[2]=d*_+u*m+p*x,n[5]=d*g+u*O+p*E,n[8]=d*b+u*y+p*w,this}multiplyScalar(t){let i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){let t=this.elements,i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8];return i*a*c-i*o*h-r*n*c+r*o*l+s*n*h-s*a*l}invert(){let t=this.elements,i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],f=c*a-o*h,d=o*l-c*n,u=h*n-a*l,p=i*f+r*d+s*u;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let _=1/p;return t[0]=f*_,t[1]=(s*h-c*r)*_,t[2]=(o*r-s*a)*_,t[3]=d*_,t[4]=(c*i-s*l)*_,t[5]=(s*n-o*i)*_,t[6]=u*_,t[7]=(r*l-h*i)*_,t[8]=(a*i-r*n)*_,this}transpose(){let t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,s,n,a,o){let l=Math.cos(n),h=Math.sin(n);return this.set(r*l,r*h,-r*(l*a+h*o)+a+t,-s*h,s*l,-s*(-h*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(Y0.makeScale(t,i)),this}rotate(t){return this.premultiply(Y0.makeRotation(-t)),this}translate(t,i){return this.premultiply(Y0.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){let i=this.elements,r=t.elements;for(let s=0;s<9;s++)if(i[s]!==r[s])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){let r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}},Y0=new Ft;function O9(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function T3(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}var w3=new Ft().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),S3=new Ft().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function m9(){let e={enabled:!0,workingColorSpace:b3,spaces:{},convert:function(s,n,a){return this.enabled===!1||n===a||!n||!a||(this.spaces[n].transfer===H0&&(s.r=ho(s.r),s.g=ho(s.g),s.b=ho(s.b)),this.spaces[n].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[n].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===H0&&(s.r=Nc(s.r),s.g=Nc(s.g),s.b=Nc(s.b))),s},fromWorkingColorSpace:function(s,n){return this.convert(s,this.workingColorSpace,n)},toWorkingColorSpace:function(s,n){return this.convert(s,n,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Qw?x3:this.spaces[s].transfer},getLuminanceCoefficients:function(s,n=this.workingColorSpace){return s.fromArray(this.spaces[n].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,n,a){return s.copy(this.spaces[n].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[b3]:{primaries:t,whitePoint:r,transfer:x3,toXYZ:w3,fromXYZ:S3,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:jn},outputColorSpaceConfig:{drawingBufferColorSpace:jn}},[jn]:{primaries:t,whitePoint:r,transfer:H0,toXYZ:w3,fromXYZ:S3,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:jn}}}),e}var Fn=m9();function ho(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function Nc(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var pc,y9=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{pc===void 0&&(pc=T3("canvas")),pc.width=e.width,pc.height=e.height;let i=pc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=pc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=T3("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let n=0;n<s.length;n++)s[n]=ho(s[n]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(ho(t[i]/255)*255):t[i]=ho(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},b9=0,x9=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:b9++}),this.uuid=Uc(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let n=0,a=r.length;n<a;n++)r[n].isDataTexture?s.push(V0(r[n].image)):s.push(V0(r[n]))}else s=V0(r);i.url=s}return t||(e.images[this.uuid]=i),i}};function V0(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?y9.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var v9=0,il=class cg extends mg{constructor(t=cg.DEFAULT_IMAGE,i=cg.DEFAULT_MAPPING,r=Ac,s=Ac,n=l9,a=h9,o=p9,l=c9,h=cg.DEFAULT_ANISOTROPY,c=Qw){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:v9++}),this.uuid=Uc(),this.name="",this.source=new x9(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=n,this.minFilter=a,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=l,this.offset=new He(0,0),this.repeat=new He(1,1),this.center=new He(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ft,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==$w)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case p3:t.x=t.x-Math.floor(t.x);break;case Ac:t.x=t.x<0?0:1;break;case _3:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case p3:t.y=t.y-Math.floor(t.y);break;case Ac:t.y=t.y<0?0:1;break;case _3:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}};il.DEFAULT_IMAGE=null;il.DEFAULT_MAPPING=$w;il.DEFAULT_ANISOTROPY=1;var Ud=class iS{constructor(t=0,i=0,r=0,s=1){iS.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,s){return this.x=t,this.y=i,this.z=r,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let i=this.x,r=this.y,s=this.z,n=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*s+a[12]*n,this.y=a[1]*i+a[5]*r+a[9]*s+a[13]*n,this.z=a[2]*i+a[6]*r+a[10]*s+a[14]*n,this.w=a[3]*i+a[7]*r+a[11]*s+a[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,s,n,a=t.elements,o=a[0],l=a[4],h=a[8],c=a[1],f=a[5],d=a[9],u=a[2],p=a[6],_=a[10];if(Math.abs(l-c)<.01&&Math.abs(h-u)<.01&&Math.abs(d-p)<.01){if(Math.abs(l+c)<.1&&Math.abs(h+u)<.1&&Math.abs(d+p)<.1&&Math.abs(o+f+_-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;let b=(o+1)/2,m=(f+1)/2,O=(_+1)/2,y=(l+c)/4,x=(h+u)/4,E=(d+p)/4;return b>m&&b>O?b<.01?(r=0,s=.707106781,n=.707106781):(r=Math.sqrt(b),s=y/r,n=x/r):m>O?m<.01?(r=.707106781,s=0,n=.707106781):(s=Math.sqrt(m),r=y/s,n=E/s):O<.01?(r=.707106781,s=.707106781,n=0):(n=Math.sqrt(O),r=x/n,s=E/n),this.set(r,s,n,i),this}let g=Math.sqrt((p-d)*(p-d)+(h-u)*(h-u)+(c-l)*(c-l));return Math.abs(g)<.001&&(g=1),this.x=(p-d)/g,this.y=(h-u)/g,this.z=(c-l)/g,this.w=Math.acos((o+f+_-1)/2),this}setFromMatrixPosition(t){let i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Gt(this.x,t.x,i.x),this.y=Gt(this.y,t.y,i.y),this.z=Gt(this.z,t.z,i.z),this.w=Gt(this.w,t.w,i.w),this}clampScalar(t,i){return this.x=Gt(this.x,t,i),this.y=Gt(this.y,t,i),this.z=Gt(this.z,t,i),this.w=Gt(this.w,t,i),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Gt(r,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},E9=class extends il{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Mc,this.minFilter=Mc,this.wrapR=Ac,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},T9=class extends il{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Mc,this.minFilter=Mc,this.wrapR=Ac,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},rl=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,n,a){let o=i[r+0],l=i[r+1],h=i[r+2],c=i[r+3],f=s[n+0],d=s[n+1],u=s[n+2],p=s[n+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c;return}if(a===1){e[t+0]=f,e[t+1]=d,e[t+2]=u,e[t+3]=p;return}if(c!==p||o!==f||l!==d||h!==u){let _=1-a,g=o*f+l*d+h*u+c*p,b=g>=0?1:-1,m=1-g*g;if(m>Number.EPSILON){let y=Math.sqrt(m),x=Math.atan2(y,g*b);_=Math.sin(_*x)/y,a=Math.sin(a*x)/y}let O=a*b;if(o=o*_+f*O,l=l*_+d*O,h=h*_+u*O,c=c*_+p*O,_===1-a){let y=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=y,l*=y,h*=y,c*=y}}e[t]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,s,n){let a=i[r],o=i[r+1],l=i[r+2],h=i[r+3],c=s[n],f=s[n+1],d=s[n+2],u=s[n+3];return e[t]=a*u+h*c+o*d-l*f,e[t+1]=o*u+h*f+l*c-a*d,e[t+2]=l*u+h*d+a*f-o*c,e[t+3]=h*u-a*c-o*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){let i=e._x,r=e._y,s=e._z,n=e._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(r/2),c=a(s/2),f=o(i/2),d=o(r/2),u=o(s/2);switch(n){case"XYZ":this._x=f*h*c+l*d*u,this._y=l*d*c-f*h*u,this._z=l*h*u+f*d*c,this._w=l*h*c-f*d*u;break;case"YXZ":this._x=f*h*c+l*d*u,this._y=l*d*c-f*h*u,this._z=l*h*u-f*d*c,this._w=l*h*c+f*d*u;break;case"ZXY":this._x=f*h*c-l*d*u,this._y=l*d*c+f*h*u,this._z=l*h*u+f*d*c,this._w=l*h*c-f*d*u;break;case"ZYX":this._x=f*h*c-l*d*u,this._y=l*d*c+f*h*u,this._z=l*h*u-f*d*c,this._w=l*h*c+f*d*u;break;case"YZX":this._x=f*h*c+l*d*u,this._y=l*d*c+f*h*u,this._z=l*h*u-f*d*c,this._w=l*h*c-f*d*u;break;case"XZY":this._x=f*h*c-l*d*u,this._y=l*d*c-f*h*u,this._z=l*h*u+f*d*c,this._w=l*h*c+f*d*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],s=t[8],n=t[1],a=t[5],o=t[9],l=t[2],h=t[6],c=t[10],f=i+a+c;if(f>0){let d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(h-o)*d,this._y=(s-l)*d,this._z=(n-r)*d}else if(i>a&&i>c){let d=2*Math.sqrt(1+i-a-c);this._w=(h-o)/d,this._x=.25*d,this._y=(r+n)/d,this._z=(s+l)/d}else if(a>c){let d=2*Math.sqrt(1+a-i-c);this._w=(s-l)/d,this._x=(r+n)/d,this._y=.25*d,this._z=(o+h)/d}else{let d=2*Math.sqrt(1+c-i-a);this._w=(n-r)/d,this._x=(s+l)/d,this._y=(o+h)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gt(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,s=e._z,n=e._w,a=t._x,o=t._y,l=t._z,h=t._w;return this._x=i*h+n*a+r*l-s*o,this._y=r*h+n*o+s*a-i*l,this._z=s*h+n*l+i*o-r*a,this._w=n*h-i*a-r*o-s*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,s=this._z,n=this._w,a=n*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=n,this._x=i,this._y=r,this._z=s,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*n+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*s+t*this._z,this.normalize(),this}let l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-t)*h)/l,f=Math.sin(t*h)/l;return this._w=n*c+this._w*f,this._x=i*c+this._x*f,this._y=r*c+this._y*f,this._z=s*c+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},de=class rS{constructor(t=0,i=0,r=0){rS.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(I3.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(I3.setFromAxisAngle(t,i))}applyMatrix3(t){let i=this.x,r=this.y,s=this.z,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6]*s,this.y=n[1]*i+n[4]*r+n[7]*s,this.z=n[2]*i+n[5]*r+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let i=this.x,r=this.y,s=this.z,n=t.elements,a=1/(n[3]*i+n[7]*r+n[11]*s+n[15]);return this.x=(n[0]*i+n[4]*r+n[8]*s+n[12])*a,this.y=(n[1]*i+n[5]*r+n[9]*s+n[13])*a,this.z=(n[2]*i+n[6]*r+n[10]*s+n[14])*a,this}applyQuaternion(t){let i=this.x,r=this.y,s=this.z,n=t.x,a=t.y,o=t.z,l=t.w,h=2*(a*s-o*r),c=2*(o*i-n*s),f=2*(n*r-a*i);return this.x=i+l*h+a*f-o*c,this.y=r+l*c+o*h-n*f,this.z=s+l*f+n*c-a*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let i=this.x,r=this.y,s=this.z,n=t.elements;return this.x=n[0]*i+n[4]*r+n[8]*s,this.y=n[1]*i+n[5]*r+n[9]*s,this.z=n[2]*i+n[6]*r+n[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Gt(this.x,t.x,i.x),this.y=Gt(this.y,t.y,i.y),this.z=Gt(this.z,t.z,i.z),this}clampScalar(t,i){return this.x=Gt(this.x,t,i),this.y=Gt(this.y,t,i),this.z=Gt(this.z,t,i),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Gt(r,t,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){let r=t.x,s=t.y,n=t.z,a=i.x,o=i.y,l=i.z;return this.x=s*l-n*o,this.y=n*a-r*l,this.z=r*o-s*a,this}projectOnVector(t){let i=t.lengthSq();if(i===0)return this.set(0,0,0);let r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return q0.copy(this).projectOnVector(t),this.sub(q0)}reflect(t){return this.sub(q0.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(t)/i;return Math.acos(Gt(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y,s=this.z-t.z;return i*i+r*r+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){let s=Math.sin(i)*t;return this.x=s*Math.sin(r),this.y=Math.cos(i)*t,this.z=s*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){let i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){let i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=s,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(t),this.y=i,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},q0=new de,I3=new rl,sl=class{constructor(e=new de(1/0,1/0,1/0),t=new de(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Gn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Gn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Gn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0){let s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let n=0,a=s.count;n<a;n++)e.isMesh===!0?e.getVertexPosition(n,Gn):Gn.fromBufferAttribute(s,n),Gn.applyMatrix4(e.matrixWorld),this.expandByPoint(Gn);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),D_.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),D_.copy(i.boundingBox)),D_.applyMatrix4(e.matrixWorld),this.union(D_)}let r=e.children;for(let s=0,n=r.length;s<n;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Gn),Gn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(xd),M_.subVectors(this.max,xd),_c.subVectors(e.a,xd),gc.subVectors(e.b,xd),Oc.subVectors(e.c,xd),qo.subVectors(gc,_c),Xo.subVectors(Oc,gc),Xl.subVectors(_c,Oc);let t=[0,-qo.z,qo.y,0,-Xo.z,Xo.y,0,-Xl.z,Xl.y,qo.z,0,-qo.x,Xo.z,0,-Xo.x,Xl.z,0,-Xl.x,-qo.y,qo.x,0,-Xo.y,Xo.x,0,-Xl.y,Xl.x,0];return!X0(t,_c,gc,Oc,M_)||(t=[1,0,0,0,1,0,0,0,1],!X0(t,_c,gc,Oc,M_))?!1:(B_.crossVectors(qo,Xo),t=[B_.x,B_.y,B_.z],X0(t,_c,gc,Oc,M_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Gn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Gn).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(io[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),io[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),io[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),io[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),io[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),io[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),io[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),io[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(io),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},io=[new de,new de,new de,new de,new de,new de,new de,new de],Gn=new de,D_=new sl,_c=new de,gc=new de,Oc=new de,qo=new de,Xo=new de,Xl=new de,xd=new de,M_=new de,B_=new de,Wl=new de;function X0(e,t,i,r,s){for(let n=0,a=e.length-3;n<=a;n+=3){Wl.fromArray(e,n);let o=s.x*Math.abs(Wl.x)+s.y*Math.abs(Wl.y)+s.z*Math.abs(Wl.z),l=t.dot(Wl),h=i.dot(Wl),c=r.dot(Wl);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>o)return!1}return!0}var w9=new sl,vd=new de,W0=new de,nl=class{constructor(e=new de,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):w9.setFromPoints(e).getCenter(i);let r=0;for(let s=0,n=e.length;s<n;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;vd.subVectors(e,this.center);let t=vd.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(vd,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(W0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(vd.copy(e.center).add(W0)),this.expandByPoint(vd.copy(e.center).sub(W0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},ro=new de,J0=new de,k_=new de,Wo=new de,Z0=new de,U_=new de,K0=new de,yg=class{constructor(e=new de,t=new de(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ro)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=ro.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ro.copy(this.origin).addScaledVector(this.direction,t),ro.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){J0.copy(e).add(t).multiplyScalar(.5),k_.copy(t).sub(e).normalize(),Wo.copy(this.origin).sub(J0);let s=e.distanceTo(t)*.5,n=-this.direction.dot(k_),a=Wo.dot(this.direction),o=-Wo.dot(k_),l=Wo.lengthSq(),h=Math.abs(1-n*n),c,f,d,u;if(h>0)if(c=n*o-a,f=n*a-o,u=s*h,c>=0)if(f>=-u)if(f<=u){let p=1/h;c*=p,f*=p,d=c*(c+n*f+2*a)+f*(n*c+f+2*o)+l}else f=s,c=Math.max(0,-(n*f+a)),d=-c*c+f*(f+2*o)+l;else f=-s,c=Math.max(0,-(n*f+a)),d=-c*c+f*(f+2*o)+l;else f<=-u?(c=Math.max(0,-(-n*s+a)),f=c>0?-s:Math.min(Math.max(-s,-o),s),d=-c*c+f*(f+2*o)+l):f<=u?(c=0,f=Math.min(Math.max(-s,-o),s),d=f*(f+2*o)+l):(c=Math.max(0,-(n*s+a)),f=c>0?s:Math.min(Math.max(-s,-o),s),d=-c*c+f*(f+2*o)+l);else f=n>0?-s:s,c=Math.max(0,-(n*f+a)),d=-c*c+f*(f+2*o)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,c),r&&r.copy(J0).addScaledVector(k_,f),d}intersectSphere(e,t){ro.subVectors(e.center,this.origin);let i=ro.dot(this.direction),r=ro.dot(ro)-i*i,s=e.radius*e.radius;if(r>s)return null;let n=Math.sqrt(s-r),a=i-n,o=i+n;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,n,a,o,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,f=this.origin;return l>=0?(i=(e.min.x-f.x)*l,r=(e.max.x-f.x)*l):(i=(e.max.x-f.x)*l,r=(e.min.x-f.x)*l),h>=0?(s=(e.min.y-f.y)*h,n=(e.max.y-f.y)*h):(s=(e.max.y-f.y)*h,n=(e.min.y-f.y)*h),i>n||s>r||((s>i||isNaN(i))&&(i=s),(n<r||isNaN(r))&&(r=n),c>=0?(a=(e.min.z-f.z)*c,o=(e.max.z-f.z)*c):(a=(e.max.z-f.z)*c,o=(e.min.z-f.z)*c),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,ro)!==null}intersectTriangle(e,t,i,r,s){Z0.subVectors(t,e),U_.subVectors(i,e),K0.crossVectors(Z0,U_);let n=this.direction.dot(K0),a;if(n>0){if(r)return null;a=1}else if(n<0)a=-1,n=-n;else return null;Wo.subVectors(this.origin,e);let o=a*this.direction.dot(U_.crossVectors(Wo,U_));if(o<0)return null;let l=a*this.direction.dot(Z0.cross(Wo));if(l<0||o+l>n)return null;let h=-a*Wo.dot(K0);return h<0?null:this.at(h/n,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},ii=class x1{constructor(t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g){x1.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g)}set(t,i,r,s,n,a,o,l,h,c,f,d,u,p,_,g){let b=this.elements;return b[0]=t,b[4]=i,b[8]=r,b[12]=s,b[1]=n,b[5]=a,b[9]=o,b[13]=l,b[2]=h,b[6]=c,b[10]=f,b[14]=d,b[3]=u,b[7]=p,b[11]=_,b[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new x1().fromArray(this.elements)}copy(t){let i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){let i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){let i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){let i=this.elements,r=t.elements,s=1/mc.setFromMatrixColumn(t,0).length(),n=1/mc.setFromMatrixColumn(t,1).length(),a=1/mc.setFromMatrixColumn(t,2).length();return i[0]=r[0]*s,i[1]=r[1]*s,i[2]=r[2]*s,i[3]=0,i[4]=r[4]*n,i[5]=r[5]*n,i[6]=r[6]*n,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){let i=this.elements,r=t.x,s=t.y,n=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(s),h=Math.sin(s),c=Math.cos(n),f=Math.sin(n);if(t.order==="XYZ"){let d=a*c,u=a*f,p=o*c,_=o*f;i[0]=l*c,i[4]=-l*f,i[8]=h,i[1]=u+p*h,i[5]=d-_*h,i[9]=-o*l,i[2]=_-d*h,i[6]=p+u*h,i[10]=a*l}else if(t.order==="YXZ"){let d=l*c,u=l*f,p=h*c,_=h*f;i[0]=d+_*o,i[4]=p*o-u,i[8]=a*h,i[1]=a*f,i[5]=a*c,i[9]=-o,i[2]=u*o-p,i[6]=_+d*o,i[10]=a*l}else if(t.order==="ZXY"){let d=l*c,u=l*f,p=h*c,_=h*f;i[0]=d-_*o,i[4]=-a*f,i[8]=p+u*o,i[1]=u+p*o,i[5]=a*c,i[9]=_-d*o,i[2]=-a*h,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){let d=a*c,u=a*f,p=o*c,_=o*f;i[0]=l*c,i[4]=p*h-u,i[8]=d*h+_,i[1]=l*f,i[5]=_*h+d,i[9]=u*h-p,i[2]=-h,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){let d=a*l,u=a*h,p=o*l,_=o*h;i[0]=l*c,i[4]=_-d*f,i[8]=p*f+u,i[1]=f,i[5]=a*c,i[9]=-o*c,i[2]=-h*c,i[6]=u*f+p,i[10]=d-_*f}else if(t.order==="XZY"){let d=a*l,u=a*h,p=o*l,_=o*h;i[0]=l*c,i[4]=-f,i[8]=h*c,i[1]=d*f+_,i[5]=a*c,i[9]=u*f-p,i[2]=p*f-u,i[6]=o*c,i[10]=_*f+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(S9,t,I9)}lookAt(t,i,r){let s=this.elements;return Zs.subVectors(t,i),Zs.lengthSq()===0&&(Zs.z=1),Zs.normalize(),Jo.crossVectors(r,Zs),Jo.lengthSq()===0&&(Math.abs(r.z)===1?Zs.x+=1e-4:Zs.z+=1e-4,Zs.normalize(),Jo.crossVectors(r,Zs)),Jo.normalize(),F_.crossVectors(Zs,Jo),s[0]=Jo.x,s[4]=F_.x,s[8]=Zs.x,s[1]=Jo.y,s[5]=F_.y,s[9]=Zs.y,s[2]=Jo.z,s[6]=F_.z,s[10]=Zs.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){let r=t.elements,s=i.elements,n=this.elements,a=r[0],o=r[4],l=r[8],h=r[12],c=r[1],f=r[5],d=r[9],u=r[13],p=r[2],_=r[6],g=r[10],b=r[14],m=r[3],O=r[7],y=r[11],x=r[15],E=s[0],w=s[4],S=s[8],C=s[12],R=s[1],B=s[5],Y=s[9],G=s[13],z=s[2],q=s[6],L=s[10],M=s[14],v=s[3],P=s[7],I=s[11],N=s[15];return n[0]=a*E+o*R+l*z+h*v,n[4]=a*w+o*B+l*q+h*P,n[8]=a*S+o*Y+l*L+h*I,n[12]=a*C+o*G+l*M+h*N,n[1]=c*E+f*R+d*z+u*v,n[5]=c*w+f*B+d*q+u*P,n[9]=c*S+f*Y+d*L+u*I,n[13]=c*C+f*G+d*M+u*N,n[2]=p*E+_*R+g*z+b*v,n[6]=p*w+_*B+g*q+b*P,n[10]=p*S+_*Y+g*L+b*I,n[14]=p*C+_*G+g*M+b*N,n[3]=m*E+O*R+y*z+x*v,n[7]=m*w+O*B+y*q+x*P,n[11]=m*S+O*Y+y*L+x*I,n[15]=m*C+O*G+y*M+x*N,this}multiplyScalar(t){let i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){let t=this.elements,i=t[0],r=t[4],s=t[8],n=t[12],a=t[1],o=t[5],l=t[9],h=t[13],c=t[2],f=t[6],d=t[10],u=t[14],p=t[3],_=t[7],g=t[11],b=t[15];return p*(+n*l*f-s*h*f-n*o*d+r*h*d+s*o*u-r*l*u)+_*(+i*l*u-i*h*d+n*a*d-s*a*u+s*h*c-n*l*c)+g*(+i*h*f-i*o*u-n*a*f+r*a*u+n*o*c-r*h*c)+b*(-s*o*c-i*l*f+i*o*d+s*a*f-r*a*d+r*l*c)}transpose(){let t=this.elements,i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){let s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=i,s[14]=r),this}invert(){let t=this.elements,i=t[0],r=t[1],s=t[2],n=t[3],a=t[4],o=t[5],l=t[6],h=t[7],c=t[8],f=t[9],d=t[10],u=t[11],p=t[12],_=t[13],g=t[14],b=t[15],m=f*g*h-_*d*h+_*l*u-o*g*u-f*l*b+o*d*b,O=p*d*h-c*g*h-p*l*u+a*g*u+c*l*b-a*d*b,y=c*_*h-p*f*h+p*o*u-a*_*u-c*o*b+a*f*b,x=p*f*l-c*_*l-p*o*d+a*_*d+c*o*g-a*f*g,E=i*m+r*O+s*y+n*x;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let w=1/E;return t[0]=m*w,t[1]=(_*d*n-f*g*n-_*s*u+r*g*u+f*s*b-r*d*b)*w,t[2]=(o*g*n-_*l*n+_*s*h-r*g*h-o*s*b+r*l*b)*w,t[3]=(f*l*n-o*d*n-f*s*h+r*d*h+o*s*u-r*l*u)*w,t[4]=O*w,t[5]=(c*g*n-p*d*n+p*s*u-i*g*u-c*s*b+i*d*b)*w,t[6]=(p*l*n-a*g*n-p*s*h+i*g*h+a*s*b-i*l*b)*w,t[7]=(a*d*n-c*l*n+c*s*h-i*d*h-a*s*u+i*l*u)*w,t[8]=y*w,t[9]=(p*f*n-c*_*n-p*r*u+i*_*u+c*r*b-i*f*b)*w,t[10]=(a*_*n-p*o*n+p*r*h-i*_*h-a*r*b+i*o*b)*w,t[11]=(c*o*n-a*f*n-c*r*h+i*f*h+a*r*u-i*o*u)*w,t[12]=x*w,t[13]=(c*_*s-p*f*s+p*r*d-i*_*d-c*r*g+i*f*g)*w,t[14]=(p*o*s-a*_*s-p*r*l+i*_*l+a*r*g-i*o*g)*w,t[15]=(a*f*s-c*o*s+c*r*l-i*f*l-a*r*d+i*o*d)*w,this}scale(t){let i=this.elements,r=t.x,s=t.y,n=t.z;return i[0]*=r,i[4]*=s,i[8]*=n,i[1]*=r,i[5]*=s,i[9]*=n,i[2]*=r,i[6]*=s,i[10]*=n,i[3]*=r,i[7]*=s,i[11]*=n,this}getMaxScaleOnAxis(){let t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,s))}makeTranslation(t,i,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){let i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){let r=Math.cos(i),s=Math.sin(i),n=1-r,a=t.x,o=t.y,l=t.z,h=n*a,c=n*o;return this.set(h*a+r,h*o-s*l,h*l+s*o,0,h*o+s*l,c*o+r,c*l-s*a,0,h*l-s*o,c*l+s*a,n*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,s,n,a){return this.set(1,r,n,0,t,1,a,0,i,s,1,0,0,0,0,1),this}compose(t,i,r){let s=this.elements,n=i._x,a=i._y,o=i._z,l=i._w,h=n+n,c=a+a,f=o+o,d=n*h,u=n*c,p=n*f,_=a*c,g=a*f,b=o*f,m=l*h,O=l*c,y=l*f,x=r.x,E=r.y,w=r.z;return s[0]=(1-(_+b))*x,s[1]=(u+y)*x,s[2]=(p-O)*x,s[3]=0,s[4]=(u-y)*E,s[5]=(1-(d+b))*E,s[6]=(g+m)*E,s[7]=0,s[8]=(p+O)*w,s[9]=(g-m)*w,s[10]=(1-(d+_))*w,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,i,r){let s=this.elements,n=mc.set(s[0],s[1],s[2]).length(),a=mc.set(s[4],s[5],s[6]).length(),o=mc.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),t.x=s[12],t.y=s[13],t.z=s[14],zn.copy(this);let l=1/n,h=1/a,c=1/o;return zn.elements[0]*=l,zn.elements[1]*=l,zn.elements[2]*=l,zn.elements[4]*=h,zn.elements[5]*=h,zn.elements[6]*=h,zn.elements[8]*=c,zn.elements[9]*=c,zn.elements[10]*=c,i.setFromRotationMatrix(zn),r.x=n,r.y=a,r.z=o,this}makePerspective(t,i,r,s,n,a,o=$l){let l=this.elements,h=2*n/(i-t),c=2*n/(r-s),f=(i+t)/(i-t),d=(r+s)/(r-s),u,p;if(o===$l)u=-(a+n)/(a-n),p=-2*a*n/(a-n);else if(o===b1)u=-a/(a-n),p=-a*n/(a-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=h,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=u,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,r,s,n,a,o=$l){let l=this.elements,h=1/(i-t),c=1/(r-s),f=1/(a-n),d=(i+t)*h,u=(r+s)*c,p,_;if(o===$l)p=(a+n)*f,_=-2*f;else if(o===b1)p=n*f,_=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-u,l[2]=0,l[6]=0,l[10]=_,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){let i=this.elements,r=t.elements;for(let s=0;s<16;s++)if(i[s]!==r[s])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){let r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}},mc=new de,zn=new ii,S9=new de(0,0,0),I9=new de(1,1,1),Jo=new de,F_=new de,Zs=new de,P3=new ii,A3=new rl,Fd=class sS{constructor(t=0,i=0,r=0,s=sS.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){let s=t.elements,n=s[0],a=s[4],o=s[8],l=s[1],h=s[5],c=s[9],f=s[2],d=s[6],u=s[10];switch(i){case"XYZ":this._y=Math.asin(Gt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(d,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Gt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-f,n),this._z=0);break;case"ZXY":this._x=Math.asin(Gt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,u),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,n));break;case"ZYX":this._y=Math.asin(-Gt(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(l,n)):(this._x=0,this._z=Math.atan2(-a,h));break;case"YZX":this._z=Math.asin(Gt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-f,n)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-Gt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,h),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return P3.makeRotationFromQuaternion(t),this.setFromRotationMatrix(P3,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return A3.setFromEuler(this),this.setFromQuaternion(A3,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Fd.DEFAULT_ORDER="XYZ";var P9=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},A9=0,C3=new de,yc=new rl,so=new ii,G_=new de,Ed=new de,C9=new de,N9=new rl,N3=new de(1,0,0),L3=new de(0,1,0),R3=new de(0,0,1),D3={type:"added"},L9={type:"removed"},bc={type:"childadded",child:null},$0={type:"childremoved",child:null},Fc=class ug extends mg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:A9++}),this.uuid=Uc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ug.DEFAULT_UP.clone();let t=new de,i=new Fd,r=new rl,s=new de(1,1,1);function n(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(n),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ii},normalMatrix:{value:new Ft}}),this.matrix=new ii,this.matrixWorld=new ii,this.matrixAutoUpdate=ug.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ug.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new P9,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return yc.setFromAxisAngle(t,i),this.quaternion.multiply(yc),this}rotateOnWorldAxis(t,i){return yc.setFromAxisAngle(t,i),this.quaternion.premultiply(yc),this}rotateX(t){return this.rotateOnAxis(N3,t)}rotateY(t){return this.rotateOnAxis(L3,t)}rotateZ(t){return this.rotateOnAxis(R3,t)}translateOnAxis(t,i){return C3.copy(t).applyQuaternion(this.quaternion),this.position.add(C3.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(N3,t)}translateY(t){return this.translateOnAxis(L3,t)}translateZ(t){return this.translateOnAxis(R3,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(so.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?G_.copy(t):G_.set(t,i,r);let s=this.parent;this.updateWorldMatrix(!0,!1),Ed.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?so.lookAt(Ed,G_,this.up):so.lookAt(G_,Ed,this.up),this.quaternion.setFromRotationMatrix(so),s&&(so.extractRotation(s.matrixWorld),yc.setFromRotationMatrix(so),this.quaternion.premultiply(yc.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(D3),bc.child=t,this.dispatchEvent(bc),bc.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}let i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(L9),$0.child=t,this.dispatchEvent($0),$0.child=null),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),so.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),so.multiply(t.parent.matrixWorld)),t.applyMatrix4(so),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(D3),bc.child=t,this.dispatchEvent(bc),bc.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){let n=this.children[r].getObjectByProperty(t,i);if(n!==void 0)return n}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);let s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ed,t,C9),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ed,N9,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){let i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);let i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){let s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].updateWorldMatrix(!1,!0)}}toJSON(t){let i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});let s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function n(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);let o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){let l=o.shapes;if(Array.isArray(l))for(let h=0,c=l.length;h<c;h++){let f=l[h];n(t.shapes,f)}else n(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let o=[];for(let l=0,h=this.material.length;l<h;l++)o.push(n(t.materials,this.material[l]));s.material=o}else s.material=n(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){let l=this.animations[o];s.animations.push(n(t.animations,l))}}if(i){let o=a(t.geometries),l=a(t.materials),h=a(t.textures),c=a(t.images),f=a(t.shapes),d=a(t.skeletons),u=a(t.animations),p=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),h.length>0&&(r.textures=h),c.length>0&&(r.images=c),f.length>0&&(r.shapes=f),d.length>0&&(r.skeletons=d),u.length>0&&(r.animations=u),p.length>0&&(r.nodes=p)}return r.object=s,r;function a(o){let l=[];for(let h in o){let c=o[h];delete c.metadata,l.push(c)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){let s=t.children[r];this.add(s.clone())}return this}};Fc.DEFAULT_UP=new de(0,1,0);Fc.DEFAULT_MATRIX_AUTO_UPDATE=!0;Fc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Hn=new de,no=new de,Q0=new de,ao=new de,xc=new de,vc=new de,M3=new de,e1=new de,t1=new de,i1=new de,r1=new Ud,s1=new Ud,n1=new Ud,Sc=class Ic{constructor(t=new de,i=new de,r=new de){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,s){s.subVectors(r,i),Hn.subVectors(t,i),s.cross(Hn);let n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(t,i,r,s,n){Hn.subVectors(s,i),no.subVectors(r,i),Q0.subVectors(t,i);let a=Hn.dot(Hn),o=Hn.dot(no),l=Hn.dot(Q0),h=no.dot(no),c=no.dot(Q0),f=a*h-o*o;if(f===0)return n.set(0,0,0),null;let d=1/f,u=(h*l-o*c)*d,p=(a*c-o*l)*d;return n.set(1-u-p,p,u)}static containsPoint(t,i,r,s){return this.getBarycoord(t,i,r,s,ao)===null?!1:ao.x>=0&&ao.y>=0&&ao.x+ao.y<=1}static getInterpolation(t,i,r,s,n,a,o,l){return this.getBarycoord(t,i,r,s,ao)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(n,ao.x),l.addScaledVector(a,ao.y),l.addScaledVector(o,ao.z),l)}static getInterpolatedAttribute(t,i,r,s,n,a){return r1.setScalar(0),s1.setScalar(0),n1.setScalar(0),r1.fromBufferAttribute(t,i),s1.fromBufferAttribute(t,r),n1.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(r1,n.x),a.addScaledVector(s1,n.y),a.addScaledVector(n1,n.z),a}static isFrontFacing(t,i,r,s){return Hn.subVectors(r,i),no.subVectors(t,i),Hn.cross(no).dot(s)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,s){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,i,r,s){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Hn.subVectors(this.c,this.b),no.subVectors(this.a,this.b),Hn.cross(no).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ic.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return Ic.getBarycoord(t,this.a,this.b,this.c,i)}getInterpolation(t,i,r,s,n){return Ic.getInterpolation(t,this.a,this.b,this.c,i,r,s,n)}containsPoint(t){return Ic.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ic.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){let r=this.a,s=this.b,n=this.c,a,o;xc.subVectors(s,r),vc.subVectors(n,r),e1.subVectors(t,r);let l=xc.dot(e1),h=vc.dot(e1);if(l<=0&&h<=0)return i.copy(r);t1.subVectors(t,s);let c=xc.dot(t1),f=vc.dot(t1);if(c>=0&&f<=c)return i.copy(s);let d=l*f-c*h;if(d<=0&&l>=0&&c<=0)return a=l/(l-c),i.copy(r).addScaledVector(xc,a);i1.subVectors(t,n);let u=xc.dot(i1),p=vc.dot(i1);if(p>=0&&u<=p)return i.copy(n);let _=u*h-l*p;if(_<=0&&h>=0&&p<=0)return o=h/(h-p),i.copy(r).addScaledVector(vc,o);let g=c*p-u*f;if(g<=0&&f-c>=0&&u-p>=0)return M3.subVectors(n,s),o=(f-c)/(f-c+(u-p)),i.copy(s).addScaledVector(M3,o);let b=1/(g+_+d);return a=_*b,o=d*b,i.copy(r).addScaledVector(xc,a).addScaledVector(vc,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},nS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Zo={h:0,s:0,l:0},z_={h:0,s:0,l:0};function a1(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}var cr=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){let r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=jn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Fn.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Fn.workingColorSpace){return this.r=e,this.g=t,this.b=i,Fn.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Fn.workingColorSpace){if(e=g9(e,1),t=Gt(t,0,1),i=Gt(i,0,1),t===0)this.r=this.g=this.b=i;else{let s=i<=.5?i*(1+t):i+t-i*t,n=2*i-s;this.r=a1(n,s,e+1/3),this.g=a1(n,s,e),this.b=a1(n,s,e-1/3)}return Fn.toWorkingColorSpace(this,r),this}setStyle(e,t=jn){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s,n=r[1],a=r[2];switch(n){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let s=r[1],n=s.length;if(n===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(n===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=jn){let i=nS[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ho(e.r),this.g=ho(e.g),this.b=ho(e.b),this}copyLinearToSRGB(e){return this.r=Nc(e.r),this.g=Nc(e.g),this.b=Nc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=jn){return Fn.fromWorkingColorSpace(ms.copy(this),e),Math.round(Gt(ms.r*255,0,255))*65536+Math.round(Gt(ms.g*255,0,255))*256+Math.round(Gt(ms.b*255,0,255))}getHexString(e=jn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Fn.workingColorSpace){Fn.fromWorkingColorSpace(ms.copy(this),t);let i=ms.r,r=ms.g,s=ms.b,n=Math.max(i,r,s),a=Math.min(i,r,s),o,l,h=(a+n)/2;if(a===n)o=0,l=0;else{let c=n-a;switch(l=h<=.5?c/(n+a):c/(2-n-a),n){case i:o=(r-s)/c+(r<s?6:0);break;case r:o=(s-i)/c+2;break;case s:o=(i-r)/c+4;break}o/=6}return e.h=o,e.s=l,e.l=h,e}getRGB(e,t=Fn.workingColorSpace){return Fn.fromWorkingColorSpace(ms.copy(this),t),e.r=ms.r,e.g=ms.g,e.b=ms.b,e}getStyle(e=jn){Fn.fromWorkingColorSpace(ms.copy(this),e);let t=ms.r,i=ms.g,r=ms.b;return e!==jn?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Zo),this.setHSL(Zo.h+e,Zo.s+t,Zo.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Zo),e.getHSL(z_);let i=j0(Zo.h,z_.h,t),r=j0(Zo.s,z_.s,t),s=j0(Zo.l,z_.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){let t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}},ms=new cr;cr.NAMES=nS;var R9=0,D9=class extends mg{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:R9++}),this.uuid=Uc(),this.name="",this.type="Material",this.blending=r3,this.side=m1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=n3,this.blendDst=a3,this.blendEquation=s3,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new cr(0,0,0),this.blendAlpha=0,this.depthFunc=dg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=v3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=fc,this.stencilZFail=fc,this.stencilZPass=fc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}let r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==r3&&(i.blending=this.blending),this.side!==m1&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==n3&&(i.blendSrc=this.blendSrc),this.blendDst!==a3&&(i.blendDst=this.blendDst),this.blendEquation!==s3&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==dg&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==v3&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==fc&&(i.stencilFail=this.stencilFail),this.stencilZFail!==fc&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==fc&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){let n=[];for(let a in s){let o=s[a];delete o.metadata,n.push(o)}return n}if(t){let s=r(e.textures),n=r(e.images);s.length>0&&(i.textures=s),n.length>0&&(i.images=n)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}},M9=class extends D9{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new cr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Fd,this.combine=a9,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},wte=B9();function B9(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){let h=l-127;h<-27?(r[l]=0,r[l|256]=32768,s[l]=24,s[l|256]=24):h<-14?(r[l]=1024>>-h-14,r[l|256]=1024>>-h-14|32768,s[l]=-h-1,s[l|256]=-h-1):h<=15?(r[l]=h+15<<10,r[l|256]=h+15<<10|32768,s[l]=13,s[l|256]=13):h<128?(r[l]=31744,r[l|256]=64512,s[l]=24,s[l|256]=24):(r[l]=31744,r[l|256]=64512,s[l]=13,s[l|256]=13)}let n=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let h=l<<13,c=0;for(;(h&8388608)===0;)h<<=1,c-=8388608;h&=-8388609,c+=947912704,n[l]=h|c}for(let l=1024;l<2048;++l)n[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:s,mantissaTable:n,exponentTable:a,offsetTable:o}}var xr=new de,H_=new He,Lc=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=E3,this.updateRanges=[],this.gpuType=d9,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)H_.fromBufferAttribute(this,t),H_.applyMatrix3(e),this.setXY(t,H_.x,H_.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)xr.fromBufferAttribute(this,t),xr.applyMatrix3(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)xr.fromBufferAttribute(this,t),xr.applyMatrix4(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)xr.fromBufferAttribute(this,t),xr.applyNormalMatrix(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)xr.fromBufferAttribute(this,t),xr.transformDirection(e),this.setXYZ(t,xr.x,xr.y,xr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=bd(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Us(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=bd(t,this.array)),t}setX(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=bd(t,this.array)),t}setY(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=bd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=bd(t,this.array)),t}setW(e,t){return this.normalized&&(t=Us(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Us(t,this.array),i=Us(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Us(t,this.array),i=Us(i,this.array),r=Us(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Us(t,this.array),i=Us(i,this.array),r=Us(r,this.array),s=Us(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==E3&&(e.usage=this.usage),e}},k9=class extends Lc{constructor(e,t,i){super(new Uint16Array(e),t,i)}},U9=class extends Lc{constructor(e,t,i){super(new Uint32Array(e),t,i)}},St=class extends Lc{constructor(e,t,i){super(new Float32Array(e),t,i)}},F9=0,fn=new ii,o1=new Fc,Ec=new de,Ks=new sl,Td=new sl,Vr=new de,vs=class aS extends mg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:F9++}),this.uuid=Uc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(O9(t)?U9:k9)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){let i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);let r=this.attributes.normal;if(r!==void 0){let n=new Ft().getNormalMatrix(t);r.applyNormalMatrix(n),r.needsUpdate=!0}let s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return fn.makeRotationFromQuaternion(t),this.applyMatrix4(fn),this}rotateX(t){return fn.makeRotationX(t),this.applyMatrix4(fn),this}rotateY(t){return fn.makeRotationY(t),this.applyMatrix4(fn),this}rotateZ(t){return fn.makeRotationZ(t),this.applyMatrix4(fn),this}translate(t,i,r){return fn.makeTranslation(t,i,r),this.applyMatrix4(fn),this}scale(t,i,r){return fn.makeScale(t,i,r),this.applyMatrix4(fn),this}lookAt(t){return o1.lookAt(t),o1.updateMatrix(),this.applyMatrix4(o1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ec).negate(),this.translate(Ec.x,Ec.y,Ec.z),this}setFromPoints(t){let i=this.getAttribute("position");if(i===void 0){let r=[];for(let s=0,n=t.length;s<n;s++){let a=t[s];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new St(r,3))}else{let r=Math.min(t.length,i.count);for(let s=0;s<r;s++){let n=t[s];i.setXYZ(s,n.x,n.y,n.z||0)}t.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new sl);let t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new de(-1/0,-1/0,-1/0),new de(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,s=i.length;r<s;r++){let n=i[r];Ks.setFromBufferAttribute(n),this.morphTargetsRelative?(Vr.addVectors(this.boundingBox.min,Ks.min),this.boundingBox.expandByPoint(Vr),Vr.addVectors(this.boundingBox.max,Ks.max),this.boundingBox.expandByPoint(Vr)):(this.boundingBox.expandByPoint(Ks.min),this.boundingBox.expandByPoint(Ks.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new nl);let t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new de,1/0);return}if(t){let r=this.boundingSphere.center;if(Ks.setFromBufferAttribute(t),i)for(let n=0,a=i.length;n<a;n++){let o=i[n];Td.setFromBufferAttribute(o),this.morphTargetsRelative?(Vr.addVectors(Ks.min,Td.min),Ks.expandByPoint(Vr),Vr.addVectors(Ks.max,Td.max),Ks.expandByPoint(Vr)):(Ks.expandByPoint(Td.min),Ks.expandByPoint(Td.max))}Ks.getCenter(r);let s=0;for(let n=0,a=t.count;n<a;n++)Vr.fromBufferAttribute(t,n),s=Math.max(s,r.distanceToSquared(Vr));if(i)for(let n=0,a=i.length;n<a;n++){let o=i[n],l=this.morphTargetsRelative;for(let h=0,c=o.count;h<c;h++)Vr.fromBufferAttribute(o,h),l&&(Ec.fromBufferAttribute(t,h),Vr.add(Ec)),s=Math.max(s,r.distanceToSquared(Vr))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let r=i.position,s=i.normal,n=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Lc(new Float32Array(4*r.count),4));let a=this.getAttribute("tangent"),o=[],l=[];for(let S=0;S<r.count;S++)o[S]=new de,l[S]=new de;let h=new de,c=new de,f=new de,d=new He,u=new He,p=new He,_=new de,g=new de;function b(S,C,R){h.fromBufferAttribute(r,S),c.fromBufferAttribute(r,C),f.fromBufferAttribute(r,R),d.fromBufferAttribute(n,S),u.fromBufferAttribute(n,C),p.fromBufferAttribute(n,R),c.sub(h),f.sub(h),u.sub(d),p.sub(d);let B=1/(u.x*p.y-p.x*u.y);isFinite(B)&&(_.copy(c).multiplyScalar(p.y).addScaledVector(f,-u.y).multiplyScalar(B),g.copy(f).multiplyScalar(u.x).addScaledVector(c,-p.x).multiplyScalar(B),o[S].add(_),o[C].add(_),o[R].add(_),l[S].add(g),l[C].add(g),l[R].add(g))}let m=this.groups;m.length===0&&(m=[{start:0,count:t.count}]);for(let S=0,C=m.length;S<C;++S){let R=m[S],B=R.start,Y=R.count;for(let G=B,z=B+Y;G<z;G+=3)b(t.getX(G+0),t.getX(G+1),t.getX(G+2))}let O=new de,y=new de,x=new de,E=new de;function w(S){x.fromBufferAttribute(s,S),E.copy(x);let C=o[S];O.copy(C),O.sub(x.multiplyScalar(x.dot(C))).normalize(),y.crossVectors(E,C);let R=y.dot(l[S])<0?-1:1;a.setXYZW(S,O.x,O.y,O.z,R)}for(let S=0,C=m.length;S<C;++S){let R=m[S],B=R.start,Y=R.count;for(let G=B,z=B+Y;G<z;G+=3)w(t.getX(G+0)),w(t.getX(G+1)),w(t.getX(G+2))}}computeVertexNormals(){let t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Lc(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,u=r.count;d<u;d++)r.setXYZ(d,0,0,0);let s=new de,n=new de,a=new de,o=new de,l=new de,h=new de,c=new de,f=new de;if(t)for(let d=0,u=t.count;d<u;d+=3){let p=t.getX(d+0),_=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(i,p),n.fromBufferAttribute(i,_),a.fromBufferAttribute(i,g),c.subVectors(a,n),f.subVectors(s,n),c.cross(f),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,_),h.fromBufferAttribute(r,g),o.add(c),l.add(c),h.add(c),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(_,l.x,l.y,l.z),r.setXYZ(g,h.x,h.y,h.z)}else for(let d=0,u=i.count;d<u;d+=3)s.fromBufferAttribute(i,d+0),n.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),c.subVectors(a,n),f.subVectors(s,n),c.cross(f),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){let t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)Vr.fromBufferAttribute(t,i),Vr.normalize(),t.setXYZ(i,Vr.x,Vr.y,Vr.z)}toNonIndexed(){function t(o,l){let h=o.array,c=o.itemSize,f=o.normalized,d=new h.constructor(l.length*c),u=0,p=0;for(let _=0,g=l.length;_<g;_++){o.isInterleavedBufferAttribute?u=l[_]*o.data.stride+o.offset:u=l[_]*c;for(let b=0;b<c;b++)d[p++]=h[u++]}return new Lc(d,c,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let i=new aS,r=this.index.array,s=this.attributes;for(let o in s){let l=s[o],h=t(l,r);i.setAttribute(o,h)}let n=this.morphAttributes;for(let o in n){let l=[],h=n[o];for(let c=0,f=h.length;c<f;c++){let d=h[c],u=t(d,r);l.push(u)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let o=0,l=a.length;o<l;o++){let h=a[o];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){let t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let l=this.parameters;for(let h in l)l[h]!==void 0&&(t[h]=l[h]);return t}t.data={attributes:{}};let i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});let r=this.attributes;for(let l in r){let h=r[l];t.data.attributes[l]=h.toJSON(t.data)}let s={},n=!1;for(let l in this.morphAttributes){let h=this.morphAttributes[l],c=[];for(let f=0,d=h.length;f<d;f++){let u=h[f];c.push(u.toJSON(t.data))}c.length>0&&(s[l]=c,n=!0)}n&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));let o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let i={};this.name=t.name;let r=t.index;r!==null&&this.setIndex(r.clone(i));let s=t.attributes;for(let h in s){let c=s[h];this.setAttribute(h,c.clone(i))}let n=t.morphAttributes;for(let h in n){let c=[],f=n[h];for(let d=0,u=f.length;d<u;d++)c.push(f[d].clone(i));this.morphAttributes[h]=c}this.morphTargetsRelative=t.morphTargetsRelative;let a=t.groups;for(let h=0,c=a.length;h<c;h++){let f=a[h];this.addGroup(f.start,f.count,f.materialIndex)}let o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());let l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}},B3=new ii,Jl=new yg,j_=new nl,k3=new de,Y_=new de,V_=new de,q_=new de,l1=new de,X_=new de,U3=new de,W_=new de,oS=class extends Fc{constructor(e=new vs,t=new M9){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,s=i.length;r<s;r++){let n=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,n=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(s&&a){X_.set(0,0,0);for(let o=0,l=s.length;o<l;o++){let h=a[o],c=s[o];h!==0&&(l1.fromBufferAttribute(c,e),n?X_.addScaledVector(l1,h):X_.addScaledVector(l1.sub(t),h))}t.add(X_)}return t}raycast(e,t){let i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),j_.copy(i.boundingSphere),j_.applyMatrix4(s),Jl.copy(e.ray).recast(e.near),!(j_.containsPoint(Jl.origin)===!1&&(Jl.intersectSphere(j_,k3)===null||Jl.origin.distanceToSquared(k3)>(e.far-e.near)**2))&&(B3.copy(s).invert(),Jl.copy(e.ray).applyMatrix4(B3),!(i.boundingBox!==null&&Jl.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Jl)))}_computeIntersections(e,t,i){let r,s=this.geometry,n=this.material,a=s.index,o=s.attributes.position,l=s.attributes.uv,h=s.attributes.uv1,c=s.attributes.normal,f=s.groups,d=s.drawRange;if(a!==null)if(Array.isArray(n))for(let u=0,p=f.length;u<p;u++){let _=f[u],g=n[_.materialIndex],b=Math.max(_.start,d.start),m=Math.min(a.count,Math.min(_.start+_.count,d.start+d.count));for(let O=b,y=m;O<y;O+=3){let x=a.getX(O),E=a.getX(O+1),w=a.getX(O+2);r=J_(this,g,e,i,l,h,c,x,E,w),r&&(r.faceIndex=Math.floor(O/3),r.face.materialIndex=_.materialIndex,t.push(r))}}else{let u=Math.max(0,d.start),p=Math.min(a.count,d.start+d.count);for(let _=u,g=p;_<g;_+=3){let b=a.getX(_),m=a.getX(_+1),O=a.getX(_+2);r=J_(this,n,e,i,l,h,c,b,m,O),r&&(r.faceIndex=Math.floor(_/3),t.push(r))}}else if(o!==void 0)if(Array.isArray(n))for(let u=0,p=f.length;u<p;u++){let _=f[u],g=n[_.materialIndex],b=Math.max(_.start,d.start),m=Math.min(o.count,Math.min(_.start+_.count,d.start+d.count));for(let O=b,y=m;O<y;O+=3){let x=O,E=O+1,w=O+2;r=J_(this,g,e,i,l,h,c,x,E,w),r&&(r.faceIndex=Math.floor(O/3),r.face.materialIndex=_.materialIndex,t.push(r))}}else{let u=Math.max(0,d.start),p=Math.min(o.count,d.start+d.count);for(let _=u,g=p;_<g;_+=3){let b=_,m=_+1,O=_+2;r=J_(this,n,e,i,l,h,c,b,m,O),r&&(r.faceIndex=Math.floor(_/3),t.push(r))}}}};function G9(e,t,i,r,s,n,a,o){let l;if(t.side===n9?l=r.intersectTriangle(a,n,s,!0,o):l=r.intersectTriangle(s,n,a,t.side===m1,o),l===null)return null;W_.copy(o),W_.applyMatrix4(e.matrixWorld);let h=i.ray.origin.distanceTo(W_);return h<i.near||h>i.far?null:{distance:h,point:W_.clone(),object:e}}function J_(e,t,i,r,s,n,a,o,l,h){e.getVertexPosition(o,Y_),e.getVertexPosition(l,V_),e.getVertexPosition(h,q_);let c=G9(e,t,i,r,Y_,V_,q_,U3);if(c){let f=new de;Sc.getBarycoord(U3,Y_,V_,q_,f),s&&(c.uv=Sc.getInterpolatedAttribute(s,o,l,h,f,new He)),n&&(c.uv1=Sc.getInterpolatedAttribute(n,o,l,h,f,new He)),a&&(c.normal=Sc.getInterpolatedAttribute(a,o,l,h,f,new de),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));let d={a:o,b:l,c:h,normal:new de,materialIndex:0};Sc.getNormal(Y_,V_,q_,d.normal),c.face=d,c.barycoord=f}return c}var z9=class lS extends vs{constructor(t=1,i=1,r=1,s=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:s,heightSegments:n,depthSegments:a};let o=this;s=Math.floor(s),n=Math.floor(n),a=Math.floor(a);let l=[],h=[],c=[],f=[],d=0,u=0;p("z","y","x",-1,-1,r,i,t,a,n,0),p("z","y","x",1,-1,r,i,-t,a,n,1),p("x","z","y",1,1,t,r,i,s,a,2),p("x","z","y",1,-1,t,r,-i,s,a,3),p("x","y","z",1,-1,t,i,r,s,n,4),p("x","y","z",-1,-1,t,i,-r,s,n,5),this.setIndex(l),this.setAttribute("position",new St(h,3)),this.setAttribute("normal",new St(c,3)),this.setAttribute("uv",new St(f,2));function p(_,g,b,m,O,y,x,E,w,S,C){let R=y/w,B=x/S,Y=y/2,G=x/2,z=E/2,q=w+1,L=S+1,M=0,v=0,P=new de;for(let I=0;I<L;I++){let N=I*B-G;for(let D=0;D<q;D++){let j=D*R-Y;P[_]=j*m,P[g]=N*O,P[b]=z,h.push(P.x,P.y,P.z),P[_]=0,P[g]=0,P[b]=E>0?1:-1,c.push(P.x,P.y,P.z),f.push(D/w),f.push(1-I/S),M+=1}}for(let I=0;I<S;I++)for(let N=0;N<w;N++){let D=d+N+q*I,j=d+N+q*(I+1),H=d+(N+1)+q*(I+1),K=d+(N+1)+q*I;l.push(D,j,K),l.push(j,H,K),v+=6}o.addGroup(u,v,C),u+=v,d+=M}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new lS(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function H9(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let s=e[i][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][r]=null):t[i][r]=s.clone():Array.isArray(s)?t[i][r]=s.slice():t[i][r]=s}}return t}function Fs(e){let t={};for(let i=0;i<e.length;i++){let r=H9(e[i]);for(let s in r)t[s]=r[s]}return t}var hS=class extends Fc{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ii,this.projectionMatrix=new ii,this.projectionMatrixInverse=new ii,this.coordinateSystem=$l}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Ste=new de,Ite=new He,Pte=new He,j9=class extends il{constructor(e,t,i,r,s,n,a,o,l,h){e=e!==void 0?e:[],t=t!==void 0?t:o9,super(e,t,i,r,s,n,a,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Ate=new de,Cte=new de,Nte=new de,Lte=new de,Rte=new He,Dte=new He,Mte=new ii,Bte=new de,kte=new de,Ute=new de,Fte=new He,Gte=new He,zte=new He,Hte=new de,jte=new de,Yte=new de,Vte=new Ud,qte=new Ud,Xte=new de,Wte=new ii,Jte=new de,Zte=new nl,Kte=new ii,$te=new yg;var Qte=new ii,eie=new ii,tie=new ii,iie=new ii,rie=new sl,sie=new ii,nie=new oS,aie=new nl,h1=new de,Y9=new de,V9=new Ft,Tc=class{constructor(e=new de(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=h1.subVectors(i,t).cross(Y9.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){let i=e.delta(h1),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||V9.getNormalMatrix(e),r=this.coplanarPoint(h1).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Zl=new nl,Z_=new de,q9=class{constructor(e=new Tc,t=new Tc,i=new Tc,r=new Tc,s=new Tc,n=new Tc){this.planes=[e,t,i,r,s,n]}set(e,t,i,r,s,n){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(n),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=$l){let i=this.planes,r=e.elements,s=r[0],n=r[1],a=r[2],o=r[3],l=r[4],h=r[5],c=r[6],f=r[7],d=r[8],u=r[9],p=r[10],_=r[11],g=r[12],b=r[13],m=r[14],O=r[15];if(i[0].setComponents(o-s,f-l,_-d,O-g).normalize(),i[1].setComponents(o+s,f+l,_+d,O+g).normalize(),i[2].setComponents(o+n,f+h,_+u,O+b).normalize(),i[3].setComponents(o-n,f-h,_-u,O-b).normalize(),i[4].setComponents(o-a,f-c,_-p,O-m).normalize(),t===$l)i[5].setComponents(o+a,f+c,_+p,O+m).normalize();else if(t===b1)i[5].setComponents(a,c,p,m).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Zl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{let t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Zl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Zl)}intersectsSprite(e){return Zl.center.set(0,0,0),Zl.radius=.7071067811865476,Zl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zl)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(Z_.x=r.normal.x>0?e.max.x:e.min.x,Z_.y=r.normal.y>0?e.max.y:e.min.y,Z_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Z_)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}},X9=class{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,r){let s=this.pool,n=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});let a=s[this.index];n.push(a),this.index++,a.start=e,a.count=t,a.z=i,a.index=r}reset(){this.list.length=0,this.index=0}},oie=new ii,lie=new cr(1,1,1),hie=new q9,cie=new sl,uie=new nl,die=new de,fie=new de,pie=new de,_ie=new X9,gie=new oS,Oie=new de,mie=new de,yie=new ii,bie=new yg,xie=new nl,vie=new de,Eie=new de,Tie=new de,wie=new de,Sie=new ii,Iie=new yg,Pie=new nl,Aie=new de,W9=class extends il{constructor(e,t,i,r,s,n,a,o,l,h=G0){if(h!==G0&&h!==g3)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===G0&&(i=u9),i===void 0&&h===g3&&(i=f9),super(null,r,s,n,a,o,h,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Mc,this.minFilter=o!==void 0?o:Mc,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){let t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}},ba=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),s=0;t.push(0);for(let n=1;n<=e;n++)i=this.getPoint(n/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,s=i.length,n;t?n=t:n=e*i[s-1];let a=0,o=s-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-n,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===n)return r/(s-1);let h=i[r],c=i[r+1]-h,f=(n-h)/c;return(r+f)/(s-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let s=this.getPoint(i),n=this.getPoint(r),a=t||(s.isVector2?new He:new de);return a.copy(n).sub(s).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new de,r=[],s=[],n=[],a=new de,o=new ii;for(let d=0;d<=e;d++){let u=d/e;r[d]=this.getTangentAt(u,new de)}s[0]=new de,n[0]=new de;let l=Number.MAX_VALUE,h=Math.abs(r[0].x),c=Math.abs(r[0].y),f=Math.abs(r[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),f<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),n[0].crossVectors(r[0],s[0]);for(let d=1;d<=e;d++){if(s[d]=s[d-1].clone(),n[d]=n[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let u=Math.acos(Gt(r[d-1].dot(r[d]),-1,1));s[d].applyMatrix4(o.makeRotationAxis(a,u))}n[d].crossVectors(r[d],s[d])}if(t===!0){let d=Math.acos(Gt(s[0].dot(s[e]),-1,1));d/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(d=-d);for(let u=1;u<=e;u++)s[u].applyMatrix4(o.makeRotationAxis(r[u],d*u)),n[u].crossVectors(r[u],s[u])}return{tangents:r,normals:s,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},q1=class extends ba{constructor(e=0,t=0,i=1,r=1,s=0,n=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=n,this.aClockwise=a,this.aRotation=o}getPoint(e,t=new He){let i=t,r=Math.PI*2,s=this.aEndAngle-this.aStartAngle,n=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(n?s=0:s=r),this.aClockwise===!0&&!n&&(s===r?s=-r:s=s-r);let a=this.aStartAngle+e*s,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let h=Math.cos(this.aRotation),c=Math.sin(this.aRotation),f=o-this.aX,d=l-this.aY;o=f*h-d*c+this.aX,l=f*c+d*h+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},J9=class extends q1{constructor(e,t,i,r,s,n){super(e,t,i,i,r,s,n),this.isArcCurve=!0,this.type="ArcCurve"}};function X1(){let e=0,t=0,i=0,r=0;function s(n,a,o,l){e=n,t=o,i=-3*n+3*a-2*o-l,r=2*n-2*a+o+l}return{initCatmullRom:function(n,a,o,l,h){s(a,o,h*(o-n),h*(l-a))},initNonuniformCatmullRom:function(n,a,o,l,h,c,f){let d=(a-n)/h-(o-n)/(h+c)+(o-a)/c,u=(o-a)/c-(l-a)/(c+f)+(l-o)/f;d*=c,u*=c,s(a,o,d,u)},calc:function(n){let a=n*n,o=a*n;return e+t*n+i*a+r*o}}}var K_=new de,c1=new X1,u1=new X1,d1=new X1,Z9=class extends ba{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new de){let i=t,r=this.points,s=r.length,n=(s-(this.closed?0:1))*e,a=Math.floor(n),o=n-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:o===0&&a===s-1&&(a=s-2,o=1);let l,h;this.closed||a>0?l=r[(a-1)%s]:(K_.subVectors(r[0],r[1]).add(r[0]),l=K_);let c=r[a%s],f=r[(a+1)%s];if(this.closed||a+2<s?h=r[(a+2)%s]:(K_.subVectors(r[s-1],r[s-2]).add(r[s-1]),h=K_),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,u=Math.pow(l.distanceToSquared(c),d),p=Math.pow(c.distanceToSquared(f),d),_=Math.pow(f.distanceToSquared(h),d);p<1e-4&&(p=1),u<1e-4&&(u=p),_<1e-4&&(_=p),c1.initNonuniformCatmullRom(l.x,c.x,f.x,h.x,u,p,_),u1.initNonuniformCatmullRom(l.y,c.y,f.y,h.y,u,p,_),d1.initNonuniformCatmullRom(l.z,c.z,f.z,h.z,u,p,_)}else this.curveType==="catmullrom"&&(c1.initCatmullRom(l.x,c.x,f.x,h.x,this.tension),u1.initCatmullRom(l.y,c.y,f.y,h.y,this.tension),d1.initCatmullRom(l.z,c.z,f.z,h.z,this.tension));return i.set(c1.calc(o),u1.calc(o),d1.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new de().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function F3(e,t,i,r,s){let n=(r-t)*.5,a=(s-i)*.5,o=e*e,l=e*o;return(2*i-2*r+n+a)*l+(-3*i+3*r-2*n-a)*o+n*e+i}function K9(e,t){let i=1-e;return i*i*t}function $9(e,t){return 2*(1-e)*e*t}function Q9(e,t){return e*e*t}function Id(e,t,i,r){return K9(e,t)+$9(e,i)+Q9(e,r)}function eU(e,t){let i=1-e;return i*i*i*t}function tU(e,t){let i=1-e;return 3*i*i*e*t}function iU(e,t){return 3*(1-e)*e*e*t}function rU(e,t){return e*e*e*t}function Pd(e,t,i,r,s){return eU(e,t)+tU(e,i)+iU(e,r)+rU(e,s)}var cS=class extends ba{constructor(e=new He,t=new He,i=new He,r=new He){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new He){let i=t,r=this.v0,s=this.v1,n=this.v2,a=this.v3;return i.set(Pd(e,r.x,s.x,n.x,a.x),Pd(e,r.y,s.y,n.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},sU=class extends ba{constructor(e=new de,t=new de,i=new de,r=new de){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new de){let i=t,r=this.v0,s=this.v1,n=this.v2,a=this.v3;return i.set(Pd(e,r.x,s.x,n.x,a.x),Pd(e,r.y,s.y,n.y,a.y),Pd(e,r.z,s.z,n.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},uS=class extends ba{constructor(e=new He,t=new He){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new He){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new He){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},nU=class extends ba{constructor(e=new de,t=new de){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new de){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new de){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},dS=class extends ba{constructor(e=new He,t=new He,i=new He){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new He){let i=t,r=this.v0,s=this.v1,n=this.v2;return i.set(Id(e,r.x,s.x,n.x),Id(e,r.y,s.y,n.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},fS=class extends ba{constructor(e=new de,t=new de,i=new de){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new de){let i=t,r=this.v0,s=this.v1,n=this.v2;return i.set(Id(e,r.x,s.x,n.x),Id(e,r.y,s.y,n.y),Id(e,r.z,s.z,n.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},pS=class extends ba{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new He){let i=t,r=this.points,s=(r.length-1)*e,n=Math.floor(s),a=s-n,o=r[n===0?n:n-1],l=r[n],h=r[n>r.length-2?r.length-1:n+1],c=r[n>r.length-3?r.length-1:n+2];return i.set(F3(a,o.x,l.x,h.x,c.x),F3(a,o.y,l.y,h.y,c.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new He().fromArray(r))}return this}},pg=Object.freeze({__proto__:null,ArcCurve:J9,CatmullRomCurve3:Z9,CubicBezierCurve:cS,CubicBezierCurve3:sU,EllipseCurve:q1,LineCurve:uS,LineCurve3:nU,QuadraticBezierCurve:dS,QuadraticBezierCurve3:fS,SplineCurve:pS}),aU=class extends ba{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){let i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new pg[i](t,e))}return this}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),s=0;for(;s<r.length;){if(r[s]>=i){let n=r[s]-i,a=this.curves[s],o=a.getLength(),l=o===0?0:1-n/o;return a.getPointAt(l,t)}s++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,s=this.curves;r<s.length;r++){let n=s[r],a=n.isEllipseCurve?e*2:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?e*n.points.length:e,o=n.getPoints(a);for(let l=0;l<o.length;l++){let h=o[l];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new pg[r.type]().fromJSON(r))}return this}},v1=class extends aU{constructor(e){super(),this.type="Path",this.currentPoint=new He,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new uS(this.currentPoint.clone(),new He(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let s=new dS(this.currentPoint.clone(),new He(e,t),new He(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,n){let a=new cS(this.currentPoint.clone(),new He(e,t),new He(i,r),new He(s,n));return this.curves.push(a),this.currentPoint.set(s,n),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new pS(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,n){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,s,n),this}absarc(e,t,i,r,s,n){return this.absellipse(e,t,i,i,r,s,n),this}ellipse(e,t,i,r,s,n,a,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,i,r,s,n,a,o),this}absellipse(e,t,i,r,s,n,a,o){let l=new q1(e,t,i,r,s,n,a,o);if(this.curves.length>0){let c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},_S=class gS extends vs{constructor(t=[new He(0,-.5),new He(.5,0),new He(0,.5)],i=12,r=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:s},i=Math.floor(i),s=Gt(s,0,Math.PI*2);let n=[],a=[],o=[],l=[],h=[],c=1/i,f=new de,d=new He,u=new de,p=new de,_=new de,g=0,b=0;for(let m=0;m<=t.length-1;m++)switch(m){case 0:g=t[m+1].x-t[m].x,b=t[m+1].y-t[m].y,u.x=b*1,u.y=-g,u.z=b*0,_.copy(u),u.normalize(),l.push(u.x,u.y,u.z);break;case t.length-1:l.push(_.x,_.y,_.z);break;default:g=t[m+1].x-t[m].x,b=t[m+1].y-t[m].y,u.x=b*1,u.y=-g,u.z=b*0,p.copy(u),u.x+=_.x,u.y+=_.y,u.z+=_.z,u.normalize(),l.push(u.x,u.y,u.z),_.copy(p)}for(let m=0;m<=i;m++){let O=r+m*c*s,y=Math.sin(O),x=Math.cos(O);for(let E=0;E<=t.length-1;E++){f.x=t[E].x*y,f.y=t[E].y,f.z=t[E].x*x,a.push(f.x,f.y,f.z),d.x=m/i,d.y=E/(t.length-1),o.push(d.x,d.y);let w=l[3*E+0]*y,S=l[3*E+1],C=l[3*E+0]*x;h.push(w,S,C)}}for(let m=0;m<i;m++)for(let O=0;O<t.length-1;O++){let y=O+m*t.length,x=y,E=y+t.length,w=y+t.length+1,S=y+1;n.push(x,E,S),n.push(w,S,E)}this.setIndex(n),this.setAttribute("position",new St(a,3)),this.setAttribute("uv",new St(o,2)),this.setAttribute("normal",new St(h,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new gS(t.points,t.segments,t.phiStart,t.phiLength)}},oU=class OS extends _S{constructor(t=1,i=1,r=4,s=8){let n=new v1;n.absarc(0,-i/2,t,Math.PI*1.5,0),n.absarc(0,i/2,t,0,Math.PI*.5),super(n.getPoints(r),s),this.type="CapsuleGeometry",this.parameters={radius:t,length:i,capSegments:r,radialSegments:s}}static fromJSON(t){return new OS(t.radius,t.length,t.capSegments,t.radialSegments)}},lU=class mS extends vs{constructor(t=1,i=32,r=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:s},i=Math.max(3,i);let n=[],a=[],o=[],l=[],h=new de,c=new He;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let f=0,d=3;f<=i;f++,d+=3){let u=r+f/i*s;h.x=t*Math.cos(u),h.y=t*Math.sin(u),a.push(h.x,h.y,h.z),o.push(0,0,1),c.x=(a[d]/t+1)/2,c.y=(a[d+1]/t+1)/2,l.push(c.x,c.y)}for(let f=1;f<=i;f++)n.push(f,f+1,0);this.setIndex(n),this.setAttribute("position",new St(a,3)),this.setAttribute("normal",new St(o,3)),this.setAttribute("uv",new St(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new mS(t.radius,t.segments,t.thetaStart,t.thetaLength)}},yS=class bS extends vs{constructor(t=1,i=1,r=1,s=32,n=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:s,heightSegments:n,openEnded:a,thetaStart:o,thetaLength:l};let h=this;s=Math.floor(s),n=Math.floor(n);let c=[],f=[],d=[],u=[],p=0,_=[],g=r/2,b=0;m(),a===!1&&(t>0&&O(!0),i>0&&O(!1)),this.setIndex(c),this.setAttribute("position",new St(f,3)),this.setAttribute("normal",new St(d,3)),this.setAttribute("uv",new St(u,2));function m(){let y=new de,x=new de,E=0,w=(i-t)/r;for(let S=0;S<=n;S++){let C=[],R=S/n,B=R*(i-t)+t;for(let Y=0;Y<=s;Y++){let G=Y/s,z=G*l+o,q=Math.sin(z),L=Math.cos(z);x.x=B*q,x.y=-R*r+g,x.z=B*L,f.push(x.x,x.y,x.z),y.set(q,w,L).normalize(),d.push(y.x,y.y,y.z),u.push(G,1-R),C.push(p++)}_.push(C)}for(let S=0;S<s;S++)for(let C=0;C<n;C++){let R=_[C][S],B=_[C+1][S],Y=_[C+1][S+1],G=_[C][S+1];(t>0||C!==0)&&(c.push(R,B,G),E+=3),(i>0||C!==n-1)&&(c.push(B,Y,G),E+=3)}h.addGroup(b,E,0),b+=E}function O(y){let x=p,E=new He,w=new de,S=0,C=y===!0?t:i,R=y===!0?1:-1;for(let Y=1;Y<=s;Y++)f.push(0,g*R,0),d.push(0,R,0),u.push(.5,.5),p++;let B=p;for(let Y=0;Y<=s;Y++){let G=Y/s*l+o,z=Math.cos(G),q=Math.sin(G);w.x=C*q,w.y=g*R,w.z=C*z,f.push(w.x,w.y,w.z),d.push(0,R,0),E.x=z*.5+.5,E.y=q*.5*R+.5,u.push(E.x,E.y),p++}for(let Y=0;Y<s;Y++){let G=x+Y,z=B+Y;y===!0?c.push(z,z+1,G):c.push(z+1,z,G),S+=3}h.addGroup(b,S,y===!0?1:2),b+=S}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bS(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},hU=class xS extends yS{constructor(t=1,i=1,r=32,s=1,n=!1,a=0,o=Math.PI*2){super(0,t,i,r,s,n,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:s,openEnded:n,thetaStart:a,thetaLength:o}}static fromJSON(t){return new xS(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},Gd=class vS extends vs{constructor(t=[],i=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:s};let n=[],a=[];o(s),h(r),c(),this.setAttribute("position",new St(n,3)),this.setAttribute("normal",new St(n.slice(),3)),this.setAttribute("uv",new St(a,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function o(m){let O=new de,y=new de,x=new de;for(let E=0;E<i.length;E+=3)u(i[E+0],O),u(i[E+1],y),u(i[E+2],x),l(O,y,x,m)}function l(m,O,y,x){let E=x+1,w=[];for(let S=0;S<=E;S++){w[S]=[];let C=m.clone().lerp(y,S/E),R=O.clone().lerp(y,S/E),B=E-S;for(let Y=0;Y<=B;Y++)Y===0&&S===E?w[S][Y]=C:w[S][Y]=C.clone().lerp(R,Y/B)}for(let S=0;S<E;S++)for(let C=0;C<2*(E-S)-1;C++){let R=Math.floor(C/2);C%2===0?(d(w[S][R+1]),d(w[S+1][R]),d(w[S][R])):(d(w[S][R+1]),d(w[S+1][R+1]),d(w[S+1][R]))}}function h(m){let O=new de;for(let y=0;y<n.length;y+=3)O.x=n[y+0],O.y=n[y+1],O.z=n[y+2],O.normalize().multiplyScalar(m),n[y+0]=O.x,n[y+1]=O.y,n[y+2]=O.z}function c(){let m=new de;for(let O=0;O<n.length;O+=3){m.x=n[O+0],m.y=n[O+1],m.z=n[O+2];let y=g(m)/2/Math.PI+.5,x=b(m)/Math.PI+.5;a.push(y,1-x)}p(),f()}function f(){for(let m=0;m<a.length;m+=6){let O=a[m+0],y=a[m+2],x=a[m+4],E=Math.max(O,y,x),w=Math.min(O,y,x);E>.9&&w<.1&&(O<.2&&(a[m+0]+=1),y<.2&&(a[m+2]+=1),x<.2&&(a[m+4]+=1))}}function d(m){n.push(m.x,m.y,m.z)}function u(m,O){let y=m*3;O.x=t[y+0],O.y=t[y+1],O.z=t[y+2]}function p(){let m=new de,O=new de,y=new de,x=new de,E=new He,w=new He,S=new He;for(let C=0,R=0;C<n.length;C+=9,R+=6){m.set(n[C+0],n[C+1],n[C+2]),O.set(n[C+3],n[C+4],n[C+5]),y.set(n[C+6],n[C+7],n[C+8]),E.set(a[R+0],a[R+1]),w.set(a[R+2],a[R+3]),S.set(a[R+4],a[R+5]),x.copy(m).add(O).add(y).divideScalar(3);let B=g(x);_(E,R+0,m,B),_(w,R+2,O,B),_(S,R+4,y,B)}}function _(m,O,y,x){x<0&&m.x===1&&(a[O]=m.x-1),y.x===0&&y.z===0&&(a[O]=x/2/Math.PI+.5)}function g(m){return Math.atan2(m.z,-m.x)}function b(m){return Math.atan2(-m.y,Math.sqrt(m.x*m.x+m.z*m.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vS(t.vertices,t.indices,t.radius,t.details)}},cU=class ES extends Gd{constructor(t=1,i=0){let r=(1+Math.sqrt(5))/2,s=1/r,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new ES(t.radius,t.detail)}},$_=new de,Q_=new de,f1=new de,eg=new Sc,uU=class extends vs{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){let i=Math.pow(10,4),r=Math.cos(_9*t),s=e.getIndex(),n=e.getAttribute("position"),a=s?s.count:n.count,o=[0,0,0],l=["a","b","c"],h=new Array(3),c={},f=[];for(let d=0;d<a;d+=3){s?(o[0]=s.getX(d),o[1]=s.getX(d+1),o[2]=s.getX(d+2)):(o[0]=d,o[1]=d+1,o[2]=d+2);let{a:u,b:p,c:_}=eg;if(u.fromBufferAttribute(n,o[0]),p.fromBufferAttribute(n,o[1]),_.fromBufferAttribute(n,o[2]),eg.getNormal(f1),h[0]=`${Math.round(u.x*i)},${Math.round(u.y*i)},${Math.round(u.z*i)}`,h[1]=`${Math.round(p.x*i)},${Math.round(p.y*i)},${Math.round(p.z*i)}`,h[2]=`${Math.round(_.x*i)},${Math.round(_.y*i)},${Math.round(_.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let g=0;g<3;g++){let b=(g+1)%3,m=h[g],O=h[b],y=eg[l[g]],x=eg[l[b]],E=`${m}_${O}`,w=`${O}_${m}`;w in c&&c[w]?(f1.dot(c[w].normal)<=r&&(f.push(y.x,y.y,y.z),f.push(x.x,x.y,x.z)),c[w]=null):E in c||(c[E]={index0:o[g],index1:o[b],normal:f1.clone()})}}for(let d in c)if(c[d]){let{index0:u,index1:p}=c[d];$_.fromBufferAttribute(n,u),Q_.fromBufferAttribute(n,p),f.push($_.x,$_.y,$_.z),f.push(Q_.x,Q_.y,Q_.z)}this.setAttribute("position",new St(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}},TS=class extends v1{constructor(e){super(e),this.uuid=Uc(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new v1().fromJSON(r))}return this}},dU={triangulate:function(e,t,i=2){let r=t&&t.length,s=r?t[0]*i:e.length,n=wS(e,0,s,i,!0),a=[];if(!n||n.next===n.prev)return a;let o,l,h,c,f,d,u;if(r&&(n=OU(e,t,n,i)),e.length>80*i){o=h=e[0],l=c=e[1];for(let p=i;p<s;p+=i)f=e[p],d=e[p+1],f<o&&(o=f),d<l&&(l=d),f>h&&(h=f),d>c&&(c=d);u=Math.max(h-o,c-l),u=u!==0?32767/u:0}return Ad(n,a,i,o,l,u,0),a}};function wS(e,t,i,r,s){let n,a;if(s===PU(e,t,i,r)>0)for(n=t;n<i;n+=r)a=G3(n,e[n],e[n+1],a);else for(n=i-r;n>=t;n-=r)a=G3(n,e[n],e[n+1],a);return a&&bg(a,a.next)&&(Nd(a),a=a.next),a}function Ql(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(bg(i,i.next)||Ki(i.prev,i,i.next)===0)){if(Nd(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Ad(e,t,i,r,s,n,a){if(!e)return;!a&&n&&vU(e,r,s,n);let o=e,l,h;for(;e.prev!==e.next;){if(l=e.prev,h=e.next,n?pU(e,r,s,n):fU(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(h.i/i|0),Nd(e),e=h.next,o=h.next;continue}if(e=h,e===o){a?a===1?(e=_U(Ql(e),t,i),Ad(e,t,i,r,s,n,2)):a===2&&gU(e,t,i,r,s,n):Ad(Ql(e),t,i,r,s,n,1);break}}}function fU(e){let t=e.prev,i=e,r=e.next;if(Ki(t,i,r)>=0)return!1;let s=t.x,n=i.x,a=r.x,o=t.y,l=i.y,h=r.y,c=s<n?s<a?s:a:n<a?n:a,f=o<l?o<h?o:h:l<h?l:h,d=s>n?s>a?s:a:n>a?n:a,u=o>l?o>h?o:h:l>h?l:h,p=r.next;for(;p!==t;){if(p.x>=c&&p.x<=d&&p.y>=f&&p.y<=u&&Cc(s,o,n,l,a,h,p.x,p.y)&&Ki(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function pU(e,t,i,r){let s=e.prev,n=e,a=e.next;if(Ki(s,n,a)>=0)return!1;let o=s.x,l=n.x,h=a.x,c=s.y,f=n.y,d=a.y,u=o<l?o<h?o:h:l<h?l:h,p=c<f?c<d?c:d:f<d?f:d,_=o>l?o>h?o:h:l>h?l:h,g=c>f?c>d?c:d:f>d?f:d,b=E1(u,p,t,i,r),m=E1(_,g,t,i,r),O=e.prevZ,y=e.nextZ;for(;O&&O.z>=b&&y&&y.z<=m;){if(O.x>=u&&O.x<=_&&O.y>=p&&O.y<=g&&O!==s&&O!==a&&Cc(o,c,l,f,h,d,O.x,O.y)&&Ki(O.prev,O,O.next)>=0||(O=O.prevZ,y.x>=u&&y.x<=_&&y.y>=p&&y.y<=g&&y!==s&&y!==a&&Cc(o,c,l,f,h,d,y.x,y.y)&&Ki(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;O&&O.z>=b;){if(O.x>=u&&O.x<=_&&O.y>=p&&O.y<=g&&O!==s&&O!==a&&Cc(o,c,l,f,h,d,O.x,O.y)&&Ki(O.prev,O,O.next)>=0)return!1;O=O.prevZ}for(;y&&y.z<=m;){if(y.x>=u&&y.x<=_&&y.y>=p&&y.y<=g&&y!==s&&y!==a&&Cc(o,c,l,f,h,d,y.x,y.y)&&Ki(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function _U(e,t,i){let r=e;do{let s=r.prev,n=r.next.next;!bg(s,n)&&SS(s,r,r.next,n)&&Cd(s,n)&&Cd(n,s)&&(t.push(s.i/i|0),t.push(r.i/i|0),t.push(n.i/i|0),Nd(r),Nd(r.next),r=e=n),r=r.next}while(r!==e);return Ql(r)}function gU(e,t,i,r,s,n){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&wU(a,o)){let l=IS(a,o);a=Ql(a,a.next),l=Ql(l,l.next),Ad(a,t,i,r,s,n,0),Ad(l,t,i,r,s,n,0);return}o=o.next}a=a.next}while(a!==e)}function OU(e,t,i,r){let s=[],n,a,o,l,h;for(n=0,a=t.length;n<a;n++)o=t[n]*r,l=n<a-1?t[n+1]*r:e.length,h=wS(e,o,l,r,!1),h===h.next&&(h.steiner=!0),s.push(TU(h));for(s.sort(mU),n=0;n<s.length;n++)i=yU(s[n],i);return i}function mU(e,t){return e.x-t.x}function yU(e,t){let i=bU(e,t);if(!i)return t;let r=IS(i,e);return Ql(r,r.next),Ql(i,i.next)}function bU(e,t){let i=t,r=-1/0,s,n=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=n&&d>r&&(r=d,s=i.x<i.next.x?i:i.next,d===n))return s}i=i.next}while(i!==t);if(!s)return null;let o=s,l=s.x,h=s.y,c=1/0,f;i=s;do n>=i.x&&i.x>=l&&n!==i.x&&Cc(a<h?n:r,a,l,h,a<h?r:n,a,i.x,i.y)&&(f=Math.abs(a-i.y)/(n-i.x),Cd(i,e)&&(f<c||f===c&&(i.x>s.x||i.x===s.x&&xU(s,i)))&&(s=i,c=f)),i=i.next;while(i!==o);return s}function xU(e,t){return Ki(e.prev,e,t.prev)<0&&Ki(t.next,e,e.next)<0}function vU(e,t,i,r){let s=e;do s.z===0&&(s.z=E1(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,EU(s)}function EU(e){let t,i,r,s,n,a,o,l,h=1;do{for(i=e,e=null,n=null,a=0;i;){for(a++,r=i,o=0,t=0;t<h&&(o++,r=r.nextZ,!!r);t++);for(l=h;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,h*=2}while(a>1);return e}function E1(e,t,i,r,s){return e=(e-i)*s|0,t=(t-r)*s|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function TU(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Cc(e,t,i,r,s,n,a,o){return(s-a)*(t-o)>=(e-a)*(n-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(n-o)>=(s-a)*(r-o)}function wU(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!SU(e,t)&&(Cd(e,t)&&Cd(t,e)&&IU(e,t)&&(Ki(e.prev,e,t.prev)||Ki(e,t.prev,t))||bg(e,t)&&Ki(e.prev,e,e.next)>0&&Ki(t.prev,t,t.next)>0)}function Ki(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function bg(e,t){return e.x===t.x&&e.y===t.y}function SS(e,t,i,r){let s=ig(Ki(e,t,i)),n=ig(Ki(e,t,r)),a=ig(Ki(i,r,e)),o=ig(Ki(i,r,t));return!!(s!==n&&a!==o||s===0&&tg(e,i,t)||n===0&&tg(e,r,t)||a===0&&tg(i,e,r)||o===0&&tg(i,t,r))}function tg(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function ig(e){return e>0?1:e<0?-1:0}function SU(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&SS(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Cd(e,t){return Ki(e.prev,e,e.next)<0?Ki(e,t,e.next)>=0&&Ki(e,e.prev,t)>=0:Ki(e,t,e.prev)<0||Ki(e,e.next,t)<0}function IU(e,t){let i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function IS(e,t){let i=new T1(e.i,e.x,e.y),r=new T1(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function G3(e,t,i,r){let s=new T1(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Nd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T1(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function PU(e,t,i,r){let s=0;for(let n=t,a=i-r;n<i;n+=r)s+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return s}var Rc=class PS{static area(t){let i=t.length,r=0;for(let s=i-1,n=0;n<i;s=n++)r+=t[s].x*t[n].y-t[n].x*t[s].y;return r*.5}static isClockWise(t){return PS.area(t)<0}static triangulateShape(t,i){let r=[],s=[],n=[];z3(t),H3(r,t);let a=t.length;i.forEach(z3);for(let l=0;l<i.length;l++)s.push(a),a+=i[l].length,H3(r,i[l]);let o=dU.triangulate(r,s);for(let l=0;l<o.length;l+=3)n.push(o.slice(l,l+3));return n}};function z3(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function H3(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var AU=class AS extends vs{constructor(t=new TS([new He(.5,.5),new He(-.5,.5),new He(-.5,-.5),new He(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];let r=this,s=[],n=[];for(let o=0,l=t.length;o<l;o++){let h=t[o];a(h)}this.setAttribute("position",new St(s,3)),this.setAttribute("uv",new St(n,2)),this.computeVertexNormals();function a(o){let l=[],h=i.curveSegments!==void 0?i.curveSegments:12,c=i.steps!==void 0?i.steps:1,f=i.depth!==void 0?i.depth:1,d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,u=i.bevelThickness!==void 0?i.bevelThickness:.2,p=i.bevelSize!==void 0?i.bevelSize:u-.1,_=i.bevelOffset!==void 0?i.bevelOffset:0,g=i.bevelSegments!==void 0?i.bevelSegments:3,b=i.extrudePath,m=i.UVGenerator!==void 0?i.UVGenerator:CU,O,y=!1,x,E,w,S;b&&(O=b.getSpacedPoints(c),y=!0,d=!1,x=b.computeFrenetFrames(c,!1),E=new de,w=new de,S=new de),d||(g=0,u=0,p=0,_=0);let C=o.extractPoints(h),R=C.shape,B=C.holes;if(!Rc.isClockWise(R)){R=R.reverse();for(let Z=0,re=B.length;Z<re;Z++){let ue=B[Z];Rc.isClockWise(ue)&&(B[Z]=ue.reverse())}}let Y=Rc.triangulateShape(R,B),G=R;for(let Z=0,re=B.length;Z<re;Z++){let ue=B[Z];R=R.concat(ue)}function z(Z,re,ue){return re||console.error("THREE.ExtrudeGeometry: vec does not exist"),Z.clone().addScaledVector(re,ue)}let q=R.length,L=Y.length;function M(Z,re,ue){let Le,Ce,De,Pe=Z.x-re.x,Ie=Z.y-re.y,Je=ue.x-Z.x,$e=ue.y-Z.y,pt=Pe*Pe+Ie*Ie,ct=Pe*$e-Ie*Je;if(Math.abs(ct)>Number.EPSILON){let ut=Math.sqrt(pt),si=Math.sqrt(Je*Je+$e*$e),mi=re.x-Ie/ut,It=re.y+Pe/ut,jt=ue.x-$e/si,Ai=ue.y+Je/si,ni=((jt-mi)*$e-(Ai-It)*Je)/(Pe*$e-Ie*Je);Le=mi+Pe*ni-Z.x,Ce=It+Ie*ni-Z.y;let T=Le*Le+Ce*Ce;if(T<=2)return new He(Le,Ce);De=Math.sqrt(T/2)}else{let ut=!1;Pe>Number.EPSILON?Je>Number.EPSILON&&(ut=!0):Pe<-Number.EPSILON?Je<-Number.EPSILON&&(ut=!0):Math.sign(Ie)===Math.sign($e)&&(ut=!0),ut?(Le=-Ie,Ce=Pe,De=Math.sqrt(pt)):(Le=Pe,Ce=Ie,De=Math.sqrt(pt/2))}return new He(Le/De,Ce/De)}let v=[];for(let Z=0,re=G.length,ue=re-1,Le=Z+1;Z<re;Z++,ue++,Le++)ue===re&&(ue=0),Le===re&&(Le=0),v[Z]=M(G[Z],G[ue],G[Le]);let P=[],I,N=v.concat();for(let Z=0,re=B.length;Z<re;Z++){let ue=B[Z];I=[];for(let Le=0,Ce=ue.length,De=Ce-1,Pe=Le+1;Le<Ce;Le++,De++,Pe++)De===Ce&&(De=0),Pe===Ce&&(Pe=0),I[Le]=M(ue[Le],ue[De],ue[Pe]);P.push(I),N=N.concat(I)}for(let Z=0;Z<g;Z++){let re=Z/g,ue=u*Math.cos(re*Math.PI/2),Le=p*Math.sin(re*Math.PI/2)+_;for(let Ce=0,De=G.length;Ce<De;Ce++){let Pe=z(G[Ce],v[Ce],Le);se(Pe.x,Pe.y,-ue)}for(let Ce=0,De=B.length;Ce<De;Ce++){let Pe=B[Ce];I=P[Ce];for(let Ie=0,Je=Pe.length;Ie<Je;Ie++){let $e=z(Pe[Ie],I[Ie],Le);se($e.x,$e.y,-ue)}}}let D=p+_;for(let Z=0;Z<q;Z++){let re=d?z(R[Z],N[Z],D):R[Z];y?(w.copy(x.normals[0]).multiplyScalar(re.x),E.copy(x.binormals[0]).multiplyScalar(re.y),S.copy(O[0]).add(w).add(E),se(S.x,S.y,S.z)):se(re.x,re.y,0)}for(let Z=1;Z<=c;Z++)for(let re=0;re<q;re++){let ue=d?z(R[re],N[re],D):R[re];y?(w.copy(x.normals[Z]).multiplyScalar(ue.x),E.copy(x.binormals[Z]).multiplyScalar(ue.y),S.copy(O[Z]).add(w).add(E),se(S.x,S.y,S.z)):se(ue.x,ue.y,f/c*Z)}for(let Z=g-1;Z>=0;Z--){let re=Z/g,ue=u*Math.cos(re*Math.PI/2),Le=p*Math.sin(re*Math.PI/2)+_;for(let Ce=0,De=G.length;Ce<De;Ce++){let Pe=z(G[Ce],v[Ce],Le);se(Pe.x,Pe.y,f+ue)}for(let Ce=0,De=B.length;Ce<De;Ce++){let Pe=B[Ce];I=P[Ce];for(let Ie=0,Je=Pe.length;Ie<Je;Ie++){let $e=z(Pe[Ie],I[Ie],Le);y?se($e.x,$e.y+O[c-1].y,O[c-1].x+ue):se($e.x,$e.y,f+ue)}}}j(),H();function j(){let Z=s.length/3;if(d){let re=0,ue=q*re;for(let Le=0;Le<L;Le++){let Ce=Y[Le];he(Ce[2]+ue,Ce[1]+ue,Ce[0]+ue)}re=c+g*2,ue=q*re;for(let Le=0;Le<L;Le++){let Ce=Y[Le];he(Ce[0]+ue,Ce[1]+ue,Ce[2]+ue)}}else{for(let re=0;re<L;re++){let ue=Y[re];he(ue[2],ue[1],ue[0])}for(let re=0;re<L;re++){let ue=Y[re];he(ue[0]+q*c,ue[1]+q*c,ue[2]+q*c)}}r.addGroup(Z,s.length/3-Z,0)}function H(){let Z=s.length/3,re=0;K(G,re),re+=G.length;for(let ue=0,Le=B.length;ue<Le;ue++){let Ce=B[ue];K(Ce,re),re+=Ce.length}r.addGroup(Z,s.length/3-Z,1)}function K(Z,re){let ue=Z.length;for(;--ue>=0;){let Le=ue,Ce=ue-1;Ce<0&&(Ce=Z.length-1);for(let De=0,Pe=c+g*2;De<Pe;De++){let Ie=q*De,Je=q*(De+1),$e=re+Le+Ie,pt=re+Ce+Ie,ct=re+Ce+Je,ut=re+Le+Je;_e($e,pt,ct,ut)}}}function se(Z,re,ue){l.push(Z),l.push(re),l.push(ue)}function he(Z,re,ue){ve(Z),ve(re),ve(ue);let Le=s.length/3,Ce=m.generateTopUV(r,s,Le-3,Le-2,Le-1);J(Ce[0]),J(Ce[1]),J(Ce[2])}function _e(Z,re,ue,Le){ve(Z),ve(re),ve(Le),ve(re),ve(ue),ve(Le);let Ce=s.length/3,De=m.generateSideWallUV(r,s,Ce-6,Ce-3,Ce-2,Ce-1);J(De[0]),J(De[1]),J(De[3]),J(De[1]),J(De[2]),J(De[3])}function ve(Z){s.push(l[Z*3+0]),s.push(l[Z*3+1]),s.push(l[Z*3+2])}function J(Z){n.push(Z.x),n.push(Z.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){let t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return NU(i,r,t)}static fromJSON(t,i){let r=[];for(let n=0,a=t.shapes.length;n<a;n++){let o=i[t.shapes[n]];r.push(o)}let s=t.options.extrudePath;return s!==void 0&&(t.options.extrudePath=new pg[s.type]().fromJSON(s)),new AS(r,t.options)}},CU={generateTopUV:function(e,t,i,r,s){let n=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],h=t[s*3],c=t[s*3+1];return[new He(n,a),new He(o,l),new He(h,c)]},generateSideWallUV:function(e,t,i,r,s,n){let a=t[i*3],o=t[i*3+1],l=t[i*3+2],h=t[r*3],c=t[r*3+1],f=t[r*3+2],d=t[s*3],u=t[s*3+1],p=t[s*3+2],_=t[n*3],g=t[n*3+1],b=t[n*3+2];return Math.abs(o-c)<Math.abs(a-h)?[new He(a,1-l),new He(h,1-f),new He(d,1-p),new He(_,1-b)]:[new He(o,1-l),new He(c,1-f),new He(u,1-p),new He(g,1-b)]}};function NU(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,s=e.length;r<s;r++){let n=e[r];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}var LU=class CS extends Gd{constructor(t=1,i=0){let r=(1+Math.sqrt(5))/2,s=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,n,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new CS(t.radius,t.detail)}},RU=class NS extends Gd{constructor(t=1,i=0){let r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,s,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new NS(t.radius,t.detail)}},DU=class LS extends vs{constructor(t=1,i=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:s};let n=t/2,a=i/2,o=Math.floor(r),l=Math.floor(s),h=o+1,c=l+1,f=t/o,d=i/l,u=[],p=[],_=[],g=[];for(let b=0;b<c;b++){let m=b*d-a;for(let O=0;O<h;O++){let y=O*f-n;p.push(y,-m,0),_.push(0,0,1),g.push(O/o),g.push(1-b/l)}}for(let b=0;b<l;b++)for(let m=0;m<o;m++){let O=m+h*b,y=m+h*(b+1),x=m+1+h*(b+1),E=m+1+h*b;u.push(O,y,E),u.push(y,x,E)}this.setIndex(u),this.setAttribute("position",new St(p,3)),this.setAttribute("normal",new St(_,3)),this.setAttribute("uv",new St(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new LS(t.width,t.height,t.widthSegments,t.heightSegments)}},MU=class RS extends vs{constructor(t=.5,i=1,r=32,s=1,n=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:s,thetaStart:n,thetaLength:a},r=Math.max(3,r),s=Math.max(1,s);let o=[],l=[],h=[],c=[],f=t,d=(i-t)/s,u=new de,p=new He;for(let _=0;_<=s;_++){for(let g=0;g<=r;g++){let b=n+g/r*a;u.x=f*Math.cos(b),u.y=f*Math.sin(b),l.push(u.x,u.y,u.z),h.push(0,0,1),p.x=(u.x/i+1)/2,p.y=(u.y/i+1)/2,c.push(p.x,p.y)}f+=d}for(let _=0;_<s;_++){let g=_*(r+1);for(let b=0;b<r;b++){let m=b+g,O=m,y=m+r+1,x=m+r+2,E=m+1;o.push(O,y,E),o.push(y,x,E)}}this.setIndex(o),this.setAttribute("position",new St(l,3)),this.setAttribute("normal",new St(h,3)),this.setAttribute("uv",new St(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new RS(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}},BU=class DS extends vs{constructor(t=new TS([new He(0,.5),new He(-.5,-.5),new He(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};let r=[],s=[],n=[],a=[],o=0,l=0;if(Array.isArray(t)===!1)h(t);else for(let c=0;c<t.length;c++)h(t[c]),this.addGroup(o,l,c),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new St(s,3)),this.setAttribute("normal",new St(n,3)),this.setAttribute("uv",new St(a,2));function h(c){let f=s.length/3,d=c.extractPoints(i),u=d.shape,p=d.holes;Rc.isClockWise(u)===!1&&(u=u.reverse());for(let g=0,b=p.length;g<b;g++){let m=p[g];Rc.isClockWise(m)===!0&&(p[g]=m.reverse())}let _=Rc.triangulateShape(u,p);for(let g=0,b=p.length;g<b;g++){let m=p[g];u=u.concat(m)}for(let g=0,b=u.length;g<b;g++){let m=u[g];s.push(m.x,m.y,0),n.push(0,0,1),a.push(m.x,m.y)}for(let g=0,b=_.length;g<b;g++){let m=_[g],O=m[0]+f,y=m[1]+f,x=m[2]+f;r.push(O,y,x),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){let t=super.toJSON(),i=this.parameters.shapes;return kU(i,t)}static fromJSON(t,i){let r=[];for(let s=0,n=t.shapes.length;s<n;s++){let a=i[t.shapes[s]];r.push(a)}return new DS(r,t.curveSegments)}};function kU(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){let s=e[i];t.shapes.push(s.uuid)}else t.shapes.push(e.uuid);return t}var UU=class MS extends vs{constructor(t=1,i=32,r=16,s=0,n=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:s,phiLength:n,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));let l=Math.min(a+o,Math.PI),h=0,c=[],f=new de,d=new de,u=[],p=[],_=[],g=[];for(let b=0;b<=r;b++){let m=[],O=b/r,y=0;b===0&&a===0?y=.5/i:b===r&&l===Math.PI&&(y=-.5/i);for(let x=0;x<=i;x++){let E=x/i;f.x=-t*Math.cos(s+E*n)*Math.sin(a+O*o),f.y=t*Math.cos(a+O*o),f.z=t*Math.sin(s+E*n)*Math.sin(a+O*o),p.push(f.x,f.y,f.z),d.copy(f).normalize(),_.push(d.x,d.y,d.z),g.push(E+y,1-O),m.push(h++)}c.push(m)}for(let b=0;b<r;b++)for(let m=0;m<i;m++){let O=c[b][m+1],y=c[b][m],x=c[b+1][m],E=c[b+1][m+1];(b!==0||a>0)&&u.push(O,y,E),(b!==r-1||l<Math.PI)&&u.push(y,x,E)}this.setIndex(u),this.setAttribute("position",new St(p,3)),this.setAttribute("normal",new St(_,3)),this.setAttribute("uv",new St(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new MS(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}},FU=class BS extends Gd{constructor(t=1,i=0){let r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,s,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new BS(t.radius,t.detail)}},GU=class kS extends vs{constructor(t=1,i=.4,r=12,s=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:s,arc:n},r=Math.floor(r),s=Math.floor(s);let a=[],o=[],l=[],h=[],c=new de,f=new de,d=new de;for(let u=0;u<=r;u++)for(let p=0;p<=s;p++){let _=p/s*n,g=u/r*Math.PI*2;f.x=(t+i*Math.cos(g))*Math.cos(_),f.y=(t+i*Math.cos(g))*Math.sin(_),f.z=i*Math.sin(g),o.push(f.x,f.y,f.z),c.x=t*Math.cos(_),c.y=t*Math.sin(_),d.subVectors(f,c).normalize(),l.push(d.x,d.y,d.z),h.push(p/s),h.push(u/r)}for(let u=1;u<=r;u++)for(let p=1;p<=s;p++){let _=(s+1)*u+p-1,g=(s+1)*(u-1)+p-1,b=(s+1)*(u-1)+p,m=(s+1)*u+p;a.push(_,g,m),a.push(g,b,m)}this.setIndex(a),this.setAttribute("position",new St(o,3)),this.setAttribute("normal",new St(l,3)),this.setAttribute("uv",new St(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new kS(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}},zU=class US extends vs{constructor(t=1,i=.4,r=64,s=8,n=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:s,p:n,q:a},r=Math.floor(r),s=Math.floor(s);let o=[],l=[],h=[],c=[],f=new de,d=new de,u=new de,p=new de,_=new de,g=new de,b=new de;for(let O=0;O<=r;++O){let y=O/r*n*Math.PI*2;m(y,n,a,t,u),m(y+.01,n,a,t,p),g.subVectors(p,u),b.addVectors(p,u),_.crossVectors(g,b),b.crossVectors(_,g),_.normalize(),b.normalize();for(let x=0;x<=s;++x){let E=x/s*Math.PI*2,w=-i*Math.cos(E),S=i*Math.sin(E);f.x=u.x+(w*b.x+S*_.x),f.y=u.y+(w*b.y+S*_.y),f.z=u.z+(w*b.z+S*_.z),l.push(f.x,f.y,f.z),d.subVectors(f,u).normalize(),h.push(d.x,d.y,d.z),c.push(O/r),c.push(x/s)}}for(let O=1;O<=r;O++)for(let y=1;y<=s;y++){let x=(s+1)*(O-1)+(y-1),E=(s+1)*O+(y-1),w=(s+1)*O+y,S=(s+1)*(O-1)+y;o.push(x,E,S),o.push(E,w,S)}this.setIndex(o),this.setAttribute("position",new St(l,3)),this.setAttribute("normal",new St(h,3)),this.setAttribute("uv",new St(c,2));function m(O,y,x,E,w){let S=Math.cos(O),C=Math.sin(O),R=x/y*O,B=Math.cos(R);w.x=E*(2+B)*.5*S,w.y=E*(2+B)*C*.5,w.z=E*Math.sin(R)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new US(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}},HU=class FS extends vs{constructor(t=new fS(new de(-1,-1,0),new de(-1,1,0),new de(1,1,0)),i=64,r=1,s=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:s,closed:n};let a=t.computeFrenetFrames(i,n);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;let o=new de,l=new de,h=new He,c=new de,f=[],d=[],u=[],p=[];_(),this.setIndex(p),this.setAttribute("position",new St(f,3)),this.setAttribute("normal",new St(d,3)),this.setAttribute("uv",new St(u,2));function _(){for(let O=0;O<i;O++)g(O);g(n===!1?i:0),m(),b()}function g(O){c=t.getPointAt(O/i,c);let y=a.normals[O],x=a.binormals[O];for(let E=0;E<=s;E++){let w=E/s*Math.PI*2,S=Math.sin(w),C=-Math.cos(w);l.x=C*y.x+S*x.x,l.y=C*y.y+S*x.y,l.z=C*y.z+S*x.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=c.x+r*l.x,o.y=c.y+r*l.y,o.z=c.z+r*l.z,f.push(o.x,o.y,o.z)}}function b(){for(let O=1;O<=i;O++)for(let y=1;y<=s;y++){let x=(s+1)*(O-1)+(y-1),E=(s+1)*O+(y-1),w=(s+1)*O+y,S=(s+1)*(O-1)+y;p.push(x,E,S),p.push(E,w,S)}}function m(){for(let O=0;O<=i;O++)for(let y=0;y<=s;y++)h.x=O/i,h.y=y/s,u.push(h.x,h.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){let t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new FS(new pg[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}},jU=class extends vs{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){let t=[],i=new Set,r=new de,s=new de;if(e.index!==null){let n=e.attributes.position,a=e.index,o=e.groups;o.length===0&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let l=0,h=o.length;l<h;++l){let c=o[l],f=c.start,d=c.count;for(let u=f,p=f+d;u<p;u+=3)for(let _=0;_<3;_++){let g=a.getX(u+_),b=a.getX(u+(_+1)%3);r.fromBufferAttribute(n,g),s.fromBufferAttribute(n,b),j3(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{let n=e.attributes.position;for(let a=0,o=n.count/3;a<o;a++)for(let l=0;l<3;l++){let h=3*a+l,c=3*a+(l+1)%3;r.fromBufferAttribute(n,h),s.fromBufferAttribute(n,c),j3(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new St(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}};function j3(e,t,i){let r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,s=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(s)===!0?!1:(i.add(r),i.add(s),!0)}var Cie=Object.freeze({__proto__:null,BoxGeometry:z9,CapsuleGeometry:oU,CircleGeometry:lU,ConeGeometry:hU,CylinderGeometry:yS,DodecahedronGeometry:cU,EdgesGeometry:uU,ExtrudeGeometry:AU,IcosahedronGeometry:LU,LatheGeometry:_S,OctahedronGeometry:RU,PlaneGeometry:DU,PolyhedronGeometry:Gd,RingGeometry:MU,ShapeGeometry:BU,SphereGeometry:UU,TetrahedronGeometry:FU,TorusGeometry:GU,TorusKnotGeometry:zU,TubeGeometry:HU,WireframeGeometry:jU});function rg(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function YU(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var xg=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let n;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}n=t.length;break i}if(!(e>=s)){let a=t[1];e<a&&(i=2,s=a);for(let o=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=s,s=t[--i-1],e>=s)break t}n=i,i=0;break i}break e}for(;i<n;){let a=i+n>>>1;e<t[a]?n=a:i=a+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let n=0;n!==r;++n)t[n]=i[s+n];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},VU=class extends xg{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:O3,endingEnd:O3}}intervalChanged_(e,t,i){let r=this.parameterPositions,s=e-2,n=e+1,a=r[s],o=r[n];if(a===void 0)switch(this.getSettings_().endingStart){case m3:s=e,a=2*t-i;break;case y3:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case m3:n=e,o=2*i-t;break;case y3:n=1,o=i+r[1]-r[0];break;default:n=e-1,o=t}let l=(i-t)*.5,h=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=s*h,this._offsetNext=n*h}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,h=this._offsetPrev,c=this._offsetNext,f=this._weightPrev,d=this._weightNext,u=(i-t)/(r-t),p=u*u,_=p*u,g=-f*_+2*f*p-f*u,b=(1+f)*_+(-1.5-2*f)*p+(-.5+f)*u+1,m=(-1-d)*_+(1.5+d)*p+.5*u,O=d*_-d*p;for(let y=0;y!==a;++y)s[y]=g*n[h+y]+b*n[l+y]+m*n[o+y]+O*n[c+y];return s}},qU=class extends xg{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,h=(i-t)/(r-t),c=1-h;for(let f=0;f!==a;++f)s[f]=n[l+f]*c+n[o+f]*h;return s}},XU=class extends xg{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},uo=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=rg(t,this.TimeBufferType),this.values=rg(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:rg(e.times,Array),values:rg(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new XU(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new qU(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new VU(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case fg:t=this.InterpolantFactoryMethodDiscrete;break;case y1:t=this.InterpolantFactoryMethodLinear;break;case z0:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return fg;case this.InterpolantFactoryMethodLinear:return y1;case this.InterpolantFactoryMethodSmooth:return z0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,s=0,n=r-1;for(;s!==r&&i[s]<e;)++s;for(;n!==-1&&i[n]>t;)--n;if(++n,s!==0||n!==r){s>=n&&(n=Math.max(n,1),s=n-1);let a=this.getValueSize();this.times=i.slice(s,n),this.values=this.values.slice(s*a,n*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let n=null;for(let a=0;a!==s;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(n!==null&&n>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,n),e=!1;break}n=o}if(r!==void 0&&YU(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===z0,s=e.length-1,n=1;for(let a=1;a<s;++a){let o=!1,l=e[a],h=e[a+1];if(l!==h&&(a!==1||l!==e[0]))if(r)o=!0;else{let c=a*i,f=c-i,d=c+i;for(let u=0;u!==i;++u){let p=t[c+u];if(p!==t[f+u]||p!==t[d+u]){o=!0;break}}}if(o){if(a!==n){e[n]=e[a];let c=a*i,f=n*i;for(let d=0;d!==i;++d)t[f+d]=t[c+d]}++n}}if(s>0){e[n]=e[s];for(let a=s*i,o=n*i,l=0;l!==i;++l)t[o+l]=t[a+l];++n}return n!==e.length?(this.times=e.slice(0,n),this.values=t.slice(0,n*i)):(this.times=e,this.values=t),this}clone(){let e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};uo.prototype.TimeBufferType=Float32Array;uo.prototype.ValueBufferType=Float32Array;uo.prototype.DefaultInterpolation=y1;var zd=class extends uo{constructor(e,t,i){super(e,t,i)}};zd.prototype.ValueTypeName="bool";zd.prototype.ValueBufferType=Array;zd.prototype.DefaultInterpolation=fg;zd.prototype.InterpolantFactoryMethodLinear=void 0;zd.prototype.InterpolantFactoryMethodSmooth=void 0;var WU=class extends uo{};WU.prototype.ValueTypeName="color";var JU=class extends uo{};JU.prototype.ValueTypeName="number";var ZU=class extends xg{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let s=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let h=l+a;l!==h;l+=4)rl.slerpFlat(s,0,n,l-a,n,l,o);return s}},GS=class extends uo{InterpolantFactoryMethodLinear(e){return new ZU(this.times,this.values,this.getValueSize(),e)}};GS.prototype.ValueTypeName="quaternion";GS.prototype.InterpolantFactoryMethodSmooth=void 0;var Hd=class extends uo{constructor(e,t,i){super(e,t,i)}};Hd.prototype.ValueTypeName="string";Hd.prototype.ValueBufferType=Array;Hd.prototype.DefaultInterpolation=fg;Hd.prototype.InterpolantFactoryMethodLinear=void 0;Hd.prototype.InterpolantFactoryMethodSmooth=void 0;var KU=class extends uo{};KU.prototype.ValueTypeName="vector";var $U=class{constructor(e,t,i){let r=this,s=!1,n=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,s===!1&&r.onStart!==void 0&&r.onStart(h,n,a),s=!0},this.itemEnd=function(h){n++,r.onProgress!==void 0&&r.onProgress(h,n,a),n===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return o?o(h):h},this.setURLModifier=function(h){return o=h,this},this.addHandler=function(h,c){return l.push(h,c),this},this.removeHandler=function(h){let c=l.indexOf(h);return c!==-1&&l.splice(c,2),this},this.getHandler=function(h){for(let c=0,f=l.length;c<f;c+=2){let d=l[c],u=l[c+1];if(d.global&&(d.lastIndex=0),d.test(h))return u}return null}}},QU=new $U,eF=class{constructor(e){this.manager=e!==void 0?e:QU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};eF.DEFAULT_MATERIAL_NAME="__DEFAULT";var Nie=new ii,Lie=new de,Rie=new de,Die=new ii,Mie=new de,Bie=new de,tF=class extends hS{constructor(e=-1,t=1,i=1,r=-1,s=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=n,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=i-e,n=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,n=s+l*this.view.width,a-=h*this.view.offsetY,o=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,n,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},kie=new ii,Uie=new ii,Fie=new ii,Gie=new de,zie=new rl,Hie=new de,jie=new de,Yie=new de,Vie=new rl,qie=new de,Xie=new de,W1="\\[\\]\\.:\\/",iF=new RegExp("["+W1+"]","g"),J1="[^"+W1+"]",rF="[^"+W1.replace("\\.","")+"]",sF=/((?:WC+[\/:])*)/.source.replace("WC",J1),nF=/(WCOD+)?/.source.replace("WCOD",rF),aF=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",J1),oF=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",J1),lF=new RegExp("^"+sF+nF+aF+oF+"$"),hF=["material","materials","bones","map"],cF=class{constructor(e,t,i){let r=i||sr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},sr=class Pc{constructor(t,i,r){this.path=i,this.parsedPath=r||Pc.parseTrackName(i),this.node=Pc.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new Pc.Composite(t,i,r):new Pc(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(iF,"")}static parseTrackName(t){let i=lF.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){let n=r.nodeName.substring(s+1);hF.indexOf(n)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=n)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){let r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){let r=function(n){for(let a=0;a<n.length;a++){let o=n[a];if(o.name===i||o.uuid===i)return o;let l=r(o.children);if(l)return l}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){let r=this.resolvedProperty;for(let s=0,n=r.length;s!==n;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){let r=this.resolvedProperty;for(let s=0,n=r.length;s!==n;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){let r=this.resolvedProperty;for(let s=0,n=r.length;s!==n;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){let r=this.resolvedProperty;for(let s=0,n=r.length;s!==n;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node,i=this.parsedPath,r=i.objectName,s=i.propertyName,n=i.propertyIndex;if(t||(t=Pc.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let h=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let c=0;c<t.length;c++)if(t[c].name===h){h=c;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(h!==void 0){if(t[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[h]}}let a=t[s];if(a===void 0){let h=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+s+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?o=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(n!==void 0){if(s==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};sr.Composite=cF;sr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};sr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};sr.prototype.GetterByBindingType=[sr.prototype._getValue_direct,sr.prototype._getValue_array,sr.prototype._getValue_arrayElement,sr.prototype._getValue_toArray];sr.prototype.SetterByBindingTypeAndVersioning=[[sr.prototype._setValue_direct,sr.prototype._setValue_direct_setNeedsUpdate,sr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[sr.prototype._setValue_array,sr.prototype._setValue_array_setNeedsUpdate,sr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[sr.prototype._setValue_arrayElement,sr.prototype._setValue_arrayElement_setNeedsUpdate,sr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[sr.prototype._setValue_fromArray,sr.prototype._setValue_fromArray_setNeedsUpdate,sr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Wie=new Float32Array(1),Jie=new ii,Zie=new He,Kie=new de,$ie=new de,Qie=new de,ere=new de,tre=new ii,ire=new ii,rre=new de,sre=new cr,nre=new cr,are=new de,ore=new de,lre=new de,hre=new de,cre=new hS,ure=new sl,dre=new de;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"172"}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="172");var uF=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,dF=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,fF=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,pF=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_F=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,gF=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,OF=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,mF=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,yF=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,bF=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,xF=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,vF=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,EF=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,TF=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,wF=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,SF=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,IF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,PF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,AF=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,CF=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,NF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,LF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,RF=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,DF=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,MF=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,BF=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,kF=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,UF=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,FF=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,GF=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zF="gl_FragColor = linearToOutputTexel( gl_FragColor );",HF=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,jF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,VF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,XF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,WF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,JF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,ZF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,KF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,$F=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,QF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,eG=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,tG=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,iG=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rG=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,sG=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,nG=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,aG=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,oG=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lG=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,hG=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,cG=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,uG=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,dG=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,fG=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,pG=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,_G=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,gG=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,OG=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,mG=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yG=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,bG=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xG=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vG=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,EG=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,TG=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,wG=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,SG=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,IG=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,PG=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,AG=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,CG=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,NG=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,LG=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,RG=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,DG=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,MG=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,BG=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,kG=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,UG=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,FG=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,GG=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zG=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,HG=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,jG=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YG=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,VG=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,qG=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,XG=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,WG=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,JG=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ZG=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,KG=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,$G=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,QG=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ez=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,tz=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,iz=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,rz=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,sz=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,nz=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,az=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,oz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,lz=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,hz=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,cz=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,uz=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fz=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,_z=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gz=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Oz=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,mz=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,yz=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,bz=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xz=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vz=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ez=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Tz=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,wz=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sz=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Iz=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pz=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Az=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cz=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Nz=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Lz=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rz=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dz=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Mz=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Bz=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kz=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uz=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Fz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Gz=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zz=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Hz=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,jz=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,qt={alphahash_fragment:uF,alphahash_pars_fragment:dF,alphamap_fragment:fF,alphamap_pars_fragment:pF,alphatest_fragment:_F,alphatest_pars_fragment:gF,aomap_fragment:OF,aomap_pars_fragment:mF,batching_pars_vertex:yF,batching_vertex:bF,begin_vertex:xF,beginnormal_vertex:vF,bsdfs:EF,iridescence_fragment:TF,bumpmap_pars_fragment:wF,clipping_planes_fragment:SF,clipping_planes_pars_fragment:IF,clipping_planes_pars_vertex:PF,clipping_planes_vertex:AF,color_fragment:CF,color_pars_fragment:NF,color_pars_vertex:LF,color_vertex:RF,common:DF,cube_uv_reflection_fragment:MF,defaultnormal_vertex:BF,displacementmap_pars_vertex:kF,displacementmap_vertex:UF,emissivemap_fragment:FF,emissivemap_pars_fragment:GF,colorspace_fragment:zF,colorspace_pars_fragment:HF,envmap_fragment:jF,envmap_common_pars_fragment:YF,envmap_pars_fragment:VF,envmap_pars_vertex:qF,envmap_physical_pars_fragment:rG,envmap_vertex:XF,fog_vertex:WF,fog_pars_vertex:JF,fog_fragment:ZF,fog_pars_fragment:KF,gradientmap_pars_fragment:$F,lightmap_pars_fragment:QF,lights_lambert_fragment:eG,lights_lambert_pars_fragment:tG,lights_pars_begin:iG,lights_toon_fragment:sG,lights_toon_pars_fragment:nG,lights_phong_fragment:aG,lights_phong_pars_fragment:oG,lights_physical_fragment:lG,lights_physical_pars_fragment:hG,lights_fragment_begin:cG,lights_fragment_maps:uG,lights_fragment_end:dG,logdepthbuf_fragment:fG,logdepthbuf_pars_fragment:pG,logdepthbuf_pars_vertex:_G,logdepthbuf_vertex:gG,map_fragment:OG,map_pars_fragment:mG,map_particle_fragment:yG,map_particle_pars_fragment:bG,metalnessmap_fragment:xG,metalnessmap_pars_fragment:vG,morphinstance_vertex:EG,morphcolor_vertex:TG,morphnormal_vertex:wG,morphtarget_pars_vertex:SG,morphtarget_vertex:IG,normal_fragment_begin:PG,normal_fragment_maps:AG,normal_pars_fragment:CG,normal_pars_vertex:NG,normal_vertex:LG,normalmap_pars_fragment:RG,clearcoat_normal_fragment_begin:DG,clearcoat_normal_fragment_maps:MG,clearcoat_pars_fragment:BG,iridescence_pars_fragment:kG,opaque_fragment:UG,packing:FG,premultiplied_alpha_fragment:GG,project_vertex:zG,dithering_fragment:HG,dithering_pars_fragment:jG,roughnessmap_fragment:YG,roughnessmap_pars_fragment:VG,shadowmap_pars_fragment:qG,shadowmap_pars_vertex:XG,shadowmap_vertex:WG,shadowmask_pars_fragment:JG,skinbase_vertex:ZG,skinning_pars_vertex:KG,skinning_vertex:$G,skinnormal_vertex:QG,specularmap_fragment:ez,specularmap_pars_fragment:tz,tonemapping_fragment:iz,tonemapping_pars_fragment:rz,transmission_fragment:sz,transmission_pars_fragment:nz,uv_pars_fragment:az,uv_pars_vertex:oz,uv_vertex:lz,worldpos_vertex:hz,background_vert:cz,background_frag:uz,backgroundCube_vert:dz,backgroundCube_frag:fz,cube_vert:pz,cube_frag:_z,depth_vert:gz,depth_frag:Oz,distanceRGBA_vert:mz,distanceRGBA_frag:yz,equirect_vert:bz,equirect_frag:xz,linedashed_vert:vz,linedashed_frag:Ez,meshbasic_vert:Tz,meshbasic_frag:wz,meshlambert_vert:Sz,meshlambert_frag:Iz,meshmatcap_vert:Pz,meshmatcap_frag:Az,meshnormal_vert:Cz,meshnormal_frag:Nz,meshphong_vert:Lz,meshphong_frag:Rz,meshphysical_vert:Dz,meshphysical_frag:Mz,meshtoon_vert:Bz,meshtoon_frag:kz,points_vert:Uz,points_frag:Fz,shadow_vert:Gz,shadow_frag:zz,sprite_vert:Hz,sprite_frag:jz},We={common:{diffuse:{value:new cr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ft},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ft}},envmap:{envMap:{value:null},envMapRotation:{value:new Ft},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ft}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ft}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ft},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ft},normalScale:{value:new He(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ft},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ft}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ft}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ft}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new cr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new cr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0},uvTransform:{value:new Ft}},sprite:{diffuse:{value:new cr(16777215)},opacity:{value:1},center:{value:new He(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ft},alphaMap:{value:null},alphaMapTransform:{value:new Ft},alphaTest:{value:0}}},Y3={basic:{uniforms:Fs([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.fog]),vertexShader:qt.meshbasic_vert,fragmentShader:qt.meshbasic_frag},lambert:{uniforms:Fs([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.fog,We.lights,{emissive:{value:new cr(0)}}]),vertexShader:qt.meshlambert_vert,fragmentShader:qt.meshlambert_frag},phong:{uniforms:Fs([We.common,We.specularmap,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.fog,We.lights,{emissive:{value:new cr(0)},specular:{value:new cr(1118481)},shininess:{value:30}}]),vertexShader:qt.meshphong_vert,fragmentShader:qt.meshphong_frag},standard:{uniforms:Fs([We.common,We.envmap,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.roughnessmap,We.metalnessmap,We.fog,We.lights,{emissive:{value:new cr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qt.meshphysical_vert,fragmentShader:qt.meshphysical_frag},toon:{uniforms:Fs([We.common,We.aomap,We.lightmap,We.emissivemap,We.bumpmap,We.normalmap,We.displacementmap,We.gradientmap,We.fog,We.lights,{emissive:{value:new cr(0)}}]),vertexShader:qt.meshtoon_vert,fragmentShader:qt.meshtoon_frag},matcap:{uniforms:Fs([We.common,We.bumpmap,We.normalmap,We.displacementmap,We.fog,{matcap:{value:null}}]),vertexShader:qt.meshmatcap_vert,fragmentShader:qt.meshmatcap_frag},points:{uniforms:Fs([We.points,We.fog]),vertexShader:qt.points_vert,fragmentShader:qt.points_frag},dashed:{uniforms:Fs([We.common,We.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qt.linedashed_vert,fragmentShader:qt.linedashed_frag},depth:{uniforms:Fs([We.common,We.displacementmap]),vertexShader:qt.depth_vert,fragmentShader:qt.depth_frag},normal:{uniforms:Fs([We.common,We.bumpmap,We.normalmap,We.displacementmap,{opacity:{value:1}}]),vertexShader:qt.meshnormal_vert,fragmentShader:qt.meshnormal_frag},sprite:{uniforms:Fs([We.sprite,We.fog]),vertexShader:qt.sprite_vert,fragmentShader:qt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ft},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qt.background_vert,fragmentShader:qt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ft}},vertexShader:qt.backgroundCube_vert,fragmentShader:qt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qt.cube_vert,fragmentShader:qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qt.equirect_vert,fragmentShader:qt.equirect_frag},distanceRGBA:{uniforms:Fs([We.common,We.displacementmap,{referencePosition:{value:new de},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qt.distanceRGBA_vert,fragmentShader:qt.distanceRGBA_frag},shadow:{uniforms:Fs([We.lights,We.fog,{color:{value:new cr(0)},opacity:{value:1}}]),vertexShader:qt.shadow_vert,fragmentShader:qt.shadow_frag}};Y3.physical={uniforms:Fs([Y3.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ft},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ft},clearcoatNormalScale:{value:new He(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ft},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ft},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ft},sheen:{value:0},sheenColor:{value:new cr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ft},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ft},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ft},transmissionSamplerSize:{value:new He},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ft},attenuationDistance:{value:0},attenuationColor:{value:new cr(0)},specularColor:{value:new cr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ft},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ft},anisotropyVector:{value:new He},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ft}}]),vertexShader:qt.meshphysical_vert,fragmentShader:qt.meshphysical_frag};var fre=new Fd,pre=new ii,_re=new tF,gre=new cr,Kl=(1+Math.sqrt(5))/2,wc=1/Kl,Ore=[new de(-Kl,wc,0),new de(Kl,wc,0),new de(-wc,0,Kl),new de(wc,0,Kl),new de(0,Kl,-wc),new de(0,Kl,wc),new de(-1,1,-1),new de(1,1,-1),new de(-1,1,1),new de(1,1,1)],mre=new il,yre=new W9(1,1),bre=new E9,xre=new T9,vre=new j9,Ere=new Float32Array(16),Tre=new Float32Array(9),wre=new Float32Array(4),Sre=new Ft,Ire=new de,Pre={[o3]:l3,[h3]:d3,[c3]:f3,[dg]:u3,[l3]:o3,[d3]:h3,[f3]:c3,[u3]:dg},Are=new Fd,Cre=new ii;var zS=new ArrayBuffer(40),Rre=new Float64Array(zS),Dre=new Int32Array(zS);function Yz(e,t){let i=new Map;return e.forEach((r,s)=>{let n=t(r,s);n!==null&&i.set(s,n)}),i}var Vz=class w1{constructor(t,i){this.data=t,this.size=i}static async fromBlob(t){return new Promise((i,r)=>{let s=new Image,n=document.createElement("canvas"),a=n.getContext("2d",{willReadFrequently:!0});if(!a){r(new Error("Canvas 2D context not supported"));return}let o=URL.createObjectURL(t);s.src=o,s.onload=()=>{try{n.width=s.width,n.height=s.height,a.drawImage(s,0,0);let l=a.getImageData(0,0,n.width,n.height).data,h=new Float32Array(l.length);for(let c=0;c<l.length;c++)h[c]=l[c]/255;i(new w1(h,{width:n.width,height:n.height}))}catch(l){r(l)}finally{URL.revokeObjectURL(o)}},s.onerror=r})}binarize(){let t=this._calculateColorRatios(),{primary:i,secondary:r}=n(t),s=this._binarizationData(i,r);return new w1(s,this.size);function n(a){let o,l=-1,h,c=-1;for(let[f,d]of a.entries())d>l?(o=f,l=d):d>c&&(h=f,c=d);if(l<0||c<0)throw new Error("Insufficient color data for binarization");return{primary:o,secondary:h}}}_binarizationData(t,i){let{data:r}=this,s=new Float32Array(this.data.length);for(let a=0;a<r.length;a+=4){let o=ya.build(r[a],r[a+1],r[a+2],r[a+3]),l=n(o,t),h=n(o,i);s[a/4]=l>h?1:0}return s;function n(a,o){let l=a.r-o.r,h=a.g-o.g,c=a.b-o.b;return l*l+h*h+c*c}}_calculateColorRatios(){let{data:t,size:i}=this,r=new Map;for(let n=0;n<t.length;n+=4){let a=ya.build(t[n],t[n+1],t[n+2],t[n+3]),o=!1;for(let[l,h]of r.entries())if(l.equals(a)){o=!0,r.set(l,h+1);break}o||r.set(a,1)}let s=t.length/4;return Yz(r,n=>n/s)}};function qz(e){switch(e){case 1024:return{width:1024,height:1024};case 2048:return{width:2048,height:2048};case 4096:return{width:4096,height:4096};case 8192:return{width:8192,height:8192};case 16384:return{width:16384,height:16384};case 307200:return{width:640,height:480};case 921600:return{width:1280,height:720};case 2073600:return{width:1920,height:1080};case 3686400:return{width:2560,height:1440};case 21603840:return{width:3840,height:2160};case 33177600:return{width:7680,height:4320};case 134217728:return{width:16384,height:8192};case 8388608:return{width:4096,height:2048};default:throw new Error("Unsupported resolution")}}function Xz(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return 1;case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return 2;case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb10a2unorm":case"rg11b10ufloat":return 4;case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return 8;case"rgba32uint":case"rgba32sint":case"rgba32float":return 16;case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":case"bc4-r-unorm":case"bc4-r-snorm":return 8;case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":return 16;case"depth16unorm":return 2;case"depth24plus":case"depth24plus-stencil8":return 4;case"depth32float":return 4;default:throw new Error(`Unsupported texture format: ${e}`)}}var Wz=class HS{constructor(t,i=7,r=2048){if(this._gpu=t,this._maxUserTextures=i,this.cache={id:new Map,packID:new Map},this._currentTextureSlotIndex=0,this._isClosed=!1,this._textures=[],this._format="rgba32float",this._isClosed=!1,this._atlasTextureSize=this._calculateAtlasTextureSize(),i>this._gpu.limits.maxStorageTexturesPerShaderStage)throw new Error(`Exceeds GPU texture limit (max ${t.limits.maxStorageTexturesPerShaderStage})`);if(!HS.SUPPORTED_RESOLUTIONS.has(r))throw new Error("Mapping at this resolution is not currently supported!");this._singleTextureSize=qz(r),this._texturesPerRow=this._atlasTextureSize.width/this._singleTextureSize.width,this._textureCapacity=this._texturesPerRow*this._atlasTextureSize.height/this._singleTextureSize.height}create(t){for(let a=this._textures.length;a<this._maxUserTextures;a++)this._textures.push(this._gpu.createDynamicTexture(1,1,this._format,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,"mapping "));let i=this._textures.map((a,o)=>({binding:o,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}}));i.push({binding:this._maxUserTextures,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}});let r=this._gpu.device.createBindGroupLayout({entries:i}),s=this._textures.map((a,o)=>({binding:o,resource:a.texture.createView()}));s.push({binding:this._maxUserTextures,resource:{buffer:t}});let n=this._gpu.device.createBindGroup({label:"material",layout:r,entries:s});return this._isClosed=!0,{layout:r,bindGroup:n}}async register(t,i,r){if(this._isClosed)throw new Error("Texture registry is closed for new registrations");if(this.cache.id.has(i))return this.cache.id.get(i);this._currentTextureSlotIndex%this._textureCapacity===0&&this._textures.push(this._gpu.createDynamicTexture(this._atlasTextureSize.width,this._atlasTextureSize.height,this._format,GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,"mapping texture")),await this._writeTexture(t,r);let s=this._currentTextureSlotIndex-1;return this.cache.id.set(i,s),s}_calculateAtlasTextureSize(){let{maxTextureDimension2D:t,maxBufferSize:i}=this._gpu.limits,r=Xz(this._format);return{width:t,height:Math.min(t,2**Math.floor(Math.log2(i/r/t)))}}async _writeTexture(t,i){let r=await this._getTextureData(t,i);this._gpu.device.queue.writeTexture({texture:this._textures[this._textures.length-1].texture,origin:{x:this._currentTextureSlotIndex%this._texturesPerRow*this._singleTextureSize.width,y:Math.floor(this._currentTextureSlotIndex/this._texturesPerRow)*this._singleTextureSize.height}},r,{bytesPerRow:this._singleTextureSize.width*16},[this._singleTextureSize.width,this._singleTextureSize.height,1]),this._currentTextureSlotIndex++}async _getTextureData(t,i){let{data:r,size:s}=await Vz.fromBlob(i);if(this._singleTextureSize.width!==s.width||this._singleTextureSize.height!==s.height)throw new Error(`Invalid texture dimensions: expected ${this._singleTextureSize}, got ${s}`);switch(t){case 0:{let n=new Float32Array(r.length);for(let a=0;a<r.length;a+=4){let o=new Qt(r[a]-.5,r[a+1]-.5,r[a+2]-.5).normalize();n[a]=o.x,n[a+1]=o.z,n[a+2]=o.y}return n}case 1:{let n=new Float32Array(r.length);for(let a=0;a<r.length;a+=4)n[a]=r[a],n[a+1]=r[a+1],n[a+2]=r[a+2];return n}case 2:{let n=new Float32Array(r.length);for(let a=0;a<r.length;a+=4)n[a]=r[a],n[a+1]=r[a+1],n[a+2]=r[a+2];return n}case 3:{let n=new Float32Array(r.length);for(let a=0;a<r.length;a+=4)n[a]=r[a],n[a+1]=r[a+1],n[a+2]=r[a+2];return n}default:throw new Error}}};Wz.SUPPORTED_RESOLUTIONS=new Set([2048]);var Jz=class{static isPCB(e){return Math.abs(e.r-this.pcb.r)<.01&&Math.abs(e.g-this.pcb.g)<.01&&Math.abs(e.b-this.pcb.b)<.01}};Jz.pcb=ya.build(0,.15,.36);var Zz="@ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_a : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 1 ) var < storage , read > O_b : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 2 ) var < storage , read_write > O_c : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 3 ) var < uniform > O_d : f32 ; override Image_Width : u32 ; override Image_Height : u32 ; @ compute @ workgroup_size ( 32 , 32 ) fn main ( @ builtin ( global_invocation_id ) O_e : vec3 < u32 > , ) { if ( O_e . x >= Image_Width || O_e . y >= Image_Height ) { return ; } var O_f = O_e . x + O_e . y * u32 ( Image_Width ) ; O_a [ O_f ] = O_a [ O_f ] + O_b [ O_f ] ; O_c [ O_f ] = O_a [ O_f ] / O_d ; } ";Vn.addShaderCode(Zz);var Kz="struct O_a { O_b : vec3 < f32 > , O_c : vec3 < f32 > , O_d : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read > O_e : array < O_a > ; @ group ( 0 ) @ binding ( 1 ) var < storage , read_write > O_f : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 3 ) var < storage , read_write > O_g : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 2 ) var < storage , read_write > O_h : array < f32 > ; override Image_Width : u32 ; override Image_Height : u32 ; override Workgroup_Size_X : u32 ; override Workgroup_Size_Y : u32 ; @ compute @ workgroup_size ( Workgroup_Size_X , Workgroup_Size_Y ) fn main ( @ builtin ( global_invocation_id ) O_i : vec3 < u32 > , ) { if ( O_i . x >= Image_Width || O_i . y >= Image_Height ) { return ; } let O_j = O_i . x + O_i . y * u32 ( Image_Width ) ; O_f [ O_j ] = O_e [ O_j ] . O_b ; O_g [ O_j ] = O_e [ O_j ] . O_c ; O_h [ O_j ] = O_e [ O_j ] . O_d ; } ";Vn.addShaderCode(Kz);var $z="struct O_a { O_b : f32 , O_c : f32 , O_d : f32 , O_e : f32 , O_f : f32 , O_g : f32 , O_h : f32 , } struct O_i { O_j : f32 , O_k : f32 , O_l : f32 , O_m : f32 , O_n : f32 , } struct O_o { O_p : f32 , O_k : f32 , O_q : f32 , O_r : f32 , O_s : f32 , O_t : f32 , O_u : f32 , O_v : f32 , O_w : f32 , O_x : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_y : array < O_z > ; @ group ( 0 ) @ binding ( 1 ) var < uniform > O_aa : O_ab ; @ group ( 0 ) @ binding ( 2 ) var < uniform > O_ac : O_ad ; @ group ( 0 ) @ binding ( 3 ) var < uniform > O_ae : O_a ; @ group ( 0 ) @ binding ( 4 ) var < uniform > O_af : O_i ; @ group ( 0 ) @ binding ( 5 ) var < uniform > O_ag : O_o ; @ group ( 0 ) @ binding ( 6 ) var O_ah : texture_2d < f32 > ; @ group ( 0 ) @ binding ( 7 ) var < uniform > O_ai : O_aj ; @ group ( 1 ) @ binding ( 0 ) var O_ak : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 1 ) var O_al : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 2 ) var O_am : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 3 ) var O_an : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 4 ) var O_ao : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 5 ) var O_ap : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 6 ) var O_aq : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 7 ) var < storage , read > O_ar : array < O_as > ; @ group ( 2 ) @ binding ( 0 ) var < storage , read > O_at : array < O_au > ; @ group ( 2 ) @ binding ( 1 ) var < storage , read > O_av : array < f32 > ; @ group ( 2 ) @ binding ( 2 ) var < storage , read > O_aw : array < O_ax > ; @ group ( 2 ) @ binding ( 3 ) var < storage , read > O_ay : array < vec3 < f32 > > ; @ group ( 2 ) @ binding ( 4 ) var < storage , read > O_az : array < O_ba > ; @ group ( 2 ) @ binding ( 5 ) var < storage , read > O_bb : array < f32 > ; @ group ( 2 ) @ binding ( 6 ) var < storage , read_write > O_bc : array < f32 , 2 > ; @ group ( 2 ) @ binding ( 7 ) var < uniform > O_bd : O_be ; @ group ( 2 ) @ binding ( 8 ) var < uniform > O_bf : vec2 < f32 > ; @ group ( 3 ) @ binding ( 0 ) var O_bg : texture_2d < f32 > ; override Hide_Occluder : bool ; override Image_Width : u32 ; override Image_Height : u32 ; override WORKGROUP_X : u32 ; override WORKGROUP_Y : u32 ; const O_bh : f32 = 3.14159265359 ; const O_bi : f32 = 2.718281828459045 ; const O_bj : f32 = O_bh * 2.0 ; const O_bk : u32 = 10 ; const O_bl : bool = true ; const O_bm : f32 = 1.4426950408889634 ; const O_bn : bool = true ; const O_bo : u32 = 0 ; const O_bp : u32 = 1 ; const O_bq : u32 = 2 ; const O_br : u32 = 3 ; const O_bs : u32 = 0 ; const O_bt : u32 = 1 ; const O_bu : u32 = 2 ; const O_bv : u32 = 3 ; const O_bw : u32 = 4 ; const O_bx : u32 = 5 ; const O_by : u32 = 6 ; const O_bz : u32 = 7 ; const O_ca : u32 = 8 ; const O_cb : u32 = 9 ; const O_cc : u32 = 10 ; const O_cd : u32 = 11 ; const O_ce : u32 = 12 ; const O_cf : u32 = 13 ; const O_cg : u32 = 14 ; const O_ch : u32 = 15 ; const O_ci : u32 = 16 ; const O_cj : u32 = 17 ; const O_ck : u32 = 18 ; const O_cl : u32 = 19 ; const O_cm : u32 = 20 ; const O_cn : u32 = 20 ; const O_co = 30 ; const O_cp : i32 = 1 ; const O_cq : i32 = 2 ; const O_cr : i32 = 3 ; const O_cs : i32 = 4 ; const O_ct : i32 = 5 ; var < private > O_cu : vec2 < u32 > ; var < private > O_cv : u32 ; var < private > O_cw : f32 ; var < private > O_cx : bool = false ; var < private > O_cy : u32 = 0 ; fn O_cz ( O_da : vec3 < u32 > , ) { O_db ( O_da ) ; O_dc ( ) ; } fn O_db ( O_da : vec3 < u32 > , ) { O_cu . x = O_da . x + u32 ( O_aa . O_dd ) ; O_cu . y = O_da . y + u32 ( O_aa . O_de ) ; O_cv = O_cu . x + O_cu . y * Image_Width ; } @ compute @ workgroup_size ( WORKGROUP_X , WORKGROUP_Y ) fn main ( @ builtin ( global_invocation_id ) O_da : vec3 < u32 > , ) { O_cz ( O_da ) ; if ( O_cu . x >= Image_Width || O_cu . y >= Image_Height ) { return ; } let O_df = O_dg ( ) ; let O_dh = O_di ( O_df ) ; let O_dj = O_dh . O_dj ; O_dk ( O_dj ) ; O_dl ( O_dh ) ; } @ compute @ workgroup_size ( 1 , 1 ) fn main_hit ( @ builtin ( global_invocation_id ) O_da : vec3 < u32 > , ) { O_cz ( O_da ) ; if ( O_cu . x >= Image_Width || O_cu . y >= Image_Height ) { return ; } let O_df = O_au ( O_ac . O_dm , normalize ( O_ac . O_dn ) ) ; let O_do = O_dp ( O_df , true ) ; O_bc [ 0 ] = f32 ( O_do . O_dq ) ; O_bc [ 1 ] = O_do . O_dr ; } @ compute @ workgroup_size ( 32 , 32 ) fn main_color ( @ builtin ( global_invocation_id ) O_da : vec3 < u32 > , ) { O_cz ( O_da ) ; if ( O_cu . x >= Image_Width || O_cu . y >= Image_Height ) { return ; } let O_df = O_dg ( ) ; var O_dh = O_ds ( O_df , true ) ; var O_dj : vec3 < f32 > ; if ( O_dh . O_dt != O_du ) { O_dj = O_dh . O_dv ; } else { O_dj = O_dh . O_dj ; } O_dk ( O_dj ) ; } @ compute @ workgroup_size ( 32 , 32 ) fn main_depth ( @ builtin ( global_invocation_id ) O_da : vec3 < u32 > , ) { O_cz ( O_da ) ; if ( O_cu . x >= Image_Width || O_cu . y >= Image_Height ) { return ; } let O_df = O_dg ( ) ; var O_dh = O_ds ( O_df , true ) ; O_dl ( O_dh ) ; } const O_du : u32 = 0 ; const O_dw : u32 = 1 ; const O_dx : u32 = 2 ; const O_dy : u32 = 3 ; struct O_dz { O_dt : u32 , O_ea : f32 , O_eb : f32 , O_ec : f32 , O_ed : f32 , O_ee : f32 , O_ef : f32 , O_eg : vec3 < f32 > , O_dv : vec3 < f32 > , O_eh : vec3 < f32 > , O_ei : vec3 < f32 > , O_dm : vec3 < f32 > , O_dj : vec3 < f32 > , O_ej : f32 , } fn O_ek ( ) -> O_dz { let O_el = vec3 < f32 > ( 0 ) ; return O_dz ( 0 , 0 , 0 , 0 , 0 , 0 , 0 , O_el , O_el , O_el , O_el , O_el , O_el , 0 ) ; } fn O_ds ( O_df : O_au , O_em : bool , ) -> O_dz { var O_dh = O_ek ( ) ; let O_en = O_dp ( O_df , O_em ) ; if ( O_en . O_dr < 0.0 ) { O_dh . O_dt = O_du ; O_dh . O_dj = O_eo ( O_df ) ; return O_dh ; } O_dh . O_dm = O_ep ( O_df , O_en . O_dr ) ; O_dh . O_eh = normalize ( O_en . O_ei ) ; if ( O_en . O_eq == O_ct ) { O_dh . O_dt = O_dw ; O_dh . O_dj = O_er ( ) ; return O_dh ; } let O_dq = O_ar [ O_en . O_dq ] ; O_dh . O_ed = O_dq . O_ed ; O_dh . O_ee = O_dq . O_ee ; O_dh . O_ef = O_dq . O_ef ; O_dh . O_eg = O_dq . O_eg ; if ( O_dq . O_es > 0.0 ) { let O_ei = O_et ( O_dh . O_dm , O_dh . O_eh , O_dq . O_es , O_dq . O_eu ) ; if ( O_ev ( O_df . O_ew , O_ei ) ) { O_dh . O_dt = O_dx ; return O_dh ; } O_dh . O_ei = O_ei ; } else { O_dh . O_ei = O_dh . O_eh ; } if ( O_dq . O_ex > 0.0 ) { O_dh . O_ea = O_ey ( O_dh . O_dm , O_dh . O_eh , O_dq . O_ex , O_dq . O_ez ) . x ; } else { O_dh . O_ea = O_dq . O_ea ; } if ( O_dq . O_fa > 0.0 ) { O_dh . O_dv = O_ey ( O_dh . O_dm , O_dh . O_eh , O_dq . O_fa , O_dq . O_fb ) ; } else { O_dh . O_dv = O_dq . O_dv ; } if ( O_dq . O_fc > 0.0 ) { O_dh . O_ec = O_ey ( O_dh . O_dm , O_dh . O_eh , O_dq . O_fc , O_dq . O_fd ) . x ; } else { O_dh . O_ec = O_dq . O_ec ; } O_dh . O_ej = O_fe ( O_dh . O_ei , - O_df . O_ew ) ; O_dh . O_dt = O_dy ; return O_dh ; } fn O_ff ( O_dm : vec3 < f32 > , O_ei : vec3 < f32 > , O_fg : f32 , O_fh : f32 , ) -> f32 { let O_fi = O_ey ( O_dm , O_ei , O_fg , O_fh ) ; let O_ec = ( O_fi . x / 255.0 ) - 0.5 ; return O_ec ; } fn O_fj ( O_dm : vec3 < f32 > , O_ei : vec3 < f32 > , O_fg : f32 , O_fh : f32 , ) -> vec3 < f32 > { let O_fi = O_ey ( O_dm , O_ei , O_fg , O_fh ) ; return O_fi / 255.0 ; } fn O_fk ( O_dm : vec3 < f32 > , O_ei : vec3 < f32 > , O_fg : f32 , O_fh : f32 , ) -> f32 { let O_fi = O_ey ( O_dm , O_ei , O_fg , O_fh ) ; let O_ec = O_fi . x / 255.0 ; return O_ec * O_ec * O_ec ; } fn O_et ( O_dm : vec3 < f32 > , O_ei : vec3 < f32 > , O_fg : f32 , O_fh : f32 , ) -> vec3 < f32 > { let O_fi = O_ey ( O_dm , O_ei , O_fg , O_fh ) ; let O_fl = normalize ( O_fi ) ; let O_fm = normalize ( cross ( O_ei , vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ) ) ; let O_fn = normalize ( cross ( O_ei , O_fm ) ) ; let O_fo = mat3x3 < f32 > ( O_fm , O_ei , O_fn ) ; let O_fp = normalize ( O_fo * O_fl ) ; return O_fp ; } fn O_ey ( O_dm : vec3 < f32 > , O_ei : vec3 < f32 > , O_fg : f32 , O_fh : f32 , ) -> vec3f { let O_fq = vec2 < i32 > ( i32 ( ( O_fg % 8.0 ) * 2048 ) , i32 ( floor ( O_fg / 8.0 ) ) * 2048 ) ; var O_fr = vec2 < i32 > ( O_fs ( O_dm . x , O_fh ) , O_fs ( O_dm . y , O_fh ) ) + O_fq ; var O_ft = vec2 < i32 > ( O_fs ( O_dm . x , O_fh ) , O_fs ( O_dm . z , O_fh ) ) + O_fq ; var O_fu = vec2 < i32 > ( O_fs ( O_dm . y , O_fh ) , O_fs ( O_dm . z , O_fh ) ) + O_fq ; var O_fv : vec3 < f32 > ; var O_fw : vec3 < f32 > ; var O_fx : vec3 < f32 > ; let O_fy = u32 ( floor ( O_fg / 32.0 ) ) ; if ( O_fy == 0 ) { O_fv = textureLoad ( O_ak , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_ak , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_ak , O_fu , 0 ) . rgb ; } else if ( O_fy == 1 ) { O_fv = textureLoad ( O_al , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_al , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_al , O_fu , 0 ) . rgb ; } else if ( O_fy == 2 ) { O_fv = textureLoad ( O_am , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_am , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_am , O_fu , 0 ) . rgb ; } else if ( O_fy == 3 ) { O_fv = textureLoad ( O_an , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_an , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_an , O_fu , 0 ) . rgb ; } else if ( O_fy == 4 ) { O_fv = textureLoad ( O_ao , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_ao , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_ao , O_fu , 0 ) . rgb ; } else if ( O_fy == 5 ) { O_fv = textureLoad ( O_ap , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_ap , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_ap , O_fu , 0 ) . rgb ; } else if ( O_fy == 6 ) { O_fv = textureLoad ( O_aq , O_fr , 0 ) . rgb ; O_fw = textureLoad ( O_aq , O_ft , 0 ) . rgb ; O_fx = textureLoad ( O_aq , O_fu , 0 ) . rgb ; } var O_fz = abs ( O_ei ) ; O_fz = O_fz / ( O_fz . x + O_fz . y + O_fz . z ) ; let O_ga = O_fv * O_fz . z + O_fw * O_fz . y + O_fx * O_fz . x ; return O_ga ; } fn O_fs ( O_gb : f32 , step : f32 , ) -> i32 { var O_gc = O_gb % step ; if ( O_gc < 0.0 ) { O_gc += step ; } return i32 ( 2048.0 * ( O_gc / step ) ) ; } fn O_gd ( ) -> O_ge { return O_gf ( ) ; } fn O_gf ( ) -> O_ge { var O_gg = O_ai ; return O_ge ( O_gg . O_dm + O_gh ( ) * O_gg . O_gi + O_gh ( ) * O_gg . O_el , O_gg . O_dj * O_gg . O_gj ) ; } fn O_gk ( O_df : O_au , ) -> bool { var O_gg = O_ai ; let O_gl = O_gg . O_dm + O_gg . O_gi + O_gg . O_el ; let O_gm = O_gg . O_dm + O_gg . O_gi - O_gg . O_el ; let O_gn = O_gg . O_dm - O_gg . O_gi + O_gg . O_el ; let O_go = O_gg . O_dm - O_gg . O_gi - O_gg . O_el ; return O_gp ( O_df , O_gl , O_gm , O_gn , O_go ) ; } fn O_er ( ) -> vec3 < f32 > { return O_ai . O_dj * O_ai . O_gj ; } fn O_gq ( O_gr : vec3 < f32 > , ) -> vec3 < f32 > { var O_dj : vec3 < f32 > = O_gr ; if ( O_dj . x > 1.0 ) { O_dj . x = 1.0 ; } if ( O_dj . y > 1.0 ) { O_dj . y = 1.0 ; } if O_dj . z > 1.0 { O_dj . z = 1.0 ; } if ( O_dj . x < 0.0 ) { O_dj . x = 0.0 ; } if ( O_dj . y < 0.0 ) { O_dj . y = 0.0 ; } if ( O_dj . z < 0.0 ) { O_dj . z = 0.0 ; } return O_dj ; } fn O_dg ( ) -> O_au { O_gh ( ) ; O_gh ( ) ; return O_at [ O_cv ] ; } fn O_gs ( O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , O_gw : vec3 < f32 > , ) -> vec3 < f32 > { let O_gx = O_gv - O_gu ; let O_gy = O_gw - O_gu ; let O_gz = O_gt - O_gu ; let O_ha = dot ( O_gx , O_gx ) ; let O_hb = dot ( O_gx , O_gy ) ; let O_hc = dot ( O_gy , O_gy ) ; let O_hd = dot ( O_gz , O_gx ) ; let O_he = dot ( O_gz , O_gy ) ; let O_hf = O_ha * O_hc - O_hb * O_hb ; let O_el = ( O_hc * O_hd - O_hb * O_he ) / O_hf ; let O_hg = ( O_ha * O_he - O_hb * O_hd ) / O_hf ; let O_gi = 1.0 - O_el - O_hg ; return vec3 < f32 > ( O_gi , O_el , O_hg ) ; } fn O_hh ( O_hi : O_hj , O_ei : array < vec3 < f32 > , 3 > , O_hk : vec3 < f32 > , ) -> vec3 < f32 > { let O_hl = O_gs ( O_hk , O_hi . O_gx , O_hi . O_gy , O_hi . O_gz ) ; return normalize ( O_hl . x * O_ei [ 0 ] + O_hl . y * O_ei [ 1 ] + O_hl . z * O_ei [ 2 ] ) ; } fn O_dk ( O_dj : vec3 < f32 > , ) { if ( O_cx ) { return ; } O_y [ O_cv ] . O_dt = O_dj ; O_cx = true ; } fn O_dl ( O_dh : O_dz , ) { if ( O_dh . O_dt != O_du ) { O_y [ O_cv ] . O_hm = length ( O_dh . O_dm - O_at [ O_cv ] . O_hn ) ; } else { O_y [ O_cv ] . O_hm = - 1 ; } } fn O_ho ( O_hp : vec3 < f32 > , ) { var O_ei = normalize ( O_hp ) ; O_ei = O_ei + vec3 < f32 > ( 1.0 ) ; O_ei = O_ei * 0.5 ; O_dk ( O_ei ) ; } fn O_hq ( ) { O_dk ( vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ) ; } fn O_hr ( ) { O_dk ( vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ) ; } fn O_hs ( O_gb : u32 , O_ht : u32 , ) { let O_hu = f32 ( O_gb ) / f32 ( O_ht ) ; O_dk ( vec3 < f32 > ( O_hu , O_hu , O_hu ) ) ; } fn O_hv ( O_dj : u32 , ) { let O_hw = 1.0 / f32 ( O_dj + 1 ) ; O_dk ( vec3 < f32 > ( O_hw , O_hw , O_hw ) ) ; } fn O_hx ( O_dj : vec3 < f32 > , ) -> bool { return O_dj . x > 0.0 && O_dj . y > 0.0 && O_dj . z > 0.0 ; } fn O_hy ( O_gr : vec3 < f32 > , ) -> vec3 < f32 > { var O_dj : vec3 < f32 > = O_gr ; let O_hz : f32 = 1.0 / 2.2 ; O_dj . x = pow ( O_dj . x , O_hz ) ; O_dj . y = pow ( O_dj . y , O_hz ) ; O_dj . z = pow ( O_dj . z , O_hz ) ; return O_dj ; } fn O_dc ( ) { let O_ia = O_aa . O_cw ; O_cw = O_ia * ( f32 ( O_cv ) / f32 ( Image_Width * Image_Height ) ) ; O_cw = O_ib ( O_cw ) ; } fn O_gh ( ) -> f32 { let O_ic = O_id ( O_cw ) ; O_cw = O_ic ; return O_ic ; } fn O_ie ( O_ia : f32 , ) -> f32 { var O_if = u32 ( O_ia * 1e6 ) ; O_if ^= O_if << 13 ; O_if ^= O_if >> 17 ; O_if ^= O_if << 5 ; return f32 ( O_if ) * 2.3283064e-10 ; } fn O_ig ( O_ia : f32 , ) -> f32 { var O_gx = u32 ( O_ia * 1e6 ) ; var O_gy = u32 ( O_ia * 1e6 + 1.0 ) ; var O_ih = 0u ; for ( var O_ii = 0u ; O_ii < 4u ; O_ii ++ ) { O_ih += 0x9e3779b9u ; O_gx += ( ( O_gy << 4u ) + 0xa341316cu ) ^ ( O_gy + O_ih ) ^ ( ( O_gy >> 5u ) + 0xc8013ea4u ) ; O_gy += ( ( O_gx << 4u ) + 0xad90777du ) ^ ( O_gx + O_ih ) ^ ( ( O_gx >> 5u ) + 0x7e95761eu ) ; } return f32 ( O_gx ^ O_gy ) / 4294967296.0 ; } fn O_ij ( O_ia : f32 , ) -> f32 { var O_if = u32 ( O_ia * 1e6 ) ; O_if = O_if * 0x53a2f814u + 0x74736975u ; O_if = ( O_if ^ ( O_if >> 16 ) ) * 0x7feb352du ; O_if = ( O_if ^ ( O_if >> 15 ) ) * 0x846ca68bu ; return f32 ( O_if ^ ( O_if >> 16 ) ) / 4294967296.0 ; } fn O_id ( O_ia : f32 , ) -> f32 { let O_gu : f32 = 1664525.0 ; let O_gw : f32 = 1013904223.0 ; let O_ik : f32 = 4294967296.0 ; return fract ( ( O_gu * O_ia * 100000.0 + O_gw ) / O_ik ) ; } fn O_il ( O_ia : f32 , ) -> f32 { var O_if = u32 ( O_ia * 1e6 ) ; O_if = O_if * 747796405u + 2891336453u ; let O_im = ( ( O_if >> ( ( O_if >> 28u ) + 4u ) ) ^ O_if ) * 277803737u ; return f32 ( ( O_im >> 22u ) ^ O_im ) / 4294967296.0 ; } fn O_ib ( O_ia : f32 , ) -> f32 { return fract ( sin ( O_ia * 43758.5453 ) * 12345.6789 ) ; } fn O_in ( ) -> f32 { return 2.0 * O_gh ( ) - 1.0 ; } fn O_io ( ) -> f32 { return O_in ( ) * O_bh ; } fn O_ip ( min : f32 , max : f32 , ) -> f32 { return min + ( max - min ) * O_gh ( ) ; } fn O_iq ( ) -> vec3 < f32 > { while ( true ) { let O_ir = normalize ( vec3 < f32 > ( O_is ( ) , O_is ( ) , O_is ( ) ) ) ; if ( length ( O_ir ) != 0 ) { return O_ir ; } } return vec3 < f32 > ( 0 ) ; } fn O_is ( ) -> f32 { return sqrt ( - 2 * log ( O_gh ( ) ) ) * cos ( 2 * O_bh * O_gh ( ) ) ; } const O_it = 0 ; const O_iu = 1 ; const O_iv = 2 ; const O_iw = true ; fn O_ix ( O_dh : O_dz , ) -> u32 { if ( O_gh ( ) < O_dh . O_ed && O_gh ( ) < O_iy ( O_dh . O_ej , O_dh . O_ef ) ) { return O_iv ; } if ( O_gh ( ) < O_dh . O_ea ) { return O_iu ; } else { return O_it ; } } fn O_di ( O_iz : O_au , ) -> O_dz { var O_ja = O_ds ( O_iz , true ) ; if ( O_ja . O_dt != O_dy ) { return O_ja ; } var O_jb = O_iz . O_ew ; if ( O_iw ) { O_ja . O_dj = O_jc ( O_ja , O_jb ) ; } let O_jd = i32 ( O_aa . O_jd ) ; var O_je = vec3f ( 1 ) ; var O_dh = O_ja ; for ( var O_ii = 0 ; O_ii < O_jd ; O_ii += 1 ) { let O_jf : u32 = O_ix ( O_dh ) ; if ( O_jf == O_it ) { O_jb = O_iq ( ) ; if ( ! O_ev ( O_dh . O_ei , O_jb ) ) { O_jb = - O_jb ; } O_je *= O_jg ( O_dh . O_dv , O_dh . O_ei , O_jb ) ; } else { var O_ei = O_jh ( O_dh . O_ei , select ( 0.000001 , O_dh . O_ec , O_jf == O_iu ) ) ; if ( O_ev ( O_ei , O_jb ) ) { break ; } O_jb = O_ji ( O_jb , O_ei ) ; if ( ! O_ev ( O_dh . O_ei , O_jb ) ) { break ; } if ( O_jf == O_iu ) { O_je *= O_jj ( O_dh . O_ej , O_dh . O_dv ) ; } } if ( ! O_ev ( O_dh . O_eh , O_jb ) ) { break ; } O_dh = O_ds ( O_au ( O_dh . O_dm + 0.001 * O_jb , O_jb ) , ! O_iw ) ; if ( O_dh . O_dt != O_dy ) { O_ja . O_dj += O_dh . O_dj * O_je ; return O_ja ; } if ( O_iw ) { O_ja . O_dj += O_jc ( O_dh , O_jb ) * O_je ; } } return O_ja ; } fn O_jc ( O_dh : O_dz , O_jb : vec3f , ) -> vec3 < f32 > { let O_gg = O_gd ( ) ; let O_jk = normalize ( O_gg . O_dm - O_dh . O_dm ) ; if ( ! O_ev ( O_jk , O_dh . O_ei ) || ! O_jl ( O_au ( O_dh . O_dm + O_jk * 0.001 , O_jk ) ) ) { return vec3f ( 0 ) ; } var O_dj : vec3 < f32 > ; let O_jm = normalize ( O_gg . O_dm - O_dh . O_dm ) ; let O_el = - O_jb ; let O_jn = normalize ( O_jm + O_el ) ; let O_jo = max ( dot ( O_dh . O_ei , O_jn ) , 0.0 ) ; let O_jp = O_jq ( O_dh . O_ee * O_dh . O_ee , O_jo ) ; let O_jr = O_dh . O_ed * O_iy ( O_dh . O_ej , O_dh . O_ef ) ; O_dj = O_dj + O_jj ( O_dh . O_ej , O_dh . O_eg ) * O_gg . O_dj * O_jp * O_jr ; let O_js = O_jq ( O_dh . O_ec * O_dh . O_ec , O_jo ) ; let O_jt = ( 1.0 - O_jr ) * O_dh . O_ea ; O_dj = O_dj + O_jj ( O_dh . O_ej , O_dh . O_dv ) * O_gg . O_dj * O_js * O_jt ; let O_ju = ( 1.0 - O_jr ) * ( 1 - O_dh . O_ea ) ; if ( O_aa . O_jv == 0.0 ) { O_dj = O_dj + O_jg ( O_dh . O_dv , O_dh . O_ei , O_jk ) * O_gg . O_dj * O_ju ; } else { O_dj = O_dj + O_jw ( O_dh . O_dv , O_dh . O_ec , O_dh . O_ei , O_el , O_jm , O_jn ) * O_gg . O_dj * O_ju ; } return O_dj ; } fn O_jw ( O_dj : vec3 < f32 > , O_ec : f32 , O_jx : vec3 < f32 > , O_el : vec3 < f32 > , O_jm : vec3 < f32 > , O_jn : vec3 < f32 > , ) -> vec3 < f32 > { let O_jy = dot ( O_jn , O_jm ) ; let O_jz = 0.5 + 2.0 * O_ec * O_jy * O_jy ; let O_do = ( O_dj / O_bh ) * ( 1.0 + ( O_jz - 1.0 ) * pow ( 1.0 - dot ( O_jx , O_el ) , 5.0 ) ) * ( 1.0 + ( O_jz - 1.0 ) * pow ( 1.0 - dot ( O_jx , O_jm ) , 5.0 ) ) ; return O_do ; } fn O_jg ( O_dv : vec3 < f32 > , O_ei : vec3 < f32 > , O_jk : vec3 < f32 > , ) -> vec3 < f32 > { return O_dv * dot ( O_jk , O_ei ) ; } fn O_jj ( O_ka : f32 , O_kb : vec3 < f32 > , ) -> vec3 < f32 > { return O_kb + ( vec3 < f32 > ( 1.0 ) - O_kb ) * pow ( 1.0 - O_ka , 5.0 ) ; } fn O_iy ( O_ka : f32 , O_kb : f32 , ) -> f32 { return O_kb + ( 1.0 - O_kb ) * pow ( 1.0 - O_ka , 5.0 ) ; } fn O_jh ( O_jx : vec3 < f32 > , O_ec : f32 , ) -> vec3 < f32 > { var O_jo : f32 = O_kc ( O_ec ) ; return O_kd ( O_jx , O_jo ) ; } fn O_jq ( O_ke : f32 , O_jo : f32 , ) -> f32 { let O_kf : f32 = ( O_jo * O_ke - O_jo ) * O_jo + 1.0 ; return O_ke / ( O_bh * O_kf * O_kf ) ; } fn O_kc ( O_kg : f32 , ) -> f32 { if ( O_kg > 0.99999 ) { return O_gh ( ) ; } if ( O_kg < 0.00001 ) { return 1.0 ; } let O_kh = O_kg * O_kg ; let O_ki = O_ip ( O_kh , 1.0 ) ; return sqrt ( ( 1.0 - sqrt ( O_kh / O_ki ) ) / ( 1.0 - O_kg ) ) ; } fn O_kd ( O_kj : vec3 < f32 > , O_jo : f32 , ) -> vec3 < f32 > { let O_jx = normalize ( O_kj ) ; if ( O_jo == 1.0 ) { return O_jx ; } var O_el : vec3 < f32 > ; if abs ( O_jx . x ) < 0.9 { O_el = cross ( O_jx , vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ) ; } else { O_el = cross ( O_jx , vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ) ; } O_el = normalize ( O_el ) ; let O_gi = cross ( O_jx , O_el ) ; let O_kk = O_io ( ) ; let O_kg = O_jo * O_jx + sqrt ( 1.0 - O_jo * O_jo ) * ( cos ( O_kk ) * O_el + sin ( O_kk ) * O_gi ) ; return normalize ( O_kg ) ; } struct O_kl { O_eq : i32 , O_dr : f32 , O_ei : vec3 < f32 > , O_dq : u32 , } fn O_dp ( O_df : O_au , O_em : bool , ) -> O_kl { var O_km : O_kn = O_ko ( ) ; var O_eq : i32 = - 1 ; let O_kp = O_kq ( O_df ) ; if O_kp . O_dr > 0.0 && ( O_km . O_dr < 0.0 || O_kp . O_dr < O_km . O_dr ) { O_km = O_kp ; O_eq = O_cr ; } let O_kr = O_ks ( O_df ) ; if O_kr . O_dr > 0.0 && ( O_km . O_dr < 0.0 || O_kr . O_dr < O_km . O_dr ) { O_km = O_kr ; O_eq = O_cs ; } let O_kt = O_ku ( O_df ) ; if O_kt . O_dr > 0.0 && ( O_km . O_dr < 0.0 || O_kt . O_dr < O_km . O_dr ) { O_km = O_kt ; O_eq = O_cp ; } if ( ! Hide_Occluder ) { let O_kv = O_kw ( O_df ) ; if O_kv . O_dr > 0.0 && ( O_km . O_dr < 0.0 || O_kv . O_dr < O_km . O_dr ) { O_km = O_kv ; O_eq = O_cq ; } } if ( O_em ) { let O_kx = O_ky ( O_df ) ; if O_kx . O_dr > 0.0 && ( O_km . O_dr < 0.0 || O_kx . O_dr < O_km . O_dr ) { O_km = O_kx ; O_eq = O_ct ; } } return O_kl ( O_eq , O_km . O_dr , O_km . O_ei , O_km . O_dq ) ; } fn O_jl ( O_df : O_au , ) -> bool { let O_do = O_dp ( O_df , true ) ; return ( O_do . O_eq == O_ct || O_do . O_dr < 0.0 ) ; } fn O_ku ( O_df : O_au , ) -> O_kn { let O_do = O_kz ( O_df ) ; if ( O_do . O_dr < 0 ) { return O_ko ( ) ; } var O_dq : u32 ; if ( O_la ( O_do . O_lb ) ) { O_dq = u32 ( O_ag . O_k ) ; } else { O_dq = u32 ( O_ag . O_p ) ; } return O_kn ( O_do . O_dr , vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) , O_dq ) ; } fn O_la ( O_lb : vec2f , ) -> bool { { let O_lc = O_ag . O_q / 2.0 ; let O_ld = O_ag . O_r / 2.0 ; let O_le = vec2f ( O_lc - O_ag . O_t , - O_ld + O_ag . O_t ) ; let O_lf = O_lg ( O_le . x - O_ag . O_w , O_le . x , O_le . y , O_le . y + O_ag . O_x ) ; if ( O_lh ( O_lf , O_lb ) ) { let O_li = O_lf . O_lj - O_lf . O_lk ; let O_ll = O_lf . O_lm - O_lf . O_ln ; let O_lo = vec2f ( ( O_lb . x - O_lf . O_lk ) / O_li , ( O_lb . y - O_lf . O_ln ) / O_ll ) ; let O_lp = vec2 < i32 > ( O_lo * vec2 < f32 > ( textureDimensions ( O_bg ) ) ) ; var O_dj = textureLoad ( O_bg , O_lp , 0 ) ; return O_dj . x < 0.5 ; } } { let O_lc = O_ag . O_q / 2.0 ; let O_ld = O_ag . O_r / 2.0 ; var O_lq = O_lg ( - O_lc , O_lc , - O_ld , O_ld ) ; O_lq = O_lr ( O_lq , O_ag . O_t ) ; if ( ! O_lh ( O_lq , O_lb ) ) { return false ; } } { let O_ls = O_ag . O_v ; var O_lt : f32 ; if ( O_lb . x < 0 ) { O_lt = ( O_lb . x - ( O_lb . x % O_ls ) ) - O_ls ; } else { O_lt = ( O_lb . x - ( O_lb . x % O_ls ) ) ; } var O_lu : f32 ; if ( O_lb . y < 0 ) { O_lu = ( O_lb . y - ( O_lb . y % O_ls ) ) - O_ls ; } else { O_lu = ( O_lb . y - ( O_lb . y % O_ls ) ) ; } var O_lf = O_lg ( O_lt , O_lt + O_ls , O_lu , O_lu + O_ls ) ; O_lf = O_lr ( O_lf , O_ag . O_u / 2.0 ) ; if ( ! O_lh ( O_lf , O_lb ) ) { return true ; } } return false ; } struct O_lv { O_dr : f32 , O_lb : vec2f , } fn O_kz ( O_df : O_au , ) -> O_lv { let O_lw = O_lx ( O_df , O_ly ( ) ) ; let O_dr = O_lw . O_dr ; let O_lz = O_lw . O_lb . xz ; if ( O_dr < 0 || O_ma ( O_lz ) ) { return O_lv ( - 1 , vec2f ( 0 ) ) ; } else { return O_lv ( O_dr , O_lz ) ; } } fn O_ma ( O_lz : vec2 < f32 > , ) -> bool { let O_mb = vec2 < f32 > ( - O_ag . O_q / 2.0 , O_ag . O_r / 2.0 ) ; if ( O_lz . x > O_mb . x + O_ag . O_s && O_lz . x < O_mb . x + O_ag . O_q - O_ag . O_s ) { if ( O_lz . y > O_mb . y - O_ag . O_r && O_lz . y < O_mb . y ) { return false ; } } if ( O_lz . x > O_mb . x && O_lz . x < O_mb . x + O_ag . O_q ) { if ( O_lz . y > O_mb . y - O_ag . O_r + O_ag . O_s && O_lz . y < O_mb . y - O_ag . O_s ) { return false ; } } if ( length ( O_lz - ( O_mb + vec2f ( O_ag . O_s , - O_ag . O_s ) ) ) < O_ag . O_s ) { return false ; } if ( length ( O_lz - ( O_mb + vec2f ( O_ag . O_q - O_ag . O_s , - O_ag . O_s ) ) ) < O_ag . O_s ) { return false ; } if ( length ( O_lz - ( O_mb + vec2f ( O_ag . O_s , O_ag . O_s - O_ag . O_r ) ) ) < O_ag . O_s ) { return false ; } if ( length ( O_lz - ( O_mb + vec2f ( O_ag . O_q - O_ag . O_s , O_ag . O_s - O_ag . O_r ) ) ) < O_ag . O_s ) { return false ; } return true ; } fn O_ly ( ) -> O_mc { return O_mc ( vec3 < f32 > ( 0.0 , O_md ( ) , 0.0 ) , vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ) ; } fn O_md ( ) -> f32 { return O_av [ 1 ] ; } fn O_kq ( O_df : O_au , ) -> O_kn { var O_me : i32 = 0 ; var O_mf = array < u32 , O_co > ( ) ; O_mf [ 0 ] = 0 ; var O_dr = - 1.0 ; var O_ei : vec3 < f32 > ; var O_mg : u32 ; while ( O_me >= 0 ) { let O_fg = O_mf [ O_me ] ; O_me -= 1 ; let O_lf = O_mh ( O_av [ O_fg ] , O_av [ O_fg + 1 ] , O_av [ O_fg + 2 ] , O_av [ O_fg + 3 ] , O_av [ O_fg + 4 ] , O_av [ O_fg + 5 ] ) ; let O_mi = O_mj ( O_df , O_lf ) ; if ( O_mi < 0.0 || ( O_dr > 0.0 && O_mi > O_dr ) ) { continue ; } for ( var O_ii : u32 = 0 ; O_ii < 4 ; O_ii += 1 ) { var O_mk = O_av [ O_fg + 6 + O_ii ] ; if ( O_mk > 0.0 ) { O_me += 1 ; if ( O_me >= O_co ) { O_hq ( ) ; return O_ko ( ) ; } O_mf [ O_me ] = u32 ( O_mk ) - 1 ; } else if ( O_mk < 0.0 ) { let O_ml = u32 ( - O_mk ) - 1 ; let O_hi = O_mm ( O_ml ) ; let O_mn = O_mo ( O_df , O_hi ) ; if ( O_mn < 0.0 || ( O_dr > 0.0 && O_mn > O_dr ) ) { continue ; } O_dr = O_mn ; O_mg = O_ml ; O_ei = O_mp ( O_hi , O_mq ( O_ml ) , O_ep ( O_df , O_mn ) ) ; } } } if ( O_dr < 0 ) { return O_ko ( ) ; } return O_kn ( O_dr , O_ei , u32 ( O_aw [ O_mg ] . O_ik ) ) ; } fn O_mm ( O_fg : u32 , ) -> O_hj { let O_mr = u32 ( O_aw [ O_fg ] . O_gx ) ; let O_ms = u32 ( O_aw [ O_fg ] . O_gy ) ; let O_mt = u32 ( O_aw [ O_fg ] . O_gz ) ; let O_gx = O_ay [ O_mr ] ; let O_gy = O_ay [ O_ms ] ; let O_gz = O_ay [ O_mt ] ; return O_hj ( O_gx , O_gy , O_gz ) ; } fn O_mq ( O_fg : u32 , ) -> array < vec3 < f32 > , 3 > { let O_mu = u32 ( O_aw [ O_fg ] . O_mv ) ; let O_mw = u32 ( O_aw [ O_fg ] . O_mx ) ; let O_my = u32 ( O_aw [ O_fg ] . O_mz ) ; let O_mv = O_ay [ O_mu ] ; let O_mx = O_ay [ O_mw ] ; let O_mz = O_ay [ O_my ] ; return array < vec3 < f32 > , 3 > ( O_mv , O_mx , O_mz ) ; } fn O_ks ( O_df : O_au , ) -> O_kn { var O_en : O_kn = O_na ( O_df ) ; if ( O_en . O_dr < 0.0 ) { O_en = O_nb ( O_df ) ; } return O_en ; } fn O_na ( O_df : O_au , ) -> O_kn { let O_nc = O_nd ( O_df , O_bd . O_ne ) ; if ( O_nc . O_dr < 0.0 ) { return O_ko ( ) ; } let O_lb = O_nc . O_lb ; let O_dq = O_nf ( O_lb ) ; return O_kn ( O_nc . O_dr , O_bd . O_ne . O_ei , O_dq ) ; } fn O_nf ( O_lb : vec2 < f32 > , ) -> u32 { if ( O_ng ( O_lb , i32 ( O_ae . O_c ) ) ) { return u32 ( O_af . O_k ) ; } let O_m = ! O_ng ( O_lb , i32 ( O_ae . O_d ) ) ; let O_l = O_ng ( O_lb , i32 ( O_ae . O_e ) ) ; if ( O_m ) { if ( O_l ) { return u32 ( O_af . O_n ) ; } else { return u32 ( O_af . O_m ) ; } } else { if ( O_l ) { return u32 ( O_af . O_l ) ; } else { return u32 ( O_af . O_j ) ; } } } fn O_nb ( O_df : O_au , ) -> O_kn { let O_nc = O_nd ( O_df , O_bd . O_nh ) ; if ( O_nc . O_dr < 0.0 ) { return O_ko ( ) ; } let O_lb = O_nc . O_lb ; let O_dq = O_ni ( O_lb ) ; return O_kn ( O_nc . O_dr , O_bd . O_nh . O_ei , O_dq ) ; } fn O_ni ( O_lb : vec2 < f32 > , ) -> u32 { let O_k = O_ng ( O_lb , i32 ( O_ae . O_f ) ) ; if ( O_k ) { return u32 ( O_af . O_k ) ; } let O_m = ! O_ng ( O_lb , i32 ( O_ae . O_g ) ) ; let O_l = O_ng ( O_lb , i32 ( O_ae . O_h ) ) ; if ( O_m ) { if ( O_l ) { return u32 ( O_af . O_n ) ; } else { return u32 ( O_af . O_m ) ; } } else { if ( O_l ) { return u32 ( O_af . O_l ) ; } else { return u32 ( O_af . O_j ) ; } } } fn O_nj ( O_lb : vec3 < f32 > , ) -> vec2 < f32 > { return vec2 < f32 > ( O_lb . x , - O_lb . z ) ; } fn O_nk ( ) -> O_lg { let O_nl = O_az [ u32 ( O_ae . O_b ) ] ; let O_lf = O_lg ( O_nl . O_lk , O_nl . O_lj , O_nl . O_ln , O_nl . O_lm ) ; return O_lr ( O_lf , 1 ) ; } struct O_nm { O_dr : f32 , O_lb : vec2 < f32 > , } fn O_nd ( O_df : O_au , O_p : O_mc , ) -> O_nm { let O_nc = O_lx ( O_df , O_p ) ; if ( O_nc . O_dr < 0.0 ) { return O_nm ( - 1.0 , vec2 < f32 > ( 0.0 ) ) ; } let O_nn = O_nj ( O_nc . O_lb ) ; let O_lf = O_nk ( ) ; if ( ! O_lh ( O_lf , O_nn ) ) { return O_nm ( - 1.0 , vec2 < f32 > ( 0.0 ) ) ; } return O_nm ( O_nc . O_dr , O_nn ) ; } fn O_ng ( O_lb : vec2f , O_no : i32 , ) -> bool { if ( O_no < 0 ) { return false ; } var O_mf = array < i32 , 22 > ( ) ; O_mf [ 0 ] = i32 ( O_no ) ; var O_me : i32 = 1 ; var O_np : i32 = 0 ; while ( O_me > 0 ) { let O_fg = O_mf [ O_me - 1 ] ; O_me -= 1 ; let O_nq = O_az [ O_fg ] ; let O_lf = O_lg ( O_nq . O_lk , O_nq . O_lj , O_nq . O_ln , O_nq . O_lm ) ; if ( ! O_lh ( O_lf , O_lb ) ) { continue ; } var O_nr = array < i32 , 2 > ( ) ; O_nr [ 0 ] = i32 ( O_nq . O_ns ) ; O_nr [ 1 ] = i32 ( O_nq . O_nt ) ; for ( var O_ii = 0 ; O_ii < 2 ; O_ii += 1 ) { let O_nu = O_nr [ O_ii ] ; if ( O_nu > 0 ) { O_mf [ O_me ] = O_nu - 1 ; O_me += 1 ; } else if ( O_nu < 0 ) { let O_nv = - 1 * O_nu - 1 ; let O_do = O_nw ( O_lb , O_nv ) ; if ( O_do == O_bo ) { return true ; } if ( O_do == O_br ) { O_np -= 1 ; } if ( O_do == O_bq ) { O_np += 1 ; } } } } return O_np != 0 ; } fn O_nw ( O_lb : vec2f , O_nv : i32 , ) -> u32 { let O_nx = i32 ( O_nv ) ; switch u32 ( O_bb [ O_nx ] ) { case O_ch : { let O_ny = O_lb ; var O_nz = vec2 ( O_bb [ O_nx + 1 ] , O_bb [ O_nx + 2 ] ) ; var O_oa = vec2 ( O_bb [ O_nx + 3 ] , O_bb [ O_nx + 4 ] ) ; var O_ir = normalize ( O_oa - O_nz ) ; let O_ob = O_bb [ O_nx + 5 ] ; O_nz = O_nz + O_ir * O_ob * 0.5 ; O_oa = O_oa - O_ir * O_ob * 0.5 ; if ( ( length ( O_lb - O_oa ) < ( O_ob / 2.0 ) ) || ( length ( O_lb - O_nz ) < ( O_ob / 2.0 ) ) ) { return O_bo ; } let O_ew = O_oa - O_nz ; let O_oc = dot ( O_ew , O_ew ) ; let O_od = O_ny - O_nz ; let O_dr = dot ( O_od , O_ew ) / O_oc ; if ( O_dr < 0.0 || O_dr > 1.0 ) { return O_bp ; } let O_oe = O_nz + O_dr * O_ew ; let distance = length ( O_ny - O_oe ) ; if ( distance <= O_ob / 2.0 ) { return O_bo ; } else { return O_bp ; } } case O_bs : { let O_of = vec2f ( O_bb [ O_nx + 1 ] , O_bb [ O_nx + 2 ] ) ; let O_kg = O_bb [ O_nx + 3 ] ; if ( length ( O_lb - O_of ) < O_kg ) { return O_bo ; } else { return O_bp ; } } case O_bu : { let O_og : vec2 < f32 > = vec2f ( O_bb [ O_nx + 1 ] , O_bb [ O_nx + 2 ] ) ; let O_q : f32 = O_bb [ O_nx + 3 ] ; let O_r : f32 = O_bb [ O_nx + 4 ] ; let O_kk : f32 = O_bb [ O_nx + 5 ] ; let O_oh : f32 = O_bb [ O_nx + 6 ] ; if ( O_lb . x > O_og . x + O_oh && O_lb . x < O_og . x + O_q - O_oh ) { if ( O_lb . y > O_og . y - O_r && O_lb . y < O_og . y ) { return O_bo ; } } if ( O_lb . x > O_og . x && O_lb . x < O_og . x + O_q ) { if ( O_lb . y > O_og . y - O_r + O_oh && O_lb . y < O_og . y - O_oh ) { return O_bo ; } } if ( length ( O_lb - ( O_og + vec2f ( O_oh , - O_oh ) ) ) < O_oh ) { return O_bo ; } if ( length ( O_lb - ( O_og + vec2f ( O_q - O_oh , - O_oh ) ) ) < O_oh ) { return O_bo ; } if ( length ( O_lb - ( O_og + vec2f ( O_oh , O_oh - O_r ) ) ) < O_oh ) { return O_bo ; } if ( length ( O_lb - ( O_og + vec2f ( O_q - O_oh , O_oh - O_r ) ) ) < O_oh ) { return O_bo ; } return O_bp ; } case O_by : { let O_gx : vec2 < f32 > = vec2f ( O_bb [ O_nx + 1 ] , O_bb [ O_nx + 2 ] ) ; let O_gy : vec2 < f32 > = vec2f ( O_bb [ O_nx + 3 ] , O_bb [ O_nx + 4 ] ) ; let O_gz : vec2 < f32 > = vec2f ( O_bb [ O_nx + 5 ] , O_bb [ O_nx + 6 ] ) ; let O_oi = O_bb [ O_nx + 6 ] ; let O_oj = O_gy - O_gx ; let O_ok = O_gz - O_gx ; let O_ol = O_lb - O_gx ; let O_om = dot ( O_ok , O_ok ) ; let O_on = dot ( O_ok , O_oj ) ; let O_oo = dot ( O_ok , O_ol ) ; let O_op = dot ( O_oj , O_oj ) ; let O_oq = dot ( O_oj , O_ol ) ; let O_or = 1.0 / ( O_om * O_op - O_on * O_on ) ; let O_gi = ( O_op * O_oo - O_on * O_oq ) * O_or ; let O_el = ( O_om * O_oq - O_on * O_oo ) * O_or ; if ( ( O_gi >= 0.0 ) && ( O_el >= 0.0 ) && ( O_gi + O_el <= 1.0 ) ) { if ( 0.5 * ( O_gx . x * ( O_gy . y - O_gz . y ) + O_gy . x * ( O_gz . y - O_gx . y ) + O_gz . x * ( O_gx . y - O_gy . y ) ) < 0.0 ) { return O_bq ; } else { return O_br ; } } else { return O_bp ; } } case O_bz : { let O_of = vec2f ( O_bb [ O_nx + 1 ] , O_bb [ O_nx + 2 ] ) ; let O_kg = O_bb [ O_nx + 3 ] ; var O_os = O_bb [ O_nx + 4 ] ; let O_ot = O_bb [ O_nx + 5 ] ; let O_ou = vec2f ( O_bb [ O_nx + 6 ] , O_bb [ O_nx + 7 ] ) ; let O_ov = vec2f ( O_bb [ O_nx + 8 ] , O_bb [ O_nx + 9 ] ) ; let O_ow = O_lb . x - O_of . x ; let O_ox = O_lb . y - O_of . y ; let O_oy = O_ow * O_ow + O_ox * O_ox ; if ( O_oy > O_kg * O_kg ) { return O_bp ; } let O_gx = O_of ; let O_gy = O_ou ; let O_gz = O_ov ; let O_oj = O_gy - O_gx ; let O_ok = O_gz - O_gx ; let O_ol = O_lb - O_gx ; let O_om = dot ( O_ok , O_ok ) ; let O_on = dot ( O_ok , O_oj ) ; let O_oo = dot ( O_ok , O_ol ) ; let O_op = dot ( O_oj , O_oj ) ; let O_oq = dot ( O_oj , O_ol ) ; let O_or = 1.0 / ( O_om * O_op - O_on * O_on ) ; let O_gi = ( O_op * O_oo - O_on * O_oq ) * O_or ; let O_el = ( O_om * O_oq - O_on * O_oo ) * O_or ; if ( ( O_gi >= 0.0 ) && ( O_el >= 0.0 ) && ( O_gi + O_el <= 1.0 ) ) { if ( abs ( O_ot ) >= O_bh ) { if ( O_ot > 0.0 ) { return O_br ; } else { return O_bq ; } } else { return O_bp ; } } if ( abs ( O_ot ) >= O_bj ) { if ( O_ot > 0 ) { return O_br ; } else { return O_bq ; } } O_os = O_os % O_bj ; if ( O_os < 0.0 ) { O_os = O_os + O_bj ; } var O_oz = atan2 ( O_ox , O_ow ) ; if ( O_oz < 0.0 ) { O_oz = O_oz + O_bj ; } var O_pa = O_os + O_ot ; if ( O_ot >= 0.0 ) { if ( O_pa >= O_bj ) { O_pa = O_pa - O_bj ; } if ( O_pa > O_os ) { if ( O_oz > O_os && O_oz < O_pa ) { return O_br ; } else { return O_bp ; } } else { if ( O_oz > O_os || O_oz < O_pa ) { return O_br ; } else { return O_bp ; } } } else { if ( O_pa < 0.0 ) { O_pa = O_pa + O_bj ; } if ( O_pa < O_os ) { if ( O_oz > O_os && O_oz < O_pa ) { return O_bq ; } else { return O_bp ; } } else { if ( O_oz < O_os || O_oz > O_pa ) { return O_bq ; } else { return O_bp ; } } } } case O_bt : { let O_of = vec2f ( O_bb [ O_nx + 1 ] , O_bb [ O_nx + 2 ] ) ; let O_oh = O_bb [ O_nx + 3 ] ; let O_q = O_bb [ O_nx + 4 ] ; var O_os = O_bb [ O_nx + 5 ] ; let O_ot = O_bb [ O_nx + 6 ] ; let O_pb = O_q / 2.0 ; let O_pc = length ( O_lb - O_of ) ; if ( O_pc < ( O_oh - O_pb ) || O_pc > ( O_oh + O_pb ) ) { return O_bp ; } var O_pa = O_os + O_ot ; let O_ou = vec2f ( O_of . x + cos ( O_os ) * O_oh , O_of . y + sin ( O_os ) * O_oh ) ; let O_ov = vec2f ( O_of . x + cos ( O_pa ) * O_oh , O_of . y + sin ( O_pa ) * O_oh ) ; if ( length ( O_lb - O_ou ) < O_pb || length ( O_lb - O_ov ) < O_pb ) { return O_bo ; } O_os = O_os % O_bj ; if ( O_os < 0.0 ) { O_os = O_os + O_bj ; } var O_oz = atan2 ( O_lb . y - O_of . y , O_lb . x - O_of . x ) ; if ( O_oz < 0.0 ) { O_oz = O_oz + O_bj ; } if ( O_ot >= 0.0 ) { if ( O_pa >= O_bj ) { O_pa = O_pa - O_bj ; } if ( O_pa > O_os ) { if ( O_oz > O_os && O_oz < O_pa ) { return O_bo ; } else { return O_bp ; } } else { if ( O_oz > O_os || O_oz < O_pa ) { return O_bo ; } else { return O_bp ; } } } else { if ( O_pa < 0.0 ) { O_pa = O_pa + O_bj ; } if ( O_pa < O_os ) { if ( O_oz > O_os && O_oz < O_pa ) { return O_bo ; } else { return O_bp ; } } else { if ( O_oz < O_os || O_oz > O_pa ) { return O_bo ; } else { return O_bp ; } } } } default : { O_dk ( vec3 < f32 > ( 1 , 0 , 0 ) ) ; break ; } } return O_bp ; } fn O_eo ( O_df : O_au , ) -> vec3 < f32 > { let O_ir = O_df . O_ew ; let O_lo = vec2 < f32 > ( 0.5 + atan2 ( O_ir . z , O_ir . x ) / ( 2.0 * O_bh ) , 0.5 - asin ( O_ir . y ) / O_bh ) ; let O_lp = vec2 < i32 > ( O_lo * vec2 < f32 > ( textureDimensions ( O_ah ) ) ) ; var O_pd = textureLoad ( O_ah , O_lp , 0 ) ; var O_dj = vec3 < f32 > ( O_pd . x , O_pd . y , O_pd . z ) ; return O_dj * O_ai . O_pe ; } fn O_kw ( O_df : O_au , ) -> O_kn { let O_lf = O_mh ( O_bf . x , O_bf . y , - 2000 , 2000.0 , O_bf . y + 10.0 , 2000 ) ; let O_do = O_pf ( O_df , O_lf ) ; if ( O_do . O_dr < 0 ) { return O_ko ( ) ; } return O_kn ( O_do . O_dr , O_do . O_ei , 2 ) ; } fn O_ky ( O_df : O_au , ) -> O_kn { let O_do = O_pg ( O_df , O_ai ) ; if ( O_do . O_dr < 0.0 ) { return O_ko ( ) ; } return O_kn ( O_do . O_dr , O_do . O_ei , 1 ) ; } const O_ph : u32 = 10 ; const O_pi : u32 = 5 ; struct O_pj { O_pk : u32 , O_pl : u32 , O_pm : bool , } fn O_pn ( O_po : u32 , ) -> O_pj { let O_pk = O_po & 0x3ff ; let O_pl = ( O_po >> O_ph ) & 0x1f ; let O_pp = ( O_po >> ( O_ph + O_pi ) ) & 0x1 ; if O_pp > 0 { return O_pj ( O_pk , O_pl , true ) ; } else { return O_pj ( O_pk , O_pl , false ) ; } } fn O_pq ( O_po : O_pj , ) -> u32 { if O_po . O_pm { return O_po . O_pk + ( O_po . O_pl << O_ph ) + ( 1 << ( O_pi + O_ph ) ) ; } else { return O_po . O_pk + ( O_po . O_pl << O_ph ) ; } } fn O_pr ( O_po : u32 , O_pk : u32 , ) -> u32 { var O_dr = O_pn ( O_po ) ; O_dr . O_pk = O_pk ; return O_pq ( O_dr ) ; } struct O_aj { O_gj : f32 , O_dj : vec3 < f32 > , O_dm : vec3 < f32 > , O_gi : vec3 < f32 > , O_el : vec3 < f32 > , O_pe : f32 , } struct O_ge { O_dm : vec3 < f32 > , O_dj : vec3 < f32 > , } ; struct O_mh { O_lk : f32 , O_ln : f32 , O_ps : f32 , O_lj : f32 , O_lm : f32 , O_pt : f32 , } fn O_pu ( O_lb : vec3 < f32 > , O_pv : O_mh , ) -> bool { return ( O_lb . x >= O_pv . O_lk && O_lb . x <= O_pv . O_lj ) && ( O_lb . y >= O_pv . O_ln && O_lb . y <= O_pv . O_lm ) && ( O_lb . z >= O_pv . O_ps && O_lb . z <= O_pv . O_pt ) ; } fn O_pw ( O_pv : O_mh , ) -> vec3 < f32 > { let O_gt = vec3 < f32 > ( O_pv . O_lk + O_pv . O_lj , O_pv . O_ln + O_pv . O_lm , O_pv . O_ps + O_pv . O_pt ) ; return O_gt / vec3 < f32 > ( 2.0 ) ; } fn O_px ( O_dm : vec3 < f32 > , O_q : f32 , ) -> O_mh { let O_lc = O_q / 2.0 ; return O_mh ( O_dm . x - O_lc , O_dm . y - O_lc , O_dm . z - O_lc , O_dm . x + O_lc , O_dm . y + O_lc , O_dm . z + O_lc , ) ; } fn O_py ( O_lf : O_mh , O_lb : vec3 < f32 > , ) -> vec3 < f32 > { let O_pz : f32 = 1e-5 ; if abs ( O_lb . x - O_lf . O_lk ) < O_pz { return vec3 < f32 > ( - 1.0 , 0.0 , 0.0 ) ; } if abs ( O_lb . x - O_lf . O_lj ) < O_pz { return vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ; } if abs ( O_lb . y - O_lf . O_ln ) < O_pz { return vec3 < f32 > ( 0.0 , - 1.0 , 0.0 ) ; } if abs ( O_lb . y - O_lf . O_lm ) < O_pz { return vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ; } if abs ( O_lb . z - O_lf . O_ps ) < O_pz { return vec3 < f32 > ( 0.0 , 0.0 , - 1.0 ) ; } if abs ( O_lb . z - O_lf . O_pt ) < O_pz { return vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ; } return vec3 < f32 > ( 0.0 , 0.0 , 0.0 ) ; } struct O_lg { O_lk : f32 , O_lj : f32 , O_ln : f32 , O_lm : f32 , } fn O_lr ( O_lf : O_lg , O_qa : f32 , ) -> O_lg { return O_lg ( ( O_lf . O_lk + O_qa ) , ( O_lf . O_lj - O_qa ) , ( O_lf . O_ln + O_qa ) , ( O_lf . O_lm - O_qa ) ) ; } fn O_lh ( O_lf : O_lg , O_lb : vec2 < f32 > , ) -> bool { let O_qb = O_lb . x >= O_lf . O_lk && O_lb . x <= O_lf . O_lj ; let O_qc = O_lb . y >= O_lf . O_ln && O_lb . y <= O_lf . O_lm ; return O_qb && O_qc ; } fn O_qd ( O_lq : O_lg , O_qe : O_lg , ) -> bool { let O_qf = O_lq . O_lk <= O_qe . O_lj && O_lq . O_lj >= O_qe . O_lk ; let O_qg = O_lq . O_ln <= O_qe . O_lm && O_lq . O_lm >= O_qe . O_ln ; return O_qf && O_qg ; } struct O_qh { O_dm : vec3 < f32 > , O_q : f32 , } struct O_ab { O_cw : f32 , O_dd : f32 , O_de : f32 , O_jd : f32 , O_jv : f32 , } struct O_qi { O_cw : f32 , O_qj : f32 , O_jd : f32 , O_jv : f32 , } struct O_qk { O_hi : O_hj , O_ei : vec3 < f32 > , O_ql : vec3 < f32 > , } fn O_qm ( ) -> O_qk { return O_qk ( O_qn ( ) , vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) ) ; } struct O_ax { O_gx : f32 , O_gy : f32 , O_gz : f32 , O_mv : f32 , O_mx : f32 , O_mz : f32 , O_ik : f32 , } struct O_kn { O_dr : f32 , O_ei : vec3 < f32 > , O_dq : u32 , } fn O_ko ( ) -> O_kn { return O_kn ( - 1 , O_qo ( ) , 0 ) ; } struct O_as { O_dv : vec3 < f32 > , O_ea : f32 , O_ec : f32 , O_eb : f32 , O_ed : f32 , O_ee : f32 , O_ef : f32 , O_qp : f32 , O_eg : vec3 < f32 > , O_es : f32 , O_eu : f32 , O_ex : f32 , O_ez : f32 , O_fa : f32 , O_fb : f32 , O_fc : f32 , O_fd : f32 , } struct O_qq { O_lk : f32 , O_ln : f32 , O_ps : f32 , O_lj : f32 , O_lm : f32 , O_pt : f32 , O_ns : f32 , O_nt : f32 , } struct O_ba { O_lk : f32 , O_lj : f32 , O_ln : f32 , O_lm : f32 , O_ns : f32 , O_nt : f32 , } struct O_qr { O_qs : f32 , O_no : f32 , O_qt : f32 , O_qu : f32 , } struct O_be { O_ne : O_mc , O_nh : O_mc , } struct O_mc { O_lb : vec3 < f32 > , O_ei : vec3 < f32 > , } struct O_au { O_hn : vec3 < f32 > , O_ew : vec3 < f32 > , } fn O_qv ( ) -> O_au { return O_au ( vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) ) ; } fn O_ep ( O_df : O_au , O_dr : f32 , ) -> vec3 < f32 > { return O_df . O_hn + O_dr * O_df . O_ew ; } struct O_qw { O_dr : f32 , O_ei : vec3 < f32 > , } fn O_pf ( O_df : O_au , O_lf : O_mh , ) -> O_qw { let O_qx = vec3 < f32 > ( O_lf . O_lk , O_lf . O_ln , O_lf . O_ps ) ; let O_qy = vec3 < f32 > ( O_lf . O_lj , O_lf . O_lm , O_lf . O_pt ) ; let O_qz = 1.0 / O_df . O_ew ; let sign = vec3 < u32 > ( u32 ( O_qz . x < 0.0 ) , u32 ( O_qz . y < 0.0 ) , u32 ( O_qz . z < 0.0 ) ) ; var O_ra = array < vec3 < f32 > , 2 > ( O_qx , O_qy ) ; var O_rb = ( O_ra [ sign . x ] . x - O_df . O_hn . x ) * O_qz . x ; var O_rc = ( O_ra [ 1 - sign . x ] . x - O_df . O_hn . x ) * O_qz . x ; var O_rd = ( O_ra [ sign . y ] . y - O_df . O_hn . y ) * O_qz . y ; var O_re = ( O_ra [ 1 - sign . y ] . y - O_df . O_hn . y ) * O_qz . y ; if ( O_rb > O_re ) || ( O_rd > O_rc ) { return O_qw ( - 1.0 , vec3 < f32 > ( 0.0 ) ) ; } O_rb = max ( O_rb , O_rd ) ; O_rc = min ( O_rc , O_re ) ; let O_rf = ( O_ra [ sign . z ] . z - O_df . O_hn . z ) * O_qz . z ; let O_rg = ( O_ra [ 1 - sign . z ] . z - O_df . O_hn . z ) * O_qz . z ; if ( O_rb > O_rg ) || ( O_rf > O_rc ) { return O_qw ( - 1.0 , vec3 < f32 > ( 0.0 ) ) ; } O_rb = max ( O_rb , O_rf ) ; O_rc = min ( O_rc , O_rg ) ; if ( O_rb < 0.0 ) { return O_qw ( - 1.0 , vec3 < f32 > ( 0.0 ) ) ; } var O_ei = vec3 < f32 > ( 0.0 ) ; let O_lb = O_df . O_hn + O_rb * O_df . O_ew ; let O_rh = 0.001 ; if ( abs ( O_lb . x - O_qx . x ) < O_rh ) { O_ei = vec3 < f32 > ( - 1.0 , 0.0 , 0.0 ) ; } else if ( abs ( O_lb . x - O_qy . x ) < O_rh ) { O_ei = vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ; } else if ( abs ( O_lb . y - O_qx . y ) < O_rh ) { O_ei = vec3 < f32 > ( 0.0 , - 1.0 , 0.0 ) ; } else if ( abs ( O_lb . y - O_qy . y ) < O_rh ) { O_ei = vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ; } else if ( abs ( O_lb . z - O_qx . z ) < O_rh ) { O_ei = vec3 < f32 > ( 0.0 , 0.0 , - 1.0 ) ; } else if ( abs ( O_lb . z - O_qy . z ) < O_rh ) { O_ei = vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ; } return O_qw ( O_rb , O_ei ) ; } fn O_pg ( O_df : O_au , O_gg : O_aj , ) -> O_qw { let O_gl = O_gg . O_dm + O_gg . O_gi + O_gg . O_el ; let O_gm = O_gg . O_dm + O_gg . O_gi - O_gg . O_el ; let O_gn = O_gg . O_dm - O_gg . O_gi + O_gg . O_el ; let O_go = O_gg . O_dm - O_gg . O_gi - O_gg . O_el ; var O_dr = - 1.0 ; let O_ri = O_mo ( O_df , O_hj ( O_gl , O_gm , O_gn ) ) ; if ( O_ri > 0.0 && ( O_dr < 0.0 || O_ri < O_dr ) ) { O_dr = O_ri ; } let O_rj = O_mo ( O_df , O_hj ( O_gm , O_gn , O_go ) ) ; if ( O_rj > 0.0 && ( O_dr < 0.0 || O_rj < O_dr ) ) { O_dr = O_rj ; } return O_qw ( O_dr , normalize ( cross ( O_gg . O_gi , O_gg . O_el ) ) ) ; } fn O_ji ( O_rk : vec3 < f32 > , O_ei : vec3 < f32 > , ) -> vec3 < f32 > { let O_rl = dot ( O_rk , O_ei ) ; return normalize ( O_rk - 2.0 * O_rl * O_ei ) ; } fn O_mj ( O_df : O_au , O_pv : O_mh , ) -> f32 { if O_pu ( O_df . O_hn , O_pv ) { return 0.0 ; } var O_rm : f32 = ( O_pv . O_lk - O_df . O_hn . x ) / O_df . O_ew . x ; var O_rn : f32 = ( O_pv . O_lj - O_df . O_hn . x ) / O_df . O_ew . x ; if O_rm > O_rn { let O_ro = O_rm ; O_rm = O_rn ; O_rn = O_ro ; } var O_rp : f32 = ( O_pv . O_ln - O_df . O_hn . y ) / O_df . O_ew . y ; var O_rq : f32 = ( O_pv . O_lm - O_df . O_hn . y ) / O_df . O_ew . y ; if O_rp > O_rq { let O_ro = O_rp ; O_rp = O_rq ; O_rq = O_ro ; } if ( O_rm > O_rq ) || ( O_rp > O_rn ) { return - 1.0 ; } if O_rp > O_rm { O_rm = O_rp ; } if O_rq < O_rn { O_rn = O_rq ; } var O_rr : f32 = ( O_pv . O_ps - O_df . O_hn . z ) / O_df . O_ew . z ; var O_rs : f32 = ( O_pv . O_pt - O_df . O_hn . z ) / O_df . O_ew . z ; if O_rr > O_rs { let O_ro = O_rr ; O_rr = O_rs ; O_rs = O_ro ; } if ( O_rm > O_rs ) || ( O_rr > O_rn ) { return - 1.0 ; } if O_rr > O_rm { O_rm = O_rr ; } if O_rs < O_rn { O_rn = O_rs ; } if O_rm < 0.0 { if O_rn < 0.0 { return - 1.0 ; } return O_rn ; } return O_rm ; } fn O_gp ( O_df : O_au , O_gl : vec3 < f32 > , O_gm : vec3 < f32 > , O_gn : vec3 < f32 > , O_go : vec3 < f32 > , ) -> bool { let O_ri = O_hj ( O_gl , O_gm , O_gn ) ; let O_rj = O_hj ( O_gm , O_gn , O_go ) ; return O_mo ( O_df , O_ri ) > 0.0 || O_mo ( O_df , O_rj ) > 0.0 ; } fn O_mo ( O_df : O_au , O_hi : O_hj , ) -> f32 { let O_pz = 0.00000001 ; let O_rt = O_hi . O_gy - O_hi . O_gx ; let O_ru = O_hi . O_gz - O_hi . O_gx ; let O_jn = cross ( O_df . O_ew , O_ru ) ; let O_gu = dot ( O_rt , O_jn ) ; if O_gu > - O_pz && O_gu < O_pz { return - 1.0 ; } let O_hw = 1.0 / O_gu ; let O_gc = O_df . O_hn - O_hi . O_gx ; let O_gi = O_hw * dot ( O_gc , O_jn ) ; if O_gi < 0.0 || O_gi > 1.0 { return - 1.0 ; } let O_rv = cross ( O_gc , O_rt ) ; let O_el = O_hw * dot ( O_df . O_ew , O_rv ) ; if O_el < 0.0 || O_gi + O_el > 1.0 { return - 1.0 ; } let O_dr = O_hw * dot ( O_ru , O_rv ) ; if O_dr > O_pz { return O_dr ; } else { return - 1.0 ; } } fn O_rw ( O_df : O_au , O_rx : O_ry , ) -> f32 { let O_rz = O_df . O_hn - O_rx . O_of ; let O_gu = dot ( O_df . O_ew , O_df . O_ew ) ; let O_gv = 2.0 * dot ( O_rz , O_df . O_ew ) ; let O_gw = dot ( O_rz , O_rz ) - O_rx . O_oh * O_rx . O_oh ; let O_sa = O_gv * O_gv - 4.0 * O_gu * O_gw ; if O_sa < 0.0 { return - 1.0 ; } else { return ( - O_gv - sqrt ( O_sa ) ) / ( 2.0 * O_gu ) ; } } struct O_sb { O_dr : bool , O_lb : vec3 < f32 > , } fn O_sc ( O_df : O_au , O_p : O_mc , ) -> O_sb { let O_dr = O_sd ( O_df , O_p ) ; if O_dr < 0.0 { return O_sb ( false , vec3 < f32 > ( 0 ) ) ; } let O_se = O_df . O_hn + O_dr * O_df . O_ew ; return O_sb ( true , O_se ) ; } struct O_sf { O_dr : f32 , O_lb : vec3 < f32 > , } fn O_lx ( O_df : O_au , O_p : O_mc , ) -> O_sf { let O_dr = O_sd ( O_df , O_p ) ; if O_dr < 0.0 { return O_sf ( - 1 , vec3 < f32 > ( 0 ) ) ; } let O_se = O_df . O_hn + O_dr * O_df . O_ew ; return O_sf ( O_dr , O_se ) ; } fn O_sd ( O_df : O_au , O_p : O_mc , ) -> f32 { let O_lb = O_p . O_lb ; let O_ei = O_p . O_ei ; let O_hf = dot ( O_df . O_ew , O_ei ) ; if ( O_ev ( O_df . O_ew , O_p . O_ei ) ) { return - 1.0 ; } let O_sg = O_lb - O_df . O_hn ; let O_dr = dot ( O_sg , O_ei ) / O_hf ; return O_dr ; } struct O_sh { O_si : vec3 < f32 > , O_sj : vec3 < f32 > , } ; fn O_sk ( O_sl : O_sh , O_lf : O_mh , ) -> bool { var O_rb : f32 = 0.0 ; var O_rc : f32 = 1.0 ; let O_ir : vec3 < f32 > = O_sl . O_sj - O_sl . O_si ; for ( var O_ii : i32 = 0 ; O_ii < 3 ; O_ii = O_ii + 1 ) { let O_sm : f32 = 1.0 / O_ir [ O_ii ] ; var O_ri : f32 ; var O_rj : f32 ; if O_ii == 0 { O_ri = ( O_lf . O_lk - O_sl . O_si . x ) * O_sm ; O_rj = ( O_lf . O_lj - O_sl . O_si . x ) * O_sm ; } else if O_ii == 1 { O_ri = ( O_lf . O_ln - O_sl . O_si . y ) * O_sm ; O_rj = ( O_lf . O_lm - O_sl . O_si . y ) * O_sm ; } else { O_ri = ( O_lf . O_ps - O_sl . O_si . z ) * O_sm ; O_rj = ( O_lf . O_pt - O_sl . O_si . z ) * O_sm ; } if O_sm < 0.0 { let O_ro : f32 = O_ri ; O_ri = O_rj ; O_rj = O_ro ; } O_rb = max ( O_rb , O_ri ) ; O_rc = min ( O_rc , O_rj ) ; if O_rc <= O_rb { return false ; } } return true ; } struct O_ry { O_of : vec3 < f32 > , O_oh : f32 , } ; fn O_sn ( O_rx : O_ry , O_lb : vec3 < f32 > , ) -> vec3 < f32 > { return normalize ( O_lb - O_rx . O_of ) ; } fn O_so ( O_rk : vec3 < f32 > , O_ei : vec3 < f32 > , ) -> vec3 < f32 > { return O_rk - 2.0 * dot ( O_rk , O_ei ) * O_ei ; } struct O_hj { O_gx : vec3 < f32 > , O_gy : vec3 < f32 > , O_gz : vec3 < f32 > , } ; fn O_qn ( ) -> O_hj { return O_hj ( vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) ) ; } fn O_sp ( O_hi : O_hj , ) -> vec3 < f32 > { return normalize ( O_hi . O_gx - O_hi . O_gy ) ; } fn O_sq ( O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , O_gw : vec3 < f32 > , ) -> bool { let O_gx = O_gw - O_gu ; let O_gy = O_gv - O_gu ; let O_gz = O_gt - O_gu ; let O_om = dot ( O_gx , O_gx ) ; let O_on = dot ( O_gx , O_gy ) ; let O_oo = dot ( O_gx , O_gz ) ; let O_op = dot ( O_gy , O_gy ) ; let O_oq = dot ( O_gy , O_gz ) ; let O_or = 1.0 / ( O_om * O_op - O_on * O_on ) ; let O_gi = ( O_op * O_oo - O_on * O_oq ) * O_or ; let O_el = ( O_om * O_oq - O_on * O_oo ) * O_or ; return ( O_gi >= 0.0 ) && ( O_el >= 0.0 ) && ( O_gi + O_el < 1.0 ) ; } fn O_sr ( O_sl : O_sh , O_hi : O_hj , ) -> bool { let O_gl = O_sl . O_si ; let O_gm = O_sl . O_sj ; let O_gu : vec3 < f32 > = O_hi . O_gx ; let O_gv : vec3 < f32 > = O_hi . O_gy ; let O_gw : vec3 < f32 > = O_hi . O_gz ; let O_ss = O_gv - O_gu ; let O_st = O_gw - O_gu ; let O_jx = cross ( O_ss , O_st ) ; let O_kf = dot ( O_jx , O_gu ) ; let O_dr = ( O_kf - dot ( O_jx , O_gl ) ) / dot ( O_jx , O_gm - O_gl ) ; if O_dr < 0.0 || O_dr > 1.0 { return false ; } let O_gt = O_gl + O_dr * ( O_gm - O_gl ) ; return O_sq ( O_gt , O_gu , O_gv , O_gw ) ; } fn O_su ( O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , O_gw : vec3 < f32 > , ) -> vec3 < f32 > { let O_gx = O_gv - O_gu ; let O_gy = O_gw - O_gu ; let O_gz = O_gt - O_gu ; let O_ha = dot ( O_gx , O_gx ) ; let O_hb = dot ( O_gx , O_gy ) ; let O_hc = dot ( O_gy , O_gy ) ; let O_hd = dot ( O_gz , O_gx ) ; let O_he = dot ( O_gz , O_gy ) ; let O_hf = O_ha * O_hc - O_hb * O_hb ; let O_el = ( O_hc * O_hd - O_hb * O_he ) / O_hf ; let O_hg = ( O_ha * O_he - O_hb * O_hd ) / O_hf ; let O_gi = 1.0 - O_el - O_hg ; return vec3 < f32 > ( O_gi , O_el , O_hg ) ; } fn O_mp ( O_hi : O_hj , O_ei : array < vec3 < f32 > , 3 > , O_hk : vec3 < f32 > , ) -> vec3 < f32 > { let O_hl = O_su ( O_hk , O_hi . O_gx , O_hi . O_gy , O_hi . O_gz ) ; return normalize ( O_hl . x * O_ei [ 0 ] + O_hl . y * O_ei [ 1 ] + O_hl . z * O_ei [ 2 ] ) ; } fn O_qo ( ) -> vec3 < f32 > { return vec3 < f32 > ( 0 , 0 , 0 ) ; } fn O_ev ( O_sv : vec3 < f32 > , O_gz : vec3 < f32 > , ) -> bool { let O_rl = dot ( O_sv , O_gz ) ; let O_sw = length ( O_sv ) ; let O_sx = length ( O_gz ) ; return ( O_sw > 0.0 ) && ( O_sx > 0.0 ) && ( O_rl >= 0.0 ) ; } fn O_sy ( O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , ) -> f32 { let O_rl = dot ( O_gu , O_gv ) ; let O_sz = length ( O_gu ) * length ( O_gv ) ; return O_rl / O_sz ; } fn O_ta ( O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , ) -> bool { let O_tb = 1.0 / 255.0 ; return abs ( O_gu . x - O_gv . x ) < O_tb && abs ( O_gu . y - O_gv . y ) < O_tb && abs ( O_gu . z - O_gv . z ) < O_tb ; } fn O_fe ( O_jx : vec3f , O_el : vec3f , ) -> f32 { let O_ka = max ( dot ( normalize ( O_jx ) , normalize ( O_el ) ) , 0.0 ) ; return O_ka ; } fn O_tc ( O_jx : vec3f , O_el : vec3f , ) -> f32 { let dot = O_fe ( O_jx , O_el ) ; return acos ( dot ) ; } struct O_ad { O_dm : vec3 < f32 > , O_td : vec3 < f32 > , O_te : vec3 < f32 > , O_tf : vec3 < f32 > , O_dn : vec3 < f32 > , O_tg : f32 , O_th : f32 , O_ti : f32 , O_tj : f32 , } struct O_z { O_dt : vec3 < f32 > , O_dm : vec3 < f32 > , O_hm : f32 , } ";Vn.addShaderCode($z);var Qz="struct O_a { O_b : vec3 < f32 > , O_c : vec3 < f32 > , O_d : vec3 < f32 > , O_e : vec3 < f32 > , O_f : vec3 < f32 > , O_g : f32 , O_h : f32 , O_i : f32 , O_j : f32 , } struct O_k { O_l : f32 , O_m : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_n : array < f32 > ; @ group ( 0 ) @ binding ( 1 ) var < uniform > O_o : O_a ; @ group ( 0 ) @ binding ( 2 ) var < uniform > O_p : O_k ; @ group ( 0 ) @ binding ( 3 ) var < storage , read_write > O_q : array < vec2 < f32 > > ; override Image_Width : u32 ; override Image_Height : u32 ; var < private > O_l : f32 ; @ compute @ workgroup_size ( 1024 ) fn main ( @ builtin ( global_invocation_id ) O_r : vec3 < u32 > , ) { let O_s = vec2 < u32 > ( u32 ( O_q [ O_r . x + u32 ( O_p . O_m ) ] . x ) , u32 ( O_q [ O_r . x + u32 ( O_p . O_m ) ] . y ) ) ; if ( O_s . x >= Image_Width || O_s . y >= Image_Height ) { return ; } let O_t = O_s . x + O_s . y * Image_Width ; let O_u = Image_Width * Image_Height * 8 - u32 ( O_t ) * 8 ; O_l = f32 ( O_t ) * O_p . O_l ; var O_v = O_o . O_c ; O_v = O_v + ( f32 ( O_s . x ) + O_w ( ) ) * O_o . O_d ; O_v = O_v + ( f32 ( O_s . y ) + O_w ( ) ) * O_o . O_e ; O_n [ O_u ] = O_v . x ; O_n [ O_u + 1 ] = O_v . y ; O_n [ O_u + 2 ] = O_v . z ; O_n [ O_u + 3 ] = 0 ; let O_b = O_o . O_b ; var O_x = normalize ( O_b - O_v ) ; O_n [ O_u + 4 ] = O_x . x ; O_n [ O_u + 5 ] = O_x . y ; O_n [ O_u + 6 ] = O_x . z ; O_n [ O_u + 7 ] = 0 ; } fn O_w ( ) -> f32 { let O_y : f32 = 1664525.0 ; let O_z : f32 = 1013904223.0 ; let O_aa : f32 = 4294967296.0 ; let O_ab = fract ( ( O_y * O_l + O_z ) / O_aa ) ; O_l = 100000 * O_ab ; return O_ab ; } ";Vn.addShaderCode(Qz);var eH="struct O_a { O_b : vec3 < f32 > , O_c : vec3 < f32 > , O_d : vec3 < f32 > , O_e : vec3 < f32 > , O_f : vec3 < f32 > , O_g : f32 , O_h : f32 , O_i : f32 , O_j : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_k : array < f32 > ; @ group ( 0 ) @ binding ( 1 ) var < uniform > O_l : O_a ; @ group ( 0 ) @ binding ( 2 ) var < uniform > O_m : f32 ; override Image_Width : u32 ; override Image_Height : u32 ; var < private > O_n : f32 ; @ compute @ workgroup_size ( 32 , 32 ) fn main ( @ builtin ( global_invocation_id ) O_o : vec3 < u32 > , ) { if ( O_o . x >= Image_Width || O_o . y >= Image_Height ) { return ; } let O_p = O_o . x + O_o . y * Image_Width ; let O_q = Image_Width * Image_Height * 8 - u32 ( O_p ) * 8 - 8 ; O_n = f32 ( O_p ) * O_m ; var O_r = O_l . O_c ; O_r = O_r + ( f32 ( O_o . x ) + O_s ( ) ) * O_l . O_d ; O_r = O_r + ( f32 ( O_o . y ) + O_s ( ) ) * O_l . O_e ; O_k [ O_q ] = O_r . x ; O_k [ O_q + 1 ] = O_r . y ; O_k [ O_q + 2 ] = O_r . z ; O_k [ O_q + 3 ] = 0 ; let O_b = O_l . O_b ; var O_t = normalize ( O_b - O_r ) ; O_k [ O_q + 4 ] = O_t . x ; O_k [ O_q + 5 ] = O_t . y ; O_k [ O_q + 6 ] = O_t . z ; O_k [ O_q + 7 ] = 0 ; } fn O_s ( ) -> f32 { let O_u : f32 = 1664525.0 ; let O_v : f32 = 1013904223.0 ; let O_w : f32 = 4294967296.0 ; let O_x = fract ( ( O_u * O_n + O_v ) / O_w ) ; O_n = 100000 * O_x ; return O_x ; } fn O_y ( O_z : vec3f , O_aa : vec3f , O_ab : vec3f , O_ac : f32 , ) -> vec3f { let O_ad = 2.0 * 3.1415926 * O_s ( ) ; let O_ae = O_s ( ) * O_ac ; let O_af = O_ae * cos ( O_ad ) ; let O_ag = O_ae * sin ( O_ad ) ; return O_z + O_af * O_aa + O_ag * O_ab ; } ";Vn.addShaderCode(eH);var tH="struct O_a { O_b : vec3 < f32 > , O_c : vec3 < f32 > , O_d : vec3 < f32 > , O_e : vec3 < f32 > , O_f : vec3 < f32 > , O_g : f32 , O_h : f32 , O_i : f32 , O_j : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_k : array < f32 > ; @ group ( 0 ) @ binding ( 1 ) var < uniform > O_l : O_a ; override Image_Width : u32 ; override Image_Height : u32 ; @ compute @ workgroup_size ( 32 , 32 ) fn main ( @ builtin ( global_invocation_id ) O_m : vec3 < u32 > , ) { if ( O_m . x >= Image_Width || O_m . y >= Image_Height ) { return ; } let O_n = O_m . x + O_m . y * Image_Width ; let O_o = Image_Width * Image_Height * 8 - u32 ( O_n ) * 8 ; var O_p = O_l . O_c ; O_p = O_p + f32 ( O_m . x ) * O_l . O_d ; O_p = O_p + f32 ( O_m . y ) * O_l . O_e ; O_k [ O_o ] = O_p . x ; O_k [ O_o + 1 ] = O_p . y ; O_k [ O_o + 2 ] = O_p . z ; O_k [ O_o + 3 ] = 0 ; let O_b = O_l . O_b ; var O_q = normalize ( O_b - O_p ) ; O_k [ O_o + 4 ] = O_q . x ; O_k [ O_o + 5 ] = O_q . y ; O_k [ O_o + 6 ] = O_q . z ; O_k [ O_o + 7 ] = 0 ; } ";Vn.addShaderCode(tH);var iH="struct O_a { O_b : f32 , } struct O_c { O_d : vec3 < f32 > , O_e : vec3 < f32 > , O_f : f32 , } struct O_g { O_e : vec3 < f32 > , O_h : vec3 < f32 > , O_i : vec3 < f32 > , O_j : vec3 < f32 > , O_k : vec3 < f32 > , O_l : f32 , O_m : f32 , O_n : f32 , O_o : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_p : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 1 ) var < storage , read > O_q : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 2 ) var < storage , read > O_r : array < O_c > ; @ group ( 0 ) @ binding ( 3 ) var < uniform > O_s : O_a ; @ group ( 0 ) @ binding ( 4 ) var < uniform > O_t : O_g ; override Image_Width : u32 ; override Image_Height : u32 ; @ compute @ workgroup_size ( 32 , 32 ) fn main ( @ builtin ( global_invocation_id ) O_u : vec3 < u32 > , ) { if ( O_u . x >= Image_Width || O_u . y >= Image_Height ) { return ; } let O_v = O_u . x + O_u . y * u32 ( Image_Width ) ; let O_w : f32 = O_t . O_l ; let O_x : f32 = O_t . O_m ; let O_y : f32 = O_t . O_n ; let O_z : f32 = ( O_x * O_y ) / ( O_y - O_x ) ; var O_aa : f32 = O_r [ O_v ] . O_f ; if ( O_aa == - 1.0 ) { O_aa = O_z ; } let O_ab : f32 = abs ( O_w * ( O_x / O_aa ) * ( ( O_z - O_aa ) / ( O_z - O_x ) ) ) ; var O_ac = i32 ( O_ab / O_t . O_o / 2.0 ) / 2 ; if ( O_ac > 50 ) { O_ac = 38 ; } var O_ad = O_ac * 2 ; let O_ae = vec2 < i32 > ( i32 ( i32 ( O_u . x ) - O_ac ) , i32 ( i32 ( O_u . y ) - O_ac ) ) ; var O_af : vec3 < f32 > = vec3 < f32 > ( 0 ) ; var O_ag : f32 = 0.0 ; for ( var O_ah : i32 = 0 ; O_ah < O_ad ; O_ah = O_ah + 1 ) { for ( var O_ai : i32 = 0 ; O_ai < O_ad ; O_ai = O_ai + 1 ) { let O_aj = O_ae + vec2 < i32 > ( O_ah , O_ai ) ; if ( O_aj . x < 0 || O_aj . y < 0 || O_aj . x >= i32 ( Image_Width ) || O_aj . y >= i32 ( Image_Height ) ) { continue ; } O_af = O_af + O_q [ O_aj . x + O_aj . y * i32 ( Image_Width ) ] ; O_ag = O_ag + 1 ; } } if ( O_ag == 0.0 ) { O_p [ O_v ] = O_q [ O_v ] ; } else { O_p [ O_v ] = O_af / O_ag ; } } ";Vn.addShaderCode(iH);var rH="struct O_a { O_b : vec3 < f32 > , O_c : vec3 < f32 > , O_d : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read > O_e : array < O_a > ; @ group ( 0 ) @ binding ( 1 ) var < storage , read_write > O_f : array < vec3 < f32 > > ; override Image_Width : u32 ; override Image_Height : u32 ; @ compute @ workgroup_size ( 32 , 32 ) fn main ( @ builtin ( global_invocation_id ) O_g : vec3 < u32 > , ) { if ( O_g . x >= Image_Width || O_g . y >= Image_Height ) { return ; } var O_h = O_g . x + O_g . y * u32 ( Image_Width ) ; O_f [ O_h ] = O_e [ O_h ] . O_b ; } ";Vn.addShaderCode(rH);var sH="struct O_a { O_b : f32 , O_c : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_d : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 1 ) var < storage , read > O_e : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 2 ) var < storage , read_write > O_f : array < vec3 < f32 > > ; @ group ( 0 ) @ binding ( 3 ) var < storage , read_write > O_g : array < vec2 < f32 > > ; @ group ( 0 ) @ binding ( 4 ) var < uniform > O_h : O_a ; override Image_Width : u32 ; override Image_Height : u32 ; override Workgroup_Size : u32 ; @ compute @ workgroup_size ( Workgroup_Size ) fn main ( @ builtin ( global_invocation_id ) O_i : vec3 < u32 > , ) { let O_j = u32 ( O_h . O_c ) + O_i . x ; let O_k = O_g [ O_j ] ; let O_l = vec2 < u32 > ( u32 ( O_k . x ) , u32 ( O_k . y ) ) ; if ( O_l . x >= Image_Width || O_l . y >= Image_Height ) { return ; } var O_m = O_l . x + O_l . y * u32 ( Image_Width ) ; O_d [ O_m ] = O_d [ O_m ] + O_e [ O_m ] ; O_f [ O_m ] = O_d [ O_m ] / O_h . O_b ; } ";Vn.addShaderCode(sH);var nH="struct O_a { O_b : f32 , O_c : f32 , O_d : f32 , O_e : f32 , O_f : f32 , O_g : f32 , O_h : f32 , } struct O_i { O_j : f32 , O_k : f32 , O_l : f32 , O_m : f32 , O_n : f32 , } struct O_o { O_p : f32 , O_k : f32 , O_q : f32 , O_r : f32 , O_s : f32 , O_t : f32 , O_u : f32 , O_v : f32 , O_w : f32 , O_x : f32 , } @ group ( 0 ) @ binding ( 0 ) var < storage , read_write > O_y : array < O_z > ; @ group ( 0 ) @ binding ( 1 ) var < uniform > O_aa : O_ab ; @ group ( 0 ) @ binding ( 2 ) var < uniform > O_ac : O_ad ; @ group ( 0 ) @ binding ( 3 ) var < uniform > O_ae : O_a ; @ group ( 0 ) @ binding ( 4 ) var < uniform > O_af : O_i ; @ group ( 0 ) @ binding ( 5 ) var < uniform > O_ag : O_o ; @ group ( 0 ) @ binding ( 6 ) var O_ah : texture_2d < f32 > ; @ group ( 0 ) @ binding ( 7 ) var < uniform > O_ai : O_aj ; @ group ( 1 ) @ binding ( 0 ) var O_ak : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 1 ) var O_al : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 2 ) var O_am : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 3 ) var O_an : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 4 ) var O_ao : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 5 ) var O_ap : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 6 ) var O_aq : texture_2d < f32 > ; @ group ( 1 ) @ binding ( 7 ) var < storage , read > O_ar : array < O_as > ; @ group ( 2 ) @ binding ( 0 ) var < storage , read > O_at : array < O_au > ; @ group ( 2 ) @ binding ( 1 ) var < storage , read > O_av : array < f32 > ; @ group ( 2 ) @ binding ( 2 ) var < storage , read > O_aw : array < O_ax > ; @ group ( 2 ) @ binding ( 3 ) var < storage , read > O_ay : array < vec3 < f32 > > ; @ group ( 2 ) @ binding ( 4 ) var < storage , read > O_az : array < O_ba > ; @ group ( 2 ) @ binding ( 5 ) var < storage , read > O_bb : array < f32 > ; @ group ( 2 ) @ binding ( 6 ) var < storage , read_write > O_bc : array < f32 , 2 > ; @ group ( 2 ) @ binding ( 7 ) var < uniform > O_bd : O_be ; @ group ( 2 ) @ binding ( 8 ) var < uniform > O_bf : vec2 < f32 > ; @ group ( 3 ) @ binding ( 0 ) var O_bg : texture_2d < f32 > ; @ group ( 3 ) @ binding ( 1 ) var < storage , read_write > O_bh : array < vec2 < f32 > > ; override Hide_Occluder : bool ; override Image_Width : u32 ; override Image_Height : u32 ; override Workgroup_Size : u32 ; const O_bi : f32 = 3.14159265359 ; const O_bj : f32 = 2.718281828459045 ; const O_bk : f32 = O_bi * 2.0 ; const O_bl : u32 = 10 ; const O_bm : bool = true ; const O_bn : f32 = 1.4426950408889634 ; const O_bo : bool = true ; const O_bp : u32 = 0 ; const O_bq : u32 = 1 ; const O_br : u32 = 2 ; const O_bs : u32 = 3 ; const O_bt : u32 = 0 ; const O_bu : u32 = 1 ; const O_bv : u32 = 2 ; const O_bw : u32 = 3 ; const O_bx : u32 = 4 ; const O_by : u32 = 5 ; const O_bz : u32 = 6 ; const O_ca : u32 = 7 ; const O_cb : u32 = 8 ; const O_cc : u32 = 9 ; const O_cd : u32 = 10 ; const O_ce : u32 = 11 ; const O_cf : u32 = 12 ; const O_cg : u32 = 13 ; const O_ch : u32 = 14 ; const O_ci : u32 = 15 ; const O_cj : u32 = 16 ; const O_ck : u32 = 17 ; const O_cl : u32 = 18 ; const O_cm : u32 = 19 ; const O_cn : u32 = 20 ; const O_co : u32 = 20 ; const O_cp = 30 ; const O_cq : i32 = 1 ; const O_cr : i32 = 2 ; const O_cs : i32 = 3 ; const O_ct : i32 = 4 ; const O_cu : i32 = 5 ; var < private > O_cv : vec2 < u32 > ; var < private > O_cw : u32 ; var < private > O_cx : f32 ; var < private > O_cy : bool = false ; var < private > O_cz : u32 = 0 ; fn O_da ( O_db : vec3 < u32 > , ) { O_dc ( O_db ) ; O_dd ( ) ; } fn O_dc ( O_db : vec3 < u32 > , ) { let O_de = u32 ( O_aa . O_df ) + O_db . x ; let O_dg = O_bh [ O_de ] ; O_cv = vec2 < u32 > ( u32 ( O_dg . x ) , u32 ( O_dg . y ) ) ; O_cw = O_cv . x + O_cv . y * Image_Width ; } @ compute @ workgroup_size ( Workgroup_Size ) fn main ( @ builtin ( global_invocation_id ) O_db : vec3 < u32 > , ) { let O_de = u32 ( O_aa . O_df ) + O_db . x ; if ( O_de >= Image_Width * Image_Height ) { return ; } O_da ( O_db ) ; if ( O_cv . x >= Image_Width || O_cv . y >= Image_Height ) { return ; } let O_dh = O_di ( ) ; let O_dj = O_dk ( O_dh ) ; let O_dl = O_dj . O_dl ; O_dm ( O_dl ) ; } const O_dn : u32 = 0 ; const O_do : u32 = 1 ; const O_dp : u32 = 2 ; const O_dq : u32 = 3 ; struct O_dr { O_ds : u32 , O_dt : f32 , O_du : f32 , O_dv : f32 , O_dw : f32 , O_dx : f32 , O_dy : f32 , O_dz : vec3 < f32 > , O_ea : vec3 < f32 > , O_eb : vec3 < f32 > , O_ec : vec3 < f32 > , O_ed : vec3 < f32 > , O_dl : vec3 < f32 > , O_ee : f32 , } fn O_ef ( ) -> O_dr { let O_eg = vec3 < f32 > ( 0 ) ; return O_dr ( 0 , 0 , 0 , 0 , 0 , 0 , 0 , O_eg , O_eg , O_eg , O_eg , O_eg , O_eg , 0 ) ; } fn O_eh ( O_dh : O_au , O_ei : bool , ) -> O_dr { var O_dj = O_ef ( ) ; let O_ej = O_ek ( O_dh , O_ei ) ; if ( O_ej . O_el < 0.0 ) { O_dj . O_ds = O_dn ; O_dj . O_dl = O_em ( O_dh ) ; return O_dj ; } O_dj . O_ed = O_en ( O_dh , O_ej . O_el ) ; O_dj . O_eb = normalize ( O_ej . O_ec ) ; if ( O_ej . O_eo == O_cu ) { O_dj . O_ds = O_do ; O_dj . O_dl = O_ep ( ) ; return O_dj ; } let O_eq = O_ar [ O_ej . O_eq ] ; O_dj . O_dw = O_eq . O_dw ; O_dj . O_dx = O_eq . O_dx ; O_dj . O_dy = O_eq . O_dy ; O_dj . O_dz = O_eq . O_dz ; if ( O_eq . O_er > 0.0 ) { let O_ec = O_es ( O_dj . O_ed , O_dj . O_eb , O_eq . O_er , O_eq . O_et ) ; if ( O_eu ( O_dh . O_ev , O_ec ) ) { O_dj . O_ds = O_dp ; return O_dj ; } O_dj . O_ec = O_ec ; } else { O_dj . O_ec = O_dj . O_eb ; } if ( O_eq . O_ew > 0.0 ) { O_dj . O_dt = O_ex ( O_dj . O_ed , O_dj . O_eb , O_eq . O_ew , O_eq . O_ey ) . x ; } else { O_dj . O_dt = O_eq . O_dt ; } if ( O_eq . O_ez > 0.0 ) { O_dj . O_ea = O_ex ( O_dj . O_ed , O_dj . O_eb , O_eq . O_ez , O_eq . O_fa ) ; } else { O_dj . O_ea = O_eq . O_ea ; } if ( O_eq . O_fb > 0.0 ) { O_dj . O_dv = O_ex ( O_dj . O_ed , O_dj . O_eb , O_eq . O_fb , O_eq . O_fc ) . x ; } else { O_dj . O_dv = O_eq . O_dv ; } O_dj . O_ee = O_fd ( O_dj . O_ec , - O_dh . O_ev ) ; O_dj . O_ds = O_dq ; return O_dj ; } fn O_fe ( O_ed : vec3 < f32 > , O_ec : vec3 < f32 > , O_ff : f32 , O_fg : f32 , ) -> f32 { let O_fh = O_ex ( O_ed , O_ec , O_ff , O_fg ) ; let O_dv = ( O_fh . x / 255.0 ) - 0.5 ; return O_dv ; } fn O_fi ( O_ed : vec3 < f32 > , O_ec : vec3 < f32 > , O_ff : f32 , O_fg : f32 , ) -> vec3 < f32 > { let O_fh = O_ex ( O_ed , O_ec , O_ff , O_fg ) ; return O_fh / 255.0 ; } fn O_fj ( O_ed : vec3 < f32 > , O_ec : vec3 < f32 > , O_ff : f32 , O_fg : f32 , ) -> f32 { let O_fh = O_ex ( O_ed , O_ec , O_ff , O_fg ) ; let O_dv = O_fh . x / 255.0 ; return O_dv * O_dv * O_dv ; } fn O_es ( O_ed : vec3 < f32 > , O_ec : vec3 < f32 > , O_ff : f32 , O_fg : f32 , ) -> vec3 < f32 > { let O_fh = O_ex ( O_ed , O_ec , O_ff , O_fg ) ; let O_fk = normalize ( O_fh ) ; let O_fl = normalize ( cross ( O_ec , vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ) ) ; let O_fm = normalize ( cross ( O_ec , O_fl ) ) ; let O_fn = mat3x3 < f32 > ( O_fl , O_ec , O_fm ) ; let O_fo = normalize ( O_fn * O_fk ) ; return O_fo ; } fn O_ex ( O_ed : vec3 < f32 > , O_ec : vec3 < f32 > , O_ff : f32 , O_fg : f32 , ) -> vec3f { let O_fp = vec2 < i32 > ( i32 ( ( O_ff % 8.0 ) * 2048 ) , i32 ( floor ( O_ff / 8.0 ) ) * 2048 ) ; var O_fq = vec2 < i32 > ( O_fr ( O_ed . x , O_fg ) , O_fr ( O_ed . y , O_fg ) ) + O_fp ; var O_fs = vec2 < i32 > ( O_fr ( O_ed . x , O_fg ) , O_fr ( O_ed . z , O_fg ) ) + O_fp ; var O_ft = vec2 < i32 > ( O_fr ( O_ed . y , O_fg ) , O_fr ( O_ed . z , O_fg ) ) + O_fp ; var O_fu : vec3 < f32 > ; var O_fv : vec3 < f32 > ; var O_fw : vec3 < f32 > ; let O_fx = u32 ( floor ( O_ff / 32.0 ) ) ; if ( O_fx == 0 ) { O_fu = textureLoad ( O_ak , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_ak , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_ak , O_ft , 0 ) . rgb ; } else if ( O_fx == 1 ) { O_fu = textureLoad ( O_al , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_al , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_al , O_ft , 0 ) . rgb ; } else if ( O_fx == 2 ) { O_fu = textureLoad ( O_am , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_am , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_am , O_ft , 0 ) . rgb ; } else if ( O_fx == 3 ) { O_fu = textureLoad ( O_an , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_an , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_an , O_ft , 0 ) . rgb ; } else if ( O_fx == 4 ) { O_fu = textureLoad ( O_ao , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_ao , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_ao , O_ft , 0 ) . rgb ; } else if ( O_fx == 5 ) { O_fu = textureLoad ( O_ap , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_ap , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_ap , O_ft , 0 ) . rgb ; } else if ( O_fx == 6 ) { O_fu = textureLoad ( O_aq , O_fq , 0 ) . rgb ; O_fv = textureLoad ( O_aq , O_fs , 0 ) . rgb ; O_fw = textureLoad ( O_aq , O_ft , 0 ) . rgb ; } var O_fy = abs ( O_ec ) ; O_fy = O_fy / ( O_fy . x + O_fy . y + O_fy . z ) ; let O_fz = O_fu * O_fy . z + O_fv * O_fy . y + O_fw * O_fy . x ; return O_fz ; } fn O_fr ( O_ga : f32 , step : f32 , ) -> i32 { var O_gb = O_ga % step ; if ( O_gb < 0.0 ) { O_gb += step ; } return i32 ( 2048.0 * ( O_gb / step ) ) ; } fn O_gc ( ) -> O_gd { return O_ge ( ) ; } fn O_ge ( ) -> O_gd { var O_gf = O_ai ; return O_gd ( O_gf . O_ed + O_gg ( ) * O_gf . O_gh + O_gg ( ) * O_gf . O_eg , O_gf . O_dl * O_gf . O_gi ) ; } fn O_gj ( O_dh : O_au , ) -> bool { var O_gf = O_ai ; let O_gk = O_gf . O_ed + O_gf . O_gh + O_gf . O_eg ; let O_gl = O_gf . O_ed + O_gf . O_gh - O_gf . O_eg ; let O_gm = O_gf . O_ed - O_gf . O_gh + O_gf . O_eg ; let O_gn = O_gf . O_ed - O_gf . O_gh - O_gf . O_eg ; return O_go ( O_dh , O_gk , O_gl , O_gm , O_gn ) ; } fn O_ep ( ) -> vec3 < f32 > { return O_ai . O_dl * O_ai . O_gi ; } fn O_gp ( O_gq : vec3 < f32 > , ) -> vec3 < f32 > { var O_dl : vec3 < f32 > = O_gq ; if ( O_dl . x > 1.0 ) { O_dl . x = 1.0 ; } if ( O_dl . y > 1.0 ) { O_dl . y = 1.0 ; } if O_dl . z > 1.0 { O_dl . z = 1.0 ; } if ( O_dl . x < 0.0 ) { O_dl . x = 0.0 ; } if ( O_dl . y < 0.0 ) { O_dl . y = 0.0 ; } if ( O_dl . z < 0.0 ) { O_dl . z = 0.0 ; } return O_dl ; } fn O_di ( ) -> O_au { O_gg ( ) ; O_gg ( ) ; return O_at [ O_cw ] ; } fn O_gr ( O_gs : vec3 < f32 > , O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , ) -> vec3 < f32 > { let O_gw = O_gu - O_gt ; let O_gx = O_gv - O_gt ; let O_gy = O_gs - O_gt ; let O_gz = dot ( O_gw , O_gw ) ; let O_ha = dot ( O_gw , O_gx ) ; let O_hb = dot ( O_gx , O_gx ) ; let O_hc = dot ( O_gy , O_gw ) ; let O_hd = dot ( O_gy , O_gx ) ; let O_he = O_gz * O_hb - O_ha * O_ha ; let O_eg = ( O_hb * O_hc - O_ha * O_hd ) / O_he ; let O_hf = ( O_gz * O_hd - O_ha * O_hc ) / O_he ; let O_gh = 1.0 - O_eg - O_hf ; return vec3 < f32 > ( O_gh , O_eg , O_hf ) ; } fn O_hg ( O_hh : O_hi , O_ec : array < vec3 < f32 > , 3 > , O_hj : vec3 < f32 > , ) -> vec3 < f32 > { let O_hk = O_gr ( O_hj , O_hh . O_gw , O_hh . O_gx , O_hh . O_gy ) ; return normalize ( O_hk . x * O_ec [ 0 ] + O_hk . y * O_ec [ 1 ] + O_hk . z * O_ec [ 2 ] ) ; } fn O_dm ( O_dl : vec3 < f32 > , ) { if ( O_cy ) { return ; } O_y [ O_cw ] . O_ds = O_dl ; O_cy = true ; } fn O_hl ( O_dj : O_dr , ) { if ( O_dj . O_ds != O_dn ) { O_y [ O_cw ] . O_hm = length ( O_dj . O_ed - O_at [ O_cw ] . O_hn ) ; } else { O_y [ O_cw ] . O_hm = - 1 ; } } fn O_ho ( O_hp : vec3 < f32 > , ) { var O_ec = normalize ( O_hp ) ; O_ec = O_ec + vec3 < f32 > ( 1.0 ) ; O_ec = O_ec * 0.5 ; O_dm ( O_ec ) ; } fn O_hq ( ) { O_dm ( vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ) ; } fn O_hr ( ) { O_dm ( vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ) ; } fn O_hs ( O_ga : u32 , O_ht : u32 , ) { let O_hu = f32 ( O_ga ) / f32 ( O_ht ) ; O_dm ( vec3 < f32 > ( O_hu , O_hu , O_hu ) ) ; } fn O_hv ( O_dl : u32 , ) { let O_hw = 1.0 / f32 ( O_dl + 1 ) ; O_dm ( vec3 < f32 > ( O_hw , O_hw , O_hw ) ) ; } fn O_hx ( O_dl : vec3 < f32 > , ) -> bool { return O_dl . x > 0.0 && O_dl . y > 0.0 && O_dl . z > 0.0 ; } fn O_hy ( O_gq : vec3 < f32 > , ) -> vec3 < f32 > { var O_dl : vec3 < f32 > = O_gq ; let O_hz : f32 = 1.0 / 2.2 ; O_dl . x = pow ( O_dl . x , O_hz ) ; O_dl . y = pow ( O_dl . y , O_hz ) ; O_dl . z = pow ( O_dl . z , O_hz ) ; return O_dl ; } fn O_dd ( ) { let O_ia = O_aa . O_cx ; O_cx = O_ia * ( f32 ( O_cw ) / f32 ( Image_Width * Image_Height ) ) ; O_cx = O_ib ( O_cx ) ; } fn O_gg ( ) -> f32 { let O_ic = O_id ( O_cx ) ; O_cx = O_ic ; return O_ic ; } fn O_ie ( O_ia : f32 , ) -> f32 { var O_if = u32 ( O_ia * 1e6 ) ; O_if ^= O_if << 13 ; O_if ^= O_if >> 17 ; O_if ^= O_if << 5 ; return f32 ( O_if ) * 2.3283064e-10 ; } fn O_ig ( O_ia : f32 , ) -> f32 { var O_gw = u32 ( O_ia * 1e6 ) ; var O_gx = u32 ( O_ia * 1e6 + 1.0 ) ; var O_ih = 0u ; for ( var O_ii = 0u ; O_ii < 4u ; O_ii ++ ) { O_ih += 0x9e3779b9u ; O_gw += ( ( O_gx << 4u ) + 0xa341316cu ) ^ ( O_gx + O_ih ) ^ ( ( O_gx >> 5u ) + 0xc8013ea4u ) ; O_gx += ( ( O_gw << 4u ) + 0xad90777du ) ^ ( O_gw + O_ih ) ^ ( ( O_gw >> 5u ) + 0x7e95761eu ) ; } return f32 ( O_gw ^ O_gx ) / 4294967296.0 ; } fn O_ij ( O_ia : f32 , ) -> f32 { var O_if = u32 ( O_ia * 1e6 ) ; O_if = O_if * 0x53a2f814u + 0x74736975u ; O_if = ( O_if ^ ( O_if >> 16 ) ) * 0x7feb352du ; O_if = ( O_if ^ ( O_if >> 15 ) ) * 0x846ca68bu ; return f32 ( O_if ^ ( O_if >> 16 ) ) / 4294967296.0 ; } fn O_id ( O_ia : f32 , ) -> f32 { let O_gt : f32 = 1664525.0 ; let O_gv : f32 = 1013904223.0 ; let O_ik : f32 = 4294967296.0 ; return fract ( ( O_gt * O_ia * 100000.0 + O_gv ) / O_ik ) ; } fn O_il ( O_ia : f32 , ) -> f32 { var O_if = u32 ( O_ia * 1e6 ) ; O_if = O_if * 747796405u + 2891336453u ; let O_im = ( ( O_if >> ( ( O_if >> 28u ) + 4u ) ) ^ O_if ) * 277803737u ; return f32 ( ( O_im >> 22u ) ^ O_im ) / 4294967296.0 ; } fn O_ib ( O_ia : f32 , ) -> f32 { return fract ( sin ( O_ia * 43758.5453 ) * 12345.6789 ) ; } fn O_in ( ) -> f32 { return 2.0 * O_gg ( ) - 1.0 ; } fn O_io ( ) -> f32 { return O_in ( ) * O_bi ; } fn O_ip ( min : f32 , max : f32 , ) -> f32 { return min + ( max - min ) * O_gg ( ) ; } fn O_iq ( ) -> vec3 < f32 > { while ( true ) { let O_ir = normalize ( vec3 < f32 > ( O_is ( ) , O_is ( ) , O_is ( ) ) ) ; if ( length ( O_ir ) != 0 ) { return O_ir ; } } return vec3 < f32 > ( 0 ) ; } fn O_is ( ) -> f32 { return sqrt ( - 2 * log ( O_gg ( ) ) ) * cos ( 2 * O_bi * O_gg ( ) ) ; } const O_it = 0 ; const O_iu = 1 ; const O_iv = 2 ; const O_iw = true ; fn O_ix ( O_dj : O_dr , ) -> u32 { if ( O_gg ( ) < O_dj . O_dw && O_gg ( ) < O_iy ( O_dj . O_ee , O_dj . O_dy ) ) { return O_iv ; } if ( O_gg ( ) < O_dj . O_dt ) { return O_iu ; } else { return O_it ; } } fn O_dk ( O_iz : O_au , ) -> O_dr { var O_ja = O_eh ( O_iz , true ) ; if ( O_ja . O_ds != O_dq ) { return O_ja ; } var O_jb = O_iz . O_ev ; if ( O_iw ) { O_ja . O_dl = O_jc ( O_ja , O_jb ) ; } let O_jd = i32 ( O_aa . O_jd ) ; var O_je = vec3f ( 1 ) ; var O_dj = O_ja ; for ( var O_ii = 0 ; O_ii < O_jd ; O_ii += 1 ) { let O_jf : u32 = O_ix ( O_dj ) ; if ( O_jf == O_it ) { O_jb = O_iq ( ) ; if ( ! O_eu ( O_dj . O_ec , O_jb ) ) { O_jb = - O_jb ; } O_je *= O_jg ( O_dj . O_ea , O_dj . O_ec , O_jb ) ; } else { var O_ec = O_jh ( O_dj . O_ec , select ( 0.000001 , O_dj . O_dv , O_jf == O_iu ) ) ; if ( O_eu ( O_ec , O_jb ) ) { break ; } O_jb = O_ji ( O_jb , O_ec ) ; if ( ! O_eu ( O_dj . O_ec , O_jb ) ) { break ; } if ( O_jf == O_iu ) { O_je *= O_jj ( O_dj . O_ee , O_dj . O_ea ) ; } } if ( ! O_eu ( O_dj . O_eb , O_jb ) ) { break ; } O_dj = O_eh ( O_au ( O_dj . O_ed + 0.001 * O_jb , O_jb ) , ! O_iw ) ; if ( O_dj . O_ds != O_dq ) { O_ja . O_dl += O_dj . O_dl * O_je ; return O_ja ; } if ( O_iw ) { O_ja . O_dl += O_jc ( O_dj , O_jb ) * O_je ; } } return O_ja ; } fn O_jc ( O_dj : O_dr , O_jb : vec3f , ) -> vec3 < f32 > { let O_gf = O_gc ( ) ; let O_jk = normalize ( O_gf . O_ed - O_dj . O_ed ) ; if ( ! O_eu ( O_jk , O_dj . O_ec ) || ! O_jl ( O_au ( O_dj . O_ed + O_jk * 0.001 , O_jk ) ) ) { return vec3f ( 0 ) ; } var O_dl : vec3 < f32 > ; let O_jm = normalize ( O_gf . O_ed - O_dj . O_ed ) ; let O_eg = - O_jb ; let O_jn = normalize ( O_jm + O_eg ) ; let O_jo = max ( dot ( O_dj . O_ec , O_jn ) , 0.0 ) ; let O_jp = O_jq ( O_dj . O_dx * O_dj . O_dx , O_jo ) ; let O_jr = O_dj . O_dw * O_iy ( O_dj . O_ee , O_dj . O_dy ) ; O_dl = O_dl + O_jj ( O_dj . O_ee , O_dj . O_dz ) * O_gf . O_dl * O_jp * O_jr ; let O_js = O_jq ( O_dj . O_dv * O_dj . O_dv , O_jo ) ; let O_jt = ( 1.0 - O_jr ) * O_dj . O_dt ; O_dl = O_dl + O_jj ( O_dj . O_ee , O_dj . O_ea ) * O_gf . O_dl * O_js * O_jt ; let O_ju = ( 1.0 - O_jr ) * ( 1 - O_dj . O_dt ) ; if ( O_aa . O_jv == 0.0 ) { O_dl = O_dl + O_jg ( O_dj . O_ea , O_dj . O_ec , O_jk ) * O_gf . O_dl * O_ju ; } else { O_dl = O_dl + O_jw ( O_dj . O_ea , O_dj . O_dv , O_dj . O_ec , O_eg , O_jm , O_jn ) * O_gf . O_dl * O_ju ; } return O_dl ; } fn O_jw ( O_dl : vec3 < f32 > , O_dv : f32 , O_jx : vec3 < f32 > , O_eg : vec3 < f32 > , O_jm : vec3 < f32 > , O_jn : vec3 < f32 > , ) -> vec3 < f32 > { let O_jy = dot ( O_jn , O_jm ) ; let O_jz = 0.5 + 2.0 * O_dv * O_jy * O_jy ; let O_ka = ( O_dl / O_bi ) * ( 1.0 + ( O_jz - 1.0 ) * pow ( 1.0 - dot ( O_jx , O_eg ) , 5.0 ) ) * ( 1.0 + ( O_jz - 1.0 ) * pow ( 1.0 - dot ( O_jx , O_jm ) , 5.0 ) ) ; return O_ka ; } fn O_jg ( O_ea : vec3 < f32 > , O_ec : vec3 < f32 > , O_jk : vec3 < f32 > , ) -> vec3 < f32 > { return O_ea * dot ( O_jk , O_ec ) ; } fn O_jj ( O_kb : f32 , O_kc : vec3 < f32 > , ) -> vec3 < f32 > { return O_kc + ( vec3 < f32 > ( 1.0 ) - O_kc ) * pow ( 1.0 - O_kb , 5.0 ) ; } fn O_iy ( O_kb : f32 , O_kc : f32 , ) -> f32 { return O_kc + ( 1.0 - O_kc ) * pow ( 1.0 - O_kb , 5.0 ) ; } fn O_jh ( O_jx : vec3 < f32 > , O_dv : f32 , ) -> vec3 < f32 > { var O_jo : f32 = O_kd ( O_dv ) ; return O_ke ( O_jx , O_jo ) ; } fn O_jq ( O_kf : f32 , O_jo : f32 , ) -> f32 { let O_kg : f32 = ( O_jo * O_kf - O_jo ) * O_jo + 1.0 ; return O_kf / ( O_bi * O_kg * O_kg ) ; } fn O_kd ( O_kh : f32 , ) -> f32 { if ( O_kh > 0.99999 ) { return O_gg ( ) ; } if ( O_kh < 0.00001 ) { return 1.0 ; } let O_ki = O_kh * O_kh ; let O_kj = O_ip ( O_ki , 1.0 ) ; return sqrt ( ( 1.0 - sqrt ( O_ki / O_kj ) ) / ( 1.0 - O_kh ) ) ; } fn O_ke ( O_kk : vec3 < f32 > , O_jo : f32 , ) -> vec3 < f32 > { let O_jx = normalize ( O_kk ) ; if ( O_jo == 1.0 ) { return O_jx ; } var O_eg : vec3 < f32 > ; if abs ( O_jx . x ) < 0.9 { O_eg = cross ( O_jx , vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ) ; } else { O_eg = cross ( O_jx , vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ) ; } O_eg = normalize ( O_eg ) ; let O_gh = cross ( O_jx , O_eg ) ; let O_kl = O_io ( ) ; let O_kh = O_jo * O_jx + sqrt ( 1.0 - O_jo * O_jo ) * ( cos ( O_kl ) * O_eg + sin ( O_kl ) * O_gh ) ; return normalize ( O_kh ) ; } struct O_km { O_eo : i32 , O_el : f32 , O_ec : vec3 < f32 > , O_eq : u32 , } fn O_ek ( O_dh : O_au , O_ei : bool , ) -> O_km { var O_kn : O_ko = O_kp ( ) ; var O_eo : i32 = - 1 ; let O_kq = O_kr ( O_dh ) ; if O_kq . O_el > 0.0 && ( O_kn . O_el < 0.0 || O_kq . O_el < O_kn . O_el ) { O_kn = O_kq ; O_eo = O_cs ; } let O_ks = O_kt ( O_dh ) ; if O_ks . O_el > 0.0 && ( O_kn . O_el < 0.0 || O_ks . O_el < O_kn . O_el ) { O_kn = O_ks ; O_eo = O_ct ; } let O_ku = O_kv ( O_dh ) ; if O_ku . O_el > 0.0 && ( O_kn . O_el < 0.0 || O_ku . O_el < O_kn . O_el ) { O_kn = O_ku ; O_eo = O_cq ; } if ( ! Hide_Occluder ) { let O_kw = O_kx ( O_dh ) ; if O_kw . O_el > 0.0 && ( O_kn . O_el < 0.0 || O_kw . O_el < O_kn . O_el ) { O_kn = O_kw ; O_eo = O_cr ; } } if ( O_ei ) { let O_ky = O_kz ( O_dh ) ; if O_ky . O_el > 0.0 && ( O_kn . O_el < 0.0 || O_ky . O_el < O_kn . O_el ) { O_kn = O_ky ; O_eo = O_cu ; } } return O_km ( O_eo , O_kn . O_el , O_kn . O_ec , O_kn . O_eq ) ; } fn O_jl ( O_dh : O_au , ) -> bool { let O_ka = O_ek ( O_dh , true ) ; return ( O_ka . O_eo == O_cu || O_ka . O_el < 0.0 ) ; } fn O_kv ( O_dh : O_au , ) -> O_ko { let O_ka = O_la ( O_dh ) ; if ( O_ka . O_el < 0 ) { return O_kp ( ) ; } var O_eq : u32 ; if ( O_lb ( O_ka . O_lc ) ) { O_eq = u32 ( O_ag . O_k ) ; } else { O_eq = u32 ( O_ag . O_p ) ; } return O_ko ( O_ka . O_el , vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) , O_eq ) ; } fn O_lb ( O_lc : vec2f , ) -> bool { { let O_ld = O_ag . O_q / 2.0 ; let O_le = O_ag . O_r / 2.0 ; let O_lf = vec2f ( O_ld - O_ag . O_t , - O_le + O_ag . O_t ) ; let O_lg = O_lh ( O_lf . x - O_ag . O_w , O_lf . x , O_lf . y , O_lf . y + O_ag . O_x ) ; if ( O_li ( O_lg , O_lc ) ) { let O_lj = O_lg . O_lk - O_lg . O_ll ; let O_lm = O_lg . O_ln - O_lg . O_lo ; let O_lp = vec2f ( ( O_lc . x - O_lg . O_ll ) / O_lj , ( O_lc . y - O_lg . O_lo ) / O_lm ) ; let O_lq = vec2 < i32 > ( O_lp * vec2 < f32 > ( textureDimensions ( O_bg ) ) ) ; var O_dl = textureLoad ( O_bg , O_lq , 0 ) ; return O_dl . x < 0.5 ; } } { let O_ld = O_ag . O_q / 2.0 ; let O_le = O_ag . O_r / 2.0 ; var O_lr = O_lh ( - O_ld , O_ld , - O_le , O_le ) ; O_lr = O_ls ( O_lr , O_ag . O_t ) ; if ( ! O_li ( O_lr , O_lc ) ) { return false ; } } { let O_lt = O_ag . O_v ; var O_lu : f32 ; if ( O_lc . x < 0 ) { O_lu = ( O_lc . x - ( O_lc . x % O_lt ) ) - O_lt ; } else { O_lu = ( O_lc . x - ( O_lc . x % O_lt ) ) ; } var O_lv : f32 ; if ( O_lc . y < 0 ) { O_lv = ( O_lc . y - ( O_lc . y % O_lt ) ) - O_lt ; } else { O_lv = ( O_lc . y - ( O_lc . y % O_lt ) ) ; } var O_lg = O_lh ( O_lu , O_lu + O_lt , O_lv , O_lv + O_lt ) ; O_lg = O_ls ( O_lg , O_ag . O_u / 2.0 ) ; if ( ! O_li ( O_lg , O_lc ) ) { return true ; } } return false ; } struct O_lw { O_el : f32 , O_lc : vec2f , } fn O_la ( O_dh : O_au , ) -> O_lw { let O_lx = O_ly ( O_dh , O_lz ( ) ) ; let O_el = O_lx . O_el ; let O_ma = O_lx . O_lc . xz ; if ( O_el < 0 || O_mb ( O_ma ) ) { return O_lw ( - 1 , vec2f ( 0 ) ) ; } else { return O_lw ( O_el , O_ma ) ; } } fn O_mb ( O_ma : vec2 < f32 > , ) -> bool { let O_mc = vec2 < f32 > ( - O_ag . O_q / 2.0 , O_ag . O_r / 2.0 ) ; if ( O_ma . x > O_mc . x + O_ag . O_s && O_ma . x < O_mc . x + O_ag . O_q - O_ag . O_s ) { if ( O_ma . y > O_mc . y - O_ag . O_r && O_ma . y < O_mc . y ) { return false ; } } if ( O_ma . x > O_mc . x && O_ma . x < O_mc . x + O_ag . O_q ) { if ( O_ma . y > O_mc . y - O_ag . O_r + O_ag . O_s && O_ma . y < O_mc . y - O_ag . O_s ) { return false ; } } if ( length ( O_ma - ( O_mc + vec2f ( O_ag . O_s , - O_ag . O_s ) ) ) < O_ag . O_s ) { return false ; } if ( length ( O_ma - ( O_mc + vec2f ( O_ag . O_q - O_ag . O_s , - O_ag . O_s ) ) ) < O_ag . O_s ) { return false ; } if ( length ( O_ma - ( O_mc + vec2f ( O_ag . O_s , O_ag . O_s - O_ag . O_r ) ) ) < O_ag . O_s ) { return false ; } if ( length ( O_ma - ( O_mc + vec2f ( O_ag . O_q - O_ag . O_s , O_ag . O_s - O_ag . O_r ) ) ) < O_ag . O_s ) { return false ; } return true ; } fn O_lz ( ) -> O_md { return O_md ( vec3 < f32 > ( 0.0 , O_me ( ) , 0.0 ) , vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ) ; } fn O_me ( ) -> f32 { return O_av [ 1 ] ; } fn O_kr ( O_dh : O_au , ) -> O_ko { var O_mf : i32 = 0 ; var O_mg = array < u32 , O_cp > ( ) ; O_mg [ 0 ] = 0 ; var O_el = - 1.0 ; var O_ec : vec3 < f32 > ; var O_mh : u32 ; while ( O_mf >= 0 ) { let O_ff = O_mg [ O_mf ] ; O_mf -= 1 ; let O_lg = O_mi ( O_av [ O_ff ] , O_av [ O_ff + 1 ] , O_av [ O_ff + 2 ] , O_av [ O_ff + 3 ] , O_av [ O_ff + 4 ] , O_av [ O_ff + 5 ] ) ; let O_mj = O_mk ( O_dh , O_lg ) ; if ( O_mj < 0.0 || ( O_el > 0.0 && O_mj > O_el ) ) { continue ; } for ( var O_ii : u32 = 0 ; O_ii < 4 ; O_ii += 1 ) { var O_ml = O_av [ O_ff + 6 + O_ii ] ; if ( O_ml > 0.0 ) { O_mf += 1 ; if ( O_mf >= O_cp ) { O_hq ( ) ; return O_kp ( ) ; } O_mg [ O_mf ] = u32 ( O_ml ) - 1 ; } else if ( O_ml < 0.0 ) { let O_mm = u32 ( - O_ml ) - 1 ; let O_hh = O_mn ( O_mm ) ; let O_mo = O_mp ( O_dh , O_hh ) ; if ( O_mo < 0.0 || ( O_el > 0.0 && O_mo > O_el ) ) { continue ; } O_el = O_mo ; O_mh = O_mm ; O_ec = O_mq ( O_hh , O_mr ( O_mm ) , O_en ( O_dh , O_mo ) ) ; } } } if ( O_el < 0 ) { return O_kp ( ) ; } return O_ko ( O_el , O_ec , u32 ( O_aw [ O_mh ] . O_ik ) ) ; } fn O_mn ( O_ff : u32 , ) -> O_hi { let O_ms = u32 ( O_aw [ O_ff ] . O_gw ) ; let O_mt = u32 ( O_aw [ O_ff ] . O_gx ) ; let O_mu = u32 ( O_aw [ O_ff ] . O_gy ) ; let O_gw = O_ay [ O_ms ] ; let O_gx = O_ay [ O_mt ] ; let O_gy = O_ay [ O_mu ] ; return O_hi ( O_gw , O_gx , O_gy ) ; } fn O_mr ( O_ff : u32 , ) -> array < vec3 < f32 > , 3 > { let O_mv = u32 ( O_aw [ O_ff ] . O_mw ) ; let O_mx = u32 ( O_aw [ O_ff ] . O_my ) ; let O_mz = u32 ( O_aw [ O_ff ] . O_na ) ; let O_mw = O_ay [ O_mv ] ; let O_my = O_ay [ O_mx ] ; let O_na = O_ay [ O_mz ] ; return array < vec3 < f32 > , 3 > ( O_mw , O_my , O_na ) ; } fn O_kt ( O_dh : O_au , ) -> O_ko { var O_ej : O_ko = O_nb ( O_dh ) ; if ( O_ej . O_el < 0.0 ) { O_ej = O_nc ( O_dh ) ; } return O_ej ; } fn O_nb ( O_dh : O_au , ) -> O_ko { let O_nd = O_ne ( O_dh , O_bd . O_nf ) ; if ( O_nd . O_el < 0.0 ) { return O_kp ( ) ; } let O_lc = O_nd . O_lc ; let O_eq = O_ng ( O_lc ) ; return O_ko ( O_nd . O_el , O_bd . O_nf . O_ec , O_eq ) ; } fn O_ng ( O_lc : vec2 < f32 > , ) -> u32 { if ( O_nh ( O_lc , i32 ( O_ae . O_c ) ) ) { return u32 ( O_af . O_k ) ; } let O_m = ! O_nh ( O_lc , i32 ( O_ae . O_d ) ) ; let O_l = O_nh ( O_lc , i32 ( O_ae . O_e ) ) ; if ( O_m ) { if ( O_l ) { return u32 ( O_af . O_n ) ; } else { return u32 ( O_af . O_m ) ; } } else { if ( O_l ) { return u32 ( O_af . O_l ) ; } else { return u32 ( O_af . O_j ) ; } } } fn O_nc ( O_dh : O_au , ) -> O_ko { let O_nd = O_ne ( O_dh , O_bd . O_ni ) ; if ( O_nd . O_el < 0.0 ) { return O_kp ( ) ; } let O_lc = O_nd . O_lc ; let O_eq = O_nj ( O_lc ) ; return O_ko ( O_nd . O_el , O_bd . O_ni . O_ec , O_eq ) ; } fn O_nj ( O_lc : vec2 < f32 > , ) -> u32 { let O_k = O_nh ( O_lc , i32 ( O_ae . O_f ) ) ; if ( O_k ) { return u32 ( O_af . O_k ) ; } let O_m = ! O_nh ( O_lc , i32 ( O_ae . O_g ) ) ; let O_l = O_nh ( O_lc , i32 ( O_ae . O_h ) ) ; if ( O_m ) { if ( O_l ) { return u32 ( O_af . O_n ) ; } else { return u32 ( O_af . O_m ) ; } } else { if ( O_l ) { return u32 ( O_af . O_l ) ; } else { return u32 ( O_af . O_j ) ; } } } fn O_nk ( O_lc : vec3 < f32 > , ) -> vec2 < f32 > { return vec2 < f32 > ( O_lc . x , - O_lc . z ) ; } fn O_nl ( ) -> O_lh { let O_nm = O_az [ u32 ( O_ae . O_b ) ] ; let O_lg = O_lh ( O_nm . O_ll , O_nm . O_lk , O_nm . O_lo , O_nm . O_ln ) ; return O_ls ( O_lg , 1 ) ; } struct O_nn { O_el : f32 , O_lc : vec2 < f32 > , } fn O_ne ( O_dh : O_au , O_p : O_md , ) -> O_nn { let O_nd = O_ly ( O_dh , O_p ) ; if ( O_nd . O_el < 0.0 ) { return O_nn ( - 1.0 , vec2 < f32 > ( 0.0 ) ) ; } let O_no = O_nk ( O_nd . O_lc ) ; let O_lg = O_nl ( ) ; if ( ! O_li ( O_lg , O_no ) ) { return O_nn ( - 1.0 , vec2 < f32 > ( 0.0 ) ) ; } return O_nn ( O_nd . O_el , O_no ) ; } fn O_nh ( O_lc : vec2f , O_np : i32 , ) -> bool { if ( O_np < 0 ) { return false ; } var O_mg = array < i32 , 22 > ( ) ; O_mg [ 0 ] = i32 ( O_np ) ; var O_mf : i32 = 1 ; var O_nq : i32 = 0 ; while ( O_mf > 0 ) { let O_ff = O_mg [ O_mf - 1 ] ; O_mf -= 1 ; let O_nr = O_az [ O_ff ] ; let O_lg = O_lh ( O_nr . O_ll , O_nr . O_lk , O_nr . O_lo , O_nr . O_ln ) ; if ( ! O_li ( O_lg , O_lc ) ) { continue ; } var O_ns = array < i32 , 2 > ( ) ; O_ns [ 0 ] = i32 ( O_nr . O_nt ) ; O_ns [ 1 ] = i32 ( O_nr . O_nu ) ; for ( var O_ii = 0 ; O_ii < 2 ; O_ii += 1 ) { let O_nv = O_ns [ O_ii ] ; if ( O_nv > 0 ) { O_mg [ O_mf ] = O_nv - 1 ; O_mf += 1 ; } else if ( O_nv < 0 ) { let O_nw = - 1 * O_nv - 1 ; let O_ka = O_nx ( O_lc , O_nw ) ; if ( O_ka == O_bp ) { return true ; } if ( O_ka == O_bs ) { O_nq -= 1 ; } if ( O_ka == O_br ) { O_nq += 1 ; } } } } return O_nq != 0 ; } fn O_nx ( O_lc : vec2f , O_nw : i32 , ) -> u32 { let O_ny = i32 ( O_nw ) ; switch u32 ( O_bb [ O_ny ] ) { case O_ci : { let O_nz = O_lc ; var O_oa = vec2 ( O_bb [ O_ny + 1 ] , O_bb [ O_ny + 2 ] ) ; var O_ob = vec2 ( O_bb [ O_ny + 3 ] , O_bb [ O_ny + 4 ] ) ; var O_ir = normalize ( O_ob - O_oa ) ; let O_oc = O_bb [ O_ny + 5 ] ; O_oa = O_oa + O_ir * O_oc * 0.5 ; O_ob = O_ob - O_ir * O_oc * 0.5 ; if ( ( length ( O_lc - O_ob ) < ( O_oc / 2.0 ) ) || ( length ( O_lc - O_oa ) < ( O_oc / 2.0 ) ) ) { return O_bp ; } let O_ev = O_ob - O_oa ; let O_od = dot ( O_ev , O_ev ) ; let O_oe = O_nz - O_oa ; let O_el = dot ( O_oe , O_ev ) / O_od ; if ( O_el < 0.0 || O_el > 1.0 ) { return O_bq ; } let O_of = O_oa + O_el * O_ev ; let distance = length ( O_nz - O_of ) ; if ( distance <= O_oc / 2.0 ) { return O_bp ; } else { return O_bq ; } } case O_bt : { let O_og = vec2f ( O_bb [ O_ny + 1 ] , O_bb [ O_ny + 2 ] ) ; let O_kh = O_bb [ O_ny + 3 ] ; if ( length ( O_lc - O_og ) < O_kh ) { return O_bp ; } else { return O_bq ; } } case O_bv : { let O_oh : vec2 < f32 > = vec2f ( O_bb [ O_ny + 1 ] , O_bb [ O_ny + 2 ] ) ; let O_q : f32 = O_bb [ O_ny + 3 ] ; let O_r : f32 = O_bb [ O_ny + 4 ] ; let O_kl : f32 = O_bb [ O_ny + 5 ] ; let O_oi : f32 = O_bb [ O_ny + 6 ] ; if ( O_lc . x > O_oh . x + O_oi && O_lc . x < O_oh . x + O_q - O_oi ) { if ( O_lc . y > O_oh . y - O_r && O_lc . y < O_oh . y ) { return O_bp ; } } if ( O_lc . x > O_oh . x && O_lc . x < O_oh . x + O_q ) { if ( O_lc . y > O_oh . y - O_r + O_oi && O_lc . y < O_oh . y - O_oi ) { return O_bp ; } } if ( length ( O_lc - ( O_oh + vec2f ( O_oi , - O_oi ) ) ) < O_oi ) { return O_bp ; } if ( length ( O_lc - ( O_oh + vec2f ( O_q - O_oi , - O_oi ) ) ) < O_oi ) { return O_bp ; } if ( length ( O_lc - ( O_oh + vec2f ( O_oi , O_oi - O_r ) ) ) < O_oi ) { return O_bp ; } if ( length ( O_lc - ( O_oh + vec2f ( O_q - O_oi , O_oi - O_r ) ) ) < O_oi ) { return O_bp ; } return O_bq ; } case O_bz : { let O_gw : vec2 < f32 > = vec2f ( O_bb [ O_ny + 1 ] , O_bb [ O_ny + 2 ] ) ; let O_gx : vec2 < f32 > = vec2f ( O_bb [ O_ny + 3 ] , O_bb [ O_ny + 4 ] ) ; let O_gy : vec2 < f32 > = vec2f ( O_bb [ O_ny + 5 ] , O_bb [ O_ny + 6 ] ) ; let O_oj = O_bb [ O_ny + 6 ] ; let O_ok = O_gx - O_gw ; let O_ol = O_gy - O_gw ; let O_om = O_lc - O_gw ; let O_on = dot ( O_ol , O_ol ) ; let O_oo = dot ( O_ol , O_ok ) ; let O_op = dot ( O_ol , O_om ) ; let O_oq = dot ( O_ok , O_ok ) ; let O_or = dot ( O_ok , O_om ) ; let O_os = 1.0 / ( O_on * O_oq - O_oo * O_oo ) ; let O_gh = ( O_oq * O_op - O_oo * O_or ) * O_os ; let O_eg = ( O_on * O_or - O_oo * O_op ) * O_os ; if ( ( O_gh >= 0.0 ) && ( O_eg >= 0.0 ) && ( O_gh + O_eg <= 1.0 ) ) { if ( 0.5 * ( O_gw . x * ( O_gx . y - O_gy . y ) + O_gx . x * ( O_gy . y - O_gw . y ) + O_gy . x * ( O_gw . y - O_gx . y ) ) < 0.0 ) { return O_br ; } else { return O_bs ; } } else { return O_bq ; } } case O_ca : { let O_og = vec2f ( O_bb [ O_ny + 1 ] , O_bb [ O_ny + 2 ] ) ; let O_kh = O_bb [ O_ny + 3 ] ; var O_ot = O_bb [ O_ny + 4 ] ; let O_ou = O_bb [ O_ny + 5 ] ; let O_ov = vec2f ( O_bb [ O_ny + 6 ] , O_bb [ O_ny + 7 ] ) ; let O_ow = vec2f ( O_bb [ O_ny + 8 ] , O_bb [ O_ny + 9 ] ) ; let O_ox = O_lc . x - O_og . x ; let O_oy = O_lc . y - O_og . y ; let O_oz = O_ox * O_ox + O_oy * O_oy ; if ( O_oz > O_kh * O_kh ) { return O_bq ; } let O_gw = O_og ; let O_gx = O_ov ; let O_gy = O_ow ; let O_ok = O_gx - O_gw ; let O_ol = O_gy - O_gw ; let O_om = O_lc - O_gw ; let O_on = dot ( O_ol , O_ol ) ; let O_oo = dot ( O_ol , O_ok ) ; let O_op = dot ( O_ol , O_om ) ; let O_oq = dot ( O_ok , O_ok ) ; let O_or = dot ( O_ok , O_om ) ; let O_os = 1.0 / ( O_on * O_oq - O_oo * O_oo ) ; let O_gh = ( O_oq * O_op - O_oo * O_or ) * O_os ; let O_eg = ( O_on * O_or - O_oo * O_op ) * O_os ; if ( ( O_gh >= 0.0 ) && ( O_eg >= 0.0 ) && ( O_gh + O_eg <= 1.0 ) ) { if ( abs ( O_ou ) >= O_bi ) { if ( O_ou > 0.0 ) { return O_bs ; } else { return O_br ; } } else { return O_bq ; } } if ( abs ( O_ou ) >= O_bk ) { if ( O_ou > 0 ) { return O_bs ; } else { return O_br ; } } O_ot = O_ot % O_bk ; if ( O_ot < 0.0 ) { O_ot = O_ot + O_bk ; } var O_pa = atan2 ( O_oy , O_ox ) ; if ( O_pa < 0.0 ) { O_pa = O_pa + O_bk ; } var O_pb = O_ot + O_ou ; if ( O_ou >= 0.0 ) { if ( O_pb >= O_bk ) { O_pb = O_pb - O_bk ; } if ( O_pb > O_ot ) { if ( O_pa > O_ot && O_pa < O_pb ) { return O_bs ; } else { return O_bq ; } } else { if ( O_pa > O_ot || O_pa < O_pb ) { return O_bs ; } else { return O_bq ; } } } else { if ( O_pb < 0.0 ) { O_pb = O_pb + O_bk ; } if ( O_pb < O_ot ) { if ( O_pa > O_ot && O_pa < O_pb ) { return O_br ; } else { return O_bq ; } } else { if ( O_pa < O_ot || O_pa > O_pb ) { return O_br ; } else { return O_bq ; } } } } case O_bu : { let O_og = vec2f ( O_bb [ O_ny + 1 ] , O_bb [ O_ny + 2 ] ) ; let O_oi = O_bb [ O_ny + 3 ] ; let O_q = O_bb [ O_ny + 4 ] ; var O_ot = O_bb [ O_ny + 5 ] ; let O_ou = O_bb [ O_ny + 6 ] ; let O_pc = O_q / 2.0 ; let O_pd = length ( O_lc - O_og ) ; if ( O_pd < ( O_oi - O_pc ) || O_pd > ( O_oi + O_pc ) ) { return O_bq ; } var O_pb = O_ot + O_ou ; let O_ov = vec2f ( O_og . x + cos ( O_ot ) * O_oi , O_og . y + sin ( O_ot ) * O_oi ) ; let O_ow = vec2f ( O_og . x + cos ( O_pb ) * O_oi , O_og . y + sin ( O_pb ) * O_oi ) ; if ( length ( O_lc - O_ov ) < O_pc || length ( O_lc - O_ow ) < O_pc ) { return O_bp ; } O_ot = O_ot % O_bk ; if ( O_ot < 0.0 ) { O_ot = O_ot + O_bk ; } var O_pa = atan2 ( O_lc . y - O_og . y , O_lc . x - O_og . x ) ; if ( O_pa < 0.0 ) { O_pa = O_pa + O_bk ; } if ( O_ou >= 0.0 ) { if ( O_pb >= O_bk ) { O_pb = O_pb - O_bk ; } if ( O_pb > O_ot ) { if ( O_pa > O_ot && O_pa < O_pb ) { return O_bp ; } else { return O_bq ; } } else { if ( O_pa > O_ot || O_pa < O_pb ) { return O_bp ; } else { return O_bq ; } } } else { if ( O_pb < 0.0 ) { O_pb = O_pb + O_bk ; } if ( O_pb < O_ot ) { if ( O_pa > O_ot && O_pa < O_pb ) { return O_bp ; } else { return O_bq ; } } else { if ( O_pa < O_ot || O_pa > O_pb ) { return O_bp ; } else { return O_bq ; } } } } default : { O_dm ( vec3 < f32 > ( 1 , 0 , 0 ) ) ; break ; } } return O_bq ; } fn O_em ( O_dh : O_au , ) -> vec3 < f32 > { let O_ir = O_dh . O_ev ; let O_lp = vec2 < f32 > ( 0.5 + atan2 ( O_ir . z , O_ir . x ) / ( 2.0 * O_bi ) , 0.5 - asin ( O_ir . y ) / O_bi ) ; let O_lq = vec2 < i32 > ( O_lp * vec2 < f32 > ( textureDimensions ( O_ah ) ) ) ; var O_pe = textureLoad ( O_ah , O_lq , 0 ) ; var O_dl = vec3 < f32 > ( O_pe . x , O_pe . y , O_pe . z ) ; return O_dl * O_ai . O_pf ; } fn O_kx ( O_dh : O_au , ) -> O_ko { let O_lg = O_mi ( O_bf . x , O_bf . y , - 2000 , 2000.0 , O_bf . y + 10.0 , 2000 ) ; let O_ka = O_pg ( O_dh , O_lg ) ; if ( O_ka . O_el < 0 ) { return O_kp ( ) ; } return O_ko ( O_ka . O_el , O_ka . O_ec , 2 ) ; } fn O_kz ( O_dh : O_au , ) -> O_ko { let O_ka = O_ph ( O_dh , O_ai ) ; if ( O_ka . O_el < 0.0 ) { return O_kp ( ) ; } return O_ko ( O_ka . O_el , O_ka . O_ec , 1 ) ; } const O_pi : u32 = 10 ; const O_pj : u32 = 5 ; struct O_pk { O_pl : u32 , O_pm : u32 , O_pn : bool , } fn O_po ( O_pp : u32 , ) -> O_pk { let O_pl = O_pp & 0x3ff ; let O_pm = ( O_pp >> O_pi ) & 0x1f ; let O_pq = ( O_pp >> ( O_pi + O_pj ) ) & 0x1 ; if O_pq > 0 { return O_pk ( O_pl , O_pm , true ) ; } else { return O_pk ( O_pl , O_pm , false ) ; } } fn O_pr ( O_pp : O_pk , ) -> u32 { if O_pp . O_pn { return O_pp . O_pl + ( O_pp . O_pm << O_pi ) + ( 1 << ( O_pj + O_pi ) ) ; } else { return O_pp . O_pl + ( O_pp . O_pm << O_pi ) ; } } fn O_ps ( O_pp : u32 , O_pl : u32 , ) -> u32 { var O_el = O_po ( O_pp ) ; O_el . O_pl = O_pl ; return O_pr ( O_el ) ; } struct O_aj { O_gi : f32 , O_dl : vec3 < f32 > , O_ed : vec3 < f32 > , O_gh : vec3 < f32 > , O_eg : vec3 < f32 > , O_pf : f32 , } struct O_gd { O_ed : vec3 < f32 > , O_dl : vec3 < f32 > , } ; struct O_mi { O_ll : f32 , O_lo : f32 , O_pt : f32 , O_lk : f32 , O_ln : f32 , O_pu : f32 , } fn O_pv ( O_lc : vec3 < f32 > , O_pw : O_mi , ) -> bool { return ( O_lc . x >= O_pw . O_ll && O_lc . x <= O_pw . O_lk ) && ( O_lc . y >= O_pw . O_lo && O_lc . y <= O_pw . O_ln ) && ( O_lc . z >= O_pw . O_pt && O_lc . z <= O_pw . O_pu ) ; } fn O_px ( O_pw : O_mi , ) -> vec3 < f32 > { let O_gs = vec3 < f32 > ( O_pw . O_ll + O_pw . O_lk , O_pw . O_lo + O_pw . O_ln , O_pw . O_pt + O_pw . O_pu ) ; return O_gs / vec3 < f32 > ( 2.0 ) ; } fn O_py ( O_ed : vec3 < f32 > , O_q : f32 , ) -> O_mi { let O_ld = O_q / 2.0 ; return O_mi ( O_ed . x - O_ld , O_ed . y - O_ld , O_ed . z - O_ld , O_ed . x + O_ld , O_ed . y + O_ld , O_ed . z + O_ld , ) ; } fn O_pz ( O_lg : O_mi , O_lc : vec3 < f32 > , ) -> vec3 < f32 > { let O_qa : f32 = 1e-5 ; if abs ( O_lc . x - O_lg . O_ll ) < O_qa { return vec3 < f32 > ( - 1.0 , 0.0 , 0.0 ) ; } if abs ( O_lc . x - O_lg . O_lk ) < O_qa { return vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ; } if abs ( O_lc . y - O_lg . O_lo ) < O_qa { return vec3 < f32 > ( 0.0 , - 1.0 , 0.0 ) ; } if abs ( O_lc . y - O_lg . O_ln ) < O_qa { return vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ; } if abs ( O_lc . z - O_lg . O_pt ) < O_qa { return vec3 < f32 > ( 0.0 , 0.0 , - 1.0 ) ; } if abs ( O_lc . z - O_lg . O_pu ) < O_qa { return vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ; } return vec3 < f32 > ( 0.0 , 0.0 , 0.0 ) ; } struct O_lh { O_ll : f32 , O_lk : f32 , O_lo : f32 , O_ln : f32 , } fn O_ls ( O_lg : O_lh , O_qb : f32 , ) -> O_lh { return O_lh ( ( O_lg . O_ll + O_qb ) , ( O_lg . O_lk - O_qb ) , ( O_lg . O_lo + O_qb ) , ( O_lg . O_ln - O_qb ) ) ; } fn O_li ( O_lg : O_lh , O_lc : vec2 < f32 > , ) -> bool { let O_qc = O_lc . x >= O_lg . O_ll && O_lc . x <= O_lg . O_lk ; let O_qd = O_lc . y >= O_lg . O_lo && O_lc . y <= O_lg . O_ln ; return O_qc && O_qd ; } fn O_qe ( O_lr : O_lh , O_qf : O_lh , ) -> bool { let O_qg = O_lr . O_ll <= O_qf . O_lk && O_lr . O_lk >= O_qf . O_ll ; let O_qh = O_lr . O_lo <= O_qf . O_ln && O_lr . O_ln >= O_qf . O_lo ; return O_qg && O_qh ; } struct O_qi { O_ed : vec3 < f32 > , O_q : f32 , } struct O_qj { O_cx : f32 , O_qk : f32 , O_ql : f32 , O_jd : f32 , O_jv : f32 , } struct O_ab { O_cx : f32 , O_df : f32 , O_jd : f32 , O_jv : f32 , } struct O_qm { O_hh : O_hi , O_ec : vec3 < f32 > , O_qn : vec3 < f32 > , } fn O_qo ( ) -> O_qm { return O_qm ( O_qp ( ) , vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) ) ; } struct O_ax { O_gw : f32 , O_gx : f32 , O_gy : f32 , O_mw : f32 , O_my : f32 , O_na : f32 , O_ik : f32 , } struct O_ko { O_el : f32 , O_ec : vec3 < f32 > , O_eq : u32 , } fn O_kp ( ) -> O_ko { return O_ko ( - 1 , O_qq ( ) , 0 ) ; } struct O_as { O_ea : vec3 < f32 > , O_dt : f32 , O_dv : f32 , O_du : f32 , O_dw : f32 , O_dx : f32 , O_dy : f32 , O_qr : f32 , O_dz : vec3 < f32 > , O_er : f32 , O_et : f32 , O_ew : f32 , O_ey : f32 , O_ez : f32 , O_fa : f32 , O_fb : f32 , O_fc : f32 , } struct O_qs { O_ll : f32 , O_lo : f32 , O_pt : f32 , O_lk : f32 , O_ln : f32 , O_pu : f32 , O_nt : f32 , O_nu : f32 , } struct O_ba { O_ll : f32 , O_lk : f32 , O_lo : f32 , O_ln : f32 , O_nt : f32 , O_nu : f32 , } struct O_qt { O_qu : f32 , O_np : f32 , O_qv : f32 , O_qw : f32 , } struct O_be { O_nf : O_md , O_ni : O_md , } struct O_md { O_lc : vec3 < f32 > , O_ec : vec3 < f32 > , } struct O_au { O_hn : vec3 < f32 > , O_ev : vec3 < f32 > , } fn O_qx ( ) -> O_au { return O_au ( vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) ) ; } fn O_en ( O_dh : O_au , O_el : f32 , ) -> vec3 < f32 > { return O_dh . O_hn + O_el * O_dh . O_ev ; } struct O_qy { O_el : f32 , O_ec : vec3 < f32 > , } fn O_pg ( O_dh : O_au , O_lg : O_mi , ) -> O_qy { let O_qz = vec3 < f32 > ( O_lg . O_ll , O_lg . O_lo , O_lg . O_pt ) ; let O_ra = vec3 < f32 > ( O_lg . O_lk , O_lg . O_ln , O_lg . O_pu ) ; let O_rb = 1.0 / O_dh . O_ev ; let sign = vec3 < u32 > ( u32 ( O_rb . x < 0.0 ) , u32 ( O_rb . y < 0.0 ) , u32 ( O_rb . z < 0.0 ) ) ; var O_rc = array < vec3 < f32 > , 2 > ( O_qz , O_ra ) ; var O_rd = ( O_rc [ sign . x ] . x - O_dh . O_hn . x ) * O_rb . x ; var O_re = ( O_rc [ 1 - sign . x ] . x - O_dh . O_hn . x ) * O_rb . x ; var O_rf = ( O_rc [ sign . y ] . y - O_dh . O_hn . y ) * O_rb . y ; var O_rg = ( O_rc [ 1 - sign . y ] . y - O_dh . O_hn . y ) * O_rb . y ; if ( O_rd > O_rg ) || ( O_rf > O_re ) { return O_qy ( - 1.0 , vec3 < f32 > ( 0.0 ) ) ; } O_rd = max ( O_rd , O_rf ) ; O_re = min ( O_re , O_rg ) ; let O_rh = ( O_rc [ sign . z ] . z - O_dh . O_hn . z ) * O_rb . z ; let O_ri = ( O_rc [ 1 - sign . z ] . z - O_dh . O_hn . z ) * O_rb . z ; if ( O_rd > O_ri ) || ( O_rh > O_re ) { return O_qy ( - 1.0 , vec3 < f32 > ( 0.0 ) ) ; } O_rd = max ( O_rd , O_rh ) ; O_re = min ( O_re , O_ri ) ; if ( O_rd < 0.0 ) { return O_qy ( - 1.0 , vec3 < f32 > ( 0.0 ) ) ; } var O_ec = vec3 < f32 > ( 0.0 ) ; let O_lc = O_dh . O_hn + O_rd * O_dh . O_ev ; let O_rj = 0.001 ; if ( abs ( O_lc . x - O_qz . x ) < O_rj ) { O_ec = vec3 < f32 > ( - 1.0 , 0.0 , 0.0 ) ; } else if ( abs ( O_lc . x - O_ra . x ) < O_rj ) { O_ec = vec3 < f32 > ( 1.0 , 0.0 , 0.0 ) ; } else if ( abs ( O_lc . y - O_qz . y ) < O_rj ) { O_ec = vec3 < f32 > ( 0.0 , - 1.0 , 0.0 ) ; } else if ( abs ( O_lc . y - O_ra . y ) < O_rj ) { O_ec = vec3 < f32 > ( 0.0 , 1.0 , 0.0 ) ; } else if ( abs ( O_lc . z - O_qz . z ) < O_rj ) { O_ec = vec3 < f32 > ( 0.0 , 0.0 , - 1.0 ) ; } else if ( abs ( O_lc . z - O_ra . z ) < O_rj ) { O_ec = vec3 < f32 > ( 0.0 , 0.0 , 1.0 ) ; } return O_qy ( O_rd , O_ec ) ; } fn O_ph ( O_dh : O_au , O_gf : O_aj , ) -> O_qy { let O_gk = O_gf . O_ed + O_gf . O_gh + O_gf . O_eg ; let O_gl = O_gf . O_ed + O_gf . O_gh - O_gf . O_eg ; let O_gm = O_gf . O_ed - O_gf . O_gh + O_gf . O_eg ; let O_gn = O_gf . O_ed - O_gf . O_gh - O_gf . O_eg ; var O_el = - 1.0 ; let O_rk = O_mp ( O_dh , O_hi ( O_gk , O_gl , O_gm ) ) ; if ( O_rk > 0.0 && ( O_el < 0.0 || O_rk < O_el ) ) { O_el = O_rk ; } let O_rl = O_mp ( O_dh , O_hi ( O_gl , O_gm , O_gn ) ) ; if ( O_rl > 0.0 && ( O_el < 0.0 || O_rl < O_el ) ) { O_el = O_rl ; } return O_qy ( O_el , normalize ( cross ( O_gf . O_gh , O_gf . O_eg ) ) ) ; } fn O_ji ( O_rm : vec3 < f32 > , O_ec : vec3 < f32 > , ) -> vec3 < f32 > { let O_rn = dot ( O_rm , O_ec ) ; return normalize ( O_rm - 2.0 * O_rn * O_ec ) ; } fn O_mk ( O_dh : O_au , O_pw : O_mi , ) -> f32 { if O_pv ( O_dh . O_hn , O_pw ) { return 0.0 ; } var O_ro : f32 = ( O_pw . O_ll - O_dh . O_hn . x ) / O_dh . O_ev . x ; var O_rp : f32 = ( O_pw . O_lk - O_dh . O_hn . x ) / O_dh . O_ev . x ; if O_ro > O_rp { let O_rq = O_ro ; O_ro = O_rp ; O_rp = O_rq ; } var O_rr : f32 = ( O_pw . O_lo - O_dh . O_hn . y ) / O_dh . O_ev . y ; var O_rs : f32 = ( O_pw . O_ln - O_dh . O_hn . y ) / O_dh . O_ev . y ; if O_rr > O_rs { let O_rq = O_rr ; O_rr = O_rs ; O_rs = O_rq ; } if ( O_ro > O_rs ) || ( O_rr > O_rp ) { return - 1.0 ; } if O_rr > O_ro { O_ro = O_rr ; } if O_rs < O_rp { O_rp = O_rs ; } var O_rt : f32 = ( O_pw . O_pt - O_dh . O_hn . z ) / O_dh . O_ev . z ; var O_ru : f32 = ( O_pw . O_pu - O_dh . O_hn . z ) / O_dh . O_ev . z ; if O_rt > O_ru { let O_rq = O_rt ; O_rt = O_ru ; O_ru = O_rq ; } if ( O_ro > O_ru ) || ( O_rt > O_rp ) { return - 1.0 ; } if O_rt > O_ro { O_ro = O_rt ; } if O_ru < O_rp { O_rp = O_ru ; } if O_ro < 0.0 { if O_rp < 0.0 { return - 1.0 ; } return O_rp ; } return O_ro ; } fn O_go ( O_dh : O_au , O_gk : vec3 < f32 > , O_gl : vec3 < f32 > , O_gm : vec3 < f32 > , O_gn : vec3 < f32 > , ) -> bool { let O_rk = O_hi ( O_gk , O_gl , O_gm ) ; let O_rl = O_hi ( O_gl , O_gm , O_gn ) ; return O_mp ( O_dh , O_rk ) > 0.0 || O_mp ( O_dh , O_rl ) > 0.0 ; } fn O_mp ( O_dh : O_au , O_hh : O_hi , ) -> f32 { let O_qa = 0.00000001 ; let O_rv = O_hh . O_gx - O_hh . O_gw ; let O_rw = O_hh . O_gy - O_hh . O_gw ; let O_jn = cross ( O_dh . O_ev , O_rw ) ; let O_gt = dot ( O_rv , O_jn ) ; if O_gt > - O_qa && O_gt < O_qa { return - 1.0 ; } let O_hw = 1.0 / O_gt ; let O_gb = O_dh . O_hn - O_hh . O_gw ; let O_gh = O_hw * dot ( O_gb , O_jn ) ; if O_gh < 0.0 || O_gh > 1.0 { return - 1.0 ; } let O_rx = cross ( O_gb , O_rv ) ; let O_eg = O_hw * dot ( O_dh . O_ev , O_rx ) ; if O_eg < 0.0 || O_gh + O_eg > 1.0 { return - 1.0 ; } let O_el = O_hw * dot ( O_rw , O_rx ) ; if O_el > O_qa { return O_el ; } else { return - 1.0 ; } } fn O_ry ( O_dh : O_au , O_rz : O_sa , ) -> f32 { let O_sb = O_dh . O_hn - O_rz . O_og ; let O_gt = dot ( O_dh . O_ev , O_dh . O_ev ) ; let O_gu = 2.0 * dot ( O_sb , O_dh . O_ev ) ; let O_gv = dot ( O_sb , O_sb ) - O_rz . O_oi * O_rz . O_oi ; let O_sc = O_gu * O_gu - 4.0 * O_gt * O_gv ; if O_sc < 0.0 { return - 1.0 ; } else { return ( - O_gu - sqrt ( O_sc ) ) / ( 2.0 * O_gt ) ; } } struct O_sd { O_el : bool , O_lc : vec3 < f32 > , } fn O_se ( O_dh : O_au , O_p : O_md , ) -> O_sd { let O_el = O_sf ( O_dh , O_p ) ; if O_el < 0.0 { return O_sd ( false , vec3 < f32 > ( 0 ) ) ; } let O_sg = O_dh . O_hn + O_el * O_dh . O_ev ; return O_sd ( true , O_sg ) ; } struct O_sh { O_el : f32 , O_lc : vec3 < f32 > , } fn O_ly ( O_dh : O_au , O_p : O_md , ) -> O_sh { let O_el = O_sf ( O_dh , O_p ) ; if O_el < 0.0 { return O_sh ( - 1 , vec3 < f32 > ( 0 ) ) ; } let O_sg = O_dh . O_hn + O_el * O_dh . O_ev ; return O_sh ( O_el , O_sg ) ; } fn O_sf ( O_dh : O_au , O_p : O_md , ) -> f32 { let O_lc = O_p . O_lc ; let O_ec = O_p . O_ec ; let O_he = dot ( O_dh . O_ev , O_ec ) ; if ( O_eu ( O_dh . O_ev , O_p . O_ec ) ) { return - 1.0 ; } let O_si = O_lc - O_dh . O_hn ; let O_el = dot ( O_si , O_ec ) / O_he ; return O_el ; } struct O_sj { O_sk : vec3 < f32 > , O_sl : vec3 < f32 > , } ; fn O_sm ( O_sn : O_sj , O_lg : O_mi , ) -> bool { var O_rd : f32 = 0.0 ; var O_re : f32 = 1.0 ; let O_ir : vec3 < f32 > = O_sn . O_sl - O_sn . O_sk ; for ( var O_ii : i32 = 0 ; O_ii < 3 ; O_ii = O_ii + 1 ) { let O_so : f32 = 1.0 / O_ir [ O_ii ] ; var O_rk : f32 ; var O_rl : f32 ; if O_ii == 0 { O_rk = ( O_lg . O_ll - O_sn . O_sk . x ) * O_so ; O_rl = ( O_lg . O_lk - O_sn . O_sk . x ) * O_so ; } else if O_ii == 1 { O_rk = ( O_lg . O_lo - O_sn . O_sk . y ) * O_so ; O_rl = ( O_lg . O_ln - O_sn . O_sk . y ) * O_so ; } else { O_rk = ( O_lg . O_pt - O_sn . O_sk . z ) * O_so ; O_rl = ( O_lg . O_pu - O_sn . O_sk . z ) * O_so ; } if O_so < 0.0 { let O_rq : f32 = O_rk ; O_rk = O_rl ; O_rl = O_rq ; } O_rd = max ( O_rd , O_rk ) ; O_re = min ( O_re , O_rl ) ; if O_re <= O_rd { return false ; } } return true ; } struct O_sa { O_og : vec3 < f32 > , O_oi : f32 , } ; fn O_sp ( O_rz : O_sa , O_lc : vec3 < f32 > , ) -> vec3 < f32 > { return normalize ( O_lc - O_rz . O_og ) ; } fn O_sq ( O_rm : vec3 < f32 > , O_ec : vec3 < f32 > , ) -> vec3 < f32 > { return O_rm - 2.0 * dot ( O_rm , O_ec ) * O_ec ; } struct O_hi { O_gw : vec3 < f32 > , O_gx : vec3 < f32 > , O_gy : vec3 < f32 > , } ; fn O_qp ( ) -> O_hi { return O_hi ( vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) , vec3 < f32 > ( 0 ) ) ; } fn O_sr ( O_hh : O_hi , ) -> vec3 < f32 > { return normalize ( O_hh . O_gw - O_hh . O_gx ) ; } fn O_ss ( O_gs : vec3 < f32 > , O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , ) -> bool { let O_gw = O_gv - O_gt ; let O_gx = O_gu - O_gt ; let O_gy = O_gs - O_gt ; let O_on = dot ( O_gw , O_gw ) ; let O_oo = dot ( O_gw , O_gx ) ; let O_op = dot ( O_gw , O_gy ) ; let O_oq = dot ( O_gx , O_gx ) ; let O_or = dot ( O_gx , O_gy ) ; let O_os = 1.0 / ( O_on * O_oq - O_oo * O_oo ) ; let O_gh = ( O_oq * O_op - O_oo * O_or ) * O_os ; let O_eg = ( O_on * O_or - O_oo * O_op ) * O_os ; return ( O_gh >= 0.0 ) && ( O_eg >= 0.0 ) && ( O_gh + O_eg < 1.0 ) ; } fn O_st ( O_sn : O_sj , O_hh : O_hi , ) -> bool { let O_gk = O_sn . O_sk ; let O_gl = O_sn . O_sl ; let O_gt : vec3 < f32 > = O_hh . O_gw ; let O_gu : vec3 < f32 > = O_hh . O_gx ; let O_gv : vec3 < f32 > = O_hh . O_gy ; let O_su = O_gu - O_gt ; let O_sv = O_gv - O_gt ; let O_jx = cross ( O_su , O_sv ) ; let O_kg = dot ( O_jx , O_gt ) ; let O_el = ( O_kg - dot ( O_jx , O_gk ) ) / dot ( O_jx , O_gl - O_gk ) ; if O_el < 0.0 || O_el > 1.0 { return false ; } let O_gs = O_gk + O_el * ( O_gl - O_gk ) ; return O_ss ( O_gs , O_gt , O_gu , O_gv ) ; } fn O_sw ( O_gs : vec3 < f32 > , O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , O_gv : vec3 < f32 > , ) -> vec3 < f32 > { let O_gw = O_gu - O_gt ; let O_gx = O_gv - O_gt ; let O_gy = O_gs - O_gt ; let O_gz = dot ( O_gw , O_gw ) ; let O_ha = dot ( O_gw , O_gx ) ; let O_hb = dot ( O_gx , O_gx ) ; let O_hc = dot ( O_gy , O_gw ) ; let O_hd = dot ( O_gy , O_gx ) ; let O_he = O_gz * O_hb - O_ha * O_ha ; let O_eg = ( O_hb * O_hc - O_ha * O_hd ) / O_he ; let O_hf = ( O_gz * O_hd - O_ha * O_hc ) / O_he ; let O_gh = 1.0 - O_eg - O_hf ; return vec3 < f32 > ( O_gh , O_eg , O_hf ) ; } fn O_mq ( O_hh : O_hi , O_ec : array < vec3 < f32 > , 3 > , O_hj : vec3 < f32 > , ) -> vec3 < f32 > { let O_hk = O_sw ( O_hj , O_hh . O_gw , O_hh . O_gx , O_hh . O_gy ) ; return normalize ( O_hk . x * O_ec [ 0 ] + O_hk . y * O_ec [ 1 ] + O_hk . z * O_ec [ 2 ] ) ; } fn O_qq ( ) -> vec3 < f32 > { return vec3 < f32 > ( 0 , 0 , 0 ) ; } fn O_eu ( O_sx : vec3 < f32 > , O_gy : vec3 < f32 > , ) -> bool { let O_rn = dot ( O_sx , O_gy ) ; let O_sy = length ( O_sx ) ; let O_sz = length ( O_gy ) ; return ( O_sy > 0.0 ) && ( O_sz > 0.0 ) && ( O_rn >= 0.0 ) ; } fn O_ta ( O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , ) -> f32 { let O_rn = dot ( O_gt , O_gu ) ; let O_tb = length ( O_gt ) * length ( O_gu ) ; return O_rn / O_tb ; } fn O_tc ( O_gt : vec3 < f32 > , O_gu : vec3 < f32 > , ) -> bool { let O_td = 1.0 / 255.0 ; return abs ( O_gt . x - O_gu . x ) < O_td && abs ( O_gt . y - O_gu . y ) < O_td && abs ( O_gt . z - O_gu . z ) < O_td ; } fn O_fd ( O_jx : vec3f , O_eg : vec3f , ) -> f32 { let O_kb = max ( dot ( normalize ( O_jx ) , normalize ( O_eg ) ) , 0.0 ) ; return O_kb ; } fn O_te ( O_jx : vec3f , O_eg : vec3f , ) -> f32 { let dot = O_fd ( O_jx , O_eg ) ; return acos ( dot ) ; } struct O_ad { O_ed : vec3 < f32 > , O_tf : vec3 < f32 > , O_tg : vec3 < f32 > , O_th : vec3 < f32 > , O_ti : vec3 < f32 > , O_tj : f32 , O_tk : f32 , O_tl : f32 , O_tm : f32 , } struct O_z { O_ds : vec3 < f32 > , O_ed : vec3 < f32 > , O_hm : f32 , } ";Vn.addShaderCode(nH);var aH=class{static get lambert(){return this.cache[0]}static get disney(){return this.cache[1]}static get(e){return this.cache.find(t=>t[0]===e)}static all(){return this.cache.map(e=>e[0])}};aH.cache=[["lambert",0],["disney",1]];var oH="@ group ( 0 ) @ binding ( 0 ) var < uniform > O_a : f32 ; @ group ( 0 ) @ binding ( 1 ) var < storage , read_write > O_b : array < f32 > ; override Image_Width : u32 ; override Image_Height : u32 ; var < private > O_c : f32 ; @ compute @ workgroup_size ( 32 , 32 ) fn main ( @ builtin ( global_invocation_id ) O_d : vec3 < u32 > , ) { if ( O_d . x >= Image_Width || O_d . y >= Image_Height ) { return ; } let O_e = O_d . x + O_d . y * Image_Width ; O_c = O_a * ( f32 ( O_e ) / f32 ( Image_Width * Image_Height ) ) ; O_c = O_f ( O_c ) ; O_b [ O_e ] = O_g ( ) ; } fn O_g ( ) -> f32 { let O_h = O_i ( O_c ) ; O_c = O_h ; return O_h ; } fn O_j ( O_a : f32 , ) -> f32 { var O_k = u32 ( O_a * 1e6 ) ; O_k ^= O_k << 13 ; O_k ^= O_k >> 17 ; O_k ^= O_k << 5 ; return f32 ( O_k ) * 2.3283064e-10 ; } fn O_f ( O_a : f32 , ) -> f32 { return fract ( sin ( O_a * 43758.5453 ) * 12345.6789 ) ; } fn O_i ( O_a : f32 , ) -> f32 { const O_l : f32 = 1664525.0 ; const O_m : f32 = 1013904223.0 ; const O_n : f32 = 2.3283064e-10 ; return fract ( ( O_l * O_a + O_m ) * O_n ) ; } fn O_o ( O_a : f32 , ) -> f32 { let O_p = u32 ( O_a * 65535.0 ) * 0x9E3779B9u ; var O_k = O_p ^ ( O_p >> 16 ) ; O_k = O_k * 0x21f0aaadu ; O_k = O_k ^ ( O_k >> 15 ) ; O_k = O_k * 0x735a2d97u ; O_k = O_k ^ ( O_k >> 15 ) ; return f32 ( O_k ) * 2.3283064e-10 ; } ";Vn.addShaderCode(oH);var Yre=q3(_w()),lH=(e=>(e.model="model",e.obj="obj",e.material="material",e.log="log",e.cMatrix="c_matrix",e.ambientLight="ambient_light",e.textureNormal="texture_normal",e.textureMetallic="texture_metallic",e.textureColor="texture_color",e.textureRoughness="texture_roughness",e.camera="camera",e))(lH||{});var vg=class vg{conversion(t,i,r){if(t===i)return r;if(t[1]==="i"&&i[0]==="m"&&i[1]==="m")return this.mil2mm(r);if(t[0]==="m"&&t[1]==="m"&&i[1]==="i")return this.mm2mil(r);let s=t+2+i;return this[s](r)}conversion1(t,i,r){let s=t+2+i,n=this[s](r);return i=="mil"?Math.round(n*10)/10:Math.round(n*1e3)/1e3}mil2mil(t){return t}mil2mm(t){return t*.0254}mil2cm(t){return t*.00254}mil2inch(t){return t/1e3}mm2mm(t){return t}mm2mil(t){let i=Math.pow(10,5);return Math.round(t*39.37007874015748*i)/i}mm2cm(t){return t/10}mm2inch(t){let i=Math.pow(10,8);return Math.round(t*.03937007874015748*i)/i}cm2mil(t){let i=Math.pow(10,6);return Math.round(t*393.7007874015748*i)/i}cm2mm(t){return t*10}cm2inch(t){let i=Math.pow(10,7);return Math.round(t*.3937007874015748*i)/i}inch2mil(t){return t*1e3}inch2mm(t){return t*25.4}inch2cm(t){return t*2.54}};vg.ins=new vg;var al=vg;al.prototype["px(100)2mil"]=e=>e*10;al.prototype["px(100)2mm"]=e=>e*.254;al.prototype["mil2px(100)"]=e=>e/10;al.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var hH=Object.create,II=Object.defineProperty,cH=Object.getOwnPropertyDescriptor,uH=Object.getOwnPropertyNames,dH=Object.getPrototypeOf,fH=Object.prototype.hasOwnProperty,pH=(e=>typeof hr<"u"?hr:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof hr<"u"?hr:t)[i]}):e)(function(e){if(typeof hr<"u")return hr.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),Ht=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),_H=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of uH(t))!fH.call(e,s)&&s!==i&&II(e,s,{get:()=>t[s],enumerable:!(r=cH(t,s))||r.enumerable});return e},iu=(e,t,i)=>(i=e!=null?hH(dH(e)):{},_H(t||!e||!e.__esModule?II(i,"default",{value:e,enumerable:!0}):i,e)),uf=Ht((e,t)=>{"use strict";var i=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(T,k)=>{for(var A in k)i(T,A,{get:k[A],enumerable:!0})},o=(T,k,A,F)=>{if(k&&typeof k=="object"||typeof k=="function")for(let V of s(k))!n.call(T,V)&&V!==A&&i(T,V,{get:()=>k[V],enumerable:!(F=r(k,V))||F.enumerable});return T},l=T=>o(i({},"__esModule",{value:!0}),T),h={};a(h,{BroadcastChannelMessageBus:()=>Je,MessageBus:()=>J,MessageBus2:()=>Pe,MessageBusTask:()=>ve,MessageBusTask2:()=>Ce,WindowMessageBridge:()=>_e,WorkerMessageBridge:()=>he,createBroadcastP2PStream:()=>mi,createBufferedByteBufferStream:()=>si,createBufferedStream:()=>ct,createBufferedStringStream:()=>ut,dropP2PStream:()=>It,flowRead:()=>ni,flowWrite:()=>Ai}),t.exports=l(h);var c=class{constructor(T=1.5){this.growthFactor=T,this.capacity=10,this.buffer=new Array(this.capacity),this.head=0,this.tail=0,this.count=0}enqueue(T){if(this.count===this.capacity){let k=Math.floor(this.capacity*this.growthFactor);console.log("grow",this.capacity,k);let A=new Array(k);for(let F=0;F<this.count;F++)A[F]=this.buffer[(this.head+F)%this.capacity];this.buffer=A,this.head=0,this.tail=this.count,this.capacity=k}this.buffer[this.tail]=T,this.tail=(this.tail+1)%this.capacity,this.count++}dequeue(){if(this.isEmpty())return;let T=this.buffer[this.head];return this.head=(this.head+1)%this.capacity,this.count--,T}peek(){return this.buffer[this.head]}isEmpty(){return this.count===0}clear(){this.buffer.length=0,this.head=0,this.tail=0,this.count=0}},f=new ArrayBuffer(8),d=new Float64Array(f),u=new Uint32Array(f),p=new Uint16Array(f),_=ArrayBuffer;try{_=self.HTMLImageElement||_}catch{}var g=typeof SharedArrayBuffer<"u";function b(T){if(typeof T!="object"||T===null||T instanceof Date||T instanceof ArrayBuffer||g&&T instanceof SharedArrayBuffer||T instanceof Blob||T instanceof FormData||T instanceof Function||T instanceof Uint8ClampedArray||T instanceof _)return T;if(Array.isArray(T))return T.map(b);{let k={};for(let A in T)Object.hasOwnProperty.call(T,A)&&(k[A]=b(T[A]));return k}}function m(T,k){return O(T,k,()=>[])}function O(T,k,A){let F=T[k];return F!==void 0||(F=A(k),T[k]=F),F}function y(T,k){if(Array.isArray(T)){for(let A=0,F=T.length;A<F;A++)if(k(void 0,T[A],A)===!1)return}else{let A=0;for(let F in T)if(T.hasOwnProperty(F)){let V=T[F];if(k(F,V,A)===!1)return;A++}}}var x=Object.prototype.hasOwnProperty;async function E(T,k){if(Array.isArray(T)){for(let A=0,F=T.length;A<F;A++)if(await k(void 0,T[A],A)===!1)return}else{let A=0;for(let F in T)if(x.call(T,F)){let V=T[F];if(await k(F,V,A)===!1)return;A++}}}function w(T,k,A){return typeof T=="string"&&(/https?:/.test(T)||(T=location.origin+T)),Promise.race([fetch(T,k),new Promise((F,V)=>setTimeout(V,A))])}function S(T,k){let A=0,F=0;return(...V)=>{let Q=++A;setTimeout(()=>{let W=performance.now();if(Q===A||W-F>=T){try{k(...V)}catch(ne){console.log(ne)}F=W}},Math.max(0,T-(performance.now()-F)))}}function C(T,k){let A=T.length,F=0;for(;F<A;){let V=T.indexOf(`
`,F);V<0&&(V=A);let Q=T.substring(F,V);try{if(k(Q)===!1)return}catch(W){console.error(W)}F=V+1}}function R(T){let k=null;return()=>(k===null&&(k=T()),k)}var B=0;function Y(){B===0&&(B=Date.now()-performance.now());let T=new Array,k=B+performance.now();d[0]=k,T.push(u[1].toString(16)),d[0]=Math.random(),T.push(p[3].toString(16));let A=p[2].toString(16);T.push("4"+A.substr(0,3)),d[0]=k;let F=u[0].toString(16)+u[1].toString(16);return T.push("0"+F.substr(0,3)),T.push(F.substr(3)),T.join("-")}var G=class{constructor(T){this.maxResources=T,this.idle=new c,this.isClosed=!1,this.resources=T}acquire(T){this.isClosed?Promise.resolve(!1).then(T):this.resources>0?(this.resources--,Promise.resolve(!0).then(T)):this.idle.enqueue(T)}acquireSync(){return new Promise(T=>{this.acquire(T)})}release(){if(!this.isClosed){let T=this.idle.dequeue();T?Promise.resolve(!0).then(T):this.resources++}}close(){if(!this.isClosed)for(this.isClosed=!0;!this.idle.isEmpty();){let T=this.idle.dequeue();Promise.resolve(!1).then(T)}}};function z(){if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global}function q(T,k,A){let F=T.length+k-1;for(let V=0;V<F;V++){let Q=new Array;for(let W=V-k+1;W<=V;W++)Q.push(T[W]);if(A(Q)===!1)break}}function L(){let T=new Date,k=T.getFullYear(),A=T.getMonth()+1,F=T.getDate(),V=T.getHours(),Q=T.getMinutes(),W=T.getSeconds(),ne=T.getMilliseconds();return"["+k+"-"+(A<10?"0"+A:A)+"-"+(F<10?"0"+F:F)+" "+(V<10?"0"+V:V)+":"+(Q<10?"0"+Q:Q)+":"+(W<10?"0"+W:W)+"."+(ne<100?ne<10?"00"+ne:"0"+ne:ne)+"] "}function M(T){return new Promise(k=>setTimeout(k,T))}function v(T,k){let A=0,F=T.length;for(let V=0;V<F;V++)T[V]===k&&(T.splice(V,1),V--,F--,A++);return A}var P=z(),I=P.WeakRef||(T=>T);function N(T){if(T!=null){if(typeof T=="object")return new I(T);console.error(T,T instanceof Object,typeof T);return}}function D(T){return T==null?void 0:T.deref()}var j="_MSG_BUS_RPC_",H=300*1e3,K=(T=>(T.PUBLISH="publish",T.SUBSCRIBE="subscribe",T.PUSH="push",T.PULL="pull",T))(K||{}),se=class{constructor(T){this.bus=T}processRemoteMessage(T,k){let A=N(k),F=T.topic,V=T.type,Q=T.message;switch(V){case"pull":this.bus.pull(F,W=>{this.push(F,W,D(A))});break;case"subscribe":this.bus.subscribe(F,W=>{this.publish(F,W,D(A))});break;case"publish":this.bus.publish(F,Q,this,D(A));break;case"push":this.bus.push(F,Q,this,D(A));break;default:console.debug("unknown message type "+V)}}rpcCall(T,k,A,F=H){let V=N(A),Q=new Promise(W=>{let ne=this.bus.uniqueRpcTopic(T);this.publish(T,{message:k,reply:ne},D(V)),this.bus.pull(ne,(X,Ee,Me)=>{W({message:X,bridge:Ee,source:N(Me)})})});return F>0?Promise.race([Q,new Promise((W,ne)=>{setTimeout(ne,F)})]):Q}},he=class extends se{constructor(T,k){super(T),this.worker=k,k.onmessage=A=>{this.processRemoteMessage(A.data,void 0)}}publish(T,k){this.postMessage(T,"publish",k)}subscribe(T){this.postMessage(T,"subscribe",null)}push(T,k){this.postMessage(T,"push",k)}pull(T){this.postMessage(T,"pull",null)}rpcCall(T,k,A=H){return super.rpcCall(T,k,void 0,A)}postMessage(T,k,A){let F={topic:T,type:k,message:A};this.worker.postMessage(F)}discard(){this.worker.terminate()}},_e=class extends se{constructor(T){super(T),window.addEventListener("message",k=>{this.processRemoteMessage(k.data,k.source)},!1)}publish(T,k,A){this.postMessage(T,"publish",k,A)}subscribe(T,k){if(k===window)throw new Error("regist remote subscribe from current window is not permitted");this.postMessage(T,"subscribe",null,k)}push(T,k,A){this.postMessage(T,"push",k,A)}pull(T,k){if(k===window)throw new Error("regist remote pull from current window is not permitted");this.postMessage(T,"pull",null,k)}postMessage(T,k,A,F){let V={topic:T,type:k,message:A};F&&F.postMessage(V,"*")}},ve=class{constructor(T){this.isRunning=!0,this.callback=T}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}execute(T,k,A,F){try{T=F?T:b(T),this.callback(T,k,A)}catch(V){console.error(V)}}},J=class{constructor(T=!1){this.subscribed={},this.pulled={},this.pushed={},this.uuid=crypto.randomUUID().replace(/-/g,""),this.rpcTicket=0,this.unsafe=T}uniqueRpcTopic(T){return`${j}-${T}-${this.uuid}-${this.rpcTicket++}`}publish(T,k,A,F){let V=this.subscribed[T];if(V){let Q;for(let W of V)W.running()?W.execute(k,A,F,this.unsafe):(Q=Q||new Array,Q.push(W));if(Q)for(let W of Q)v(V,W)}else console.debug("no sub on topic: "+T)}subscribe(T,k){let A=new ve(k);return m(this.subscribed,T).push(A),A}push(T,k,A,F){let V=!1,Q=this.pulled[T];if(Q){for(;Q.length>0;){let W=Q.shift();if(W.running()){W.execute(k,A,F,this.unsafe),V=!0;break}}Q.length===0&&delete this.pulled[T]}V||m(this.pushed,T).push({message:k,bridge:A,source:N(F)})}pull(T,k){let A=new ve(k),F=this.pushed[T];if(F){let V=F.shift();A.execute(V.message,V.bridge,D(V.source),this.unsafe),F.length===0&&delete this.pushed[T]}else m(this.pulled,T).push(A);return A}pullA(T){return new Promise(k=>{this.pull(T,(A,F,V)=>{k({message:A,bridge:F,source:N(V)})})})}rpcService(T,k){this.subscribe(T,(A,F,V)=>{let{message:Q,reply:W}=A;try{let ne=k(Q);if(ne instanceof Promise){let X=N(V);ne.then(Ee=>{this.rpcReply(Ee,W,F,D(X))},Ee=>{console.error(Ee),this.rpcReply(void 0,W,F,D(X))})}else this.rpcReply(ne,W,F,V)}catch(ne){console.error(ne),this.rpcReply(void 0,W,F,V)}})}rpcCall(T,k,A=H){let F=new Promise(V=>{let Q=this.uniqueRpcTopic(T);this.publish(T,{message:k,reply:Q}),this.pull(Q,(W,ne,X)=>{V({message:W,bridge:ne,source:N(X)})})});return A>0?Promise.race([F,new Promise((V,Q)=>{setTimeout(Q,A)})]):F}rpcReply(T,k,A,F){A?A.push(k,T,F):this.push(k,T)}},Z="_MSG_BUS_RPC_";function re(T,k){let A=0,F=T.length;for(let V=0;V<F;V++)T[V]===k&&(T.splice(V,1),V--,F--,A++);return A}function ue(T,k){return Le(T,k,()=>[])}function Le(T,k,A){let F=T[k];return F!==void 0||(F=A(k),T[k]=F),F}var Ce=class{constructor(T,k){this.callback=T,this.unsafe=k,this.isRunning=!0}cancel(){this.callback=null,this.isRunning=!1}running(){return this.isRunning}async execute(T){try{T=this.unsafe?T:b(T),this.callback(T)}catch(k){console.error(k)}}},De=class{constructor(T=crypto.randomUUID()){this.uuid=T,this.rpcTicket=0}subscribeOnce(T,k){let A=this.subscribe(T,F=>{A.cancel(),k(F)});return A}pullA(T){return new Promise(k=>{this.pull(T,k)})}rpcService(T,k){let A=F=>{try{let{message:V,replyTopic:Q}=F;try{let W=k(V);W instanceof Promise?W.then(ne=>{this.publish(Q,{success:!0,result:ne})}).catch(ne=>{console.error(ne),this.publish(Q,{success:!1,err:String(ne)})}):this.publish(Q,{success:!0,result:W})}catch(W){this.publish(Q,{success:!1,err:String(W)})}}finally{this.pull(T,A)}};this.pull(T,A)}rpcCall(T,k,A=0){let F=new Promise((V,Q)=>{let W=`${Z}-${T}-${this.uuid}-${this.rpcTicket++}`;this.subscribeOnce(W,ne=>{ne.success?V(ne.result):Q(new Error(ne.err))}),this.push(T,{message:k,replyTopic:W})});return A>0?Promise.race([F,new Promise((V,Q)=>{setTimeout(Q,A)})]):F}},Pe=class extends De{constructor(T=!1){super(),this.unsafe=T,this.subscribed={},this.pulled={},this.pushed={}}publish(T,k){let A=this.subscribed[T];if(A){let F;for(let V of A)V.running()?V.execute(k):(F=F||new Array,F.push(V));if(F)for(let V of F)re(A,V)}}subscribe(T,k){let A=new Ce(k,this.unsafe);return ue(this.subscribed,T).push(A),A}push(T,k){let A=!1,F=this.pulled[T];if(F){for(;F.length>0;){let V=F.shift();if(V&&V.running()){V.execute(k),A=!0;break}}F.length===0&&delete this.pulled[T]}A||ue(this.pushed,T).push(k)}pull(T,k){let A=new Ce(k,this.unsafe);return this.repull(T,A),A}repull(T,k){let A=this.pushed[T];if(A){let F=A.shift();F&&(k.execute(F),A.length===0&&delete this.pushed[T])}else ue(this.pulled,T).push(k)}},Ie=class extends De{constructor(T=crypto.randomUUID()){super(T),this.subscribed={},this.pushed={},this.pulled={},this.pushCnt=0}publish(T,k){console.debug("BC",this.uuid,"PUBLISH",T,k),this.broadcastPublish(T,k)}subscribe(T,k){console.debug("BC",this.uuid,"SUBSCRIBE",T);let A=new Ce(k,!0);return ue(this.subscribed,T).push(A),A}push(T,k){let A=this.pushCnt++;console.debug("BC",this.uuid,"PUSH",T,`(${A})`,k),ue(this.pushed,T).push({id:A,message:k}),this.broadcastPushedHeadMessage(T)}pull(T,k){console.debug("BC",this.uuid,"PULL",T);let A=new Ce(k,!0);return ue(this.pulled,T).push(A),this.broadcastWhoHas(T),A}broadcastPushedHeadMessage(T){let k=this.pushed[T];k&&k[0]&&this.broadcastIHave(T,k[0].id)}onReceivedPublish(T,k,A){console.debug("BCMSG(",this.uuid,")","from",T,"PUBLISH",k,"message",A);let F=this.subscribed[k];if(F){let V;for(let Q of F)Q.running()?Q.execute(A):(V=V||new Array,V.push(Q));if(V)for(let Q of V)re(F,Q);F.length===0&&delete this.subscribed[k]}}onReceivedWhoHas(T,k){console.debug("BCMSG(",this.uuid,")","from",T,"WHOHAS",k),this.broadcastPushedHeadMessage(k)}onReceivedIHave(T,k,A){console.debug("BCMSG(",this.uuid,")","from",T,"IHAVE",k,"id",A);let F=this.pulled[k];if(F){let V;for(let Q of F)if(Q.running()){this.broadcastINeed(k,T,A);break}else V=V||new Array,V.push(Q);if(V)for(let Q of V)re(F,Q);F.length===0&&delete this.pulled[k]}}onReceivedINeed(T,k,A,F){if(console.debug("BCMSG(",this.uuid,")","from",T,"INEED",k,"source",A,"id",F),this.uuid===A){let V=this.pushed[k];if(V&&V[0]&&V[0].id===F){let{message:Q}=V.shift();this.broadcastIGive(k,F,T,Q),this.broadcastPushedHeadMessage(k),V.length===0&&delete this.pushed[k]}}}onReceivedIGive(T,k,A,F,V){console.debug("BCMSG(",this.uuid,")","from",T,"IGIVE",k,"id",A,"target",F,"message",V);let Q=this.pulled[k];if(Q&&this.uuid===F){let W=!1;for(;Q.length>0;){let ne=Q.shift();if(ne.running()){ne.execute(V),W=!0;break}}W||this.push(k,V),Q.length===0&&delete this.pulled[k]}}},Je=class extends Ie{constructor(T,k=crypto.randomUUID()){super(k),this.bc=new BroadcastChannel(T),this.bc.onmessage=A=>{this.onMessage(A.data)}}onMessage(T){let{type:k,uuid:A,topic:F}=T;switch(k){case"PUBLISH":{let{message:V}=T;this.onReceivedPublish(A,F,V);break}case"WHOHAS":{this.onReceivedWhoHas(A,F);break}case"IHAVE":{let{id:V}=T;this.onReceivedIHave(A,F,V);break}case"INEED":{let{source:V,id:Q}=T;this.onReceivedINeed(A,F,V,Q);break}case"IGIVE":{let{target:V,id:Q,message:W}=T;this.onReceivedIGive(A,F,Q,V,W);break}default:console.warn("unsupported",T)}}broadcastPublish(T,k){this.post({type:"PUBLISH",uuid:this.uuid,topic:T,message:k})}broadcastWhoHas(T){this.post({type:"WHOHAS",uuid:this.uuid,topic:T})}broadcastIHave(T,k){this.post({type:"IHAVE",uuid:this.uuid,topic:T,id:k})}broadcastINeed(T,k,A){this.post({type:"INEED",uuid:this.uuid,topic:T,source:k,id:A})}broadcastIGive(T,k,A,F){this.post({type:"IGIVE",uuid:this.uuid,topic:T,id:k,target:A,message:F})}post(T){this.bc.postMessage(T),Promise.resolve().then(()=>{this.onMessage(T)})}},$e=Symbol("BLOCKING_QUEUE_RESET"),pt=class{constructor(T,k=()=>1){if(this.maxSize=T,this.itemSizeOf=k,this.queue=new c,this.waitingConsumers=new c,this.waitingProducers=new c,this.queueSize=0,this.closePromise=null,this.closeResolve=null,T<=0)throw new Error("Max size must be greater than 0")}enqueue(T){return this.closePromise?!1:this.isFull()?(async()=>{console.debug("queue is full",this.queueSize,this.maxSize);let k=await new Promise(A=>{this.waitingProducers.enqueue(A)});return console.debug("queue is not full",this.size(),k),k?(this.innerEnqueue(T),!0):!1})():(this.innerEnqueue(T),!0)}innerEnqueue(T){if(this.waitingConsumers.isEmpty())this.queue.enqueue(T),this.queueSize+=this.itemSizeOf(T),console.debug("queue pushed",T,"size",this.queueSize);else{let k=this.waitingConsumers.dequeue();Promise.resolve(T).then(k),console.debug("queue direct",T,"size",this.queueSize)}}dequeue(){if(this.queue.isEmpty())if(this.closePromise){for(;!this.waitingConsumers.isEmpty();){let T=this.waitingConsumers.dequeue();Promise.resolve($e).then(T)}return setTimeout(()=>this.closeResolve(),0),$e}else return new Promise(T=>{this.waitingConsumers.enqueue(T)});else{let T=this.queue.dequeue();if(this.queueSize-=this.itemSizeOf(T),!this.waitingProducers.isEmpty()){let k=this.waitingProducers.dequeue();Promise.resolve(!0).then(k)}return T}}size(){return this.queueSize}isEmpty(){return this.queueSize===0}isFull(){return this.queueSize>=this.maxSize}close(){return this.closePromise||(this.closePromise=new Promise(T=>{for(this.closeResolve=T;!this.waitingProducers.isEmpty();){let k=this.waitingProducers.dequeue();Promise.resolve(!1).then(k)}if(this.queueSize===0){for(;!this.waitingConsumers.isEmpty();){let k=this.waitingConsumers.dequeue();Promise.resolve($e).then(k)}T()}})),this.closePromise}};function ct(T,k,A=Number.MAX_SAFE_INTEGER){let F=new pt(A,k),V=new ReadableStream({pull(W){let ne=!0,X=(async()=>{let Ee=new Array;do{let Me=F.dequeue();if(Me instanceof Promise){ne=!1;let U=await Me;U===$e?W.close():Ee.push(U)}else{let U=Me;U===$e?W.close():Ee.push(U)}}while(F.size()>0);if(Ee.length>0){let Me=T(Ee);W.enqueue(Me)}})();if(!ne)return console.debug("read stream stucked --------------------------------------"),X},async cancel(){console.debug("buffered readable cancel"),await F.close()}}),Q=new WritableStream({write(W,ne){let X=!0,Ee=(async()=>{let Me=F.enqueue(W);typeof Me=="boolean"?Me||ne.error(new Error("Write stream closed")):(X=!1,await Me||ne.error(new Error("Write stream closed")))})();if(!X)return console.debug("read stream stucked >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),Ee},async close(){console.debug("buffered writable closing",F.size()),await F.close(),console.debug("buffered writable closed",F.size())},async abort(){console.debug("buffered writable aborting",F.size()),await F.close(),console.debug("buffered writable aborted",F.size())}});return{readable:V,writable:Q}}function ut(T=Number.MAX_SAFE_INTEGER){return ct(k=>k.join(""),k=>k.length,T)}function si(T=Number.MAX_SAFE_INTEGER){return ct(k=>{let A=new Uint8Array(k.reduce((V,Q)=>V+Q.byteLength,0)),F=0;return k.forEach(V=>{A.set(V,F),F+=V.byteLength}),A},k=>k.byteLength,T)}function mi(T){return new Promise((k,A)=>{let F=new BroadcastChannel(T),V=new pt(1),Q=new G(1),W=null,ne=!1,X=!1,Ee=!1;F.onmessage=Me=>{let U=Me.data,{type:be}=U;if(console.debug("p2p",T,"type",be,"data",be==="DATA"&&U.data),be==="DATA")V.enqueue(U.data);else if(be==="HI"){if(!W){F.postMessage({type:"HI"});let Se=0;W={rs:new ReadableStream({async pull(ze){let Ue=await V.dequeue();Ue===$e?(await $(),ze.close()):(ze.enqueue(Ue),F.postMessage({type:"ACK"}))},cancel(){return $()}}),ws:new WritableStream({async write(ze,Ue){await Q.acquireSync()?F.postMessage({type:"DATA",id:Se++,data:ze}):(Ne(),Ue.error(new Error("Write stream closed")))},close(){Ne()},abort(){Ne()}})},k(W)}}else be==="REND"?W?Q.close():fe("REND1"):be==="WEND"?W?V.close():fe("WEND1"):be==="ACK"&&Q.release();function Ne(){ne||(ne=!0,console.debug(T,"p2p write stream closed"),Q.close(),F.postMessage({type:"WEND"}),X&&(console.debug(T,"p2p channel closed on ws"),F.close()))}async function $(){X||(X=!0,console.debug(T,"p2p read stream closed"),F.postMessage({type:"REND"}),await V.close(),ne&&(console.debug(T,"p2p channel closed on rs"),F.close()))}async function fe(Se){Ee||(Ee=!0,console.debug(T,"p2p channel connection released on",Se),Q.close(),V.close(),W?(W.rs.locked||(console.debug(T,"p2p unlocked read stream direct cancel"),W.rs.cancel()),W.ws.locked||(console.debug(T,"p2p unlocked write stream direct close"),W.ws.close())):(F.postMessage({type:"HI"}),F.close()),A(new Error("p2p channel connection released")))}},F.postMessage({type:"HI"})})}function It(T){return new Promise(k=>{let A=new BroadcastChannel(T);A.onmessage=F=>{let V=F.data,{type:Q}=V;Q==="HI"&&(A.postMessage({type:"REND"}),A.close(),k())},A.postMessage({type:"REND"})})}async function jt(T){try{return await mi(T)}catch(k){k.message!=="p2p channel connection released"&&console.error(k)}}async function Ai(T,k,A=10*1024*1024,F=!0){let V=await jt(T);if(!V)return!1;let Q=!1;try{let W,ne=X=>{if(!W)if(!F)W=V.ws.getWriter();else if(typeof X=="string"){let Ee=ut(A);Ee.readable.pipeTo(V.ws),W=Ee.writable.getWriter()}else{let Ee=si(A);Ee.readable.pipeTo(V.ws),W=Ee.writable.getWriter()}return W.write(X)};if(Array.isArray(k))for(let X of k)await ne(X);else await k({write:ne,get desiredSize(){return((W==null?void 0:W.desiredSize)||0)+10}});W&&await W.close(),Q=!0}catch(W){console.error(W)}finally{return V.rs.cancel(),Q}}async function ni(T,k){var F,V;let A=await jt(T);if(A)try{let Q=A.rs.getReader();for((F=k.start)==null?void 0:F.call(k);;){let{value:W,done:ne}=await Q.read();if(W!==void 0){let X;if(k.update instanceof Promise?X=await k.update(W):X=k.update(W),X){await Q.cancel();break}}if(ne){(V=k.end)==null||V.call(k);break}}}catch(Q){console.error(Q)}finally{A.ws.close()}}}),gH=Ht(()=>{}),Kt=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r():typeof define=="function"&&define.amd?define([],r):i.CryptoJS=r()})(e,function(){var i=i||(function(r,s){var n;if(typeof window<"u"&&window.crypto&&(n=window.crypto),typeof self<"u"&&self.crypto&&(n=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(n=globalThis.crypto),!n&&typeof window<"u"&&window.msCrypto&&(n=window.msCrypto),!n&&typeof global<"u"&&global.crypto&&(n=global.crypto),!n&&typeof pH=="function")try{n=gH()}catch{}var a=function(){if(n){if(typeof n.getRandomValues=="function")try{return n.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof n.randomBytes=="function")try{return n.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||(function(){function O(){}return function(y){var x;return O.prototype=y,x=new O,O.prototype=null,x}})(),l={},h=l.lib={},c=h.Base=(function(){return{extend:function(O){var y=o(this);return O&&y.mixIn(O),(!y.hasOwnProperty("init")||this.init===y.init)&&(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var O=this.extend();return O.init.apply(O,arguments),O},init:function(){},mixIn:function(O){for(var y in O)O.hasOwnProperty(y)&&(this[y]=O[y]);O.hasOwnProperty("toString")&&(this.toString=O.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),f=h.WordArray=c.extend({init:function(O,y){O=this.words=O||[],y!=s?this.sigBytes=y:this.sigBytes=O.length*4},toString:function(O){return(O||u).stringify(this)},concat:function(O){var y=this.words,x=O.words,E=this.sigBytes,w=O.sigBytes;if(this.clamp(),E%4)for(var S=0;S<w;S++){var C=x[S>>>2]>>>24-S%4*8&255;y[E+S>>>2]|=C<<24-(E+S)%4*8}else for(var R=0;R<w;R+=4)y[E+R>>>2]=x[R>>>2];return this.sigBytes+=w,this},clamp:function(){var O=this.words,y=this.sigBytes;O[y>>>2]&=4294967295<<32-y%4*8,O.length=r.ceil(y/4)},clone:function(){var O=c.clone.call(this);return O.words=this.words.slice(0),O},random:function(O){for(var y=[],x=0;x<O;x+=4)y.push(a());return new f.init(y,O)}}),d=l.enc={},u=d.Hex={stringify:function(O){for(var y=O.words,x=O.sigBytes,E=[],w=0;w<x;w++){var S=y[w>>>2]>>>24-w%4*8&255;E.push((S>>>4).toString(16)),E.push((S&15).toString(16))}return E.join("")},parse:function(O){for(var y=O.length,x=[],E=0;E<y;E+=2)x[E>>>3]|=parseInt(O.substr(E,2),16)<<24-E%8*4;return new f.init(x,y/2)}},p=d.Latin1={stringify:function(O){for(var y=O.words,x=O.sigBytes,E=[],w=0;w<x;w++){var S=y[w>>>2]>>>24-w%4*8&255;E.push(String.fromCharCode(S))}return E.join("")},parse:function(O){for(var y=O.length,x=[],E=0;E<y;E++)x[E>>>2]|=(O.charCodeAt(E)&255)<<24-E%4*8;return new f.init(x,y)}},_=d.Utf8={stringify:function(O){try{return decodeURIComponent(escape(p.stringify(O)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(O){return p.parse(unescape(encodeURIComponent(O)))}},g=h.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(O){typeof O=="string"&&(O=_.parse(O)),this._data.concat(O),this._nDataBytes+=O.sigBytes},_process:function(O){var y,x=this._data,E=x.words,w=x.sigBytes,S=this.blockSize,C=S*4,R=w/C;O?R=r.ceil(R):R=r.max((R|0)-this._minBufferSize,0);var B=R*S,Y=r.min(B*4,w);if(B){for(var G=0;G<B;G+=S)this._doProcessBlock(E,G);y=E.splice(0,B),x.sigBytes-=Y}return new f.init(y,Y)},clone:function(){var O=c.clone.call(this);return O._data=this._data.clone(),O},_minBufferSize:0}),b=h.Hasher=g.extend({cfg:c.extend(),init:function(O){this.cfg=this.cfg.extend(O),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(O){return this._append(O),this._process(),this},finalize:function(O){O&&this._append(O);var y=this._doFinalize();return y},blockSize:512/32,_createHelper:function(O){return function(y,x){return new O.init(x).finalize(y)}},_createHmacHelper:function(O){return function(y,x){return new m.HMAC.init(O,x).finalize(y)}}}),m=l.algo={};return l})(Math);return i})}),rO=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.Base,o=n.WordArray,l=s.x64={},h=l.Word=a.extend({init:function(f,d){this.high=f,this.low=d}}),c=l.WordArray=a.extend({init:function(f,d){f=this.words=f||[],d!=r?this.sigBytes=d:this.sigBytes=f.length*8},toX32:function(){for(var f=this.words,d=f.length,u=[],p=0;p<d;p++){var _=f[p];u.push(_.high),u.push(_.low)}return o.create(u,this.sigBytes)},clone:function(){for(var f=a.clone.call(this),d=f.words=this.words.slice(0),u=d.length,p=0;p<u;p++)d[p]=d[p].clone();return f}})})(),i})}),OH=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){if(typeof ArrayBuffer=="function"){var r=i,s=r.lib,n=s.WordArray,a=n.init,o=n.init=function(l){if(l instanceof ArrayBuffer&&(l=new Uint8Array(l)),(l instanceof Int8Array||typeof Uint8ClampedArray<"u"&&l instanceof Uint8ClampedArray||l instanceof Int16Array||l instanceof Uint16Array||l instanceof Int32Array||l instanceof Uint32Array||l instanceof Float32Array||l instanceof Float64Array)&&(l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength)),l instanceof Uint8Array){for(var h=l.byteLength,c=[],f=0;f<h;f++)c[f>>>2]|=l[f]<<24-f%4*8;a.call(this,c,h)}else a.apply(this,arguments)};o.prototype=n}})(),i.lib.WordArray})}),mH=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.enc,o=a.Utf16=a.Utf16BE={stringify:function(h){for(var c=h.words,f=h.sigBytes,d=[],u=0;u<f;u+=2){var p=c[u>>>2]>>>16-u%4*8&65535;d.push(String.fromCharCode(p))}return d.join("")},parse:function(h){for(var c=h.length,f=[],d=0;d<c;d++)f[d>>>1]|=h.charCodeAt(d)<<16-d%2*16;return n.create(f,c*2)}};a.Utf16LE={stringify:function(h){for(var c=h.words,f=h.sigBytes,d=[],u=0;u<f;u+=2){var p=l(c[u>>>2]>>>16-u%4*8&65535);d.push(String.fromCharCode(p))}return d.join("")},parse:function(h){for(var c=h.length,f=[],d=0;d<c;d++)f[d>>>1]|=l(h.charCodeAt(d)<<16-d%2*16);return n.create(f,c*2)}};function l(h){return h<<8&4278255360|h>>>8&16711935}})(),i.enc.Utf16})}),ch=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.enc,o=a.Base64={stringify:function(h){var c=h.words,f=h.sigBytes,d=this._map;h.clamp();for(var u=[],p=0;p<f;p+=3)for(var _=c[p>>>2]>>>24-p%4*8&255,g=c[p+1>>>2]>>>24-(p+1)%4*8&255,b=c[p+2>>>2]>>>24-(p+2)%4*8&255,m=_<<16|g<<8|b,O=0;O<4&&p+O*.75<f;O++)u.push(d.charAt(m>>>6*(3-O)&63));var y=d.charAt(64);if(y)for(;u.length%4;)u.push(y);return u.join("")},parse:function(h){var c=h.length,f=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var u=0;u<f.length;u++)d[f.charCodeAt(u)]=u}var p=f.charAt(64);if(p){var _=h.indexOf(p);_!==-1&&(c=_)}return l(h,c,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(h,c,f){for(var d=[],u=0,p=0;p<c;p++)if(p%4){var _=f[h.charCodeAt(p-1)]<<p%4*2,g=f[h.charCodeAt(p)]>>>6-p%4*2,b=_|g;d[u>>>2]|=b<<24-u%4*8,u++}return n.create(d,u)}})(),i.enc.Base64})}),yH=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.enc,o=a.Base64url={stringify:function(h,c){c===void 0&&(c=!0);var f=h.words,d=h.sigBytes,u=c?this._safe_map:this._map;h.clamp();for(var p=[],_=0;_<d;_+=3)for(var g=f[_>>>2]>>>24-_%4*8&255,b=f[_+1>>>2]>>>24-(_+1)%4*8&255,m=f[_+2>>>2]>>>24-(_+2)%4*8&255,O=g<<16|b<<8|m,y=0;y<4&&_+y*.75<d;y++)p.push(u.charAt(O>>>6*(3-y)&63));var x=u.charAt(64);if(x)for(;p.length%4;)p.push(x);return p.join("")},parse:function(h,c){c===void 0&&(c=!0);var f=h.length,d=c?this._safe_map:this._map,u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var p=0;p<d.length;p++)u[d.charCodeAt(p)]=p}var _=d.charAt(64);if(_){var g=h.indexOf(_);g!==-1&&(f=g)}return l(h,f,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(h,c,f){for(var d=[],u=0,p=0;p<c;p++)if(p%4){var _=f[h.charCodeAt(p-1)]<<p%4*2,g=f[h.charCodeAt(p)]>>>6-p%4*2,b=_|g;d[u>>>2]|=b<<24-u%4*8,u++}return n.create(d,u)}})(),i.enc.Base64url})}),uh=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.algo,h=[];(function(){for(var _=0;_<64;_++)h[_]=r.abs(r.sin(_+1))*4294967296|0})();var c=l.MD5=o.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(_,g){for(var b=0;b<16;b++){var m=g+b,O=_[m];_[m]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360}var y=this._hash.words,x=_[g+0],E=_[g+1],w=_[g+2],S=_[g+3],C=_[g+4],R=_[g+5],B=_[g+6],Y=_[g+7],G=_[g+8],z=_[g+9],q=_[g+10],L=_[g+11],M=_[g+12],v=_[g+13],P=_[g+14],I=_[g+15],N=y[0],D=y[1],j=y[2],H=y[3];N=f(N,D,j,H,x,7,h[0]),H=f(H,N,D,j,E,12,h[1]),j=f(j,H,N,D,w,17,h[2]),D=f(D,j,H,N,S,22,h[3]),N=f(N,D,j,H,C,7,h[4]),H=f(H,N,D,j,R,12,h[5]),j=f(j,H,N,D,B,17,h[6]),D=f(D,j,H,N,Y,22,h[7]),N=f(N,D,j,H,G,7,h[8]),H=f(H,N,D,j,z,12,h[9]),j=f(j,H,N,D,q,17,h[10]),D=f(D,j,H,N,L,22,h[11]),N=f(N,D,j,H,M,7,h[12]),H=f(H,N,D,j,v,12,h[13]),j=f(j,H,N,D,P,17,h[14]),D=f(D,j,H,N,I,22,h[15]),N=d(N,D,j,H,E,5,h[16]),H=d(H,N,D,j,B,9,h[17]),j=d(j,H,N,D,L,14,h[18]),D=d(D,j,H,N,x,20,h[19]),N=d(N,D,j,H,R,5,h[20]),H=d(H,N,D,j,q,9,h[21]),j=d(j,H,N,D,I,14,h[22]),D=d(D,j,H,N,C,20,h[23]),N=d(N,D,j,H,z,5,h[24]),H=d(H,N,D,j,P,9,h[25]),j=d(j,H,N,D,S,14,h[26]),D=d(D,j,H,N,G,20,h[27]),N=d(N,D,j,H,v,5,h[28]),H=d(H,N,D,j,w,9,h[29]),j=d(j,H,N,D,Y,14,h[30]),D=d(D,j,H,N,M,20,h[31]),N=u(N,D,j,H,R,4,h[32]),H=u(H,N,D,j,G,11,h[33]),j=u(j,H,N,D,L,16,h[34]),D=u(D,j,H,N,P,23,h[35]),N=u(N,D,j,H,E,4,h[36]),H=u(H,N,D,j,C,11,h[37]),j=u(j,H,N,D,Y,16,h[38]),D=u(D,j,H,N,q,23,h[39]),N=u(N,D,j,H,v,4,h[40]),H=u(H,N,D,j,x,11,h[41]),j=u(j,H,N,D,S,16,h[42]),D=u(D,j,H,N,B,23,h[43]),N=u(N,D,j,H,z,4,h[44]),H=u(H,N,D,j,M,11,h[45]),j=u(j,H,N,D,I,16,h[46]),D=u(D,j,H,N,w,23,h[47]),N=p(N,D,j,H,x,6,h[48]),H=p(H,N,D,j,Y,10,h[49]),j=p(j,H,N,D,P,15,h[50]),D=p(D,j,H,N,R,21,h[51]),N=p(N,D,j,H,M,6,h[52]),H=p(H,N,D,j,S,10,h[53]),j=p(j,H,N,D,q,15,h[54]),D=p(D,j,H,N,E,21,h[55]),N=p(N,D,j,H,G,6,h[56]),H=p(H,N,D,j,I,10,h[57]),j=p(j,H,N,D,B,15,h[58]),D=p(D,j,H,N,v,21,h[59]),N=p(N,D,j,H,C,6,h[60]),H=p(H,N,D,j,L,10,h[61]),j=p(j,H,N,D,w,15,h[62]),D=p(D,j,H,N,z,21,h[63]),y[0]=y[0]+N|0,y[1]=y[1]+D|0,y[2]=y[2]+j|0,y[3]=y[3]+H|0},_doFinalize:function(){var _=this._data,g=_.words,b=this._nDataBytes*8,m=_.sigBytes*8;g[m>>>5]|=128<<24-m%32;var O=r.floor(b/4294967296),y=b;g[(m+64>>>9<<4)+15]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,g[(m+64>>>9<<4)+14]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360,_.sigBytes=(g.length+1)*4,this._process();for(var x=this._hash,E=x.words,w=0;w<4;w++){var S=E[w];E[w]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}return x},clone:function(){var _=o.clone.call(this);return _._hash=this._hash.clone(),_}});function f(_,g,b,m,O,y,x){var E=_+(g&b|~g&m)+O+x;return(E<<y|E>>>32-y)+g}function d(_,g,b,m,O,y,x){var E=_+(g&m|b&~m)+O+x;return(E<<y|E>>>32-y)+g}function u(_,g,b,m,O,y,x){var E=_+(g^b^m)+O+x;return(E<<y|E>>>32-y)+g}function p(_,g,b,m,O,y,x){var E=_+(b^(g|~m))+O+x;return(E<<y|E>>>32-y)+g}s.MD5=o._createHelper(c),s.HmacMD5=o._createHmacHelper(c)})(Math),i.MD5})}),PI=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=s.Hasher,o=r.algo,l=[],h=o.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,f){for(var d=this._hash.words,u=d[0],p=d[1],_=d[2],g=d[3],b=d[4],m=0;m<80;m++){if(m<16)l[m]=c[f+m]|0;else{var O=l[m-3]^l[m-8]^l[m-14]^l[m-16];l[m]=O<<1|O>>>31}var y=(u<<5|u>>>27)+b+l[m];m<20?y+=(p&_|~p&g)+1518500249:m<40?y+=(p^_^g)+1859775393:m<60?y+=(p&_|p&g|_&g)-1894007588:y+=(p^_^g)-899497514,b=g,g=_,_=p<<30|p>>>2,p=u,u=y}d[0]=d[0]+u|0,d[1]=d[1]+p|0,d[2]=d[2]+_|0,d[3]=d[3]+g|0,d[4]=d[4]+b|0},_doFinalize:function(){var c=this._data,f=c.words,d=this._nDataBytes*8,u=c.sigBytes*8;return f[u>>>5]|=128<<24-u%32,f[(u+64>>>9<<4)+14]=Math.floor(d/4294967296),f[(u+64>>>9<<4)+15]=d,c.sigBytes=f.length*4,this._process(),this._hash},clone:function(){var c=a.clone.call(this);return c._hash=this._hash.clone(),c}});r.SHA1=a._createHelper(h),r.HmacSHA1=a._createHmacHelper(h)})(),i.SHA1})}),Py=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.algo,h=[],c=[];(function(){function u(b){for(var m=r.sqrt(b),O=2;O<=m;O++)if(!(b%O))return!1;return!0}function p(b){return(b-(b|0))*4294967296|0}for(var _=2,g=0;g<64;)u(_)&&(g<8&&(h[g]=p(r.pow(_,1/2))),c[g]=p(r.pow(_,1/3)),g++),_++})();var f=[],d=l.SHA256=o.extend({_doReset:function(){this._hash=new a.init(h.slice(0))},_doProcessBlock:function(u,p){for(var _=this._hash.words,g=_[0],b=_[1],m=_[2],O=_[3],y=_[4],x=_[5],E=_[6],w=_[7],S=0;S<64;S++){if(S<16)f[S]=u[p+S]|0;else{var C=f[S-15],R=(C<<25|C>>>7)^(C<<14|C>>>18)^C>>>3,B=f[S-2],Y=(B<<15|B>>>17)^(B<<13|B>>>19)^B>>>10;f[S]=R+f[S-7]+Y+f[S-16]}var G=y&x^~y&E,z=g&b^g&m^b&m,q=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),L=(y<<26|y>>>6)^(y<<21|y>>>11)^(y<<7|y>>>25),M=w+L+G+c[S]+f[S],v=q+z;w=E,E=x,x=y,y=O+M|0,O=m,m=b,b=g,g=M+v|0}_[0]=_[0]+g|0,_[1]=_[1]+b|0,_[2]=_[2]+m|0,_[3]=_[3]+O|0,_[4]=_[4]+y|0,_[5]=_[5]+x|0,_[6]=_[6]+E|0,_[7]=_[7]+w|0},_doFinalize:function(){var u=this._data,p=u.words,_=this._nDataBytes*8,g=u.sigBytes*8;return p[g>>>5]|=128<<24-g%32,p[(g+64>>>9<<4)+14]=r.floor(_/4294967296),p[(g+64>>>9<<4)+15]=_,u.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var u=o.clone.call(this);return u._hash=this._hash.clone(),u}});s.SHA256=o._createHelper(d),s.HmacSHA256=o._createHmacHelper(d)})(Math),i.SHA256})}),bH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Py()):typeof define=="function"&&define.amd?define(["./core","./sha256"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=r.algo,o=a.SHA256,l=a.SHA224=o.extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var h=o._doFinalize.call(this);return h.sigBytes-=4,h}});r.SHA224=o._createHelper(l),r.HmacSHA224=o._createHmacHelper(l)})(),i.SHA224})}),AI=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),rO()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.Hasher,a=r.x64,o=a.Word,l=a.WordArray,h=r.algo;function c(){return o.create.apply(o,arguments)}var f=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],d=[];(function(){for(var p=0;p<80;p++)d[p]=c()})();var u=h.SHA512=n.extend({_doReset:function(){this._hash=new l.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(p,_){for(var g=this._hash.words,b=g[0],m=g[1],O=g[2],y=g[3],x=g[4],E=g[5],w=g[6],S=g[7],C=b.high,R=b.low,B=m.high,Y=m.low,G=O.high,z=O.low,q=y.high,L=y.low,M=x.high,v=x.low,P=E.high,I=E.low,N=w.high,D=w.low,j=S.high,H=S.low,K=C,se=R,he=B,_e=Y,ve=G,J=z,Z=q,re=L,ue=M,Le=v,Ce=P,De=I,Pe=N,Ie=D,Je=j,$e=H,pt=0;pt<80;pt++){var ct,ut,si=d[pt];if(pt<16)ut=si.high=p[_+pt*2]|0,ct=si.low=p[_+pt*2+1]|0;else{var mi=d[pt-15],It=mi.high,jt=mi.low,Ai=(It>>>1|jt<<31)^(It>>>8|jt<<24)^It>>>7,ni=(jt>>>1|It<<31)^(jt>>>8|It<<24)^(jt>>>7|It<<25),T=d[pt-2],k=T.high,A=T.low,F=(k>>>19|A<<13)^(k<<3|A>>>29)^k>>>6,V=(A>>>19|k<<13)^(A<<3|k>>>29)^(A>>>6|k<<26),Q=d[pt-7],W=Q.high,ne=Q.low,X=d[pt-16],Ee=X.high,Me=X.low;ct=ni+ne,ut=Ai+W+(ct>>>0<ni>>>0?1:0),ct=ct+V,ut=ut+F+(ct>>>0<V>>>0?1:0),ct=ct+Me,ut=ut+Ee+(ct>>>0<Me>>>0?1:0),si.high=ut,si.low=ct}var U=ue&Ce^~ue&Pe,be=Le&De^~Le&Ie,Ne=K&he^K&ve^he&ve,$=se&_e^se&J^_e&J,fe=(K>>>28|se<<4)^(K<<30|se>>>2)^(K<<25|se>>>7),Se=(se>>>28|K<<4)^(se<<30|K>>>2)^(se<<25|K>>>7),ze=(ue>>>14|Le<<18)^(ue>>>18|Le<<14)^(ue<<23|Le>>>9),Ue=(Le>>>14|ue<<18)^(Le>>>18|ue<<14)^(Le<<23|ue>>>9),je=f[pt],Dt=je.high,Ts=je.low,ft=$e+Ue,dt=Je+ze+(ft>>>0<$e>>>0?1:0),ft=ft+be,dt=dt+U+(ft>>>0<be>>>0?1:0),ft=ft+Ts,dt=dt+Dt+(ft>>>0<Ts>>>0?1:0),ft=ft+ct,dt=dt+ut+(ft>>>0<ct>>>0?1:0),Li=Se+$,fr=fe+Ne+(Li>>>0<Se>>>0?1:0);Je=Pe,$e=Ie,Pe=Ce,Ie=De,Ce=ue,De=Le,Le=re+ft|0,ue=Z+dt+(Le>>>0<re>>>0?1:0)|0,Z=ve,re=J,ve=he,J=_e,he=K,_e=se,se=ft+Li|0,K=dt+fr+(se>>>0<ft>>>0?1:0)|0}R=b.low=R+se,b.high=C+K+(R>>>0<se>>>0?1:0),Y=m.low=Y+_e,m.high=B+he+(Y>>>0<_e>>>0?1:0),z=O.low=z+J,O.high=G+ve+(z>>>0<J>>>0?1:0),L=y.low=L+re,y.high=q+Z+(L>>>0<re>>>0?1:0),v=x.low=v+Le,x.high=M+ue+(v>>>0<Le>>>0?1:0),I=E.low=I+De,E.high=P+Ce+(I>>>0<De>>>0?1:0),D=w.low=D+Ie,w.high=N+Pe+(D>>>0<Ie>>>0?1:0),H=S.low=H+$e,S.high=j+Je+(H>>>0<$e>>>0?1:0)},_doFinalize:function(){var p=this._data,_=p.words,g=this._nDataBytes*8,b=p.sigBytes*8;_[b>>>5]|=128<<24-b%32,_[(b+128>>>10<<5)+30]=Math.floor(g/4294967296),_[(b+128>>>10<<5)+31]=g,p.sigBytes=_.length*4,this._process();var m=this._hash.toX32();return m},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=n._createHelper(u),r.HmacSHA512=n._createHmacHelper(u)})(),i.SHA512})}),xH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),rO(),AI()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./sha512"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.x64,n=s.Word,a=s.WordArray,o=r.algo,l=o.SHA512,h=o.SHA384=l.extend({_doReset:function(){this._hash=new a.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var c=l._doFinalize.call(this);return c.sigBytes-=16,c}});r.SHA384=l._createHelper(h),r.HmacSHA384=l._createHmacHelper(h)})(),i.SHA384})}),vH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),rO()):typeof define=="function"&&define.amd?define(["./core","./x64-core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.x64,h=l.Word,c=s.algo,f=[],d=[],u=[];(function(){for(var g=1,b=0,m=0;m<24;m++){f[g+5*b]=(m+1)*(m+2)/2%64;var O=b%5,y=(2*g+3*b)%5;g=O,b=y}for(var g=0;g<5;g++)for(var b=0;b<5;b++)d[g+5*b]=b+(2*g+3*b)%5*5;for(var x=1,E=0;E<24;E++){for(var w=0,S=0,C=0;C<7;C++){if(x&1){var R=(1<<C)-1;R<32?S^=1<<R:w^=1<<R-32}x&128?x=x<<1^113:x<<=1}u[E]=h.create(w,S)}})();var p=[];(function(){for(var g=0;g<25;g++)p[g]=h.create()})();var _=c.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var g=this._state=[],b=0;b<25;b++)g[b]=new h.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(g,b){for(var m=this._state,O=this.blockSize/2,y=0;y<O;y++){var x=g[b+2*y],E=g[b+2*y+1];x=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360;var w=m[y];w.high^=E,w.low^=x}for(var S=0;S<24;S++){for(var C=0;C<5;C++){for(var R=0,B=0,Y=0;Y<5;Y++){var w=m[C+5*Y];R^=w.high,B^=w.low}var G=p[C];G.high=R,G.low=B}for(var C=0;C<5;C++)for(var z=p[(C+4)%5],q=p[(C+1)%5],L=q.high,M=q.low,R=z.high^(L<<1|M>>>31),B=z.low^(M<<1|L>>>31),Y=0;Y<5;Y++){var w=m[C+5*Y];w.high^=R,w.low^=B}for(var v=1;v<25;v++){var R,B,w=m[v],P=w.high,I=w.low,N=f[v];N<32?(R=P<<N|I>>>32-N,B=I<<N|P>>>32-N):(R=I<<N-32|P>>>64-N,B=P<<N-32|I>>>64-N);var D=p[d[v]];D.high=R,D.low=B}var j=p[0],H=m[0];j.high=H.high,j.low=H.low;for(var C=0;C<5;C++)for(var Y=0;Y<5;Y++){var v=C+5*Y,w=m[v],K=p[v],se=p[(C+1)%5+5*Y],he=p[(C+2)%5+5*Y];w.high=K.high^~se.high&he.high,w.low=K.low^~se.low&he.low}var w=m[0],_e=u[S];w.high^=_e.high,w.low^=_e.low}},_doFinalize:function(){var g=this._data,b=g.words,m=this._nDataBytes*8,O=g.sigBytes*8,y=this.blockSize*32;b[O>>>5]|=1<<24-O%32,b[(r.ceil((O+1)/y)*y>>>5)-1]|=128,g.sigBytes=b.length*4,this._process();for(var x=this._state,E=this.cfg.outputLength/8,w=E/8,S=[],C=0;C<w;C++){var R=x[C],B=R.high,Y=R.low;B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,Y=(Y<<8|Y>>>24)&16711935|(Y<<24|Y>>>8)&4278255360,S.push(Y),S.push(B)}return new a.init(S,E)},clone:function(){for(var g=o.clone.call(this),b=g._state=this._state.slice(0),m=0;m<25;m++)b[m]=b[m].clone();return g}});s.SHA3=o._createHelper(_),s.HmacSHA3=o._createHmacHelper(_)})(Math),i.SHA3})}),EH=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.WordArray,o=n.Hasher,l=s.algo,h=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),f=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=a.create([0,1518500249,1859775393,2400959708,2840853838]),p=a.create([1352829926,1548603684,1836072691,2053994217,0]),_=l.RIPEMD160=o.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(E,w){for(var S=0;S<16;S++){var C=w+S,R=E[C];E[C]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}var B=this._hash.words,Y=u.words,G=p.words,z=h.words,q=c.words,L=f.words,M=d.words,v,P,I,N,D,j,H,K,se,he;j=v=B[0],H=P=B[1],K=I=B[2],se=N=B[3],he=D=B[4];for(var _e,S=0;S<80;S+=1)_e=v+E[w+z[S]]|0,S<16?_e+=g(P,I,N)+Y[0]:S<32?_e+=b(P,I,N)+Y[1]:S<48?_e+=m(P,I,N)+Y[2]:S<64?_e+=O(P,I,N)+Y[3]:_e+=y(P,I,N)+Y[4],_e=_e|0,_e=x(_e,L[S]),_e=_e+D|0,v=D,D=N,N=x(I,10),I=P,P=_e,_e=j+E[w+q[S]]|0,S<16?_e+=y(H,K,se)+G[0]:S<32?_e+=O(H,K,se)+G[1]:S<48?_e+=m(H,K,se)+G[2]:S<64?_e+=b(H,K,se)+G[3]:_e+=g(H,K,se)+G[4],_e=_e|0,_e=x(_e,M[S]),_e=_e+he|0,j=he,he=se,se=x(K,10),K=H,H=_e;_e=B[1]+I+se|0,B[1]=B[2]+N+he|0,B[2]=B[3]+D+j|0,B[3]=B[4]+v+H|0,B[4]=B[0]+P+K|0,B[0]=_e},_doFinalize:function(){var E=this._data,w=E.words,S=this._nDataBytes*8,C=E.sigBytes*8;w[C>>>5]|=128<<24-C%32,w[(C+64>>>9<<4)+14]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,E.sigBytes=(w.length+1)*4,this._process();for(var R=this._hash,B=R.words,Y=0;Y<5;Y++){var G=B[Y];B[Y]=(G<<8|G>>>24)&16711935|(G<<24|G>>>8)&4278255360}return R},clone:function(){var E=o.clone.call(this);return E._hash=this._hash.clone(),E}});function g(E,w,S){return E^w^S}function b(E,w,S){return E&w|~E&S}function m(E,w,S){return(E|~w)^S}function O(E,w,S){return E&S|w&~S}function y(E,w,S){return E^(w|~S)}function x(E,w){return E<<w|E>>>32-w}s.RIPEMD160=o._createHelper(_),s.HmacRIPEMD160=o._createHmacHelper(_)})(Math),i.RIPEMD160})}),Ay=Ht((e,t)=>{(function(i,r){typeof e=="object"?t.exports=e=r(Kt()):typeof define=="function"&&define.amd?define(["./core"],r):r(i.CryptoJS)})(e,function(i){(function(){var r=i,s=r.lib,n=s.Base,a=r.enc,o=a.Utf8,l=r.algo,h=l.HMAC=n.extend({init:function(c,f){c=this._hasher=new c.init,typeof f=="string"&&(f=o.parse(f));var d=c.blockSize,u=d*4;f.sigBytes>u&&(f=c.finalize(f)),f.clamp();for(var p=this._oKey=f.clone(),_=this._iKey=f.clone(),g=p.words,b=_.words,m=0;m<d;m++)g[m]^=1549556828,b[m]^=909522486;p.sigBytes=_.sigBytes=u,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var f=this._hasher,d=f.finalize(c);f.reset();var u=f.finalize(this._oKey.clone().concat(d));return u}})})()})}),TH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Py(),Ay()):typeof define=="function"&&define.amd?define(["./core","./sha256","./hmac"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.Base,a=s.WordArray,o=r.algo,l=o.SHA256,h=o.HMAC,c=o.PBKDF2=n.extend({cfg:n.extend({keySize:128/32,hasher:l,iterations:25e4}),init:function(f){this.cfg=this.cfg.extend(f)},compute:function(f,d){for(var u=this.cfg,p=h.create(u.hasher,f),_=a.create(),g=a.create([1]),b=_.words,m=g.words,O=u.keySize,y=u.iterations;b.length<O;){var x=p.update(d).finalize(g);p.reset();for(var E=x.words,w=E.length,S=x,C=1;C<y;C++){S=p.finalize(S),p.reset();for(var R=S.words,B=0;B<w;B++)E[B]^=R[B]}_.concat(x),m[0]++}return _.sigBytes=O*4,_}});r.PBKDF2=function(f,d,u){return c.create(u).compute(f,d)}})(),i.PBKDF2})}),gl=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),PI(),Ay()):typeof define=="function"&&define.amd?define(["./core","./sha1","./hmac"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.Base,a=s.WordArray,o=r.algo,l=o.MD5,h=o.EvpKDF=n.extend({cfg:n.extend({keySize:128/32,hasher:l,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,f){for(var d,u=this.cfg,p=u.hasher.create(),_=a.create(),g=_.words,b=u.keySize,m=u.iterations;g.length<b;){d&&p.update(d),d=p.update(c).finalize(f),p.reset();for(var O=1;O<m;O++)d=p.finalize(d),p.reset();_.concat(d)}return _.sigBytes=b*4,_}});r.EvpKDF=function(c,f,d){return h.create(d).compute(c,f)}})(),i.EvpKDF})}),Jr=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),gl()):typeof define=="function"&&define.amd?define(["./core","./evpkdf"],r):r(i.CryptoJS)})(e,function(i){i.lib.Cipher||(function(r){var s=i,n=s.lib,a=n.Base,o=n.WordArray,l=n.BufferedBlockAlgorithm,h=s.enc,c=h.Utf8,f=h.Base64,d=s.algo,u=d.EvpKDF,p=n.Cipher=l.extend({cfg:a.extend(),createEncryptor:function(G,z){return this.create(this._ENC_XFORM_MODE,G,z)},createDecryptor:function(G,z){return this.create(this._DEC_XFORM_MODE,G,z)},init:function(G,z,q){this.cfg=this.cfg.extend(q),this._xformMode=G,this._key=z,this.reset()},reset:function(){l.reset.call(this),this._doReset()},process:function(G){return this._append(G),this._process()},finalize:function(G){G&&this._append(G);var z=this._doFinalize();return z},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function G(z){return typeof z=="string"?Y:C}return function(z){return{encrypt:function(q,L,M){return G(L).encrypt(z,q,L,M)},decrypt:function(q,L,M){return G(L).decrypt(z,q,L,M)}}}})()}),_=n.StreamCipher=p.extend({_doFinalize:function(){var G=this._process(!0);return G},blockSize:1}),g=s.mode={},b=n.BlockCipherMode=a.extend({createEncryptor:function(G,z){return this.Encryptor.create(G,z)},createDecryptor:function(G,z){return this.Decryptor.create(G,z)},init:function(G,z){this._cipher=G,this._iv=z}}),m=g.CBC=(function(){var G=b.extend();G.Encryptor=G.extend({processBlock:function(q,L){var M=this._cipher,v=M.blockSize;z.call(this,q,L,v),M.encryptBlock(q,L),this._prevBlock=q.slice(L,L+v)}}),G.Decryptor=G.extend({processBlock:function(q,L){var M=this._cipher,v=M.blockSize,P=q.slice(L,L+v);M.decryptBlock(q,L),z.call(this,q,L,v),this._prevBlock=P}});function z(q,L,M){var v,P=this._iv;P?(v=P,this._iv=r):v=this._prevBlock;for(var I=0;I<M;I++)q[L+I]^=v[I]}return G})(),O=s.pad={},y=O.Pkcs7={pad:function(G,z){for(var q=z*4,L=q-G.sigBytes%q,M=L<<24|L<<16|L<<8|L,v=[],P=0;P<L;P+=4)v.push(M);var I=o.create(v,L);G.concat(I)},unpad:function(G){var z=G.words[G.sigBytes-1>>>2]&255;G.sigBytes-=z}},x=n.BlockCipher=p.extend({cfg:p.cfg.extend({mode:m,padding:y}),reset:function(){var G;p.reset.call(this);var z=this.cfg,q=z.iv,L=z.mode;this._xformMode==this._ENC_XFORM_MODE?G=L.createEncryptor:(G=L.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==G?this._mode.init(this,q&&q.words):(this._mode=G.call(L,this,q&&q.words),this._mode.__creator=G)},_doProcessBlock:function(G,z){this._mode.processBlock(G,z)},_doFinalize:function(){var G,z=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(z.pad(this._data,this.blockSize),G=this._process(!0)):(G=this._process(!0),z.unpad(G)),G},blockSize:128/32}),E=n.CipherParams=a.extend({init:function(G){this.mixIn(G)},toString:function(G){return(G||this.formatter).stringify(this)}}),w=s.format={},S=w.OpenSSL={stringify:function(G){var z,q=G.ciphertext,L=G.salt;return L?z=o.create([1398893684,1701076831]).concat(L).concat(q):z=q,z.toString(f)},parse:function(G){var z,q=f.parse(G),L=q.words;return L[0]==1398893684&&L[1]==1701076831&&(z=o.create(L.slice(2,4)),L.splice(0,4),q.sigBytes-=16),E.create({ciphertext:q,salt:z})}},C=n.SerializableCipher=a.extend({cfg:a.extend({format:S}),encrypt:function(G,z,q,L){L=this.cfg.extend(L);var M=G.createEncryptor(q,L),v=M.finalize(z),P=M.cfg;return E.create({ciphertext:v,key:q,iv:P.iv,algorithm:G,mode:P.mode,padding:P.padding,blockSize:G.blockSize,formatter:L.format})},decrypt:function(G,z,q,L){L=this.cfg.extend(L),z=this._parse(z,L.format);var M=G.createDecryptor(q,L).finalize(z.ciphertext);return M},_parse:function(G,z){return typeof G=="string"?z.parse(G,this):G}}),R=s.kdf={},B=R.OpenSSL={execute:function(G,z,q,L,M){if(L||(L=o.random(64/8)),M)var v=u.create({keySize:z+q,hasher:M}).compute(G,L);else var v=u.create({keySize:z+q}).compute(G,L);var P=o.create(v.words.slice(z),q*4);return v.sigBytes=z*4,E.create({key:v,iv:P,salt:L})}},Y=n.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:B}),encrypt:function(G,z,q,L){L=this.cfg.extend(L);var M=L.kdf.execute(q,G.keySize,G.ivSize,L.salt,L.hasher);L.iv=M.iv;var v=C.encrypt.call(this,G,z,M.key,L);return v.mixIn(M),v},decrypt:function(G,z,q,L){L=this.cfg.extend(L),z=this._parse(z,L.format);var M=L.kdf.execute(q,G.keySize,G.ivSize,z.salt,L.hasher);L.iv=M.iv;var v=C.decrypt.call(this,G,z,M.key,L);return v}})})()})}),wH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.CFB=(function(){var r=i.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize;s.call(this,n,a,l,o),this._prevBlock=n.slice(a,a+l)}}),r.Decryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,h=n.slice(a,a+l);s.call(this,n,a,l,o),this._prevBlock=h}});function s(n,a,o,l){var h,c=this._iv;c?(h=c.slice(0),this._iv=void 0):h=this._prevBlock,l.encryptBlock(h,0);for(var f=0;f<o;f++)n[a+f]^=h[f]}return r})(),i.mode.CFB})}),SH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.CTR=(function(){var r=i.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,h=this._iv,c=this._counter;h&&(c=this._counter=h.slice(0),this._iv=void 0);var f=c.slice(0);o.encryptBlock(f,0),c[l-1]=c[l-1]+1|0;for(var d=0;d<l;d++)n[a+d]^=f[d]}});return r.Decryptor=s,r})(),i.mode.CTR})}),IH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.CTRGladman=(function(){var r=i.lib.BlockCipherMode.extend();function s(o){if((o>>24&255)===255){var l=o>>16&255,h=o>>8&255,c=o&255;l===255?(l=0,h===255?(h=0,c===255?c=0:++c):++h):++l,o=0,o+=l<<16,o+=h<<8,o+=c}else o+=1<<24;return o}function n(o){return(o[0]=s(o[0]))===0&&(o[1]=s(o[1])),o}var a=r.Encryptor=r.extend({processBlock:function(o,l){var h=this._cipher,c=h.blockSize,f=this._iv,d=this._counter;f&&(d=this._counter=f.slice(0),this._iv=void 0),n(d);var u=d.slice(0);h.encryptBlock(u,0);for(var p=0;p<c;p++)o[l+p]^=u[p]}});return r.Decryptor=a,r})(),i.mode.CTRGladman})}),PH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.OFB=(function(){var r=i.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(n,a){var o=this._cipher,l=o.blockSize,h=this._iv,c=this._keystream;h&&(c=this._keystream=h.slice(0),this._iv=void 0),o.encryptBlock(c,0);for(var f=0;f<l;f++)n[a+f]^=c[f]}});return r.Decryptor=s,r})(),i.mode.OFB})}),AH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.mode.ECB=(function(){var r=i.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(s,n){this._cipher.encryptBlock(s,n)}}),r.Decryptor=r.extend({processBlock:function(s,n){this._cipher.decryptBlock(s,n)}}),r})(),i.mode.ECB})}),CH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.AnsiX923={pad:function(r,s){var n=r.sigBytes,a=s*4,o=a-n%a,l=n+o-1;r.clamp(),r.words[l>>>2]|=o<<24-l%4*8,r.sigBytes+=o},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},i.pad.Ansix923})}),NH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.Iso10126={pad:function(r,s){var n=s*4,a=n-r.sigBytes%n;r.concat(i.lib.WordArray.random(a-1)).concat(i.lib.WordArray.create([a<<24],1))},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},i.pad.Iso10126})}),LH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.Iso97971={pad:function(r,s){r.concat(i.lib.WordArray.create([2147483648],1)),i.pad.ZeroPadding.pad(r,s)},unpad:function(r){i.pad.ZeroPadding.unpad(r),r.sigBytes--}},i.pad.Iso97971})}),RH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.ZeroPadding={pad:function(r,s){var n=s*4;r.clamp(),r.sigBytes+=n-(r.sigBytes%n||n)},unpad:function(r){for(var s=r.words,n=r.sigBytes-1,n=r.sigBytes-1;n>=0;n--)if(s[n>>>2]>>>24-n%4*8&255){r.sigBytes=n+1;break}}},i.pad.ZeroPadding})}),DH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return i.pad.NoPadding={pad:function(){},unpad:function(){}},i.pad.NoPadding})}),MH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),Jr()):typeof define=="function"&&define.amd?define(["./core","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(r){var s=i,n=s.lib,a=n.CipherParams,o=s.enc,l=o.Hex,h=s.format,c=h.Hex={stringify:function(f){return f.ciphertext.toString(l)},parse:function(f){var d=l.parse(f);return a.create({ciphertext:d})}}})(),i.format.Hex})}),BH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),ch(),uh(),gl(),Jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.BlockCipher,a=r.algo,o=[],l=[],h=[],c=[],f=[],d=[],u=[],p=[],_=[],g=[];(function(){for(var O=[],y=0;y<256;y++)y<128?O[y]=y<<1:O[y]=y<<1^283;for(var x=0,E=0,y=0;y<256;y++){var w=E^E<<1^E<<2^E<<3^E<<4;w=w>>>8^w&255^99,o[x]=w,l[w]=x;var S=O[x],C=O[S],R=O[C],B=O[w]*257^w*16843008;h[x]=B<<24|B>>>8,c[x]=B<<16|B>>>16,f[x]=B<<8|B>>>24,d[x]=B;var B=R*16843009^C*65537^S*257^x*16843008;u[w]=B<<24|B>>>8,p[w]=B<<16|B>>>16,_[w]=B<<8|B>>>24,g[w]=B,x?(x=S^O[O[O[R^S]]],E^=O[O[E]]):x=E=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],m=a.AES=n.extend({_doReset:function(){var O;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var y=this._keyPriorReset=this._key,x=y.words,E=y.sigBytes/4,w=this._nRounds=E+6,S=(w+1)*4,C=this._keySchedule=[],R=0;R<S;R++)R<E?C[R]=x[R]:(O=C[R-1],R%E?E>6&&R%E==4&&(O=o[O>>>24]<<24|o[O>>>16&255]<<16|o[O>>>8&255]<<8|o[O&255]):(O=O<<8|O>>>24,O=o[O>>>24]<<24|o[O>>>16&255]<<16|o[O>>>8&255]<<8|o[O&255],O^=b[R/E|0]<<24),C[R]=C[R-E]^O);for(var B=this._invKeySchedule=[],Y=0;Y<S;Y++){var R=S-Y;if(Y%4)var O=C[R];else var O=C[R-4];Y<4||R<=4?B[Y]=O:B[Y]=u[o[O>>>24]]^p[o[O>>>16&255]]^_[o[O>>>8&255]]^g[o[O&255]]}}},encryptBlock:function(O,y){this._doCryptBlock(O,y,this._keySchedule,h,c,f,d,o)},decryptBlock:function(O,y){var x=O[y+1];O[y+1]=O[y+3],O[y+3]=x,this._doCryptBlock(O,y,this._invKeySchedule,u,p,_,g,l);var x=O[y+1];O[y+1]=O[y+3],O[y+3]=x},_doCryptBlock:function(O,y,x,E,w,S,C,R){for(var B=this._nRounds,Y=O[y]^x[0],G=O[y+1]^x[1],z=O[y+2]^x[2],q=O[y+3]^x[3],L=4,M=1;M<B;M++){var v=E[Y>>>24]^w[G>>>16&255]^S[z>>>8&255]^C[q&255]^x[L++],P=E[G>>>24]^w[z>>>16&255]^S[q>>>8&255]^C[Y&255]^x[L++],I=E[z>>>24]^w[q>>>16&255]^S[Y>>>8&255]^C[G&255]^x[L++],N=E[q>>>24]^w[Y>>>16&255]^S[G>>>8&255]^C[z&255]^x[L++];Y=v,G=P,z=I,q=N}var v=(R[Y>>>24]<<24|R[G>>>16&255]<<16|R[z>>>8&255]<<8|R[q&255])^x[L++],P=(R[G>>>24]<<24|R[z>>>16&255]<<16|R[q>>>8&255]<<8|R[Y&255])^x[L++],I=(R[z>>>24]<<24|R[q>>>16&255]<<16|R[Y>>>8&255]<<8|R[G&255])^x[L++],N=(R[q>>>24]<<24|R[Y>>>16&255]<<16|R[G>>>8&255]<<8|R[z&255])^x[L++];O[y]=v,O[y+1]=P,O[y+2]=I,O[y+3]=N},keySize:256/32});r.AES=n._createHelper(m)})(),i.AES})}),kH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),ch(),uh(),gl(),Jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.WordArray,a=s.BlockCipher,o=r.algo,l=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],h=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],f=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=o.DES=a.extend({_doReset:function(){for(var b=this._key,m=b.words,O=[],y=0;y<56;y++){var x=l[y]-1;O[y]=m[x>>>5]>>>31-x%32&1}for(var E=this._subKeys=[],w=0;w<16;w++){for(var S=E[w]=[],C=c[w],y=0;y<24;y++)S[y/6|0]|=O[(h[y]-1+C)%28]<<31-y%6,S[4+(y/6|0)]|=O[28+(h[y+24]-1+C)%28]<<31-y%6;S[0]=S[0]<<1|S[0]>>>31;for(var y=1;y<7;y++)S[y]=S[y]>>>(y-1)*4+3;S[7]=S[7]<<5|S[7]>>>27}for(var R=this._invSubKeys=[],y=0;y<16;y++)R[y]=E[15-y]},encryptBlock:function(b,m){this._doCryptBlock(b,m,this._subKeys)},decryptBlock:function(b,m){this._doCryptBlock(b,m,this._invSubKeys)},_doCryptBlock:function(b,m,O){this._lBlock=b[m],this._rBlock=b[m+1],p.call(this,4,252645135),p.call(this,16,65535),_.call(this,2,858993459),_.call(this,8,16711935),p.call(this,1,1431655765);for(var y=0;y<16;y++){for(var x=O[y],E=this._lBlock,w=this._rBlock,S=0,C=0;C<8;C++)S|=f[C][((w^x[C])&d[C])>>>0];this._lBlock=w,this._rBlock=E^S}var R=this._lBlock;this._lBlock=this._rBlock,this._rBlock=R,p.call(this,1,1431655765),_.call(this,8,16711935),_.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),b[m]=this._lBlock,b[m+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(b,m){var O=(this._lBlock>>>b^this._rBlock)&m;this._rBlock^=O,this._lBlock^=O<<b}function _(b,m){var O=(this._rBlock>>>b^this._lBlock)&m;this._lBlock^=O,this._rBlock^=O<<b}r.DES=a._createHelper(u);var g=o.TripleDES=a.extend({_doReset:function(){var b=this._key,m=b.words;if(m.length!==2&&m.length!==4&&m.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var O=m.slice(0,2),y=m.length<4?m.slice(0,2):m.slice(2,4),x=m.length<6?m.slice(0,2):m.slice(4,6);this._des1=u.createEncryptor(n.create(O)),this._des2=u.createEncryptor(n.create(y)),this._des3=u.createEncryptor(n.create(x))},encryptBlock:function(b,m){this._des1.encryptBlock(b,m),this._des2.decryptBlock(b,m),this._des3.encryptBlock(b,m)},decryptBlock:function(b,m){this._des3.decryptBlock(b,m),this._des2.encryptBlock(b,m),this._des1.decryptBlock(b,m)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=a._createHelper(g)})(),i.TripleDES})}),UH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),ch(),uh(),gl(),Jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.StreamCipher,a=r.algo,o=a.RC4=n.extend({_doReset:function(){for(var c=this._key,f=c.words,d=c.sigBytes,u=this._S=[],p=0;p<256;p++)u[p]=p;for(var p=0,_=0;p<256;p++){var g=p%d,b=f[g>>>2]>>>24-g%4*8&255;_=(_+u[p]+b)%256;var m=u[p];u[p]=u[_],u[_]=m}this._i=this._j=0},_doProcessBlock:function(c,f){c[f]^=l.call(this)},keySize:256/32,ivSize:0});function l(){for(var c=this._S,f=this._i,d=this._j,u=0,p=0;p<4;p++){f=(f+1)%256,d=(d+c[f])%256;var _=c[f];c[f]=c[d],c[d]=_,u|=c[(c[f]+c[d])%256]<<24-p*8}return this._i=f,this._j=d,u}r.RC4=n._createHelper(o);var h=a.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var c=this.cfg.drop;c>0;c--)l.call(this)}});r.RC4Drop=n._createHelper(h)})(),i.RC4})}),FH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),ch(),uh(),gl(),Jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.StreamCipher,a=r.algo,o=[],l=[],h=[],c=a.Rabbit=n.extend({_doReset:function(){for(var d=this._key.words,u=this.cfg.iv,p=0;p<4;p++)d[p]=(d[p]<<8|d[p]>>>24)&16711935|(d[p]<<24|d[p]>>>8)&4278255360;var _=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],g=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var p=0;p<4;p++)f.call(this);for(var p=0;p<8;p++)g[p]^=_[p+4&7];if(u){var b=u.words,m=b[0],O=b[1],y=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,x=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,E=y>>>16|x&4294901760,w=x<<16|y&65535;g[0]^=y,g[1]^=E,g[2]^=x,g[3]^=w,g[4]^=y,g[5]^=E,g[6]^=x,g[7]^=w;for(var p=0;p<4;p++)f.call(this)}},_doProcessBlock:function(d,u){var p=this._X;f.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var _=0;_<4;_++)o[_]=(o[_]<<8|o[_]>>>24)&16711935|(o[_]<<24|o[_]>>>8)&4278255360,d[u+_]^=o[_]},blockSize:128/32,ivSize:64/32});function f(){for(var d=this._X,u=this._C,p=0;p<8;p++)l[p]=u[p];u[0]=u[0]+1295307597+this._b|0,u[1]=u[1]+3545052371+(u[0]>>>0<l[0]>>>0?1:0)|0,u[2]=u[2]+886263092+(u[1]>>>0<l[1]>>>0?1:0)|0,u[3]=u[3]+1295307597+(u[2]>>>0<l[2]>>>0?1:0)|0,u[4]=u[4]+3545052371+(u[3]>>>0<l[3]>>>0?1:0)|0,u[5]=u[5]+886263092+(u[4]>>>0<l[4]>>>0?1:0)|0,u[6]=u[6]+1295307597+(u[5]>>>0<l[5]>>>0?1:0)|0,u[7]=u[7]+3545052371+(u[6]>>>0<l[6]>>>0?1:0)|0,this._b=u[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var _=d[p]+u[p],g=_&65535,b=_>>>16,m=((g*g>>>17)+g*b>>>15)+b*b,O=((_&4294901760)*_|0)+((_&65535)*_|0);h[p]=m^O}d[0]=h[0]+(h[7]<<16|h[7]>>>16)+(h[6]<<16|h[6]>>>16)|0,d[1]=h[1]+(h[0]<<8|h[0]>>>24)+h[7]|0,d[2]=h[2]+(h[1]<<16|h[1]>>>16)+(h[0]<<16|h[0]>>>16)|0,d[3]=h[3]+(h[2]<<8|h[2]>>>24)+h[1]|0,d[4]=h[4]+(h[3]<<16|h[3]>>>16)+(h[2]<<16|h[2]>>>16)|0,d[5]=h[5]+(h[4]<<8|h[4]>>>24)+h[3]|0,d[6]=h[6]+(h[5]<<16|h[5]>>>16)+(h[4]<<16|h[4]>>>16)|0,d[7]=h[7]+(h[6]<<8|h[6]>>>24)+h[5]|0}r.Rabbit=n._createHelper(c)})(),i.Rabbit})}),GH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),ch(),uh(),gl(),Jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.StreamCipher,a=r.algo,o=[],l=[],h=[],c=a.RabbitLegacy=n.extend({_doReset:function(){var d=this._key.words,u=this.cfg.iv,p=this._X=[d[0],d[3]<<16|d[2]>>>16,d[1],d[0]<<16|d[3]>>>16,d[2],d[1]<<16|d[0]>>>16,d[3],d[2]<<16|d[1]>>>16],_=this._C=[d[2]<<16|d[2]>>>16,d[0]&4294901760|d[1]&65535,d[3]<<16|d[3]>>>16,d[1]&4294901760|d[2]&65535,d[0]<<16|d[0]>>>16,d[2]&4294901760|d[3]&65535,d[1]<<16|d[1]>>>16,d[3]&4294901760|d[0]&65535];this._b=0;for(var g=0;g<4;g++)f.call(this);for(var g=0;g<8;g++)_[g]^=p[g+4&7];if(u){var b=u.words,m=b[0],O=b[1],y=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,x=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,E=y>>>16|x&4294901760,w=x<<16|y&65535;_[0]^=y,_[1]^=E,_[2]^=x,_[3]^=w,_[4]^=y,_[5]^=E,_[6]^=x,_[7]^=w;for(var g=0;g<4;g++)f.call(this)}},_doProcessBlock:function(d,u){var p=this._X;f.call(this),o[0]=p[0]^p[5]>>>16^p[3]<<16,o[1]=p[2]^p[7]>>>16^p[5]<<16,o[2]=p[4]^p[1]>>>16^p[7]<<16,o[3]=p[6]^p[3]>>>16^p[1]<<16;for(var _=0;_<4;_++)o[_]=(o[_]<<8|o[_]>>>24)&16711935|(o[_]<<24|o[_]>>>8)&4278255360,d[u+_]^=o[_]},blockSize:128/32,ivSize:64/32});function f(){for(var d=this._X,u=this._C,p=0;p<8;p++)l[p]=u[p];u[0]=u[0]+1295307597+this._b|0,u[1]=u[1]+3545052371+(u[0]>>>0<l[0]>>>0?1:0)|0,u[2]=u[2]+886263092+(u[1]>>>0<l[1]>>>0?1:0)|0,u[3]=u[3]+1295307597+(u[2]>>>0<l[2]>>>0?1:0)|0,u[4]=u[4]+3545052371+(u[3]>>>0<l[3]>>>0?1:0)|0,u[5]=u[5]+886263092+(u[4]>>>0<l[4]>>>0?1:0)|0,u[6]=u[6]+1295307597+(u[5]>>>0<l[5]>>>0?1:0)|0,u[7]=u[7]+3545052371+(u[6]>>>0<l[6]>>>0?1:0)|0,this._b=u[7]>>>0<l[7]>>>0?1:0;for(var p=0;p<8;p++){var _=d[p]+u[p],g=_&65535,b=_>>>16,m=((g*g>>>17)+g*b>>>15)+b*b,O=((_&4294901760)*_|0)+((_&65535)*_|0);h[p]=m^O}d[0]=h[0]+(h[7]<<16|h[7]>>>16)+(h[6]<<16|h[6]>>>16)|0,d[1]=h[1]+(h[0]<<8|h[0]>>>24)+h[7]|0,d[2]=h[2]+(h[1]<<16|h[1]>>>16)+(h[0]<<16|h[0]>>>16)|0,d[3]=h[3]+(h[2]<<8|h[2]>>>24)+h[1]|0,d[4]=h[4]+(h[3]<<16|h[3]>>>16)+(h[2]<<16|h[2]>>>16)|0,d[5]=h[5]+(h[4]<<8|h[4]>>>24)+h[3]|0,d[6]=h[6]+(h[5]<<16|h[5]>>>16)+(h[4]<<16|h[4]>>>16)|0,d[7]=h[7]+(h[6]<<8|h[6]>>>24)+h[5]|0}r.RabbitLegacy=n._createHelper(c)})(),i.RabbitLegacy})}),zH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),ch(),uh(),gl(),Jr()):typeof define=="function"&&define.amd?define(["./core","./enc-base64","./md5","./evpkdf","./cipher-core"],r):r(i.CryptoJS)})(e,function(i){return(function(){var r=i,s=r.lib,n=s.BlockCipher,a=r.algo;let o=16,l=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],h=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var c={pbox:[],sbox:[]};function f(g,b){let m=b>>24&255,O=b>>16&255,y=b>>8&255,x=b&255,E=g.sbox[0][m]+g.sbox[1][O];return E=E^g.sbox[2][y],E=E+g.sbox[3][x],E}function d(g,b,m){let O=b,y=m,x;for(let E=0;E<o;++E)O=O^g.pbox[E],y=f(g,O)^y,x=O,O=y,y=x;return x=O,O=y,y=x,y=y^g.pbox[o],O=O^g.pbox[o+1],{left:O,right:y}}function u(g,b,m){let O=b,y=m,x;for(let E=o+1;E>1;--E)O=O^g.pbox[E],y=f(g,O)^y,x=O,O=y,y=x;return x=O,O=y,y=x,y=y^g.pbox[1],O=O^g.pbox[0],{left:O,right:y}}function p(g,b,m){for(let w=0;w<4;w++){g.sbox[w]=[];for(let S=0;S<256;S++)g.sbox[w][S]=h[w][S]}let O=0;for(let w=0;w<o+2;w++)g.pbox[w]=l[w]^b[O],O++,O>=m&&(O=0);let y=0,x=0,E=0;for(let w=0;w<o+2;w+=2)E=d(g,y,x),y=E.left,x=E.right,g.pbox[w]=y,g.pbox[w+1]=x;for(let w=0;w<4;w++)for(let S=0;S<256;S+=2)E=d(g,y,x),y=E.left,x=E.right,g.sbox[w][S]=y,g.sbox[w][S+1]=x;return!0}var _=a.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var g=this._keyPriorReset=this._key,b=g.words,m=g.sigBytes/4;p(c,b,m)}},encryptBlock:function(g,b){var m=d(c,g[b],g[b+1]);g[b]=m.left,g[b+1]=m.right},decryptBlock:function(g,b){var m=u(c,g[b],g[b+1]);g[b]=m.left,g[b+1]=m.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=n._createHelper(_)})(),i.Blowfish})}),HH=Ht((e,t)=>{(function(i,r,s){typeof e=="object"?t.exports=e=r(Kt(),rO(),OH(),mH(),ch(),yH(),uh(),PI(),Py(),bH(),AI(),xH(),vH(),EH(),Ay(),TH(),gl(),Jr(),wH(),SH(),IH(),PH(),AH(),CH(),NH(),LH(),RH(),DH(),MH(),BH(),kH(),UH(),FH(),GH(),zH()):typeof define=="function"&&define.amd?define(["./core","./x64-core","./lib-typedarrays","./enc-utf16","./enc-base64","./enc-base64url","./md5","./sha1","./sha256","./sha224","./sha512","./sha384","./sha3","./ripemd160","./hmac","./pbkdf2","./evpkdf","./cipher-core","./mode-cfb","./mode-ctr","./mode-ctr-gladman","./mode-ofb","./mode-ecb","./pad-ansix923","./pad-iso10126","./pad-iso97971","./pad-zeropadding","./pad-nopadding","./format-hex","./aes","./tripledes","./rc4","./rabbit","./rabbit-legacy","./blowfish"],r):i.CryptoJS=r(i.CryptoJS)})(e,function(i){return i})}),jH=(e=>(e.Device="Device",e.Symbol="Symbol",e.Footprint="Footprint",e.OBJ="OBJ",e.ModelID="3D Model",e.ModelName="3D Model Title",e.OriginModelName="Origin 3D Model Title",e.ModelTransform="3D Model Transform",e.OriginFootprint="Origin Footprint",e))(jH||{}),YH=(e=>(e.DOCHEAD="DOCHEAD",e.EDIT_HEAD="EDIT_HEAD",e.SCH="SCH",e.SCH_PAGE="SCH_PAGE",e.PCB="PCB",e.PANEL="PANEL",e.PANEL_LIB="PANEL_LIB",e.SYMBOL="SYMBOL",e.FOOTPRINT="FOOTPRINT",e.DEVICE="DEVICE",e.BLOB="BLOB",e.INSTANCE="INSTANCE",e.CONFIG="CONFIG",e.BOARD="BOARD",e.FONT="FONT",e.VARIANT="VARIANT",e.COMPONENT_GROUP="COMPONENT_GROUP",e.COMPONENT_GROUP_DATA="COMPONENT_GROUP_DATA",e.SIMULATION="SIMULATION",e))(YH||{}),VH=(e=>(e.META="META",e.META_SORT="META_SORT",e.META_CREATE="META_CREATE",e.META_MODIFY="META_MODIFY",e.FONT="FONT",e.BLOB="BLOB",e.MAX_NUM="MAX_NUM",e.INSTANCE_ATTR="INSTANCE_ATTR",e.DELETE_DOC="DELETE_DOC",e.META_Z_INDEX="META_Z_INDEX",e.VARIANT_GROUPED="VARIANT_GROUPED",e.GROUP_INDEX="GROUP_INDEX",e.GROUP_DATA="GROUP_DATA",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.META_PLACEHOLDER="META_PLACEHOLDER",e))(VH||{}),$c="||",rf=`|
`;function sf(e,t,i){return e.slice(t,i)}function jS(e,t,i){let r=e.length,s=0;for(;s<r;){let n=e.indexOf(rf,s);if(n<0){if(i)return e.substring(s);n=r}let a=sf(e,s,n);try{if(a){let o=a.indexOf($c),l=o>-1,h=l?sf(a,0,o):a,c=l?sf(a,o+$c.length):"";if(t(h,c,a,l?s+o+$c.length:s)===!1){a=null;break}a=null}}catch(o){console.error(o)}s=n+rf.length}e=null}var qH=["SYMBOL","FOOTPRINT","BLOB","FONT","PANEL_LIB","DEVICE","BOARD","INSTANCE","CONFIG","VARIANT","COMPONENT_GROUP","COMPONENT_GROUP_DATA"];function Z1(e,t){return qH.includes(t)?t:e}var XH=class{parseFull(e,t,i){let r=t,s=i,n,a=null;jS(e,(o,l,h)=>{let c=JSON.parse(o);if(c.type==="EDIT_HEAD")a=JSON.parse(l),this.onEditHead&&this.onEditHead(a);else if(c.type==="DOCHEAD"){let f=JSON.parse(l);s=f.docType,r=f.uuid,n=f.client,f.ticket=c.ticket,this.onDocHead(f,a,h)}else this.onLine(c.id,c.ticket,l,c.type,c.client||n,s,r,c.firstTicket,c.pend,a,c.num,h)}),this.onEnd(),e=null}flowParseFull(e={}){let{cache:t,chunkLength:i=100*1024*1024,idsData:r,history:s}=e,n="",a=null,o,l=null,h=!0,c="",f=0,d=!1,u={},p=t?{}:void 0,_=m=>{p[m]===void 0&&(p[m]=-1),t(m,++p[m],u[m].data.join(rf)),u[m].data.length=0,u[m].size=0,u[m].data.push(u[m].head),u[m].size+=u[m].head.length},g=m=>{let O=Z1(n,a);t&&(u[O].data.push(m),u[O].size+=(u[O].size?rf.length:0)+m.length,u[O].size+m.length>i&&_(O))},b=(m,O)=>jS(m,(y,x,E,w)=>{var C,R,B,Y,G,z,q,L;let S=JSON.parse(y);if(S.type==="EDIT_HEAD")l=JSON.parse(x),(C=this.onEditHead)==null||C.call(this,l),(R=e.onEditHead)==null||R.call(e,l),d=!0;else if(S.type==="DOCHEAD"){let M=JSON.parse(x);a=M.docType,n=M.uuid,o=M.client,M.ticket=S.ticket,d||(l={uuid:M.uuid,username:(B=M==null?void 0:M.user)==null?void 0:B.username,nickname:(Y=M==null?void 0:M.user)==null?void 0:Y.nickname,updateTime:M==null?void 0:M.updateTime},(G=e.onEditHead)==null||G.call(e,l),d=!0),this.onDocHead(M,l,E);let v=Z1(n,a);t&&!u[v]&&(u[v]={size:0,data:[],head:""}),t&&(u[v].head=E),g(E)}else{let M=S.num,v=S.client||o;if(r){let P=(L=(q=(z=r.ids)==null?void 0:z[n])==null?void 0:q[v])==null?void 0:L[S.id];if(!P||P[0]!==S.ticket)return;M=P[1],r.size-=1,delete r.ids[n][v][S.id]}if(s){let P=Z1(n,a);t&&(s.dNum=(p==null?void 0:p[P])===void 0?0:(p==null?void 0:p[P])+1),s.start=t?u[P].size+rf.length+y.length+$c.length:f+w}this.onLine(S.id,S.ticket,x,S.type,v,a,n,S.firstTicket,S.pend,l||(s==null?void 0:s.editHead),M,E,s),g(E)}},O);return{start:()=>{h=!0},end:()=>{if(c&&b(c,!1),t)for(let m in u)u[m].size&&u[m].data.length>1&&_(m),u[m]=null;h=!1,c="",n="",n=null,o="",l=null,this.onEnd()},update:m=>{if(!h)throw new Error("\u66F4\u65B0\u524D\u672A\u8C03\u7528 start \u65B9\u6CD5");let O=b(c+m,!0);f=f+c.length+m.length-((O==null?void 0:O.length)||0),c="",O&&(c=O)},docMap:p}}parseLine(e,t,i){let r=e.indexOf($c),s=r!==-1,n=s?sf(e,0,r):e,a=s?sf(e,r+$c.length):"",o=JSON.parse(n);this.onLine(o.id,o.ticket,a,o.type,o.client,i,t,o.firstTicket,o.pend,void 0,o.num,e),e=null}onEditHead(e){}},K1=new Uint8Array(8);function ul(){crypto.getRandomValues(K1);let e="";for(let t=0;t<K1.length;t++)e+=K1[t].toString(16).padStart(2,"0");return e}var CI=class extends XH{constructor(e){super(),this.unique=ul(),this.maxTicket=0,this.isPendChange=!0,this.isLocalChange=!0,this.cbArr=[],this.tempLocalIds={},this.client=e||ul()}onLine(e,t,i,r,s,n,a,o,l,h,c){this.remoteChange(t,s,a,e,i,r,n,void 0,o,l,h,void 0,void 0,c)}getUnique(){return this.unique}setUnique(e){this.unique=e}onDocHead(e,t){}onEnd(){}setIsPendChange(e){this.isPendChange=e}getIsPendChange(){return this.isPendChange}getMaxTicket(){return this.maxTicket}setMaxTicket(e,t){e&&(t||this.maxTicket<e)&&(this.maxTicket=e)}setIsLocalChange(e){this.isLocalChange=e}getIsLocalChange(){return this.isLocalChange}revoke(e,t,i,r,s,n,a,o,l,h,c){var f;if(!((f=this.tempLocalIds[e])!=null&&f[t]))return c?c(t,s,i,a,`${r}-1`,e,n,void 0,void 0,!0,h):this.cbArr.forEach(d=>d(e,t,i,a,`${r}-1`,s,void 0,n,void 0,void 0,void 0,h)),!0}getRandomUuid(){return ul()}getClient(){return this.client}onChange(e){this.cbArr.push(e)}localChange(e,t,i,r,s,n){let a=this.maxTicket+1;return this.tempLocalIds[e]||(this.tempLocalIds[e]={}),this.tempLocalIds[e][t]=[this.getClient(),a],this.remoteChange(a,this.client,e,t,i,r,s,!0,void 0,!0,void 0,this.unique,void 0,n),a}remoteChange(e,t,i,r,s,n,a,o,l,h,c,f,d,u){var m;this.setMaxTicket(e);let p=f===this.unique,_=o||p,g=(!_||_&&this.isLocalChange)&&(!d||d&&this.isPendChange),b=(m=this.tempLocalIds[i])==null?void 0:m[r];!o&&p?b?(g=!1,b[0]===t&&b[1]===e&&delete this.tempLocalIds[i][r]):g=!0:!o&&b&&(b[1]>e||b[1]===e&&b[0]>t?g=!1:delete this.tempLocalIds[i][r]),g&&this.cbArr.forEach(O=>O(i,r,s,n,t,e,l,h,void 0,d,f,u))}};function dr(e,t){return JSON.stringify([t,e])}function ol(e){try{let t=JSON.parse(e);return typeof t=="string"?e:t[1]}catch{return e}}var WH=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.POLY="POLY",e.STRING="STRING",e.AUX_LINE="AUXLINE",e.DIMENSION="DIMENSION",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(WH||{}),JH=(e=>(e.META="META",e.CANVAS="CANVAS",e.LAYER="LAYER",e.LAYER_PHYS="LAYER_PHYS",e.ACTIVE_LAYER="ACTIVE_LAYER",e.PARTITION="PARTITION",e.NET="NET",e.PRIMITIVE="PRIMITIVE",e.GROUP="GROUP",e.SILK_OPTS="SILK_OPTS",e.PREFERENCE="PREFERENCE",e.VIA="VIA",e.PAD="PAD",e.LINE="LINE",e.ARC="ARC",e.OBJ="OBJ",e.EQLEN_GRP="EQLEN_GRP",e.POLY="POLY",e.FILL="FILL",e.LAYER_FILL="LAYER_FILL",e.REGION="REGION",e.POUR="POUR",e.POURED="POURED",e.IMAGE="IMAGE",e.TEARDROP="TEARDROP",e.FPC_FILL="FPC_FILL",e.SHELL="SHELL",e.CREASE="CREASE",e.SHELLCUT="SHELLCUT",e.SHELL_ENTITY="SHELL_ENTITY",e.BOSS="BOSS",e.STRING="STRING",e.ATTR="ATTR",e.DIMENSION="DIMENSION",e.COMPONENT="COMPONENT",e.PAD_NET="PAD_NET",e.RULE_TEMPLATE="RULE_TEMPLATE",e.RULE="RULE",e.RULE_SELECTOR="RULE_SELECTOR",e.PANELIZE="PANELIZE",e.BOARD="BOARD",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e))(JH||{}),ZH=(e=>(e.META="META",e.CANVAS="CANVAS",e.GROUP="GROUP",e.ATTR="ATTR",e.LINE="LINE",e.WIRE="WIRE",e.BUS="BUS",e.TEXT="TEXT",e.POLY="POLY",e.CIRCLE="CIRCLE",e.ARC="ARC",e.BUSENTRY="BUSENTRY",e.RECT="RECT",e.MASK_REGION="MASK_REGION",e.PIN="PIN",e.OBJ="OBJ",e.COMPONENT="COMPONENT",e.PART="PART",e.ELLIPSE="ELLIPSE",e.BEZIER="BEZIER",e.TABLE="TABLE",e.ELE_PLACEHOLDER="ELE_PLACEHOLDER",e.NG_SETTING="NG_SETTING",e))(ZH||{});var KH=["PARTITION","VIA","PAD","LINE","ARC","OBJ","POLY","FILL","REGION","POUR","POURED","IMAGE","TEARDROP","FPC_FILL","SHELL","CREASE","SHELLCUT","SHELL_ENTITY","BOSS","STRING","ATTR","DIMENSION","COMPONENT"];var $H=(e=>(e.SOLID="SOLID",e.SHORT_DASH="SHORT_DASH",e.DOT="DOT",e.DOT_DASH="DOT_DASH",e))($H||{}),QH=(e=>(e.PRINT="PRINT",e.COVER="COVER",e.PRINT_AND_COVER="PRINT&COVER",e))(QH||{}),ej=(e=>(e.LEFT="LEFT",e.CENTER="CENTER",e.RIGHT="RIGHT",e))(ej||{}),tj=(e=>(e.TOP="TOP",e.MIDDLE="MIDDLE",e.BOTTOM="BOTTOM",e))(tj||{}),ij=(e=>(e.LEFT_BOTTOM="LEFT_BOTTOM",e.CENTER_BOTTOM="CENTER_BOTTOM",e.RIGHT_BOTTOM="RIGHT_BOTTOM",e.LEFT_MIDDLE="LEFT_MIDDLE",e.CENTER_MIDDLE="CENTER_MIDDLE",e.RIGHT_MIDDLE="RIGHT_MIDDLE",e.LEFT_TOP="LEFT_TOP",e.CENTER_TOP="CENTER_TOP",e.RIGHT_TOP="RIGHT_TOP",e))(ij||{}),rj=(e=>(e.NONE="NONE",e.SOLID="SOLID",e.GRID="GRID",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e.RHOMBIC="RHOMBIC",e.LEFT_SLASH_LINE="LEFT_SLASH_LINE",e.RIGHT_SLASH_LINE="RIGHT_SLASH_LINE",e))(rj||{}),sj=(e=>(e.NONE="NONE",e.CLOCK="CLOCK",e.INVERTED="INVERTED",e.INVERTED_CLOCK="INVERTED_CLOCK",e))(sj||{}),nj=(e=>(e.NONE="NONE",e.GRID="GRID",e.OUTLETS="OUTLETS",e))(nj||{}),aj=(e=>(e.NONE="NONE",e.PUSH="PUSH",e.SURROUND="SURROUND",e.OBSTRUCT="OBSTRUCT",e.SURROUND_AND_PUSH="SURROUND&PUSH",e))(aj||{}),oj=(e=>(e.ELLIPSE="ELLIPSE",e.RECT="RECT",e.OVAL="OVAL",e.POLYGON="POLYGON",e))(oj||{}),lj=(e=>(e.ROUND="ROUND",e.RECT="RECT",e.SLOT="SLOT",e))(lj||{}),hj=(e=>(e.SOLID="SOLID",e.GRID_LINE="GRID_LINE",e.HORIZONTAL_LINE="HORIZONTAL_LINE",e.VERTICAL_LINE="VERTICAL_LINE",e))(hj||{}),cj=(e=>(e.ALL="ALL",e.PAD="PAD",e.VIA="VIA",e))(cj||{}),uj=(e=>(e.NONE="NONE",e.SINGLE="SINGLE",e.ALL="ALL",e))(uj||{}),dj=(e=>(e.OPTIMIZA_OPEN="OPTIMIZA_OPEN",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(dj||{}),fj=(e=>(e.OPTIMIZA_STRONG="OPTIMIZA_STRONG",e.OPTIMIZA_WEAK="OPTIMIZA_WEAK",e.OPTIMIZA_NONE="OPTIMIZA_NONE",e))(fj||{}),pj=(e=>(e.L45="L45",e.L90="L90",e.L="L",e.R45="R45",e.R90="R90",e.R="R",e))(pj||{}),_j=(e=>(e.NORMAL="NORMAL",e.BLIND="BLIND",e.SUTURE="SUTURE",e))(_j||{}),gj=(e=>(e.NORMAL="NORMAL",e.TEST="TEST",e.MARKER="MARKER",e))(gj||{}),Oj=(e=>(e.DIVERGENCE="DIVERGENCE",e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(Oj||{}),mj=(e=>(e.DOT="DOT",e.CENTER="CENT",e))(mj||{}),yj=(e=>(e.NORMAL="NORMAL",e.BOARD_OUTLINE="BOARD_OUTLINE",e))(yj||{}),df=(e=>(e.SOLID="SOLID",e.GRID="GRID",e.PLANE="PLANE",e))(df||{}),bj=(e=>(e.PROHIBIT="PROHIBIT",e.CONSTRAINT="CONSTRAINT",e))(bj||{}),xj=(e=>(e.COMPONENT="COMPONENT",e.VIA="VIA",e.TRACK="TRACK",e.FILL="FILL",e.COPPER="COPPER",e.PLANE="PLANE",e))(xj||{}),vj=(e=>(e.PI="Polyimide",e.FR4="FR4",e.STEEL_SHEET="Stainless Steel",e.M3_DOUBLE_SIDED_TAPE="3M Tape",e.EMI_SHIELDING_FILM="EMI Shielding Film",e))(vj||{}),Ej=(e=>(e.PUSH_COVER="DRAWER",e.UPPER_LOWER_SHELLS="T&B",e))(Ej||{}),Tj=(e=>(e.X_AXIS_POSITIVE="X_AXIS_POSITIVE",e.X_AXIS_NEGATIVE="X_AXIS_NEGATIVE",e.Y_AXIS_POSITIVE="Y_AXIS_POSITIVE",e.Y_AXIS_NEGATIVE="Y_AXIS_NEGATIVE",e))(Tj||{}),wj=(e=>(e.SLOT="SLOT",e.ENTITY="ENTITY",e))(wj||{}),Sj=(e=>(e.AUTO="AUTO",e.UPPER_SHELLS="UPPER_SHELLS",e.LOWER_SHELLS="LOWER_SHELLS",e))(Sj||{}),Ij=(e=>(e.OUTLINE="OUTLINE",e.SCREW_PILLAR="SCREW_PILLAR",e.ENTITY="ENTITY",e))(Ij||{}),Pj=(e=>(e.M2="M2",e.M3="M3",e.M4="M4",e.M5="M5",e.M6="M6",e))(Pj||{}),Aj=(e=>(e.LENGTH="LENGTH",e.RADIUS="RADIUS",e.ANGLE="ANGLE",e))(Aj||{}),Cj=(e=>(e.MIL="mil",e.INCH="inch",e.CM="cm",e.MM="mm",e))(Cj||{}),Nj=(e=>(e.SAFE="SAFE",e.OTHER="OTHER",e.TRACK="TRACK",e.BLIND="BLIND",e.RADIUS="RADIUS",e.PLANE="PLANE",e.COPPER="COPPER",e.PASTE="PASTE",e.SOLDER="SOLDER",e.DIFFER_ENTAIL="DIFFER_ENTAIL",e.NET_LENGTH="NET_LENGTH",e.AUTO_ROUTER="AUTO_ROUTER",e.NET_LENGTH_TOLERANCE="NET_LENGTH_TOLERANCE",e))(Nj||{}),Lj=(e=>(e.NORMAL="NORMAL",e.DEFAULT="DEFAULT",e))(Lj||{}),Rj=(e=>(e.ALL="ALL",e.LAYERED="LAYERED",e))(Rj||{}),Dj=(e=>(e.DIRECT="DIRECT",e.NON_CONNECT="NON_CONNECT",e))(Dj||{}),Mj=(e=>(e.FORTY_FIVE="L45",e.NINETY="L90",e.NINETY_ARC="A90",e))(Mj||{}),Bj=(e=>(e.LESS="LESS",e.MID="MID",e.MORE="MORE",e))(Bj||{}),kj=(e=>(e.SPEED_FIRST="SPEED_FIRST",e.COMPLETION_FIRST="COMPLETION_FIRST",e))(kj||{}),Uj=(e=>(e.DesignRule="DesignRule",e.Board="Board",e.SlotRegion="SlotRegion",e.ProhibitedRegion="ProhibitedRegion",e.ConstraintRegion="ConstraintRegion",e.Component="Component",e.Track="Track",e.TestPoint="TestPoint",e.Pad="Pad",e.Via="Via",e.SutureHole="SutureHole",e.Text="Text",e.ColorfulImage="ColorfulImage",e.Image="Image",e.FPCStiffener="FPCStiffener",e.Dimension="Dimension",e.CopperRegion="CopperRegion",e.FillRegion="Fill Region",e.Line="Line",e.Teardrop="Teardrop",e.D3Shell="D3Shell",e))(Uj||{}),Fj=iu(HH());function YS(e,t,i,r,s,n,a,o){return JSON.stringify([e||"",t||"",i,r,s?1:0,n?1:0,a?1:0,o])}function Gj(e){let t=JSON.parse(e);return{text:t[0],fontFamily:t[1],fontSize:t[2],thickness:t[3],bold:!!t[4],italic:!!t[5],reverse:!!t[6],expansion:t[7]}}function zj(e){return Fj.default.SHA256(e).toString()}var yae=iu(uf());var Hj=class{constructor(e,t=1,i=[]){this.consistencyManager=e,this.startNum=t,this.needOrderType=i,this.initIng=!1,this.allOrderNum={},this.maxNum={},this.consistencyManager.onChange((r,s,n,a,o,l,h,c,f,d,u,p)=>{try{this.onParseLine(s,a,n?JSON.parse(n):null,o,l,c,p)}catch(_){console.error(_)}})}setIsInit(e){this.initIng=e}setNeedNum(e){this.needNum=e}setOrderNum(e,t,i){this.needNum&&this.needOrderType&&this.needOrderType.includes(i)&&t!==void 0&&(this.allOrderNum[e]=t,this.setMaxNum(i,t))}deleteOrderNum(e){delete this.allOrderNum[e]}getOrderNum(e){return this.allOrderNum[e]}setMaxNum(e,t,i){(i||this.maxNum[e]===void 0||this.maxNum[e]<t)&&(this.maxNum[e]=t)}getMaxNum(e){return this.maxNum[e]===void 0&&(this.maxNum[e]=this.startNum-1),++this.maxNum[e]}};function jj(e){switch(e=String(e),e){case"1":return"SAFE";case"2":return"OTHER";case"3":return"TRACK";case"4":return"BLIND";case"5":return"RADIUS";case"6":return"PLANE";case"7":return"COPPER";case"8":return"PASTE";case"9":return"SOLDER";case"10":return"DIFFER_ENTAIL";case"11":return"NET_LENGTH";case"12":return"AUTO_ROUTER";case"13":return"NET_LENGTH_TOLERANCE"}return e}function Yj(e){if(!e)return{};let t=["1","2","3","4","5","6","7","8","9","10","11","12","13"];for(let i of t)if(e.hasOwnProperty(i)){let r=e[i];delete e[i],e[jj(i)]=r}return e}var Vj=(e=>(e[e.TRACK=0]="TRACK",e[e.SMDPad=1]="SMDPad",e[e.THPad=2]="THPad",e[e.SMD_Test_Point=3]="SMD_Test_Point",e[e.TH_Test_Point=4]="TH_Test_Point",e[e.VIA=5]="VIA",e[e.REGION=6]="REGION",e[e.PLANE=7]="PLANE",e[e.SLOT=8]="SLOT",e[e.LINE=9]="LINE",e[e.OTHER=10]="OTHER",e[e.SHEETFRAME=11]="SHEETFRAME",e[e.Hole=12]="Hole",e[e.Copper=13]="Copper",e[e.Inner=14]="Inner",e[e.PROHIBITAREA=15]="PROHIBITAREA",e[e.COMPONENT=16]="COMPONENT",e))(Vj||{});var qj=(e=>(e[e.pro1=1]="pro1",e[e.pro2=1.1]="pro2",e[e.pro3=1.2]="pro3",e[e.pro4=1.3]="pro4",e[e.pro5=1.4]="pro5",e[e.pro6=1.5]="pro6",e[e.pro7=1.6]="pro7",e[e.pro8=1.7]="pro8",e[e.pro9=1.8]="pro9",e[e.pro=1.8]="pro",e))(qj||{});var Xj=Object.create,NI=Object.defineProperty,Wj=Object.getOwnPropertyDescriptor,Jj=Object.getOwnPropertyNames,Zj=Object.getPrototypeOf,Kj=Object.prototype.hasOwnProperty,$j=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Qj=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Jj(t))!Kj.call(e,s)&&s!==i&&NI(e,s,{get:()=>t[s],enumerable:!(r=Wj(t,s))||r.enumerable});return e},eY=(e,t,i)=>(i=e!=null?Xj(Zj(e)):{},Qj(t||!e||!e.__esModule?NI(i,"default",{value:e,enumerable:!0}):i,e)),tY=$j((e,t)=>{"use strict";t.exports=i,t.exports.default=i;function i(v,P,I){I=I||2;var N=P&&P.length,D=N?P[0]*I:v.length,j=r(v,0,D,I,!0),H=[];if(!j||j.next===j.prev)return H;var K,se,he,_e,ve,J,Z;if(N&&(j=c(v,P,j,I)),v.length>80*I){K=he=v[0],se=_e=v[1];for(var re=I;re<D;re+=I)ve=v[re],J=v[re+1],ve<K&&(K=ve),J<se&&(se=J),ve>he&&(he=ve),J>_e&&(_e=J);Z=Math.max(he-K,_e-se),Z=Z!==0?32767/Z:0}return n(j,H,I,K,se,Z,0),H}function r(v,P,I,N,D){var j,H;if(D===M(v,P,I,N)>0)for(j=P;j<I;j+=N)H=z(j,v[j],v[j+1],H);else for(j=I-N;j>=P;j-=N)H=z(j,v[j],v[j+1],H);return H&&E(H,H.next)&&(q(H),H=H.next),H}function s(v,P){if(!v)return v;P||(P=v);var I=v,N;do if(N=!1,!I.steiner&&(E(I,I.next)||x(I.prev,I,I.next)===0)){if(q(I),I=P=I.prev,I===I.next)break;N=!0}else I=I.next;while(N||I!==P);return P}function n(v,P,I,N,D,j,H){if(v){!H&&j&&_(v,N,D,j);for(var K=v,se,he;v.prev!==v.next;){if(se=v.prev,he=v.next,j?o(v,N,D,j):a(v)){P.push(se.i/I|0),P.push(v.i/I|0),P.push(he.i/I|0),q(v),v=he.next,K=he.next;continue}if(v=he,v===K){H?H===1?(v=l(s(v),P,I),n(v,P,I,N,D,j,2)):H===2&&h(v,P,I,N,D,j):n(s(v),P,I,N,D,j,1);break}}}}function a(v){var P=v.prev,I=v,N=v.next;if(x(P,I,N)>=0)return!1;for(var D=P.x,j=I.x,H=N.x,K=P.y,se=I.y,he=N.y,_e=D<j?D<H?D:H:j<H?j:H,ve=K<se?K<he?K:he:se<he?se:he,J=D>j?D>H?D:H:j>H?j:H,Z=K>se?K>he?K:he:se>he?se:he,re=N.next;re!==P;){if(re.x>=_e&&re.x<=J&&re.y>=ve&&re.y<=Z&&O(D,K,j,se,H,he,re.x,re.y)&&x(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function o(v,P,I,N){var D=v.prev,j=v,H=v.next;if(x(D,j,H)>=0)return!1;for(var K=D.x,se=j.x,he=H.x,_e=D.y,ve=j.y,J=H.y,Z=K<se?K<he?K:he:se<he?se:he,re=_e<ve?_e<J?_e:J:ve<J?ve:J,ue=K>se?K>he?K:he:se>he?se:he,Le=_e>ve?_e>J?_e:J:ve>J?ve:J,Ce=b(Z,re,P,I,N),De=b(ue,Le,P,I,N),Pe=v.prevZ,Ie=v.nextZ;Pe&&Pe.z>=Ce&&Ie&&Ie.z<=De;){if(Pe.x>=Z&&Pe.x<=ue&&Pe.y>=re&&Pe.y<=Le&&Pe!==D&&Pe!==H&&O(K,_e,se,ve,he,J,Pe.x,Pe.y)&&x(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ie.x>=Z&&Ie.x<=ue&&Ie.y>=re&&Ie.y<=Le&&Ie!==D&&Ie!==H&&O(K,_e,se,ve,he,J,Ie.x,Ie.y)&&x(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;Pe&&Pe.z>=Ce;){if(Pe.x>=Z&&Pe.x<=ue&&Pe.y>=re&&Pe.y<=Le&&Pe!==D&&Pe!==H&&O(K,_e,se,ve,he,J,Pe.x,Pe.y)&&x(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ie&&Ie.z<=De;){if(Ie.x>=Z&&Ie.x<=ue&&Ie.y>=re&&Ie.y<=Le&&Ie!==D&&Ie!==H&&O(K,_e,se,ve,he,J,Ie.x,Ie.y)&&x(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function l(v,P,I){var N=v;do{var D=N.prev,j=N.next.next;!E(D,j)&&w(D,N,N.next,j)&&B(D,j)&&B(j,D)&&(P.push(D.i/I|0),P.push(N.i/I|0),P.push(j.i/I|0),q(N),q(N.next),N=v=j),N=N.next}while(N!==v);return s(N)}function h(v,P,I,N,D,j){var H=v;do{for(var K=H.next.next;K!==H.prev;){if(H.i!==K.i&&y(H,K)){var se=G(H,K);H=s(H,H.next),se=s(se,se.next),n(H,P,I,N,D,j,0),n(se,P,I,N,D,j,0);return}K=K.next}H=H.next}while(H!==v)}function c(v,P,I,N){var D=[],j,H,K,se,he;for(j=0,H=P.length;j<H;j++)K=P[j]*N,se=j<H-1?P[j+1]*N:v.length,he=r(v,K,se,N,!1),he===he.next&&(he.steiner=!0),D.push(m(he));for(D.sort(f),j=0;j<D.length;j++)I=d(D[j],I);return I}function f(v,P){return v.x-P.x}function d(v,P){var I=u(v,P);if(!I)return P;var N=G(I,v);return s(N,N.next),s(I,I.next)}function u(v,P){var I=P,N=v.x,D=v.y,j=-1/0,H;do{if(D<=I.y&&D>=I.next.y&&I.next.y!==I.y){var K=I.x+(D-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(K<=N&&K>j&&(j=K,H=I.x<I.next.x?I:I.next,K===N))return H}I=I.next}while(I!==P);if(!H)return null;var se=H,he=H.x,_e=H.y,ve=1/0,J;I=H;do N>=I.x&&I.x>=he&&N!==I.x&&O(D<_e?N:j,D,he,_e,D<_e?j:N,D,I.x,I.y)&&(J=Math.abs(D-I.y)/(N-I.x),B(I,v)&&(J<ve||J===ve&&(I.x>H.x||I.x===H.x&&p(H,I)))&&(H=I,ve=J)),I=I.next;while(I!==se);return H}function p(v,P){return x(v.prev,v,P.prev)<0&&x(P.next,v,v.next)<0}function _(v,P,I,N){var D=v;do D.z===0&&(D.z=b(D.x,D.y,P,I,N)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,g(D)}function g(v){var P,I,N,D,j,H,K,se,he=1;do{for(I=v,v=null,j=null,H=0;I;){for(H++,N=I,K=0,P=0;P<he&&(K++,N=N.nextZ,!!N);P++);for(se=he;K>0||se>0&&N;)K!==0&&(se===0||!N||I.z<=N.z)?(D=I,I=I.nextZ,K--):(D=N,N=N.nextZ,se--),j?j.nextZ=D:v=D,D.prevZ=j,j=D;I=N}j.nextZ=null,he*=2}while(H>1);return v}function b(v,P,I,N,D){return v=(v-I)*D|0,P=(P-N)*D|0,v=(v|v<<8)&16711935,v=(v|v<<4)&252645135,v=(v|v<<2)&858993459,v=(v|v<<1)&1431655765,P=(P|P<<8)&16711935,P=(P|P<<4)&252645135,P=(P|P<<2)&858993459,P=(P|P<<1)&1431655765,v|P<<1}function m(v){var P=v,I=v;do(P.x<I.x||P.x===I.x&&P.y<I.y)&&(I=P),P=P.next;while(P!==v);return I}function O(v,P,I,N,D,j,H,K){return(D-H)*(P-K)>=(v-H)*(j-K)&&(v-H)*(N-K)>=(I-H)*(P-K)&&(I-H)*(j-K)>=(D-H)*(N-K)}function y(v,P){return v.next.i!==P.i&&v.prev.i!==P.i&&!R(v,P)&&(B(v,P)&&B(P,v)&&Y(v,P)&&(x(v.prev,v,P.prev)||x(v,P.prev,P))||E(v,P)&&x(v.prev,v,v.next)>0&&x(P.prev,P,P.next)>0)}function x(v,P,I){return(P.y-v.y)*(I.x-P.x)-(P.x-v.x)*(I.y-P.y)}function E(v,P){return v.x===P.x&&v.y===P.y}function w(v,P,I,N){var D=C(x(v,P,I)),j=C(x(v,P,N)),H=C(x(I,N,v)),K=C(x(I,N,P));return!!(D!==j&&H!==K||D===0&&S(v,I,P)||j===0&&S(v,N,P)||H===0&&S(I,v,N)||K===0&&S(I,P,N))}function S(v,P,I){return P.x<=Math.max(v.x,I.x)&&P.x>=Math.min(v.x,I.x)&&P.y<=Math.max(v.y,I.y)&&P.y>=Math.min(v.y,I.y)}function C(v){return v>0?1:v<0?-1:0}function R(v,P){var I=v;do{if(I.i!==v.i&&I.next.i!==v.i&&I.i!==P.i&&I.next.i!==P.i&&w(I,I.next,v,P))return!0;I=I.next}while(I!==v);return!1}function B(v,P){return x(v.prev,v,v.next)<0?x(v,P,v.next)>=0&&x(v,v.prev,P)>=0:x(v,P,v.prev)<0||x(v,v.next,P)<0}function Y(v,P){var I=v,N=!1,D=(v.x+P.x)/2,j=(v.y+P.y)/2;do I.y>j!=I.next.y>j&&I.next.y!==I.y&&D<(I.next.x-I.x)*(j-I.y)/(I.next.y-I.y)+I.x&&(N=!N),I=I.next;while(I!==v);return N}function G(v,P){var I=new L(v.i,v.x,v.y),N=new L(P.i,P.x,P.y),D=v.next,j=P.prev;return v.next=P,P.prev=v,I.next=D,D.prev=I,N.next=I,I.prev=N,j.next=N,N.prev=j,N}function z(v,P,I,N){var D=new L(v,P,I);return N?(D.next=N.next,D.prev=N,N.next.prev=D,N.next=D):(D.prev=D,D.next=D),D}function q(v){v.next.prev=v.prev,v.prev.next=v.next,v.prevZ&&(v.prevZ.nextZ=v.nextZ),v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function L(v,P,I){this.i=v,this.x=P,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(v,P,I,N){var D=P&&P.length,j=D?P[0]*I:v.length,H=Math.abs(M(v,0,j,I));if(D)for(var K=0,se=P.length;K<se;K++){var he=P[K]*I,_e=K<se-1?P[K+1]*I:v.length;H-=Math.abs(M(v,he,_e,I))}var ve=0;for(K=0;K<N.length;K+=3){var J=N[K]*I,Z=N[K+1]*I,re=N[K+2]*I;ve+=Math.abs((v[J]-v[re])*(v[Z+1]-v[J+1])-(v[J]-v[Z])*(v[re+1]-v[J+1]))}return H===0&&ve===0?0:Math.abs((ve-H)/H)};function M(v,P,I,N){for(var D=0,j=P,H=I-N;j<I;j+=N)D+=(v[H]-v[j])*(v[j+1]+v[H+1]),H=j;return D}i.flatten=function(v){for(var P=v[0][0].length,I={vertices:[],holes:[],dimensions:P},N=0,D=0;D<v.length;D++){for(var j=0;j<v[D].length;j++)for(var H=0;H<P;H++)I.vertices.push(v[D][j][H]);D>0&&(N+=v[D-1].length,I.holes.push(N))}return I}}),iY=(e=>(e[e.MIL=1]="MIL",e[e.INCH=1e3]="INCH",e[e.FT=12e3]="FT",e[e.YARD=36e3]="YARD",e[e.MILE=6336e4]="MILE",e[e.KM=3937007874e-2]="KM",e[e.M=39370]="M",e[e.DM=3937]="DM",e[e.CM=393.7]="CM",e[e.MM=39.37]="MM",e[e.UM=.039]="UM",e[e.NM=394e-7]="NM",e[e.PT=13.88888888888889]="PT",e[e.PX72=13.88888888888889]="PX72",e[e.PX96=10.416666666666666]="PX96",e[e.PX100=10]="PX100",e[e.LTSPICE=6.25]="LTSPICE",e[e.PX1=.1]="PX1",e[e.PX001=.001]="PX001",e))(iY||{}),rY=(e=>(e.MIL="mil",e.INCH="inch",e.FT="ft",e.YARD="yard",e.MILE="mile",e.KM="km",e.M="m",e.DM="dm",e.CM="cm",e.MM="mm",e.UM="um",e.NM="nm",e.PT="pt",e.PX72="px(72)",e.PX96="px(96)",e.PX100="px(100)",e))(rY||{}),VS={mil:1,inch:1e3,ft:12e3,yard:36e3,mile:6336e4,km:3937007874e-2,dm:3937,mm:39.37,um:.039,nm:394e-7,pt:13.88888888888889,"px(72)":13.88888888888889,"px(96)":10.416666666666666,"px(100)":10},bae=(()=>{let e={};for(let t in VS)e[VS[t]]=t;return e})();var ah,xae=(ah=class{constructor(t,i){this.ratio=t/i}wrap(t){return t*this.ratio}static convert(t,i,r){return t*i/r}},ah.ASIS=new ah(1,1),ah),Eg=class{conversion(e,t,i){if(e===t)return i;let r=e+2+t;return this[r](i)}conversion1(e,t,i){let r=e+2+t,s=this[r](i);return t=="mil"?Math.round(s*10)/10:Math.round(s*1e3)/1e3}mil2mil(e){return e}mil2mm(e){return e*.0254}mil2cm(e){return e*.00254}mil2inch(e){return e/1e3}mm2mm(e){return e}mm2mil(e){let t=Math.pow(10,5);return Math.round(e*39.37007874015748*t)/t}mm2cm(e){return e/10}mm2inch(e){let t=Math.pow(10,8);return Math.round(e*.03937007874015748*t)/t}cm2mil(e){let t=Math.pow(10,6);return Math.round(e*393.7007874015748*t)/t}cm2mm(e){return e*10}cm2inch(e){let t=Math.pow(10,7);return Math.round(e*.3937007874015748*t)/t}inch2mil(e){return e*1e3}inch2mm(e){return e*25.4}inch2cm(e){return e*2.54}};Eg.prototype["px(100)2mil"]=e=>e*10,Eg.prototype["px(100)2mm"]=e=>e*.254,Eg.prototype["mil2px(100)"]=e=>e/10,Eg.prototype["mm2px(100)"]=e=>{let t=Math.pow(10,5);return Math.round(e*3.937007874015748*t)/t};var Tg=null,Cy=new ArrayBuffer(8),$1=new Float64Array(Cy),Q1=new Uint32Array(Cy),qS=new Uint16Array(Cy);var XS=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!Tg){let e=this.getUrlVars().version;e?Tg="/analyzer/v"+e:Tg="/analyzer"}return Tg}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;$1[0]=new Date().getTime(),e.push(Q1[1].toString(16)),$1[0]=Math.random(),e.push(qS[3].toString(16));let t=qS[2].toString(16);e.push("4"+t.substr(0,3)),$1[0]=performance.now();let i=Q1[0].toString(16)+Q1[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}};var LI=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(Jc.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(Jc.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(Jc.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(Jc.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},sY=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(sY||{}),nY=/(\.?0+)$/,Jc=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(XS.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(XS.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);LI.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(nY,"")}},aY=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(aY||{});function oY(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var lY=(e,t)=>{e===3?console.error(t):console.log(t)},hY=(e,t)=>Jc.format("%s %s: %s",new Date,oY(e),t),yo,sO=(yo=class{constructor(t,i=lY,r=hY){this.debug=!1,this.level=t,this.writer=i,this.fmt=r}static mix(...t){let i=4;for(let r of t)r.level<i&&(i=r.level);return new yo(i,(r,s)=>{for(let n of t)n.write1(r,s)},(r,s)=>s)}wrap(t=null,i=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),s=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new yo(this.level,s,r)}chain(t){return t.wrap(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}write3(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,Jc.format(i,...r)))}write2(t,i){this.include(t)&&(i instanceof Error?this.writer(t,this.fmt(t,i.stack)):this.writer(t,this.fmt(t,i.toString())))}write1(t,i){this.include(t)&&this.writer(t,this.fmt(t,i))}debug3(t,...i){this.write3(0,t,i)}debug2(t){this.write2(0,t)}debug1(t){this.write1(0,t)}info3(t,...i){this.write3(1,t,i)}info2(t){this.write2(1,t)}info1(t){this.write1(1,t)}warning3(t,...i){this.write3(2,t,i)}warning2(t){this.write2(2,t)}warning1(t){this.write1(2,t)}error3(t,...i){this.write3(3,t,i)}error2(t){this.write2(3,t)}error1(t){this.write1(3,t)}},yo.DUMMY=new yo(4),yo),Ny=new ArrayBuffer(8),ey=new Float64Array(Ny),ty=new Uint32Array(Ny),WS=new Uint16Array(Ny),JS=ArrayBuffer;try{JS=self.HTMLImageElement||JS}catch{}var wg=null;function lh(e,t,i=0,r=e.length){s(e,null,t,i,r);function s(a,o,l,h,c){let f,d,u,p;if(h<c-1){let _=c-h;if(_>50)o===null&&(o=new Array(_+1)),n(a,o,l,h,(h+c)/2|0,c);else{f=a[h],d=h,u=h,p=c;let g=d+1;for(;g<p;){if(u!=p){if(p=p+-1,l(f,a[p])<=0)continue;a[u]=a[p],u=p;continue}if(l(f,a[g])>=0){d=g,g=d+1;continue}a[u]=a[g],d=g,u=g,g=d+1}a[u]=f,s(a,o,l,h,u),s(a,o,l,u+1,c)}}}function n(a,o,l,h,c,f){s(a,o,l,h,c),s(a,o,l,c,f);for(var d=h,u=c,p=0,_=a[d],g=a[u];d<c&&u<f;){var b=l(_,g);isNaN(b)?(o[p++]=g,g=a[++u]):(b<=0&&(o[p++]=_,_=a[++d]),b>=0&&(o[p++]=g,g=a[++u]))}for(;d<c;d++)o[p++]=a[d];for(;u<f;u++)o[p++]=a[u];for(d=h,u=0;u<p;d++,u++)a[d]=o[u]}}var hs=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}static rpad(e,t,i){let r=i-e.length;return r>0?e+this.repeat(t,r):e}static strHashcode(e){if(e.length>0){let t=0;for(let i=0;i<e.length;i++)t=31*t+e.charCodeAt(i)|0;return t}else return 0}static arraycopy(e,t,i,r,s){if(e.length>=t+s&&i.length>=r+s)for(;s-- >0;)i[r++]=e[t++];else throw new Error("arraycopy out of range")}static undefAsNull(e){return null}static reverse(e,t){for(let i=0,r=e.length-1;r>=0;i++,r--)t[i]=e[r];return t}static sortAsc(e,t){return e-t}static xmlDecode(e){let t=e.length,i=new Array,r=-1;for(let s=0;s<t;s++){let n=e.charAt(s);if(r>=0){if(n===";"){let a=e.substring(r+1,s);switch(a){case"lt":i.push("<");break;case"gt":i.push(">");break;case"quot":i.push('"');break;case"apos":i.push("'");break;case"amp":i.push("&");break;default:if(a.charAt(0)==="#"){let o=parseInt(a.substring(1));i.push(String.fromCharCode(o))}else i.push("&"+a+";")}r=-1}}else n==="&"?r=s:i.push(n)}return r>=0&&i.push(e.substring(r)),i.join("")}static addAll(e,t){for(let i of t)e.push(i)}static addAllSet(e,t){for(let i of t)e.add(i)}static contains(e,t){for(let i of e)if(i.equals(t))return!0;return!1}static equals(e,t){if(e.length==t.length){for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}else return!1}static remove(e,t){let i=0,r=e.length;for(let s=0;s<r;s++)e[s]===t&&(e.splice(s,1),s--,r--,i++);return i}static getUrlVars(){for(var e={},t=location.href.slice(location.href.indexOf("?")+1).split("&"),i=0;i<t.length;i++){var r=t[i].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}static prefix(){if(!wg){let e=this.getUrlVars().version;e?wg="/analyzer/v"+e:wg="/analyzer"}return wg}static add2objS(e,t,i){if(t in e)return e[t];{let r=i(t);return e[t]=r,r}}static downloadFile(e,t){let i=document.createElement("a"),r=URL.createObjectURL(t);i.download=e,i.href=r,i.click(),URL.revokeObjectURL(r)}static uuid(){let e=new Array;ey[0]=new Date().getTime(),e.push(ty[1].toString(16)),ey[0]=Math.random(),e.push(WS[3].toString(16));let t=WS[2].toString(16);e.push("4"+t.substr(0,3)),ey[0]=performance.now();let i=ty[0].toString(16)+ty[1].toString(16);return e.push("0"+i.substr(0,3)),e.push(i.substr(3)),e.join("-")}static funcCopy(e){return(0,eval)("("+e.toString()+")")}static NVL(...e){for(let t of e)if(t!==null)return t;return null}static isSingle(e){return Array.from(new Set(e)).length===e.length}},cY=[1,10,100,1e3];var Sg=0,th=0;function ZS(e,t,i){return Sg=Math.abs(e-t),i>=5&&Sg>1e-5||isNaN(i)&&Sg>1e-8?!1:Sg<1e-13?!0:(th=Math.min(KS(e),KS(t)),th<10&&(th=10),isNaN(i)||(th=Math.min(th,i)),$S(e,th)===$S(t,th))}var Ig=0,Pg=0;function KS(e){return Ig=0,Pg=0,e>0?Ig=e-Math.floor(e):Ig=e-Math.ceil(e),Pg=(Ig.toString()||"").length,Pg>2?Pg-2:0}function $S(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=cY[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}var uY=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(uY||{}),dY=/(\.?0+)$/,Zc=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(hs.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(hs.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static split(e,t){let i=new Array,r=0;for(;;){let s=e.exec(t);if(s!==null){let n=e.lastIndex-s[0].length;i.push(t.substring(r,n)),r=e.lastIndex}else{let n=t.substring(r);Ti.nullOrEmpty(n)||i.push(n);break}}return i}static fmtNumber(e){return e.toFixed(5).replace(dY,"")}},Ti=class{static rgb(e){if(0<=e&&e<=255)return e;throw new Error(Zc.format("RGB should not nagative and not over 255(0xFF): %X",e))}static normal(e){if(isFinite(e))return e;throw new Error(Zc.format("%f is not permitted",e))}static positiveOr0(e){if(e>=0)return e;throw new Error(Zc.format("%f must >= 0",e))}static positive(e){if(e>0)return e;throw new Error(Zc.format("%f must > 0",e))}static notnull(e){if(e!=null)return e;throw new Error("invalid null value")}static mustnull(e){if(e===null)return null;throw new Error("value must be null")}static notEmpty(e){if(e==null||e.length===0)throw new Error("invalid empty string");return e}static nullOrEmpty(e){return e==null||e.length===0}static notNullOrUndef(e){if(e!=null)return e;throw new Error("null or undefined is not permitted")}},oh,we=(oh=class{static regular(t){return Math.round(t*this.precision)/this.precision}static eq(t,i){return Math.abs(t-i)<=this.eps}static neq(t,i){return Math.abs(t-i)>this.eps}static less(t,i){return t-i<-this.eps}static lesseq(t,i){return t-i<=this.eps}static greater(t,i){return t-i>this.eps}static greatereq(t,i){return t-i>=-this.eps}static sqrt(t){return Math.abs(t)<=1e-10?0:Math.sqrt(t)}static sortAsc(t,i){return t-i}static sortDesc(t,i){return i-t}},oh.eps=1e-8,oh.precision=1e8,oh);function Qc(e,t){Xg(e.iterator(),t)}function Xg(e,t){let i=0;for(;e.hasNext();){let r=e.next();t(i++,r)}}var fY=class{constructor(e){this.idx=-1,this.lst=e}hasNext(){return this.idx<this.lst.length-1}next(){if(this.idx<this.lst.length-1)return this.idx++,this.lst[this.idx];throw new Error("bug")}};function gy(e){return new fY(e)}var wr,ht=(wr=class{static toDegrees(t){return t*180/Math.PI}static toRadians(t){return t/180*Math.PI}static regularD(t){return t=t%360,t=t<0?360+t:t,t===360?0:t}static regular(t){return t=t%wr.PIx2,t=t<0?wr.PIx2+t:t,t===wr.PIx2?0:t}static toQuarterBase(t){return wr.regular((t+wr.PI_4)/wr.PI_2*wr.PI_2)}static toQuarterBaseD(t){return wr.regularD(((t+45)/90|0)*90)}static transformD(t,i){return wr.toDegrees(wr.transform(wr.toRadians(t),i))}static transform(t,i){let r=Math.cos(t),s=Math.sin(t),n=new ge(i.data[6],i.data[7]),a=new ge(r,s).multiply3(i);return wr.regular(a.angle(n))}},wr.PIx2=Math.PI*2,wr.PI_2=Math.PI/2,wr.PI_4=Math.PI/4,wr),Bi=class{static dotProd1(e,t,i,r){return e*i+t*r}static dotProd2(e,t,i,r,s,n){return this.dotProd1(i-e,r-t,s-i,n-r)}static dotProd3(e,t,i){return this.dotProd2(e.x,e.y,t.x,t.y,i.x,i.y)}static crossProd1(e,t,i,r){return e*r-t*i}static crossProd2(e,t,i,r,s,n){return this.crossProd1(i-e,r-t,s-i,n-r)}static crossProd3(e,t,i){return this.crossProd2(e.x,e.y,t.x,t.y,i.x,i.y)}static distance2(e,t,i,r){let s=i-e,n=r-t;return s*s+n*n}static distance1(e,t,i,r){return this.hypot(i-e,r-t)}static distance1p(e,t){return this.distance1(e.x,e.y,t.x,t.y)}static hypot(e,t){if(e=Math.abs(e),t=Math.abs(t),t>e){var i=t;t=e,e=i}if(e===0)return t;var r=t/e;return e*Math.sqrt(1+r*r)}},RI=new ArrayBuffer(16),QS=new Float64Array(RI),Ag=new Int32Array(RI),Ct,ge=(Ct=class{static sortByXAsc(t,i){return t.x-i.x}static sortByYAsc(t,i){return t.y-i.y}static sortByXYAsc(t,i){return t.x<i.x?-1:t.x>i.x?1:t.y-i.y}static caculateAngle(t,i){let r=Math.cos(t),s=Math.sin(t),n=r*i.data[0]+s*i.data[4],a=r*i.data[1]+s*i.data[5],o=new Ct(n,a).normalize();return Math.atan2(o.y,o.x)}static normal(t,i,r){let s=i.sub(t),n=r.sub(i);return s.cross(n)}static getVector2(t){return new Ct(Math.cos(t),Math.sin(t))}static getCrossPoint1(t,i,r,s){if(t.equals1(i)||r.equals1(s)||we.eq(1,Math.abs(i.sub(t).normalize().dot(s.sub(r).normalize()))))return null;let n=i.y-t.y,a=t.x-i.x,o=i.x*t.y-t.x*i.y,l=s.y-r.y,h=r.x-s.x,c=s.x*r.y-r.x*s.y,f=n*h-l*a;return new Ct((c*a-o*h)/f,(o*l-c*n)/f)}static getCrossPoint2(t,i,r,s){return this.getCrossPoint1(t,t.add(i),r,r.add(s))}constructor(t,i){this.x=Ti.normal(t),this.y=Ti.normal(i)}get hashed(){return this._hashed==null&&(QS[0]=this.x,QS[1]=this.y,this._hashed=Ag[0]^Ag[1]^Ag[2]^Ag[3]),this._hashed}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.dot(this))}getCos(){return this.x/this.length()}sub(t){var i=this.x-t.x,r=this.y-t.y;return new Ct(i,r)}add(t){var i=this.x+t.x,r=this.y+t.y;return new Ct(i,r)}div(t){return new Ct(this.x/t,this.y/t)}add1(t,i){return new Ct(this.x+t,this.y+i)}mul(t){return new Ct(this.x*t,this.y*t)}cross(t){return this.x*t.y-this.y*t.x}getSin(){return this.y/this.length()}angle2(t){let i=this.y-t.y,r=this.x-t.x;return i=Math.abs(i-0)<10**-4?0:i,r=Math.abs(r-0)<10**-4?0:r,Math.atan2(i,r)}angleD2(t){return ht.toDegrees(this.angle2(t))}angle(t){return Math.atan2(this.y-t.y,this.x-t.x)}angleX(t=Ct.ORIGIN){let i=this.angle(t);return i<0&&(i=Math.PI*2+i),i}angleD(t){return ht.toDegrees(this.angle(t))}distance1(t){let i=t.x-this.x,r=t.y-this.y;return Bi.hypot(i,r)}distance2(t){let i=t.x-this.x,r=t.y-this.y;return i*i+r*r}rotateD(t,i){return this.rotate(t,ht.toRadians(i))}rotate(t,i){let r=Math.cos(i),s=Math.sin(i),n=this.x-t.x,a=this.y-t.y,o=n*r+a*-s,l=n*s+a*r;return t.add1(o,l)}multiply3(t){let i=this.x*t.data[0]+this.y*t.data[3]+t.data[6],r=this.x*t.data[1]+this.y*t.data[4]+t.data[7];return new Ct(i,r)}multiply4(t){let i=this.x*t.data[0]+this.y*t.data[4]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+t.data[13];return new Ct(i,r)}hashCode(){return this.hashed}equals(t,i){return t instanceof Ct?ZS(t.x,this.x,i)&&ZS(t.y,this.y,i):!1}equals1(t){return t?we.eq(this.x,t.x)&&we.eq(this.y,t.y):!1}equals2(t,i){return t instanceof Ct?Math.abs(this.x-t.x)<=i&&Math.abs(this.y-t.y)<=i:!1}similarEquals(t,i=.5){return Math.abs(this.x*.1-t.x*.1)<=i&&Math.abs(this.y*.1-t.y*.1)<=i}toString(){return"Vector [X="+this.x+", Y="+this.y+"]"}bbox(){let t=this.x,i=this.y;return new ls(t,t,i,i)}normalize(){if(this.x===0&&this.y===0)return new Ct(0,0);let t=this.x/this.length(),i=this.y/this.length();return new Ct(t,i)}regular(t=1e-4){let i=Math.round(1/t);return new Ct(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}round(t=4){let i=10**(t|0);return new Ct(Math.round(this.x*i)/i,Math.round(this.y*i)/i)}mirrorX(t=Ct.ORIGIN){return new Ct(this.x,2*t.y-this.y)}mirrorY(t=Ct.ORIGIN){return new Ct(2*t.x-this.x,this.y)}mirrorCenter(t=Ct.ORIGIN){return new Ct(2*t.x-this.x,2*t.y-this.y)}clone(){return new Ct(this.x,this.y)}mirror(t=Ct.ORIGIN){return new Ct(2*t.x-this.x,2*t.y-this.y)}pointOnRays(t,i){let r=ht.toRadians(t);return new Ct(this.x+Math.cos(r)*i,this.y+Math.sin(r)*i)}pointOnRays2(t,i){let r=t.angle(this);return new Ct(this.x+Math.cos(r)*i,this.y+Math.sin(r)*i)}scale(t){return new Ct(this.x*t,this.y*t)}},Ct.ORIGIN=new Ct(0,0),Ct.X_UNIT_VECTOR=new Ct(1,0),Ct.Y_UNIT_VECTOR=new Ct(0,1),Ct),pY=(e=>(e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT",e))(pY||{}),_Y=(e=>(e[e.TOP=0]="TOP",e[e.CENTER=1]="CENTER",e[e.BOTTOM=2]="BOTTOM",e))(_Y||{}),Qi,fo=(Qi=class{constructor(t,i){this.horizontal=t,this.vertical=i}},Qi.LT=new Qi(0,0),Qi.LC=new Qi(0,1),Qi.LB=new Qi(0,2),Qi.CT=new Qi(1,0),Qi.CC=new Qi(1,1),Qi.CB=new Qi(1,2),Qi.RT=new Qi(2,0),Qi.RC=new Qi(2,1),Qi.RB=new Qi(2,2),Qi),gY=(e=>(e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER",e[e.SEPARATED=2]="SEPARATED",e[e.INTERSECTED=3]="INTERSECTED",e[e.EQ=4]="EQ",e[e.INSIDE_TOUCHED=5]="INSIDE_TOUCHED",e[e.OUTSIDE_TOUCHED=6]="OUTSIDE_TOUCHED",e))(gY||{}),Hs=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}ext1(e){return this.minX=Math.min(this.minX,e.minX),this.maxX=Math.max(this.maxX,e.maxX),this.minY=Math.min(this.minY,e.minY),this.maxY=Math.max(this.maxY,e.maxY),this}ext2(e){return this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y),this}ext3(e){for(let t=0;t<e.length;t++){let i=e[t];this.ext2(i)}return this}ext4(e){return Qc(e,(t,i)=>(this.ext2(i),!0)),this}ext5(e,t,i,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,t),this.minY=Math.min(this.minY,i),this.maxY=Math.max(this.maxY,r),this}ext6(e,t){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t),this}ext7(e){if(e<0){let t=e*2;if(t<this.minX-this.maxX||t<this.minY-this.maxY)throw new Error("")}return this.minX-=e,this.maxX+=e,this.minY-=e,this.maxY+=e,this}ext8(e){let t=[];for(let i=0;i<e.length;i+=2)t.push(new ge(e[i],e[i+1]));return this.ext3(t)}ext9(e,t,i,r){return this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e+i),this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t+r),this}ext10({x:e,y:t,width:i,height:r}){return this.ext9(e,t,i,r)}valid(){return isFinite(this.minX)&&isFinite(this.maxX)&&isFinite(this.minY)&&isFinite(this.maxY)}clear(){this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}build(){return new ls(this.minX,this.maxX,this.minY,this.maxY)}build1(){return this.valid()?new ls(this.minX,this.maxX,this.minY,this.maxY):new ls(0,0,0,0)}},jd=new Float64Array(4),ls=class yn{static extendRect({x:t,y:i,width:r,height:s}){return new yn(t,t+r,i,i+s)}static extend1(t,i){if(t===null)return new yn(i.x,i.x,i.y,i.y);{let r=Math.min(t.minX,i.x),s=Math.max(t.maxX,i.x),n=Math.min(t.minY,i.y),a=Math.max(t.maxY,i.y);return new yn(r,s,n,a)}}static extend2(t,i){if(t){let r=Math.min(t.minX,i.minX),s=Math.max(t.maxX,i.maxX),n=Math.min(t.minY,i.minY),a=Math.max(t.maxY,i.maxY);return new yn(r,s,n,a)}else return i}static extend3(t,i){let r=Math.min(t.x,i.x),s=Math.max(t.x,i.x),n=Math.min(t.y,i.y),a=Math.max(t.y,i.y);return new yn(r,s,n,a)}static extend4(t,i,r){return new yn(t.x-i/2,t.x+i/2,t.y-r/2,t.y+r/2)}constructor(t,i,r,s){if(this.minX=Ti.normal(t),this.maxX=Ti.normal(i),this.minY=Ti.normal(r),this.maxY=Ti.normal(s),t>i||r>s)throw new Error(`min > max is not permitted: [${t}, ${i}, ${r}, ${s}]`)}get data(){return jd[0]=this.minX,jd[1]=this.maxX,jd[2]=this.minY,jd[3]=this.maxY,jd}isContains(t){return this.isContains1(t.x,t.y)}points(){return[this.LL(),this.LR(),this.UR(),this.UL(),this.LL()]}isContains1(t,i){return this.isContainsX(t)&&this.isContainsY(i)}isContains2(t,i){return this.isContainsX1(t)&&this.isContainsY1(i)}isContainsX(t){return t>=this.minX&&t<=this.maxX}isContainsX1(t){return we.greatereq(t,this.minX)&&we.lesseq(t,this.maxX)}isContainsY(t){return t>=this.minY&&t<=this.maxY}isContainsY1(t){return we.greatereq(t,this.minY)&&we.lesseq(t,this.maxY)}isIntersect(t){return!(this.maxX<t.minX||this.minX>t.maxX||this.maxY<t.minY||this.minY>t.maxY)}extendOfSize(t){return Ti.positiveOr0(this.maxX-this.minX+t*2),Ti.positiveOr0(this.maxY-this.minY+t*2),new yn(this.minX-t,this.maxX+t,this.minY-t,this.maxY+t)}isInside(t){return this.minX>=t.minX&&this.maxX<=t.maxX&&this.minY>=t.minY&&this.maxY<=t.maxY}isContainsBBox(t){return this.maxX>=t.maxX&&this.minX<=t.minX&&this.maxY>=t.maxY&&this.minY<=t.minY}isContainsBBox1(t){return we.greatereq(this.maxX,t.maxX)&&we.lesseq(this.minX,t.minX)&&we.greatereq(this.maxY,t.maxY)&&we.lesseq(this.minY,t.minY)}intersect(t){let i=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(i>r)return null;let s=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return s>n?null:new yn(i,r,s,n)}intersection1(t){let i=Math.max(this.minX,t.minX),r=Math.min(this.maxX,t.maxX);if(we.greater(i,r))return null;i>r&&(r=i);let s=Math.max(this.minY,t.minY),n=Math.min(this.maxY,t.maxY);return we.greater(s,n)?null:(s>n&&(n=s),new yn(i,r,s,n))}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}UL(){return new ge(this.minX,this.maxY)}UR(){return new ge(this.maxX,this.maxY)}LL(){return new ge(this.minX,this.minY)}LR(){return new ge(this.maxX,this.minY)}center(){return new ge(this.maxX-(this.maxX-this.minX)/2,this.maxY-(this.maxY-this.minY)/2)}area(){return this.width()*this.height()}transform(t){let i=new Hs;return i.ext2(this.LL().multiply3(t)),i.ext2(this.LR().multiply3(t)),i.ext2(this.UR().multiply3(t)),i.ext2(this.UL().multiply3(t)),i.build()}transform4(t){let i=new Hs;return i.ext2(this.LL().multiply4(t)),i.ext2(this.LR().multiply4(t)),i.ext2(this.UR().multiply4(t)),i.ext2(this.UL().multiply4(t)),i.build()}isSeparated(t){if(t==null||t==null)return!1;let i;this.minX>=t.minX?i=this.minX:i=t.minX;let r;if(this.maxX<=t.maxX?r=this.maxX:r=t.maxX,i>r)return!0;{let s;this.minY>=t.minY?s=this.minY:s=t.minY;let n;return this.maxY<=t.maxY?n=this.maxY:n=t.maxY,s>n}}relation(t){let i=0,r=0,s;this.minX>t.minX?(i++,s=this.minX):this.minX===t.minX?s=this.minX:(r++,s=t.minX);let n;if(this.maxX<t.maxX?(i++,n=this.maxX):this.maxX===t.maxX?n=this.maxX:(r++,n=t.maxX),s>n)return 2;{let a;this.minY>t.minY?(i++,a=this.minY):this.minY===t.minY?a=this.minY:(r++,a=t.minY);let o;return this.maxY<t.maxY?(i++,o=this.maxY):this.maxY===t.maxY?o=this.maxY:(r++,o=t.maxY),a>o?2:i===4?0:r===4?1:i===0&&r===0?4:s===n||a===o?6:i!==r?5:3}}zoom(t){let i=this.width(),r=this.height(),s=this.center();return t!=0&&(i/=t/2,r/=t/2),new yn(s.x-i,s.x+i,s.y-i,s.y+i)}toString(){return"BBox [minX="+this.minX+", maxX="+this.maxX+", minY="+this.minY+", maxY="+this.maxY+"]"}equals(t){return this.minY==t.minY&&this.minX==t.minX&&this.maxX==t.maxX&&this.maxY==t.maxY}extendSize(t,i){return Object.is(void 0,i)&&(i=t),yn.extend4(this.center(),this.width()+t,this.height()+i)}positionOnBBox(t,i=0){let r=this.center(),s=this.width()*i/2,n=this.height()*i/2,a=t.x-r.x,o=t.y-r.y;return a>s?o>n?fo.RT:o<-n?fo.RB:fo.RC:a<-s?o>n?fo.LT:o<-n?fo.LB:fo.LC:o>n?fo.CT:o<-n?fo.CB:fo.CC}bbox(){return this}},Wg=class Rt{static mul(t,i,r,s,n,a){let o=0,l=0;for(let h=0;h<t;h++){for(let c=0;c<r;c++){let f=c,d=0;for(let u=0;u<i;u++)d+=s[l+u]*n[f],f+=r;a[o++]=d}l+=i}}constructor(t,i,r){this.m=Ti.normal(t),this.n=Ti.normal(i);let s=t*i;if(r.length===s){for(let n=0;n<r.length;n++)Ti.normal(r[n]);this.data=r}else throw new Error("invalid matrix size")}mul(t){if(this.n===t.m){let i=new Array(this.m*t.n);return Rt.mul(this.m,this.n,t.n,this.data,t.data,i),new Rt(this.m,t.n,i)}else throw new Error("m !== p")}toString(){let t=[];t.push("Matrix ("),t.push(this.m.toString()),t.push(" x "),t.push(this.n.toString()),t.push(")");let i=0;for(let r=0;r<this.m;r++)for(let s=0;s<this.n;s++){let n=this.data[i++].toString();s===0?(t.push(`
`),t.push("	"),t.push(n)):(t.push(", "),t.push(n))}return t.join("")}static on(t,i,r){return t*i+r}initExpandMatrix(t){let i=this.m,r=this.n,s=r*2,n=new Array(i*s);for(let a=0;a<i;a++)for(let o=0;o<s;o++)o<r?n[Rt.on(s,a,o)]=t[Rt.on(r,a,o)]:o===i+a?n[Rt.on(s,a,o)]=1:n[Rt.on(s,a,o)]=0;return n}inverseMatrix(t,i,r){for(let s=0;s<i;s++){let n=t[Rt.on(r,s,s)];for(let a=0;a<r;a++)t[Rt.on(r,s,a)]/=n}return t}getMatrixRank(t,i,r){let s=Math.min(i,r);for(let n=0;n<i;n++){if(t[Rt.on(r,n,n)]===0){let a=new Array(r),o;for(o=n;o<i;o++)if(t[Rt.on(r,o,n)]!==0){hs.arraycopy(t,Rt.on(r,o,0),a,0,r),hs.arraycopy(t,Rt.on(r,n,0),t,Rt.on(r,o,0),r),hs.arraycopy(a,0,t,Rt.on(r,n,0),r);break}o>=i&&(s-=1)}if(!(s<i))for(let a=0;a<i;a++){if(a===n)continue;let o=t[Rt.on(r,a,n)]/t[Rt.on(r,n,n)];for(let l=0;l<r;l++)t[Rt.on(r,a,l)]-=t[Rt.on(r,n,l)]*o}}return s}getInverseMatrix(){if(this.m!==this.n)throw new Error("The matrix is an "+this.m+"x"+this.n+" order matrix, non-square matrix, please check!");function t(a){return we.lesseq(Math.abs(a),0)}let i=this.initExpandMatrix(this.data.slice(0)),r=this.n*2;function s(a,o){for(let l=0;l<r;l++){let h=i[Rt.on(r,a,l)];i[Rt.on(r,a,l)]=i[Rt.on(r,o,l)],i[Rt.on(r,o,l)]=h}}for(let a=0;a<this.m;a++){let o=Math.abs(i[Rt.on(r,a,a)]),l=a;if(t(i[Rt.on(r,a,a)]))for(let c=a+1;c<this.m;c++){if(t(i[Rt.on(r,c,a)])){Math.abs(i[Rt.on(r,c,a)])>o&&(o=Math.abs(i[Rt.on(r,c,a)]),l=c);continue}s(a,c);break}if(t(i[Rt.on(r,a,a)])){if(o===0)throw new Error("The matrix is a non-full rank matrix, please check!");console.warn("The matrix may be a non-full rank matrix, please check!"),l!==a&&s(a,l)}let h=1/i[Rt.on(r,a,a)];for(let c=0;c<r;c++)i[Rt.on(r,a,c)]*=h;for(let c=0;c<this.m;c++){if(a===c)continue;let f=i[Rt.on(r,c,a)];for(let d=a;d<r;d++)i[Rt.on(r,c,d)]-=i[Rt.on(r,a,d)]*f}}let n=[];for(let a=0;a<this.m;a++)for(let o=this.n;o<r;o++)n[Rt.on(this.n,a,o-this.n)]=i[Rt.on(r,a,o)];return new Rt(this.m,this.n,n)}getTransposeMatrix(){let t=new Array(this.data.length);for(let i=0;i<this.m;i++)for(let r=0;r<this.n;r++)t[r*this.n+i]=this.data[i*this.m+r];return new Rt(this.n,this.m,t)}hashCode(){let t=0;for(let i of this.data)t+=i;return t}equals(t){return this===t?!0:t===null?!1:t instanceof Rt?!(this.m!=t.m||this.n!=t.n||!hs.equals(this.data,t.data)):!1}},OY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],gi,DI=(gi=class extends Wg{static translate(t,i,r){return new gi([1,0,0,0,0,1,0,0,0,0,1,0,t,i,r,1])}static translate1(t){return new gi([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,t.z,1])}static rotateX(t){let i=Math.cos(t),r=Math.sin(t);return new gi([1,0,0,0,0,i,r,0,0,-r,i,0,0,0,0,1])}static rotateY(t){let i=Math.cos(t),r=Math.sin(t);return new gi([i,0,-r,0,0,1,0,0,r,0,i,0,0,0,0,1])}static rotateZ(t){let i=Math.cos(t),r=Math.sin(t);return new gi([i,r,0,0,-r,i,0,0,0,0,1,0,0,0,0,1])}static rotateAxis(t,i){t=t.normalize();let r=t.x,s=t.y,n=t.z,a=Math.sin(i),o=Math.cos(i);return new gi([r*r*(1-o)+o,r*s*(1-o)+n*a,r*n*(1-o)-s*a,0,r*s*(1-o)-n*a,s*s*(1-o)+o,s*n*(1-o)+r*a,0,r*n*(1-o)+s*a,s*n*(1-o)-r*a,n*n*(1-o)+o,0,0,0,0,1])}static scale(t,i=t,r=t){return new gi([t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1])}static flipX(){return new gi([1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1])}static flipY(){return new gi([-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}static rotateZForPoint(t,i){return t.equals1(ge.ORIGIN)?gi.rotateZ(i):gi.translate(-t.x,-t.y,0).rotateZ(i).translate1(t.x,t.y,0)}static getMatrix4(t,i,r,s){let n=Math.cos(i),a=Math.sin(i),o=r*(t.x*n-t.y*a)+s.x,l=t.x*a+t.y*n+s.y,h=[r*n,a,0,0,-a*r,n,0,0,0,0,1,0,o,l,0,1];return new gi(h)}constructor(t=OY){super(4,4,t)}translate(t){return this.multiply4(gi.translate1(t))}translate1(t,i,r){return this.multiply4(gi.translate(t,i,r))}rotateX(t){return this.multiply4(gi.rotateX(t))}rotateY(t){return this.multiply4(gi.rotateY(t))}rotateZ(t){return this.multiply4(gi.rotateZ(t))}scale(t,i=t,r=t){return this.multiply4(gi.scale(t,i,r))}scale1(t){return this.multiply4(gi.scale(t.x,t.y,t.z))}setOrigin(t,i,r){return gi.translate(-t,-i,-r).multiply4(this).translate1(t,i,r)}setOrigin1(t){return this.setOrigin(t.x,t.y,t.z)}multiply4(t){let i=new Array(16);return Wg.mul(4,4,4,this.data,t.data,i),new gi(i)}getInverseMatrix(){let t=super.getInverseMatrix();return new gi(t.data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new gi(t.data)}inverse(){let t=this.getInverseMatrix();return new gi(t.data)}toMatrix3(){let t=this.data;return new er([t[0],t[1],0,t[4],t[5],0,t[12],t[13],1])}},gi.ORIGIN=new gi,gi);function Yd(e){return LI.normal(parseFloat(e))}var mY=[1,0,0,0,1,0,0,0,1],ri,er=(ri=class extends Wg{static translate(t,i){return new ri([1,0,0,0,1,0,t,i,1])}static translate1(t){return this.translate(t.x,t.y)}static rotate(t){let i=Math.cos(t),r=Math.sin(t);return new ri([i,r,0,-r,i,0,0,0,1])}static rotateD(t){return this.rotate(ht.toRadians(t))}static scale(t,i=t){return new ri([t,0,0,0,i,0,0,0,1])}static scale1(t,i){return new ri([t,0,0,0,i,0,0,0,1])}static toDOMMatrix(t){let[i,r,,s,n,,a,o]=t.data;return`matrix(${[i,r,s,n,a,o].join(",")})`}static svgTrasform(t){let i=t.split(" "),r=null;return i.forEach(s=>{s=s.trim();let n=s.trim().replace(")","").split("("),a=n[0],o=n[1].split(",");switch(a){case"translate":let l=Yd(o[0]),h=Yd(o[1]);r=r?r.translate(l,h):ri.translate(l,h);break;case"rotate":let c=Yd(o[0]),f=Yd(o[1]),d=Yd(o[2]);r=r?r.setOrigin(f,d):ri.translate(f,d),r=r.rotateD(c);break;default:return}}),r}constructor(t=mY){super(3,3,t);let i=t[0],r=t[3],s=t[1],n=t[4];this.iScale=Math.sqrt(i*i+s*s),this.jScale=Math.sqrt(r*r+n*n)}isMirrored(){return this.det()<0}multiply3(t){let i=new Array(9);return Wg.mul(3,3,3,this.data,t.data,i),new ri(i)}translate(t,i){return this.multiply3(ri.translate(t,i))}translate1(t){return this.multiply3(ri.translate1(t))}scale(t,i=t){return this.multiply3(ri.scale(t,i))}scale1(t,i){return this.multiply3(ri.scale1(t,i))}det(){return this.data[0]*this.data[4]-this.data[3]*this.data[1]}invert(){let t=this.getInverseMatrix();return new ri(t.data)}rotateD(t){return this.multiply3(ri.rotateD(t))}rotate(t){return this.multiply3(ri.rotate(t))}resetOffset(){let t=this.data;return new ri([t[0],t[1],0,t[3],t[4],0,0,0,1])}setOrigin(t,i){return ri.translate(-t,-i).multiply3(this).translate(t,i)}setOrigin1(t){return this.setOrigin(t.x,t.y)}getInverseMatrix(){return new ri(super.getInverseMatrix().data)}getTransposeMatrix(){let t=super.getTransposeMatrix();return new ri(t.data)}toMatrix4(){let t=this.data;return new DI([t[0],t[1],0,t[2],t[3],t[4],0,t[5],0,0,1,0,t[6],t[7],0,t[8]])}scaleNum(t){return!t||isNaN(t)?t:t*this.iScale}},ri.ORIGIN=new ri,ri.MIRROR_Y=new ri([1,0,0,0,-1,0,0,0,1]),ri.MIRROR_X=new ri([-1,0,0,0,1,0,0,0,1]),ri.ROT_90=new ri([0,1,0,-1,0,0,0,0,1]),ri.ROT_N90=new ri([0,-1,0,1,0,0,0,0,1]),ri),yY=(e=>(e[e.BUTT=0]="BUTT",e[e.ROUND=1]="ROUND",e[e.SQUARE=2]="SQUARE",e))(yY||{}),bY=(e=>(e[e.CW=0]="CW",e[e.CCW=1]="CCW",e))(bY||{}),ff=class{},Oy=class Jd{constructor(t,i,r){this.p1=t,this.p2=i,this.p3=r}barycentre(){return Jd.barycentre(this.p1,this.p2,this.p3)}incentre(){return Jd.incentre(this.p1,this.p2,this.p3)}static barycentre(t,i,r){let s=t.x+i.x+r.x,n=t.y+i.y+r.y;return new ge(s/3,n/3)}static incentre(t,i,r){let s=i.sub(r).length(),n=t.sub(r).length(),a=t.sub(i).length(),o=s+n+a,l=s*t.x+n*i.x+a*r.x,h=s*t.y+n*i.y+a*r.y;return new ge(l/o,h/o)}area(){return Jd.area(this.p1,this.p2,this.p3)}static area(t,i,r){return this.area2(t.x,t.y,i.x,i.y,r.x,r.y)/2}static area2(t,i,r,s,n,a){return Math.abs(Bi.crossProd2(t,i,r,s,n,a))}scale(t,i){let r=er.translate(-t.x,-t.y).scale(i).translate1(t),s=this.p1.multiply3(r),n=this.p2.multiply3(r),a=this.p3.multiply3(r);return new Jd(s,n,a)}scaleOnBarycentre(t){return this.scale(this.barycentre(),t)}scaleOnIncentre(t){return this.scale(this.incentre(),t)}extend(t){let i=this.incentre(),r=this.p1.add(this.p2).sub(i).scale(1/2),s=r.length(),n=ge.ORIGIN.pointOnRays2(r,s+t).length()/s;return this.scaleOnIncentre(n)}container(t){let i=this.p3.sub(this.p1),r=this.p2.sub(this.p1),s=t.sub(this.p1),n=i.dot(i),a=i.dot(r),o=i.dot(s),l=r.dot(r),h=r.dot(s),c=1/(n*l-a*a),f=(l*o-a*h)*c;if(f<0||f>1)return!1;let d=(n*h-a*o)*c;return d<0||d>1?!1:f+d<=1}};function Cg(){return{minDistance:Number.POSITIVE_INFINITY,start:null,end:null}}var Jn=class cl{static getMinDistanceWithoutCross(t,i){let r=Cg();return cl.minLine(t,i,r),r.minDistance}static getMinDistance(t,i){return bn(t,i)?0:this.getMinDistanceWithoutCross(t,i)}static getMinLineWithCross(t,i){let r=Cg();return cl.minLine(t,i,r),new ce(r.start,r.end)}static getMinLine(t,i){return cl.intersection(t,i)||this.getMinLineWithCross(t,i)}static getMinDistanceFromPoint(t,i){let r=Cg();if(i instanceof ce)this.point2LineMinLine(r,i,t);else if(i instanceof xe)this.point2ArcMinDistance(t,i,r);else throw new Error("not support");return r.minDistance}constructor(t,i){if(this.pt1=t,this.pt2=i,this.minline=cl.intersection(t,i),this.minline)this.minDistance=0;else{let r=Cg();cl.minLine(t,i,r),this.minline=new ce(r.start,r.end),this.minDistance=r.minDistance}}getDistance(){return this.minDistance}getLine(){return this.minline}static intersection(t,i){let r=bn(t,i);if(r===0)return;let s=new Array;for(let n=0;n<r;n+=2){let a=new ge(ie[n],ie[n+1]);s.push(a)}return s.length>1?new ce(s[0],s[1]):new ce(s[0],s[0])}static minLine(t,i,r){if(t instanceof ce&&i instanceof ce)return this.minDistanceForLines(t,i,r);if(t instanceof xe&&i instanceof ce)return this.minDistanceForLineAndArc(t,i,r);if(t instanceof ce&&i instanceof xe)return this.minDistanceForLineAndArc(i,t,r);if(t instanceof xe&&i instanceof xe)return this.minDistanceForArcs(t,i,r);throw new Error("not support")}static minDistanceForLines(t,i,r){[t.start(),t.end(),i.start(),i.end()].forEach((s,n)=>{n<2?this.point2LineMinLine(r,i,s):this.point2LineMinLine(r,t,s)})}static minDistanceForLineAndArc(t,i,r){this.point2LineMinLine(r,i,t.start()),this.point2LineMinLine(r,i,t.svgEnd);let s=cl.foot(i,t.center);i.bbox().extendOfSize(1e-8).isContains(s)&&this.point2ArcMinLine(r,t,s),this.point2ArcMinLine(r,t,i.start()),this.point2ArcMinLine(r,t,i.end())}static minDistanceForArcs(t,i,r){this.concentricArc(t,i,r),this.point2ArcMinDistance(i.start(),t,r),this.point2ArcMinDistance(i.svgEnd,t,r),this.point2ArcMinDistance(t.start(),i,r),this.point2ArcMinDistance(t.svgEnd,i,r),(qn(t,i.center)||qn(i,t.center))&&this.shortestLineForArcs(t,i,r)}static minLineForArcAndLine(t,i,r){let s=t.pointOn(r.angleD(t.center)),n=t.pointOn(t.center.angleD(r));this.arcShortestLine(t,i,r,s),this.arcShortestLine(t,i,r,n)}static arcInnerLineFootSegment(t,i,r){let s=r.distance1(t.center);if(s!==0){let n=t.rx*(r.y-t.center.y)/s+t.center.y,a=t.rx*(r.x-t.center.x)/s+t.center.x;s=t.rx-s,s<i.minDistance&&(i.minDistance=s,i.start=new ge(a,n),i.end=r)}else s=t.rx-s,s<i.minDistance&&(i.minDistance=s,i.start=t.start(),i.end=r)}static shortestLineForArcs(t,i,r){let s=t.center.angleD(i.center),n=i.center.angleD(t.center),a=t.pointOn(s),o=t.pointOn(n),l=i.pointOn(s),h=i.pointOn(n);qn(t,a)&&(this.arcShortestLine(i,r,a,l),this.arcShortestLine(i,r,a,h)),qn(t,o)&&(this.arcShortestLine(i,r,o,l),this.arcShortestLine(i,r,o,h)),this.shortestLineForArcs1(t,i,r)}static shortestLineForArcs1(t,i,r){let s=i.start().sub(t.center).normalize(),n=i.end().sub(t.center).normalize(),a=t.start().sub(i.center).normalize(),o=t.end().sub(i.center).normalize(),l=t.center.add(s.mul(t.rx)),h=t.center.add(n.mul(t.rx)),c=i.center.add(a.mul(i.rx)),f=i.center.add(o.mul(i.rx));qn(t,l)&&we.greater(i.start().distance2(t.center),0)&&this.arcShortestLine(t,r,i.start(),l),qn(t,h)&&we.greater(i.end().distance2(t.center),0)&&this.arcShortestLine(t,r,i.end(),h),qn(i,c)&&we.greater(t.start().distance2(i.center),0)&&this.arcShortestLine(i,r,t.start(),c),qn(i,f)&&we.greater(t.end().distance2(i.center),0)&&this.arcShortestLine(i,r,t.end(),f)}static concentricArc(t,i,r){if(!(t.center.distance1(i.center)<1e-5&&t.rx===i.rx&&t.ry===i.ry))return;let s=t.start().distance1(i.svgEnd);s<r.minDistance&&(r.minDistance=s,r.start=t.start(),r.end=i.svgEnd),s=i.start().distance1(t.svgEnd),s<r.minDistance&&(r.minDistance=s,r.start=i.start(),r.end=t.svgEnd)}static point2ArcMinDistance(t,i,r){if(qn(i,t)){let s=i.pointOn(t.angleD(i.center)),n=i.pointOn(i.center.angleD(t));this.arcShortestLine(i,r,t,s),this.arcShortestLine(i,r,t,n)}else this.minLineSegment(r,i.start(),t),this.minLineSegment(r,i.svgEnd,t)}static point2ArcMinLine(t,i,r){if(qn(i,r)){let s=r.distance1(i.center);s>i.rx||s>i.ry?this.minLineForArcAndLine(i,t,r):this.arcInnerLineFootSegment(i,t,r)}}static point2LineMinLine(t,i,r){let s=cl.foot(i,r);i.bbox().extendOfSize(1e-8).isContains(s)?this.minLineSegment(t,s,r):(this.minLineSegment(t,i.start(),r),this.minLineSegment(t,i.end(),r))}static minLineSegment(t,i,r){let s=i.distance1(r);s<t.minDistance&&(t.minDistance=s,t.start=i,t.end=r)}static arcShortestLine(t,i,r,s){if(!qn(t,s))return;let n=r.distance1(s);n<i.minDistance&&(i.minDistance=n,i.start=r,i.end=s)}static foot(t,i){if(t.isPoint())return t.start();if(!we.eq(t.b,0)&&!we.eq(t.a,0)){let r=t.start(),s=t.direct,n=(i.x-r.x)*s.x+(i.y-r.y)*s.y;return new ge(r.x+s.x*n,r.y+s.y*n)}else return we.eq(t.b,0)&&!we.eq(t.a,0)?new ge(t.start().x,i.y):!we.eq(t.b,0)&&we.eq(t.a,0)?new ge(i.x,t.start().y):i}};function qn(e,t){if(we.eq(e.sweepAngle,360))return!0;let i=ht.regularD(t.angleD(e.center));return e.sweepAngle>0?(we.less(i,e.startAngle)&&(i+=360),we.greatereq(e.endAngle(),i)):(we.greater(i,e.startAngle)&&(i-=360),we.lesseq(e.endAngle(),i))}var xY=[1,10,100,1e3],eI="http://www.w3.org/2000/svg",tI="http://www.w3.org/1999/xlink",iI="http://www.w3.org/XML/1998/namespace",rI="https://easyeda.com/",vae=(function(){var e={svg:eI,xlink:tI,xml:iI,c:rI};return e[eI]="svg",e[tI]="xlink",e[iI]="xml",e[rI]="c",e})();var $i=(function(){var e={RATLINES:9,MODEL3D:19,ALL:11,TOPSILKLAYER:3,TOPLAYER:1,TOPPASTERLAYER:5,TOPSOLDERLAYER:7,LIBBODY:99,PADSURFACE:100,BOARDOUTLINE:10,DOCUMENT:12,TOPASSEMBLY:13,MECHANICAL:15,TOPCOMPONENT:16,SUBSTRATE:18},t;for(t=21;t<53;t++)e["INNER"+(t-20)]=t;for(e.BOTTOMSILKLAYER=4,e.BOTTOMLAYER=2,e.BOTTOMPASTERLAYER=6,e.BOTTOMSOLDERLAYER=8,e.BOTTOMASSEMBLY=14,e.BOTTOMCOMPONENT=17,t=53;t<85;t++)e["BOARD"+(t-52)]=t;return e})(),Eae=(function(){var e={COPPERAREA:[1,2,21,22,23,24],PLANEZONE:[1,2,21,22,23,24],RECT:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,99],TRACK:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],PAD:[11,1,2],VIA:[11],HOLE:[11],TEXT:[3,4,1,2,7,8,12,13,14,15,21,22,23,24],ARC:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],ELLIPSE:[3,4,12,13,14,15],CIRCLE:[1,2,3,4,5,6,7,8,10,12,13,14,15,21,22,23,24,99],DIMENSION:[3,4,12,13,14,15],FOOTPRINT:[1,2],SOLIDREGION:[1,2,3,4,5,6,7,8,12,13,14,15,21,22,23,24,11,99,100],SVGNODE:[1,2,3,4,7,8,12,13,14,15],PROTRACTOR:[3,4,12,13,14,15],SHEET:[12,13,14,15]};e["3D"]=(function(){for(var s=[16,19,3,7,5,1],n=21;n<52;n++)s.push(n+32,n);return s.push(2,6,8,4,17),s})();var t,i,r;for(t in e)if(e.hasOwnProperty(t)&&(r=e[t],r.indexOf(21)>0&&r.indexOf(25)===-1))for(i=25;i<=52;i++)r.push(i);return e})(),Br=(function(){var e={1:"TopLayer",2:"BottomLayer",3:"TopSilkLayer",4:"BottomSilkLayer",5:"TopPasteMaskLayer",6:"BottomPasteMaskLayer",7:"TopSolderMaskLayer",8:"BottomSolderMaskLayer",9:"Ratlines",10:"BoardOutLine",11:"Multi-Layer",12:"Document",13:"TopAssembly",14:"BottomAssembly",15:"Mechanical",16:"TopComponents",17:"BottomComponents",18:"Substrate",19:"3DModel",99:"ComponentShapeLayer",100:"LeadShapeLayer"},t;for(t=21;t<53;t++)e[t]="Inner"+(t-20);for(t=53;t<85;t++)e[t]="Substrate"+(t-52);return e})(),Tae=(function(){var e=[],t=[];for(var i in $i)if($i.hasOwnProperty(i)){if(i.match(/^BOARD\d+/))continue;e.push($i[i])}e.sort(),t.sort();var r={},s,n={21:"#999966",22:"#008000",23:"#00FF00",24:"#BC8E00",25:"#70DBFA",26:"#00CC66",27:"#9966FF",28:"#800080",29:"#008080",30:"#15935F",31:"#000080",32:"#00B400",33:"#2E4756",34:"#99842F",35:"#FFFFAA",36:"#99842F",37:"#2E4756",38:"#3535FF",39:"#8000BC",40:"#43AE5F",41:"#C3ECCE",42:"#728978",43:"#39503F",44:"#0C715D",45:"#5A8A80",46:"#2B937E",47:"#23999D",48:"#45B4E3",49:"#215DA1",50:"#4564D7",51:"#6969E9",52:"#9069E9"};e.forEach(function(o){switch(o){case $i.TOPLAYER:s={name:Br[o],color:"#FF0000",darkColor:"#CC0000",visible:!0,active:!0,config:!0};break;case $i.BOTTOMLAYER:s={name:Br[o],color:"#0000FF",darkColor:"#000080",visible:!0,active:!1,config:!0};break;case $i.TOPSILKLAYER:s={name:Br[o],color:"#FFCC00",darkColor:"#806600",visible:!0,active:!1,config:!0};break;case $i.BOTTOMSILKLAYER:s={name:Br[o],color:"#66CC33",darkColor:"#33661A",visible:!0,active:!1,config:!0};break;case $i.TOPPASTERLAYER:s={name:Br[o],color:"#808080",darkColor:"#666666",visible:!0,active:!1,config:!0};break;case $i.BOTTOMPASTERLAYER:s={name:Br[o],color:"#800000",darkColor:"#660000",visible:!0,active:!1,config:!0};break;case $i.TOPSOLDERLAYER:s={name:Br[o],color:"#800080",darkColor:"#660066",visible:!0,active:!1,transparency:.3,config:!0};break;case $i.BOTTOMSOLDERLAYER:s={name:Br[o],color:"#AA00FF",darkColor:"#8800CC",visible:!0,active:!1,transparency:.3,config:!0};break;case $i.RATLINES:s={name:Br[o],color:"#6464FF",darkColor:"#5050CC",visible:!1,active:!1,config:!0};break;case $i.BOARDOUTLINE:s={name:Br[o],color:"#FF00FF",darkColor:"#CC00CC",visible:!0,active:!1,config:!0};break;case $i.ALL:s={name:Br[o],color:"#C0C0C0",darkColor:"#999999",visible:!0,active:!1,config:!0};break;case $i.DOCUMENT:s={name:Br[o],color:"#FFFFFF",darkColor:"#CCCCCC",visible:!0,active:!1,config:!0};break;case $i.TOPASSEMBLY:s={name:Br[o],color:"#33CC99",darkColor:"#33AA99",visible:!1,active:!1,config:!1};break;case $i.BOTTOMASSEMBLY:s={name:Br[o],color:"#5555FF",darkColor:"#8888FF",visible:!1,active:!1,config:!1};break;case $i.MECHANICAL:s={name:Br[o],color:"#F022F0",darkColor:"#F088F0",visible:!1,active:!1,config:!1};break;case $i.MODEL3D:s={name:Br[o],color:"#66CCFF",visible:!1,active:!1,config:!1};break;case $i.LIBBODY:s={name:Br[o],color:"#00CCCC",visible:!1,active:!1,config:!1};break;case $i.PADSURFACE:s={name:Br[o],color:"#CC9999",visible:!1,active:!1,config:!1};break;default:o>=$i.INNER1&&o<=$i.INNER32?s={name:Br[o],color:n[o],darkColor:a(n[o]),visible:!1,active:!1,config:!1}:s=null;break}s&&(r[o]=s)}),r.Hole={config:!0,name:"Hole",darkColor:"#222222",color:"#222222"},r.DRCError={config:!0,name:"DRCError",color:"#FAD609",darkColor:"#FAD609"};function a(o){if(typeof o!="string"||!o.match(/#?([\da-f]{6})/i))return o;var l=parseInt(RegExp.$1,16),h=.5,c=Math.min(255,Math.round((l>>16)*h)),f=Math.min(255,Math.round((l>>8&255)*h)),d=Math.min(255,Math.round((l&255)*h)),u=((c<<16)+(f<<8)+d).toString(16);return"#"+("00000"+u).substr(-6).toUpperCase()}return r})(),sI={BLANK:0,SCH:1,PART:2,PCB:3,FOOTPRINT:4,PRJ:5,SUBPART:6,SPICESYMBOL:7,SUBCKT:8,NETLIST:9,WAVEFORM:10,SCHLIB3D:11,PHOTOVIEW:12,SCHMODULE:13,PCBMODULE:14,VIEW3D:15,PCBLIB3D:16,BLOCK_SYMBOL:17,NETFLAG:18,NETPORT:19,SHEET_SYMBOL:20,NONEELEC_SYMBOL:21,SHORT_SYMBOL:22,FOOTPRINTVIEW:23,CNCPRINTVIEW:24,PCB2D:31,PCB3D:32},wae=(function(){var e={};for(let t in sI)e[sI[t]]=t;return e})();var nO=Math.PI*2,Jg=Math.PI/2,Sae=Math.sin(Math.PI/180);function vY(e,t,i){if(typeof e!="number"&&(e=+e),isNaN(e))return NaN;if(t=t|0,t<=0||!e&&!i)return Math.round(e);var r=xY[t]||Math.pow(10,t)||10;if(i){var s=e<0?"-":"";for(e=e<0?-e:e,e=Math.round(e*r)+"";e.length<=t;)e="0"+e;return e=e.slice(0,-t)+"."+e.slice(-t),parseFloat(s+e)}else return Math.round(e*r+1e-10)/r}function MI(e,t,i){var r=e-t;return i||(i=1e-10),(r>0?r:-r)<i}function EY(e,t,i){var r=c(e)&&c(t)&&c(i);if(!r)return console.warn("Bad arguments"),null;var s=t.x-i.x>0?t.x:i.x,n=t.y-i.y>0?t.y:i.y,a=t.x-i.x>0?i.x:t.x,o=t.y-i.y>0?i.y:t.y,l=e.x,h=e.y;return l<=s+.001&&l>=a-.001&&h<=n+.001&&h>=o-.001;function c(f){return f?(f.x=Number(f.x),f.y=Number(f.y),isNaN(f.x)||isNaN(f.y)?(console.warn("Can not convert to Number, NaN found"),!1):!0):(console.warn("Empty input!"),!1)}}function TY(e,t,i,r,s,n){var a=(s-i)*(e-i)+(n-r)*(t-r),o=(s-i)*(s-i)+(n-r)*(n-r),l=a/o,h=i+(s-i)*l,c=r+(n-r)*l;return a<=0?Math.sqrt((e-i)*(e-i)+(t-r)*(t-r)):a>=o?Math.sqrt((e-s)*(e-s)+(t-n)*(t-n)):Math.sqrt((e-h)*(e-h)+(c-t)*(c-t))}function wY(e,t,i){return EY(e,t,i)?MI((e.x-t.x)*(i.y-t.y),(i.x-t.x)*(e.y-t.y),.001):!1}var Zd=1e-4,ie=new Float64Array(100);function bn(e,t){if(e instanceof ce&&t instanceof ce)return Sa(e,t);if(e instanceof xe&&t instanceof ce)return my(e,t);if(e instanceof ce&&t instanceof xe)return my(t,e);if(e instanceof xe&&t instanceof xe)return kI(e,t);if(e instanceof Fe&&t instanceof Fe)return Gg(e,t);if(e instanceof Fe&&t instanceof ce)return Gg(e,new Fe([t.start(),t.end()]));if(e instanceof ce&&t instanceof Fe)return Gg(new Fe([e.start(),e.end()]),t);if(e instanceof Fe&&t instanceof xe)return uI(t,e);if(e instanceof xe&&t instanceof Fe)return uI(e,t);throw new Error("not supported operation")}function SY(e,t){let i=e.bbox();if(i.isContainsY1(t)){let r=new ce(new ge(i.minX-1,t),new ge(i.maxX+1,t));return Sa(r,e)>0?1:0}else return 0}function IY(e,t){if(e.rx===e.ry){let i=e.bbox();if(i.isContainsY1(t)){let r=new ce(new ge(i.minX-1,t),new ge(i.maxX+1,t));return Zg(e,r)>0?1:0}else return 0}else throw new Error("not supported operation")}function nI(e,t){let i=e.bbox();return i.isContainsY1(t)&&Gg(new Fe([new ge(i.minX-1,t),new ge(i.maxX+1,t)]),e)>0?1:0}function aI(e,t,i){return isFinite(t)&&isFinite(i)?e.isContains2(t,i):!1}function PY(e,t){let i=t.length(),r=Bi.crossProd3(t.start(),t.end(),e.start())/i,s=Bi.crossProd3(t.start(),t.end(),e.end())/i;return Math.abs(r)<1e-8||Math.abs(s)<1e-8||r*s<0}function Sa(e,t){let i=e.bbox().intersection1(t.bbox());if(!i)return 0;if(e.isPoint())if(t.isPoint()){let r=i.center();return ie[0]=r.x,ie[1]=r.y,2}else return oI(t,e,i);else{if(t.isPoint())return oI(e,t,i);{let r=function(O,y){i.isContains2(O,y)&&(ie[m++]=O,ie[m++]=y)};if(!PY(e,t))return 0;let s=e.start().x,n=e.start().y,a=e.end().x,o=e.end().y,l=t.start().x,h=t.start().y,c=t.end().x,f=t.end().y,d=t.length(),u=Bi.crossProd2(s,n,l,h,c,f)/d,p=Bi.crossProd2(a,o,l,h,c,f)/d;if(u*p>0&&!we.eq(u,0)&&!we.eq(p,0))return 0;let _=e.length(),g=Bi.crossProd2(l,h,s,n,a,o)/_,b=Bi.crossProd2(c,f,s,n,a,o)/_;if(g*b>0&&!we.eq(g,0)&&!we.eq(b,0))return 0;let m=0;if(we.eq(u,0)&&we.eq(p,0)){let O=i.UL(),y=i.UR(),x=i.LL(),E=i.LR();if(we.eq(i.width(),0))we.eq(i.height(),0)?(ie[m++]=O.x,ie[m++]=O.y):(ie[m++]=O.x,ie[m++]=O.y,ie[m++]=x.x,ie[m++]=x.y);else if(we.eq(i.height(),0))ie[m++]=O.x,ie[m++]=O.y,ie[m++]=y.x,ie[m++]=y.y;else{let w=Oy.area2(O.x,O.y,l,h,c,f),S=Oy.area2(y.x,y.y,l,h,c,f);w<S?(ie[m++]=O.x,ie[m++]=O.y,ie[m++]=E.x,ie[m++]=E.y):(ie[m++]=y.x,ie[m++]=y.y,ie[m++]=x.x,ie[m++]=x.y)}}else if(we.eq(u,0))r(s,n);else if(we.eq(p,0))r(a,o);else{let O=Math.abs(u/(u-p));r(s+(a-s)*O,n+(o-n)*O)}return m}}}function oI(e,t,i){let r=t.start(),s=t.end(),n=Bi.crossProd3(e.start(),e.end(),t.start()),a=Bi.crossProd3(e.start(),e.end(),t.end());if(n*a<0){let o=i.center();return ie[0]=o.x,ie[1]=o.y,2}else if(Math.abs(n)<Math.abs(a)){if(we.eq(n/e.length(),0))return ie[0]=r.x,ie[1]=r.y,2}else if(we.eq(a/e.length(),0))return ie[0]=s.x,ie[1]=s.y,2;return 0}function Zg(e,t){let i=e.bbox().intersection1(t.bbox());if(i!=null){i=i.extendOfSize(Zd);let r=e.center.x,s=e.center.y,n=e.rx,a=e.rx2,o=t.start().x,l=t.start().y,h=t.end().x,c=t.end().y,f=e.center.distance1(t.start()),d=e.center.distance1(t.end()),u=we.eq(f,n)?0:f>n?1:-1,p=we.eq(d,n)?0:d>n?1:-1,_=0;if(u===-1&&p===-1)return 0;if(u===0&&p===0)ie[_++]=o,ie[_++]=l,ie[_++]=h,ie[_++]=c;else if(u===1&&p===1){let g=Jn.foot(t,e.center),b=g.distance1(e.center);if(we.greater(b,n))return 0;if(we.eq(b,n))we.eq(t.distance2(e.start()),0)?(ie[_++]=e.start().x,ie[_++]=e.start().y,ie[_++]=e.start().x,ie[_++]=e.start().y):we.eq(t.distance2(e.end()),0)?(ie[_++]=e.end().x,ie[_++]=e.end().y,ie[_++]=e.end().x,ie[_++]=e.end().y):(ie[_++]=g.x,ie[_++]=g.y,ie[_++]=g.x,ie[_++]=g.y);else{_=BI(r,s,o,l,h,c,_,g);let m=ie[_-2],O=ie[_-1];_-=2;let y=Bi.distance1(r,s,m,O);if(we.eq(y,n))ie[_++]=m,ie[_++]=O,ie[_++]=m,ie[_++]=O;else if(y<n)_=Xr(a,r,s,o,l,m,O,_),_=Xr(a,r,s,m,O,h,c,_);else return 0}}else if(u===-1||p===-1)_=Xr(a,r,s,o,l,h,c,_);else{let g=Jn.foot(t,e.center),b=g.distance1(e.center);if(we.eq(b,n)){let m=function(x){return aI(i,x.x,x.y)&&Vi(e,x)},O=e.start(),y=e.end();if(u===0){let x=t.start();if(m(x))return ie[_++]=x.x,ie[_++]=x.y,ie[_++]=x.x,ie[_++]=x.y,_;if(m(g))return ie[_++]=g.x,ie[_++]=g.y,ie[_++]=g.x,ie[_++]=g.y,_;if(we.eq(t.distance2(O),0)&&m(O))return ie[_++]=O.x,ie[_++]=O.y,ie[_++]=O.x,ie[_++]=O.y,_;if(we.eq(t.distance2(y),0)&&m(y))return ie[_++]=y.x,ie[_++]=y.y,ie[_++]=y.x,ie[_++]=y.y,_;if(f<=n)_=Xr(a,r,s,g.x,g.y,h,c,_),_===2&&(ie[_++]=ie[0],ie[_++]=ie[1]);else if(b<n){if(_=Xr(a,r,s,g.x,g.y,h,c,_),_===2&&m(new ge(ie[0],ie[1])))return ie[_++]=ie[0],ie[_++]=ie[1],_;_=Xr(a,r,s,g.x,g.y,o,l,0),_===2&&(ie[_++]=ie[0],ie[_++]=ie[1])}}else{let x=t.end();if(m(x))return ie[_++]=x.x,ie[_++]=x.y,ie[_++]=x.x,ie[_++]=x.y,_;if(m(g))return ie[_++]=g.x,ie[_++]=g.y,ie[_++]=g.x,ie[_++]=g.y,_;if(we.eq(t.distance2(O),0)&&m(O))return ie[_++]=O.x,ie[_++]=O.y,ie[_++]=O.x,ie[_++]=O.y,_;if(we.eq(t.distance2(y),0)&&m(y))return ie[_++]=y.x,ie[_++]=y.y,ie[_++]=y.x,ie[_++]=y.y,_;if(d<=n)_=Xr(a,r,s,g.x,g.y,o,l,_),_===2&&(ie[_++]=ie[0],ie[_++]=ie[1]);else if(b<n){if(_=Xr(a,r,s,g.x,g.y,o,l,_),_===2&&m(new ge(ie[0],ie[1])))return ie[_++]=ie[0],ie[_++]=ie[1],_;_=Xr(a,r,s,g.x,g.y,h,c,0),_===2&&(ie[_++]=ie[0],ie[_++]=ie[1])}}}else if(u===0){let m=t.start();ie[_++]=m.x,ie[_++]=m.y,(o-g.x)*(h-g.x)+(l-g.y)*(c-g.y)<0&&(_=Xr(a,r,s,g.x,g.y,h,c,_))}else{let m=t.end();ie[_++]=m.x,ie[_++]=m.y,(o-g.x)*(h-g.x)+(l-g.y)*(c-g.y)<0&&(_=Xr(a,r,s,g.x,g.y,o,l,_))}}if(_>0){let g=0;for(let b=0;b<_;b+=2){let m=ie[b],O=ie[b+1];isFinite(m)&&isFinite(O)&&aI(i,m,O)&&Vi(e,new ge(m,O))&&(ie[g++]=m,ie[g++]=O)}return g}else return 0}else return 0}function AY(e,t){if(e.bbox()){let i=e.center.x,r=e.center.y,s=e.rx2,n=t.start().x,a=t.start().y,o=t.end().x,l=t.end().y,h=e.center.distance2(t.start()),c=e.center.distance2(t.end()),f=we.eq(h,s)?0:h>s?1:-1,d=we.eq(c,s)?0:c>s?1:-1,u=0;if(f===-1&&d===-1)return 0;if(f===0&&d===0)ie[u++]=n,ie[u++]=a,ie[u++]=o,ie[u++]=l;else if(f===1&&d===1){let p=Jn.foot(t,e.center),_=p.distance2(e.center);if(we.greater(_,s))return 0;if(we.eq(_,s)){let g=p.distance2(e.start()),b=p.distance2(e.end());we.eq(g,0)?(ie[u++]=e.start().x,ie[u++]=e.start().y):we.eq(b,0)?(ie[u++]=e.end().x,ie[u++]=e.end().y):(ie[u++]=p.x,ie[u++]=p.y)}else{u=BI(i,r,n,a,o,l,u,p);let g=ie[u-2],b=ie[u-1],m=Bi.distance2(i,r,g,b);if(u-=2,we.eq(m,s))ie[u++]=g,ie[u++]=b;else if(m<s)u=Xr(s,i,r,n,a,g,b,u),u=Xr(s,i,r,g,b,o,l,u);else return 0}}else if(f===-1||d===-1)u=Xr(s,i,r,n,a,o,l,u);else{let p=Jn.foot(t,e.center);f===0?(ie[u++]=t.start().x,ie[u++]=t.start().y,we.neq(p.distance2(t.start()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(u=Xr(s,i,r,p.x,p.y,o,l,u))):(ie[u++]=t.end().x,ie[u++]=t.end().y,we.neq(p.distance2(t.end()),0)&&(n-p.x)*(o-p.x)+(a-p.y)*(l-p.y)<0&&(u=Xr(s,i,r,p.x,p.y,n,a,u)))}if(u>0){let p=0;for(let _=0;_<u;_+=2){let g=ie[_],b=ie[_+1];isFinite(g)&&isFinite(b)&&(ie[p++]=g,ie[p++]=b)}return p}else return 0}else return 0}function Xr(e,t,i,r,s,n,a,o){if(s==a){let O=e-(s-i)*(s-i);if(we.greater(O,0)){let y=Math.sqrt(O),x=t-y,E=t+y,w=Math.min(r,n),S=Math.max(r,n);return x>=w&&x<=S&&(ie[o++]=x,ie[o++]=s),E>=w&&E<=S&&(ie[o++]=E,ie[o++]=s),o}}let l=Bi.distance2(r,s,t,i)-e;if(l===0)return ie[o++]=r,ie[o++]=s,o;let h=Bi.distance2(n,a,t,i)-e;if(h===0)return ie[o++]=n,ie[o++]=a,o;let c=r,f=s,d=n,u=a,p=NaN,_=NaN,g=Number.POSITIVE_INFINITY,b=0;for(;g!==0;){b++;let O=Math.max(Math.min(Math.abs(l)/(Math.abs(l)+Math.abs(h)),.75),.25);if(p=c+(d-c)*O,_=f+(u-f)*O,c===p&&f===_||d===p&&u===_){Math.abs(l)>Math.abs(h)?(p=d,_=u,g=h):(p=c,_=f,g=l);break}else g=Bi.distance2(p,_,t,i)-e,g<0&&l>h||g>0&&l<h?(d=p,u=_,h=g):(c=p,f=_,l=g)}let m=Math.sqrt(e)-Bi.distance1(p,_,t,i);return(we.eq(0,g)||we.eq(0,m))&&(ie[o++]=p,ie[o++]=_),o}function BI(e,t,i,r,s,n,a,o){let l=Bi.dotProd2(i,r,s,n,e,t),h=Bi.dotProd2(s,n,i,r,e,t);if(l>=0)return ie[a++]=s,ie[a++]=n,a;if(h>=0)return ie[a++]=i,ie[a++]=r,a;if(Bi.crossProd2(i,r,s,n,e,t)==0)return ie[a++]=e,ie[a++]=t,a;{let c=NaN,f=NaN,d=i,u=r,p=s,_=n,g=Bi.distance2(i,r,e,t),b=Bi.distance2(s,n,e,t),m=Number.POSITIVE_INFINITY,O=0;for(;m>0&&(O++,c=d+(p-d)*.5,f=u+(_-u)*.5,!(g==b||d==c&&u==f||p==c&&_==f));){m=Bi.distance2(c,f,e,t);let y=Bi.dotProd2(d,u,c,f,e,t);if(y==0)break;y<0?(p=c,_=f,b=m):(d=c,u=f,g=m)}return Bi.distance2(c,f,e,t)<Bi.distance2(o.x,o.y,e,t)?(ie[a++]=c,ie[a++]=f):(ie[a++]=o.x,ie[a++]=o.y),a}}function my(e,t){if(e.rx===e.ry)return Zg(e,t);throw new Error("not supported")}function CY(e,t){if(e.rx===e.ry)return AY(e,t);throw new Error("not supported")}function kI(e,t){if(e.bbox().intersection1(t.bbox())!=null){if(e.rx===e.ry&&t.rx===t.ry)return NY(e,t);throw new Error("not supported operation")}return 0}function NY(e,t){let i=e.center.x,r=e.center.y,s=t.center.x,n=t.center.y,a=e.rx,o=t.rx,l=e.rx2,h=t.rx2,c=e.center.distance1(t.center),f=Math.abs(a-o),d=a+o;if(we.greater(c,d)||we.less(c,f))return 0;if(we.eq(f+c,0)){let u=0,p;return Vi(e,t.start())&&(ie[u]=t.start().x,ie[u+1]=t.start().y,u+=2,p=t.start()),Vi(e,t.end())&&(ie[u]=t.end().x,ie[u+1]=t.end().y,u+=2,p=t.end()),u===0?(Vi(t,e.start())&&(ie[u]=e.start().x,ie[u+1]=e.start().y,u+=2),Vi(t,e.end())&&(ie[u]=e.end().x,ie[u+1]=e.end().y,u+=2)):u===2&&(!p.equals1(e.start())&&Vi(t,e.start())&&(ie[u]=e.start().x,ie[u+1]=e.start().y,u+=2),!p.equals1(e.end())&&Vi(t,e.end())&&(ie[u]=e.end().x,ie[u+1]=e.end().y,u+=2)),u}else if(we.eq(c,d)){if(lI(e,t))return 4;let u=new ce(e.center,t.center),p=Zg(t,u);return p=hI(e,p),p!==0?p:(p=Zg(e,u),hI(t,p))}else if(we.eq(c,f)){if(lI(e,t))return 4;if(a>o){let u=(a-o)/a;return ie[0]=i+(s-i)/u,ie[1]=r+(n-r)/u,cI(e,t,2)}else{let u=(o-a)/o;return ie[0]=s+(i-s)/u,ie[1]=n+(r-n)/u,cI(e,t,2)}}else{let u=(e.center.distance2(t.center)-h+l)/(c*2)/c,p=(s-i)*u+i,_=(n-r)*u+r,g=s-i,b=n-r,m=Math.max(a,o),O,y,x,E;if(Math.abs(g)<Math.abs(b)){let R=g/-b,B=_-R*p;O=p-m,y=R*O+B,x=p+m,E=R*x+B}else{let R=b/-g,B=p-R*_;y=_-m,O=R*y+B,E=_+m,x=R*E+B}let w=Xr(l,i,r,O,y,p,_,0);if(w=Xr(l,i,r,p,_,x,E,w),w!==4)throw new Error("cnt !== 4");let S=new ge(ie[0],ie[1]),C=new ge(ie[2],ie[3]);if(Vi(e,S)&&Vi(t,S))return Vi(e,C)&&Vi(t,C)?4:ll(e.start(),t,C,S)?(ie[2]=e.start().x,ie[3]=e.start().y,4):ll(e.end(),t,C,S)?(ie[2]=e.end().x,ie[3]=e.end().y,4):ll(t.start(),e,C,S)?(ie[2]=t.start().x,ie[3]=t.start().y,4):ll(t.end(),e,C,S)?(ie[2]=t.end().x,ie[3]=t.end().y,4):2;if(Vi(e,C)&&Vi(t,C))return ll(e.start(),t,S,C)?(ie[0]=e.start().x,ie[1]=e.start().y,4):ll(e.end(),t,S,C)?(ie[0]=e.end().x,ie[1]=e.end().y,4):ll(t.start(),e,S,C)?(ie[0]=t.start().x,ie[1]=t.start().y,4):ll(t.end(),e,S,C)?(ie[0]=t.end().x,ie[1]=t.end().y,4):(ie[0]=ie[2],ie[1]=ie[3],2);{let R=function(z,q){if(we.eq(z.distance1(q.center),q.rx)&&Vi(q,z)){if(z.distance2(S)<z.distance2(C)){if(B)return;B=!0}else{if(Y)return;Y=!0}ie[G++]=z.x,ie[G++]=z.y}},B=!1,Y=!1,G=0;return R(e.start(),t),R(e.end(),t),R(t.start(),e),R(t.end(),e),G}}}function ll(e,t,i,r){return we.eq(e.distance1(t.center),t.rx)&&Vi(t,e)&&e.distance2(i)<e.distance2(r)}function lI(e,t){return we.eq(t.start().distance1(e.center),e.rx)&&Vi(e,t.start())?(ie[0]=t.start().x,ie[1]=t.start().y,ie[2]=t.start().x,ie[3]=t.start().y,!0):we.eq(t.end().distance1(e.center),e.rx)&&Vi(e,t.end())?(ie[0]=t.end().x,ie[1]=t.end().y,ie[2]=t.end().x,ie[3]=t.end().y,!0):we.eq(e.start().distance1(t.center),t.rx)&&Vi(t,e.start())?(ie[0]=e.start().x,ie[1]=e.start().y,ie[2]=e.start().x,ie[3]=e.start().y,!0):we.eq(e.end().distance1(t.center),t.rx)&&Vi(t,e.end())?(ie[0]=e.end().x,ie[1]=e.end().y,ie[2]=e.end().x,ie[3]=e.end().y,!0):!1}function hI(e,t){if(t===0)return 0;let i=ie[0],r=ie[1];return Vi(e,new ge(i,r))?(ie[0]=i,ie[1]=r,ie[2]=i,ie[3]=r,4):0}function cI(e,t,i){if(i===0)return 0;let r=ie[0],s=ie[1],n=new ge(r,s);return Vi(e,n)&&Vi(t,n)?(ie[0]=r,ie[1]=s,ie[2]=r,ie[3]=s,4):0}function Gc(e,t){return Math.abs(e-t)<=1e-6}function Vi(e,t){let i=e.bbox();if(t.x-i.minX>-Zd&&t.x-i.maxX<Zd&&t.y-i.minY>-Zd&&t.y-i.maxY<Zd){let r=ht.regularD(t.angleD(e.center));return Gc(r,e.startAngle)||Gc(r,e.startAngle+360)||Gc(r,e.startAngle-360)||Gc(r,e.endAngle())||Gc(r,e.endAngle()+360)||Gc(r,e.endAngle()-360)?!0:e.sweepAngle>0?(we.less(r,e.startAngle)&&(r+=360),we.greatereq(e.endAngle(),r)):(we.greater(r,e.startAngle)&&(r-=360),we.lesseq(e.endAngle(),r))}else return!1}function LY(e,t){let i=e[1].x-e[0].x,r=e[1].y-e[0].y,s=t[1].x-t[0].x,n=t[1].y-t[0].y;if(i===0&&s!==0||i!==0&&s===0)return!1;if(i===0&&s===0)return!0;let a=r/i,o=n/s;return MI(a,o,Math.sin(Math.PI/180))}function RY(e,t,i){var r,s=+t.x,n=+t.y,a=+i.x,o=+i.y,l=+e.x,h=+e.y,c=a-s,f=o-n,d=l-s,u=h-n,p,_,g,b,m,O;return c===0&&f===0?{d:Math.sqrt(d*d+u*u),point:new ge(s,n)}:(r=(d*c+u*f)/(c*c+f*f),r<0?{d:Math.sqrt(d*d+u*u),point:new ge(s,n)}:r>1?(p=l-a,_=h-o,{d:Math.sqrt(p*p+_*_),point:new ge(a,o)}):(m=s+r*c,O=n+r*f,g=l-m,b=h-O,{d:Math.sqrt(g*g+b*b),point:new ge(m,O)}))}function Wn(e,t){if(!e||!t||e.length!=t.length)return!1;let i="equals1";return!e.some((r,s)=>{let n=t[s],a=!1;return r&&n&&typeof r=="object"&&typeof n=="object"?typeof r[i]=="function"&&MY(r,n)?a=!r[i].call(r,n):a=!(r===n||r.toString()===n.toString()):typeof r=="number"&&typeof n=="number"?a=!(DY(r,n)||Number.isNaN(r)&&Number.isNaN(n)):a=r!==n,a})}function DY(e,t,i=5){return Math.abs(e-t)*Math.pow(10,i)<1}function MY(e,t){return!e||!t||typeof e!="object"||typeof t!="object"?e===t:e.constructor===t.constructor}var Ot=new Float64Array(100);function Gg(e,t){if(e.bbox().extendOfSize(we.eps).isSeparated(t.bbox()))return 0;let i=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,s=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(L){B=Math.min(B,L),Y=Math.max(Y,L)},o=function(L,M){let v=Sa(L,M);if(v===0)throw new Error("cnt === 0");for(let P=0;P<v;P+=2)a(ie[P])};if(s>r){for(let L=s-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(we.eq(Ot[L],Ot[M])&&we.eq(Ot[L+1],Ot[M+1])){Ot[M]=(Ot[L]+Ot[M])/2,Ot[M+1]=(Ot[L+1]+Ot[M+1])/2;for(let v=s-3;v>=L;v--)Ot[v]=Ot[v+2];s-=2;break}if(s>r){s=0;let L=t.start(),M=new Float64Array(8);e.getPercent(L)!==null&&(M[s++]=L.x,M[s++]=L.y);let v=t.end();e.getPercent(v)!==null&&(M[s++]=v.x,M[s++]=v.y);let P=e.start();t.getPercent(P)!==null&&(M[s++]=P.x,M[s++]=P.y);let I=e.end();return t.getPercent(I)!==null&&(M[s++]=I.x,M[s++]=I.y),ie.set(M),s}}let[l,h]=i.pop(),c=l.controls,f=h.controls;if(c.length===2&&f.length===2){let L=Sa(new ce(c[0],c[1]),new ce(f[0],f[1]));for(let M=0;M<L;M++)Ot[s++]=ie[M];continue}let d=c[0],u=c[c.length-1];d.equals1(u)&&(u=d.add1(1,0));let p=u.y-d.y,_=d.x-u.x,g=-p*d.x-_*d.y,b=Math.sqrt(1/(p**2+_**2));p*=b,_*=b,g*=b;let m=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY;if(c.forEach(L=>{let M=p*L.x+_*L.y+g;M<m&&(m=M),M>O&&(O=M)}),we.eq(m,O)){if(h.controls.length===2){let L=Sa(new ce(l.start(),l.end()),new ce(h.start(),h.end()));for(let M=0;M<L;M++)Ot[s++]=ie[M];if(L!==0)continue}l=new Fe([c[0],c[c.length-1]]),c=l.controls}let y=f.map(L=>{let M=p*L.x+_*L.y+g,v=Math.abs(M);return v<n&&(n=v),M}),x=0;for(let L of y){if(we.less(L,m))x=x|1;else if(we.greater(L,O))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let E=0,w=0,S=u.x-d.x,C=u.y-d.y,R=Math.sqrt(1/(S**2+C**2));S*=R,C*=R;for(let L=1;L<c.length;L++){let M=c[L],v=(M.x-d.x)*S+(M.y-d.y)*C;v<E?E=v:v>w&&(w=v)}x=0;for(let L of f){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(we.less(M,E))x=x|1;else if(we.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let B=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;n/=2,n<=we.eps&&(n=we.eps),m-=n,O+=n,y.forEach((L,M)=>{L>=m&&L<=O&&a(M/(y.length-1))});let G=new ce(new ge(0,m),new ge(1,m)),z=new ce(new ge(0,O),new ge(1,O));for(let L=0;L<y.length-1;L++){let M=new ge(L/(y.length-1),y[L]),v=M.y<m?1:M.y>O?2:3;for(let P=0;P<y.length;P++){let I=new ge(P/(y.length-1),y[P]),N=I.y<m?1:I.y>O?2:3;v!==N&&(v===1?N===2?(o(new ce(M,I),G),o(new ce(M,I),z)):o(new ce(M,I),G):v===2?N===1?(o(new ce(M,I),G),o(new ce(M,I),z)):o(new ce(M,I),z):N===1?o(new ce(M,I),G):o(new ce(M,I),z))}}B!==0&&(h=h.clip(B)[1]),Y!==1&&(h=h.clip((Y-B)/(1-B))[0]);let q=h.bbox();if(we.eq(q.minX,q.maxX)&&we.eq(q.minY,q.maxY)){x=0;for(let L of h.controls){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(we.less(M,E))x=x|1;else if(we.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x===3){let L=new ge((q.minX+q.maxX)/2,(q.minY+q.maxY)/2);l.getPercent(L)&&(Ot[s++]=L.x,Ot[s++]=L.y)}continue}if(Y-B>.8){let[L,M]=h.clip(.5);i.push([L,l]),i.push([M,l])}else i.push([h,l])}for(let a=0;a<s;a++)ie[a]=Ot[a];return s}function BY(e,t){if(e.bbox().extendOfSize(we.eps).isSeparated(t.bbox()))return{cnt:0};let i=[[e,t]],r=(e.controls.length-1)*(t.controls.length-1)*8,s=0,n=Number.POSITIVE_INFINITY;for(;i.length!==0;){let a=function(L){B=Math.min(B,L),Y=Math.max(Y,L)},o=function(L,M){let v=Sa(L,M);if(v===0)throw new Error("cnt === 0");for(let P=0;P<v;P+=2)a(ie[P])};if(s>r){for(let L=s-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(we.eq(Ot[L],Ot[M])&&we.eq(Ot[L+1],Ot[M+1])){Ot[M]=(Ot[L]+Ot[M])/2,Ot[M+1]=(Ot[L+1]+Ot[M+1])/2;for(let v=s-3;v>=L;v--)Ot[v]=Ot[v+2];s-=2;break}if(s>r){s=0;let L=new Float64Array(8),M=t.end(),v=0;e.getPercent(M)!==null&&(L[s++]=M.x,L[s++]=M.y,v=2);let P=e.end();return t.getPercent(P)!==null&&(L[s++]=P.x,L[s++]=P.y,v=v===0?1:3),ie.set(L),{havOverlap:v,cnt:s}}}let[l,h]=i.pop(),c=l.controls,f=h.controls;if(c.length===2&&f.length===2){let L=Sa(new ce(c[0],c[1]),new ce(f[0],f[1]));for(let M=0;M<L;M++)Ot[s++]=ie[M];continue}let d=c[0],u=c[c.length-1];d.equals1(u)&&(u=d.add1(1,0));let p=u.y-d.y,_=d.x-u.x,g=-p*d.x-_*d.y,b=Math.sqrt(1/(p**2+_**2));p*=b,_*=b,g*=b;let m=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY;if(c.forEach(L=>{let M=p*L.x+_*L.y+g;M<m&&(m=M),M>O&&(O=M)}),we.eq(m,O)){if(h.controls.length===2){let L=Sa(new ce(l.start(),l.end()),new ce(h.start(),h.end()));for(let M=0;M<L;M++)Ot[s++]=ie[M];if(L!==0)continue}l=new Fe([c[0],c[c.length-1]]),c=l.controls}let y=f.map(L=>{let M=p*L.x+_*L.y+g,v=Math.abs(M);return v<n&&(n=v),M}),x=0;for(let L of y){if(we.less(L,m))x=x|1;else if(we.greater(L,O))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let E=0,w=0,S=u.x-d.x,C=u.y-d.y,R=Math.sqrt(1/(S**2+C**2));S*=R,C*=R;for(let L=1;L<c.length;L++){let M=c[L],v=(M.x-d.x)*S+(M.y-d.y)*C;v<E?E=v:v>w&&(w=v)}x=0;for(let L of f){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(we.less(M,E))x=x|1;else if(we.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x!==3)continue;let B=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;n/=2,n<=we.eps&&(n=we.eps),m-=n,O+=n,y.forEach((L,M)=>{L>=m&&L<=O&&a(M/(y.length-1))});let G=new ce(new ge(0,m),new ge(1,m)),z=new ce(new ge(0,O),new ge(1,O));for(let L=0;L<y.length-1;L++){let M=new ge(L/(y.length-1),y[L]),v=M.y<m?1:M.y>O?2:3;for(let P=0;P<y.length;P++){let I=new ge(P/(y.length-1),y[P]),N=I.y<m?1:I.y>O?2:3;v!==N&&(v===1?N===2?(o(new ce(M,I),G),o(new ce(M,I),z)):o(new ce(M,I),G):v===2?N===1?(o(new ce(M,I),G),o(new ce(M,I),z)):o(new ce(M,I),z):N===1?o(new ce(M,I),G):o(new ce(M,I),z))}}B!==0&&(h=h.clip(B)[1]),Y!==1&&(h=h.clip((Y-B)/(1-B))[0]);let q=h.bbox();if(we.eq(q.minX,q.maxX)&&we.eq(q.minY,q.maxY)){x=0;for(let L of h.controls){let M=(L.x-d.x)*S+(L.y-d.y)*C;if(we.less(M,E))x=x|1;else if(we.greater(M,w))x=x|2;else{x=3;break}if(x===3)break}if(x===3){let L=new ge((q.minX+q.maxX)/2,(q.minY+q.maxY)/2);l.getPercent(L)&&(Ot[s++]=L.x,Ot[s++]=L.y)}continue}if(Y-B>.8){let[L,M]=h.clip(.5);i.push([L,l]),i.push([M,l])}else i.push([h,l])}for(let a=0;a<s;a++)ie[a]=Ot[a];return{cnt:s}}var kY=class{constructor(e=we.eps){this.eps=e}eq(e,t){return Math.abs(e-t)<=this.eps}setEps(e){this.eps=e}},Vd=new kY;function uI(e,t){if(e.bbox().extendOfSize(we.eps).isSeparated(t.bbox()))return 0;let i=[[e,t]],r=(t.controls.length-1)*16,s=0;for(;i.length!==0;){if(s>r){let a=function(){for(let h=0;h<s;h+=2)for(let c=h+2;c<s;c+=2)if(!(Vd.eq(Ot[h],Ot[c])&&Vd.eq(Ot[h+1],Ot[c+1]))){l(Ot[c],Ot[c+1],o);break}function l(h,c,f){let d=!1;for(let u=0;u<f.length;u+=2)if(Vd.eq(h,f[u])&&Vd.eq(c,f[u+1])){d=!0;break}d||f.push(h,c)}},o=[Ot[0],Ot[1]];if(a(),o.length>=100&&(Vd.setEps(.001),o=[Ot[0],Ot[1]],a(),o.length>=100))throw new Error("clearSamePoint()");s=o.length,o.forEach((l,h)=>Ot[h]=l)}let n=i.pop();if(n[0]instanceof xe){let a=function(z){C=Math.min(C,z),R=Math.max(R,z)},o=function(z,q){let L=Sa(z,q);if(L===0)throw new Error("cnt === 0");for(let M=0;M<L;M+=2)a(ie[M])},[l,h]=n,c=h.controls;if(c.length===2){let z=my(l,new ce(c[0],c[1]));for(let q=0;q<z;q++)Ot[s++]=ie[q];continue}let f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,u,p,_,g,b;if(Math.abs(l.sweepAngle)>359){let z=l.rx;u=l.center.add1(z,0),p=l.center.add1(-z,0),f=-z,d=z,_=0,g=1,b=-l.center.y}else{u=l.start(),p=l.end(),_=p.y-u.y,g=u.x-p.x,b=-_*u.x-g*u.y;let z=Math.sqrt(1/(_**2+g**2));_*=z,g*=z,b*=z;let q=_*l.center.x+g*l.center.y+b;l.isCCW?(d=l.rx+q,f=0):(f=q-l.rx,d=0)}let m=c.map(z=>_*z.x+g*z.y+b),O=0;for(let z of m){if(we.less(z,f))O=O|1;else if(we.greater(z,d))O=O|2;else{O=3;break}if(O===3)break}if(O!==3)continue;let y=0,x=0,E=p.x-u.x,w=p.y-u.y,S=Math.sqrt(1/(E**2+w**2));if(E*=S,w*=S,Math.abs(l.sweepAngle)<=180)y=0,x=(p.x-u.x)*E+(p.y-u.y)*w;else throw new Error("not support");O=0;for(let z of c){let q=(z.x-u.x)*E+(z.y-u.y)*w;if(we.less(q,y))O=O|1;else if(we.greater(q,x))O=O|2;else{O=3;break}if(O===3)break}if(O!==3)continue;let C=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY;f-=we.eps,d+=we.eps,m.forEach((z,q)=>{z>=f&&z<=d&&a(q/(m.length-1))});let B=new ce(new ge(0,f),new ge(1,f)),Y=new ce(new ge(0,d),new ge(1,d));for(let z=0;z<m.length-1;z++){let q=new ge(z/(m.length-1),m[z]),L=q.y<f?1:q.y>d?2:3;for(let M=0;M<m.length;M++){let v=new ge(M/(m.length-1),m[M]),P=v.y<f?1:v.y>d?2:3;L!==P&&(L===1?P===2?(o(new ce(q,v),B),o(new ce(q,v),Y)):o(new ce(q,v),B):L===2?P===1?(o(new ce(q,v),B),o(new ce(q,v),Y)):o(new ce(q,v),Y):P===1?o(new ce(q,v),B):o(new ce(q,v),Y))}}C!==0&&(h=h.clip(C)[1]),R!==1&&(h=h.clip((R-C)/(1-C))[0]);let G=h.bbox();if(we.eq(G.minX,G.maxX)&&we.eq(G.minY,G.maxY)){O=0;for(let z of h.controls){let q=(z.x-u.x)*E+(z.y-u.y)*w;if(we.less(q,y))O=O|1;else if(we.greater(q,x))O=O|2;else{O=3;break}if(O===3)break}O===3&&(Ot[s++]=(G.minX+G.maxX)/2,Ot[s++]=(G.minY+G.maxY)/2);continue}R-C>.8?h.clip(.5).forEach(z=>i.push([z,l])):i.push([h,l])}else{let[a,o]=n;i.push([xe.build3(o.center,o.startAngle,o.sweepAngle/2,o.rx,o.ry),a]),i.push([xe.build3(o.center,o.startAngle+o.sweepAngle/2,o.sweepAngle/2,o.rx,o.ry),a])}}for(let n=0;n<s;n++)ie[n]=Ot[n];return s}var UY=class{static getSweep(e){if(e.length>2){let t=0,i=e.length;for(let n=0;n<i-1;n++){let a=e[n],o=e[n+1];t+=(o.x+a.x)*(o.y-a.y)}let r=e[0],s=e[i-1];return t+=(r.x+s.x)*(r.y-s.y),t>0}else throw new Error("Unable to determine the direction of rotation!")}static isClose(e){return!!(e.primitives.length>0&&e.primitives[0].start().equals1(e.primitives[e.primitives.length-1].end()))}};function FY(e){let t=e.primitives,i=t[0],r=i instanceof xe?i.sweepAngle%360:null;if(t.length===1&&i instanceof xe&&(we.eq(r,0)||we.eq(Math.abs(r),360)))return!!i.isCCW;let s=new Array;return e.points(.1,n=>{s.push(n)}),UY.getSweep(s)}var GY=class{static zoomCorner(e,t){let i=new Array,r=new Array,s=new Array;return this.getPanPrimitive(e,i,s,t),this.rearrange(i,s),this.processStart(i,s),this.getResult(i,s,r,t),r.length>0?xt.build2(r):null}static zoomPolygon(e,t){let i=new Array,r=new Array,s=new Array;return FY(e)&&(e=e.reverse().asClose()),this.getPanPrimitive(e,i,s,t),this.rearrange(i,s),this.processStart(i,s),this.getResult(i,s,r,t),r.length>0?xt.build2(r):null}static zoomLines(e,t){return this.zoomPolygon(xt.build2(e.primitives.concat(e.reverse().primitives)),t/2)}static getPanPrimitive(e,t,i,r){let s=e.primitives;for(let n of s){let a=this.panDistance(n,r);a!==void 0&&(t.push(a),i.push(n))}}static rearrange(e,t){let i=e.length,r=0;for(let a=0;a<i;a++){let o=t[a],l=e[a],h=a==i-1?e[0]:e[a+1];if(!(l instanceof xe&&h instanceof xe)&&!this.isCW(l.end(),h.start(),o.end())){if(bn(l,h)!=0){r=a==i-1?0:a+1;break}}else{r=a;break}}let s=this.start4Index(t,r),n=this.start4Index(e,r);t.length=0,e.length=0,s.forEach(a=>{t.push(a)}),n.forEach(a=>{e.push(a)})}static processStart(e,t){let i=e.length;if(i>2){let r=e[i-1],s=e[0],n=t[i-1];if(!(r instanceof xe&&s instanceof xe)&&!this.isCW(r.end(),s.start(),n.end())){let a=bn(r,s);for(let o=0;o<a;o+=2){let l=new ge(ie[o],ie[o+1]);e[i-1]=this.generatePrimitive(r,r.start(),l),e[0]=this.generatePrimitive(s,l,s.end())}}}}static getResult(e,t,i,r){let s=e.length;for(let n=0;n<s;n++){let a=t[n],o=n===s-1?t[0]:t[n+1],l=n==s-1?0:n+1,h=l==s-1?t[0]:t[l+1],c=e[n],f=n==s-1?e[0]:e[n+1],d=l==s-1?e[0]:e[l+1];if(!(c instanceof xe&&f instanceof xe)&&!this.isCW(c.end(),f.start(),a.end())){let p=this.add(e,i,n,c,f,0);p=this.update(e,i,n,f,p);let _=this.generateArc(o,h,f,d,r);if(p=this.add(e,i,n,c,_,p),p=this.update(e,i,n,_,p),p>0)continue}i.push(c);let u=this.generateArc(a,o,c,f,r);u!==void 0&&i.push(u)}}static generateArc(e,t,i,r,s){if(s>0){let n=e.end(),a=t.start(),o=i.end(),l=r.start();if(o.distance2(l)>1e-8)if(n.equals(a)){let h=o.angleD(n),c=l.angleD(n);return xe.build2(n,h,c,s,s,0)}else{let h=o.angleD(n),c=l.angleD(n),f=o.angleD(a),d=l.angleD(a),u=xe.build2(n,h,c,s,s,0),p=xe.build2(a,f,d,s,s,0);return u.pointOn(u.endAngle()).equals1(l)?u:p.pointOn(p.endAngle()).equals1(l)?p:u}}}static updateNews(e,t,i,r){let s=e.length,n=t==s-1?0:t+1;e[n]=this.generatePrimitive(i,r,i.end())}static add(e,t,i,r,s,n){if(n>0)return n;if(r!=null&&s!=null){let a=bn(r,s);for(let o=0;o<a;o+=2){let l=new ge(ie[o],ie[o+1]);t.push(this.generatePrimitive(r,r.start(),l)),this.updateNews(e,i,s,l);break}return a}else return 0}static update(e,t,i,r,s){if(s>0)return s;let n=t.length;if(n>0&&r!=null){let a=t[n-1],o=bn(a,r);for(let l=0;l<o;l+=2){let h=new ge(ie[l],ie[l+1]);t[n-1]=this.generatePrimitive(a,a.start(),h),this.updateNews(e,i,r,h)}return o}else return 0}static generatePrimitive(e,t,i){if(e instanceof ce)return new ce(t,i);if(e instanceof xe){let r=e,s=t.angleD(r.center),n=i.angleD(r.center);return xe.build2(r.center,s,n,r.rx,r.ry,r.sweep())}else throw new Error("not supported operation")}static start4Index(e,t){let i=e.length,r=new Array;for(let s=t;s<i;s++)r.push(e[s]);for(let s=0;s<t;s++)r.push(e[s]);return r}static isCW(e,t,i){let r=new ce(i,e),s=new ce(i,t),n=r.end().x-r.start().x,a=r.end().y-r.start().y,o=s.end().x-s.start().x,l=s.end().y-s.start().y;return!(n*l-a*o>0)}static panDistance(e,t){if(e instanceof ce){if(e.isPoint())return;{let i=e.panDistance(t);return i.length()>1e-5?i:void 0}}else if(e instanceof xe){let i=e;if(i.sweepAngle>0){if(i.rx-t<=0||i.ry-t<=0)return}else if(i.sweepAngle<0&&(i.rx+t<=0||i.ry+t<=0))return;return i=i.panDistance(t),i.start().distance1(i.end())>1e-5||we.eq(Math.abs(i.sweepAngle),360)?i:void 0}else throw new Error("not supported operation")}},st=.001,us=st**2;function Xe(e,t){return e.distance2(t)<us}function Ia(e,t){return Math.abs(e-t)<=1e-4}function zY(e,t){if(e instanceof ce)return new ce(e.start(),t);if(e instanceof xe){let i=t.angleD(e.center);return Ia(ht.regularD(e.startAngle),ht.regularD(i))?xe.build3(e.center,e.startAngle,0,e.rx,e.ry):xe.build2(e.center,e.startAngle,i,e.rx,e.ry,e.isCCW?1:0)}else{if(e instanceof Fe)return e.clip(e.getPercent(t,st))[0];throw new Error("not supported operation")}}function Zn(e,t=ht.toRadians(e.startAngle)){return e.isCCW?t+=Jg:t-=Jg,new ge(Math.cos(t),Math.sin(t))}function of(e,t=0){let i=e.controls;if(t===0){let r=i[0],s=i.slice(1).find(n=>!(n.x===r.x&&n.y===r.y));if(!s)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return s.sub(r)}else if(t===1){let r=i[i.length-1],s=i.slice(0,-1).reverse().find(n=>!(n.x===r.x&&n.y===r.y));if(!s)throw Error("getTangentBezier(bezier: Bezier, t: number = 0)");return r.sub(s)}if(i.length===3){let[r,s,n]=i;return s.sub(r).mul(2*(1-t)).add(n.sub(s).mul(2*t)).normalize()}else{let[r,s,n,a]=i;return s.sub(r).mul(3*(1-t)**2).add(n.sub(s).mul(6*(1-t)*t)).add(a.sub(n).mul(3*t**2)).normalize()}}function Kc(e,t,i){let r=e.slice(1).findIndex(n=>!(n.x===t.x&&n.y===t.y)),s=e[r+1];if(i&&(i.getPercent(s,st)!==null||new ce(i.start(),i.end()).distance(s)<=st)&&(s=e[r+2]),!s)throw Error("getSecondPoint(controls: readonly Vector2[])");return s}function rt(e,t){if(e instanceof ce)return e.end().sub(e.start()).normalize();if(e instanceof xe)return(t?Zn(e,t.angle(e.center)):Zn(e)).normalize();if(e instanceof Fe)if(e.controls.length===2){let[i,r]=e.controls;if(Xe(i,r))throw Error("equalsPP(p0, p1)");return r.sub(i).normalize()}else return(t?of(e,e.getPercent(t,st)):of(e)).normalize();else throw new Error("not support")}function HY(e,t,i){let r=[],s=t**2-4*e*i;if(s>=0){let n=-t/(2*e),a=Math.sqrt(s)/(2*e),o=n+a;if(r.push(o),s>0){let l=n-a;r.push(l)}}return r}function jY(e,t,i,r,s=0,n=1){let a=[],o=e*Math.pow(s,3)+t*Math.pow(s,2)+i*s+r,l=e*Math.pow(n,3)+t*Math.pow(n,2)+i*n+r,h,c;if(o*l<0)for(;Math.abs(s-n)>st;)if(h=(s+n)/2,c=e*Math.pow(h,3)+t*Math.pow(h,2)+i*h+r,Math.abs(c)<st){a.push(h);break}else o*c<0?n=h:l*c<0&&(s=h);else o*l===0&&(o===0&&a.push(s),l===0&&a.push(n));return a}function iy(e,t,i){if(e instanceof ce||t.distance2(i)<=us)return new ce(t,i);if(e instanceof xe)return xe.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof Fe){let r=e.getPercent(t,st),s=e.getPercent(i,st);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}function yy(e){return we.greater(e,0)&&we.less(e,1)}function Kg(e,t,i,r){let s=e[r]-2*t[r]+i[r],n=t[r]-e[r];if(s===0)return[];let a=-n/s,o=[];return yy(a)&&o.push(a),o}function $g(e,t,i,r,s){let n,a,o=-e[s]+3*t[s]-3*i[s]+r[s],l=2*(e[s]-2*t[s]+i[s]),h=t[s]-e[s],c=l**2-4*o*h;if(we.lesseq(c,0))n=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;else{let d=Math.sqrt(c);n=(-l-d)/(2*o),a=(-l+d)/(2*o);let u=o*2;if(we.lesseq(n,1)&&we.greatereq(n,0)){let p=Number.NEGATIVE_INFINITY;for(;we.neq(n,p);){p=n;let _=u*n+l;n=-(o*n**2+l*n+h-_*n)/_}}if(we.lesseq(a,1)&&we.greatereq(a,0)){let p=Number.NEGATIVE_INFINITY;for(;we.neq(a,p);){p=a;let _=u*a+l;a=-(o*a**2+l*a+h-_*a)/_}}}let f=[];return yy(a)&&f.push(a),yy(n)&&f.push(n),f}function UI(e,t){if(e.controls.length===2){let[o,l]=e.controls;Xe(o,l)||t.push(new ce(o,l));return}let i,r;if(e.controls.length===3){let[o,l,h]=e.controls;i=Kg(o,l,h,"x"),r=Kg(o,l,h,"y")}else{let[o,l,h,c]=e.controls;i=$g(o,l,h,c,"x"),r=$g(o,l,h,c,"y")}i.sort((o,l)=>l-o),r.sort((o,l)=>l-o);let s=i.pop()||1,n=r.pop()||1,a=0;for(;s!==1||n!==1;)if(we.eq(s,n))s=i.pop()||1,n=r.pop()||1;else if(s<n){let[o,l]=e.clip((s-a)/(1-a));a=s,t.push(o),e=l,s=i.pop()||1}else{let[o,l]=e.clip((n-a)/(1-a));a=n,t.push(o),e=l,n=r.pop()||1}t.push(e)}var YY=1e-5,Ly=1,Fe=class Es extends ff{constructor(t){if(super(),this._startToEndL=null,t.length<2)throw new Error("Bezier needs at least 2 endpoints");this.controls=t.slice()}get startToEndL(){return this._startToEndL===null&&(this._startToEndL=new ce(this.start(),this.end())),this._startToEndL}build1(t){let i=[];return Qc(t,(r,s)=>(i.push(s),!0)),new Es(i)}start(){return this.controls[0]}end(){return this.controls[this.controls.length-1]}static pointOn(t,i){if(i.length<1)throw new Error("bezier must have at least 1 point");if(i.length===1)return i[0];{let r=new Array(i.length-1);for(let s=1;s<i.length;s++){let n=i[s-1],a=i[s],o=(a.x-n.x)*t,l=(a.y-n.y)*t;r[s-1]=n.add1(o,l)}return Es.pointOn(t,r)}}clip1(t,i,r,s){if(r.push(i[0]),s.push(i[i.length-1]),i.length<2)throw new Error("bezier clip must have at least 2 point");if(i.length===2){let n=i[0],a=i[1],o=(a.x-n.x)*t,l=(a.y-n.y)*t,h=n.add1(o,l);r.push(h),s.push(h)}else{let n=new Array(i.length-1);for(let a=1;a<i.length;a++){let o=i[a-1],l=i[a],h=(l.x-o.x)*t,c=(l.y-o.y)*t;n[a-1]=o.add1(h,c)}this.clip1(t,n,r,s)}}clip(t){let i=[],r=[];return this.clip1(t,this.controls,i,r),[new Es(i),new Es(r.reverse())]}greater(t,i,r){return t-i>r}less(t,i,r){return t-i<-r}eq(t,i,r){return Math.abs(t-i)<=r}eqPP(t,i,r){return!t||!i?!1:this.eq(t.x,i.x,r)&&this.eq(t.y,i.y,r)}isInRange(t,i=we.eps){let r=this.controls.map(n=>n.y-t.y),s=0;for(let n of r){if(this.less(n,0,i))s=s|1;else if(this.greater(n,0,i))s=s|2;else{s=3;break}if(s===3)break}if(s!==3)return!1;s=0;for(let n of this.controls){let a=n.x-t.x;if(this.less(a,0,i))s=s|1;else if(this.greater(a,0,i))s=s|2;else{s=3;break}if(s===3)break}return s===3}getPercent(t,i=we.eps){if(!this.isInRange(t,i))return null;let r=Number.POSITIVE_INFINITY,s=[[this,0,1]];for(;s.length!==0;){let n=function(g){c=Math.min(c,g),f=Math.max(f,g)},a=function(g,b){let m=Sa(g,b);if(m===0)throw new Error("cnt === 0");for(let O=0;O<m;O+=2)n(ie[O])},[o,l,h]=s.pop();if(this.eqPP(o.start(),t,i))return l;if(this.eqPP(o.end(),t,i))return h;let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,d=o.controls.map(g=>g.y-t.y);r=d.reduce((g,b)=>{let m=Math.abs(b);return m<g?m:g},r),r/=2,r<=i&&(r=i),d.forEach((g,b)=>{this.eq(g,0,i)&&n(b/(d.length-1))});let u=new ce(new ge(0,-r),new ge(1,-r)),p=new ce(new ge(0,r),new ge(1,r));for(let g=0;g<d.length-1;g++){let b=new ge(g/(d.length-1),d[g]),m=this.less(b.y,0,i)?1:this.greater(b.y,0,i)?2:3;for(let O=0;O<d.length;O++){let y=new ge(O/(d.length-1),d[O]),x=this.less(y.y,0,i)?1:this.greater(y.y,0,i)?2:3;m!==x&&(m===1?x===2?(a(new ce(b,y),u),a(new ce(b,y),p)):a(new ce(b,y),u):m===2?x===1?(a(new ce(b,y),u),a(new ce(b,y),p)):a(new ce(b,y),p):x===1?a(new ce(b,y),u):a(new ce(b,y),p))}}if(!isFinite(c)){if(Math.max(...d.map(g=>Math.abs(g)))<i*4)return(l+h)/2;continue}if(c!==0&&(o=o.clip(c)[1],l=(h-l)*c+l),f!==1){let g=(f-c)/(1-c);o=o.clip(g)[0],h=(h-l)*g+l}if(!o.isInRange(t,i))continue;let _=o.controls.reduce((g,b)=>g.ext2(b),new Hs).build1();if(this.eq(_.minX,_.maxX,i)&&this.eq(_.minY,_.maxY,i))return(l+h)/2;if(f-c>.8){let[g,b]=o.clip(.5);g.isInRange(t,i)?(s.push([g,l,(l+h)/2]),b.isInRange(t,i)&&s.push([b,(l+h)/2,h])):s.push([b,(l+h)/2,h])}else s.push([o,l,h])}return null}toBezier(){return this}toString(){return"Bezier ["+this.controls.join(" ")+"]"}bbox(){return this._bbox||(this._bbox=new Hs().ext3(this.points(.1)).build1()),this._bbox}bboxWithControls(){return this._bbox_controls||(this._bbox_controls=new Hs().ext3(this.controls).build()),this._bbox_controls}multiply3(t){let i=new Array(this.controls.length);for(let r=0;r<this.controls.length;r++){let s=this.controls[r];i[r]=s.multiply3(t)}return new Es(i)}stroke(t,i,r,s=Ly){let n=GY.zoomLines(xt.build4(this.points(s)),t);return r===0?n:n.reverse()}points(t){let i=[];return this.getBezierPoints(t,r=>i.push(r)),i}getBezierPoints(t,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let r=[this];for(i(this.start());r.length!==0;){let n=r.pop(),a=new ce(n.start(),n.end());if(s(n.controls,a)<=t)i(n.end());else{let[o,l]=n.clip(.5);r.push(l,o)}}function s(n,a){let o=a.start(),l=a.end();o.equals1(l)&&(l=o.add1(1,0));let h=l.y-o.y,c=o.x-l.x,f=-h*o.x-c*o.y,d=Math.sqrt(1/(h**2+c**2));h*=d,c*=d,f*=d;let u=n.map(p=>Math.abs(h*p.x+c*p.y+f));return Math.max(...u)}}getBezierPoints3(t,i){if(this.controls.length===2){i(this.start()),i(this.end());return}let r=t*t,s=this.controls[0],n=.5;for(;n>YY&&!(s.distance2(Es.pointOn(n,this.controls))<=r);n*=.5);let a=Math.ceil(1/n);n=1/a,i(s);let o=0;for(let l=1;l<a;l++)o+=n,i(Es.pointOn(o,this.controls));i(this.end())}getPointsBySlope(t){if(this.controls.length===4)return this.getPointsBySlope4(t);throw new Error("Currently, only 4 control points are supported!")}getPointsBySlope4(t){let[i,r,s,n]=this.controls,a=-3*i.x+9*r.x-9*s.x+3*n.x,o=6*i.x-12*r.x+6*s.x,l=-3*i.x+3*r.x,h=[];if(Number.isFinite(t)){let c=-3*i.y+9*r.y-9*s.y+3*n.y,f=6*i.y-12*r.y+6*s.y,d=-3*i.y+3*r.y,u=c-a*t,p=f-o*t,_=d-l*t,g=-p/(2*u),b=Math.sqrt(p**2-4*u*_)/(2*u),m=g+b;m>=0&&m<=1&&h.push(Es.pointOn(m,this.controls));let O=g-b;O>=0&&O<=1&&h.push(Es.pointOn(O,this.controls))}else{let c=-o/(2*a),f=Math.sqrt(o**2-4*a*l)/(2*a),d=c+f;d>=0&&d<=1&&h.push(Es.pointOn(d,this.controls));let u=c-f;u>=0&&u<=1&&h.push(Es.pointOn(u,this.controls))}return h}buildConverxHull(t=we.eps){let i=[...this.controls],r=[],s=i[0],n=1;do{let a=i[n%i.length];this.eqPP(s,a,t)||r.push(new ce(s,a)),s=a,n++}while(s!==i[0]);if(r.length===0)throw Error("buildConverxHull(diff = DoubleKit.eps)");return xt.build7(r).asClose()}getExtremePoints(t){if(!t)return a(this.controls);let i=t.start(),r=t.end(),s=r.x-i.x,n=r.y-i.y;if(Math.abs(s)<=we.eps||Math.abs(n)<=we.eps)return a(this.controls);{let o=n/s;if(this.controls.length===3){i.equals1(r)&&(r=i.add1(1,0));let l=r.y-i.y,h=i.x-r.x,c=-l*i.x-h*i.y,f=Math.sqrt(1/(l**2+h**2));l*=f,h*=f,c*=f;let d=this.controls.map(_=>l*_.x+h*_.y+c),u=d[0]-2*d[1]+d[2],p=d[1]-d[0]-o/2;if(u!==0){let _=-p/u;if(we.greater(_,0)&&we.less(_,1))return[Es.pointOn(_,this.controls)]}}else if(this.controls.length===4)return this.getPointsBySlope(o)}return[];function a(o){let l,h;if(o.length===3){let[u,p,_]=o;l=Kg(u,p,_,"x"),h=Kg(u,p,_,"y")}else if(o.length===4){let[u,p,_,g]=o;l=$g(u,p,_,g,"x"),h=$g(u,p,_,g,"y")}l.sort((u,p)=>p-u),h.sort((u,p)=>p-u);let c=l.pop()||1,f=h.pop()||1,d=[];for(;c!==1||f!==1;)we.eq(c,f)?(c=l.pop()||1,f=h.pop()||1):c<f?(d.push(Es.pointOn(c,o)),c=l.pop()||1):(d.push(Es.pointOn(f,o)),f=h.pop()||1);return d}}getToLineMaxDis2(t){let i=this.getExtremePoints(t),r=t.distance2(this.start()),s=t.distance2(this.end()),n=Math.max(r,s);return i.forEach(o=>a(t.distance2(o))),n;function a(o){n=Math.max(n,o)}}getToLineMinAndMaxDis_Controls(t){let i=t.start(),r=t.end();t.start().equals1(t.end())&&(r=i.add1(1,0));let s=r.y-i.y,n=i.x-r.x,a=-s*i.x-n*i.y,o=Math.sqrt(1/(s**2+n**2));s*=o,n*=o,a*=o;let l=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return this.controls.forEach(c=>{let f=s*c.x+n*c.y+a;f<l&&(l=f),f>h&&(h=f)}),{minDis:l,maxDis:h}}getPercentInLine(t){let i=[],r=[],s=this.controls,n=t.start(),a=t.end(),o=a.y-n.y,l=n.x-a.x,h=-o*n.x-l*n.y,c=Math.sqrt(1/(o**2+l**2));if(o*=c,l*=c,h*=c,o**2+l**2<=0)return i;if(s.length===3){let[f,d,u]=s,p=o*(f.x-2*d.x+u.x)+l*(f.y-2*d.y+u.y),_=2*(o*(d.x-f.x)+l*(d.y-f.y)),g=o*f.x+l*f.y+h;r=HY(p,_,g)}else if(s.length===4){let[f,d,u,p]=s,_=p.sub(u.mul(3)).add(d.mul(3)).sub(f),g=f.sub(d.mul(2)).add(u).mul(3),b=d.sub(f).mul(3),m=f,O=o*_.x+l*_.y,y=o*g.x+l*g.y,x=o*b.x+l*b.y,E=o*m.x+l*m.y+h,w=Math.sqrt(1/(O**2+y**2));O*=w,y*=w,x*=w,E*=w,r=jY(O,y,x,E)}else throw Error("not support getBeizerPointInLine");return r.forEach(f=>{f>=0&&f<=1&&i.push(f)}),i}reverse(){return new Es(this.controls.slice().reverse())}},Ta,FI=(Ta=class{constructor(){this.textCache=new Map,this.numCache=new Array(20),this.boxCache=new Array(4),this.textOffsetCache=new Array(9),this.BuildLineCache=new Array(7),this.BuildTrackCache=new Array(7),this.BuildViaCache=new Array(11),this.BuildBoxCache=new Array(10),this.BuildArcCache=new Array(10),this.BuildArcTrackCache=new Array(10),this.BuildTextCache=new Array(7),this.BuildPadStyleCache=new Array(4),this.BuildPadCache=new Array(12),this.ARRAY1=new Array(1),this.ARRAY2=new Array(2),this.ARRAY3=new Array(3),this.ARRAY4=new Array(4),this.ARRAY5=new Array(5),this.ARRAY6=new Array(6),this.ARRAY7=new Array(7),this.ARRAY8=new Array(8),this.ARRAY9=new Array(9),this.ARRAY10=new Array(10),this.ARRAY11=new Array(11),this.ARRAY12=new Array(12),this.textOffsetCache[0]=ge.ORIGIN,this.textOffsetCache[1]=new ge(0,-.5),this.textOffsetCache[2]=new ge(0,-1),this.textOffsetCache[3]=new ge(-.5,0),this.textOffsetCache[4]=new ge(-.5,-.5),this.textOffsetCache[5]=new ge(-.5,-1),this.textOffsetCache[6]=new ge(-1,0),this.textOffsetCache[7]=new ge(-1,-.5),this.textOffsetCache[8]=new ge(-1,-1)}static getCache(){return Ta.instance==null&&(Ta.instance=new Ta),Ta.instance}},Ta.instance=null,Ta),ce=class ih extends ff{constructor(t,i){super(),this._a=null,this._b=null,this._c=null,this.__bbox=null,this._hashed=null,this._direct=null,this._start=t,this._end=i}get a(){return this._a===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._a}get b(){return this._b===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._b}get c(){return this._c===null&&(this._start.equals1(this._end)?(this._a=NaN,this._b=NaN,this._c=NaN):(this._a=this._end.y-this._start.y,this._b=this._start.x-this._end.x,this._c=this._end.x*this._start.y-this._start.x*this._end.y)),this._c}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}get direct(){return this._direct==null&&(this._direct=this._end.sub(this._start).normalize()),this._direct}cutLine(t){if(we.eq(this.distance(t),0)){let i=new ih(this._start,t);return i._a=this._a,i._b=this._b,i._c=this._c,i}return new ih(this._start,t)}get midPoint(){return this._start.add(this._end).mul(.5)}toBezier(){return new Fe([this._start,this._end])}_hashCode(){let t=31,i=1;return i=t*i+this._start.hashCode(),i=t*i+this._end.hashCode(),i}start(){return this._start}end(){return this._end}center(){let t=this.start(),i=this.end();return t.add(i).mul(.5)}panDistance(t){let i=this._end.x-this._start.x,r=this._end.y-this._start.y,s=this.length();i=i*t/s,r=-r*t/s;let n=new ge(this._start.x+r,this._start.y+i),a=new ge(this._end.x+r,this._end.y+i);return new ih(n,a)}isPoint(){return this._start.distance2(this._end)<=1e-8}length(){return this._start.distance1(this._end)}toString(){return"Line [start="+this._start+", end="+this._end+"]"}bbox(){if(this.__bbox==null){let t=FI.getCache().boxCache;t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.__bbox=new ls(t[0],t[1],t[2],t[3])}return this.__bbox}multiply3(t){return new ih(this._start.multiply3(t),this._end.multiply3(t))}hashCode(){return this.hashed}equals(t){let i=t;return this.hashed===i.hashed&&this._start.equals(i._start)&&this._end.equals(i._end)}equals1(t){let i=t;return this.hashed===i.hashed&&this._start.equals1(i._start)&&this._end.equals1(i._end)}equals2(t){let i=[this.start(),this.end()],r=[t.start(),t.end()];return Wn(i,r)||Wn(i,r.reverse())}stroke(t,i,r){let s,n,a;this._end.x<this._start.x?(n=this._start.x-this._end.x,a=this._start.y-this._end.y,s=this._end):(n=this._end.x-this._start.x,a=this._end.y-this._start.y,s=this._start);let o=Math.sqrt(n*n+a*a),l=t/2,h,c,f;i===2?(c=-l,f=o+l):(c=0,f=o),i===0||i===2?r===0?h=xt.build5([c,-l,c,l,f,l,f,-l]):h=xt.build5([c,l,c,-l,f,-l,f,l]):r===0?h=xt.build2([xe.build3(new ge(c,0),-90,-180,l,l),xe.build3(new ge(f,0),90,-180,l,l)]):h=xt.build2([xe.build3(new ge(c,0),90,180,l,l),xe.build3(new ge(f,0),-90,180,l,l)]);let d=Math.atan2(a,n),u=er.rotate(d).translate1(s);return h.asClose().multiply3(u)}points(t){return[this._start,this._end]}mirrorY(t){return new ih(this.start().mirrorY(t),this.end().mirrorY(t))}reverse(){return new ih(this._end,this._start)}inArea(t,i,r){let s=t.x,n=t.y,a=this._start,o=this._end,l=r==1,h=s-a.x,c=n-a.y,f=s-o.x,d=n-o.y,u=o.x-a.x,p=o.y-a.y,_=new ge(-p,u).normalize(),g=u+_.x*i/2,b=p+_.y*i/2,m=g*g+b*b,O=h*h+c*c,y=f*f+d*d,x=Math.abs(h*p-c*u)/2,E=Math.sqrt(u*u+p*p)*i/4;if(x<=E&&O<=m&&y<=m){if(l)return!0;{let w=new ge(s,n).sub(o).normalize(),S=new ge(s,n).sub(a).normalize(),C=new ge(_.x,_.y).cross(w),R=new ge(_.x,_.y).cross(S);return C>=0&&R<=0}}else if(l){let w=i/2;return O<=w*w?!0:y<=w*w}else return!1}isParallel(t,i=!1){let r=we.eq(Math.abs(this.direct.cross(t.direct)),0),s=!i||we.greatereq(this.direct.dot(t.direct),0);return r&&s}distance2(t){return(this.a*t.x+this.b*t.y+this.c)**2/(this.a**2+this.b**2)}distance2ForPP(t){let{x:i,y:r}=t,{x:s,y:n}=this.start(),{x:a,y:o}=this.end();return((i-s)*(o-n)-(r-n)*(a-s))**2/((o-n)**2+(a-s)**2)}distance(t){return Math.abs(this.a*t.x+this.b*t.y+this.c)/Math.sqrt(this.a**2+this.b**2)}};function VY(e,t=.05){if(e.length<3)return e.slice();let i=e.slice(0,1),r=(n,a,o)=>TY(n.x,n.y,a.x,a.y,o.x,o.y);for(;;){i=e.slice(0,1);for(let n=1;n<e.length-1;n+=2)r(e[n],e[n-1],e[n+1])>t&&i.push(e[n]),i.push(e[n+1]);if(i.at(-1).equals1(e.at(-1))||i.push(e.at(-1)),e.length==i.length)break;e=i}let s=e[e.length-1];return i.push(s),i}var qY=eY(tY());var XY=class{constructor(){this.fac=new Hs,this.length=0,this.box=null,this.pt=null,this.i=0}calcBBox(e){for(this.fac.clear(),this.length=e.length,this.box=null,this.pt=null,this.i=0;this.i<this.length;this.i++)this.pt=e[this.i],this.box=this.pt.bbox(),this.fac.ext1(this.box);return this.fac.build1()}},WY=new XY,xt=class Yi{constructor(t,i){this.__bbox=null,this.primitives=t,this.__bbox=i}static calcBBox(t){return WY.calcBBox(t)}static build1(t){let i=[],r=null;return Xg(t,(s,n)=>{let a=n.start();return r!==null&&!a.equals(r)&&i.push(new ce(r,a)),i.push(n),r=n.end(),!0}),i.length===0&&r!=null&&i.push(new ce(r,r)),new Yi(i)}static build2(t){return Yi.build1(gy(t))}static build3(t){let i=[],r=null;return Xg(t,(s,n)=>(r!==null&&i.push(new ce(r,n)),r=n,!0)),new Yi(i)}static build4(t){return this.build3(gy(t))}static build5(t){let i=[];for(let r=0;r<t.length;r+=2)i.push(new ge(t[r],t[r+1]));return this.build4(i)}static build6(t){return Yi.build4([t.LL(),t.LR(),t.UR(),t.UL(),t.LL()])}static build7(t){return new Yi(t)}static build8(t){let i=new ge(t[0],t[1]),r,s=[],n,a=(o,l)=>o.length==l&&o.every(h=>typeof h=="number");for(let o=2;o<t.length;)switch(typeof t[o]=="string"?n=t[o]:o-=1,n){case"ARC":{let l=t.slice(o+1,o+4);if(!a(l,3))throw new Error("invalid rawData");let h=l[0];r=new ge(l[1],l[2]),s.push(xe.build5(i,r,h)),i=r,o+=4;break}case"L":{let l=t.slice(o+1,o+3);if(!a(l,2))throw new Error("invalid rawData");r=new ge(l[0],l[1]),s.push(new ce(i,r)),i=r,o+=3;break}case"C":{let l=t.slice(o+1,o+7);if(!a(l,7))throw new Error("invalid rawData");let h=new ge(l[0],l[1]),c=new ge(l[2],l[3]);r=new ge(l[4],l[5]),s.push(new Fe([i,h,c,r])),i=r,o+=7;break}default:throw new Error("invalid rawData")}return Yi.build2(s)}static buildBBox(t,i=0){return i===1?Yi.build5([t.minX,t.minY,t.maxX,t.minY,t.maxX,t.maxY,t.minX,t.maxY,t.minX,t.minY]):Yi.build5([t.minX,t.minY,t.minX,t.maxY,t.maxX,t.maxY,t.maxX,t.minY,t.minX,t.minY])}static triangulate(t,i,r=1){if(t.length===1){let l=new Array;t[0].asClose().points2(r,d=>l.push(d));let h,c=l[0],f=[];for(let d=0;d<l.length-2;d+=2){let u=l[d+1],p=l[d+2],_=u.sub(c).normalize().cross(p.sub(c).normalize());if(we.neq(_,0)){if(h===!0){if(_<0){f.length=0;break}}else if(h===!1){if(_>0){f.length=0;break}}else h=_>0;f.push(c),f.push(u),f.push(p)}l.push(c),c=p}if(f.length!==0){for(let d=0;d<f.length;d+=3)i(f[d],f[d+1],f[d+2]);return}}let s=[],n=[];t.forEach(l=>{s.length!==0&&n.push(s.length/2),l.asClose().points2(r,h=>s.push(h.x,h.y))});let a=qY.default(s,n),o=[];for(let l=1;l<s.length;l+=2)o.push(new ge(s[l-1],s[l]));for(let l=0;l<a.length;l+=3)i(o[a[l]],o[a[l+1]],o[a[l+2]])}lines(t,i){let r=new Array;this.points(t,n=>r.push(n));let s=r[0];for(let n=1;n<r.length;n++){let a=r[n];i(s),i(a),s=a}}triangles(t,i){Yi.triangulate([this],(...r)=>{r.forEach(s=>i(s))},t)}mirror(){let t=[];return this.primitives.forEach(i=>{if(i instanceof ce)i=new ce(i.start().mirror(),i.end().mirror());else if(i instanceof xe)i=i.mirror();else if(i instanceof Fe){let r=i.controls.map(s=>s.mirror());i=new Fe(r)}else throw new Error("bug");t.push(i)}),new Yi(t,this.__bbox)}getPoints(t){let i=[];for(let r of this.primitives)for(let s of r.points(t))i.push(s);return i}round(t=4){let i=this.primitives.slice();for(let r=0;r<i.length;r++){let s=i[r];if(s instanceof ce){let n=s.start().round(t),a=s.end().round(t);i[r]=new ce(n,a)}else if(s instanceof Fe){let n=s.controls.map(a=>a.round(t));i[r]=new Fe(n)}else if(s instanceof xe){let n=s.start().round(t),a=s.end().round(t),o=s.sweepAngle;i[r]=xe.build5(n,a,o)}}return new Yi(i,this.__bbox)}simplify(t=.05){let i=[],r=!1,s=[],n=this.closed();if(this.primitives.length<=1)return Yi.build2(this.primitives);let a=()=>{if(s.length>2){let l=VY(s,t);for(let h=1;h<l.length;h++)i.push(new ce(l[h-1],l[h]))}else i.push(new ce(s[0],s[1]));s.length=0,r=!1};for(let l=0;l<this.primitives.length;l++){let h=this.primitives[l];h instanceof ce?(r?s.push(h.end()):(s.length=0,s.push(h.start(),h.end()),r=!0),l===this.primitives.length-1&&a()):(r&&a(),i.push(h))}let o=new Yi(i,this.__bbox);return n&&!o.closed()&&(o=o.asClose()),o}hasBackLine(){let{primitives:t}=this,i;for(let r=0;r<t.length;r++){let s=t[r];if(s instanceof ce){if(s.end().equals1(s.start()))continue;if(i&&(s.end().equals1(i.start())||wY(s.end(),i.start(),i.end())))return!0;i=s}else i=null}return!1}area(t=.1){let i=0,r=this.end();return this.primitives.forEach(s=>{let n=s.start(),a=s.end();if(i+=(n.x+r.x)*(n.y-r.y),s instanceof ce)i+=(a.x+n.x)*(a.y-n.y);else if(s instanceof xe)i+=(a.x+n.x)*(a.y-n.y),i+=Math.PI*s.rx2*s.sweepAngle/180-ge.normal(s.center,s.start(),s.end());else if(s instanceof Fe){let o=n;s.points(t).forEach(l=>{i+=(l.x+o.x)*(l.y-o.y),o=l}),i+=(a.x+o.x)*(a.y-o.y)}r=a}),i/2}closed(t){return this.primitives.length===0?!1:this.start().equals(this.end(),t)}asClose(){let t=this.primitives[0],i=this.primitives[this.primitives.length-1],r=t.start(),s=i.end();if(r.equals(s))return this;{let n=new Array;return hs.addAll(n,this.primitives),n.push(new ce(s,r)),Yi.build2(n)}}closeEndpoint(){let t=this.primitives[0],i=this.primitives[this.primitives.length-1],r=t.start(),s=i.end();if(r.equals1(s))return this;{let n=new Array;return hs.addAll(n,this.primitives),n.push(new ce(s,r)),new Yi(n)}}reverse(){let t=new Array(this.primitives.length);for(let i=0,r=this.primitives.length-1;r>=0;i++,r--){let s=this.primitives[r];if(s instanceof ce)s=new ce(s.end(),s.start());else if(s instanceof xe)s=s.exchangeSweep();else if(s instanceof Fe)s=new Fe(s.controls.slice().reverse());else throw new Error("bug");t[i]=s}return new Yi(t,this.__bbox)}reverse1(){let t=new Array(this.primitives.length);for(let i=0,r=this.primitives.length-1;r>=0;i++,r--){let s=this.primitives[r];if(s instanceof ce)s=new ce(s.end(),s.start());else if(s instanceof xe)s=s.exchangeSweep1();else if(s instanceof Fe)s=new Fe(s.controls.slice().reverse());else throw new Error("bug");t[i]=s}return new Yi(t,this.__bbox)}mirrorY(t){let i=[];return this.primitives.forEach(r=>{if(r instanceof ce)r=r.mirrorY(t);else if(r instanceof xe)r=r.mirrorY(t);else if(r instanceof Fe){let s=r.controls.map(n=>n.mirrorY(t));r=new Fe(s)}else throw new Error("bug");i.push(r)}),new Yi(i,this.__bbox)}points(t,i){if(this.primitives.length!==0){for(let r=0;r<this.primitives.length-1;r++){let s=this.primitives[r].points(t);s.pop(),s.forEach(n=>i(n))}this.primitives[this.primitives.length-1].points(t).forEach(r=>i(r))}}points1(t,i){if(this.primitives.length===0)return;for(let s=0;s<this.primitives.length-1;s++){let n=this.primitives[s],a=n instanceof xe?n.points1(t):n.points(t);a.pop(),a.forEach(o=>i(o))}let r=this.primitives[this.primitives.length-1];(r instanceof xe?r.points1(t):r.points(t)).forEach(s=>i(s))}points2(t,i){if(this.primitives.length===0)return;for(let s=0;s<this.primitives.length-1;s++){let n=this.primitives[s],a=n instanceof xe?n.points2():n.points(t);a.pop(),a.forEach(o=>i(o))}let r=this.primitives[this.primitives.length-1];(r instanceof xe?r.points2():r.points(t)).forEach(s=>i(s))}multiply3(t){let i=new Array(this.primitives.length);for(let r=0;r<this.primitives.length;r++)i[r]=this.primitives[r].multiply3(t);return Yi.build7(i)}bbox(){return this.__bbox==null&&(this.__bbox=Yi.calcBBox(this.primitives)),this.__bbox}start(){return this.primitives.length!==0?this.primitives[0].start():null}end(){return this.primitives.length!==0?this.primitives[this.primitives.length-1].end():null}isClose(t){if(this.primitives.length<=1&&!(this.primitives[0]instanceof xe))return!1;{let i=this.primitives[0],r=this.primitives[this.primitives.length-1];return i.start().equals(r.end(),t)}}isEqual(t){if(t instanceof Yi&&t.primitives.length==this.primitives.length){let i=t.primitives.length;for(let r=0;r<i;r++){let s=t.primitives[r],n=this.primitives[r];if(JSON.stringify(s)!=JSON.stringify(n))return!1}return!0}return!1}equals(t){if(!t)return!1;let i=this.primitives,r=t.primitives;if(i.length!=r.length)return!1;if(t.isClose()){let s=0;for(;s<i.length;){let n=i.slice(s).concat(i.slice(0,s));if(Wn(n,r)||Wn(n.reverse(),r))return!0;s++}return!1}else return Wn(this.primitives,t.primitives)}clone(){return Yi.build2(this.primitives)}putItem(t,i){if(!t)return!1;if(t instanceof Yi)return this.mergePolyline(t,i);let r=this.start();if(!r){this.primitives.push(t),this.__bbox=t.bbox();return}let s=this.end();if(r.equals(s,i))return!1;let n=t.start(),a=t.end(),o=!1,l=!1;if(r.equals(n,i))o=!0,l=!1;else if(r.equals(a,i))o=!1,l=!1;else if(s.equals(n,i))o=!1,l=!0;else if(s.equals(a,i))o=!0,l=!0;else return!1;return l?this.primitives.push(o?t.reverse():t):this.primitives.unshift(o?t.reverse():t),this.__bbox=ls.extend2(this.__bbox,t.bbox()),!0}mergePolyline(t,i,r=0){if(!t)return!1;let s=this.start();if(!s){this.primitives.push(...t.primitives),this.__bbox=t.bbox();return}let n=this.end();if(s.equals(n,i))return!1;let a=t.start(),o=t.end(),l=!1,h=!1;if(s.equals(a,i))l=!0,h=!1;else if(s.equals(o,i))l=!1,h=!1;else if(n.equals(a,i))l=!1,h=!0;else if(n.equals(o,i))l=!0,h=!0;else return!1;let c=l?t.reverse():t;return h?this.primitives.push(...c.primitives):this.primitives.unshift(...c.primitives),this.__bbox=ls.extend2(this.__bbox,t.bbox()),!0}deDuplicationPoint(t){let i=this.primitives[this.primitives.length-1].start(),r=this.primitives[this.primitives.length-1].end(),s=t.primitives[0].start(),n=t.primitives[0].end();if(this.primitives[this.primitives.length-1]instanceof ce&&t.primitives[0]instanceof ce&&LY([i,r],[s,n])){this.primitives.pop(),t.primitives.shift();let a=[];a.push(new ce(i,n)),this.primitives.push(...a)}}getMaxBBoxHeightByVec(t){let i=t.normalize(),r=-1/0,s=1/0;if(this.primitives.forEach(a=>{let o=a.start().dot(i),l=a.end().dot(i);if(n(o),n(l),a instanceof xe){let h=t.angleD(ge.ORIGIN);if(a.angleIsInArc(h)){let c=a.pointOn(h).dot(i);n(c)}if(a.angleIsInArc(h+180)){let c=a.pointOn(h-180).dot(i);n(c)}}}),r-s<=0)throw new Error("getMaxBBoxHeightByVec");return r-s;function n(a){a>r&&(r=a),a<s&&(s=a)}}getWindingNum(t){let i=this.end(),r=0,{x:s,y:n}=t;for(let o of this.primitives){if(i.y>n?o.bbox().minY>n:o.bbox().maxY<=n){i=o.end();continue}if(o instanceof xe&&(o.isCCW?Math.floor(o.startAngle/90)+1!==Math.ceil(o.endAngle()/90):Math.ceil(o.startAngle/90)-1!==Math.floor(o.endAngle()/90))){let l=o.startAngle,h=o.endAngle();if(o.sweepAngle>0){let c=90;for(;c<=h;)c>l&&(a(xe.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c+=90;l<h&&a(xe.build3(o.center,l,h-l,o.rx,o.ry))}else{let c=270;for(;c>=h;)c<l&&(a(xe.build3(o.center,l,c-l,o.rx,o.ry)),l=c),c-=90;l>h&&a(xe.build3(o.center,l,h-l,o.rx,o.ry))}}else if(o instanceof Fe){let l=[];UI(o,l),l.forEach(h=>a(h))}else a(o)}return r;function a(o){let l=o.start(),h=o.end();if(i.y>n!=l.y>n&&(i.x>s?l.x>s?r+=l.y>i.y?1:-1:i.y>l.y?(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)<0&&r--:(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)>0&&r++:l.x>s&&(i.y>l.y?(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)<0&&r--:(i.x-s)*(l.y-n)-(i.y-n)*(l.x-s)>0&&r++)),l.y>n!=h.y>n){if(l.x>s)if(h.x>s)r+=h.y>l.y?1:-1;else if(o instanceof ce)l.y>h.y?(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)<0&&r--:(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)>0&&r++;else if(o instanceof xe){let{center:c,isCCW:f,rx2:d}=o,u=(c.x-s)**2+(c.y-n)**2;l.y>h.y?(f?u>d:u<d)&&r--:(f?u<d:u>d)&&r++}else if(o instanceof Fe){if(nI(o,n)===0)throw new Error("no inters");ie[0]>s&&(r+=h.y>l.y?1:-1)}else throw new Error("not support!");else if(h.x>s)if(o instanceof ce)l.y>h.y?(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)<0&&r--:(l.x-s)*(h.y-n)-(l.y-n)*(h.x-s)>0&&r++;else if(o instanceof xe){let{center:c,isCCW:f,rx2:d}=o,u=(c.x-s)**2+(c.y-n)**2;l.y>h.y?(f?u>d:u<d)&&r--:(f?u<d:u>d)&&r++}else if(o instanceof Fe){if(nI(o,n)===0)throw new Error("no inters");ie[0]>s&&(r+=h.y>l.y?1:-1)}else throw new Error("not support!")}i=h}}},Ng=Math.PI*2;var Iae=Math.PI/2,Pae=Math.sin(Math.PI/180);var JY=4,xe=class _i extends ff{constructor(t,i,r,s,n){super(),this._rx2=null,this._ry2=null,this._svgEnd=null,this._hashed=null,this.__bbox=null,this.rx=t,this.ry=i,this.center=r,this.startAngle=s,this.sweepAngle=n,this._start=ge.ORIGIN,this._end=ge.ORIGIN,this._start=this.pointOn(s),this._end=this.pointOn(s+n)}get hashed(){return this._hashed==null&&(this._hashed=this._hashCode()),this._hashed}hashCode(){return this.hashed}_hashCode(){let t=31,i=1;return i=t*i+new ge(this.rx,this.rx).hashCode(),i=t*i+this.center.hashCode(),i=t*i+new ge(this.startAngle,this.sweepAngle).hashCode(),i}get rx2(){return this._rx2==null&&(this._rx2=this.rx*this.rx),this._rx2}get ry2(){return this._ry2==null&&(this._ry2=this.ry*this.ry),this._ry2}get svgEnd(){return this._svgEnd==null&&(this._svgEnd=this.getSvgEnd(this.startAngle,this.sweepAngle,this._start,this._end)),this._svgEnd}getSvgEnd(t,i,r,s){let n=i>=0?-.01:.01,a=t+i;for(;(i>=0&&a>t||i<0&&a<t)&&r.distance2(s)<2e-4;)n*=2,a+=n,s=this.pointOn(a);return s}static build1(t,i,r,s,n,a){Ti.positive(r),Ti.positive(s);let o=t.equals(i);if(o)return new _i(r,s,t,0,n?360:0);{let l=t.x,h=-t.y,c=i.x,f=-i.y,d=a===0,u=(l-c)/2,p=(h-f)/2,_=Math.cos(0),g=Math.sin(0),b=_*u+g*p,m=-g*u+_*p;r=Math.abs(r),s=Math.abs(s);let O=r*r,y=s*s,x=b*b,E=m*m,w=n===d?-1:1,S=(O*y-O*E-y*x)/(O*E+y*x);S=S<0?0:S;let C=w*Math.sqrt(S),R=C*(r*m/s),B=C*-(s*b/r),Y=(l+c)/2,G=(h+f)/2,z=Y+(_*R-g*B),q=G+(g*R+_*B),L=(b-R)/r,M=(m-B)/s,v=(-b-R)/r,P=(-m-B)/s,I,N;N=Math.sqrt(L*L+M*M),I=L,w=M<0?-1:1;let D=ht.toDegrees(w*Math.acos(I/N));N=Math.sqrt((L*L+M*M)*(v*v+P*P)),I=L*v+M*P,w=L*P-M*v<0?-1:1;let j=I/N,H;j<-1?H=Math.acos(-1):j>1?H=Math.acos(1):H=Math.acos(j);let K=ht.toDegrees(w*H);!d&&K>0?K-=360:d&&K<0&&(K+=360),Ti.normal(D),Ti.normal(K);let se=u*u/O+p*p/y,he=t.distance1(i)/2;r<he&&s<he&&(r*=Math.sqrt(se),s*=Math.sqrt(se));let _e=o?0:ht.regularD(-D),ve=o?n?360:0:-K;return new _i(r,s,new ge(z,-q),_e,ve)}}static build2(t,i,r,s,n,a){Ti.positive(s),Ti.positive(n),Ti.normal(i),Ti.normal(r);let o;return i===r?(i=ht.regularD(i),r=ht.regularD(r),o=0):(i=ht.regularD(i),r=ht.regularD(r),a===1?r<=i&&(r+=360):r>=i&&(i+=360),o=r-i),new _i(s,n,t,ht.regularD(i),o)}static build3(t,i,r,s,n){return Ti.positive(s),Ti.positive(n),Ti.normal(r),new _i(s,n,t,ht.regularD(i),r)}static build4(t,i,r,s,n,a){let o=t.angleD(r),l=i.angleD(r);return _i.build2(r,o,l,s,n,a)}static build5(t,i,r){r=ht.toRadians(r);let s=i.sub(t),n=new ge(-s.y,s.x).normalize(),a=Math.abs(r)/2,o;if(a!=0)o=s.length()/2/Math.sin(a);else throw new Error("Can't represent circle!!!");let l=n.rotate(ge.ORIGIN,a),h,c;r>0?(h=1,c=i.add(l.scale(o))):(h=0,c=t.sub(l.scale(o)));let f=ht.toDegrees(t.angle(c)),d=ht.toDegrees(i.angle(c));return _i.build2(c,f,d,o,o,h)}static buildCircle(t,i,r=0){return _i.build2(t,0,360,i,i,r)}start(){return this._start}end(){return this._end}isLarge(){return Math.abs(this.sweepAngle)>180}sweep(){return this.sweepAngle>=0?1:0}get isCCW(){return this.sweepAngle>=0}endAngle(){return this.startAngle+this.sweepAngle}pointOn(t){t=ht.regularD(t);let i=this.rx,r=this.ry;if(t===0)return this.center.add1(i,0);if(t===90)return this.center.add1(0,r);if(t===180)return this.center.add1(-i,0);if(t===270)return this.center.add1(0,-r);{let s=this.rx2,n=this.ry2,a=Math.tan(ht.toRadians(t)),o=a*a,l=Math.sqrt(s*n/(s+n/o)),h=Math.sqrt(s*n/(n+s*o));return t>90&&t<270&&(h=-h),t>180&&t<360&&(l=-l),isNaN(h)&&(h=0),isNaN(l)&&(l=0),this.center.add1(h,l)}}exchangeSweep(){return _i.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,this.rx,this.ry)}exchangeSweepAndStart(){return _i.build1(this.end(),this.start(),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}exchangeSweep1(){return _i.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle+.01,this.rx,this.ry)}mirrorY(t){let i=this.start(),r=this.end();return i.equals(r)?_i.build3(this.center.mirrorY(),0,360,this.rx,this.ry):_i.build1(i.mirrorY(t),r.mirrorY(t),this.rx,this.ry,this.isLarge(),this.sweepAngle>=0?0:1)}mirror(t=ge.ORIGIN){let i=this.start(),r=this.end();return i.equals(r)?_i.build3(this.center.mirror(t),0,360,this.rx,this.ry):_i.build1(i.mirror(t),r.mirror(t),this.rx,this.ry,this.isLarge(),this.sweep())}sectorArea(){return Math.abs(this.sweepAngle)/360*Math.PI*this.rx*this.ry}area(){let t=Oy.area(this.center,this._start,this.pointOn(this.endAngle()));return this.sectorArea()-t}multiply3(t){let i;t.isMirrored()?i=-this.sweepAngle:i=this.sweepAngle;let r;return t.equals(er.ROT_90)?r=ht.regularD(this.startAngle+90):t.equals(er.ROT_N90)?r=ht.regularD(this.startAngle-90):r=ht.transformD(this.startAngle,t),_i.build3(this.center.multiply3(t),r,i,t.iScale*this.rx,t.iScale*this.ry)}angleIsInArc(t){return t=ht.regularD(t),this.sweepAngle>0?(t<this.startAngle&&(t+=360),this.endAngle()>t):(t>this.startAngle&&(t-=360),this.endAngle()<t)}toBezier(){if(Math.abs(this.sweepAngle)>90)throw new Error("not support!");let t=this.start(),i=this.end(),r=ht.toRadians(this.sweepAngle)/2,s=4/3*(1-Math.cos(r))/Math.sin(r)*this.rx;return new Fe([t,t.add(new ge(s,0).multiply3(er.rotateD(this.startAngle+90))),i.add(new ge(s,0).multiply3(er.rotateD(this.endAngle()-90))),i])}toBezier2(){let t=[];r(this,90);let i=[];return t.forEach(s=>i.push(s.toBezier())),i;function r(s,n){if(Math.abs(s.sweepAngle)>n){let a=s.sweepAngle/2;r(_i.build3(s.center,s.startAngle,a,s.rx,s.ry),n),r(_i.build3(s.center,s.startAngle+a,a,s.rx,s.ry),n)}else t.push(s)}}buildBBox(){let t=FI.getCache().boxCache,i=this.startAngle+this.sweepAngle;if(t[0]=Math.min(this._start.x,this._end.x),t[1]=Math.max(this._start.x,this._end.x),t[2]=Math.min(this._start.y,this._end.y),t[3]=Math.max(this._start.y,this._end.y),this.sweepAngle>0){let r=0;for(;r<i;){if(r>this.startAngle){let s=this.pointOn(r);t[0]=Math.min(t[0],s.x),t[1]=Math.max(t[1],s.x),t[2]=Math.min(t[2],s.y),t[3]=Math.max(t[3],s.y)}r+=90}}else if(this.sweepAngle<0){let r=360;for(;r>i;){if(r<this.startAngle){let s=this.pointOn(r);t[0]=Math.min(t[0],s.x),t[1]=Math.max(t[1],s.x),t[2]=Math.min(t[2],s.y),t[3]=Math.max(t[3],s.y)}r-=90}}return new ls(t[0],t[1],t[2],t[3])}bbox(){return this.__bbox==null&&(this.__bbox=this.buildBBox()),this.__bbox}length(){return Math.abs(this.rx*this.sweepAngle*Math.PI/180)}toString(){return Zc.format("Arc [start=%s, end=%s, rx=%s, ry=%s, center=%s, startAngle=%s, sweepAngle=%s]",this._start,this._end,this.rx,this.ry,this.center,this.startAngle,this.sweepAngle)}stroke(t,i,r){let s=t/2,n=this.rx+s,a=this.ry+s,o=this.rx-s,l=this.ry-s,h=new er;o<0&&(o=-o,h=h.multiply3(er.MIRROR_Y)),l<0&&(l=-l,h=h.multiply3(er.MIRROR_X)),o===0&&(o=.001),l===0&&(l=.001),h=h.setOrigin1(this.center);let c,f;switch(r===this.sweep()?(c=_i.build3(this.center,this.startAngle,this.sweepAngle,n,a),f=_i.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,o,l)):(c=_i.build3(this.center,this.startAngle+this.sweepAngle,-this.sweepAngle,n,a),f=_i.build3(this.center,this.startAngle,this.sweepAngle,o,l)),f=f.multiply3(h),i){case 1:{let d=r===1?180:-180,u=r===this.sweep()?this.pointOn(this.endAngle()):this.pointOn(this.startAngle),p=r===this.sweep()?this.pointOn(this.startAngle):this.pointOn(this.endAngle()),_=c.pointOn(c.endAngle()).angleD(u),g=f.pointOn(f.endAngle()).angleD(p);return xt.build2([c,_i.build3(u,_,d,s,s),f,_i.build3(p,g,d,s,s)])}default:return xt.build2([c,f])}}points2(){let t=Math.ceil(Math.abs(this.sweepAngle)/JY),i=this.sweepAngle/t,r=[this._start];for(let s=1;s<t;s++)r.push(this.pointOn(this.startAngle+i*s));return r.push(this._end),r}points1(t){let i=Math.max(this.rx,this.ry);if(i<=t)return[this.start(),this.svgEnd];let r=(i-t)/i,s=Math.ceil(Math.abs(this.sweepAngle/ht.toDegrees(Math.acos(r))/2)),n=new Array(s+1),a=this.sweepAngle/s,o=this.startAngle;for(let l=0;l<=s;l++,o+=a)n[l]=this.pointOn(o);return n}points(t){let i=Math.max(this.rx,this.ry);if(t=Math.abs(t),i<=t)return[this.start(),this.svgEnd];t=Math.max(t,i*1e-5),t=Math.min(t,i*(1-Math.SQRT1_2));let r=(i-t)/i,s=Math.ceil(Math.abs(this.sweepAngle/ht.toDegrees(Math.acos(r))/2));s=Math.max(s,2);let n=new Array(s+1),a=this.sweepAngle/s,o=this.startAngle+a;n[0]=this.start();for(let l=1;l<s;l++,o+=a)n[l]=this.pointOn(o);return n[s]=this.end(),n}panDistance(t){return this.sweepAngle>0?new _i(this.rx-t,this.ry-t,this.center,this.startAngle,this.sweepAngle):new _i(this.rx+t,this.ry+t,this.center,this.startAngle,this.sweepAngle)}panDistance1(t){if(this.sweepAngle>0){let i=this.rx-t;return i<0?(i=Math.abs(i),_i.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new _i(i,i,this.center,this.startAngle,this.sweepAngle)}else{let i=this.rx+t;return i<0?(i=Math.abs(i),_i.build3(this.center,this.startAngle-180,this.sweepAngle,i,i)):new _i(i,i,this.center,this.startAngle,this.sweepAngle)}}get bulge(){let t=Math.abs(vY(this.sweepAngle,3))/180*Math.PI;return Math.tan(t/4)}get midPoint(){let t=ht.toRadians(this.startAngle),i=ht.toRadians(this.endAngle()),r=this.sweep(),s=this.center,n=this.rx;if(r==1)if(i>t){let a=(i-t)/2+t;return s.add(new ge(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==t)return s.add(new ge(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(i+Ng-t)/2+t;return s.add(new ge(Math.cos(a),Math.sin(a)).mul(n))}}else if(i>t){let a=(t+Ng-i)/2+i;return s.add(new ge(Math.cos(a),Math.sin(a)).mul(n))}else{if(i==t)return s.add(new ge(Math.cos(Math.PI*3/2),Math.sin(Math.PI*3/2)).mul(n));{let a=(t-i)/2+i;return s.add(new ge(Math.cos(a),Math.sin(a)).mul(n))}}}get svgPathData(){return[{type:"M",values:[this._start.x,this._start.y]},{type:"A",values:[this.rx,this.ry,0,this.isLarge()?1:0,this.isCCW,this._end.x,this._end.y]}]}equals(t){let i=ht.regularD(this.startAngle),r=ht.regularD(this.sweepAngle),s=ht.regularD(t.startAngle),n=ht.regularD(t.sweepAngle);return Wn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Wn([r,i],[n,s])||Wn([ht.regularD(i+r)],[s]))}equals1(t){let i=ht.regularD(this.startAngle),r=ht.regularD(this.sweepAngle),s=ht.regularD(t.startAngle),n=ht.regularD(t.sweepAngle);return Wn([this.rx,this.ry,this.center,Math.abs(r)],[t.rx,t.ry,t.center,Math.abs(n)])&&(Wn([r,i],[n,s])||Wn([ht.regularD(i+r)],[s]))}inArea(t,i){let r=t.x,s=t.y,n=this.center,a=this.rx,o=ht.toRadians(this.startAngle);this.sweep()==0&&(o=ht.toRadians(this.endAngle()));let l=ht.toRadians(this.endAngle());this.sweep()==0&&(l=ht.toRadians(this.startAngle));let h=a-i/2,c=a+i/2;var f=r-n.x,d=s-n.y,u=Math.atan2(d,f);if(u<0&&(u+=Ng),o<=l&&u>=o&&u<=l||o>l&&(u>=o&&u<=Ng||u>=0&&u<=l)||o==l){var p=Math.sqrt(f*f+d*d);return p<=c&&p>=h}else{var p=(c+h)/2,_=new ge(n.x+Math.cos(o)*p,n.y+Math.sin(o)*p),g=new ge(n.x+Math.cos(l)*p,n.y+Math.sin(l)*p),b=r-_.x,m=s-_.y,O=r-g.x,y=s-g.y;return b*b+m*m<=i*i/4?!0:O*O+y*y<=i*i/4}}isCircle(){return(we.eq(Math.abs(this.sweepAngle),360)||this._start.equals1(this._end))&&this.rx==this.ry}reverse(){return _i.build3(this.center,this.endAngle(),-this.sweepAngle,this.rx,this.ry)}getAngle(){let t=Math.PI*2;return this.sweep()==1?(this.endAngle()-this.startAngle+t)%t:(this.startAngle-this.endAngle()+t)%t}isValid(){return this.rx>0&&this.ry>0}},GI=new ArrayBuffer(24),ry=new Float64Array(GI),zc=new Int32Array(GI),or,Aae=(or=class{static normal(t,i,r){let s=i.sub(t),n=r.sub(i);return s.cross(n)}constructor(t,i,r){this.x=Ti.normal(t),this.y=Ti.normal(i),this.z=Ti.normal(r),ry[0]=t,ry[1]=i,ry[2]=r,this.hashed=zc[0]^zc[1]^zc[2]^zc[3]^zc[4]^zc[5]}isZeroVector(){return this.x===0&&this.y===0&&this.z===0}hashCode(){return this.hashed}equals(t){return t instanceof or?t.x===this.x&&t.y===this.y&&t.z===this.z:!1}cross(t){return new or(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){var t=this.length();return new or(this.x/t,this.y/t,this.z/t)}sub(t){return new or(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new or(this.x+t.x,this.y+t.y,this.z+t.z)}scale(t){return new or(this.x*t,this.y*t,this.z*t)}neg(){return new or(-this.x,-this.y,-this.z)}multiply4(t){var i=this.x*t.data[0]+this.y*t.data[4]+this.z*t.data[8]+t.data[12],r=this.x*t.data[1]+this.y*t.data[5]+this.z*t.data[9]+t.data[13],s=this.x*t.data[2]+this.y*t.data[6]+this.z*t.data[10]+t.data[14],n=this.x*t.data[3]+this.y*t.data[7]+this.z*t.data[11]+t.data[15];return n!=0?new or(i/n,r/n,s/n):new or(i,r,s)}rotate(t,i){return this.multiply4(DI.rotateAxis(t,i))}toVector2(){return new ge(this.x,this.y)}},or.ORIGIN=new or(0,0,0),or.X_UNIT_VECTOR=new or(1,0,0),or.Y_UNIT_VECTOR=new or(0,1,0),or.Z_UNIT_VECTOR=new or(0,0,1),or);var ki=class qc{static build(t){return t instanceof xt?new qc([new lr([t])]):t instanceof lr?new qc([t]):t}static buildByPolygon(t){return t?new qc([t]):new qc([])}static buildByStroke(t,i,r=1,s){return this.buildByPolygon(lr.buildByStroke(t,i,r,Ly,s))}static buildCircle(t,i){return this.buildByPolygon(lr.buildCircle(t,i))}static buildRect(t){return this.buildByPolygon(lr.buildRect(t))}static buildBBox(t){return this.buildByPolygon(lr.buildBBox(t))}constructor(t){this.items=t.slice()}multiply3(t){return new qc(this.items.map(i=>i.multiply3(t)))}bbox(){return this._bbox||(this._bbox=this.items.reduce((t,i)=>t.ext1(i.bbox()),new Hs).build1()),this._bbox}toPolylineGroups(){return this.items.map(t=>t.toPolylineGroup())}},ei,zt=(ei=class{static isHexFormate(t){return!t||typeof t!="string"?!1:/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)}static of1(t){return this.of2(t>>16&255,t>>8&255,t&255)}static of2(t,i,r,s=255){return new ei(t/255,i/255,r/255,s/255)}static of3(t){t.startsWith("#")&&(t=t.substr(1));let i=t.length;if(i==3)return new ei(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15);if(i==6)return new ei(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255);if(i==8)return new ei(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,parseInt(t.substr(6,2),16)/255);throw new Error("invalid color string")}static of4(t){let i=parseInt(t.r*255+"").toString(16),r=parseInt(t.g*255+"").toString(16),s=parseInt(t.b*255+"").toString(16);return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),("#"+i+r+s).toUpperCase()}static of5(t,i){if(t.startsWith("#")&&(t=t.substr(1)),t.length==3)return new ei(parseInt(t[0],16)/15,parseInt(t[1],16)/15,parseInt(t[2],16)/15,i);if(t.length==6)return new ei(parseInt(t.substr(0,2),16)/255,parseInt(t.substr(2,2),16)/255,parseInt(t.substr(4,2),16)/255,i);throw new Error("invalid color string")}static of6(t,i){return new ei(t.r,t.g,t.b,i)}static of7(t){return t==null?null:ei.of3(t)}constructor(t,i,r,s=1){this.r=Ti.positiveOr0(t),this.g=Ti.positiveOr0(i),this.b=Ti.positiveOr0(r),this.alpha=s}hashCode(){return this.r+this.g+this.b+this.alpha}equals(t,i=!1){let r=this.r===t.r&&this.g===t.g&&this.b===t.b;return i?r:r&&this.alpha===t.alpha}add(t,i,r,s){return new ei(Math.max(0,Math.min(1,this.r+t)),Math.max(0,Math.min(1,this.g+i)),Math.max(0,Math.min(1,this.b+r)),Math.max(0,Math.min(1,this.alpha+s)))}mul(t){return new ei(Math.max(0,Math.min(1,this.r*t)),Math.max(0,Math.min(1,this.g*t)),Math.max(0,Math.min(1,this.b*t)),this.alpha)}mul1(t){return new ei(Math.max(0,this.r*t),Math.max(0,this.g*t),Math.max(0,this.b*t),this.alpha)}getData(){return[this.r,this.g,this.b,this.alpha]}toString(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)}toString1(){let t=(this.r*255).toString(16),i=(this.g*255).toString(16),r=(this.b*255).toString(16),s=(this.alpha*255).toString(16);return t.length<2&&(t="0"+t),i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),"#"+t.substr(0,2)+i.substr(0,2)+r.substr(0,2)+s.substr(0,2)}toRGBA(){let t=this.r*255,i=this.g*255,r=this.b*255;return[t,i,r,this.alpha]}toRGBAString(){let t=this.r*255,i=this.g*255,r=this.b*255;return`rgba(${t},${i},${r},${this.alpha})`}isWHITE(){return this.r===1&&this.g===1&&this.b===1&&this.alpha===1}},ei.WHITE=new ei(1,1,1,1),ei.BLACK=new ei(0,0,0,1),ei.RED=new ei(1,0,0,1),ei.GREEN=new ei(0,1,0,1),ei.BLUE=new ei(0,0,1,1),ei.Gray=ei.of3("#9966ff"),ei.Silver=ei.of3("#D2D2D2"),ei.Golden=ei.of3("#DCAA14"),ei.Pink=ei.of3("#ffaec9"),ei),dI=!1,zI=class{onRTreeBBox(e){}onResultSide(e){}onOriginSide(e){}onSplitedSide(e){}onDebugSide(e){}onSweep(e,t,i,r,s,n){}onIntersect(e,t,i){}onSegment(e,t,i,r,s,n){}onSegment1(e,t,i){if(dI){let r=new ge(e.getX(i),i),s=new ge(t.getX(i),i);this.onSegment(r,e.weight,e,s,t.weight,t)}else this.onSegment(e.start,e.weight,e,t.end,t.weight,t)}onSweep1(e,t,i){if(dI){let r=new ge(e.getX(i),i),s=new ge(t.getX(i),i);this.onSweep(r,e.weight,e,s,t.weight,t)}else this.onSweep(e.start,e.weight,e,t.end,t.weight,t)}},nf=class extends zI{constructor(e){super(),this.plGrps=new Array,this.debug=e}onPolylineGroup(e,t){this.plGrps.push(e)}},pf=class{constructor(e){this.cache={},this.levels=e,this.result=new Array(e),this.weights=new Array(e),this.maxIdx=e-1,this.rule=this.decide.bind(this);let t=1;for(let i=0;i<e;i++)this.weights[i]=t,t*=50}weight(e){return this.weights[e]}decide(e){e=Math.abs(e);let t=this.cache[e];if(t===void 0){let i=e;for(let r=this.maxIdx;r>=0;r--){let s=this.weights[r],n=e/s|0,a=e%s;a>(s/2|0)?(e=s-a,n++):e=a,this.result[r]=n>0}t=this.decide1(this.result),this.cache[i]=t}return t}},ZY=e=>e!==0;var KY=new class extends pf{decide1(e){return e[0]||e[1]}}(2),zg=new class extends pf{decide1(e){return e[0]&&!e[1]}}(2),Hg=new class extends pf{decide1(e){return e[0]&&e[1]}}(2),jg=new class extends pf{decide1(e){return e[0]&&!e[1]||!e[0]&&e[1]}}(2),$Y=(e=>(e[e.UNMARKED=0]="UNMARKED",e[e.INSIDE=1]="INSIDE",e[e.OUTSIDE=2]="OUTSIDE",e[e.INVALID=3]="INVALID",e))($Y||{}),tu=class Xc{constructor(t,i,r,s,n,a,o){this.inters=[],this.connect=new Array,this.previous=null,this.next=null,this.finalGrp=-1,this.trans=NaN,this.outsideWeight=0,this.insideWeight=0,this.invalidWeight=0,this._confidence=0,this._confidence_y=NaN,this._x=NaN,this._x_y=NaN,this.status=0,this.bo=t,this.shape=i,this.baseWeight=r,s.y>n.y?this.weight=-r:s.y==n.y?this.weight=0:this.weight=r,this.start=s,this.end=n,this.polyGrp=a,this.polyIndex=o,this._bbox=new Hs().ext1(i.bbox()).ext2(s).ext2(n).build1(),this.inters.push(s),this.inters.push(n);let l=31,h=1;h=l*h+this.polyGrp,h=l*h+this.polyIndex,this._hashcode=h}static rebuild(t,i,r){if(t instanceof ce||i.distance2(r)<1e-6)return new ce(i,r);if(t instanceof xe){let s=t,n=t.bbox().center().x,a;i.y>r.y?a=n>s.center.x?0:1:a=n>s.center.x?1:0;let o=i.angleD(s.center),l=r.angleD(s.center);return xe.build2(s.center,o,l,s.rx,s.ry,a)}else throw new Error("not supported operation")}updateBbox(){this._bbox=new Hs().ext2(this.start).ext2(this.end).build1()}is(t,i){return t===this.polyGrp&&i===this.polyIndex}confidence(t){if(this._confidence_y!=t){let i=this._bbox.height();if(i!==0)if(Math.abs(t-this._bbox.maxY)>5e-4&&Math.abs(t-this._bbox.minY)>5e-4){let r=1-Math.abs(2*t-this._bbox.maxY-this._bbox.minY)/i;this._confidence=r*1e4|0}else this._confidence=0;else this._confidence=1;this._confidence_y=t}return this._confidence}needCountWeight(){return this.outsideWeight+this.insideWeight+this.invalidWeight<5e3}revokeOutside(t){let i=this.confidence(t);return this.outsideWeight-=i,this.invalidWeight+=i,i}revokeInside(t){let i=this.confidence(t);return this.insideWeight-=i,this.invalidWeight+=i,i}setOutside(t){let i=this.confidence(t);return this.outsideWeight+=i,i}setInside(t){let i=this.confidence(t);return this.insideWeight+=i,i}setInvalid(t){let i=this.confidence(t);return this.invalidWeight+=i,i}prevNot0(){let t=this.previous;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.previous}return null}nextNot0(){let t=this.next;for(;t!=null&&t!=this;){if(t.weight!=0)return t;t=t.next}return null}getX(t){if(this.bo!==null)return(this._x_y!=t||isNaN(this._x))&&(aV(this,t)>0?this._x=ie[0]:this._x=NaN,this._x_y=t),this._x;throw new Error("not supported operation")}voteStatus(){return this.outsideWeight>this.insideWeight&&this.outsideWeight>this.invalidWeight?2:this.insideWeight>this.outsideWeight&&this.insideWeight>this.invalidWeight?1:this.invalidWeight>this.outsideWeight&&this.invalidWeight>this.insideWeight?3:0}reverse(t){if(t===2)if(this.start.y>this.end.y){let i=Xc.rebuild(this.shape,this.end,this.start),r=new Xc(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return hs.addAll(r.connect,this.connect),r}else return this;else if(t===1)if(this.start.y<this.end.y){let i=Xc.rebuild(this.shape,this.end,this.start),r=new Xc(this.bo,i,this.baseWeight,this.end,this.start,this.polyGrp,this.polyIndex);return hs.addAll(r.connect,this.connect),r}else return this;return this}isNeedScan(t){return this.needCountWeight()&&this.confidence(t)>0}hashCode(){return this._hashcode}equals(t){return t instanceof Xc?!(this.polyGrp!==t.polyGrp||this.polyIndex!==t.polyIndex):!1}bbox(){return this._bbox}toString(){return Zc.format("(%d,%d,%d) (%d,%d,%d) %s %s",this.polyGrp,this.polyIndex,this.weight,this.outsideWeight,this.invalidWeight,this.insideWeight,this.start,this.end)}};function QY(e,t){let i=e.bbox(),r=t.bbox(),s=(i.minY+i.maxY)/2,n=(r.minY+r.maxY)/2;return s-n}function eV(e,t){let i=e.bbox(),r=t.bbox(),s=(i.minX+i.maxX)/2,n=(r.minX+r.maxX)/2;return s-n}var Hc=class{constructor(e){if(this.__bbox=null,typeof e<"u")if(e instanceof Array){this.__items=[];for(let t of e)this.add(t)}else this.__items=e,this.__bbox=e.bbox();else this.__items=[]}add(e){if(this.__items instanceof Array)this.__items.push(e),this.__bbox=ls.extend2(this.__bbox,e.bbox());else throw new Error("can't insert multiple item into leaf node")}items(){return this.__items}bbox(){if(this.__bbox!==null)return this.__bbox;throw new Error("bug")}},lf=class{constructor(e){this.changed=!1,this.root=new Hc,this.capacity=e,this.capacity2=e*e,this.itemList=[]}size(){return this.itemList.length}items(){return this.flushWhenNeed(),this.itemList}add(e){this.itemList.push(e),this.changed=!0}remove(e){hs.remove(this.itemList,e),this.changed=!0}clear(){this.changed=!1,this.root=new Hc,this.itemList.length=0}flushWhenNeed(){if(this.changed){let e=new Array;for(let t of this.itemList)e.push(new Hc(t));for(;;){let t=this.organize(e);if(t.length>1)e=t;else break}this.root=new Hc(e),this.changed=!1}}organize(e){lh(e,eV,0,e.length);let t=e.length,i=[];for(let r=0;r<t;)if(r+this.capacity2<=t){let s=r+this.capacity2;lh(e,QY,r,s);for(let n=r;n<s;n+=this.capacity){let a=new Hc(e.slice(n,n+this.capacity));i.push(a)}r=r+this.capacity*this.capacity}else{let s=new Hc(e.slice(r,r+this.capacity));i.push(s),r=r+this.capacity}return i}search(e){this.flushWhenNeed();let t=[],i=[];for(i.push(this.root);;){let r=i.shift();if(typeof r<"u"){let s=r.items();if(s instanceof Array){for(let n of s)if(!e.isSeparated(n.bbox())){let a=n.items();a instanceof Array?i.push(n):t.push(a)}}else e.isSeparated(r.bbox())||t.push(s)}else break}return t}walker(e){this.flushWhenNeed(),this._walker(this.root,0,e)}_walker(e,t,i){this.flushWhenNeed();let r=e.items();if(r instanceof Array)for(let s of r)this._walker(s,t+1,i);else i(r,t)}bbox(){return this.flushWhenNeed(),this.root.bbox()}};function sy(e,t){tV(e.iterator(),t)}function tV(e,t){let i=0;for(;e.hasNext();){let r=e.next();t(i++,r)}}var Lg=new Error("list is empty"),Rg=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},iV=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},rV=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},sh=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Lg;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Lg;return this.remove(e),e.item}addLast(e){return this.first===null||this.last===null?(this.first=new Rg(this,e),this.last=this.first,this.cnt=1,this.first):this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Rg(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Lg;return this.first.item}getLast(){if(this.last===null)throw Lg;return this.last.item}insertAfter(e,t){let i=new Rg(this,t);return e.insertAfter(i),e===this.last&&(this.last=i),this.cnt++,i}insertBefore(e,t){let i=new Rg(this,t);return e.insertBefore(i),e===this.first&&(this.first=i),this.cnt++,i}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new iV(this.first)}listIterator(){return new rV(this.first)}toArray(){let e=new Array(this.cnt),t=this.first,i=0;for(;t!=null;)e[i]=t.item,t=t.next,i++;return e}};function ny(e){throw new Error("")}var Dg=class{constructor(e,t){this.node1=null,this.node2=null,this.key=e,this.value=t}},sV=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().key}},nV=class{constructor(e){this.itors=e}hasNext(){return this.itors.hasNext()}next(){return this.itors.next().value}},Qg=class{constructor(){this.innerList=new sh,this.innerMap={}}replace(e,t){e.node1!==null&&(e.node1.set(t),t.node1=e.node1),e.node2!==null&&(e.node2.set(t),t.node2=e.node2)}clear(){this.innerList.clear();for(let e in this.innerMap)delete this.innerMap[e]}put(e,t){let i=e.hashCode(),r=new Dg(e,t),s=this.innerMap[i];if(s===void 0)return r.node1=this.innerList.add(r),this.innerMap[i]=r,null;if(s instanceof Dg){if(s.key.equals(e))return this.innerMap[i]=r,this.replace(s,r),s.value;{r.node1=this.innerList.add(r);let n=new sh;return s.node2=n.add(s),r.node2=n.add(r),this.innerMap[i]=n,null}}if(s instanceof sh){let n=null;return sy(s,(a,o)=>o.key.equals(e)?(this.replace(o,r),n=o.value,!1):!0),n===null?(r.node1=this.innerList.add(r),r.node2=s.push(r),null):n}return ny(s)}get(e){let t=e.hashCode(),i=this.innerMap[t];if(i===void 0)return null;if(i instanceof Dg)return i.key.equals(e)?i.value:null;if(i instanceof sh){let r=null;return sy(i,(s,n)=>n.key.equals(e)?(r=n.value,!1):!0),r}return ny(i)}containsKey(e){return this.get(e)!==null}delete(e){e.node1!==null&&e.node1.parent.remove(e.node1),e.node2===null?delete this.innerMap[e.key.hashCode()]:e.node2.parent.remove(e.node2)}remove(e){let t=e.hashCode(),i=this.innerMap[t];if(i===void 0)return null;if(i instanceof Dg)return i.key.equals(e)?(this.delete(i),i.value):null;if(i instanceof sh){let r=null;return sy(i,(s,n)=>n.key.equals(e)?(r=n.value,this.delete(n),!1):!0),r}return ny(i)}computeIfAbsent(e,t){let i=this.get(e);if(i===null){let r=t(e);return this.put(e,r),r}else return i}size(){return this.innerList.size()}isEmpty(){return this.innerList.size()===0}keys(){return new sV(this.innerList.iterator())}values(){return new nV(this.innerList.iterator())}entries(){return this.innerList.iterator()}},eu=class{constructor(){this.innerMap=new Qg}add(e){return this.innerMap.put(e,!0)!==!0}remove(e){this.innerMap.remove(e)}contains(e){return this.innerMap.get(e)===!0}iterator(){return this.innerMap.keys()}addAll(e){let t=e.iterator();for(;t.hasNext();)this.add(t.next())}size(){return this.innerMap.size()}clear(){let e=this.iterator();for(;e.hasNext();){let t=e.next();this.remove(t)}}},fI=hs.funcCopy(lh);function aV(e,t){let i=0;if(Math.abs(e.start.y-t)<=1e-4)ie[i++]=e.start.x;else if(Math.abs(e.end.y-t)<=1e-4)ie[i++]=e.end.x;else if(e.shape instanceof ce)i=SY(e.shape,t);else if(e.shape instanceof xe)i=IY(e.shape,t);else throw new Error("not supported operation");return i}var Yg=class{constructor(e,t,i,r){this.sides=new Array,this.loader=e,this.loader.bo=this,this.logger=i,this.rule=t,this.event=r}static sortByBBoxMinY(e,t){return e.bbox().minY-t.bbox().minY}static sortByBBoxAreaDesc(e,t){return t.bbox().area()-e.bbox().area()}addPolyline(e,t=1,i=.01,r=!0){for(let s of this.loader.buildGroup(e,t,i,r))this.sides.push(s),this.event.onOriginSide(s)}buildRTree(){let e=new lf(10);for(let t of this.sides)e.add(t);return e}fillValidSides(e,t,i){for(let r of t)isFinite(r.getX(i))&&e.push(r)}getSortedEndpointsLineAsc(e){let t=new Array;for(let s of e)s.needCountWeight()&&(t.push(s.start),t.push(s.end));fI(t,ge.sortByYAsc,0,t.length);let i=new Array,r=Number.NEGATIVE_INFINITY;for(let s of t){let n=s.y;n>r&&(i.push(n),r=n)}return i}splitSides(e,t,i){let r=e.start,s=e.end,n=new ge(s.x+(r.x-s.x)*2,s.y+(r.y-s.y)*2);fI(e.inters,(o,l)=>o.distance2(n)-l.distance2(n),0,e.inters.length);let a=null;for(let o of e.inters)if(a==null)o.equals(r)&&(a=o);else if(!o.equals(a)){let l=tu.rebuild(e.shape,a,o);l instanceof xe&&Math.abs(l.sweepAngle)>190&&(l=new ce(a,o));let h=new tu(this,l,e.baseWeight,a,o,e.polyGrp,i++);if(t.push(h),h.updateBbox(),o.equals(s))break;a=o}return i}splitSidesByInters(){let e=new Array;for(let t of this.sides)if(t.polyIndex==0){let i=0,r=null,s=null;do{let n=new Array;i=this.splitSides(t,n,i);for(let a of n)r!=null?(r.next=a,a.previous=r):s=a,r=a,this.event.onSplitedSide(a),e.push(a);if(t.next===null)throw new Error("not supported operation");t=t.next}while(t.polyIndex!==0);s!=null&&r!=null&&(s.previous=r,r.next=s)}this.sides.length=0;for(let t of e)this.sides.push(t)}seekIntersection(){if(this.sides.length>0){let e=this.buildRTree(),t=new eu;for(let i of this.sides){t.add(i);let r=i.bbox().extendOfSize(1e-5),s=i.shape instanceof ce;for(let n of e.search(r))if(!t.contains(n)){let a=n.shape instanceof ce;if(!(s&&a&&i.next!==null&&i.previous!==null&&(i.next.equals(n)||i.previous.equals(n)))){let o=bn(i.shape,n.shape);for(let l=0;l<o;l+=2){let h=new ge(ie[l],ie[l+1]);i.inters.push(h),n.inters.push(h),this.event.onIntersect(h,i,n)}}}}}}},oV=class HI{constructor(t){this.sides=new eu,this.others=new eu,this.id=t}add(t){this.sides.add(t),t.finalGrp=this.id;for(let i of t.connect)this.others.add(i)}polyline(){let t=new Array;return Qc(this.sides,(i,r)=>(t.push(r.shape),!0)),xt.build2(t).asClose()}hashCode(){return this.id}equals(t){return t!=null&&t instanceof HI?this.id===t.id:!1}},jI=class{constructor(e){this.bo=null,this.sides=new Array,this.polyGrp=0,this.polyIndex=0,this.prevSide=null,this.firstSide=null,this.noWeight0=e}completeGroup(e){this.prevSide!=null&&this.firstSide!=null&&!this.prevSide.end.equals(this.firstSide.start)&&this.addSide(new ce(this.prevSide.end,this.firstSide.start),e);let t=new Array,i=null,r=null;for(let s of this.sides)(!this.noWeight0||s.weight!==0)&&(i!=null?(i.next=s,s.previous=i):r=s,i=s,t.push(s));return i!=null&&r!=null&&(r.previous=i,i.next=r),this.polyGrp++,this.sides.length=0,this.prevSide=null,this.firstSide=null,this.polyIndex=0,t}buildGroup(e,t,i,r=!0){for(let s of e.primitives)if(s instanceof ce)this.addSide(s,t);else if(r&&s instanceof xe&&s.rx===s.ry)this.addArc(s,t);else{let n=null;for(let a of s.points(i))n!=null&&this.addSide(new ce(n,a),t),n=a}return this.completeGroup(t)}addArc(e,t){let i=e.sweepAngle,r=ht.regularD(e.startAngle),s=r+i;if(i>0){let n=90;for(;n<=s;)n>r&&(this.addSide(xe.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n+=90;r<s&&this.addSide(xe.build3(e.center,r,s-r,e.rx,e.ry),t)}else if(i<0){let n=270;for(;n>=s;)n<r&&(this.addSide(xe.build3(e.center,r,n-r,e.rx,e.ry),t),r=n),n-=90;r>s&&this.addSide(xe.build3(e.center,r,s-r,e.rx,e.ry),t)}}addSide(e,t){if(e.start().equals(e.end()))return;let i=e.start(),r;this.prevSide!=null?(this.prevSide.end.equals(i)||this.addSide(new ce(this.prevSide.end,i),t),r=new tu(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++)):(r=new tu(this.bo,e,t,e.start(),e.end(),this.polyGrp,this.polyIndex++),this.firstSide=r),this.prevSide=r,this.sides.push(r)}},YI=class{constructor(e,t,i){this.eps=new Array,this.curWeight=0,this.start=null,this.last=null,this.prevStart=null,this.prevEnd=null,this.y=i,this.rule=e,this.bo=t,this.event=t.event}onEp(e){this.tuningWeight(e),this.start===null?this.rule(this.curWeight)?this.in(e):e.setInvalid(this.y):this.rule(this.curWeight)?e.setInvalid(this.y):this.out(e,this.start),this.last!==null&&this.event.onSweep1(this.last,e,this.y),this.last=e}in(e){this.prevEnd!=null&&this.onSameX(e,this.prevEnd)?(this.start=this.prevStart,this.prevStart=null,this.prevEnd.revokeInside(this.y),this.prevEnd=null):(this.start=e,this.start.setOutside(this.y))}out(e,t){if(this.onSameX(t,e))t.revokeOutside(this.y);else{if(e.setInside(this.y)>0&&t.confidence(this.y)>0){let i=t.voteStatus(),r=e.voteStatus();this.isValid(i)&&this.isValid(r)?i==2&&r==1&&(e.connect.push(t),t.connect.push(e)):(e.connect.push(t),t.connect.push(e))}this.event.onSegment1(t,e,this.y),this.eps.push(t),this.eps.push(e),this.prevStart=t,this.prevEnd=e}this.start=null}isValid(e){return e==1||e==2}onSameX(e,t){return e.bbox().isIntersect(t.bbox())&&we.eq(e.getX(this.y),t.getX(this.y))}tuningWeight(e){this.curWeight+=e.weight;let t=e.nextNot0(),i=e.prevNot0();t!=null&&e.weight===t.weight&&t.trans===this.y&&(this.curWeight-=e.weight),i!=null&&e.weight===i.weight&&i.trans===this.y&&(this.curWeight-=e.weight),e.trans=this.y}},eO=new Error,pI=new class extends pf{decide1(e){return e[0]&&e[1]}}(2),lV=new class extends zI{onPolylineGroup(e,t){throw eO}onSegment(e,t,i,r,s,n){throw eO}},hV=class{constructor(e,t){this.rtree=e,this.level=t}},cV=class VI extends Yg{static isIntersect(t,i,r=sO.DUMMY){let s=new VI(r),n=s.createGroup1(t.items),a=s.createGroup2(i.items);return n.rtree.itemList.length==0||a.rtree.itemList.length==0?!1:s.isIntersect(n,a)}constructor(t){super(new jI(!1),pI.rule,t,lV)}createGroup1(t){return this.createGroup(t,0)}createGroup2(t){return this.createGroup(t,1)}createGroup(t,i){let r=pI.weight(i);for(let n of t)this.addPolyline(n,r);let s=this.buildRTree();return this.sides.length=0,new hV(s,i)}isIntersect(t,i){if(t.level!==i.level){let r=t.rtree.bbox().intersection1(i.rtree.bbox());if(r!==null){try{this.inters(t,i);let s=(r.minY+r.maxY)/2;this.sweep(t,i,s)}catch(s){if(s===eO)return!0;throw s}return!1}else return!1}else throw new Error("inersection detection should not in same group")}inters(t,i){if(t.rtree.size()>i.rtree.size()){let r=t;t=i,i=r}for(let r of t.rtree.items()){r.trans=NaN;let s=r.bbox().extendOfSize(1e-5);for(let n of i.rtree.search(s))if(n.trans=NaN,bn(r.shape,n.shape)>0)throw eO}}sweep(t,i,r){let s=ls.extend2(t.rtree.bbox(),i.rtree.bbox()).extendOfSize(1e-5),n=new Array;this.fillValidSides(n,t.rtree.search(s),r),this.fillValidSides(n,i.rtree.search(s),r),lh(n,(o,l)=>o.getX(r)-l.getX(r),0,n.length);let a=new YI(this.rule,this,r);for(let o of n)a.onEp(o)}},Ry=class po{constructor(t){this.items=new Array(t.length),hs.arraycopy(t,0,this.items,0,t.length),this.__bbox=this.calcBBox()}static build1(t){let i=[];return Xg(t,(r,s)=>(i.push(s),!0)),new po(i)}static build2(t){let i=t.map(r=>xt.build8(r));return new po(i)}static combinePolylineGroupArr(t){let i=[];for(let r of t)i=i.concat(r.items);return new po(i)}calcBBox(){let t=new Hs;for(let i=0;i<this.items.length;i++)t.ext1(this.items[i].bbox());return t.build1()}multiply3(t){let i=new Array(this.items.length);for(let r=0;r<i.length;r++)i[r]=this.items[r].multiply3(t);return new po(i)}bbox(){return this.__bbox}asClose(){return this.items.forEach(t=>t.asClose()),this}mirrorY(t){return this.items.forEach(i=>i.mirrorY(t)),this}closeEndpoint(){return this.items.forEach(t=>t.closeEndpoint()),this}get primitives(){return this.items.map(t=>t.primitives).flat(2)}isEqual(t){return t instanceof po?this.items.every(i=>t.items.some(r=>r.isEqual(i))):!1}getOutMostPolyline(){return this.items.reduce((t,i)=>i.bbox().area()>t.bbox().area()?i:t,this.items[0])}getOutline(){let t=this.items;if(t.length===1)return{outline:t,hole:new Array};let i=new Set,r=new Set;for(let s=0,n=t.length;s<n;s++){let a=t[s];if(!i.has(a)&&!r.has(a)){s+1>=n&&i.add(a);for(let o=s+1;o<n;o++){let l=t[o];if(!i.has(l)&&!r.has(l)){if(!a.bbox().isInside(l.bbox().extendOfSize(1e-4))&&!l.bbox().isInside(a.bbox().extendOfSize(1e-4)))continue;cV.isIntersect(new po([a]),new po([l]))&&(a.bbox().area()>l.bbox().area()?(i.add(a),r.add(l)):(i.add(l),r.add(a)))}}!i.has(a)&&!r.has(a)&&i.add(a)}}return{outline:[...i],hole:[...r]}}round(t=4){let i=this.items.map(r=>r.round(t));return new po(i)}},uV=hs.funcCopy(lh),dV=hs.funcCopy(lh),fV=hs.funcCopy(lh);function pV(e){return new Array}function _V(e,t){let i=new nf(!1),r=new af(e,sO.DUMMY,i);for(let s of t)r.addPolyline(s);return r.simplify(),i.plGrps}var af=class extends Yg{constructor(e,t,i){super(new jI(!1),e,t,i),this.finalSides=new Array,this.sideGroups={},this.vecSides=new Array,this.scanY=NaN,this.curNetIndex=0,this.curIndex=-1,this.scanLines=0}sweep(e,t,i){this.scanY=NaN,this.scanLines=0,uV(t,Yg.sortByBBoxMinY,0,t.length);let r=new sh;this.curNetIndex=0;let s=Number.POSITIVE_INFINITY;for(let n of e)n>s&&this.scan(r,(s+n)/2,t),s=n;this.getAllMarkPrimitive(i,t),this.logger.debug3("scan %s %d",i,this.scanLines)}simplify(){this.seekIntersection(),this.splitSidesByInters(),this.sweep(this.getSortedEndpointsLineAsc(this.sides),this.sides,!1),this.flipSides(),this.sweep(this.getSortedEndpointsLineAsc(this.vecSides),this.vecSides,!0),this.connectSides(),this.fillResult()}addPolyline(e,t=1,i=.01,r=!0){super.addPolyline(e,t,i,r)}scan(e,t,i){if(this.scanY==t)return;this.scanY=t;let r=!1,s=e.listIterator();for(;s.hasNext();){let n=s.next(),a=n.item;we.less(a.bbox().maxY,t)?e.remove(n):!r&&a.isNeedScan(t)&&(r=!0)}for(;this.curNetIndex<i.length;){let n=i[this.curNetIndex];if(we.less(n.bbox().minY,t))we.greatereq(n.bbox().maxY,t)&&(this.add2AET(e,n),!r&&n.isNeedScan(t)&&(r=!0)),this.curNetIndex++;else break}if(r){this.scanLines++;let n=new YI(this.rule,this,t),a=e.iterator();for(;a.hasNext();){let o=a.next();n.onEp(o)}}}add2AET(e,t){let i=t.bbox().minX,r=t.bbox().maxX,s=t.bbox().minY,n=t.bbox().maxY,a=e.listIterator(),o=null;for(;a.hasNext();){let l,h=a.next(),c=h.item,f=c.bbox().minX,d=c.bbox().maxX;if(r<=f)l=-1;else if(d<=i)l=1;else{let p=c.bbox().minY,_=c.bbox().maxY,g=Math.max(s,p),b=Math.min(n,_);l=this.compareBySweep(t,c,(g+b)/2)}let u=c.shape;if(u instanceof ce&&u.length()<.001&&o==null&&l<0){o=h;continue}if(o!=null&&l<0){e.insertBefore(o,t);return}if(l<0){e.insertBefore(h,t);return}else o=null}e.add(t)}getLineAngle(e){let t=e.start().angle(e.end());return t<0&&(t+=Math.PI),t}getArcAngle(e,t){let i=Math.asin((t-e.center.y)/e.rx);return e.startAngle>90&&e.startAngle<270&&(i=-i),i<0&&(i+=Math.PI),(i+Math.PI/2)%Math.PI}compareArcLine(e,t,i){let r=this.getArcAngle(e,i),s=this.getLineAngle(t);return we.eq(r,s)?-e.sweepAngle:s-r}compareBySweep(e,t,i){let r=e.getX(i);if(!isFinite(r))return 0;let s=t.getX(i);if(!isFinite(s))return 0;if(!we.eq(r,s))return r-s;if(e.shape instanceof ce)return t.shape instanceof ce?this.getLineAngle(t.shape)-this.getLineAngle(e.shape):-this.compareArcLine(t.shape,e.shape,i);if(t.shape instanceof ce)return this.compareArcLine(e.shape,t.shape,i);{let n=e.shape,a=t.shape,o=this.getArcAngle(n,i),l=this.getArcAngle(a,i);return we.eq(o,l)?n.sweepAngle*a.sweepAngle<=0?n.sweepAngle<=0?1:-1:n.sweepAngle>0?n.rx-a.rx:a.rx-n.rx:l-o}}getAllMarkPrimitive(e,t){for(let i of t)if(i.status===0&&i.bbox().height()!=0){let r=i.voteStatus();if(r===2||r===1){i.status=r;let s=i.reverse(r);if(e){this.event.onResultSide(s);let n=s.shape.multiply3(er.ROT_N90),a=s.start.multiply3(er.ROT_N90),o=s.end.multiply3(er.ROT_N90);s=new tu(this,n,s.baseWeight,a,o,s.polyGrp,s.polyIndex)}this.finalSides.push(s),this.event.onResultSide(s)}}}flipSides(){for(let e of this.sides)if(e.polyIndex==0){let t=null,i=null;do{let r=e.shape.multiply3(er.ROT_90),s=e.start.multiply3(er.ROT_90),n=e.end.multiply3(er.ROT_90),a=new tu(this,r,e.baseWeight,s,n,e.polyGrp,e.polyIndex);if(a.outsideWeight=e.outsideWeight,a.insideWeight=e.insideWeight,a.invalidWeight=e.invalidWeight,a.status=e.status,t!=null?(t.next=a,a.previous=t):i=a,this.vecSides.push(a),this.event.onSplitedSide(a),t=a,e.next!==null)e=e.next;else break}while(e.polyIndex!=0);i!=null&&(i.previous=t,t.next=i)}}canBeEnd(e,t){if(e.size()==1){let i=e.getFirst().shape;if(i instanceof xe){if(t&&i.rx<=t)return!1}else if(i instanceof ce&&t&&i.length()<=t)return!1}return!0}connectSides(){let e=new Qg,t=new lf(10);for(let n of this.finalSides)e.computeIfAbsent(n.start,pV).push(n),t.add(n.start);let i=0,r=new eu,s=new Array;for(let n of this.finalSides)if(!r.contains(n)){let a=new eu,o=n.start,l=new sh;l.add(n),r.add(n);let h=n.end;for(;l.size()>0;)if(this.isStart(o,h)&&this.canBeEnd(l,.01)){l.size()>1&&this.fillSideGroups(l,i++);break}else{let c=e.get(h),f=this.findNext(r,c);if(f==null&&(h=this.findNeigber(h,a,t,.01),h!==null&&(c=e.get(h),f=this.findNext(r,c))),f!=null)l.add(f),r.add(f),h=f.end;else if(h!=null?a.add(h):(s.length==0&&l.size()>1&&this.logger.warning3("unable to connect at %s",l.getLast()),s.push(l.removeLast())),l.size()>0)h=l.getLast().end;else break}}}fillSideGroups(e,t){let i=new oV(t);Qc(e,(r,s)=>(i.add(s),!0)),this.sideGroups[i.id]=i}isStart(e,t){return e.distance2(t)<=1e-4}findNext(e,t){if(t!=null){for(let i of t)if(!e.contains(i))return i}return null}fillResult(){let e=0,t=new Qg;for(let r in this.sideGroups){let s=this.sideGroups[r];Qc(s.sides,(n,a)=>(a.polyGrp!=-2&&t.put(a,a),!0))}let i=new eu;for(let r in this.sideGroups){let s=this.sideGroups[r];if(i.add(s)){let n=0,a=new Array;for(a.push(s);n<a.length;){let l=a[n],h=new Array;Qc(l.others,(f,d)=>{let u=t.get(d);return u!=null&&h.push(u.finalGrp),!0}),dV(h,hs.sortAsc,0,h.length);let c=l.id;for(let f of h)if(f!=c&&f!=l.id){let d=this.sideGroups[f];i.add(d)&&a.push(d),c=f}n++}let o=new Array;for(let l of a)o.push(l.polyline());fV(o,Yg.sortByBBoxAreaDesc,0,o.length),this.event.onPolylineGroup(new Ry(o),e++)}}}findNeigber(e,t,i,r){let s=r*r,n=Number.MAX_VALUE,a=null;for(let o of i.search(e.bbox().extendOfSize(r)))if(!t.contains(o)){let l=e.distance2(o);l<n&&(n=l,a=o)}return n<s?a:null}},gV=class{constructor(){this.points=[],this.lines=[],this.arcs=[],this.beziers=[],this.listText=[],this.fonts=[]}addPt(e,t=!0){if(e instanceof ce)this.lines.push(e);else if(e instanceof xe)this.arcs.push(e);else if(e instanceof Fe)this.beziers.push(e);else throw new Error("not support");t&&this.points.push(e.start())}addPoint(e){this.points.push(e)}addText(e,t,i=1,r=.1,s=!0){this.listText.push({pos:e,str:t,size:i,width:r}),s&&this.points.push(e)}addPly(e,t=!0){e.primitives.forEach(i=>this.addPt(i,t))}build(){let e=[],t=[],i=[],r=[],s=[],n=[];return this.points.forEach(a=>e.push(a.x,a.y)),this.lines.forEach(a=>t.push(a.start().x,a.start().y,a.end().x,a.end().y)),this.arcs.forEach(a=>i.push(a.center.x,a.center.y,a.rx,ht.toRadians(a.startAngle),ht.toRadians(a.endAngle()),a.sweep())),this.beziers.forEach(a=>{a.controls.forEach(o=>{r.push(o.x,o.y)}),r.push("end")}),this.listText.forEach(a=>s.push(a.pos.x,a.pos.y,a.str,a.width,a.size)),this.fonts.forEach(a=>n.push(a)),{points:e,lines:t,arcs:i,texts:s,beziers:r,fonts:n}}},pl,_f=(pl=class{constructor(t){this.map=new Qg,this.bus=t}initColor(t){return this.map.computeIfAbsent(t,()=>new gV)}draw(){let t={},i=this.map.entries();for(;i.hasNext();){let r=i.next();t[r.key.toString()]=r.value.build()}this.bus.publish("/debug/draw",t)}clear(){this.map.clear()}static init(t){if(!t)throw new Error("bus is undefined!");this.palette=new pl(t)}static initPalette(t){this.palette=t}static getDefaultColor(){for(let t of this.colorBuffersMap)if(t[0]!==null&&t[0])return t[0]=!1,t[1];return this.colorBuffersMap.forEach(t=>{if(t[0]===null){console.log(1);return}t[0]=!0}),this.getDefaultColor()}static clear(){this.palette.clear()}static auto(t,i=this.getDefaultColor()){if(Array.isArray(t))t.forEach(r=>{this.auto(r,i)});else if(t instanceof ge)this.point(t,i);else if(t instanceof ls)this.bbox(t,i);else if(t instanceof ff)this.primitive(t,i);else if(t instanceof xt)this.polyline(t,i);else if(t instanceof lr)this.polygon(t,i);else if(t instanceof ki)this.group(t,i);else if(t instanceof Ry)this.auto(t.items,i);else{debugger;throw new Error("No incoming type!")}}static text(t,i,r=.5,s=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");this.palette.initColor(s).addText(t,i,r,r/10),this.palette.draw()}static point(t,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(i);Array.isArray(t)?t.forEach(s=>{this.point(s,i)}):r.addPoint(t),this.palette.draw()}static bbox(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.bbox(r,i)}):(this.primitive(new ce(new ge(t.maxX,t.maxY),new ge(t.maxX,t.minY)),i),this.primitive(new ce(new ge(t.maxX,t.maxY),new ge(t.minX,t.maxY)),i),this.primitive(new ce(new ge(t.minX,t.minY),new ge(t.maxX,t.minY)),i),this.primitive(new ce(new ge(t.minX,t.minY),new ge(t.minX,t.maxY)),i))}static primitive(t,i=this.getDefaultColor()){if(!this.palette)throw new Error("palette  is not initialised!");let r=this.palette.initColor(i);Array.isArray(t)?t.forEach(s=>{this.primitive(s,i)}):r.addPt(t),this.palette.draw()}static polyline(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polyline(r,i)}):t.primitives.forEach(r=>{this.primitive(r,i)})}static polygon(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.polygon(r,i)}):t.items.forEach(r=>{this.polyline(r,i)})}static group(t,i=this.getDefaultColor()){Array.isArray(t)?t.forEach(r=>{this.group(r,i)}):t.items.forEach(r=>{this.polygon(r,i)})}static async begin(){this.t1=performance.now()}static async end(t){console.log(t||"t1:",performance.now()-this.t1)}static async log(t){console.log(t||"==================")}},pl.colorBuffersMap=[[!0,zt.BLUE],[!0,zt.GREEN],[!0,zt.WHITE],[!0,zt.RED],[!0,zt.Golden],[!0,zt.Gray]],pl.t1=0,pl),OV=0,gf=class by{constructor(t,i){this.inters=[],this.shape=t,this.start=t.start(),this.end=t.end(),this.judgeOverlapMap=new Map,i&&(this.id=OV++)}reverse(){this.shape=this.shape.reverse();let t=this.start;this.start=this.end,this.end=t}getCenterPoint(t=this.end){let{x:i,y:r}=this.start,{x:s,y:n}=t;if(this.shape instanceof xe){let a=this.shape.rx,o=new ge((i+s)/2,(r+n)/2),l=this.shape.center,h;return o.x!==l.x||o.y!==l.y?(h=o.angle(l),Math.abs(this.shape.sweepAngle)>180&&(h+=h>=0?-180:180)):h=(this.shape.startAngle+this.shape.endAngle())/2,new ge(l.x+Math.cos(h)*a,l.y+Math.sin(h)*a)}else{if(this.shape instanceof ce)return new ge((i+s)/2,(r+n)/2);if(this.shape instanceof Fe){let a=this.shape.getPercent(t,st);return Fe.pointOn(a/2,this.shape.controls)}else throw Error("not support")}}static finalAngle(t,i,r){let s=t.cross(i)>0,n=Math.acos(Math.min(1,Math.max(-1,t.dot(i)/i.length())));return(r?!s:s)&&(n=nO-n),n}sortInters(){if(this.shape instanceof xe){let t=this.shape.center,i=this.shape.start().sub(t).normalize(),r=this.shape.isCCW;this.inters.sort((s,n)=>{let a=s.coord.sub(t),o=n.coord.sub(t);return by.finalAngle(i,a,r)-by.finalAngle(i,o,r)<=0?-1:1})}else if(this.shape instanceof ce){let t=this.start,i=this.end,r=new ge(i.x+(t.x-i.x)*2,i.y+(t.y-i.y)*2);this.inters.sort((s,n)=>s.coord.distance2(r)-n.coord.distance2(r)<=0?-1:1)}else if(this.shape instanceof Fe){let t=this.shape;this.inters.sort((i,r)=>t.getPercent(i.coord,st)-t.getPercent(r.coord,st)<=0?-1:1)}else throw Error("not support the primitive type");this.inters.forEach((t,i)=>t.setIndex(i))}getStart(){return this.start}getEnd(){return this.end}getShape(){return this.shape}connect(t){this.nextSide=t,t.prevSide=this}static returnPolygonList(t){let i=[];return t.forEach(r=>{let s=[];r.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),s.push(xt.build7(o))}),i.push(new lr(s))}),i}addInter(t){this.inters.push(t)}static returnPolygonGroup(t){let i=[];return t.forEach(r=>{let s=[];r.forEach((n,a)=>{let o=[];n.forEach(l=>{o.push(l.shape)}),s.push(xt.build7(o))}),i.push(new lr(s))}),new ki(i)}static rebuild(t,i,r){let s;if(t instanceof ce||i.distance2(r)<1e-6)s=new ce(i,r);else if(t instanceof xe)s=xe.build2(t.center,i.angleD(t.center),r.angleD(t.center),t.rx,t.ry,t.isCCW?1:0);else if(t instanceof Fe){let n=t.getPercent(i,st),a=t.clip(n)[1];s=a.clip(a.getPercent(r,st))[0]}else throw new Error("not supported operation");return rt(t,i).dot(rt(s,i))<0?null:s}static returnPolyline(t){return xt.build7(t.map(i=>i.shape))}bbox(){return this.shape.bbox()}},mV=(e=>(e[e.END1=0]="END1",e[e.END2=1]="END2",e[e.END12=2]="END12",e[e.LEFT1=3]="LEFT1",e[e.LEFT2=4]="LEFT2",e))(mV||{});function cs(e,t,i){if(e instanceof xe&&t instanceof xe)return xV(e,t);if(e instanceof xe&&t instanceof ce)return OI(e,t);if(e instanceof ce&&t instanceof xe)return gI(e,t);if(e instanceof ce&&t instanceof ce)return nh(e,t);if(e instanceof Fe&&t instanceof ce)return e.controls.length===2||mo(e)?nh(new ce(e.start(),e.end()),t):qI(e,t);if(e instanceof ce&&t instanceof Fe)return t.controls.length===2||mo(t)?nh(e,new ce(t.start(),t.end())):xy(e,t);if(e instanceof xe&&t instanceof Fe)return t.controls.length===2||mo(t)?OI(e,new ce(t.start(),t.end())):yV(e,t);if(e instanceof Fe&&t instanceof xe)return e.controls.length===2||mo(e)?gI(new ce(e.start(),e.end()),t):bV(e,t);if(e instanceof Fe&&t instanceof Fe)return Dy(e,t);throw new Error("not support")}function jc(e,t){return rt(e,t.start()).dot(rt(t,t.start()))<=0?!1:cs(e,t).state<=2}function ay(e,t){let i=t.getPercent(e.end(),st);if(i===null)return!1;if(i===0)return!0;let r=t.clip(i)[0],s=e.buildConverxHull(st),n=r.buildConverxHull(st),a=h(s),o=h(n);return l(a,o);function l(c,f){let d=new Map([[0,1],[1,0],[2,2],[3,4],[4,3]]),u=c[0],p=f[0];if(!u||!p)throw Error("isAllOverlap(sides1: PackSide[], sides2: PackSide[])");let _=!0;do{let g=u.getShape(),b=p.getShape();if(g instanceof ce&&b instanceof ce){let m=_?nh(g,b).state:d.get(nh(b,g).state);if(m===0)u=u.nextSide,_=!1;else if(m===1)p=p.nextSide,_=!0;else if(m===2)u=u.nextSide,p=p.nextSide,_=!0;else return!1}else throw Error("not support")}while(u!==c[0].prevSide&&p!==f[0].prevSide);return!0}function h(c){let f=c.primitives.map(u=>new gf(u)),d=f[f.length-1];return f.forEach(u=>{d.connect(u),d=u}),f}}function _I(e,t){let i=e.end().distance2(t.center);if(i>(t.rx+st)**2||i<(t.rx-st)**2||!(Xe(e.end(),t.end())||My(t,e.end())))return!1;if(e.center.equals1(t.center))return!0;let r=e.center.distance1(t.center),s=Math.abs(e.rx-t.rx);if(r>Math.min(e.rx,t.rx)){let n=e.center.angleD(t.center);return e.rx>t.rx?!(r+s>st&&va(e,n))&&!(r-s>st&&e.rx+t.rx-r>st&&va(e,n+180)):!(r-s>st&&va(e,n))&&!(e.rx+t.rx-r>st&&va(e,n+180))}else{if(r+s<=st)return!0;let n=e.rx>t.rx?e.center.angleD(t.center):t.center.angleD(e.center);return va(e,n)?!1:r-s<=st?!0:!va(e,n+180)}}function yV(e,t){let i=By(e,t.start()).toBezier2(),r,s=0;for(let n=i.length;s<n;s++){let a=i[s];if(r=Dy(a,t).state,r!==0)break}return r===2&&s!==i.length-1?{state:1}:{state:r}}function bV(e,t){let i=t.toBezier2(),r,s=0;for(let n=i.length;s<n;s++){let a=i[s];if(r=Dy(e,a).state,r!==1)break}return r===2&&s!==i.length-1?{state:0}:{state:r}}function Dy(e,t){if(e.controls.length===2||mo(e))return t.controls.length===2||mo(t)?nh(new ce(e.start(),t.end()),new ce(t.start(),t.end())):xy(new ce(t.start(),e.end()),t);if(t.controls.length===2||mo(t))return qI(vy(e,t.start()),new ce(t.start(),t.end()));let i=vy(e,t.start());if(mo(i))return xy(new ce(t.start(),e.end()),t);let r=ay(i,t),s=ay(t,i);if(!r&&!s){let n=BY(i,t);if(n.havOverlap){let a=n.havOverlap!==2,o=n.havOverlap!==1;return vo(e,t,a,o)}else{let a=function(){for(let f=0;f<h;f+=2)ie[f]=c[f],ie[f+1]=c[f+1]},o,l,h=n.cnt,c=new Array(h).fill(0).map((f,d)=>ie[d]);for(let f=0;f<h;f+=2){let d=new ge(ie[f],ie[f+1]),u=i.getPercent(d,st),p=t.getPercent(d,st);if(u===0||p===0)continue;let _=u===1?i:i.clip(u)[0],g=p===1?t:t.clip(p)[0];if(ay(_,g)){let b=rt(e,d).cross(rt(t,d));if(b===0){o=i.end(),l=t.end();break}return{state:b<0?3:4}}a()}return(!o||!l)&&(o=Kc(i.controls,i.controls[0],t),l=Kc(t.controls,i.controls[0],i)),{state:o.sub(i.controls[0]).cross(l.sub(i.controls[0]))>0?4:3}}}return vo(e,t,r,s)}function qI(e,t){let i=vy(e,t.start());if(mo(i))return nh(new ce(i.start(),i.end()),t);let r=WI(i,t),{isIn:s,bezierIsInLeft:n}=XI(t,i);if(!r&&!s){if(n!==void 0)return{state:n?3:4};let a=null,o=e.getPercent(t.start(),st)+.01;for(let l=o>1?1:o;l<=1;){let h=Fe.pointOn(l,e.controls);if(hf(t,h)>us){a=h;break}l+=.01,l>1&&(l=1)}if(!a)throw Error("!end1 && !end2 not result");return{state:t.direct.cross(a.sub(t.start()))<0?4:3}}return vo(i,t,r,s)}function xy(e,t){let{isIn:i,bezierIsInLeft:r}=XI(e,t),s=WI(t,e);if(!i&&!s){if(r!==void 0)return{state:r?4:3};let n=null;for(let a=.01;a<=1;){let o=Fe.pointOn(a,t.controls);if(hf(e,o)>us){n=o;break}a+=.01,a>1&&(a=1)}if(!n)throw Error("!end1 && !end2 not result");return{state:e.direct.cross(n.sub(e.start()))<0?3:4}}return vo(t,e,i,s)}function xV(e,t){let i=_I(By(e,t.start()),t),r=_I(t,e);if(!i&&!r){let s=Zn(t);if(e.center.sub(t.start()).dot(t.center.sub(t.start()))>0){if(e.rx===t.rx)return e.isCCW?{state:s.dot(e.center.sub(t.center))<0?3:4,exitIsInvalid:!1}:{state:s.dot(e.center.sub(t.center))>0?3:4,exitIsInvalid:!1};let n,a;return e.rx>t.rx?(n=e,a=t):(n=t,a=e),s.dot(a.center.sub(n.center))>0&&a.rx+a.center.distance1(n.center)-n.rx>st?e.isCCW?{state:e.rx>t.rx?3:4,exitIsInvalid:!1}:{state:e.rx<t.rx?3:4,exitIsInvalid:!1}:e.isCCW?{state:e.rx<t.rx?3:4,exitIsInvalid:!0}:{state:e.rx>t.rx?3:4,exitIsInvalid:!0}}else return e.rx+t.rx-e.center.distance1(t.center)>st&&s.dot(e.center.sub(t.center))>0?{state:t.isCCW?3:4,exitIsInvalid:!1}:{state:e.isCCW?3:4,exitIsInvalid:!0}}return vo(e,t,i,r)}function gI(e,t){let i=Jn.foot(e,t.center),r=e.end().distance2(t.center),s=e.end().sub(e.start()),n=(t.rx-st)**2,a=r<=(t.rx+st)**2&&r>=n&&(s.dot(i.sub(t.start()))<=0||e.start().distance2(e.end())<=e.start().distance2(i)||i.distance2(t.center)>=n)&&(Xe(e.end(),t.end())||My(t,e.end())),o=JI(t,e);if(!a&&!o){let l=e.distance2(t.center);return l<=us?{state:s.cross(Zn(t))>0?4:3}:s.dot(i.sub(t.start()))>=0&&(r<n||e.start().distance2(t.center)<n||l<n)?{state:s.cross(t.center.sub(e.start()))<0?4:3}:{state:s.cross(t.center.sub(e.start()))>0?4:3}}return vo(t,e,a,o)}function va(e,t){return t=ht.regularD(t),e.sweepAngle>0?(t<e.startAngle&&(t+=360),e.endAngle()>t):(t>e.startAngle&&(t-=360),e.endAngle()<t)}function My(e,t){return Xe(e.end(),t)||Xe(e.start(),t)||va(e,t.angleD(e.center))}function XI(e,t){let i=e.panDistance(st),r=e.panDistance(-st),s=mI(t,i),n=mI(t,r);if(!s.length&&!n.length)return{isIn:t.getPercent(e.end(),st)!==null};let a=[...s,...n].sort((c,f)=>c.t-f.t),o=new ce(r.start(),i.start()),l=[];for(let c=0,f=a.length;c<f;c++){let d=a[c];if(l.push(d),o.distance(d.interP)>e.length()+st)break;if(l.length===2){let u=(l[1].t*10+l.shift().t*10)/20,p=Fe.pointOn(u,t.controls);if(e.distance2(p)>us)return{isIn:!1,bezierIsInLeft:e.direct.cross(p.sub(e.start()))>0}}}let h=l.length?o.distance(l[0].interP)>=e.length()+st:!0;return{isIn:h,bezierIsInLeft:h?void 0:e.direct.cross(l[0].interP.sub(e.start()))>0}}function WI(e,t){if(hf(t,e.end())>us||e.getToLineMaxDis2(t)>us)return!1;let i=EV(t,us);return e.getToLineMaxDis2(i)<=(t.length()+st)**2}function JI(e,t){let i=t.end().angleD(t.start()),r=vV(t,e.end());if(r>us)return!1;if(va(e,i+90)){if(Jn.foot(t,e.center).distance1(e.pointOn(i+90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}if(va(e,i-90)){if(Jn.foot(t,e.center).distance1(e.pointOn(i-90))>e.rx)return!1;r=Math.max(r,(e.rx-t.distance(e.center))**2)}return r<=us&&(Xe(e.end(),t.end())||Ey(t,e.end()))}var ZI=(st*2)**2;function By(e,t){if(Xe(e.end(),t))return xe.build3(e.center,e.endAngle(),0,e.rx,e.ry);if(e.start().distance2(t)<ZI)return e;let i=ht.regularD(t.angleD(e.center));if(!va(e,i))throw new Error("!angleIsInArc(arc, angle)");return xe.build2(e.center,i,e.endAngle(),e.rx,e.ry,e.isCCW?1:0)}function vy(e,t){if(Xe(e.end(),t))return new Fe([t,t]);if(e.start().distance2(t)<ZI)return e;let i=e.getPercent(t,st);if(i===null)throw new Error("!cutBezier(bezier: Bezier, p: Vector2)");return e.clip(i)[1]}function OI(e,t){let i=JI(By(e,t.start()),t),r=t.end().distance2(e.center),s=t.end().sub(t.start()),n=Jn.foot(t,e.center),a=(e.rx-st)**2,o=r<=(e.rx+st)**2&&r>=a&&(s.dot(n.sub(t.start()))<=0||t.start().distance2(t.end())<=t.start().distance2(n)||n.distance2(e.center)>=a)&&(Xe(e.end(),t.end())||My(e,t.end()));if(!i&&!o){let l=t.distance2(e.center);return l<=us?{state:s.cross(Zn(e,t.start().angle(e.center)))>0?3:4}:s.dot(n.sub(t.start()))>=0&&(r<a||t.start().distance2(e.center)<a||l<a)?{state:s.cross(e.center.sub(t.start()))>0?4:3}:{state:s.cross(e.center.sub(t.start()))<0?4:3}}return vo(t,e,i,o)}function nh(e,t){if(Xe(e.end(),t.end()))return vo(e,t,!0,!0);let i=hf(t,e.end())<=us&&Ey(t,e.end()),r=hf(e,t.end())<=us&&Ey(e,t.end());if(!i&&!r){let s=e.direct.x===0&&e.direct.y===0,n=t.direct.x===0&&t.direct.y===0;if(s&&n)throw Error("2LineAllIsPoint");return s?{state:t.direct.cross(e.end().sub(t.start()))>0?3:4}:{state:e.end().sub(e.start()).cross(t.end().sub(e.start()))>0?4:3}}return vo(e,t,i,r)}function Ey(e,t){return Jn.foot(e,t).distance2(e.start())<e.end().distance2(e.start())}function vo(e,t,i,r){if(i)return r?Xe(e.end(),t.end())?{state:2}:{state:0}:{state:0};if(r)return{state:1};throw new Error("!end1 && !end2")}function hf(e,t){return(e.a*t.x+e.b*t.y+e.c)**2/(e.a**2+e.b**2)}function vV(e,t){return Math.min(e.distance2(t),Jn.foot(e,t).distance2(t))}function EV(e,t){let i=e.panDistance(t),r=e.panDistance(-t);return new ce(r.start(),i.start())}function mo(e){let t=e.start(),i=e.end();t.equals1(i)&&(i=t.add1(1,0));let r=i.y-t.y,s=t.x-i.x,n=-r*t.x-s*t.y,a=Math.sqrt(1/(r**2+s**2));r*=a,s*=a,n*=a;let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;return e.controls.forEach(h=>{let c=r*h.x+s*h.y+n;c<o&&(o=c),c>l&&(l=c)}),Ia(o,l)}function mI(e,t){let i=bn(e,t),r=[],s=new Array(i).fill(0).map((a,o)=>ie[o]);for(let a=0;a<i;a+=2){let o=new ge(ie[a],ie[a+1]),l=e.getPercent(o);r.push({interP:o,t:l}),n()}function n(){for(let a=0;a<i;a+=2)ie[a]=s[a],ie[a+1]=s[a+1]}return r}var xa=.01,TV=270;function _l(e){let t=xa**2,i=e.end(),r=[],s=[];for(let u=0,p=e.primitives.length;u<p;u++){let _=function(R,B){return R instanceof ce&&B instanceof ce&&Math.abs(R.direct.cross(B.direct))<we.eps&&R.direct.dot(B.direct)>0||R instanceof xe&&B instanceof xe&&Math.abs(R.rx-B.rx)<=we.eps&&R.center.distance2(B.center)<we.eps&&R.isCCW===B.isCCW},g=function(R){if(tn(R,xa))s.push(null);else{if(R instanceof ce)s.push(R);else if(R instanceof xe&&R.rx===R.ry)f(R,s);else if(R instanceof Fe){let B=[];UI(R,B),B.forEach(Y=>{let G=Y.start(),z=Y.end();c(G,z)||s.push(Y)})}else throw new Error("not support!");i=y}},b=function(R){if(R instanceof ce)return R.direct.x===0&&R.direct.y===0;if(R instanceof xe)return R.sweepAngle===0;if(R instanceof Fe){let B=new Set(R.controls.map(G=>G.x)),Y=new Set(R.controls.map(G=>G.y));return B.size===1&&Y.size===1}else throw new Error("not support")},m=e.primitives[u],O=m.start(),y=m.end();if(b(m))continue;c(i,O)||(s.push(new ce(i,O)),i=O);let x=(u+1)%p,E=e.primitives[x];for(;_(m,E)&&(x=(x+1)%p,E=e.primitives[x],E!==m););if(x===(u+1)%p){g(m);continue}if(E===m){if(!(m instanceof xe)){if(Math.abs(e.area(.1))<t)return null;throw new Error("simplifyPolyline not support")}let R=m instanceof xe?m.isCCW:e.area(.1)>0;s.length=0;let B=R?180:-180;s.push(xe.build3(m.center,m.startAngle,B,m.rx,m.ry),xe.build3(m.center,m.startAngle+B,B,m.rx,m.ry));break}let w=(()=>{if(m instanceof ce)return(R,B)=>{let Y=new ce(R,B);return tn(Y,xa)?null:[Y]};if(m instanceof xe)return(R,B)=>{let Y;if(R.equals1(B)?Y=xe.build3(m.center,m.startAngle,m.sweep()===1?360:-360,m.rx,m.ry):Y=xe.build4(R,B,m.center,m.rx,m.ry,m.sweep()),tn(Y,xa))return null;let G=Y.pointOn(Y.startAngle+Y.sweepAngle/2),z=xe.build4(Y.start(),G,m.center,m.rx,m.ry,m.sweep()),q=xe.build4(G,Y.end(),m.center,m.rx,m.ry,m.sweep());return tn(z,xa)||tn(q,xa)?[Y]:[z,q]};throw new Error("not support")})(),S=x===0;if(x<u&&!S&&(S=!w(e.primitives[0].start(),e.primitives[x-1].end()),!S)){let R=w(m.start(),e.primitives[p-1].end());if(R)s.push(...R);else{let B=w(m.start(),s[0].end());if(B.length===1)s[0]=B[0];else if(B.length===2)s[0]=B[1],s.push(B[0]);else throw new Error("!!!generatorPt")}break}u=x===0?p-1:x-1,E=e.primitives[u];let C=w(m.start(),E.end());if(C?(C.forEach(R=>s.push(R)),i=E.end()):g(null),S)break}let n=s.length;if(s.forEach((u,p)=>{if(u)r.push(u);else{let _,g;p===n-1&&(_=r[0],g=r[r.length-1]);let b=(p+1)%n;if(_=_!=null?_:s[b],_){let m=p,O=!1;for(;g=g!=null?g:s[(--m+n)%n],g!==_;)if(g){O=!0;break}if(O){if(_.start().equals1(g.end()))return;if(rt(g,g.end()).dot(rt(_,_.start()))<0){if(!c(g.end(),_.start())){let w=new ce(g.end(),_.start());r.push(w);return}let{rebuildPrevPt:y,rebuildNextPt:x,rebuildLinkLine:E}=yI(s[(m-1+n)%n],g,new ce(g.end(),_.start()),_,s[(p+2)%n]);y&&x&&(y!==g?(s[(m+n)%n]=y,r[r.length-1]&&(r[r.length-1]=y)):x!==_&&(s[(p+1)%n]=x,r[0]===_&&(r[0]=x)),E&&r.push(E))}}}}}),r.length===0)return null;c(i,r[0].start())||r.push(new ce(i,r[0].start()));let a=r[r.length-1];if(r.length===1)return a instanceof xe?xt.build7([xe.build2(a.center,0,180,a.rx,a.ry,a.sweep()),xe.build2(a.center,180,360,a.rx,a.ry,a.sweep())]):a instanceof Fe?xt.build7(a.clip(.5)):null;let o=r.map(u=>new wV(u)),l=o[o.length-1];for(o.forEach(u=>{u.connect(l),l=u});!l.isVisited;){let u=function(){l.next.connect(_),l=l.next,l.isConnected=!1,l.isVisited=!1},p=function(){l.connect(_.prev),l.isConnected=!1},_=l.prev;if(l===_)break;let g=l.pt,b=_.pt,m=b.end();if(!l.isConnected&&!m.equals(g.start())){let O=function(x){l.isConnected=!0,l.pt=g=x,l.next.isVisited=!1},y=function(x){l.isConnected=!0,_.pt=x,_.isVisited=!1,l=_};if(g instanceof ce)if(c(m,g.end())){u();continue}else O(new ce(m,g.end()));else if(b instanceof ce){c(b.start(),g.start())?p():y(new ce(b.start(),g.start()));continue}else if(g instanceof Fe)if(c(m,g.end())&&!(g.controls.length!==2&&g.getToLineMaxDis2(g.startToEndL)>=t)){u();continue}else O(new Fe([m,...g.controls.slice(1)]));else if(b instanceof Fe)c(b.start(),g.start())&&!(b.controls.length!==2&&b.getToLineMaxDis2(b.startToEndL)>=t)?p():y(new Fe([...b.controls.slice(0,-1),g.start()]));else if(g instanceof xe&&b instanceof xe)if(Math.abs(Math.abs(g.sweepAngle)-180)<Math.abs(Math.abs(b.sweepAngle)-180)){let x=xe.build5(m,g.end(),g.sweepAngle);if(c(x.start(),x.end())&&!(x.rx>=xa&&Math.abs(x.sweepAngle)>180)){u();continue}else O(x)}else{let x=xe.build5(b.start(),g.start(),b.sweepAngle);c(x.start(),x.end())&&!(x.rx>=xa&&Math.abs(x.sweepAngle)>180)?p():y(x);continue}else throw new Error("not support")}if(rt(g,g.start()).dot(rt(b,b.end()))<0){let O=function(E,w,S,C,R,B){if(l.next===_){l=null;return}let{rebuildLinkLine:Y,rebuildPrevPt:G,rebuildNextPt:z}=yI(E,w,S,C,R);G&&z&&(G!==w&&(_.prev.pt=G),z!==C&&(l.next.pt=z),Y?B.pt=Y:u())},y=function(){l.next===_?l=null:(l.next.connect(_.prev),l=l.next,l.isConnected=!1,l.isVisited=!1)},x=cs(b.reverse(),g).state;if(x===0){let E=bI(g,b.start(),g.end());if(d(E)){let w=_.prev.pt,S=l.next.pt;if(rt(S,S.start()).dot(rt(w,w.end()))>=0){if(y(),!l)break;continue}if(O(_.prev.prev.pt,w,E instanceof ce?E:new ce(E.start(),E.end()),S,l.next.next.pt,l),!l)break}else l.pt=E;p();continue}else if(x===1){let E=bI(b,b.start(),g.end());if(d(E)){let w=_.prev.pt,S=l.next.pt;if(rt(S,S.start()).dot(rt(w,w.end()))>=0){if(y(),!l)break;continue}if(O(_.prev.prev.pt,w,E instanceof ce?E:new ce(E.start(),E.end()),S,l.next.next.pt,_),!l)break}else _.pt=E;u();continue}else if(x===2){if(y(),!l)break;continue}}l.isVisited=!0,l=l.next}if(!l)return null;r.length=0;let h=l;for(r.push(l.pt),l=l.next;l!==h;)r.push(l.pt),l=l.next;if(r.length===1){let u=r[0];return u instanceof xe?(c(u.start(),u.end())?r[0]=xe.buildCircle(u.center,u.rx,u.sweep()):r.push(new ce(u.end(),u.start())),xt.build7(r)):u instanceof Fe?(c(u.start(),u.end())||r.push(new ce(u.end(),u.start())),xt.build7(r)):null}if(e=xt.build7(r),Math.abs(e.area(.1))<t)return null;return e;function c(u,p){return u.distance2(p)<t}function f(u,p){if(Math.abs(u.sweepAngle)>TV){let _=u.sweepAngle/2;f(xe.build3(u.center,u.startAngle,_,u.rx,u.ry),p),f(xe.build3(u.center,u.startAngle+_,_,u.rx,u.ry),p)}else p.push(u)}function d(u){return u.start().distance2(u.end())<t&&!(u instanceof xe&&u.rx>=xa&&Math.abs(u.sweepAngle)>180||u instanceof Fe&&u.controls.length!==2&&u.getToLineMaxDis2(new ce(u.start().add1(1,0),u.end()))>=t)}}function tn(e,t){if(!e)return!0;let i=e.start(),r=e.end();if(i.distance2(r)<t**2)if(e instanceof xe){if(!(e.rx>=t&&Math.abs(e.sweepAngle)>180))return!0}else if(e instanceof Fe){if(!(e.controls.length!==2&&e.getToLineMaxDis2(new ce(e.start().add1(1,0),e.end()))>=t))return!0}else return!0;return!1}function Yc(e){if(e.direct.x===0&&e.direct.y===0)throw Error("getEndOfExtendLine(line: Line, distance: number)");let t=Math.abs(xa-e.length())+we.eps,i={x:e.direct.normalize().x*t,y:e.direct.normalize().y*t},r=e.end();return new ge(r.x+i.x,r.y+i.y)}function yI(e,t,i,r,s){if(!e)a();else if(!s)o();else{let l=rt(e,e.end()),h=rt(t,e.end()),c=l.dot(h);if(c>=0)a();else{let f=rt(r,r.end()),d=rt(s,r.end()),u=f.dot(d);if(u>=0)o();else if(Ia(c,-1)&&Ia(u,-1)){let p=i.center();n(p),i=null}else c>u?a():o()}}function n(l){let h;if(t instanceof ce)h=new ce(t.start(),l);else if(t instanceof Fe)h=new Fe([...t.controls.slice(0,-1),l]);else if(t instanceof xe)h=xe.build5(t.start(),l,t.sweepAngle);else throw new Error("not supported");t=tn(h,st)?null:h;let c;if(r instanceof ce)c=new ce(l,r.end());else if(r instanceof Fe)c=new Fe([l,...r.controls.slice(1)]);else if(r instanceof xe)c=xe.build5(l,r.end(),r.sweepAngle);else throw new Error("supported");r=tn(c,st)?null:c}function a(){if(t instanceof ce){let l=Yc(i.reverse());i=new ce(l,i.end());let h=new ce(t.start(),l);t=tn(h,st)?null:h}else if(t instanceof Fe){let l=Yc(i.reverse());i=new ce(l,i.end());let h=new Fe([...t.controls.slice(0,-1),l]);t=tn(h,st)?null:h}else if(t instanceof xe){let l=Yc(i.reverse());i=new ce(l,i.end());let h=xe.build5(t.start(),l,t.sweepAngle);t=tn(h,st)?null:h}else throw new Error("not supported")}function o(){if(r instanceof ce){let l=Yc(i);i=new ce(i.start(),l);let h=new ce(l,r.end());r=tn(h,st)?null:h}else if(r instanceof Fe){let l=Yc(i);i=new ce(i.start(),l);let h=new Fe([l,...r.controls.slice(1)]);r=tn(h,st)?null:h}else if(r instanceof xe){let l=Yc(i);i=new ce(i.start(),l);let h=xe.build5(l,r.end(),r.sweepAngle);r=tn(h,st)?null:h}else throw new Error("not supported")}return{rebuildPrevPt:t,rebuildNextPt:r,rebuildLinkLine:i}}function bI(e,t,i){if(e instanceof ce||t.distance2(i)<=us)return new ce(t,i);if(e instanceof xe)return xe.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.isCCW?1:0);if(e instanceof Fe){let r=e.getPercent(t,st),s=e.getPercent(i,st);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}var wV=class{constructor(e){this.pt=e}connect(e){this.prev=e,e.next=this}};function tO(e){let t=Of(),i;if(e instanceof xt){let r=_l(e);if(r===null)return null;i=r}else if(e instanceof lr){let r=e.items.map(s=>tO(s)).filter(s=>s!==null);if(r.length===0)return null;i=new lr(r)}else{let r=e.items.map(s=>tO(s)).filter(s=>s!==null);if(r.length===0)return null;i=new ki(r)}return wa.preprocessPolyline+=dl(t),i}var wa={addDocShapes2RTree:0,getPour:0,prepare:0,getSinglePourLayerPolyline:0,combindOutlines:0,mergeSameNet:0,run:0,end:0,deSelfIntersection:0,changeDirect:0,extend:0,preprocessPolyline:0,runBoolean:0,IntersectionSeeker:0,BooleanTools:0,totalBool:0};function Of(){return{timeIndex:Object.assign({},wa),start:performance.now()}}function xI(e){return Object.values(e).reduce((t,i)=>t+i,0)}function dl(e){return performance.now()-e.start-(xI(wa)-xI(e.timeIndex))}function Sr(e,t,i,r){let s=zt.RED,n=zt.Golden;function a(){if(!r)return;let d=r.initColor(zt.Golden);d.addPt(o),d.addPoint(o.end()),r.initColor(zt.RED).addPt(l),r.draw();debugger}let o=e.getShape(),l=i?t.getShape():t.getShape().reverse(),h=rt(o,l.start()),c=rt(l),f=h.cross(c);if(Ia(f,0))if(o instanceof ce)if(l instanceof ce){if(we.eq(f,0)&&(h.dot(c)>0?!Xe(o.end(),l.start()):!Xe(o.start(),l.start())))throw a(),new Error("line and line");return f<0}else{if(l instanceof xe)return h.cross(l.center.sub(o.start()))<0;if(l instanceof Fe){let d=l.getExtremePoints(o),u=d.length?d[0]:Kc(l.controls,o.start());return h.cross(u.sub(o.start()))<0}else throw new Error("not support")}else if(o instanceof xe){if(l instanceof ce)return o.isCCW;if(l instanceof xe){if(l.center.equals1(o.center)&&(h.dot(c)>0?!Xe(o.end(),l.start())&&o.end().sub(l.start()).dot(c)>0:!Xe(o.start(),l.start())&&o.start().sub(l.start()).dot(c)>0))throw a(),new Error("arc and arc");return l.rx>=o.rx||l.center.distance2(o.center)>o.rx2?o.isCCW:!o.isCCW}else throw new Error("not support")}else if(o instanceof Fe)if(l instanceof ce){let d=o.getPercent(l.start(),st),u=o.clip(d)[1],p=u.getExtremePoints(l);return(p.length?p[0]:Kc(u.controls,l.start())).sub(l.start()).cross(c)<0}else if(l instanceof Fe){let d=o.getPercent(l.start(),st),u=o.clip(d)[1],p=u.getExtremePoints(new ce(l.start(),l.end())),_=l.getExtremePoints(new ce(u.start(),u.end())),g=p.length?p[0]:Kc(u.controls,l.start()),b=_.length?_[0]:Kc(l.controls,l.start()),m=g.sub(l.start()),O=b.sub(l.start());return m.cross(O)<0}else throw Error("not support");else throw new Error("not support");else return f<0}function hh(e,t,i,r,s){let n=e.getShape(),a=t.getShape(),o=n instanceof xe?Zn(n,ht.toRadians(n.endAngle())):n instanceof Fe?of(n,1):n.end().sub(n.start()).normalize(),l=rt(a),h=o.dot(l);if(Ia(h,-1))return Sr(e,t,!0,s)?Sr(e,i,r,s)&&Sr(t,i,r,s):Sr(e,i,r,s)||Sr(t,i,r,s);{let c=o.scale(-1).angle(ge.ORIGIN),f=l.angle(ge.ORIGIN);c>f&&(c-=nO);let d=(c+f)/2,u=new ge(Math.cos(d),Math.sin(d)),p=r?i.getShape():i.getShape().reverse(),_=rt(p);return u.cross(_)<0?Sr(e,i,r,s):Sr(t,i,r,s)}}function oy(e,t,i,r,s){let n=e.getShape(),a=t.getShape(),o=n instanceof xe?Zn(n,ht.toRadians(n.endAngle())):n instanceof Fe?of(n,1):n.end().sub(n.start()).normalize(),l=rt(a),h=o.dot(l);if(Ia(h,-1))return Sr(e,t,!0,s)?Sr(e,i,r,s)&&Sr(t,i,r,s):Sr(e,i,r,s)||Sr(t,i,r,s);{let c=o.scale(-1).angle(ge.ORIGIN),f=l.angle(ge.ORIGIN);c>f&&(c-=nO);let d=(c+f)/2,u=new ge(Math.cos(d),Math.sin(d)),p=r?i.getShape():i.getShape().reverse(),_=rt(p);if(u.cross(_)<0){let g=o.dot(_)<0,b=cs(g?e.getShape().reverse():e.getShape(),p).state;return b!==3&&b!==4?Sr(e,i,r,s):b===(g?4:3)}else{let g=l.dot(_)<0,b=cs(g?t.getShape().reverse():t.getShape(),p).state;return b!==3&&b!==4?Sr(t,i,r,s):b===(g?4:3)}}}var SV=(e=>(e[e.NOT_IN=0]="NOT_IN",e[e.IS_IN=1]="IS_IN",e[e.IS_OVERLAP=2]="IS_OVERLAP",e))(SV||{}),IV=(e=>(e[e.AllClear=0]="AllClear",e[e.MapClear=1]="MapClear",e))(IV||{}),Ea,fl=!1;function rn(e,t,i,r,s,n,a,o=i.side===t,l=!0,h){return Ea=s,fl=n,KI($I(e,t,l,h,a,i,o,r),i,o,r,0)}function _o(e,t,i,r,s,n,a,o=r.side===i){Ea=s,fl=n;let l=QI(e,t,i,new Map,r,o,a),h=l instanceof Array?-1:1;return KI(l,r,o,a,h)}function KI(e,t,i,r,s){for(;e instanceof Array;)s++,e.length===4?e=QI(...e,t,i,r):e=$I(...e,t,i,r);return{...e,existOverlap:s>0}}function $I(e,t,i,r,s,n,a,o){if(iO===-1){o.initColor(zt.RED).addPt(e.getShape()),o.initColor(zt.Golden).addPt(t.getShape()),o.draw();debugger}let l=e.getShape(),h=a?t.getShape().reverse():t.getShape(),c=(l instanceof xe?Zn(l,i?h.start().angle(l.center):r?ht.toRadians(l.endAngle()):void 0):l instanceof Fe?rt(l,i?h.start():r?l.end():l.start()):l.end().sub(l.start())).normalize(),f=(h instanceof xe?Zn(h,i?void 0:(r?l.end():l.start()).angle(h.center)):h instanceof Fe?rt(h,i?void 0:r?l.end():l.start()):h.end().sub(h.start())).normalize();if(r===void 0){let p=c.dot(f);if(r=p<0,Ia(p,0))return{state:Sr(e,t,!a,o)?1:0,inter:go(e,t,n,a,i,r,s)}}else if(r?c.dot(f)>0:c.dot(f)<0)if(i){let p,_=!0;if(l instanceof ce&&Xe(Jn.foot(l,h.start()),r?l.end():l.start()))_=!1;else if(l instanceof xe||l instanceof Fe){let g=r?l.reverse():l,b=cs(h,zY(g,h.start()).reverse()).state;(b===1||b===2)&&(_=!1)}if(_){let g=!r;p=cs(g?l.reverse():l,h,o).state===(g?4:3)?1:0}else r?p=hh(e,e.nextSide,t,!a,o)?1:0:p=hh(e.prevSide,e,t,!a,o)?1:0;return{state:p,inter:go(e,t,n,a,i,r,s)}}else return r?{state:Sr(e,e.nextSide,!0,o)?0:1,inter:go(e,t,n,a,i,r,s),isReversed:!0}:{state:Sr(e.prevSide,e,!0,o)?0:1,inter:go(e,t,n,a,i,r,s),isReversed:!0};let d,u=new Map([[3,4],[4,3],[0,1],[1,0],[2,2]]);if(i)if(e.judgeOverlapMap.has(t)&&!fl){let p=e.judgeOverlapMap.get(t);d=r?u.get(p.state):p.state}else d=cs(r?l.reverse():l,h).state,(d===3||d===4)&&e.judgeOverlapMap.set(t,{state:r?u.get(d):d});else{if(t.judgeOverlapMap.has(e)&&!fl){let p=t.judgeOverlapMap.get(e);d=a?u.get(p.state):p.state}else d=cs(h,r?l.reverse():l).state,(d===3||d===4)&&t.judgeOverlapMap.set(e,{state:a?u.get(d):d});d=u.get(d)}if(d===1||d===2){let p=a?t.prevSide:t,_=p.inters,g=p.getEnd();for(let b=_.length-1;b>=0;b--){let m=_[b];if(!(p.getShape()instanceof Fe)&&!Xe(g,m.coord))break;if(m===n)return{state:2,inter:go(e,t,n,a,i,r,s)}}}if(d===3||d===4)return{state:d===(r?4:3)?1:0,inter:go(e,t,n,a,i,r,s)};if(s.has(e)?s.get(e).mapSideList.push(t):s.set(e,{sideIsReversed:r,mapSideList:[t]}),s.has(t)?s.get(t).mapSideList.push(e):s.set(t,{sideIsReversed:a,mapSideList:[e]}),d===2)return r?[e.prevSide,e,a?t.prevSide:t.nextSide,s]:[e,e.nextSide,a?t.prevSide:t.nextSide,s];if(d===0)return[r?e.prevSide:e.nextSide,t,!1,r,s];if(d===1)return[e,a?t.prevSide:t.nextSide,!0,r,s];throw Error("not support")}function go(e,t,i,r,s,n,a){if(fl)return null;let o=e.getShape(),l=r?t.getShape().reverse():t.getShape(),h=r;if(!s){let u=t;t=e,e=u,r=n,i=i.getBindedInter()}let c=u=>!(s?n:h)&&Xe(u,e.prevSide.getEnd())?e.prevSide:e;if(r){let u=t.inters;for(let p=0;p<u.length;p++){let _=u[p];if(_.isInvalid&&n===void 0)continue;if(_===i&&Xe(l.start(),i.coord))return s?_:_.getBindedInter();let g=_.getBindedInter().side,b=c(_.coord);if(g===b&&f(_))return d(_)}for(;;){t=t.nextSide;let p=t.inters;for(let _=0;_<p.length;_++){let g=p[_];if(g===i)return s?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||Xe(g.coord,b.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return d(g);if(a.has(b)){let m=t.getShape().reverse(),O=rt(m,g.coord).dot(rt(b.getShape(),g.coord))<0,y=O?b.getShape().reverse():b.getShape(),x=cs(m,O?iy(y,g.coord,y.end()):iy(y,y.start(),g.coord)).state;if(x===1||x===2)return d(g)}else a.has(b.nextSide)}else if(g.side===i.side&&f(g))return d(g)}}}else{let u=t.inters;for(let p=u.length-1;p>=0;p--){let _=u[p];if(_.isInvalid&&n===void 0)continue;if(_===i&&Xe(l.start(),i.coord))return s?_:_.getBindedInter();let g=_.getBindedInter().side,b=c(_.coord);if(g===b&&f(_))return d(_)}for(;;){t=t.prevSide;let p=t.inters;for(let _=p.length-1;_>=0;_--){let g=p[_];if(g===i)return s?g:g.getBindedInter();if(a.has(t)){let b=g.getBindedInter().side;if(a.get(t).mapSideList.includes(b)||Xe(g.coord,g.getBindedInter().side.getEnd())&&a.get(t).mapSideList.includes(b.nextSide))return d(g);if(!a.has(b)&&a.has(b.prevSide)){let m=t.getShape().reverse(),O=rt(m,g.coord).dot(rt(b.getShape(),g.coord))<0;if(a.has(b.prevSide)){let y=O?b.getShape().reverse():b.getShape(),x=cs(t.getShape(),iy(y,g.coord,y.end())).state;if(x===1||x===2)return d(g)}}}else if(g.side===i.side&&f(g))return d(g)}}}function f(u){if(u.isInvalid||u.getBindedInter().side!==(Xe(u.coord,e.prevSide.getEnd())?e.prevSide:e))return!1;let p;if(s){if(Xe(u.coord,l.start()))return!0;p=cs(n?o.reverse():o,_(l)).state}else{if(Xe(u.coord,n?o.end():o.start()))return!0;p=cs(l,_(n?o.reverse():o)).state}return p===2||p===1;function _(g){if(g instanceof ce)return Xe(u.coord,g.end())?g:g.cutLine(u.coord);if(g instanceof xe)return xe.build2(g.center,g.startAngle,u.coord.angleD(g.center),g.rx,g.ry,g.isCCW?1:0);if(g instanceof Fe)return g.clip(g.getPercent(u.coord,st))[0];throw new Error("not supported operation")}}function d(u){let p=i.getBindedInter(),_=i.side,g=p.side,b=i===u,m=i;if(r){let O=i.getIndex()-1;for(;_;){let y=_.inters;for(;O>=0;O--)if(i=y[O],i===u){b||(i.setIsInvalid(),i.isDealed(),m=i),_=null;break}else if(Ea===0)!i.isInvalid&&(!Xe(i.coord,u.coord)||i.side===u.side&&i.getBindedInter().side===u.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),m=i);else if(Ea===1){if(i.isInvalid)continue;let x=i.getBindedInter().side;a.has(_)&&a.get(_).mapSideList.includes(x)&&(i.setIsInvalid(),i.isDealed(),m=i)}_=_==null?void 0:_.prevSide,O=(_==null?void 0:_.inters.length)-1}}else{let O=i.getIndex()+1;for(;_;){let y=_.inters;for(;O<y.length;O++){i=y[O];let x=i.getBindedInter();if(i===u){b||(i.setIsInvalid(),i.isDealed(),m=i),_=null;break}else if(Ea===0)!i.isInvalid&&(!Xe(i.coord,u.coord)||_===u.side&&(Xe(x.side.getEnd(),i.coord)?x.side.nextSide:x.side)===u.getBindedInter().side)&&(i.setIsInvalid(),i.isDealed(),m=i);else if(Ea===1){let E=x.side;a.has(_)&&a.get(_).mapSideList.includes(E)&&(i.setIsInvalid(),i.isDealed(),m=i)}}_=_==null?void 0:_.nextSide,O=0}}if(Ea===0&&!Xe(p.coord,u.coord))if(s?a.has(g)?a.get(g).sideIsReversed:n:h){let O=p.getIndex()-1;for(;g;){let y=a.has(g),x=g.inters;for(;O>=0;O--){if(p=x[O],p===u.getBindedInter()){g=null;break}p.isInvalid||!y||(!Xe(p.coord,u.getBindedInter().coord)||p.side===u.side&&p.getBindedInter().side===u.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.prevSide,O=(g==null?void 0:g.inters.length)-1}}else{let O=p.getIndex()+1;for(;g;){let y=g.inters,x=a.has(g);for(;O<y.length;O++){if(p=y[O],p===u.getBindedInter()){g=null;break}let E=Xe(g.getEnd(),p.coord)?a.has(g.nextSide):!1;p.isInvalid||!(x||E)||(!Xe(p.coord,u.getBindedInter().coord)||p.side===u.side&&p.getBindedInter().side===u.getBindedInter().side)&&(p.setIsInvalid(),p.isDealed())}g=g==null?void 0:g.nextSide,O=0}}return s?m:m.getBindedInter()}}function QI(e,t,i,r,s,n,a){let o=e.getShape(),l=t.getShape(),h=n?i.getShape().reverse():i.getShape(),c=(o instanceof xe?Zn(o,h.start().angle(o.center)):o instanceof Fe?rt(o,h.start()):o.end().sub(o.start())).normalize(),f=(l instanceof xe?Zn(l,h.start().angle(l.center)):l instanceof Fe?rt(l,h.start()):l.end().sub(l.start())).normalize(),d=c.dot(f);if(Ia(d,-1)){let u=n?i.getShape().reverse():i.getShape(),p=rt(u).normalize(),_=c.add(f.scale(-1)).normalize().dot(p),g=cs(o.reverse(),l,a).state;if(_>-.9&&(g===3||g===4))return{state:g===4?0:1,inter:go(t,i,s,n,!0,!1,r)};let b=rn(e,i,s,a,Ea,fl,r.size===0?new Map:r,n);return b.state===2?b:g===4?b.state===0||b.inter!==s?b:rn(t,i,s,a,Ea,fl,r.size===0?new Map:r,n):b.state===1||b.inter!==s?b:rn(t,i,s,a,Ea,fl,r.size===0?new Map:r,n)}else{let u=c.scale(-1).angle(ge.ORIGIN),p=f.angle(ge.ORIGIN);u>p&&(u-=nO);let _=(u+p)/2,g=new ge(Math.cos(_),Math.sin(_)),b=rt(h).normalize(),m=b.angle(ge.ORIGIN),O=u<m&&m<p&&o instanceof ce&&l instanceof ce&&h instanceof ce;if(g.cross(b)<=0){if(c.scale(-1).dot(b)<0){let y;return s.coord.equals1(h.start())?y=rt(o,s.coord).dot(rt(h,s.coord))<0:h instanceof ce&&(y=rt(o,o.end()).dot(h.direct)<0),{state:hh(e,t,i,!n,a)?1:0,inter:go(e,i,s,n,!0,y,r)}}return O&&o.distance2(h.start())>us?[t,i,!0,void 0,r]:[e,i,!0,void 0,r]}else return f.dot(b)<=0?{state:hh(e,t,i,!n,a)?1:0,inter:go(t,i,s,n,!0,void 0,r)}:O&&l.distance2(h.start())>us?[e,i,!0,void 0,r]:[t,i,!0,void 0,r]}}var iO=0;function PV(e,t,i,r){let s=t.getBindedInter(),n=t.side,a=s.side,o=n.getShape(),l=a.getShape();if(r&&(iO++,iO===-1)){r.initColor(zt.RED).addPt(o),r.initColor(zt.Golden).addPt(l),r.draw();debugger}let h=0,c=!1;if(e===-1){let w=_o(n,n.nextSide,a,s,h,c,r),S=w.state!==0;if(w.state===2){let R=rt(o,t.coord).add(rt(n.nextSide.getShape(),t.coord)).normalize(),B=rt(l,t.coord).add(rt(a.nextSide.getShape(),t.coord)).normalize();return E(S,R.dot(B)>0)}let C=_o(n,n.nextSide,a.nextSide,s,h,c,r);return w.state!==C.state?(x(w,C),1):E(S,w.state!==_o(a,a.nextSide,n,t,h,!0,r).state,w.inter,C.inter)}if(e===1){let w=rn(n,a,s,r,h,c,new Map),S=w.state!==0;if(w.state===2)return E(S,rt(o,t.coord).dot(rt(l,t.coord))>0);let C;if(w.isReversed&&w.existOverlap&&Xe(w.inter.coord,a.getEnd())&&w.inter.getBindedInter().side!==n){let Y=w.inter.getBindedInter().side;if(Y===n.nextSide)C={state:hh(n,Y,a.nextSide,!0,r)?1:0,inter:s};else if(Y===n.prevSide){if(C={state:hh(Y,n,a.nextSide,!0,r)?1:0,inter:w.inter},w.state===C.state&&t!==w.inter){let G=rt(l,t.coord),z=rt(a.nextSide.getShape(),t.coord),q=rt(Y.getShape(),t.coord);return E(S,G.add(z).dot(q)>0,w.inter,C.inter)}}else C=rn(n,a.nextSide,s,r,h,c,new Map)}else C=rn(n,a.nextSide,s,r,h,c,new Map);if(w.state!==C.state)return x(w,C),1;let R=rt(l,t.coord),B=rt(a.nextSide.getShape(),t.coord);if(Ia(R.dot(B),-1)){let Y=Sr(a,a.nextSide,!0,r);return E(S,w.state!==rn(a.nextSide,n,t,r,h,!0,new Map,Y?!S:S,!1).state,w.inter,C.inter)}else{let Y=rt(o,t.coord);return E(S,R.add(B).dot(Y)>0,w.inter,C.inter)}}if(!(o instanceof Fe||l instanceof Fe))return 1;let f=rt(o,t.coord),d=rt(l,t.coord),u,p;if(l instanceof ce)u=new ce(t.coord,l.start()),p=new ce(t.coord,l.end());else if(l instanceof xe){let w=t.coord.angleD(l.center);u=xe.build2(l.center,w,l.startAngle,l.rx,l.ry,l.isCCW?0:1),p=xe.build2(l.center,w,l.endAngle(),l.rx,l.ry,l.isCCW?1:0)}else if(l instanceof Fe){let w=l.getPercent(t.coord,st);[u,p]=l.clip(w),u=u.reverse()}else throw new Error("not support");let _=f.dot(d)>0,g,b;_?(g=cs(o.reverse(),u).state,b=cs(o,p).state):(g=cs(o,u).state,b=cs(o.reverse(),p).state);let m;g===0?m=rn(_?n.prevSide:n.nextSide,a,s,r,h,c,new Map,!0,!1,_):g===1?m=rn(n,a.prevSide,s,r,h,c,new Map,!0,!0,_):g===2?_?m=_o(n.prevSide,n,a.prevSide,s,h,c,r,!0):m=_o(n,n.nextSide,a.prevSide,s,h,c,r,!0):_?g===3?m={inter:s,state:0}:m={inter:s,state:1}:g===3?m={inter:s,state:1}:m={inter:s,state:0};let O=m.state!==0;if(m.state===2)return E(O,_);let y;if(b===0?y=rn(_?n.nextSide:n.prevSide,a,s,r,h,c,new Map,!1,!1,!_):b===1?y=rn(n,a.nextSide,s,r,h,c,new Map,!1,!0,!_):b===2?_?y=_o(n,n.nextSide,a.nextSide,s,h,c,r,!1):y=_o(n.prevSide,n,a.nextSide,s,h,c,r,!1):_?b===3?y={inter:s,state:1}:y={inter:s,state:0}:b===3?y={inter:s,state:0}:y={inter:s,state:1},m.state===y.state)return m.inter===y.inter?(t.setIsInvalid(),0):E(O,_,m.inter,y.inter);return x(m,y),1;function x(w,S){let C=w.state!==0;if(w.inter===S.inter){t.setOutToIn(C);return}else Vc(w.inter,S.inter,!0),Vc(S.inter,w.inter,!1);let R=[];if(e===-1){let Y=rt(o,t.coord),G=rt(n.nextSide.getShape(),t.coord),z=rt(l,t.coord),q=rt(a.nextSide.getShape(),t.coord);R.push(Y.dot(z)),R.push(Y.dot(q)),R.push(G.dot(z)),R.push(G.dot(q))}else{let Y=rt(o,t.coord);R.push(rt(l,t.coord).dot(Y)),R.push(rt(a.nextSide.getShape(),t.coord).dot(Y))}if(R.reduce((Y,G)=>Math.abs(Y)>Math.abs(G)?Y:G,0)>0)if(i===1||i===0||i===2||i===3)t.setOutToIn(C);else throw new Error("not support");else if(i===1)B(!C);else if(i===0||i===2||i===3)B(C);else throw new Error("not support");function B(Y){t.setIsInvalid();let G=(Y?w:S).inter;delete G.isInvalid,delete G.getBindedInter().isInvalid,G.setOutToIn(!C)}}function E(w,S,C,R){if(C===R){if(t.side.outline.inters.find(G=>!G.isInvalid&&G!==t&&Xe(G.coord,t.coord)))return t.setIsInvalid(),0;let B=new Oo(t.coord,n,r),Y=new Oo(t.coord,a,r);return B.bind(Y),S?n.inters.splice(t.getIndex(),0,B):n.inters.splice(t.getIndex()+1,0,B),a.inters.splice(t.getBindedInter().getIndex(),0,Y),B.setOutToIn(w),t.setOutToIn(!w),B.isDealed(),n.inters.forEach((G,z)=>G.setIndex(z)),a.inters.forEach((G,z)=>G.setIndex(z)),2}else{let B=function(){let Y=C.getBindedInter(),G=R.getBindedInter();delete C.isInvalid,delete Y.isInvalid,delete R.isInvalid,delete G.isInvalid,C.setOutToIn(!w),R.setOutToIn(w),Vc(C,R,!0),Vc(R,C,!1),Vc(Y,G,S),Vc(G,Y,!S)};if(t.setIsInvalid(),S){if(i===1||i===0||i===2||i===3)return B(),2;throw new Error("not support")}else{if(i===1)return w?0:(B(),2);if(i===0||i===2||i===3)return w?(B(),2):0;throw new Error("not support")}}}}function Vc(e,t,i){let{judge:r,changeNum:s}=a(),n=e.getIndex();for(let o=n+s,l=e.side.inters;r(o);o+=s){if(l[o].isInvalid)continue;if(!Xe(l[o].coord,e.coord))break;l[o].setIndex(n),l[n].setIndex(o);let h=l[o];l[o]=l[n],l[n]=h,n=o}function a(){let o=e.side===t.side;if(i){let l=o?t.getIndex():e.side.inters.length;return{judge:h=>h<l,changeNum:1}}else{let l=o?t.getIndex()+1:0;return{judge:h=>h>=l,changeNum:-1}}}}var vI=0,Oo=class{constructor(e,t,i){this.id=vI++,this.coord=e,this.side=t,i&&(this.id=vI++,this.drawDebug=i);let r=new Hs;r.ext2(e),this._bbox=r.build1()}bbox(){return this._bbox}resetVisitStatus(){this.visited=!1,this.bindedInter.visited=!1}isDealed(){this.dealed=!0,this.getBindedInter().dealed=!0}setOutToIn(e){this.outToIn=e,this.bindedInter.outToIn=!e}setIsInvalid(){this.isInvalid=!0,this.getBindedInter().isInvalid=!0}getBindedInter(){return this.bindedInter}bind(e){this.bindedInter=e,e.bindedInter=this}setIndex(e){this.index=e}isSorted(){return this.index!==void 0}getIndex(){return this.index}getVisited(){return this.visited}visitSelf(){this.visited=!0}visit(){this.visited=!0,this.bindedInter.visited=!0}getPrevPoint(){let e=this.getIndex(),t=this.side.getStart();return e&&(t=this.side.inters[e-1].coord),t}getTangent(){let e=this.side.getShape();if(e instanceof ce)return e.end().sub(e.start());if(e instanceof xe){let t=this.coord.angle(e.center);return e.isCCW?t+=Jg:t-=Jg,new ge(Math.cos(t),Math.sin(t))}else{if(e instanceof Fe)return of(e,e.getPercent(this.coord,st));throw new Error("not support")}}findStartInter(){return this.outToIn===void 0?this.getTangent().cross(this.bindedInter.getTangent())>0?this:this.bindedInter:this.outToIn?this:this.bindedInter}run(){let e=[],t=this,i;if(this.drawDebug){ly++;let r=ly===-1,s=this.drawDebug.initColor(zt.RED);if(r){this.drawDebug.draw();debugger}i=n=>{if(e.push(n),r){s.addPt(e[e.length-1]),this.drawDebug.draw();debugger}}}else i=r=>e.push(r);for(;!t.visited;){let r=function(o,l){if(we.eq(o.distance2(l),0))return;let h=gf.rebuild(n.getShape(),o,l);if(!h)return!0;i(h)};t.visit();let s=t.getIndex(),n=t.side,a=n.inters[s+1];for(;a!=null&&a.isInvalid;)a=n.inters[a.getIndex()+1];if(a)r(t.coord,a.coord),t=a.bindedInter;else{let o=r(t.coord,n.getEnd()),l=t.coord;for(n=n.nextSide,t=null;;){for(let h of n.inters)if(!h.isInvalid){t=h.bindedInter;break}if(t)break;o?(r(l,n.getEnd()),o=!1):i(n.getShape()),n=n.nextSide}o?(we.eq(l.distance2(t.coord),0)?r(l,n.getEnd()):r(l,t.coord),o=!1):we.eq(n.getEnd().distance2(t.coord),0)?i(n.getShape()):r(n.getStart(),t.coord)}}if(t!==this)throw this.drawDebug&&console.log(JSON.stringify({runId:ly,handleId:iO,boolId:$d})),new Error("inter !== this");return _l(xt.build7(e))}},ly=0,hy=class Ty{constructor(t,i,r,s,n){this.inters=[],this.allInterIsInvalid=!0,this.isVisit=!1,this.sides=t,this.isGroup1=r,this.isOutside=s,this.finalIsOutside=s,this.polyline=i,n&&(this.polygon=n),t.forEach(a=>a.outline=this)}static build(t,i,r,s,n){let a=t.primitives.map(l=>new gf(l,s)),o=a[a.length-1];return a.forEach(l=>{o.connect(l),o=l}),n?new Ty(a,t,i,r,n):new Ty(a,t,i,r)}setFinalIsOutSide(t){this.finalIsOutside=t}startAndEndIsSameOutsideFlag(){return this.isOutside===this.finalIsOutside}get hasInter(){return!!this.interOutlines}isAllInterIsInvalid(){return this.allInterIsInvalid}setAllInterIsInvalidToFalse(){this.allInterIsInvalid=!1}resetVisited(){this.isVisit=!1}intersect(t,i){if(!(t.interOutlines&&t.interOutlines===this.interOutlines))if(t.interOutlines)if(this.interOutlines){let r,s;this.interOutlines.length>t.interOutlines.length?(r=this.interOutlines,s=t.interOutlines):(r=t.interOutlines,s=this.interOutlines),s.forEach(n=>{r.push(n),n.interOutlines=r}),i.delete(s)}else t.interOutlines.push(this),this.interOutlines=t.interOutlines;else this.interOutlines?(this.interOutlines.push(t),t.interOutlines=this.interOutlines):(t.interOutlines=this.interOutlines=[this,t],i.add(this.interOutlines))}isContain(t){if(!this.polyline.bbox().extendOfSize(st).isContainsBBox(t.polyline.bbox()))return!1;let i=t.polyline.primitives[0].start();if(t.hasInter&&t.isAllInterIsInvalid()){let r=t.inters[0];r.getBindedInter().side.outline!==this?i=r.side.getCenterPoint():i=r.side.getCenterPoint(r.coord)}return!!this.polyline.getWindingNum(i)}isInternally(t){return!!this.polyline.getWindingNum(t)}isEqual(t){return this.polyline===t.polyline}bbox(){return this.polyline.bbox()}reverse(){this.sides.reverse();let t=this.sides[this.sides.length-1];this.sides.forEach(i=>{i.reverse(),t.connect(i),t=i})}returnPolyline(){let t=this.sides.map(r=>r.getShape()),i=this.polyline.primitives;if(this.sides.length===i.length){let r=new Set(i);if(!t.some(s=>!r.has(s)))return this.polyline}return xt.build7(t)}};function EI(e,t,i){let r=[];return e.forEach(s=>s.forEach(n=>{if(n.hasInter&&!n.isAllInterIsInvalid())return;let a=n.bbox(),o=t.search(a.extendOfSize(st)).filter(l=>l.bbox().extendOfSize(st).isContainsBBox(a)).sort((l,h)=>l.bbox().area()-h.bbox().area());for(let l of o)if(l.isContain(n)){let h=i(!n.isOutside,l.isOutside),c=i(n.isOutside,l.isOutside);h!==c&&(r.push(n),n.setFinalIsOutSide(!h));return}i(n.isOutside,!1)!==i(!n.isOutside,!1)&&r.push(n)})),r}function AV(e,t,i){let r;switch(i){case 0:r=(o,l)=>o&&l;break;case 1:r=(o,l)=>o||l;break;case 2:r=(o,l)=>o&&!l;break;case 3:r=(o,l)=>o&&!l||!o&&l;break;default:throw Error("not support the rule")}let s=new lf(10),n=new lf(10);e.forEach(o=>o.forEach(l=>s.add(l))),t.forEach(o=>o.forEach(l=>n.add(l)));let a=EI(e,n,r);return EI(t,s,(o,l)=>r(l,o)).forEach(o=>a.push(o)),a}var CV=class{constructor(e){this.roots=[],this.nodes=e.sort((t,i)=>t.bbox().minX-i.bbox().minX).map(t=>new NV(t)),this.nodes.forEach((t,i)=>{t.visit()&&(this.roots.push(t),this.build(i))})}build(e){let t=this.nodes[e];for(let i=e+1,r=this.nodes.length;i<r;i++){let s=this.nodes[i];if(t.key.bbox().maxX<s.key.bbox().minX)break;s.getIsVisit()||t.isContain(s)&&(s.visit(),t.addChild(s),this.build(i))}}getPolygons(){let e=[];return this.roots.forEach(t=>t.getPolygons().forEach(i=>e.push(i))),e}},NV=class{constructor(e){this.children=[],this.isVisit=!1,this.key=e}getIsVisit(){return this.isVisit}isContain(e){return this.key.isContain(e.key)}addChild(e){this.children.push(e)}getPolygons(){let e=[];return this.getPolylineList(e),e.map(t=>{let i=t[0].polygon;if(i&&i.items.length===t.length){let r=t.map(n=>n.returnPolyline()),s=new Set(i.items);return r.some(n=>!s.has(n))?new lr(r):i}else return new lr(t.map(r=>r.returnPolyline()))})}getPolylineList(e,t){t?(t.push(this.key),t=null):(t=[this.key],e.push(t)),this.children.forEach(i=>i.getPolylineList(e,t))}visit(){return this.isVisit?!1:(this.isVisit=!0,!0)}};function TI(e){let t="";return e.items.forEach((i,r)=>{let s="$";if(i.items.forEach((n,a)=>{let o="[";if(n.primitives.forEach((l,h)=>{let c="";if(l instanceof ce)c=`Line,${l.start().x},${l.start().y},${l.end().x},${l.end().y}`;else if(l instanceof xe)c=`Arc,${l.center.x},${l.center.y},${l.startAngle},${l.sweepAngle},${l.rx}`;else if(l instanceof Fe)c=`Bezier,${l.controls.map(f=>`${f.x},${f.y}`).join(",")}`;else throw new Error("not supported");if(h===n.primitives.length-1){o+=`${c}]`;return}o+=`${c},`}),a===i.items.length-1){s+=`${o}$`;return}s+=`${o}_`}),r===e.items.length-1){t+=`${s}`;return}t+=`${s}^`}),console.log(t),t}function wI(e){let t=e.split("^"),i=[];return t.forEach(s=>{let n=/\$(.*?)\$/,a=s.match(n)[1].split("_"),o=[];a.forEach(h=>{let c=/\[(.*?)\]/,f=h.match(c)[1].split(","),d=[],u=[];for(let _=0;_<f.length;_++){let g=f[_];if(g==="Line"||g==="Arc"||g==="Bezier"){if(d.length){let b=r(d);u.push(b),d.length=0}d.push(g);continue}d.push(Number(g))}d.length&&(u.push(r(d)),d.length=0);let p=xt.build7(u);o.push(p)});let l=new lr(o);i.push(l)}),new ki(i);function r(s){let n=s[0];if(n==="Line")return new ce(new ge(s[1],s[2]),new ge(s[3],s[4]));if(n==="Arc")return xe.build3(new ge(s[1],s[2]),s[3],s[4],s[5],s[5]);if(n==="Bezier"){let a=[];for(let o=1;o<s.length;o+=2)a.push(new ge(s[o],s[o+1]));return new Fe(a)}else throw new Error("not support")}}var LV=class{constructor(e=1){this.group1Str="$[Line,20193.777980000017,4122.200439600661,20193.77082,4211.848760073709,Arc,20193.972672902382,4211.8487570980205,179.99915535323618,-89.99540000050294,0.2018529024026465,Line,20193.972659672283,4212.050609999989,20193.972660393258,4212.039610000013,Arc,20193.97217289501,4211.848257065248,89.85403133887164,89.99540000041924,0.19135355574930143,Line,20193.78082,4211.848759926291,20193.78897999998,4122.200440479205,Line,20193.78897999998,4122.200440479205,20193.777980000017,4122.200439600661]$",this.group2Str="$[Arc,20209.72784128151,4122.2007625157785,258.46768032837986,-75.66780748375947,4.138846238512183,Line,20205.593935808283,4121.998590004101,20193.97982992629,4121.998600000001,Arc,20193.97983290198,4122.2004529023825,269.9991553532362,-89.99540000050297,0.20185290240401074,Arc,20193.782979999996,4122.20044,180.00375535340328,-180.0000000000027,0.004999999999025513,Arc,20193.979332869207,4122.200952909754,180.15347936671733,89.99540000008247,0.19135355575111057,Line,20193.97983008845,4122.009599999999,20205.603694309226,4122.003828485546,Arc,20209.733142304296,4122.194577876843,182.64475341258483,75.73379999998886,4.133851239977064,Line,20208.900400396684,4118.145470939558,20208.902599535475,4118.156248870184,Arc,20206.972515961093,4108.700057667588,78.46393309088245,-78.46759999998636,9.65115405866796,Arc,20216.618669999996,4108.69944,359.99996825446135,-180,0.004999999999200412,Arc,20206.973015966745,4108.699445349495,359.99996822365375,78.46759999998409,9.640654033253735]$^$[Line,20193.997796883676,4095.399470032799,20205.596133314026,4095.4013992171836,Arc,20209.72470159858,4095.1923799234505,177.10172964919312,-75.64935037184974,4.133855965730166,Arc,20209.73000213952,4095.198565517174,101.5415133143569,75.7293000000185,4.128850963459707,Line,20205.605834328744,4095.395161923586,20193.997203529463,4095.389485743675,Arc,20193.994588809255,4095.197684525904,89.21896662213764,4.544099999999517,0.19181903946188483,Arc,20193.981499796217,4095.1977402038,89.85034659953621,89.9999999995926,0.19135044893494071,Arc,20193.78515,4095.19824,0,-180,0.005,Arc,20193.98200016982,4095.1982398301675,179.99995179248322,-89.99999999974185,0.20185016982129908,Arc,20193.981986624152,4095.198185381971,89.9961078637802,-4.487285276547311,0.2019046184835962]$",this.rule=e}getGroup1(){return wI(this.group1Str)}getGroup2(){return wI(this.group2Str)}},cy=new sO(2),Kd=class{getUnion(e,t=!0){return t&&(e=e.map(i=>this.asSameSweep([i])[0])),_V(ZY,e)}asSameSweep(e){let t=0;return e.forEach(i=>t+=i.area(.01)),t>0?e.map(i=>i.reverse()):e}getSubtraction(e,t){let i=new nf(!1),r=new af(zg.rule,cy,i);for(let s of e){let n=zg.weight(0);r.addPolyline(s,n)}for(let s of t){let n=zg.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}getIntersection(e,t){let i=new nf(!1),r=new af(Hg.rule,cy,i);for(let s of e){let n=Hg.weight(0);r.addPolyline(s,n)}for(let s of t){let n=Hg.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}getMutuallyExclusive(e,t){let i=new nf(!1),r=new af(jg.rule,cy,i);for(let s of e){let n=jg.weight(0);r.addPolyline(s,n)}for(let s of t){let n=jg.weight(1);r.addPolyline(s,n)}return r.simplify(),i.plGrps}},$d=0,uy=!1;function Qd(e,t,i,r,s){let n=Of(),a=[],o=[],l=[],h=new Set,c;if(s){if(c=new _f(s),$d++,uy){debugger;uy=!1;let y=new LV;Qd(y.rule,y.getGroup1(),y.getGroup2(),r,s)}if($d===-1||uy){console.table({rule:e,group1:TI(t),group2:TI(i)}),c.clear();let y=c.initColor(zt.GREEN),x=c.initColor(zt.WHITE),E=c.initColor(zt.BLUE),w=c.initColor(zt.Gray);t.items.forEach(S=>S.items.forEach((C,R)=>{R>0?x.addPly(C):y.addPly(C)})),i.items.forEach(S=>S.items.forEach((C,R)=>{R>0?w.addPly(C):E.addPly(C)})),c.draw();debugger}}let f=t.items.length!==0&&i.items.length!==0?t.bbox().extendOfSize(st).intersection1(i.bbox().extendOfSize(st)):null;if(f){let y=[],x=[];switch(e){case 0:{for(let E of t.items)E.bbox().isIntersect(f)&&y.push(E);for(let E of i.items)E.bbox().isIntersect(f)&&x.push(E);break}case 1:case 3:{for(let E of t.items)E.bbox().isIntersect(f)?y.push(E):a.push(E);for(let E of i.items)E.bbox().isIntersect(f)?x.push(E):a.push(E);break}case 2:{for(let E of t.items)E.bbox().isIntersect(f)?y.push(E):a.push(E);for(let E of i.items)E.bbox().isIntersect(f)&&x.push(E);break}default:throw new Error("not support")}y.length!==t.items.length&&(t=new ki(y)),x.length!==i.items.length&&(i=new ki(x))}else{switch(e){case 0:break;case 1:case 3:{t.items.forEach(y=>a.push(y)),i.items.forEach(y=>a.push(y));break}case 2:{t.items.forEach(y=>a.push(y));break}default:throw new Error("not support")}t=new ki([]),i=new ki([])}m(t,o,!0),m(i,l,!1);let d=e===2||e===3?(y,x)=>Xe(y.getEnd(),x)?y.nextSide:y:(y,x)=>Xe(y.prevSide.getEnd(),x)?y.prevSide:y,u=(y,x,E)=>{if(Xe(y.getEnd(),E)){if(y.inters.findIndex(w=>w.getBindedInter().side===x&&Xe(w.coord,y.getEnd()))===-1)return new Oo(E,y,c)}else return new Oo(E,y,c)},p=e===2||e===3?(y,x,E)=>{if(Xe(y.getStart(),E)){if(y.inters.findIndex(w=>w.getBindedInter().side===x&&Xe(w.coord,y.getStart()))===-1)return new Oo(E,y,c)}else return new Oo(E,y,c)}:u;r.seek(t,i,(y,x,E,w,S,C)=>{let R=o[y][x],B=l[w][S],Y=R.sides[E],G=B.sides[C],z=bn(Y.getShape(),G.getShape());if((Y.getShape()instanceof Fe||G.getShape()instanceof Fe)&&z>=4){if(Y.getShape()instanceof xe||G.getShape()instanceof xe){let L=function(v,P){let I=!1;for(let N=0;N<P.length;N+=2)Xe(new ge(P[N],P[N+1]),v)&&(I=!0);I||P.push(v.x,v.y)},M=[ie[0],ie[1]];for(let v=0;v<z;v+=2){let P=new ge(ie[v],ie[v+1]);for(let I=v+2;I<z;I+=2){let N=new ge(ie[I],ie[I+1]);if(!Xe(P,N)){L(N,M);break}}}z=M.length,M.forEach((v,P)=>ie[P]=v)}else for(let L=z-2;L>=2;L-=2)for(let M=L-2;M>=0;M-=2)if(Xe(new ge(ie[L],ie[L+1]),new ge(ie[M],ie[M+1]))){ie[M]=(ie[L]+ie[M])/2,ie[M+1]=(ie[L+1]+ie[M+1])/2;for(let v=z-3;v>=L;v--)ie[v]=ie[v+2];z-=2;break}}let q=0;if(z===4){let L=function(P){return Xe(Y.getEnd(),P)||Xe(Y.prevSide.getEnd(),P)||Xe(G.prevSide.getEnd(),P)||Xe(G.getEnd(),P)},M=new ge(ie[0],ie[1]),v=()=>{let P=new Oo(M,Y,c),I=new Oo(M,G,c);P.bind(I),P.setIsInvalid(),P.isDealed(),R.inters.push(P),B.inters.push(I)};if(ie[0]===ie[2]&&ie[1]===ie[3])if(L(M))q=2;else{v();return}}for(;q<z;q+=2){let L=new ge(ie[q],ie[q+1]),M=Y,v=G;if(Xe(M.prevSide.getEnd(),L)&&(M=M.prevSide),v=d(v,L),Y!==M&&G!==v){let I=e===2||e===3?G.getEnd():v.getEnd();M.getEnd().distance1(L)<I.distance1(L)?(L=M.getEnd(),Xe(I,L)||(v=G)):(L=I,Xe(M.getEnd(),L)||(M=Y))}let P=u(M,v,L);if(P){let I=p(v,M,L);I&&(M.addInter(P),R.inters.push(P),v.addInter(I),B.inters.push(I),P.bind(I),R.intersect(B,h))}}return z},s);let _=O(),g=AV(o,l,e);g.forEach(y=>!y.startAndEndIsSameOutsideFlag()&&y.reverse()),new CV(_.concat(g)).getPolygons().forEach(y=>a.push(y));let b=new ki(a);if(c){if($d===-1){let y=c.initColor(zt.RED),x=c.initColor(zt.Golden);a.forEach(E=>{y.addPly(E.items[0]),E.items.slice(1).forEach(w=>x.addPly(w))}),c.draw();debugger;throw new Error}b.id=$d}return wa.BooleanTools+=dl(n),b;function m(y,x,E){y.items.forEach(w=>{let S=[];S.push(hy.build(w.items[0],E,!0,c,w)),w.items.slice(1).forEach(C=>{S.push(hy.build(C,E,!1,c))}),x.push(S)})}function O(){let y=[];return h.forEach(E=>{e===2||e===3?E.forEach(S=>{S.isGroup1||S.reverse(),S.sides.forEach(C=>C.sortInters())}):E.forEach(S=>S.sides.forEach(C=>C.sortInters())),E.map(S=>S.sides.filter(C=>C.inters.length)).flat(2).sort((S,C)=>{let R=S.inters,B=C.inters,Y=Xe(R[R.length-1].coord,S.getEnd()),G=Xe(B[B.length-1].coord,C.getEnd());if(Y&&G){let z=0,q=0;for(let L=R.length-2;L>=0&&Xe(R[L].coord,S.getEnd());L--)z++;for(let L=B.length-2;L>=0&&Xe(B[L].coord,C.getEnd());L--)q++;return q-z}else return Y?-1:1}).forEach(S=>{S.inters.forEach(C=>{if(C.dealed)return;let R=C.side,B=C.getBindedInter().side,Y;Xe(R.getEnd(),C.coord)&&Xe(B.getEnd(),C.coord)?Y=-1:Xe(R.getEnd(),C.coord)?(Y=1,C=C.getBindedInter()):Xe(B.getEnd(),C.coord)&&(Y=1);let G=PV(Y,C,e,c);C.isDealed(),G&&(R.outline.setAllInterIsInvalidToFalse(),B.outline.setAllInterIsInvalidToFalse())})}),w(E),e===3&&(E.forEach(S=>{S.reverse(),S.sides.forEach(C=>{C.sortInters(),C.inters.forEach(R=>{R.resetVisitStatus()})})}),w(E));function w(S){S.forEach(C=>{C.inters.forEach(R=>{if(R.isInvalid||R.getVisited())return;let B=R.findStartInter(),Y=x(e)?B.run():B.getBindedInter().run(),G=C.polyline.primitives;if(Y){if(G.length===Y.primitives.length){let z=new Set(G);if(!Y.primitives.some(q=>!z.has(q))){y.push(C);return}}y.push(hy.build(Y,!0,!0,c))}})})}}),y;function x(E){switch(E){case 0:case 2:case 3:return!0;case 1:return!1;default:throw Error("not support the rule")}}}}var Mg=/\bstablilizetion\b/.test(self.location.href)||!0,qd={intersect(e,t,i,r){try{return Qd(0,e,t,i,r)}catch(s){if(Mg){let n=new Kd().getIntersection(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new ki(n.map(a=>new lr(a.items)))}throw s}},union(e,t,i,r){try{return Qd(1,e,t,i,r)}catch(s){if(Mg){let n=new Kd,a=e.items.map(l=>l.items.map(h=>h)).flat(2);t.items.forEach(l=>l.items.forEach(h=>a.push(h)));let o=n.getUnion(a);return new ki(o.map(l=>new lr(l.items)))}throw s}},diff(e,t,i,r){try{return Qd(2,e,t,i,r)}catch(s){if(Mg){let n=new Kd().getSubtraction(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new ki(n.map(a=>new lr(a.items)))}throw s}},xor(e,t,i,r){try{return Qd(3,e,t,i,r)}catch(s){if(Mg){let n=new Kd().getMutuallyExclusive(e.items.map(a=>a.items.map(o=>o)).flat(2),t.items.map(a=>a.items.map(o=>o)).flat(2));return new ki(n.map(a=>new lr(a.items)))}throw s}}},RV=class extends af{constructor(e,t,i,r,s,n){super(e.rule,sO.DUMMY,t),this.sideGroup1=[],this.sideGroup2=[],this.group1=i,this.group2=r,this.seeker=s,this.addGroup(i,e.weight(0),this.sideGroup1),this.addGroup(r,e.weight(1),this.sideGroup2),this.bus=n}addGroup(e,t,i){if(!e)debugger;e.items.forEach(r=>{let s=[];r.items.forEach(n=>{let a=this.sides.length;this.addPolyline(n,t),s.push(this.sides.slice(a))}),i.push(s)})}seekIntersection(){this.seeker.seek(this.group1,this.group2,(e,t,i,r,s,n)=>{let a=this.sideGroup1[e][t][i],o=this.sideGroup2[r][s][n],l=bn(a.shape,o.shape);for(let h=0;h<l;h+=2){let c=new ge(ie[h],ie[h+1]);a.inters.push(c),o.inters.push(c),this.event.onIntersect(c,a,o)}return l},this.bus)}},DV=class extends nf{constructor(e){super(!!e),e&&(this.drawDebug=new _f(e),this.blueDrawing=this.drawDebug.initColor(zt.BLUE),this.greenDrawing=this.drawDebug.initColor(zt.GREEN),this.redDrawing=this.drawDebug.initColor(zt.RED))}onOriginSide(e){super.onOriginSide(e),this.debug&&this.blueDrawing.addPt(e.shape)}onPolylineGroup(e,t){super.onPolylineGroup(e,t),this.debug&&e.items.forEach(i=>this.greenDrawing.addPly(i))}draw(){this.drawDebug.draw()}};function Bg(e,t,i,r,s){let n=Of(),a=new DV(s);new RV(e,a,t,i,r,s).simplify();let o=[];a.plGrps.forEach(h=>{let c=h.items.map(f=>tO(f));c[0]&&o.push(new lr(c.filter(f=>f)))});let l=new ki(o);return wa.BooleanTools+=dl(n),l}var kg=!0,Xd={intersect(e,t,i,r){try{return qd.intersect(e,t,i,r)}catch(s){if(kg)throw s;return console.error(s),Bg(Hg,e,t,i,r)}},union(e,t,i,r){try{return qd.union(e,t,i,r)}catch(s){if(kg)throw s;return console.error(s),Bg(KY,e,t,i,r)}},diff(e,t,i,r){try{return qd.diff(e,t,i,r)}catch(s){if(kg)throw s;return console.error(s),Bg(zg,e,t,i,r)}},xor(e,t,i,r){return qd.xor(e,t,i,r)}};var MV=class{init(e){}seek(e,t,i,r){let s=e.bbox().extendOfSize(5e-6).intersection1(t.bbox().extendOfSize(5e-6));if(!s)return;let n=Of(),a=[];for(let d=0,u=e.items.length;d<u;d++){let p=e.items[d];if(s.isIntersect(p.bbox()))for(let _=0,g=p.items.length;_<g;_++){let b=p.items[_];if(s.isIntersect(b.bbox()))for(let m=0,O=b.primitives.length;m<O;m++){let y=b.primitives[m].bbox();s.isIntersect(y)&&a.push({bbox:y,polygonIndex:d,polylineIndex:_,ptIndex:m})}}}let o=a.length;if(o===0){wa.IntersectionSeeker+=dl(n);return}let l=[];for(let d=0,u=t.items.length;d<u;d++){let p=t.items[d];if(s.isIntersect(p.bbox()))for(let _=0,g=p.items.length;_<g;_++){let b=p.items[_];if(s.isIntersect(b.bbox()))for(let m=0,O=b.primitives.length;m<O;m++){let y=b.primitives[m].bbox();s.isIntersect(y)&&l.push({bbox:y,polygonIndex:d,polylineIndex:_,ptIndex:m})}}}let h=l.length;if(h===0){wa.IntersectionSeeker+=dl(n);return}if(o<5||h<5){for(let d=0,u=a.length;d<u;d++)for(let p=0,_=l.length;p<_;p++)if(a[d].bbox.isIntersect(l[p].bbox.extendOfSize(1e-5))){let g=a[d],b=l[p];i(g.polygonIndex,g.polylineIndex,g.ptIndex,b.polygonIndex,b.polylineIndex,b.ptIndex)}wa.IntersectionSeeker+=dl(n);return}a.sort((d,u)=>d.bbox.minX-u.bbox.minX),l.sort((d,u)=>d.bbox.minX-u.bbox.minX);let c=0,f=0;for(;c<o&&f<h;)if(a[c].bbox.minX<l[f].bbox.minX){let d=a[c],u=d.bbox;for(let p=f;p<h;p++){let _=l[p],g=_.bbox;if(g.minX>u.maxX+1e-5)break;(u.minY<g.minY?g.minY:u.minY)<(u.maxY<g.maxY?u.maxY:g.maxY)+1e-5&&i(d.polygonIndex,d.polylineIndex,d.ptIndex,_.polygonIndex,_.polylineIndex,_.ptIndex)}c++}else{let d=l[f],u=d.bbox;for(let p=c;p<o;p++){let _=a[p],g=_.bbox;if(g.minX>u.maxX+1e-5)break;(g.minY<u.minY?u.minY:g.minY)<(g.maxY<u.maxY?g.maxY:u.maxY)+1e-5&&i(_.polygonIndex,_.polylineIndex,_.ptIndex,d.polygonIndex,d.polylineIndex,d.ptIndex)}f++}wa.IntersectionSeeker+=dl(n)}},kr,Wr=(kr=class{static getDebug(){return kr.drawDebug||(kr.drawDebug=new _f(kr.curBus)),kr.drawDebug}static getDrawing(t=zt.GREEN){return this.getDebug().initColor(t)}static clearDrawing(){kr.getDebug().clear()}static drawText(t,i,r=zt.GREEN){kr.getDrawing(r).addText(t,i,1.5,.1,!0)}static drawBBox(t,i=zt.GREEN){if(!t)return;let r=kr.getDrawing(i),s=new ce(t.UL(),t.UR()),n=new ce(t.UR(),t.LR()),a=new ce(t.LR(),t.LL()),o=new ce(t.LL(),t.UL());r.addPt(s),r.addPt(n),r.addPt(a),r.addPt(o)}static drawPolyType(t,i){let r=kr.getDrawing(i);if(t instanceof xt)r.addPly(t);else if(t instanceof lr)for(let s of t.items)s instanceof xt?r.addPly(s):this.drawPolyType(s,i);else if(t instanceof ki)for(let s of t.items)this.drawPolyType(s,i)}static translate(t){switch(t){case 0:return"\u2229";case 2:return"-";case 1:return"U";case 3:return"X";default:break}}},kr.UseRunArrange=!0,kr.UseOptimizeSplit=!0,kr.LocalBestThread=4,kr.HandleDiff=!0,kr.OcTreeSplitStep=4,kr.PrintStart=new ge(150,-200),kr),Wd=class wy{static getPolyTypeLine(t){let i=[];if(t instanceof xt)for(let r of t.primitives)i.push(r);else if(t instanceof lr)for(let r of t.items)if(r instanceof xt)for(let s of r.primitives)i.push(s);else{let s=this.getPolyTypeLine(r);for(let n of s)i.push(n)}else if(t instanceof ki)for(let r of t.items){let s=this.getPolyTypeLine(r);for(let n of s)i.push(n)}return i}static getPolyTypePolyLine(t){let i=[];if(t instanceof xt)i.push(t);else if(t instanceof lr)for(let r of t.items)if(r instanceof xt)i.push(r);else{let s=this.getPolyTypePolyLine(r);for(let n of s)i.push(n)}else if(t instanceof ki)for(let r of t.items){let s=this.getPolyTypePolyLine(r);for(let n of s)i.push(n)}return i}static getListBBox(t){if(t.length<=0)return;let i=new Hs;for(let r of t){let s=wy.getSingleBBox(r);i.ext1(s)}return i.build1()}static getSingleBBox(t){if(t instanceof Array){let i=new Hs,r=wy.getListBBox(t.slice(1));return i.ext1(r),i.build1()}else return t.bbox()}static doDrawRule(t,i=Wr.PrintStart){if(t.length<2)return[i,i,i];let r=5,s=10,n=t[0],a=Wr.translate(n),o=[],l=i.y,h=i.x,c=i.x;i=i.add(new ge(0,-s));for(let u=1;u<t.length;u++){let p=t[u];if(p instanceof Array){i=i.add(new ge(r,0));let _=this.doDrawRule(p,i);o.push(_[0]),_[1].x<=h&&(h=_[1].x),_[2].x>=c&&(c=_[2].x),i=new ge(_[2].x+r,i.y)}else o.push(i.clone()),i.x<=h&&(h=i.x),i.x>=c&&(c=i.x),Wr.drawText(i,p.name),i=i.add(new ge(r,0))}let f=0;for(let u of o)f+=u.x;let d=new ge(f/o.length,i.y+s);Wr.drawText(d,"N:"+a);for(let u of o){let p=new ce(u,d),_=new Array;_.push(p);let g=xt.build1(gy(_));Wr.drawPolyType(g,zt.GREEN)}return[d,new ge(h,l),new ge(c,l)]}static drawRule(t,i=Wr.PrintStart,r=!1,s){Wr.clearDrawing(),this.doDrawRule(t,i),r&&this.doDrawRulePolygon(t,s),Wr.getDebug().draw()}static doDrawRulePolygon(t,i){let r=t[0];for(let s=1;s<t.length;s++){let n=t[s];if(n instanceof Array)this.doDrawRulePolygon(n,i);else{let a=i;r===2&&s===1&&(a=zt.RED),n.name&&Wr.drawText(n.bbox().UL(),n.name,a),Wr.drawPolyType(n,a)}}}static IsCenterBBoxPointInPolygonType(t,i){let r=t.center();for(let s of i.items)if(s.getOutMostPolyline().getWindingNum(r))return!0;return!1}static KeepBBoxPolygonGroup(t,i){let r=i.bbox().intersection1(t);if(!r)return!1;for(let s of i.items)if(s.bbox().isIntersect(r)){for(let n of s.items)if(n.bbox().isIntersect(r)){for(let a of n.primitives)if(r.isIntersect(a.bbox()))return!0}}return!!this.IsCenterBBoxPointInPolygonType(t,i)}},BV=class Wc{static createNode(t,i,r){let s=t.UL(),n=t.width()/i,a=t.height()/i,o=~~(r/i),l=r-o*i,h=s.x+l*n,c=s.y-(o+1)*a,f=h+n,d=c+a;return new ls(h,f,c,d)}static ocTreeSplitNode(t,i,r,s,n=2){if(t.length<=r)return t;let a=[],o=n**2,l=new Array(o),h=new Array(o);for(let u=0;u<o;u++)l[u]=new Array(t.length),h[u]=0;let c=i.UL(),f=i.width()/n,d=i.height()/n;for(let u of t){let p=s(u).center(),_=~~((p.x-c.x)/f),g=~~((c.y-p.y)/d)*n+_;try{l[g][h[g]]=u,h[g]+=1}catch{a.push(u)}}for(let u=0;u<l.length;u++){let p=h[u];if(p<=0)continue;let _=l[u].slice(0,p);if(_.length===t.length)return t;let g=Wc.createNode(i,n,u),b=Wc.ocTreeSplitNode(_,g,r,s,n);if(b.length===t.length)return t;a.push(b)}return a}static ocTreeSplitNodeMinIntersect(t,i,r,s){let n=[];if(t.length<=r)return t;let a=3,o=i.LL(),l=i.UR(),h=i.width()/(a+1),c=i.height()/(a+1),f=-(2**32),d=[],u=[];for(let p=1;p<=a;p++)for(let _=1;_<=a;_++){let g=o.x+h*p,b=o.y+c*_,m=[[],[],[],[]],O=new Array(4),y=new Array(4);y[0]=new ls(o.x,g,b,l.y),y[1]=new ls(g,l.x,b,l.y),y[2]=new ls(o.x,g,o.y,b),y[3]=new ls(g,l.x,o.y,b);for(let S of t){let C=s(S).center(),R=-1,B=-1;C.x===g?R=Math.random()>=.5?1:-1:C.x>g?R=1:C.x<g&&(R=-1),C.y===b?B=Math.random()>=.5?1:-1:C.y>b?B=1:C.y<b&&(B=-1),R===1&&B===1?m[1].push(S):R===1&&B===-1?m[3].push(S):R===-1&&B===-1?m[2].push(S):R===-1&&B===1&&m[0].push(S)}for(let S=0;S<4;S++){let C=m[S];if(C.length<=0)continue;let R=new Hs;for(let B of C)R.ext1(s(B));O[S]=R.build1()}let x=0,E=0;for(let S of O)S&&(x+=S.area());E=x;let w=(S,C)=>{if(!O[S]||!O[C])return 0;let R=O[S].intersection1(O[C]);return R?R.area():0};E-=w(0,1),E-=w(0,2),E-=w(0,3),E-=w(1,2),E-=w(1,3),E-=w(2,3),E/x>=f&&(d=m,u=y)}for(let p=0;p<d.length;p++){let _=d[p];if(_.length<=0)continue;let g=u[p],b;if(_.length===t.length?b=Wc.ocTreeSplitNode(_,g,r,s):b=Wc.ocTreeSplitNodeMinIntersect(_,g,r,s),b.length===t.length)return t;n.push(b)}return n}static ocTreeSplit(t,i,r,s){return Wc.ocTreeSplitNode(t,i,r,s,Wr.OcTreeSplitStep)}},kV=class eP{static simplifyRules(t,i){return Wr.UseOptimizeSplit&&(t=this.optimizeSplit(t,i)),t}static OcTreeOptimizeSplit(t){let i=t[0];if(i!==1||t.length<=Wr.LocalBestThread+1)return t;let r=t.slice(1),s=new Array(r.length);for(let h=1;h<t.length;h++)s[h-1]=h;let n=Wd.getListBBox(r),a=BV.ocTreeSplit(s,n,Wr.LocalBestThread,h=>{let c=t[h];return Wd.getSingleBBox(c)}),o=(h,c)=>{if(!(h.length<=0))for(let f of h)if(Array.isArray(f)){let d=[c[0]];o(f,d),c.push(d)}else{let d=t[f];c.push(d)}},l=[i];return o(a,l),l}static optimizeSplit(t,i){let r=t[0];if(r===2){if(Wr.HandleDiff){let n=t[1],a;if(Array.isArray(n)){let o=this.optimizeSplit(n,i);if(o.length<=1)return[2];a=Sy(o,i)}else a=Sy([2,n],i);if(t.length>3){let o;o=[1];for(let l=2;l<t.length;l++){let h=t[l];if(Array.isArray(h)){let c=Wd.getListBBox([...h.slice(1)]);Wd.KeepBBoxPolygonGroup(c,a)&&o.push(h)}else Wd.KeepBBoxPolygonGroup(h.bbox(),a)&&o.push(h)}return o.length<=1?[2,a]:(o=this.optimizeSplit(o,i),o.length>1?[2,a,...o.slice(1)]:[2,a])}else{let o=t[2];if(Array.isArray(o)&&o[0]===1&&o.length>2){let l=o.slice(1);return this.optimizeSplit([2,a,...l],i)}}}else if(t.slice(1).length>2){let n=t[1],a=t.slice(2),o=this.optimizeSplit([1,...a],i);return o.length>1?[2,n,...o.slice(1)]:n}}else if(r===1){if(t.length-1>Wr.LocalBestThread){let n=!1;for(let a=1;a<t.length;a++){let o=t[a];if(!Array.isArray(o)){n=!0;break}}n&&(t=eP.OcTreeOptimizeSplit(t))}}else if(r===0&&t.length<=2)return[0];let s=[r];for(let n=1;n<t.length;n++){let a=t[n];if(Array.isArray(a)){let o=this.optimizeSplit(a,i);if(o.length<=1)continue;s.push(o)}else s.push(a)}return s}},UV=(e=>(e[e.INTERSECT=0]="INTERSECT",e[e.UNION=1]="UNION",e[e.DIFF=2]="DIFF",e[e.XOR=3]="XOR",e))(UV||{});function ef(e){let t=e[0],i=[t];switch(t){case 0:for(let s=1;s<e.length;s++){let n=e[s];if(Array.isArray(n)&&(n=ef(n),!n))return null;i.push(n)}break;case 1:case 3:for(let s=1;s<e.length;s++){let n=e[s];Array.isArray(n)&&(n=ef(n),!n)||i.push(n)}break;case 2:let r=e[1];if(Array.isArray(r)&&(r=ef(r)),!r)return null;i.push(r);for(let s=2;s<e.length;s++){let n=e[s];Array.isArray(n)&&(n=ef(n),!n)||i.push(n)}break;default:throw new Error("not support boolean rule!")}return i.length===1?null:i}function dy(e,t,i){return Array.isArray(e)?tP(e,t,i):e}function fy(e,t,i,r,s=!0){if(s)for(;e.length>1;){let n,a=[];for(e.length%2===1?(a.push(e[0]),n=1):n=0;n<e.length;n+=2)a.push(t(e[n],e[n+1],i,r));e=a}else for(;e.length>1;){if(e.length===2)return t(e[0],e[1],i,r);e=[t(e[0],e[1],i,r),...e.slice(2)]}return e[0]}function tP(e,t,i,r=!0){let s=new Array(e.length-1);for(let n=1;n<e.length;n++)s[n-1]=dy(e[n],t,i);switch(e[0]){case 0:return fy(s,Xd.intersect,t,i);case 1:return fy(s,Xd.union,t,i);case 2:let n=fy(s.slice(1),Xd.union,t,i);return n?Xd.diff(s[0],n,t,i):s[0];case 3:let a=dy(e[1],t,i);for(let o=2;o<e.length;o++)a=Xd.xor(a,dy(e[o],t,i),t,i);return a;default:throw new Error("not support boolean rule! "+e[0])}}function iP(e){let t=[e[0]];for(let i=1;i<e.length;i++){let r=e[i];if(Array.isArray(r)){let s=iP(r);Array.isArray(s)?s.length>1&&t.push(s):t.push(s)}else{let s=tO(r);s!==null&&t.push(ki.build(s))}}return t}function FV(e,t){Wr.curBus=t,e=iP(e);let i;return Wr.UseRunArrange?i=kV.simplifyRules(e,t):i=ef(e),i.length<=1?new ki([]):Sy(i,t)}function Sy(e,t,i=!0){if(!e||e.length===1)return new ki([]);let r=e,s=new MV,n=[];function a(o){for(let l=1;l<o.length;l++){let h=o[l];Array.isArray(h)?a(h):n.push(h)}}return a(r),s.init(n),tP(r,s,t,i)}var Ug=new Error("list is empty"),Fg=class{constructor(e,t){this.prev=null,this.next=null,this.parent=e,this.item=t}insertAfter(e){e.next=this.next,this.next=e,e.prev=this,e.next!==null&&(e.next.prev=e)}insertBefore(e){e.prev=this.prev,this.prev=e,e.next=this,e.prev!==null&&(e.prev.next=e)}remove(){this.prev!==null&&(this.prev.next=this.next),this.next!==null&&(this.next.prev=this.prev)}set(e){this.item=e}},GV=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e.item;throw new Error("iterator is null")}},zV=class{constructor(e){this._next=e}hasNext(){return this._next!==null}next(){let e=this._next;if(e!==null)return this._next=e.next,e;throw new Error("iterator is null")}},HV=class{constructor(){this.first=null,this.last=null,this.cnt=0}add(e){return this.addLast(e)}push(e){return this.addLast(e)}pop(){return this.removeLast()}shift(){return this.removeFirst()}removeFirst(){let e=this.first;if(e===null)throw Ug;return this.remove(e),e.item}removeLast(){let e=this.last;if(e===null)throw Ug;return this.remove(e),e.item}addLast(e){if(this.first===null||this.last===null){let t=new Fg(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertAfter(this.last,e)}addFirst(e){if(this.first===null||this.last===null){let t=new Fg(this,e);return this.first=t,this.last=t,this.cnt++,t}else return this.insertBefore(this.first,e)}getFirst(){if(this.first===null)throw Ug;return this.first.item}getLast(){if(this.last===null)throw Ug;return this.last.item}insertAfter(e,t){let i=new Fg(this,t);return e.insertAfter(i),e===this.last&&(this.last=i),this.cnt++,i}insertBefore(e,t){let i=new Fg(this,t);return e.insertBefore(i),e===this.first&&(this.first=i),this.cnt++,i}remove(e){e.remove(),e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev),this.cnt--}size(){return this.cnt}clear(){this.first=null,this.last=null,this.cnt=0}iterator(){return new GV(this.first)}listIterator(){return new zV(this.first)}toArray(){let e=new Array,t=this.first;for(;t!=null;)e.push(t.item),t=t.next;return e}},Vg=class{constructor(e){this.inters=[],e&&(this.inters=e)}addInter(e){this.inters.push(e),e.group=this}findInter(e){let t=this.inters.find(i=>Xe(i.coord,e.coord));return t&&this.inters.find(i=>i.side===e.side)&&e.visitSelf(),t}getOutInter(e){let t=this.inters.filter(i=>!i.getVisited());if(t.length!==0)return t.length===1?t[0]:t.reduce((i,r)=>{if(!i||i.side.getShape()===e)return r;if(r.side.getShape()===e)return i;let s=i.coord,n=rt(e,s),a=rt(i.side.getShape(),s),o=rt(r.side.getShape(),s);return n.dot(a)>n.dot(o)?i:r},void 0)}getEntryInter(){}},py=0;function rP(e,t){let i=e.primitives[0];if(e.primitives.length===1&&i instanceof xe&&Math.abs(i.sweepAngle)===360)return[e];let r=Of();py++;let s,n=KV(e);if(n.length===0)return[];let a=VV(n);if(py===-1){s=new _f(t);let c=s.initColor(zt.BLUE);n.forEach(d=>c.addPt(d.getShape()));let f=s.initColor(zt.GREEN);a.forEach(d=>f.addPoint(d.coord)),s.draw();debugger;throw new Error}if(a.length===0)return[xt.build7(n.map(c=>c.getShape()))];qV(a);let o=[],l=!1;try{JV(a,s)}catch(c){c.customType==="IS_OVERLAP"?(l=!0,o=new Kd().getUnion([e]).map(f=>f.items).flat(2)):console.error(c)}if(l)return o;let h=WV(a);if(!h.length)return[xt.build7(n.map(c=>c.getShape()))];if(o=jV(h,s),o.length===0)return console.warn("=====deSelfIntersection=====",py),[];if(s)throw o.forEach(c=>{s.initColor(zt.WHITE).addPly(c),s.draw();debugger}),new Error;return wa.deSelfIntersection+=dl(r),o}function jV(e,t){let i=[];return e.forEach(r=>{let s=r;r.inters.forEach(n=>{if(n.getVisited())return;let a=[],o=[],l;if(t){debugger;let c=t.initColor(zt.RED);l=f=>{a.push(f),c.addPt(a[a.length-1]),t.draw();debugger}}else l=c=>a.push(c);do{let c=function(_,g){we.eq(_.distance2(g),0)||l(sP(u.getShape(),_,g))},f=o.findIndex(_=>_===n.group);if(f!==-1){let _=a.findIndex(m=>m===n.group),g=a.splice(_).filter(m=>!(m instanceof Vg));if(g.length){let m=_l(xt.build7(g));m&&i.push(m)}let b=a.filter(m=>!(m instanceof Vg));if(n=o[f].getOutInter(b[b.length-1]),o.splice(f),!n)throw Error("interGroup not hav inter!!!2");continue}n.visitSelf(),o.push(n.group),a.push(n.group);let d=n.getIndex(),u=n.side,p=u.inters[d+1];for(;p!=null&&p.isInvalid||p&&p.group===n.group;)p=u.inters[p.getIndex()+1];if(p){c(n.coord,p.coord);let _=p.getBindedInter();if(n=_.getVisited()?_.group.getOutInter(_.side.getShape()):_,!n){if(p.group===s)break;throw new Error("interGroup not hav inter!!!3")}}else{for(c(n.coord,u.getEnd()),u=u.nextSide,n=null;;){for(let _ of u.inters)if(!_.isInvalid){let g=_.group.getOutInter(u.getShape());if(!g){if(_.group===s){n=_;break}else if(_.getBindedInter().group===s){n=_.getBindedInter();break}continue}n=g;break}if(n)break;l(u.getShape()),u=u.nextSide}we.eq(u.getEnd().distance2(n.coord),0)?l(u.getShape()):c(u.getStart(),n.coord)}}while(n.group!==s);let h=_l(xt.build7(a.filter(c=>!(c instanceof Vg))));h&&i.push(h)})}),i}function YV(e){return{next(){return e.hasNext()?{value:e.next()}:{done:!0,value:void 0}},[Symbol.iterator](){return this}}}function VV(e){let t=[],i=new HV;for(let r of e.slice().sort((s,n)=>s.bbox().minY-n.bbox().minY)){for(let s of YV(i.listIterator())){let n=s.item;if(n.bbox().maxY<r.bbox().minY)i.remove(s);else{let a=function(d,u){let p=new Oo(u,d,null);return d.inters.push(p),t.push(p),p},o=function(d,u){let p=d.getEnd(),_=new ge(ie[0],ie[1]),g=new ge(ie[2],ie[3]),b=p.distance2(_)>p.distance2(g)?_:g,m=d.prevSide;a(Xe(m.getEnd(),b)?m:d,b).bind(a(u,b))},l=n.getShape(),h=r.getShape(),c=bn(l,h),f=c===4&&ie[0]===ie[2]&&ie[1]===ie[3];if(f&&(c-=2),n.nextSide===r)n.prevSide!==r&&c===4&&o(n,r);else if(n.prevSide===r)c===4&&o(r,n);else if(c!==0){let d=function(p,_){let g=p.prevSide;return a(Xe(g.getEnd(),_)?g:p,_)},u=new ge(ie[0],ie[1]);if(f&&!Xe(u,n.prevSide.getEnd())&&!Xe(u,r.prevSide.getEnd())&&rt(l,u).dot(rt(h,u))>0)continue;for(let p=0;p<c;p+=2){let _=new ge(ie[p],ie[p+1]);d(n,_).bind(d(r,_))}}}}i.add(r)}return t.forEach(r=>{r.getIndex()===void 0&&r.side.sortInters()}),t}function qV(e){e.forEach(t=>{let i=t.side.getEnd();if(t.isInvalid||!Xe(t.coord,i))return;let r=t.side.inters,s=t.getBindedInter().side;for(let n=r.length-1;n>=0;n--){let a=r[n];if(!Xe(a.coord,i))break;a!==t&&a.getBindedInter().side===s&&a.setIsInvalid()}})}function XV(e){let t=new lf(10);return e.forEach(i=>{i.isInvalid||t.add(i)}),t}function WV(e){let t=[],i=XV(e);return e.forEach(r=>{if(r.isInvalid||r.group)return;let s=i.search(r.bbox().extendOfSize(we.eps)).filter(n=>!n.group);if(s.length){let n=new Set,a=new Vg(s);s.forEach(o=>{o.group=a,n.has(o.side)&&o.visitSelf(),n.add(o.side)}),t.push(a)}}),t}function JV(e,t){e.forEach(i=>{if(i.isInvalid||i.dealed)return;let r=i.side,s=i.getBindedInter().side,n;Xe(r.getEnd(),i.coord)&&Xe(s.getEnd(),i.coord)?n=-1:Xe(r.getEnd(),i.coord)?r.nextSide!==s&&(n=1,i=i.getBindedInter()):Xe(s.getEnd(),i.coord)&&s.nextSide!==r&&(n=1),ZV(n,i,t),i.isDealed()})}function ZV(e,t,i){let r=t.getBindedInter(),s=t.side,n=r.side,a=s.getShape(),o=n.getShape(),l=1,h=!1;if(e===-1){if(jc(a.reverse(),o.reverse())||jc(s.nextSide.getShape(),n.nextSide.getShape())){let f=_o(s,s.nextSide,n,r,l,h,i);if(f.state===2){let u=new Error("info1.state === InState.IS_OVERLAP");throw u.customType="IS_OVERLAP",u}let d=_o(s,s.nextSide,n.nextSide,r,l,h,i);f.state===d.state&&c(f,d)}else if(!(jc(a.reverse(),n.nextSide.getShape())||jc(s.nextSide.getShape(),o.reverse()))){let f=oy(s,s.nextSide,n,!1,i);f===oy(s,s.nextSide,n.nextSide,!0,i)&&f!==oy(n,n.nextSide,s.nextSide,!0,i)&&t.setIsInvalid()}}else if(e===1){let f=function(d,u){return rt(d,u.start()).dot(rt(u,u.start()))>0};if(jc(a.reverse(),o.reverse())||jc(a,n.nextSide.getShape())){let d=rn(s,n,r,i,l,h,new Map);if(d.state===2){let p=new Error("info1.state === InState.IS_OVERLAP");throw p.customType="IS_OVERLAP",p}let u=rn(s,n.nextSide,r,i,l,h,new Map);d.state===u.state&&c(d,u)}else if(f(a.reverse(),o.reverse())&&f(a,n.nextSide.getShape())){let d=Sr(s,n,!1,i);d===Sr(s,n.nextSide,!0,i)&&d!==hh(n,n.nextSide,new gf(sP(a,t.coord,a.end()),i),!0,i)&&t.setIsInvalid()}}function c(f,d){f.inter.setIsInvalid(),d.inter.setIsInvalid(),t.setIsInvalid()}}function sP(e,t,i){if(e instanceof ce||t.distance2(i)<1e-6)return new ce(t,i);if(e instanceof xe)return xe.build2(e.center,t.angleD(e.center),i.angleD(e.center),e.rx,e.ry,e.sweep());if(e instanceof Fe){let r=e.getPercent(t,st),s=e.getPercent(i,st);return e.clip(r)[1].clip((s-r)/(1-r))[0]}else throw new Error("not supported operation")}function KV(e){let t=_l(e);if(!t)return[];let i=t.primitives.map(s=>new gf(s,null)),r=i[i.length-1];return i.forEach(s=>{r.connect(s),r=s}),i}var bo,$V=(bo=class{static clearData(t){this.originalPrimitive=[],this.offsetPrimitive=[],this.rawOffsetPrimitive=[],this.offsetDistance=0,this.testI++,this.testI===0?this.drawDebug=new _f(t):delete this.drawDebug}static createRawOffsetEdge(){if(this.drawDebug){let t=this.drawDebug.initColor(zt.WHITE);this.originalPrimitive.forEach(i=>t.addPt(i)),this.drawDebug.draw();debugger}for(let t=0;t<this.originalPrimitive.length;t+=1){let i=this.originalPrimitive[t];this.offsetPrimitive.push({index:t,offsetEdge:this.createOffsetEdge(i)})}if(this.drawDebug){let t=this.drawDebug.initColor(zt.Golden);this.offsetPrimitive.forEach(i=>t.addPt(i.offsetEdge)),this.drawDebug.draw();debugger}if(this.offsetPrimitive.length>1)for(let t=0;t<this.offsetPrimitive.length;t+=1)if(t===this.offsetPrimitive.length-1){this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[0]);let i=this.rawOffsetPrimitive[0],r;i instanceof xe?r=xe.build4(this.offsetPrimitive[0].offsetEdge.start(),i.end(),i.center,i.rx,i.ry,i.sweep()):r=new ce(this.offsetPrimitive[0].offsetEdge.start(),i.end()),this.rawOffsetPrimitive.shift(),this.rawOffsetPrimitive.unshift(r)}else this.connectPrimitive(this.offsetPrimitive[t],this.offsetPrimitive[t+1]);else this.rawOffsetPrimitive=[]}static createCirclePrimitive(t,i){let r=t.width()*.5,s=t.height()*.5,n=Math.sqrt(r**2+s**2)+i;return[xe.buildCircle(t.center(),n)]}static getExtendPolyLine(t,i,r=!0,s){var o,l;if(!((o=t==null?void 0:t.primitives)!=null&&o.length))return[];let n=_l(t);if(!((l=n==null?void 0:n.primitives)!=null&&l.length)){if(this.isExpansion){let h=[1],c=i*2;t.primitives.forEach(d=>h.push(d.stroke(c,1,0)));let f=FV(h,s);if(f.items.length!==1)throw new Error("group.items.length !== 1 ");return[f.items[0].items[0]]}return[]}if(t=n,this.clearData(s),this.originalPrimitive=t.primitives,this.isExpansion=i>0,this.offsetDistance=i,this.createRawOffsetEdge(),this.drawDebug){let h=this.drawDebug.initColor(zt.BLUE);this.rawOffsetPrimitive.forEach(c=>h.addPt(c)),this.drawDebug.draw();debugger}let a=r?this.createClippingEdge(s):[xt.build2(this.rawOffsetPrimitive)];if(this.drawDebug){let h=this.drawDebug.initColor(zt.RED);a.forEach(c=>h.addPly(c)),this.drawDebug.draw();debugger}if(a.length&&(!this.isExpansion||this.isExpansion&&a.length>1)&&(a=this.getValidityPrimitive(a)),this.drawDebug){let h=this.drawDebug.initColor(zt.GREEN);a.forEach(c=>h.addPly(c)),this.drawDebug.draw();debugger;throw new Error}return a}static getValidityPrimitive(t){let i=[],r=Math.abs(this.offsetDistance);for(let s=0;s<t.length;s+=1){let n=!0,a=t[s].primitives;e:for(let o=0;o<a.length;o+=1){let l=a[o],h;if(l instanceof xe)h=l.midPoint;else if(l instanceof ce)h=l.start();else throw new Error("not support!");for(let c=0;c<this.originalPrimitive.length;c+=1){let f=this.originalPrimitive[c],d;if(f instanceof xe?d=this.pointArcClosest(h,f):d=RY(h,f.start(),f.end()).d,r-d>.01){n=!1;break e}}}n&&i.push(t[s])}return i}static getInters(t){let i=[];for(let r=0;r<t;r+=2)i.push(new ge(ie[r],ie[r+1]));return i}static pointArcClosest(t,i){let r=i.center;if(t.equals1(i.center))return i.rx;if(i.inArea(t,0)){let a=t.sub(r);return Math.abs(a.length()-i.rx)}let s=t.distance2(i.start()),n=t.distance2(i.end());return we.less(s,n)?Math.sqrt(s):Math.sqrt(n)}static createClippingEdge(t){let i=[],r=[],s=rP(xt.build2(this.rawOffsetPrimitive),t);s.forEach(a=>{let o=a.area(.01);i.push(o)});let n=Math.min(...i.filter(a=>a<0));for(let a=0;a<i.length;a+=1){let o=i[a];we.eq(o,0)||(!this.isExpansion&&o<0||this.isExpansion&&(o<0&&i[a]===n||o>0))&&r.push(s[a])}return r}static createOffsetEdge(t){if(t instanceof xe)return t.panDistance1(this.offsetDistance);if(t instanceof ce)return t.panDistance(this.offsetDistance);throw new Error("not support!")}static connectPrimitive(t,i){t.offsetEdge instanceof ce&&i.offsetEdge instanceof ce?this.lineToLineConnect(t,i):t.offsetEdge instanceof xe&&i.offsetEdge instanceof xe?this.arcToArcConnect(t,i):t.offsetEdge instanceof ce&&i.offsetEdge instanceof xe?this.lineToArcConnect(t,i):this.arcToLineConnect(t,i)}static isFalseIntersection(t){return t>1||t<0}static lineToLineConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=i.index,a=this.originalPrimitive[n].start();if(r.isParallel(s))r.bbox().intersection1(s.bbox())?this.rawOffsetPrimitive.push(r):this.lineToLineUseArcToConnect(a,r,s);else{let o=this.getLineToLineT(r,s),l=o[0],h=o[1];if(this.isFalseIntersection(l)||this.isFalseIntersection(h))l>1&&this.isFalseIntersection(h)?this.lineToLineUseArcToConnect(a,r,s):this.useLineToConnect(r,s);else if(!this.isFalseIntersection(l)&&!this.isFalseIntersection(h)){let c=r.end().sub(r.start()),f=r.start().add(c.mul(l)),d=new ce(r.start(),f);this.rawOffsetPrimitive.push(d);let u=new ce(f,s.end());this.updateNextOffsetPrimitive(n,u)}}}static updateNextOffsetPrimitive(t,i){this.offsetPrimitive[t].offsetEdge=i}static useLineToConnect(t,i){this.rawOffsetPrimitive.push(t);let r=new ce(t.end(),i.start());this.rawOffsetPrimitive.push(r)}static lineToLineUseArcToConnect(t,i,r){let s=this.getSweep(t,i),n=this.getSweepAngel(i.end(),r.start(),t,s);if(n===0){this.useLineToConnect(i,r);return}this.rawOffsetPrimitive.push(i);let a=xe.build5(i.end(),r.start(),n);this.rawOffsetPrimitive.push(a)}static getSweep(t,i,r){let s=null,n=r||r===0?this.originalPrimitive[r]:i;if(n instanceof xe){let a=n.center.sub(n.end()).normalize();n.isCCW?s=new ge(a.y,-a.x):s=new ge(-a.y,a.x)}else s=i.end().sub(i.start()).normalize();return t.sub(i.end()).normalize().cross(s)>0?0:1}static getLineToLineT(t,i){let r=t.end().sub(t.start()),s=i.end().sub(i.start()),n=r.cross(s),a=i.start().sub(t.start()),o=t.start().sub(i.start()),l=a.cross(s)/n,h=o.cross(r)/-n;return[l,h]}static lineToArcConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=t.index,a=i.index,o=this.getLineJoinArcScalarAndIntersectionNum(r,s),l=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(l,r,s,n);else if(o.intersectionNum===1){let h=o.points[0];this.lineAndArcConnectionDetail(r,s,o.t[0],h,l,n,a)}else if(o.intersectionNum===2){let h=o.points[0],c=o.points[1],f=h.distance2(l),d=c.distance2(l);this.lineAndArcConnectionDetail(r,s,f<d?o.t[0]:o.t[1],f<d?h:c,l,n,a)}}static lineAndArcConnectionDetail(t,i,r,s,n,a,o){let l=this.isTrueArcIntersection(i,s);if(!this.isFalseIntersection(r)&&l){let h=new ce(t.start(),s);this.rawOffsetPrimitive.push(h);let c;!i.center.equals1(s)||i.sweepAngle>1e-4?(c=xe.build4(s,i.end(),i.center,i.rx,i.ry,i.sweep()),c instanceof xe&&c.sweepAngle===0&&(c=new ce(c.start(),c.end()))):c=new ce(i.center,s),this.updateNextOffsetPrimitive(o,c)}else l?this.useLineToConnect(t,i):this.lineAndArcUseArcConnect(n,t,i,a)}static lineAndArcUseArcConnect(t,i,r,s){let n=this.getSweep(t,i,s),a=this.getSweepAngel(i.end(),r.start(),t,n);if(a===0){this.useLineToConnect(i,r);return}let o=xe.build5(i.end(),r.start(),a);this.rawOffsetPrimitive.push(i),this.rawOffsetPrimitive.push(o)}static arcToLineConnectionDetail(t,i,r,s,n,a,o){let l=this.isTrueArcIntersection(t,s);if(!this.isFalseIntersection(r)&&l){let h;t.center.equals1(s)?h=new ce(t.center,s):Math.abs(t.sweepAngle)<1e-4?h=new ce(t.start(),s):(h=xe.build4(t.start(),s,t.center,t.rx,t.ry,t.sweep()),h instanceof xe&&h.sweepAngle===0&&(h=new ce(h.start(),h.end()))),this.rawOffsetPrimitive.push(h);let c=new ce(s,i.end());this.updateNextOffsetPrimitive(o,c)}else l?this.useLineToConnect(t,i):this.lineAndArcUseArcConnect(n,t,i,a)}static isTrueArcIntersection(t,i){return Vi(t,i)}static getSweepAngel(t,i,r,s){let n=t.angleD(r),a=i.angleD(r),o;return n===a?o=0:(n=ht.regularD(n),a=ht.regularD(a),s===1?a<=n&&(a+=360):a>=n&&(n+=360),o=a-n),o}static getLineJoinArcScalarAndIntersectionNum(t,i){let r={t:[],intersectionNum:0,points:[]},s=CY(i,t);if(s){r.intersectionNum=s/2;for(let n=0;n<s-1;n+=2){let a=new ge(ie[n],ie[n+1]);r.points.push(a),a.sub(t.start()).x<1e-4||a.sub(t.start()).y<1e-4?r.t.push(0):r.t.push(a.sub(t.start()).x/t.end().sub(t.start()).x)}}else r.intersectionNum=0;return r}static arcToLineConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=t.index,a=i.index,o=this.getLineJoinArcScalarAndIntersectionNum(s,r),l=this.originalPrimitive[a].start();if(o.intersectionNum===0)this.lineAndArcUseArcConnect(l,r,s,n);else if(o.intersectionNum===1){let h=o.points[0];this.arcToLineConnectionDetail(r,s,o.t[0],h,l,n,a)}else if(o.intersectionNum===2){let h=o.points[0],c=o.points[1],f=h.distance2(l),d=c.distance2(l);this.arcToLineConnectionDetail(r,s,f<d?o.t[0]:o.t[1],f<d?h:c,l,n,a)}}static rxChangeStatus(t){return t===1?!this.isExpansion:this.isExpansion}static arcToArcConnect(t,i){let r=t.offsetEdge,s=i.offsetEdge,n=kI(r,s);if(n){let a=this.getInters(n),o;if(a.length===2){let c=this.originalPrimitive[i.index].start(),f=a[0],d=a[1],u=f.distance2(c),p=d.distance2(c);u<p?o=f:o=d}else o=a[0];let l,h;o.equals1(r.center)?l=new ce(r.center,o):Math.abs(r.sweepAngle)<1e-4?l=new ce(r.start(),o):(l=xe.build4(r.start(),o,r.center,r.rx,r.ry,r.sweep()),l instanceof xe&&l.sweepAngle===0&&(l=new ce(l.start(),l.end()))),this.rawOffsetPrimitive.push(l),o.equals1(s.center)?h=new ce(o,s.center):Math.abs(s.sweepAngle)<1e-4?h=new ce(o,s.end()):(h=xe.build4(o,s.end(),s.center,s.rx,s.ry,s.sweep()),h instanceof xe&&h.sweepAngle===0&&(h=new ce(h.start(),h.end()))),this.updateNextOffsetPrimitive(i.index,h)}else{let a=this.originalPrimitive[t.index],o=this.originalPrimitive[i.index],l=this.rxChangeStatus(a.sweep()),h=this.rxChangeStatus(o.sweep()),c=this.originalPrimitive[i.index].start(),f=this.getSweep(c,r,t.index),d=Math.abs(this.offsetDistance),u=xe.build2(c,l?a.endAngle():a.endAngle()+180,h?o.startAngle:o.startAngle+180,d,d,f);this.rawOffsetPrimitive.push(r),this.rawOffsetPrimitive.push(u)}}},bo.originalPrimitive=[],bo.offsetPrimitive=[],bo.rawOffsetPrimitive=[],bo.testI=0,bo),QV=class tf extends ff{constructor(t,i,r,s,n,a){if(super(),i<0||r<0)throw new Error("The width and height of rect can't be less than 0!");this.leftUpPoint=t,this.width=i,this.height=r,this.angle=s,this.isCCW=n,this.radius=Math.min(Math.max(a,0),i/2,r/2)}get radiusRatio(){return this.radius/Math.min(this.width,this.height)}start(){return this.leftUpPoint.add(new ge(this.radius,0).multiply3(er.rotateD(this.angle)))}end(){return this.start()}getLeftPoint(){return this.leftUpPoint.add(new ge(0,-this.height/2).multiply3(er.rotateD(this.angle)))}getRightPoint(){return this.leftUpPoint.add(new ge(this.width,-this.height/2).multiply3(er.rotateD(this.angle)))}extend(t){return new tf(this.leftUpPoint.add(new ge(-t,t).rotateD(ge.ORIGIN,this.angle)),this.width+t*2,this.height+t*2,this.angle,this.isCCW,this.radius+t)}bbox(){let t=er.rotateD(this.angle),{leftUpPoint:i,width:r,height:s,radius:n}=this,a=i.add(new ge(n,-n).multiply3(t)),o=i.add(new ge(n,n-s).multiply3(t)),l=i.add(new ge(r-n,-n).multiply3(t)),h=i.add(new ge(r-n,n-s).multiply3(t));return new ls(Math.min(a.x,o.x,l.x,h.x)-n,Math.max(a.x,o.x,l.x,h.x)+n,Math.min(a.y,o.y,l.y,h.y)-n,Math.max(a.y,o.y,l.y,h.y)+n)}toPolyline(){let t=[],{leftUpPoint:i,width:r,height:s,radius:n}=this;if(n===0){let o=ge.ORIGIN,l=new ge(r,0),h=new ge(r,-s),c=new ge(0,-s);t.push(new ce(o,l),new ce(l,h),new ce(h,c),new ce(c,o))}else{let o=new ge(0,-n),l=new ge(n,0),h=new ge(r-n,0),c=new ge(r,-n),f=new ge(r,n-s),d=new ge(r-n,-s),u=new ge(n,-s),p=new ge(0,n-s);t.push(xe.build1(o,l,n,n,!1,0),new ce(l,h),xe.build1(h,c,n,n,!1,0),new ce(c,f),xe.build1(f,d,n,n,!1,0),new ce(d,u),xe.build1(u,p,n,n,!1,0),new ce(p,o))}t=t.filter(o=>!o.start().equals1(o.end())),this.isCCW&&(t.forEach((o,l)=>t[l]=o.reverse()),t.reverse());let a=er.rotateD(this.angle).translate1(i);return xt.build2(t.map(o=>o.multiply3(a)))}center(){return this.leftUpPoint.add1(this.width/2,this.height/2).rotateD(this.leftUpPoint,this.angle)}multiply3(t){let i=this.leftUpPoint.multiply3(t),r=new ge(this.width,0).multiply3(er.rotateD(this.angle)).multiply3(t),s=new ge(0,-this.height).multiply3(er.rotateD(this.angle)).multiply3(t);return t.isMirrored()?new tf(i,s.length(),r.length(),s.angleD(ge.ORIGIN),this.isCCW===1?0:1,this.radius*r.length()/this.width):new tf(i,r.length(),s.length(),r.angleD(ge.ORIGIN),this.isCCW,this.radius*r.length()/this.width)}reverse(){return new tf(this.leftUpPoint,this.width,this.height,this.angle,this.isCCW===1?0:1,this.radius)}stroke(t,i,r){let s=this.stroke1(t,i,r);if(s.length===1)return s[0];{let[n,a]=s;return xt.build2(n.primitives.concat(new ce(n.primitives[0].start(),a.primitives[0].start()),a.primitives,new ce(a.primitives[0].start(),n.primitives[0].start())))}}stroke1(t,i,r){let s=r===this.isCCW?this:this.reverse(),n=t/2,a=Math.min(s.width,s.height)/2,o=s.extend(n).toPolyline();return a<=n?[o]:[o,s.extend(-n).toPolyline().reverse()]}points(t){let i=this.toPolyline(),r=[];return i.points(t,s=>r.push(s)),r}toBezier(){throw new Error("Method not implemented.")}},eq=.01,lr=class Xn{static simplify(t){return t=_l(t),t?new Xn([t]):null}static buildByStroke(t,i,r=1,s=Ly,n){if(t instanceof xe&&(t.rx<i/2+eq||Math.abs(t.sweepAngle)>180&&we.lesseq(t.start().distance1(t.end()),i))){let o=rP(t.stroke(i,r,0),n);if(o.length===0)return null;if(o.length===1)return new Xn(o);let l=[null],h=Number.POSITIVE_INFINITY;return o.forEach(c=>{let f=c.area(.1);f<0?f<h&&(l[0]=c,h=f):l.push(c)}),new Xn(l)}else if(t instanceof QV){let o=t.stroke1(i,r,0).map(l=>_l(l));return o[0]?o[1]?new Xn(o):new Xn([o[0]]):null}let a=t.stroke(i,r,0,s);return a?this.simplify(a):null}static buildCircle(t,i){return this.simplify(xt.build7([xe.buildCircle(t,i,0)]))}static buildRect(t){return this.simplify(t.toPolyline())}static buildBBox(t){return this.simplify(xt.buildBBox(t,0))}constructor(t){this.items=t.slice()}multiply3(t){return new Xn(this.items.map(i=>i.multiply3(t)))}bbox(){return this.items[0].bbox()}isEqual(t){return t instanceof Xn?this.items.every(i=>t.items.some(r=>r.isEqual(i))):!1}getOutMostPolyline(){return this.items[0]}extend(t,i){if(this.items.length!==1)throw new Error("this.items.length !== 1");if(t===0)return new ki([this]);let r=this.items[0],s=[];for(let c of r.primitives)if(c instanceof ce)s.push(c);else if(c instanceof xe&&c.rx===c.ry)a(c);else if(c instanceof Fe)n(c);else throw new Error("not support!");r=xt.build7(s);function n(c){let f=c.points(.1);for(let d=0;d<f.length-1;d++){let u=f[d],p=f[d+1];s.push(new ce(u,p))}}function a(c){if(Math.abs(c.sweepAngle)>270){let f=c.sweepAngle/2;a(xe.build3(c.center,c.startAngle,f,c.rx,c.ry)),a(xe.build3(c.center,c.startAngle+f,f,c.rx,c.ry))}else s.push(c)}let o=[],l=[];$V.getExtendPolyLine(r,t,!0,i).forEach(c=>{(c.area(.1)>0?l:o).push(c)});let h;if(o.length===1)l.forEach(c=>o.push(c)),h=new ki([new Xn(o)]);else if(o.length===0)console.warn("outlines.length === 0"),h=new ki([]);else if(l.length===0)h=new ki(o.map(c=>new Xn([c])));else{let c=o.map(f=>[f]);l.forEach(f=>{let d=[],u=f.bbox();if(c.forEach(p=>{p[0].bbox().isContainsBBox1(u)&&d.push(p)}),d.length===1)d[0].push(f);else{if(d.length===0)throw new Error("inPlsArr.length === 0");for(let p of d.sort((_,g)=>_[0].bbox().area()-g[0].bbox().area()))if(p[0].getWindingNum(f.start())===-1){p.push(f);break}}}),h=new ki(c.map(f=>new Xn(f)))}return h}toPolylineGroup(){return new Ry(this.items)}};var tq=(e=>(e[e.POLYGON=1]="POLYGON",e[e.POLYLINE=2]="POLYLINE",e[e.LINE=3]="LINE",e[e.ARC=4]="ARC",e[e.BEZIER2=5]="BEZIER2",e[e.BEZIER3=6]="BEZIER3",e[e.BOOLEAN_OUTPUT=7]="BOOLEAN_OUTPUT",e[e.BOOLEAN_INTERSECTION=8]="BOOLEAN_INTERSECTION",e[e.BOOLEAN_UNION=9]="BOOLEAN_UNION",e[e.BOOLEAN_DIFF=10]="BOOLEAN_DIFF",e[e.BOOLEAN_RESULT=11]="BOOLEAN_RESULT",e[e.LINES=12]="LINES",e[e.ARCS=13]="ARCS",e[e.BEZIER2S=14]="BEZIER2S",e[e.BEZIER3S=15]="BEZIER3S",e[e.CIRCLE_CW=16]="CIRCLE_CW",e[e.CIRCLE_CCW=17]="CIRCLE_CCW",e[e.POLYGON_GROUP=18]="POLYGON_GROUP",e))(tq||{});var _y=class{static repeat(e,t){let i=new Array(t);for(;t-- >0;)i[t]=e;return i.join("")}static lpad(e,t,i){let r=i-e.length;return r>0?this.repeat(t,r)+e:e}},iq=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.PERCENT=1]="PERCENT",e[e.LEFT_PAD0=2]="LEFT_PAD0",e))(iq||{}),rq=/(\.?0+)$/,Iy=class{static format(e,...t){return this.format1(e,t)}static format1(e,t){let i=this._format(e,t);if(typeof i=="string")return i;throw new Error(this.format("Invalid state on (%d) %s",i,e))}static _format(e,t){let i=[],r=0,s=0,n,a=0,o=0;for(let l=0;l<e.length;l++){let h=e.charAt(l),c=h.charCodeAt(0);switch(r){case 0:c===37?r=1:i.push(h);break;case 1:switch(c){case 100:if(n=t[s++],typeof n=="number")i.push(n.toFixed(0)),r=0;else return l;break;case 102:if(n=t[s++],typeof n=="number")i.push(n.toString()),r=0;else return l;break;case 120:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16)),r=0;else return l;break;case 88:if(n=t[s++],typeof n=="number")i.push((n|0).toString(16).toUpperCase()),r=0;else return l;break;case 115:case 99:n=t[s++],i.push(n===null?"null":n.toString()),r=0;break;case 48:a=l+1,o=-1,r=2;break;case 37:i.push("%"),r=0;break;default:return l}break;case 2:switch(c){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:o=l;break;case 100:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(_y.lpad((n|0).toString(10),"0",f)),r=0;else return l}else return l;break;case 120:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(_y.lpad((n|0).toString(16),"0",f)),r=0;else return l}else return l;break;case 88:if(o>=a){let f=parseInt(e.substring(a,o+1));if(n=t[s++],typeof n=="number")i.push(_y.lpad((n|0).toString(16).toUpperCase(),"0",f)),r=0;else return l}else return l;break;default:return l}break;default:return l}}return i.join("")}static startsWith(e,t){return e.length>=t.length?e.substring(0,t.length)===t:!1}static endsWith(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}static fmtNumber(e){return e.toFixed(5).replace(rq,"")}},sq=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.DUMMY=4]="DUMMY",e))(sq||{});function nq(e){switch(e){case 0:return"DEBUG";case 1:return"INFO";case 2:return"WARNING";case 3:return"ERROR";case 4:return"DUMMY"}}var aq=(e,t)=>{e===3?console.error(...t):e===2?console.warn(...t):console.log(...t)},oq=(e,t)=>[nq(e)].concat(t),xo,Cae=(xo=class{static mix(...t){return new xo(0,(i,r)=>{for(let s of t)s.write(i,r)},(i,r)=>r)}constructor(t,i=aq,r=oq){this.level=t,this.writer=i,this.fmt=r}setLevel(t){this.level=t}prepend(t=null,i=null){let r=t===null?this.fmt:(n,a)=>(a=t(n,a),this.fmt(n,a)),s=i===null?this.writer:(n,a)=>{i(n,a),this.writer(n,a)};return new xo(this.level,s,r)}chain(t){return t.prepend(this.fmt.bind(this),this.writer.bind(this))}include(t){return this.level<=t}formatWrite(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,[Iy.format(i,...r)]))}write(t,i){this.include(t)&&this.writer(t,this.fmt(t,i))}write3(t,i,r){this.include(t)&&this.writer(t,this.fmt(t,[Iy.format(i,...r)]))}debug3(t,...i){this.write3(0,t,i)}warning3(t,...i){this.write3(2,t,i)}debugFmt(t,...i){this.formatWrite(0,t,i)}debug(...t){this.write(0,t)}infoFmt(t,...i){this.formatWrite(1,t,i)}info(...t){this.write(1,t)}warningFmt(t,...i){this.formatWrite(2,t,i)}warning(...t){this.write(2,t)}errorFmt(t,...i){this.formatWrite(3,t,i)}error(...t){this.write(3,t)}},xo.DUMMY=new xo(4),xo);var Nae=String.fromCharCode;var lq=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.NUMBER_INTEGER=1]="NUMBER_INTEGER",e[e.NUMBER_DECIMAL=2]="NUMBER_DECIMAL",e[e.NUMBER_E=3]="NUMBER_E",e[e.NUMBER_E_SIGNED=4]="NUMBER_E_SIGNED",e))(lq||{}),hq=(e=>(e[e.UNKNOW=0]="UNKNOW",e[e.MOVE_X=1]="MOVE_X",e[e.MOVE_Y=2]="MOVE_Y",e[e.LINE_X=3]="LINE_X",e[e.LINE_Y=4]="LINE_Y",e[e.HORIZONTAL_X=5]="HORIZONTAL_X",e[e.VERTICAL_Y=6]="VERTICAL_Y",e[e.CUBIC_BEZIER_X1=7]="CUBIC_BEZIER_X1",e[e.CUBIC_BEZIER_Y1=8]="CUBIC_BEZIER_Y1",e[e.CUBIC_BEZIER_X2=9]="CUBIC_BEZIER_X2",e[e.CUBIC_BEZIER_Y2=10]="CUBIC_BEZIER_Y2",e[e.CUBIC_BEZIER_X=11]="CUBIC_BEZIER_X",e[e.CUBIC_BEZIER_Y=12]="CUBIC_BEZIER_Y",e[e.ARC_RX=13]="ARC_RX",e[e.ARC_RY=14]="ARC_RY",e[e.ARC_ROTATION=15]="ARC_ROTATION",e[e.ARC_LARGE=16]="ARC_LARGE",e[e.ARC_SWEEP=17]="ARC_SWEEP",e[e.ARC_X=18]="ARC_X",e[e.ARC_Y=19]="ARC_Y",e[e.SMOOTH_CUBIC_BEZIER_X2=20]="SMOOTH_CUBIC_BEZIER_X2",e[e.SMOOTH_CUBIC_BEZIER_Y2=21]="SMOOTH_CUBIC_BEZIER_Y2",e[e.SMOOTH_CUBIC_BEZIER_X=22]="SMOOTH_CUBIC_BEZIER_X",e[e.SMOOTH_CUBIC_BEZIER_Y=23]="SMOOTH_CUBIC_BEZIER_Y",e[e.QUADRATIC_BEZIER_X1=24]="QUADRATIC_BEZIER_X1",e[e.QUADRATIC_BEZIER_Y1=25]="QUADRATIC_BEZIER_Y1",e[e.QUADRATIC_BEZIER_X=26]="QUADRATIC_BEZIER_X",e[e.QUADRATIC_BEZIER_Y=27]="QUADRATIC_BEZIER_Y",e))(hq||{});var cq=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.ENC_LINE=1]="ENC_LINE",e[e.ENC_ARC=2]="ENC_ARC",e[e.ENC_CUBIC_BEZIER=3]="ENC_CUBIC_BEZIER",e[e.ENC_QUADRATIC_BEZIER=4]="ENC_QUADRATIC_BEZIER",e))(cq||{}),Lae=Iy.fmtNumber;var uq=class{constructor(){}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodePadNet(e){let t=JSON.stringify(["PAD_NET",e.componentId,e.padNum,e.padId||""]),i={...e};return delete i.componentId,delete i.padNum,delete i.padId,{id:t,dataType:"PAD_NET",data:JSON.stringify(i)}}encodeComponent(e,t){return{id:e,dataType:"COMPONENT",data:JSON.stringify(t)}}encodePanelize(e){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(e)}}encodeRuleSelector(e){let t=JSON.stringify(["RULE_SELECTOR",e.ruleSelect]),i={...e};return delete i.ruleSelect,{id:t,dataType:"RULE_SELECTOR",data:JSON.stringify(i)}}encodeRule(e){let t=JSON.stringify(["RULE",e.ruleType,e.ruleName]),i={...e};return delete i.ruleType,delete i.ruleName,{id:t,dataType:"RULE",data:JSON.stringify(i)}}encodeRuleTemplate(e){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(e)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeBoss(e,t){return{id:e,dataType:"BOSS",data:JSON.stringify(t)}}encodeShellEntity(e,t){return{id:e,dataType:"SHELL_ENTITY",data:JSON.stringify(t)}}encodeShellCut(e,t){return{id:e,dataType:"SHELLCUT",data:JSON.stringify(t)}}encodeCrease(e,t){return{id:e,dataType:"CREASE",data:JSON.stringify(t)}}encodeShell(e,t){return{id:e,dataType:"SHELL",data:JSON.stringify(t)}}encodeFpcFill(e,t){return{id:e,dataType:"FPC_FILL",data:JSON.stringify(t)}}encodeTeardrop(e,t){return{id:e,dataType:"TEARDROP",data:JSON.stringify(t)}}encodeImage(e,t){return{id:e,dataType:"IMAGE",data:JSON.stringify(t)}}encodePoured(e,t){return{id:dr(e,"POURED"),dataType:"POURED",data:JSON.stringify(t)}}encodePour(e,t){return{id:e,dataType:"POUR",data:JSON.stringify(t)}}encodeRegion(e,t){return{id:e,dataType:"REGION",data:JSON.stringify(t)}}encodeFill(e,t){return{id:e,dataType:"FILL",data:JSON.stringify(t)}}encodeLayerFill(e,t){return{id:dr(e,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeEQLenGrp(e,t){return{id:e,dataType:"EQLEN_GRP",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodePad(e,t){return{id:e,dataType:"PAD",data:JSON.stringify(t)}}encodeVia(e,t){return{id:e,dataType:"VIA",data:JSON.stringify(t)}}encodePreference(e){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(e)}}encodeSilkOpts(e,t){return{id:dr(e,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodePrimitive(e,t){return{id:dr(e,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(t)}}encodeNet(e,t){return{id:dr(e,"NET"),dataType:"NET",data:JSON.stringify(t)}}encodePartition(e,t){return{id:e,dataType:"PARTITION",data:JSON.stringify(t)}}encodeActiveLayer(e){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(e)}}encodeLayerPhys(e,t){return{id:dr(e,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(t)}}encodeLayer(e,t){return{id:dr(e,"LAYER"),dataType:"LAYER",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}},dq=class{constructor(){}encodeString(e,t){return{id:e,dataType:"STRING",data:JSON.stringify(t)}}encodeAttr(e,t){return{id:e,dataType:"ATTR",data:JSON.stringify(t)}}encodePanelize(e){return{id:"PANELIZE",dataType:"PANELIZE",data:JSON.stringify(e)}}encodeRuleSelector(e){let t=JSON.stringify(["RULE_SELECTOR",e.ruleSelect]),i={...e};return delete i.ruleSelect,{id:t,dataType:"RULE_SELECTOR",data:JSON.stringify(i)}}encodeRule(e){let t=JSON.stringify(["RULE",e.ruleType,e.ruleName]),i={...e};return delete i.ruleType,delete i.ruleName,{id:t,dataType:"RULE",data:JSON.stringify(i)}}encodeRuleTemplate(e){return{id:"RULE_TEMPLATE",dataType:"RULE_TEMPLATE",data:JSON.stringify(e)}}encodeDimension(e,t){return{id:e,dataType:"DIMENSION",data:JSON.stringify(t)}}encodeBoss(e,t){return{id:e,dataType:"BOSS",data:JSON.stringify(t)}}encodeShellEntity(e,t){return{id:e,dataType:"SHELL_ENTITY",data:JSON.stringify(t)}}encodeShellCut(e,t){return{id:e,dataType:"SHELLCUT",data:JSON.stringify(t)}}encodeCrease(e,t){return{id:e,dataType:"CREASE",data:JSON.stringify(t)}}encodeShell(e,t){return{id:e,dataType:"SHELL",data:JSON.stringify(t)}}encodeFpcFill(e,t){return{id:e,dataType:"FPC_FILL",data:JSON.stringify(t)}}encodeTeardrop(e,t){return{id:e,dataType:"TEARDROP",data:JSON.stringify(t)}}encodeImage(e,t){return{id:e,dataType:"IMAGE",data:JSON.stringify(t)}}encodePoured(e,t){return{id:dr(e,"POURED"),dataType:"POURED",data:JSON.stringify(t)}}encodePour(e,t){return{id:e,dataType:"POUR",data:JSON.stringify(t)}}encodeRegion(e,t){return{id:e,dataType:"REGION",data:JSON.stringify(t)}}encodeFill(e,t){return{id:e,dataType:"FILL",data:JSON.stringify(t)}}encodeLayerFill(e,t){return{id:dr(e,"LAYER_FILL"),dataType:"LAYER_FILL",data:JSON.stringify(t)}}encodePoly(e,t){return{id:e,dataType:"POLY",data:JSON.stringify(t)}}encodeEQLenGrp(e,t){return{id:e,dataType:"EQLEN_GRP",data:JSON.stringify(t)}}encodeObj(e,t){return{id:e,dataType:"OBJ",data:JSON.stringify(t)}}encodeArc(e,t){return{id:e,dataType:"ARC",data:JSON.stringify(t)}}encodeLine(e,t){return{id:e,dataType:"LINE",data:JSON.stringify(t)}}encodePad(e,t){return{id:e,dataType:"PAD",data:JSON.stringify(t)}}encodeVia(e,t){return{id:e,dataType:"VIA",data:JSON.stringify(t)}}encodePreference(e){return{id:"PREFERENCE",dataType:"PREFERENCE",data:JSON.stringify(e)}}encodeSilkOpts(e,t){return{id:dr(e,"SILK_OPTS"),dataType:"SILK_OPTS",data:JSON.stringify(t)}}encodeGroup(e,t){return{id:e,dataType:"GROUP",data:JSON.stringify(t)}}encodePrimitive(e,t){return{id:dr(e,"PRIMITIVE"),dataType:"PRIMITIVE",data:JSON.stringify(t)}}encodeNet(e,t){return{id:dr(e,"NET"),dataType:"NET",data:JSON.stringify(t)}}encodeActiveLayer(e){return{id:"ACTIVE_LAYER",dataType:"ACTIVE_LAYER",data:JSON.stringify(e)}}encodeLayerPhys(e,t){return{id:dr(e,"LAYER_PHYS"),dataType:"LAYER_PHYS",data:JSON.stringify(t)}}encodeLayer(e,t){return{id:dr(e,"LAYER"),dataType:"LAYER",data:JSON.stringify(t)}}encodeCanvas(e){return{id:"CANVAS",dataType:"CANVAS",data:JSON.stringify(e)}}};var fq=class extends Hj{constructor(e){let t=e||new CI;super(t,0,KH),this.cacheNum=null}onParseLine(e,t,i,r,s,n,a){switch(this.setOrderNum(e,a,t),this.cacheNum=a,t){case"MAX_NUM":if(i)for(let l in i)this.setMaxNum(l,i[l]);break;case"BLOB":i?this.onBlob(e,r,s,i,n):this.onDelBlob(e,r,s,n);break;case"FONT":this.parseFont(e,i,r,s,n);break;case"META":i&&this.parseDetail(i,r,s,n);break;case"ELE_PLACEHOLDER":break;case"CANVAS":i&&this.parseCanvas(i,r,s,n);break;case"BOARD":i?this.parseBoard(i,r,s,n):this.onDelBoard(r,s,n);break;case"LAYER":{let l=ol(e);i?this.parseLayer(l,i,r,s,n):this.onDelLayer(l,r,s,n);break}case"LAYER_PHYS":{let l=ol(e);i?this.parseLayerPhys(l,i,r,s,n):this.onDelLayerPhys(l,r,s,n);break}case"ACTIVE_LAYER":i&&this.parseActiveLayer(e,i,r,s,n);break;case"PARTITION":i?this.parsePartition(e,i,r,s,n):this.onDelPartition(e,r,s,n);break;case"NET":{let l=ol(e);i?this.parseNet(l,i,r,s,n):this.onDelNet(l,r,s,n);break}case"PRIMITIVE":{let l=ol(e);i?this.parsePrimitive(l,i,r,s,n):this.onDelPrimitive(l,r,s,n);break}case"GROUP":i?this.parseGroup(e,i,r,s,n):this.onDelGroup(e,r,s,n);break;case"SILK_OPTS":{let l=ol(e);i?this.parseSilkOpts(l,i,r,s,n):this.onDelSilkOpts(l,r,s,n);break}case"PREFERENCE":i&&this.parsePreference(e,i,r,s,n);break;case"VIA":i?this.parseVia(e,i,r,s,n):this.onDelVia(e,r,s,n);break;case"PAD":i?this.parsePad(e,i,r,s,n):this.onDelPad(e,r,s,n);break;case"LINE":i?this.parseLine(e,i,r,s,n):this.onDelLine(e,r,s,n);break;case"ARC":i?this.parseArc(e,i,r,s,n):this.onDelArc(e,r,s,n);break;case"OBJ":i?this.parseObj(e,i,r,s,n):this.onDelObj(e,r,s,n);break;case"EQLEN_GRP":i?this.parseEQLenGrp(e,i,r,s,n):this.onDelEQLenGrp(e,r,s,n);break;case"POLY":i?this.parsePoly(e,i,r,s,n):this.onDelPoly(e,r,s,n);break;case"FILL":i?this.parseFill(e,i,r,s,n):this.onDelFill(e,r,s,n);break;case"LAYER_FILL":let o=ol(e);i?this.parseLayerFill(o,i,r,s,n):this.onDelLayerFill(o,r,s,n);break;case"REGION":i?this.parseRegion(e,i,r,s,n):this.onDelRegion(e,r,s,n);break;case"POUR":i?this.parsePour(e,i,r,s,n):this.onDelPour(e,r,s,n);break;case"POURED":{e=ol(e),i?this.parsePoured(e,i,r,s,n):this.onDelPoured(e,r,s,n);break}case"IMAGE":i?this.parseImage(e,i,r,s,n):this.onDelImage(e,r,s,n);break;case"TEARDROP":i?this.parseTeardrop(e,i,r,s,n):this.onDelTeardrop(e,r,s,n);break;case"FPC_FILL":i?this.parseFpcFill(e,i,r,s,n):this.onDelFpcFill(e,r,s,n);break;case"SHELL":i?this.parseShell(e,i,r,s,n):this.onDelShell(e,r,s,n);break;case"CREASE":i?this.parseCrease(e,i,r,s,n):this.onDelCrease(e,r,s,n);break;case"SHELLCUT":i?this.parseShellCut(e,i,r,s,n):this.onDelShellCut(e,r,s,n);break;case"SHELL_ENTITY":i?this.parseShellEntity(e,i,r,s,n):this.onDelShellEntity(e,r,s,n);break;case"BOSS":i?this.parseBoss(e,i,r,s,n):this.onDelBoss(e,r,s,n);break;case"STRING":i?this.parseString(e,i,r,s,n):this.onDelString(e,r,s,n);break;case"ATTR":i?this.parseAttr(e,i,r,s,n):this.onDelAttr(e,r,s,n);break;case"DIMENSION":i?this.parseDimension(e,i,r,s,n):this.onDelDimension(e,r,s,n);break;case"COMPONENT":i?this.parseComponent(e,i,r,s,n):this.onDelComponent(e,r,s,n);break;case"PAD_NET":{let l=JSON.parse(e);i?(i.componentId=l[1],i.padNum=l[2],i.padId=l[3],this.parsePadNet(i,r,s,n)):this.onDelPadNet(l[1],l[2],l[3]||"",r,s,n);break}case"RULE_TEMPLATE":i&&this.parseRuleTemplate(e,i,r,s,n);break;case"RULE":{let l=JSON.parse(e);i?(i.ruleType=l[1],i.ruleName=l[2],this.parseRule(i,r,s,n)):this.onDelRule(l[1],l[2],r,s,n);break}case"RULE_SELECTOR":{let l=JSON.parse(e);i?(i.ruleSelect=l[1],this.parseRuleSelector(i,r,s,n)):this.onDelRuleSelector(l[1],r,s,n);break}case"PANELIZE":i?this.parsePanelize(e,i,r,s,n):this.onDelPanelize(r,s,n);break;default:console.warn("can not find hanlder with",i,r,s)}this.cacheNum=null}onOrderNum(e,t,i){switch(this.setOrderNum(e,i,t),t){case"PARTITION":this.onPartitionNum&&this.onPartitionNum(e,i);break;case"VIA":this.onViaNum&&this.onViaNum(e,i);break;case"PAD":this.onPadNum&&this.onPadNum(e,i);break;case"LINE":this.onLineNum&&this.onLineNum(e,i);break;case"ARC":this.onArcNum&&this.onArcNum(e,i);break;case"OBJ":this.onObjNum&&this.onObjNum(e,i);break;case"POLY":this.onPolyNum&&this.onPolyNum(e,i);break;case"FILL":this.onFillNum&&this.onFillNum(e,i);break;case"REGION":this.onRegionNum&&this.onRegionNum(e,i);break;case"POUR":this.onPourNum&&this.onPourNum(e,i);break;case"POURED":let r=ol(e);this.onPouredNum&&this.onPouredNum(r,i);break;case"IMAGE":this.onImageNum&&this.onImageNum(e,i);break;case"TEARDROP":this.onTeardropNum&&this.onTeardropNum(e,i);break;case"FPC_FILL":this.onFpcFillNum&&this.onFpcFillNum(e,i);break;case"SHELL":this.onShellNum&&this.onShellNum(e,i);break;case"CREASE":this.onCreaseNum&&this.onCreaseNum(e,i);break;case"SHELLCUT":this.onShellCutNum&&this.onShellCutNum(e,i);break;case"SHELL_ENTITY":this.onShellEntityNum&&this.onShellEntityNum(e,i);break;case"BOSS":this.onBossNum&&this.onBossNum(e,i);break;case"STRING":this.onStringNum&&this.onStringNum(e,i);break;case"ATTR":this.onAttrNum&&this.onAttrNum(e,i);break;case"DIMENSION":this.onDimensionNum&&this.onDimensionNum(e,i);break;case"COMPONENT":this.onComponentNum&&this.onComponentNum(e,i);break}}onParseEnd(){}parseCanvas(e,t,i,r){this.onCanvas(t,i,e,r)}parseBoard(e,t,i,r){this.onBoard(e,t,i,r)}parseDetail(e,t,i,r){this.onDocDetail(t,i,e,r)}parseFont(e,t,i,r,s){let n=Gj(e);t?this.onFont(i,r,Object.assign(t,n),s):this.onDelFont(n,i,r,s)}parseLayer(e,t,i,r,s){this.onLayer(e,i,r,t,s)}parseLayerPhys(e,t,i,r,s){this.onLayerPhys(e,i,r,t,s)}parseActiveLayer(e,t,i,r,s){this.onActiveLayer(i,r,t,s)}parsePartition(e,t,i,r,s){this.onPartition(e,this.cacheNum,i,r,t,s)}parseNet(e,t,i,r,s){this.onNet(e,i,r,t,s)}parsePrimitive(e,t,i,r,s){this.onPrimitive(e,i,r,t,s)}parseGroup(e,t,i,r,s){this.onGroup(e,i,r,t,s)}parseSilkOpts(e,t,i,r,s){this.onSilkOpts(e,i,r,t,s)}parsePreference(e,t,i,r,s){this.onPreference(i,r,t,s)}parseVia(e,t,i,r,s){this.onVia(e,this.cacheNum,i,r,t,s)}parsePad(e,t,i,r,s){this.onPad(e,this.cacheNum,i,r,t,s)}parseLine(e,t,i,r,s){this.onLine(e,this.cacheNum,i,r,t,s)}parseArc(e,t,i,r,s){this.onArc(e,this.cacheNum,i,r,t,s)}parseObj(e,t,i,r,s){this.onObj(e,this.cacheNum,i,r,t,s)}parseEQLenGrp(e,t,i,r,s){this.onEQLenGrp(e,i,r,t,s)}parsePoly(e,t,i,r,s){this.onPoly(e,this.cacheNum,i,r,t,s)}parseFill(e,t,i,r,s){t.fillStyle!=="PLANE"&&this.onFill(e,this.cacheNum,i,r,t,s)}parseLayerFill(e,t,i,r,s){this.onLayerFill(e,i,r,t,s)}parseRegion(e,t,i,r,s){this.onRegion(e,this.cacheNum,i,r,t,s)}parsePour(e,t,i,r,s){this.onPour(e,this.cacheNum,i,r,t,s)}parsePoured(e,t,i,r,s){let n=t;Array.isArray(t)&&(n={pourFill:t}),n.pourFill&&this.onPoured(e,this.cacheNum,i,r,n,s)}parseImage(e,t,i,r,s){this.onImage(e,this.cacheNum,i,r,t,s)}parseTeardrop(e,t,i,r,s){this.onTeardrop(e,this.cacheNum,i,r,t,s)}parseFpcFill(e,t,i,r,s){this.onFpcFill(e,this.cacheNum,i,r,t,s)}parseShell(e,t,i,r,s){this.onShell(e,this.cacheNum,i,r,t,s)}parseCrease(e,t,i,r,s){this.onCrease(e,this.cacheNum,i,r,t,s)}parseShellCut(e,t,i,r,s){this.onShellCut(e,this.cacheNum,i,r,t,s)}parseShellEntity(e,t,i,r,s){this.onShellEntity(e,this.cacheNum,i,r,t,s)}parseBoss(e,t,i,r,s){this.onBoss(e,this.cacheNum,i,r,t,s)}parseDimension(e,t,i,r,s){this.onDimension(e,this.cacheNum,i,r,t,s)}parseRuleTemplate(e,t,i,r,s){this.onRuleTemplate(i,r,t,s)}parseRule(e,t,i,r){this.onRule(t,i,e,r)}parseRuleSelector(e,t,i,r){if(e.ruleKeyValue&&(e.ruleKeyValue=Yj(e.ruleKeyValue)),e.copperValue&&e.copperValue.hasOwnProperty("7")){let s=e.copperValue[7];delete e.copperValue[7],e.copperValue.COPPER=s}if(e.innerPlaneValue&&e.innerPlaneValue.hasOwnProperty("6")){let s=e.innerPlaneValue[6];delete e.innerPlaneValue[6],e.innerPlaneValue.PLANE=s}this.onRuleSelector(t,i,e,r)}parsePanelize(e,t,i,r,s){this.onPanelize(i,r,t,s)}parseComponent(e,t,i,r,s){this.onComponent(e,this.cacheNum,i,r,t,s)}parsePadNet(e,t,i,r){this.onPadNet(t,i,e,r)}parseAttr(e,t,i,r,s){this.onAttr(e,this.cacheNum,i,r,t,s)}parseString(e,t,i,r,s){this.onString(e,this.cacheNum,i,r,t,s)}};var pq=(e=>(e.UNIVERSAL="UNIVERSAL",e))(pq||{}),_q=(e=>(e.SINGLE="SINGLE",e.MULTIPLE="MULTIPLE",e))(_q||{}),gq=(e=>(e.NONE="NONE",e.NAME="NAME",e.NUMBER="NUMBER",e))(gq||{}),Oq=(e=>(e.NONE="NONE",e.ZONE="ZONE",e))(Oq||{});var mq=iu(uf());function cf(){return self.EDITOR_TOP||self}function qg(e){return self[e]=self[e]||new mq.BroadcastChannelMessageBus(e)}var rh=(e,t)=>{let i=/{([^}]*)}/gim,r=[...new Set(e.match(i))];for(let s=0;s<r.length;s++){let n=r[s],a=n.substring(1,n.length-1);t[a]&&(e=e.replace(n,t[a]))}return e};var Oi={getTime:"/pro-mgr/serverTime/now",getUserL:"/pro-ui/loginUser/get",subMaxTick:"/pro-mgr/project/ticket",subBlob:"/pro-mgr/canvas/BLOB/update",subFont:"/pro-mgr/canvas/FONT/update",subRevoke:"/pro-mgr/{uuid}/revoke",pushPend:"/pro-mgr/worker/batchPendData",pushSync:"/pro-mgr/dataWorker/sync",pushRevoke:"/pro-mgr/worker/revoke",pullASync:"/pro-mgr/dataWorker/sync/{id}",personDestroy:"/mgr/libWorker/destroy",projectUpdate:"/pro-mgr/canvas/{uuid}/update",personUpdate:"/mgr/libWorker/component/{uuid}/update",personSave:"/mgr/libWorker/save",projectSave:"/mgr/projectWorker/setCanvas",canSavePend:"/mgr/projectWorker/canSavePend",hasSaveData:"/mgr/check/hasSaveData"},yq={projectUpdate:Oi.projectUpdate,personUpdate:Oi.personUpdate,projectCanSave:Oi.canSavePend,getProject:"/mgr/projectWorker/footprint/getCanvas",getPerson:"/mgr/libWorker/getFootprint",unwatch:"/mgr/projectWorker/footprint/unwatchCanvas"},bq={projectUpdate:Oi.projectUpdate,projectCanSave:Oi.canSavePend,getProject:"/mgr/projectWorker/pcb/getCanvas",unwatch:"/mgr/projectWorker/pcb/unwatchCanvas"},Rae={projectUpdate:Oi.projectUpdate,projectCanSave:Oi.canSavePend,getProject:"/mgr/projectWorker/sheet/getCanvas",unwatch:"/mgr/projectWorker/sheet/unwatchCanvas"},Dae={projectUpdate:Oi.projectUpdate,getProject:"/mgr/projectWorker/schematic/getCanvas",unwatch:"/mgr/projectWorker/schematic/unwatchCanvas"},Mae={projectUpdate:Oi.projectUpdate,projectCanSave:Oi.canSavePend,getProject:"/mgr/projectWorker/simulation/getCanvas",unwatch:"/mgr/projectWorker/simulation/unwatchCanvas"},Bae={projectUpdate:Oi.projectUpdate,personUpdate:Oi.personUpdate,projectCanSave:Oi.canSavePend,getProject:"/mgr/projectWorker/symbol/getCanvasOnCompiler",getPerson:"/mgr/libWorker/getSymbol",unwatch:"/mgr/projectWorker/symbol/unwatchCanvas"},kae={projectUpdate:Oi.projectUpdate,personUpdate:Oi.personUpdate,projectCanSave:Oi.canSavePend,getProject:"/mgr/projectWorker/panel/getCanvas",getPerson:"/mgr/libWorker/getPanelLib",unwatch:"/mgr/projectWorker/panel/unwatchCanvas"};var zs={send:"/pro-mgr/notify/send",sendMsg:"/document/sendMsg/cooperation",unwatch:"/document/unwatch/cooperation",watch:"/document/watch/cooperation",message:"/pro-mgr/notify/message/{path}/{uuid}/cooperation",established:"/pro-mgr/notify/message/ws/established",getWsId:"/pro-mgr/notify/getWsId",disconnect:"/pro-mgr/notify/message/ws/disconnect"},ky=class{constructor(e=!0){this._lockerTicket=0,this.isPull=!1,this.compiler={},this.order={SYMBOL:1,FOOTPRINT:2,DEVICE:3,SCH_PAGE:4,PCB:5},this._locker=e?++this._lockerTicket:0}getOrder(e){return this.order[e]||6}publish(){if(!this.isPull){this.isPull=!0,this._temporaryUnlock=this._locker;try{let e=Object.keys(this.compiler).sort((i,r)=>this.getOrder(i)-this.getOrder(r)),t=!1;for(let i of e){for(let[,r]of this.compiler[i])if(t=r.publish(),t)break;if(t)break}}finally{this._temporaryUnlock=0,this.isPull=!1}}}canPush(){return!this._locker||this._locker===this._temporaryUnlock}addCompiler(e){this.compiler[e.headType]||(this.compiler[e.headType]=new Map),this.compiler[e.headType].set(e.uniqueId,e)}removeCompiler(e){var t,i,r;(r=(i=(t=this.compiler)==null?void 0:t[e.headType])==null?void 0:i.delete)==null||r.call(i,e.uniqueId)}pull(){if(!this._locker)throw Error("\u4E0D\u5141\u8BB8\u5728\u975E pause \u72B6\u6001\u4E0B\u62C9\u53D6\u6570\u636E");this.publish()}resume(){this._locker=0,this.publish()}pause(){this._locker=++this._lockerTicket}dispose(){for(let e in this.compiler)this.compiler[e].clear();this.compiler=null}},hl={publish:"publish",destroy:"destroy",init:"init",selected:"selected"},xq=class{constructor(e,t,i,r=(a=>(a=cf())==null?void 0:a._TAB_ID_)(),s,n){var o;this.uuid=e,this.path=t,this.user=i,this.windowId=r,this.initIds={},this.sub=[],this.wsBus=n||qg(`/${this.windowId}/notify`),this.dataBus=s||this.wsBus,this._client=(o=cf())==null?void 0:o._WS_ID_}get client(){return this._client}watch(){this.dataBus.publish(zs.send,{topic:zs.watch,uuid:this.uuid,path:this.path})}initPublish(){var e;this.dataBus.publish(zs.send,{topic:zs.sendMsg,uuid:this.uuid,path:this.path,msg:{type:hl.publish,user:this.user,client:this.client,data:((e=this.getSelect)==null?void 0:e.call(this))||""}})}async init(){if(!this.isInit){if(this.sub.push(this.wsBus.subscribe(zs.established,e=>{this._client=e,this.watch(),this.initPublish()})),!this.client){let e=await this.wsBus.rpcCall(zs.getWsId);if(!e||this.client)return;this._client=e}this.watch(),this.sub.push(this.wsBus.subscribe(zs.disconnect,e=>{this.initIds[e]&&this.onDestroy(this.initIds[e],e)})),this.sub.push(this.dataBus.subscribe(rh(zs.message,{uuid:this.uuid,path:this.path}),e=>{if(e.type===1)e.connectId&&this.initIds[e.connectId]&&this.onDestroy(this.initIds[e.connectId],e.connectId);else if(e.msg){let t=e.msg;if(t.client===this.client)return;switch(t.type){case hl.destroy:this.onDestroy(t.userId,t.client),delete this.initIds[t.client];break;case hl.init:this.initIds[t.client]||(this.initIds[t.client]=t.user.uuid,this.onSelected(t.user,t.client,t.data||""));break;case hl.selected:this.onSelected(t.user,t.client,t.data||"");break;case hl.publish:this.dataBus.publish(zs.send,{topic:zs.sendMsg,uuid:this.uuid,path:this.path,msg:{type:hl.init,user:this.user,client:this.client,data:this.getSelect()||""}}),this.initIds[t.client]=t.user.uuid,this.onSelected(t.user,t.client,t.data||"");break;default:break}}})),this.initPublish(),this.isInit=!0}}publishSelected(e,t){this.dataBus.publish(zs.send,{topic:zs.sendMsg,uuid:this.uuid,path:this.path,msg:{type:hl.selected,user:this.user,client:this.client,data:e}}),t&&this.onSelected(this.user,this.client,e)}destroy(){if(this.isInit){this.isInit=!1,this.dataBus.publish(zs.send,{topic:zs.unwatch,uuid:this.uuid,path:this.path,msg:{type:hl.destroy,userId:this.user.uuid,client:this.client}});for(let e of this.sub)e.cancel();this.sub=[],this.initIds={}}}},SI=class extends xq{constructor(e,t,i,r,s,n,a,o){super(e,t,o,i,s,n),this.channel=r,this.selectedProps=a,this.cache=new Map,this.deleteCache=new Map}rePublish(){var e,t,i,r;if(this.channel.canPush()){for(let[s,n]of this.cache)(t=(e=this.selectedProps)==null?void 0:e.onSelect)==null||t.call(e,n.user,s,n.data);for(let[s,n]of this.deleteCache)(r=(i=this.selectedProps)==null?void 0:i.onQuit)==null||r.call(i,n,s)}}getSelect(){var e,t;return((t=(e=this.selectedProps)==null?void 0:e.getSelect)==null?void 0:t.call(e))||""}onSelected(e,t,i){var r,s;this.channel.canPush()?!this.deleteCache.has(t)&&this.cache.set(t,{user:e,data:i}):(s=(r=this.selectedProps)==null?void 0:r.onSelect)==null||s.call(r,e,t,i)}onDestroy(e,t){var i,r;this.channel.canPush()?(this.deleteCache.set(t,e),this.cache.delete(t)):(r=(i=this.selectedProps)==null?void 0:i.onQuit)==null||r.call(i,e,t)}dispose(){this.destroy(),this.cache.clear(),this.deleteCache.clear()}publishSelected(e,t){super.publishSelected(e,t)}},vq=iu(uf()),Eq=class{constructor(e,t,i,r=(b=>(b=cf())==null?void 0:b._TAB_ID_)(),s=new ky,n=null,a,o,l,h,c,f,d,u,p,_,g){this.uuid=e,this.path=t,this.isProject=i,this.windowId=r,this.channel=s,this.consistencyManager=n,this.selectedProps=l,this.setInit=h,this.onDocDetail=c,this.onUpdate=f,this.handleInit=d,this.onDelete=u,this.publishCache=p,this.onOrderNm=_,this.setMaxNum=g,this.isInit=!1,this.canSave=!0,this.sub=[],this.isInitIng=!1,this.cache={},this.deleteCache=new Map,this.pendTimer=null,this.pendCache={},this.pendCacheLength=0,this.wsBus=qg(`/${r}/notify`),n||(this._unique=ul()),this._headType=a,this.busTopic=o}get uniqueId(){return this._unique||this.consistencyManager.getUnique()}get headType(){return this._headType}setIsInitIng(e){var t;(t=this.setInit)==null||t.call(this,e),this.isInitIng=e}consoleDebug(...e){console.debug("[lc-protocol]",this._headType,this.uuid,...e)}publishLine(e,t,i,r,s,n=this.uuid,a,o,l,h,c){if(this.channel.canPush())return this.consistencyManager.remoteChange(t,s,n,e,i,r,void 0,void 0,void 0,a,void 0,o,l,c),!1;this.cache[n]||(this.cache[n]=new Map);let f=this.cache[n].get(e);return(h||!f||f.ticket<t||f.ticket===t&&(f.client<s||f.client===s&&!!f.pend!=!!a))&&this.cache[n].set(e,{client:s,ticket:t,dataType:r,data:i,pend:a,unique:o,pChange:f?void 0:l,num:c}),!0}onDocHead(){}onEnd(){}setDocType(e,t){e===this.uuid&&(this._headType=t)}setBusTopic(e){this.busTopic=e}publish(){var t,i,r;if(this.publishCache)return this.publishCache();let e=!1;for(let[s,n]of this.deleteCache){if(this.channel.canPush()){(t=this.onDelete)==null||t.call(this,n),delete this.cache[s];continue}e=!0;break}if(e)return e;for(let s in this.cache){let n=this.cache[s].keys();for(let a of n){let o=this.cache[s].get(a);if(e=this.publishLine(a,o.ticket,o.data,o.dataType,o.client,s,o.pend,o.unique,o.pChange,!1,o.num),e)break;this.cache[s].delete(a)}if(e)break}return(r=(i=this.selectManager)==null?void 0:i.rePublish)==null||r.call(i),e}publishSelected(e,t){this.selectManager.publishSelected(e,t)}clear(){var e,t;for(let i of this.sub)i.cancel();this.sub.length=0,this.cache={},this.deleteCache.clear(),this.setIsInitIng(!1),this.channel.removeCompiler(this),(t=(e=this.selectManager)==null?void 0:e.dispose)==null||t.call(e),this.selectManager=null,this.isInit=!1,this.setIsInitIng(!1)}async init(e=!0,t=!0,i=!0,r,s,n,a){try{if(this.isInit)return{success:!0};if(this.isInitIng)throw new Error("\u6B63\u5728\u521D\u59CB\u5316\u4E2D");return this.isProject?await this.initProject(e,t,i,r,n,a):await this.initLib(i,r,s,n,a)}catch(o){throw this.clear(),new Error(`${this._headType}+'Compiler' ${this.uuid} init false: ${(o==null?void 0:o.message)||o||""}`,{cause:o})}finally{this.isInitIng=!1}}async flowRead(e){let t=this.consistencyManager.flowParseFull(),i=t.update,r=this;t.update=s=>{if(r.isDestroy)return!0;i(s)},await(0,vq.flowRead)(e,t)}pushOnLine(e,t){if(this.consistencyManager)for(let i of e)this.publishLine(i[0],i[1],i[2],i[3],i[4],t,i[5],i[6],i[7],!1,i[8])}async initProject(e,t,i,r,s,n){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=qg(`/${this.windowId}/project/${this.path}`),s&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,l=>{if(this.onOrderNm)for(let h of l)this.onOrderNm(h[0],h[1],h[2])})),i&&this.busTopic.projectUpdate&&this.sub.push(this.dataBus.subscribe(rh(this.busTopic.projectUpdate,{uuid:this.uuid}),l=>{this.onUpdate?this.onUpdate(l):this.pushOnLine(l,this.uuid)})),i&&this.busTopic.projectCanSave&&this.sub.push(this.dataBus.subscribe(this.busTopic.projectCanSave,l=>{this.canSave=l})),i&&this.busTopic.subDelete&&this.sub.push(this.dataBus.subscribe(this.busTopic.subDelete,l=>{var h;this.channel.canPush()?(h=this.onDelete)==null||h.call(this,l):this.deleteCache.set(l[0],l)})),i&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(Oi.subMaxTick,l=>{this.consistencyManager.setMaxTicket(l.ticket,l.force)})),i&&t&&this.sub.push(this.dataBus.subscribe(Oi.subBlob,l=>{this.pushOnLine(l,"BLOB")})),i&&e&&this.sub.push(this.dataBus.subscribe(Oi.subFont,l=>{this.pushOnLine(l,"FONT")})),i&&this.consistencyManager&&this.sub.push(this.dataBus.subscribe(rh(Oi.subRevoke,{uuid:this.uuid}),l=>this.revoke(l))),!this.busTopic.getProject)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");this.isDestroy=!1;let a={doc:[this.uuid],watch:i,needNum:s,needDelete:n};t&&a.doc.push("BLOB"),e&&a.doc.push("FONT");let o=await this.dataBus.rpcCall(this.busTopic.getProject,a);if(this.isWatch=i,!this.isDestroy){if(!o.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",o);if(this.canSave=!(o!=null&&o.readOnly),this.consoleDebug("init",o.result),o.maxTicket&&this.consistencyManager&&this.consistencyManager.setMaxTicket(o.maxTicket),o.data&&this.onDocDetail&&this.onDocDetail(o.client||ul(),0,o.data,!1),o.channel&&await this.flowRead(o.channel),!this.isDestroy){if(this.handleInit?this.handleInit(o):o.result&&this.consistencyManager&&this.consistencyManager.parseFull(o.result,this.uuid,this._headType),r){let l=this.user=this.user||o.user||await this.wsBus.rpcCall(Oi.getUserL);this.selectManager=new SI(this.uuid,this.path,this.windowId,this.channel,this.dataBus,this.wsBus,this.selectedProps,l),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}}async initLib(e,t,i,r,s){if(this.setIsInitIng(!0),this.channel.addCompiler(this),this.dataBus=qg(`/${this.windowId}/libWorker`),!this.busTopic.getPerson)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01");let n=i?ul():"";this.isDestroy=!1;let a=await this.dataBus.rpcCall(this.busTopic.getPerson,{uuid:this.uuid,path:this.path,watch:e,channel:n,needNum:r,needDelete:s});if(this.isWatch=e,this.isDestroy)return;if(!a.success)throw new Error("\u83B7\u53D6\u6570\u636E\u5931\u8D25\uFF01\uFF01\uFF01",a);this.consoleDebug("init",a.dataStr);let o=a.data||a.result;if(o&&this.onDocDetail&&this.onDocDetail(a.client||ul(),0,o,!1),r&&this.sub.push(this.dataBus.subscribe(`/pro-mgr/${this.uuid}/number/update`,l=>{if(this.onOrderNm)for(let h of l)this.onOrderNm(h[0],h[1],h[2])})),e&&this.busTopic.personUpdate&&this.sub.push(this.dataBus.subscribe(rh(this.busTopic.personUpdate,{uuid:this.uuid}),l=>{this.pushOnLine(l,this.uuid)})),e&&this.sub.push(this.dataBus.subscribe(rh(rh(Oi.subRevoke,{uuid:this.uuid}),{uuid:this.uuid}),l=>this.revoke(l))),n&&await this.flowRead(n),!this.isDestroy){if(a.dataStr&&this.consistencyManager&&this.consistencyManager.parseFull(a.dataStr),t){let l=this.user=this.user||a.user||await this.wsBus.rpcCall(Oi.getUserL);this.selectManager=new SI(this.uuid,this.path,this.windowId,this.channel,this.wsBus,this.wsBus,this.selectedProps,l),await this.selectManager.init()}return this.isInit=!0,this.setIsInitIng(!1),{success:!0}}}revoke(e){for(let t of e)this.consistencyManager&&this.consistencyManager.revoke(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],(...i)=>this.publishLine(...i)),t[10]&&this.setMaxNum&&this.setMaxNum(t[6],t[10],t[1])}cachePendData(e,t,i,r,s,n){this.pendCache[e]||(this.pendCache[e]={type:n,pend:[]}),this.pendCache[e].pend.push([t,i,s,r]),this.pendCacheLength+=r.length+1,this.pendCacheLength>1e7&&this.publishPendData(),this.pendTimer||(this.pendTimer=setTimeout(()=>{this.publishPendData(),this.pendTimer=null},0))}publishPendData(){if(this.pendCacheLength){this.dataBus.publish(Oi.pushPend,[this.pendCache,this.consistencyManager.getClient(),this.uniqueId,this.uuid]);for(let e in this.pendCache)this.pendCache[e].pend.length=0;this.pendCache={},this.pendCacheLength=0}}localChange(e,t,i,r=this.uuid,s,n){if(!this.isInit||!this.canSave||!this.consistencyManager)return 0;if(t&&!t.startsWith("{"))return console.error("\u4E0A\u4F20\u7684\u683C\u5F0F\u4E0D\u6B63\u786E",e,i,t),0;let a=this.consistencyManager.localChange(r,e,t,i,s,n);return this.cachePendData(r,e,a,t,i,s||this.headType),a}async sync(){if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u540C\u6B65");let e=ul();this.dataBus.publish(Oi.pushSync,e),await this.dataBus.pullA(rh(Oi.pullASync,{id:e}))}async destroy(){return this.isDestroy?{success:!1}:(this.consistencyManager&&this.dataBus&&this.dataBus.publish(Oi.pushRevoke,[this.uuid,this.uniqueId,this.consistencyManager.getClient()]),this.clear(),this.isDestroy=!0,this.isWatch&&this.dataBus&&!this.isProject&&this.dataBus.publish(Oi.personDestroy,{uuid:this.uuid,path:this.path}),this.isWatch&&this.dataBus&&this.busTopic.unwatch&&this.dataBus.publish(this.busTopic.unwatch,this.uuid),this.isWatch=!1,{success:!0})}async save(e=[this.uuid,"BLOB","FONT"]){try{if(!this.isInit)throw new Error("\u6570\u636E\u672A\u521D\u59CB\u5316\uFF0C\u65E0\u6CD5\u4FDD\u5B58");if(!this.consistencyManager)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let t=this.isProject?Oi.projectSave:Oi.personSave;if(!t)throw new Error("\u65E0\u6CD5\u652F\u6301\u4FDD\u5B58");let i=await this.dataBus.rpcCall(t,{uuid:this.uuid,path:this.path,docIds:e,uniqueId:this.uniqueId,client:this.consistencyManager.getClient()});return this.consoleDebug("save",i),i}catch(t){throw new Error(`${this._headType}+'Compiler' ${this.uuid} \u4FDD\u5B58\u5931\u8D25: ${(t==null?void 0:t.message)||t||""}`,{cause:t})}}async getBlob(e){return this.dataBus.rpcCall("/mgr/projectWorker/blob/getBlob",e)}async getFont(e,t,i,r,s,n,a,o){let l={text:e,fontFamily:t,fontSize:i,thickness:r,bold:s,italic:n,reverse:a,expansion:o},h=await this.dataBus.rpcCall("/mgr/projectWorker/font/get",l);return h.success?{success:!0,result:Object.assign(l,JSON.parse(h.result))}:h}async checkSave(){return await this.dataBus.rpcCall(Oi.hasSaveData,{uuid:this.uuid,uniqueId:this.uniqueId})}};var Tq=(e=>(e.DIFFERENTIAL_PAIR="DIFFERENTIAL_PAIR",e.NET_CLASS="NET_CLASS",e.EQL_NET_GRP="EQL_NET_GRP",e))(Tq||{});var Uae=iu(uf());var Fae=iu(uf());var nP=class extends fq{constructor(e,t,i,r,s,n,a,o=(l=>(l=cf())==null?void 0:l._TAB_ID_)()){let h=new CI(o);super(h),this.encode=n,this.base=new Eq(e,t,i,o,r,h,s,s==="PCB"?bq:yq,a,(...c)=>this.setIsInit(...c),(...c)=>this.onDocDetail(...c),void 0,void 0,void 0,void 0,(c,f,d)=>this.onOrderNum(c,f,d),(c,f,d)=>{this.setMaxNum(c,f,!!d),d&&this.deleteOrderNum(d)})}get dataBus(){return this.base.dataBus}set dataBus(e){this.base.dataBus=e}async init(e=!0,t=!0,i=!0,r,s=!0,n){return this.setNeedNum(s),this.base.init(e,t,i,r,!0,s,n)}async sync(){return this.base.sync()}async destroy(){return this.base.destroy()}async save(){return this.base.save()}checkSave(){return this.base.checkSave()}publishSelected(e,t){this.base.publishSelected(e,t)}uploadBlob(e,t){let i=zj(t),r={filename:e,content:t};return{success:!0,ticket:this.localChange({id:i,data:JSON.stringify(r),dataType:"BLOB"},"BLOB","BLOB"),hash:i}}deleteBlob(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"BLOB"},"BLOB","BLOB")}}uploadFont(e){let{text:t,fontFamily:i,fontSize:r,thickness:s,bold:n,italic:a,reverse:o,expansion:l,width:h,height:c,path:f}=e,d={width:h,height:c,path:f},u=YS(t,i,r,s,n,a,o,l);return{success:!0,ticket:this.localChange({id:u,data:JSON.stringify(d),dataType:"FONT"},"FONT","FONT")}}deleteFont(e){let{text:t,fontFamily:i,fontSize:r,thickness:s,bold:n,italic:a,reverse:o,expansion:l}=e,h=YS(t,i,r,s,n,a,o,l);return{success:!0,ticket:this.localChange({id:h,data:"",dataType:"FONT"},"FONT","FONT")}}localChange(e,t=this.base.uuid,i){var s,n;let r=this.getOrderNum(e.id);return(n=(s=this.needOrderType)==null?void 0:s.includes)!=null&&n.call(s,e.dataType)&&r===void 0&&(r=this.getMaxNum(e.dataType),this.setOrderNum(e.id,r,e.dataType),this.onOrderNum(e.id,e.dataType,r)),this.base.localChange(e.id,e.data,e.dataType,t,i,r)}uploadString(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeString(e,t))}}deleteString(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"STRING"})}}uploadAttr(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeAttr(e,t))}}deleteAttr(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"ATTR"})}}uploadPanelize(e){return{success:!0,ticket:this.localChange(this.encode.encodePanelize(e))}}deletePanelize(){return{success:!0,ticket:this.localChange({id:"PANELIZE",data:"",dataType:"PANELIZE"})}}uploadRuleSelector(e){return{success:!0,ticket:this.localChange(this.encode.encodeRuleSelector(e))}}deleteRuleSelector(e){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE_SELECTOR",e]),data:"",dataType:"RULE_SELECTOR"})}}uploadRule(e){return{success:!0,ticket:this.localChange(this.encode.encodeRule(e))}}deleteRule(e,t){return{success:!0,ticket:this.localChange({id:JSON.stringify(["RULE",e,t]),data:"",dataType:"RULE"})}}uploadRuleTemplate(e){return{success:!0,ticket:this.localChange(this.encode.encodeRuleTemplate(e))}}uploadDimension(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeDimension(e,t))}}deleteDimension(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"DIMENSION"})}}uploadBoss(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeBoss(e,t))}}deleteBoss(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"BOSS"})}}uploadShellEntity(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShellEntity(e,t))}}deleteShellEntity(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELL_ENTITY"})}}uploadShellCut(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShellCut(e,t))}}deleteShellCut(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELLCUT"})}}uploadCrease(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeCrease(e,t))}}deleteCrease(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"CREASE"})}}uploadShell(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeShell(e,t))}}deleteShell(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"SHELL"})}}uploadFpcFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeFpcFill(e,t))}}deleteFpcFill(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"FPC_FILL"})}}uploadTeardrop(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeTeardrop(e,t))}}deleteTeardrop(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"TEARDROP"})}}uploadImage(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeImage(e,t))}}deleteImage(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"IMAGE"})}}uploadPoured(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePoured(e,t))}}deletePoured(e){return{success:!0,ticket:this.localChange({id:dr(e,"POURED"),data:"",dataType:"POURED"})}}uploadPour(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePour(e,t))}}deletePour(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"POUR"})}}uploadRegion(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeRegion(e,t))}}deleteRegion(e){let t=this.localChange({id:e,data:"",dataType:"REGION"});return this.onDelRegion(e,this.consistencyManager.getClient(),t,!0),{success:!0,ticket:t}}uploadFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeFill(e,t))}}deleteFill(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"FILL"})}}uploadLayerFill(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayerFill(e,t))}}deleteLayerFill(e){return{success:!0,ticket:this.localChange({id:dr(e,"LAYER_FILL"),data:"",dataType:"LAYER_FILL"})}}uploadPoly(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePoly(e,t))}}deletePoly(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"POLY"})}}uploadEQLenGrp(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeEQLenGrp(e,t))}}deleteEQLenGrp(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"EQLEN_GRP"})}}uploadObj(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeObj(e,t))}}deleteObj(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"OBJ"})}}uploadArc(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeArc(e,t))}}deleteArc(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"ARC"})}}uploadLine(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLine(e,t))}}deleteLine(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"LINE"})}}uploadPad(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePad(e,t))}}deletePad(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"PAD"})}}uploadVia(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeVia(e,t))}}deleteVia(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"VIA"})}}uploadPreference(e){return{success:!0,ticket:this.localChange(this.encode.encodePreference(e))}}uploadSilkOpts(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeSilkOpts(e,t))}}deleteSilkOpts(e){return{success:!0,ticket:this.localChange({id:dr(e,"SILK_OPTS"),data:"",dataType:"SILK_OPTS"})}}uploadGroup(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeGroup(e,t))}}deleteGroup(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"GROUP"})}}uploadPrimitive(e,t){return{success:!0,ticket:this.localChange(this.encode.encodePrimitive(e,t))}}deletePrimitive(e){return{success:!0,ticket:this.localChange({id:dr(e,"PRIMITIVE"),data:"",dataType:"PRIMITIVE"})}}uploadNet(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeNet(e,t))}}deleteNet(e){return{success:!0,ticket:this.localChange({id:dr(e,"NET"),data:"",dataType:"NET"})}}uploadActiveLayer(e){return{success:!0,ticket:this.localChange(this.encode.encodeActiveLayer(e))}}uploadLayerPhys(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayerPhys(e,t))}}deleteLayerPhys(e){return{success:!0,ticket:this.localChange({id:dr(e,"LAYER_PHYS"),data:"",dataType:"LAYER_PHYS"})}}uploadLayer(e,t){return{success:!0,ticket:this.localChange(this.encode.encodeLayer(e,t))}}deleteLayer(e){return{success:!0,ticket:this.localChange({id:dr(e,"LAYER"),data:"",dataType:"LAYER"})}}uploadCanvas(e){return{success:!0,ticket:this.localChange(this.encode.encodeCanvas(e))}}uploadBoard(e){return{success:!0,ticket:this.localChange({id:"BOARD",data:JSON.stringify(e),dataType:"BOARD"})}}deleteBoard(){return{success:!0,ticket:this.localChange({id:"BOARD",data:"",dataType:"BOARD"})}}},aP=class extends nP{constructor(e,t,i,r){let s=new uq;super(e,t,!0,i,"PCB",s,{getSelect:()=>{var n;return(n=this.canvasSelected)==null?void 0:n.call(this)},onSelect:(...n)=>{var a;return(a=this.onSelectChange)==null?void 0:a.call(this,n[0],n[1],n[2])},onQuit:(...n)=>{var a;return(a=this.onSelectQuit)==null?void 0:a.call(this,n[0],n[1])}},r),this.uuid=e,this.project=t,this.windowId=r,this.encoder=s}async customFootprint(e,t){return this.dataBus.rpcCall("/mgr/projectWorker/footprint/clone",{uuid:e,source:t})}async updateFootprint(e){return this.dataBus.rpcCall("/mgr/projectWorker/footprint/update",e)}async footprintIsExist(e){var t;return(t=await this.dataBus.rpcCall("/mgr/projectWorker/footprint/isExist",e))==null?void 0:t.result}uploadPadNet(e){return{success:!0,ticket:this.localChange(this.encoder.encodePadNet(e))}}deletePadNet(e,t,i){return{success:!0,ticket:this.localChange({id:JSON.stringify(["PAD_NET",e,t,i||""]),data:"",dataType:"PAD_NET"})}}uploadComponent(e,t){return{success:!0,ticket:this.localChange(this.encoder.encodeComponent(e,t))}}deleteComponent(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"COMPONENT"})}}uploadPartition(e,t){return{success:!0,ticket:this.localChange(this.encoder.encodePartition(e,t))}}deletePartition(e){return{success:!0,ticket:this.localChange({id:e,data:"",dataType:"PARTITION"})}}},oP=class extends nP{constructor(e,t,i,r,s=(n=>(n=cf())==null?void 0:n._TAB_ID_)()){super(e,t,i,r,"FOOTPRINT",new dq,{getSelect:()=>{var a;return(a=this.canvasSelected)==null?void 0:a.call(this)},onSelect:(...a)=>{var o;return(o=this.onSelectChange)==null?void 0:o.call(this,a[0],a[1],a[2])},onQuit:(...a)=>{var o;return(o=this.onSelectQuit)==null?void 0:o.call(this,a[0],a[1])}},s),this.uuid=e,this.path=t,this.isProject=i,this.windowId=s}onComponent(){}onComponentNum(){}onDelComponent(){}onPadNet(){}onDelPadNet(){}};var ru=class extends aP{constructor(i,r,s,n){super(i,r,s,n);this.hasSynced=new Map;this.initFinished=!1}getSelectHandle(){return this.selectHandle}setSelectHandle(i){this.selectHandle=i}getDocDetail(){return this.docDetail}canvasSelected(){var i;return(i=this.selectHandle)==null?void 0:i.getSelect()}onSelectChange(i,r,s){var n;(n=this.selectHandle)==null||n.onSelected(i,r,s)}onSelectQuit(i,r){var s;(s=this.selectHandle)==null||s.onDestroy(i,r)}setHandle(i,r){this.handle!=null&&!r&&this.handle.destory(),this.handle=i,this.handle.setClient(this.consistencyManager.getClient())}destroy(){return new Promise(i=>{super.destroy().then(r=>{this.handle=null,i(r)})})}setTicket(i=this.consistencyManager.getMaxTicket()+1){this.handle.setTicket(i)}getHandle(){return this.handle}onBoard(i,r,s,n){}onDelBoard(i,r,s){}onLayerFill(i,r,s,n,a){this.handle.onLayerFill(i,r,s,n,a)}onDelLayerFill(i,r,s,n){this.handle.onDelLayerFill(i,r,s,n)}onBlob(i,r,s,n,a){this.handle.onBlob(i,r,s,n,a)}onDelBlob(i,r,s,n){this.handle.onDelBlob(i,r,s,n)}onFont(i,r,s,n){this.handle.onFont(i,r,s,n)}onDelFont(i,r,s,n){this.handle.onDelFont(i,r,s,n)}onString(i,r,s,n,a,o){this.handle.onString(i,r,s,n,a,o)}onDelString(i,r,s,n){this.handle.onDelString(i,r,s,n)}onAttr(i,r,s,n,a,o){this.handle.onAttr(i,r,s,n,a,o)}onDelAttr(i,r,s,n){this.handle.onDelAttr(i,r,s,n)}onPadNet(i,r,s,n){this.handle.onPadNet(i,r,s,n)}onDelPadNet(i,r,s,n,a,o){this.handle.onDelPadNet(i,r,n,s,a,o)}onComponent(i,r,s,n,a,o){this.handle.onComponent(i,r,s,n,a,o)}onDelComponent(i,r,s,n){this.handle.onDelComponent(i,r,s,n)}onPanelize(i,r,s,n){this.handle.onPanelize(i,r,s,n)}onDelPanelize(i,r,s){this.handle.onDelPanelize(i,r,s)}onRuleSelector(i,r,s,n){this.handle.onRuleSelector(i,r,s,n)}onDelRuleSelector(i,r,s,n){this.handle.onDelRuleSelector(i,r,s,n)}onRule(i,r,s,n){this.handle.onRule(i,r,s,n)}onDelRule(i,r,s,n,a){this.handle.onDelRule(i,r,s,n,a)}onRuleTemplate(i,r,s,n){this.handle.onRuleTemplate(i,r,s,n)}onDimension(i,r,s,n,a,o){this.handle.onDimension(i,r,s,n,a,o)}onDelDimension(i,r,s,n){this.handle.onDelDimension(i,r,s,n)}onBoss(i,r,s,n,a,o){this.handle.onBoss(i,r,s,n,a,o)}onDelBoss(i,r,s,n){this.handle.onDelBoss(i,r,s,n)}onShellEntity(i,r,s,n,a,o){this.handle.onShellEntity(i,r,s,n,a,o)}onDelShellEntity(i,r,s,n){this.handle.onDelShellEntity(i,r,s,n)}onShellCut(i,r,s,n,a,o){this.handle.onShellCut(i,r,s,n,a,o)}onDelShellCut(i,r,s,n){this.handle.onDelShellCut(i,r,s,n)}onCrease(i,r,s,n,a,o){this.handle.onCrease(i,r,s,n,a,o)}onDelCrease(i,r,s,n){this.handle.onDelCrease(i,r,s,n)}onShell(i,r,s,n,a,o){this.handle.onShell(i,r,s,n,a,o)}onDelShell(i,r,s,n){this.handle.onDelShell(i,r,s,n)}onFpcFill(i,r,s,n,a,o){this.handle.onFpcFill(i,r,s,n,a,o)}onDelFpcFill(i,r,s,n){this.handle.onDelFpcFill(i,r,s,n)}onTeardrop(i,r,s,n,a,o){this.handle.onTeardrop(i,r,s,n,a,o)}onDelTeardrop(i,r,s,n){this.handle.onDelTeardrop(i,r,s,n)}onImage(i,r,s,n,a,o){this.handle.onImage(i,r,s,n,a,o)}onDelImage(i,r,s,n){this.handle.onDelImage(i,r,s,n)}onPoured(i,r,s,n,a,o){this.handle.onPoured(i,r,s,n,a,o)}onDelPoured(i,r,s,n){this.handle.onDelPoured(i,r,s,n)}onPour(i,r,s,n,a,o){this.handle.onPour(i,r,s,n,a,o)}onDelPour(i,r,s,n){this.handle.onDelPour(i,r,s,n)}onRegion(i,r,s,n,a,o){this.handle.onRegion(i,r,s,n,a,o)}onDelRegion(i,r,s,n){this.handle.onDelRegion(i,r,s,n)}onFill(i,r,s,n,a,o){a.fillStyle!=df.PLANE&&this.handle.onFill(i,r,s,n,a,o)}onDelFill(i,r,s,n){this.handle.onDelFill(i,r,s,n)}onPoly(i,r,s,n,a,o){this.handle.onPoly(i,r,s,n,a,o)}onDelPoly(i,r,s,n){this.handle.onDelPoly(i,r,s,n)}onEQLenGrp(i,r,s,n,a){this.handle.onEQLenGrp(i,r,s,n,a)}onDelEQLenGrp(i,r,s,n){this.handle.onDelEQLenGrp(i,r,s,n)}onObj(i,r,s,n,a,o){this.handle.onObj(i,r,s,n,a,o)}onDelObj(i,r,s,n){this.handle.onDelObj(i,r,s,n)}onArc(i,r,s,n,a,o){this.handle.onArc(i,r,s,n,a,o)}onDelArc(i,r,s,n){this.handle.onDelArc(i,r,s,n)}onLine(i,r,s,n,a,o){this.initFinished&&this.hasSynced.set(i,n),this.handle.onLine(i,r,s,n,a,o)}onDelLine(i,r,s,n){this.handle.onDelLine(i,r,s,n)}onPad(i,r,s,n,a,o){this.handle.onPad(i,r,s,n,a,o)}onDelPad(i,r,s,n){this.handle.onDelPad(i,r,s,n)}onVia(i,r,s,n,a,o){this.handle.onVia(i,r,s,n,a,o)}onDelVia(i,r,s,n){this.handle.onDelVia(i,r,s,n)}onPreference(i,r,s,n){this.handle.onPreference(i,r,s,n)}onSilkOpts(i,r,s,n,a){this.handle.onSilkOpts(i,r,s,n,a)}onDelSilkOpts(i,r,s,n){this.handle.onDelSilkOpts(i,r,s,n)}onGroup(i,r,s,n,a){this.handle.onGroup(i,r,s,n,a)}onDelGroup(i,r,s,n){this.handle.onDelGroup(i,r,s,n)}onPrimitive(i,r,s,n,a){this.handle.onPrimitive(i,r,s,n,a)}onDelPrimitive(i,r,s,n){this.handle.onDelPrimitive(i,r,s,n)}onNet(i,r,s,n,a){this.handle.onNet(i,r,s,n,a)}onDelNet(i,r,s,n){this.handle.onDelNet(i,r,s,n)}onPartition(i,r,s,n,a,o){this.handle.onPartition(i,r,s,n,a,o)}onDelPartition(i,r,s,n){this.handle.onDelPartition(i,r,s,n)}onActiveLayer(i,r,s,n){this.handle.onActiveLayer(i,r,s,n)}onLayerPhys(i,r,s,n,a){this.handle.onLayerPhys(i,r,s,n,a)}onDelLayerPhys(i,r,s,n){this.handle.onDelLayerPhys(i,r,s,n)}onLayer(i,r,s,n,a){this.handle.onLayer(i,r,s,n,a)}onDelLayer(i,r,s,n){this.handle.onDelLayer(i,r,s,n)}onCanvas(i,r,s,n){this.handle.onCanvas(i,r,s,n)}onDocDetail(i,r,s,n){this.docDetail=s,this.handle.onDocDetail(i,r,s,n)}onStringNum(i,r){this.handle.onStringNum(i,r)}onAttrNum(i,r){this.handle.onAttrNum(i,r)}onComponentNum(i,r){this.handle.onComponentNum(i,r)}onDimensionNum(i,r){this.handle.onDimensionNum(i,r)}onBossNum(i,r){this.handle.onBossNum(i,r)}onShellEntityNum(i,r){this.handle.onShellEntityNum(i,r)}onShellCutNum(i,r){this.handle.onShellCutNum(i,r)}onCreaseNum(i,r){this.handle.onCreaseNum(i,r)}onShellNum(i,r){this.handle.onShellNum(i,r)}onFpcFillNum(i,r){this.handle.onFpcFillNum(i,r)}onTeardropNum(i,r){this.handle.onTeardropNum(i,r)}onImageNum(i,r){this.handle.onImageNum(i,r)}onPouredNum(i,r){this.handle.onPouredNum(i,r)}onPourNum(i,r){this.handle.onPourNum(i,r)}onRegionNum(i,r){this.handle.onRegionNum(i,r)}onFillNum(i,r){this.handle.onFillNum(i,r)}onPolyNum(i,r){this.handle.onPolyNum(i,r)}onObjNum(i,r){this.handle.onObjNum(i,r)}onArcNum(i,r){this.handle.onArcNum(i,r)}onLineNum(i,r){this.handle.onLineNum(i,r)}onPadNum(i,r){this.handle.onPadNum(i,r)}onViaNum(i,r){this.handle.onViaNum(i,r)}onPartitionNum(i,r){this.handle.onPartitionNum(i,r)}uploadRuleSelector(i){return i.ruleSelect.length==0?{success:!1,message:"rule selector data error."}:super.uploadRuleSelector(i)}};var aO=class extends oP{getDocDetail(){return this.docDetail}constructor(t,i,r,s=Ol.getInstance().currOpenProjectId===i){super(t,i,s,r,void 0)}canvasSelected(){var t;return(t=this.selectHandle)==null?void 0:t.getSelect()}onSelectChange(t,i,r){var s;(s=this.selectHandle)==null||s.onSelected(t,i,r)}onSelectQuit(t,i){var r;(r=this.selectHandle)==null||r.onDestroy(t,i)}getHandle(){return this.handle}setHandle(t){this.handle!=null&&this.handle.destory(),this.handle=t,this.handle.setClient(this.consistencyManager.getClient())}destroy(){return this.handle=null,super.destroy()}setTicket(){this.handle.setTicket(this.consistencyManager.getMaxTicket()+1)}onBoard(t,i,r,s){}onDelBoard(t,i,r){}onLayerFill(t,i,r,s,n){this.handle.onLayerFill(t,i,r,s,n)}onDelLayerFill(t,i,r,s){this.handle.onDelLayerFill(t,i,r,s)}onBlob(t,i,r,s,n){this.handle.onBlob(t,i,r,s,n)}onDelBlob(t,i,r,s){this.handle.onDelBlob(t,i,r,s)}onFont(t,i,r,s){this.handle.onFont(t,i,r,s)}onDelFont(t,i,r,s){this.handle.onDelFont(t,i,r,s)}onGroup(t,i,r,s,n){this.handle.onGroup(t,i,r,s,n)}onDelGroup(t,i,r,s){this.handle.onDelGroup(t,i,r,s)}onString(t,i,r,s,n,a){this.handle.onString(t,i,r,s,n,a)}onDelString(t,i,r,s){this.handle.onDelString(t,i,r,s)}onAttr(t,i,r,s,n,a){this.handle.onAttr(t,i,r,s,n,a)}onDelAttr(t,i,r,s){this.handle.onDelAttr(t,i,r,s)}onPanelize(t,i,r,s){this.handle.onPanelize(t,i,r,s)}onDelPanelize(t,i,r){this.handle.onDelPanelize(t,i,r)}onRuleSelector(t,i,r,s){this.handle.onRuleSelector(t,i,r,s)}onDelRuleSelector(t,i,r,s){this.handle.onDelRuleSelector(t,i,r,s)}onRule(t,i,r,s){this.handle.onRule(t,i,r,s)}onDelRule(t,i,r,s,n){this.handle.onDelRule(t,i,r,s,n)}onRuleTemplate(t,i,r,s){this.handle.onRuleTemplate(t,i,r,s)}onDimension(t,i,r,s,n,a){this.handle.onDimension(t,i,r,s,n,a)}onDelDimension(t,i,r,s){this.handle.onDelDimension(t,i,r,s)}onBoss(t,i,r,s,n,a){this.handle.onBoss(t,i,r,s,n,a)}onDelBoss(t,i,r,s){this.handle.onDelBoss(t,i,r,s)}onShellEntity(t,i,r,s,n,a){this.handle.onShellEntity(t,i,r,s,n,a)}onDelShellEntity(t,i,r,s){this.handle.onDelShellEntity(t,i,r,s)}onShellCut(t,i,r,s,n,a){this.handle.onShellCut(t,i,r,s,n,a)}onDelShellCut(t,i,r,s){this.handle.onDelShellCut(t,i,r,s)}onCrease(t,i,r,s,n,a){this.handle.onCrease(t,i,r,s,n,a)}onDelCrease(t,i,r,s){this.handle.onDelCrease(t,i,r,s)}onShell(t,i,r,s,n,a){this.handle.onShell(t,i,r,s,n,a)}onDelShell(t,i,r,s){this.handle.onDelShell(t,i,r,s)}onFpcFill(t,i,r,s,n,a){this.handle.onFpcFill(t,i,r,s,n,a)}onDelFpcFill(t,i,r,s){this.handle.onDelFpcFill(t,i,r,s)}onTeardrop(t,i,r,s,n,a){let o={...n,width:.2,fillStyle:df.SOLID,path:[n.path],locked:!1,zIndex:0};this.handle.onFill(t,i,r,s,o,a)}onDelTeardrop(t,i,r,s){this.handle.onDelTeardrop(t,i,r,s)}onImage(t,i,r,s,n,a){this.handle.onImage(t,i,r,s,n,a)}onDelImage(t,i,r,s){this.handle.onDelImage(t,i,r,s)}onPoured(t,i,r,s,n,a){this.handle.onPoured(t,i,r,s,n,a)}onDelPoured(t,i,r,s){this.handle.onDelPoured(t,i,r,s)}onPour(t,i,r,s,n,a){this.handle.onPour(t,i,r,s,n,a)}onDelPour(t,i,r,s){this.handle.onDelPour(t,i,r,s)}onRegion(t,i,r,s,n,a){this.handle.onRegion(t,i,r,s,n,a)}onDelRegion(t,i,r,s){this.handle.onDelRegion(t,i,r,s)}onFill(t,i,r,s,n,a){this.handle.onFill(t,i,r,s,n,a)}onDelFill(t,i,r,s){this.handle.onDelFill(t,i,r,s)}onPoly(t,i,r,s,n,a){this.handle.onPoly(t,i,r,s,n,a)}onDelPoly(t,i,r,s){this.handle.onDelPoly(t,i,r,s)}onEQLenGrp(t,i,r,s,n){this.handle.onEQLenGrp(t,i,r,s,n)}onDelEQLenGrp(t,i,r,s){this.handle.onDelEQLenGrp(t,i,r,s)}onObj(t,i,r,s,n,a){this.handle.onObj(t,i,r,s,n,a)}onDelObj(t,i,r,s){this.handle.onDelObj(t,i,r,s)}onArc(t,i,r,s,n,a){this.handle.onArc(t,i,r,s,n,a)}onDelArc(t,i,r,s){this.handle.onDelArc(t,i,r,s)}onLine(t,i,r,s,n,a){this.handle.onLine(t,i,r,s,n,a)}onDelLine(t,i,r,s){this.handle.onDelLine(t,i,r,s)}onPad(t,i,r,s,n,a){this.handle.onPad(t,i,r,s,n,a)}onDelPad(t,i,r,s){this.handle.onDelPad(t,i,r,s)}onVia(t,i,r,s,n,a){this.handle.onVia(t,i,r,s,n,a)}onDelVia(t,i,r,s){this.handle.onDelVia(t,i,r,s)}onPreference(t,i,r,s){this.handle.onPreference(t,i,r,s)}onSilkOpts(t,i,r,s,n){this.handle.onSilkOpts(t,i,r,s,n)}onDelSilkOpts(t,i,r,s){this.handle.onDelSilkOpts(t,i,r,s)}onPrimitive(t,i,r,s,n){this.handle.onPrimitive(t,i,r,s,n)}onDelPrimitive(t,i,r,s){this.handle.onDelPrimitive(t,i,r,s)}onNet(t,i,r,s,n){this.handle.onNet(t,i,r,s,n)}onDelNet(t,i,r,s){this.handle.onDelNet(t,i,r,s)}onPartition(t,i,r,s,n,a){this.handle.onPartition(t,i,r,s,n,a)}onDelPartition(t,i,r,s){this.handle.onDelPartition(t,i,r,s)}onActiveLayer(t,i,r,s){this.handle.onActiveLayer(t,i,r,s)}onLayerPhys(t,i,r,s,n){this.handle.onLayerPhys(t,i,r,s,n)}onDelLayerPhys(t,i,r,s){this.handle.onDelLayerPhys(t,i,r,s)}onLayer(t,i,r,s,n){this.handle.onLayer(t,i,r,s,n)}onDelLayer(t,i,r,s){this.handle.onDelLayer(t,i,r,s)}onCanvas(t,i,r,s){this.handle.onCanvas(t,i,r,s)}onDocDetail(t,i,r,s){this.docDetail=r,this.handle.onDocDetail(t,i,r,s)}onStringNum(t,i){this.handle.onStringNum(t,i)}onAttrNum(t,i){this.handle.onAttrNum(t,i)}onDimensionNum(t,i){this.handle.onDimensionNum(t,i)}onBossNum(t,i){this.handle.onBossNum(t,i)}onShellEntityNum(t,i){this.handle.onShellEntityNum(t,i)}onShellCutNum(t,i){this.handle.onShellCutNum(t,i)}onCreaseNum(t,i){this.handle.onCreaseNum(t,i)}onShellNum(t,i){this.handle.onShellNum(t,i)}onFpcFillNum(t,i){this.handle.onFpcFillNum(t,i)}onTeardropNum(t,i){this.handle.onTeardropNum(t,i)}onImageNum(t,i){this.handle.onImageNum(t,i)}onPouredNum(t,i){this.handle.onPouredNum(t,i)}onPourNum(t,i){this.handle.onPourNum(t,i)}onRegionNum(t,i){this.handle.onRegionNum(t,i)}onFillNum(t,i){this.handle.onFillNum(t,i)}onPolyNum(t,i){this.handle.onPolyNum(t,i)}onObjNum(t,i){this.handle.onObjNum(t,i)}onArcNum(t,i){this.handle.onArcNum(t,i)}onLineNum(t,i){this.handle.onLineNum(t,i)}onPadNum(t,i){this.handle.onPadNum(t,i)}onViaNum(t,i){this.handle.onViaNum(t,i)}onPartitionNum(t,i){this.handle.onPartitionNum(t,i)}uploadRuleSelector(t){return t.ruleSelect.length==0?{success:!1,message:"rule selector data error."}:super.uploadRuleSelector(t)}};var mf=Math.PI*2;var hce=Math.PI/2,cce=Math.sin(Math.PI/180);var yf=class yf{constructor(){this.param=null;this._visible=Yn.SHOW;this._flip=!1;this._currentCoord=!0;this._gridColor=ya.WHITE;this._transparency=.3;this._multiGridColor=ya.WHITE;this._multiTransparency=.55;this._coordinateAxisColor=ya.WHITE;this._coordinateAxisTransparency=1;this._stepX=.5;this._stepY=.5;this._snapX=.5;this._snapY=.5;this._pattern=!0;this._multiRatio=5;this._multiStyle=eh.None;this._angleDelta=Math.PI/4;this._startAngle=0;this._endAngle=mf;this._step=39.37;this._minRadius=3.937;this._maxRadius=393.7;this._renderGrid=!0}static getInstance(){return this.ins==null&&(this.ins=new yf),this.ins}modify(t,i,r,s,n){this._stepX=t,this._stepY=i,this._snapX=r,this._snapY=s,this._pattern=n,this.param!=null&&this.param.modify(t,i,r,s,n)}attach(t){this.param=t,this.param!=null&&(this.param.visible=this._visible,this.param.flip=this._flip,this.param.currentCoord=this._currentCoord,this.param.gridColor=this._gridColor,this.param.transparency=this._transparency,this.param.multiGridColor=this._multiGridColor,this.param.multiTransparency=this._multiTransparency,this.param.coordinateAxisColor=this._coordinateAxisColor,this.param.coordinateAxisTransparency=this._coordinateAxisTransparency,this.param.modify(this._stepX,this._stepY,this._snapX,this._snapY,this._pattern),this.param.setMultiRatio(this._multiRatio),this.param.setMultiStyle(this._multiStyle),this.param.angleDelta=this._angleDelta,this.param.startAngle=this._startAngle,this.param.endAngle=this._endAngle,this.param.radius=this._step,this.param.minRadius=this._minRadius,this.param.maxRadius=this._maxRadius)}set visible(t){this._visible=t,this.param!=null&&(this.param.visible=t)}get visible(){var t;return((t=this.param)==null?void 0:t.visible)||this._visible}set renderGrid(t){this._renderGrid=t,this.param!=null&&(this.param.renderGrid=t)}get renderGrid(){var t;return((t=this.param)==null?void 0:t.renderGrid)||this._renderGrid}get flip(){var t;return((t=this.param)==null?void 0:t.flip)||this._flip}set flip(t){this._flip=t,this.param!=null&&(this.param.flip=t)}get gridColor(){var t;return((t=this.param)==null?void 0:t.gridColor)||this._gridColor}set gridColor(t){this._gridColor=t,this.param!=null&&(this.param.gridColor=t)}get currentCoord(){var t;return((t=this.param)==null?void 0:t.currentCoord)||this._currentCoord}set currentCoord(t){this._currentCoord=t,this.param!=null&&(this.param.currentCoord=t)}get minRadius(){var t;return((t=this.param)==null?void 0:t.minRadius)||this._minRadius}set minRadius(t){this._minRadius=t,this.param!=null&&(this.param.minRadius=t)}get maxRadius(){var t;return((t=this.param)==null?void 0:t.maxRadius)||this._maxRadius}set maxRadius(t){this._maxRadius=t,this.param!=null&&(this.param.maxRadius=t)}get angleDelta(){var t;return((t=this.param)==null?void 0:t.angleDelta)||this._angleDelta}set angleDelta(t){this._angleDelta=t,this.param!=null&&(this.param.angleDelta=t)}get radius(){var t;return((t=this.param)==null?void 0:t.radius)||this._step}set radius(t){this._step=t,this.param!=null&&(this.param.radius=t)}get startAngle(){var t;return((t=this.param)==null?void 0:t.startAngle)||this._startAngle}set startAngle(t){t%=mf,t<0&&(t+=mf),this._startAngle=t,this.param!=null&&(this.param.startAngle=t)}get endAngle(){var t;return((t=this.param)==null?void 0:t.endAngle)||this._endAngle}set endAngle(t){this._endAngle=t,this.param!=null&&(this.param.endAngle=t)}get sweepAngle(){var i;let t=(i=this.param)==null?void 0:i.sweepAngle;return t==null?this.endAngle>this.startAngle?this.endAngle-this.startAngle:this.endAngle-this.startAngle+mf:t}updateGridParam(t,i,r,s){let n=t?Yn.SHOW:Yn.ONLYAXIS;this._stepX=i,this._stepY=r,t!==void 0&&(this.visible=n),s!==void 0&&(this._pattern=s),this.param!=null&&this.param.updateGridParam(t,i,r,s)}setGridX(t){t>0&&(this._stepX=t),this.param!=null&&this.param.setGridX(t)}getGridX(){var t;return((t=this.param)==null?void 0:t.getGridX())||this._stepX}setGridY(t){t>0&&(this._stepY=t),this.param!=null&&this.param.setGridY(t)}getGridY(){var t;return((t=this.param)==null?void 0:t.getGridY())||this._stepY}getMultiRatio(){var t;return((t=this.param)==null?void 0:t.getMultiRatio())||this._multiRatio}setMultiRatio(t){t>=1&&(this._multiRatio=t),this.param!=null&&this.param.setMultiRatio(t)}getMultiStyle(){var t;return((t=this.param)==null?void 0:t.getMultiStyle())||this._multiStyle}setMultiStyle(t){this._multiStyle=t,this.param!=null&&this.param.setMultiStyle(t)}setSnapX(t){t>0&&(this._snapX=t),this.param!=null&&this.param.setSnapX(t)}getSnapX(){var t;return((t=this.param)==null?void 0:t.getSnapX())||this._snapX}setSnapY(t){t>0&&(this._snapY=t),this.param!=null&&this.param.setSnapY(t)}getSnapY(){var t;return((t=this.param)==null?void 0:t.getSnapY())||this._snapY}get pattern(){var t;return((t=this.param)==null?void 0:t.pattern)||this._pattern}set pattern(t){this._pattern=t,this.param!=null&&(this.param.pattern=t)}get transparency(){var t;return((t=this.param)==null?void 0:t.transparency)||this._transparency}set transparency(t){this._transparency=t,this.param!=null&&(this.param.transparency=t)}get multiGridColor(){var t;return((t=this.param)==null?void 0:t.multiGridColor)||this._multiGridColor}set multiGridColor(t){this._multiGridColor=t,this.param!=null&&(this.param.multiGridColor=t)}get multiTransparency(){var t;return((t=this.param)==null?void 0:t.multiTransparency)||this._multiTransparency}set multiTransparency(t){this._multiTransparency=t,this.param!=null&&(this.param.multiTransparency=t)}get coordinateAxisColor(){var t;return((t=this.param)==null?void 0:t.coordinateAxisColor)||this._coordinateAxisColor}set coordinateAxisColor(t){this._coordinateAxisColor=t,this.param!=null&&(this.param.coordinateAxisColor=t)}get coordinateAxisTransparency(){var t;return((t=this.param)==null?void 0:t.coordinateAxisTransparency)||this._coordinateAxisTransparency}set coordinateAxisTransparency(t){this._coordinateAxisTransparency=t,this.param!=null&&(this.param.coordinateAxisTransparency=t)}};yf.scenes=[],yf.ins=null;var Kn=yf;var xn=class xn{constructor(){this._isConcurrentStrictMode=!1;this._isReadOnlyMode=!1;this._origin=ae.ORIGIN;this._doctype=0;this._id="";this._tabId="";this._isactive=!1;this._owner=null;this._customerCode=void 0;this._clientOnlineService=void 0;this._unit="mil";this.scenes=new Array(0);this._footprintIsConnectDevice=!1;this._editorVersion="";this._projectTitle="";this._importFlag=0;this._source="";this._envFlag=null;this.partitionId="";this.name="";this.currOpenProjectId=void 0;this.currVersionUUid=void 0;this._compiler=null;this._altGridSize={GridX:{number:5,unit:this.unit},GridY:{number:5,unit:this.unit}};this._gridType="grid";this._multiType="none";this._multiRatio=5;this._forceDeactive=!1;this._forceValue=.5;this.highLightModeIsDark=!0;this._forceVisibleHighLightPt=!1;this._forceVisibleRange=!1;this._backgroundColor=ya.build(0,0,0,1);this._openRuler=!1;this._rulerBackgroundColor=null;this._rulerStringColor=null;this.antialias=!1;this._needRenderPanelize=!1;this._renderMode=0;this.time=new Date().getTime();this.num=Math.floor(Math.random()*100);this._panelizeParam={success:!1,on:!1,row:1,column:1,offset:new ae(0,0),onlyOutline:!0};this._coreRenderingEngine="auto";this._isPreview=!1;this.compilerChannel=new ky;this._isHistoryMode=!1;this.workerName="";this.needNum=!0}static getInstance(){return xn.env==null&&(xn.env=new xn),xn.env}get isPreview(){return this._isPreview}set isPreview(t){this._isPreview=t}get isHistoryMode(){return this._isHistoryMode}set isHistoryMode(t){this._isHistoryMode=t}get compiler(){return this._compiler==null&&(this._doctype==4?this._compiler=new aO(this._id,this.projectId,this.compilerChannel,void 0):this._doctype==3?(this._compiler=new ru(this._id,this.projectId,this.compilerChannel,void 0),this._compiler.consistencyManager.setIsLocalChange(!1),this._compiler.consistencyManager.setIsPendChange(!1)):(this._compiler=new ru(this._id,this.projectId,this.compilerChannel,void 0),this._compiler.consistencyManager.setIsLocalChange(!1),this._compiler.consistencyManager.setIsPendChange(!1))),this._compiler}get channel(){return(this.time+this.num).toString()}async resetCompiler(){this._compiler&&(await this._compiler.destroy(),this._compiler=null)}modify(t,i,r,s,n,a,o,l){this.doctype=t,this.id=i,this.tabId=r,this.isactive=s,this.owner=n,this.customerCode=a,this.name=o,this.origin=l}get gridType(){return this._gridType}set gridType(t){if(t!=null&&this._gridType!=t&&Kn.getInstance().visible!=Yn.NOTSHOW)switch(this._gridType=t,t){case"grid":Kn.getInstance().pattern=!0,Kn.getInstance().visible=Yn.SHOW;break;case"outlets":Kn.getInstance().pattern=!1,Kn.getInstance().visible=Yn.SHOW;break;case"none":Kn.getInstance().visible=Yn.ONLYAXIS;break}}get altGridSize(){return this._altGridSize}set altGridSize(t){this._altGridSize=t}getAltGridSize(){let t=this._altGridSize.GridX,i=this._altGridSize.GridY,r=t.number/10,s=i.number/10,n=new al;return xn.getInstance().unit=="mil"?t.unit!=xn.getInstance().unit&&(r=n.conversion(t.unit,xn.getInstance().unit,r),s=n.conversion(i.unit,xn.getInstance().unit,s)):t.unit==xn.getInstance().unit&&(r=n.conversion(t.unit,"mil",r),s=n.conversion(i.unit,"mil",s)),{snapX:r,snapY:s}}set forceValue(t){this._forceDeactive&&this._forceValue!=t&&this.updateForceDeactivateRatio(t,this._forceDeactive),this._forceValue=t}get forceValue(){return this._forceValue}set forceDeactive(t){this._forceDeactive=t,this.updateForceDeactivateRatio(this._forceValue,t)}updateForceDeactivateRatio(t,i){t=t>.99?.99:t;for(let r of this.scenes)r.setForceDeactivateRatio(i?t:1)}set forceVisibleHighLightPt(t){this._forceVisibleHighLightPt=t,this.forceVisible()}set forceVisibleHighRange(t){this._forceVisibleRange!=t&&(this._forceVisibleRange=t,this.forceVisible())}get forceVisibleHighRange(){return this._forceVisibleRange}forceVisible(){let t=this._forceVisibleRange&&this._forceVisibleHighLightPt;for(let i of this.scenes)i.setForceVisibleHighLightPt(t)}setHighLightMode(t){if(this.highLightModeIsDark!=t){for(let i of this.scenes)i.setGlobalHighLightType(t?Bc.PT:Bc.MASK);this.highLightModeIsDark=t}}get forceVisibleHighLightPt(){return this._forceVisibleHighLightPt}get forceDeactive(){return this._forceDeactive}get projectTitle(){return this._projectTitle}set projectTitle(t){this._projectTitle=t||""}get editorVersion(){return this._editorVersion}set editorVersion(t){this._editorVersion=t||""}get isReadOnlyMode(){return this._isReadOnlyMode}set isReadOnlyMode(t){this._isReadOnlyMode=t}get isConcurrentStrictMode(){return this._isConcurrentStrictMode}set isConcurrentStrictMode(t){this._isConcurrentStrictMode=t}get importFlag(){return this._importFlag}set importFlag(t){this._importFlag=t||0}get source(){return this._source}set source(t){this._source=t||""}get envFlag(){return this._envFlag}set envFlag(t){this._envFlag=t}get multiType(){return this._multiType}set multiType(t){let i=Kn.getInstance();if(this._multiType!=t&&i.visible!=Yn.NOTSHOW)switch(this._multiType=t,t){case"grid":i.setMultiStyle(eh.Line);break;case"outlets":i.setMultiStyle(eh.Point);break;case"none":i.setMultiStyle(eh.None);break}}get multiRatio(){return this._multiRatio}set multiRatio(t){let i=Kn.getInstance();this._multiRatio!=t&&(this._multiRatio=t,i.setMultiRatio(t))}get unit(){return this._unit}set unit(t){this._unit=t;for(let i of this.scenes)i.modifyUnit(t)}get projectId(){let t=this._tabId.split("@");return t.length>=2?t[1]:""}getRatio(){for(let t of this.scenes)return(t==null?void 0:t.getPixelRatio())||1;return 1}attachScene(t){return!this.scenes.includes(t)&&t!=null&&(this.scenes.push(t),t.modifyUnit(this._unit),t.modifyBgColor(this._backgroundColor),t.resize(),t.setAntialias(this.antialias),t.openRuler=this._openRuler,this._rulerBackgroundColor&&t.setRulerBackgroundColor(this._rulerBackgroundColor),this._rulerStringColor&&t.setRulerStringColor(this._rulerStringColor),t.needRenderPanelize=this._needRenderPanelize,t.setRenderMode(this._renderMode),this._panelizeParam.success&&!this._panelizeParam.onlyOutline?t.setPanelizeInfo(this._panelizeParam.offset,this._panelizeParam.row,this._panelizeParam.column):t.setPanelizeInfo(),t.setForceVisibleHighLightPt(this._forceVisibleRange&&this._forceVisibleHighLightPt),t.setGlobalHighLightType(this.highLightModeIsDark?Bc.PT:Bc.MASK)),!0}getBgColor(){return this._backgroundColor}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t;for(let i of this.scenes)i.modifyBgColor(t)}get rulerBackgroundColor(){return this._rulerBackgroundColor}set rulerBackgroundColor(t){if(this._rulerBackgroundColor=t,t!=null)for(let i of this.scenes)i.setRulerBackgroundColor(t)}get rulerStringColor(){return this._rulerStringColor}set rulerStringColor(t){if(this._rulerStringColor=t,t!=null)for(let i of this.scenes)i.setRulerStringColor(t)}resize(t,i){for(let r of this.scenes)r.resize(t,i)}get openRuler(){return this._openRuler}set openRuler(t){this._openRuler=t;for(let i of this.scenes)i.openRuler=t}get needRenderPanelize(){return this._needRenderPanelize}set needRenderPanelize(t){this._needRenderPanelize=t;for(let i of this.scenes)i.needRenderPanelize=t}get renderMode(){return this._renderMode}set renderMode(t){this._renderMode=t;for(let i of this.scenes)i.setRenderMode(t)}getAntialias(){return this.antialias}setAntialias(t){this.antialias=t;for(let i of this.scenes)i.setAntialias(t)}get origin(){return this._origin}set origin(t){this._origin=t,this.scenes.forEach(i=>{i.setOrigin(this._origin)})}get customerCode(){return this._customerCode}set customerCode(t){this._customerCode=t}get owner(){return this._owner}set owner(t){this._owner=t}get clientOnlineService(){return this._clientOnlineService}set clientOnlineService(t){this._clientOnlineService=t}get doctype(){return this._isPreview&&(this._doctype==4||this._doctype==3)?23:this._doctype}set doctype(t){this._doctype=t}get id(){return this._id}set id(t){this._id=t}get tabId(){return this._tabId}set tabId(t){this._tabId=t}get isactive(){return this._isactive}set isactive(t){this._isactive=t}get footprintIsConnectDevice(){return this._footprintIsConnectDevice}set footprintIsConnectDevice(t){this._footprintIsConnectDevice=t}get panelizeParam(){return this._panelizeParam}set panelizeParam(t){this._panelizeParam=t,this.scenes.forEach(i=>{this._panelizeParam.success&&!this._panelizeParam.onlyOutline?i.setPanelizeInfo(this._panelizeParam.offset,this._panelizeParam.row,this._panelizeParam.column):i.setPanelizeInfo()})}get coreRenderingEngine(){return this._coreRenderingEngine}set coreRenderingEngine(t){typeof t<"u"&&this._coreRenderingEngine!=t&&(this._coreRenderingEngine=t)}getSceneBbox(){let t=new uc;return this.scenes.forEach(i=>{t.ext4(i.getBBox3())}),t.build()}};xn.env=null;var Ol=xn;async function Uy(e){var h,c;if(!e)return null;let{options:t,env:i,decodeTopic:r}=e;if(!t)return null;if(!r)return console.warn("Please check the decoding parameters"),null;let s=Ol.getInstance();i?(i.tabId||(i.tabId=s.tabId),i.windowTabId||(i.windowTabId=(c=Ms())==null?void 0:c._TAB_ID_)):e.env={tabId:s.tabId,windowTabId:(h=Ms())==null?void 0:h._TAB_ID_};let n=new Worker(`editor?entry=pcb-decode-worker.js${Ms().location.search.replace(/\?/,"&")}`),a=new oO.MessageBus(!0),l=(await new oO.WorkerMessageBridge(a,n).rpcCall(r,e)).message;return setTimeout(()=>{n.terminate()},0),l}Ze.messageBus=window._MSG_BUS_=window._MSG_BUS_||new bf.MessageBus;Ze.windowBridge=window._MSG_BUS_WIN_=window._MSG_BUS_WIN_||new bf.WindowMessageBridge(Ze.messageBus);Ze.pcbMessageBus=window._MSG_BUS_PCB_=window._MSG_BUS_PCB_||new bf.MessageBus(!0);var Zce=new Hp;Ze.gRecover=document.createDocumentFragment();Ze.gZoom=1;Ze.currZoom=100;var lP=new Date().getTime();Ze.messageBus.subscribe(Bp.ON_OPENED,({info:e})=>{Ze.currentProject=e});Ze.messageBus.subscribe(Bp.ON_CLOSED,()=>{Ze.currentProject={}});Ze.messageBus.subscribe(Cp.ON_TEMP_OPENED,e=>{Ze.currentProject={projectId:e.uuid,title:e.title}});Ze.messageBus.subscribe(Cp.ON_TEMP_CLOSED,()=>{Ze.currentProject={}});Ze.messageBus.subscribe(qu.PROJECT.ON_UPDATE,async({ops:e,projectId:t})=>{if(t!==Ze.currentProject.projectId)return;let i=(e==null?void 0:e.project)||(e==null?void 0:e.initPrj)||e;i.title&&i.title!==Ze.currentProject.title&&(Ze.currentProject.title=i.title)});Ze.messageBus.subscribe(qu.PCB.ON_ADD,async e=>{});Ze.messageBus.subscribe(qu.PCB.ON_UPDATE,async e=>{});Ze.messageBus.subscribe(qu.PCB.ON_DELETE,async e=>{});Ze.messageBus.rpcService("pcb/getIframeUrl",e=>{var t;switch(e){case 3:case 4:t="pcb";break;case 15:t="pcb3d";break}if(t)return`editor?entry=${t}`});Ze.pcbMessageBus.rpcService("getPcbAnnotationInfo",async e=>{var a;let{uuid:t,itemsId:i}=e;if(!t)return;let r={itemsId:i},s=Ol.getInstance();return await Uy({uuid:t,docType:3,projectId:e.projectId||Ze.currentProject.projectId,options:{data:r},env:{tabId:s.tabId,windowTabId:(a=Ms())==null?void 0:a._TAB_ID_},decodeTopic:"exportAnnotationConnectInfo"})});Ze.pcbMessageBus.rpcService("dataStr2RenderingdataStr",async e=>{let{uuid:t,docType:i,projectId:r,options:s}=e;return await new Vp(i,t,r).parse(s)});Ze.messageBus.rpcService("getLastModifyInPcb",function(){return lP});Ze.messageBus.subscribe("updateLastModifyInPcb",function(){lP=new Date().getTime()});Ze.messageBus.rpcService("handle3DModelFile",e=>Ze.messageBus.rpcCall("/model/import/auto",e));Ze.messageBus.rpcService("newOrReplace3DModel",gE);Ze.messageBus.subscribe("setUserInfo",e=>{Ze.globalVariableCookieData.userInfo=e});Ze.messageBus.rpcService("components2newFormatByIndexDB",async e=>await mE(e==null?void 0:e.attrs));Ze.pcbMessageBus.rpcService("pcb/decodePcbWorldInWorker",async e=>await Uy(e));})();
/*! Bundled license information:

lc-editor-common/dist/index.js:
  (*! Bundled license information:
  
  lc-protocol/dist/index.js:
    (*! Bundled license information:
    
    crypto-js/ripemd160.js:
      (** @preserve
      	(c) 2012 by Cdric Mesnil. All rights reserved.
      
      	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
      
      	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
      	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
      
      	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      	*)
    
    crypto-js/mode-ctr-gladman.js:
      (** @preserve
       * Counter block mode compatible with  Dr Brian Gladman fileenc.c
       * derived from CryptoJS.mode.CTR
       * Jan Hruby jhruby.web@gmail.com
       *)
    *)
  *)

kitsune/dist/index.js:
  (*! Bundled license information:
  
  three/build/three.core.js:
  three/build/three.module.js:
    (**
     * @license
     * Copyright 2010-2024 Three.js Authors
     * SPDX-License-Identifier: MIT
     *)
  *)

lc-protocol/dist/index.js:
  (*! Bundled license information:
  
  crypto-js/ripemd160.js:
    (** @preserve
    	(c) 2012 by Cdric Mesnil. All rights reserved.
    
    	Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    
    	    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    	    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    
    	THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
    	*)
  
  crypto-js/mode-ctr-gladman.js:
    (** @preserve
     * Counter block mode compatible with  Dr Brian Gladman fileenc.c
     * derived from CryptoJS.mode.CTR
     * Jan Hruby jhruby.web@gmail.com
     *)
  *)
*/
//# sourceMappingURL=https://modules.lceda.cn/pro-pcb/3.1.54.fb5a7cd6/js/pcb-main.js.map
